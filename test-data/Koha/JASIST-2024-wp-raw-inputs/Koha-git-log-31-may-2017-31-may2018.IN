commit 35f1fbfedbf628d8e0a043a011bba1c8627858af
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 29 15:53:59 2018 +0000

    Bug 20825: (QA follow-up) set biblioitemnumber with correct value
    
    Both biblionumber and biblioitemnumber for item were set to
    biblionumber, when they don't line up tests fail
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 0895eadd676ca477b2064d30015eed2ec454f4d9
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Mon May 21 14:56:58 2018 -0400

    Bug 20798: Client side validation for for fund selection prevents adding only some records to a basket
    
    Bug 19453 "fixed" the fund validation that never actually worked. This validation should be removed altogether instead. It is overly simplistic and simply checks to see if each record in the batch has a fund selected regardless of whether that record will be imported or not.
    
    In addition, the code completely ignores items generated by MarcItemFieldsToOrder such that even if items on that page have a fund selected, the javascript forces the librarian to make a selection from the left-hand fund pulldown even though it will not be used.
    
    Considering this bad validation is basically 'new' as it never worked before, the most sensible course of action would be to 'undo' the change and remove the validation.
    
    Test Plan:
    1) Add records to a basket from an import batch
    2) Select only some of those items in the batch
    3) Note Koha will not let you import them unless you set funds for *all*
       records in the batch
    4) Apply this patch
    5) Note Koha no longer forces a budget to be selected in the pulldown
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=20789
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit c48f3cd73c09d135a4c18b36d31b57382f9c2350
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sun May 13 01:44:28 2018 +0000

    Bug 20761: Fix some js includes in rancor
    
    To test:
    1 - Load the advanced cataloging editor
    2 - Inspect the network tab in your browser (F12)
    3 - Note failure to load 'cataloging_.js'
    4 - Note some other scripts don't have versioning
    5 - Apply patch
    6 - Reload page
    7 - Note cataloging.js loads with version number
    8 - Note more js files have versioning
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 69f74104d5e705b95d8207e61fedfbd71ca2e673
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed May 2 16:13:20 2018 +0200

    Bug 20696: Fix a few ugly "eq undef" comparisons in Search.pm
    
    Comparisons like $a eq undef should normally raise a warning like:
        Use of uninitialized value in string eq at ...
    But unfortunately we still suppress warnings here and there.
    
    Test plan:
    [1] Just read this patch and confirm the small changes.
    [2] Git grep on "eq undef" and do not find other occurrences.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Passes test plan and QA tools. Searching works correctly.
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit da6fde55dd2f4e11f73490d6502483748666d1e7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 24 16:33:19 2018 -0300

    Bug 20818: Add missing QA Manager entry in 18.05.00 release notes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 60b0d9439bf45519a3b64750831c7905ba92e21e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 18 14:01:09 2018 +0000

    Bug 20781: Set a minimum enrollemnt period 'in months' of 1
    
    To test:
     1 - Browse to Admin->Patron Categories
     2 - Click '+ New category'
     3 - Enter data as required, however, enter 0 in 'Enrolment period' ->
    'in months'
     4 - Save
     5 - View the list of categories, the new category has 'Enrolment period'
    = 'until'
     6 - Create a patron in this category, note their dateexipry is
    '0000-00-00'
     7 - Search for them
     8 - internal server error
     9 - Delete that patron
    10 - Apply patch
    11 - Edit the category, note you cannot save with 0 months
    12 - Set 1 month and save
    13 - Create a patron in this cateogry
    14 - Note they have a valid dateexpiry
    15 - Search for them
    16 - All works
    17 - Create a new category and verify you cannot add with 0 months
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 5486670aca2773b8205622e48058f34ec4827b74
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 14 14:04:01 2018 -0300

    Bug 20767: Display a stack trace when a method is not covered by tests
    
    When a method is not allowed yet (not covered by tests), developers get
    an error the is not really useful: "The method XXX is not covered by
    tests!"
    It would be more useful to have a stack trace in order to know where
    this error come from.
    
    Test plan:
    Modify some code to display this stack trace and confirm it makes sense
    to have it, i.e. it will make debug easier
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit db5628e7710325766e25648615c772d200348116
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed May 16 02:45:02 2018 +0200

    Bug 3886: Fix mismatch of required permissions for printing slips
    
    - Print summary (summary-print.pl)
    - Print quick slip (printslip.pl)
    - Print slip (printslip.pl)
    - Print overdues (print_overdues.pl)
    
    Perl scripts all require circulate_remaining_permissions, while
    in the template we were checking for edit_borrowers.
    
    Now the print pull down will only be visible if the patron has
    circulate or circulate_remaining_permissions.
    
    To test:
    - Verify that printing the listed slips works for staff users
      with either circulate or circulate_remaining_permissions
      and without edit_borrowers.
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 08c731f6da8ccb470e473bd089bc7e27289632ee
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 17 11:38:39 2018 +0000

    Bug 20774: Trivial HTML error in itemslost.tt
    
    This patch makes a minor correction to the markup of the lost items
    report template.
    
    To test, apply the patch and run the lost items report with parameters
    which will return results. The report results should look correct, and
    the page should validate with no relevant errors.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 76aa349ebe9dcaa84e667db770216a306f21ecf1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu May 10 17:54:38 2018 +0000

    Bug 20752: Fix capitalization on the files tab for patron files
    
    - Activate EnableBorrowerFiles
    - Go to any patron account in staff
    - Go to the files tab
    - Check that strings on the page ar all properly capitalized
      - button
      - legend on section
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 62595687c19d5a752b6c3e02e85fd94834c72e31
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri May 18 05:39:19 2018 +0000

    Bug 20791: Correct capitalization on 'Notices & slips' page
    
    - Standardizes spelling to 'Notices & slips'
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 6773a5e3006de18d4b9eb94697abb7fccafe08c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 28 11:40:20 2018 -0300

    Bug 20827: Display Fund's owner name when selected
    
    When a fund is created or edited and does not have a owner yet, the
    name of the patron will not be displayed when selected.
    
    The HTML element the JS code expects is not present in the DOM.
    
    Test plan:
    - Create a fund, set a owner
    - remove the owner, edit, etc.
    - Save
    - Edit again
    Make sure it works as expected.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 3b5599f00e2cfa3d6804c1bbcb0f353fbb837ab3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 24 15:38:41 2018 -0300

    Bug 20652: Fix result sorting after search on limit only
    
    1 chomp was missing, spaces were replaced with %20
    This patch adds extra chomps, but it does not hurt
    
    Test plan:
    Advanced Search
    Choose an Item type (do not enter any other search limits)
    Search
    Click on Sort (it doesn't appear to matter what you sort on)
    
    Signed-off-by: Pierre-Luc Lapointe <pierreluc.lapointe@inLibro.com>
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 82a4f23ee3a05d057047d0fde8b1b74cb4dfd6ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 28 15:11:09 2018 -0300

    Bug 20822: (bug 18789 follow-up) Fix HOLD_SLIP
    
    Caused by
      commit ab47e46ea0ade643b308a8b00708d57995c57050
      Bug 18789: Pass a Koha::Patron object from returns.pl
    
    circ/returns.pl does not send a $patron Koha::Patron object to the
    template in case print_slip is set
    
    Test plan:
    Confirm a hold and print the slip
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 96070c9ea431063052f8c360f52032db6568c139
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 28 11:24:43 2018 -0300

    Bug 20825: (bug 19943 follow-up) call notforloan on itemtype instead of biblioitem
    
    On bug 19943:
     -        elsif ($biblioitem->{'notforloan'} == 1){
     +        elsif ($biblioitem->notforloan == 1){
    
    The biblioitems table does not contain a notforloan column, this comes
    from the item type.
    
    This bug only appears when item type is defined at biblio level
    (item-level_itypes=0)
    
    Test plan:
    Set item-level_itypes = biblio
    Check an item out
    
    Without this patch it explodes with
    "The method notforloan is not covered by tests!"
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    I reproduced the error condition and verified the tests failed without
    this patch. After this patch is applied, tests pass and checkout
    succeeds.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit b64262af2a237505c775739e7cbd2465637498ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 28 11:20:32 2018 -0300

    Bug 20825: Add regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit c320e7e01ccaba92db74fb62caefdfaa1e06006f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 25 16:54:31 2018 +0000

    Koha 18.06 - It's Adventure time!
    
    There was once an ILS from New Zealand
    They said "How hard could it be?" and
    So we all came together
    To help make it better
    Come join us! The adventure will be grand!
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit df8716197ad36f168689b98994fd693893c9d5d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 24 10:40:27 2018 -0300

    Koha 18.05.00 is here!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c20957cb101a5149e4d935ec794c7b17671a8d1e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 24 11:45:52 2018 -0300

    Add release notes for Koha 18.05.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec23ba9c222de74e2698fcd36001bd732b4a5a70
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 24 14:18:08 2018 -0300

    revert missing part of bug 20073
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad96a900f265fce294d99d760dd0e6fa3b9f16a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 24 14:17:18 2018 -0300

    Revert "Bug 20073: Update DBIC Schema changes"
    
    This reverts commit dc300b6547355019d9135c2023c444df7a7f3cff.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 279a8953c443eddece5a3f5fb8c6bfd96d8fcd54
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 24 14:26:55 2018 -0300

    Fix translation issues
    
    1.
     <failure message="msgfmt
     failure">misc/translator/po/fr-CA-staff-prog.po:713: number of format
     specifications in 'msgid' and 'msgstr' does not match
    
    2.
     <failure message="msgfmt
     failure">misc/translator/po/hy-Armn-staff-prog.po:53901: 'msgstr' is
     not a valid C format string, unlike 'msgid'. Reason: The character
     that terminates the directive number 1 is not a v
     alid conversion specifier.
    
    Found with:
     sudo apt-get install translate-toolkit
     junitmsgfmt misc/translator/po/ar-Arab-staff-prog.po
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 548753687126f00b226e97cc6ab6c52359c2ea5e
Author: Koha translators <>
Date:   Thu May 24 10:37:29 2018 -0300

    Translation updates for Koha 18.05.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21c81528a849d5f95159ec2638e3d480ced65b38
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 24 10:09:36 2018 -0300

    Bug 19287: (follow-up) Use the notice defined for the library of the patron
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa3a2943f67fc6227ce90713cc2f05081e8b91f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 3 09:09:19 2018 -0300

    Bug 20701: Add csrf protection to mancredit.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6f99f0df11e824353fa051b595b01bf8b4ac28d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu May 3 11:52:24 2018 +0000

    Bug 20701: Add csrf protection to maninvoice.pl
    
    TO test:
    1 - Be signed in to Koha
    2 - Add a manual invoice to an account, works fine
    3 - Now do it via url: http://localhost:8081/cgi-bin/koha/members/maninvoice.pl?borrowernumber=5&type=test&amount=5&add=Save
    4 - Apply patches
    5 - Test that everything continues to work as expected (but more securely)
    6 - Try adding a new invoice via URL
    7 - Should get 'internal server error' and wrong csrf token in logs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe8a617efd36826c405882adf96c9081aad5b137
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue May 22 17:46:36 2018 +0000

    Bug 20803: Cannot search to hold or use print options from API keys interface
    
    This patch adds a required JS asset to the patron API key interface.
    Without it, JS-based functions in the toolbar do not work.
    
    To test you must have RESTOAuth2ClientCredentials enabled.
    
     - From a patron detail page, choose More -> Manage API keys.
     - Test the toolbar buttons on this page, especially "Search to hold"
       and the various print options.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 148fb34d4d28f9ad389026ba16805cb29d58b9d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 8 14:27:38 2018 -0300

    Bug 20730: Move the authentication block before doing anything
    
    No need to add more information here, it's self-explanatory...
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81703f58ce12b178806b260193cd7e8a06efa653
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Tue May 22 13:48:10 2018 +0200

    Bug 20801: Make dependency on memcached mandatory
    
    Move memcached from suggested to depends for Debian packages.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56813f5c90827df0fd89262917e7f9920f7d9175
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Tue May 22 12:32:19 2018 +0200

    Bug 20800: Keep Koha on Stretch from using broken libhttp-oai-perl
    
    libhttp-oai-perl in Stretch is 4.03 and broken. Koha depends on
    libhttp-oai-perl << 4 for that reason. To make the installation of Koha
    on Stretch as easy as possible, this patch adds the alternative
    libhttp-oai-3.27-perl which we provide in the Koha repository.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cff62796ea9fc227c24fec8f8f3f153a715796ef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 21 11:02:04 2018 -0300

    Revert "Bug 20073: Move Elasticsearch configs to yaml files and improve the default settings."
    
    This reverts commit f489d2034bbc3bff67230423a7986d5ea34060ec.
    
    This commit breaks the install process when using debian packages.
    Reverting as we are very close to the 18.05.00 release
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1a95094e731f3816ff862fe22c317006f0f73ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 21 11:01:58 2018 -0300

    Revert "Bug 20073: Remove perlcritic error"
    
    This reverts commit 67359a97f4cbf828dbe93a7b08ec7283258b46c5.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2f5371b019b1c3d9b3e926aef2592c3e764ae46
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 21 10:40:43 2018 -0300

    Bug 20792: (bug 18789 follow-up) Fix patron edit page if TranslateNotices is set
    
    translated_language is not a Koha::Patron's method but a simple variable
    sent to the template.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb8b0824ff94380cffb200ecdccae23df1f2314f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 17 13:36:48 2018 -0300

    Release notes for 18.05.00-rc2
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5de40713a518f02a4cc6e4f4898bd78fee287ee0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 17 13:16:32 2018 -0300

    Bug 18786: Add PAYMENT_TYPE to the installer file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cb0147affce54f19004173456ff2f8027767b30
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Jan 11 09:44:08 2018 -0500

    Bug 18856: (QA follow-up) Rename method to avoid confusion
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Hmm. I would have liked the opac parameter even better ;)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 710c0e5df644731cee15f91b4ebc62924f7f85c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 10 16:49:33 2018 -0300

    Bug 18856: Don't show cancel option for waiting holds in OPAC
    
    This is the alternative patch of Kyle's
    """
    If a hold is 'waiting' for the patron to collect then the patron should
    be prevented from cancelling the hold via their account in the opac.
    If a patron tries to cancel the hold, Koha will give an 'are you sure'
    alert and when you click Yes the page just refreshes and the hold
    remains.
    Staff can cancel the hold from the staff interface but they can then
    action the waiting hold.
    I think therefore that it is correct behaviour that a patron cannot
    cancel a hold when it reaches waiting state via the opac but it would be
    useful to either have a warning to prevent the cancellation or a useful
    message when they attempt to do so.
    
    The template was using a method that tells Koha if *staff* can cancel a
    hold,
    instead of patron.
    
    Test Plan:
    1) Set up a waiting hold
    2) Try to cancel it from the opac
    3) Note you cannot
    4) Apply this patch
    5) Reload the page
    6) Note the cancel button has disappeared for found holds
    """
    
    It sounds better to keep the ->is_cancelable method, for readability
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45b6ea652797288d2910b121e3009696c847791d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Apr 17 07:55:52 2018 +0200

    Bug 19862: Turn off RoutingListAddReserves on new installations
    
    The RoutingListAddReserves feature currently doesn't work as
    expected (see bug 2894) and should be turned off for new
    installations until properly fixed.
    
    To test:
    - Run the web installer
    - Confirm that RoutingListAddReserves is set to "Don't place"
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1c7f5ede60ef63f5da969ff8495675248e50102
Author: Lee Jamison <ldjamison@marywood.edu>
Date:   Wed May 16 11:56:26 2018 -0400

    Bug 7143: Update about page for documentation team
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92ac27b7b2b91ff9003bde41c21a19a002be778c
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue May 15 02:59:24 2018 +0000

    Bug 20706: Fix bad HTML link to help file
    
    Before there is no href.
    After there is.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c1092396a520f6784bbcc45b3d3e251864336ca
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu May 10 19:03:47 2018 +0200

    Bug 20706: Adds en language code to the links to the manual
    
    As we don't have a fix yet to link to the right translated manual,
    this adds /en to the links from the help files to the manual to
    make them work again.
    
    Check with both patches applied, that the links work.
    You will have to change 17.11 to 18.05.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 554642ae75042a1565dbdc9044b6f614db218a55
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu May 3 23:26:40 2018 +0200

    Bug 20706: Fixes the links to the manual to reflect chanced chapter file names
    
    The numbering in front of the chapter file names has been removed,
    so the links need to be adapted accordingly.
    
    Note:
    Testing this in master currently won't work for 2 reasons:
    - We are still using 17.11 as version variable, will be 18.05 later.
    - We are missing the lanugage code before /html and this leads
      to an outdated version of the 18.05 manual.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88ac8c499f878a1c0ac622d53742a3d9acea1f64
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed May 16 14:43:27 2018 +0200

    Bug 20724: (QA follow-up) Remove two obsolete comment lines
    
    No test plan :)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b6dc6b23ccb26e18c437a578b4e20174ee1ea58
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 10 11:40:33 2018 -0300

    Bug 20724: Add tests for ReservesNeedReturns
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1798d22e764bebf46e2915e1c0b7c3360ea8dd51
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 10 11:40:11 2018 -0300

    Bug 20724: Move the ReservesNeedReturns logic to AddReserve
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c585f1149770ec401f188e061211501897cec0bf
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu May 10 08:12:04 2018 -0400

    Bug 20724: Correctly mark an hold as waiting - ReservesNeedReturns
    
    We need to call Koha::Hold->set_waiting to correctly
    calculate the expiration date.
    
    It fixes a regression introduced by
      commit 26634151dbce0bf39ff6c9eda5b58bb993996a2d
      Bug 12063 - Fix QA failures
    
    The expiration date has to be set for waiting holds
    
    == Test plan (time to execute: less than 4min) ==
    1. Set ReservesNeedReturns to "Don't automatically"
    2. Place a hold on a specific item
    3. Check it in and confirm hold
    4. The hold should have an expiration date
         record page → Hold → "Expiration" column
    5. It should be listed in staff:/cgi-bin/koha/circ/waitingreserves.pl
    6. Set ReservesNeedReturns to "Automatically"
    7. Place a hold on a specific item
        (which should also behave like we check the item in to
        keep it for the patron)
    8. The hold should have an *empty* expiration date
         record page → Hold → "Expiration" column
    9. Holds awaiting pickup page should crash
         staff:/cgi-bin/koha/circ/waitingreserves.pl
    10. Cancel the hold to remove the corrupted data
         record page → Hold → the red X
    11. Apply this patch
    12. Place a hold on a specific item
    13. The hold should have an expiration date (not empty)
    14. It should be listed in staff:/cgi-bin/koha/circ/waitingreserves.pl
    15. Celebrate!
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b31bc2d27c6e045a6e7ea079778c47674c135db
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Tue May 15 19:23:25 2018 +0200

    Bug 20437: Update debian/control
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05ebfaf0c04cce35933f81e48de95b307da1c325
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 16 15:22:47 2018 -0300

    Bug 20437: Force the dependency on HTTP::OAI < 4.0
    
    Until HTTP::OAI is patched so it actually works, and bug 17704 fixes the API change Koha-side, we need to explicitly pull the right version. Otherwise people using Debian 9+ derived distros (Ubuntu 16.04+) are seeing production issues.
    
    This implies packaging our custom libhttp-oai-perl distribution in the meantime.
    
    This patch makes Koha require a version lower than 4.0.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a6cad2fa9d8e4419be7538949b4ce9a758d0e9b
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Tue May 15 13:58:03 2018 +0200

    Bug 20693: Update control file
    
    Auto-generated file.
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9e06c38495ad9b7c14a9866414c229da92833db
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Tue May 15 13:47:10 2018 +0200

    Bug 20693: Plack fails, because 'libcgi-emulate-psgi-perl' package is not installed
    
    Add CGI::Emulate::PSGI to PerlDependencies.pm
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 856d48016b853cac1c34e723628e52806fbc3d43
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Mon May 14 22:21:14 2018 +0200

    Bug 17084: Automatic debian/control updates (master)
    
    18.05.00-rc1
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3422a0d93eb2ac607b9deee57f9e5c034907c839
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 14 13:09:16 2018 -0300

    Bug 20764: Fix Plugins.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdad7aec0e34c81c7eb02a2de7552c4a03998a62
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 14 12:33:48 2018 -0300

    Bug 20764: (follow-up) Rename the test file
    
    There is something wrong here...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46b648545470bcd39d751bff0709c0ec6d79e041
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 14 12:25:42 2018 -0300

    Bug 20404: Fix Patrons/Import.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a125dfb9144ae4165d9790121db1ed3b7129dc4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 14 12:14:33 2018 -0300

    Bug 20764: Rename the test file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3523a01a07381a701375b81d540e325559449aae
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 14 12:03:32 2018 -0300

    Bug 20764: (QA follow-up) Fix path to sample plugins
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 831e6fac4d84cf5cbc63354dcd1baa5100cfaba7
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Mon May 14 14:46:20 2018 +0200

    Bug 20764: Koha_Template_Plugin_KohaPlugins.t is db dependent
    
    t/Koha_Template_Plugin_KohaPlugins.t is DB dependent.
    This patch moves it to t/db_dependent/
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71eba3a74a65b49aeb5c24ddd5118df882cef14b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 14 11:11:34 2018 -0300

    Bug 20428: Display warning if the entry is empty
    
    And not only if the entry is missing. We should do the same for other
    entries.
    Also, use Koha::UploadedFile->temporary_directory to know the fallback
    value.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a88e052ae5e420eb2f8ffa7555756b0581b72652
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon May 14 09:05:21 2018 +0200

    Bug 20428: (QA follow-up) Remove redundant directory level
    
    Upload creates its own upload folder in the temp folder, so there is no
    need to add another level in temporary_directory.
    Removing the creation of this folder in koha-create-dirs too.
    
    Also removing the use Koha::UploadedFiles in about.pl. No longer needed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fdb5d0ca1ac16563c4b34c47dd32d61f96913d8a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 11 14:24:32 2018 -0300

    Bug 20428: Make upload_tmp a more general tmp directory
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ffaa7b8a32b9ee2d9d430c097322708f090f8f7
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue May 8 16:14:48 2018 +0000

    Bug 20428: Added missing parameter --upload-tmp-path
    
    Line 463 lists valid parameters, but it was missing
    upload-tmp-path: which resulted in the koha-create
    saying it is an invalid parameter.
    
    TEST PLAN
    ---------
    1) apply all patches but this.
    2) sudo perl ~/misc4dev/cp_debian_files.pl
    3) restart_all
    4) sudo koha-create --create-db --upload-tmp-path unique-path
    awesome-test-name
       -- Fails to run.
    5) apply this patch
    6) repeat 2-4
    7) sudo vi /etc/koha/sites/awesome-test-name/koha-conf.xml
       -- the upload_tmp_path entry should have unique-path
          in it.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da2886132e8445dd472b8b9ccd67e07365657c3a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 29 10:45:30 2018 -0300

    Bug 20428: Make about.pl inform about missing upload_tmp_path entry
    
    This patch makes about.pl warn about a missing upload_tmp_path entry in
    koha-conf.xml. It also mentions the effectively used tmp dir.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b0c27beafae072087d1e63bb00cc5b193ed9917
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 29 10:44:59 2018 -0300

    Bug 20428: Make Koha::UploadedFile use the new config entry for tmp files
    
    This patch makes Koha::UploadedFile->temporary_directory try to use the
    new configuration entry. It will fallback to File::Spec->tmpdir
    otherwise.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d90d8c9b272061986c101763d7c8f73ed7a9b0a2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 29 10:25:43 2018 -0300

    Bug 20428: Add the option to specify a tmp uploads dir
    
    This patch adds an option to the koha-conf.xml file for specifying
    a temporary uploaded files directory.
    
    The koha-create script is adjusted to handle it and a convenient option
    switch is added. If ommited, it will default to
    /var/lib/koha/<instance>/uploads_tmp.
    
    koha-create-dirs is patched to create the required directory with the
    right permissions.
    
    The docs get the new parameter documented.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 624870631ce374e90db2035545150eca95c72677
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu May 10 21:05:07 2018 +0200

    Bug 20404: Turn on ExtendedPatronAttributes by default for new installations
    
    Extended patron attributes are a very useful feature that should be
    more obvious. We should activate them by default for new installations.
    
    For testing:
    - Run the web isntaller on an empty database
    - Check that after installation ExtendedPatronAttributes is turned on
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c65526f4904d6070cd88b3e7cb56a7beaed18e20
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 11 16:25:13 2018 -0300

    Bug 19181: Do not screenshot
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52e93b7121321b1e4b5c0872dd2c49f1cfaa80fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 11 15:41:35 2018 -0300

    Bug 19181: Fix jenkins failure
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35d887fece0634eb92d030b959aeb991f10a0239
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri May 11 17:43:33 2018 +0200

    Bug 20623: (QA follow-up) avoid fetch() calls in some cases
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8a3fae361223c39244d8abde368d0877cf24652
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 9 11:51:20 2018 +0000

    Bug 20737: Use https for baker and taylor cover images
    
    Easy change, should be able to verify with code review or testing with
    dummy values
    
    To test:
    1 - Put some values in baker and taylor prefs (don't need to be valid)
    2 - Do a search on the opac (and have some items with isbns)
    3 - Inspect the cover images links to ensure they are formed correctly
    4 - prove -v t/External/BakerTaylor.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92e318dfc5d26bd3c9c0e9963f4eca3b45677f47
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 4 13:54:49 2018 +0000

    Bug 20707: Replace circ/search.pl circulate permission requirement with catalogue
    
    To test:
     1 - Setup a staff patron with permissions:
       - catalogue
       - reserveforothers
       - course_reserves
     2 - Log in to staff client as that patron
     3 - Find a record and click to place a hold
     4 - Type more than three letters into the search bar but don't submit
     5 - Note that you will not receive autocomplete results
     6 - Either submit, or try to visit any page in staff client
     7 - Your session has been expired, you must log in again
     8 - Log in, go to course reserves
     9 - As before, trigger the autocomplete search in the instrcutor field
    10 - Again your session has been terminated
    11 - Apply patch
    12 - Repeat above actions, this time you will not be kicked out
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54944bd10299d8af3c698d50ac75839af45fa300
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 18 15:11:47 2018 -0300

    Bug 7910: Give feedack when the subscriptions have been renewed
    
    This patch adds a message to the user to let them know the subscription
    have been renewed successfully.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 935af3eab537244d9fbb70207ee41d7874591fdd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 13:29:06 2018 -0300

    Bug 19792: Few minor fixes
    
    - No string extrapolation needed on SQL queries
    - '== undef' must be written 'if not defined'
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f3f232175183e117931bb6895cbc2d3dbf64534
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Dec 27 17:04:36 2017 +0100

    Bug 19792: (QA follow-up) Move anonymous sub out of GetHierarchy
    
    Test plan:
    Run t/db_dependent/Budgets.t.
    Without both patches, running the test is slower than with only the first
    or both patches.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1edd7f8265b5e51f3e651c207ee8c3301273891f
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Mon Dec 11 11:56:27 2017 -0500

    Bug 19792: Performance boost for GetBudgetHierarchy
    
    This patches reduces the number of SQL calls by combining multiple calls to the recursive functions GetBudgetSpent(), GetBudgetOrdered(), etc. into 4 big queries.
    It also removes duplicate function calls from acqui-home.pl
    
    Test plan:
    0) Visit Acquisition home
    0) Apply patch
    1) Refresh page. It shoud look identical.
    2) prove t/db_dependent/budgets.t
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5347537f1ab216dd283a5c85604b28d6f2d5c21c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 22 14:52:26 2017 -0300

    Bug 19579: Do not confirm the registration if email already used - PatronSelfRegistrationEmailMustBeUnique
    
    If PatronSelfRegistrationVerifyByEmail and
    PatronSelfRegistrationEmailMustBeUnique are set, it should not be
    possible to register twice with the same email.
    However the test is made on already created patron cards when the
    registration is done.
    Which means it is possible to register several times with the same
    email address and click on the registration link to finalise the
    registration.
    
    This patch adds a test when the registration link is clicked and display
    the "Registration invalid" generic message if the same email is used
    
    Test plan:
    1. Patron submits self registration form using the same email address 3
    times
    2. Patron receives 3 verification emails
    3. Patron clicks on 3 verify token URLs
    => Only the first registration should succeed, the 2 others must fail
    
    Maybe we should display a more specific message?
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bc3bbfdc78bfd559fec841c6ca47ddcbeb0f179
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 11 11:33:32 2018 +0200

    Bug 20623: (QA follow-up) Remove one find call
    
    Imo these somewhat weird lines ask for improvement, but I don't want to change
    the exact conditions here. Just removing the need to call find twice.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3811985c3a55b72900ba005c6867059776ee9281
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri Apr 20 11:17:26 2018 +0200

    Bug 20623: Fix basket group PDF when itemtype not itemtype table
    
    When an item has an itemtype not in the itemtype table. Trying to fetch
    it's description lead to an error.
    Using authorized values like ccode to populate the itemtypes of the
    biblioitems (instead of the itemtype table) can lead to such data.
    Or importing records with invalid itemtype codes. Koha doesn't do enough
    checks at import to at least warn about these issues.
    
    == Test plan ==
    1. first we need an item with an itype not in the item_types table
       1. download a record as MARCXML
       2. find it's item type in administration; and the related code
       3. open the MARCXML file and search for occurences of the code
            and replace them by some non-existing value like "FOOBAR"
       4. also change the barcode so it won't be ignored because
            it's a duplicate
       5. also change the title to easily find it later in the search
       6. tools → "Stage MARC records for import"
       7. upload your file
       8. "stage for import"
       9. click "Manage staged records"
            You should end on the page related to your staged record
       10. "Import this batch into the catalog"
    
    2. now we need it in a basket group
       1. have/create a active budget
       2. have/create a fund
       3. have/create a vendor with minimal info
       4. create a basket with minimal info
       5. add our imported item to the basket
            for example search it by name
       6. go to the basket. URL should be
          /cgi-bin/koha/acqui/basket.pl?basketno=XXXXX
       7. close this basket
            and tick "Attach this basket to a new basket group with the same name"
       8. you will end up in the basket groups lists
       9. go to the "closed" tab
       11. go to the basket group
              your vendor page => Basket groups => Closed
    
    3. export as PDF, it should fail (internal server error)
         this is the bug (no kidding ^_^)
    4. apply this patch
    5. reexport the basket as PDF
    6. it should work
    7. create an item type (in administration)
         that has the same code as the one that you put in the MARCXML
    8. reexport the basket as PDF
    9. check that in the PDF that the description is here:
         table at the bottom of the document → "Document" column
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4200ffb720f1864a6ee02c071dc5aa09ee258f42
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 7 15:04:33 2018 -0300

    Bug 20722: Display search results when searching only by ITEMTYPECAT
    
    - Create an entry for the ITEMTYPECAT authorised value category.
      Make sure to fill in the OPAC description.
    - Go to administration > itemtypes and add the new category to 2 item types.
    - Go to the OPAC and check that the advanced search shows your new itemtype
      group instead of the individual itemtypes.
    - Check the checkbox and Search.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fce2434666505460030db1df3869c87c1ef83a7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed May 2 14:50:32 2018 +0200

    Bug 20695: Fix multiple upload result in tools/upload script
    
    Instead of calling UploadedFiles->find only once with $id, we should
    extract all comma separated id's from the parameter.
    
    Test plan:
    [1] Before this patch, upload two files at once in Tools/Upload. After doing
        so, you should see only one result reported. But both files should
        have been uploaded.
    [2] With this patch, repeat step 1 and see two upload results.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Patch applies and functions as described.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b47ed3f9076f76ce476da7314c08841ce5252d1
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon May 7 18:14:22 2018 +0000

    Bug 20719: USE Branches in TT files
    
    TEST PLAN
    ---------
    In the staff client on a kohadevbox:
    1) Enable the HouseboundModule system preference.
    2) Enable the EnableBorrowerFiles system preference.
    3) Go to a patron detail page.
       -- note the Home library is shown.
    4) Go to Fines tab (left pane)
       -- Home library is still shown.
    5) Click each of the four horizontal tabs
       (Account, Pay fines, Create manual invoice,
        Create manual credit)
       -- Home library not visible for both create tabs
          and the account tab
    6) Click the 'Create manual invoice' tab, and create
       some kind of entry.
    7) On the 'Account' tab, the table has a 'Details' button.
       Click that.
       -- Home library not visible.
    8) Click the 'Details' tab in the left pane.
    9) Click 'More' button and choose 'Delete'
       -- Home library not visible when asked for delete
          confirmation.
    10) Cancel that, and if you know how to actually
        set up the Norwegian system preferences you can
        figure out how to test the nl-search change.
    
    After seeing all these not visible, apply this patch.
    Repeat all the steps, but this time the Home library
    should be visible.
    
    Works OK.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a7976e34f12dfa2eb1ddc7d39db2271aa5f2e26
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon May 7 17:48:57 2018 +0530

    Bug 20719: Add missing USE Branches to files.tt
    
    Test
    
    On a kohadevbox:
    0. Enable the EnableBorrowerFiles system preference
    1. Go to any patron, and click on the 'Files' tab in the
       left pane.
       -- the Home library is not displayed.
    2. Apply the patch, restart_all, and reload the page.
       -- the Home library is now displayed.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f55f4e090b3d961abe0206fc1ed01335d0e6f909
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 09:34:20 2018 -0300

    Bug 20746: Move it-IT files to optional
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ea48ca9345862fc655e0ef418ea91d040ead03a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 10 12:37:53 2018 -0300

    Bug 20745: koha-zebra doesn't return the correct error codes
    
    This patch makes koha-zebra return 0 (or 1) even when verbose mode is
    off. This made koha-zebra --start always return a failure even when the
    daemon was correctly launched.
    
    To test:
    - Have Zebra running for kohadev instance on your KohaDevBox
    - Run:
      $ sudo koha-zebra --stop kohadev && echo yay || echo doh
    => FAIL: 'doh' is printed
    - Run:
      $ sudo koha-zebra --start kohadev e&& echo yay || echo doh
    => FAIL: 'doh' is printed as well
    - Apply this patch
    - Run:
      $ sudo perl misc4dev/cp_debian_files.pl
      $ sudo koha-zebra --stop kohadev && echo yay || echo doh
    => SUCCESS: 'yay' is printed
    - Run:
      $ sudo koha-zebra --start kohadev e&& echo yay || echo doh
    => SUCCESS: 'yay' is printed
    - Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3fd46d3dd7e87e2857437f45b9bdaae990c5fd1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 25 16:08:25 2018 -0300

    Bug 19181: Add new tests
    
    This patch reuses the method newly added to Selenium.pm and improve
    existing tests.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0f66431758d1d051f8e6d165df027745c2a8f66
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Oct 30 03:28:20 2017 +0000

    Bug 19181: Change to use ENV, fix login and passwords
    
    The kohadevbox has admin/admin set, so for testing when
    creating the initial superuser, if you wish to minimize
    effort, use admin/admin. Otherwise, make sure to:
    export KOHA_USER={whatever your user is}
    export KOHA_PASS={whatever your password is}
    before attempting to run the test.
    
    Also, this test was failing because of a validation check on
    the passwords requiring uppercase letters, lowercase letters,
    and numbers. Changed the sample data passwords to fix.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 837fa4e6f7010b2ce94bff36fd9ceaf94de93a18
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Thu Jul 20 10:50:49 2017 +0000

    Bug 19181: Selenium test for logging into the Koha intranet and OPAC
    
    This selenium test goes through the process of creating a category and
    patron user (as is completed in the basic_workflow.t test) then the
    superlibrarian used to create them is logged out and the newly created
    patron user authenticates into the OPAC and staff intranet therefore testing the
    authenitcation of both.
    
    Test plan (this test plan includes how to install Selenium as well as
    how to run this test, for the benefit of people who have not got
    Selenium installed on their machines):
    
    1. wget https://selenium-release.storage.googleapis.com/2.53/selenium-server-standalone-2.53.0.jar
    
    2. vim /etc/apt/sources.list.d/firefox.list
    
    3. Paste into the file:
    deb http://packages.linuxmint.com debian import
    
    4. sudo apt-get update
    
    5. sudo apt-get install firefox
    
    6. sudo apt-get install xvfb
    
    7. Set the SELENIUM_PATH vartiable:
    SELENIUM_PATH=/home/vagrant/kohaclone/selenium-server-standalone-2.53.0.jar
    
    8. Xvfb :1 -screen 0 1024x768x24 2>&1 >/dev/null &
    
    9. DISPLAY=:1 java -jar $SELENIUM_PATH
    
    Note: This will start up the selenium server. Everytime you want to shut
    down this terminal window and want to restart Selenium just run the step
    9 command to restart the Selenium server
    
    10. Open a new terminal window and write in:
    git clone https://github.com/gempesaw/Selenium-Remote-Driver --branch
    build/master --single-branch --depth 1
    
    11. cd Selenium-Remote-Driver
    
    12. perl Makefile.PL
    
    13. make
    
    14. make test
    
    15. sudo make install
    
    16. Now everything is installed and you can et up for running the selenium tests
    
    17. Create a superlibrarian user with the username koha and password
    koha
    
    18. If your usual port configuration for the intranet and OPAC is 8081
    and 8080 respectively then set the staffClientBaseURL and OPACBaseURL
    system preferences to localhost:8080 and localhost:80 respectively
    
    19. sudo koha-shell <instancename>
    
    20. perl t/db_dependent/selenium/authenticate.t
    
    21. The test should pass.
    Note: The time_diff comments in the test output showing what the test is
    doing
    
    Note: If you have issues with installing Selenium and
    Selenium::Remote::Driver please write a comment on the bug report and I
    will be more than happy to create a screencapture video showing all the
    steps
    
    Sponsored-By: Catalyst IT
    
    https://bugs.koha-community.org/show_bug.cgi?id=19181
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee82d441c2d84a506e553cf8e1e95984bae85204
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 4 09:54:30 2018 +0200

    Bug 11943: Add unit test for double accepts
    
    Test plan:
    Run t/db_dependent/Virtualshelves.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94fd62dac9b8c0bcb3127c4eef91781984c55f7b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 4 09:34:02 2018 +0200

    Bug 11943: Prevent double accepts in Koha::Virtualshelfshare
    
    This 'bug' existed long enough now to finally remove it ;)
    
    We do so by deleting the invitation if the borrower already has a share
    on this list. Actually not that hard.
    
    We still need: a unit test and a db revision.
    
    Test plan:
    [1] Share a list. Let user B accept.
    [2] Without this patch: Share again and let B accept again.
    [3] Verify that you have two shares for this list in virtualshelfshares.
    [4] With this patch: Share another list, let B accept.
    [5] Share this other list again, let B accept again.
    [6] Verify that virtualshelfshares does not contain double entries now.
        (Note: This pertains to the second list only.)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2ea81e6529768ec4e85afb46cf2e3b7255f9a2e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 10 14:41:45 2018 -0300

    Bug 18789: Fix borrowernumber on members/files.tt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc300b6547355019d9135c2023c444df7a7f3cff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 9 12:55:31 2018 -0300

    Bug 20073: Update DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe7e0d1e5257f266ea81370553d235164186c245
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 9 11:31:34 2018 -0300

    Bug 20734: Add warning to the about page if RESTOAuth2ClientCredentials and not Net::OAuth2::AuthorizationServer
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8acd86231a3b63f311a1c6357acc8096bef06ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 8 16:07:03 2018 -0300

    Bug 20624: DBRev 17.12.00.044
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17e8acad70c778a1d544ad2cb22e0fc98ba2f312
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 8 14:58:55 2018 -0300

    Bug 20624: Net::OAuth2::AuthorizationServer is not a hard dependency
    
    While we get packaging sorted, Net::OAuth2::AuthorizationServer is not a
    hard dependency for Koha and the feature requiring it is disabled by
    default.
    
    This patch:
    - Makes the dependency optional
    - Makes the unit tests for the OAuth2 client credentials flow skip if
      the dependency is not met.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 432dd41418003494c6db24ef0fc9d81f83186ba3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 7 11:57:59 2018 -0300

    Bug 20624: (QA follow-up) Add missing POD in Koha::REST::V1::OAuth
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 763343a152b1e2a7a0c4fb6f6b8fd685843eb562
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 3 15:29:22 2018 -0300

    Bug 20624: (QA follow-up) Handle missing deps gracefuly
    
    This patch makes the /token endpoint and the authenticate_api_request
    method behave correctly in the event of missing deps for OAuth2.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/oauth.t
    => FAIL: The behaviour is not implemented
    - Apply this patch
    - Run:
     k$ prove t/db_dependent/api/v1/oauth.t
    => SUCCESS: Tests pass!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8579ac6c4fac0a660b506949bc47fcc7faf7674
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 3 15:24:56 2018 -0300

    Bug 20624: (QA follow-up) Unit tests for missing deps situation
    
    This patch tests the situation in which Net::OAuth2::AuthorizationServer
    is missing. It mocks Module::Load::Conditional::can_load and expects the
    /token endpoint answers 'Unimplemented grant type' to all requests, and
    the 'authenticate_api_request' in 'under' exit with unauthorized (403)
    to requests in which the Authorization header is passed containing a
    Bearer token, but OAuth2 is not really available.
    
    To test:
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/oauth.t
    => FAIL: Tests fail because our REST endpoints don't support this
    behaviour.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cf8bbfb7aea34b6367dfbbfb9d73f88851507fb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 2 15:55:31 2018 -0300

    Bug 20624: Make staff client respect RESTOAuth2ClientCredentials
    
    This patch makes the staff client UI respect the
    RESTOAuth2ClientCredentials syspref.
    
    To test:
    - Make sure RESTOAuth2ClientCredentials is "Don't enable"
    - Go to a patron's detail page
    => SUCCESS: The 'More' dropdown doesn't show the API keys management
    link.
    - Enable RESTOAuth2ClientCredentials
    - Reload
    => SUCCESS: The 'More' dropdown shows the API keys management link
    - Click on the API keys management link
    => SUCCESS: You can edit the api keys
    - Disable the syspref
    - Reload
    => SUCCESS: You are presented an error 400 page.
    - Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 997a5705504b63cbaf9ae41f0487f5c1654c686f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 2 15:51:38 2018 -0300

    Bug 20624: Make /api/v1/oauth/token respect RESTOAuth2ClientCredentials
    
    This patch makes the /api/v1/oauth/token enpoint respect the
    RESTOAuth2ClientCredentials syspref. It will return 400 (with
    'Unimplemented grant type' error message) on the event of the syspref
    being disabled and the grant_type => 'client_credentials' value passed.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/oauth.t
    => FAIL: It fails because the off-switch is not implemented
    - Apply this patch
    - Run:
      k$ prove t/db_dependent/api/v1/oauth.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de0698076fee3061d3c37a8a922faf19a69336c8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 2 15:21:53 2018 -0300

    Bug 20624: Unit tests
    
    This patch adds tests to verify that disabling the RESTOAuth2ClientCredentials syspref
    makes any request on the /api/v1/oauth/token using the
    'client_credentials' grant fail with 'grant not implemented'.
    
    To test:
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/oauth.t
    => FAIL: Tests fail because the change is not implemented!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 027aa4f3495a5b1b3fd778470cdcd1c8f623233b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 2 11:20:37 2018 -0300

    Bug 20624: Add RESTOAuth2ClientCredentials syspref
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d96a9080dd2625229528adff8f35b9c2b8aebb9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 3 15:53:16 2018 -0300

    Bug 20612: (QA follow-up) Fix typo in method POD
    
    As Martin correctly highlighted, the method name is not correctly
    spelled in POD. This patch fixes it.
    
    To test:
    - Look carefully
    => FAIL: Method name is _verify_client_cb but POD says _verify_client_db
    - Apply this patch
    - Look carefully
    => SUCCESS: Notice the POD is fixed!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c46439abda66bfbf9cd7a987346331f93670062c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 18 13:40:13 2018 -0300

    Bug 20612: koha-conf.xml cleanup
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bf71bb837239ca9e3fdf4703074caf5eff7ec52
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 18 13:34:18 2018 -0300

    Bug 20612: Make OAuth2 use patron's client_id/secret pairs
    
    This patch wires the OAuth related code so it leverages on the new
    Koha::ApiKey(s) classes and tools introduced by bug 20568 instead of the
    hardcoded entries in koha-conf.xml originally proposed by bug 20402.
    
    To test revisit the test plan for bug 20402, and verify that it works.
    But create API key pairs instead of writing them down in koha-conf.xml.
    Also:
    - Run:
      $ prove t/db_dependent/api/v1/oauth.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8eb9239a340e662c42f8686a4d29154cc54ec5e4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 18 13:32:34 2018 -0300

    Bug 20612: Unit tests
    
    This patch makes the oauth.t tests leverage on the new Koha::ApiKey(s)
    classes. It adds tests for expired tokens too.
    
    To test:
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/oauth.t
    => FAIL: Tests should fail without the rest of the patches.
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef7a900742cf8c7bc063cc6df74b922db235b8b6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 8 16:06:22 2018 -0300

    Bug 20568: DBRev 17.12.00.043
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a8c3fad0a669870505d5b84b5fbaa7dd1c2a8a8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 8 16:27:54 2018 -0300

    Bug 20568: fix shebang
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2454d6868c357ee65dd683d80ab16f2cc2366fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 8 16:15:54 2018 -0300

    Bug 20568: Fix bad resolution conflict with bug 18403
    
    borrowers module permission has now several subpermissions
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cb1020e0cdb63143d3d954d4d9ff3a4bd93e330
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 3 15:51:15 2018 -0300

    Bug 20568: (QA follow-up) Remove unused vars
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82edceb2ed583ae9beaa63fd6208b380cc184c28
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 2 11:05:05 2018 -0300

    Bug 20568: (QA follow-up) Remove api-key management from OPAC
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45841d9ec7d013a6288fc5e543accf58d63f4c9b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 18 14:38:02 2018 -0300

    Bug 20568: CSRF protection
    
    Edit: fix warning introduced by this patch
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28a750fb7678f9d7a4a601cc3c0ff828a8b8f8bf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Apr 14 14:50:23 2018 -0300

    Bug 20568: (QA follow-up) Get rid of the id column
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45efd8e3ec7fa2e68d29bf97a454f0fd04faa272
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 18 13:56:28 2018 -0300

    Bug 20568: (QA follow-up) Make sure client_id and secret are not overwritten on store
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 175b7730517c738d09c180623a161c3052740213
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 18 13:56:00 2018 -0300

    Bug 20568: (QA follow-up) Test client_id and secret are not overwritten
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3f702625436a1b11e7740b6c53e26e68fa4184b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 18 10:55:43 2018 -0300

    Bug 20568: (follow-up) Atomic update fix
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b67e88f429fb926a9032893f343c05a15e856c37
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 16 16:04:26 2018 -0300

    Bug 20568: Move value => client_id + secret
    
    This patch addresses the request from Julian that api keys are expected
    to be client id/secret pairs.
    
    It does so by
    - Adding 'client_id' and 'secret' columns
    - Removing 'value'
    
    Tests got adjusted and so controller scripts and templates.
    Both libs and tests changes have been squashed. This ones remain in
    order to keep Owen's attribution on the template changes and avoid
    rebase conflicts.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37efe6ff7643e1bfee201a3e9b3473a82a0d656f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 16 15:23:50 2018 +0000

    Bug 20568: (follow-up) Interface and markup changes
    
    This patch makes some interface changes to bring things better in line
    with existing interface patterns. This patch also re-indents the
    modified templates with 4 spaces instead of 2 and makes <input>s
    self-closing.
    
    Also changed: Corrected system preference check in opac-apikeys.pl.
    
    To test, apply the patch and:
    
    In the staff client:
    
     - Open a patron record and choose More -> Manage API keys.
       - There should be a standard message dialog containing a link to
         "Generate a new key."
         - Clicking the link should show the form for adding a new key.
         - Test that clicking the "Cancel" link hides the form.
         - Test that creating the new key works correctly.
       - You should now see a table showing existing keys and a "Generate a
         new key" button above it.
         - Test that the "Delete" button asks for confirmation, and that
           confirming and denying both work correctly.
         - Test that "Revoke" and "Activate" actions still work correctly.
    
    In the OPAC:
    
     - Set the AllowPatronsManageAPIKeysInOPAC system preference to "Allow."
     - Log in to the OPAC and click the "your API keys" link in the sidebar.
       - Clicking the "Generate new key" button should display the form for
         adding a new key.
         - Clicking the "cancel" link should hide the form.
         - Submitting the form should add a new key.
       - You should now see a table showing existing keys.
         - Test that the "Delete" link asks for confirmation, and that
           confirming and denying both work correctly.
         - Test that "Revoke" and "Activate" actions still work correctly.
     - Set the AllowPatronsManageAPIKeysInOPAC system preference to "Don't
       allow."
       - Log in to the OPAC and confirm that the "your API keys" link in the
         sidebar is no longer visible.
         - Confirm that navigating directly to /cgi-bin/koha/opac-apikeys.pl
           results in a 404 error.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9007b25d0920dff1d0f7f976f4de866a7e1f20f0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Apr 14 17:38:03 2018 -0300

    Bug 20568: API key management for OPAC users
    
    This patch makes the OPAC interface for API keys management work
    with the new lib. Verify all actions work for a logged user.
    
    Users without login should be redirected to an error page.
    
    The AllowPatronsManageAPIKeysInOPAC syspref is added to control if the
    OPAC feature is enabled or not.
    
    To test:
    - Verify the syspref works
    - Verify users can manage their API keys
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30b763040cef34f083e66d047e50b5dd20c5ec7c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Apr 14 17:37:56 2018 -0300

    Bug 20568: Unit tests
    
    This patch adds unit tests for the introduced classes: Koha::ApiKey(s).
    
    To test:
    - Apply this patch
    - Run
      $ kshell
     k$ prove t/db_dependent/Koha/ApiKeys.t
    => FAIL: Tests fail because the feature is not implemented.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05101f0afa28d1de67d8d313963cb06cc5b3e1e1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 12 14:38:47 2018 -0300

    Bug 20568: Add mandatory description field for api keys
    
    This patch changes the table structure adding fields usually found on
    this kind of api management pages.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3aa102d0c35058bc6f2350d97e3da11815d368f1
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Mar 23 20:14:23 2015 +0100

    Bug 20568: API keys management in interface
    
    This introduces the concept of API keys for use in the new REST API.
    A key is a string of 32 alphanumerical characters (32 is purely
    arbitrary, it can be changed easily).
    A user can have multiple keys (unlimited at the moment)
    Keys can be generated automatically, and then we have the possibility to
    delete or revoke each one individually.
    
    Test plan:
    1/ Go to staff interface
    2/ Go to a borrower page
    3/ In toolbar, click on More -> Manage API keys
    4/ Click on "Generate new key" multiple times, check that they are
       correctly displayed under the button, and they are active by default
    5/ Revoke some keys, check that they are not active anymore
    6/ Delete some keys, check that they disappear from table
    7/ Go to opac interface, log in
    8/ In your user account pages, you now have a new tab to the left "your
       API keys". Click on it.
    9/ Repeat steps 4-6
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 462dc01cee6f8edc76c686d36aac66ef90a5aad4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 9 12:54:57 2018 -0300

    Bug 20402: Update DBIX schema
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d012552ab636b23227990e3992e9dfe34733fcab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 8 16:05:04 2018 -0300

    Bug 20402: DBRev 17.12.00.042
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 714e55388921c3663dd65d0347e8b52d0664cc2d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 8 16:44:42 2018 -0300

    Bug 20402: only output if verbose flag is set
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99b820653418f8d8ea57ef6e01f45879e783b0f8
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 20 10:37:37 2018 +0200

    Bug 20402: Remove useless call to Koha::OAuthAccessTokens->search
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ada1214312d1bd904c7c98778a918a80c104740
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 17 16:23:56 2018 -0300

    Bug 20402: Add missing POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a5c28cc24b857c050c1fc41e270a601772cc381d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 17 16:23:36 2018 -0300

    Bug 20402: Atomic update and kohastructure.sql fixes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b2aec72a98d770456169f0e01c23e85954493c8
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Apr 17 19:07:47 2018 +0200

    Bug 20402: Use TestBuilder->build_object in oauth.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c7d12e4e0f813fb31a9ebe7b5c6e5aee71c6cfc
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Apr 17 19:07:01 2018 +0200

    Bug 20402: Remove dependency on Mojo::Plugin::OAuth2::Server
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 996b100f1f46f574cc597d4fd2865c1db8e5f4e7
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 12 14:48:58 2018 +0200

    Bug 20402: Don't look at cookies if OAuth2 is attempted and has failed
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccc034195ee8c3cd7d5e43b0b88cbbf98c865666
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 12 09:17:43 2018 +0200

    Bug 20402: Fix oauth.t
    
    GET /patrons now requires { "borrowers": 1 } instead of
    { "borrowers": "edit_borrowers" }
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43a4b3c22c7a694975032a787c118fc1aeef5411
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Mar 13 13:17:12 2018 +0100

    Bug 20402: Implement OAuth2 authentication for REST API
    
    It implements only the "client credentials" flow with no scopes
    support. API clients are tied to an existing patron and have the same
    permissions as the patron they are tied to.
    API Clients are defined in $KOHA_CONF.
    
    Test plan:
    0. Install Net::OAuth2::AuthorizationServer 0.16
    1. In $KOHA_CONF, add an <api_client> element under <config>:
         <api_client>
           <client_id>$CLIENT_ID</client_id>
           <client_secret>$CLIENT_SECRET</client_secret>
           <patron_id>X</patron_id> <!-- X is an existing borrowernumber -->
         </api_client>
    2. Apply patch, run updatedatabase.pl and reload starman
    3. Install Firefox extension RESTer [1]
    4. In RESTer, go to "Authorization" tab and create a new OAuth2
       configuration:
       - OAuth flow: Client credentials
       - Access Token Request Method: POST
       - Access Token Request Endpoint: http://$KOHA_URL/api/v1/oauth/token
       - Access Token Request Client Authentication: Credentials in request
         body
       - Client ID: $CLIENT_ID
       - Client Secret: $CLIENT_SECRET
    5. Click on the newly created configuration to generate a new token
       (which will be valid only for an hour)
    6. In RESTer, set HTTP method to GET and url to
       http://$KOHA_URL/api/v1/patrons then click on SEND
       If patron X has permission 'borrowers', it should return 200 OK
       with the list of patrons
       Otherwise it should return 403 with the list of required permissions
       (Please test both cases)
    7. Wait an hour (or run the following SQL query:
       UPDATE oauth_access_tokens SET expires = 0) and repeat step 6.
       You should have a 403 Forbidden status, and the token must have been
       removed from the database.
    8. Create a bunch of tokens using RESTer, make some of them expires
       using the previous SQL query, and run the following command:
         misc/cronjobs/cleanup_database.pl --oauth-tokens
       Verify that expired tokens were removed, and that the others are
       still there
    9. prove t/db_dependent/api/v1/oauth.t
    
    [1] https://addons.mozilla.org/en-US/firefox/addon/rester/
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 896bb7ec54d128d829ed34a06a85a64586e53bff
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 5 11:07:30 2018 -0300

    Bug 20525: Add --timezone switch to koha-create
    
    This patch adds a --timezone switch to koha-create so the timezone can
    be set on creation time. It defaults to empty (i.e. using the server's
    local time).
    
    To test:
    - Create an instance:
      $ sudo koha-create --create-db timezone1
    => SUCCESS: /etc/koha/sites/timezone1/koha-conf.xml contains an empty
    <timezone> entry.
    - Apply this patch
    - Run:
      $ perl misc4dev/cp_debian_files.pl
    - Create a new instance:
      $ sudo koha-create --create-db timezone2
    => SUCCESS: /etc/koha/sites/timezone2/koha-conf.xml contains an empty
    <timezone> entry (i.e. the current behaviour is preserved).
    - Create a new instance:
      $ sudo koha-create --create-db --timezone Your/Timezone timezone3
    => SUCCESS: /etc/koha/sites/timezone3/koha-conf.xml contains
        <timezone>Your/Timezone</timezone> (i.e. introduced behaviour works)
    - Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bb531b5308635d53345cd04617b47acb076970e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 7 13:15:34 2018 -0300

    Bug 20721: (bug 19403 follow-up) Prevent Circulation.t to fail randomly
    
    If items.restricted == 1, CanBookBeIssued will not returned what we are
    testing.
    
    The easiest and global fix is to define a default value at TestBuilder
    package level
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a1bed84d6ac0ac5b0b9ee631363bc9cb0d74b73
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 7 12:22:40 2018 -0300

    Bug 20531: (follow-up) Set the timestamps to the same value to get a correct order
    
    There were 2 places where it was failing!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit affd3f0eceba42ec7c92706452a892823eed39e0
Author: Mason James <mtj@kohaaloha.com>
Date:   Tue May 1 13:24:37 2018 +1200

    Bug 20686: OPAC shows 'Login to OverDrive account' with 'OverDriveCirculation' syspref disabled
    
    ps: you will need an active and working overdrive account to test this patch
    
    1/ prepare a koha with overdrive sysprefs set and working
        (OverDriveLibraryID,OverDriveClientKey,OverDriveClientSecret)
    
    2/ set OverDriveCirculation syspref to 'disable'
    
    3/ do an opac search, note the 'Login to OverDrive account' message is incorrectly displayed
        see pic 1
    
    4/ apply patch
    
    5/ do an opac search, note the 'Login to OverDrive account' message is no longer displayed (good)
        see pic 2
    
    Can confirm that bug is replicable and patch applies and functions as described.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23aa9866124064cbea8d52c1ec8f72089b4e8626
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 27 13:37:53 2018 -0300

    Bug 20305: Remove warnings from tools scripts
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0b88ed328e83877cbb98c5e3904e6b087b5a9ca
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 4 08:10:46 2018 +0200

    Bug 20687: (follow-up) Look for invitekey in show_accept and fix error codes
    
    We should check the invitekey in show_accept by passing it along in the
    search call.
    On the way I fixed some error checking: if the list number is invalid, or
    the list is public or you are the owner, or if the key is not found, we
    should set the right error code; the template contains those messages.
    
    Test plan:
    [1] Share a list and accept a correct invitation with another user.
    [2] Try to accept some invalid proposals: wrong key, wrong list.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested invalid key, wrong list, owner, public list, expiry.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90d249b39dcc6702074aea7b747807d231d09024
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 1 13:47:18 2018 +0000

    Bug 20687: Check all share keys for a given list
    
    This patch gets all the shares for a list and iterates through to find
    the correct one when accepting from a link
    
    To test:
    1 - Create a private list in the opac
    2 - Invite 2 patrons to the list
    3 - Try to accept from the patron you first shared to
    4 - You will get a failure message about expiration of the link
    5 - Apply patch
    6 - Now try to accept the first share
    7 - It works! Success!
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab52b1f3ac03ad4b68ac4ab7fa29e32c5efe39b9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 4 12:30:55 2018 -0300

    Bug 20284: Fix minor compilation errors
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 046f1f340132a97a2447a44707bdc1e2ded9a637
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 4 12:26:39 2018 -0300

    Bug 20284: (QA follow-up) superlibrarian has ill permissions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b67f208232bbf7efa1eee35c3b1c28e5baa8199
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Apr 20 15:15:15 2018 +0100

    Bug 20284: (follow-up) Added missing 'exit's
    
    This patch adds the exits that were missing after the redirects
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b12d5e7c20f44e12b990eaa2a083202bf8b5d43c
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Apr 9 14:32:21 2018 +0100

    Bug 20284: ILLModuleCopyrightClearance text breaks
    
    This patch fixes the display of the copyright notice text that is defined
    in ILLModuleCopyrightClearance preference when placing ILL requests from
    the OPAC. Handling of the copyrightclearance stage was missing,
    this has been added.
    
    To test:
    1) Ensure you have at least one ILL backend available:
       https://wiki.koha-community.org/wiki/ILL_backends
    2) Ensure you have the "ILLModule" preference enabled
    3) Add some text to the "ILLModuleCopyrightClearance" preference
    4) Navigate to a search results page in the catalog
    5) Click the "Make an Interlibrary Loan request" link at the bottom
    6) Choose "Create a new request", then select a backend
    7) Observe the text you added earlier is displayed with buttons for
       agreeing or disagreeing (prior to this patch, this screen displayed
       an error)
    8) Observe that clicking "Yes" takes you to the form for adding request
       details
    9) Observe that clicking "No" takes you back to the "Interlibrary loan
       requests" page
    
    Signed-off-by: Barry Cannon <bc@interleaf.ie>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6db7ab6b93f52358bcbad60b60ad776a2cd68a23
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Mar 26 19:14:44 2018 +0000

    Bug 20477: Silence floody noise on fast cataloging
    
    TEST PLAN
    ---------
    See comment #0 to reproduce.
    apply this patch
    restart_all
    
    echo | sudo tee /var/log/koha/kohadev/place-error.log
    restart_all
    cat /var/log/koha/kohadev/plack-error.log
    -- just restart information
    
    log into staff client again, home -> circulation -> fast cataloging
    
    cat /var/log/koha/kohadev/plack-error.log
    -- just restart information
    
    run qa test tools
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c36d4beb6f308ddec9b8da667ed23878bdc208d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 09:54:45 2018 -0300

    Bug 20620: Remove warnings in moredetail.pl
    
    Since 19995 warnings are displayed in moredetail.pl, we should get rid
    of them.
    
    Test plan:
    Hit moredetail.pl with different biblionumbers and confirm you do no
    longer see warnings in logs.
    
    Make sure values for rentalcharge, item type, ccode and replacementprice
    are displayed correctly.
    
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be35e4883a5595b08c14364fb5da7c98a251aeb5
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Apr 26 04:31:32 2018 +0000

    Bug 20663: Add some POD, so koha test tools don't complain
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32a2528d53c7917a0d680dc54416df3202057a5e
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Apr 26 04:17:51 2018 +0000

    Bug 20663: Remove dead code related to compound reports
    
    TEST PLAN
    ---------
    git grep "Create Compound Report"
    -- only one file
    git grep compound | grep 1
    -- this is the only setting of the compound tt variable
    less koha-tmpl/intranet-tmpl/prog/en/modules/reports/guided_reports_start.tt
    -- There is an TT IF statement for compound.
    -- In that statement it would trigger 'Save Compound'
    git grep save_compound
    -- only the template and the guided report perl
    git grep create_compound
    -- only triggered by the save code in the guided report perl
    -- in the export for the C4/Reports/Guided.pm
    git grep run_compound
    -- left over in export
    
    apply the patch
    look around and see the pieces are cleaned up.
    
    run koha qa test tools
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2d937fc9bb4bdd886c12964c4a21b324626528b
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Apr 22 22:00:17 2018 +0000

    Bug 19171: Attempt to make "no holds possible" messages less confusing
    
    At the moment, when no holds are possible, the OPAC reads something
    like:
    
    Sorry, none of these items can be placed on hold.
    No items available.
    
    This is confusing to the patrons, because the records have items,
    but they are not showing. The record also may have available items,
    they are just not permitted to place holds on them.
    
    Changes:
    - Only display the first message, when somoene tried unsuccessfully
      to place holds on multiple records.
    - Change first message to: Sorry, none of these titles can be placed on hold.
    - Change the second message to read:
      No items available to be placed on hold.
    - Remove <strong> around Sorry for better translatability.
    
    To test:
    - Try to place a hold on single record, where no hold is possible.
    - Try to place a hold on a single record, where a hold is possible.
    - Try to place holds on multiple records where no hold is possible.
    - Try to place holds on multiple records where at least one hold
      is possible.
    
      Verify the screen messages make sense in all cases.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Fixed stray </strong> during signoff.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    For consistency with staff, I renamed multi_holds to multi_hold.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 305d3c36cb685fabce3ec4357ed769c25b12eb73
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 3 15:40:11 2018 -0300

    Bug 20685: Escape letter template content in textarea
    
    Test plan:
    enter the following text into the Email template for 'HOLD_SLIP'
    in Home › Tools › Notices & Slips › Modify notice
    
    <div style='max-width: 4in;'>
    <h3><<borrowers.surname>>, <<borrowers.firstname>></h3><br />
    <<borrowers.streetnumber>> <<borrowers.address>><br />
    <<borrowers.address2>><br />
    <<borrowers.city>>, <<borrowers.state>> <<borrowers.zipcode>><br />
    <br />
    <br />
    <img src="/cgi-bin/koha/svc/barcode?barcode=<<borrowers.cardnumber>>&type=Industrial2of5&notext=1">
    
    Edit it again
    Without this patch you will get:
    <img src="/cgi-bin/koha/svc/barcode?barcode=<<borrowers.cardnumber>>&type=Industrial2of5¬ext=1">
    
    Signed-off-by: Barton Chittenden <barton@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75dc3fb0f3291221c3c1b59006ef75d92f4f63c2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 3 14:30:00 2018 -0300

    Bug 11317: Add id and class attributes to body
    
    This fixes xt/tt_valid.t
     #   Failed test '<body> tag with id and class attributes'
     #   at xt/tt_valid.t line 91
     # Files list:
     # intranet-tmpl/prog/en/modules/tools/access_files.tt: 8
     # Looks like you failed 1 test of 3.
     [16:44:56] xt/tt_valid.t
     Dubious, test returned 1 (wstat 256, 0x100)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 150a589e088906e2eed255fe05aa292dfdde5fdc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 3 13:39:53 2018 -0300

    Bug 11317: DBRev 17.12.00.041
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c4928048e9013956413378ad33873d75d7d3e96
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Apr 28 02:30:55 2018 +0200

    Bug 11317: (QA follow-up) Change tool name to be more general
    
    I think this tool could be used in multiple ways, for all kinds
    of files that you want to protect by login in Koha. So a more
    general name might work better.
    
    This is a suggestion, not mandatory.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba0abdf9292c26cfddb040bb3e491d03bf7e013f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Apr 28 00:29:06 2018 +0200

    Bug 11317: (QA follow-up) Fix merge error and punctuation
    
    2 tiny fixes:
    - Remove space before : as this is not correct in English
    - Remove an errorenous commented line that probably snuck back
      in from a merge
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67ec2ead88c7d58f7977a206ad75f00eddef8095
Author: Roch D'Amour <roch.damour@inlibro.com>
Date:   Mon Apr 23 09:20:35 2018 -0400

    Bug 11317: (follow-up) Add two-level entry to koha-conf and remove unwanted characters
    
    - Removed merge marker
    - Changed include path in favor of using the Asset tt plugin (bug 20538)
    - Changed access_dir to a two-level entry for clarity
    
    Test plans stay the same, just make sure that the two-level configuration entry
    work properly and everything pass QA.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f9ec1287539e61f4dd089131cf69cb90fb3f8e2
Author: Roch D'Amour <roch.damour@inlibro.com>
Date:   Tue Apr 17 14:24:07 2018 -0400

    Bug 11317: Add a way to access files from the intranet
    
    This squash contains all of these commits:
    - Adds a page to access log files on the server from the intranet
    - Update ID to allow for permalinking
    - Rename config to "'accessdir' and fix qa
    - Allows for multiple directories to be accessible
    - Update the link under reports
    - (Follow-up) Fixing merge error and cosmetic changes
    - (Follow-up) Fix tab chars and move javascript to the footer
    - (QA Follow-up) Fix datatable
    - Make filename unicode-proof, renamed accessdir to access_dir and fix update
    
    Test plans:
    - Apply patch, update database
    - Add to koha-conf:
    <access_dir>/tmp/koha-public/one</access_dir>
    <access_dir>/tmp/koha-public/two</access_dir>
    <access_dir>/tmp/koha-public</access_dir>
    - Create these directories ( mkdir /tmp/koha-public , etc...)
    - Create these files:
    echo "hello world!" > /tmp/koha-public/❤
    echo "test" > /tmp/koha-public/one/samename.txt
    echo "this is not the same" > /tmp/koha-public/two/samename.txt
    - Login as Superadmin, go to tools > reports files
        - Click on ❤, make sure it's downloadable and readable
        - Click on both samename.txt, look inside and make sure the file is different
    - Login as NON-superadmin. Go under tools, see no Report/Log under the third column
        - Go to add tools/access_file permission to user
        - See new entry under tools third column.
        - validate link is ok.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d59eee2bae08799358a8ea4dc17d4dd861784c4
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Mar 28 22:40:09 2018 +0000

    Bug 20103: Readonly::XS is completely bogus post perl 5.8
    
    A ha! Lie about who we are, and the module will return a version.
    
    ./koha_perl_deps.pl -a
    -- before patch Readonly::XS is 0
    -- after patch it has a version number.
    run koha qa test tools
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7787d1022b5f5c344e7d841a48ea1a2cc8dceed
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 19 09:33:50 2018 +0000

    Bug 20444: Remove sub GetAttributes
    
    0) Apply this patch
    1) git grep GetAttributes should return no occurencies
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddd40048ce482d90eba45031b892e516af6de8cd
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 19 09:33:07 2018 +0000

    Bug 20444: Update test
    
    0) Apply this patch
    1) prove t/db_dependent/Members/Attributes.t
    should return green
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c3a257448a238ec070ef209be70f76182cc91c4
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 19 09:27:07 2018 +0000

    Bug 20444: Use Koha::Patron::Attribute::Types object for getting patron attributes in letter.pl
    
    Test plan:
    0) Apply the patch
    1) Do not have any patron attribute types defined
    2) Go to Tools -> Notices and slips
    3) Edit any slip/letter which uses table borrower
    4) Confirm the editing works, and the slip/letter itself works
    5) Add some patron attributes types and define them a value for any
    patron
    6) Go to Tools -> Notices and slips and edit any slip/letter which uses
    table borrower
    7) Confirm, the attributes are listed in available fields
    8) Confirm the slip/letter is working when you add a attribute to it
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60e5a8a2aba887371966c593ffab44c6a4ac5d94
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Tue Dec 5 10:43:05 2017 +0000

    Bug 19752: offline_circ/service.pl - Return HTTP status 401 when authentication failed and add option nocookie
    
    Test plan:
    
    - Apply this patch,
    - log in to Koha,
    - go to cgi-bin/koha/offline_circ/service.pl with no valid user
      and password as parameters and nocookie set to 1. i.e:
      cgi-bin/koha/offline_circ/service.pl?userid=alex&password=wrongpass&nocookie=1,
    - auth should fail
    - check that the response code is 401
    
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90fd45d0f279c58083e14f7953ea762726b8386f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Apr 22 18:37:11 2018 +0000

    Bug 19972: (QA follow-up) Fix id name
    
    Renames #type-filter to #itemtype-filter
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c9b26e437f70f9ad422586cc3a40812aa660aff
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Tue Jan 16 10:06:20 2018 +0100

    Bug 19972: Make holds to pull list honors item-level_itypes syspref
    
    And reflect that in the UI strings + variable names
    
    Test plan:
    1. Set syspref "item-level_itypes" to "specific item"
    2. Create a hold on a record with one item
    3. Change the document type of the item
    4. Check that the item edition page and the record page show 2 different
         types.
    5. Go to /cgi-bin/koha/circ/pendingreserves.pl
    6. Check that the displayed type is the item one
    7. Set syspref "item-level_itypes" to "biblio record"
    8. Go to /cgi-bin/koha/circ/pendingreserves.pl
    9. See that the displayed type is the item one. When the sysopref says
         "record"
         This is the bug.
    10. Apply this patch
    11. Go to /cgi-bin/koha/circ/pendingreserves.pl
    12. See that the displayed type now follows the syspref
    13. Set syspref "item-level_itypes" to "specific item"
    14. Go to /cgi-bin/koha/circ/pendingreserves.pl
    15. See that the displayed type still follows the syspref
    
    Signed-off-by: Lucie Gay <lucie.gay@ens-paris-saclay.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc595ecc175c84727ed33157b5572dcb7196e163
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Apr 26 16:57:47 2018 +0000

    Bug 20666: Correct permissions on opac-routing-lists.pl
    
    You will need to have the 'Your routing lists' appear
    in the opac-user page in order to trigger the error.
    
    Make sure plack is off, and you will an error 500 page.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fde5422d80f2f85c3080aa1b2eb9792059d9bf55
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Apr 26 16:22:16 2018 +0000

    Bug 20666: Correct executable permissions
    
    TEST PLAN
    ---------
    On a kohadevbox:
     1) sudo koha-plack --enable kohadev
     2) restart_all
     3) Enter fines for a patron in the staff client
     4) Go to the 'Fines' tab (left pane)
     5) Go to the 'Account' tab (below the row of buttons)
     6) Click 'Details'
        -- no issues
     7) sudo koha-plack --disable kohadev
     8) restart_all
     9) refresh page
        -- Error 500
    10) apply patch
    11) restart_all
    12) refresh page
        -- no issues
    13) sudo koha-plack --enable kohadev
    14) restart_all
    15) refresh page
        -- no issues
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d15af45055fd9c1c8df575f49a382ba7e4b48d0d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 24 15:21:36 2018 -0300

    Bug 20637: Fix filters content on the holds to pull screen
    
    libraries and locations are separated by <br> whereas itypes are using
    \n
    This patch standardized the separator to generate correctly the filters
    pulldown
    
    Test plan:
    - Place a hold on a biblio record which has several items
    - Define different locations and itypes for these items
    - Display the holds on the "Holds to pull" screen and make sure the
    filters are working correctly (focus on the dropdown list)
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae29e71c2a928b47a78b12e72d149849d8d8f331
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 25 12:38:25 2018 +0000

    Bug 20329: Text input fields are wider than the fieldset class they are inside of
    
    This alternate patch defines a width of 100% for text inputs and selects
    inside sidebar fieldsets. The scope of this style is limited to the
    sidebar by unsetting the width for fieldsets within "#yui-main," the
    main body of the page.
    
    This patch also removes inline styles from two templates which are now
    unnecessary.
    
    To test, apply the patch and clear your cache if necessary.
    
    View various pages which have a sidebar search form: acqui/invoices.pl,
    members/members-home.pl, circ/overdue.pl, acqui/parcel.pl. Confirm that
    form fields in the sidebar look correct.
    
    Confirm that other forms styled with the "brief" class aren't
    unintentionally affected by this patch. For example:
    circ/request-article.pl, members/member-password.pl,
    reports/reports-home.pl, reserve/request.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d285342347248749bb26e0be635e062bff265dc
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sun Mar 4 05:31:15 2018 +0000

    Bug 20329: Shorten the width of text input fields
    
    This makes the text input fields fit tidily within the border of the
    fieldset class elements they are within.
    
    Test plan:
    1. Go to the acqui/invoices.pl, members/members-home.pl,
    circ/overdue.pl, acqui/parcel.pl and notice that the text input fields
    on the fieldset element on the left hand side of the screen for
    filtering search results are too wide and go over the border of the
    fieldset element
    
    2. Apply patch
    
    3. Refresh the aforementioned pages and notice the text inputs have a
    shortened width and now fit within the fielset class element
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5220bc6a130e7fe8a31739b98993b203cfee2b6
Author: Magnus Enger <magnus@libriotech.no>
Date:   Mon Apr 9 12:39:23 2018 +0200

    Bug 20546: Display shelving location on checkin
    
    Currently, the sehlving location is not being displayed in the table
    of checked in items on <intranet>/cgi-bin/koha/circ/returns.pl
    
    To test:
    - Make sure you have a couple of books with a value for shelving location (952$c)
    - Check the books out
    - Check the books in
    - Verify nothing is displayed in the "Shelving location" column
    - Apply this patch
    - Check the books out and in again
    - Verify the shelving location is now being displayed
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6c739ae9c7ff7a50398d6d4e22f7afa69a3cc47
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 26 13:48:58 2018 +0200

    Bug 20304: (QA follow-up) Remove unwanted 'my'
    
    'my' creates a new '$value' variable, and prevented the '$value' in
    outer scope to be modified
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f8add96131837dc797cb0222c67060732e4ffa8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 27 13:36:21 2018 -0300

    Bug 20304: Remove warnings from cataloguing scripts
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6f3e1fbe6d2efa593b3a7ca06b6d8664d61f650
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 15:03:52 2018 -0300

    Bug 18342: Mark Cache::Memcached as mandatory
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64be74b3380441b645ec808e0c30455e76b326e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 16:19:07 2017 -0300

    Bug 18342: Enable memcached by default for new installs
    
    Note that there is no way to create an install without memcached.
    As it is now considered as stable, there is no point to not use it.
    
    Test plan:
    Create a new Koha install and make sure memcached is enabled by default
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a50dc1ad59b52ae47b5749b984763e8e85d0cb7
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Thu Apr 26 13:08:25 2018 +0000

    Bug 20665: Reset MySQL connection time zone in the OAI-PMH Provider
    
    TEST PLAN
    ---------
    apply unit test patch
    prove t/db_dependent/OAI/Server.t
    -- should fail
    apply this patch
    prove t/db_dependent/OAI/Server.t
    -- should pass
    run koha qa test tools
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebc32f2aae4081c4f0e3e10e5353d65faff77c7a
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Thu Apr 26 13:05:51 2018 +0000

    Bug 20665: Units tests for testing MySQL connection time zone
    
    TEST PLAN
    ---------
    apply this test patch
    prove t/db_dependent/OAI/Server.t
    -- should fail
    apply the other patch
    prove t/db_dependent/OAI/Server.t
    -- should pass
    run koha qa test tools
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de9cfe0c946e394ebbe765f8b07bacf23d3d9c66
Author: David Bourgault <dav.bour@gmail.com>
Date:   Tue May 1 15:09:53 2018 -0400

    Bug 19466: Turn AutoCalc off for new installs
    
    Default value of AutoMemberNum is now 0.
    
    TEST PLAN:
    0. Do a fresh install of Koha
    1. In system preferences AutoMemberNum should be off
    2. No warning should be shown next to the cardnumber field in the patron creation form.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5d5038fa3a1fbfaf81f4b01d319b00af5a7c46c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 25 17:38:38 2018 -0300

    Bug 20531: Set the timestamps to the same value to get a correct order
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af765d348fdc4ba7106dc3ee767ccd71f86835d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 25 16:52:07 2018 -0300

    Bug 20659: Fix blocking errors display
    
    The include file blocking-errors.inc has been created to by-pass regular
    processing and display an error that should block the elements of the
    view.
    
    For instance you call a patron's page with invalid borrowernumber => we
    do not want the app to crash (500) or the page to display with broken
    elements.
    
    It worked well on bug 18403 but it's now broken, a blank page is
    displayed instead.
    It may be caused by the move of the JS to the bottom of the page.
    
    Test plan:
    hit /cgi-bin/koha/members/moremember.pl?borrowernumber=45432
    Without this patch a blank page is displayed.
    With this patch you see the blocking error
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53045699eb84926f41b3316fd9f96bed7671dbed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 25 12:17:19 2018 -0300

    Bug 20531: Add diag to help debug next failure
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84f090d1958105a8810cd8f4d71d1d1f88ed73ea
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 10:37:48 2018 -0300

    Bug 19204: Add tests for new days_mode parameter
    
    Sponsored-by: Goethe-Institut
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59b2f2edb954ae8ad4e2bd1e3758be66cbba618c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 18:52:00 2018 -0300

    Bug 19204: Add a test: holiday is expiration date
    
    Sponsored-by: Goethe-Institut
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1676955f71bfd7d2fedbe52956e5e03a975a8c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 18:12:00 2018 -0300

    Bug 19204: Clean the tests a bit to reuse the same pattern
    
    The same pattern is used several times in test:
    checkout, checkin, get the debarment, compare the dates and remove the
    debarment.
    Let's move that to a separate subroutine
    
    Sponsored-by: Goethe-Institut
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d3eba6a297f4fd993ddf237b6cd66cfda38ff95
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 15:23:00 2018 -0300

    Bug 19204: Make the debarment date calculation depends on finesCalendar
    
    This patchs adds the ability to calculate the end of the suspension date
    (debarment date) using the finesCalendar syspref.
    Prior to this patch it was never calculating without taking into account
    the calendar.
    
    calculated without taking holidays into account.
    This was a problem because the restriction could end in the middle of a
    period the library is closed.
    
    Test plan:
    - Set finescalendar to 'not including days the library is closed'
    - Set a circulation condition with no fine/maxfine, but fine days and
    max fine days instead
    - Check out an item with a due date in the past
    - Check the item in and verify the restriction date
    - Clean the restriction
    
    - Add holidays to your calendar on the calculated restriction date
    - Check the item out again with the same due date in the past
    - Check in the item again
    - Verify the calculated restriction end date has changed, it's set to the day
    after the holiday.
    
    Fines in days restriction calculation is correctly taking calendar
    into account.
    
    Sponsored-by: Goethe-Institut
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d12311ac189b928b840e8842076492cdc8369d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 25 10:37:08 2018 -0300

    Bug 20100: DBRev 17.12.00.040
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 532d07c00bb2e522ea7448a00cf80558f9c13dbe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 25 10:46:11 2018 -0300

    Bug 20100: Set ProtectSuperlibrarianPrivileges by default
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e08a36c25a67da083d5d3bdf0dd58b4a71144e9d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 25 10:34:59 2018 -0300

    Bug 20100: Explain why the checkbox is disabled
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c45edcebb474009d8da64bd479b0f9de1872e15
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Apr 25 13:33:05 2018 +0200

    Bug 20100: (QA follow-up) Pref description and improve code in member-flags
    
    Two points as mentioned on Bugzilla comment29.
    [1] Improve pref description. Feedback from comment30 incorporated.
    [2] Improve code in member-flags. Check if we change librarian flag first.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested the die with "disable_superlibrarian_privs => 0" in member-flags.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f1ebf68a6a5e1fcb42caa1479a4856a0a4653aa
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Apr 25 13:09:05 2018 +0200

    Bug 20100: (QA follow-up) Change syspref name to full version
    
    As per RM request, changing the shorter name to its full form.
    Result of a git grep | sed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    No occurrences to be found anymore with git grep -i.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d31b0bfdfc2d15eb94255240b6233315120f2bfe
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 20 11:52:17 2018 +0000

    Bug 20100: (QA follow-up) Use template logic instead of js to disable superlib box
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccf62d46d7143965086fae7770c2fb27031e1bb6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 31 16:47:23 2018 +0100

    Bug 20100: Disallow access to superlibrarian privileges at client side
    
    This last patch activates the check at client side.
    If the pref ProtectSuperlibPrivs is enabled, non-superlibs should not be
    able to change superlibrarian privileges via the interface.
    
    Test plan:
    [1] Enable the pref.
    [2] Login as superlib and add/remove superlib privs to a staff user.
    [3] Login as another user (no superlib, but having borrowers, permissions
        and staff_access). Verify that you cannot add or remove superlib
        privs.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: JM Broust <jean-manuel.broust@univ-lyon2.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f26b68a07f8ac8e5dd47a1e478e47507e424453a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 31 15:02:36 2018 +0100

    Bug 20100: Disallow access to superlib privileges at server side
    
    Depends on pref ProtectSuperlibPrivs.
    If enabled, script member-flags.pl will not allow you to add or remove
    superlib privs when you are no superlibrarian.
    The follow-up patch will enable the check at client side.
    
    Test plan:
    [1] Enable the pref. Do not apply the third patch (client side).
    [2] Login as superlib and add/remove superlib privs to a staff user.
    [3] Login as another user (no superlib, but having borrowers, permissions
        and staff_access). Verify that you have an internal server error when
        you add or remove superlib privs. The log contains a warning.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: JM Broust <jean-manuel.broust@univ-lyon2.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a5f526ae0fc488607cf766335626294d6027a406
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 31 16:23:18 2018 +0100

    Bug 20100: Introduce preference ProtectSuperlibPrivs
    
    This pref allows you to block changes to superlibrarian privileges at
    client and server side for non-superlibrarians.
    This patch only contains the db rev and the preference description.
    
    Test plan:
    Run dbrev or new install. Check pref value.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: JM Broust <jean-manuel.broust@univ-lyon2.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e05cd22723d9c7f8bf5fc1ce3149df9c41dc9df1
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Apr 25 09:21:30 2018 +0200

    Bug 20538: Prevent warnings in xt/author/valid-templates.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 896644d90125a930e1acbc19ce5d80aaf5d91278
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 24 16:43:25 2018 +0000

    Bug 2696: (QA follow-up) Add more test, move to subtest
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0269200bc6c6615e405ac34eee36852434c08dca
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Mon Apr 23 14:23:00 2018 -0400

    Bug 2696: (QA follow-up) Fix POD, results sorting, permissions
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 273065921362f348bf44faf8b7865b8eb5948922
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Apr 21 00:40:15 2018 +0000

    Bug 2696: (QA follow-up) Several fixes to template variables
    
    - Fix link to patron account in breadcrumbs
    - Fix includes for accounttype.inc to display type correctly
      - in Details for fee
      - in Payments list
    - Fix use CGI qw ( -utf8 );
    - Remove <br> from within a string for better translation
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5643de4d79f274b35f92aa03f5f8cbc124359e52
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 21 14:15:52 2017 +0000

    Bug 2696: Fine payments should show what was paid for
    
    Test Plan:
    1) Apply this patch and its' dependencies
    2) Create and pay some various fees and fines
    3) View the payments for fees, and fees paid by payments by
       using the new 'Details' button available on boraccount.pl
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Running updatedatabase.pl after patch application makes dependencies
    happy. Passes QA Tools and works as intended.
    
    Rebased (2017-12-21): Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 2696: (QA follow-up) - Remove use of GetMember
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50c68497a26f50a66c59b182cae50bade708faf4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 18 14:01:18 2018 -0300

    Bug 7910: Add the ability to renew several subscriptions at once
    
    This patch adds a "Renew all selected subscriptions" action link on top
    of the table of the "Check expiration" page.
    
    It will allow to auto-renew several subscriptions.
    
    Test plan:
    Make sure this new link renew the selected subscriptions as expected.
    
    Sponsored-by: BULAC - http://www.bulac.fr/
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2999c047af7a7fbf3b8619f1b0cff3999b2b42e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 18 14:56:13 2018 -0300

    Bug 20614: Use GET instead of POST for subscription renewing
    
    It will prevent Firefox (and certainly other browsers) to block the form
    resubmit:
    
    "To display this page, Firefox must send information that will repeat
    any action (such as a search or order confirmation) that was performed
    earlier."
    
    Test plan:
    Renew a subscription and save
    
    => You should not longer see the browser warning
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14cc4a3499319591c2fc658dacb1d3c1f4e73523
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 24 12:04:29 2018 -0300

    Bug 20482: DBRev 17.12.00.039
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d5271d315d401a2d1269cf8e815413de7452e99
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 20 17:36:15 2018 +0000

    Bug 20482: (QA follow-up) Correct code in atomic update
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit caff790fb76f97ad39528ffc4a84757b3fba596b
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Mar 28 02:47:18 2018 +0000

    Bug 20482: Correct Terminology codes to Bibliographic ones
    
    "RELATIONSHIP TO ISO 639-2
    ISO 639-2 (Codes for the representation of names of
    languages-- Part 2: alpha-3 code) was based on the MARC
    Code List for Languages and published in 1998. In the 22
    cases where the ISO 639-2 list has two alternative codes,
    the bibliographic code is the same as the MARC code."
    (http://www.loc.gov/marc/languages/introduction.pdf)
    
    This leads me to believe that eus, mri, and sqi are
    incorrect. The slk code was corrected on an earlier bug.
    
    TEST PLAN
    ----------
    Apply patch
    Do a database upgrade
    -- Are eus, mri, and sqi fixed?
    reset_all
    -- Are eus, mri, and sqi never there in the first place?
    koha qa test tools only check perl code.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e376338f175a12bb63d015b6be1afbab49ad8f9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 24 12:00:36 2018 -0300

    Bug 20245: DBRev 17.12.00.038
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28020fae2eebfc83e5050b5d167307c10cc23bcb
Author: Radek Šiman <rbit@rbit.cz>
Date:   Thu Mar 8 22:28:37 2018 +0100

    Bug 20245: Wrong language code for Slovak
    
    This patch updates iso639_2_code value for Slovak language
    
    Test plan:
    1) Obtain a biblio record having 'slo' value in its language
       code (marc field 041a)
    2) Try to find it through Advanced search + more options
       with language set to Slovak
    3) Nothing is found
    4) Apply this patch
    5) Repeat steps 1 and 2
    6) Record is found now
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 582d566aac5af0dbb065b9f057e43eb5ccb19a1a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Apr 23 04:15:56 2018 +0000

    Bug 20616: (QA follow-up) Make alert translatable
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e14ee4ad0a033354052726ff401f8ee4f64dd2b9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 16:19:50 2018 -0300

    Bug 20616: Prevent "edit serials" form submission if no serial is selected
    
    In order to prevent the form to submit and gives an ugly error if no
    issues are selected we will make sure at least one is checked otherwise
    an alert will be displayed.
    
    Test plan:
    - create a subscrpition
    - go to the serials collection page
    - don't check any checkboxes for serials
    - click 'Edit serials'
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc082c26a18392a029d60ef76db6d358c073d17c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 12:07:58 2018 -0300

    Bug 20625: Handle non existing of active currency
    
    This patch avoid the explosion in the air when creating a new patron
    category and no active currency is defined.
    
    Test plan:
    Remove the currencies, create a new patron category
    Without this patch applied you will get
      Can't call method "p_sep_by_space" on an undefined value
    
    With this patch the form will be displayed correctly and you will be
    able to create the patron category
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 564809473d0ae50d3dd2ea69e1ab999851a62fab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 12:03:48 2018 -0300

    Bug 20625: Add tests
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67359a97f4cbf828dbe93a7b08ec7283258b46c5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 15:12:20 2018 -0300

    Bug 20073: Remove perlcritic error
    
    "return" statement with explicit "undef" at line 245, column 5.  See
    page 199 of PBP.  (Severity: 5)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a905b119035dda28130293b9160b6e1bfaad3f6a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 20 18:35:14 2018 +0000

    Bug 20617: Add 'Search Engine configuration' link to administration menu
    
    This patch adds a link to the Elasticsearch configuration page in the
    administration sidebar menu when Elasticsearch is enabled.
    
    This patch also corrects the title of the Elasticsearch page to match
    the page heading. "Search engine configuration" instead of
    "Elasticsearch mappings."
    
    To test, apply the patch and set the SearchEngine system preference to
    "Elasticsearch."
    
      - View any page in the administration module which shows the
        left-hand sidebar menu. The link to search engine configuration
        should be there.
      - View the search engine configuration page and confirm that the page
        title is correct.
      - Set the SearchEngine system preferenc to "Zebra."
      - The search engine configuration link should no longer appear in the
        administration sidebar menu.
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a49e3bf92ae3fa4b03067199d1e860f1fe0b274
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 13:58:24 2018 -0300

    Bug 20363: (bug 16966 follow-up) better messages handling
    
    User views the "Your privacy" -page, it shows "No reading history to
    delete", even when the user has history.
    
    Test plan:
    - Turn OPACPrivacy on
    - Go to opac-privacy.pl
    - Click the "Immediate deletion button" to delete the reading history
    => If the patron has reading history you must get "Your reading history has been deleted."
    Otherwise "No reading history to delete"
    
    Note that this patch reintroduce the "something went wrong" message if
    the deletion failed for whatever reason.
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2edc7a2240dc7772ab2c778364416667fd21da5a
Author: Eric Phetteplace <phette23@gmail.com>
Date:   Fri Apr 6 14:15:26 2018 -0700

    Bug 13445: Remove URL option from scheduled reports, add Text option
    
    Remove the non-functional 'URL' format
    Offer the (functional) CSV & HTML formats
    
    testing plan:
    - visit the task scheduler tool at cgi-bin/koha/tools/scheduler.pl
    - 'Output format' select list should offer Text (TSV), CSV, & HTML
    - scheduled reports for each of the above types should run & send emails correctly
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d8a401c85171ea3c4213c76ea97224367c13795
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 14:21:43 2018 -0300

    Bug 20073: DBRev 17.12.00.037
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f489d2034bbc3bff67230423a7986d5ea34060ec
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Tue Jan 23 15:21:31 2018 +0200

    Bug 20073: Move Elasticsearch configs to yaml files and improve the default settings.
    
    Improvements:
    1) Index settings moved from code to etc/searchengine/elasticsearch/index_config.yaml. An alternative can be specified in koha-conf.xml.
    2) Field settings moved from code to etc/searchengine/elasticsearch/field_config.yaml. An alternative can be specified in koha-conf.xml.
    3) mappings.yaml has been moved from admin/searchengine/elasticsearch to etc/searchengine/elasticsearch. An alternative can be specified in koha-conf.xml.
    4) Default settings have been improved to remove punctuation from phrases used for sorting etc.
    5) State variables are used for storing configuration to avoid parsing it multiple times.
    6) A possibility to reset the fields too has been added to the reset operation of mappings administration.
    7) mappings.yaml has been moved from admin/searchengine/elasticsearch to etc/searchengine/elasticsearch.
    8) An stdno field type has been added for standard identifiers.
    
    To test:
    1) Run tests in t/Koha/SearchEngine/Elasticsearch.t
    2) Clear tables search_fields and search_marc_map
    3) Go to admin/searchengine/elasticsearch/mappings.pl?op=reset&i_know_what_i_am_doing=1
    4) Verify that admin/searchengine/elasticsearch/mappings.pl displays the mappings properly, including ISBN and other standard number fields.
    5) Index some records using the -d parameter with misc/search_tools/rebuild_elastic_search.pl to recreate the index
    6) Verify that you can find the records
    7) Put <elasticsearch_index_mappings>non_existent</elasticsearch_index_mappings> to koha-conf.xml
    8) Verify that admin/searchengine/elasticsearch/mappings.pl?op=reset&i_know_what_i_am_doing=1 fails because it can't find non_existent.
    9) Copy etc/searchengine/elasticsearch/mappings.yaml to a new location and make elasticsearch_index_mappings setting in koha-conf.xml point to it.
    10) Make a change in the new mappings.yaml.
    11) Clear table search_fields (mappings reset doesn't do it yet, see bug 20248)
    12) Go to admin/searchengine/elasticsearch/mappings.pl?op=reset&i_know_what_i_am_doing=1
    13) Verify that the changes you made are now visible in the mappings UI
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb61cade43e11813158ba864a0834ae6a2ac6dec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 13:07:48 2018 -0300

    Bug 19855: Use patron-title to display patron's info
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c7ff786d5e755ff2452ec41c4385150b93d3ea9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 17:01:08 2017 -0300

    Bug 19855: Move getalert, addalert and delalert to Koha::Subscription
    
    This patch removes 3 subroutines from C4::Letters:
    - getalert
    - addalert
    - delalert
    
    And add 3 methods to Koha::Subscription:
    - subscribers
    - add_subscriber
    - remove_subscriber
    
    It makes the code cleaner for future cleanup.
    TODO - we should remove alert.alertid and alert.type, and rename
    alert.externalid with alert.subscriptionid
    That way alert will be renamed borrowers_subscriptions (or similar) and
    will become a simple join table between borrowers and subscriptions.
    We will need to deal with FK that could not be satisfied.
    Let's do that after this patch is pushed.
    
    Test plan:
    Subscribe and unsubscribe to email notifications sent when a new issues
    is available.
    Make sure everything works as before and you receive the emails.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bd1f30c8c4f151eaed1a6e1e56a8c78d28c0b4b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 14:26:39 2017 -0300

    Bug 19855: Remove $type from the alerts
    
    It looks like this feature has never been finished. It has been
    developed with more flexibility in mind, but only 'issue' is used for
    this parameter. Apparently it could have been 'virtual', for virtual shelves.
    
    Let remove this parameter and clean the code a bit.
    TODO: Remove the DB column
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a81a4adabb7e30bae77b0059c3a2372fd51a526
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 14:14:57 2017 -0300

    Bug 19855: Remove C4::Letters::findrelatedto
    
    This subroutine is called only once. It only concat firstname and
    surname for subscribers.
    It can be easily replaced with Koha::Patron
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6441436f45895d96ebe632cc841da82ccd72290
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 14:12:01 2017 -0300

    Bug 19855: Remove getalert from opac-user.pl
    
    This is not used later and seems unused since:
    commit e61173aa8eb23c111a707eba2cfbd2003df709bf
    Date:   Sun May 21 02:29:09 2006 +0000
        syncing dev-week and HEAD
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b75d9dc25800fde1218ca9896e3a69a8da54de96
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 14:10:44 2017 -0300

    Bug 19855: Remove getalert from moremember.pl
    
    This is not used later and seems unused since:
    commit b38997925f603dc9784c25d3db3501644c19e068
    Date:   Wed Oct 26 09:11:02 2005 +0000
        big commit, still breaking things...
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cc44f96b846af671e7bcb07dc541eecb5ec2120
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 07:27:07 2018 -0300

    Bug 18426: Replace 'Modify' with 'Edit'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64b689fcc810fbfc20b6483b43e05f60e968b9ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 07:25:29 2018 -0300

    Bug 18426: Make sure the logged in user can edit the subscriptions
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b366d8d4de2adae265fab1313e7bd2aad3fe67aa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 17 18:14:22 2018 -0300

    Bug 18426: Address QA issues
    
    - Replaced with the "action" links we already have on the biblio detail
    page and the items lost report.
    - Display all the editable values in the table
    - Add a 'Cancel' link
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f839259357f643a9719f583c02d02603a2a84a37
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 17 16:24:43 2018 -0300

    Bug 18426: Fix datepicker
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e698f7b478a094d7b32ebfeaa917bca05ebcc5b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Apr 11 18:07:47 2017 +0200

    Bug 18426: Allow to edit subscriptions in batch
    
    This adds a checkbox column in serials-search.pl tables that allow to edit
    selected subscriptions.
    The following fields can be modified:
     - Bookseller
     - Location
     - Library
     - Item type
     - Public note
     - Nonpublic note
     - "Create item when receiving" flag
     - Expiration date
    + the additional fields defined in serials/add_fields.pl
    
    Test plan:
    
    1. Go to Serials module
    2. If there is no additional fields defined, define some (at least one with an
       authorized value and one without)
    3. Start a subscription search
    4. Select some results using the checkboxes and click the "Edit" button above
       the table
    5. Select values for some fields (not all) and click "Start batch edit"
    6. Verify you are being redirected to the previous search results
    7. Verify that the fields for which you selected a value were modified and that
       the others fields weren't
    8. Repeat steps 4 to 7 but this time, modify the other fields.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d119336f19afb3e869b5b31752288ecc7216fa3f
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Apr 11 11:26:36 2017 +0200

    Bug 18426: Refactor subscriptions tables code in a BLOCK
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc6ba2cfa9c6f1b12772df2203a84896a145b2f3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 20 06:07:19 2018 -0400

    Bug 20622: Add some color to bootstrap modal headers and footers
    
    Right now the bootstrap modal header, body and footer are all white. It would be nice to give them a bit of color.
    
    Test Plan:
    1) Apply this patch
    2) Find a patron, click the 'add message' button
    3) Note the modal header and footer now have a background color
    
    Signed-off-by: Kyle M Hall <kyle@bywatetsolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea7a4f9c2cfc160fa8e637e2472cd7910b2bf6e6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 23 14:20:14 2018 -0300

    Bug 19287: DBRev 17.12.00.036
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a912d25ae8d2d360056c1ae5c88daa3909243d9a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Apr 22 16:05:03 2018 +0000

    Bug 19287: (QA follow-up) Fix preference description
    
    The last part of the preference description didn't show.
    Moved behind the other text and rephrased.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7cc2c97500ceb06a2efe0246c974e94d379d8f16
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 15:09:34 2018 -0300

    Bug 19287: Shorten button text
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6325f4cc83a6422f6ce7c2922b9077862efa50c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 15:08:42 2018 -0300

    Bug 19287: Do not display buttons for biblio level holds
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 215adcae9879a1465b217b9da5519bac06dd6c3b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 15:08:18 2018 -0300

    Bug 19287: Update UpdateItemWhenLostFromHoldList description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b3f6729b58f55b21762a4776a48214276a23653
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 13:16:30 2018 -0300

    Bug 19287: Add column action to columns settings
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32958c690f13eacf5a62ca7d28941e8568b6373f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 13:09:21 2018 -0300

    Bug 19287: Add CANCEL_HOLD_ON_LOST to installer files for all languages
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38b6e8afe1477a4afbed99cca1983b9be6b4478f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 13:03:47 2018 -0300

    Bug 19287: Use the notice defined for the homebranch of the patron
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 406c642dfaf5da77ae04d8f4dc38d95539fec235
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 12:59:26 2018 -0300

    Bug 19287: Fix conflict with bug 19974
    
    Note that these patches should be pushed along with bug 19984 to avoid
    regressions (if the syspref is changed between the 2 update DB entries)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26402293614301a273300bd8afd6afa2c55640b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 13:41:20 2018 -0300

    Bug 19287: Fix conflict with bug 19304
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32ff96a875aa7607eeba56b9ce3fc5f86eee585f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 12 14:14:56 2017 -0300

    Bug 19287: Add ability to mark an item 'Lost' from 'Holds to pull' list
    
    The goal to this enhancement is to add the ability to cancel a hold and
    mark items as lost from the 'Holds to pull' page.
    A new pref is added to control the behaviour, default is off
    
    To mark items as lost you need to set the new pref CanMarkHoldsToPullAsLost to one of these two values:
    - "Allow to mark items as lost"
    => The item will be marked as lost and the hold will be cancelled
    - "Allow to mark items as lost and notify the patron"
    => Same as previously but the patron will be notified as well.
    
    The notification is done using a new notice template (code=CANCEL_HOLD_ON_LOST).
    Feel free to suggest another default wording.
    
    To update the values of the items when one of these 2 buttons are used, you need to
    fill the UpdateItemWhenLostFromHoldList with something like: 'itemlost: 1'
    
    Test plan:
    1/ Place holds on some items
    2/ Go to Home > Circulation > Holds to pull
    From here you can cancel the hold or
    3/ Mark the items as lost
    => You will receive feedback messages depending on different situations:
    * The CANCEL_HOLD_ON_LOST does not exist
    * The patron does not have an email address (but the notice has been
    enqueued! It is the current behaviour with other notices)
    * The notice has been enqueued
    * The hold has been cancelled
    
    QA Notes:
    From which library do we want to pick the notice? This patch use
    reserves.branchcode
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 443b7159fa214af3398bef97d5f2aaa49b2f1a55
Author: Jon Knight <J.P.Knight@lboro.ac.uk>
Date:   Wed Mar 28 16:29:43 2018 +0000

    Bug 19479: Display price in basket group formatted according to CurrencyFormat syspref using templates.
    
    On the page acqui/basketgroup.pl the prices of baskets should be shown
    formatted according to the selected CurrencyFormat syspref, with no
    currency symbol or code.
    
    Test plan:
    
    1) Create a basket with items in it worth more than 1000 currency units.
    2) Close the basket.
    3) Go to acqui/basketgroup.pl page and check that the price format matches
       the current CurrencyFormat syspref.
    4) Go to Administration and change CurrencyFormat syspref to one of the
       other available options and recheck step 3.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Fixed some tabs.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95031b035b5de87211d0de2040eb685ae005606c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 20 19:00:35 2018 -0300

    Bug 20400: Fix get_routing_lists tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c0d4035866d3ed1e093c64696bb097bc06c26f6
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Apr 20 22:25:08 2018 +0200

    Bug 20400: (follow-up) Several fixes from RM review
    
    - "your routing lists" tab is now highlighted when active
    - get_routinglists was renamed to get_routing_lists
    - Koha::Patron->get_routing_lists returns the ->search result
      directly
    - Koha::Subscription::RoutingList->subscription uses DBIC
      relationship
    - Undo changes to C4/Auth.pm
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6bfebf03fb88783b7f2685281c27ebbc1b6dc4bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 20 14:06:33 2018 -0300

    Bug 20400: Fix number of tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9af0b9de7d464004b9418b5098568a864f3fcdfd
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Mar 15 08:40:12 2018 +0000

    Bug 20400: Add routing list tab in OPAC
    
    This patch adds the base for the new feature:
    Show a list of the serial titles a patron is on routing
    lists for in the OPAC.
    
    Test plan applies to the complete patch set:
    
    To test:
    - Apply all patches
    - Make sure RoutingSerials is not activated
    - Check patron account in OPAC - no tab should appear
    - Activate RoutingSerials
    - Create subscriptions and different routing lists, test with:
      - Patron with no routing list entries = no tab
      - Patron with one or more routing list entries = tab appears
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 20400: Rewrite using Koha::Objects
    
    Adds
    - Koha::Subscription::Routinglist
    - Koha::Subscription::Routinglists
    
    Adds 2 methods
    - Koha::Patron::get_routinglists
    - Koha::Routinglist::subscription
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 20400: Add unit tests
    
    prove t/db_dependent/Koha/Subscription/Routinglists.t
    prove t/db_dependent/Koha/Patrons.t
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 20400: Display new tab in OPAC only for patrons with routing lists
    
    The visibility of the routing list tab in the OPAC depends
    on the system preference RoutingSerials and the existence
    of routing list entries for the patron.
    
    Some libraries only offer routing lists to certain user groups and
    would not want it generally visible. As there are currently no
    actions you can perform from the list, this appears to be a
    reasonable behaviour.
    
    See test plan in first patch.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 20400: (follow-up) Use Asset TT plugin on opac-routing-lists.tt
    
    Patch applies and functions as described.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 20400: (QA follow-up) Redirect to 404 if routing is disabled
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51b774dc61d7ab49af843628333c26be4b57e1ac
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 20 15:47:51 2018 +0000

    Bug 9302: Add error message if keeper patron is invalid
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6797259d446dafec4523aad6840c590ae641769a
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Apr 19 15:02:31 2018 -0400

    Bug 9302: Add error messages, correct number of unit tests in subtest 'Test Koha::Patrons::merge'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b24fae93b41f3c7647a0683e5aa2fe843f0689a0
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 18 11:24:42 2018 -0400

    Bug 9302: Update div classes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b0ddf9c90c8f338c877f96138c7d9ddcafa48fa
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 18 11:20:33 2018 -0400

    Bug 9302: Wrap display_names block line with a span tag
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7319f1526b73729c51f2c5405d37de4a7809ea39
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 18 11:18:35 2018 -0400

    Bug 9302: Use patron-title.inc
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5afe2d81e178e34e0e2c2cd91daebf9afca44ab
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 18 11:11:11 2018 -0400

    Bug 9302: Add button directing use to keeper's patron record
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed3ee3c89b8bd7662820c07b15a7338ccedab4ac
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 18 11:06:39 2018 -0400

    Bug 9302: Make the patron search show/hide more links work
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a72911d701f3ac4ff4f9e4cd2ed61287d2739156
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 18 10:41:08 2018 -0400

    Bug 9302: Use new 'edit borrowers' permission
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57f510d963c4eae0a3e6e53d0e3b05862ac8833a
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 18 10:37:17 2018 -0400

    Bug 9302: Add aq tables to mapping
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 253dbb758aca5e9554fd5d9afd4429224fedc859
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 4 16:56:34 2018 -0300

    Bug 9302: (QA follow-up) Consistency follow-up
    
    This patch moves the Koha::Patrons->merge method into
    Koha::Patron->merge_with in the line of the discussed implementation for
    bug 15336. I agree with that implementation so I provide this follow-up.
    
    Tests are adjusted, the controller script is adapted too. The behaviour
    remains.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73e7661c498ec110c35809491b29157567a775dc
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Apr 4 11:30:17 2018 -0400

    Bug 9302: (QA follow-up) Dumper plugin isn't used
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 310b9b00b9966c334234cb333cb8e091f06766d9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 3 03:51:51 2018 +0000

    Bug 9302: (QA follow-up) Merge should be a transaction
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8d5447e39d176603e44b09f6a14d51bc1285680
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Jan 12 14:22:52 2018 -0500

    Bug 9302: (QA follow-up) Copy merged patrons to deletedborrowers table
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Ed Veal <eveal@mckinneytexas.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 11a2970d0e6c57752e6993c2ec162405878b0c95
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Aug 29 13:55:59 2017 -0400

    Bug 9302: Add ability to merge patron records
    
    It would be great if there were a merge patrons feature. If you
    accidentally end up with one patron with two cards it would be nice to
    merge their records together so that you don't lose their history or
    holds or anything.
    
    This patch adds a basic patron merge feature. It attempts to relink all
    patron related tables from the patron(s) to be merged. It does not
    attempt to relink librarian account related tables at this time. This
    feature does not attempt to automatically resolve issues such as
    duplicate holds. Such a feature could build upon this one though.
    
    Test Plan:
    1) Apply this patch
    2) Find two or more patrons
    3) Perform a patron search that will bring them up on the same page of
       results, or add them all to a list of patrons.
    4) Use the 'merge' button to begin the merging process
    5) Choose a patron to keep
    6) Verify the deleted patrons data ( checkouts, holds, etc )
       are now linked to the kept patron
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Ed Veal <eveal@mckinneytexas.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe5f6c8efdf46cfc8e8c93130256bbacf77b5a0b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 17 12:05:29 2018 +0000

    Bug 20047: (follow-up) Retrieve only biblio/authority servers as appropriate
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23d423365887311c29810bed2ca7718502189c87
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 19 15:57:02 2018 +0000

    Bug 20047: Add Koha::Z3950Server Oject and use it to get server count
    
    To test:
    1 - prove t/db_dependent/Koha/Z3950Servers.t
    2 - Load cataloging and authority home pages
    3 - Verify you can add form z395 on each page
    4 - Delete all z3950 servers
    5 - Viery option to add from Z3950 is removed on both pages
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 324a3e5dd3ea0194cbad51fa4509cef4d8ea5afc
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 19 13:33:21 2018 +0200

    Bug 20619: Remove last occurrences of long gone syspref (opacsmallimage)
    
    Code was commented anyway, so it was useless
    
    Test plan:
    1. Read the diff
    2. Confirm that it only removes comments
    3. Confirm that there are no remaining references to this syspref in the
       code (only remaining references are in updatedatabase.pl and release
       notes)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 268ba1d5ec7ef66790583c877d5641f007550ad2
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 20 13:55:50 2018 +0200

    Bug 19873: (QA follow-up) Prevent warnings
    
    "Use of uninitialized value $operands[X] in string ne"
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fa350014905c43636c6bdf8df7eee54e1b7d901
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Thu Mar 1 13:23:44 2018 +0000

    Bug 19873: Add unit tests
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc41a490a1ecd14e31b36a4531ced1203c0ed608
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Fri Dec 22 14:18:44 2017 +0000

    Bug 19873: Ability to search on 0 value
    
    Test plan:
      - create a st-numeric index in zebra conf related to
        a numeric field
        i.e:
        yourindex 1=yourindex 4=109
      - fill a field with 0 in a biblio,
      - reindex your biblios,
      - search yourindex=0,
      - should not work,
      - apply this patch,
      - test again,
      - should work
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db3e175c46ab466e484a34c97d8a64a6482fd194
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 20 13:12:36 2018 -0300

    Bug 19974: DBRev 17.12.00.034
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fdea02efce857153bd34aab1a7fe600c765c4ad9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 25 21:12:30 2016 -0500

    Bug 15922: Show authorized value description in staff client search results for lost, withdrawn, and damaged
    
    If an item in the staff client search results list is lost, withdrawn,
    or damaged, the actual authorized value description for each of those
    statuses should be displayed rather than the generic term. This patch
    adds use of the AuthorisedValues template plugin to output the correct
    description.
    
    To test, apply the patch and perform a catalog search in the staff
    client which will return results with various values for lost, damaged,
    and withdrawn.
    
    Confirm that the correct lost, damaged, or withdrawn status appears for
    each item rather than the generic term.
    
    Followed test plan, statuses appear as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c5843b1564cc2f1cab2c6bb8be7556b51730631
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 15 12:32:43 2017 +0000

    Bug 18799: XSLTresultsdisplay hides the icons
    
    If item-level_itypes is turned off and XSLTResultsDisplay is turned on,
    biblio-level itemtype images are not shown in staff client search
    results. This patch corrects the problem.
    
    This patch also adds some markup and CSS to the itemtype image to make
    it look a litte cleaner and work better in result sets in which some
    titles have images and some don't.
    
    To test, apply the patch and view the staff client search results page
    with various settings:
    
    - XSLT turned on and off
    - item-level_itypes turned on and off
    - noItemTypeImages turned on and off
    
    Confirm that item type images are shown or not shown correctly according
    to each setting.
    
    The difference between this patch and the other patch currently on this
    bug is that this patch continues the practice of hiding biblio-level
    itemtype information when item-level_itypes is ON.
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4de8790482ebe80611aa2ad81feb03e23e270aac
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Apr 18 10:25:19 2018 +0000

    Bug 20603: Remove ModNote, getcredits and getrefunds from C4::Accounts
    
    Test plan:
    0) Do not apply the patch
    1) Run these 3 commands
        git grep ModNote
        git grep getcredits
        git grep getrefunds
    all should return occurances only in C4/Accounts.pm - the sub definition
    and in t/db_dependent/Accounts.t
    2) Apply the patch
    3) Run commands from 1) again, now there should be no occurence
    4) prove t/db_dependent/Accounts.t
        should return green
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3277ca88fd079e4bb17c549f317b3ba24a2f64c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 28 14:49:18 2018 -0300

    Bug 20489: Remove warnings from the interface
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d68fe07bf806e3676fc637dddf0e63dee41055bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 28 14:44:21 2018 -0300

    Bug 20489: Prevent DB user login
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8291ba410e66a6f9adeeeb7e2cac3d2308cc0a3e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 12:31:22 2018 -0300

    Bug 20580: Make create_superlibrarian.pl accept parameters
    
    So far this script does not accept parameters and create a koha/koha
    superlibrarian
    This patch makes it accept parameters to create a customized
    superlibrarian patrons.
    
    Test plan:
    Use the script with valid and invalid paramters and confirm that it
    works as expected.
    
    Note: A cryptic "Invalid parameter passed" error is raised when the
    categorycode is not valid. Better error handling must be provided but
    Koha::Exceptions seems to be enhancement (see related bug reports).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit beb6bd866779a93373ae493c784afbcbd470e4a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 17:41:42 2018 -0300

    Bug 19030: Preserve link between order and subscription when editing an order
    
    The aqorders.subscriptionid info is not sent to the template when the
    order is edited. Which means we lose this link.
    
    Test plan:
    Create an order from a subscription
    Edit the order
    => Without this patch, the aqorders.subscriptionid value is set to NULL
    and items are created when receiving serial.
    
    => With this patch applied the link is preserved and expected behaviors
    are preserved during all the acquisition workflow
    
    You should also try and create several orders from the same subscription
    
    Sponsored-by: BULAC - http://www.bulac.fr/
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d7db25b00fd1191374650c5fe5a6da6d02fcb0c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 20 08:21:33 2018 +0200

    Bug 19974: (QA follow-up) Do not use bar separator in atomic update
    
    The multiple select saves the selected values with a comma.
    Furthermore, preferences.pl also splits on a comma. In other words, the
    upgrade will not work with the bar character. All options will be
    deselected.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d32791b5db11c20e7e445d0c9e10e8663883598f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 2 13:55:16 2018 -0300

    Bug 19974: Make MarkLostItemsAsReturned multiple
    
    Given the confusion regarding this behaviour it sounds better to make it
    configurable.
    This pref will take 4 different values, 1 per place an item can be
    marked as lost.
    
    Test plan:
    Mark items as lost and confirm the item is returned or not, depending on
    the value of the system preference.
    
    - from the longoverdue cronjob (--mark-returned takes precedence if set)
    - from the batch item modification tool
    - when cataloguing an item
    - from the items tab of the catalog module
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d8dc552418dc0a95c8baadcfc524382e76d971c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 23 09:34:46 2018 +0100

    Bug 19974: (QA follow-up) Move lost logic to else branch
    
    If an error is raised for the barcode, we should not try to perform the
    lost logic succeeding it.
    Futhermore there is no need to go to GetMarcFromKohaField etc. if we just
    use the output of ModItemFromMarc.
    
    Note: It seems unnecessary to clear $itemnumber, but I can understand
    the anxiety about passing it to the template with op=additem. So just
    leaving it here.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fc6715350084bbba2bef92b52aabf58afd70a9f
Author: Charles Farmer <charles@inlibro.com>
Date:   Mon Jan 15 16:20:10 2018 -0500

    Bug 19974: Marking an item as 'lost' in additem.pl will not modify the current item
    
        TEST PLAN:
    
        1) Log in with your superlibrarian account
        2) Borrow any book
        3) Visit your Checkouts page, and click 'Show Checkouts'
        4) Click on the item's barcode to visit the item's page
        5) On the item's page, click the 'Edit' button, and choose 'Edit items'
        6) In the items table, click the 'Actions->Edit' button of the item you borrowed
        7) Mark that item as lost (it should be the first row of the form) and click the button 'Save changes'
        8) Visit your Checkouts page. The item should still be there, despite BZ12363 claiming it should've been automagically returned
            8.1) Your koha-log should also output a warning message: 'DBIx::Class::Storage::DBI::select_single(): Query returned more than one row...'
            8.2) If you visit the item's page, the modification had no effect. It should not be marked as lost.
        9) APPLY PATCH
        10) Start back from step 2), but this time, after marking the item as lost, the item's page should
            reflect the change, and the item you borrowed should've been automatically returned to the library
    
    Signed-off-by: Jean-Manuel Broust <jean-manuel.broust@univ-lyon2.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Using $item->{itemnumber} instead of new variable.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbd233db5a4c7201c4691198fe5f0aecb320f357
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue Apr 10 16:50:56 2018 +0100

    Bug 20556: Marking ILL request as complete..
    
    When marking a request as complete, the status is updated internally
    then the user to redirected to the view of the request.
    
    Although the redirect header is sent, there is no exit to indicate that
    the program flow should stop. As a result, an attempt is made to render
    the template, which fails.
    
    This patch simply adds the missing exit.
    
    TEST PLAN
    ---------
    
    - Create an ILL request
    - "Manage request" > "Confirm request"
    - "Mark completed"
    - TEST: Ensure that no error is written to the error log upon clicking
    "Mark completed"
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 439844afaaed1e7507119e34c10ace50d31adfdf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 20 10:17:49 2018 -0300

    Bug 20590: Fix Members.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee790caf6ebdba87f951bac5a13fbb2c2bff1c56
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 19 12:21:41 2018 -0300

    Bug 20322: (QA follow-up) Use Font Awesome icons
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69fab7eddab5d3b77a08bf9729b3ad9e4132f025
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Mar 27 01:34:04 2018 +0000

    Bug 20322: (follow-up) fix validator.w3.org complaints - extra /div
    
    The intranet-bottom.inc has the closing div, just deleted
    the last one.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c252fbc1ae3dded6eb7f77bb2d8fda547f26deaa
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Mar 27 01:32:16 2018 +0000

    Bug 20322: (follow-up) use tooltips for warning
    
    This puts similar old text into tool tips for the overdues.
    Hover over the overdues, and the tool tips should appear and
    be similar to what the text was before.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 841565060c6c5436a0eb07868ecdd58538e54a94
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Tue Mar 20 23:03:51 2018 +0000

    Bug 20322: (follow up) design refresh for circulation page
    
    Further revisions, compromise.
    
    - 4 columns to three
    - offline circulation demoted to below the intranet homepage preference,
        and no buttons, due to its relative lack of everyday use.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bb60e300563c3afad826a5d1eb287d58ac9f694
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 6 13:16:21 2018 +0000

    Bug 20322: (follow-up) Circulation page layout and design update
    
    This follow-up makes some suggestions about how to push this further:
    
    - Put content in four columns which reduces to two on smaller screens
    - Adjust font size of large links
    - Move Offline Circulation links into its own column
    - Add image icons to the Firefox extension and Windows application
      download links
    - Improve indentation in template
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00812355434ffbd7c3b20c568da28d651cf348c2
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Fri Mar 2 15:21:24 2018 +1300

    Bug 20322: design refresh for circulation page
    
    do note, I don't actually mind if these aren't the changes eventually accepted. I just know it needs doing and starting it will hopefully get some gears turning.
    
    To test:
    Click all the links and check they work.
    Do you like the styling? it's different. :)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c448494f179e275d34c449b3a843d93d7c40b04
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 07:13:16 2018 -0300

    Bug 18327: Style 'Multi receiving' button like others
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acef0a17964ecdf28b48b06eb8f00304ddec9486
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 18 13:08:21 2018 -0300

    Bug 18327: Set label width to 50% in modal
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e215da87fffb2e7fae0551a8eb9abe6a21d26063
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 18 13:08:06 2018 -0300

    Bug 18327: Rename submit button with 'OK'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4aa45fc489210dff7c78569c2c99bbae1e7d4803
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 17 09:42:08 2018 -0300

    Bug 18327: Same change for serials-edit
    
    And use an include file to avoid copy/paste
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3ed24560c6981ebee418fad12c3086714f5a04b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 18:56:06 2018 -0300

    Bug 18327: Add the ability to set the received date to today on multi receiving serials
    
    When receiving several issues for a subscription (Serials > Serial
    collection > Multi receiving), the reception date is always identical to the
    publication date.
    In some use cases we would like to set this "date received" value to
    today.
    Note: "date received" refers to the DB column serial.planneddate
    
    To make this possible this patch replaces the JS prompt with a modal
    dialog asking for
     1. the number of issues to receive
     2. if the received date must be set to today
    
    Ergonomic note: bootstrap styled buttons are used, but they do not display correctly
    We may need to improve that (later)
    
    Test plan:
    - Receive 1 or more serials using the "Multi receiving" buttons
    Note that this button appears twice, on the "serial collection
    information" and the "serial edition" pages
    - Try with and without the new checkbox ticked and confirm the behaviour
    is correct (i.e. date received is set to today or set to the publish
    date)
    - Make sure "Edit serials" and "Generate next" buttons still work as
    before
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0d3cd9b92a86c10539213e210789e1f2d1d61e3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 16:21:57 2018 -0300

    Bug 20562: Fix Returns.t test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6f729cfa0a1bb362e66646413fb0ef40af9d9ea
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 19 11:13:06 2018 -0300

    Bug 20590: Include Koha::Exceptions::Exception
    
    This patch makes Koha::Exceptions::Object include
    Koha::Exceptions::Exception so it is not required to include it
    excplicitly for using this exceptions.
    
    To test:
    - Run:
      $ kshell
     $k prove t/Koha/Exceptions.t
    => FAIL: Tests fail because Koha::Exceptions::Exception is not
    (implicitly or explicitly included)
    - Apply this patch
    - Run
     k$ prove t/Koha/Exceptions.t
    => SUCCESS: Tests pass!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 681a25f802dc3d2c1eaf63a2d1e7efa3f0d3f585
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 19 11:12:31 2018 -0300

    Bug 20590: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74e0dfb4376c971d916299827aca1d65cd0852a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 12:39:15 2018 -0300

    Bug 20590: Improve Koha::Exceptions in string context
    
    I was working on bug 20580 and noticed that the exceptions are not
    stringified and so not really useful when displayed in string context.
    
    This patch is for discussion and not ready for inclusion
    
    Still need to fix:
    Koha/REST/V1/Patrons.pm (The error is "Given xxx does not exist")
    Koha/Object.pm: in ->store, Koha::Exceptions::Object::FKConstraint is
    raised but we cannot set 'value'
    
    Another note: In Koha::Exceptions::Exception I do not have access to
    $self->line_number and $self->filename
    
    See also
    http://search.cpan.org/~drolsky/Exception-Class-1.44/lib/Exception/Class/Base.pm#OVERRIDING_THE_as_string_METHOD
    
    Test plan:
    Apply patch from bug 20580 and execute create_superlibrarian.pl with an
    invalid categorycode
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0797d9cc09fdb8e0f1b1e0b5824775ff6286c60a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 10:50:33 2018 -0300

    Bug 20590: Koha::Exceptions::Exception
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b080c2d1b924058563c8e12b30a24308c26cf68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 09:12:11 2018 -0300

    Bug 7143: Update about page for new dev - Andrew Isherwood
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50f4c8c831290aa6a02a821d591497e6d33ce94b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 09:09:31 2018 -0300

    Revert "Bug 20104: Update minimum version of Perl to 5.20"
    
    This reverts commit 4218875ec039dc375124f969caea1624399c21a4.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62ed6df83e9e8586510e4ed612a25b50a697800d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 11 13:56:11 2018 +0000

    Bug 19952: Update popup window templates to use Bootstrap grid: UNIMARC cataloging plugins
    
    This patch updates two UNIMARC cataloging plugin templates to use the
    Bootstrap grid instead of the YUI grid.
    
    - unimarc_field_210c_bis.tt
    - unimarc_field_686a.tt
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that the
    page in the popup window looks correct. Confirm that changes made in the
    popup window are saved to the corresponding field in the editor.
    
    Signed-off-by: Te Rauhina Jackson <terauhina.jackson@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1659fa09f68541efbb552390f858f5567354f2d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 12:29:20 2018 -0300

    Bug 18790: DBRev 17.12.00.034
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a92d53bc8be12f4f57a3931bc8cde84a8a844e7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 12:19:17 2018 -0300

    Bug 18790: Prevent the tests to fail if precision changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10dd350a8bdb408c226721e1387edd9dd3b1575e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 13 12:25:51 2018 +0000

    Bug 18790: (QA follow-up) Use a transaction for voiding
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75ebc49f2585b9dbfd1e52a58a83b49862ce12b4
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 13 11:16:19 2018 +0000

    Bug 18790: (QA follow-up) Fix capitalization
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1f773318f4382b57b4fa9cd1f0cc618528b3a25
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Feb 21 07:04:22 2018 -0500

    Bug 18790: Add new account offsets to atomic update
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49a0ed8d16a9481ee0ea466adc6db0ad52cbfcbf
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Feb 21 07:03:17 2018 -0500

    Bug 18790: Add logging for voided payments
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5372faf4e5be575f91eacd91ddbfba73c5835bf5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Sat Jun 10 11:34:56 2017 +0000

    Bug 18790: Add ability to void payments
    
    We've had the ability to 'reverse' a payment for a long time, but it
    would be much better if we had a true void payment function that
    replaces the paid amounts into the fee so that it appears as if the
    payment was never made.
    
    Test Plan:
    1) Apply this patch and dependent patches
    2) Run updatedatabase.pl
    3) Create some fines
    4) Pay those fines
    5) Use the new 'void' button to void the payments
    6) Note the fines were restored to their pre-payment amounts
    
    Signed-off-by: Koha-us conference <koha-us@koha-us.net>
    Signed-off-by: BWS Sandboxes <ByWaterSandboxes@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46cf3910a368ce5affdc9517c0a5f28d360bdbcb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 12:28:16 2018 -0300

    Bug 18786: DBRev 17.12.00.033
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cce5ce7ce78642a451c9f06f4bc1dee80f9451c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 12:21:00 2018 -0300

    Bug 18786: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7311d35f934eabad15d1b261d6ca968a3b736373
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 13 13:15:57 2018 -0300

    Bug 18786: Add PAYMENT_TYPE to the AV categories
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fde5ea23fc87662e59a590aa8e90f8aea6caefa2
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jun 12 10:09:35 2017 -0400

    Bug 18786: Add ability to create custom payment types
    
    Some libraries would like to be able to specify more specific payment types such as cash, check, credit card, or even canned food ( for food drives ). This feature will allow a library to specify payment types as authorised values of the type PAYMENT_TYPE.
    
    Test Plan:
    1) Apply patches
    2) Update database
    3) Add authorised value PAYMENT_TYPE with values 'Cash', 'Check', 'Credit card'
    4) Go to the fines section of a patron who has several fines
    5) Tab 'Fines'
    6) Click on 'Pay' for an individual fine
    7) Verify that in the form a 'Pay an individual fine' dropdown appears with payment types
    8) Select a payment type, confirm payment
    9) Verify that payment type appears in "Description of charges" in tab 'Account'
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Bug 18786: Remove use of Koha::Patron::Images
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Bug 18786: Remove duplicate block with bad IF
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73d2ba31889af8c3a39d8e7a5908ba5a36e5e21b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jun 12 10:07:53 2017 -0400

    Bug 18786: Update database
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 618ccd243ea9bdd2daa115415bafb5a4c864333b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Apr 18 15:20:02 2018 +0200

    Bug 20343: Put translatable strings in strings.tt
    
    Also add a CSS class on <details> for easier styling and change the
    list style so it take less space on screen
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67d905d49f2871c884dc868bd1b50517624dcdbf
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Mar 6 14:47:46 2018 +0100

    Bug 20343: Show number of checkouts by itemtype in circulation.pl
    
    It is sometimes useful to have the number of checkouts grouped by
    itemtype (to see if we're approaching the maximum number of checkouts
    allowed for instance).
    This patch adds this information above the checkouts table, in
    circ/circulation.pl
    
    Test plan:
    1. Check out some items with various item types to a patron
    2. In circ/circulation.pl, click on 'Show checkouts' button to display
       the table
    3. Notice the line "Number of checkouts by item type" above the table,
       click on it
    4. See that the list of item types is displayed with a count in front of
       each one
    5. Compare the numbers to the checkouts in the table and verify that the
       numbers are correct
    
    Signed-off-by: claude <claude.brayer@cea.fr>
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71e5c4274057755bc593d8f1ca598d378b558649
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 17 18:12:50 2018 -0300

    Bug 20599: Add the Koha::Subscription->vendor method
    
    Test plan:
      prove t/db_dependent/Koha/Subscription.t
    must return green
    
    NOTE: My preference is for $subscription to be object,
          and perhaps something like $built_subscription to
          be from the builder. Because, $object is a poor
          variable name.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26201f906c90d1596ad450a4ee788ccd301c24d4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 19 12:26:21 2018 -0300

    Bug 19794: DBRev 17.12.00.032
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 233be0fe1390022d45edf1811675c12ad45d2f22
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Apr 17 00:17:09 2018 +0000

    Bug 19794: (follow-up) Add atomic update
    
    The update will
    - change the RLIST notice code to SERIAL_ALERT
    - adapt the description if it has remained unchanged from
      'Routing List' to 'New serial issue'
    - update subscriptions to use the new notice code
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d444b0bb9d48060de246818f1cbc8a9b470956b7
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Apr 16 14:56:33 2018 +0000

    Bug 19794: (QA follow-up) Change tab to space
    
    Test plan:
    Run qa tools, it should be happy
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb796f4eb8c5b0c3a7cd29fdd32e250d88166350
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Feb 20 21:33:10 2018 +0000

    Bug 19794: Rename RLIST notice to SERIAL_ALERT to better reflect its purpose
    
    The RLIST sample notice is used to send an email to patrons who have
    subscribed to be notified when a new issue for a subscription arrives.
    
    This is a feature that is totally independent and not related to the
    use of routing lists. In the GUI however, this was misleading so far.
    
    - Rename  RLIST to SERIAL_ALERT and fixes the sample notices
    - Fix explanations in the helf files
    - Fix name of the module in letters from 'serials (routing list)'
      to 'serials (new issue)'
    
    Note: There is no logic to be changed as the notice template
    to be used is defined for each subscriptions and this is just
    the sample notice. I've also opted against a database update, to not
    interfere with existing installations, reports etc.
    
    A patch to the manual will be submitted shortly after this passes QA.
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea983250dc14583b7594aa7af4d942ddc3f38ad6
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Apr 13 09:57:38 2018 -0400

    Bug 12123: Make iframe large enough to remove scroll bars
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3de9bc0042ee7f661aaa7d9fdba57647a0fd7b5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 22 06:55:22 2014 -0700

    Bug 12123: Prevent HTML notices to break the notice viewer
    
    Depending on the content of an html notice, it can cause the notice to
    either not be collapsible, be uncollapsible, or to be permanently
    collapsed.
    
    Test Plan:
    1) Set your CHECKOUT notice to the following ( with HTML Message checked ) :
    <p>The following items have been checked out:</p>
    
    ----
    <blockquote> <<biblio.title>> </blockquote>
    ----
    
    <p>Thank you for visiting the <<branches.branchname>> of HMCPL.</p>
    2) Check out some items to a patron
    3) View the patrn's notices
    4) Note the notice viewer is broken ( message is not collapsed, and
       con't be collapsed ).
    5) Apply this patch
    6) Reload the page
    7) Note the notice viewer is no longer broken
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    I followed the test plan successfully.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d1f04b2699737ddd2b2ea5a374cc343f46c2380
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 13:48:54 2018 -0300

    Bug 20562: Pass the Koha::Checkout object to AddIssuingCharge
    
    We do not need to pass all those parameters, just the checkout object is
    enough.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc5d3b9abd34b0e80794fff7029809b7438bcefa
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Sun Apr 8 07:11:11 2018 +0000

    Bug 20562: issue_id is not stored in accountlines for rental fees
    
    Test Plan:
    1) Apply this patch
    2) Assign a charge to an item type
    3) Checkout an item of that type to a patron
    4) View the accountlines table for that patron
    SELECT * FROM accountlines WHERE accounttype='Rent' and borrowernumber=##;
    5) Note there is an issue_id
    
    Or
    
    1) Apply this patch
    2) prove t/db_dependent/Circulation/issue.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f553d76600e967b4492f03494f34170c8cf5d83e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 14:09:03 2018 -0300

    Bug 11674: DBRev 17.12.00.031
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0b0732c970f09781ca4bf6d90f0302e93c418ff
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Thu Feb 1 12:00:02 2018 +0200

    Bug 11674: Configuration for MARC field doc URLs
    
    Add a new system preference MarcFieldDocURL. Setting it to some URL
    will make all the MARC documentation links point to that in
    the MARC edit UI. Leaving the value empty will use the old defaults
    (http://loc.gov for MARC21 and http://archive.ifla.org for UNIMARC).
    
    There are some possible substitutions usable in the URL:
     - {MARC} is replaced with either "MARC21" or "UNIMARC"
     - {FIELD} is replaced by the MARC field number, eg. "000", "048", ...
     - {LANG} is replaced by the UI language, eg. "en", or "fi-FI"
    
    To test:
    
    1) Go to Cataloguing > New record
    2) Clicking on the question mark links in the MARC edit will
       open a window to either loc.gov or archive.ifla.org
    3) Install patch, run updatedatabase, etc
    4) Redo parts 1, and 2.
    5) Set the value of MarcFieldDocURL to
       http://example.com/?field={FIELD}&marc={MARC}&lang={LANG}
    6) Redo parts 1 and 2
    7) Clicking on the question mark links in the MARC edit will
       open a window to example.com, with the proper substitutions
       in the URL for the field, marc flavour and language
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c14c4998dc7eeb79a02911d8ed37db5393f3de8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 13 11:43:21 2018 +0000

    Bug 18007: Interface updates to notices and notice previews
    
    This patch makes changes to the form for adding and editing notices, and
    to the template for viewing a rendered preview of notices.
    
    - Preview now shows side-by-side comparisons
    - JavaScript has been movied out of template into separate file
    - Validation of the add/edit form improved through use of validation
      plugin
    
    To test, apply the patch on top of those for Bug 17981
    
    - Add a new notice.
      - Confirm that the form can't be submitted without data in the "code"
        and "name" fields.
      - Confirm that the form can't be submitted without filling in at least
        one message template (subject and body).
      - Confirm that you cannot submit the form while using an
        existing notice code.
      - Follow Bug 17981's test plan for testing the preview function.
        Confirm that the preview loads correctly and looks correct.
        - Test both with old syntax messages which require conversion and
          messages in template-toolkit syntax.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Fixed conflicts caused by bug 20538.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84fe9a2adeafb7d0393779bcfafdbd49e25736dd
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Apr 16 00:25:56 2018 +0200

    Bug 20515: (QA follow-up) Fix capitalization on 'Ill Requests'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f95c7845fecaefd6e7c2fd68f2381710f1ebc7a4
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Apr 13 11:41:37 2018 +0100

    Bug 20515: (follow-up) Add missing CAN_user_ill
    
    This follow up patch adds two missing CAN_user_ill tests in templates
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f983c7249f2141a2908f1cef4e9c5a0c2ba282d
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Apr 9 15:41:57 2018 +0100

    Bug 20515: (QA follow-up) Remove specific superlibrarian check
    
    Removed the test for CAN_user_superlibrarian as requested
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4ccd04d066ab304619c34adf15f9124e1cf6ee6
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed Apr 4 12:09:52 2018 +0100

    Bug 20515: Fix permission check on "ILL request" menu options
    
    This patch adds the following additional conditions to the display of
    both the ILL Requests drop down "More" menu option and the "ILL Requests"
    option on the intranet front page:
    
    Before:
    
    [% IF Koha.Preference('ILLModule') %]
    
    After:
    
    [% IF Koha.Preference('ILLModule') && (CAN_user_ill || CAN_user_superlibrarian) %]
    
    This prevents the options being displayed to users who have no
    permissions to work with ILL.
    
    Test plan:
    
    View both the intranet front page and "More" dropdown while logged in as
    a user without ILL permissions, ensure the options do not display. Then
    do the same with a user with ILL permissions, ensure the options do
    display.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84327359787fe681e4ae456df330bcb4591f6291
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Apr 9 11:38:44 2018 +0200

    Bug 20539: Remove warnings in catalogue/search.pl
    
    Test plan:
    1. Start a search from intranet
    2. See several warnings in logs
    3. Apply patch (&& reload starman)
    4. Start a new search
    5. Confirm that warnings are gone and that the search still works
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4c1e91a2fce18dca1708fe933f142541ea2190d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 12:56:01 2018 -0300

    Bug 18725: Test return values of make_column_dirty
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38132cabbb88a51b3b457972dc7119eecdc9cfb5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 13 09:38:50 2018 +0200

    Bug 18725: (QA follow-up) Use make_column_dirty instead of status change
    
    Moving the status to the invalid 'processing' might well have unwanted
    side-effects. (The status column will be set to empty string and we have
    a problem if it is not processed.)
    
    This patch allows pass-through of DBIX's make_column_dirty in
    Koha::Object (simple tests included) and uses it to force an update.
    If the update does not return true, it still exits.
    
    Test plan:
    [1] Read the changes.
    [2] Run t/db_dependent/Koha/Object.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ad45474324b672fb48d8b7af83a94184cd1b2f9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 26 09:04:59 2017 -0400

    Bug 18725: Prevent process_message_queue to send duplicate emails if message_queue is not writable.
    
    Last week, we had a database server whose disk filled, causing database writes to fail.
    
    This meant that messages in message_queue marked 'pending' were not marked as 'sent' when they were added to the postfix mail queue; messages were sent every 15 minutes (as specified in the cron job) until the disk space issues were cleared.
    
    I would suggest adding a token write to the start of process_message_queue.pl as a 'canary in the coal mine'. If the database write fails, process_message_queue should stop, because it's not safe to proceed sending emails that may not be marked 'sent'.
    
    Test Plan:
    1) Apply this patch
    2) Make the message_queue table unwriteable somehow
    3) Run process_message_queue.pl
    4) Script should die with error
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77853e2e538a8503d1283331d4b1dc743a3e1591
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 16 11:14:50 2018 -0300

    Bug 19882: Fix syntax issue in .pref file
    
    The translate script raised an error:
    Use of uninitialized value $pref_name in concatenation (.) or string at
    LangInstaller.pm line 190.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9dade8852caab3479204f2995826a2e970bca3a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 13 15:09:53 2018 -0300

    Bug 20584: Prevent Koha/Patron/Categories.t to fail randomly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 967a33d9a1ca669cb10c91aa4b84e7ff69fb70d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 13 13:53:32 2018 -0300

    Bug 18791: Export visible columns only
    
    We certainly will want to improve that and explicitely list the columns
    to export. For instance the actions and checkboxes should not be
    exported, even if visible.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c48a1e2c2b5ea246a4ea0f3b0e2d8dadc3279ed
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 27 15:09:08 2018 +0000

    Bug 18791: (follow up) Fix translation of copy messages
    
    This patch updates DataTables configuration so that more strings are
    translatable:
    
    https://datatables.net/extensions/buttons/examples/html5/copyi18n.html
    
    To test, apply the patch and clear your browser cache.
    
    - Open the account tab for a patron who has only one fine.
    - Confirm that the new DataTables buttons appear.
    - Click the 'Copy' button and confirm that a "Copied 1 row to clipboard"
      message appears.
    - Test again with a patron who has multiple fines, confirm that the
      message reads "Copied X rows to clipboard."
    
    To test the translation:
    
    - Confirm that "Copied 1 row to clipboard" is missing from the language
      file you're testing with (misc/translator/po/xx-YY-staff-prog.po).
    - Run 'translate update xx-YY'
    - Check that the clipboard strings are now in the po file.
    - Add translations for those strings.
    - Run 'translate update xx-YY' and 'translate install xx-YY'
    - Switch to the translated language and clear your browser cache.
    - Test the 'Copy' button again. Your translated text should appear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c35b35ad0311ec74d27518d794d63a2e6f3e8b6
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 9 11:22:06 2018 -0500

    Bug 18791: (follow-up) Make buttons translatable
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5254441c14ef13af9fbd8e0c76a0b12735b0f8ea
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jun 12 14:13:51 2017 -0400

    Bug 18791: Add the ability for librarians to easily copy, download or print DataTables based tables in Koha
    
    There are many tables in Koha where it would be useful
    for librarians to easily copy, download or print the table
    for various purposes. These functions are available via
    DataTables button plugins.
    
    Test Plan:
    1) Clear your browser cache ( just in case )
    2) Apply this patch
    3) Browse to boraccount.pl ( or another page using DataTabes )
    4) Note the new Excel, CSV, Copy and Print buttons
    5) Test each button to ensure they work
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 274974fdb82c0ed712b1198200554dc849ce2b67
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 13 13:31:23 2018 -0300

    Bug 19882: DBRev 17.12.00.030
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 952c03d6f9d8be29decb4585f3810017f64917ca
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 12 13:51:17 2018 +0000

    Bug 19882: (follow-up) Add 'IGNORE' in DB update
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c36042e858068f01494bf129e82a62b48cc4e10
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 27 13:18:26 2017 +0000

    Bug 19882: Add Novelist Select staff client profile
    
    This patchset allows for use of a separate Novelist profile for the
    staff client and opac. This allows Novelist to determine links and
    special styling for each. Testing is best with novelist credentials,
    however, confirming that values are set and used correctly and nothing
    is broken should suffice.
    
    To test:
    1 - Apply patches
    2 - Update database
    3 - View detail pages for some records on opac and staff client and ensure no changes have been
    made
    4 - Enable NovelistSelectStaffEnabled (and enter or have info in the Profile and password)
    5 - Set NovelistSelectStaffView to 'above'
    6 - View detail pages for some records, verify that if novelist info is
    available it is displayed and nothing is displayed if not
    7 - Repeat with all staff view options
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7960a7311bccab007e50d586159814f94f848c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 13 12:08:07 2018 -0300

    Bug 20538: ->tag is private - tell it explicitly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8470024657a9516ae4f50c4cb75f59f16056824a
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 12 11:21:05 2018 +0200

    Bug 20538: Add POD for Asset.pm
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 639591f072a64f228a9eb0bb62c0337aea91c322
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 12 11:05:31 2018 +0200

    Bug 20538: Move categories.js out of language directory
    
    This was the last js/css file inside a language directory
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4626a6f5a58bd8cd3992d9e369b5ae94593443fd
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 12 10:30:10 2018 +0200

    Bug 20538: Fix 2 JS paths
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae542767cbe496c19aba159325f005bbe7b804f4
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 12 10:28:45 2018 +0200

    Bug 20538: Fix copyright notice in Asset.pm
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ac45a4a68a567b249d4b5220541ae5461dfed81
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Apr 12 06:57:25 2018 +0000

    Bug 20538: (follow-up) Update discharges request page with Asset plugin
    
    This is follow-up of bug 20524
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed7543287b5e0bb3fadf851d761eb116a79ea727
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 6 17:02:55 2018 +0200

    Bug 20538: Remove the need of writing [% KOHA_VERSION %] everywhere
    
    Having to write [% KOHA_VERSION %] for each url is bad because:
    - It's easily forgettable when adding new <script> or <link>
    - It prevents grep'ing for the full filename
    - It violates the DRY principle
    - If at some point we want to change the "force js and css reload"
      mechanism, it will be tedious
    
    This patch:
    - adds a Template::Toolkit plugin that generates <script> and
      <link> tags for JS and CSS files, and inserts automatically the Koha
      version in the filename
    - use the new plugin to remove all occurences of [% KOHA_VERSION %]
    - remove the code that was adding KOHA_VERSION as a template variable
    
    Test plan:
    1. Apply patch
    2. Go to several different pages in Koha (opac and intranet) while
       checking your browser's dev tools (there should be no 404 for JS and
       CSS files, and the Koha version should appear in filenames) and the
       server logs (there should be no "File not found")
    3. `git grep KOHA_VERSION` should return nothing
    4. prove t/db_dependent/Koha/Template/Plugin/Asset.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fe8b62f8429bde8f73d893ca34d0dec4de0f91c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 12 12:31:28 2018 -0300

    Bug 20499: just check if GetItem returns something is enough
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32b6c50855166efbfbc21e08cb9f417577d29e44
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Mar 29 18:47:25 2018 +0000

    Bug 20499: Fix the Internal Server Error
    
    TEST PLAN
    ---------
    See comment #1
    
    Applying the test without the patch: messy.
    Applyin both patches: smooth.
    Run koha qa test tools
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c43af09eb4976e1790f601cd262d22b731a74ea0
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Mar 29 18:44:32 2018 +0000

    Bug 20499: Unit Test to prove the problem
    
    TEST PLAN
    ---------
    1) apply this patch
    2) prove t/db_dependent/Circulation.t
       -- horrible death.
    3) apply next path
    4) prove t/db_dependent/Circulation.t
       -- passes.
    5) run koha qa test tools
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a04fdbe609ddf1abe7a74a5046e0e517035ae38
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 13 11:47:47 2018 -0300

    Bug 7143: Update about page for new dev - Joachim Ganseman
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39be84754fd5cf4a1bd1f41ed901ad7fa59f8892
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Apr 10 18:30:09 2018 +0000

    Bug 17981: (QA follow-up) Fix and update pod in svc/letters/get
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c57ecd00ae312ad2464fbabeef9a7f2aa262cba5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 11 15:55:04 2018 -0300

    Bug 17981: Do not crash if the template is already using TT syntax
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44041681e102c46693c512a34854db195e14997a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 15 12:50:32 2017 -0300

    Bug 17981: Remove uneeded module JS var
    
    As we only support CHECKIN and CHECKOUT for now, we do not need this
    module variable. It may be useful to re-add it later.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b44db114211fad704bdf80ae6e8f8471b57477d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 24 17:38:17 2017 +0100

    Bug 17981: Move the divs to the top of the modal
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9e23381f3f1b2b8ab7a3ad70aaf07dba2756c5e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 24 17:13:07 2017 +0100

    Bug 17981: Better error handling
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a236b684fdae8e0da83ca7263b948da971dfc849
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 24 13:31:30 2017 +0100

    Bug 17981: Add a preview mode for notice templates
    
    This patch is a first step to provide a preview mode for notice
    templates.
    
    CHECKIN, CHECKOUT and HOLD_SLIP are supported so far.
    Maybe more, but I have not tested yet and the interface will not allow
    you to generate the preview.
    
    The idea is to provide an idea of how will render the messages generated
    from a notice template.
    
    A new "Preview" button is added close to each textarea on the editing
    notice templates view.
    For each notice template code (letter_code), we will need some input
    data to produce the preview.
    
    For instance, for CHECKIN we need an barcode. From the barcode we
    can guess all the other data.
    For CHECKOUT we will need the borrowernumber and the barcode.
    Note that the way to enter the data for the preview is not really
    user-friendly, for CHECKOUT you will have to fill
    'borrowernumber|barcode', but the placeholder will help you to know how
    and what to fill.
    In the modal window, you will see 4 blocks:
    1/ the content of the letter (with the placeholds << >>)
    2/ the generated message (with the data filled)
    3/ if the letter contained historical syntax markers, the screen will
    try to generate a notice template using the TT syntax
    4/ the generated message from this TT syntax
    => You will be able to compare the 2 generated messages.
    
    What is the goal of this first patchset:
    - Show this first POC and get feedback from other developpers
    - Add a way to easily visualise the differences between the 2 syntaxes
    - Confort users with the TT syntax and the migration step from the
    historical syntax.
    
    I'd like to get opinions before going further.
    
    The possibilities:
    - Mock data to get fully working generated messages for any notice
    templates. For instance, for CHECKIN and CHECKOUT, the item is not
    checked in/out yet. So we cannot access the issue's information.
    (I have no idea how to do that)
    - Browse the data to get the ones we want to use for the preview (big).
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6155d98e0cf6193efd8224ace68e0755f678df6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 24 11:18:46 2017 +0100

    Bug 17981: Add a 'letter' param to GetPreparedLetter
    
    This will allow us to call GetPreparedLetter with a letter content that
    does not exist in the DB
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3f69fc1146b341878cacdb9bb6f67b42d84b658
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 24 10:09:26 2017 +0100

    Bug 17981: Move svc/letters to svc/letters/get
    
    To allow another script under svc/letters
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62c99195157829ce31e87f7b05eb294c297d43b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 2 12:56:21 2018 -0300

    Bug 20426: Fix default fund value when adding orders from iso2709 file
    
    A new bug has been highlighted since:
      commit b830349f45007629f141a9835e05b95f90ee4b92
      Bug 19453: Incorrect jQuery selector for fund drop down validation
    
    Prior to bug 19453 the check on the existence of the fund did not work
    as expected, no select with name='budget_code' existed and the error was
    never raised.
    Now it works but expect a fund to be selected for every record to
    import.
    This check must only be done if there is no default value selected.
    
    Test plan:
    - Create an order from a staged file
    - Do not select any funds
    => You must get a warning
    - Select a specific fund for some of the records
    => You must get a warning
    - Select a default fund in the last tab
    => You must not get a warning and the records must be imported and
    inserted with the correct fund
    
    Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4b558fc2242b0a10e30ad7ec57d2c1f9d66d1f5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 11 18:19:58 2018 +0000

    Bug 18904: (follow-up) Use Ctrl+Shift+L
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dff72d446e7aee4ef5ff180db29a51454625bebe
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Apr 9 12:55:38 2018 +0200

    Bug 18904: (QA follow-up) Do not put authid in searchbox of blinddetail
    
    Adding trivial test if subfield equals 9.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e5297efaaf9f5fd55d10e163ba275f4e04562ee
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 6 12:30:16 2018 +0000

    Bug 18904: (follow-up) Rebase onto 14769
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: simplified if-then-else around cur_field.setIndicator[12].
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db75d5bf035efa92ea0a70956a3abb258283b49c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 15 10:18:54 2018 +0000

    Bug 18904: (follow-up) Set indicators and correct js path
    
    TO test:
    1 - Have an authority with some indicators
    2 - Link a field in rancor to that authority
    3 - See that you get some indicators (same in unimarc, diff in marc21)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ad0a0fd9eecfc26d7456bcb9cf9fd0d6599249a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 27 11:17:09 2017 +0000

    Bug 18904: Remove debugging code
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7df1f9f8eb9ed16246964d94dd8a69b756b6551
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 20 10:23:49 2017 +0000

    Bug 18904: (follow-up) Retrieve subfield in the order they are stored
    
    Use subfields in the order they are stored.
    
    This patch removes use of an intermediate hash for storing values. Order
    of subfields as obtained from authority is now preserved.
    
    Also removes useless code that was intended to set $2 subfields
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5648b1b45fade82aa4dd5d8df6de7c29a0dd5bd5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 6 17:49:14 2017 +0000

    Bug 18904: (follow-up) Fix whitespace and don't use hardcoded path
    
    Fix whitespace/tabs
    use [% interface %] not intranet-tmpl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 297529c251a13bab5817c0fb4f9dd66708229eb1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 6 16:35:38 2017 +0000

    Bug 18904: Advanced editor - Rancor - Add authority support
    
    This patchset adds the ability to use the authorities search to select
    or clear fields in the advanced editor
    
    To test:
     1 - Open a record in the advanced cataloging editor
     2 - Press 'Ctrl+L' while in a field that shuold not be linked to
    authorities (300 for instance)
     3 - Nothing should happen
     4 - Try it in a field that should be linked
     5 - You should get the authorities pop-up
     6 - Values in pop-up should be populated from values in record (as
            appropriate for authority type)
     7 - Correct authority type should be selected ( PERSO_NAME for 100,
            TOPIC_TERM for 650, etc.)
     8 - Press 'Clear', field should be blanked
     9 - Search again and select an authority
    10 - Field should be correctly populated
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2057bc5ccd52564c846a47031f889c78b4506cd3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 10 14:50:16 2018 -0300

    Bug 14769: DBRev 17.12.00.029
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32fc3f9ed14df5cec9e13064c93959fce8dec69c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 12 08:54:34 2018 +0200

    Bug 14769: (QA follow-up) Remove global var $cached_indicators
    
    As requested by RM, this patch replaces using the global $cached_indicators
    by saving state temporarily during the (limited) lifetime of the object.
    
    Essentially this affects two places in code:
    [1] blinddetail-biblio-search.pl (loading auth record in editor)
    [2] AuthoritiesMarc::merge (merging authority into biblios)
    
    Concurrent runs of [1] and/or [2] together with a simultaneous pref change
    just in between could cause slight (hypothetical) side-effects.
    The current approach of keeping state in the object makes that a series of
    controlled_indicators calls during an immediate merge of one specific
    authority is not affected by a simultaneous pref change. So the same rules
    are applied to the set of attached biblio record for that authority.
    Note also that the cron job ignores a simultaneous pref change, since
    it reads from the unchanged L1 cache (yes, also hypothetical).
    
    Test plan:
    [1] Run t/Koha/Authority/ControlledIndicators.t
    [2] Run t/db_dependent/Authority/Merge.t
    [3] Run t/db_dependent/Koha/Authorities.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ea53c745632e3b45bcad2d2238e4b126a323231
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 9 12:18:10 2018 +0100

    Bug 14769: (Follow-up) Let blinddetail look at indicator values
    
    If the indicators are not controlled, blinddetail should not overwrite
    what the user already entered. Very strictly seen, we could say that it
    is outside the scope. But it is strongly related.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested with 100 and 600 in the cataloging editor.
    For 100 the second indicator should not be overwritten. For 600 it should.
    Also tested "ind2:" which should blank ind2.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49933cd449de64f4f546c929641f86550c00812f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 9 09:03:26 2018 +0100

    Bug 14769: (Follow-up) Reduce number of preference parses
    
    In sub merge the Koha::Authority object was already created, so it was kind
    of silly to recreate it each time with new.
    In Koha::Authority, the ControlledIndicators object can be saved in the
    object too for reuse during its life time. Similarly, we prevent repeated
    lookups for the reporting tag (via authority type).
    
    Test plan:
    [1] Run t/db_dependent/Authority/Merge.t
    [2] Run t/db_dependent/Koha/Authorities.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Limited benchmarking shows me a reduction of 11% on Merge.t and a
    reduction of 4% on Authorities.t when comparing with and without this
    last patch. The larger impact on Merge.t could be expected.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 420f8b01d4c5420cb6538b75c06c828f90fdaac0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 26 10:17:33 2018 +0100

    Bug 14769: Put ControlledIndicators to work
    
    This patch does:
    [1] Adds Koha::Authority->controlled_indicators (with a test).
    [2] Adds a call to controlled_indicators in AuthoritiesMarc::merge.
        Unit test Merge.t is extended too.
    [3] Simplifies the code in authorities/blinddetail-biblio-search.pl by
        calling controlled_indicators.
    
    Test plan:
    [1] Run t/db_dependent/Koha/Authorities.t
    [2] Run t/db_dependent/Authority/Merge.t
    [3] Steps 3 to 7 for MARC21:
        Create a PERSO_NAME authority with 008/11=r and ind1=3
    [4] Edit a biblio and add a 600 linked to the new authority.
    [5] Verify that the biblio has ind1==3 and ind2==7 and $2==aat.
        (If $2 is not visible, check the metadata in biblio_metadata.)
    [6] Edit the PERSO_NAME authority and change 008/11 to '|' (bar).
    [7] Verify that merge updated your biblio record: $ind2==4 and $2 gone.
    [8] UNIMARC: Follow the pattern from steps 3 to 7.
        Create authority, link it in a biblio, check indicators (they should
        be copied both). Edit authority, change indicators and verify the
        merge results in the biblio record.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested PERSO_NAME and UNIF_TITLE.
    For UNIF_TITLE the second authority indicator is copied to ind1 or ind2,
    depending on the biblio tag involved.
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73c905300646c20a0c3c5bbe1a728cd29602f87f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Feb 8 12:59:08 2018 +0100

    Bug 14769: Add preference AuthorityControlledIndicators
    
    Including:
    
    [1] Atomic update to add pref for existing installs
    [2] Add new pref to sysprefs.sql for new installs
    [3] Add description to authorities preference file.
    
    Test plan:
    [1] Run new install or upgrade to add pref.
    [2] Check value of pref via System preferences in staff interface.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eae628e22d240df705a9b608a778fe6a1b21a586
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Feb 6 16:47:12 2018 +0100

    Bug 14769: Add tests for _thesaurus_info in ControlledIndicators.t
    
    Apart from adding tests for this sub, we make the following change
    too and support it with a test.
    
    The fallback to $code in the construction
        $thes_mapping{ $code } // $code // '4'
    is removed by this patch. When $code is not in $thes_mapping, we cannot
    assume that it is a valid code for a biblio indicator. In this case it is
    more safe to mark it as 4 (Source not specified).
    
    Test plan:
    Run t/Koha/Authority/ControlledIndicators.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2a9c6d540b38039d17636adf9c00c0cd2b0f422
Author: Janusz Kaczmarek <januszop@gmail.com>
Date:   Fri Nov 24 22:21:48 2017 +0100

    Bug 14769: Biblio indicators based on authority's thesaurus code
    
    Original patch from Janusz Kaczmarek on November 24, 2017.
    Amended by Marcel de Rooy on February 6, 2018.
    Code moved from AuthoritiesMarc.pm to ControlledIndicators.pm.
    
    Special attention has been paid to the proper application of 008/11
    while controlling 6XX in MARC 21, specially if 008/11 =~ /[rsz]/
    (and if it is 'z' and 040 $f is defined).
    
    Test plan:
    See next patch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    The construction $thes_mapping{ $code } // $code // '4' will still get
    some attention on a follow-up.
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bfa57165e1df549a56d661808efcb5144f970ef
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 26 11:06:59 2018 +0100

    Bug 14769: Introduce Koha::Authority::ControlledIndicators
    
    This module reads its settings from pref AuthorityControlledIndicators.
    The get method allows you to retrieve indicator values for specific
    biblio fields.
    
    Test plan:
    Run t/Koha/Authority/ControlledIndicators.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Added a test to show that "ind1:" returns empty string.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa4d328a3bbe1971a3c4aec9adf8468ce4dbb5c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 12 10:48:17 2018 -0300

    Bug 9701: DBRev 17.12.00.028
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a58a5cca2c1881ac0fdf54c06cab7314d7981e1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Apr 9 09:08:59 2018 +0200

    Bug 9701: (QA follow-up) DBIx schema changes
    
    Changes in MarcTagStructure.pm
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2e9d0d8951ecaffba2f055a4df588468951a09f
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Feb 19 10:36:04 2018 +0000

    Bug 9701: (follow-up) Adjust tests
    
    Test plan:
    
    prove t/db_dependent/Biblio.t
    should be green
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 031604f59bc92d68a0cc439d4ddc8b6d9a9660f4
Author: Joachim Ganseman <joachim.ganseman@student.ua.ac.be>
Date:   Sat Jun 4 12:58:36 2016 +0000

    Bug 9701: Configure default indicator
    
    This patch adds the possibility to define default indicators in
    the MARC frameworks. It adds 2 columns in the marc_tag_structure table in
    the database in order to accomplish this. All files that reference this
    table have also been updated to reflect these added fields.
    
    Test: Add or edit a MARC framework. In the Field list should be 2 extra
    columns. It should be possible to add default indicators (1 character)
        in these fields. Nothing else should have changed in the meantime.
        The default indicator values are not yet visible in the cataloguing module.
    
    The default values are also loaded in the cataloguing form.
    
    Test: Define default values in some MARC framework. Go to cataloguing
    and create a new record using this framework. Verify that the defined
    defaults are visible when set. Verify the default is empty (as before)
        if no default was set. Verify that if the default is changed, the
        record is saved with the manually changed value. Verify that upon
        changing such a new record, the manually set indicator value is used
        and not the default one from the framework.
    
    Don't forget to run database and database schema update
    
    Signed-off-by: Eugene Jose Espinoza <eugenegf@yahoo.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8012cc5ebdd2439791d87c11bce22134d1e76533
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 23 13:45:09 2018 -0300

    Bug 19936: Reuse existing userid if none provided
    
    Found this regression when working on other patches:
    If you edit a patron and blank the userid field, it will be regenerated
    with an incremented value (firstname.surname will be firstname.surname1)
    
    This is because we use a non-existing patron and ->in_storage in
    has_valid_userid is always false.
    The trick here is to backup the value, generate the userid, then reset
    userid to the previous value.
    
    As the POD says, it will be fix later, when AddMember and ModMember will
    be replaced with Koha::Patron->store
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c252ab6a878cc97da97739b0fb5434692e12bb4b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 21 16:10:30 2018 -0300

    Bug 19936: Replace Check_userid - Update the occurrences
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36c4d1441d216f25e69fe9bb9e29d92d103a6b45
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 10:33:25 2018 -0300

    Bug 19936: Remove warnings from tests
    
    C4::Members did not "use warnings;"
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bebf7d17c9e6b12c5d0abe7253cea26f046311bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 10:27:34 2018 -0300

    Bug 19936: Remove the subroutine Generate_Userid
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b1d08df0f4f69c52826c80a13158245287f4c00
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 18:44:25 2018 -0300

    Bug 19936: Replace Generate_Userid - Update the occurrences
    
    Test plan:
    Same test plan as previous patch:
    add/update/import patrons and watch the userid
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81819184fcff96e71025f1a3be7f653e8f8b822d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 18:48:49 2018 -0300

    Bug 19936: Adapt tests
    
    And prove that we are not cheating
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e80f4d81e942d59075fb47906174c00e9220d9c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 18:44:56 2018 -0300

    Bug 19936: Add the Koha::Patron->generate_userid method
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3efdeb2db89f49b73930cf53cbf2e8e658c3215
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 18:35:58 2018 -0300

    Bug 19936: Move and add tests for Generate_Userid
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4db544aa5c2994a8e5ff14a8cfaad53e95a217d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 18:05:29 2018 -0300

    Bug 19936: Remove the subroutine Check_Userid
    
    It is no longer in user, we can remove it.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd147a38323bb810f85c41134abfc894b0ac8e60
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 18:04:56 2018 -0300

    Bug 19936: Replace Check_userid - Update the occurrences
    
    We previously prove that the method and the subroutine were equivalent,
    we know update the controller calls.
    
    Test plan:
    - Add and update a patron with different variations of userid
    (automatically generated or not)
    - Import patrons with and without userid, as well as with existing
    userid
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de3a15c0a80fe6946827a80ca8e4ffd64078625e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 17:50:48 2018 -0300

    Bug 19936: Add the Koha::Patron->has_valid_userid method
    
    Reuse how C4::Members::Check_Userid works and adapt it to write
    Koha::Patron->check_userid
    Adapt the tests to use this new method.
    The tests still pass, we can adapt the different callers
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db274061c25c9ec48cf555f54bc63d42ebe546ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 17:14:49 2018 -0300

    Bug 19936: Replace Check_userid - just move the tests
    
    This patch moves the tests related to Check_userid out of Members.t
    The tests must pass with only this patch applied
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5229fd68b13e69b47349e9b5c986a6243ee69c6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 11 18:08:56 2018 -0300

    Bug 20123: (follow-up) Mock timezone in t/Auth_with_shibboleth.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9b824559d336150afb27836c2c8e36ca3ad4900
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Apr 10 16:31:44 2018 +0200

    Bug 19904: (follow-up) Add Nick Clemens as RM assistant
    
    See comments on Bugzilla report and wiki roles page for 18.05.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e41df9101667304a09da007e7ef1104c4fdfeb6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Apr 9 14:29:40 2018 +0200

    Bug 19904: Release team for 18.05
    
    First moved all relevant 17.11 release team entries to the development
    section, and then updated the release team section from the wiki 18.05
    roles page.
    
    Test plan:
    [1] Check if Koha team tab on about looks as it should.
    [2] Verify changes with 17.11 and 18.05 roles.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55abcbee5323b16071392cdc3f0dc38b0f1c3cfe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 11 16:50:37 2018 -0300

    Bug 19289: DBRev 17.12.00.027
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad2b04001fe3100a5caeafbbdd5ea56a6ff65e1a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 12:52:31 2018 -0300

    Bug 19289: (follow-up) Add existing fields to the ACQ framework
    
    Changes for other frameworks
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 198096ffab71ced1aa6ce453ee5c08fc43d0b5d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 6 17:15:34 2018 -0300

    Bug 19289: Extend size of inputs to 50
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30faa632e95362e0f80cf42f9fa37e96047e4a74
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 27 10:38:47 2018 -0300

    Bug 19289: Use copyrightdate instead of publicationyear for MARC21
    
    See comment 24
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 946d5bcdd2ccaefaba2596b8be1278781d1cc482
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 14:13:48 2018 -0300

    Bug 19289: Use jQuery validate plugin
    
    This is quite dirty but rewrite the JS checks is out of the scope of
    this bug report.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84ce1fb5921cdddf2368f0c330dede0f602742d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 13 17:35:11 2017 -0300

    Bug 19289: Use the ACQ framework to display bibliographic details
    
    The ACQ MARC framework is only used for the ‘Item’ block.
    This patch add the ability to define biblio fields (!= 995 or 952) to
    customize the display of the bibliographic details when ordering.
    
    This new feature is controlled by a new pref:
    UseACQFrameworkForBiblioRecords
    
    Test plan:
    - Create a new installation to populate the ACQ framework correctly
    - Set the pref UseACQFrameworkForBiblioRecords to "Use"
    - Create a new order
    => You will see the lib from the ACQ framework
    - Add/remove/update biblio subfields in the ACQ framework
    - Create a new order
    => You should see the new subfields displayed
    
    Note for QA: I though I would be able to refactor existing code to make
    it more flexible, but it is a bit messy and lost a lot of time. I
    finally decided to copy/paste the existing code. I simplified it as, I
    think, we do not want the plugin, etc. like in the full biblio editor.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d632da51c80f9c4215c6952793353803038d98d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 26 17:29:36 2017 -0300

    Bug 19289: Add existing fields to the ACQ framework
    
    When ordering, the bibliographic details contain the title, author,
    publisher code, publication year, isbn and series info.
    To avoid regression to provide the same behaviour, we will add these
    fields to the ACQ framework
    
    NOTE: This patch makes the change only for
      - en
      - fr / unimarc complet
    
    Other frameworks will be updated before to be pushed, to avoid
    unecessary rebases
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccc71f6cf13334d554cad74ae85df2e8be3e3649
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Apr 7 10:59:47 2018 +0200

    Bug 20540: (follow-up) Remove debug line
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc8f3dc1cc046ecd7d53349091fbba864dfb91c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 6 17:16:30 2018 -0300

    Bug 20540: Fix TransformHtmlToXml if last tag is empty
    
    This bug has been found during testing bug 19289.
    
    In some conditions C4::Biblio::TransformHtmlToXml will generate a malformed XML structure. The last </datafield> can be duplicated.
    
    For instance, if a call like:
    my $xml = TransformHtmlToXml( \@tags, \@subfields, \@field_values );
    
    with the last value of @field_values is empty, it will return:
    
    <?xml version="1.0" encoding="UTF-8"?>
    <collection
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd"
      xmlns="http://www.loc.gov/MARC21/slim">
    <record>
    <datafield2 tag="020" ind1=" " ind2=" ">
    <subfield code="a">l</subfield>
    </datafield>
    <datafield1 tag="100" ind1=" " ind2=" ">
    <subfield code="a">k</subfield>
    </datafield>
    <datafield1 tag="245" ind1=" " ind2=" ">
    <subfield code="a">k</subfield>
    </datafield>
    <datafield1 tag="250" ind1=" " ind2=" ">
    <subfield code="a">k</subfield>
    </datafield>
    <datafield1 tag="260" ind1=" " ind2=" ">
    <subfield code="b">k</subfield>
    <subfield code="c">k</subfield>
    </datafield>
    </datafield>
    </record>
    </collection>
    
    Which will result later in the following error:
    :23: parser error : Opening and ending tag mismatch: record line 6 and datafield
    </datafield>
                ^
    :24: parser error : Opening and ending tag mismatch: collection line 2 and record
    </record>
             ^
    :25: parser error : Extra content at the end of the document
    </collection>
    
    Test plan:
    You can test it along with bug 19289 and confirm that it fixes the problem
    raised on bug 19289 comment 30
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8b6fde9b7f59ba32f4726f55acb6f803c7816d6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 11 14:41:17 2017 +0200

    Bug 18625: (QA follow-up) Simplify update_lastseen
    
    No need to check the pref.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 654d8c0cfd6cd2643e2deed7bb18618ea740cace
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Thu May 18 15:59:49 2017 +0100

    Bug 18625: Update lastseen in patron info request
    
    Many services use SIP patron req info to validate a patron against
    the koha database. If recording lastseen sites will
    also want to record that the user has accessed these
    library facilities although they have not logged into koha
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Verified that Patron Info request (63) updates lastseen when the pref has
    been enabled.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e9c703d2bef25f7ada760952d3e070203376a05
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 27 02:23:22 2017 +0000

    Bug 18625: (QA follow-up) Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4218875ec039dc375124f969caea1624399c21a4
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Jan 30 19:53:32 2018 +0000

    Bug 20104: Update minimum version of Perl to 5.20
    
    This patch not only updates the version check, but repurposes
    the perlversion parameter, so as to not have to retranslate
    templates again when the version number changes after this.
    
    The changes are very self-evident.
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84d6c23eddf8744a61e06432b0f443753138d7f2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 6 10:22:20 2018 +0100

    Bug 20536: (ILL) authnotrequired should be explicitly unset on opac
    
    * koha/opac-illrequest.pl - Added explicit setting of authnotrequired
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd0469132cf5aee7fded7e69949b4e6e2e54694b
Author: Claire Gravely <claire.gravely@bsz-bw.de>
Date:   Tue Apr 10 12:46:11 2018 +0000

    Bug 20552: Fix HTML tag for search facets
    
    The tags for home library and holding library in the 'refine your
    search' list should be h5.
    
    This patch changes the html tag for the availability, holding library and home library
    facets.
    
    To test:
    - Search for an item in the OPAC where the relevant facet appears
    - Use 'Inspect element' to check the tag
    - Apply patch
    - Confirm the facet now has the h5 tag
    - Confirm spacing is improved
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 999f2ed7e9e56dda254308f9bbbc85dcc66a160c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 27 11:38:51 2017 +0000

    Bug 19538: Move EnableAdvancedCatalogingEdtor from 'Labs' to 'Cataloging'
    
    To test:
    1 - View sysprefs
    2 - Note 'Labs' tab
    3 - Note EnableAdvancedCatalogingEditor is the only pref there
    4 - Note that prefs works
    5 - Apply patch
    6 - Note 'Labs' tba is gone
    7 - Check the 'Cataloging' tab (under Interface)
    8 - There it is!
    9 - Verify it still works
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3b8f17395f05548c87129d286a3f49d0b171e0b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 4 16:33:34 2018 +0000

    Bug 20518: Don't show "Messages" header and link on patron details if there are no messages
    
    This patch modifies the patron detail page so that the "Messages" header
    is not displayed if there are no messages.
    
    Unrelated: A minor change was made to moremember.pl to quiet an error in
    the log, "Use of uninitialized value $print in string eq at
    members/moremember.pl line 219."
    
    To test, apply the patch and open the detail page for a patron who has
    no messages. There should be no "Messages" header or "add message" link.
    
    Add a message to the patron's account. The message should appear, along
    with the "Messages" header and "add message" link.
    
    The error logs should show no errors.
    
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8acf5912b3fd213b8bcb3e7ee9b47f7cb086002b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 15 14:11:29 2018 +0000

    Bug 9634: Allow for combining same paraneters in SQL reports
    
    This patch combines report paramters with the same name and data type
    (authorised value)
    
    This presereves the past ability to provide all parameters as
    'sql_params' in order to preserve existing public report links
    
    To test:
     1 - Create a report that takes multiple parameters, e.g.:
    SELECT <<cat>> AS one, <<dog|branches>> AS two, <<dog|YES_NO>> as three,
           <<cat>> as four, <<dog|branches>> as five
     2 - Run this report, note you are asked for five parameters
     3 - Apply patch
     4 - Update database
     5 - Run report, note you are asked for three params
     6 - Verify the results reflect the supplied parameters
     7 - Export the report and verify results
     8 - Alter the URL and provide 5 params as sql_params and no param_name
     variables i.e.
     http://localhost:8081/cgi-bin/koha/reports/guided_reports.pl?reports=1&phase=Run+this+report&sql_params=Banana&sql_params=CPL&sql_params=0&sql_params=Orange&sql_params=LPL
     9 - Verify results come out as expected. i.e. 5 different values that
           are those of the URL.
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a3d12e35e20766a2175c68f870a48058a25d6ec
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 11 15:47:01 2018 -0300

    Bug 18674: (QA follow-up) Add date and time
    
    This patch adds current date and time, formatted as configured.
    It makes the timezone name be displayed the system uses it (important
    for the 'local' use case).
    
    It removes some warnings too.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b068259521ebea158e8b664cfbab46d5a65495ff
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 5 16:29:23 2018 -0300

    Bug 18674: TZ error handling
    
    This patch adds C4::Context->timezone bad timezone handling.
    The calculated 'effective' timezone is tested with the right tool and a
    fallback to 'local' is added. A warning is printed in the logs.
    
    A test for this is added to about.pl too, along with the right warning
    messages in case of problems.
    
    Tests are added for both invalid TZ and to make sure the warning is
    raised.
    
    To test:
    - Apply the patch
    - Run:
      $ kshell
     k$ prove t/timezones.t
    => SUCCESS: All tests pass
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7513c70ef04f9326a8f726556788ea85c098ae60
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 4 20:49:07 2018 +0000

    Bug 18674: Style changes to match other entries
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b1a5cd640a69f6accb6e35eb02eebd35d8af338
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Apr 2 15:24:25 2018 -0400

    Bug 18674: Allow TZ SetEnv for plack
    
    It should also be noted that
        /etc/apache2/sites-enabled/{configuration file}
    should also contain:
        RequestHeader add X-Koha-SetEnv "TZ {timezone}"
    Where {timezone} is the desired instance timezone.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8ac2d38331872bc812f6ed32cf2fc5735a88bde
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Feb 26 15:00:54 2018 +0000

    Bug 18674: Added timezone information to about page
    
    Before patch: No timezone section
    After patch: timezone section at bottom of
                 Server information tab.
    
    Actual is what is being used. Config overrides environment variables.
    So if there is confusion why the environment variables aren't working,
    it will be visible why.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 015e7ee3331ededee37dd68a7e9743b93605b05a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 5 10:31:04 2018 -0300

    Bug 20123: Make the timezone entry empty and uncommented by default
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb35784d3cf9fc878859200bcab8f577583d8b07
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 9 09:26:13 2018 -0500

    Bug 20123: Add commented out example to koha-conf.xml
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fb700b81dac0e180d1acf24c50420b4f6939fd5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 27 12:10:59 2018 +0000

    Bug 20123: (QA follow-up) If tz is 'local', no need to tell database to set the timezone
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4cdf3e38afd608bcd0f8a1c7b6918d40ad84859f
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Feb 1 13:21:54 2018 -0500

    Bug 20123: Allow multiple instances of Koha to have different timezones on the same server
    
    Most of Koha depends on the local timezone of the server, except for Koha::Database which support an ENV override with the key TZ.
    
    We should take this a step further. We should not only accept the TZ environment variable for all of Koha, we should really be able to set the timezone in the koha conf file as well so we don't have to pass that environment variable to things like cronjobs and one-off scripts.
    
    Test Plan:
    1) Apply this patch
    2) Set a timzone in your koha_conf file, that is *not* your local time zone
       Available timzones are listed here: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
    3) Restart apache/plack
    4) Perform some actions, check the timestamps in the database and in the
       html output, note they are for the set timezone and not the local
       timezone.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33618eaec3eedf148a235d246e5ccc9ebc9ae7c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 10 13:08:43 2018 -0300

    Bug 20557: Prevent Koha/Acquisition/Order.t to fail randomly
    
    https://jenkins.koha-community.org/job/Koha_Master_D8/427/consoleFull
    
    t/db_dependent/Koha/Acquisition/Order.t .. 1/2         # No tests run!
    
        #   Failed test 'No tests run for subtest "entrydate"'
        #   at t/db_dependent/Koha/Acquisition/Order.t line 97.
        # Looks like you failed 1 test of 1.
    
     #   Failed test 'store'
     #   at t/db_dependent/Koha/Acquisition/Order.t line 99.
     Cannot insert order: Mandatory parameter quantity is missing at t/db_dependent/Koha/Acquisition/Order.t line 77.
     # Looks like your test exited with 255 just after 2.
    
    It happens when basket.is_standing is 0
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b00d4d9e4697528fcad7ce911a02e2fdddcf1c58
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 10 12:04:59 2018 -0300

    Bug 3841: (follow-up) Add the ACQ framework for pl-PL
    
    No idea why I missed pl-PL!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e6aca360f5b88d66745141495b474033b9c5167
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 17:43:41 2018 -0300

    Bug 19581: Fix Koha_Elasticsearch.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d7391dcf5a4d271d5aec63c299f8cc9236d050d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 17:39:35 2018 -0300

    Bug 19804: Fix test in maxsuspensiondays.t
    
    We do not want a random value of suspension_chargeperiod from
    TestBuilder
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f32cf00e132c747a008163e5f40810d4a47bff58
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 17:33:37 2018 -0300

    Bug 19804: Fix test in GetHardDueDate.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe4846d0017e17fefe3c134d30d4230a3864be4e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 16:14:23 2018 -0300

    Bug 19804: DBRev 17.12.00.026
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a73aa7c23231a582464f609bdf100ccbec2d714e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 4 17:36:28 2018 -0300

    Bug 19804: (follow-up) Fix wording and columns order
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ee536c715f90262c344b2afc9a9456382c858b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 13 18:05:50 2017 -0300

    Bug 19804: Add the new column to the circ rules interface
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e1fe25748f4454b52170f37d19cdb26a819e517
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 13 16:57:40 2017 -0300

    Bug 19804: Add a 'Fine charging interval' for suspension days
    
    We already have a chargeperiod (Fine charging interval) value which is
    taken into account for fine ($) for not for the suspension period.
    
    This patch adds a new column suspension_chargeperiod (Fine day charging
    interval) to add the same behaviour when a suspension is calculated.
    
    Test plan:
    Add overdue item and play with the circulation rules (and the calendar).
    The suspension period must be correctly calculated.
    Please provide the different tests you made.
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff3ca4a489ce5ba16c732e477b1829552c4ccbe8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 13 16:56:57 2017 -0300

    Bug 19804: DBIC Schema changes
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4d39fd00f38aeb05d01d0df84ac1a5b47036347
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 13 16:56:38 2017 -0300

    Bug 19804: Add new DB column issuingrules.suspension_chargeperiod
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49c289eb1f747da7530fa93e43760afcfcf016f0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 16 09:03:46 2018 +0000

    Bug 19581: (follow-up) Fix handling of new and old arrays for auth compat
    
    Stolen from bug 20244
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6dfff20145b90a58747d7daccd2bf1abe233da11
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 13 09:32:04 2018 +0000

    Bug 19581: Remove unused comment and line
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc8879ce4332401eae248ccf8998298b6a1ece7c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sun Nov 5 01:47:49 2017 +0000

    Bug 19581: Unit tests
    
    This patch makes a few changes to the tests to take into account the
    change to indexing.
    
    To test:
    prove t/db_dependent/Koha_Elasticsearch_Indexer.t
    Should return green
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec0ea67a43455b94a9d8bd3cf4ba8f68d1678e4a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sun Nov 5 01:51:39 2017 +0000

    Bug 19581: Remove 'split' option from Catmandu fixes for marc
    
    This option in combination with append seems to add null entries in the indexes
    for fields that don't exist. These fields then affect sorting. Removing it solves
    the issue
    
    To test:
    1 - Have an ES setup
    2 - Catalog and index some records
    3 - View a record in ES:
        curl 'localhost:9200/koha_kohadev_biblios/data/4?pretty=yes'
    4 - Note there are 'null' entries in the indexes, save this result for
    comparison
    5 - Apply patch
    6 - Reindex, amking sure to delete existing indexes
        perl misc/search_tools/rebuild_elastic_search.pl -d
    7 - View the record again
    8 - Note the null entries are removed
    9 - Note indices are otherwise intact
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0798dcb0baef1cb2bd391188b49fee3ff270370a
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Apr 6 14:59:28 2018 +0000

    Bug 20122: Explicitly set path to fix emptying cart functionality
    
    This is caused by bib_list not being deleted.
    The path was not explicitly set.
    This patch adds path=/ explicitly to ensure it
    does get deleted.
    
    TEST PLAN
    ---------
    1) search for 'the' in OPAC
    2) add several items to cart.
    3) look at your cart.
    4) empty and close the cart, select all->remove
       -- either way window closes and it looks empty.
    5) refresh the page
       -- cart comes back.
       -- in chromium inspecting the page, specifically
          the "Application" area, bib_list is shown as
          a cookie still.
    6) apply patch
    7) restart_all and empty cache forcing JS reload
    8) repeat steps 1-5
       -- this time cart stays empty.
       -- and the bib_list cookie is gone
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com> using firefox 59.0.2
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad37e87b0af454086a08adb97060552ccf1aaa9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 7 12:26:53 2018 -0300

    Bug 20180: [sql_modes] Remove GROUP BY clause in manage-marc-import.pl
    
    Replaced with a distinct.
    
    Fix for:
    'koha_kohadev.me.frameworktext' isn't in GROUP BY
    
    t/db_dependent/www/search_utf8.t
    
    NOTE: I added a [% frameworks.count %] into the template file,
          and compared master and a branch with this applied when
          managing a staged marc import. Values were identical.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e220e0d8f107cce63f32bfaa1919c04b4dea6e2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 11:04:50 2018 -0300

    Bug 20179: [sql_modes] Remove GROUP BY in get_shelves_containing_record
    
    Replaced with distinct.
    Fix for:
    'koha_kohadev.me.shelfname' isn't in GROUP BY
    
    t/db_dependent/Virtualshelves.t
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76eb3a0549efe4c1f1557071a6cb4b33d4bd3e4d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 9 15:59:32 2018 -0300

    Bug 18789: (follow-up) Pass a Koha::Patron object from returns.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2cccbd2314ea1832dae4c1c4ba738fa5c3510d2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 6 14:08:40 2018 -0300

    Bug 20298: (follow-up) fix labels' for attributes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14c702bee5362654c8779b8b4a33a0d679ee6a6e
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Mar 29 07:11:40 2018 -0400

    Bug 20181: (QA follow-up) Remove double check
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f50a6ece8386058a5778d46458821064412c5f01
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Tue Feb 13 14:08:25 2018 -0500

    Bug 20181: Add POD for new plugin
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9755c34938c42411e4a7e5d897af7335eca6bc13
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Feb 13 18:50:02 2018 +0000

    Bug 20181: (follow-up) Ensure test runs
    
    If EnablePlugins was 0, this test before this patch fails.
    After this patch, it passes.
    
    TEST PLAN
    ---------
    1) Apply all but this patch
    2) Run the following commands
        kshell
        prove t/Koha_Template_Plugin_KohaPlugins.t
       -- two tests fail, if you have the conf or syspref set to 0.
    3) Apply this patch
    4) Repeat step 2.
       -- all tests pass, including the positive and negative case checks.
    5) run koha qa test tools
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98164dc43209af9964b84e83f2ee8f0ff7491a35
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Mon Feb 12 11:15:47 2018 -0500

    Bug 20181: Unit tests
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8fbe51ff33760b0446339b44047229be9e9f1a8
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Mon Feb 12 09:09:20 2018 -0500

    Bug 20181: Allow plugins to add css and javascript to OPAC
    
    A number of Koha plugins have been written that enhance Koha's public catalog. These plugins often make due to adding css and javascript to the various opac system preferences. It would be nice if the plugin system had hooks so plugin developers could add code the the head block and the area where we include javascript in the opac template.
    
    Test Plan:
    1) Apply this patch
    2) Download and install the Kitchen Sink plugin ( v2.1.12 or later )
       https://github.com/bywatersolutions/koha-plugin-kitchen-sink/releases/download/v2.1.12/koha-plugin-kitchen-sink-v2.1.12.kpz
    3) Install the plugin
    4) Restart all the things if you can ( restart_all if you are using kohadevbox )
       This will ensure the plugin takes effect right away, it should be
       necessary but it won't hurt anything!
    5) Load the opac, notice you get an alert message and the background
       for your opac is now orange ( assuming you've not customized the
       opac in any way )
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28e980a25d02ea48609d3ec2ab025034a05ecc4b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 6 08:05:58 2018 +0200

    Bug 18816: (QA follow-up) Fix Circulation.t
    
    Resolve:
    ok 33 - Can renew, item is marked not for loan, hold does not block
    Can't use string ("1") as a HASH ref while "strict refs" in use at /usr/share/koha/devclone/C4/Items.pm line 557.
    
    Trivial fix. Remove fourth parameter.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cbb62feb036317ff47122b5da60be088330f0136
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 6 07:57:32 2018 +0200

    Bug 18816: (QA follow-up) Framework parameter is not needed
    
    $frameworkcode is not used in ModItem (no need to pass it in
    ModItemFromMarc).
    $dbh is not used in ModItem.
    
    Test plan:
    Run t/db_dependent/Items.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db348f67f36c0849b2057a598bbbcc30deebd8bc
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 23 07:04:57 2018 -0400

    Bug 18816: (QA follow-up) Add rarely used params to hashref, remove param
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a71e1df9858d55dddbeff6b31f60426e086570c
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Mar 22 06:43:44 2018 -0400

    Bug 18816: (QA follow-up) Convert param to hashref, fix typo
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b711ea638afc21ed93c6b7350e0d58d11f7e962b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jun 16 08:27:29 2017 -0400

    Bug 18816: Make CataloguingLog work in production by preventing circulation from spamming the log
    
    The system preference CataloguingLog is not recommended for use in
    production. This is do to the fact that every checkin and checkout
    generates one or more log entires. This seems to be not only bad
    behavior, but unnecessary and outside the needs of CataloguingLog as we
    have CirculationLog.
    
    Test Plan:
    1) Log into staff client
    2) Home -> Koha administration -> Global system preferences -> Logs
    3) Set only CataloguingLog to 'Log', everything else to "Don't log"
    4) Click 'Save all Logging preferences'
    5) In MySQL, use your instance DB, and then type 'delete from action_logs;'
    6) Have a person checkout and checkin anything.
    7) In MySQL, 'select * from action_logs;'
       -- there will be data. This is the floodiness that will be removed.
    8) Apply this patch
    9) Repeat steps 5-7
       -- there should be no data.
    10) Edit any biblio or item.
    11) In MySQL, 'select * from action_logs;'
        -- there should be data reflecting the changes made.
    12) run koha qa test tools
    
    NOTE: Improved clarity of test plan -- Mark Tompsett
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a71836f07db418e5c82b5cd55882a1e4d34c732d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 5 13:59:18 2018 +0000

    Bug 20526: Show and sort by date of request in pending discharges table
    
    This patch adds a "date requested" column to the table of pending
    discharges, and updates the DataTables configuration to sort by this
    column by default.
    
    The patch also makes some other changes:
    
    - Table information and filtering have been added.
    - The "Allow" link has been converted to a Bootstrap-styled buttong with
      an icon.
    
    To test, apply the patch and view the table of pending discharge
    requests. It should be sorted by default by date requested.
    
    - Confirm that date sorting is correct.
    - Confirm that other columns still sort correctly.
    - Confirm that buttons look right.
    - Confirm that the table information is correct.
    - Confirm that the table search form works.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa2cb3ffbb277fbbe6c7b8f17aa04a67c1996ac2
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 5 13:14:39 2018 +0200

    Bug 20524: Make columns of pending discharges table sortable
    
    Test plan:
    1. Enable syspref useDischarge
    2. Login to OPAC and ask for a discharge (tab on the left)
    3. Login to OPAC with another borrower from another library and ask for
       a discharge
    4. Login to intranet, you should see a message about pending discharges,
       and a link. Click on the link.
    5. Confirm that the Patron column is sortable and the Allow column is
       not
    6. (Optional) You can apply bug 20516 and confirm that the Library
       column is sortable too
    
    Signed-off-by: Axelle Clarisse <axelle.clarisse@univ-amu.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 509ab2c0ee5852824d2db8aa9c44a57fde629655
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 23 07:28:47 2018 -0400

    Bug 11512: Update syspref description
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d1b491a799f4ca42cbe46809811539897647f8f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 26 07:40:04 2017 -0400

    Bug 11512: Forced holds that violate issuing rules will never be filled
    
    Currently in Koha, if you choose to force a hold from the staff side that would contravened the current issuing rules, that hold will never be filled, as it is always skipped over by CheckReserves.
    
    This patch disallows overrideing except for tooManyReserves which are the only overridden holds that will be trapped.
    
    Test Plan:
    1) Apply this patch
    2) Attempt to override hold placement, only placements where the patron has too many holds already should be allowed
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f46ead631325dc86e7ff15344095b8b845cff7f3
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jan 19 01:56:17 2018 +0000

    Bug 19712: (follow-up) Add missing use Pod::Usage
    
    pod2usage call failed otherwise.
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcf2b798fd985bfb87809dcbe04eadfd409714b3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 19:10:44 2017 -0300

    Bug 19712: Fix test mode for delete_records_via_leader.pl
    
    Test plan:
    perl misc/cronjobs/delete_records_via_leader.pl
    => Should display a warning
    perl misc/cronjobs/delete_records_via_leader.pl --test
    => Should not display a warning and script should not apply changes
    perl misc/cronjobs/delete_records_via_leader.pl --confirm
    => Should not display a warning and script should apply changes
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69f71ca2bf3e3c6a6a07cb97f88681c86c7d11b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 29 10:39:08 2018 -0300

    Bug 20446: Fix Edifact quotes processing
    
    Caused by
      commit 04aea91de0f2fe1103e4021f880d135da1fd11a9
      Bug 15685: (QA follow-up) Address QA issues
    
    ->find is called on Koha::Object instead of the set class (Koha::Objects)
    and raises the following error:
    Can't use string ("Koha::Acquisition::Basket") as a HASH ref while
    "strict refs" in use at /usr/share/koha/lib/Koha/Object.pm line 275.
    
    This patch also makes sure $basketno refers to an existing basket in DB
    
    I cannot provide a test plan, I have no idea how this code is used.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45b1dee67e5fd771adbb30e9cac352b8a0c6ab40
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 5 16:46:38 2018 -0300

    Bug 20531: Prevent IssueSlip.t to fail randomly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a10b66205dc93d9b9773703008ebcb412b711bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 5 14:13:37 2018 -0300

    Bug 20530: Remove trailing ':' in columns_settings.yml
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 754994a90b0050539174e83c065080dd10a53bbd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 7 15:39:49 2018 +0000

    Bug 20350: Add column configuration to table of saved reports
    
    This patch makes changes to the saved reports template to enable a
    columns configuration button. Settings for the table have been added to
    columns_settings.yml.
    
    To test, apply the patch and go to Reports -> Use saved.
    
     - Confirm that there is a "Column visibility" button in the
       table's pagination toolbar.
     - Confirm that showing and hiding columns via the button is working
       correctly.
     - Confirm that the first, second, and last columns cannot be toggled.
    
    Go to Administration -> Columns settings.
    
    - Expand the "Reports" section.
    - Find "id=table_reports."
    - Make some selections to configure default settings of the reports
      table.
    - Return to reports and confirm that these defaults are applied.
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2fcaac302fc544ba1c3b64eec9a649e72d3d58b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Apr 4 14:08:37 2018 +0200

    Bug 20516: Show patron's library in pending discharges table
    
    Test plan:
    1. Enable syspref useDischarge
    2. Login to OPAC and ask for a discharge (tab on the left)
    3. Login to intranet, you should see a message about pending discharges,
       and a link. Click on the link.
    4. Confirm that there is a 'Library' column in the table that is
       displaying the patron's library
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61d51c9b11fb10af24e134201984ea759ac4fa52
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Apr 3 08:24:56 2018 +0200

    Bug 20510: Remove unused sub TotalPaid from C4::Stats
    
    Test plan:
    0) Do not apply the patch
    1) Run git grep TotalPaid and confirm it is only defined and then used once in a test
    2) Apply the patch
    3) git grep TotalPaid should return nothing
    4) prove t/db_dependent/Stats.t should be green
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ac8e52f61223d44dfbb5a7ad8933c0ba674ca8a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jun 19 19:40:39 2017 +0000

    Bug 18825: Elasticsearch - Update heading main-heading and see fields
    
    Signed-off-by: Ere Maijala <ere.maijala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bfad6106aec007ac4bcf17d00f72b5508c4895d
Author: Alex Arnaud <alex.arnaud@gmail.com>
Date:   Wed Mar 28 09:03:56 2018 +0000

    Bug 20261: Fix pagination of the results in authority search
    
    Test plan:
    
      - apply this patch,
      - do a search that return more than 20 results,
      - click on page 2,
      - check that you get results,
      - check other pages if possible
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 199c2f33d93a33bb56d422a6abdeb334fd988faf
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Mon Mar 12 16:12:20 2018 +0000

    Bug 17373: Add mappings for unimarc authorities - Match index
    
    Test plan:
    
    1. apply patches
    
    2. switch  SearchEngine syspref to ElasticSearch
    
    3. load new mapping
    (admin/searchengine/elasticsearch/mappings.pl?op=reset&i_know_what_i_am_doing=1)
    
    4. load some unimarc authorities like the sample attached to bug 17373
    
    5. reindex authorities
    (./misc/search_tools/rebuild_elastic_search.pl -d -a -v)
    
    6. search entire notice for shalev or שלו
    
    7. you should find stuff
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6271f6c1374ac2dad573ae6784d1632d626b14be
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Oct 13 09:45:40 2016 +0200

    Bug 17373: Elasticsearch - Authority mappings for UNIMARC - patch1
    
    This patch starts the UNIMARC mapping for ES.
    It is needed to test.
    More patches will come.
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5fd79222dedacd13d9a06aa7ab27f07b585f1a4
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Apr 5 06:12:44 2018 -0400

    Bug 20325: Remove warning, it is no longer true
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 328d5e7007a8abedf3f8ba679eee910e8ae41d9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 4 15:36:46 2018 -0300

    Bug 20325: Do not remove accountlines between tests
    
    This is part of the tests, to make sure they have not been deleted
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 373b2f747bb5d67302ae1aa6567b8b593a39d9e9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 4 15:19:54 2018 -0300

    Bug 20325: Move tests to a subtest
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27a21083d9878f029f01fcc7256fa116ee15dc28
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Tue Mar 27 15:16:16 2018 -0400

    Bug 20325: C4::Accounts::purge_zero_balance_fees does not check account_offsets
    
    purge_zero_balance_fees is used in cleanup_database.pl to determine which fees can be cleaned up.
    
    It uses a simple SQL query to determine which rows in accountlines need to be removed:
    
    463     my $sth = $dbh->prepare(
    464         q{
    465             DELETE FROM accountlines
    466             WHERE date < date_sub(curdate(), INTERVAL ? DAY)
    467               AND ( amountoutstanding = 0 or amountoutstanding IS NULL );
    468         }
    
    The function comes with the following warning:
    
    451 B<Warning:> Because fines and payments are not linked in accountlines, it is
    452 possible for a fine to be deleted without the accompanying payment,
    453 or vise versa. This won't affect the account balance, but might be
    454 confusing to staff.
    
    This was a reasonable solution prior to the addition of account_offsets in 17.11. The problem now is that rows in accountlines which are linked as credits in accountlines will *always* have amountoutstanding marked as 0. These are linked to debits via account_offsets. purge_zero_balance_fees will delete credits and leave rows in account_offsets which link to deleted credits.
    
    Sites using the --fees option cleanup_database.pl which upgrade to 17.11 may have all of their credits removed without warning.
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/Accounts.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aaea46594215c88b4459cd882f1d869faeb2e2d8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 5 10:06:37 2018 -0300

    Bug 20191: (QA follow-up) Require Jessie's Test::MockTime
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b76ad51b9d45d67746bddf27a9376e810c1b2d1e
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Apr 5 01:31:38 2018 +0000

    Bug 20191: Use Test::MockTime to hold time still
    
    The problem is the calls to HTTP::OAI::Header, etc.
    may reference gmtime which is continually changing by
    the second. By forcing time to lock for all the tests,
    except the last one, we can be assured things should
    not fail.
    
    TEST PLAN
    ---------
    install libtest-mocktime-perl
    apply the patch
    restart_all
    in kshell, prove t/db_dependent/OAI/Server.t
    run koha qa test tools
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3f9b750e22b87f6f699bf608cc90fa91cd1ef58
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri Jan 5 15:03:38 2018 +0100

    Bug 19953: Record page: acquisition details: add column for invoice
    
    Test plan:
    1. create a vendor with minimal info
    2. create a basket with minimal info
    3. add a item to the basket
    4. close the basket
    5. receive a shipment
    6. on the "receipt summary" click on "receive" for the wanted item (it
       should be the only one)
    7. items → receive? → tick this checkbox
    8. save
    9. click on "finish receiving"
    10. go to the record → Acquisition details
    11. apply this patch
    12. refresh the page
    13. you should see the new column
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18e02913a0eaf0b94421027dbcfc0965499b15a8
Author: Jesse Weaver <jweaver@bywatersolutions.com>
Date:   Mon Jul 18 16:31:20 2016 -0600

    Bug 19267: Rancor - Warn before leaving page if record modified
    
    To test:
    1 - Open the advanced editor
    2 - Make some changes to a record
    3 - Click on 'Patrons' or leave the page in some way
    4 - Note there is no warning and changes are not saved
    5 - Apply patch
    6 - Open the advanced editor
    7 - Make some changes
    8 - Leave the page
    9 - Note you get a warning of unsaved changes and can stay on the page
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36db911da09f83131f82db6f8ed50ec1ad2f0029
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 14 07:03:39 2017 -0500

    Bug 19812: Fix confusing holds count values in "Already received" table
    
    In acqui/parcel.pl both the "Pending orders" and "Already received" tables show how many holds there are for the given record. However, the count of holds in the "Pending orders" table confuses librarians because it only lists holds for the particular items in the orderline. Due to that, the holds column may show 0 holds even if there are a dozen record level holds for that bib! This is not what librarians seem to expect, instead it seems that the same total holds in the "Pending orders" table would be preferred.
    
    Test Plan:
    1) Find an invoice with an item in the "Already received" table
    2) Add one or more record level holds to the record
    3) Note the holds column does not count those holds
    4) Apply this patch
    5) Note the holds column now shows total holds and holds for just those ordered items
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nancy Keener <nkeener@washoecounty.us>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 19812: (QA follow-up) Swap sides for total and item holds
    
    Bug 19812: (QA follow-up) If 0 holds show '0' not '0 / 0'
    
    Bug 19812: (QA follow-up) Remove unnecessary line
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65b71667c0bdef7e4fb04e4a747c99af2bcf2e5d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 4 15:54:58 2018 -0300

    Bug 19910: Use span to make translators happy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6611ad4f05f8b236842940189ecd5ded88dc3d85
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 3 14:07:17 2018 +0000

    Bug 19910: Use the delimiter syspref to name download link
    
    To test:
    1 - Set delimiter syspref to anything but comma
    2 - Download report results as comma separated text
    3 - They actually follow the syspref
    4 - Apply patch
    5 - Download link should now match pref selection
    6 - Change pref, note link changes
    7 - Verify things still work as expected
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2214f2b256e0a44e0936d3eb8e87ac02b40917e
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Jan 17 14:30:06 2018 -0500

    Bug 20008: Fix restrictions added from memberentry.pl if TimeFormat is 12hr
    
    Test Plan:
    1) Set TimeFormat to 12 hour
    2) Add a restriction with an expiration date via memberentry.pl
    3) Note the restriction exists, but has no expiration date
    4) Apply this patch
    5) Repeat step 2
    6) Note the restriction exists and has an expiration date!
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 195f5404e4fc665f95e3f686494e7e0f298e27e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 29 12:14:11 2018 -0300

    Bug 20115: Add information about this feature in the pref descriptions
    
    I guess a native English speaker will have a better wording :)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4376db33b5acbc49ebdfe3e98afa9f1126634934
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 11:42:22 2018 -0300

    Bug 20115: Remove sort on rfc4646_subtag in OPAC templates
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d407221be6ec07b8323935370fe07b5ff4dc9d80
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 31 14:06:23 2018 -0300

    Bug 20115: Trigger "modified" when sort is changed
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32c562bbe0383fe50a65aed7a18f82336e6d53c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 31 13:47:46 2018 -0300

    Bug 20115: Make the prefs sortable
    
    If we depend on the order, we should make it sortable.
    
    I let the customization to someone else (we would need an icon to tell
    the user it's sortable).
    
    Something does not work here:
    If fr-FR and fr-CA is installed, but only 1 is ticked, it will be
    considered as last. I do not think it's a blocker as it does not make
    really make sense to have it installed but not used (the interface is
    also weird, there is a dropdown list with only 1 entry)
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c45246053639c216b598385a2f89cf723277a3c5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 31 13:47:37 2018 -0300

    Bug 20115: Set the languages order with the pref values
    
    To avoid the languages to be ordered randomly, it is better to stick on
    a default order.
    Let's suppose that the order in the pref is correct.
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1f2c84e5078c2aa77e428ca359aef4df952944a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 6 15:35:50 2017 -0300

    Bug 19578: Remove MARC punctuation in notices (TT syntax)
    
    Jenkins fails (run 287) on a test in t/db_dependent/Letters/TemplateToolkit.t:
    
    With the historical syntax:
            # Your request for an article from tQYRS (c3Av58O0P5xkkIGu) has been canceled for the following reason:
    
    With the TT syntax:
            # Your request for an article from tQYRS_ (c3Av58O0P5xkkIGu) has been canceled for the following reason:
    
    The last character of the biblio's title has been removed because it's a punctuation character.
    It comes from: C4::Letters::_parseletter
     893         $val =~ s/\p{P}$// if $val && $table=~/biblio/;
    
    The same replacement is done for patron's attributes too.
    
    Test plan:
    - Confirm that the new tests pass. That should be enough to confirm this change make sense.
    
    Test plan (manual):
    - Create a biblio with a title ending with a punctuation (like "with_punctuation_"), or any other fields of biblio/biblioitem
    - Generate a notice which will display this field (CHECKIN for instance)
    
    Use the historical syntax and the TT syntax, both should display the title without the punctuation character at the end
    
    CHECKIN historical:
    The following items have been checked in:
    ----
    <<biblio.title>>
    ----
    
    CHECKIN TT syntax:
    The following items have been checked in:
    ----
    [% biblio.title %]
    ----
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a76781f9ef0ba997fdaf79d78648a6c41827f03
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Jan 30 22:35:39 2018 +0000

    Bug 20083: (follow-up) use same logic in opac-showmarc
    
    It was correctly pointed out that opac-showmarc would leak
    the same way as catalogue/showmarc.pl, and so this patch
    moves the authentication step up to the top where it
    should be so as to prevent inappropriate data leaks.
    
    TEST PLAN
    ---------
    1) Set your OpacPublic system preference to Disabled
    2) Open your OPAC and login
    3) Find a biblio with items
    4) Go to the opac details, particularly MARC view.
    5) Copy the "view plain" shortcut link.
    6) log out.
    7) Paste the link into the address bar.
       -- the information will leak!
    8) apply the patch
    9) restart_all
    10) Refresh the OPAC link
        -- log in screen will appear.
    11) run koha qa test tools
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8ce3d88b18ece5c04fbe923a37ce7a9aa715c3c
Author: Andreas Roussos <arouss1980@gmail.com>
Date:   Fri Jan 26 14:12:47 2018 +1300

    Bug 20083: Information disclosure when (mis)using the MARC Preview feature
    
    The MARC Preview feature in the Staff client (catalogue/showmarc.pl) does not
    check whether a user is logged in or not. As a consequence, it can be used to
    obtain information that would normally be available to logged-in users only.
    For example, you can view any bibliographic record by passing a value to the
    'id' argument, but you can also view records as they were imported (normally
    done via the 'Staged MARC management' tool).
    
    All three 17.11 installations currently listed at
    https://wiki.koha-community.org/wiki/Koha_Demo_Installations
    are affected by this issue, as demonstrated by the URLs below:
    
    http://koha.adminkuhn.ch:8080/cgi-bin/koha/catalogue/showmarc.pl?importid=1&viewas=html
    http://pro.demo1711-koha.test.biblibre.eu/cgi-bin/koha/catalogue/showmarc.pl?id=1000&viewas=html
    https://staff-kohademo.equinoxinitiative.org/cgi-bin/koha/catalogue/showmarc.pl?id=1&viewas=html
    
    It should be noted that this only applies to XSLT-enabled installations.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ab51a509a2a9d0ced3b2ccd9ff154f670f27560
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 27 15:56:57 2018 -0300

    Bug 19223: Add methods to correctly handle plugin-generated output
    
    This patch introduces two methods to be used by plugin authors:
    
    ->output
    ->output_html
    
    They are basically wrappers for the helper methods from C4::Output
    (output_html_with_http_headers and output_with_http_headers).
    
    Plugin authors can use them, or keep the current flexibility of handling
    the headers themselves in their code.
    
    The KitchenSink plugin should be updated to highlight this.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/db_dependent/Plugins.t
    => FAIL: The methods are not implemented
    - Apply this patch
    - Run:
     k$ prove t/db_dependent/Plugins.t
    => SUCCESS: Tests pass, and they are meaningful
    - Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c4ac7dac8b8dece9afd2330077aeda82dddc1c1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 27 15:56:41 2018 -0300

    Bug 19223: Unit tests for output and output_html methods
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8538886cb91f977d6109bfd035d4d8348ad108dc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 3 09:52:57 2018 -0300

    Bug 19935: (follow-up) Replace GetPendingIssues - opac-user.pl
    
    Syntax issue, can be squashed on pushing.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e32e62d46d5fae8806a41eadaec701531913764
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 3 09:49:54 2018 -0300

    Bug 19935: Use ->checkouts when ->pending_checkouts->count was used
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfdd5150c1e01f7167bb1702cebba218dfeec38e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 12:32:55 2018 -0300

    Bug 19935: Replace GetPendingIssues - Remove the residue
    
    Here we are, no more occurrences of GetPendingIssues, we can remove the
    tests and subroutine \o/
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc001c2352fee419a2bbe20c0cf707afd9e5bd78
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 12:23:42 2018 -0300

    Bug 19935: Replace GetPendingIssues - SIP
    
    Sounds like we do not need related fields or 'overdue' flag here.
    No idea how to confirm there is no regression here.
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 509892fd00cf6b7a5d65e2aef9d615bf35806cbe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 12:06:59 2018 -0300

    Bug 19935: Replace GetPendingIssues - sco-main
    
    Same as previously, we do not need all the prefetched values here, just
    a few.
    
    Test plan:
    Use the self checkout module to check some items out
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a53471e8bbf4dcb071fabc956fa41c467c4c8c88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 11:59:29 2018 -0300

    Bug 19935: Replace GetPendingIssues - opac-user.pl
    
    At first glance we just need the biblio title and the subtitle (in
    addition of the fines info), we should not need the prefetch.
    
    Test plan:
    Loggin at the OPAC, on the summary page you should see your checkouts
    and overdues with the correct values
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83082242a50c1f33f11080e47e51d0cdcf961939
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 11:47:46 2018 -0300

    Bug 19935: Replace GetPendingIssues - opac-ics.pl
    
    We only need the biblio title and the barcode, we should not need the
    whole prefetch.
    
    Test plan:
    On your OPAC summary page export your checkout list using the
    "Download as iCal/.ics file" link.
    Before and after the patchset, the generated files must be the same
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0161a106e757627d95043401c29c6ab10faa6bdb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 11:40:10 2018 -0300

    Bug 19935: Replace GetPendingIssues - summary-print
    
    We are in the notices part, so we need to fetch all the data to avoid
    regressions.
    
    Test plan:
    Print a summary slip before and after this patch.
    They must be the same
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b4e3dd343b8757e402a943fdb6c4d349f9b1e10
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 11:16:09 2018 -0300

    Bug 19935: Replace GetPendingIssues - deletemem.pl
    
    Same as previously, we just want Koha::Patron->checkouts->count to know
    if a patron has checkouts.
    
    Test plan:
    Confirm that you cannot delete a patron's card if they have pending checkouts
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c4677efc765979643315c238c405843fe9be654
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 11:15:02 2018 -0300

    Bug 19935: Replace GetPendingIssues - Discharges
    
    We should actually use Koha::Patron->checkouts here to avoid the
    prefetch.
    
    Test plan:
    A patron with checkouts cannot get a discharge
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0265c4ae29f860f36baccc9b09537b3cc0368274
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 11:10:50 2018 -0300

    Bug 19935: Replace GetPendingIssues - ILSDI
    
    Here we should only access to what we want in the template, but let do
    it as it for now.
    
    Test plan:
    Hit
    /cgi-bin/koha/ilsdi.pl?service=GetPatronInfo&patron_id=542&show_contact=0&show_loans=1
    
    With 42 a borrowernumber with checkouts
    
    Before and after these patches the XML must be the same
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52af054b6091ee3256f3d87f58ab8e2d29134c32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 15:49:18 2018 -0300

    Bug 19935: Replace GetPendingIssues - IssueSlip
    
    Luckily we have a good test coverage here!
    
    Test plan:
    Print issue slips before and after these patches (with overdues, etc.)
    They should be the same.
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98d0c990bf33bbe8ce76126181f64f078087fa45
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 15:49:03 2018 -0300

    Bug 19935: Add Koha::Patron->pending_checkouts
    
    To move this subroutine out of the C4 namespace we face the same
    problematic as bug 17553 (with GetOverduesForPatron).
    We need to provide an equivalent method and so return all the related
    value for a given checkout.
    We can acchieve the easily using Koha::Object->unblessed_all_relateds,
    but we need to keep in mind that it is a temporary move.
    Indeed we will want to use our API to only access/retrive values we really need.
    The whole trick could be removed when the current syntax for notices
    will be deprecated and removed.
    
    Note: this method returns the same number of elements than ->checkouts
    They indeed returns the same things, but it sounds better to me to have a
    different method to highlight (from the callers) where does it come
    from (C4::Members::GetPendingIssues).
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac7ea9e10e8db92c91e9e436a7f32af2f8623782
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Apr 3 12:28:21 2018 +0000

    Bug 17553: (follow-up) Adjust number of tests
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4b680155247ef0289e8728a7416a734410c12f6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 13:19:51 2018 -0300

    Bug 17553: Move GetOverduesForPatron to Koha::Patron->get_overdues
    
    With the help of Koha::Object->unblessed_all_relateds we are going to
    replace GetOverduesForPatron without introducing regressions (hopefully)
    on both template notice syntaxes.
    
    Test plan:
    0/ Do not apply any patches
    1/ Check some items in to a given patron, with and without overdues.
    2/ Print the overdues slip (Circulation module > Print > Print overdues)
    3/ Apply these patches
    4/ Print again and compare the result
    => The 2 generated slips must be exactly the same
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f907342c88e318ee6e774f8c085370681bc1af8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 4 10:23:56 2016 +0000

    Bug 17553: Move existing tests
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94e3caf32b481e557351eadf1c0657c6b9ad5dd0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 13:48:28 2018 -0300

    Bug 19926: Add tests for Koha::Object->unblessed_all_relateds
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5bbda68fa7d73469f625d40ccee346f48db40bd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 8 13:19:16 2018 -0300

    Bug 19926: Add the Koha::Object->unblessed_all_relateds method
    
    In order to refactor our legacy code step-by-step, we will need to
    provide code with the exact same behaviors and then improve it.
    
    The same idea appears for the TT syntax for notices: we will want to
    deprecate the existing syntax in order to support only one syntax.
    Currently we fetch all the values from the related tables, without
    knowing which are actually used.
    
    I am suggestion to introduce a Koha::Object->unblessed_all_relateds
    method which will return a hash containing all the fields from the
    related tables (with the problems we know: collision in column names).
    It is the existing behavior of GetOverduesForPatron and GetPendingIssues
    for instance, they are used to send notices and so we have to provide
    all the data needed.
    
    See dependent bugs to understand the context and test this patch.
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@deichman.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28c39d5c8642d167b66446ab36dedc447dc076c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 3 11:21:28 2018 -0300

    Bug 7143: Update about page for new dev - Roch D'Amour
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e9ed1a823c6ed9bf9c5f0b57e9c4185b67c0cf3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 3 11:18:08 2018 -0300

    Bug 7143: Update about page for new dev - Philippe Audet-Fortin
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39c2a696b007097bdc286f166c62902c90b14cf3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 3 11:16:53 2018 -0300

    Bug 7143: Update about page for new releases
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92c1eb7db3d46c1495afd6181514be72bdb703c2
Author: Roch D'Amour <roch.damour@inlibro.com>
Date:   Thu Feb 22 16:08:59 2018 -0500

    Bug 18820: Main block size now adjust to OpacNavRight like it would for opacuserlogin
    
    Test plans  :
    - "beforepatch.png" shows the result you get when OpacNavRight and opacnav are set to false.
    - "opacuserlogin=f_opacnav=f.png" shows the result with the patch and OpacNavRight and opacnav set to false
    - "opacuserlogin=t_opacnav=f.png" shows the result with the patch and OpacNavRight set to true and opacnav set to false
    
    Applied patch, can confirm it functions as expected.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a08ad004942a79b7781c2a5cabc21d6cb468006a
Author: Philippe Audet-Fortin <philippe.audet-fortin@inlibro.com>
Date:   Mon Jun 19 09:27:15 2017 -0400

    Bug 18820: Adding lines that check if opacuserlogin is enable and if OpacNav has content.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2d16d6f850adf1e2b528f4ded6de174921b2a03
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 29 16:12:28 2018 -0300

    Bug 20497: Access LibraryThing assets using HTTPS
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ac49d9cdac831f6b72d675aa1436fd9e264be92
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 27 16:46:16 2018 +0000

    Bug 19892: (follow-up) Replace one more instance
    
    This patch replaces one more instance of [% IF ( numbersphr ) %].
    
    To test, apply the patch and view the source of the OPAC home page.
    
    With the OPACNumbersPreferPhrase system preference set to 'use,' you
    should find this in the HTML source:
    
    <option value="callnum,phr">Call number</option>
    
    With the preference set to 'don't use,' you should find this:
    
    <option value="callnum">Call number</option>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52f58f2ec0e9f0270c807cccd95749e853a8d64a
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Thu Jan 18 01:29:05 2018 +0000

    Bug 19892: Replace numbersphr variable with Koha.Preference('OPACNumbersPreferPhrase') in OPAC
    
    Test Case
    1) Check that the following files have been changed properly.
    opac/opac-search.pl
     opac/opac-main.pl
     koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-advsearch.tt
    
    2)Apply bug
    3) Check that there are no differences in behaviour as a result of the patch.
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c2e29463a73fa1ece1808378013160347036143
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 2 18:05:39 2018 -0300

    Bug 20291: DBRev 17.12.00.025
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d255e42241008f028a55fec7eede0a61075c547
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 29 10:14:59 2018 +0000

    Bug 20291: (follow-up) Rename NoLoginInstructions to OpacLoginInstructions
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97a7420735a8304bc8dbb6e123461837da921870
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Feb 27 10:45:46 2018 +0000

    Bug 20291: (follow-up) Add sysprefs.sql changes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7bde81dd8444dfe099d66d89731ef281744341f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Feb 21 04:56:23 2018 +0000

    Bug 20291: Add a StaffLoginInstructions preference for adding text to staff client login
    
    To test:
    1 - Apply patches
    2 - Upgrade database
    3 - Check the staff client login page, should be no change
    4 - Add something to the preferene
    5 - It should appear on the login page
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 769ae66d5e0b50ba7d806e32ade347737b2a7ebc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 29 13:00:36 2018 +0000

    Bug 20052: (follow-up) Fix QA tool complaints and bad copy
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b1dc1b6089c88755a66d2e23215a86622a82f0b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 15 14:38:13 2018 +0000

    Bug 20052: Add Koha Reports object class
    
    To test:
    prove -v t/db_dependent/Koha/Reports.t
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fff1c66a73161e9969ed4354e4824c589daf19e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 28 19:58:37 2018 +0000

    Bug 18382: (QA follow-up) Make new unit test pass
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b6e65d3fd28d78a3c0182ee50b6cf3dc6d3a7a2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 27 14:09:54 2018 -0300

    Bug 18382: Add a test
    
    This is what I am expecting but I may be wrong.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc033fa03758b4a1a106b295bb0a0cab2fb00738
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Tue Mar 27 10:45:09 2018 -0400

    Bug 18382: (QA follow-up) Don't set suspend_until if dt if undefined
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a07da768c52c0f79130b465bc46a8578c80c487
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 22 09:17:46 2018 +0100

    Bug 18382: (QA follow-up) Replace ->ymd by ->datetime
    
    The first patch makes Hold.t fail on:
    not ok 8 - Hold is suspended with a date, truncation takes place automatically
       Failed test 'Hold is suspended with a date, truncation takes place automatically'
       at Hold.t line 94.
              got: '2018-03-22'
         expected: '2018-03-22T00:00:00'
    
    We could remove the midnight time there, but we also could replace ymd by
    datetime. The cpan doc tells us:
        Same as $dt->ymd('-') . 'T' . $dt->hms(':')
    
    Test plan:
    With this patch, run Hold.t again. It should pass now.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2deaead2566a62ce7772cd15a5ffbeb6216a539a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jun 5 10:46:45 2017 -0400

    Bug 18382: action_logs entry for module HOLDS, action SUSPEND is spammy
    
    When a hold is suspended, 'suspend_until' is represented as a DateTime object, complete with locale. All told, this is about 800 lines of text.
    
    Test Plan:
    1) Enable the HoldsLog syspref
    2) Add a hold on a record/item
    3) Suspend the hold with a date to resume
    4) Note the massive amount of date in the suspend_until field
    5) Apply this patch
    6) Suspend another hold with a date to resume
    7) Note the log has an acutal date in the suspend_until field
    
    Check the logs using module 'Holds' and Action 'Suspend'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5afc40805cc8ede026fcb52629a183388bd25cd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 29 12:33:56 2018 +0000

    Bug 20494: Remove unused code in neworderempty.pl and addbiblio.pl
    
    Should be sufficient to read code and see all lines were commented and
    that this patch removes useless lines
    
    To be thorough, ensure that your can add an order to a basket and add a
    biblio.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d55a7eb316e699c32178cbde9d60b6005c4d3e98
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 19 20:29:26 2017 -0300

    Bug 18979: Speed up 'valid-templates.t' tests
    
    Test plan:
    Confirm than prove xt/author/valid-templates.t is quicker with this
    patch.
    
    Before I got:
    Files=1, Tests=840, 21 wallclock secs ( 0.18 usr  0.02 sys + 20.28 cusr
    0.32 csys = 20.80 CPU)
    
    After:
    Files=1, Tests=840, 17 wallclock secs ( 0.06 usr  0.01 sys + 21.56 cusr
    0.48 csys = 22.11 CPU)
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a251be4b80bda3392cde16826cc6c52ff421174e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 23 10:58:27 2018 +0000

    Bug 20282: Match course reserve on holdingbranch
    
    To test:
    1 - Add a course (Course Reserves)
    2 - Add an item to the course
    3 - Ensure to change the holding branch for the course reserve
    4 - Modify the course item
    5 - Note the dropdwn for holding branch is unset
    6 - Apply patch
    7 - Modify the course item
    8 - Dropdown should be correctly populated
    
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adf1835890f5aba60c587c3e905bbd1e003a417c
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Mon Mar 12 07:15:12 2018 -0400

    Bug 20369: Analytics search is broken with QueryAutoTruncate set to 'only if * is added'
    
    Test Plan:
    1) Enable EasyAnalytics
    2) Disable QueryAutoTruncate
    3) Create an analytic record, add some host items to it
    4) Browser to the analytics tab for the record
    5) Click the link in the 'used in' column of the table
    6) No search results
    7) Apply this patch
    8) Reload the page, now you get the analytic record!
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4cdd58b188e785a6d00cf3b7de0e9021d2489c6
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Jan 3 11:20:46 2018 +0000

    Bug 19907: Fix email validation in patron edit form
    
    Test plan:
    0) Confirm that email validation is not working in add/edit patron form
    1) Apply the patch
    2) Edit/add patron, the e-mail validation should be working now
    3) Ensure the password validation is still working (use test plan from
        bug 19908)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83b364ec56ae94a077542691f790d6153d90c4d1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 26 12:22:15 2018 -0300

    Bug 20462: Ensure batch item deletion will not delete the same item twice
    
    This has been done on bug 9509 when barcodes are scaned, but not when using a text file.
    
    Test plan (stolen from Barton on the bug report):
    1) Create a text file containing duplicate barcodes
    
    Here's a quick way to do that, substitute INSTANCE for the instance name of your test server:
    
    sudo koha-mysql INSTANCE <<< "select barcode from items where barcode is not null limit 3" | sed '1d;p' > /tmp/dup_barcodes.txt
    
    2) Go to Home › Tools › Batch item deletion
    3) Click 'Choose File', select the file you created in step 1.
    4) Click 'Continue'
    5) Note that duplicate items appear in the list of items to batch delete
    6) Check 'Delete records if no items remain'
    7) This will trigger a software error
    
    Note that entering the barcodes via the 'scan items one by one' text box removes duplicates in the list, so this only causes problems when uploading a file.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 391bc7623c25c46111719e3988f110e2cc2174a9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 2 14:30:23 2018 -0300

    Bug 20318: Add class 'required' to the label
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dcdd49b6b383730191334a01794f7b8318a537e
Author: Christophe Croullebois <christophe.croullebois@biblibre.com>
Date:   Wed Mar 14 14:28:28 2018 +0000

    Bug 20318: Merge invoices can lead to an merged invoice without Invoice number
    
    When you want to merge invoices you have a page with a non editable
    field 'Invoice number:' it shows the content of the first invoice to be
    merged.
    But if you validate by clicking the 'merge' button you arrive on the
    next page which says that 'Invoice has been modified' and if you quit
    this page without saving you have now a merged invoice without Invoice
    number.
    This tiny patch just prevents this issue to occur.
    
    Test plan :
    
    1° go to the acqui/invoices.pl page and search invoices to merge.
    You must have at least 2 invoices on the same vendor
    2° check boxes to select invoices to merge and click on 'merge selected
    invoices' button
    3° next page you see the non editable field 'Invoice number:'
    4° click on the 'merge' button
    5° next page you see 'Invoice has been modified'
    6° leave this page i.e click on the left link 'Invoices'
    7° search invoices you'll see the merged invoice without invoice number.
    
    Apply the patch, replay the steps 1 to 3
    4° on this page you can enter your invoice number and click on the
    'merge' button.
    If you leave this field empty and click merge, a message informs you
    that it is required and you can not merge.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bba218444e9e475981670f1663d341204d1e67ce
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 30 07:08:30 2018 -0400

    Bug 18474: (QA follow-up) Remove useless else in template
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ef1e5d4edff50afd571e7b3d9bfc7ab078e90bd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 15:59:24 2017 -0300

    Bug 18474: Restore multiple holds when patron is searched for
    
    We lost the ability to place multiple holds when we are searching for
    patrons. The multi_holds parameter is lost and not handled correctly in
    the template.
    
    Test plan:
    - Make sure you can place multiple holds for a patron you will search for
    - Same for simple hold
    
    TODO the multiple holds view should not be displayed if only 1 record
    has been selected from the search result.
    
    Signed-off-by: claude brayer <claude.brayer@cea.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d22a1308d52fb55ebe280f545d1f3718aa16cbdf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 23 17:12:13 2018 +0000

    Bug 20385: (follow-up) Assign blank instead of inappropraite value
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6560a9a706686d4a28d23f15d223bbc88c0b5c50
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 13 14:57:47 2018 +0000

    Bug 20385: Don't try to get info for bad authtypecodes
    
    TO test:
    0 - Have a koha with ES enabled and some auth records
    1 - backup your db
    2 - sudo koha-mysql <<instance>>
    3 - UPDATE auth_types SET authtypecode="PERSO_NAMB" WHERE
    authtypecode="PERSO_NAME" (or adjust as necessary)
    4 - Search for some authorities where a PERSO_NAME record will be
    returned
    5 - KA_BOOM!
    6 - Apply patch
    7 - Results are returned, they do not display a code, viewing record you
    won't see code
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08039f41c196f9119e5ca82f762e5260d8c81a1a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 30 13:14:46 2018 -0300

    Bug 20503: Prevent Borrower_PrevCheckout.t to fail randomly
    
    category_type must be != "X"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit caba1b2daef753c7db946851491ce75ac978798c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 29 17:57:01 2018 +0000

    Bug 20498: (bug 19641 follow-up) Patron advanced search form missing from patron entry page
    
    My patch moving patron-related templates' javascript to the footer left
    out a script from the patron entry template which is required if the
    patron header search menu is going to work.
    
    To test, apply the patch and go to Patrons -> New patron.
    
    Clicking the [+] link in the "Search patrons" header search form should
    expand the advanced search options.
    
    Test that the page's toolbar still "floats" correctly when you scroll
    the page.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43e57efa523ad05f45eb2ff5dcb928877b3b4209
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 29 12:45:39 2018 -0300

    Bug 16330: Remove unecessary Koha::Patron->store method
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbf374498bb327b2948904fd8783944ab2a9e389
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Wed Mar 28 21:19:52 2018 +0000

    Bug 20490: Correct bug number typo in comment in Circulation.t
    
    NOTE: Confirmed that the typo of 17641 was part of bug 17941.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7e46047cffbca02d08049729911a274970244f5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 8 09:35:45 2017 -0300

    Bug 19784: Adapt /v1/patrons to new naming guidelines
    
    This patch introduces two functions to the patrons endpoint:
    - _to_api
    - _to_model
    
    This are in charge of field mappings in order to comply with the
    guidelines.
    
    Koha::REST::V1:Auth is adjusted to handle 'patron_id' as well. 'borrowernumber'
    handling is kept until the existing endpoints get updated.
    
    To test:
    - Apply the patches
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/*.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87dc9b0ac1db2b689385a5b65e7d1293ea8bca0a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 8 09:25:35 2017 -0300

    Bug 19784: Remove reference to 'borrowernumber' param from other endpoints
    
    This patch removes the $ref occurences for borrowernumber in not
    patron-specific endpoints. 'borrowernumber' is still used on them, but as a
    hardcoded parameter. The param rename will happen on a separate bug for
    each endpoint.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10de4f437f3ca9f368e52f79ab6fb1b86c916209
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 8 09:17:28 2017 -0300

    Bug 19784: Unit tests for /api/v1/patrons
    
    This patch adapts the existing endpoint's tests so they expect:
    - 'patron_id' for 'borrowernumber'
    - 'library_id' for 'branchcode'
    - 'category_id' for 'categorycode'
    
    In the process, I tried to make the tests more robust, by creating random
    data that gets deleted to make sure our tests cases can't have false
    positives.
    
    Independent subtests are wrapped inside transactions to avoid
    eventual interference.
    
    To test:
    - Apply the patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: The api doesn't implement the expected behaviour and attributes
    for endpoint responses
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dce823c12255c8d3db3761c30fc04370d3682157
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Feb 19 07:15:22 2018 +0000

    Bug 16330: (QA follow-up) Update usage of search plugin because of bug 19686
    
    Test plan:
    prove t/db_dependent/api/v1/patrons.t
    --> without  patch the list subtest fail
    --> with patch test pass
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2183c7a175f1ac3648b7963a5d18dce0cd2936f9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 19 14:46:45 2017 -0300

    Bug 16330: Remove validation code from Koha::Patron
    
    This patch removes previously added validation code from Koha::Patron
    as we will rely on the DB structure and relationships to catch the same
    problems. This is implemented on bug 19828.
    
    This patch also adapts the API controller class to expect this behaviour
    change from Koha::Patron. The expected exceptions are adjusted, and some
    minor changes take place. The API tests are adjusted as well.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/db_dependent/Koha/Patrons.t
     k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCESS: Tests should still pass
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e36dc18376390d2747ce5d831064146817cd24c9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 12 18:53:45 2017 -0300

    Bug 16330: (QA follow-up) ModMember requires borrowernumber
    
    Works perfectly. Well done everyone!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c3a273af93dbe64d050190a6cdfb9e9453a9364
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 5 16:43:00 2017 -0300

    Bug 16330: (QA follow-up) Repect guidelines on plurals Patron > Patrons
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd9b6c165163ac1d6b52df6f2df17ec5de6b2758
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 4 16:18:47 2017 -0300

    Bug 16330: Move patches to OpenAPI
    
    This patch refactors the original work so it implements the controllers
    and the spec using Mojolicious::Plugin::OpenAPI, and OpenAPI for the specification.
    
    It removes the ability for patrons without permissions to edit their own data or their
    guarantee's. This will be moved to a patron modification requests endpoint for simplicity.
    
    It makes use of bugs 19410 and 19686 and their dependencies to deal with parameters handling,
    query building and pagination.
    
    Tests are adapted.
    
    To test:
    - Apply this patches and the dependencies
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b8909cb9080216352b0a68564476c8861f7e790
Author: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
Date:   Wed Apr 27 13:47:04 2016 +0000

    Bug 16330: Add routes to add, update and delete patrons
    
    This patch adds support for add, edit and delete patrons via REST API.
    
    GET  /api/v1/patrons                   Get patron list from params
    GET  /api/v1/patrons/<borrowernumber>  Get single patron
    POST /api/v1/patrons                   Create a new patron
    PUT  /api/v1/patrons/<borrowernumber>  Update data about patron
    DEL  /api/v1/patrons/<borrowernumber>  Delete a patron
    
    Revised Test plan:
    1) Apply this patch
    2) Run tests perl t/db_dependent/api/v1/patrons.t
    3) Add a user with proper rights to use the REST API
    4) play with your favourite REST client (curl/httpie, etc.):
       Authenticate with the user created above and get a CGISESSION id.
       Use the CGISESSION to add, edit and delete patrons via the API.
    5) Use PUT /patrons/<borrowernumber> for a patron without borrowers
       flag. This should go into pending patron modification status and
       needs to be accepted by a librarian.
    
    Please note there is no validation of body input in PUT/POST other
    than branchcode,category,userid,cardnumber.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 275c5bd4fa11c30606d11d7bfb2eab8c0a31ed04
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Mar 25 22:10:22 2018 +0200

    Bug 19488: (QA follow-up) Fix spelling, remove ()
    
    Fixes spelling to match the details page and removes ().
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae57ac3792d16c546efdd4949c07218e8ccccf0b
Author: Jesse Maseto <jesse@bywatersolutions.com>
Date:   Fri Mar 2 14:48:06 2018 +0000

    Bug 19488: Add borrowernumber to brief info on patron details pages in staff client
    
    To test:
    - View different tabs of a borrower's patron account in staff
    - Verify the borrowernumber is shown in the brief info section
      on the left
    
    Signed-off-by: JM Broust <jean-manuel.broust@univ-lyon2.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b76ee39d4b3696d9ec7e71cdcc785b2980e10ff
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 28 12:42:19 2018 +0000

    Bug 19564: (QA follow-up) Make commented out tests pass
    
    We likely shoudln't pass through an uncoverted sort order for now, but
    it does allow us to look ahead to implementing the orders directly so
    seems a good option to have.
    
    Either this patch should be used, or the commented out tests should be
    removed
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3afd4a7e1aff525d870aef5d4693016885a6dbcf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 22 15:21:51 2017 -0300

    Bug 19564: Add tests for _convert_sort_fields
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e07761f30c576e5f8b275d83ce6dea578148e94
Author: David Gustafsson <david.gustafsson@ub.gu.se>
Date:   Thu Nov 2 15:02:23 2017 +0100

    Bug 19564: Fix extraction of sort order from sort condition name
    
    Currently sort order is extracted from sort condition by splitting the
    field, instead use regular expression to extract the last part preceded
    by underscore.
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 444ac690745cb360db852303b1ff461fa8c7175e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 21:35:47 2017 -0300

    Bug 19673: Allow to set patron attributes to 0 with batch patron modification
    
    This patch will have to be tested deeply to make sure it will not
    introduce regression!
    
    The idea is to display an empty option in the patron attributes select
    and ignore it. That way we can deal with false values 0 and "" which
    were skipped before.
    
    Test plan:
    Add several patron attributes
    Use the batch patron modification tool to add/update/remove them
    Play with empty "" and 0 values, as well as other values
    Modify several attributes in a row
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3e7c265acea3e30313d9f824ee27e5391bf71e8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 4 15:31:52 2018 +0000

    Bug 19916: Add keyword and standard ID fields to acq external search
    
    To test:
    1 - Add an order from external source
    2 - Note you don't have keyword or standard ID fields
    3 - Add a catalog record from Z3950, note those fields are there
    4 - Apply patch
    5 - Check acq and note you do have those fields
    6 - Do some searches to verify they work as expected
    
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c12ddd88d5a3b04faa260a8fbbcc253f7c26c2d
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Mon Mar 5 09:09:28 2018 +0200

    Bug 20330: Allow translating more of quote upload
    
    Translate the error messages, and the table headers.
    
    Test plan:
    
    1) Go to Home -> Tools -> Quote editor -> Import quotes
    2) Upload quotes from a file. Try to trigger the error messages
    3) On successful import, check the table header texts
    4) Apply patch, update & install a language
    5) The error messages and the table header texts should
       show up in the xx-YY-staff-prog.po
    6) Repeat 1,2,3
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2869cb0143a6176e44ff5bf0b4d0dda65be7e2e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 28 15:54:56 2018 -0300

    Bug 18055: The 2 new deps are used for testing purpose
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0fbc15c9764e5cff1edf8b71d8c0f3370aa8da4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 1 12:25:27 2017 -0300

    Bug 18055: (QA followup) Only print output if DEBUG
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 735b4e0fc027f7e8a66640fe11174f709131160f
Author: Mason James <mtj@kohaaloha.com>
Date:   Fri Jun 16 01:20:05 2017 +1200

    Bug 18055: Speed up '00-strict.t' test, with Parallel::ForkManager
    
    add KOHA_PROVE_CPUS envar to manually set number of cpus
    
    to test..
    
    1/ set number of cpus to 1
     $ export KOHA_PROVE_CPUS=1
    
    2/ observe 1 cpus are used
     $ time prove -v  t/db_dependent/00-strict.t
     t/db_dependent/00-strict.t ..
     Using 1 CPUs...
    
    3/ unset number of cpus
     $ export KOHA_PROVE_CPUS=
    
    4/ observe all available cpus are used
     $ time prove -v  t/db_dependent/00-strict.t
     t/db_dependent/00-strict.t ..
     Using 32 CPUs...
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac38492107c14acd2651cae07beeb81a56d4f132
Author: Mason James <mtj@kohaaloha.com>
Date:   Sun Feb 5 14:40:06 2017 +1300

    Bug 18055: Speed up '00-strict.t' test, with Parallel::ForkManager
    
    to test...
    
    1/ run 00-strict.t test, (16.5 mins on a 4xcpu system)
    
    $ time prove t/db_dependent/00-strict.t
    ...
    Files=1, Tests=654, 994 wallclock secs ( 0.19 usr  0.04 sys + 873.40 cusr 116.20 csys = 989.83 CPU)
    Result: PASS
    real    16m34.104s
    
    2/ apply patch
    
    3/ install Parallel::ForkManager package
    $ sudo apt-get install libparallel-forkmanager-perl libsys-cpu-perl
    
    4/ run 00-strict.t test again, (now 6 mins.. much faster)
    
    $ time prove t/db_dependent/00-strict.t
    ...
    Files=1, Tests=654, 364 wallclock secs ( 0.07 usr  0.01 sys + 1159.20 cusr 153.41 csys = 1312.69 CPU)
    Result: PASS
    real    6m4.355s
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Edit: removed debian/control changes as the file is generated
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a9031676eefbccad1afa6594df8990b8202b0fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 26 13:13:58 2018 -0300

    Bug 20455: Fix sort patrons by date expired
    
    We may need to apply this change for all other occurrences in our
    codebase.
    
    Test plan:
    - Make sure sample patron data is loaded and you have a patron without a
    date expired defined
    - Make an empty search for all patrons or another search that gives you
    a good amount of results
    - Try to sort on the date expired column
    
    => Without this patch you get
    Odd number of elements in anonymous hash
    at /home/vagrant/kohaclone/C4/Utils/DataTables/Members.pm line 189.
    output_pref is called with 'dateonly' (ref SCALAR), not a DateTime
    object
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64616fe2ffc35bf65aa28dcbc36b30e648591cf2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 27 17:53:13 2018 -0300

    Bug 19233: Restore styling of the button
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 031149a20c60fbb2eb5a940cf4000eec4bfe08f7
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Tue Mar 13 15:09:22 2018 +0000

    Bug 19583: Remove use of C4::AuthoritiesMarc
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de3f658e9b35a93717d615aa79fb7fc85bcaeb88
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Mar 12 15:56:45 2018 +0000

    Bug 19582: (follow-up) get params in correct order
    
    We were ordering the values out of sync with the order of the mathclist
    param and so causing 'entire record' and 'all headings' to be reversed
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 675daf17cd3eb031416efac4114726555b656600
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Nov 7 01:24:56 2017 +0000

    Bug 19582: Unit tests
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49c5acc5b9a47946b514c339fed33862d98e63d7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 6 17:14:34 2017 +0000

    Bug 19582: Use compat routines for searching authorities in auth_finder.pl
    
    To test:
    1 - Enable Zebra
    2 - Perform an auth search
    3 - note results
    4 - Enable ES
    5 - Repeat search, note (likely) diff results
    6 - Open a record in cataloging and use the button to launch auth search
    7 - Perform same search as above, note results match for eiher engine
    selected
    8 - NOTE: Disbale sorting for ES search - this will be dealt with in
    another report
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 304e2a8868d6473b8a624bd4cb88812c8b90e1d4
Author: Claire Gravely <claire.gravely@bsz-bw.de>
Date:   Tue Mar 13 11:18:33 2018 +0000

    Bug 20386: Improve warning and error messages for Search Engine Configuration
    
    This patch updates a warning message and error message in the Search
    engine configuration for Elasticsearch.
    
    Note: elasticsearch does not need to be active in order to test.
    
    To test warning message:
     1. go to: cgi-bin/koha/admin/searchengine/elasticsearch/mappings.pl
     2. note the warning message
     3. Apply patch
     4. Note the change in warning message. Confirm it makes sense.
    
    To test error message:
      Apply patch and check the changed message in the template file mappings.tt and confirm it makes sense.
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57844add803b67f0f5e5c691d172d4141d8d6540
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Dec 4 10:04:48 2017 +0100

    Bug 19739: Add default ES configuration to koha-conf.xml
    
    Bug 18571 added default ES configuration for packaging config.
    
    This patch adds it to dev install in koha-conf.xml.
    Database name is used in index_name to allow multiple installs.
    
    Test plan :
    - Run dev install
    - Install ElasticSearch server and Koha deps
    - Enable ElasticSearch in Koha
    - Check indexing and searching works directly
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce82441d2625ac45a224b8acea9f616a256296a4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 27 17:30:42 2018 +0000

    Bug 19233: (follow-up) Use a button to submit form
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b70f369d58c380b8c3fb8a5b13981776a0945f1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 18 15:23:38 2017 +0000

    Bug 19233: (follow-up) Send itemnumbers in report results to batch modification
    
    This patch changes the obscure "^" symbol to a styled link with the text
    "Batch modify." I think the only disadvantage of this is that it takes
    up more space, but it is outweighed by the improved clarity.
    
    This patch also makes minor indentation corrections to new lines of
    HTML.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdbd489428fd392e6d4c096e88fa42cda2283c56
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 1 00:54:44 2017 +0000

    Bug 19233: Add ability to send itemnumbers in report results to batch modification
    
    To test:
    1 - Apply patch
    2 - Run a report with an itemnumber column
    3 - Note there is a linked '^' after column title
    4 - Hover over the '^'
    5 - You should see a tooltip 'Send visible items to batch modification'
    6 - Click the '^'
    7 - You should be sent to batch item modification with itemnumbers that
    were visible in report
    
    Signed-off-by: George <george@nekls.org>
    Signed-off-by: BWS Sandboxes <ByWaterSandboxes@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7aac30428f3ae24f384bad316650e26b32dc5fed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 27 13:37:35 2018 -0300

    Bug 20479: Ease readability - do not enter the block if not logged in
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24f25369a58d4a2bc2adf92853feeed4337e013e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 27 12:47:54 2018 -0300

    Bug 20479: Use $flag instead of fetching patron
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8b3497368b839e4fc594661719351efbe3433cc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 27 15:05:57 2018 +0000

    Bug 20479: (follow-up) Don't try to get flags for database user
    
    Login will still break in opac-user.pl, but that seems a bigger problem
    not from SCI module
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51d7a02726b81b28325f7a151c8670e2f2293f71
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 27 12:47:57 2018 +0000

    Bug 20479: Don't kick superlibrarians out of the opac
    
    To test:
    1 - Try to log in to opac with a superlibrarian
    2 - Everythign goes wrong
    3 - Apply patch
    4 - Try to log in with superlibrarian
    5 - You can sign in
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da36fd4429863c77570543a08978d0ef1e290e41
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 27 13:27:27 2018 -0300

    Bug 20480: send KOHA_VERSION even if only one language is enabled
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b03ce512c45544d2b9695f913a2291530cb63362
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 27 11:54:51 2018 -0300

    Bug 20480: Make KOHA_VERSION available to all templates in all circumstances
    
    This patch makes C4::Templates::gettemplate set the KOHA_VERSION param
    for the template. This way this template parameter, which is required by
    (probably) all pages that include CSS/JS content is available in all
    circumstances.
    
    A noticeable problem with the current approach is when using the SCO and
    SCI modules with wrong/forbidden users: C4::Auth short-circuits and
    redirects to the login page, without setting the KOHA_VERSION param.
    This patch solves it for good.
    
    To test:
    - Enable the SCI module
    - Open the browser at
      http://localhost:8080/cgi-bin/koha/sci/sci-main.pl
    - Login with the db user (koha_kohadev / password)
    => FAIL: Login failure, but styling is broken
    - Apply this patch
    - Retry
    => SUCCESS: Everything looks as it should!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3f8c669141da6941f7eebaebb157e99a3a5e217
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 27 12:21:41 2018 -0300

    Bug 20474: Mimick Letters.t
    
    Please improve if needed the 2 occurrences on a separate bug reports.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62f79301479a7926f5e5d2f3299a1d156f50d933
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Mar 26 15:39:28 2018 +0000

    Bug 20474: Mock sendmail instead of actually emailing
    
    Copy mocking sendmail code from t/db_dependent/Letters.t
    into the Passwordrecovery.t test file.
    
    prove t/db_dependent/Passwordrecovery.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8a94b0a9a0c4b92ab22f61522d2c449012762fd
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Mar 26 16:46:19 2018 +0000

    Bug 20474: Explicitly call sendmail to make mocking work
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fec6a3c83a53a973db464512523c7f022e9ad976
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 27 12:03:51 2018 -0300

    Bug 20045: Fix Selenium tests
    
    Element id=doc does not longer exist on the admin home page
    The "main block" need to be localized using the new class 'main
    container-fluid'
    We will certainly need to improve this later.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f757c7e6a05a70fd4e374b284396885daff336f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 26 19:35:07 2018 -0300

    Bug 20267: .gitignore do not need to be mapped in Makefile
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 385c16174b4156f59518cdd1de02ee81ba3c03b8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Feb 17 12:20:09 2018 -0300

    Bug 17468: Remove koha-*-zebra scripts and its traces
    
    This patch removes traces from the (deprecated) koha-*-zebra scripts.
    
    To test:
    - Apply the patch
    - Verify no traces of koha-*-zebra remain on the codebase (besides
      Release Notes and the koha-zebra script):
      $ cd kohaclone
      $ git grep koha-start-zebra
      $ git grep koha-stop-zebra
      $ git grep koha-restart-zebra
    => SUCCESS: No traces!
    - Create the following symlinks:
      $ sudo ln -s /usr/sbin/koha-zebra  /usr/sbin/koha-start-zebra
      $ sudo ln -s /usr/sbin/koha-zebra  /usr/sbin/koha-stop-zebra
      $ sudo ln -s /usr/sbin/koha-zebra  /usr/sbin/koha-restart-zebra
    - Try the koha-*-zebra commands:
      $ sudo koha-stop-zebra kohadev
      $ sudo koha-start-zebra kohadev
      $ sudo koha-restart-zebra kohadev
    => SUCCESS: They all work as expected!
    
    - Sign off :-D!
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e93b777fdc59c3b79fae2f9a86a763c7ceb7cdd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 6 18:48:08 2018 +0000

    Bug 20345: Put saved report keyword search form on reports home
    
    This patch makes cosmetic changes to the reports home page in the staff
    client following the pattern set on the Administration home page with
    the system preferences search box. A reports keyword search form is
    added, and reports actions have font-awesome icons.
    
    To test, apply the patch and view the reports home page. Confirm that
    all affected links work correctly and that the search form works
    correctly.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18fb2f12e70b92de63bd283d7d137ee69aa82a9f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 19 16:02:46 2018 +0000

    Bug 20045: Switch single-column templates to Bootstrap grid: Various
    
    This patch updates various unrelated templates to use the Bootstrap
    grid.
    
    - about.tt - The about page
    - auth.tt - The login page
    
      These pages should look correct.
    
    - reports/reports-home.tt - The reports home page
    - admin/admin-home.tt - The administration home page
    
      These pages should look correct, with a single centered column
      with wide margins on either side. At lower browser widths the margins
      should disappear.
    
    - serials/subscription-add.tt - Serials -> Add subscription. The entry
      form should look correct during each step of the add/edit process.
    
    - suggestion/suggestion.tt - Acquisitions -> Suggestions -> New
      suggestion. The page with the new suggestion form should look correct.
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 011aa89777cd821869ca85e9aca7485550ecf001
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 16 16:55:36 2018 +0000

    Bug 19983: Switch single-column templates to Bootstrap grid: Authorities
    
    This patch updates several single-column Authorities module templates to
    use the Bootstrap grid.
    
    - authorities-home - The home page of the Authorities module.
    - authorities.tt - The authority add/edit page.
    - blinddetail-biblio-search.tt - Not really testable -- It's the small
      popup window which appears during the process of linking an authority
      to a MARC record.
    - detail.tt - The authority detail page. Search for an authority record
      and click on the "details" link in the search results.
    - merge.tt - From a list of authority search results, select "Merge"
      from the Actions menu of two authority records. Test both the initial
      selection screen and the source/destination merging view.
    - searchresultlist.tt - The authority search results page.
    
    Each of these pages should look correct, with a single centered column
    with wide margins on either side. At lower browser widths the margins
    should disappear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95f881b96969dda6156d78fbe59410946f61ca99
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 21 19:40:06 2018 +0000

    Bug 19961: Move template JavaScript to the footer: Patron card creator
    
    This patch modifies the staff client patron card creator templates so
    that JavaScript is included in the footer instead of the header.
    
    Also changed: Removed "type" attribute from script tags.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    
    - Creating and managing layouts
    - Creating and managing card batches
    - Creating and managing card templates
    - Creating and managing printer profiles
    - Creating and managing images
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9f2d9d86102bd03b72e03b5640ba9f2544c8a86
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 9 13:16:40 2018 +0000

    Bug 19946: (follow-up) Add fixed footer to authorities Z39.50 popup
    
    This patch adds additional Bootstrap framework markup to the search form
    so that the "Save" and "Cancel" controls are in a fixed footer at the
    bottom of the window. This prevents the controls from disappearing down
    off screen.
    
    This patch also adds some whitespace to the "Author
    (meeting/conference)" label to enable better word wrapping.
    
    To test, apply the patch and go to Authorities -> New from Z39.50/SRU.
    In the popup window, both the search form and search results pages
    should look correct.
    
    Patch applies, form resizes, displays and functions as expected.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c609249390aa37ba09a7fa4f71816456fa2e8ac
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 10 16:10:44 2018 +0000

    Bug 19946: Update popup window templates to use Bootstrap grid: Authority Z39.50 search
    
    This patch updates the authority Z39.50 search template to use the
    Bootstrap grid instead of the YUI grid.
    
    Also fixed: Some capitalization corrections, better <title>
    handling. This patch does not fix Bug 17119.
    
    To test, apply the patch and go to Authorities -> New from Z39.50.
    In the popup window, both the search form and search results pages
    should look correct.
    
    Signed-off-by: Te Rauhina Jackson <terauhina.jackson@gmail.com>
    
    Signed-off-by: Te Rauhina Jackson <terauhina.jackson@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f4eb5df7e3c3eb156df176915fcac3a5d34553c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 10 17:42:59 2018 +0000

    Bug 19949: Update popup window templates to use Bootstrap grid: Cataloging authority search
    
    This patch updates the cataloging authority search templates to use the
    Bootstrap grid instead of the YUI grid.
    
    To test you must have a MARC subfield configured with "Thesaurus"
    linked to an authority type.
    
    Apply the patch and go to Cataloging -> New record. Click the plugin
    link for the field which is linked to authorities. In the popup window,
    the search form and search results should look correct.
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42ff67e1732f5cbbaf580214d88f3f287ca34770
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 2 16:29:44 2018 +0000

    Bug 19878: Move template JavaScript to the footer: UNIMARC editor plugins, part 7
    
    This patch updates the last of the UNIMARC plugin templates so that
    JavaScript is included in the footer following the same pattern as
    other templates which have been modified to fix Bug 17858.
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that changes
    made in the popup window are saved to the corresponding field in the
    editor.
    
    - unimarc_field_210c.tt
    - unimarc_field_210c_bis.tt
    - unimarc_field_225a.tt
    - unimarc_field_225a_bis.tt
    - unimarc_field_4XX.tt
    - unimarc_field_700-4.tt
    - unimarc_leader.tt
    
    Signed-off-by: Anne-Claire Bernaudin <anne-claire.bernaudin@univ-rennes1.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b809726492aca4118dfdd9171a855cbf6739da84
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 22 16:32:57 2017 +0000

    Bug 19877: Move template JavaScript to the footer: UNIMARC editor plugins, part 6
    
    This patch updates more UNIMARC plugin templates than ever before, so
    that JavaScript is included in the footer following the same pattern as
    other templates which have been modified to fix Bug 17858.
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that changes
    made in the popup window are saved to the corresponding field in the
    editor.
    
    - unimarc_field_128a.tt
    - unimarc_field_128b.tt
    - unimarc_field_128c.tt
    - unimarc_field_130.tt
    - unimarc_field_135a.tt
    - unimarc_field_140.tt
    - unimarc_field_141.tt
    
    Signed-off-by: delaye <stephane.delaye@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 077fcf3a6be405fc6bac7371f5586d1d696ec287
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 22 14:51:20 2017 +0000

    Bug 19874: Move template JavaScript to the footer: UNIMARC editor plugins, part 5
    
    This patch updates yet more UNIMARC plugin templates so that
    JavaScript is included in the footer following the same pattern as other
    templates which have been modified to fix Bug 17858.
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that changes
    made in the popup window are saved to the corresponding field in the
    editor.
    
    - unimarc_field_125a.tt
    - unimarc_field_125b.tt
    - unimarc_field_126a.tt
    - unimarc_field_126b.tt
    - unimarc_field_127.tt
    
    Signed-off-by: delaye <stephane.delaye@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ea03cefd6a1612ad60ead35bbac95588ff5723c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 22 14:12:09 2017 +0000

    Bug 19872: Move template JavaScript to the footer: UNIMARC editor plugins, part 4
    
    This patch updates more and more UNIMARC plugin templates so that
    JavaScript is included in the footer following the same pattern as other
    templates which have been modified to fix Bug 17858.
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that changes
    made in the popup window are saved to the corresponding field in the
    editor.
    
    - unimarc_field_124a.tt
    - unimarc_field_124b.tt
    - unimarc_field_124c.tt
    - unimarc_field_124d.tt
    - unimarc_field_124e.tt
    - unimarc_field_124f.tt
    - unimarc_field_124g.tt
    
    Signed-off-by: delaye <stephane.delaye@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbfbcae838eacf7684141260e263619dd7869aef
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 21 18:20:12 2017 +0000

    Bug 19869: Move template JavaScript to the footer: UNIMARC editor plugins, part 3
    
    This patch updates even more UNIMARC plugin templates so that
    JavaScript is included in the footer following the same pattern as other
    templates which have been modified to fix Bug 17858.
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that changes
    made in the popup window are saved to the corresponding field in the
    editor.
    
    - unimarc_field_123a.tt
    - unimarc_field_123d.tt
    - unimarc_field_123e.tt
    - unimarc_field_123f.tt
      - This template has been modified, but doesn't appear to be used. The
        unimarc_field_1234.pl script uses unimarc_field_123g.tt as its
        template.
    - unimarc_field_123g.tt
    - unimarc_field_123i_j.tt
    
    Signed-off-by: Anne-Claire Bernaudin <anne-claire.bernaudin@univ-rennes1.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0844092693358f873c059e78b51b5e1b6dd83166
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 21 17:45:09 2017 +0000

    Bug 19868: Move template JavaScript to the footer: UNIMARC editor plugins, part 2
    
    This patch updates several more UNIMARC plugin templates so that
    JavaScript is included in the footer following the same pattern as other
    templates which have been modified to fix Bug 17858.
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that changes
    made in the popup window are saved to the corresponding field in the
    editor.
    
    - unimarc_field_116.tt
    - unimarc_field_117.tt
    - unimarc_field_120.tt
    - unimarc_field_121a.tt
    - unimarc_field_121b.tt
    - unimarc_field_122.tt
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e42475ca28a56e83a672a618339ffdfacd09036c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 21 16:30:05 2017 +0000

    Bug 19866: Move template JavaScript to the footer: UNIMARC editor plugins, part 1
    
    This patch updates several UNIMARC plugin templates so that JavaScript
    is included in the footer following the same pattern as other templates
    which have been modified to fix Bug 17858.
    
    To test you do not need a UNIMARC system.
    
    Apply the patch and for each plugin, configure a MARC subfield (e.g.
    100$a) to use that plugin.
    
    From the MARC edit page, trigger the plugin and confirm that changes
    made in the popup window are saved to the corresponding field in the
    editor.
    
    - unimarc_field_100.tt
    - unimarc_field_100_authorities.tt
    - unimarc_field_105.tt
    - unimarc_field_106.tt
    - unimarc_field_110.tt
    - unimarc_field_115a.tt
    - unimarc_field_115b.tt
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e563d81aae7e2e38ecda8ce19381b023130118a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 20 14:19:31 2018 +0000

    Bug 19786: (follow-up) Correct js include path, popup window size
    
    This follow-up adds the required KOHA_VERSION variable to two templates
    where it was missing.
    
    This patch also adds a 'window_size' parameter to a popup window
    function so that self-closing windows like blinddetail-biblio-search.pl
    can appear small and others at a reasonable size.
    
    To test, apply the patch and clear your browser cache if
    necessary.
    
    - Confirm that the QA tools do not complain about missing KOHA_VERSION
      in auth_finder.tt and searchresultlist_auth.tt.
    
    - Open a bibliographic record for editing in the basic editor using a
      framework in which a field is linked to authorities.
    - Trigger the authority selection window for that field.
    - Click the "Clear field" button at the top of the authority search
      pop-up window. Another smaller popup window should briefly appear, and
      then both windows should close.
    - Trigger the authority selection window again.
    - Click the "Create new authority" button. A new window should appear
      with the MARC authority editor. The window should be a usable size.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d41b8cce8235446812ec3a7309dd68abd4b86e4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 8 19:57:28 2017 +0000

    Bug 19786: Move template JavaScript to the footer: Authorities, part 2
    
    This patch modifies the staff client patron lists templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template.
    
    I've made one change to the JavaScript in addition to moving it: I've
    made it so that the blank window which pops up briefly in this process
    is 100px x 100px instead of full screen.
    
    - Cataloging -> Add or edit bibliographic record in a framework which
      has authorities linked to a tag
      -> Click authorities plugin link
         -> Create new authority button
         -> Autocomplete on text inputs (except "Search all headings")
         -> Search
            -> Select authority record ("choose")
               -> Click authorities plugin link again
                  -> Clear field
    
    Signed-off-by: Claire Gravely <claire_gravely@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49f50a7f267e7ea105895dc5165965b149697fe3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 26 17:29:52 2018 -0300

    Bug 15492: DBRev 17.12.00.024
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72061402d9e710de8ae322d46cd1d54702a27019
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 19 16:31:52 2018 -0300

    Bug 15492: (QA followup) Make page refresh work correctly
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c660aef299b8b705e8a31dce91de254195baabe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 21 17:11:59 2018 -0300

    Bug 15492: Add KOHA_VERSION to included .css and .js
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a9b69ec7adf85194cf6ef4991b1febfef692ede
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 27 12:45:16 2017 -0300

    Bug 15492: Display nicer message on data corruption
    
    This patch hides scary messages and changes the wording for a more
    idiomatic approach. Thanks to Nick :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56da3e5705f2f41795a8b3c6a5ba365fe17c4137
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 27 12:32:11 2017 -0300

    Bug 15492: Make SCI use its own sysprefs and CSS file
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6e8e88249914531d8b01f35200de6a8a4692b89
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 27 12:29:29 2017 -0300

    Bug 15492: Make existing code aware of new self_check* permissions
    
    This patch makes the existing code for SCO use the new permissions schema
    for self check modules. Specifically addresses this change:
    
      circulate  => self_checkout
    becomes
      slef_check => self_checkout_module
    
    about.pl checks are dejusted too.
    
    get_template_and_user gets refactored to avoid code duplication and the
    conditions are adjusted for the new permissions.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92b29b88c213b7ef6ebbecacc7db896a901880d3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 27 12:24:36 2017 -0300

    Bug 15492: New sysprefs and permissions
    
    In order to make this module unrelated to the SCO module, this
    patch introduces the following sysprefs:
    
    - SelfCheckInMainUserBlock
    - SelfCheckInModuleUserID
    - SelfCheckInTimeout
    - SelfCheckInUserCSS
    - SelfCheckInUserJS
    
    It also adds a new user flag and sub-permission:
    
    - self_check => self_checkin_module
    
    and moves the circulate => self_checkout permission into
    
    - self_check => self_checkout_module
    
    Descriptions are adjusted accordingly.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c5fa90668b2a402cddde3c2f469e3ddb0def63f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 21 12:59:13 2017 -0500

    Bug 15492: (QA follow-up) Reset SCI if idle for 30 seconds
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9bf68c8c3e89bddb23662c9fbd03b7a7514c9955
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 10 15:32:43 2017 -0300

    Bug 15492: Add SCI module
    
    This patch adds the SCI module, and adapts C4::Auth to know about it.
    
    The current behaviour is:
    - Requires admin user initialization/login
    - Uses the logged users' library
    - A form allows to scan multiple barcodes
    - A button sends the barcode list to the controller
      to batch perform the checkins
    - Successful and failed checkins are sent to the template
    - Results are displayed
    - Logout link
    
    To test:
    - Apply this patches
    - Make sure you upgrade:
      $ kshell
     k$ perl installer/data/mysql/updatedatabase.pl
    - Have 'SelfCheckInModule' disabled
    - Go to http://kohadev.myDNSname.org:8080/cgi-bin/koha/sci/sci-main.pl [1]
    => SUCCESS: You are rejected because the feature is disabled
    - Enable 'SelfCheckInModule'
    - Go to the previous URL
    => SUCCESS: You are required to login
    - Login with a user WITHOUT self_checkout permissions
    => SUCCESS: You are not allowed to log into the Self check-in module.
    - Login with a user WITH self_checkour permissions
    => SUCCESS: You gain access, and are presented the UI
    - Go through the several options
    => SUCCESS: All works as it should
    - Click the 'Help' link
    => SUCCESS: A help text is displayed on a modal
    - Sign off :-D
    
    - Bonus points:
      $ kshell
     k$ qa -c 2 -v 2
    => SUCCESS: All tests green
    
    [1] Adjust to your dev's OPAC setup
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76853c347ee49e2a8c3f132e0b786db3df987187
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 10 15:12:56 2017 -0300

    Bug 15492: Add the SelfCheckInModule syspref
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d150eaeca5ba9c9fb3ef2229ce2138526b4db64
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jan 23 20:21:57 2018 +0000

    Bug 20081: Set inline headers for uploaded pdfs
    
    To test:
    1 - Edit a framework and add the 'upload/pl' plugin to the 856 field
    2 - Attach a pdf to one record
    3 - Attach a different type of file to another
    (To attach, edit a record in the framework edited above and find the
     helper by the 856 field)
    4 - Click the links on the record
    5 - Verify the pdf opens inline
    6 - Verify the other file does not
    7 - prove t/db_dependent/Upload.t
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef7805aa3657e47daaa266b5334e98a1c1667d5f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 11 18:19:33 2018 +0000

    Bug 19957: Allow continued editing of report after saving
    
    To test:
     1 - Edit or create a report
     2 - Save it
     3 - Note the report is saved but you can't keep editing
     4 - Clicking 'Edit' returns you to editing
     5 - Apply patch
     6 - Save report
     7 - Note success message remains, but report is still open for editing
     8 - Note when you click the saved/updated message dissappears
     9 - Try again after inserting erros into report (No Select, bad
            authorised value, etc.)
    10 - Note errors stil display as expected
    11 - Verify message works on update of existing report and save of new
          new report
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Joubu: amended patch to fix alignment
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06424503b7c88bdead7cb7008a6a1aff3ced603e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 26 17:10:26 2018 -0300

    Bug 18797: Create the biblioitem entry
    
    We need that since bug 19943
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc2ad5fa9da6eecddffad8e47f7ba5f716229232
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Sat Mar 17 02:24:41 2018 +0000

    Bug 18797: Make rollingloans test useful
    
    TEST PLAN
    ---------
    1) Run the following commands on a kohadevbox:
        kshell
        prove -v t/db_dependent/rollingloans.t
        exit
       -- all the tests were skipped, not useful!
    2) Apply this patch
    3) Redo step 1
       -- all the tests run
    4) Run qa test tools
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 484d4cbbdd203578062f2dd6e15af788a0f7c1e0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Nov 7 15:29:56 2017 +0100

    Bug 19584: Check compare barcodes box when uploading barcodes
    
    This patch makes two trivial changes in the inventory interface:
    
    [1] If you have uploaded a barcode file, the compare barcodes checkbox is
    automatically checked. In most cases this will be the option the user wants.
    The compare will report missed items on the shelf.
    [2] If the compare barcodes checkbox is checked, the Skip items on loan-
    checkbox is automatically checked. This again is often desirable. If you
    compare, you normally are not interested in seeing items reported missing
    while they are checked out.
    
    Test plan:
    [1] Upload a barcode file on inventory. Is the compare checked?
    [2] Toggle compare. Does 'skip items on loan' change accordingly?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Grace Smyth <gracesmythh@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d614eec694f7aff11a54805c57fab1d4a463f24
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Nov 7 15:07:42 2017 +0100

    Bug 19584: Replace label Status by Not for loan
    
    Status does not tell me that this is the Not for loan column.
    Trivial edit.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Grace Smyth <gracesmythh@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d239baf0fb331d4f99b10abef8b7085e579eb9ba
Author: Charles Farmer <charles@inlibro.com>
Date:   Fri Jan 19 16:04:19 2018 -0500

    Bug 19955: Minor grammatical correction
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 830b5a7d7dad1d9d1593c14419496e81f7f4b24c
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Jan 11 13:00:31 2018 -0500

    Bug 19955: Add ability to process only one 'type' of message ( sms, email, etc ) for a given run of process_message_queue.pl
    
    It would be nice to allow emails to be sent overnight, but limit the sending of SMS messages to hours when people are awake. Adding a type limit to process_message_queue.pl would allow this to be accomplished easily.
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd79cf177ee8787b48f1dd81179d5ef60640db4f
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Feb 22 10:51:27 2018 +0100

    Bug 20267: Add basic .gitignore
    
    Ignore files generated by ExtUtils::MakeMaker
    
    NOTE: Limited scope does not affect files created
          by translation utilities
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9eed6c5190818b9ed40bedcb0242be9d8fc34f62
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Tue Nov 28 11:23:01 2017 -0500

    Bug 19708: Improve code for printing the cart in OPAC
    
    This removes a lot of useless code relating to the print function from opac-basket.tt, opac-basket.pl and opac/basket.js.
    
    It also fixes the CSS so that no extra blank page is printed.
    
    To test:
    0) Add an item to your cart
    1) Print your basket
        Note the appearance of the page. There will be an extra blank page.
    2) Apply patch
    3) Reload basket
    4) Print your basket
        The appearce should be identical. The extra blank page is gone.
    
    This only affects the OPAC.
    
    Signed-off-by: Tomás Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: claude <claude.brayer@cea.fr>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46c4aa3551f810e8d1853f5013a282ce4ee95541
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Mon Mar 12 13:20:06 2018 +0200

    Bug 12020: Allow translating label-edit-batch hardcoded strings
    
    Move the hardcoded error strings in the batch label edit into the template,
    so they can be translated.
    
    Test plan:
    1) Apply patch
    2) Go to Home -> Tools -> Label edit
    3) Create a new batch with some items in it
    4) Try to trigger any of the errors, check that the error
       messages look correct
    5) Update a language xx-YY
    5) Check that the error messages show up in xx-YY-staff-prog.po
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Changed branch to library in one of the error messages.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f47a999c9f36ed644b811e0f01b7cdcd11d068f9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 16 10:30:30 2018 +0000

    Bug 20433: Remove unused Mozilla Persona image file
    
    This patch removes an unused image file from the OPAC which was added
    when we added Mozilla Persona authentication but wasn't removed when
    Mozilla Persona went away.
    
    To test, apply the patch and confirm that the image no longer exists:
    
    koha-tmpl/opac-tmpl/bootstrap/images/sign_in_green.png
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9dff376ae1294d147af8eca49891128f509af6a
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Wed Feb 14 11:25:34 2018 +0100

    Bug 20111: i18nize units in Patron card creator
    
    Test plan:
    1. install and switch to the fr_FR locale
         or another one and adapt the test plan accordingly
    2. go to /cgi-bin/koha/patroncards/edit-template.pl?op=new
    3. then you should see the "Unités" dropdown with english units
    4. apply this patch
    5. install the language
    6. refresh the page
    7. then you should see the "Unités" dropdown with french units
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc1bfafbd0c2b9e15f1253a7a7719a9ae889bfa2
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Tue Feb 13 14:27:23 2018 +0100

    Bug 20111: Coding style: Fix indentation before doing actual change
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4680a1e09e4ccf9a9028eb52b98ae0891c16e375
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Mon Mar 5 11:47:25 2018 +0100

    Bug 19522: i18n Label creator: wrap text with <span>
    
    In a SWITCH CASE.
    To avoid pollution and duplication in the .po files.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit abdc75b9a5703714c513e9f7b41e4d4814795d2f
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri Mar 2 14:00:04 2018 +0100

    Bug 19522: Label creator: Batches: make "Export Labels" translatable
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6737704c027f1195ed08c69ab395e3cc26806454
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri Oct 27 15:24:52 2017 +0200

    Bug 19522: Label creator: edit batch: make "Export label" translatable
    
    Test plan:
    1. install the fr_FR locale
    2. go to /cgi-bin/koha/labels/label-manage.pl?label_element=batch
    3. create a batch if there is none
    4. edit that batch
    5. Switch the language to French if you haven't done it yet
    6. click on "Exporter le lot entier"
    7. then you should see "Export labels"
    8. apply this patch
    9. install the language
    10. replay steps 2 to 6
    11. then you should see "Exporter des étiquettes"
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98d4ad2704026a39b8872a170c0a129b15b478fa
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri Oct 27 11:51:21 2017 +0200

    Bug 19522: Label creator: edit batch: make Call number translatable
    
    Test plan:
    1. install the fr_FR locale
    2. go to /cgi-bin/koha/labels/label-manage.pl?label_element=batch
    3. create a batch if there is none
    4. edit that batch
    5. then you should see "Call number" in the column names
    6. apply this patch
    7. install the fr_FR locale
    8. refresh the page
    9. then you should see "Cote" in the column names
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebd523ffd55ba89892986c87bf8cab299d035361
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Thu Oct 26 15:56:54 2017 +0200

    Bug 19522: Label creator: translate empty list message
    
    The name of the element wasn't translated in the message.
    
    Test plan:
    1. install the fr_FR locale
    2. go to /cgi-bin/koha/labels/label-manage.pl?label_element=batch
    3. ensure that the list is empty
    4. then you should see "pas de Batches actuellement"
    5. then you should see "créer un nouveau batch."
    6. apply this patch
    7. install the language
    8. refresh the page
    9. then you should see "pas de Lots actuellement"
    10. then you should see "créer un nouveau lot ."
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49fd4a2dac3ff8b66fc4ff189d0a557c05e41898
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Wed Oct 25 17:17:21 2017 +0200

    Bug 19522: Coding style: Replace tabs with spaces
    
    In Label creator: Templates: new/edit form
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ef987dacfd28ee7d5e63b12e641e96910604284
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Wed Oct 25 15:22:11 2017 +0200

    Bug 19522: Label creator - some strings are not translatable
    
    Templates: new form:
    Add hardcoded unit names to make them translatable.
    
    Test plan:
    1. install the fr_FR locale
    2. go to /cgi-bin/koha/labels/label-edit-template.pl?op=new
    3. then you should see the "Unités" dropdown with english units
    4. apply this patch
    5. install the language
    6. refresh the page
    7. then you should see the "Unités" dropdown with french units
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit febb64260bc629105b0b0dc3c77da4b1452d6b8d
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Wed Oct 25 12:07:43 2017 +0200

    Bug 19522: Coding style: Fix alignement after previous patch
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c3ead6ecd0641306c65a321d642a392a24dca63
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 15 12:37:11 2018 +0100

    Bug 20422: Fix warning on uri_escape_utf8 in Output.pm
    
    When opac-details calls parametrized_url, it triggers an uninitialized
    warning when you would have a record without e.g. author, like:
        Use of uninitialized value in subroutine entry at /usr/share/perl5/URI/Escape.pm line 184.
    
    This is (imo) actually a bug in URI::Escape; it should check its args.
    But we resolve the warning here by adding the "// q{}" in parametrized_url.
    
    NOTE: Along the way we do something similar in the arrParamsBusc loop.
    If the variable is undefined, jump to the next one. (Consistent with the
    approach in the if-part preceding it.)
    
    Test plan:
    [1] Run t/Output.t again. Should pass now.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3503e8119fd453241cb6d3824eeda0af0e5ec5e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 15 14:07:11 2018 +0100

    Bug 20422: Add unit test to Output.t for parametrized_url
    
    This test will reveal that we need to resolve a warning too.
    
    Test plan:
    [1] Run t/Output.t without the second patch.
    [2] The test will fail on the warning raised by an undefined value.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b0df471e653be6e34b0800eeb7c269530195549
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 28 14:26:06 2018 -0300

    Bug 20298: Fix SMS characters counter when TranslateNotices is set
    
    If you have multiple languages installed, the notices and slips page
    uses the same HTML id multiple times, once for each language. This
    prevents eg. the SMS character count javascript from working, because
    each of the textareas has the same id.
    
    Test plan:
    Test the sms characters counter, with and without TranslateNotices
    Make sure other features on this page still work correctly
    
    QA: Make sure this change of id did not break something else.
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c3ec562f1330d9b31033ac16d91ca0ab5ae5fbd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Feb 17 18:48:50 2018 -0300

    Bug 19467: Display description instead of code for itemtype and location
    
    On reports/itemslost.pl you must now see the descriptions instead of the
    code for itemtype and location
    
    Signed-off-by: delaye <stephane.delaye@biblibre.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7465cbac2f2c65d008bcc4870a3bc8d6c5668b71
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Thu Mar 22 15:44:00 2018 +0100

    Bug 20461: Serials: fix ignored params in subscription creation form
    
    In subscription-add.pl, the two params aren't passed to
    NewSubscription() but they are to ModSubscription()
    
    == Test plan ==
    1. Enable syspref "makePreviousSerialAvailable"
    2. Create a minimal subscription with a value in the "Item type" and
         "item type for older issues" fields.
    3. Edit the subscription
    4. You should see that the two fields are empty. This is the bug.
    5. Apply this patch
    6. Do step 2 and 3
    7. You should see that the two fields have the right value
    8. Express the joy of a successful and easy sign off.
       (this is important, otherwise the sign off spell won't work!)
    
    Signed-off-by: delaye <stephane.delaye@biblibre.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74ac5baba5a618174aed679256a274dcdef10166
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 16 15:18:15 2018 -0300

    Bug 20438: Allow uninstalling plugins not implementing the 'uninstall' method
    
    The plugins handling code expects plugins implementing an 'uninstall' method for
    cleanup purposes. It executes this method, and then moves on with removing the
    configuration entries in the storage, and the plugin itself.
    
    But the 'plugins-home.tt' template makes the tool display the 'Uninstall'
    link in the dropdown ONLY when the plugin has the 'uninstall' method.
    
    This patch fixes the issue.
    
    To reproduce:
    - Install the KitchenSink plugin [1]
    => SUCCESS: The 'actions' dropdown for KitchenSink shows an 'Uninstall' option
    - Edit the code for the plugin:
      $ sudo vim /var/lib/koha/kohadev/plugins/Koha/Plugin/Com/ByWaterSolutions/KitchenSink.pm
    - Remove the uninstall sub
    - Restart everything:
      $ restart_all
    - Reload the browser
    => FAIL: There's no 'Uninstall' option in the actions dropdown.
    - Apply this patch
    - Restart everything
      $ restart_all
    - Reload the browser
    => SUCCESS: The 'actions' dropdown for KitchenSink shows an 'Uninstall' option
    - Sign off :-D
    
    [1] https://github.com/bywatersolutions/koha-plugin-kitchen-sink/releases
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 001ce959b625d85d74511b2fe603993a0f3db5d5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 15 10:34:26 2018 +0000

    Bug 20420: Remove unnecessary [% KOHA_VERSION %] from OPAC third-party sources
    
    This patch removes [% KOHA_VERSION %] from the <script> tag for some
    third-party JavaScript sources. [% KOHA_VERSION %] should only be used
    for Koha's JS resources.
    
    To test, apply the patch and enable the SocialNetworks and
    NovelistSelect* preferences.
    
    In the OPAC, view the detail page for a bibliographic record. In the
    right-hand sidebar you should see social network icons for Google+ and
    Twitter. Clicking either of them should trigger a sharing popup window.
    
    If you have Novelist credentials and can enable the feature for the OPAC
    you should see Novelist content in the place specified in your
    preferences.
    
    If you don't have Novelist credentials, put some random text in the
    NovelistSelectProfile system preference. Looking at the detail page in
    the OPAC, view source. You should see a link to Novelist JS around line
    1020 of the source. Clicking the link should show JavaScript. This
    confirms that the path is correct, thus the bug has been fixed.
    
    Note: The QA tool will complain that [% KOHA_VERSION %] is missing. This
    is a false positive.
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4427f90de037e0175383ba2b818f0c85b79c1a32
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 22 10:36:00 2018 +0100

    Bug 20459: Correct message for cancelling an article request
    
    We should not ask for 'cancel this hold'. Remove corresponding TODO.
    
    Fix qa warning on old bootstrap style:
        btn btn-mini => btn btn-default btn-xs
    I removed above change, qa tool complaint is wrong (refers to staff, we
            are on opac)
    
    Test plan:
    Create an article request and cancel it on opac-user.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9007c6e8587196ab05e5727eac1e4bbb6c4ae9e4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Feb 23 14:29:48 2018 +0100

    Bug 20067: Fix other checks for linked authorised value categories
    
    The same pattern was used in other files, this patch fixes it.
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1428615dad77f4a9702f287c461d792e908b5dcf
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Feb 23 14:20:17 2018 +0100

    Bug 20067: Fix false display of authorised value for materials on staff detail page
    
    Koha didn't check for a linked authorised value category for
    Koha didn't check for a linked authorised value category for
    items.materials correctly which led to displaying false information
    on the detail page.
    
    To test:
    - before applying the patch:
    - make sure sample data and configuration is loaded
    - edit any item
    - write 2 in the $3 materials specificed
    - check the details page normal view - it will display 'restocking'
    - apply patch
    - check display, it should now show "2"
    - link 952$3 (MARC21) to ORDER_CANCELLATION_REASON
    - check display again, it should now show 'restocking'
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3dfd5226d0c077428df797fb8b829ed7f333748
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jan 24 14:23:30 2018 +0100

    Bug 20085: Better translatability of smart-rules.tt
    
    Template smart-rules.tt in administration contains some if/elsif/else with translatable strings.
    For example :
    [% IF rule.onshelfholds == 1 %]
        Yes
    [% ELSIF rule.onshelfholds == 2 %]
        If all unavailable
    [% ELSE %]
        If any unavailable
    [% END %]
    
    Adding span to translatable strings will allow to have the same translation than :
    
    <select name="onshelfholds" id="onshelfholds">
        <option value="1">Yes</option>
        <option value="0">If any unavailable</option>
        <option value="2">If all unavailable</option>
    </select>
    
    This is important to allow editing an existing circulation and fine rule.
    
    Actually for example in french some strings are translated differently :
    msgid "%s Yes %s If all unavailable %s If any unavailable %s"
    msgstr "%s Oui %s Si tous indisponibles %s Si aucun indisponible %s"
    
    msgid "If any unavailable"
    msgstr "Si au moins un exemplaire est indisponible"
    
    Test plan :
    1) Look at PO files, for example fr-FR and see there is :
    msgid "%s Yes %s If all unavailable %s If any unavailable %s"
    msgid "If any unavailable"
    2) Apply patch
    3) update PO files
    4) Look at PO files, for example fr-FR and see there is now only :
    msgid "If any unavailable"
    5) Install translation
    6) Go to Administration > Circulation and fine rule
    7) Check that when editing an existing rule, edition comboboxes are set on the correct value
    8) Create a default holds policy by item type and check that correct values are displayed in table
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 952b2242cfccec7a5cedcc858942f940f80d757b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 23 13:02:29 2018 +0000

    Bug 20299: Koha is a gift
    
    This patch updates the database update script replacing the "pile of
    poo" emoji with the "wrapped gift" emoji.
    
    To test, apply the patch and go to Administration -> System preferences
    -> Local use. Set the "Version" preference back to trigger a database
    update. Go through the database update process and confirm that the
    "Convert DB tables to utf8mb4" upgrade message includes a gift emoji.
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 423fa9cc8f9bc1976296a3c5e26845b0c0d24608
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 2 15:42:12 2018 -0300

    Bug 18593: Move suggestions when bibliographic records are merged
    
    When bibliographic records are merged, the suggestions.biblionumber
    field should be replaced with the new record.
    Ideally we should have kept an history of the merges, to know what was
    the original record. Now we cannot fix the broken links.
    
    Test plan:
    1) Create a suggestion in OPAC
    2) Accept the suggestion in staff
    3) Add order from this suggestion
    4) Go to cataloguing search and search for the record and another
    5) Merge the suggestion record with the catalog record - catalog record wins (should be the more common case when a patron suggests something that already exists)
    6) Verify that after merging, the new title displays in the acquisition record
    7) Verify that the suggestion info no longer displays in basket
    
    From Katrin's test plan:
    8) Verify that the new title doesn't display in suggestions. The old title will still show as suggested (not updated)
    => This is the title from suggestions.title, I think it makes sense to show this one.
    Maybe we should open a new bug report to improve the display of the suggestion, and link to the bibliographic record
    
    Signed-off-by: Lucie Gay <lucie.gay@ens-paris-saclay.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bdd4c02af25873aed550bd1e312d07fa9b229f0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 26 16:55:51 2018 -0300

    Bug 18789: (follow-up) Fix place hold page
    
    This patch fixes very weird behaviours introduced by
      commit 0ab22e1c7c6b6e8d14a4fb7478ab2a3d42da347d
      Bug 18789: Send Koha::Patron object to the templates
    
    The patron variable was only set when no action was defined.
    This patch restores the feature the easiest way possible (less changes)
    even if it is not the best one.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d553fa72111c9168d07ae218bdcfc31761db631
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Mar 23 19:25:20 2018 +0000

    Bug 18570: Follow up to fix test noise
    
    This sets a valid email and changes the tests
    to expect it was sent.
    
    prove t/db_dependent/Passwordrecovery.t
    -- noise before patch
    -- no noise after patch
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13ae64db80e98cf0ac0913fa302aa4499cc56b33
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 13:22:35 2018 -0300

    Bug 19943: Fix Borrower_PrevCheckout.t - create the biblioitem entry
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac21d687a13581b80489d0d901f28b80195ed773
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 13:20:49 2018 -0300

    Bug 19943: Fix SwitchOnSiteCheckouts.t - create the biblioitem entry
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07dedc7dbbcf72c2908aa890f67da2d048ade448
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 13:18:59 2018 -0300

    Bug 19943: Fix dateexpiry.t - create the biblioitem entry
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a90a0ca1c62a6de7525844ad57e5903df6039a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 13:01:18 2018 -0300

    Bug 19943: Fix NoIssuesChargeGuarantees.t - create the biblioitem entry
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f394973124476adcd998340c0aa7a9bae69c2a50
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 13:13:59 2018 -0300

    Bug 4078: Fix test when fr_FR.UTF-8 is installed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe85f7f674d20d6513fb8db25d0b6a1a908cd1fb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 23 13:13:16 2018 -0300

    Bug 20466: Fix fixture syntax in t/Prices.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88fb04d180f5251d3c150e31d767616f08796964
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 9 10:51:53 2018 -0300

    Bug 19943: Gentle error handling for bookcount.pl
    
    This patch tests the required parameters and redirects with a 400 HTTP
    code if parameters are invalid.
    
    It also removes the need for the passed biblioitemnumber which is not
    used at all.
    
    A (now) useless sub is removed too.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9bc1949e9dd544cf791acccbdacf5a595458ef8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 14:38:10 2018 -0300

    Bug 19943: Remove C4::Biblio::GetBiblioItemData
    
    It is no longer used.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6183c0e6a910663fec02bdba66d05f173310f562
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 14:37:20 2018 -0300

    Bug 19943: Koha::Biblio - Replace GetBiblioItemData with Koha::Biblio->biblioitem
    
    The biblioitem's info can be retrieved with Koha::Biblio->biblioitem
    
    Test plan:
    1. Use the age restriction to restrict checkouts for a given patron
    2. Check some items of a biblio out, go to "Items" tab, then "View
    item's checkout history" link. Compare views with and without patches
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3953fdb921d7f280ffbaca813956357aa67d42ca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 14:29:50 2018 -0300

    Bug 19943: Remove itemtype vs itype confusion in CanBookBeIssued
    
    Just a preliminary step to clean the code a bit in CanBookBeIssued.
    The effective item type is already set from GetItem and we do not need
    to deal with that again.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ebc2aa6e2133594335f445a9fa89dc6266c0579
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 13:58:53 2018 -0300

    Bug 19940: Koha::Biblio - Remove GetBiblioItemInfosOf
    
    This subroutine is only used once and can be replaced easily with a
    Koha::Biblioitems->search call
    
    Test plan:
    Test this on top of bug 19941 and confirm that the correct item types
    are displayed
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb336e633bf7e0cb25051a8ed8157af8486a58d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 13 13:04:01 2017 -0300

    Bug 18255: Koha::Biblio - Replace GetBiblioItemByBiblioNumber with Koha::Biblio->biblioitem
    
    The subroutine GetBiblioItemByBiblioNumber considers that we have a 1-N
    relation between biblio and biblioitems, which is wrong (it's 1-1).
    So the calls can be replaced with Koha::biblio->biblioitem, it will ease
    the read of the code.
    
    Test plan:
    1. Use the ILSDI service to display info of a bibliographic record,
    biblioitems fields must be displayed
    2. Search for items, biblioitems info must be displayed as well in the
    result table
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab46f93df4049ff3ac7bcfcaaf932dc9446c025f
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 2 06:17:14 2018 -0500

    Bug 19933: Fix typo in template plugin name
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58dccaee26181b42ab3a435e4b84786e3a75bcd3
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 2 06:08:10 2018 -0500

    Bug 19933: Move instantiation of in deletemem.pl
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc2339247bbe60e4f23f4d3993b2774648284674
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 2 06:01:38 2018 -0500

    Bug 19933: (follow-up) Remove patronflags - easy ones
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bddfed75913a2302c19c00b00a6fe86538af6f9f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Jan 7 14:57:23 2018 -0300

    Bug 19933: Remove patronflags - tricky ones
    
    Here we are, patronflags is used in a couple of places where (almost) all flags
    were really useful: C4::SIP::ILS::Patron->new and circulation.pl
    
    This patch only deal with the circulation code as I am not convident
    enough with SIP code.
    
    The change does not seems trivial because of the complexity of the
    existing code, but the logic is the same. We send a variable to the
    template depending on the situation of the patron.
    
    I guess only code eyes ball could catch issue in this patch quickly.
    
    Maybe we need to find a good place in a Koha module to move this code
    and provide code coverage (especially when C4::SIP::ILS::Patron will
    reuse it).
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b61e7145e7046ea042cfb2e7a4c81c89a924001
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Jan 7 14:42:00 2018 -0300

    Bug 19933: Remove patronflags - easy ones
    
    This patch replaces the easy occurrences of patronflags.
    
    These calls only need the CHARGES->amount value, that is the non issues
    charges. Luckily we now have a Koha::Account->non_issues_charges that
    deal with that.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3abb1ace539ce7e68e414400d2c6ba2842dd248
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Jan 7 13:48:16 2018 -0300

    Bug 19933: Remove patronflags - In CanBookBeIssued
    
    The change is trivial here, we only want to pass gonenoaddress, lost and
    is_debared to the template.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5fbda6685fdc6107d57f97a77df9c9c6c0235f6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Jan 7 14:06:14 2018 -0300

    Bug 19933: Remove patronflags - unused vars oldamount/amountold in circulation.pl
    
    There is oldamound/amountold variable that is sent to the template but
    never used later. Let remove it now to avoid useless replacement.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee5885a17a5e5a5e77a0e7efab7c4feb090e8b53
Author: Te Rauhina Jackson <terauhina.jackson@gmail.com>
Date:   Thu Jan 18 02:20:11 2018 +0000

    Bug 16427: Add direct link to authority records from staff detail view (MARC21 subjects)
    
    I added a magnigying glass icon in the staff detail view that links to
    the authority records.
    
    Test Plan:
    1) On the Koha staff page, create a new authority. The type of authority
       will be: Topical Term.
    2) When creating authority, in tab 1 under -HEADING--TOPICAL TERM enter
       the topical term or geographic name entry element and then save the
       new authority e.g. science.
    3) In circulation, search the catalog for a random book. Click the title
       of the book and you will be taken to the book details.
    4) Edit the record and in tab 6, scroll down the - SUBJECT ADDED
       ENTRY--TOPICAL TERM and repeat this tag (the icon next to the title).
    5) Edit the Topical term or geographic name entry element by clicking
       the button on the right of the bar.
    6) In the Search main heading ($a only) enter your topical term e.g.
       science.
    7) Press search, and then in the table that pops up, click 'choose'.
    8) Save your edits and the new topical term will be in the 'Subject(s)'
       list of the book details.
    9) Notice that there is no magnifying glass icon.
    10) Apply this patch
    11) Notice that there is now a magnifying glass icon next to the topical
        term.
    12) Click on the magnifying glass and it will take you directly to the
        authorities records
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f4a0c40c8d32e64c06b10ac4990e31f7fe35fee
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 16 10:16:23 2018 +0000

    Bug 20432: Add black version of small Koha logo for use in the OPAC
    
    This patch adds a black version of the Koha logo for use in OPAC
    customization.
    
    To test, apply the patch and add this CSS to your OPACUserCSS system
    preference:
    
    .navbar-inverse .navbar-inner {
        background: #CCC none;
    }
    
     #logo {
        background: transparent url(/opac-tmpl/bootstrap/images/koha-logo-navbar-black.png) no-repeat scroll 0;
    }
    
    Refresh your OPAC and the top navigation bar should be changed from
    black to grey, and you should see a black version of the Koha logo.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97b8bd5ebc41c4b1aa6792e190c87e82f9578a48
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 22 16:46:19 2018 +0000

    Bug 20275: Add comment to let user know they can define multiple plugindirs
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf0f2d9819e8b11053953b3513c33e51ce979623
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 15 14:51:34 2018 +0100

    Bug 19929: (QA follow-up) Fix POD
    
    Make qa tools happy.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ee8f826f7474023117a4d4f5faa54caf0eef355
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jan 9 11:45:47 2018 +0000

    Bug 19929: Add Koha objects for class sources and sorters
    
    prove -v t/db_dependent/Koha/ClassSortRules.t
    prove -v t/db_dependent/Koha/ClassSources.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5855b015430505568a3e2d9da90e3afa06a5abb8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 14 13:22:46 2018 +0100

    Bug 19454: (QA follow-up) Fix selection on categorycode
    
    A follow-up on a preceding report introduced a join instead of a
    subquery. This made the categorycode ambiguous.
    
    Test plan:
    See former patches.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 906c9166a7c63a4086116ce8711610f2448d2ff3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Oct 16 13:08:22 2017 +0200

    Bug 19454: (follow-up) Add a total line when updating
    
    Test plan:
    [1] Run the script with -doit and -cat [some_category] and verify that
        the printed total is correct.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2610f39c7bbdcf086b21f204c21a7167cefe10b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 12 15:36:10 2017 +0200

    Bug 19454: Add -category parameter to borrowers-force-messaging-defaults.pl
    
    Instead of updating patrons over all patron categories, it would be
    helpful if we could filter on a specified category.
    
    Test plan:
    [1] Select two patrons A and B in say categories C1 and C2.
    [2] Change the msg prefs for A and B away from defaults.
    [3] Run borrowers-force-messaging-defaults.pl -doit -cat C1
        Verify that patron A changed and patron B did not.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Amended: Replace -category by --category. (marcelr 20180314)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1926bda5613edd606d0357695b9a67d20926781
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Nov 29 15:20:19 2017 -0500

    Bug 19716: Add option to send header line for CSV output
    
    Currently, if outputting a CSV file using runreport.pl, you need to look at the report used to know what each column means. It would be nice if we could include column headers.
    
    Test Plan:
    1) Apply this patch
    2) Try using runreport.pl with --format csv --csv-header
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e77982ade1254b48493aac28393888509a054846
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 9 09:51:52 2018 -0500

    Bug 18626: Add unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4297841b98c7f992ef18c400fae2d7d77ae84b9e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu May 11 00:44:12 2017 +0000

    Bug 18626: Add ability to track cardnumber changes for patrons
    
    Some libraries want to keep a history of cardnumber changes for a
    patron. This is a feature that another ILS has.
    
    Test Plan:
    1) Apply this patch
    2) Enable the BorrowersLog
    3) Modify a patron, update his or her cardnumber
    4) Notice the entry in the action log containing the old and new cardnumbers
    5) Edit a patron, leave the cardnumber the same
    6) Note there is no cardnumber change entry in the action logs
    7) Disable BorrowersLog, modify a patron cardnumber
    8) Note there is no cardnumber change entry in teh action logs
    
    Followed test plan, works as expected
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a6c8883cc9022ab70459d978267c883062260a4
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 9 10:49:03 2018 -0500

    Bug 17826: Add POD
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dbc24783eef87520495d4795c9a17a8ab1d4f87a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 29 15:39:28 2016 +0000

    Bug 17826: Allow extended patron attributes to be sent in arbitrary SIP2 fields
    
    Some libraries need to be able to send additional patron data from the
    extended patron attributes in made up SIP2 fields for the patron
    information and patron status responses.
    
    Test Plan:
    1) Apply this patch
    2) Create 3 new patron attributes with the codes CODE1, CODE2, CODE3.
       Make a least one repeatable.
    3) Create a patron, add those attibutes for the patron, make sure there
       are at least two instances of the repeatable code
    4) Edit your SIP2 config file, add the following within the login stanza:
       <patron_attribute field="XX" code="CODE1" />
       <patron_attribute field="XY" code="CODE2" />
       <patron_attribute field="XZ" code="CODE3" />
    5) Using the sip cli emulator, run patron_information and
       patron_status_request messages for the patron
    6) Note the values you set for the patron attributes are sent in the
       corrosponding fields!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Daniel Mauchley <dmauchley@duchesne.utah.gov>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: added parentheses on line 488 when assigning hashref to array.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4537ea270b7b717f37b885dd4f715a74802641d2
Author: Jenny Way <jwayway@hotmail.com>
Date:   Wed Jan 17 20:20:23 2018 +0000

    Bug 19856: (follow-up) Improve styling of reports sidebar
    
    Added divs to report-menu.inc as well. Should work on any reports page
    with sidebar now.
    
    Signed-off-by: claude <claude.brayer@cea.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3441efd1af00f06f8370d332692d8bba2c6be00a
Author: Jenny Way <jwayway@hotmail.com>
Date:   Tue Jan 16 03:24:41 2018 +0000

    Bug 19856: Improve styling of reports sidebar
    
    Test Plan
    1. Open tools page and click on any of the links with a sidebar
    2. Note the layout of the sidebar
    3. Open reports page and click on any of the links with a sidebar
    4. All the sidebars should have the same layout as the tools one
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 567e2ac8874839ec9b2490148c6afeabdfcf591b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 19 17:18:26 2018 -0300

    Bug 20264: DBRev 17.12.00.023
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd29269185cfaea65a0d1eb4ca8003a5b5a984bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 21 15:04:01 2018 -0300

    Bug 20264: Remove syspref checkdigit
    
    According to
    http://irc.koha-community.org/koha/2013-06-26#i_1333289
    http://irc.koha-community.org/koha/2013-06-26#i_1333589
    and Hea data, this syspref is no longer in used and is always set to
    false.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c40e07d6a6ddead18d6851bb1ee211b0897348db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 19 17:16:26 2018 -0300

    Bug 4078: DBRev 17.12.00.022
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2cf899a90117d63b7706b83af2b8d863b94c767
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 1 14:35:06 2018 -0300

    Bug 4078: Add a new test
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18e72e31957a51206875ac27d92929909a90ef34
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 1 14:32:39 2018 -0300

    Bug 4078: Add the ability to display and configure the symbol for prices
    
    The symbol of currencies are not displayed (or not correctly) so far.
    This patch set adds the ability to configure the display of the symbol
    (with or without a whitespace between the symbol and the price).
    
    Test plan:
    1. Execute the update DB entry, go to the currency admin page and tick the
    new "Space separation between symbol and value" checkbox
    2. Add a fine to a patron and use their credentials to login at the OPAC
    3. You should see the "$ 42 due fines and charges" info in the
    dashboard
    4. Untick the new checkbox to remove the space and reload the OPAC main
    page.
    => The space should not be longer displayed ($42)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d03a4008240380a342ba6d7734c00f699f57902c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 1 14:31:48 2018 -0300

    Bug 4078: Pass with_symbol to module
    
    The template plugin did not pass the with_symbol flag to the module and
    so was not taken into account
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 841d592d3577115296007e254c1444a52fa29289
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 1 14:31:25 2018 -0300

    Bug 4078: Add the checkbox to the UI
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8627fde517c5c47e38700379ecc8f1c021c0651e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 1 14:30:53 2018 -0300

    Bug 4078: Update DB entry - add new column currency.p_sep_by_space
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 11c1829dc306d801502e5b38555b2cf3f6cef9d2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 1 14:30:39 2018 -0300

    Bug 4078: DBIC Schema changes
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 736f8a9205b02c89fe007759d581d23f84c5d09a
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Wed Jan 24 15:52:50 2018 -0500

    Bug 17457: Add tests for each marc flavour
    
    + Added a `run_flavoured_tests` sub that runs for each MARC flavour
    * Moved SearchWithISBNVariation tests to the new sub
    
    I copied a lot of the necessary utility functions over Biblio.t (as of Jonathan's suggestion). I also tried to name and organize the code in such a way that it can be reused if anyone else needs to run "flavoured" tests in the future.
    
    prove t/db_dependant/Acquisition.t  OK
    QA tool green
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1c14d25d1bcf1cacb7bdeef3bfc7581f5c830ec
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Mon Sep 25 16:22:51 2017 -0400

    Bug 17457: Adv. Acquisition search with ISBN variations
    
    Advanced acquisition search will now follow the "SearchWithISBNVariations" system preference.
    
    Test plan :
    0) Make sure you have orders pending or completed
    1) Enable SearchWithISBNVariations if it is not enabled
    2) Search for one of your orders by its ISBN, it should appear
    3) Search for the same order by a variation of its ISBN, I used this website to find it : http://www.hahnlibrary.net/libraries/isbncalc.html
    You should not get a result.
    4) Apply patch
    5) Repeat step 2-3. You should get a hit both times.
    6) prove t/db_dependent/Acquisition.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dda23db34b36992d8694858afe1bb29484ced3f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Mar 2 12:36:20 2018 +0000

    Bug 19160: Add POD
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c55515d2daf1c9ed5fb09e5dc39667f4f39dbd85
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Mar 2 12:32:09 2018 +0000

    Bug 19160: Remove tab characters causing qa script to fail
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84ca0487a05ea7532d68baa7526796cc13d55552
Author: Ulrich Kleiber <ulrich.kleiber@bsz-bw.de>
Date:   Wed Feb 7 10:06:20 2018 +0100

    Bug 19160: (follow-up) Fix problems introduced by renaming logout_required to logout_if_required
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c0be579fe6ce476ee4809321b63b0f215551fb4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 11 15:43:42 2018 -0300

    Bug 19160: Isolate CAS code into its own module
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b85f8c9e2ad2ea5efa5a9b57df5614f24d8d9fdd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 11 15:37:18 2018 -0300

    Bug 19160: Move the code from controller to C4::Auth_with_cas
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8857894bd4fe04b1279c8d65826dda1b064a239
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 11 15:29:22 2018 -0300

    Bug 19160: Move duplicated code to its own private subroutine
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61c9f0c5a08273cec1cead966b754278986f3167
Author: Chris Cormack <chrisc@catalyst.net.nz>
Date:   Thu Jun 8 09:38:30 2017 +1200

    Bug 19160: CAS Single logout
    
    CAS supports single logout, where if you logout of one application it
    logs you out of all of them.
    
    This bug implements this
    
    You will need a CAS server (with single logout configure),
    and at least 2 applications (one being Koha)
    
    1/ In Koha login via CAS
    2/ Login to the other application via CAS
    3/ Logout of the other application
    4/ Notice you are still logged into Koha
    5/ Log out of Koha
    6/ Apply patch
    7/ Login to Koha via CAS, login to other app via CAS
    8/ Log out of other app
    9/ Notice you are logged out of Koha
    
    If you dont have CAS, this patch should be a no op, you could test that
    1/ Login and logout normally
    2/ Apply patch
    3/ Login and logout still work fine
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Patch works as described, local login still works correctly.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 450d0e3db1ce3d0eefaefc44d88b777f7ab294bc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 23 13:39:45 2018 +0000

    Bug 20268: (follow-up) Correct template error
    
    The login template must have a class attribute on the body tag in order
    for the template to pass tests.
    
    To test, apply the patch and confirm that the staff client login form
    still looks the same. For further confirmation you could update the
    IntranetUserCSS system preference with something like this:
    
    .main_main-auth {
        background-color: #CCF;
    }
    
    The login form should now have a different background color.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 070c327c98ee49a882638be7a5d667b3ec6d4347
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 19 15:40:09 2018 -0300

    Revert "Bug 20341: Use AuthorisedValues plugin on the staff side"
    
    This reverts commit a67fdf3bd498bf1c5a90c2847570ea8eff9c52da.
    
    I am not sure we already agreed on that: the UI let the ability to
    choose different AV category for each frameworks. I think it should be
    discussed widely before removing this possibility.
    Even if I am pretty sure it is not handle correctly everywhere.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f128ed7710f1d1fb54df7f076f0810ca4dc3d181
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 19 15:38:03 2018 -0300

    Bug 7143: Update about page for new dev - Maksim Sen
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 715fc55d28be57112ede6cfd41a101684513aec5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 19 15:36:52 2018 -0300

    Bug 7143: Update about page for new dev - Jose Martin
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5dc0d1c8bc916ba3acaa6349199f5d9b60ffef8b
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Wed Mar 7 09:35:19 2018 +0200

    Bug 20347: Add missing classes to search results elements
    
    The MARC21 XSLT doesn't add html classes to distinguish between
    certain elements, and there's no way to rely on the element
    positioning, making it impossible to style the elements with CSS.
    
    Add the missing classes to distinguish the elements.
    
    Test plan:
    1) Apply patch
    2) Search for any biblios
    3) Check the search result page table HTML to see that the
       "Publisher", "Edition", "Source", "Other title", and "Online access"
       are wrapped in a span with class of results_summary and one
       of "publisher", "edition", "source", "other_title", and
       "online_access"
    4) Check that the search results of the elements above looks correct
       when compared to the other elements
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Sebastian Hierl <s.hierl@aarome.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79f5051ed767bcc50cd2187a57b136eabbb513fb
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Mar 12 11:51:59 2018 +0100

    Bug 11936: (QA follow-up) Consistent log message for item insert
    
    Fix the same error in another place
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2208e9ca7526f70dc1bf87a8f7fb109b4a269bf
Author: Magnus Enger <magnus@libriotech.no>
Date:   Thu Feb 22 10:37:08 2018 +0100

    Bug 11936: Consistent log message for item insert
    
    If you use bulkmarcimport.pl to import records with items it looks
    like the successfull insert of the record is reported multiple time,
    but the second and subsequent "ok" is really related to importing
    the item(s).
    
    This patch changes the log message on successfully inserting an item
    to match the log message given when inserting an item fails.
    
    To test, the easy way:
    - Look at lines 530 and 536 of bulkmarcimport.pl, and note that the
      "op" in those two lines are different
    - Apply the patch
    - Look at lines 530 and 536 again, and note that the "op" is now
      identical, and that this makes sense, since they are both related
      to the same operation, specifically inserting an item
    
    To test, the hard way
    - Have some records with items
    - Import the records with bulkmarcimport.pl, and make sure to specify
      the -l option, to create a log of the actions taken
    - Look at the log and verify it looks something like this:
      id;operation;status
      1;insert;ok
      1;insert;ok
      2;insert;ok
      2;insert;ok
    - Apply this patch and import some more records with items. The log
      should now be similar to this:
      id;operation;status
      1;insert;ok
      1;insertitem;ok
      2;insert;ok
      2;insertitem;ok
    
    Signed-off-by: Maksim Sen <maksim.sen@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a674795972907e9562b3e5feb881c1e589c8e40d
Author: Claire Gravely <claire.gravely@bsz-bw.de>
Date:   Tue Mar 13 08:53:29 2018 +0000

    Bug 20382: Missing space between patron and cardnumber on check out screen
    
    There should be a space between patron name and cardnumber on the check
    out screen.
    
    This patch adds a space between patron and cardnumber.
    
    To test:
     1 type a patron name into the check out search or go to the check out
     tab from a patron record
     2 Confirm there is no space between patron name and cardnumber on the
     check out page
     3 apply patch
     4 confirm there is now a space
     5 sign off :)
    
    Signed-off-by: Sebastian Hierl <s.hierl@aarome.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a3cc2f98b7d85c1d4f7471be593452c7903ab22
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Wed Feb 14 12:12:52 2018 +0200

    Bug 20195: Untranslatable Show/Hide title attr replacement in opac detail
    
    There's javascript code in opac detail view that tries to replace
    the word "Show" with "Hide" (and vice versa) in a title attribute.
    In addition to those words being untranslatable, a word replacement
    like that would not work properly when using other languages.
    
    Replace the single title attribute with two translatable strings,
    one for the "Show" case and one "Hide", and use the whole
    string instead of trying to replace a single word.
    
    Test plan:
    
    1) Make sure OpacBrowseResults is on
    2) in OPAC, search the catalog and go to the detail view
    3) Hover the mouse over the "Browse results" text in the grey box on the
       right side. The popup text should show something like
       "Show pagination list (1-5 / 5)"
    4) Click on the "Browse results"
    5) Hover the mouse again over the text. The popup should show
       "Hide pagination list (1-5 / 5)"
    6) Update a language xx-YY, translate the new msgids
       "Show pagination list (%s-%s / %s)" and
       "Hide pagination list (%s-%s / %s)", and install the language
    7) Repeat 2-5 with that language, making sure the popup
       texts show up correctly in that language
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7b004689c901af68d65bda6b36054b4242ef6e9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 13 10:15:31 2018 +0000

    Bug 20383: Hide link to plugin management if plugins are not enabled
    
    This patch adds a check in admin-home.pl to see whether plugins are
    enabled. If plugins are disabled, the link to plugins management is
    hidden even if the user has plugin management permission.
    
    To test, view the administration home page with plugins enabled and
    disabled via the enable_plugins flag in the Koha configuration file.
    Also test using users with different plugins permissions:
    
    - Plugins enabled
      - CAN_user_plugins = 1
        -> Plugins link appears
      - CAN_user_plugins = 0
        -> Plugins link hidden
    
    - Plugins disabled
      - CAN_user_plugins = 1,
      - CAN_user_plugins = 0
        -> Plugins link hidden
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 246746759afd39a4bf67aca9fc944b4659fb740d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 12 12:56:08 2018 +0000

    Bug 20372: Correct toolbar markup on some pages
    
    Differences in markup around some toolbars has the potential to create
    CSS styling problems. This patch changes the markup to be consistent
    with other instances of <div id="toolbar"></div>
    
    To test, apply the patch and view these pages:
    
    - Course reserves (main page)
    - Course reserves -> Course detail page
    - Reports -> Dictionary
    
    On each of these pages the toolbar should look correct.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d1525dbf1f0783ef90274b1e925e125bededb37
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 1 16:30:35 2018 +0000

    Bug 20321: Remove get_biblionumber_from_isbn
    
    To test:
    1 - grep get_biblionumber_from_isbn
    2 - verify all occurences are not actual calls (except for test)
    3 - Apply patch
    4 - grep get_biblionumber_from_isbn
    5 - Verify it is removed
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0132ffdcfe759ea16ea6642ce041c6fdde7f9e9
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Jul 6 18:51:56 2017 +0000

    Bug 18908: Warning "Compatibility levels before 9 are deprecated"
    
    The following output:
    
    dh: Compatibility levels before 9 are deprecated (level 7 in use)
       dh_testdir -O--fail-missing
       dh_auto_clean -O--fail-missing
    dh_auto_clean: Compatibility levels before 9 are deprecated (level 7 in use)
       dh_clean -O--fail-missing
    
    is given when trying to following these instructions:
    https://wiki.koha-community.org/wiki/Building_Debian_Packages_-_The_Easy_Way
    
    This merely tweaks the debian/compat file from 7 to 9.
    The message goes away.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    From https://www.debian.org/doc/manuals/maint-guide/dother.en.html:
    You may use compat level v9 in certain circumstances for compatibility with older systems. However, using any level below v9 is not recommended and should be avoided for new packages.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4271f90a06c3fef825e11efe6b53c858a3437f58
Author: Maksim Sen <maksim.sen@inlibro.com>
Date:   Mon Mar 12 16:15:30 2018 -0400

    Bug 20376: Make select/unselect all ignore disabled checkboxes on batch record deletion
    
    Test Plan:
    
    0.1 - find at least one biblionumber that has at least one item checked out
    0.2 - find at least one biblionumber that has zero items checked out.
    1 - Go into the module "Tools > Batch record deletion"
    2 - in "List of biblionumbers or authority ids (one per line)" put the values you found in step 0.1 and 0.2
    3 - click continue
    4 - biblionumbers with at least one item checked out should not be clickable.
    5 - biblionumbers with zero items checked out should be clickable.
    6 - click "Select all" and "Clear all", both buttons should change the "checked" status of the enabled AND disabled biblionumber checkboxes.
    7 - apply patch
    8 - click "Select all" and "Clear all", both buttons should change the "checked" status of ONLY the enabled biblionumber checkboxes.
    
    Signed-off-by: JM Broust <jean-manuel.broust@univ-lyon2.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84bd0a17cc3401eb9718c30ae74c7898e7116cb3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 16:00:20 2018 -0300

    Bug 20219: Remove t/smolder_smoke_signal
    
    The file is no longer used (is it?) and the project looks dead. Let
    remove that file.
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80d6abf886213d85fad562ceb6be82064fafb640
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon Feb 19 10:11:29 2018 +1100

    Bug 20173: Fix favicon.ico path in installer
    
    This patch corrects the favicon.ico path for the installer.
    
    On git installs, it used to point to ./koha-tmpl/favicon.ico,
    and on regular installs, it probably just didn't work.
    
    https://bugs.koha-community.org/show_bug.cgi?id=20173
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f94c8caafa341f395db60dfbfe1645b6885777e
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon Feb 12 13:44:50 2018 +1100

    Bug 20173: Clean up koha-tmpl directory
    
    This patch removes some HTML and ico files that are no longer
    used in Koha.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c53f83afc6cfe49cd5f6424f709ecabb0286a405
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 1 15:00:18 2018 +0000

    Bug 20268: CSS regression: white gap on the top of the staff pages
    
    This patch makes template and CSS changes so that the staff client main
    page doesn't get an unwanted top margin from the Bootstrap-grid
    conversion.
    
    - The unused "main" class is removed from the login page
    - The "main" class on the staff client home page is changed to
      "intranet-main."
    - The CSS for the staff client home page has been modified accordingly.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Open the staff client login page. It should look as it always does.
    - Log in and check the style of the main page. There should be no white
      margin at the top of the page.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ceaf74a287f35986115716700de9a32086d33656
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Oct 31 02:28:58 2017 +0000

    Bug 19547: Deal with --create-db missing debian.cnf issue
    
    Followed test plan. Patch functions as described and both commands execute.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b32870ac016312b1809fca26b4d04b28ea5fcf3
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Oct 30 17:59:43 2017 -0400

    Bug 19547: MariaDB install has no debian.cnf
    
    This attempts to handle issues arising when running
    koha-create on a system that never had MySQL installed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b2e49141586d0c169de5a67349cd9785836b8e6
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Mar 9 11:54:16 2018 +0000

    Bug 18570: (QA follow-up) Improved POD
    
    This tweaks the perldoc for SendQueuedMessages and adds
    some for _get_unsent_messages.
    
    TEST PLAN
    ---------
    
    perldoc C4::Letters
    -- look at _add_attachments (ugly), _get_unsent_messages (non-existent),
       SendQueuedMessages (no reference to borrowernumber or letter_code).
    apply patch
    perldoc C4::Letters
    -- confirm that SendQueuedMessages and _get_unsent_messages
       have reasonable POD information.
    -- notice how _add_attachments' POD is now readable
    
    run koha qa test tools
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70941cde0ec70c4f59ff51abd713594a92cf1e3f
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Mar 8 00:15:33 2018 +0000

    Bug 18570: Send Password Reset Emails immediately
    
    Run through the password reset process, and your server
    should send the message immediate, not waiting for the
    cronjob.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0772f0c55a5ffba2b5e26587ba0ea8c91c09c8c
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Mar 8 00:13:09 2018 +0000

    Bug 18570: Prove that the letter code parameter tweaks work
    
    Run the following commands:
    kshell
    prove -v t/db_dependent/Letters.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73c21c4d30539371bb255346384bfa9f7cd945f8
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Mar 7 23:59:54 2018 +0000

    Bug 18570: Tests to prove if email send was attempted
    
    kshell
    prove -v t/db_dependent/Passwordrecovery.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9ce37ff3e7f351bdf3506e925b1333217743cea
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 16 09:02:36 2018 +0100

    Bug 20430: (See also bug 19436) Button display depends on wrong server count
    
    This is a QA follow-up of bug 19436, submitted separately for ease of
    backporting it. (The bug was not raised by 19436.)
    
    Obviously, the number of authority servers not biblio servers should
    be the key factor for showing or hiding the button for new authority
    records via Z39.50/SRU.
    
    Trivial fix.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aea565e71e0cf81933af3a45e9ad6511ba0a96c3
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Mar 8 03:03:46 2018 +0000

    Bug 20097: (follow-up) Add a unit test
    
    kshell
    prove -v t/db_dependent/Record.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f24e48577f478bf6d5132cce2a59febf8d36ce6d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 29 10:32:28 2018 +0100

    Bug 20097: Use same regex in marc2dcxml and opac-export
    
    This regex allows: dc, oaidc, srwdc, and rdfdc.
    
    Test plan:
    [1] Check https://[yourserver]/cgi-bin/koha/opac-export.pl?bib=[some_biblionumber]&op=export&format=dc
    [2] Check https://[yourserver]/cgi-bin/koha/opac-export.pl?bib=[some_biblionumber]&op=export&format=oaidc
    [3] Check https://[yourserver]/cgi-bin/koha/opac-export.pl?bib=[some_biblionumber]&op=export&format=nodc. This one should trigger a not-supported message.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d479dc5e53e3558207c75b73d58bce23328a61d
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Mar 9 15:49:27 2018 +0200

    Bug 20367: Avoid resetting userid when BorrowerUnwantedField contains userid
    
    To test:
    1. In staff client, set your username to firstname
    2. Add userid to BorrowerUnwantedField system preference
    3. Go to your patron modification screen (memberentry.pl) and click Save
    4. Observe you get kicked out into login screen, saying:
    Error: You do not have permission to access this page.
    Log in as a different user
    
    5. Apply patch and restart plack
    
    6. Set your username back to firstname
    7. Repeat step 3
    8. Observe you were not kicked out and your userid stays the same
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd559df8b9f839b8dcfe765ba0e503a0c65aa3e6
Author: Jose Martin <jose.i.martin.cuesta@gmail.com>
Date:   Wed Mar 7 15:21:39 2018 +0300

    Bug 20348: SIP2 patron identification fails to use userid
    
    Replaces "or" with "||" in variable assignment
    
    second attempt to retrieve borrower was not being executed due
    to changed precedence
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a67fdf3bd498bf1c5a90c2847570ea8eff9c52da
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Mar 9 06:43:18 2018 -0500

    Bug 20341: Use AuthorisedValues plugin on the staff side
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4159512fc5639cccaf1c563e1bc824f3010d3f6a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Mar 6 12:26:19 2018 +0100

    Bug 20341: Show authorized value description for withdrawn like damaged and lost
    
    Actually catalog detail page shows for damaged and lost items the authorized value description if exists.
    We must do the same for withdrawn information.
    
    Test plan :
    1) Set for items a subfield linked to items.withdrawn and using the authorized value category 'WITHDRAWN'
    2) Edit the authorized value category to add value '2' and description 'Eaten by dog'
    3) Edit an item to set this withdrawn value
    4) Go to staff interface and look at items in record detail page /cgi-bin/koh/catalogue/detail.pl :
    => Without patch you see 'Withdrawn' and with patch you see 'Eaten by dog'
    5) Go to OPAc and look at items in record detail page /cgi-bin/koha/opac-detail.pl :
    => Without patch you see 'Withdrawn' and with patch you see 'Eaten by dog'
    
    Signed-off-by: delaye <stephane.delaye@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e24e7ad7f17fb957c6747fa76ff79be30769eaa1
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Feb 5 08:25:03 2018 +0000

    Bug 19908: Do not use .optional in password match validation function
    
    Test plan:
    0) Aplly only first patch
    1) You will be able to submit a from on member-password.pl even if the
    passwords don't match
    2) Apply this patch -> you can't be able to submit the form if the
    paswords don't match, but you'll be able to submit the form when
    password fields are blank
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be4d4a8e28a85f2baf90b03127428cadb551a00e
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Jan 3 10:56:37 2018 +0000

    Bug 19908: Password fields in edit/add patron form should respect BorrowerMandatoryField preference
    
    Test plan:
    0) Do not apply the patch, note the password field is always required
    1) Apply the patch
    2) Try to add and edit patron with and without "password" in BorrowerMandatoryField, it should always respect this setting
    3) Use "Change password" button in patron toolbar, the password field
    should be never required here - when leaved blank, the password is
    unchanged
    4) Play with  minPasswordLength and  RequireStrongPassword preferences,
        to ensure they work as expected
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb97767501a016609743c354b781a0783eb6e66b
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Mar 9 06:58:34 2018 +0000

    Bug 12812: (Follow-up) Fix use of C4::Circulation
    
    Fixes this error:
    Undefined subroutine &main::MarkIssueReturned called at
    misc/cronjobs/longoverdue.pl line 316.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit c8f6a351aceabef991a3ee4a8efa9e37b4d246d7
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Thu Feb 8 06:39:39 2018 -0500

    Bug 12812: Longoverdue.pl --mark-returned doesn't return items
    
    The longoverdue.pl option --mark-returned doesn't work unless the
    --charge option is used as well.
    
    Test Plan:
    1) Run long overdue with --mark-returned and not --charge,
       note your items are marked lost but not returned
    2) Apply this patch
    3) Repeat step 1, the items should now get returned!
    
    Tested with (for example):
    misc/cronjobs/longoverdue.pl --lost 10=1 --mark-returned --verbose
    --confirm
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 37d6bafcf8b8a1570a0344b9817eb6f95f23ce42
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 27 15:54:38 2018 -0300

    Bug 20303: Do not explode when receiving an order if authorisedby not set
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit a36c1051787e0ebea106081f2ff02cf8a8ebffb4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 5 10:27:33 2018 +0100

    Bug 19546: (QA follow-up) Make the returning cd more fool proof
    
    Trivial and hypothetical fix.
    If you create /root/AA B (space in dirname), the quotes added here will
    help you to get back where you came from.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 4e3c60a19295394a5e0c9357504b5efc4228e059
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 2 10:36:34 2018 -0300

    Bug 19546: Run starman from the instance's home dir
    
    This patch makes koha-plack jump into the instance's home directory to
    run.
    
    It is required because Perl 5.18 introduced a breaking change that
    makes perl die if @INC includes directories for which the user doesn't
    have read permission, and need to be traversed when querying for a lib.
    This is the case of '.', which is introduced automatically into @INC
    until Perl 5.26 (which removes the 'feature').
    
    The Mojolicious::Plugins lib prefixes the plugin names with
    'Mojolicious::Plugin' so it first looks (for example) for
    Mojolicious::Plugin::Koha::REST::Plugin::Pagination (Pagination is just
    the first one on the list). When it looks for it at '.' it dies (because
    of Perl's behaviour) so it doesn't query for the right namespace (the
    following to try).
    
    I only reproduced it in koha-testing-docker. To test, you just need to
    try this patched koha-plack and make sure it doesn't break due to this
    permissions issue.
    
    To test:
    - In your koha-testing-docker clone, run:
      $ docker-compose up -p test
    - Open a shell inside the container (on a separate terminal):
      $ docker exec -it test_koha_1 bash
    - From within the /root directory, restart plack:
      $ cd /root
      $ koha-plack --restart kohadev
    => FAIL: Logs show plack is broken due to permissions problems trying to
        find Mojolicious::Plugin::Koha::REST::Plugin::Pagination
    - Use the patched script from this patch:
      $ /kohadevbox/koha/debian/scripts/koha-plack --restart kohadev
    => SUCCESS: Plack runs fine, no error in the logs
    - Sign off :-D
    
    Note: people who has environments in which the problems is reproducible,
        please test this version of koha-plack and stamp your sign-off,
        PLEASE.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 4a90619e583be270dd4e581057a2fc30f48c4537
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Mar 2 10:13:00 2018 +0000

    Bug 20323: Fix batch patron modification tool
    
    Test plan:
    1) Go to Tools -> Batch patrons modification
    2) Select some patrons and try to change any field
    --> without patch - it exploads with log:
    Can't call method "category" on unblessed reference at /home/vagrant/kohaclone/tools/modborrowers.pl
    --> with patch - the modification is properly made
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 4f5d525d66f1436fb1a74f4fc9da3a0d17168e75
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 5 13:36:50 2018 -0300

    Bug 20167: Make changing a hold pass the itemnumber to ModReserve
    
    If you have an item-level hold, changing an attribute (like priority,
    pickup location or suspended until date) makes the hold a biblio-level
    hold, because ModReserve is not passed the current itemnumber.
    
    This patch uses the hold's itemnumber and passes it to the ModReserve
    call.
    
    To test:
    - Run the regression tests from the previous patch:
      $ kshell
     k$ prove t/db_dependent/api/v1/holds.t
    => FAIL: Tests fail
    - Apply this patch
    - Run the tests:
      $ kshell
     k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 00374d0741b5c94ccdbbbc36164d4ef099ab3e2c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 5 13:35:33 2018 -0300

    Bug 20167: Regression test
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit d4e444a01db991f54a771bbca1e689f959ac066c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 5 11:30:15 2018 +0100

    Bug 17717: (QA follow-up) Fix typo chdir
    
    This test does obviously not achieve the desired result:
        [ "chdir" != "no" ]
    Trivial fix.
    Adding the same quotes around starting_dir (just as for Bug 19546).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 6db09ad3b070845539994ff4f1f8b9f7d6d2dfc8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 2 11:51:20 2018 -0300

    Bug 17717: Make cronjobs using koha-foreach use --chdir
    
    In order to patch production sites we need to adjust the shipped
    cronjobs so they are called with the --chdir option switch.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit f312f83dbc14de6e31e15a36f03d5532f5396a8d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 2 11:17:40 2018 -0300

    Bug 17717: Add a --chdir option switch for koha-foreach
    
    Until Perl 5.26, the current directory is added to @INC when running a
    Perl script [1]. Having the current directory in @INC means it can be
    tried to be traversed when performing a lib lookup. Since version 5.18,
    Perl dies when it finds an unreadable directory (permissions) in @INC
    that needs to be traversed. This behaviour won't change because Perl
    devs consider it an enhancement to security. [2]
    
    Because of this, we need to make sure our scripts are ran **from** a
    directory in which they have read permissions.
    
    Ths patch adds a --chdir option switch to the **koha-foreach** wrapper
    script, that makes the inner shells/scripts to be ran within the Koha
    instance's user home directory.
    
    The change is trivial and should be QAed easily. I tested this on a prod
    server:
    
    - Create a /tmp/test.pl file containing:
    
    use Modern::Perl;
    
    use Cwd;
    my $dir = getcwd;
    
    warn $dir;
    
    1;
    
    A) then create a cronjob entry to run it using koha-foreach:
    (in /etc/cron.d/test):
    1/* * * * * root koha-foreach perl /tmp/test.pl
    - Once I noticed the cronjob ran, I used mutt to read the emails in the
    root user.
    => FAIL:
    ...
    Subject: Cron <root@koha> koha-foreach --enabled perl /tmp/test.pl
    
    "/root"
    "/root"
    "/root"
    "/root"
    "/root"
    ...
    
    B) I then used the patched koha-foreach with different results:
    => SUCCESS:
    ...
    Subject: Cron <root@koha> /root/koha-foreach --chdir --enabled perl /tmp/test.pl
    
    "/var/lib/koha/acaderc"
    "/var/lib/koha/agro"
    "/var/lib/koha/anc"
    "/var/lib/koha/arico"
    "/var/lib/koha/artes"
    ...
    
    So this patch's approach works. But...
    
    C) master's koha-foreach seems to work just the same... I think it is
    because of my previous attempt to fix this by using sudo in koha-shell.
    So I think environmental conditions affect the behaviour (which shell is
    configured for cron, sudo configuration, etc).
    
    ====
    
    In conclusion, I think we should go ahead with this patch as it will solve
    peoples issues, and it is a right solution (option #5 on the list) to
    this Perl behaviour change. It doesn't cover other commands, but
    followup patches could do.
    
    I avoided /tmp as it is writable by any user... so it is an easy path
    for both exploiting by replacing some lib, and also because the
    existence of an unreadable dir that the interpreter could try to
    traverse (unreadable /tmp/Authen or /tmp/Koha will trigger the same
    error, and I assume people know what they are putting on the instance's
    dir, at least it will be easier to track).
    
    A followup patch takes care of making the cronjobs use --chdir when
    calling koha-foreach
    
    [1] https://lists.debian.org/debian-devel-announce/2016/08/msg00013.html
    [2] https://rt.perl.org/Public/Bug/Display.html?id=123795
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 184541269307726d7b457ff8beb9637adcd5016b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 28 12:57:25 2018 -0300

    Bug 20251: (bug 19280 follow-up) FIX SIP checkout
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 48c764bd752c1e692aaea80cf54a09c810db5b9c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 27 15:30:18 2018 -0300

    Bug 20286: Fix filter for BakerTaylor* prefs
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit f85f104c3075f097e03eff45c08f51ae7ee5fa11
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 26 10:48:18 2018 -0300

    Bug 20286: Correctly escape URI characters in OPAC RSS template
    
    Bug 19568 use the TT filter url whereas it must have escaped the URI
    characters with the uri filter.
    
    Test plan:
    Subscribe to an OPAC search
    => Without this patch you will get an empty page
    => With this patch applied you will see result list.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 2201fda6c70442860cd8056326baa144adb912e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 28 13:54:32 2018 -0300

    Bug 20311: Prevent get_age tests to fail on Feb 28th
    
    Today Feb 28th 2018:
    If we subtract 18y to this DateTime object 29/02/2000 and so the patron is not major yet
    
    use Koha::DateUtils qw( dt_from_string );
    say dt_from_string('28/02/2018')->add(years => -18);
    say dt_from_string('28/02/2018')->add(years => -18, end_of_month => 'limit');
    
    will display:
    2000-02-29T00:00:00
    2000-02-28T00:00:00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1c75f7bb54e8bc1a7f4a2aec293a2291dcd27be
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Feb 17 11:57:43 2018 -0300

    Bug 19610: Make koha-common.logrotate use copytruncate
    
    This patch makes logrotate use the **copytruncate** directive, removing
    the need to stop the Zebra and Plack servers on log rotation.
    
    To test:
    - Run:
      $ misc4dev/cp_debian_files.pl
    - Edit the new /etc/logrotate.d/koha-common file changing 'weekly' for
    'hourly'. This is to ease testing.
    - Run:
      $ sudo ls -l /var/log/koha/kohadev
    - Open a second terminal on your kohadevbox. On it...
    - Run:
      $ sudo logrotate /etc/logrotate.d/koha-common
    - Run:
      $ sudo ls -l /var/log/koha/kohadev
    => SUCCESS: Files got rotated! (i.e. files ending in .1 are created, the
            sizes make sense (.1 have contents, the ones without numbering
                probably zeroed <- it will depend on what's happening with
                your devbox in between).
    - Play with your Koha, do some searches too:
    => SUCCESS: You have access to your Koha, searches work. i.e.:
         - Apache handled the log rotation operation
         - Plack handled the log rotation operation
         - Zebra handled the log rotation operation
    - Sign off :-D!
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud hagud@orex.es
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a204a15c4b771bd43460913ee98d6632c17d3b8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Feb 17 11:50:16 2018 -0300

    Bug 20234: Update service description in koha-common.init
    
    The service description is very old and outdated. This patch fixes this.
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud hagud@orex.es
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77e95698b4a4f373160adc7827a5434dd2c4560b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Feb 17 11:34:58 2018 -0300

    Bug 20234: Make maintenance scripts use koha-zebra instead of koha-*-zebra
    
    This patch makes all maintenance scripts use **koha-zebra** instead of
    the old **koha-*-zebra** scripts.
    
    To test:
    - Run:
      $ perl misc4dev/cp_debian_files.pl
      $ sudo service koha-common stop
    => SUCCESS: No errors and the Zebra-related sevices are stopped
      $ sudo service koha-common start
    => SUCCESS: No errors and the Zebra-related services are started
      $ sudo service koha-common restart
    => SUCCESS: No erros and Zebra-related services are running
      $ sudo koha-create --create-db test
    => SUCCESS: Instance created and zebra running for it
      $ sudo koha-disable test
    => SUCCESS: No errors and Zebra is stopped for instance test
      $ sudo koha-zebra --start test
      $ sudo koha-remove test
    => SUCCESS: No errors, instance removed, no Zebra running for test
    - Sign off :-D
    
    Sponsored-by: Orex Digital
    
    Signed-off-by:  Hugo Agud hagud@orex.es
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0eb7bf0caf286e4503f94de869b64f48cc020a24
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 16 12:31:39 2018 +0000

    Bug 20218: Fix matching of uri in tracklinks
    
    The current code matches using a regex, this breaks when the url
    contains special characters. We swtich it to equality check
    
    To test:
    1 - Enable TrackClicks (either track or anonymous)
    2 - Find the URL of a biblio in the OPAC
    3 - Paste this into the 856$u of another record
        (or use any url containing a '?' or other characters)
    4 - View the record in the opac
    5 - Click the URL
    6 - 404 Error!
    7 - Apply patch
    8 - Try again
    9 - Success!
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cbf5a4363b9553f099aa842a01688e866adb690
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Tue Feb 27 12:59:56 2018 +0200

    Bug 20302: Allow translating Delete button in Patron batch mod tool
    
    There is an untranslatable Delete-button in the patron batch modification
    tool. Allow translating it.
    
    Test plan:
    
    1) Go to Home -> Tools -> Batch patron modification, put a patron's
       card number in the box, and click on Continue
    2) At the bottom of the screen there is an drop-down entry for
       Attribute, click on the "New" at the nd of that line
    3) There should now be another Attribute -line, with "Delete" -link
       at the end of that line
    4) Apply patch, install a language
    5) Repeat 1-3 in that language, the Delete-link should be shown in
       the correct language, if the msgid "Delete" was translated
       in xx-YY-staff-prog.po
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee33f6f8cc94e2a1213f804c39ed4c060dae2e5e
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Tue Feb 27 09:10:17 2018 +0200

    Bug 20301: Allow translating "View" in manage MARC import
    
    When looking at the table showing the staged MARC records, the "View"
    text in the Diff-column is not translatable. Make it so.
    
    Test plan:
    
    1) Go to Home -> Tools -> Stage MARC records for import
    2) Select eg. t/db_dependent/www/data/marc21record.mrc and upload the file
    3) Click on Stage for import
       -> Manage staged records
       -> Import this batch into the catalog
    4) Wait for zebra to reindex, or trigger it yourself by
       running rebuild_zebra.pl -a -b -r
    5) Go to Home -> Tools -> Stage MARC records for import
    6) Select the same file as in part 2 and upload the file
    7) Change the Record matching rule to ISBN (020$a)
    8) Click on Stage for import
       -> Manage staged records
    9) In the table below, there should now be a line showing
       the staged MARC record matches biblio
    10) Note the "View"-text in the "Diff"-column
    11) Apply patch
    12) Install a language, view the same batch in the
        Manage staged MARC records -page in that language
    13) The "View" should show up correctly, and if the
        msgid "View" was translated in the xx-YY-staff-prog.po,
        should show up in the correct language
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 239106ea05f91eeb2ee125e898b2c3a70554afd3
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Tue Feb 6 12:19:17 2018 +0200

    Bug 20141: Untranslatable string in transport cost matrix
    
    Make the "Disable" checkboxes in transport cost matrix translatable
    
    Test plan:
    
    1) Go to Home -> Administration -> Transport cost matrix
    2) Click on any cell
    3) Note the "Disable" checkbox text
    4) Install patch, add a language, translate the text, etc
    5) Repeat 1-3, the "Disable" text should now be translated
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18b3771d1e47fb97d1763de276a49f6aa69cd46e
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Mon Feb 5 14:45:25 2018 +0200

    Bug 20139: Improve MARC mapping translatable strings
    
    - Allow translating one error message
    - Use string formatting with placeholders instead of concatenation
    
    Test plan:
    
    1) Go to Home -> Administration -> Koha to MARC Mapping
    2) Click on the "Add" button to add a new mapping
    3) Note the popup text looks correct
    4) Enter something invalid
    5) Note the error message
    6) Click on any of the "Remove" buttons to remove a mapping
    7) Note the popup text looks correct
    8) Update, translate the new msgid's, and install a language
    9) Repeat 1-7, note how the message are in the correct
       language
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 348fd052830c8fabed72cd4f679bc506f26b07f0
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Mon Feb 26 12:08:27 2018 +0200

    Bug 20296: Untranslatable "All" in patrons table filter
    
    There's an untranslatable "All" in the "Show X entries" filter
    when browsing the patrons.
    
    Test plan:
    
    1) Home --> Patrons --> Browse by last name.
    2) In the table filtering toolbar, there's a dropdown with
       "Show [20] entries" and the last in the dropdown is "All".
    3) Update and install a language, check that msgid "All" is
       translated and isn't fuzzy.
    4) Check the "All" in the dropdown, it is not translated.
    5) Install patch, repeat 1-3, and check the "All" in the dropdown,
       it should now be translated.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df8bac232eed0f99468cb4aa1909100a5856076f
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Mon Feb 26 11:10:10 2018 +0200

    Bug 20295: Allow translating link title in ILL module
    
    Allow translating "View borrower details" link title in the ILL module.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5db35e919a5a786337615d925da8becaf64bb63c
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Feb 14 20:19:01 2018 +0000

    Bug 20201: Silence warnings triggered by admin/aqplan.pl
    
    TEST PLAN
    ---------
    0) back up DB
    1) Run the following commands on a kohadevbox:
        reset_all
        git bz apply 20185
        echo | sudo tee /var/log/koha/kohadev/plack-error.log
        restart_all
    2) Navigate in a staff client:
        Home -> Administration -> Budgets -> Edit -> Planning by libraries
       -- could be any of the planning, but by libraries is nicely visible
       on screen.
    3) Run the following commands:
        cat /var/log/koha/kohadev/plack-error.log
       -- several warnings.
    4) Run the following commands:
        git bz apply 20201
        echo | sudo tee /var/log/koha/kohadev/plack-error.log
        restart_all
    5) repeat step 2 and refresh the staff client page.
       -- this time warnings related to aqplan.pl are not there.
    6) run koha qa test tools
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bc1a8daa209c2596d10076b8a292dddc7b4e947
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Feb 20 21:42:13 2018 +0000

    Bug 20290: Fix capitalization of "Routling List"
    
    This fixes some strings to be properly capitalized.
    
    To test:
    - Create a new routing list, check title and breadcrumbs
    - View the routing list tab in the patron account in staff,
      check title and breadcrumbs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae9a246840296f2356952df42d5926c8264e9232
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 27 11:40:13 2018 -0300

    Bug 19979: ->count and be called directly on Koha::Objects
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 670712e57cbd197339d5ead5332b4ffd79bf22b8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 16 14:28:36 2018 +0100

    Bug 19979: Fix get_facets_info test in Search.t
    
    The test should remove the holdingbranch key in the expected results when
    there is only one branch.
    See the logic in C4::Koha.
    
    Test plan:
    [1] Run Search.t on a database with multiple branches.
    [2] Run Search.t on a database with one branch. Without this patch the test
        would fail: Failed test '_get_facets_info returns the correct data'.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e476fe45713c51413445da22af50819856a6f02
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Tue Feb 6 13:01:36 2018 +0200

    Bug 20142: Allow translating offline circ message
    
    Allow translating the notification saying you cannot change branch or
    logout while offline.
    
    Test plan:
    
    1) Enable AllowOfflineCirculation
    2) Go to Home -> Circulation -> Built-in offline circulation interface
    3) Try to change your branch. Note the notification message
    4) Apply patch, install language, translate the notification
    5) Repeat 2 and 3 in that language. The message should be translated
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dea5572991b0f5130ee365eb173a46bfdc60093e
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Tue Feb 6 14:17:45 2018 +0200

    Bug 20147: Allow translating prompt in label edit batch
    
    Fix one untranslatable prompt in the label batch edit.
    
    Test plan:
    
    1) Go to Home -> Tools -> Label creator
    2) Click on New -> Label batch
    3) Add items to the batch
    4) Select any of the items
    5) Click on "Remove selected items"
    6) Note the popup text
    7) Apply patch, update a language, translate the msgid
       "Are you sure you want to remove label number(s): %s from this batch?"
    8) Repeat 1-6. The popup text should now be translated.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df666bcab60636eb2b2fc6c87b870bd6782cc3a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 27 11:25:03 2018 -0300

    Bug 13287: Fix DBRev message
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 775adc1e9adbc647b3389019ded546b81e46c6e3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 26 13:23:38 2018 -0300

    Bug 13287: DBRev 17.12.00.021
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec6fe57db001ddfd659b894a534286cdf923f502
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 26 13:01:05 2018 -0300

    Bug 13287: Remove warning if --days is not passed and pref empty
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c39ea95e3806e55bd12a4f5e993b4f79ba87ba4a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 23 10:33:49 2018 +0100

    Bug 13287: (QA follow-up) Final polishing
    
    Cosmetic changes.
    And: adding a confirm flag (see earlier comment too). Without this flag but
    with having a filled pref, the script would purge when you do not pass any
    parameter. This might not be appreciated.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d88c0803e6f76db99aefc1b44b14789818fb69ae
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 23 10:00:13 2018 +0100

    Bug 13287: (QA follow-up) Extend Suggestions.t for DelSuggestionsOlderThan
    
    Adding a days>0 test in the sub with a POD line.
    Specific subtest for this sub added in Suggestions.t.
    
    Test plan:
    Run t/db_dependent/Suggestions.t again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b241555b0abe0ade8aa5fb088acdf2bc26cefe60
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 23 09:15:55 2018 +0100

    Bug 13287: (QA follow-up) Prepare Suggestions.t for changes
    
    Just rearranging some modules here.
    Adding Koha::Database and schema calls.
    
    Test plan:
    Run t/db_dependent/Suggestions.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 053d9a58ac057b8e72c050751540dda1f827ddbe
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Feb 23 19:29:36 2016 -0500

    Bug 13287: (QA follow-up) Add db revision
    
    Added missing upgrade SQL system preference.
    Corrected system preference screen message
    Fixes on purge_suggestions.pl
    - perlcritic friendlier
    - address $PERL5LIB comment by using $PROGRAM_NAME (comment #10)
    - used STDERR (comment #10)
    - perltidy
    
    TEST PLAN
    ---------
    $ ./installer/data/mysql/updatedatabase.pl
    -- should run upgrade and generate new systempreference in table
    $ ./misc/cronjobs/purge_suggestions.pl --help
    -- should give help with a real path used instead of $PERL5LIB.
    $ ./misc/cronjobs/purge_suggestions.pl -days -1
    -- should give error message as expected
    $ ./misc/cronjobs/purge_suggestions.pl -days 0
    -- should give error message as expected
    
    Go to OPAC system preferences tab and check the
    PurgeSuggestionsOlderThan system preference
    -- message should be as expected (see comment #9)
    
    run koha qa test tools
    -- all should pass
    
    Signed-off-by: Marc Veron <veron@veron.ch>
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Moved new pref from OPAC to Acquisitions preferences.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit badaf236c9d49d852cb4bcb5754b9f032cd8b6c6
Author: Remi Mayrand-Provencher <remi.mayrand-provencher@inLibro.com>
Date:   Tue Jul 28 12:10:59 2015 -0400

    Bug 13287: Add a system preference to define the number of days used in purge_suggestions.pl
    
        The system preferences value is used whenever purge_suggestions.pl is called without the 'days' parameter.
        This patch uses the preference description suggested by comment #9.
        This version should now be cleanly applicable.
    
        I Apply the patch
        II Run updatedatabase.pl
    
        a) Run purge_suggestions.pl without the days parameter
           - validate that there is an error message
        b) Run purge_suggestions.pl with the days parameter
           - validate that there is no error message
        c) Insert a number of days in the system variable PurgeSuggestionsOlderThan
        d) Run purge_suggestions.pl without the days parameter
           - validate that there is no error message
    
    Signed-off-by: Liz Rea <liz@catalyst.net.nz>
    Tested per plan, all tests pass.
    
    Signed-off-by: Marc Veron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e466f0d1e390530de317ad34bb9495ef8a3b64f3
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Tue Feb 6 10:11:27 2018 +0200

    Bug 20140: Allow translating more of OAI sets
    
    Allow translating two strings in the OAI set config:
    "setDescription" and "Remove"
    
    Test plan:
    
    1) Go to Home -> Administrator -> OAI sets config -> Add a new OAI set
    2) Click on "New set"
    3) Click on "Add description"
    4) Note the "setDescription:" and "Remove" -texts
    5) Install patch, update language, translate the new strings
    6) Redo 1-4, note how the strings in part 4 are now translated
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dd344d6d6c95afd0bbb1f0095a256fea7a8d8dd
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Feb 16 11:21:09 2018 +0100

    Bug 20225: Remove unused script reports/stats.print.pl
    
    Test plan:
    1. Verify that there is no remaining references to this script
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    Signed-off-by: Maksim Sen <maksim@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=20255
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3d46287a992e946039c03c84d3327f7c4b43413
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 26 13:09:18 2018 -0300

    Bug 20082: DBRev 17.12.00.020
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f0a5a4f48cf4c70dd18d5a316eef3f22c0199d8
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Feb 1 07:42:13 2018 +0100

    Bug 20082: Correct description of Vietnamese language and add German translation
    
    Fixes the language description of Vietnamese according to the
    bug report and adds the German translation for the language
    name.
    
    To test:
    - Run the database update
    - Verify that the new descriptions Tiếng Việt shows
      in advanced search language pull down
    - Install German translations
    - Verify that the German translation 'Vietnamesisch'
      shows in the pull down when German is selected.
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cd75a0eb28db29779de85e29e4c485dd2dbb6fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 14 14:17:58 2018 -0300

    Bug 20199: Send a DateTime to DBIC instead of an iso formatted date
    
    We do not need to format the date, DBIC handles DateTime correctly.
    
    It fixes t/db_dependent/Letters.t with new SQL modes
    
    Test plan:
      prove t/db_dependent/Letters.t
      prove t/db_dependent/Koha/Acquisition/Order.t
    Must return green
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 912824a9b187aac7c09d31c91b3c6056e3ec538e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 14 14:13:15 2018 -0300

    Bug 20199: Add tests for Koha::Acq::Order->store
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1df9aad54cb1acdacfb0e5681ef83e1b7f24eec
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Feb 26 10:59:13 2018 +0100

    Bug 20075: Update installer files for uk-UA
    
    Instead of the very laborious task of going thru all these files line by
    line, I am adding a statement at the very end to correct hidden values.
    
    Test plan:
    Run a new Ukrainian install or run a few files on an empty database.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f06cc501be05fe6c2cc6099d2122006dee12496
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Feb 26 10:48:50 2018 +0100

    Bug 20075: Update installer files for ru-RU
    
    Instead of the very laborious task of going thru all these files line by
    line, I am adding a statement at the very end to correct hidden values.
    
    Test plan:
    Run a new Russian install or run a few files on an empty database.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd8775c53aa2818cd9434821ce6f96ffbd62cb0f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Feb 26 09:59:03 2018 +0100

    Bug 20075: Adjust installer files for de-DE up to pl-PL
    
    We are replacing the values -5 or 8 here by 1 for the hidden field in
    auth_subfield_structure.
    Note that 1 is mainly used in MARC21 and -5 in UNIMARC.
    Since it is a boolean, I choose here for keeping 0 and 1.
    
    The value 8 was only used for field 942 in MARC21 files.
    The value -5 was replaced in
    en/marcflavour/unimarc/mandatory/authorities_normal_unimarc.sql
    it-IT/marcflavour/unimarc/necessari/authority_framework.sql
    pl-PL/marcflavour/unimarc/mandatory/authorities_normal_unimarc.sql
    
    NOTE: The french unimarc files
    fr-FR/marcflavour/unimarc_complet/Obligatoire/autorite_default.sql
    fr-FR/marcflavour/unimarc_complet/Obligatoire/autorites_norme_unimarc.sql
    fr-FR/marcflavour/unimarc_lecture_pub/Obligatoire/autorites_norme_unimarc.sql
    seem to display all fields, since hidden is 0 everywhere.
    
    Test plan:
    Test a new install in one of the languages.
    Or run the sql script on an empty database.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2a376db26904e30f4eec51e17c976652a0fe8b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 26 13:06:15 2018 -0300

    Bug 20074: DBRev 17.12.00.019
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5db0f7e4c6514b137cfe08e32260dd9694bf33c8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Feb 26 11:43:43 2018 +0100

    Bug 20074: (follow-up) Replace hidden value -5 by 1 in data and interface
    
    [ Moved from 20075 to 20074 ]
    
    Since hidden is used as a boolean, it makes more sense to save the values
    0 and 1 instead of 0 and -5.
    
    Test plan:
    Test toggling between Show all and Hide all in the auth frameworks.
    Run the db rev.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b25d81dc69a758f900b72fbff0c7fc99bc59fa2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 23 15:59:06 2018 +0100

    Bug 20074: (follow-up) Remove another remainder of biblio hidden logic
    
    Script authorities.pl still contains a module 2 calculation on the hidden
    attribute, although it is used as a boolean.
    Since -5 mod 2 == 1, it does no harm, but we better remove it.
    
    Test plan:
    Edit and save an authority. Verify that everything still works as expected.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08aba08a926f3956324cb66a049942f38810b525
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 23 15:21:27 2018 +0100

    Bug 20074: Database revision to convert hidden to -5
    
    The hidden value is used as a boolean in authority frameworks (in contrast
    with biblio framework).
    It is consistent to apply the same value (-5) to all non-zero values.
    
    Test plan:
    Check if you a have 0, 1 and 8 value in hidden somewhere.
    Run the dbrev.
    Verify that 1 and 8 are converted to -5.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42ed26660b7c8c05a66a99a1e458f303481119dd
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 23 15:16:35 2018 +0100

    Bug 20074: Fix hidden value in auth_subfields_structure
    
    The template included an else branch where a value not equal to 0 or -5
    was interpreted as 0 (Show all).
    This effectively converted hidden values 1 and 8 to 0.
    This patch removes that else branch.
    
    Test plan:
    Toggle a authority field between Hide all and Show all. Check what happens.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45bb8a8225d88f43125803c0994245915cd4b3cc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 15 15:27:31 2017 +0000

    Bug 19823: Move template JavaScript to the footer: MARC21 editor plugins
    
    This patch modifies the templates for MARC21 editor plugins so that
    JavaScript is included in the footer.
    
    To test, you must link the plugins to their corresponding tag +
    subfield (if they aren't already):
    
    In a bibliographic framework:
    
    000 -> marc21_leader.pl
    006 -> marc21_field_006.pl
    007 -> marc21_field_007.pl
    008 -> marc21_field_008.pl
    773$t -> marc21_linking_section.tt
    
    In an authorities framework:
    
    000 -> marc21_leader_authorities.tt
    008 -> marc21_field_008_authorities.tt
        -> marc21_field_008_classifications.tt
    
    For each field, trigger the plugin by clicking the plugin link. Test
    JavaScript-driven functionality in each plugin window and confirm that
    your selections are correctly saved to the editor.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Edit: Fix for QA, add KOHA_VERSION variables to js includes
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d2e91a5730c1916a05134fa56e7557d4fc51f36
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Dec 5 17:17:15 2017 +0000

    Bug 19754: Move template JavaScript to the footer: Acquisitions, part 2
    
    This patch modifies some staff client acquisitions templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    - Acquisitions -> Invoices
      - Datepickers
      - Search for invoices
        - Datatable
    - Acquisitions -> Late orders
      - Datepickers, datatables, selection controls (when searching by
        vendor)
    - Acquisitions -> Vendor -> Basket -> Add to basket -> From an existing
      record -> Search
      - Datatables, View MARC modal
    - Acquisitions -> Vendor -> Basket -> Add to basket -> From a new
      (empty) record
      - Form validation, inactive fund control, add users to notify on
        receiving.
    - Acquisitions -> Vendor -> Basket -> Add to basket -> From a
      subscription -> Search
      - Datatables, show only renewed, show/hide search form
    - Acquisitions -> Vendor -> Basket -> Add to basket -> From a suggestion
      - Datatables, "Show" controls
    - Acquisitions
      - "Ordered" link in table of funds
        - Datatables
    - Acquisitions -> Vendor -> Receive shipment -> Invoice -> Receive
      - Datepickers, item add form plugins (test with AcqCreateItem set to
        'receiving an order.'
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit efa894e625b4097ca0c1b41380a8d8afec5dc273
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Feb 19 22:43:32 2018 +0000

    Bug 12001: (QA follow-up) Fix showing links to items on boraccount page
    
    Test plan:
    Go to the Fines -> Account page of a patron with fees linked to items
    --> without patch there is no link to related item
    --> with patch the link is presented in description column
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d81f371e2dfacb4da9eecdb4ed521af581c67fc4
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Feb 19 22:31:54 2018 +0000

    Bug 12001: (QA follow-up) Fix patron account summary print
    
    Test plan:
    Try to print patron account summary
    --> without patch it explodes
    --> with patch it works, and if there is a fee related to item, the title should be printed out
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e83779f2f68a16f72f5e3ffa5494424c4e182db
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Feb 19 21:24:32 2018 +0000

    Bug 12001: (QA follow-up) Add test for Koha::Account::Lines object
    
    Test plan
    prove t/db_dependent/Koha/Account/Lines.t
    --> should be green
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d9245d7b21f1bd0b403940e12156ff364a8f6e8
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Feb 19 20:49:02 2018 +0000

    Bug 12001: (QA follow-up) Fix printinvoice page
    
    Test plan:
    Try to print a fee
    --> without patch it explodes
    --> with patch it works and the date is formatted according to
    system wide date format setting
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2410aaca23548be9817dfcec9f66d8999390cd67
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 16 15:05:30 2018 -0300

    Bug 12001: (QA follow-up) Explicit return
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcd495de24dd2bca4079a25e6b0a968b3b40f899
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Jan 7 13:41:07 2018 -0300

    Bug 12001: Format DEBT correctly
    
    Before this patchset, DEBT was formatted in the module, now it should be
    done template-side.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e479921bfdd0983e76c3c0d7f2e4bb568aa299e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 18:00:24 2018 -0300

    Bug 12001: Prove that result are the same \o/
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6355791848585f7ef490b1c63f64790b9a783e73
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 17:25:41 2018 -0300

    Bug 12001: Move GetMemberAccountBalance to Koha::Account->non_issues_charges
    
    As said previously, GetMemberAccountBalance returns ( the balance, the
    non issues charges, the other charges)
    
    The other charges are the balance - the non issues charges.
    
    In this patch we remove the subroutine from C4::Members and use the
    new Koha::Account->non_issues_charges subroutine instead
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9558f77866fa3fd530eb615b8f5d277d1b8c608
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 17:46:51 2018 -0300

    Bug 12001: Add tests
    
    Yes, we need tests to make sure we understand what is going on in this
    subroutine.
    The different combination of HoldsInNoissuesCharge,
    RentalsInNoissuesCharge and ManInvInNoissuesCharge are tested here with
    the subroutine we are going to remove (GetMemberAccountBalance).
    In one of the next patches the new methods will be used to make sure we
    are not modifying the calculated values (except the formatting).
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51aa6db46c604aa202a3d8f8e5028557480efbd5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 16:18:37 2018 -0300

    Bug 12001: Move GetMemberAccountRecords to the Koha namespace
    
    The GetMemberAccountRecords may be a perf killer, it retrieves all the
    account lines of a patron and then the related item and biblio
    information.
    Most of the time we only want to know how much the patron owns to the
    library (sum of amountoutstanding). We already have this information in
    Koha::Patron->account->balance.
    
    This patch replaces the occurrences of this subroutine by fetching only
    the information we need, either the balance, the detail, or both.
    It removes the formatting done in the module, to use the TT plugin
    'Price' instead.
    There is a very weird and error-prone behavior/feature in
    GetMemberAccountBalance (FIXME): as the accountlines.accounttype is a
    varchar(5), the value of the authorised value used for the
    ManInvInNoissuesCharge pref (category MANUAL_INV) is truncated to the 5
    first characters. That could lead to unexpected behaviors.
    
    On the way, this patchset also replace the GetMemberAccountBalance
    subroutine, which returns the balance, the non issues charges and the
    other charges. We only need to have the balance and the non issues
    charges to calcul the third one.
    
    Test plan:
    Add several fees for a patron and play with HoldsInNoissuesCharge,
    RentalsInNoissuesCharge and ManInvInNoissuesCharge.
    The information (biblio and item info, as well as the account line) must
    be correctly displayed on the different screens: 'Fines' module, fine
    slips, circulation module
    
    Note that this patchset could introduce regression on price formatting,
    but will be easy to fix using the TT plugin.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4609e95f9d9f8bd2a773522d67d7cd6126c9120a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 21 17:40:06 2018 +0000

    Bug 20240: Remove space before : when searching for a vendor in serials (Vendor name :)
    
    This patch removes the space before the colon in the "vendor" label in
    the vendor search pop-up window.
    
    To test, apply the patch and go to Serials -> New subscription.
    
    - Click the "Search for a vendor" link next to the vendor form field.
    - In the pop-up window, confirm that there is no space before the colon
      in the "vendor" label.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca32f936576e07909d7d5468f8eaa470221de6a1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 21 17:59:49 2018 +0000

    Bug 20239: Fix spelling on authority linker plugin
    
    This patch corrects the capitalization of the "Choose" link in the
    pop-up window for selecting an authority record to link to a MARC field.
    
    This patch also converts the link, and the "Edit authority" link, to
    Bootstrap buttons.
    
    To test:
    - Create a new record
    - Go to the 100 field
    - Click on plugin link behind $a
    - Look for an existing authoriy in your system
    - In the table of search results, confirm that the "Choose" and "Edit
      authority" links look correct and work correctly.
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1b6feb20f19492f4848c939566472f33bd621c9
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Fri Feb 23 13:36:02 2018 +0100

    Bug 20061: koha-common is not pulling libsearch-elasticsearch-perl / d/control
    
    update debian/control. this file is auto generated. no testing required.
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78cd06a0f67f2f5eb09a9cf9441e4619856ac407
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Fri Feb 23 13:10:51 2018 +0100

    Bug 20061: koha-common is not pulling libsearch-elasticsearch-perl
    
    Adds Search::Elasticsearch to Perldependencies.pm
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc02e92d107750d624bf8121ca48a3c63eee9e21
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 20 14:14:56 2018 -0300

    Bug 7143: Update about page for new dev - Pongtawat Chippimolchai
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 673a40d2acc5c8c58b7f3e7e6d11c329d0587fc6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 19 17:40:06 2018 -0300

    Bug 20250: (bug 19529 follow-up) Prevent NoIssuesChargeGuarantees.t to fail randomly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29539307e959e285df88148cc88ab83d2fa8d1df
Author: Charles Farmer <charles.farmer@inLibro.com>
Date:   Mon Feb 19 15:00:33 2018 -0500

    Bug 20249: (bug 18789 follow-up) "Patron has no outstanding fines" now appears alongside fines
    
    Test plan:
        1) Choose two patrons from your database, one who has fines, and the other who does not
        2) Visit their 'Fines' page, and click on the 'Pay fines' tab
            2.1) If they don't have any fines, you'll only see a blank row
            2.2) If they do have fines, the payment form will appear, but the text "... no outstanding fines" will also appear
        3) Apply patch
        4) Visit once again the 'Pay fines' tab of your patrons
            4.1) Now, "... no outstanding fines" will appear for the right situation
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7219cf43c18f0690be84657b3cbc5dcd33ec6a4
Author: Pongtawat Chippimolchai <pongtawat@punsarn.asia>
Date:   Sun Jul 9 23:34:17 2017 +0700

    Bug 18913: Allow symbolic link in /etc/koha/sites
    
    This patch makes the koha-* scripts follow symbolic links when querying for
    Koha instances. Without it, it is not possible to define instances outside the
    /etc/koha/sites directory,
    
    To test:
    - Create a symlink in /etc/koha/sites:
      $ sudo ln -s /tmp /etc/koha/sites/test
    - Test the original is_instance function:
      $ . /usr/share/koha/bin/koha-functions.sh
      $ is_instance test && echo success || echo failure
    => FAIL: symlinks are not considered instance names (i.e. failure is printed)
    - Apply this patch
    - Update the koha-functions.sh file:
      $ perl misc4dev/cp_debian_files.pl
    - Test is_instance again:
      $ . /usr/share/koha/bin/koha-functions.sh
      $ is_instance test && echo success || echo failure
    => SUCCESS: symlinks are considered instance names (i.e. success is printed)
    - Sign off :-D
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7d4c773be5cf1df275827270465f7f55b95ce02
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 19 16:16:57 2018 -0300

    Bug 19290: DBRev 17.12.00.018
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9a7b6742b970d1e605f84ff001f609ddda8eaa2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 11 19:06:17 2017 -0300

    Bug 19290: Browse selected bibliographic records - Staff interface
    
    This patch adds the same feature as bug 10858 for the OPAC interface:
    after a search, librarians will be able to browse selected results.
    The results can be selected from several pages.
    By extension it is possible to add results from several pages to a list
    or the cart.
    
    When at least one result is selected, a new "Browse selected records" button
    becomes usable and change the behaviour of the existing browser.
    
    The whole feature can be turned off with the pref BrowseResultSelection.
    
    Test plan:
    - Launch a search (on the staff interface)
    - Check some biblios
    - Go on another page
    - Check some biblios
    - Come back to a page you already check results and confirm that they are
    still checked
    - Click on the "Browse selected records" button
    - Check that you are able to browse results you had checked.
    
    You can also:
    - add them to the cart
    - add them to a list
    
    QA note: the browsers at the OPAC and the one at the staff interface are completely different
    That's why the code is not mimicking what has been done on bug 10858.
    The behaviour must stay the same anyway.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af1a8c5a78706a9d7d1cd8e4f75197189132d17c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Feb 19 10:25:21 2018 -0300

    Bug 18336: (follow-up) Shift TINYTEXT columns
    
    This patch fixes two errors that slipped in the patchset.
    
    To test:
    - Create a dummy branch for testing:
      $ cd kohaclone
      $ git fetch
      $ git checkout v17.11.00 -b dummy
    - Reset your working DB
      $ reset_all (y)
    - Set your branch to current master
      $ git reset --hard origin/master
    - Update the DB
      $ updatedatabase
    - Update the schema files
      $ kshell
     k$ misc/devel/update_dbix_class_files.pl \
           --db_name koha_kohadev \
           --db_user koha_kohadev \
           --db_passwd password
     k$ exit
      $ git diff
    => FAIL: There are discrepancies on upgrades
    - Reset to v17.11.00 revision and DB:
      $ git reset --hard v17.11.00
      $ reset_all (y)
    - Set your branch to current master
      $ git reset --hard origin/master
    - Apply this patch
    - Update the DB
      $ updatedatabase
    - Update the schema files
      $ kshell
     k$ misc/devel/update_dbix_class_files.pl \
           --db_name koha_kohadev \
           --db_user koha_kohadev \
           --db_passwd password
     k$ exit
      $ git diff
    => SUCCESS: No discrepancies!
    - Reset to HEAD to get rid of the schema changes
      $ git reset --hard HEAD
    - Regenerate the schema files on top of this patch
      $ dbic ; cd /home/vagrant/kohaclone
      $ git diff
    => SUCCESS: No discrepancies!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b86a9ee984ece06e11e0f490027771125d5fc9a7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 18 18:29:10 2018 +0000

    Bug 20037: Switch single-column templates to Bootstrap grid: Serials
    
    This patch updates several single-column Serials module templates to
    use the Bootstrap grid. In addition to grid changes, some templates have
    been modified to include the footer with the correct popup parameter.
    
    - serials\acqui-search.tt - Go to Serials -> New subscription. Click
      "Search for a vendor."
    
    - serials\acqui-search-result.tt - Vendor search results
    
    - serials\result.tt - Click "Search for record."
    
    - serials\subscription-bib-search.tt - Catalog search results.
    
    Each of these pages should look correct.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3eb50270b1a02fe98cde767ad0240b2943e23321
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 16 15:03:29 2018 +0000

    Bug 19981: Switch single-column templates to Bootstrap grid: Course reserves
    
    This patch updates three single-column course reserves templates to use
    the Bootstrap grid:
    
    - course-reserves.tt - The main Course Reserves page
    - course-details.tt - The detail view of an individual course
    - course.tt - Editing a course
    - add_items-step1.tt - Adding items to a course, step 1 (scan barcode)
    - add_items-step2.tt - Adding items to a course, step 2
    - invalid-course.tt - The error page shown if you try to view
      course_reserves/course-details.pl directly without passing a course id
      in the URL
      - Also changed in this template: Error message has been wrapped in the
        standard "dialog alert" <div>.
    
    Each of these pages should look correct, with a single centered column
    with wide margins on either side. At lower browser widths the margins
    should disappear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a418f73cf57c9b9ecc54feb2a9b42e67084150b2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 11 18:16:39 2018 +0000

    Bug 19954: Update popup window templates to use Bootstrap grid: Patrons
    
    This patch updates two patron-related templates to use the
    Bootstrap grid instead of the YUI grid.
    
    This patch also corrects an unrelated error in update-child.tt where
    some JS variable declarations required by members-menu.js were
    missing.
    
    To test you must have more than one adult-type patron category defined.
    
    - Locate and view a child-type patron record.
    - From the "More" menu in the toolbar, choose "Update child to adult
      patron."
      - The popup window which appears should look correct and work
        correctly.
      - The table of patron categories should be sortable.
    - Add a new patron and enter the first and last names of an existing
      patron.
      - When Koha asks to confirm a possible duplicate record, click the
        "View existing record" link. The popup which is triggered should
        look correct.
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 466c46f4f64b83abc8205e4ff0600587fa69d234
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 9 19:11:12 2018 +0000

    Bug 19939: Move cataloging Z39.50 results actions into menu
    
    This patch modifies the template which displays cataloging Z39.50
    search results so that the "MARC," "Card," and "Import" links are moved
    out of separate table cells and into one menu.
    
    The old menu which would appear when any table cell is clicked has been
    removed, and code added to display the same Bootstrap menu if a table
    cell is clicked.
    
    To test, apply the patch and go to Cataloging -> New from Z39.50/SRU.
    
    - Perform a Z39.50 search which will return more than one result.
    - Confirm that clicking the "Actions" button triggers a drop-down menu.
      - Confirm that the links in the menu trigger actions for the correct
        bibliographic record.
    - Confirm that clicking any other table cell in the table of results
      will trigger the display of the same menu.
      - Confirm that this menu works correctly for the correct record.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22ab693c76346b3b2c28463f35df69ae808d98e5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 3 01:40:13 2018 +0000

    Bug 19837: Add error feedback for duplicated or unfound cardnumbers
    
    To test:
    1 - Enter some patrons on a list
    2 - 'Enter multiple cardnumbers'
    3 - Make sure to add some that are already in list, some that don't
        exist, and some new patrons
    4 - Verify results are as expected with warnings
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d63cd0efbb9c59bab5de2aa67b3fb4831221a105
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 15 17:26:12 2017 +0000

    Bug 19837: Add multiple patrons to a list by barcode
    
    This patch adds the interface change and basic functionality for an
    option to add multiple patrons to a patron list by scanning barcodes.
    
    To test, apply the patch and go to Tools -> Patron lists.
    
    - Create a patron list if necessary, and got to the "Add patrons"
      screen.
    - Test the process for adding patrons using the "Patron search" text
      input.
    - Test the process for adding patrons using the "Enter multiple card
      numbers" option.
    
    This should really have some error-handling added to it: Onscreen
    messages when a non-existing patron card number is submitted or when a
    patron already exists on the list.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5e150440b2333793cf4b1c8d773285439f69151
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Feb 18 16:39:01 2018 -0300

    Bug 19785: Replace intranet-tmpl with [% interface %]
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac6869eed1304cf748f34265541fbfa15153c621
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 8 19:09:05 2017 +0000

    Bug 19785: Move template JavaScript to the footer: Authorities, part 1
    
    This patch modifies even more staff client authorities templates so
    that JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
     - Authorities
       - New from Z39.50
       -> Search
          -> Results
             - New from Z39.50
             - Deletion confirmation
             - Merge records -> Merge
               - Tabs
               - Tag selection
             -> Authority detail
                - Tabs
                - Deletion confirmation
                - New from Z39.50
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00bfa63dc7cb8322045690745e818dbd05dcbe64
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Feb 18 16:47:12 2018 -0300

    Bug 17672: DBRev 17.12.00.017
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5977dedb945b274e86d225cb7e14549965cc9305
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Feb 18 16:44:51 2018 -0300

    Bug 17672: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30f6f17664a41b4a536b13fe6bc71cfc3e89afc5
Author: Charles Farmer <charles@inlibro.com>
Date:   Fri Nov 3 16:21:04 2017 -0400

    Bug 17672: Fixing Items.t expected tests from 12 to 13
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d8155439eb91471400ad04a1f95da4e77d80dad
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 19 13:10:41 2017 +0000

    Bug 17672: Add damaged_on to items and deleteditems tables
    
    This patchset adds a 'damaged_on' column to store the date an item is
    marked damaged, analogous to withdrawn_on and itemlost_on
    
    To test:
    1 - Apply patch
    2 - Mark an item damaged via moredetail.pl (Items tab on left in
            details)
    3 - Note the damaged on date apears below
    4 - Unmark the item, the date is removed
    5 - Go to the edit items screen (from top bar 'Edit->edit items')
    6 - Mark item damaged - check db or moredetails.pl to see damaged_on
    date
    7 - Unmark item damaged - confirm date is removed
    8 - prove t/db_dependent/Items.t
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90e0c0de5c127664177821ac9d05aca046e0d823
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Feb 18 15:10:30 2018 -0300

    Bug 20148: Prevent adding same user multiple times to an order
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53e8b8cbe0ff98fb691cb80f7b9986b49b94be5c
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Wed Feb 7 09:45:20 2018 +0200

    Bug 20148: Prevent adding same user multiple times to acq basket
    
    When adding a user to manage acquisitions basket, it is possible
    to add the same user multiple times. Prevent that.
    
    Test plan:
    
    1) Go to Home -> Acquisitions -> [bookseller] -> [basket]
    2) On the "Add user" in the Managed by-part, and try adding
       the same user multiple times.
    3) Apply patch
    4) Repeat 1 and 2. You should now get an error message saying
       the user is already in the list.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 138afb693ebfa09208bffb5ab0e18aa2bb96da38
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 16 14:33:12 2018 +0000

    Bug 20222: Make bread crumb for cleanborrowers.pl match the link text in tools-home.pl
    
    This patch revises the breadcrumbs in the template for batch patron
    deletion / anonymization so that they match the text used in the tools
    menu and on Tools home.
    
    To test, apply the patch and go through a batch patron anonymization
    process. At each step the breadcrumbs should read "Batch patron
    deletion/anonymization" instead of "clean patron records."
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58b5c925cc14dcb85455f071efdf94acc5b1787f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 12 13:13:41 2017 +0200

    Bug 19452: Remove the truncate option
    
    The truncate option is not really useful. Its result is probably not what
    most users of this script expect or need.
    It truncates both tables borrower_message_preferences and
    borrower_message_transport_preferences. This (unfortunately) includes
    deleting messaging preferences for patron categories. After that, adding
    preferences again will not add categories again, but only borrower
    preferences which are all disabled.
    
    Furthermore, we do not need to disable the foreign key check. Neither
    do we actually need to truncate, deleting records seems sufficient.
    Also deleting transport preferences is not needed, since it will be
    done by a cascade from messaging preferences. Note that the subsequent
    call of SetMessagingPreferencesFromDefaults will already delete the
    records.
    
    This makes it possible to remove the truncate option altogether.
    
    Test plan:
    [1] Select a patron category (say ST) and change days_in_advance to x.
    [2] Select a ST patron and set days_advance to y in his msg prefs.
    [3] Run borrowers-force-messaging-defaults.pl -doit
    [4] Verify that the patron has been reset to the default prefs (incl.
        value x in days_in_advance).
    [5] Verify that the patron category prefs are still intact.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 744e9a03791f50be98cb5c43cb4223f31fa30ed4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 14 15:15:39 2018 -0300

    Bug 20145: Do not insert 0000-00-00 in patron tests (and more)
    
    We should call Koha::Patron->is_expired in CanBookBeIssued instead of
    doing the same calculation.
    
    Tests have been adapted to pass with new SQL modes.
    
    We should not need to update the values in DB, we already have
      Bug 14717: Prevent 0000-00-00 dates in patron data (3.21.00.023)
    
    Test plan:
      prove t/db_dependent/Circulation/dateexpiry.t
      prove t/db_dependent/Koha/Patrons.t
    must return green
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69e51d729ff7e5e1a90a0d6ce13e2ca6a0c69308
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 16 10:25:00 2018 -0300

    Bug 19978: Fix ITEMTYPECAT behaviour
    
    ITEMTYPECAT permits to group and hide item types at the OPAC (see bug
    10937 for a complete description).
    
    Since commit 091d6c513bcbee224ff06477e79be48cea7fe825
        Bug 17843: Replace C4::Koha::getitemtypeinfo with Koha::ItemTypes
    the code assume that they are item types. Before it just assigned undef
    to the description.
    
    Test plan:
    Create ITEMTYPECAT authorised values
    Assign an item type to this authorised value group
    Search for a item using this item type at the OPAC
    Without this patch applied you get:
    Can't call method "translated_description" on an undefined value at
    /home/vagrant/kohaclone/opac/opac-search.pl line 231.
    
    With this patch applied the search result is displayed.
    
    Make sure the original feature still works.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 208f1021255f388418135ea0aac4e4e4258d0525
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 17:15:43 2017 -0300

    Bug 18975: Retrieve up-to-date CGISESSID when just logged in
    
    If a user is asked to login before sending a card, the wrong (old)
    CGISESSID cookie is used.
    We need to retrieve the one that has just been created.
    
    This will certainly need more work, I guess other scripts are affected
    too.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 549b8fe787ffd9edd38c71c0c5b362f5df9062b0
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Feb 8 09:27:18 2018 +0000

    Bug 9573: (QA follow-up) Add missing include back
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b76ee62eed039e623c276a15cad884a8d8f935b7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Feb 17 11:48:51 2018 -0300

    Bug 9573: Add missing KOHA_VERSION in js paths
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 618b15a569566fde2245d6a455a61a892ee980c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 18 19:49:31 2017 -0300

    Bug 9573: Add missing use statement
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b5b1a0358ecf5362f0c2348e9654f350e3c1b3b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 16 12:10:03 2017 -0300

    Bug 9573: (follow-up) Lost items report - add KohaTable to itemlost
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit abbd0eeea9b686584c3f2c5d7201b43a4e76ae76
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 5 17:38:34 2017 -0300

    Bug 9573: Lost items report - Add the CSV export ability
    
    Finally we add the ability to export the list of lost items.
    The items will be export in CSV format using a CSV profile defined.
    
    Test plan:
    0/ Apply all the patches from this patch set
    1/ Define a CSV profile (type=SQL, Usage=Export lost items in report)
    Try something like that to get the same columns as the default table:
    Title=biblio.title
    |Author=biblio.author
    |Lost status=items.itemlost
    |Lost on=items.itemlost_on
    |Barcode=items.barcode
    |Call number=items.itemcallnumber
    |Date last seen=items.datelastseen
    |Price=items.price
    |Rep. price=items.replacementprice
    |Library=items.homebranch
    |item type=items.itype
    |Current location=items.holdingbranch
    |Location=items.location
    |Not for loan status=items.notforloan
    |Notes=items.itemnotes
    2/ Use the filters and select items to export
    3/ Export the list of items you want and make sure the CSV is correctly
    formatted and contains the items you selected
    
    QA Notes:
    - I think we should add default CSV profiles for the different "usage",
    but I would consider it as a separate enhancement since none of them is
    defined yet
    - Most of the code to export CSV is no reusable. We should make
    Koha::Exporter::Record support CSV export for type=SQL (it only
    supports MARC type so far).
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17948b0c37874756226099c8bf8cedcff6ccacfa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 5 16:29:48 2017 -0300

    Bug 9573: Lost items report - Add a new "Export selected items" link
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a118d01bf3e2415b02fd4a8a820203491a2af90
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 5 16:44:38 2017 -0300

    Bug 9573: Lost items report - Add a new itemlost_on column
    
    This patch adds a new "Lost on" column to the result table
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2eb7633ca6ca9e1cd67587a9895643e05c44f07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 5 14:35:24 2017 -0300

    Bug 9573: Lost items report - add KohaTable to itemlost
    
    Before this patch set, we used KohaTable to display a table with the
    column visibility plugin, and an usual dataTable initialisation for the
    filters.
    For the lost items report table we will need both.
    To do so we need to reorganize the code a bit
    
    We cannot pass a selector but the id of the node which represents the
    table. Indeed it is how works currently the filters (we may want to
    improve that later)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 771de35a2b297cc5058f83ed3e19e34927f95c36
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 5 13:15:43 2017 -0300

    Bug 9573: Lost items report - Move filters code to a separate js file
    
    For the next patches we will need to reuse what is already done on the
    bibliographic record detail page. This patch moves the code to make it
    reusable easily and avoid copy and paste.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61c832a507286fc636bd4e4c709be3a5be6970fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 5 13:02:58 2017 -0300

    Bug 9573: Lost items report - Add items.notforloan as a filter
    
    This patch adds a new "Not for loan" status filter to the lost items
    report.
    
    Test plan:
    0/ Apply all patches from this patch set
    1/ Use the new "Not for loan" filter to search lost items
    2/ The table result must be consistent and a new "Not for loan" column
    should be there
    3/ Confirm that you are able to hide/show this column with the column
    settings tool.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6378a8fb39a316ae30815ab6c2b6d2f58861c2f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 17:40:37 2018 -0300

    Bug 15794: Add emojiarea to the license area of the about page
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 294c1dc1eb24d2272a68c4b4504db16d262bf980
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 17:32:15 2018 -0300

    Bug 15794: Add [% KOHA_VERSION to .css and .js
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e11fd3060fc49634ffbdf8a5e62192ac48080e6a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 29 09:54:53 2018 -0300

    Bug 15794: Add an emoji picker to tag entry in OPAC
    
    This patch introduces an emoji picker int othe OPAC's tag entry form.
    It relies on the emoji-picker library [1]
    
    To test:
    - Apply the patches
    - Restart all services (just in case some caching is taking place):
      $ restart_all
    - Log into the OPAC
    - Do a search, pick a record
    - On the detail page for the record, click on 'Add tags'
    => SUCCESS: An input form is displayed, with an emoji picker on the
        right.
    => SUCCESS: Choosing an emoji populates the input with it
    - Set 'TagsModeration' and retry
    => SUCCESS: Proposed tags are displayed correctly on the staff interface
        for tag moderation
    - Sign off :-D
    
    Sponsored-by: Hotchkiss School
    
    [1] https://github.com/OneSignal/emoji-picker
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 358d5f2ab2856322f3138a35fd08fd879e16bf24
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 18:10:23 2018 -0300

    Bug 18336: DBRev 17.12.00.016
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 052572cd1efc751804bdba28f6ad43fe0e3210c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 17:56:05 2018 -0300

    Bug 18336: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46a39cf4fbf06864b4b1b348753a08c317ba2cb2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 16 14:08:12 2018 -0300

    Bug 18336: Library groups fix
    
    Library groups were added after this patchset was submitted.
    This patch adjusts kohastructure.sql entry for library_groups.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 340042dbaeb12d78aa6b10da9f05fa5ea4060435
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 16 11:25:31 2018 -0300

    Bug 18336: Shift *TEXT columns size
    
    Because of the 3-byte vs. 4-byte char size change in utf8mb4, altering a
    column's encoding from utf8 into utf8mb4 results in this changes:
    
    TEXT => MEDIUMTEXT
    MEDIUMTEXT => LONGTEXT
    
    The column size in the rows (the text itself goes to a separate object
    storage) shifts by 1 byte, because all chars are shifted in bytes size
    too, so there needs to be room for the byte-count in the column.
    
    This is a debatable change, but the path needs to be included along with
    the rest of the patchset for consistency.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f45d606e109ed7367d1f18d4e4919347da40fd10
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 29 10:02:21 2018 -0300

    Bug 18336: Fix missing utf8_bin > utf8mb4_bin translation in kohastructure.sql
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac77cc5349085e6208db6d82b2028611824eb7ee
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jan 23 12:26:26 2018 -0300

    Bug 18336: Add explicit index names to kohastructure.sql
    
    This patch just adds an explicit index name to the search_marc_map
    table. The atomicupdate on this patchset is a good example of why we
    better have them.
    
    Sponsored-by: Hotchkiss School
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c09a18adec949d8b0377c3a6ee6bce724c8be49
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jan 23 11:46:05 2018 -0300

    Bug 18336: Atomic update
    
    Sponsored-by: Hotchkiss School
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6e444198f875bfb6d04c41cc3deef29807281b6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 22 12:35:49 2018 -0300

    Bug 18336: DBIC update
    
    Sponsored-by: Hotchkiss School
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c655a2000a87e0b7ff07ecee1be4f7b6eddad0f4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 22 12:32:36 2018 -0300

    Bug 18336: Convert schema from utf8 to utf8mb4
    
    This patch adapts the DB structure so it uses utf8mb4 encoding and
    utf8mb4_generic_ci collation.
    
    Indexes for columns of type VARCHAR with prefix lenght higher than 191
    are shortened because of the smaller max index lenght for utf8mb4
    
    Note: please beware that testing this patchset risks your data and the
    patchset includes reinitializing the DB.
    
    To test:
    - Be on the master branch
    - Have a clean DB:
      $ reset_all
      (y)
    - Apply the first patch (Unit tests)
    - Run:
      $ kshell
     k$ prove t/db_dependent/www/search_utf8.t \
              t/db_dependent/www/auth_values_input_www.t
    => FAIL: Tests fail because Koha doesn't support supplemental (UTF-8)
             chars.
    - Apply the rest of this patchset
    - Upgrade the schema:
      $ kshell
     k$ perl installer/data/mysql/updatedatabase.pl
    - Run the tests:
     k$ prove t/db_dependent/www/search_utf8.t \
              t/db_dependent/www/auth_values_input_www.t
    => SUCCESS: Tests pass!
    - Now start from a clean DB
    - Run:
      $ reset_all
      (y)
    - Run the tests:
     k$ prove t/db_dependent/www/search_utf8.t \
              t/db_dependent/www/auth_values_input_www.t
    => SUCCESS: Tests pass!
    
    Verify you can use emojis all over the place (MARC records, AV
            descriptions, etc).
    
    Sponsored-by: Hotchkiss School
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a7341c98d84a59807ae4a74c9c28343979a081b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 22 12:32:21 2018 -0300

    Bug 18336: SET NAMES utf8mb4 in Koha::Database
    
    Sponsored-by: Hotchkiss School
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d74c5393edf35d6cb3728ef109125bff05869a02
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 22 13:16:26 2018 -0300

    Bug 18336: Full stack tests for supplemental UTF-8 chars
    
    This patch introduces tests for Koha's support for 4-byte supplemental
    UTF-8 chars. encoding/decoding tools handle this gracefuly. The missing
    piece is the MySQL DB backend.
    
    The tests in this patch:
    - Adds a couple records for each flavour (MARC21 and UNIMARC) so
      search_utf8.t tests 4-byte chars are handled correctly
    - Adds emoji testing in auth_values_input_www.t
    
    To test:
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/www/search_utf8.t \
              t/db_dependent/www/auth_values_input_www.t
    => FAIL: It should fail if the DB hasn't been migrated into using
    utf8mb4
    
    Sponsored-by: Hotchkiss School
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1ccd5ed35be6fa5252a65005a7374d340b2acf9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Feb 16 16:23:14 2018 +0000

    Bug 20004: Fix POD
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfbadc70d4d6b117b9287beda8b2b46dced6b432
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 17 14:03:28 2018 -0300

    Bug 20004: Adapt /v1/cities to new naming guidelines
    
    This patch implements the changes required by the cities endpoint RFC
    [1].
    
    It uses the objects.search helper, and relies on bug 19686.
    
    To test:
    - Apply the patches
    - Compare the spec with the RFC (api/v1/swagger/definitions/city.json)
    => SUCCESS: It makes sense
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/cities.t
    => Tests pass!
    - Sign off :-D
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3afbbdf48cad8acda06fc21333b270cb1944d454
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 17 14:03:52 2018 -0300

    Bug 20004: Unit tests
    
    This patch adapts the unit tests for the cities endpoint to the
    requirements from the RFC. This tests are expected to just fail
    without the needed followup.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/cities.t
    => FAIL: Tests obviously don't pass without the followup patch.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b16c0b35ded57c728f89db3af7aab349e879bef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 12:23:26 2018 -0300

    Bug 20229: Explicitly list the SQL modes we support
    
    In our installation procedure we ask the administrator to edit the
    MySQL|MariaDB configuration file to specify the SQL modes we support
    (see bug 17258 comment 6 and 7 for more information).
    
    We are on the way to catch and fix all these issues and support these
    stricter modes (as they highlight problem in our codebase/DB structure)
    but in the meanwhile it may be good to remove this step and revert the
    changes when we are ready.
    
    TODO:
    - Remove that for dev installations (to let developers catch these bugs)
    - Edit the wiki page to remove this step
    
    Test plan:
    0. Do not apply this patch
    1. Edit your MySQL|MariaDB config and add:
    sql-mode = "ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"
    to the [mysqld] section (or edit it)
    2. Restart your DBMS
    3. Try to make the app explode (watch the logs)
    (tips: you should get "'koha_kohadev.me.id' isn't in GROUP BY" when
    editing an order)
    4. Apply the patch, restart_all, restart your DBMS
    5. Try to recreate the failure
    => You should no longer see the error in the logs
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f34dcf36581f909e531d49be7a44bbbc6ebc9ce0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 15:03:17 2018 -0300

    Bug 18789: (follow-up) Fix page title when creating a new patron
    
    This has been caught by selenium test, the category name must be
    displayed when we are creating a new patron, and so does not depends on
    the "patron" variable
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c48ac7a05a82e4a27ad9dd2d2bae5119cf34e5a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 14:26:46 2018 -0300

    Bug 18789: (follow-up) Fix perlcritic issue - housebound.pl
    
    "$branch" is declared but not used at line 65, column 1.  Unused
    variables clutter code and make it harder to read.  (Severity: 3)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae7f0ae4b51ec1b9cba2643a580d4bb622cd60b9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 17 14:33:33 2018 -0300

    Bug 19686: (follow-up) Add to_api param for completeness
    
    This patch adds (yet) another param to objects.search: a reference
    to a to_api function to be applied when processing the search results
    for output.
    
    To test:
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/Koha/REST/Plugin/Objects.t
    => SUCCESS: Test count raised, and tests pass!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bd62d0a8c5f78d31ef12fdca856af76bdf13809
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 23 17:10:42 2017 -0300

    Bug 19686: Add objects.search a 'to_model' param
    
    This patch introduces a new parameter to the objects.search Mojo helper.
    The idea behind this, is that if there's any attribute name mapping
    between the DB objects and the API exposed ones, we should be able to
    pass it to objects.search so the filtering query params are mapped
    correctly for building the DBIC query, like this example:
    
      my $patrons_set = Koha::Patrons->new;
      my @patrons = $c->objects->search( $patrons_set,
                                         \&to_model
                                        )->as_list;
      # and probably
      @patrons = map {to_api($_)} @patrons;
    
    The to_model function needs to avoid autovivification, to prevent
    messing with the query parameters (undef params).
    
    To test:
    - Apply this patches
    - Run:
      $ kshell
     k$ prove t/db_dependent/Koha/REST/Plugin/Objects.t
    => SUCCESS: Tests pass! Params get mapped!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37ed1111cee60c519f844c789d4385eacd299fbb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 23 17:10:13 2017 -0300

    Bug 19686: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3434ebb3d6cb83d2e7b2cf063d75f78f07e3695
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 10 17:19:57 2018 +0000

    Bug 19947: Update popup window templates to use Bootstrap grid: Acquisitions transfer order
    
    This patch updates the acquisitions transfer order template to use the
    Bootstrap grid instead of the YUI grid.
    
    Also fixed: Corrected footer include for popup window.
    
    To test, apply the patch and go to Acquisitions -> Vendor -> Open order
    -> Transfer.
    
    In the popup window search for a vendor, select, and choose a basket.
    
    Signed-off-by: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f88a68e993f65bae4bf33726978c64c41eebba5e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 7 14:24:04 2018 +0000

    Bug 19932: (follow-up) Add fixed footer to cataloging Z39.50 popup
    
    This patch adds additional Bootstrap framework markup to the search form
    so that the "Save" and "Cancel" controls are in a fixed footer at the
    bottom of the window. This prevents the controls from disappearing down
    off screen.
    
    To test, apply the patch and go to Cataloging -> New from Z39.50/SRU.
    In the popup window, both the search form and search results pages
    should look correct.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a6ef80a3d8a2e77673afd820d712e3582e81704
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 9 13:49:02 2018 +0000

    Bug 19932: Update popup window templates to use Bootstrap grid: Cataloging Z39.50 search
    
    This patch updates the cataloging Z39.50 search template to use the
    Bootstrap grid instead of the YUI grid.
    
    Also fixed: Several un-quoted HTML attributes have been corrected.
    
    To test, apply the patch and go to Cataloging -> New from Z39.50/SRU.
    In the popup window, both the search form and search results pages
    should look correct.
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4339291f44d51accc891c99cf2eb4d68cdc3fa19
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 16 12:01:36 2018 +0100

    Bug 20227: Check for categorycode in default_borrower_circ_rules
    
    Fixes silent crash when adding the same category twice.
    DBD::mysql::st execute failed: Duplicate entry 'ST' for key 'PRIMARY' [for Statement "
                    INSERT INTO default_borrower_circ_rules
                        (categorycode, maxissueqty, maxonsiteissueqty, max_holds)
                        VALUES (?, ?, ?, ?)
                " with ParamValues: 0="ST", 1=undef, 2=undef, 3="3"] at /usr/share/koha/devclone/admin/smart-rules.pl line 309.
    
    (Line number affected by bug 15524.)
    
    Very trivial solution.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 427b9a70ba40fef46042f31b0972dc17b6139442
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Feb 16 08:43:32 2018 -0500

    Bug 12598: Fix POD
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b07298991a78f21486f5b2f61e1d812c4939c3e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 4 10:06:17 2018 -0300

    Bug 12598: Use Pod::Usage and make the help more explicit
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd122369dcdc69bde1c66d2aecc2e0b4bcc744b4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 4 10:05:46 2018 -0300

    Bug 12598: Remove warnings from tests and make them pass
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29e429171899d825099ec8f9a22ffebb761db3fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 29 10:31:08 2017 -0300

    Bug 12598: Add use Koha::Patron::debarments statement
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2cd0f388fa5e6bf21a1608cb548157485c060392
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 22 13:34:17 2017 -0300

    Bug 12598: Re-add bug 18555: Create patron list from patron import
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f8eb35c2f6d56dfd332cbe6212db75aae8b8f50
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Thu Aug 10 13:56:24 2017 +0100

    Bug 12598: Allow matched patron to be updated
    
    When a test was introduced to not add duplicate userids
    it overlooked that if you were matching on userid you
    do not want the update to be rejected.
    
    Add a test to overcome this logical flaw if updating
    by matching userid
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b361ff2d7d1d9e0f27ff3d6b728686bc3691c564
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 25 10:19:20 2017 -0300

    Bug 12598: Re-add some missing stuffs
    
    This patch will have to be squashed with previous ones, but for
    readability I prefer to let it alone for now.
    
    It reintroduces 2 missing changes:
      commit fd123903651435c56ca14d88897e9ce4d7a38bb5
        Bug 15010: Import patron tool creates 'duplicate' restrictions (
        debarments )
      commit 011d8e9855ffeb1779f5c1aadc9f4367c298cee7
        Bug 12543 - Add userid as matchpoint for "Import patrons" tool
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9c0697ca54fa274c1e361ff2c28459069943ad1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 25 10:10:54 2017 -0300

    Bug 12598: Fix conflict with 17829 - GetMember
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70c45c37813860652914a381195f976c554b71d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 6 12:49:01 2017 -0300

    Bug 12598: Fix conflict with bug 16911
    
    Tests will have to be written for this change
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1476578f20b1c1f84f2edf241dbb0d1eea565fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 10:12:48 2017 -0300

    Bug 12598: Update code to use new modules
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2066bcadc3b691b4cbf3684c72e9d57e5989d81
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jul 21 13:50:08 2014 -0400

    Bug 12598: New misc/import_borrowers.pl command line tool
    
    Test Plan:
    1) Apply this patch
    2) Test importing patrons from command line,
       options are availble with --help.
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    
    Tested with minimal csv
    (cardnumber,surname,firstname,categorycode,branchcode,password,userid)
    
    Overwrite does not change category or branch.
    Patrons are loaded, userid & password works
    
    Updated license to GPLv3
    No other koha-qa errors.
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Tidy import_borrowers.pl
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Move importing code to a subroutine
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Update command line script to use patron import subroutine
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 [QA Followup]
    
    * Fix copyright on import_borrowers.pl
    * Changes -c --csv to -f --file
    * Adds -c --confirm option
    * Renames misc/import_borrowers.pl to misc/import_patrons.pl
    * Restore userid matchpoint option
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Fix merge to master. Backport 3 updates from latest import_borrowers.pl
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Started regression tests. Fix missing C4::Members::Attributes package
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - More refactoring and regression tests in Koha::Patrons::Import
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Creating objects in misc/import_patrons.pl and tools/import_borrowers.pl
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Refactoring Koha::Patrons::Import includes bug fixed for critical date types and header column parsing
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598 - Rebase + backport of 16426 plus fixing 16426
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 12598: catch warnings raised by import_patrons in tests
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97bfd4be33773ee18882edb004c8a7a5a8629169
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 13:57:07 2018 -0300

    Bug 18789: Add POD for is_adult and is_child
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 249736a67f7ed0e2130c620e10bcbc01b14b1829
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 11:00:25 2018 +0000

    Bug 18789: (QA follow-up) Fix viewlog when accessed via circulation
    
    Test plan:
    Go to any patron and then to Modification log of this patron
    -- without patch you will not see the left side menu and patron information
    -- with patch menu and patron information is here, and should be fully
    working (links)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b2c4ff551bb29db15813d91cfb5e74de1061683
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 10:58:42 2018 +0000

    Bug 18789: (QA follow-up) Update holdshistory.pl, fix is_child, is_adult, patron->image, clear template params
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36bd68842f13714638a1ed8aa93bef0672685d38
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 10:57:15 2018 +0000

    Bug 18789: (QA follow-up) Use is_child in circulation.pl
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5008ccd11e0255f85e68195586591f2715c4cbd5
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 10:15:14 2018 +0000

    Bug 18789: (QA follow-up) Use patron object in batch checkout template
    
    1) Enable batch checkouts in system preferences and set it on for some
    patron categories
    2) Try to batch checkout for some patron with one of these categories
    --> without patch the batch checkout page is even not shown
    --> with patch batch checking out is working as expected
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8ff7ccd5fcae69834a75dd11ef62b6092606015
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 10:00:22 2018 +0000

    Bug 18789: (QA follow-up) Fix showing cardnumber when creating a hold
    
    Test plan:
    1) Try to create a hold request for a patron
    2) On place hold form on the first line is shown the patron name
    --> without patch the cardnumber is not shown
    --> with patch there is cardnumber right after the patron name
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6058953da3a486fbf09aa8950c68c62a532c802
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 09:57:48 2018 +0000

    Bug 18789: (QA follow-up) Fix showing patron name when checking in
    
    Test plan:
    1) Have a patron with more then one checkouts
    2) Check in one of the checkouts
    --> without patch patron name is not shown in checked-in items table
    --> with patch the patron is shown with name, category, number of
    checkouts and both links are working
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c8b420dd72cb58fbdf1eada88a6ee6127f6068b
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 09:01:26 2018 +0000

    Bug 18789: (QA follow-up) Fix loading saved address data to edit patron form
    
    Test plan:
    1) Have patron with address filled in
    2) Edit the patron
    -- without this patch the fields for address are blank
    -- with patch the fields are filled with actual data
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 146faf5d6783c95e91fba5456d2e9badd7a8c3d5
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 08:15:31 2018 +0000

    Bug 18789: (QA follow-up) Use first_valid_email_address on Tranfers to receive page
    
    For consistancy with waitng reserves
    
    Test plan:
    1) Have a hold for patron which need to be transfered, inititate
    transfer and go to target library
    2) Go to Circulation -> transfers to receive page and you should see any
    first valid email for tha patron in column "On hold for"
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bb01c86161741297c177b41b36d7a15f4d1c61a
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 08:02:39 2018 +0000

    Bug 18789: (QA follow-up) Fix showing the name of basket creator on booksellers page
    
    Test plan:
    1) Go to Acquisition and search for a vendor, you are presented with vendors and their baskets
    2) Look to Created by column
    --> without patch only firstname is shown
    --> with patch you should see full name
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8eb00d2cbbcdfe8af1e2c7df59ac9673c248fbf9
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 07:46:49 2018 +0000

    Bug 18789: (QA follow-up) Fix borrowernumber in menu item links
    
    Test plan:
    Go to patrons routing list
    Try to click Holds history or ILL requests menu link
    --> without page blank page
    --> with page desired page
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d9ba0d1b410385d8867ed1b6ac08cdb37c53e6a
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Feb 16 07:45:35 2018 +0000

    Bug 18789: (QA follow-up) Fix tab char
    
    Test plan:
    
    run koha qa tools, should be green
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 105b3e10e8b31b7de6d733e676c3e661a39b1280
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 15:06:04 2018 -0300

    Bug 18789: Use the patron variable in circulation.[pl|tt]
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c49bffda19d64090e897a4c83ca50548175dde62
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 14:10:13 2018 -0300

    Bug 18789: Add tests for is_adult and is_child
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43b60d6eed5a028fcc629b7db8b33e93d1dd680b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 7 15:54:31 2018 -0300

    Bug 18789: (follow-up) Use Koha::Patron->image from the templates
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f9c5d45a41e0e6078e927cb829ef9861ecb613b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 12 14:20:26 2017 -0300

    Bug 18789: (follow-up) Send Koha::Patron object to the templates
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9773923bc0e68401702e568dc67948df72cc300f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 14:03:52 2017 -0300

    Bug 18789: Update other occurences where is_child should be used
    
    Trivial changes here, just do a code review on the QA step
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ee70dd0826a7adc0a1f35973dec3bed9f0f6c58
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 13:58:48 2017 -0300

    Bug 18789: Remove adultborrower from the pay* scripts
    
    This flag is not used in the templates
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82474cad8437a29bd279e57b9d4c1332674a5301
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 13:58:04 2017 -0300

    Bug 18789: Remove useless IS_ADULT variable
    
    Test plan:
      git grep IS_ADULT
    must not return any results
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a723bbaf1b564bf18ec9f477a3269b8b17033639
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 13:57:12 2017 -0300

    Bug 18789: Use Koha::Patron->is_adult where needed
    
    Test plan:
    When editing adult's info you must see the "Add child" button
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8b8799355596a960d3c2cabf6bf4e7a04cef00c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 13:52:30 2017 -0300

    Bug 18789: Use Koha::Patron->is_child where needed
    
    Test plan:
    When you are on a page related to a child you should see the "Update
    child to adult patron" button
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5f70a6010ec08243b6aee09054f8de33577c7cd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 13:51:09 2017 -0300

    Bug 18789: Add tests for is_adult and is_child
    
    This patch add 2 methods to the Koha::Patron module: is_adult and
    is_child.
    That way the business logic is at only one place and covered by tests.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4c23e1a3e6ed5299cf41c9a29432b13f57654ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 13:29:45 2017 -0300

    Bug 18789: Use Koha::Patron->image from the templates
    
    Now that we have the 'patron' variable in all our templates, we can call
    Koha::Patron->image and do the check from the templates.
    
    Test plan:
    On the different pages of the patron module, you should see the default
    image if there is no image attached or the one that has been attached
    (see pref patronimages)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab47e46ea0ade643b308a8b00708d57995c57050
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 13:14:29 2017 -0300

    Bug 18789: Pass a Koha::Patron object from returns.pl
    
    This is a specific patch for returns.pl
    
    Test plan:
    Do some checkin for a patron and make sure the info are correctly
    displayed (and info from someone that has placed a hold on this item)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ab22e1c7c6b6e8d14a4fb7478ab2a3d42da347d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 1 14:47:40 2017 -0300

    Bug 18789: Send Koha::Patron object to the templates
    
    In order to simplify and make uniform the code, the controller scripts send
    a Koha::Patron object to the templates instead of all attributes of a patron.
    
    That will make the code much more easier to maintain and will be less
    error-prone.
    
    The variable "patron" sent to the templates is supposed to represent the
    patron the librarian is editing the detail.
    
    In the members module and some scripts of the circulation module, the
    patron's detail are sent one by one to the template. That leads to
    frustration from developpers (making sure everything is passed from all
    scripts) and to regression (we got tone of bugs in the last year because
    of this way to do).
    With this patch set it will be easy access patron's detail, passing only
    1 variable from the controllers.
    
    Test plan:
    Play with the patron and circulation module and make sur the detail of
    the patron you are editing/seeing info are correctly displayed.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 265070081aa32a6b7fa703bcf3ebf9f357e95cd8
Author: Magnus Enger <magnus@libriotech.no>
Date:   Thu Feb 15 10:14:56 2018 +0100

    Bug 20205: Add IDs to buttons in patron-toolbar.inc
    
    The buttons in patron-toolbar.inc lack unique IDs, making them
    hard to style/remove with CSS. This patch adds IDs to all three
    buttons.
    
    To test:
    - Look in koha-tmpl/intranet-tmpl/prog/en/includes/patron-toolbar.inc
      and verify there are no IDs
    - Apply the patch and look at the file again to verify the IDs have
      been added
    - Test the "New patron" and "Quick add new patron" buttons to verify
      they still work as intended
    - Check that the new buttons are globally unique:
      $ grep -rn "new-patron-button" *
      $ grep -rn "patron-lists-button" *
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 795aeaefffdea1e3aa20befe96cc1383f707caf9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 15:37:18 2018 -0300

    Bug 20185: Remove warnings from stats.print.pl
    
    This needs a full rewrite!
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 216b0cff0de168ce95f11b648c2e794083a00874
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 13:58:28 2018 -0300

    Bug 20185: Remove warnings from aqplan.pl
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eac8f7d9ac11e6a20d0e3ecf0986edb9a270415f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 17:06:55 2018 -0300

    Bug 20182: [sql_modes] Remove group by clause in search_patrons_to_anonymise
    
    Not trivial, more attention needed on this one!
    
    Fix for:
    'koha_kohadev.me.cardnumber' isn't in GROUP BY
    
    Looks like the query is complexified, perf tests needed, see bug 19599.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 524eab678833b2719187e67128ee4f83a2a48ba4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 15:59:09 2018 -0300

    Bug 20176: [sql_modes] Set biblio.datecreated to NOW if not defined
    
    Fix at ->store level, this issue appears in lot of places.
    
    Fix for:
    Field 'datecreated' doesn't have a default value
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd70cdcc31021457285c68633a50499bf4b6bfe6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 12:58:34 2018 -0300

    Bug 12904: Add KOHA_VERSION to few more .css
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e01b3be15a6b2ad9b0f02598d84fe466e31e719e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 14 14:12:00 2018 +0000

    Bug 20193: Path to Greybox CSS broken after Bug 12904
    
    Bug 12904 changed the way CSS and JS assets should be linked, but the
    Greybox CSS path wasn't changed in the process. This patch adds the
    required VERSION template variable to greybox.inc.
    
    To test, apply the patch and test usage of Greybox in the staff client.
    For instance:
    
    - Go to Tools -> Labels -> Manage -> Label batches
    - Select a batch for export and click the 'Export selected' button
    - A Greybox modal should be triggered, and the export process should
      proceed correctly.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04005f2ea12c270f2895738eb434e5292218b789
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 12:12:00 2018 -0300

    Bug 20191: Use find with unique key combination
    
    To prevent unexpected issues later.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f90cd2be0affbdd2e2bc0c2223bfcf0cf65a13a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 15 14:14:18 2018 -0300

    Bug 20191: Make OAI/Server.t tests use timestamps from the DB
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3672df52265d4c3caf6aef84b9f3e3b9f01f47d6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 15 19:43:39 2018 +0000

    Bug 20221: Fix for JavaScript error during checkout patron search
    
    This patch fixes a bug caused by the changes in Bug 19641. JavaScript
    embedded in circ-patron-search-results.inc executes before jQuery is
    loaded.
    
    This patch adds a separate javascript file which can be included both in
    circulation.tt and request.tt since both use the same include.
    
    To test, apply the patch and submit a patron name in the check out form.
    On the page of search results, clicking a table row should work the same
    as clicking the patron name link.
    
    Perform the same test during the hold process: Locate and place a hold
    on a title. In the patron search form, submit a patron name and test the
    behavior of the search results screen.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d30669458f671913d56596cd0461d8ab2a7c440
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 16 10:49:43 2018 -0300

    Bug 18403: Prevent Modifications.t to fail randomly
    
        #   Failed test 'pending_count() correctly returns 2 if filtered by library'
        #   at t/db_dependent/Koha/Patron/Modifications.t line 355.
        #          got: '0'
        #     expected: '2'
    
        #   Failed test 'pending_count() correctly returns 2'
        #   at t/db_dependent/Koha/Patron/Modifications.t line 360.
        #          got: '0'
        #     expected: '2'
    
        #   Failed test 'pending_count() correctly returns 1'
        #   at t/db_dependent/Koha/Patron/Modifications.t line 365.
        #          got: '0'
        #     expected: '1'
        # Looks like you failed 3 tests of 16.
    
     #   Failed test 'pending_count() and pending() tests'
     #   at t/db_dependent/Koha/Patron/Modifications.t line 374.
     # Looks like you failed 1 test of 6.
     [19:45:28] t/db_dependent/Koha/Patron/Modifications.t
    
    The logged in patron did not have permissions to view patron's info from other branches.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3848f81c3c0eaafca162a1fdf3d3aa2de8fd3d43
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 18:05:56 2017 -0300

    Bug 19881: Remove authorities-list.pl
    
    For obvious reasons...
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51b6cf2aafbfb45b9fcb072403b986fe3c2add53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 12:13:10 2017 -0300

    Bug 19847: Track links within the records and 404 for others
    
    Test plan:
    Behave like a robot, you will get 404
    Be a human, you will be tracked
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b59988f78d0db6ae953949aca9dd60bd88601596
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Dec 3 22:21:57 2017 +0000

    Bug 19738: Fix XSS on vendor name in serials module
    
    Test plan:
    
    1) do not apply this patch
    2) Have at least one vendor which name does contain javascript, for
    example: <i>Vendor 1</i><script>alert('Hi');</script>
    3) go to serial module and create new subscription
    4) use "Search for vendor"
    5) Search for your vendor, when search results table is presented, the
    javascript is executed
    6) go through subscription creation and save the new subscription
    7) On subscription detail page, the javascript is executed as well
    8) apply this patch
    9) Repeat 3-7, the script is not executed, the input is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4301a52b83ca24876ff58fd78bee863df5ce398
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 15 17:05:29 2018 +0000

    Bug 20216: Correctly populate values in itemtype editor
    
    Caused by a bad merge conflict on bug 12768.
    
    To test:
    1 - Edit an item type, define a replacement cost,processing fee, and
    remote image url
    2 - Save the item type
    3 - Values are correct in list
    4 - Edit again
    5 - note values in fields are not populated
    6 - Save itemtype, values are lost
    7 - Apply patch
    8 - Repeat 1-4
    9 - Values should be correctly populated and saved now
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Bug 20216: (follow-up) - Fix other use of remote_image
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0e29fc46fbc9c6dad7bdd360a067696c930d4cc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 15:20:16 2018 -0300

    Bug 19641: (follow-up) Update circulation.tt too
    
    Fix bad merge conflict with bug 18403
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c45a5011ba815d1b13746a5c9192dfc51091dc7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 15:09:35 2018 -0300

    Bug 19641: (follow-up) Move patron templates to the footer
    
    Fix bad merge conflict with bug 12904
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fad518ed7de058937177c59fbc24f0fbcf30fe67
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 18 19:41:45 2018 +0000

    Bug 20038: Switch single-column templates to Bootstrap grid: Acquisitions
    
    This patch updates several acquisitions module templates to use the
    Bootstrap grid.
    
    - acqui/z3950_search.tt - Acquisitions -> Vendor -> View basket -> Add
      to basket -> From an external source. The Z39.50 search form should
      look correct.
      - Search for a title. The search results page should look correct.
    
    - acqui/addorder.tt - Acquisitions -> Vendor -> View basket -> Add to
      basket. Add an order to the basket which costs more than is available
      in the fund you select. The error/confirmation screen should look
      correct.
    
    - acqui\modordernotes.tt - Acquisitions -> Vendor -> View basket -> Add
      internal or vendor note. The note add form should look correct.
    
    - acqui/cancelorder.tt - Acquisitions -> Vendor -> View basket -> Cancel
      order (from an open basket which has existing orders). The
      confirmation screen should look correct.
    
    - acqui\basketheader.tt - Acquisitions -> Vendor -> New basket. The new
      basket edit form should look correct.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32efe993617f578773f62b7e9c82195bf34653ec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 18 18:00:20 2018 +0000

    Bug 20036: Switch single-column templates to Bootstrap grid: Offline circulation
    
    This patch updates three single-column offline circulation templates to
    use the Bootstrap grid.
    
    - offline_circ\process_koc.tt - Circulation -> Upload offline
      circulation.
    
    - offline_circ\enqueue_koc.tt - After uploading offline circulation
      file -> Add to offline circulation queue. The confirmation page is the
      page to be tested.
    
    - offline_circ\list.tt - From the confirmation page -> View pending
      offline circulation actions.
    
    Each of these pages should look correct, with a single centered column
    with wide margins on either side. At lower browser widths the margins
    should disappear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 027daeff56eea3baf48cc09f75e5dff100ddaa30
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 18 17:33:00 2018 +0000

    Bug 20035: Switch single-column templates to Bootstrap grid: Patron clubs
    
    This patch updates two single-column Patron clubs templates to
    use the Bootstrap grid.
    
    - clubs/clubs-add-modify.tt - Tools -> Patron clubs -> New club.
    - clubs/templates-add-modify.tt - Tools -> Patron clubs -> New club
      template. Also changed in this file: Markup corrections. Label "for"
      attribute should match the form field's id attribute.
    
    Each of these pages should look correct, with a single centered column
    with wide margins on either side. At lower browser widths the margins
    should disappear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae56b6bcc162e5ca15f9c5c63f09f00feb770122
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 18 16:45:05 2018 +0000

    Bug 20034: Switch single-column templates to Bootstrap grid: Circulation
    
    This patch updates two single-column circulation templates to
    use the Bootstrap grid.
    
    - circulation-home.tt - Circulation home page. This patch corrects what
      appears to have been a long-broken three-column layout.
    
    - article-requests.tt - Article requests list. Turn on the
      ArticleRequests system preference if necessary. Go to Circulation ->
      Article requests.
    
    Each of these pages should look correct, with a single centered column
    with wide margins on either side. At lower browser widths the margins
    should disappear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f22633033107b3ebcd9f7c77df638d98006e1db
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 18 16:08:26 2018 +0000

    Bug 20033: Switch single-column templates to Bootstrap grid: Catalog
    
    This patch updates a few catalog-related single-column templates to use
    the Bootstrap grid.
    
    - basket/basket.tt - The staff client cart. Add some items to the cart
      and open the cart.
    
    - catalogue/advsearch.tt - The advanced search page.
    
    - catalogue/itemsearch.tt - The item search page, both the initial form
      and the search results.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e2936a37e08e6c669a969984361f7d761efd074
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 18 15:32:56 2018 +0000

    Bug 20032: Switch single-column templates to Bootstrap grid: Tools
    
    This patch updates several single-column Tools templates to
    use the Bootstrap grid.
    
    - batchMod-del.tt - Tools -> Batch item deletion -> Submit barcodes or
      item numbers for deletion. The grid is changed for the results and
      confirmation screens.
    
    - batchMod-edit.tt - Tools -> Batch item modification -> Submit barcodes
      or item numbers for modification. The grid is changed for the results
      and confirmation screens.
    
    - koha-news.tt - Tools -> News -> Edit or create a new news item. The
      grid is changed for the edit screen.
    
    - letter.tt - Tools -> Notices and Slips -> Edit or create a notice. The
      grid is changed for the edit screen.
    
    Each of these pages should look correct. The News and Notices page
    should have a single centered column with wide margins on either side.
    At lower browser widths the margins should disappear.
    
    The batch mod screens should be displayed at full screen width.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5ee90225a5581ff77f2e055066b27eda91a5505
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 16 16:00:23 2018 +0000

    Bug 19982: Switch single-column templates to Bootstrap grid: Patrons
    
    This patch updates two single-column patron module templates to use
    the Bootstrap grid:
    
    - discharges.tt - The list of pending discharges. One or more
      discharges must have been made via the OPAC. From the staff client
      home page, look for "Discharge requests pending."
    
    - members-update.tt - The list of pending patron updates. One or more
      updates must have been submitted via the OPAC. From the staff client
      home page, look for "Patrons requesting modifications."
    
    Each of these pages should look correct, with a single centered column
    with wide margins on either side. At lower browser widths the margins
    should disappear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 908cf7f4ba94b4b97a2439a628d3af088d660c8b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 11 18:53:33 2018 +0000

    Bug 19960: Update popup window templates to use Bootstrap grid: Add to list
    
    This patch updates add-to-list template to use the Bootstrap grid
    instead of the YUI grid.
    
    To test, open the detail page for a bibliographic record in the staff
    client and choose "Add to -> List." The resulting pop-up window should
    look correct.
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9293e428b4e8809dcae1d1011a578550c860db7e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 10 19:21:46 2018 +0000

    Bug 19950: Update popup window templates to use Bootstrap grid: Serials
    
    This patch updates the two serials templates to use the Bootstrap grid
    instead of the YUI grid.
    
    Apply the patch and go to Serials and locate an existing
    subscription.
    
    - Click the "Edit routing list" in the sidebar.
    - Save the routing list, and click "Save and preview routing slip."
    - The routing slip preview should look correct and buttons should work
      correctly.
    
    - When viewing the details of a subscription, click the "Renew" button
      in the toolbar. The popup window should look correct.
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 609f2f1fc70742eeec2c491cfcb1806ef65ba4c3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Dec 5 18:30:08 2017 +0000

    Bug 19755: Move template JavaScript to the footer: Acquisitions, part 3
    
    This patch modifies even more staff client acquisitions templates so
    that JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    - Acquisitions -> Vendor -> Vendor details
      - Contracts datatable
      - Edit vendor
        - Add contacts, form validation
    - Acquisitions -> Vendor -> Invoices -> Invoice -> "Go to receipt"
      - Datatables, MARC and Card previews
        - Transfer
          - Confirmation of transfer, window closes
    - Acquisitions -> Vendor -> Receive shipments
      - Datatables, date pickers
    - Acquisitions -> Available funds table -> Spent report
      - Datatables
    - Acquisitions -> Vendor -> Uncertain prices
      - Datatables, form validation
    - Acquisitions -> Vendor -> Basket -> Add to basket from external source
      - Select and clear all on search form
      - Search results
        - Datatables, MARC and Card previews, in-table pop-up controls
          (click any table cell)
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b2da53bc1dac0ef7f5db62e77e41ed16fc58be8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 22 19:33:48 2017 +0000

    Bug 19682: Move JS to the footer: Two patron-related tools
    
    This patch modifies two patron-related tools templates in the staff
    client so that JavaScript is included in the footer instead of the
    header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    
      - Import patrons
      - Upload patron images
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Edit for QA: Fixed datepickers on import patron form
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de454ff55282f31f1d273f0be1481224613ecd2d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 26 13:12:16 2018 +0000

    Bug 19641: (follow-up) Fix update child menu option
    
    This follow-up corrects handling of clicks on the "Update child" menu
    option when the patron is an adult. Previously the click handler was
    conditionally added via template markup. This patch modifies it to use
    the data-tooltip attribute as an indicator that the option is disabled.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Open an adult patron's record for viewing.
    - Choose More -> Update child from the toolbar menu.
    - The menu item should be disabled, and should show a tooltip.
    - Clicking the menu item should do nothing.
    
    - Open a child patron's record for viewing.
    - Choose More -> Update child from the toolbar menu.
    - The patron should be updated to an adult category.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fc473e04db151d346429caa144b6051094ffeaf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 11 17:37:49 2018 +0000

    Bug 19641: (follow-up) Correct popup templates
    
    This patch corrects the footer include for two patron-related popup
    windows. popup-bottom.inc should be considered obsolete, and
    "'intranet-bottom.inc' popup_window=1" used in its place.
    
    To test you must have more than one adult-type patron category defined.
    
    - Locate and view a child-type patron record.
    - From the "More" menu in the toolbar, choose "Update child to adult
      patron."
      - The popup window which appears should look correct and work
        correctly.
    - Add a new patron and enter the first and last names of an existing
      patron.
      - When Koha asks to confirm a possible duplicate record, click the
        "View existing record" link. The popup which is triggered should
        look correct.
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a06d3d428f7a769fedb57bcac0d04f54cdafdc5c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 11 16:15:01 2018 +0000

    Bug 19641: (follow-up) Update circulation.tt too
    
    This patch makes the same JS-to-footer changes to circulation.tt.
    Inclusion of this template in this bug is necessary because it includes
    members-toolbar.inc.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Enter a patron card for checkout
    - Test any JavaScript-driven actions on the checkout page, for instance:
        - Select all/clear all controls
        - Datepicker/timepickers
        - Datatable sorting, columns configuration
        - Renewals, check-ins
        - Patron message interactions, print slip, and other toolbar actions
        - Checkout exports
        - Search to hold
        - Tab loading: Restrictions, Holds, Clubs
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 047ca33a937962c60278bb85398d83f26aaf3db6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 16 16:08:07 2017 +0000

    Bug 19641: Move patron templates to the footer
    
    This patch modifies the staff client patron module templates so that
    JavaScript is included in the footer instead of the header.
    
    This patch touches a lot of files because the changes are all
    interdependent, affecting a couple of module-wide include files.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    Patrons -> Patrons home, patron search results
      -> Manage pending modification requests
      -> Patron detail page
        -> Edit patron
          -> Set guarantor
        -> Fines
           -> Account, Pay fines, Create manual invoice, Create manual
              credit
           -> Print receipts for different kinds of charges
        -> Routing lists
        -> Circulation history
        -> Holds history
        -> Notices
        -> Statistics
        -> Files
        -> Purchase suggestions
        -> Discharges
        -> Housebound
        -> Set permissions
        -> Change password
        -> Print summary, slips, and overdues
        -> Update child to adult patron type
    
    Patron toolbar and patron search bar operations should work correctly on
    all pages.
    
    This patch also updates the template for searching the Norwegian
    national patron database, but it has NOT been tested.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Zoe Bennett <zoebennett1308@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebccf7424efdc9378077d3d1b1f0ec6c9f9b80a1
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Thu Feb 15 16:06:03 2018 +0100

    Bug 20214: (bug 18403 follow-up) Fix patron search: remove newline breaking JSON
    
    == Test plan ==
    1. go/cgi-bin/koha/members/members-home.pl
    2. search "a"
    3. result never display
    4. apply patch
    5. search "a"
    3. result display
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 205c55b1d25b39ad3758f0619778461128ff2563
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 11:23:48 2018 -0300

    Bug 19996: (RM follow-up 2) Remove commented use warnings;
    
    This one is easy to fix.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 262f6f3d4c1d53dcfc5551e8f36584353fa9d382
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 15 11:20:34 2018 -0300

    Bug 19996: (RM follow-up) Remove commented use warnings;
    
    These plugins are very noisy, badly written and I have no idea what they
    do.
    t/db_dependent/FrameworkPlugin.t outputs a log of warnings about "
    uninitialized value".
    
    Let fix them later.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69516294a5a0bc6d8c284670082863f3db2265bc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Feb 15 09:08:59 2018 +0100

    Bug 20204: Add TestBuilder to replace CPL branch
    
    Remove CPL; without this branch, the test crashes.
    Rearrange modules at the start.
    Add Koha::Database calls.
    Move a few global my vars to our level.
    Remove intermediate rollbacks.
    
    Test plan:
    [1] Run prove t/db_dependent/FrameworkPlugin.t
        Ignore noise from unimarc plugins :)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03a547da32195aa98cd9cd28b8d64f7bc399fa02
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 16:23:00 2017 -0300

    Bug 19243: Fix tests for patron categories
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1d4bdb926798a1523fe3e98e101aaa367555a19
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 16:09:41 2017 -0300

    Bug 19243: Fix tests for AV
    
    The tricky part here was to find an alternative for ends-with in Xpath
    version 1
    Indeed there are 2  button with
    "/admin/authorised_values.pl?op=add_form", and the first one was picked
    (/admin/authorised_values.pl?op=add_form&category=Asort1)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8391e5d9353392eeae594b29111ebfeb2938a87d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 14:38:55 2017 -0300

    Bug 19243: The "delete library" is now a button with id
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26cc2b211a1bfae5bf510f6aeaf5cab751cdcabf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 14:37:43 2017 -0300

    Bug 19243: Fix for bug 19860
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f175ce2bb556dd79561b5945708c77223bddb70
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 14:11:05 2017 -0300

    Bug 19243: fix urls - do not use /cgi-bin/koha
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8876fd3e716dc71640bc1f067f37ecd82c21384c
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Thu Dec 14 23:07:30 2017 +0000

    Bug 19243: Amended Selenium test to add the creation of patron category and authorised values
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bee0c0b4ab17d336feda519b842f8212edfd696f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 12 19:11:15 2017 -0300

    Bug 19243: Add selenium tests for the administration module
    
    This is just a start.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6f95808d815c6ef5376a5e9d5e238387010dd6d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 14:41:50 2017 -0300

    Bug 19802: Add stack trace to ease debugging
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d482aef2e420cc2466a6e645eebea9c0c8d4a19d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 12 15:42:56 2017 -0300

    Bug 19802: Move Selenium code to t::lib::Selenium
    
    To make it reusable easily.
    
    Test plan:
    The basic_workflow.t tests should still pass after this change.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c489457caf79f3c71eb78e1c75939fcde0fef32
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 13 15:52:45 2018 -0300

    Bug 20144: (follow-up) Adjust /patrons endpoint
    
    Fields 'address' and 'city' have been maybe nullable by this bug. This
    patch makes them nullable on the API as well.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Tests fail (randomly) when address or city are set to null by
             TestBuilder.
    - Apply this patch
    - Run:
     k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea7fa8d011afc6d2337aebb440c1bf1f4732b143
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 13 14:09:12 2018 -0300

    Bug 20144: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc30a2c82c487fdf6da354cccd86c29b2c1d4aee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 13 14:07:37 2018 -0300

    Bug 20144: DBRev 17.12.00.015
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53e46a58624f14f6528b6bd06c0eb39bd09b9e0f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 16:32:26 2018 -0300

    Bug 20144: [sql_modes] Do not store 0000-00-00
    
    This patch needs to be linked with bug 20145.
    
    Fix for:
    Incorrect date value: '0000-00-00' for column 'dateexpiry'
    
    We cannot longer store 0000-00-00, but no need to.
    The tests must be kept for now as long as bug 20145 has a solution
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb16189e0bedb6c2c91d778ca842cfca2507018c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 15:43:09 2018 -0300

    Bug 20144: [sql_modes] Fix GROUP BY clause in Virtualshelves search (DT)
    
    Fix for:
    'koha_kohadev.vs.shelfname' isn't in GROUP BY
    
    t/db_dependent/Utils/Datatables_Virtualshelves.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f69f6e1c8738564c30d613d245ea8af5f6b91fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 14:49:47 2018 -0300

    Bug 20144: [sql_modes] Set subscription.numberlength and weeklength to NULL if not passed
    
    Fix for:
    Incorrect integer value: '' for column 'numberlength'
    Incorrect integer value: '' for column 'weeklength'
    
    t/db_dependent/Serials/ReNewSubscription.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 410e3c81d59f27e4e21d4f55d45c9de74f6d80d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 14:47:43 2018 -0300

    Bug 20144: [sql_modes] Add default value for subscription_numberpatterns.description in tests
    
    Fix for:
    Field 'description' doesn't have a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0fe8670547ec0fe3e55f8e0dbb77fbf07f141601
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 14:45:08 2018 -0300

    Bug 20144: [sql_modes] Fix search history tests
    
    Incorrect datetime value: '1374978877' for column 'time'
    
    Need to investigate this: Why did I put that value in the test?
    Does the feature correctly works?
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 129270cd4657f6b13b3890920cbd75cd83595187
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 14:39:32 2018 -0300

    Bug 20144: [sql_modes] Fix values when creating a sql report in tests
    
    For fix:
    Data too long for column 'report_area'
    Incorrect integer value: 'null' for column 'cache_expiry'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44ca7c37acd2b5f16160c03d8772c1ff01f3990a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 14:32:27 2018 -0300

    Bug 20144: [sql_modes] Set default value for opac_news.content in tests
    
    Fix for:
    Field 'content' doesn't have a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a93e49131d4d22c5bc2123f9a3626c36845d9e07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 13:39:51 2018 -0300

    Bug 20144: [sql_modes] Remove ORDER BY clause for COUNT(*) in GetItemsForInventory
    
    Fix for:
    DBD::mysql::st execute failed: Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause [for Statement 'SELECT COUNT(*)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a0e21f0ecfd7e5bd135ad30e8955960b5d3549d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 13:36:42 2018 -0300

    Bug 20144: [sql_modes] Remove useless ORDER BY clauses in tests
    
    Fix for:
    Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf26f1f41f5d0d6ebedfe46b9405dc3b8fc71506
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 13:28:38 2018 -0300

    Bug 20144: [sql_modes] Set value for creator_batches.timestamp
    
    Fix for:
    Incorrect datetime value: 'now()' for column 'timestamp'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8f0a3fc40ce4aa64dec1c819a936d7397970ddf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 13:27:32 2018 -0300

    Bug 20144: [sql_modes] Set default value for biblio.datecreated in tests
    
    Fix for:
    Field 'datecreated' doesn't have a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffae331219341978582bc1db7a03b2c6449b7227
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 12:51:19 2018 -0300

    Bug 20144: [sql_modes] Set value for pending_offline_operations.timestamp
    
    Not null
    
    Fix for:
    Incorrect datetime value: 'null' for column 'timestamp'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21922eeac502d055ee5eaaf59da0ae8d251d37a3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 12:34:34 2018 -0300

    Bug 20144: [sql_modes] Remove HAVING clause from GetTopIssues
    
    Fix for:
    'koha_kohadev.b.title' isn't in GROUP BY
    
    t/db_dependent/Circulation/GetTopIssues.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29434b14549144589cc0663a25246914cb093d3d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 12:26:56 2018 -0300

    Bug 20144: [sql_modes] Remove 'Null' string values from GetHardDueDate.t
    
    Must be undef or correct integer value
    
    Fix for:
    Incorrect integer value: 'Null' for column 'enrolmentperiod'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f75f7bb9eec1325cf3c1527c571fbe392b478ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 12:15:02 2018 -0300

    Bug 20144: [sql_modes] Set default value for Itemtype fees in TestBuilder
    
    Fix for:
    Out of range value for column 'amount'
    
    t/db_dependent/Circulation/Chargelostitem.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39b0b5909cb0bc271b85723eb32d02146649b3be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 12:02:47 2018 -0300

    Bug 20144: [sql_modes] Fix GROUP BY clause in GetInvoices
    
    Need to be tested from the interface!
    
    Fix for:
    'koha_kohadev.aqinvoices.invoicenumber' isn't in GROUP BY
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e35da4f6b0e2c25ca1e6acb3e80f8b9d65cb658
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 11:54:18 2018 -0300

    Bug 20144: [sql_modes] Fix GROUP BY clause in GetBasketsInfosByBookseller
    
    This need to be tested from the interface!
    
    Fix for:
    'koha_kohadev.aqbasket.basketname' isn't in GROUP BY
    
    t/db_dependent/Acquisition/GetBasketsInfosByBookseller.t
    
    We need this group by.
    We should not need to list all fields, from mysql 5.7 doc:
    https://dev.mysql.com/doc/refman/5.7/en/group-by-handling.html
    "The query is valid if name is a primary key of t or is a unique NOT NULL column. In such cases, MySQL recognizes that the selected column is functionally dependent on a grouping column. "
    
    However, MariaDB did not implemented yet:
    https://jira.mariadb.org/browse/MDEV-11588
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 406a480a780e67d3386e354907f8fac674257c17
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 11:08:02 2018 -0300

    Bug 20144: [sql_modes] Add default value for export_basket.description in tests
    
    Fix for:
    Field 'description' doesn't have a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51ddaa78953b4751d193ebfec2efbf331c6f8502
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 11:00:31 2018 -0300

    Bug 20144: [sql_modes] Shorten values for virtualshelfshares.invitekey in tests
    
    It's a varchar(10)
    
    Fix for:
    Data too long for column 'invitekey'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61679027b50baac783bd9f8914d5d31ac4364bb2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 10:55:15 2018 -0300

    Bug 20144: [sql_modes] Set correct value for old_issues.issue_id in tests
    
    Fix for:
    Column 'issue_id' cannot be null
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d43eb8b19c8b9fe51c5a6bde0a565fe363596e36
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 10:49:40 2018 -0300

    Bug 20144: [sql_modes] Shorten auth_header.authtypecode values in tests
    
    Fix for:
    Data too long for column 'authtypecode'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db181fd8e15df0309898e3c6b62ed6446a68d526
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 10:48:49 2018 -0300

    Bug 20144: [sql_modes] Set auth_header.marcxml to an empty string in tests
    
    Fix for:
    Field 'marcxml' doesn't have a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2292e83f13f499472e251995596ff04c263339d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 10:47:09 2018 -0300

    Bug 20144: [sql_modes] Set default value for biblio.datecreated in tests
    
    Should call Koha::Biblio->new instead
    
    Fix for:
    Field 'datecreated' doesn't have a default value
    
    t/db_dependent/UsageStats.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23018e15127c163ffb1559c3627cc261e846df07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 19:13:07 2018 -0300

    Bug 20144: [sql_modes] Add default value for subscription_numberpatterns.description in tests
    
    Fix for:
    Field 'description' doesn't have a default value
    
    t/db_dependent/Serials.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cbd566caf6e827e67c20d7d06de2e5bd7036dff5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 19:10:34 2018 -0300

    Bug 20144: [sql_modes] Remove HAVING clause in GetBorrowersToExpunge
    
    Special attention needed here!
    
    Fix for:
    Non-grouping field 'currentissue' is used in HAVING clause
    
    t/db_dependent/Members.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3755a38acfd4972d794bef8cb844e5474c3c4112
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 18:40:36 2018 -0300

    Bug 20144: [sql_modes] Set default value for marc_modification_template_actions
    
    Cannot be empty strings.
    
    Fix for:
    Data truncated for column 'conditional'
    Data truncated for column 'conditional_comparison'
    Incorrect integer value: '' for column 'conditional_regex'
    
    t/db_dependent/MarcModificationTemplates.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 666cbed5e17f8b644300c43091231554eaeb3eb0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 18:26:05 2018 -0300

    Bug 20144: [sql_modes] Fix GROUP BY clause in GetLetters
    
    This subroutine is wrong and must be rewritten using
    Koha::Notice::Templates.
    Mainly because the DB structure is bad.
    Meanwhile we remove the branchcode from the SELECT to get correct
    results, it was not used by callers anyway.
    
    Fix for:
    'koha_kohadev.letter.module' isn't in GROUP BY
    
    t/db_dependent/Letters.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2decad7b43e298524c0aea812462b73c7f088573
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 18:23:59 2018 -0300

    Bug 20144: [sql_modes] Correct quotes.timestamp values in tests
    
    Fix for:
    Incorrect datetime value: '0000-00-00 00:00:00' for column 'timestamp'
    
    t/db_dependent/Koha.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e053ccb682402d57253471d8f07dcf906ea288c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 18:22:34 2018 -0300

    Bug 20144: [sql_modes] Set default value for biblio.datecreated in tests
    
    When created without Koha::Biblio.
    
    Fix for:
    Field 'datecreated' doesn't have a default value
    
    t/db_dependent/Items.t
    
    TODO LATER - Use Koha::Biblio instead
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 294ea88614ab8683904dee5123d69c896a174f59
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 18:19:53 2018 -0300

    Bug 20144: [sql_modes] Set import_records.marcxml_old to '' on INSERT
    
    Fix for:
    Field 'marcxml_old' doesn't have a default value
    
    t/db_dependent/ImportBatch.t
    
    Fixme - need to update existing DB?
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d439a5c5852db2c524c5ba027d0ce58c0d8d537
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 18:08:03 2018 -0300

    Bug 20144: [sql_modes] Remove HAVING clause in GetUpcomingDueIssues
    
    More attention needed here!
    
    Fix for:
    Non-grouping field 'days_until_due' is used in HAVING clause
    
    t/db_dependent/Circulation.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b51c8e443e32cdad241b032bca042a53c698769
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 18:02:12 2018 -0300

    Bug 20144: [sql_modes] Set issuingrules.no_auto_renewal_after to NULL in tests
    
    Fix for:
    Incorrect integer value: '' for column 'no_auto_renewal_after'
    
    FIXME - must we update values for existing installs?
    TODO - check if can be set to an empty string from the interface
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae63d6e27156981a171540c0180a96f86c3fc184
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 17:48:03 2018 -0300

    Bug 20144: [sql_modes] Add default value for subscription_numberpatterns.description in tests
    
    Fix for:
    Field 'description' doesn't have a default value
    
    t/db_dependent/AdditionalField.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecc69f0ab24c926696ae1c537589801e0f41d9b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 17:38:32 2018 -0300

    Bug 20144: [sql_modes] Remove HAVING clause in GetLateOrders
    
    More attention needed here!
    
    Fix for:
    Non-grouping field 'quantity' is used in HAVING clause
    
    Having is useless, and certainly slower
    
    t/db_dependent/Acquisition.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f854d16def40a97df326e356063bd931d03c3032
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 17:31:34 2018 -0300

    Bug 20144: [sql_modes] Shorten aqbudgets.budget_code
    
    Fix for:
    Data too long for column 'budget_code'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5693d255d553e8670cb5da7a9f65e3e9a6a229bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 17:22:05 2018 -0300

    Bug 20144: [sql_modes] Set default value for Acccountline in TestBuilder
    
    Fix for:
    Data too long for column 'proccode'
    
    t/db_dependent/Accounts.t
    
    FIXME LATER - It's a varchar(4), must be integer!
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2bb3392156e4314b948c39e4037c1c1662240f6a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 17:17:11 2018 -0300

    Bug 20144: [sql_modes] Fix default value for statistics.itemnumber
    
    Must be an integer, not empty string
    
    Fix for:
    Incorrect integer value: '' for column 'itemnumber'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b482f11d438ee84657690e0d1460a21c2814def8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 16:24:56 2018 -0300

    Bug 20144: [sql_modes] Add a value for borrower_attribute_types.description in tests
    
    Fix for:
    Field 'description' doesn't have a default value
    
    t/db_dependent/Koha/Patron/Attribute/Types.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a11d648980dc5bc9bb5b7dbf5228622a82d5d481
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 16:21:43 2018 -0300

    Bug 20144: [sql_modes] Shorten items.barcode
    
    It's a varchar(20)
    
    Fix for:
    Data too long for column 'barcode'
    
    t/db_dependent/Koha/Items.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16cb9e92e5bf81086ad848e6b19e43bc9f74708a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 16:20:05 2018 -0300

    Bug 20144: [sql_modes] Correct quotes.timestamp values in tests
    
    Fix for:
    Incorrect datetime value: '0000-00-00 00:00:00' for column 'timestamp'
    
    t/db_dependent/Koha/GetDailyQuote.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2672f9d7f697583cba3fef18fb75d5706e242c38
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 16:09:31 2018 -0300

    Bug 20144: [sql_modes] Add default values for export_format columns
    
    Fix for:
    Field 'field_separator' doesn't have a default value
    Field 'encoding' doesn't have a default value
    
    field_separator and subfield_separator are only used for MARC csv
    profiles, no need to specify a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b48213f4271d6314bb8f9a5b629695f2f30eb24
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 16:03:03 2018 -0300

    Bug 20144: [sql_modes] Shorten cities.city_zipcode
    
    It's a varchar(20)
    
    Fix for:
    Data too long for column 'city_zipcode'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c2329b02d9643f47dcf93aa7be9c31def4b2d91
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 15:51:03 2018 -0300

    Bug 20144: [sql_modes] Set auth_header.marcxml to an empty string in tests
    
    Fix for:
    Field 'marcxml' doesn't have a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f975945c2b26e640b8a73ab8cc73d5059bcf9f5f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 15:46:51 2018 -0300

    Bug 20144: [sql_modes] Set missinglist and recievedlist in subscriptionhistory
    
    Fix for:
    Field 'missinglist' doesn't have a default value
    
    t/db_dependent/Koha/Acquisition/Booksellers.t
    
    from mysql doc:
    BLOB, TEXT, GEOMETRY, and JSON columns cannot be assigned a default
     value.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ed2a1f5e810b37744c88b072e3883d1c5ba5845
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 15:39:49 2018 -0300

    Bug 20144: [sql_modes] Fix date format in tests
    
    Fix for:
    Incorrect date value: '01-01-2013' for column 'startdate'
    Incorrect date value: '01-01-2016' for column 'budget_period_enddate'
    Incorrect date value: '30-11-2013' for column 'enddate'
    Incorrect date value: '31-12-2015' for column 'budget_period_enddate'
    Incorrect date value: '12-31-2015' for column 'budget_period_enddate'
    Incorrect date value: '01-01-2014' for column 'entrydate'
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b27ff2fdeafa0acfb34257dbe4080bacacb4147
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 15:36:27 2018 -0300

    Bug 20144: [sql_modes] Set default value for aqbasket.is_standing
    
    Fix for:
    Column 'is_standing' cannot be null
    
    t/db_dependent/Koha/Acquisition/Booksellers.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06baf06d21e5c808d0e0eed37f3a737dfe0f4e3b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 15:32:28 2018 -0300

    Bug 20144: [sql_modes] Fix datatype for aqbasket.authorisedby
    
    It's defined as a VARCHAR(10) in DB, but it is expecting a
    borrowernumber instead
    
    Fix for
    Data too long for column 'authorisedby'
    
    Must be a FK but first a borrowernumber
    Need to update kohastructure for the comment?
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42e41883a4c8daad97201ad2a0d29443d9facc13
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 15:21:26 2018 -0300

    Bug 20144: [sql_modes] Set default value for Aqbookseller in TestBuilder
    
    Fix for:
    Out of range value for column 'tax_rate'
    
    t/db_dependent/Koha/Acquisition/Basket.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit efdf8cc9641f16c6cf3e7d4d7aebcbf22350863b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 14:51:43 2018 -0300

    Bug 20144: [sql_modes] Fix generated value for account_offsets.amount
    
    Fix error:
    Out of range value for column 'amount'
    
    DBD::mysql::st execute failed: Out of range value for column 'amount' at
    row 1 [for Statement "INSERT INTO `account_offsets` ( `amount`,
    `debit_id`, `type`) VALUES ( ?, ?, ? )" with ParamValues:
    0=7925469795795194609664.000000, 1='10', 2='Manual Debit'] at
    /usr/share/perl5/DBIx/Class/Storage/DBI.pm line 1832.
    
    7925469795795194609664.000000
    => Should be lower anyway
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ef4bad47377eefa83bc6a2fe5ae64e39707c266
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 14:41:48 2018 -0300

    Bug 20144: [sql_modes] Fix default value for statistics.amount
    
    Must be an integer, not empty string
    Fix for:
    Data truncated for column 'value'
    
    Found with
    t/db_dependent/Holds/DisallowHoldIfItemsAvailable.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d03a6206da9b74ff169dd71154992d80b966cd5d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 14:33:45 2018 -0300

    Bug 20144: [sql_modes] Set a default value for lowestPriority
    
    Fix for:
    Field 'lowestPriority' doesn't have a default value
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e2c353b1a4f0895a0b6b887534dc70764637a68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 14:28:31 2018 -0300

    Bug 20144: [sql_modes] Fix borrowers table structure
    
    surname, address and city can be NULL
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0706bb18f98ace6aa2272833a9e3d61659a0cb8a
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Tue Jan 30 11:22:52 2018 -0500

    Bug 19530: Don't update the date arrived for closed transfers
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc381290bb1b1432513999c8fced120a316ada20
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Oct 25 21:28:10 2017 -0400

    Bug 19530: Added commentary for last test when prove -v
    
    Before patch, prove -v had no comment for the last test.
    After patch, it says something in line with second last test.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b85a24d6debdbea7bb5786a1470b5143ade3cfca
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Oct 25 14:24:18 2017 -0400

    Bug 19530: Prevent multiple transfers from existing for one item
    
    We have found multiple open branch transfers for a given item. While I'm not sure how it is happening at this point, it seems that it would make sense to cancel any existing branch transfers when initiating a new one.
    
    Test Plan:
    1) prove t/db_dependent/Circulation/transfers.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9c696fd03f177e6e2b4727126f124601f495f7c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 13 13:34:12 2018 -0300

    Bug 19466: Restore original sentence to avoid additional translation
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8df9ba7ec5c8a01b1a12ebab12c5b965441d0f21
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Thu Dec 21 10:20:48 2017 -0500

    Bug 19466: Warn about conflicting settings of autoMemberNum and BorrowerMandatoryField for cardnumber
    
    Changes the appearance of the cardnumber entry field in memberentrygen.tt
    The "Leave empty for autocalc" message has been moved to the hint div
    under the input field. If AutoMemberNum and BorrowerMandatoryField
    interfere with each other, the auto calc hint is replace by a warning
    telling the user that auto calc has been disabled.
    
    Cardnumber should now correctly appear as mandatory if marked as such
    in BorrowerMandatoryField.
    
    Test plan:
    0] Apply patch
    1} Disable AutoMemberNum, remove cardnumber from BorrowerMandatoryField
    2) Edit or create a patron, scroll down to cardnumber input field
        Hint is some form of "Cardnumber must be this long"
        Cardnumber input is not marked as required
        There is no mention of auto calc
    
    3> Enable AutoMemberNum
        Hint includes "Leave empty for auto calc" message
    
    4~ Add cardnumber to BorrowerMandatoryField
        Hint warns you that your sysprefs are conflicting.
        Cardnumber input is marked as required
    
    5: Disable AutoMemberNum
        Hint is some form of "Cardnumber must be this long"
        Cardnumber input is marked as required
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a845188c7d3a7700301d5d649ad7685f72879d6d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 22 10:08:07 2017 +0100

    Bug 19301: (QA follow-up) Add a few simple tests
    
    We removed tests from Reserves.t, but would be nice to test the new
    sub in IssuingRules.t too.
    Adding a subtest there.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 149cb5014932749cb0c13a2a8ae3ff18bfd4dc52
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 22 09:07:50 2017 +0100

    Bug 19301: (QA follow-up) Add POD, use statements and correct typo
    
    Add POD for new sub in Koha/IssuingRules.pm.
    Adding use Koha::IssuingRules to opac-detail and opac-MARCdetail.
    Adding use Koha::Items to opac-detail and opac-MARCdetail.
    Correct typo $items => $item in opac-MARCdetail.pl.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c06bc6422f8aba1ada7c2351f3a3ffc4c67576b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 14:04:08 2017 -0300

    Bug 19301: Remove C4::Reserves::OnShelfHoldsAllowed
    
    At this point the subroutine is not used anymore
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39e1fbcbe95eb128dc9e6eb78df2ea2f0c68ff0f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 11 16:02:19 2017 -0300

    Bug 19301: Move C4::Reserves::OnShelfHoldsAllowed to get_onshelfholds_policy
    
    Following the pattern introduced by bug 19300, we are going to move the
    OnShelfHoldsAllowed logic to Koha::IssuingRules->get_onshelfholds_policy
    
    Test plan:
    Make sure the onshelfholds policy is correct when placing a hold
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3c922c2a1b8f24f0348480869904eccb2160079
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Fri Jan 12 09:51:45 2018 +0000

    Bug 4319: (QA follow-up) Rename hasItemswaitingOrInTransit to has_items_waiting_or_intransit
    
    and udate pod
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9905247a481c7eb4db6d2cc38ea3f1041d66aa4b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 15 10:49:44 2017 +0100

    Bug 4319: (QA follow-up) Use ReservableItems in all scripts
    
    [1] Call CountItemsIssued or hasItemswaitingOrInTransit when needed only.
    [2] Add this logic to ISBD and MARC detail too, since they also use
        this include.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Confirming that Place hold now comes up if you have a waiting item and
    circulation rule == If any unavailable.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ac45d00b6c2cabe3535ec31e901b2c6b0f6f191
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 15 10:09:29 2017 +0100

    Bug 4319: (QA follow-up) Consistency in IsAvailableForItemLevelRequest
    
    [1] For consistency going back to IsItemOnHoldAndFound in this sub.
        This call is used in the on_shelf_holds == 2 case too.
        The routine will be refactored quite soon.
        Adding the else branch for on_shelf_holds == 0 for more clarity.
    [2] Removing the test for found==F in reserves. In Koha F is only used
        when the hold is filled and moved to oldreserves.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9779b67d652351c32486ffc005a01b465ec463e
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Tue Oct 3 14:50:36 2017 +0000

    Bug 4319: [OPAC] Allow holds on waiting/transit items
    
    Test plan:
    
     - Checkout an item
     - Place hold on this item,
     - Return the item
     - Make sure the hold is waiting (found W) and AllowOnShelfHolds is
       not to 'Allow'
     - Check that the button "Place hold" appears in opac detail page of
       the biblio
    
     - do the samewith items/reserves in transit
    
    Changes on C4::Reserves::IsAvailableForItemLevelRequest
    
    Make sure this tests pass:
      - t/db_dependent/Reserves.t
      - t/db_dependent/Holds/DisallowHoldIfItemsAvailable.t
    
    Rebased - 2017-12-12 - Alex Arnaud
    
    Bug 4319 - [QA fix] Create Koha::Biblio->hasItemswaitingOrInTransit
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit addb4a06b5e082c56f91a325565c0b688439a1de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 13 12:33:30 2018 -0300

    Bug 20190: Replace intranet-tmpl with [% interface %]
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bc0ea5bd73e679cafabc73506584f9e29493529
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Tue Feb 13 10:01:05 2018 -0500

    Bug 20190: TinyMCE is broken and not displayed
    
    Changes made by bug 12904 appear to have affected TinyMCE.
    
    Test plan:
    1) Edit a library, note the OPAC info editor is missing
    2) Apply this patch
    3) Reload the page
    4) The editor is back!
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c24abd7dc1fdd71e64083478134dc99fc39cf654
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 13 12:47:27 2018 -0300

    Bug 20189: Fix style on installer and onboarding pages
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5dcfcd6b3bf24b78fab75149b271ea902b393bf
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Feb 13 15:33:12 2018 +0100

    Bug 20189: Fix style on the authentication page
    
    Needed when logging out and in again..
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 818f1c2f83682167c6850bf28eeac89a06389e8e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Feb 13 15:53:48 2018 +0100

    Bug 20187: (QA follow-up) Replace N,L flag by L flag
    
    The flags [N,L] make no sense: next and last combined.
    Choosing here for L to stop the rewriting process.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cd0a76d1034d582ff0cfde986331324369294f7
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 13 13:20:24 2018 +0000

    Bug 20187: New rewrite rules can break custom css
    
    Koha has the ability to include custom css in the apache configuration.
    If a library has any custom css ( or adds a custom js file in some way ),
    and that file has an underscore in it ( e.g. my_custom.css ), the
    apache rewrite rule will convert it to my.css and thus it will 404.
    
    We should make the rewrite rules as specific as possible for the
    format we are using.
    
    Test Plan:
    1) Set OPAC_CSS_OVERRIDE to a file with an underscore in it
    2) Note it does not work
    3) Apply this patch
    4) Update the apache rewrite rules to match those in the patch
       For kohadevbox, just run /home/vagrant/misc4dev/cp_debian_files.pl
    5) Restart apache
    6) Reload the page, your custom css should load now!
    
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c079990723a90e2d97f821959cf0289dad539c73
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 5 15:30:48 2018 +0000

    Bug 20135: Prevent staff client language choose pop-up from appearing off-screen
    
    This patch fixes a bug which was introduced by Bug 19851 ("Improve
    responsive layout handling of staff client menu bar."). The changes in
    that patch did not take into account the effects it would have on the
    language menus in the footer.
    
    This patch adds some additional classes to some menus and adds some CSS
    for those classes so that menus are correctly aligned left or right
    based on their position on the screen.
    
    To test, apply the patch and clear your cache if necessary. You should
    have multiple translations installed and enabled, at least one of which
    should have more than one "sub-language" (e.g. en-GB and en-US).
    
    In the staff client, test the appearance of various drop-down menus with
    the browser width above and below 800 pixels wide:
    
    - Search and More menus in the header
    - User/Library menu in the header
    - Language selection in the footer
    - Language selection in the header
    
    In all cases, menus should look correct and should not be aligned in
    such a way that they disappear off the left or right sides of the
    screen.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47b359cc96b238250637db9ae9df2e176c4ea3ca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 13:17:50 2017 -0300

    Bug 19671: Map itemtypes to hash for correct display in issues_stats.pl
    
    To test:
    1 - Run the circulation wizard with itemtypes as columns, shelving
    locations as rows - display on screen
    2 - Note all itemtype values are blank
    3 - Switch rows/columns - same issue
    4 - Apply patch
    5 - Re-run reports
    6 - Itemtypes should display correctly
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c78966c5d6eb182ad3de2eaf9d47fa843764c6b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 8 18:27:42 2018 +0000

    Bug 20163: Position of NoLoginInstructions text is inconsistent
    
    This patch modifies the markup for two login forms, making the markup
    more consistent between them. The order of NoLoginInstructions, "Forgot
    your password?" and "Don't have an account?" should now be the same.
    
    This patch also updates some classes in each login form to allow for
    more consistent custom styling.  A couple of capitalization corrections
    are included.
    
    To test, enable the PatronSelfRegistration and OpacResetPassword
    preferences. Put some text in the NoLoginInstructions preference.
    
    View the login form as associated links on the OPAC main page. Compare
    to the login form which appears in a modal window when you click the
    login link at the top of the page. The two areas should look consistent.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b8ae21185a6c175b47407b4dfc716efd58108dd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 18:07:20 2018 -0300

    Bug 7143: Update about page for new dev - Chad Billman
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c5633b0ea1e6393d9f31e990d97c6c75f65899a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 17:55:00 2018 -0300

    Bug 19790: DBRev 17.12.00.014
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15b46699d5de79cddfcef6a5199355f95d4a6fb3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Dec 11 10:09:00 2017 +0100

    Bug 19790: Add a db revision for existing installs
    
    Since many installs may still have the additionalauthors kohafield,
    this patch adds a dbrev in atomicupdate to clear it.
    
    Test plan:
    [1] Run updatedatabase. Check that you see no additionalauthors anymore
        in marc_subfield_structure.kohafield.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25c5f3968fde4559898a8f7c6733afa534d3e08a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Dec 11 09:39:37 2017 +0100

    Bug 19790: Remove additionalauthors.author from installer files
    
    In the upgrade from 2.2 to 3.0 (some time ago already) the table
    additionalauthors has been dropped. Unfortunately, a reference to this
    table has not been removed from the MARC framework installer files.
    
    This patch clears kohafield for 700$a or 200$g in 32 installer files.
    
    Note: The reference to additionalauthors in field kohafield is silently
    ignored in AddBiblio/ModBiblio since the routines _koha_add_biblio,
    _koha_add_biblioitem, _koha_modify_biblio and
    _koha_modify_biblioitem_nonmarc simply do not use it. You can define a
    Koha to MARC mapping for a biblio/biblioitem field but if the field is not
    referenced in one of those routines, nothing happens..
    Also note that C4::Items::_koha_modify_item does not hardcode all fields
    and will respond to a new item mapping.
    
    Test plan:
    [1] Run a new install or verify somehow that the change to these sql files
        is correct.
        The change is a result of: sed -i -e "s/'additionalauthors.author'/''/g"
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Run a new install with MARC21 and English. This includes the mandatory
    file marc21_framework_DEFAULT.sql. Verified that 700$a was inserted
    correctly (without additionalauthors).
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c15abaeda937fde619c79e7b437902994e2d7f9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 17:43:55 2018 -0300

    Bug 18403: Fix POD for C4::Output::output_and_exit_if_error
    
    xt/author/podcorrectness.t
    C4/Output.pm (310): Expected text after =item, not a bullet
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75c0481466f0b3887847e24a2069cd396d8f712c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 17:35:53 2018 -0300

    Bug 18403: Fix perlcritic on Koha::Patron
    
    Perl::Critic found these violations in "Koha/Patron.pm":
    "return" statement followed by "sort" at line 798, column 5.  Behavior
    is undefined if called in scalar context.  (Severity: 5)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1686054ac3467bc1770de8f0f5485b208a49e6d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 17:33:18 2018 -0300

    Bug 18403: rename Koha::Patron->can to has_permission
    
    I do not exactly why but there is a conflict in the name of the method
    
    prove t/db_dependent/api/v1/patrons.t failed with
    [Mon Feb 12 17:13:16 2018] [error] Can't use string ("TO_JSON") as a
    HASH ref while "strict refs" in use at
    /home/vagrant/kohaclone/C4/Auth.pm line 2053.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5373bbaf5d1bdfcf997e0f9b2e67962c40374220
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 17:52:49 2018 -0300

    Bug 20175: DBRev 17.12.00.013
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffd7fa3a068ff60976b1cf6f94fd2a48ae2d619c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 7 11:58:02 2018 -0300

    Bug 20175: [sql_modes] (follow-up) Set a correct default value for club_enrollments.date_created
    
    From comment 6:
    """
    Can't recreate database, when creating table structure, I got:
    there can be only one TIMESTAMP column with CURRENT_TIMESTAMP in DEFAULT
    or ON UPDATE clause
    
    I am on mysql 5.5.59, which is still default in jessie, more timestamp
    columns are possible from mysql 5.6.5:
    https://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-5.html
    """
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a43228c547200e4b6d9f03fe25e98d124889226
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 14:22:59 2018 -0300

    Bug 20175: [sql_modes] Set a correct default value for club_enrollments.date_created
    
    0000-00-00 00:00:00 is not a valid timestamp.
    
    It will fix the installer and upgrade process
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55af5cdc0052a7cbc10f12b1fffeec26f1e886d4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 7 17:23:56 2018 +0000

    Bug 20155: (follow-up) Compiled CSS
    
    This patch contains the compiled opac.css file.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d83f0c1d8aa0da95c77d6d083f5bf2a702a56f66
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 7 17:17:34 2018 +0000

    Bug 20155: Improve readability of OPAC header language menu
    
    This patch makes some minor HTML and CSS changes in order to make the
    header's language-chooser menu more readable and consistent with the
    Lists menu.
    
    To test, apply this patch and the patch with the compiled CSS.
    
    - Install and enable more than one translation.
    - Set the OpacLangSelectorMode to either "top" or "both top and footer."
    - View the OPAC's header menu and confirm that the links and menus look
      correct whether or not a user is logged in.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca161474f3f01e9b1b444a2bc21566de6e17afdb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 9 11:47:52 2018 +0100

    Bug 19451: (QA follow-up) Replace weird subquery
    
    As requested, we add a JOIN and make the SELECT distinct.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested that no-overwrite still works as expected.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9f096fec335b9a1b453e4c56f30f8d9aa22652b
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Feb 7 21:06:10 2018 +0000

    Bug 19451: (QA follow-up) Change parameter name no_overwrite to no-overwrite for consistency
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd4992749b75f2d8e57fe3ddce1eb9ff4b004fe1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 12 12:19:11 2017 +0200

    Bug 19451: Add no_overwrite option to borrowers-force-messaging-defaults.pl
    
    This option allows you to add preferences only when they are not yet
    present. In other words: skip patrons that already set their prefs.
    
    Test plan:
    [1] Delete all borrower messaging prefs for a patron.
    [2] Run borrowers-force-messaging-defaults.pl -no-overwrite -doit
        Verify that the patron now has default msg preferences.
    [3] Change his settings and make them non-default.
        For instance, increase days in advance.
    [4] Run borrowers-force-messaging-defaults.pl -no-overwrite -doit
        Verify that the patron still has the non-default settings.
    [5] Run borrowers-force-messaging-defaults.pl -doit
        Verify that the patron msg prefs have been overwritten.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8070357a4070cbcfb6f854fa421b48482b1c0ab4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 17:50:33 2018 -0300

    Bug 15752: DBRev 17.12.00.012
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09a72046f4c6abc4826db3df5170be72cbb66c4e
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Dec 21 19:17:20 2017 +0000

    Bug 15752: (QA follow-up) Remove unecessary redirect
    
    If the borrowernumber is defined in query, it starts to get information
    about previous borrower and the new one is taken into account fully on
    second page reload
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f0652056c55b49b712861adffee59ee6fd56119
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 15:14:22 2017 -0300

    Bug 15752: (QA follow-up) Remove unecessary redirect
    
    We are on circulation.pl, no need to redirect.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fb4aa36c6dda1e206b0c28a4da554c225357305
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Aug 18 10:58:51 2017 +0000

    Bug 15752: (QA follow-up) Inform user that patron was automatically switched
    
    Test plan:
    
    1) Start checking out to some patron - there should be no message about
    auto switching
    2) read the another patrons card - note the patron is switched and there
    is a message about it at top of the main page content
    
    Followed test plan, patch worked as described. Passed QA test tool
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88735fd8fef786ac10d167e1b027fa7ad9c75a9e
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Aug 18 12:20:40 2017 +0200

    Bug 15752: (follow-up) Search for patrons only if param barcode is defined
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dea9b80f9b2bc38af42ed532297f2554dd10a0a
Author: Chad Billman <chad@pennmanor.net>
Date:   Thu Jan 21 10:59:01 2016 -0500

    Bug 15752: Automatically switch to patron when cardnumber is read during circulation
    
    With this syspref enabled scanning a patron barcode into the item
    barcode field during circulation will redirect you to the patron's
    circulation page.
    
    This allows circulation with only a barcode scanner.
    
    Testing:
    
    - Enable the AutoSwitchPatron syspref
    - Navigate to a patron's check out screen
    - Enter a patron barcode into the "Enter item barcode" field
    
    Result
    - Browser should be redirected to the entered patron
    
    Signed-off-by: Joel <aloi54@live.fr>
    
    Followed test plan, patch works as described
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38e8b47e262cfe1c53770d91a6c700594b438e11
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Fri Feb 9 08:35:18 2018 +0200

    Bug 20166: Untranslatable course reserves delete prompt
    
    Having a Template Toolkit statements inside the javascript
    translation function _() prevents it from being picked for
    translation.
    
    The only example of such is the course reserve delete prompt.
    Move the TT statement outside the string.
    
    Test plan:
    
    1) Update and install language xx-YY. Check that the msgids
       "Are you sure you want to delete this course? There is %s attached item."
       and
       "Are you sure you want to delete this course? There are %s attached items."
       do not exist in the xx-YY-staff-prog.po
    2) Check the translated file
       intranet-tmpl/prog/fi-FI/modules/course_reserves/course-details.tt
       It should have two prompt texts above in English
    3) Install patch
    4) Update the language. Check that the msgids show up in
       xx-YY-staff-prog.po, translate them, and install the language.
    5) Repeat 2, the prompts should now show up in the correct language.
    6) Enable UsecourseReserves
    7) Go to Home -> Course reserves
    8) Create a new course, and add reserves to it
    9) See the course details. Click on Delete course, the prompt
       should be correctly translated
    10) Remove all but one of the reserves from the course
    11) Repeat 9
    
    To see if there are other such TT statements:
    
        rgrep -E '\b_\("[^"]*\[%' koha-tmpl/
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2bfe53eea6c4e549f47ad060ff6b5f3aa04ea5d
Author: Indranil Das Gupta <indradg@l2c2.co.in>
Date:   Sun Jan 21 23:59:35 2018 +0530

    Bug 20054: Remove attribute "text/css" for <style> element in OPAC
    
    Conformance rules for HTML5 is generating warnings for <style> element
    with type="text/css" attribute when the OPAC page is checked
    with W3C Validator.
    
    Test plan
    =========
    
    1/ Click the "Tag cloud" link on the OPAC. Paste the URL to your OPAC
       page (if it is hosted) to W3C Validator and watch the warning about
       type attribute "text/css".
    
    2/ Apply patch and re-submit the page to the Validator. The warning
       will be gone.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: maksim <maksim@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90fea78bc15642798d9f7e9540c6f7f09258ff47
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 15:42:03 2018 -0300

    Bug 20157: DBRev 17.12.00.011
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb6c280c53c18ee8d25b71c8011dc9188ed3ccca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 11:17:37 2018 -0300

    Bug 20157: Group search groups together
    
    We do not actually need 2 groups, the previous feature worked for both
    OPAC and STAFF interface.
    The only difference was the "show_in_pulldown" feature.
    Here we are going to REMOVE this feature for ergonomic reasons. We will
    already have 3 features and it will surcharge the interface to add
    another one. Moreover the feature will have to be applied at the OPAC
    (and so will add lot of JS checks to keep data consistent: only useful
    if ft_search_groups_opac is set).
    Moreover it is quite easy to remove entry from the dropdown list in
    JavaScript.
    
    If people was really using this feature, we will re-add it, just let us
    know.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7aa94b78216e9c71c2ecbcec3b329db8af54f46
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 10:49:56 2018 -0300

    Bug 20157: Do not display OPAC groups on the staff interface
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 702c464c7472596022af17ff388793acfad008bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 10:10:31 2018 -0300

    Bug 20157: Correctly hide the features for non first level groups
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75a40acc39997a40aa8c692a58ec819630eb8f22
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 10:00:06 2018 -0300

    Bug 20157: Save the features that have been checked
    
    Previous patch forgot to modify the controller script to save the
    changes.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1240cd140890f9698202ac7682fae6864296e105
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Feb 7 19:48:56 2018 +0000

    Bug 20157: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f353a6caacb8bc0c075106a1b1060db0495fdecf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Feb 7 19:44:28 2018 +0000

    Bug 20157: Use group 'features' to decide which groups to use for group searching functionality
    
    Instead of basing the group searches on the group name, which is an
    inherently touchy system, we should use the same checkbox style that
    Jonathan introduced for the patron limits by group feature.
    
    Test Plan:
    1) Check to ensure existing group searches still show as they used to
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f961c963d2a3131b3377bb444d4060ca3b74e8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 15:40:42 2018 -0300

    Bug 20133: DBRev 17.12.00.010
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84e17bd716bd2f561a58a7688700dddf2faa4b98
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Wed Feb 7 12:41:10 2018 -0500

    Bug 20133: (QA follow-up) Tweak new 'group features' section
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d52044f65a611d49cd8f78f7aeaef24a018e357
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 2 14:23:42 2018 -0300

    Bug 20133: Enable/disable the "Hide patron information" feature per group of libraries
    
    In order to control this feature correctly it needs to be enabled for
    group of libraries and not for all groups defined in the system.
    Groups will be used for different usages and so the feature must not be
    enabled by default for all of them.
    
    Test plan:
    Retest bug 18403 with the feature turned on/off for a given tree
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0919c3a29b70a83063a245da6e967ccf5328e4d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 2 14:21:49 2018 -0300

    Bug 20133: UI Changes
    
    Add a checkbox to enable/disable the feature for given group of
    libraries.
    
    Important note: Only the top level node can turn the feature, the idea
    is to avoid confusion, ease testing (by limiting the number of cases)
    and force libraries to define one tree per feature (Maybe this is wrong,
    but maybe good to start)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca0ca1b99e01baa913e2b5c56a87b529d8819bab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 2 14:21:26 2018 -0300

    Bug 20133: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25655c3bc56338ac5327745a9d3f2e378d37e8da
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 2 14:21:14 2018 -0300

    Bug 20133: Add new column library_groups.ft_hide_patron_info
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 340c18d8bc2c2b0691c0c45de201d4b663d90a47
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 15:38:54 2018 -0300

    Bug 18403: DBRev 17.12.00.009
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 607c66e436a0e4eddfb59f1c0ce6a69311c8e9ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 12 14:14:32 2018 -0300

    Bug 18403: Fix few errors found with hit_pages.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d433a4dc3d18c68ed579c5c720465060602283b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 16:57:01 2018 -0300

    Bug 18403: Add POD for output_and_exit_if_error
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b3b382f5814c2d30234e80d00f238547871d3e5
Author: Kyle M Hall <kyle@bywatetsolutions.com>
Date:   Fri Feb 9 08:51:02 2018 -0500

    Bug 18403: Fix error triggered by subgroups being added to group
    
    With one root group and two child groups and it works fine.
    But if I create any groups under *those* groups, not only does it not work,
    I get the following error:
    Template process failed: undef error - SQL::Abstract::puke(): [SQL::Abstract::__ANON__]
    Fatal: SQL::Abstract before v1.75 used to generate incorrect SQL when the -IN operator was
    given an undef-containing list: !!!AUDIT YOUR CODE AND DATA!!! (the
    upcoming Data::Query-based version of SQL::Abstract will
    emit the logically correct SQL instead of raising this
    exception) at /home/vagrant/kohaclone/Koha/Objects.pm line 269
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a037b80ee325e3828141ebc15533e8f3d159de5a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 12 09:56:22 2017 -0300

    Bug 18403: Deal with the DB user
    
    On first login, Koha explodes before the logged in user does not exist
    in DB.
    This patch deals with that by adding several checks when it's needed.
    
    Test plan:
    Use the DB user to create a superlibrarian user.
    The DB user should no be allowed to do anything else.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Bug 18403: Fix patron creation
    
    memberentry.pl can be called to create a new patron, in that case the
    patron does not exist yet.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c8365e4a748a6e3eadddccc44a196087d4da279
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 10 17:34:34 2017 -0300

    Bug 18403: REST API - patrons endpoint
    
    There is something wrond here, the userenv is no set and so we cannot
    user search_limited.
    Should we set the userenv or filter on the libraries using
    libraries_where_can_see_patrons?
    WAITING FOR FEEDBACK HERE.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fda87270ad49d403e70f3db4291c2ca65649cfeb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 10 10:23:37 2017 -0300

    Bug 18403: Guarantors
    
    Technically a kid from your library group could have a guarantor
    attached to another
    group of library, let's deal with this case.
    
    Test plan:
    - Create a kid from your library group
    - With a superlibrarian staff user create a guarantor that is outside of
    the group of
    libraries of the kid
    - Login with a limited staff user and confirm that on the patron detail
    page you do not
    see the link to the guarantor detail page.
    
    Note that you see the firstname and surname of the guarantor
    Q. should it be hidden?
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 710175fbe6721583028083d498f1df4a44bb1784
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 7 17:53:35 2017 -0300

    Bug 18403: Article requests
    
    Same as previously but for article requests.
    
    Test plan:
    Test article requests and make sure you do not need the requests for
    patrons that
    are attached to a group that is not part of your library's group
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc1e7f478f150a33d53a07114d65aead54569f48
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 7 15:42:51 2017 -0300

    Bug 18403: Patron discharges
    
    This patch deals with patron's discharges.
    
    Test plan:
    Same as previously you will need to request dischages at the OPAC.
    On the staff interface the logged in user should not be allowed to see
    discharge
    from patrons outside his library group.
    The number of discharges waiting displayed on the mainpage should be
    correct as well.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Bug 18403: (follow-up) Patron discharges
    
    Fix QA issue:
    forbidden pattern: Do not assume male gender, use they/them instead (bug 18432) (line 150)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e484b543f796df481edfb5e00920fb30c162fe80
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 7 14:37:47 2017 -0300

    Bug 18403: Patron reviews
    
    This patch adds a new method Koha::Reviews->search_limited to return the
    reviews
    a logged in user is allowed to see depending his permissions.
    
    Test plan:
    Create some reviews at the OPAC and make sure a staff user is limited
    (or not) to approve
    or decline it.
    The number of reviews displayed on the mainpage should be correct as
    well.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb2550de6e2c47ad83b63a196f50cbe1e0e16b43
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 7 14:02:09 2017 -0300

    Bug 18403: Patron modification requests
    
    Limit patron's modifications based on logged in patron permissions.
    
    Test plan:
    Create some patron's modification requests at the OPAC
    Make sure the logged in staff user see (or not) the modification depending his
    permissions.
    The number of modification displayed on the mainpage should be correct as well.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38ae35332a60da74a69afb8765f8f2f3e870c11d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 7 14:00:34 2017 -0300

    Bug 18403: Add new method Koha::Patron->can_see_patrons_from
    
    Technical note:
    Sometimes we do not have the patron object, for instance for the patron modifications
    we will need to know if the logged in user can modify patron's from a given library.
    This new subroutine 'can_see_patrons_from' will then be useful
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55544f0187545747b1fbc2ce74ed44517ba7ca2f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 07:34:47 2017 -0300

    Bug 18403: Add tests for Koha::Patrons
    
    A bit late but here are the tests for
     Koha::Patron->libraries_where_can_see_patrons
     Koha::Patron->can_see_patron_infos
     Koha::Patron->search_limited
    
    Test plan:
      prove t/db_dependent/Koha/Patrons.t
    should return green
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40ae454b9b0678d9e9f0418216bd546bc222e4f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 6 12:59:46 2017 -0300

    Bug 18403: Refactor and add Koha::Patron->libraries_where_can_see_patrons
    
    Technical note:
    Here we are just refactoring a code that have been copied into 3 different places.
    libraries_where_can_see_patrons is a terrible method's name, feel free to suggest
    something better. The method return a list of branchcodes to be more efficient,
    instead of Koha::Libraries
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7809a6bd132e6bd2c98d69179fc2c2f0788decb0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 6 12:42:03 2017 -0300

    Bug 18403: Add new methods Koha::Patrons->search_limited and use it where needed
    
    Most of the time when we search for patrons we do not want to search for all patrons,
    but just the ones the logged in user is allowed to see the information.
    This patch takes care of that by adding a new search_limited method to Koha::Patrons.
    When called this method only search for patrons that the logged in user is allowed
    to see.
    
    Test plan:
    Patron autocomplete search should be limited
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 032992042dc0dcc910465e1ded4b7bbb6d23e9f6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 18:55:13 2017 -0300

    Bug 18403: output_and_exit_if_error for circulation.pl
    
    This is a follow-up for a previous patch, changes have been tested
    already
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6299bbca5dc1654652814f9792f276670e1ac7f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 18:47:30 2017 -0300

    Bug 18403: Batch patron modification tool
    
    Do not allow a logged in staff user to modify patrons that are not part of his
    group if he is not allowed.
    
    Test plan:
    Make sure you are not allowed to modify patrons that are not part of your group
    from the batch patron modification tool
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea15f3112b4de5d0fb76343d4545ccfd940d40fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 17:25:13 2017 -0300

    Bug 18403: Use patron-title.inc when hidepatronname is used [SPECIFIC for view_holdsqueue]
    
    Same that the previous patch but for the holds queue
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa54100dffe092e606f79b15692eedaf78f42e45
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 17:04:36 2017 -0300

    Bug 18403: Use patron-title.inc when hidepatronname is used [SPECIFIC for issuehistory]
    
    On this page we do not have the patron object sent to the template,
    let's pass it!
    
    Test plan:
    Go on the checkout history of a bibliographic record
    (catalogue/issuehistory.pl)
    You should not see patron's information that are not part of your group
    if you
    are not allowed to see them.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f80977875ff124d411f2cd89de4a944fa9c27af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 16:43:41 2017 -0300

    Bug 18403: Use patron-title.inc when hidepatronname is used
    
    There is already a HidePatronName syspref to hide patron's information
    on bibliographic
    record detail pages and the hold list.
    
    Test plan:
    With the HidePatronName enabled, make sure the patron's information are
    hidden from
    the catalogue and hold list pages. If the logged in user is not allowed
    to see the
    patron's info, no link and no cardnumber will be displayed
    With he HidePatronName disabled, make sure the patron's information are
    displayed
    if the logged in user is allowed to see the patron's info.
    
    Technical note:
    This patch improves the existing patron-title.inc include file to
    display patron's
    information. Using it everywhere patron's details are displayed will
    permit to
    homogenise the way they are displayed. The file takes now a patron
    object (what
    should be, in the future, the only way to use it), that way we can call
    the new
    method on it to know if patron's information can be shown by the logged
    in used.
    
    NOTE: I am not sure this syspref makes sense anymore. Should not we
    remove it?
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e09ed656af5f75a82ccfa29318081e217618c32d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 14:11:02 2017 -0300

    Bug 18403: Only display libraries from group in dropdown lists
    
    From where patrons it's about patrons, we do not want to display the libraries
    from all the system, but only the ones from the group.
    
    Test plan:
    - See the overdues (circ/overdue.pl) and make sure you can only see overdues from
    patrons part of your group (do not forget to test the CSV export).
    - Search for patrons, the 'library' filters (headers and left side) should only
    display libraries from your group
    - Search for article request by patron's library: only the libraries from your
    group should be displayed
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ef64cda22dc7a17c72215bbb0d74c240b314646
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 13:19:42 2017 -0300

    Bug 18403: Adapt patron search
    
    This patch modifies the patron search code to limit the libraries to the
    ones
    the logged in user is allowed to access
    
    Test plan:
    Search for patrons
    You should not see patrons you are not allowed to see.
    
    Technical note:
    I am really glad to have refactored all the patron searches before
    having to
    write this patch. It tooks me ~40 l to acchieve this job and affect all
    patron searches.
    Thanks refactoring!
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cee2cf9ff927504f9c24f6519462a7d702c5c27d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 4 18:48:45 2017 -0300

    Bug 18403: Add sub output_and_exit_if_error - unknown_patron & cannot_see_patron_infos
    
    Test plan:
    Login with a patron that is not allowed to see patron's information for patrons
    outside of his group. Try to access patron's information from scripts of the patron
    module (members/*) and circ/circulation.pl.
    You should be able to access patron's information of patrons outside of your group
    and get "You are not allowed to see the information of this patron."
    If you try and access a patron page with a borrowernumber that does not exist, you
    should get "This patron does not exist"
    
    Technical note:
    A new C4::Output subroutine is created in this patch: "output_and_exit_if_error"
    Executed at the beginning of the script it will permit not to copy/paste all the
    different checks to know if the logged in user is authorised to see patron's information.
    The design here can be discussed, but I did not find an alternative with as less changes.
    On the way I refactor what we did with 'unknowuser' previously: it will now work with all
    patron pages, not only the few that used it.
    Note that the 'or die "Not logged in";' part should not be needed, but... who trusts
    C4::Auth?
    I think it could be used as a safeguard later. I am willing to sed and remove them
    if required.
    
    Changes in discharge.pl are mainly indentation changes.
    
    With this patch we should now have a $patron variable that refer to the patron we
    want to access. That will be very useful to remove plenty of code in members/* and
    only pass this variable to the template (instead of 1 variable per patron's attribute).
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bc92169dcc04cd0bd586abf01828331711980cc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 4 17:45:30 2017 -0300

    Bug 18403: Update permissions - borrowers => 1|* becomes borrowers => 'edit_borrowers'
    
    Test plan:
    Login with a patron that only have the 'edit_borrowers' permission.
    You should be able to access patron's information of patrons inside of your group.
    
    Technical note:
    Before this patchset the borrowers permission module contains only 1 permission 'edit_borrowers'.
    That meant
      borrowers => 1
    and
      borrowers => '*'
    had the same behavior.
    Moreover, now that we have 2 permissions, 'CAN_user_borrowers' is set when all
    permissions of 'borrowers' are set.
    We need to update the different occurrences of these tests.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4134df83734d2fabd4806339854cfab41faab82d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 6 16:10:18 2017 -0300

    Bug 18403: Add new method Koha::Patron->can_see_patron_info
    
    Technical note:
    This is the method that will be called on the logged_in_user variable sent to
    the template. Moreover we will check that the logged in user can access patron'
    information when access to members/* and some circulation scripts will be done.
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2f2590c894efca417112795e05248dbd16636f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 4 16:43:58 2017 -0300

    Bug 18403: Send logged_in_user to template from C4::Auth
    
    Technical note:
    To ease future changes we are passing a logged_in_user variable to templates.
    It contains the Koha::Patron object representing the logged in patron.
    This will be very useful for this patch and even after (for instance we will be
    able to replace easily loggedinusername and loggedinusernumber).
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb68ca2af2c9ebf32091f98380dbbd07cd7ff2e6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 6 16:10:02 2017 -0300

    Bug 18403: Add new method Koha::Library::Group->has_child
    
    This is more a follow-up for bug 15707. It could be moved on its own bug report
    if necessary.
    
    IMPORTANT NOTE: At the moment the feature only works for 1 level depth, see
    bug 15707 comment 166+ for the discussion
    
    It means that if we have:
     root_group
         + groupA
             + groupA1
                 + groupA1_library2
             + groupA_library1
             + groupA2
         + groupB
             + groupB_library1
    groupA1_library2 is not considered a child of groupA1.
    Note that this can change.
    
    Test plan:
      prove t/db_dependent/LibraryGroups.t
    should return green
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e14fd52761f709f0644fe3a59700895cb1e7f87
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 6 16:09:46 2017 -0300

    Bug 18403: Add new method Koha::Library->library_group
    
    This is more a follow-up for bug 15707. It could be moved on its own bug report
    if necessary.
    
    Test plan:
      prove t/db_dependent/LibraryGroups.t
    should return green
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95d0a17e8b873c493f099fc69772e4c50908a21c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 4 16:01:41 2017 -0300

    Bug 18403: Hide patron information if not part of the logged in user library group
    
    This patchset adds a new feature that will allow libraries inside a
    single Koha installation to restrict access to information of patrons
    that
    
    The group of libraries feature is introduced by bug 15707, see this bug for more
    information.
    
    Let's imagine that 2 groups G1 and G2 are defined and that they include 2 libraries
    each G1a, G1b and G2c, G2d: logged in users attached to G1a will only see patron's
    information from G1a and G1b.
    To add more flexibility, a new user permission named 'view_borrower_infos_from_any_libraries'
    will drive this behavior. If set, the patron will be able to see patron's information
    of any libraries.
    
    If the restriction is set, the logged in user will not be able to search, show, edit,
    delete patron's information of patrons attached to groups of libraries outside his
    own group.
    In situations we need to refer to a patron, for holds and checkouts for instance,
    and his information cannot be viewed, a text "A patron from library G1A" will be
    displayed.
    
    Considered unecessary or outside the scope of this bug report:
    * The report module is not affected by this feature for obvious reasons
    * The firstname and surname of guarantors, basket (acq) managers, patrons linked
    to orders are still displayed.
    * Log viewer: Can only be staff
    * patron list: you cannot add patrons from another group of librairies, but can
    see/delete from list (too much rewrite, or we can test for patron one by one?).
    * "Patron card creator" tool is not impacted by this feature.
    * Upload patron images is not impacted by this patch, should it be?
    * Tools:
      - Upload patrons
      - Clean borrowers tool (This can can done easily updating Koha::Patrons->search
    with Koha::Patrons->search_limited in search_upcoming_membership_expires and
    search_patrons_to_anonymise but we will need to move GetBorrowersToExpunge to
    Koha::Patrons first)
    We can discuss these different points but will be other bug reports not to add
    more complexity to this first patchset.
    
    Test plan:
    You will find a test plan in the following commit messages.
    Start by creating different group of libraries and patrons with and without the
    new permission. Open different browser sessions to ease the tests.
    Note that all patches have to be applied to test the different test plans.
    
    Technical notes:
    For QAers (and others) a techical note will be added to the commit messages of this
    patchset. I would recommend you to read them one by one to understand the different
    steps of this development.
    
    + Special attention should be payed to the REST api changes
    + Should we restrict the logged in user to libraries from his group when
    he wants to set his library (Home › Circulation › Set library)?
    
    Signed-off-by: Signed-off-by: Jon McGowan <jon.mcgowan@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cd2ad6e052d12e6ccf4d0b098ff2dd7a1fa526a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 15:44:25 2018 -0300

    Bug 16735: DBRev 17.12.00.008
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a364bb15a7c7c49017d0a928bbe9e02038231419
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 5 14:09:23 2017 -0300

    Bug 16735: DBIC Schema files
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a0421dbf78e896d831c8ac5c1caf44b802208c2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 17:00:44 2018 -0300

    Bug 16735: Fix POD format for Koha::Library::Groups methods
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb02cd1a7375fe391c37408981662d70c6aa0499
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 11:35:03 2018 -0300

    Bug 16735: Remove unecessary use of Koha::LibraryCategories in onboarding
    
    This was not used, it has been copied/pasted from admin/branches.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc475cceabba7fceb3e53a8021cd9799b46b7d4b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 11 13:29:33 2017 -0300

    Bug 16735: (QA follow-up) Fix rebase error
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae870e767a3edbb786e4815220c57ca624e3d5e3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 11 12:46:05 2017 -0300

    Bug 16735: (QA follow-up) POD fixes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad6a7aaf85d1c10fe74c9c1c503384b04372a29c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Aug 8 12:40:45 2017 -0400

    Bug 16735: Use libraries in all subgroups, not just immediate children
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b106a7e7b8cb45a9f3794e325d12ad5799bb0a9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 21 13:36:22 2017 +0000

    Bug 16735: Filter individual libraries from search group pulldown
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e667fc1cfc601704a72432c7efafdd1c40a6126f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 21 12:26:25 2017 +0000

    Bug 16735: Remove use of get_categories
    
    Feature using it is completely undocumented as far as my research has
    shown.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28dccc7a112065fa39d03ca44f864be9e3174c78
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 21 12:07:18 2017 +0000

    Bug 16735: Don't use objects for database update
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2059f7d8016ab61172830e9b670279d3e28882b7
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jun 22 17:10:23 2016 +0000

    Bug 16735: Migrate library search groups into the new hierarchical groups
    
    Test Plan:
    1) Apply this patch set
    2) Note your existing search groups have been ported over to the new
       __SEARCH_GROUPS__ group if you had any
    3) Create the group __SEARCH_GROUPS__ if one does not already exist
    4) Add some first level subgroups to this group, add libraries to those groups
    5) Search the library group searching in the intranet and opac
    6) Note you get the same results as pre-patch
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3d4820209ca8a35cf5fcce9595a8d7700ca9da9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 23 13:24:54 2016 +0000

    Bug 16735: Clean up sample data
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd81430d4209822e69d970db3aef520a6010c94f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 23 11:44:15 2016 +0000

    Bug 16735: Remove tables no longer needed
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1cd3d1e0520e87d373fe154946e95d64705812c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jun 22 18:28:03 2016 +0000

    Bug 16735: Remove modules no longer needed
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba4a808015ac1e172983487e590b097469970355
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 15:13:35 2018 -0300

    Bug 15707: DBRev 17.12.00.007
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc25710581e4e69abff401757ae6351601c19893
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 6 16:12:47 2017 -0300

    Bug 15707: (QA follow-up) Style buttons correctly
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99543e96ab7fca91e9126db1ba9a4d838dc8e01e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 5 14:05:28 2017 -0300

    Bug 15707: DBIC Schema files
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f32cdb7211705a0950e98897820f3a4a7bc52cd8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 1 13:58:54 2017 +0000

    Bug 15707: Display error if group title is already used
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Edit: I added !$branchcode && to the checked condition so we can add multiple
    libraries back.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c4d57a7906aba9f87c04924eadb231c6f727495
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Feb 22 19:54:58 2017 +0000

    Bug 15707: Updates for Bootstrap 3
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fdb554ad8c349f78399fb14e9a2a2e502ed2ebc
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 21 12:21:12 2017 +0000

    Bug 15707: Add UNIQUE constraint to library groups table
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbc466f93b3cd6900b8313db3314d2f1b946abdf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 21 12:16:03 2017 +0000

    Bug 15707: Switch datetimes to timestamps
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a2e3d1b1499c84fdc900e3fa2cc15e7f63494a2
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Dec 7 01:01:52 2016 +0000

    Bug 15707: (follow-up) use cat-search instead of cities-search in header
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1effa1b90fdf84b23934bb3b6d8f1d18fbd79641
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jun 20 11:45:10 2016 +0000

    Bug 15707: (QA follow-up) Allow object names to be styled without impeding translation
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a02e867449b3f74f9b4dda44c2dfde3972de1be
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jun 14 13:20:32 2016 +0000

    Bug 15707: (QA follow-up) Remove class for treegrid
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65d4289f129274a4ed504e7fb517623aeee1bb3b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jun 14 11:55:25 2016 +0000

    Bug 15707: (QA follow-up) Fix UI issues
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf232417fc16a366cb1389d9d64b4f978144101d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Jun 12 10:15:38 2016 +0100

    Bug 15707: (QA follow-up) Drop table if exists
    
    1/ DROP table if exists
    2/ FAIL   spelling
        decendents  ==> descendants
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb52f91d3c39944d7aa68b9ee1653e73c4397512
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 19 13:33:39 2016 +0000

    Bug 15707: (QA follow-up) Switch to treetable which Koha already uses
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2cb369e5d23abfcd797832fb173b33afb9a6dbb2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 15 17:24:35 2016 +0000

    Bug 15707: Fix conflict with bug 15446 (type vs _type)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f2893c35bcf2aeb65680db3dc3d4dbdd51ab8e5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Feb 5 06:53:20 2016 +0000

    Bug 15707: Unit Tests
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee259d614000e0121f1567fd40b0721b23d100d5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Sun Jan 31 11:22:51 2016 +0000

    Bug 15707: Add library groups editor
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfb5ebc98856c111a6dcf32f1cd4cc0bb5d6c86b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Sun Jan 31 11:22:19 2016 +0000

    Bug 15707: Add Koha::Library::Group(s) modules
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d178613ad16d030ca9252d971f7efc615c8925f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Sun Jan 31 11:21:00 2016 +0000

    Bug 15707: Update DB
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35b60cbd139146ecbce7a0b3ba7a51e912630c48
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 9 14:49:21 2018 -0300

    Bug 19928: Mock delimiter pref in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0927962b45016fb30e378ddf4860ed7f4a0b7f59
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Wed Dec 13 15:14:58 2017 +1300

    Bug 19801: Display messages on user details page as well as on check out page
    
    To test:
    
    Look up a borrower, add a message (internal or opac)
    Click the Details tab for that borrower
    Messages should be displayed above the user information [is this the right place? it could go below]
    adding messages on this page should make them immediately available
    deleting messages on this page should delete them immediately and bring you back to the detail page.
    
    Basically, make sure messages work from both the Check out and detail pages and that there are no typos.
    
    Messages should work the same as they always have from the Check Out page.
    
    sponsored-by: Catalyst IT
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Marjorie Vila <marjorie.barry-vila@collecto.ca>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Bug 19801 - Fixes for QA
    
    - Fixes indentation
    - changes messages to patron_messages (even though it's not like that on the circulation page.)
    
    Signed-off-by: Marjorie Vila <marjorie.barry-vila@collecto.ca>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>

commit 571c088ceec98f34320f27e505245a0cdfa52a82
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 4 14:16:42 2018 +0000

    Bug 10032: (follow-up) Move title attribute to button container
    
    This patch modifies the "Close basket" button markup so that the title
    attribute on a disabled button is added to the button wrapper <div>
    instead of the <a> tag. This allows the title attribute tooltip to
    appear when the cursor is hovered over the button.
    
    To test, follow the original patch's test plan and confirm that when the
    "Close basket" button is disabled, hovering the mouse over the button
    triggers the title attribute tooltip.
    
    Signed-off-by: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>

commit f3453684dfe388314cda39d4ace23041d1b6af98
Author: Jon Knight <J.P.Knight@lboro.ac.uk>
Date:   Tue Dec 12 17:50:36 2017 +0000

    Bug 10032: Improve GUI when uncertain price prevents closing the basket
    
    Added disabled "Close this basket" button when uncertain
    prices are present.
    Note that whilst this has a "title" attribute, there is no tooltip
    shown because JQueryUI disabled buttons don't get DOM events.
    
    https://bugs.koha-community.org/show_bug.cgi?id=10032
    
    Signed-off-by: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>

commit 91198900191ee53051f64a0f7bb1d14b712d3ce0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 7 17:42:09 2018 +0000

    Bug 20156: Display a markup for the current language in header menu
    
    This patch replaces Glyphicon markup with Font Awesome markup so that a
    check mark appears next to the currently-selected language in the staff
    client header's language menu.
    
    Also changed in this patch: Some classes have been removed because they
    are not used in staff client CSS.
    
    To test you must have multiple languages installed and enabled in the
    staff client.
    
     - Set the StaffLangSelectorMode system preference to "top" or "both top
       and footer"
     - Confirm that the currently-select language in the langauge menu has a
       check mark next to it.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>

commit d77d371c4fe679c416554806da0d1c94ec06bc02
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Feb 5 10:28:37 2018 -0300

    Bug 20134: Remove /api/v1/app.pl from the generated URLs
    
    This patch removes the /api/v1/app.pl prefix from generated baseUrl.
    It has the consequence of hardcoding / as the base path for the API.
    
    This is ok because we don't currently support mounting Koha pieces in
    different than hardcoded paths (/cgi-bin/koha?), but certainly worth
    mentioning because this will need to depend on a syspref or config entry
    when someone chages this behviour.
    
    To test:
    - On master, point your browser to:
      http://kohadev.mydnsname.org:8080/api/v1/
    => FAIL: basePath looks like /api/v1/app.pl/api/v1
    - Apply this patch
    - Restart memcached and plack:
      $ restart_all
    or
      $ sudo systemctl restart memcached && sudo systemctl restart
      koha-common
    - Reload http://kohadev.mydnsname.org:8080/api/v1/
    => SUCCESS: basePath is /api/v1
    - Sign off :-D
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>

commit bb98e99dc6349ba316889e2123f6218d42863fc7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 6 10:41:03 2018 -0300

    Bug 12904: Fix occurrences not caught by script
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>

commit 0ad922011cc330397d9b680b0d045bfd48e85f44
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 23 10:22:47 2018 -0300

    Bug 12904: Force browser to load new javascript files after upgrade
    
    This patch has been automatically generated using:
      perl kv.pl **/*.tt **/*.inc
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>

commit 0f43bdd6416cf997bf656f5f3766f6f6020b52a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 23 10:24:52 2018 -0300

    Bug 12904: Pass KOHA_VERSION in C4::Auth
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>

commit f89a2bbdbeefe2befe77c2985a11109d3e23ac88
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Wed May 24 09:34:17 2017 -0400

    Bug 12904: Add mod_expire to etc/koha-httpd.conf
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>

commit 43c67312a02c60f77f8a164b3766dbcbd8196554
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 22 15:42:30 2016 +0000

    Bug 12904: Apache configuration
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>

commit 3e23c85bceb61f81c1487c1812844631fa0f9a5a
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Wed Jan 10 16:07:36 2018 +0100

    Bug 19928: Acquisitions' CSV exports now honors syspref "delimiter"
    
    Bonus fixes:
    - Basketgroup: there was an unnecessary space.
      " RRP tax excluded" replaced by "RRP tax excluded"
    - Late orders:
      - leading spaces before every line
      - surrounding spaces for [% orders.size %]
    
    Other changes:
    - quoted "Total orders in late" to no worry about additional spaces
    - Late orders: additional spaces which shouldn't be a problem because
      all the fields are enclosed by quotes.
    
    Test plan:
    1. Set syspref "delimiter" to "#'s"
    2. Change the language e.g. FR-fr
    
    3. Create a vendor with minimal info
    4. Create a basket with two items
    5. Go to the basket. URL should be
       /cgi-bin/koha/acqui/basket.pl?basketno=XXXXX
    6. Close this basket
    7. "Export as CSV"
    8. You should see that the file contains commas "," This is the bug.
       Leave the file open for future comparison to ensure that there are
       no regressions.
    
    9. Create a basket group with two baskets
       (tick the close this basket group check box)
    10. Go to the "Closed" tab to see your basket group
    11. "Export as CSV"
    12. You should see that the file contains commas "," This is the bug.
        Leave the file open for future comparison to ensure that there are
        no regressions.
    
    13. Go to /cgi-bin/koha/acqui/lateorders.pl
    14. Tick two orders. Of the same vendor, otherwise Koha won't let you tick
        orders of different vendors.
    15. "Export as CSV"
    16. You should see that the file contains commas "," This is the bug.
        Leave the file open for future comparison to ensure that there are
        no regressions.
    
    17. Apply this patch
    18. Translation stuff
        1. cd misc/translator
        2. perl translate update YOUR_LANG
        3. manually edit the po file, remove the fuzzy tags.
           And translate the string. You can just copy the original and
           replace some parts by gibberish.
        4. perl translate install YOUR_LANG
    
    19. Re-export the same CSVs and compare with the original version to check that
        - delimiter syspref is honored
        - the headers are translatable
        - there is no whitespace regression (additional newlines or spaces)
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>

commit bc2a79f86b7fd9268ec4b2cd85f5a9c871bff12a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 7 11:27:50 2018 -0300

    Bug 7143: Fix typo developper vs developer

commit e6f8059a04144bf9247a6f43e19f83ba2c4f7f9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 10:02:00 2018 -0300

     Bug 7143: Update about page for new dev - Jenny Way
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a49cc5a5850a2ba70e274c389ceee63d8396fbdb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 09:56:42 2018 -0300

    Bug 11827: (follow-up) Use double quote instead of simple-quote

commit 1e2f88990da0747ea7164b98060fb82bac24670f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 09:55:50 2018 -0300

    Bug 20109: (follow-up) Use double quote instead of simple-quote

commit 2ff5482c973eb2f1835a3e372bcee6f16c4a9445
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Fri Feb 2 09:45:42 2018 +0200

    Bug 20124: Make "Save configuration" translatable on "did you mean?" config
    
    When saving the "Did you mean?" setting, a popup with the
    message "Successfully saved configuration" is shown, but
    it cannot be translated. Make it translatable.
    
    Test plan:
    
    1) Go to Home -> Administration -> Did you mean?
    2) Change the settings, click on "Save configuration"
    3) Popup with "Successfully saved configuration"
    4) Apply patch, update po-files, etc.
    5) Check that the msgid "Successfully saved configuration"
       is in fi-FI-staff-prog.po, and translate the message
    6) install the fi-FI language
    7) Change your UI language to finnish
    8) Repeat 1, 2, 3. You should now see the same popup
       message translated.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c2cd21cc35fdb5a048c042add0087ebedbca44e
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Wed Jan 31 11:11:56 2018 +0200

    Bug 20110: Adding same user multiple times to same budget
    
    In javascript, using indexOf to test if a number exists in an array
    of strings doesn't work, and makes it possible to add the same user
    multiple times into the same budget fund.
    Make borrowernumber into string and compare that instead.
    
    Test plan:
    
    1) Go to Home -> Administration -> Budgets -> Funds -> Add Fund
    2) Add a user to the fund
    3) Try to add the same user again to the same fund. No error.
    4) Apply patch
    5) Do 1, 2, and 3 again. You should now get an error message
       saying the user is already in the list.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 127da0e35c5117e4c6ad7a208087cf191745b49b
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Wed Jan 31 08:51:30 2018 +0200

    Bug 20109: Make "Remove" translatable when adding a fund
    
    When a user has been added to the fund, the link to "Remove" that user
    is not translatable.
    
    Test plan:
    
    1) Install language xx-YY
    2) Go to Home -> Administration -> Budgets -> Funds -> Add Fund
    3) Add a user to the fund
    4) Notice how the "Remove" link after the user's name is not translated
    5) Apply patch
    6) Look in xx-YY-staff-prog.po, and if needed, translate the msgid
       "Remove"
    7) Update and reinstall the language
    8) Do 2 and 3 again. The "Remove" link should now be translated.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    https://bugs.koha-community.org/show_bug.cgi?id=10209
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 458c8c1ae1d27cd4099328b4035fb236458fcd67
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Mon Jan 29 16:09:24 2018 +0100

    Bug 20098: Inventory tool: CVS export: fix itemlost column
    
    It was mapped with "lost" instead of "itemlost".
    
    == Test plan ==
    1. Have a lost item
    2. Go to staff:/cgi-bin/koha/tools/inventory.pl
    3. Tick "Optional filters" → "items.itemlost" →
          "name of Authorized values for the lost state"
    4. Tick "Export to CSV file"
    5. Submit
    6. Open the CSV
    7. Check that the lost item is in the list
    8. You should observe that the "Lost status" column is empty for all items
         This is the problem
    9. Apply this patch
    10. Click submit to re-export the CSV
    11. Open the CSV
    12. Check that the lost item is in the list
    13. You should observe that the "Lost status" column now filled with the
          expected values.
    14. Smile because it works! :D
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Maksim Sen <maksim@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60efdccafd40de43a4917a80fc96d3f6e63626a7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 22 15:48:42 2018 +0000

    Bug 20062: Remove support for Internet Explorer 7 in the staff client
    
    This patch removes JavaScript files which were added to support Internet
    Explorer 7. Templates which included the files have been modified
    accordingly.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    Perform a catalog search in the staff client and click through to view
    one of the search results. The search results navigation menu in the
    left-hand sidebar should work correctly.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3d0bc24c97ed35653130cdc55f0da3271d958e9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 22 13:04:33 2018 +0100

    Bug 20060: Resolve uninitialized warn from Koha::Template::Plugin::Branches
    
    The warn comes from undefined C4::Context->userenv->{branch}.
    Can be triggered by calling mainpage.pl when being logged out in staff.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1b4b53765da4088483a7255b657b1a4c98db694
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Thu Jan 18 03:32:12 2018 +0000

    Bug 20020: use Modern::Perl in XT scripts
    
    Test Case:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    author/podcorrectness.t
    author/show-template-structure.pl
    author/translatable-templates.t
    author/valid-templates.t
    find-license-problems
    fix-old-fsf-address
    single_quotes.t
    verify-debian-docbook.t
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d10513dfc0d47846fdb874b0a62ce9c8c7107644
Author: Te Rauhina Jackson <terauhina.jackson@gmail.com>
Date:   Thu Jan 18 20:41:33 2018 +0000

    Bug 20019: use Modern::Perl in misc perl scripts
    
    Test Plan:
    Test Plan:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    services/itemrecorddisplay.pl
    suggestion/suggestion.pl
    tags/list.pl
    tags/review.pl
    virtualshelves/sendshelf.pl
    help.pl
    changelanguage.pl
    koha_perl_deps.pl
    debian/bd-to-depends
    debian/build-git-snapshot
    debian/list-deps
    docs/CAS/CASProxy/examples/koha_webservice.pl
    docs/CAS/CASProxy/examples/proxy_cas.pl
    docs/CAS/CASProxy/examples/proxy_cas_callback.pl
    docs/CAS/CASProxy/examples/proxy_cas_data.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 484fd322abd36bba61a8c2fa40e3902e909438c3
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Thu Jan 18 03:32:43 2018 +0000

    Bug 20018: use Modern::Perl in offline_circ scripts
    
    Test Plan:
    - Check that it now says 'use Modern::Perl' and not 'use trict; use
    warnings;' in the follwing plugins perl scripts
    
    enqueue_koc.pl
    list.pl
    process.pl
    process_koc.pl
    service.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cad2db6016fb154049a030f0d8a74a6b539cb7a4
Author: Jenny Way <jwayway@hotmail.com>
Date:   Thu Jan 18 02:04:47 2018 +0000

    Bug 20017: use Modern::Perl in Tools perl scripts
    
    Test plan:
    Check that the following files don't contain use strict; use warnings;
    and have use Modern::Perl instead.
    background-job-progress.pl
    batchMod.pl
    copy-holidays.pl
    exceptionHolidays.pl
    holidays.pl
    import_borrowers.pl
    koha-news.pl
    letter.pl
    manage-marc-import.pl
    newHolidays.pl
    overduerules.pl
    quotes-upload.pl
    quotes.pl
    quotes/quotes-upload_ajax.pl
    quotes/quotes_ajax.pl
    scheduler.pl
    stage-marc-import.pl
    upload-cover-image.pl
    
    Also the credits have been added to newHolidays.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2bde680e0b7cb0a91731bd9a9475e3460e4b6fec
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Thu Jan 18 03:24:23 2018 +0000

    Bug 20016: use Modern::Perl in svc scripts
    
    Test Plan:
    - Check that it now says 'use Modern::Perl' and not 'use trict; use
    warnings;' in the follwing plugins svc scripts
    
    authentication
    bib
    bib_profile
    checkouts
    config/systempreferences
    import_bib
    new_bib
    
    https://bugs.koha-community.org/show_bug.cgi?id=20016
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb5aa286126d204c3bfb52a2d774eeaf7bfe9b68
Author: Jenny Way <jwayway@hotmail.com>
Date:   Thu Jan 18 00:56:42 2018 +0000

    Bug 20015: use Modern::Perl in Serials perl script
    
    Test plan:
    Check that use strict; use warnings; doesn't exist in the following
    files and use Modern::Perl; is written instead.
    acqui-search-result.pl
    acqui-search.pl
    checkexpiration.pl
    reorder_members.pl
    routing-preview.pl
    routing.pl
    serials-collection.pl
    serials-edit.pl
    subscription-add.pl
    subscription-bib-search.pl
    subscription-renew.pl
    viewalerts.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b3470ca3f5df7af683e916b35880e674dd200bb
Author: Jenny Way <jwayway@hotmail.com>
Date:   Thu Jan 18 00:40:57 2018 +0000

    Bug 20013: use Modern::Perl in Reserve perl script
    
    Test plan:
    Check the following files that use strict; use warnings; doesn't exist
    and use Modern::Perl; is written instead.
    modrequest.pl
    modrequest_suspendall.pl
    placerequest.pl
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d9348ffa22ecf8cf2a2cf2f953d4e18930c2669
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Thu Jan 18 02:58:06 2018 +0000

    Bug 20012: use Modern::Perl in Reports perl scripts
    
    Test Case:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    borrowers_out.pl
    cat_issues_top.pl
    catalogue_out.pl
    catalogue_stats.pl
    dictionary.pl
    issues_avg_stats.pl
    issues_stats.pl
    itemslost.pl
    manager.pl
    reports-home.pl
    serials_stats.pl
    stats.print.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0216c7ca0c78c9fbb866950562632315b588e36
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Thu Jan 18 03:13:55 2018 +0000

    Bug 20011: use Modern::Perl in plugins perl scripts
    
    Test Plan:
    - Check that it now says 'use Modern::Perl' and not 'use trict; use
    warnings;' in the follwing plugins perl scripts
    
    plugins-home.pl
    plugins-uninstall.pl
    plugins-upload.pl
    run.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ded637bc51227acc9b107da09ba8d0f2a39862d
Author: Grace Smyth <gracesmythh@gmail.com>
Date:   Thu Jan 18 03:58:42 2018 +0000

    Bug 20010: use Modern::Perl in Patroncards perl scripts
    
    Test Plan:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    create-pdf.pl
    edit-batch.pl
    edit-layout.pl
    edit-profile.pl
    edit-template.pl
    home.pl
    image-manage.pl
    manage.pl
    print.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2502c94998c5a60e6ec038e64decc5fb64e5b6a
Author: Te Rauhina Jackson <terauhina.jackson@gmail.com>
Date:   Thu Jan 18 03:43:59 2018 +0000

    Bug 20009: use Modern::Perl in Members perl scripts
    
    Test Plan:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    boraccount.pl
    default_messageprefs.pl
    deletemem.pl
    files.pl
    mancredit.pl
    maninvoice.pl
    member-flags.pl
    member-password.pl
    memberentry.pl
    members-home.pl
    members-update-do.pl
    moremember.pl
    notices.pl
    pay.pl
    paycollect.pl
    printfeercpt.pl
    printinvoice.pl
    printslip.pl
    readingrec.pl
    routing-lists.pl
    setstatus.pl
    update-child.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 165c56de29b259c0607d5e3000045ae5fe481af0
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Wed Jan 17 23:00:28 2018 +0000

    Bug 19999: use Modern::Perl in label scripts
    
    Test Plan:
    - Check that it now says 'use Modern::Perl;' and not 'use strict; use
    warnings;' in the following labels perl scripts:
    
    label-create-csv.pl
    label-create-pdf.pl
    label-create-xml.pl
    label-edit-batch.pl
    label-edit-layout.pl
    label-edit-profile.pl
    label-edit-template.pl
    label-home.pl
    label-item-search.pl
    label-print.pl
    spinelabel-home.pl
    spinelabel-print.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4458e71e56aaa79c80b695aa9c7945a29211584
Author: Te Rauhina Jackson <terauhina.jackson@gmail.com>
Date:   Thu Jan 18 03:14:44 2018 +0000

    Bug 19998: use Modern::Perl in error perl scripts
    
    Test Plan:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    400.pl
    401.pl
    402.pl
    403.pl
    404.pl
    500.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9b93e07fd3259d2c8c795ee220d27a8a1251cd4
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Thu Jan 18 01:57:32 2018 +0000

    Bug 19997: use Modern::Perl in Circulation perl scripts
    
    Test Case:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    bookcount.pl
    branchoverdues.pl
    branchtransfers.pl
    circulation.pl
    hold-transfer-slip.pl
    reserveratios.pl
    returns.pl
    selectbranchprinter.pl
    transfer-slip.pl
    transferstoreceive.pl
    view_holdsqueue.pl
    waitingreserves.pl
    ypattrodue-attr-search-authvalue.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f477c078d86fab112c1ecf26e68dc869bf0fef54
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Feb 4 15:26:58 2018 +0100

    Bug 19996: (QA follow-up) Remove commented use warnings;
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70b4176b195a0e54d776a1de5f1212ab5707f29f
Author: Grace Smyth <gracesmythh@gmail.com>
Date:   Thu Jan 18 03:30:08 2018 +0000

    Bug 19996: use Modern::Perl in cataloguing perl scripts
    
    Test Case:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    addbiblio.pl
    addbooks.pl
    additem.pl
    linkitem.pl
    moveitem.pl
    value_builder/normarc_field_007.pl
    value_builder/normarc_field_008.pl
    value_builder/normarc_leader.pl
    value_builder/unimarc_field_010.pl
    value_builder/unimarc_field_100.pl
    value_builder/unimarc_field_105.pl
    value_builder/unimarc_field_106.pl
    value_builder/unimarc_field_110.pl
    value_builder/unimarc_field_115a.pl
    value_builder/unimarc_field_115b.pl
    value_builder/unimarc_field_116.pl
    value_builder/unimarc_field_117.pl
    value_builder/unimarc_field_120.pl
    value_builder/unimarc_field_121a.pl
    value_builder/unimarc_field_121b.pl
    value_builder/unimarc_field_122.pl
    value_builder/unimarc_field_123a.pl
    value_builder/unimarc_field_123d.pl
    value_builder/unimarc_field_123e.pl
    value_builder/unimarc_field_123f.pl
    value_builder/unimarc_field_123g.pl
    value_builder/unimarc_field_123i.pl
    value_builder/unimarc_field_123j.pl
    value_builder/unimarc_field_124.pl
    value_builder/unimarc_field_124a.pl
    value_builder/unimarc_field_124b.pl
    value_builder/unimarc_field_124c.pl
    value_builder/unimarc_field_124d.pl
    value_builder/unimarc_field_124e.pl
    value_builder/unimarc_field_124f.pl
    value_builder/unimarc_field_124g.pl
    value_builder/unimarc_field_125.pl
    value_builder/unimarc_field_125a.pl
    value_builder/unimarc_field_125b.pl
    value_builder/unimarc_field_126.pl
    value_builder/unimarc_field_126a.pl
    value_builder/unimarc_field_126b.pl
    value_builder/unimarc_field_127.pl
    value_builder/unimarc_field_128a.pl
    value_builder/unimarc_field_128b.pl
    value_builder/unimarc_field_128c.pl
    value_builder/unimarc_field_130.pl
    value_builder/unimarc_field_135a.pl
    value_builder/unimarc_field_140.pl
    value_builder/unimarc_field_141.pl
    value_builder/unimarc_field_210c.pl
    value_builder/unimarc_field_210c_bis.pl
    value_builder/unimarc_field_225a.pl
    value_builder/unimarc_field_4XX.pl
    value_builder/unimarc_field_686a.pl
    value_builder/unimarc_field_700-4.pl
    value_builder/unimarc_leader.pl
    z3950_auth_search.pl
    z3950_search.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cea818a56ac29ae0cb8876e514c5ec97e8ede0e2
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Thu Jan 18 00:45:11 2018 +0000

    Bug 19995: use Modern::Perl in Catalogue perl scripts
    
    Test Plan:
    - Check that it now says 'use Modern::Perl;' and not 'use strict; use
    warnings;' in the following catalogue perl scripts.
    
    MARCdetail.pl
    export.pl
    image.pl
    imageviewer.pl
    issuehistory.pl
    labeledMARCdetail.pl
    moredetail.pl
    search.pl
    showmarc.pl
    updateitem.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc37c04bf3cd7afb61e53cffd58c079fa43af4f2
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Thu Jan 18 00:48:55 2018 +0000

    Bug 19993: use Modern::Perl in Acquisition perl scripts
    
    Test Case:
    Check the following files have been updated from
    use strict;
    use warnings;
    to
    use Modern::Perl;
    
    acqui-home.pl
    addorder.pl
    basketgroup.pl
    basketheader.pl
    booksellers.pl
    check_budget_total.pl
    check_duplicate_barcode_ajax.pl
    edi_ean.pl
    edifactmsgs.pl
    edimsg.pl
    finishreceive.pl
    histsearch.pl
    invoice.pl
    invoices.pl
    neworderbiblio.pl
    neworderempty.pl
    newordersuggestion.pl
    ordered.pl
    orderreceive.pl
    parcel.pl
    parcels.pl
    pdfformat/layout2pages.pm
    pdfformat/layout2pagesde.pm
    pdfformat/layout3pages.pm
    pdfformat/layout3pagesfr.pm
    spent.pl
    supplier.pl
    uncertainprice.pl
    updatesupplier.pl
    z3950_search.pl
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Corrected a single semicolon in edimsg.pl during signoff.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f6a7933b84ba95550518b0364a9ba90002390b5
Author: Jenny Way <jwayway@hotmail.com>
Date:   Wed Jan 17 21:48:57 2018 +0000

    Bug 19992: use Modern::Perl in Admin perl scripts
    
    Test plan:
    Check use warnings; use strict doesn't exist and use Modern::Perl is written instead in the following files:
    
    admin/admin-home.pl
    admin/aqcontract.pl
    admin/aqplan.pl
    admin/auth_tag_structure.pl
    admin/branch_transfer_limits.pl
    admin/check_budget_parent.pl
    admin/check_parent_total.pl
    admin/checkmarc.pl
    admin/classsources.pl
    admin/clone-rules.pl
    admin/didyoumean.pl
    admin/edi_accounts.pl
    admin/edi_ean_accounts.pl
    admin/import_export_framework.pl
    admin/item_circulation_alerts.pl
    admin/marctagstructure.pl
    admin/matching-rules.pl
    admin/printers.pl
    admin/smart-rules.pl
    admin/systempreferences.pl
    admin/transport-cost-matrix.pl
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ba6bd033f30c4d7f393a50e299fe709e524c5f7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 5 09:34:42 2018 -0300

    Bug 19989: remove confusing variable
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f3fef5cae94b64f7ca636be082d4d4c02e1fae9
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Wed Jan 17 04:01:01 2018 +0000

    Bug 19989: Use Koha::Patron::Modifications->delete instead of loop
    
    Test:
    1) Make a change to the user in the OPAC
    2) In the staff client make sure this is the only request
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3d62e4331a9ac00a693ce2fc855ea8131e92395
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Jan 30 18:22:42 2018 +0000

    Bug 12932: Check the Perl version even if all modules installed
    
    The description in comment #0 is quite true, because the
    scope of the $checkmodule variable is local to just the
    module checking. If we change the scope, we can include the
    perl check as part of the new scope, and thus properly set
    its value.
    
    As Debian Jessie, Stretch and Ubuntu Xenial all have good
    versions of Perl by default, the easiest way to test this
    is to:
    - make sure to have some optional modules not installed.
    - change the system preference 'Version' to one just under
      the current version in your SQL client.
    - modify the version check line to 5.030000
    - restart_all and try going to the staff client.
      -- This should not inform you that your perl version is bad.
    - git reset hard back to origin/master
    - apply the patch
    - modify the version check line to 5.030000
    - change the system preference 'Version' to one just under
      the current version in your SQL client.
    - restart_all and try going to the staff client.
      -- This should trigger the patch, and you should
         be informed your perl version is bad.
    - git reset hard back to origin/master
    - apply the patch
    - run koha qa test tools
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8622f4be5900d141dc4fe232476fb3cbfafd3b09
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Thu Jan 25 13:04:09 2018 +0200

    Bug 11827: Make "Cancel Rating" translatable in jQuery rating plugin
    
    - Make the "Cancel rating" text translatable (and change
      capitalization to conform to Koha coding guidelines)
    - Improve the two other messages to use formatted strings
      instead of concatenation.
    - Use the exact same text for the "your rating" text, so it
      only appears once in the po-file.
    
    Test plan:
    
    1. See that the "Cancel rating" -text doesn't appear in
       po/xx-YY-opac-bootstrap.po
    2. Note how there's two versions of the your rating -text
       ("your rating: %s, " and "your rating:") in the po-file
    3. Apply patch
    4. Update the xx-YY translation
    5. Check the po-file. It should now contain the "Cancel rating"
       and a single "your rating: %s, "
    6. Translate those texts, and update & install the language.
    7. Go to the OPAC detail page of a biblio, and check the
       rating texts.
    8. Hovering over the rating minus -sign should show the translated
       "Cancel rating"
    9. Check that the text after the stars is correct with and without
       your rating
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3c6284835769dead3e9a8b6e91a14d7620a130c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jan 18 15:40:15 2018 +0100

    Bug 20031: CGI param in list context warn in guided_reports.pl
    
    Resolve warn:
    CGI::param called in list context from package CGI::Compile::ROOT::usr_share_koha_shadowclone_reports_guided_reports_2epl line 794, this can lead to vulnerabilities. [NOTE: line number from older Koha version.]
    
    Test plan:
    Looking at this change should convince you already. Another look at this
    routine in C4/Output.pm would be bonus.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b65f1f4c94731c4c35845f2a3db112ea3f5cc843
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 1 15:51:16 2017 +0000

    Bug 19730: (follow-up bug 17196) Use biblio_metadata.timestamp in export_records.pl
    
    Since bug 17196, biblioitems.timestamp is not always updated after a
    change in the MARC record.
    Filtering should be based on biblio_metadata.timestamp instead.
    
    REVISED TEST PLAN
    -----------------
    0. Do not apply patch
    
    1. Find a biblio record, remember the biblionumber for step 3
    
    2. Edit the record, modify a field (e.g. 003, 015$q) that is
       not mapped to a DB column, so biblio_metadata.timestamp will
       be modified but not biblioitems.timestamp
    
    3. In MySQL with the koha database selected:
       > select timestamp from biblio where biblionumber=###;
       > select timestamp from biblio_metadata where biblionumber=###;
       -- you'll need to change the ###'s based on the biblionumber
          you remembered in step 1.
       -- the two timestamps will differ.
       -- Remember the timestamp of biblio_metadata for step 4.
    
    4. Run this command:
       $ sudo koha-shell -c bash kohadev
       $ export DATE="YYYY-MM-DD HH:mm:SS"
       -- use the timestamp remembered in step 3.
    
    5. Run this command:
       $ ./misc/export_records.pl --date="$DATE"
       $ ls -la koha.mrc
       -- the file should be 0 bytes.
    
    6. Run this command:
       $ exit
       $ git bz apply 19730
       $ restart_all
       $ sudo koha-shell -c bash kohadev
       $ export DATE="YYYY-MM-DD HH:mm:SS"
       -- use the timestamp remembered in step 3.
    
    7. Run this command:
       $ ./misc/export_records.pl --date="$DATE"
       $ ls -la koha.mrc
       -- the file should be a lot more than 0 bytes.
    
    8. Run this command:
       $ /home/vagrant/qa-test-tools/koha-qa.pl -v 2 -c 1
       -- this should pass.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 906563d1ff9dd32b53b38e9b40a316f0570637fc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 2 12:06:00 2018 +0100

    Bug 20126: Add simple test for ModBiblioMarc
    
    Just to confirm that we see record length and base address in a record
    that has been passed through ModBiblioMarc.
    
    Test plan:
    Run the test.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6da42de894a5fde78d804208fa9d8b493dc57c8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 2 11:32:49 2018 +0100

    Bug 20126: (follow-up bug 10455) Restore MARC field length calculation in ModBiblioMarc
    
    Trivial fix. Problem raised by bug 10455.
    
    Test plan:
    [1] Create or edit biblio record.
    [2] Save and check leader field lengths in MARC view.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58f7214926c62f86e7d5a42e3c38037a8e80263c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 31 13:52:46 2018 +0100

    Bug 18198: (QA follow-up) Add tests for GetMarcNotes
    
    As requested by the RM, this patch adds a separate unit test
    for GetMarcNotes. We test MARC21 and UNIMARC. The NotesBlacklist pref
    is tested and also handling URLs in 5XX$u for MARC21.
    
    Test plan:
    Run t/Biblio/GetMarcNotes.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9215cb7cafb95b7fa21838a7d8ddaf71999ad572
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 2 12:59:37 2017 +0100

    Bug 18198: MARC21: Further improve handling of 5XX$u in GetMarcNotes
    
    Bug 14306 only handled field 555 in MARC21 as an URI. But a lot of other
    5XX fields have a $u subfield for URIs; actually $u is not used in any
    other way. This patch generalizes the change made for 555 and extends
    it to all 5XX $u.
    
    Test plan:
    [1] Run t/Biblio.t
    [2] Run t/db_dependent/Biblio.t
    [3] Edit a MARC21 record. Add a URL into 505u, 520u, 555u.
    [4] Check presentation on opac-detail (tab Title notes)
    [5] Check presentation on catalogue/detail (tab Descriptions)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 320e66b0438cc752ddc4e21d5c74c226f2e85120
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 19 19:41:35 2018 +0000

    Bug 20051: Invalid markup in staff client's header.inc
    
    This patch corrects markup errors in header.inc which introduced by
    Bug 19851. For id attributes on <span>s have been replaced with classes,
    eliminating an HTML validator error about duplicate ids.
    
    Minor unrelated change: Updated an element's id with a more descriptive
    name.
    
    Test plan the same as Bug 19851's:
    
     - Log in to the staff client and confirm that the appearance of the
       menu bar at the top of the screen looks correct at various browser
       widths.
     - Confirm that the logged-in user menu label and help link expand and
       collapse according to browser width.
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Fix for QA: Corrected ID reference in circ/offline.tt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 11515d5f76fbc5244df6b5d3b5ff7a6d4f262445
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Dec 5 10:23:45 2017 -0500

    Bug 19750: Overdues without a fine rule add warnings to log
    
    When running fines.pl, any overdue items that have no corresponding circulation rule will generate the following warning:
    
    Use of uninitialized value $amount in numeric gt (>) at /usr/share/koha/bin/cronjobs/fines.pl line 133.
    
    Test Plan:
    1) Create a single circ rule
    2) Backdate a checkout so it is overdue
    3) Delete the circ rule
    4) Run fines.pl, note the warning
    5) Apply this patch
    6) Run fines.pl, note the warning is gone
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8ffee5f0fad17815027c5c0b85babab515c679e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jan 30 14:34:10 2018 +0000

    Bug 18497: (follow-up) Chomp newlines in BLOCK
    
    To test:
    Run report
    Validate results page at: https://validator.w3.org/
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f5a9c98bcc38d6481be0463747086bfcf705a70
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 3 13:13:40 2018 +0000

    Bug 18497: Use report id to retrieve saved SQL instead of passing param
    
    This patch takes some of the code when executing report and moves it to
    a sub to be reused when downloading
    
    To test:
    1 - Run some very long report (see comment #1)
    2 - Try to download, erk!
    3 - Apply patch
    4 - Run report, results hould not have changed
    5 - Try to download, success!
    6 - Ensure reports work as before
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd2d2fd433baeca3d311c403b482c6a2000a6668
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Jan 26 09:25:21 2018 +0000

    Bug 16213: (QA follow-up) Fix terminology
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c76281f3fcb4f634a1e1a8f74b9663763c874dfd
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Apr 6 13:12:51 2016 +0200

    Bug 16213: Allow to select hold's itemtype when using API
    
    Test plan:
    1/ Use your usual "REST testing" tool to place a title-level hold with
    an itemtype. The request should look like this:
    
    POST /api/v1/holds
    {
        "borrowernumber": 1234,
        "biblionumber": 456,
        "branchcode": "CPL",
        "itemtype": "A"
    }
    
    2/ Check that the hold was placed and the itemtype is correctly selected
    3/ prove t/db_dependent/api/v1/holds.t
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83177006302494bc3a5bc67a7d89d373d5a9002c
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Tue Jan 23 12:11:32 2018 +0100

    Bug 17084: Automatic debian/control updates
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e04c780e9a51c06d606b1bf7cda89e465f1d7431
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jan 25 12:01:30 2018 +0100

    Bug 20088: Fix uninitialized warning from svc/holds
    
    Use of uninitialized value in array element at svc/holds line 56.
    
    Test plan:
    Check if the warn is no longer in the logs; the warning is triggered by
    an ajax call from the circulation template in staff.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20e89d051c9ca3def36e9cde742ea10fd59204aa
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 22 09:49:36 2018 +0100

    Bug 20056: Resolve uninitialized warn in cmp_sysprefs.pl
    
    When running a compare with --upd flag, I got the following warn:
        Use of uninitialized value in addition (+) at misc/maintenance/cmp_sysprefs.pl line 125.
    This is simply resolved by not returning undef but 0 in case of the Version
    syspref in the sub UpdateOnePref.
    
    Test plan:
    Look at this simple change.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1ba582af9c93a96870365be2fd1609621567a2e
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Wed Jan 17 23:16:38 2018 +0000

    Bug 19827: Removing &checkuniquemember from the export in C4/Members.pm
    
    Test Plan:
    - Check that the line &checkuniquemember has been removed from the
    export in C4/Members.pm
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32a2b5a996a91bfa1f4a22c1c7ceefc9e2bd8b31
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 26 12:43:58 2018 +0000

    Bug 20091: Moved FailedLoginAttempts out of Norwegian Patron Database heading
    
    To test:
    1 - View systempreferences patron tab
    2 - Note FailedLoginAttempts is uner 'Norwegian Patron Database'
    3 - apply patch
    4 - Now it is under 'General'
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Maksim Sen <maksim@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13cb7e0490e7a41e2c47ba89e27bfdc446af572c
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Sun Jan 28 01:41:01 2018 -0500

    Bug 13990: (follow-up) silence warnings on testing
    
    prove t/db_dependent/ILSDI_Services.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84fc8c65186053ea69e46b5c8aac736050e0ac54
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Sun Jan 28 01:18:54 2018 -0500

    Bug 13990: (QA follow-up) Add unit test coverage
    
    prove t/db_dependent/ILSDI_Services.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d6e58f7cadd9c42ef5669b29674bd4b38fabc4f
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jan 26 16:20:20 2018 +0000

    Bug 13990: (follow-up) fix various whitespace errors
    
    - tabs to 4 spaces
    - trailing whitespace
    - missing vertical whitespace before =head3
    
    Without this patch, this bug fails qa test tools.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65e541085c86ab2f6873a0c98d631b7719bcc62d
Author: Jon Knight <J.P.Knight@lboro.ac.uk>
Date:   Tue Nov 7 17:27:56 2017 +0000

    Bug 13990: ILS-DI LookupPatron requires ID Type
    
    Patch provides a constrained set of borrower attributes to try in turn if the
    ID type is not specified.  Also added "email" to the POD documented list of
    id types seeing as its quite a useful one for integration developers.
    
    Test plan:
    
    1) without the patch applied, turn on ils-di interface in your admin sysprefs
       and then try accessing the URL:
    
       https://your-server/cgi-bin/koha/ilsdi.pl?service=LookupPatron&id=Mabel
    
       replacing "your-server" your Koha dev test domain name (localhost:8080 if
       you're using a kohadevbox VM) and "Mabel" with the first name of a patron
       (Mabel is in the test database already if you're using that).
    
       You should get back an error message in the XML.
    
    2) Apply the patch and repeat. This time you should get an <id> element in
       the XML with Mabel's patron ID in it.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19a07cc16f2ffb1c019bf98707fcbe31e57168a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 30 14:06:27 2018 -0300

    Bug 19230: (follow-up) Preventing warn when deleting course
    
    Simplify 'unless' statement
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f05da6ada78f2366a96cce4af25f20bab3b271c1
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Dec 21 00:57:21 2017 +0000

    Bug 19230: Preventing warn when deleting course
    
    To test:
    1) Ensure UseCourseReserves is enabled
    2) Go to Course Reserves, create a course
    3) When you are taken to the course page, you should notice the
    'Argument "" isn't numeric in numeric gt' warn
    4) Delete course
    5) Notice warn, and that no confirm message popped up
    6) Apply patch
    7) Create a course again. Confirm the 'Argument "" isn't numeric in
    numeric gt' warn did not show
    8) Delete the course
    9) Notice no warn and the confirm message pops up
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24b72f8bfa122ed9bbbf697d15fb6de68c66f4a0
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Fri Jan 26 15:01:39 2018 +1300

    Bug 20041: ILL module missing from more menu in staff when activated
    
    Apply this patch
    Check that ILL requests are now listed in More menu when ILL requests syspref is enabled
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10c3dc1a25f08994b832bd37998ff10c30ac2f88
Author: Grace Smyth <gracesmythh@gmail.com>
Date:   Wed Jan 17 20:36:59 2018 +0000

    Bug 19986: 'Server name' doesn't appear as required
    
    Test plan:
    [1.] Go to Admin -> z39.50/SRU servers
    [2.] Make a new z39.50 server
    [3.] Fill in the required field (hostname, port, database)
    [4.] Save the server
    [5.] Notice that the form does not submit, tells you that Sever name is
         required
    [6.] Repeat steps 2 - 5 but this time make a new SRU server
    [6.] Upload the patch and repeat steps 1 - 3 (make a new z39.50 server
         and a new SRRU server)
    [7.] See that now 'Server name:' is red and on the right side of the box
         there is a required note
    [8.] Save both servers and it should have created a new z39.50 server
    and a new SRU server
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1cb8a14bcd5bcc1ca6fd9efb0b9912b773790a7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 26 21:05:39 2018 +0000

    Bug 20003: (QA follow-up) use patron checkouts method instead of Koha::Checkouts
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccea385ce7bf65a2650d7993f3e9d0cd34d51c49
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Jan 18 07:56:15 2018 +0000

    Bug 20003: Fix showing number of remaining checkouts during checking in
    
    Test plan:
    0) Do not apply the patch
    1) Have a patron with more then one checkout
    2) Return one of patron's checkout and confirm the remaining number of
    checkout is not shown
    3) Apply the patch
    4) Try it again and confirm the number is now shown
    
    Signed-off-by: Roch D'Amour <roch.damour@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74dec87b0f9d9868d910cf9e2b400598b2217aa8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 22 17:04:28 2018 -0300

    Bug 19975: Fix search by tags at the OPAC
    
    This bug has certainly be caused by
      commit 091d6c513bcbee224ff06477e79be48cea7fe825
        Bug 17843: Replace C4::Koha::getitemtypeinfo with Koha::ItemTypes
    
    The reason is quite simple, in Koha::ItemType->translated_description
    (called in opac-search.pl l.229) there is an eval to know if we have
    access to the translated description of the item type, to avoid
    retrieving it again.
    
    The evaluation of $@ later in opac-search.pl is supposed to test the 2
    eval made few lines before (a "normal" search, without tags), but
    $@ contains the error message from the *last* eval command.
    So we are raising an error that have been correctly handled in
    Koha::ItemType.
    
    Test plan:
    At the OPAC, click Tag cloud, then click any of the tags
    
    => Without the patch you get
    Koha::ItemType::get_column generated this error: DBIx::Class::Row::get_column(): No such column 'translated_description' on Koha::Schema::Result::Itemtype at /usr/share/koha/lib/Koha/Object.pm line 307
    
    => With the patch applied the page is correctly displayed
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3abb73b5cc8c541f7b6c8acc4c03be337c77099
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Tue Jan 23 11:43:10 2018 +0100

    Bug 20072: Fix build-git-snapshot for Debian source format quilt
    
    With bug 18696 we need a few tiny changes to build-git-snapshot:
    - Debian revision number for debian/changelog
    - "orig" in the file name for the tar.gz archive
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7cb86656956131ed81cc74069a765a37664edd8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 30 12:24:48 2018 -0300

    Revert "Bug 19669: (QA follow-up) Remove itemstypes.plugin"
    
    This reverts commit 7140a5e4ecc68759c1bee04571386f9cc9a16d92.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e1c6dddde372f622cc88f993f72b8f81d0b6252
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 23 17:00:16 2018 -0300

    Bug 19705: Try to fix random failures from DecreaseLoanHighHolds.t
    
    No idea if it will do the trick, wait and see...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80de9fa97cfc737e7da42418c059dbf6b1bcf1f7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 21 16:28:31 2017 -0300

    Bug 18964: Add --debugger option to koha-plack
    
    CAVEAT: This patch is only about allowing koha-plack to start a debugging
    session on a remote target. Configuring all the needed pieces to make it
    work is out of the scope of the bug. Testing should be focused (mainly) on
    making sure this introduces NO REGRESSIONS on regular use (i.e. not debugging).
    
    This patch adds the following option switches to koha-plack:
    
    --debugger
    ----------
    Toggle debugging
    
    --debugger-key
    --------------
    Some IDEs require a key, this needs to match because they are picky about it
    
    --debugger-location
    -------------------
    This option switch is used to specify the host:port your IDE is listening at.
    Inside kohadevbox (using Vdebug with Vim) this would be localhost:9000. Outside
    kohadevbox it would be 192.168.50.1:9000
    
    --debugger-path
    ---------------
    This is the path in which you installed the Komodo Remote Debugger library [1]. In kohadevbox
    you could put the contents of the downloaded .tar.gz in /home/vagrant/dbgp/perllib. That
    perllib seems to be required for things to work [2].
    
    You can test with a simple CLI script things work:
    
    PERL5LIB=/home/vagrant/dbgp/perllib:$PERL5LIB \
    PERLDB="BEGIN { require q(/home/vagrant/dbgp/perllib/perl5db.pl) }" \
    PERLDB_OPTS="RemotePort=192.168.50.1:9000" perl -d t/Prices.t
    
    If you see action on your IDE, you are on the right track on the IDE side.
    
    To test:
    - Apply this patch
    - Enable remote debugging on your IDE, on port 9000 (or adjust the command
      below to match your IDE's listening port).
    - Download the Komodo Remote Debugger package, and place the package's contents
      in /home/vagrant/dbgp/perllib (you should see perl5db.pl in there).
    - Run:
      $ sudo koha-plack --stop kohadev
      $ sudo kohaclone/debian/koha-plack --start \
                                         --debugger \
                                         --debugger-path /home/vagrant/dbgp/perllib \
                                         --debugger-location 192.168.50.1:9000 \
                                         kohadev
    => SUCCESS: You IDE/tool gets a connection from the Plack process.
    - Sign off :-D
    
    The explanation on how to use it assumes you are running kohadevbox.
    
    WARNING: The main difficulty I found was setting the right dir/file mappings.
    
    [1] http://code.activestate.com/komodo/remotedebugging/
    [2] https://github.com/Komodo/KomodoEdit/issues/644#issuecomment-236268012
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2bf4289ad16507f673bed36d222353adef6189f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 22 17:18:59 2018 -0300

    Bug 19985: Make TestBuilder.t pass even if default_circ_rules is not empty
    
    This table cannot contain more than 1 row, so we need to remove its data
    before trying to generate a new entry.
    
    Test plan:
    Set a default circ rule
     prove t/db_dependent/TestBuilder.t
    should return green
    
    Without this patch you get:
        #   Failed test 'TestBuilder should be able to create an object for every source'
        #   at t/db_dependent/TestBuilder.t line 78.
        #          got: '1'
        #     expected: '0'
        # The following sources have not been generated correctly: DefaultCircRule
        # Looks like you failed 1 test of 1.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85b0424eb704d416950510c30b41a10ce56cbc3b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon May 8 16:47:06 2017 +0000

    Bug 18477: Populate article_requests table values for AR_PENDING notices
    
    The default AR_PENDING letter does not print populate <<article_requests.*>> fields.
    
    Test Plan:
    1) Enable article requests ( syspref: ArticleRequests => Enable, Circ and fine rules ALL/ALL (or a given category/itemtype): Article requests => Yes )
    2) Search for a title, click in to catalog detail, click 'Request Article' button.
    3) Select Patron
    4) Fill out request information
    5) Click 'Place request'
    6) Go to notices in patron record, inspect 'Article Request Received' notice. You should see the request information from step 4, but it doesn't display.
    7) Apply this patch
    8) Repeat steps 2-6, not the fields now display!
    
    Signed-off-by: Eric Phetteplace <phette23@gmail.com>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c87adaf4f3802cb3d701529efc10fa65a70caac3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 2 14:36:43 2018 -0300

    Bug 18477: Add tests
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7236df74223b3976f4da88f51d8321d7a4802f7
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jan 22 23:52:21 2018 +0000

    Bug 20068: Check if user logged in before passing dashboard params to template
    
    This prevents warns from dashboard variables when not logged in
    
    To test:
    1) Go to OPAC main homepage. Do not log in
    2) Notice warn
    3) Apply patch and refresh
    4) Warn should be gone
    5) Log in
    6) Confirm dashboard shows as normal
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19e97bed4ecec730058c2f4f95efb49f07c0f44e
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Tue Jan 16 02:09:29 2018 +0000

    Bug 19831: Turn on EnhancedMessagingPreferences by default for new installations
    
    Test plan:
    1) Create a new installation
    2) On staff go adminisation --> and search EnchancedMessagingPreferences
    3) Check that it is automaticaly on allow. If it is the it has worked.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adaa2ad86ae4021b7846de9930c2032c425a6691
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 17 14:26:38 2018 +0100

    Bug 20063: (bug 18811 follow-up) Allow hidden $9 subfields
    
    Although we could argue that the user should make all $9 subfields
    visible, this might be a good compromise. It selectively reverts the
    change from the first patch by accepting $9 subfields without checking
    the hidden flag in the framework.
    
    Test plan:
    [1] Make a subfield $9 visible for some authority field.
    [2] Put a value in it somewhere in authorities.pl
    [3] Make subfield $9 invisible in the auth framework.
    [4] Open and save the adjusted authority record.
    [5] Check the marcxml of this record.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad770a01be4f79ab78273e4f3a2b660589c34084
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 16:08:33 2018 -0300

    Bug 7143: Update about page for new dev - Zoe Bennett
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 330314f609b32d6c7eb102120bff083d90573185
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 16:06:35 2018 -0300

    Bug 7143: Update about page for new dev - Te Rauhina Jackson
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c5a368db8d6cae4219d03b0a84f63c36f48cc81
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 16:07:46 2018 -0300

    Bug 7143: Update about page for new dev - Charlotte Cordwell
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5adc40ad1c39cb4fb784a41e39ae471c28d0513
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 16:03:07 2018 -0300

    Bug 7143: Update about page for new dev - Grace Smyth
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 750adfb41484352e36723edc4cb292cae425cf25
Author: Zoe Bennett <zoebennett1308@gmail.com>
Date:   Wed Jan 17 03:27:06 2018 +0000

    Bug 19988: Fixing the case where terminolgy referred to sex instead of gender.
    
    To test:
    1) Change a users gender in the OPAC
    2) View it in the patron request in the staff client
    3) Check that under 'Field' it now says 'Gender' instead of 'Sex'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 231817c40f528144d8fe29f5a0b20470205052f2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 15:42:54 2018 -0300

    Bug 18083: Simplify the condition - if there are more than 1 library
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dfb27605c9f953d311382e662155f7f282f0e07
Author: Te Rauhina Jackson <terauhina.jackson@gmail.com>
Date:   Tue Jan 16 03:03:47 2018 +0000

    Bug 18083: Don't show 'library' selection on popular titles page for single-branch libraries
    
    This patch hides the search filter labelled "From" that offers you to
    select a library branch which is located on the 'popular titles' page on the OPAC. It is hidden when the library only has one branchas it would be unneccessary to have an option for other branches when there is only one.
    
    Test Plan:
    1) Make sure you have a single-branch library
    2) Make sure OPACTopIssue is allowed in the OPAC preferences
    3) In the OPAC, got to 'Most Popular' page
    4) Check that there is no "From" filter in the refine search
    5) Create a new branch so that you have more than one branch
    6) Check that there is a "From" filter in the refine search on the Most Popular page.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended white space on second change.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c4974cc1246ceb5d84ed01ce70456ef34b9b330
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Nov 2 10:55:42 2017 +0100

    Bug 19585: Inventory: Allow additional separators in a barcode file
    
    This patch makes \n, \r, |, comma, semicolon and hyphen ('-') all valid
    separators between barcodes passed to inventory.
    An additional grep removes empty barcodes. (Note: The grep looks for at
    least one non-whitespace character. We could be more specific, but this
    allows for more flexibility like testing with alphanumeric barcodes etc.)
    
    Test plan:
    Upload a barcode file that contains various allowed separators.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Jenny Way <jwayway@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfc82dbc418bc79781df3a9e231e60491c501220
Author: Grace Smyth <gracesmythh@gmail.com>
Date:   Tue Jan 16 02:16:50 2018 +0000

    Bug 18878: Align labels in item form to the right
    
    Test Plan
    [1.] Search for an item and click on it
    [2.] Press the edit button to edit an item
    [3.] Notice that the labels are aligned to the left and very far away
    from the boxes
    [4.] Load the patch and now notice that the labels are closer to the
    boxes and are easier to read
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2a045b9d508d56e556ecbbb11238d8108ce4512
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 20:29:29 2017 -0300

    Bug 15770: Do not format numbers if too big
    
    At several places we got the following error if we use numbers too big
    for Number::Format
    Template process failed: undef error - round() overflow. Try smaller
    precision or use Math::BigFloat at /home/koha/src/Koha/Number/Price.pm line 44
    
    It make the app explodes.
    The goal here is to handle these errors gracefully and easily.
    
    Test plan:
    - Add a manual fine to a patron of 100000000000000
    - Create a patron category with an enrolment fee of 123456789012345
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a2d0a8f652aa958b1c650fdf8002846970ce98c
Author: Olivier Crouzet <kohateam@univ-lyon3.fr>
Date:   Mon Jan 15 17:22:22 2018 +0100

    Bug 19971: Typo in the comments of parseQuery routine
    
    TEST PLAN
    ---------
    1) Run these commands:
        git checkout master
        git pull
        perldoc C4::Search
    2) look for parseQuery
        -- NOTE: The sample code provided below this heading has
                 the wrong function name!
    3) Run these commands:
        git checkout -b bug_19971 origin/master
        perldoc C4::Search
    4) look for parseQuery
        -- NOTE: The wrong function name is corrected.
    5) Run koha qa test tools
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f37ebd0f76e3bfcdcde6c27bbc2671910449fc59
Author: Te Rauhina Jackson <terauhina.jackson@gmail.com>
Date:   Tue Jan 16 21:21:21 2018 +0000

    Bug 19221: Onboarding tool says user needs to be made superlibrarian
    
    I changed the "To give new patron superlibrarian permissions go to:"
    message to "To edit patron permissions, go to:". Please clarify if this
    is clearer or not.
    
    Test plan:
    1) Apply patch
    2) Go through the web installer
    3) At the create koha administrator patron step, notice that at the
       bottom, there is a message saying "To edit patron permissions, go
       to:"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6252c297a957124169b69b281ea764223bb71218
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Dec 17 08:45:41 2017 +0000

    Bug 19825: Make links to biblios on pending offline circulation page working again
    
    0) Do not apply the patch
    1) Have pending offline circulation operations - you can use standalone
    application, Firefox add-on or built-in offline circulatin client - it
    does not matter in this case
    2) Go to Circulation -> pending offline circulation actions
    3) You see all barcode in red and without links - even if the item and
    biblio existed
    4) Apply the patch
    5) Repeat 1-3, now you should see the links to biblio on existing items
    
    Note: Don't add non-existent barcodes actions and payment actions unti
    bug 19771 is not fixed
    
    Signed-off-by: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 727177df5c0c02814f6f5c1cfeca65674d54c8fc
Author: Grace Smyth <gracesmythh@gmail.com>
Date:   Tue Jan 16 03:41:15 2018 +0000

    Bug 19839: Removed Warning (invoice.pl - uncertainprices)
    
    Test Plan
    [1.] Check the patch to see that I have removed:
    $template->param( uncertainprices => 1 ); from line 204 as Mr Druart has instructed to do
    (to get to the patch see the comment above by Mr Druart)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ebb19a94b7e28016048b9220f3e8b75ded22062
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 15:49:28 2018 -0300

    Bug 17682: DBRev 17.12.00.006
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66693d84a8c5949766c1de76649c45ffe6a39815
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 19 15:26:32 2018 -0300

    Bug 17682: Replace 2 occurrences in de-DE and nb-NO
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e85b584499946cee7f725fb839e484fdc049adbd
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Tue Jan 16 20:14:20 2018 +0000

    Bug 17682: (follow-up) Change URL for Google Scholar in OPACSearchForTitleIn
    
    Amended the sql statement so it only affects the http://www.scholar.google.com url
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59ea245f854ec04e8e081f6effececa4193f84c5
Author: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
Date:   Tue Jan 16 03:55:49 2018 +0000

    Bug 17682: Change URL for Google Scholar in OPACSearchForTitleIn
    
    1)apply patch
    2) go into administration --> search for OPACSearchForTitleIn
    3) *click to edit*
    4) look at the link and read the google scholar one.
    5) check that the start link is https://scholar.google.com.
    6) http://www.scholar.google is incorrect
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f68f5c90136d6da1ec91778b3ee0ba9fb8ca613
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 19 14:11:51 2018 +0000

    Bug 16603: (QA follow-up) Add a FIXME
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2da5356e4b8dc5a7313a7d117a664764d4afc31c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 1 18:23:01 2017 +0000

    Bug 16603: When processing uploaded offline circulation file, "apply directly" option fails
    
    This patch is a temporary mitigation of whatever the real problem is.
    The patch hides the "Apply directly" button so that the option isn't
    available.
    
    To test, apply the patch and generate a .koc file with some
    transactions. Upload the file via Circulation -> Offline
    circulation file upload. After the file is uploaded, you should see only
    a "Add to offline circulation queue" button, which should work
    correctly.
    
    Signed-off-by: Grace Smyth <gracesmythh@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4933de21ea0d5d70d078456ff2317187134f1a4c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 18 14:42:25 2017 +0000

    Bug 19677: Properly escape enumchrom/serialseq data
    
    Some serial issues use angle brackets for denoting certain data.
    Currently this is not displayed in Koha. This patch escapes the data so
    that angle brackets will display.
    
    To test:
    1 - Add an enumchron field to an item containg angle brackets:
    "This is a <test>"
    2 - View the record in the staff and opac, not the field displays as:
    "This is a"
    3 - Apply patch
    4 - Note full text now displays
    
    Signed-off-by: Charlotte Cordwell <charlotte.cordwell123@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ef92056ffea9dd47d59dc9695391167ed3fdcb1
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Fri Jan 19 14:06:48 2018 +0100

    Bug 18696: Change debian/source/format to quilt
    
    debian/source/format uses 'native'. As Koha is not native Debian software,
    and to allow Debian revision numbers like -2 in 16.05.13-2, it should be
    changed to 'quilt'.
    
    This is only relevant to packaging and does not affect Koha itself.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42d7b23c0256e4aab9aa6f1d014524ad9c5e0cd6
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Fri Jan 19 13:55:30 2018 +0100

    Bug 19783: Move check_kohastructure.t to db_dependent
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42d8c599e577e0595555892b83f9bee420516c0d
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Fri Jan 19 13:59:43 2018 +0100

    Bug 20042: 00-load.t fails when Elasticsearch is not installed
    
    00-load.t fails when Elasticsearch is not installed. Blocks packaging.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01af3bb7dd1cd92eca2f33429048030655f7a0a0
Author: Grace Smyth <gracesmythh@gmail.com>
Date:   Thu Jan 18 20:30:00 2018 +0000

    Bug 19987: If no z39.50/SRU servers the button should not show
    
    Test plan:
    [1.] Load the patch and make sure you have some Z39.50/SRU servers
         (Administration => Z39.50/SRU servers administration)
    [2.] Then go to authorities and notice that the 'New from
         Z39.50/SRU' button is there
    [3.] Next go to cataloging and notice that the 'New from Z39.50/SRU'
         button is there too
    [4.] Now make sure you have no Z39.50/SRU servers (remove the
         servers)
         (Administration => Z39.50/SRU servers administration)
    [5.] Go to authorities and notice that the 'New from Z39.50/SRU'
         button is not there
    [6.] Lastly go to cataloging and notice that the 'New from Z39.50/SRU'
         button is not there too
    
    :)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    I added a missing [% END %] during signoff. Hope no one minds!
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8329eb174a4f856b11c0fd8c331bdd6f0371085c
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Jan 16 10:20:21 2018 +0100

    Bug 19977: Open only .pref files in Local Use tab (sysprefs)
    
    Test plan:
    1. Open .../prog/en/modules/admin/preferences/circulation.pref
    with vim (check that it creates a .circulation.pref.swp in the same
    directory)
    2. Go to the "Local Use" tab in admin/systempreferences.pl
    3. Confirm that the page works normally
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 898b17ba8e8906870f7876f5e8283b05a1c93c7b
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Dec 17 08:53:18 2017 +0000

    Bug 19771: Fix crashing in pending offline circulation actions list
    
    When the barcode is empty or invalid, an "Internal Server Error"
    is triggered on the kohadev box.
    
    TEST PLAN
    ---------
    0) back up your database if you care about it.
    1) Run the following commands:
        git checkout master
        git pull
        git checkout -b bug_19771 origin/master
        git bz apply 19771
       -- This should be quite uneventful. Standard promptings.
    2) Continue to run the following commands:
        git checkout master
        reset_all
        sudo koha-shell -c bash kohadev
        ./misc/cronjobs/create_te_koc_db.pl --sqlite3
       -- This will create a borrowers.db in your current directory.
    3) On the host where you intend on running the koct install it.
       -- https://sourceforge.net/projects/koha-oc/files/
          download and install.
    4) get the borrowers.db file to your host where you installed koct
    5) point koct at the file you downloaded
       Database -> Select Borrowers DB File
    6) Create a .koc file with the following transactions.
        check in, check out, check in (bad barcode),
        pay fines (any non-zero amount).
    7) Run the following commands:
        restart_all
       -- we want to make sure caching for plack isn't in the way.
    8) In the staff client: Home -> Circulation
        -> Upload offline circulation file (.koc)
    9) Choose the file created and click 'Upload file'.
    10) Add to offline circulation queue.
    11) View pending offline circulation actions
        -- This should die. Reading /var/log/koha/kohadev/plack-error.log
           should be the same error as comment #0.
           However, this was only the bad biblio error.
    12) Run the following commands:
        git checkout bug_19771
        restart_all
    13) Refresh staff client page.
        -- it should all come up.
    14) Select the bad biblio line, and delete it.
    15) Run the following commands:
        git checkout master
        restart_all
    16) Refresh the staff client page.
        -- it should die. Same error as comment #0.
           This confirms the fine payment issue.
    17) Run the following commands
        git checkout bug_19771
        restart_all
    18) Refresh the staff client page.
        -- it should all come up.
    19) run the koha qa test tools
    20) if you backed up your database, restore it. :)
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6559f5524fdd586838bd48d03ee86f5c710ff35e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 18 12:49:12 2018 -0300

    Bug 20001: Fix confusion between array and arrayref
    
    Illrequest->available_backends always returned only 1 element
    
    TEST PLAN
    ---------
    See bug 7317 comment #20 for configuring ILL
    Make sure to restart_all
    Strangely, ILLIBS didn't exist, but IL did in default install,
        so use that as the patron code in your koha-conf.xml
    Make sure to turn on the ILL related system preference.
    
    1) Configure ILL.
       -- this is the hard part. Hopefully the above will give you
          enough.
    2) open OPAC and log in
    3) Click the 'your interlibrary loan request' in the left pane
    4) Click the 'Create a new request' button.
       -- when you hover your mouse over the links for the backends,
          they will have ARRAY(...) instead of a meaningful name.
          This is what triggers the error (see comment #7).
    5) Run the following commands
        git checkout -b bug_20001 origin/master
        git bz apply 20001
        restart_all
    6) Refresh the OPAC page, and repeat step 4.
        -- when hovering your mouse over the links for the backends,
           they will have meaningful values now.
    7) run koha qa test tools.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 326e83748c300ace9679244989c54ef6cffb9e5a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 20 10:00:19 2016 -0300

    Bug 17467: Add missing --status switch handling
    
    RM note: I forgot this patch (no idea what happened!)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 129ffee791da9f8ab4ad85a4473a138fc81ccbef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 15 10:10:41 2018 -0300

    Bug 19968: Add missing use Date::Calc statement
    
    It has been reported than the missing use statement can cause a
    compilation error:
    Undefined subroutine &Date::Calc::Today called at
    /usr/share/koha/intranet/cgi-bin/cataloguing/value_builder/unimarc_field_100.pl
    line 75.
    
    Test plan:
    Use this UNIMARC plugin and make sure it fixes the error or at least
    does not break it
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1770d08162ed146d9e37e8058dea0fff2f9fb63
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 15 13:46:06 2018 -0300

    Bug 19973: Fix SQL syntax error in uk-UA/mandatory/sample_notices.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07ced9f337fe183403d2b62e9ded98c94224e73e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 15 13:41:41 2018 -0300

    Bug 18915: Add CHECKOUT_NOTE notice template for other languages
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3524925631817521480cb233d6c60927d80e93c5
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Jan 9 14:37:08 2018 +0000

    Bug 19937: Silence warnings t/db_dependent/www/batch.t
    
    TEST PLAN
    ---------
    1) Run the following on a kohadevbox:
        git checkout -b bug_19937 origin/master
        sudo koha-shell -c bash kohadev
        prove t/db_dependent/www/batch.t
        cat /var/log/koha/kohadev/plack-error.log
    
        The following errors are triggered at the end of the log file:
            Use of uninitialized value in array element at
            /home/vagrant/kohaclone/tools/batch_records_ajax.pl line 50.
            Use of uninitialized value $results_per_page in numeric eq (==) at
            /home/vagrant/kohaclone/tools/batch_records_ajax.pl line 53.
            Use of uninitialized value in uc at
            /home/vagrant/kohaclone/C4/ImportBatch.pm line 1120.
    
    2) Run the following on a kohadevbox:
        exit
        git bz apply 19937
        restart_all
        sudo koha-shell -c bash kohadev
        prove t/db_dependent/www/batch.t
        cat /var/log/koha/kohadev/plack-error.log
    
        The log file will end with the restarting of plack, not the
        errors.
    
    3) run koha qa test tools
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended handling of $results_per_page.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 163404d9c7bc1c3d35d4810e0b91f7cd47dab987
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Wed Oct 18 14:33:22 2017 +0300

    Bug 19483: Fix test plan in t/db_dependent/www/*
    
    t/db_dependent/www/* crashes test harness due to misconfigured test plan
    
    prove t/db_dependent/www/
    
    without defining KOHA_INTRANET_URL
    bails out and marks the whole test suite as failed.
    Test suite should not be failed if this optional WWW::Mechanize test
    suite is not activated.
    
    After this patch, the tests are properly skipped without failing the
    whole tests.
    
    This is important when running all tests under t, as this needlessly
    fails the test suite.
    
    Also handling of 'skip_all' is inconsistent in t/db_dependent/www
    -tests, so this normalizes it to skip_all instead of bail_out
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d0284f79d9b0f56b0762a7ebe4012454827f5a8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 15 12:19:08 2018 -0300

    Bug 18915: DBRev 17.12.00.005
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f9cb38f1d8dc690e20e0a73b2566be8abece9c8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 12 11:31:42 2018 +0100

    Bug 18915: (QA follow-up) Add note for installs after 17.05
    
    Since the 17.05 upgrade adds the note and the sql file did not yet include
    the note, we should add it when it is not there (for example new 17.11s).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested by running the dbrev while there is a letter and while not.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd772363716f8b6ba9eec6c429680dfef5652737
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sun Dec 17 23:42:36 2017 +0000

    Bug 18915: Renaming svc/patron_notes to svc/checkout_notes
    
    For consistency.
    
    Signed-off-by: Marjorie Barry-Vila <marjorie.barry-vila@collecto.ca>
    
    https://bugs.koha-community.org/show_bug.cgi?id=19801
    
    Signed-off-by: Marjorie Vila <marjorie.barry-vila@collecto.ca>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8963726d0ea00c50c4914dfd5172cb01a708fb4
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sun Dec 17 23:33:18 2017 +0000

    Bug 18915: Giving CHECKOUT_NOTE access to issues table
    
    This patch allows the notice to reference the issues table so that the
    checkout note itself can be added to the note if wanted, such as in
    Comment 9.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Marjorie Barry-Vila <marjorie.barry-vila@collecto.ca>
    
    https://bugs.koha-community.org/show_bug.cgi?id=19801
    
    Signed-off-by: Marjorie Vila <marjorie.barry-vila@collecto.ca>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5239269216bac250593a32bdf4cce3a6fae0f8fc
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sun Aug 27 23:20:40 2017 +0000

    Bug 18915: Fix checkout note email message
    
    This patch replaces the <<biblio.item>> in the email with
    <<biblio.title>> and uses CHECKOUT_NOTE instead of PATRON_NOTE.
    This patch also adds the notice to
    installer/data/mysql/en/mandatory/sample_notices.sql, and updates the
    PATRON_NOTE entry in installer/data/mysql/updatedatabase.pl
    
    To test:
    1) Apply patch and update database
    2) View the message_queue table in mysql
    3) Check out an item if haven't already
    4) Go to OPAC and set a checkout note for an item
    5) View message_queue table and confirm it the title is included in the
    email and all instances of 'patron note' have been replaced with
    'checkout note'
    6) Disable javascript in browser
    7) repeat steps 4 and 5 and confirm all works as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Marjorie Vila <marjorie.barry-vila@collecto.ca>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd7df9a7a3f4ec5b0c2356089b56c47165f87abb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 3 16:15:18 2018 -0300

    Bug 19911: Escape password value during self-registration confirmation
    
    The password must be correctly escape, it can contains html character
    and break the display.
    
    Test plan:
    Apply first patch and confirm that the display is broken
    Apply second patch (this one) and confirm that the display is fixed
    
    Signed-off-by: Arturo <alongoria@sll.texas.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 579507e7f728a070629649aad07e4e1c8fb7510a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 4 11:00:35 2018 -0300

    Bug 19911: Do not escape html characters when saving passwords
    
    When the password is not generated automatically, we should not escape
    the html characters. Otherwise it will be changed without any warnings.
    
    Signed-off-by: Arturo <alongoria@sll.texas.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 585453fe20417779be84258b60d3d652d8e170e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 16:36:31 2018 -0300

    Bug 19921: Fix update child when only one adult patron category exist
    
    We are passing the Koha::Patron::Category object to the template instead
    of the categorycode.
    
    To reproduce this bug you must test in a system which has only one
    patron category of the "adult" type. View the details of a patron with a
    child-type patron category and choose More -> Update child to adult
    patron.
    
    This results in an error:
    
    Can't call method "category_type" on an undefined value at
    /home/vagrant/kohaclone/members/update-child.pl line 84.
    
    The URL of the error page shows a problem with the parameters being
    passed:
    
    members/update-child.pl?op=update&borrowernumber=12345&catcode=Koha::Patron::Category=HASH(0xa168a18)&catcode_multi=
    
    Test plan:
    Make sure you have only 1 adult patron category
    Update a child to adult
    => With this patch applied the error is gone and the patron has been
    correctly updated
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 834b8c749b59600c62d16868d8e5104ba3e0795b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Nov 4 01:01:42 2017 +0000

    Bug 19580: Exclude period as splitting character for autotrunction
    
    To test:
    0 - Apply Unit test patch only
    1 - prove t/db_dependent/Koha_SearchEngine_Elasticsearch_Search.t
    2 - Should fail
    3 - Apply this patch
    4 - prove t/db_dependent/Koha_SearchEngine_Elasticsearch_Search.t
    5 - should pass
    6 - search for 'Local-number.raw:"4"' (or a vlid biblionumber)
    7 - should get expected result
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 574809f37b8e64f12f39cfcb544a792f3c398c37
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Nov 4 01:01:20 2017 +0000

    Bug 19580: Unit tests
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc30c8bc3f53287c0cb90f7bde1ce616bf9583d2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 10 13:31:49 2018 +0100

    Bug 18071: (QA follow-up) Rename commit to confirm parameter
    
    Trivial edit.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81eefc4e03413e097ec9c8a7625323aab7cc85fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 16:56:38 2018 -0300

    Bug 18071: Improve parameters handling
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fba7c05c6dbbabce055c2915ccc917bdd841a275
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 5 17:40:50 2018 +0000

    Bug 18071: (QA Followup) - Add additional feedback and expand commit option
    
    To test:
    Test as before, verify commit option makes no changes and provides
    additional feedback when verbose
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae48ff6729b4b36139ba53c6e49ee3c458186141
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 1 12:29:48 2017 +0100

    Bug 18071: (QA follow-up) Add commit parameter, add warning
    
    Addressing points mentioned in comment12:
    [1] Commit parameter.
    [2] Warning if authid does not exist for -merge.
    
    Test plan:
    [1] Run update_authorities.pl -authid X -merge -ref Y -c
        where X does not exist in your db and Y does.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ace03864ba716cf3a6a3df6f57a84bbf8bd06570
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Feb 7 13:59:33 2017 +0100

    Bug 18071: Add authorities maintenance script
    
    With bug 9988 the manual merge option of merge_authorities was removed.
    (Note that it did not work any more too.) This patch reintroduces this
    functionality on the command line.
    
    This maintenance script now allows you to force renumbering field 001 for
    selected authid's, to delete authid's including the removal of references
    in biblio records, as well as merging several authid's into one reference
    record.
    
    Test plan:
    [1] Test the -renumber parameter. Field 001 and 005 should be updated.
    [2] Test the -delete parameter. Check if a linked biblio does no longer
        contain a reference to the deleted authority.
    [3] Test the -merge parameter.
        Create two PERSO_NAME records (say A,B) and attach biblios to them.
        Pick a CORPO_NAME record as reference record C.
        Now pass -merge -reference C -authid A,B
        Verify that A and B are gone, and the records link to C now.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfed10325bc2de3b207606f6c87940ac3b67e303
Author: David Gustafsson <david.gustafsson@ub.gu.se>
Date:   Mon Oct 16 11:03:55 2017 +0200

    Bug 19471: Show creation date in patron restrictions list
    
    Test plan:
    1. Go to the "Details" vertical tab of a patron.
    2. Click the "Restriction" tab in the bottom and add a manual restriction.
    3. Verify a creation date is visible.
    
    4. Edit the same patron.
    5. Under "Patron restrictions" verify the creation date of the listed
       restiction is visible.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e04894b25d1bf9f2a3fdf8ffee00f965bdb07b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 17:20:42 2018 -0300

    Bug 16782: Use uri filter instead of html
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b785d509b1be70b3dfa07b052b4b3357649b2546
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 8 15:37:45 2018 +0000

    Bug 16782: (QA follow-up) Use Koha.Preference for staffClientBaseURL and provide classes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 156bcdaac41e4e9ca75877a15210956c86b9c0ab
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Thu Oct 19 16:23:43 2017 +1300

    Bug 16782: Disclose JSON URL for reports on the saved report page
    
    It has always annoyed me that you had to look at the help to divine the url for a report.
    This patch works it out and displays it for you in a new column on the saved reports table.
    
    Requirements:
    - OPACBaseURL and staffClientBaseURL preferences must be set for the urls to be complete. It's ok if they are not, but it's better if they are.
    - You must have a saved report that is public to your OPAC, and one that is not public.
    
    To test:
    - create a public saved report and a private staff report. They can be anything.
    - view the saved reports page, note that under a new heading of JSON URL the link to the json feed for that report shows.
    - copying and pasting that link into the address bar, or clicking it, should take you to the results of the selected report.
    
    sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Bug 16782 - missing </td>, fixed now
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0ed339ad5596e98101087505b72fb35a07b160b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 9 17:13:41 2018 -0300

    Bug 11046: Improve the readability of the regex using named capture
    
    The tests tell me I am good
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1e4acac3c7451044c28d02d05881040adee0592
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 28 13:14:08 2017 +0200

    Bug 11046: Add the form YYY-? for uncertain years
    
    This form occurred in Dutch ISBD rules.
    The question mark should follow the hyphen(s).
    
    Test plan:
    Run t/db_dependent/Biblio/TransformMarcToKoha.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    TransformMarcToKoha tests passed. Also this patch passed QA test tool
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 665fcd2777928c947ad3aff68b9f8a8bc97575ef
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 25 07:39:16 2017 +0200

    Bug 11046: Better handling of uncertain years for publicationyear
    
    This patch makes it possible that uncertain year like 18.. or 197x are
    converted to 1800 or 1970 in Koha field copyrightdate (MARC21) or
    publicationyear (UNIMARC). (The corresponding MARC record will not be
    changed obviously.)
    
    This change will allow for better results when sorting search results or
    list contents on copyrightdate. Currently, things like 18.. will sort
    together with zero.
    
    Note: The regex now allows four possible uncertain year markers: x or X,
    question mark or dot.
    
    Test plan:
    [1] Run t/db_dependent/Biblio/TransformMarcToKoha.t
    [2] Edit a biblio record. Save 18.. into 260c. Check biblio.copyrightdate.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Followed test plan, patch worked as described, it also passed QA test
    tool
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e606fdd1b0e12a59c39585b1c7f4d418afe9e1a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 24 19:11:28 2017 +0000

    Bug 18417: (follow-up) Document new shortcuts in dropdown
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1fd17efba8631f91fde33525b9de42f10c58a95a
Author: Jesse Weaver <pianohacker@gmail.com>
Date:   Tue Nov 10 12:02:06 2015 -0700

    Bug 18417: Advanced Editor (Rancor) add shortcuts for copyright symbols (C) (P)
    
    To test:
    1 - Apply patch
    2 - Open advanced cataloging editor
    3 - Try using Alt+P and Alt+C and note symbols are added
    4 - Save record and ensure symbols are saved
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09e330aa24e2015be72ad0f6412adcd64cf3499e
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Tue Feb 3 13:52:26 2015 +0200

    Bug 13660: Exclude export phase and use existing exported MARCXML - rebuild_zebra_sliced.sh
    
    When looking for a bad MARC Record using the rebuild_zebra_sliced.sh, it is
    useful to skip the complete MARCXML exporting from Koha and reuse the exported
    files for Zebra indexing.
    
    This patch adds a new parameter:
        -x | --exclude-export Do not export Biblios from Koha, but use the existing
                              export-dir
    
    Which depends on the:
         -d | --export-dir     Where rebuild_zebra.pl will export data
                               Default: $EXPORTDIR
    
     !---------!
    ! TEST PLAN !
     !---------!
    
    1. Run
         "./rebuild_zebra_sliced.sh --length 1000"
       to export 1000 MARC Records
       and slice them to one big 1000-Record chunk.
    2. Realize that you get an imaginary "stack smashing detected"-error crashing
       your indexing at some Record you dont know of and can't make out from the
       indexing logging.
    3. Start looking for the bad Record by running:
         "./rebuild_zebra_sliced.sh --exlude-export --chunk-size 10"
       To skip Biblios export from Koha which takes ~2h and get straight into
       splitting your exported biblios to chunks of 10, and indexing them. You
       know which chunk fails so it is much easier to find the issue there.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28dfd27a1ac54fdcf608fd971d6e84e1fe608ffd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 14:02:45 2018 -0300

    Bug 17833: Make sure this warning will not be ignored
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9ac9596483a198af79ee3ad987e9d0247eb75ee
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Mon Jan 2 13:01:02 2017 +0200

    Bug 17833: Add a warning if memcached init failed
    
    If memcached or the connection to it is misconfigured, show simple warnings to help
    identify the problem.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3647665f46fb89b3cb67cfde611f9e73c8037668
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 11:00:07 2018 -0300

    Bug 19280: refresh unblessed patron too
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8dc86bc4bde4b5744cd0bc954e1e5767250dde2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 8 12:51:28 2017 -0300

    Bug 19280: Pass a Koha::Patron to CanBookBeIssued
    
    We need to make subroutine from C4 use more Koha::Object objects
    Seeing bug 19276, starting here is a good start.
    
    Test plan:
    The tests should still pass.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67bf5baf1507fbb35080e15238c55dc8762edd9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 2 16:13:32 2017 -0300

    Bug 19568: Escape url params with url filter - opac-opensearch.tt
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9e5f3d3806e4866baeda4a3e29bf751e5066389
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 2 16:14:12 2017 -0300

    Bug 19569: Set X-Frame-Options=SAMEORIGIN - opac-showmarc.ok
    
    Before and after:
    wget 'http://catalogue.kohadev.org/cgi-bin/koha/opac-showmarc.pl?id=1&viewas=html'
    must be the same
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cff43a3d5fb8587dcd69ffd15ff65870b241788
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Nov 6 15:10:45 2017 +0000

    Bug 19570: Add autocomplete=off to opac-main as well
    
    To confirm all the files were modified for opac, typed
    this:
    $ git grep -i password | grep opac | grep -v "[.]po:" | grep
    "opac[^/]*[.]tt:" | cut -f1 -d: | sort -u
    
    The follow output was handled as follows:
        koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-auth.tt
        koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-memberentry.tt
        koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-passwd.tt
        koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-registration-confirmation.tt
    These were already done in the first patch.
    
        koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-password-recovery.tt
    This already had the autocomplete modification.
    
        koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-detail.tt
    This was a false-find. There was no modification necessary.
    
        koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-main.tt
    This is the modal login in. This patch amends it.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61452ce1f2726ea651008863d693bfcd9feac193
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 2 16:24:00 2017 -0300

    Bug 19570: Add autocomplete='off' for login forms at the opac
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ba4af723cf9b893934fcca8d7b94a384d6a1e1d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 8 14:57:15 2017 -0300

    Bug 19319: Only fetch the record if it exists
    
    We already know if the bibliographic record exists (404 redirect),
    we can avoid unecessary fetches
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecc6b8b61532afdfaed7436a76d32369b48ba306
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 8 09:46:02 2017 +0100

    Bug 19319: (QA follow-up) Biblionumber leftovers in opac-detail.tt
    
    Correcting a few biblionumber template var leftovers in opac-detail
    template. They were combined with url filter instead of html.
    
    Test plan:
    [1] Look for [^.;?]biblionumber in opac-detail.tt and verify that these
        occurrences are fine.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 950fc8e101886821879066b33e389a47fb0a9782
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Sep 14 11:52:08 2017 -0400

    Bug 19319: Reflected XSS Vulnerability in opac-MARCdetail.pl
    
    Try going to this URL on your site: /cgi-bin/koha/opac-MARCdetail.pl?biblionumber=2"><TEST>
    
    Test Plan:
    1) Go to /cgi-bin/koha/opac-MARCdetail.pl?biblionumber=2"><TEST>
    2) Note <TEST> is embedded all over the html
    3) Apply this patch
    4) Refresh the page, note the injection is gone!
    5) run koha qa test tools
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26864e9f6f129c16959f680b7fa08468a8ad652d
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Sun Nov 12 21:14:41 2017 +0530

    Bug 19611: Fix XSS Flaws in supplier.pl
    
    Test
    1. Hit the page /cgi-bin/koha/acqui/supplier.pl?op=enter
    2. Add a text in the field Name that contains java script
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0e063a85b654af623ea1da068d6fd23e8ec3833
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Nov 13 09:05:14 2017 +0530

    Bug 19612: Fix XSS in members/memberentry.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/members/memberentry.pl
    2. Add a text in the field address, address2, city, state, country,
       zipcode, B_streetnumber, B_city, B_country, B_zipcode that contains js
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload, the js is escaped
    
    Signed-off-by: Chris Cormack <chris@bigballofwax.co.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit feeab2b3a0f78a600560395326b4538104e25ff1
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Nov 13 09:27:44 2017 +0530

    Bug 19614: Fix XSS in members/pay.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/members/memberentry.pl
    2. Add a text in the field firstname, surname that contains js
    3. Save the page.
    4. click on fine tab
    5. Notice js is execute
    6. Apply patch and reload, the js is escaped
    
    Signed-off-by: Chris Cormack <chris@bigballofwax.co.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99797acd83116f0f182a55cc847adddd42b4f558
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 3 18:12:33 2018 -0300

    Bug 19913: Fix embedded HTML5 videos at the OPAC
    
    Caused by
    commit 752aef4593f1aa2d64700bf9738e7e03907eb1cd
    Bug 18754: Translatability: Get rid of exposed tt directives in opac-detail.tt
    
    A space is missing between 'source' and 'src'
    
    Test plan:
    Set  HTML5MediaEnabled  to OPAC
    Put a video link to 856$u
    See the OPAC detail page, tab video, click the video
    => Should play with this patch applied
    
    Note that this does not affect intranet
    
    Signed-off-by: George Williams <george@nekls.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b2e3631e313d0e5a30ad751cccba90215b3a645
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 4 10:27:57 2018 -0300

    Bug 19914: Add an id to the Delete button on the library list view
    
    To ease selenium tests, see bug 19243.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aceb2eead58b9341854d035b10e8652637c7e9d1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 11:42:03 2018 -0300

    Bug 19899: Restore Item floats feature - do not crash
    
    Error is "The method noreturn is not covered by tests!"
    caused by commit 6eade474ed3a84a5ba372a26ac27bf9fb4bd2299
    Bug 18276: Remove GetBiblioFromItemNumber - Easy ones
    
    When the "Return policy" (var returnbranch) is set to "Item floats" (value noreturn)
    the library must be the current library (from userenv).
    This behaviour is used in C4::Circulation::AddReturn
    
    On bug 18276 I assumed that the value was either holdingbranch or
    homebranch, and forgot it could be "noreturn"
    
    Test plan:
    Set Return policy to Item floats
    Check an item in
    => without this patch it explodes
    => With this patch applied it will check the item in
    
    Signed-off-by: Mohd Hafiz Yusoff <mhby87@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94cd27677d8febd2979f9f618f1e8cd1bd2d68d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 5 11:09:09 2018 -0300

    Bug 19918: Close span tag in opac-registration-confirmation.tt
    
    Introduced by:
    commit 06f4950aa21ff889cff81f27b2f4e79788db193f
    Bug 13599 - Add patron cardnumber to self registration confirmation
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 886b197b2d8c556fad5bea46ceefe7db82b44883
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Wed Dec 13 20:16:54 2017 +0100

    Bug 19807: Make IntranetCatalogSearchPulldown honor IntranetNumbersPreferPhrase
    
    This patch
    - fixes callnum and sn
    - Removes unecessary syspref transmission to the template.
      As the template directly reads the syspref
    
    Test plan:
    1. Set sysprefs IntranetCatalogSearchPulldown and
       IntranetNumbersPreferPhrase to true
    2. Go to staff:/cgi-bin/koha/catalogue/search.pl
    3. "search for" → "call number" and write anything that won't match a
       call number in the field
    4. Then you should see
       «No results match your search for 'callnum,phr: [...]»
    5. Go to the staff homepage
    6. Click on "Search the catalog"
    7. Do the same search as previouly
    8. Then you should see
       «No results match your search for 'callnum,wrdl: [...]»
       This shows that IntranetNumbersPreferPhrase isn't honored
    9. Apply this patch
    10. Redo the same two searches and see that phr will now be always used.
        So IntranetNumbersPreferPhrase is honored
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c70270b3aa52f2956efbf62013905af4c632d732
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 4 20:22:13 2017 -0300

    Bug 15378: Allow removal of lost items from course reserves
    
    It seems that this restriction is not necessary, it should be possible
    to remove lost items from course reserves.
    
    Test plan:
    Create a course and add reserve with a lost item
    
    => Without this patch the "Remove" button is disabled and the item
    cannot be removed from the course
    => With this patch applied the button is enable and the item can be
    removed
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5baf823935848a43bdcd7ed63449084075f54d47
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Feb 28 14:26:22 2017 +0100

    Bug 18183: jQuery append error related to script tags in cloneItemBlock
    
    See the detailed explanation of the error on Bugzilla.
    As a workaround, we move the append of clone to outeritemblock before the
    append of data (long string with item fields and script tags) to clone.
    
    This patch also moves two vars inside the success function, since they are
    not used outside of it.
    
    Test plan:
    [1] Set AcqCreateItem to receiving.
    [2] Receive an order. Verify that adding, updating or deleting an item block
        still works as expected.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78462ff16faef5d7f24181c79cc53d10db29d75e
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Jan 2 08:44:39 2018 +0000

    Bug 19304: (QA follow-up) Fix number of tests in Members.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a5534fcf5c945e744a86422eb03251b40ea5894
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 15:41:56 2017 -0300

    Bug 19304: Move C4::Members::GetNoticeEmailAddress to Koha::Patron->notice_email_address
    
    This subroutine is quite trivial and can be replaced easily with a new
    method of Koha::Patron
    
    Test plan:
    Overdue notices and shelf sharing must be send the to an email address,
    according to the value of the pref AutoEmailPrimaryAddress
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9782fa1846575bba8a53e934a16ca94a55bea8b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 15:28:07 2017 -0300

    Bug 19303: Move C4::Members::GetFirstValidEmailAddress to Koha::Patron->first_valid_email_address
    
    This new Koha::Patron->first_valid_email_address already exists, it
    should be called directly
    
    Test plan:
    - With a logged in user who have an email address defined, send a basket.
    The email should be marked sent by this email address
    
    - On the "Holds awaiting pickup", the email address must be displayed as well
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19e5eeb8e5580dbcf7c344adf5798b63ea720a88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 11 14:16:07 2017 -0300

    Bug 19300: Replace C4::Reserves::OPACItemHoldsAllowed - Remove the subroutine
    
    At this point the subroutine is not longer in use, we can remove it
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c78746d40d584be2a74dc666b39acfa451728803
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 11 14:15:41 2017 -0300

    Bug 19300: Replace C4::Reserves::OPACItemHoldsAllowed
    
    This patchset move The OPACItemHoldsAllowed logic
    (issuingrules.opacitemholds) to a new class method of
    Koha::IssuingRules: get_opacitemholds_policy
    
    On the way, this patch will certainly fix the same problem as bug
    19298 with onshelfholds.
    
    Test plan:
    Make sure the opacitemholds policy is correct when placing a hold at the
    OPAC or the staff interface.
    
    Followed test plan which worked as described
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44ba06bdb163ae70db53f7f7747735fb7c8f6ea9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 11 13:59:11 2017 -0300

    Bug 19300: Replace C4::Reserves::OPACItemHoldsAllowed - tests
    
    This patch proves that we will not introduce trivial regression.
    With the same tests, we will execute the existing code and the new code.
    
    Test plan:
    With only this patch applied, prove t/db_dependent/Koha/IssuingRules.t
    should return green
    
    Followed test plan, patches worked as described
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91990b04b9f79b130996053c0f4f9a9479338e3c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 15:51:42 2017 -0300

    Bug 19798: Fix print transfer slip
    
    ... and maybe other bugs as well
    What happens here is that $itemnumber is no longer set when barcode is
    passed.
    
    Test plan:
    1. Check in available/not on hold item at a non owning library.
    2. Click print slip
    3. Item's info must be displayed on the slip
    
    Signed-off-by: Björn Nylén <bjorn.nylen@ub.lu.se>
    Signed-off-by: Björn Nylén <bjorn.nylen@ub.lu.se>
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0853b50f016107d48b33a8e6a0fa5ff6b1006fa7
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Dec 22 11:38:32 2017 +0000

    Bug 19603: (QA follow-up) Remove unused message
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e678098109187e8d76d8567396f622886904fffc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 9 14:30:26 2017 +0000

    Bug 19603: Move admin templates JavaScript to the footer: Patrons and circulation
    
    This patch modifies the staff client patrons and circulation-related
    administration templates so that JavaScript is included in the footer
    instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    tabs, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Edit: Rebased
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f7bc759852badba028a9eb398e236ad6d27acf2
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Tue Sep 19 15:29:22 2017 +1200

    Bug 19338: Fix sorting by dates in opac-account.tt
    
    To test:
    Find an account with lots of fines/payments
    load up the borrower's account in the OPAC
    note that the sort on the dates sorts by day, and not by date.
    apply this patch
    reload the page, note that the sort on the dates is now correct.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d777c044be6af4e369bd3d5b72ca4ab607608196
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 20 19:48:13 2017 +0000

    Bug 19860: Make staff client home page responsive
    
    This patch rewrites the markup of the staff client home page to use the
    Bootstrap grid instead of the YUI grid, taking advantage of Bootstrap's
    built-in responsiveness.
    
    This patch does not affect the logo and search form in the header. It
    will be necessary to address search forms in another patch.
    
    To test, apply the patch and clear your browser cache if necessary. For
    better results, apply the patch for Bug 19851 as well.
    
    - View the staff client home page and test the layout at various browser
      widths.
    - Test with and without news items
    - Test with and without content in IntranetmainUserblock
    
    Signed-off-by: Dominic Pichette <dominic.pichette@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01e66ec78f07b3c0ed3ffeeeae672634f65f97ea
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 20 17:09:30 2017 +0000

    Bug 19851: Improve responsive layout handling of staff client menu bar
    
    This patch modifies CSS and markup in the staff client header to
    override the default responsive style of the menu bar. The changed
    layout will keep the menu bar items in a horizontal line at lower screen
    widths.
    
    To test, apply the patch and clear your browser cache if necessary.
    
     - Log in to the staff client and confirm that the appearance of the
       menu bar at the top of the screen looks correct at various browser
       widths.
     - Confirm that the logged-in user menu label and help link expand and
       collapse according to browser width.
    
    Signed-off-by: Dominic Pichette <dominic.pichette@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14e2185f9408f89d14ee5b8fabf7cc2abdd632f8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 20 16:19:18 2017 -0300

    Bug 19841: Make AddMember raise an exception if categorycode is invalid
    
    This patch makes C4::Members::AddMember raise a Koha::Exceptions::BadParameter
    exception. The current behaviour is to just explode. Code calling
    AddReturn should work as expected, unless they are looking for a
    specific failure message.
    
    It is just explodes in a way we know what happened, in the case the
    categorycode is invalid.
    
    To test:
    - Apply the Unit tests patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/Members.t
    => FAIL: Tests fail because AddReturn doesn't raise an exception
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/Members.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Dominic Pichette <dominic.pichette@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfe025688355eb714c24bd608726bc61f3224cbd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 20 16:19:07 2017 -0300

    Bug 19841: Unit tests
    
    This patch introduces unit tests for the new behaviour of AddMember
    (raising an exception if the passed categorycode is not valid.
    
     To test:
     - Apply this patch
     - Run:
       $ kshell
      k$ prove t/db_dependent/Members.t
    => FAIL: It should fail because the feature is still not implemented.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 759a86efd10f75cb4b038046957e28f2906b8dd5
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Dec 22 08:02:10 2017 +0000

    Bug 19623: (QA follow-up) Add missing footerjs variable in merge.tt
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b8d085375bbfeec0e5f57451bd6249013dea6ea
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 22 13:37:58 2017 +0000

    Bug 19623: (follow-up) Correct footer include in pop-up windows
    
    This patch corrects the footer include in two templates for Z39.50
    pop-up windows. popup-bottom.inc shouldn't be used because it doesn't
    have the JavaScript embed code in it.
    
    To test, perform a Z39.50 search from both the MARC bibliographic editor
    and the MARC authority editor. In both cases the Z39.50 popup window
    should work correctly.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9839e84950f84a73da8bdff9d038b956dc04198
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 14 17:53:24 2017 +0000

    Bug 19623: Move template JavaScript to the footer: Cataloging
    
    This patch modifies some staff client cataloging templates so that
    JavaScript is included in the footer instead of the header.
    
    Several cataloging templates are excluded because they require
    significant structural changes: addbiblio.tt, additem.tt, and editor.tt
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    Note that z350_auth_search.tt is tested by performing a Z39.50 search
    from the Authorities module.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29f56fd5a0fe35927ca97f43e459d3ec5b2d24f4
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Dec 21 21:16:59 2017 +0000

    Bug 19608: (QA follow-up) Fix menu item styling for clone-rules
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8669dc1548b1425fa54ca49ef1a64ff28932ffbd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 14 13:11:10 2017 +0000

    Bug 19608: (QA follow-up) Fix redirect on localization modal
    
    This patch makes two minor corrections:
    
    1. The item types localization modal redirect problem has been fixed by
       excluding the anti-clickjack code from executing in the footer.
    2. The sidebar menu highlighting script has been modified to correctly
       handle the clone-rules page.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a4e76876bffbeac5d147255c70d698c539d98ee
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 14 16:13:56 2017 +0000

    Bug 19608: Move admin templates JavaScript to the footer: The rest
    
    This patch modifies the staff client administration templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    To test the changes to localization.tt you must have more than one
    translation installed. Go to admin/itemtypes.pl, edit an itemtype, and
    click the 'Translate into other languages' link.
    
    To test the changes to sur_modmapping.tt, go to admin/z3950servers.pl
    and create a new SRU server. Click the 'Modify' button next to 'SRU
    Search fields mapping'
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aeb3a88224782944e46f9c56e99a5ff375cf77b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 26 12:33:39 2017 -0300

    Bug 19826: Add tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e541af7543d2169e2f926b5b2a8189f5e49c97f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 18 11:25:00 2017 -0300

    Bug 19826: Add K::Acq::Budget(s) and K::Acq::Fund(s)
    
    This patch introduces Koha::Object(s)-derived classes for budgets and funds (aqbudgetperiods and aqbudgets respectively).
    
    C4::Budgets already uses DBIC calls on those tables so transition should be easy on top of this.
    
    To test:
    - Check the referenced schema files are the right ones.
    - QA scripts shoudl be happy.
    - Sign off :-D
    
    Note: the POD coverage report throws a false negative result on singular classes which is trivially wrong.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8592be20367790582c7235988ceafc5350a036b3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 22 14:04:52 2017 -0300

    Bug 19760: Fix Config.t test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6dd0ff217460375bb01e192f642c592912c6fcbb
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Dec 21 18:12:38 2017 +0000

    Bug 19753: (QA follow-up) Style invoices menu item when on individual invoice page
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a132440766277d6d94246a86ec671b79de7a442
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Dec 5 14:20:11 2017 +0000

    Bug 19753: Move template JavaScript to the footer: Acquisitions
    
    This patch modifies some staff client acquisitions templates so that
    JavaScript is included in the footer instead of the header.
    
    This patch adds a JavaScript file, acquisitions-menu.js, which controls
    the highlighting of the current page in the sidebar. Highlighting will
    be temporarily broken for pages which have not been modified to include
    this file
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    - Acquisitions home page
      - Datatable, Inactive budget controls
    - Vendor search results
      - Acquisitions -> Vendor search
        - Datatables, "Show all" links
    - Basket
      - Acquisitions -> Vendor -> Basket
        - Datatables, button controls, add managing user
    - Add to basket from a staged file
      - Acquisitions -> Vendor -> Basket -> Add to basket from a staged file
        - Datatables, tabs, selection controls
    - Edit basket
      - Acquisitions -> Vendor -> Edit basket
        - Form validation
    - EDIFACT messages
      - Acquisitions -> EDIFACT messages
        - Datatables, message preview
    - Orders search
      - Acquisitions -> Order search
        - Full orders search form
          - Patron autocomplete in "Basket created by" field
          - Datepickers
        - Orders search results
          - Datatables, column visibility
    - Invoices
      - Acquisitions -> Vendor -> Invoices -> Invoice
        - Form validation, datepickers, datatables
      - Invoice files (enable AcqEnableFiles preference)
        - Manage invoice files
          - File list datatable
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8425ab43dde41f30d73cbcd4a781f260fcffea44
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 1 15:44:59 2017 +0000

    Bug 19744: Move template JavaScript to the footer: Offline circulation
    
    This patch modifies the staff client offline circulation templates so
    that JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    Circulation -> Built-in offline circulation interface
      -> Synchronize
       -> Download records
      -> Check out
      -> Check in
        -> Synchronize
          -> Upload transactions
      -> Pending offline circulations
        -> Check all, uncheck all
        -> Delete
        -> Process
    
    Circulation -> Upload offline circulation data
      -> Upload .koc file (gerated by the Koha Offline Circulation program,
         for instance).
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a523f09e043fa7d6a17fc93406f966cab5671583
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 25 12:25:32 2017 -0300

    Bug 17951: (follow-up) Make Makefile.PL handle template_cache_dir config
    
    This patch adds Makefile.PL the capability of handling the template_cache_dir configuration entry.
    To do so, it:
    - Adds the --template-cache-dir option switch (consistency with koha-create)
    - Sets a default value for template_cache_dir to '/tmp/koha'
    - Adds a dialog requesting the path for the template cache dir to Makefile.PL
    - It tweaks etc/koha-conf.xml so it is correctly changed by rewrite-config.PL
    
    To test:
    - Apply this patch
    - Run:
      $ perl Makefile.PL --template-cache-dir your/favourite/dir
    => SUCCESS: The dialogs don't ask for template cache dir
    => SUCCESS: The resulting Makefile contains an entry for TEMPLATE_CACHE_DIR which value
                matches what we passed to --template-cache-dir
    - Run:
      $ perl Makefile.PL
    - When prompted for a template cache dir, introduce whatever you want
    => SUCCESS: The default you are offered is /tmp/koha
    => SUCCESS: At the end of the process, Makefile contains what we put in there
    - Run:
      $ sudo make install
    => SUCCESS: The resulting koha-conf.xml contains a <template_cache_dir> entry containing
                whatever you picked for that purpose.
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06a1f18a1b7c0b34d0519084d17fd52a7f32bec4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jan 24 12:48:18 2017 -0300

    Bug 17951: Make koha-create set template_cache_dir correctly
    
    This patch makes koha-create (and friends) handle the template_cache_dir
    config entry correctly.
    
    It does so by:
    - Adding a replaceable string to the template for koha-conf.xml
    - Making koha-create-dirs create the needed directories (i.e.
     /var/cache/koha/instance and /var/cache/koha/instance/templates)
    - Adding a --template-cache-dir switch to koha-create (so sysadmins can
      specify their favourite directory for the templates cache).
    - koha-remove now takes care of the instance's *templates* dir.
    - The install scripts now automatically create /var/cache/koha so it can
      be used later by koha-create and friends. It does so the same way it does
      for other install-created directories.
    
    To test, you should ideally be able to build your own packages. This
    instructions can be followed by people that doesn't have that ability
    yet. But can be used on a custom packages setup too.
    
    To test:
    - Make sure you have the latest misc4dev in your kohadevbox (if it is a
      fresh box you have it already)
    - Run:
      $ sudo perl misc4dev/cp_debian_files.pl
    - Manually create the /var/cache/koha dir (skip if you have your own
            packages):
      $ sudo mkdir /var/cache/koha
    - Create a new instance:
      $ sudo koha-create --create-db cachetest
    => SUCCESS:
        * /etc/koha/sites/cachetest/koha-conf.xml contains
        template_cache_dir and is populated with /var/cache/koha/cachetest/templates
        * The directory /var/cache/koha/cachetest/templates exists!
    - Create a new instance, pass your own cache dir:
      $ sudo koha-create --create-db --template-cache-dir /tmp cachetest2
    => SUCCESS: etc/koha/sites/cachetest2/koha-conf.xml contains template_cache_dir
       and is populated with /tmp
    - Run:
      $ man koha-create
    => SUCCESS: The docs mention the --template-cache-dir option switch
        correctly.
    - Sign off :-D!
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a2767b577abd38bf63a2f815339eed3b93ecba7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 20 12:19:49 2016 -0400

    Bug 16764: Update printers administration page
    
    This patch updates the template for printers administration according to
    current interface guidelines.
    
    - Custom JavaScript form validation is removed in favor of the built-in
      form validation plugin.
    - Printer-specific header search form is removed, along with server-side
      pagination code. The functionality of both is now taken care of the
      adding DataTables sorting and pagination to the table.
    - Edit and delete links are styled as Boostrap buttons with Font Awesome
      icons.
    - Confirmation dialogs are updated to use Font Awesome icons.
    
    To test properly you will need to add multiple printers.
    
    - Apply the patch and open /cgi-bin/koha/admin/printers.pl (there is no
      menu link for the page).
    - When no printers exist you should see a message dialog saying so.
    - Add a new printer. Confirm that printer name and queue are required
      fields.
    - After adding multiple printers, confirm that the table of printers is
      correctly sorted and searched by the DataTables plugin.
    - Delete a printer and verify that the confirmation dialog is correctly
      styled.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Update: rebased and updated Bootstrap 3 classes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec2ca4eecf7c720356b0de8f46ad0affbe5004f5
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Thu Dec 21 13:56:34 2017 +0200

    Bug 19857: Use BorrowerUnwantedField system preference for SMS provider selection
    
    Optionally hide SMS provider field in patron modification screen with
    BorrowerUnwantedField system preference.
    
    To test:
    1. Apply patch
    2. Append BorrowerUnwantedField with sms_provider_id and save changes
    3. Go to patron modification screen in staff client
    4. Observe the SMS provider selection is now hidden
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 786086cfcfd57509b9ff9f5ab8d3ff24ad3d1ecc
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Dec 22 07:43:39 2017 +0000

    Bug 19828: (QA follow-up) Fix rethrowing exception and move rethrowing out of 'if' statement just in case the exception does not came from DBIx::Class
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fc594bcb4b9e3fb1fd56f0bdb350bde5c84c73e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 20 15:33:48 2017 -0300

    Bug 19828: Fix tests that expect DBD errors instead of the exception message
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84a8f09ec2b4288092f6035555fa91b400a015ef
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 18 13:48:56 2017 -0300

    Bug 19828: Make Koha::Object->store translate DBIC exceptions into Koha exceptions
    
    This patch introduces a try/catch block in store() and parses the error
    when an exceptional situation takes place.
    
    It only deals with FK constraint violations and duplicate IDs. The rest of the DBIC exceptions
    are rethrown.
    
    To test:
    
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/Koha/Object.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 122f5441323cb257fd0aaa171e2f00c7dfbcf189
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 18 13:47:53 2017 -0300

    Bug 19828: Unit tests
    
    This patch introduces unit tests for the changes this bug introduces to
    Koha::Object->store.
    
    To test:
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/Koha/Object.t
    => FAIL: Tests should fail because the changes are not implemented on this patch
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f98b47cf3ae666318c815f319289586bfc5717a4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 22 08:23:23 2017 +0100

    Bug 19494: (QA follow-up) Rename column and apply title-string
    
    As requested by Katrin, the column should not refer to Reserve but Hold.
    Sorting should be the same as Waiting since-column.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e111e4415d41d557984630b5a9bfbdfd9ba0df19
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 4 10:05:20 2016 +0200

    Bug 19494: Add reservedate to Holds awaiting pickup
    
    Add reservedate to report.
    Change label "Available since" to "Waiting since".
    
    Note: The table (already) crosses the boundaries of its container. Also
    the vertical spacing for the first column (already) is not the same as the
    others. (Adding the second date only makes it more visible.) These minor
    design issues should be solved on another report.
    
    Test plan:
    [1] Go to Circulation, Holds awaiting pickup
    [2] Note the additional column for reservedate.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4da034dd3074e589c2c963fd5df7600b3b8f996
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 11:56:07 2017 -0300

    Bug 19788: Add a test
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46f4f7d6c2857644e3c2d2b0c152007037fb0409
Author: Frédéric Demians <f.demians@tamil.fr>
Date:   Mon Dec 11 08:41:05 2017 +0100

    Bug 19788: Preserve case sensitivity when creating Local preferences
    
    Fix a bug tranforming new local preference variable name in lowercase.
    
    TO TEST:
    
    1. Admin > System preferences > Local use
    2. Button New preference. Fill variable field with 'TESTfoo'. Click
       Save.
    3. The new variable is named: 'testfoo'.
    4. Apply the patch.
    5. Button New preference. Fill variable field with 'TESTfoo2'. Click
       Save.
    6. The new variable is properly named: 'TESTfoo2'.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 103fe109b22b48d506848a0a1bc43556c9dfda4b
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Mon Nov 27 16:05:48 2017 -0500

    Bug 19702: Correct cookie path in Basket.js
    
    This corrects the cookie path in bootstrap/js/basket.js. It used to take
    the default value (current page path), but will now be "/"
    
    Test plan:
    0) Visit the OPAC, add a book to your basket
    1) Navigate to the OPAC's homepage (www.domain.com, without the
        /cgi-bin/koha)
        -> The basket will display as empty
        2) Apply patch
        3) Clear your cookies and your cache
        4) Redo step 1)
            -> Basket will display correctly
    
    Patch applies without issue and functions as descibed.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69c8e07ca0697bd3d5beefbd7dfd84f6bb0ead88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 15:45:53 2017 -0300

    Bug 19840: And avoid XSS...
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62a8f49848b4b8b450e3c643ed6014a0cfbe420c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 15:40:45 2017 -0300

    Bug 19840: Fix - display patron note on checkin
    
    If a patron let a note on the checkout (AllowCheckoutNotes), it is
    supposed to be displayed when checked in.
    
    Test plan:
    1/ Enable AllowCheckoutNotes
    2/ Check an item out
    3/ At the opac let a note on the checkout
    4/ Check the item in
       => With this patch applied you should see the notes displayed
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96a42b873aa0cd183fae31bb25292b975ebdd589
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 13 17:18:44 2017 +0000

    Bug 19621: Use Koha.Preference on template side to display/hide "Routing lists" tab
    
    Patch applies without issue and functions as described.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70bb6fe0ae5eae74e86c765480fd188ec2da0f61
Author: Janusz Kaczmarek <januszop@gmail.com>
Date:   Sat Nov 25 02:28:02 2017 +0100

    Bug 18458: Fix subfields ordering when Merging authority records
    
    While doing a merge, if a subfield(s) precedes the controlled subfields
    (like $i before $a in 7XX, which comes before $a -- rare but will
    become more and more usual) after merging will be moved to the end.
    This is not right.
    
    The patch (with AuthorityMergeMode == loose) make merge consider the
    subfields order: all subfields which originally were found before
    the first controlled subfield (e.g. $i before $a in 7XX / MARC 21)
    will remain in the front, the rest of not controlled subfields that
    should remain in the field will come after the subfields copied
    from authority rec.
    
    As a bonus, $9 will be placed at the end.
    
    To test:
    0) Have AuthorityMergeMode == loose;
    1) Have some field in bibliorecord, controlled by an authority, with
    extra subfield(s) (i.e. not present in authority rec.) placed at the
    beginning of the field;
    2) Open (not necessarily edit) and save the connected authority;
    3) See that the extra subfieds were moved to the end of the field
       (and $9 is in the front);
    4) Apply the patch;
    5) Reorder subfields in biblio field;
    6) Open (not necessarily edit) and save the connected authority;
    7) See that the order has been conserved, additionally $9 the last
       subfield in the field.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended:
    Moved field creation to its original place. Changed $9 handling. Simplified the following add_subfields for loop. Edited comments.
    Restored the append_fields_ordered call (see comment6).
    
    With this patch, the Merge.t test now passes.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c728506815ab22df06dd81c346762ee6bb0a2fa3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 8 13:45:55 2017 +0100

    Bug 18458: Add a subtest in Merge.t
    
    This test illustrates the problem we have if you run it without the
    second patch. And it serves to demonstrate that we resolved the
    situation if you run it after the second patch.
    
    Test plan:
    [1] Without the second patch: The last subtest should fail.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit edcf4af0953f89573b760529303c388e2ae818b4
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 14 10:31:17 2017 -0500

    Bug 19813: Make MarcItemFieldsToOrder handle non-existing tags
    
    MarcItemFieldsToOrder defines how Koha looks at tags in order records to generate item data.
    
    Let's look at a simplified case:
    homebranch: 955$a
    holdingbranch: 956$a
    
    So, here we are looking at 955 for the home branch, and 956 for the holding branch. So, it should make sense that Koha requires that these fields exist in equal number in the record. That is, for each 955, there should be a corresponding 956.
    
    Let's look at a different case:
    homebranch: 946$a|975$a
    holdingbranch: 946$a|975$a
    
    In this case, we are using the fallback behavior. VendorA stores the branch data in 946, and VendorB stores it in 975. This seems like it would work, but it won't! That's because Koha is expecting there to be the same number of 946's as there are 975's! In reality, the VendorA records will have a number of 946's, and *zero* 975's. The inverse will be true for VendorB.
    
    Koha should be able to skip those tags that simply don't exist in the record.
    
    Test Plan:
    1) Set MarcItemFieldsToOrder to something like:
    homebranch: 946$a|975$a
    holdingbranch: 946$a|975$a
    budget_code: 946$f|975$f
    itype: 946$y|975$y
    notforloan: 946$l|975$l
    ccode: 946$t|975$c
    quantity: 946$q|975$q
    price: 946$p|975$p
    itemcallnumber: 946$n|975$n
    loc: 946$c|975$t
    2) Create a record using only the 975 tag for item building data
    3) Import the record into Koha
    4) Create a basket
    5) Attempt to add the record to the basket
    6) Note the unequal fields error
    7) Apply this patch
    8) Reload the page
    9) No error!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Marci Chen <mchen@mckinneytexas.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Fix typo occurrance and theses.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e21ffe6c5e09ad1f5a1023e32be88f5a43a9d68
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 22 11:20:13 2017 +0100

    Bug 19200: (QA follow-up) Simplify call to GetBasketAsCSV
    
    If no profile_id is passed, GetBasketAsCSV will fallback to default itself.
    No need to make the distinction in basket.pl.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 809175f3d4b0293e934e56654994797f38330e08
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Aug 29 21:07:39 2017 +0000

    Bug 19200: Preventing warns when exporting a basket
    
    To test:
    1) Go to Tools -> CSV profiles -> New CSV Profile
    2) Create a new CSV profile with any name of SQL fields. Ensure profile
    type: SQL and usage: basket export in acquisition
    3) Go to Acquisitions -> Find or create a vendor -> Use or create a
    basket
    4) Click the dropdown menu next to the 'Export as CSV' button. There
    should be a 'Default' option and your new CSV profile (at least)
    5) Click the 'Default' option. Notice warns
    6) Click the 'Export as CSV' button. Notice warns
    7) Click your new CSV profile option. Notice warns
    8) Apply patch and refresh page
    9) Repeat steps 5-7, confirm that warns do not show
    10) Confirm export still works as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 252c7c06b30a0f42aa523752e6e3aef02f16af41
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 6 13:58:04 2017 -0300

    Bug 19760: Die if koha-conf is not accessible
    
    We got a lot of support questions because scripts are executed without
    the correct environment/user.
    We could die and provide more useful information
    
    Tested on my kohadevbox VM by:
    
    1) sudo chmod a-rx /etc/koha/sites/kohadev/koha-conf.xml
    2) run help.pl from the command line to produce the desired die message
    3) sudo chmod a+rx /etc/koha/sites/kohadev/koha-conf.xml
    4) rerun help.pl successfully
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 19760: Change wording
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e465e3608cbc4422b695aaef2da26592706d82f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 14:45:51 2017 -0300

    Bug 19867: Prevent HouseboundRoles.t to fail randomly
    
    Here is just a guess but we need to tell TestBuilder the values of
    housebound_deliverer and housebound_chooser to make sure it will not be
    1
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    I manually tested setting to the opposite values in the tests, and
    verified those values made the tests fail due to count problems.
    The fix is valid.

commit b4d3b25bc21adfc768d18756b0973ddf37d69efa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 12:42:03 2017 -0300

    Bug 19429: Rename .delete to .delete_invoice
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ec74621ca2f105c33b85645d6855918efbc28a7
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Oct 3 02:47:40 2017 +0000

    Bug 19401: Add confirm message when deleting invoice
    
    To test:
    1) Go to Acquisitions
    2) Go to Invoices (left nav menu)
    3) Click Search (no need to filter results)
    4) Click dropdown menu for an invoice, click Details
    5) Click Delete
    6) Notice invoice is deleted instantly
    7) Apply patch and repeat steps 4 and 5
    8) Confirm the confirm message shows and works as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 367f6ef536fd67288eca8a0897499badf292be34
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Oct 10 02:17:36 2017 +0000

    Bug 19429: Add confirm message when deleting invoice from invoice search page
    
    To test:
    To test:
    1) Go to Acquisitions
    2) Go to Invoices (left nav menu)
    3) Click Search (no need to filter results)
    4) Click dropdown menu for an invoice, click Delete
    5) Notice invoice is deleted instantly
    6) Apply patch and repeat steps 3 and 4
    7) Confirm the confirm message shows and works as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 730e1273801057781ea4577844bb80ab1b5c117c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 12:37:38 2017 -0300

    Bug 18201: Tidy tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df7fbba8284349e404acf484e029093f0c6cb73f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 18:59:39 2017 -0300

    Bug 19756: Fix encoding issues during the update DB process
    
    To display the output of the updatedatabase.pl under Plack, we redirect
    the output to a temporary file, read it, then display it.
    We need to open it specifying the correct encoding (utf-8).
    
    Test plan:
    1. MariaDB [koha_kohadev]> update systempreferences set value="17.1100000"
    where variable="version";
    2. restart plack
    3. Login
    4. Make the update from the interface
    => Without this patch you will see encoding issue:
    Upgrade to 17.12.00.000 done (TÄ tÅia, tÄ haumatia)
    => With this patch applied you will see :
    Upgrade to 17.12.00.000 done (Tē tōia, tē haumatia)
    
    Signed-off-by: Liz Rea <liz@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebc1583f09e2c6cae9fe48f4476bc3ba4fd725fd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 9 15:54:12 2017 +0000

    Bug 19573: Link to make a new list in masthead in OPAC only appears / works if no other list already exists
    
    This patch corrects the OPAC masthead include file so that the "New
    list" link will appear whether or not the logged-in user has existing
    private lists.
    
    To test, apply the patch and log into the OPAC as both a user with
    private lists and a user without private lists. The header's "Lists"
    dropdown menu should include a "New list" link in both cases.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b98a82572ae5667309c1d33c5994b2d42f36081
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 12:57:11 2017 -0300

    Bug 11976: Fix sorting issues
    
    The last column must be sortable, and dates must use title-string
    I removed the class on the th (did not seem useful as we have an id
    already)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1ea09f851626784d1c7b33c65ea3b78d6656556
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Oct 26 11:41:34 2017 -0400

    Bug 11976: Add Publication date to subscription table (opac) + column settings
    
    This patch adds the column settings feature to the subscription list at
    the OPAC.
    It also adds a new column (Publication date) to this table
    
    Using Home->Administration->Column Settings->OPAC->subscriptionst
    the fields visibility can be toggled.
    
    TEST PLAN
    ---------
    1) Have a subscription where you have received at least once.
    2) Look for it in OPAC and note the date is the received date, not the publication date
    3) Apply patch
    4) Log in to staff client
    5) Home->Administration->Column Settings->OPAC->subscriptionst
    6) Set visibility as desired.
    7) Refresh OPAC page
       -- everything should be as expected.
    8) run koha qa test tools.
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 136c49a940a632e9bcfb50694871b1a9ba2480c1
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 1 15:21:56 2017 +0000

    Bug 19725: OAI-PMH - Use biblio_metadata.timestamp
    
    Since bug 17196, biblioitems.timestamp is not always updated after a
    change in the MARC record.
    Filtering should be based on biblio_metadata.timestamp instead.
    
    Test plan:
    1. prove t/db_dependent/OAI/Server.t
    2. Verify that it SUCCEEDS
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c867cadeef6a324d1861514f3f21979881d04e18
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 1 15:18:04 2017 +0000

    Bug 19725: Add failing test
    
    Also fix tests for UNIMARC
    
    Test plan:
    1. prove t/db_dependent/OAI/Server.t
    2. Verify that it FAILS
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9aa724cdf29a57bc91e42b240b5bcd19e3814ada
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 10:34:08 2017 -0300

    Bug 19599: Speed anonymise_issue_history up
    
    The query generated by anonymise_issue_history is unecessary complex and
    can be very slow on large DB.
    With this patch we will execute one query per patron instead.
    
    See patch "Bug 19599: Simplify the query" on the bug report for an
    alternative.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf57457d34eed3a5fe3aff86ad5fbc9c1147cd81
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 18 14:27:52 2017 -0300

    Bug 19830: Add the Koha::Patron->old_checkouts method
    
    Test plan:
      prove t/db_dependent/Koha/Patrons.t
    must return green
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d720e9ede3da4cb612d1517c776d5636e12452e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 15:04:13 2017 -0300

    Bug 19694: Force scalar context for output_pref called with billingdate
    
    If no string is passed to output_pref, it needs to be called in scalar
    context (to avoid a shift in the hash elements).
    Here we have billingdate that is not defined yet (NULL)
    
    Test plan:
    - Search for an existing invoice
    - Show details
    - Changing shipping cost
    - Save
    - Verify the new amount is shown
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3d26c4e96e195308607960e03d309a9cf2d4065
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 4 12:10:13 2017 +0000

    Bug 18201: Unit tests
    
    To test:
    1. prove -v t/db_dependent/Exporter/Record.t
    2. Tests should pass/be green/make the day a little brighter
    
    Signed-off-by: Scott Kehoe <scott@masslibsystem.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b11597b16acdb76b2801c371c9a5df76d97824b9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 13 10:21:50 2017 -0400

    Bug 18201: Export data -Fix "Remove non-local items" option and add "Removes non-local records" option for existing functionality
    
    It turns out the modules had the option expected  built in, we just didn't call
    it. This patch set expands the options for passing to the export.
    
    To test:
    1 - Go to Tools->Export data
    2 - Perform an export and check 'Remove non-local items'
    3 - Note that file contains only 'local' records, but includes all items
    on those records
    4 - Apply patch
    5 - Note Tools->Export data has a new option to remove records not owned
    by logged in branch
    6 - Export as before checking records option, file should be as before
    7 - Now check 'Remove items not owned by logged in branch'
    8 - File should now only have local items (may have empty records)
    9 - Check both boxes and recieve only 'local' records and items
    
    Signed-off-by: Scott Kehoe <scott@masslibsystem.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79c2848b142ed64336ccecd675d9cb2a38795900
Author: Srdjan Janković <srdjan@catalyst.net.nz>
Date:   Thu Oct 12 13:45:43 2017 +1300

    Bug 19450: Fixed WebService::ILS bug upstream (0.17)
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f07f69ae21d5ac78ea662b9a473de59ef6d12ac0
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Nov 7 03:25:52 2017 +0000

    Bug 17770: Perltidy
    
    Signed-off-by: Your Full Name <your_email>
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69f6b24a80ed6156ca13f48606f9941b260fcd80
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Nov 7 03:21:36 2017 +0000

    Bug 17770: Improve perlcritic level
    
    before patch: perlcritic -4 noisy
    after patch: perlcritic -4 ok
    
    Signed-off-by: Your Full Name <your_email>
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c269a0148661a2f39e75688eeaf9be48f0926cf6
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Nov 6 19:49:27 2017 +0000

    Bug 17770: Fix Sitemapper.t if date changes during test run
    
    To compensate, DateTime->now is mocked to the current date.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 325fddd8e911a7efe1342d61f21803d24f785dec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 12:32:34 2017 -0300

    Bug 19845: Do not generate a password if one is filled on selfreg
    
    Bug 15343 allows patrons to choose their own passwords during self-registration.
    But this does not work if the PatronSelfRegistrationVerifyByEmail preference is
    set to "Require." If e-mail verification is required, whatever password the patron
    supplied in the form is ignored, and they are given a randomly generated password
    once they click on the verification link.
    
    Test plan:
    1. Make sure there is a valid e-mail stored in the KohaAdminEmailAddress preference.
    2. Set PatronSelfRegistration to Allow.
    3. Set PatronSelfRegistrationVerifyByEmail to Require.
    3. Be sure "password" is listed in PatronSelfRegistrationBorrowerMandatoryField and
    NOT listed in PatronSelfRegistrationBorrowerUnwantedField.
    4. Be sure there is a valid patron category in PatronSelfRegistrationDefaultCategory.
    5. Set PatronSelfRegistrationPrefillForm to "Display and prefill" so that you can see
    the generated password.
    
    Then fill out the self-registration form, include a valid e-mail address, and select
    a password. Wait for the verification e-mail. Click on the link and you'll see that
    the password you entered in the form is used.
    
    Signed-off-by: Arturo <alongoria@sll.texas.gov>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7140a5e4ecc68759c1bee04571386f9cc9a16d92
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 21 09:17:01 2017 -0500

    Bug 19669: (QA follow-up) Remove itemstypes.plugin
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92dd9082b8de2f45b468e4b73bd5f3efda344f4f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 21 13:56:31 2017 +0000

    Bug 19669: Remove deprecated checkouts by patron category report
    
    Patch applies. Reports and general OPAC and staff client functionality is intact.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 11b562e0d1dbca1243e7ab9305741360b2114db6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 16:52:03 2017 -0300

    Bug 19843: (bug 15839 follow-up) Set reviews.datereviewed when the review is made
    
    Caused by
      commit 092ae340cef375cc66c8511fd34c1a4eec9c7ba6
        Bug 15839: Koha::Reviews - Remove savereview
    
    the datereviewed=now() part of the query has not been translated.
    
    Test plan:
    Add a review from the OPAC
    Confirm that the reviews.datereviewd has been correctly set. Without
    this patch it is set to NULL.
    
    I have no idea how we could update existing data :-/
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2d88cfb28d54fe0e6f5714d5bcd3746076cffa5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 16:28:00 2017 -0300

    Bug 19808: Do not display 'Added' alone
    
    It seems that reviews.datereviewed ends with NULL in DB.
    It is caused by another issue that will be fixed on another bug report.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54f7db91435498bcb6f846c2ec789d0abfa21b30
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 18 13:32:19 2017 -0300

    Bug 19808: Handle deleted reviewers gracefully - reviews/reviewswaiting.pl
    
    Test plan:
    - Create reviews
    - Delete some reviewers
    - Go to Home › Tools › Comments › Comments awaiting moderation
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f1c847aba818b1093a21e67ce4e350b861d013c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 18 13:32:14 2017 -0300

    Bug 19808: Handle deleted reviewers gracefully - opac-showreview
    
    Test plan:
    - Create reviews
    - Delete some reviewers
    - Enable OpacShowRecentComments
    - Go to opac/opac-showreviews.pl
    - Go to opac-showreviews.pl?format=rss
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2cd52f68cbe9de9c26871fc19d4ce1bf34488c7b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 18 13:32:02 2017 -0300

    Bug 19808: (follow-up) Handle deleted reviewers gracefully - opac-detail
    
    Make the tests easier to read
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12882d824ec5e7eab61c67afff4b43dfdde6f9fe
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri Dec 15 15:22:24 2017 +0100

    Bug 19808: Handle deleted reviewers gracefully - opac-detail
    
    And other display issues when the patron was NULL.
    Which allows to keep the review even if it has no patron.
    Because it might be useful.
    
    For example when disconnected, the borrowernumber is null. So the
    comments from deleted patrons were displayed as if the disconnected
    user wrote them. So it had the edit button...
    
    And fix borrowernumber not being passed to the template when
    OpacStarRatings was false.
    
    Test plan
    1. Log in as a patron
    2. Leave a comment/review on a record
    3. Librarian: approve this comment
    4. Delete the borrower
    5. See the record (opac:/cgi-bin/koha/opac-detail.pl?biblionumber=RELEVANT_BIB_NUMBER)
    6. Then you should see an error
    7. Apply this patch
    8. Refresh the page
    9. Then you should see the record page with the comment
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47d8320deaabe420d0a13f4a4403ae650f5b6c74
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 21 10:49:41 2017 -0300

    Bug 19315: Prevent crash if no items and not library set for the subscription
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4421681f48b1728a1d50f751a2d69154abf85dfc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 13:52:44 2017 -0300

    Bug 7143: Update about page for new dev - Isabel Grubi
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fb0099ecee47b3a30e60dc861f608a4383e0450
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 13:50:28 2017 -0300

    Bug 7143: Update about page for new dev - Bonnie Crawford
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ee2257c970832ed5004e9ba561dcfad83d30157
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 13:49:30 2017 -0300

    Bug 7143: Update about page for new dev - Sherryn Mak
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c5e71ed384a9a5df17f642bb5aa832cd4d702f0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 20 13:48:25 2017 -0300

    Bug 7143: Update about page for new dev - Priya Patel
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b5d6441aa8b62efdac2bb1ba09a13cdae088a8b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 21 13:31:49 2017 +0000

    Bug 19664: Reports sidebar menu should match list of reports on reports home page
    
    This patch makes the reports sidebar menu a little more consistent with
    the reports home page menu by adding missing links to reports.
    
    To test, observer the reports sidebar menu before and after the patch
    and confirm that missing reports are linked in the update.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0928edc4ef5ad4774dbd8f0fa34bc444ae84ba85
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 20 17:27:57 2017 +0000

    Bug 19658: Style fix for staff client lists page
    
    Patch applies with no issues and works as described.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Edit: Rebased.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcb8b106fa67194e7ea16260dc4049026e06c6ae
Author: Isabel Grubi <isabel.grubi@gmail.com>
Date:   Mon Dec 18 22:04:26 2017 +0000

    Bug 18313: Remove delicious link on social networks
    
    To test:
    1/ enable social networkds systems preference
    2/ look at any record on the OPAC, notice it has a link to delicious
    3/ apply patch
    4/ refersh page on OPAC, noitce delicious link has gone
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 572b615b9a4035d16111ea2bea22c6add0d08b4c
Author: Bonnie Crawford <bonniecrawford@catalyst.net.nz>
Date:   Mon Dec 18 22:40:12 2017 +0000

    Bug 18819: "UNIMARC is used in Europe" text changed to "UNIMARC is used in a few European countries"
    
    To test
    1/ run installer and notice the inaccurate text "UNIMARC is used in Europe"
    2/ run the patch attached
    3/ run the installer and notice that the updated text "UNIMARC is used in a few European countries"is now present
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae572dcb24b3a1dd50a26b9daf6ffb51b80524a1
Author: Sherryn Mak <sherryn@catalyst.net.nz>
Date:   Mon Dec 18 21:29:55 2017 +0000

    Bug 13676: Fixing the OpacSuppression description
    
    To Test
    1/ Search for OpacSuppression system preference
    2/ Notice that it says "Items marked as suppressed from OPAC search
    results
    3/ Noticre also that addresses is spelt wrong
    4/ Apply patch
    5/ Refresh the page, notice addresses is fixed and items has become
    biblios
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75e6c204a4b04c95bb73d1d6c5307fe6d71a4148
Author: Priya Patel <priya.patel@catalyst.net.nz>
Date:   Mon Dec 18 22:32:30 2017 +0000

    Bug 19713: Remove 2 occurences of OpacShowLibrariesPullDownMobile
    
    To test:
    1/ Grep to find OpacShowLibrariesPullDownMobile
    2/ Notice it is in t/db_dependent/UsageStats.t and C4/UsageStats.pm
    3/ Apply patch
    4/ Grep to check OpacShowLibrariesPullDownMobile was removed from 2
    files
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6574fa7dcc9555e214908e2dba43eae1a112083
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Thu Nov 16 14:24:52 2017 +0200

    Bug 19636: Hold priority changes incorrectly via dropdown select
    
    This patch sorts holds in UI after priority is changed via "Priority"
    dropdown.
    
    It fixes confusion where the form is posted and each row is individually
    processed one by one - and due to conflict in priority value, the latter
    row always gets the chosen value instead of what the user actually might
    have wanted to change.
    
    To reproduce:
    1. Place 3 holds on a record
    2. See existing holds (cgi-bin/koha/reserve/request.pl?biblionumber=XXX)
    3. By using the dropdown menu under "Priority" column, change the first
       hold's priority to last (3). Do not touch other priorities.
    4. Click Update hold(s)
    5. Observe the hold did not get your selected priority 3, but 2 instead.
    
    To test:
    1. Apply patch
    2. Place 3 holds on a record
    3. See existing holds (cgi-bin/koha/reserve/request.pl?biblionumber=XXX)
    4. By using the dropdown menu under "Priority" column, change the first
       hold's priority to last (3). Do not touch other priorities.
    5. Observe this hold was automatically moved to the last row in the user
       interface.
    6. Click Update hold(s)
    7. Observe the hold has your selected priority 3.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dccb3a3414cb284f914d0fbeff7871a809379685
Author: Claire Gravely <claire.gravely@bsz-bw.de>
Date:   Wed Nov 22 13:54:11 2017 +0000

    Bug 19678: Clicking Cancel when adding New Course to course reserves shows message Invalid Course!
    
    Clicking on the cancel link when adding a new course to course reserves
    displays the message 'Invalid Course!'. It would be better if it
    redirected back to the main Course Reserves page.
    
    This patch redirects the user back to the main course reserves page.
    
    To Test:
    
    1. Go to Course Reserves
    
    2. Click '+ New Course'
    
    3. Cancel the process
    
    4. You are shown 'Invalid Course!'
    
    5. Apply patch and repeat steps 1-3
    
    6. You are redirected back to the main course reserves page
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7456c32a755b5c775dbe17084736b91317e63ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 11:30:06 2017 -0300

    Bug 7143: Update about page for new dev - Jessica Freeman
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0303f8730609d4b1393d6f4f500b2df244599c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 19 11:27:41 2017 -0300

    Bug 7143: Update about page for new dev - Chris Weeks
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eddc1acd709b13e5804e51cafd487ce506fabadf
Author: Jessica Freeman <jessicafreeman@catalyst.net.nz>
Date:   Mon Dec 18 22:40:08 2017 +0000

    Bug 19714: Removing 2 occurrences of memberofinstitution
    
    To Test:
    1/grep for memberofinstitution
    2/Notice it occurs in C4/UsageStats.pm and t/db_dependent/UsageStats.t
    3/grep again, notice they have been removed
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e243c36db651c790190ee8c95e2d8fe1ee34cac1
Author: Chris Weeks <chrisweeks@catalyst.net.nz>
Date:   Mon Dec 18 22:10:05 2017 +0000

    Bug 19510: Add description for edi_manage in acquistion permissions
    
    Test Plan:
    1/ Login
    2/ Select patrons
    3/ Search for a patron by name or card number that exists in the system
    4/ Click More -> Set permissions
    5/ Expand 'acquistions' and notice that 'edi_manage' has no description
    6/ Apply patch
    7/ Refresh the permissions page or repeat steps 2 to 5.
    8/ Notice that 'edi_manage' now has a description of 'Manage EDIFACT transmissions'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 130ace389919ee986f2cdcb82ebb9791bb914980
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 18 14:47:37 2017 -0300

    Bug 19759: Fix failing test in Chargelostitem.t
    
     t/db_dependent/Circulation/Chargelostitem.t .. 1/6
     #   Failed test 'The accountline amount should be precessfee value '
     #   at t/db_dependent/Circulation/Chargelostitem.t line 71.
     #          got: '4.5968041848873e+20'
     #     expected: '459680418488730451968.00'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6325f9ed55705f6be55f6fef6d5c94be87b6e58a
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 15 10:08:11 2017 +0100

    Bug 19444: (QA follow-up) Remove repeating condition
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a439d052872a7031c3301b149d1dcf42cb78a74
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 15 09:46:54 2017 +0100

    Bug 19444: (QA follow-up) Fix tests for UNIMARC
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25e050e2ef084afb18d09d24ce68a086b4826923
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 5 10:23:09 2017 -0300

    Bug 19444: Display error message for auto_account_expired
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8f4aacb1db5820b530b2b1dc4072df624f9f1f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 25 16:51:28 2017 -0300

    Bug 19444: Do not auto renew if patron is expired and BlockExpiredPatronOpacActions is set
    
    If the patron's account has expired and BlockExpiredPatronOpacActions is set,
    we expect auto renewal to be rejected.
    
    Test plan:
    Use the automatic_renewals.pl cronjob script to auto renew a checkout
    
    Before this patch, if the patron's account has expired the auto renew was done.
    With this patch, it will only be auto renewed if BlockExpiredPatronOpacActions is not set.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcc2c5e2d93945e35a7138a832f81bc8178c523d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 13 15:46:10 2017 +0000

    Bug 19805: Add DataTables to Koha to MARC mapping page
    
    This patch adds sorting and filtering to the Koha to MARC mapping table
    using DataTables.
    
    Also changed: Font awesome icons on "Add" and "Remove" buttons; Minor
    markup correction to breadcrumbs.
    
    To test, apply the patch and go to Administration -> Koha to MARC
    mapping.
    
    - Table should be sorted by default on Koha field.
    - Sorting and filtering should work correctly.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3cc2a1a9dbb63d080d121c7c2c6f882d03084e8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Dec 12 14:38:01 2017 +0000

    Bug 19654: Move tools templates JavaScript to the footer: Batch MARC tools
    
    This patch modifies the staff client patron lists templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    
    Revised: My original patch included changes to batchMod-edit.tt but
    didn't take into account the MARC plugins which are loaded in the item
    edit form. I have discarded those changes for now.
    
    Tools -> Batch record modification
      - Page highlighting in the sidebar
      - Patron autocomplete in the "Check out" tab
      - Submit records for deletion
        - Page highlighting in the sidebar
        - Checkbox selection links
        - Warning when no records selected
        - Patron autocomplete in the "Check out" tab
    Tools -> Batch item modification
      - Page highlighting in the sidebar
      - Patron autocomplete in the "Check out" tab
    Tools -> Batch item deletion
      - Page highlighting in the sidebar
      - Patron autocomplete in the "Check out" tab
      - Submit items for deletion
        - Patron autocomplete in the "Check out" tab
        - Checkbox selection links
        - Column-hiding checkboxes
        - Datatables
    Tools -> Batch record modification
      - Page highlighting in the sidebar
      - Patron autocomplete in the "Check out" tab
      - Submit records for modification
          - Page highlighting in the sidebar
          - Patron autocomplete in the "Check out" tab
          - Checkbox selection links
          - Datatables
          - MARC preview
          - Warning when no records selected
          - Progress bar after submitting items for modification
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63cfdf700b3701fda882989add55bd4562e03e97
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 14 12:54:14 2017 +0000

    Bug 19806: Add classes to itemnotes in issues table
    
    To test:
    1 - Checkout an item with both public and non-public notes
    2 - Note the notes display and both have circ-hlt class
    3 - Apply patch
    4 - Ensure display has not changed
    5 - Note notes now have classes 'item-note-public' and
    'item-note-nonpublic'
    6 - Sign off
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 405b0f14a4a629e900df71d19bd4369f1ed94e3f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 31 15:57:13 2017 +0100

    Bug 19554: The inventory table should jump to detail instead of MARCdetail
    
    This patch just replaces the link to detail.
    Detail provides item information needed in case of inventory problems.
    
    Test plan:
    Go to Tools/Inventory.
    Create an inventory list without barcode file.
    Check if the link goes to detail now.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54d13ca4afb169111cf6bb386f99eb005565b2ac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 6 13:03:15 2017 -0300

    Bug 19759: Make TestBuilder generates only 2 decimals for float
    
    For instance items.replacementprice is decimal(8,2) but more than 2 decimals are generated.
    
    It leads to issues when we compare expected objects:
    
        #          got: '135623.866142537'
        #     expected: '135623.87'
    
    Test plan:
      prove t/db_dependent/TestBuilder.t
    must return green
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Somehow I have the feeling that we should allow more decimals sometimes
    and perhaps have a number of decimals parameter or so. Think of fields
    like currency or discount.
    But the current issues justify this change.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdccbfcbab7df56d396e667ac6049499a62acf20
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Dec 17 07:24:53 2017 +0000

    Bug 19706: (QA follow-up) Hide the collection code selector if no value is defined (for consistency)
    
    Test plan:
    0) Go to item search
    1) Do have some authorized values in CCODE category -> selector of
    collection is visible
    2) Don't have any authorized value in CCODE category -> selector of
    collection is not visible
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c07f63e5faf475b937bca8673e691390de91cf4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Dec 12 11:15:34 2017 +0000

    Bug 19706: Fix bad json formed when there are no CCODE values
    
    To test:
    1 - Delete all ccode values in your system
    2 - Load the item search page
    3 - View the console and note a js error
    4 - Try to perform an item search to screen
    5 - Internal server error ("unsupported format 'html'" in logs)
    6 - Apply patch
    7 - Reload page
    8 - Note js error is gone
    9 - Perform search to screen, success!
    
    To test there is no regression:
    1 - Have some values in CCODE authorised values
    2 - Ensure collection drop down on item search displays correctly
    3 - Ensure item search returns results ot screen with no js errors
    
    Signed-off-by Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d6c628d85e845da796359de72ef9013ccbb2ebd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 18 12:12:09 2017 -0300

    Bug 18330: (follow-up) Do not return undef explicitely
    
    This patch fixes a perl critic issue, hopefully it will not break
    something else.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e66a78d1075ed5a1af995f79bd92b1ffc10036d7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Dec 11 16:47:00 2017 +0000

    Bug 19767: Remove unused serial-issues.pl script
    
    This patch removes three unused files:
    
    serials/serial-issues.pl
    
    ...and its associated templates:
    
    koha-tmpl/intranet-tmpl/prog/en/modules/serials/serial-issues-full.tt
    koha-tmpl/intranet-tmpl/prog/en/modules/serials/serial-issues.tt
    
    To test, apply the patch and search the Koha codebase for references to
    any of those files. None should exist.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 400804ada19be4e6865d356e3671f6119ad56357
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 12 18:35:47 2017 -0300

    Bug 18330: (follow-up) Adapt holds.t to match the new datetime format
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54de74c6f67c1caa6e1126ceae7e6d67d6f17e03
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Mar 24 15:29:30 2017 +0200

    Bug 18330: Handle date-time in Koha::Object->TO_JSON
    
    This patch formats timestamps and datetimes to meet date-time definition
    in RFC3339, as required by Swagger documentation.
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cebadca9c30df1134ec05117f24850a3b66b3c25
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Mar 24 16:29:46 2017 +0200

    Bug 18330: Add RFC3339 to Koha::DateUtils
    
    To test:
    1. prove t/DateUtils.t
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfb372c30884dc85e31a8ca5159611dcab2ba98e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 20 19:43:11 2017 +0000

    Bug 19663: Move JS to the footer: Reports
    
    This patch modifies the staff client's reports templates so
    that JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    reports pages: All button controls, DataTables functionality, form
    validation, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Fix for QA: Remove unused Dopop function.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 214cae8d3daf131e733b71453d56bec6f03f6162
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 7 13:25:11 2017 +0000

    Bug 19627: (follow-up) Include tools-menu.js on required templates
    
    This follow-up adds tools-menu.js to the two patron clubs templates
    which include the tools sidebar menu.
    
    The patch also modifies tools-menu.js so that the correct sidebar link
    is highlighted when editing or viewing club enrollments.
    
    To test, apply the patch and view the patron clubs main page and the
    patron clubs enrollments page. The sidebar menu should have the correct
    link highlighted in both cases.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a52b0f596f5890c147992120edd6f0227073a571
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 15 14:13:46 2017 +0000

    Bug 19627: Move patron clubs templates JS to the footer
    
    This patch modifies the staff client's patron clubs templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each page: All button controls, DataTables functionality, tabs, etc.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00cfd934c1095bfb2f5cee6296955d3a4de4950b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 10 13:23:43 2017 +0000

    Bug 19607: Move admin templates JavaScript to the footer: Basic parameters
    
    This patch modifies the staff client catalog-related administration
    templates so that JavaScript is included in the footer instead of the
    header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    tabs, etc.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Edit: Rebased on Bug 19560
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04d79ba063bafcb15ae9c2fbb33bd7c7c96b4e60
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 8 16:04:15 2017 +0000

    Bug 19778: Move template JavaScript to the footer: Serials, part 4
    
    This patch modifies more and more staff client serials templates so
    that JavaScript is included in the footer instead of the header.
    
    This patch adds a new JavaScript include, showpredictionpattern.js,
    which is used by subscription-add.tt and subscription-numberpatterns.tt.
    it also adds subscription-add.js, moving most of the JS embedded in
    subscription-add.tt into an external file.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
     - Serials -> New subscription
       - Date pickers
       - Popup search windows for vendors and bibliographic
         records
       - Next / Previous buttons
       - Form validation
       - Prediction pattern operations
    
       Test with new subscriptions, editing existing subscriptions, and
       duplicating subscriptions.
    
     - Serials -> Manage Numbering Patterns
       - Datatable
       - Delete confirmation
       -> Edit
          - Datepicker, test pattern
     - Serials -> Manage frequencies
       - Delete confirmation
       -> Edit
          - Form validation
     - Serials -> Subscription details -> Planning tab
       -> Edit history
          -> Datepicker
     - Serials -> Subscription details -> Renew
       - Datepicker
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 666a1b276097785c2a7c33e718f26f5512b3d972
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 7 19:00:12 2017 +0000

    Bug 19777: Move template JavaScript to the footer: Serials, part 3
    
    This patch modifies even more staff client serials templates so
    that JavaScript is included in the footer instead of the header.
    
    This patch adds a new JavaScript include, serials-toolbar.js, which is
    required on pages which include serials-toolbar.inc.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
     - Serials
       - Search for a subscription
         - Tabs, datatables, date pickers
         - Open a subscription for viewing
           - Tabs, toolbar buttons for delete, renew, and close.
       - Serial collection (in the sidebar menu)
         - Select all / clear all
         - Datatable
         - Print slip
         - Generate next
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 512c5f0c0d64cd4cf7a50c006416b42856202d41
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 7 17:20:48 2017 +0000

    Bug 19761: Move template JavaScript to the footer: Serials, part 2
    
    This patch modifies more staff client serials templates so
    that JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
     - Serials -> Subscription detail -> Edit routing list
       - Add recipients
       - Save
         - "Save and preview routing slip" should trigger preview
           - In preview popup: Print and Close buttons should work correctly
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc4cf2bde45a91ba94980182f40b8c3894f5a11b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 6 15:52:37 2017 +0000

    Bug 19758: Move template JavaScript to the footer: Serials, part 1
    
    This patch modifies some staff client serials templates so
    that JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    - Serials -> New subscription
      - Search for a vendor
        - "Choose" link and "Cancel" button should work correctly
      - Search for record
        - "Choose" link and "Cancel" button should word correctly
    - Serials -> Add subscription fields
      - Datatable, delete confirmation
      - Edit
        - Form validation (submit both authorised value and MARC field)
    - Serials -> Check expiration
      - Date picker in search form
      - Search
        - Renew button triggers popup
    - Serials -> Claims -> Search results
      - Date picker, datatable, form validation
      - Select all/none; Download claims
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ea21c395ae012792feb87c3f452f7cdf510c34f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 6 12:22:59 2017 -0300

    Bug 19514: Add client-side check
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48bf229cc804b0624555137687527e1e23fa22f8
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sat Oct 21 00:54:23 2017 +0000

    Bug 19514: Implement password restrictions into onboarding tool
    
    Test plan:
    1. Drop and recreate your database
    2. Restart memcached
    3. Go through the web installer
    4. In the onboarding tool create a patron with a password of only 2 characters in length
    5. Notice the patron is successfully created and no warning message is
    displayed
    6. Repeat step 1,2,3 and create a patron with a password of 3 characters
    none of which are a uppercase letter or number and notice the patron is
    successfully created and no warning message is displayed
    7. Apply patch
    8. Repeat steps 1,2,3 and create a patron with a password consisting of
    2 characters, notice that after submitting the form the same form is
    loaded again and there is a warning message at the top of the page
    informing you the patron wasn't created
    9. Repeat steps 1,2,3 and create a patron with a password consisting of
    3 characters (all lower case) and submit the form, notice the same form
    is reloaded and a warning message at the top of the page informs you
    that the patron wasn't created because the password was weak
    10. Repeat steps 1,2,3 and create a patron with a password consisting of
    3 characters (one lower case letter, one upper case letter and one
    number) and submit the form and notice this time the next form in the onboarding is displayed with the message at the top of the screen informing you that the patron was successfully created
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e224182cc3581fa61331f3b6742d9be0e6707cda
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 29 15:24:40 2017 -0300

    Bug 19560: Correctly escape branchcode in admin/branches.pl
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 441585a6cc402340977948338dddc6090c1b541f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 14 16:01:33 2017 -0300

    Bug 19776: (follow-up) remove dup category_type keys
    
    The previous patch was obviously wrong, the category_type key appeared
    twice.
    categories.category_type is a varchar(1) and 'P' is not 'X'.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 233b83ca5d6632e6d84f82e9fe50306b30212f49
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 11 17:12:05 2017 -0300

    Bug 19410: (follow-up) Move build_query_params_from_api into a helper
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec9f74791364906dea243a67a661645ae02d4567
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 5 15:40:56 2017 -0300

    Bug 19410: (follow-up) Add reserved params definitions
    
    This patch re-adds some parameters I left out during some rebasing tasks
    and ended up on a separate patchset (bug 18731).
    
    The introduced parameters definitions are only used on endpoint definitions
    that implement (at least) pagination. No need to test them here but easier
    adding them here than on a patch implementing a new enpoint, which would become
    a dependency for other endpoints.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1163dba9d70bfd463c0abe2f70528c66d12d7e7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 21 16:12:08 2017 -0300

    Bug 19410: Move build_query_params_from_api into a helper
    
    This patch creates the 'build_query_params' helper, instead of the
    original function in Koha::Objects.
    
    Unit tests are removed for Koha::Objects::_build_query_params_from_api and
    written for the helper plugin.
    
    The objects.search helper gets a call to build_query_params added. Tests for it
    updated to match this behaviour change.
    
    To test:
    - Apply this patches
    - Run:
      $ kshell
     k$ prove t/Koha/REST/Plugin/Query.t \
              t/db_dependent/Koha/Objects.t \
              t/db_dependent/Koha/REST/Plugin/Objects.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 86706c3b349e77bd2e67ced763dabec3b74c5b72
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Nov 21 14:36:49 2017 +0000

    Bug 19410: Move search_for_api into a Mojo helper
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f5b10126d3d2a2522277b64dd7a1996ca82181d
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Sat Oct 7 12:55:56 2017 +0000

    Bug 19410: (follow-up) Fix typo in POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dda7b2ce4d8e7a7460740fb9e01257e9150bb608
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 6 12:49:27 2017 -0300

    Bug 19410: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7805ef2c01bf8a566daeb805b3c2f8943dafc80d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 4 15:41:35 2017 -0300

    Bug 19410: Add Koha::Objects->search_for_api
    
    Following the discussion about the best way to make things simpler for
    developing the REST api, I quote Lari's email:
    
    "As many other endpoint will have the exact same usage, by looking at your example, I would prefer to avoid writing parameter / pagination / sorting / header handling for each list operation in our API controllers. Do you think it's possible to centralize all of this e.g. by passing $c into a customized search sub? Perhaps in Koha::Objects?
    so instead we could have something like (ignore my bad choice of naming)...:
    sub list_vendors {
      my $c = shift->openapi->valid_input or return;
      my $args = $c->validation->output;
      my $vendors;
    
      return try {
        $vendors = Koha::Acquisition::Booksellers->api_list_search($c);
        return $c->render(status => 200, openapi => $vendors);
      } catch {
        ...
      }
    }"
    
    We all agreed we neeed something like that. Here's a possible implementation. I take
    advantage of the previously written Mojo helpers, that are fully covered by tests.
    
    I submit this early so anyone can take a look and gather ideas to make it even better.
    I'm already using it (effectively) for the /acquisitions/orders endpoint I'm writing
    on bug 18731.
    
    Thanks!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8430a541af9302ae6cef247253000c1469ae2f33
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 23 10:45:59 2017 -0300

    Bug 19370: (QA follow-up) Use OpenAPI's handling of pipe separated values
    
    This patch makes the helper handling _order_by params expect a list of
    values instead of a (to-be-splitted) string.
    
    The idea is that the OpenAPI plugin will take care of splitting
    pipe-delimited values if the spec is correctly defined.
    
    Note: In the process I noticed + on the URL represents a space, so the
    helper function is updated to handle both + and %2B as ascending.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/Koha/REST/Plugin/Query.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Edit: Removed rebasing leftover making the tests fail.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 254883608912456bc15f57cf282099b8641faf54
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 3 17:03:54 2017 -0300

    Bug 19370: Remove undefined variable warning
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a31321676e8bfd02d3a7c1888b89a7fc01166f4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 26 15:17:43 2017 -0300

    Bug 19370: Add helper function for order_by attribute generation
    
    This patch introduces a helper function called 'dbic_merge_sorting'
    to Koha::REST::Plugin::Query.
    
    This simple function adds SQL::Abstract order_by attribute to the passed
    $filter hashref, as explained in the POD.
    
    It introduces a syntax for passing sorting params on the request to the REST api.
    The proposed syntax has been found in the wild, and is pretty trivial to parse/work with:
    
        GET /api/v1/<endpoint>?order_by=+column_1|-column_2|column_3
    
    As explained on the POD, + stands for 'asc' and - for 'desc'. If ommited, it defaults to the
    DB engine default (usually asc).
    
    To test:
    - Apply this patches
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/Koha/REST/Plugin/Query.t
    => SUCCESS: Tests pass! And they make sense! :-P
    - Sign off :-D
    
    Edit: renamed params to match DBIC terminology. My bad :-D (tcohen)
    
    Sponsored-by: Camden County
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2485afc57cb26ce331be60f413a519644ce29796
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 26 15:17:01 2017 -0300

    Bug 19370: Unit tests
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b07ae3f41df33c73cfe2f5989b4a50be6efce3d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 11 17:30:49 2017 -0300

    Bug 19278: DBRev 17.12.00.004
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 296442d2d5d8d506ae299b136ddbd834f5123880
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 22 19:15:43 2017 -0300

    Bug 19278: Mention RESTdefaultPageSize in POD
    
    This patch adds information about RESTdefaultPageSize usage
    when the per_page parameter is absent on the query.
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96f442badd65f672ddc2ba425e851e11a42112ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 11 17:42:15 2017 -0300

    Bug 19278: (follow-up) Make the pagination plugin use RESTdefaultPageSize
    
    Use 20 as default for RESTdefaultPageSize (just in case)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54880b1a4ef8a656d270182d368d4254bc811042
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 8 12:20:20 2017 -0300

    Bug 19278: Make the pagination plugin use RESTdefaultPageSize
    
    This bug introduces a new syspref RESTdefaultPageSize that is used on
    the Koha::REST::Plugin::Pagination plugin to default to a valid value
    for the page size if the param is not present on the query.
    
    This patch also considers the situation in which no 'page' param is
    passed, and no header should be added.
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/Koha/REST/Plugin/Pagination.t
    => FAIL: Tests fail because the plugin doesn't behave as the tests
    expect.
    - Apply this patch
    - Run:
     k$ prove t/Koha/REST/Plugin/Pagination.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Sponsored-by: Camden County
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7d333f3cde9b6fe7cdd0f816b9c357e741ce8e9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 8 12:18:35 2017 -0300

    Bug 19278: Unit tests
    
    This patch introduces tests for a behaviour change in
    Koha::REST::Plugin::Pagination.
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/Koha/REST/Plugin/Pagination.t
    => FAIL: Tests should fail without the followup patch applied
    
    Sponsored-by: Camden County
    Sponsored-by: Bywater Solutions
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fd7834394fb0d4996bbd93e206c2337d922333f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 8 12:18:21 2017 -0300

    Bug 19278: Add RESTdefaultPageSize syspref
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 538536da73681719a1c2d7349a6d729bad7f39f4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 26 15:12:19 2017 -0300

    Bug 19369: Add helper function for pagination attributes generation
    
    This patch introduces a new helper function to the Koha::REST::Plugin::Pagination
    plugin, called 'dbic_merge_pagination'.
    
    This simple function adds SQL::Abstract pagination attributes ('page' and 'rows') to the
    passed $filter hashref.
    
    To test:
    - Apply this patches
    - Run:
      $ koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/Koha/REST/Plugin/Pagination.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Sponsored-by: Camden County
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83ca8fb600e598995b3547912092ec6df2dd3cac
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 26 15:11:38 2017 -0300

    Bug 19369: Unit tests
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9046b76843b426d7a62a687f4fa62d6a222bc05
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 1 12:01:08 2017 -0300

    Bug 19234: (follow-up) Make Query plugin available to endpoints
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cea8b9c7c5465a66cd2510117e88468259bc3983
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 1 11:53:35 2017 -0300

    Bug 19234: Add query parameters handling helpers
    
    This patch introduces a Mojolicious plugin to be used on the REST api.
    It adds a helper method:
    
    generate_dbic_query
    ===================
    
    When used, it generates what's needed to perform a search on
    DBIC/Koha::Objects like this:
    
        my $params  = $c->validation->output;
        my ($filtered_params, $reserved_params) = $c->extract_reserved_params($params);
    
        my $filter = do_smth($filtered_params, $reserved_params);
        my $attributes = do_smth_reserved($reserved_params);
    
        my $patrons = Koha::Patrons->search( $filter, $attributes );
    
    It introduces reserved param names:
    - _match
    - _order_by
    - _page
    - _per_page
    
    They are reserved for later usage (pagination, matching algorithm on building DB queries)
    
    All the plugin's behaviour is tested.
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/Koha/REST/Plugin/Query.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Sponsored-by: ByWater solutions
    Sponsored-by: Camden County
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 656efc09dc55d639258741e3b0bcfc8e38dd7dcb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 1 11:52:29 2017 -0300

    Bug 19234: Unit tests for query parameters handling helpers
    
    This patch adds unit tests for the new query parameters handling Mojo plugin.
    
    Sponsored-by: Camden County
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03dd8267575559caadcc892a488ed74cd7c35e2b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 8 15:31:49 2017 +0100

    Bug 17182: (QA follow-up) Fix call to GetMarcBiblio
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc900d81c555bd133c40b859bda390c1592e0e71
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 19 14:10:05 2017 +0000

    Bug 17182: Allow Keyword to MARC mapping for acquisitions searches
    
    This patchset adds the 'subtitle' field to the results display on
    acquistions search for adding an order form an existing item.
    
    Any field mapped to 'subtitle' in 'Keyword to MARC mapping' will be
    fetched and displayed in the results
    
    To test:
    1 - Perform an acquisitions search for existing record
    2 - Note record subtitles are not displayed
    3 - Map 245$b and 245$n to 'subtitle' in 'Keyword to MARC mapping'
    4 - Note they are still not displayed ion acq results
    5 - Apply patch
    6 - subtitle fields should now display
    
    Sponsored by: Round Rock Public Library
    <https://www.roundrocktexas.gov/departments/library/>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8dd884f13869036ce666cf5a5b430aaa62065df0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 11 14:28:26 2017 -0300

    Bug 19542: Use comma to separate indices
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22d708894b31d63fbac23df65eeb7d6597e6af61
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 7 15:35:42 2017 +0000

    Bug 19542: (QA follow-up) Remove debug warn
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0e44e192003541c2132c94df92cf8372ec30b92
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 31 11:29:28 2017 -0300

    Bug 19542: Add Elasticsearch information in the 'About' page
    
    This patch adds Elasticsearch related information to the 'About' page.
    
    The information is gathered and displayed only when the 'SearchEngine' syspref
    is set to 'Elasticsearch'. It displays configured nodes, and the status:
    - Running
    - Not running
    
    In case it is running, it displays the defined indices and the document count on each.
    If there are configuration problems, exceptions are catch and a convenient warning
    message is displayed.
    
    To test:
    - Apply this patches
    - Run:
      $ kshell
     k$ prove t/Koha/SearchEngine/Elasticsearch.t
    => SUCCESS: Tests pass!
    - Have ES configured in your koha-conf.xml file (by default in kohadevbox)
    - Set the 'SearchEngine' syspref to 'Elasticsearch'
    - Comment out pieces of the elasticsearch-specific entries (server, index_name,
      the whole elasticsearch block). Reload on each change.
    => SUCCESS: Warning messages are displayed and make sense in the context of your changes.
    ----> the rest of the tests require having ES running on the dev env. This can be easily
          achieved by creating the kohadevbox using:
            $ KOHA_ELASTICSEARCH=1 vagrant up
    - Stop the 'elasticsearch' service:
      $ sudo service elasticsearch stop
    - Reload about.pl
    => SUCCESS: The configured nodes are displayed, and the status is 'not running'
    - Start the 'elasticsearch' service:
      $ sudo service elasticsearch start
    - Reload about.pl
    => SUCCESS: The configured nodes are displayed, the status is 'running' and
                created indices info is displayed, along with the document count
                on each index.
    - Sign off :-D
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f57c3b36ea55612d81da7eaa8f75efe9126f9703
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 31 11:26:36 2017 -0300

    Bug 19542: Add a check for ES configuration health
    
    This patch adds a new statuc function to Koha::SearchEngine::ElasticSearch
    which is instended to replace most of get_elasticsearch_params. This function
    reads the configuration from C4::Context->config('elasticsearch') and raises
    relevant exceptions when mandatory entries are missing.
    
    Its behaviour is covered by tests.
    
    To test:
    - Run:
      $ kshell
     k$ prove t/Koha/SearchEngine/Elasticsearch.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ab5a3cf929505a393060f212a4a0399abd9245d
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Mon Sep 25 13:05:01 2017 -0400

    Bug 11210: Writeoff partial amounts
    
    Minor changes to pay.pl and paycollect.tt to allow writing off a partial amount of a fine.
    
    Test plan:
    0) Go to the Fines tab of a test patron's profile
    1) Create a fine if there are none (under the Manual invoice tab)
    2) Go to the "Pay fines" tab
    3) Press the write off button on the corresponding account line
    
    Without patch, you'll be asked to confirm, but will not be able to edit the amount
    With patch, you'll be able to edit the amount.
    
    Followed test plan, patch worked as described. Also ran QA test tool and
    modified files passed
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9125722e38e330a0c45b56844d0aac583509f67f
Author: Claire Gravely <claire.gravely@bsz-bw.de>
Date:   Thu Dec 7 07:35:37 2017 +0000

    Bug 19769: 'Pickup library is different' message does not display library branch name when placing hold
    
    When placing a hold for a patron whose pickup library and home library
    are different, the message displayed only shows the branch code and not
    the branch name.
    
    This patch displays the branch name as well as the branch code.
    
    To test:
    1. Search for an item
    2. Click 'place hold'
    3. Enter patron name/card number for a patron whose home library is
       different to the item's
    4. Note the message displayed only shows the branch code but not the
       name
    5. Apply Patch
    6. Repeat 1-3
    7. Message should now also display the branch name
    
    https://bugs.koha-community.org/show_bug.cgi?id=19769
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20b8568a998264b874bd9baa884ed11cce1e7223
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 4 16:07:52 2017 -0300

    Bug 19746: Remove debug statements in returns.pl
    
    From bug commit bb6277ffcc593685554112d770ac273c9efeda33
    Bug 14464: Add ability to cancel waiting holds from checkin screen
    
    +use Carp 'verbose';
    +$SIG{ __DIE__ } = sub { Carp::confess( @_ ) };
    
    See also
    http://lists.koha-community.org/pipermail/koha-devel/2017-November/044168.html
    
    Test plan:
    Read the changes and make sure they make sense
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 203ddfd9edf69d86d0f6b930c4be292bbbe4b25b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 26 15:41:47 2017 -0300

    Bug 3841: Add the ACQ framework for new installations
    
    This patch adds the acquisition frameworks (frameworkcode=ACQ) for new
    installations.
    It copies the 952 (MARC21) or 995 (UNIMARC) fields from the default
    framework (frameworkcode='')
    
    Test plan:
    Create a new installation and make sure the ACQ framework exists.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1ba8d344ddfff53d24fa6b3a1966e17bdd13a7c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 17 12:13:55 2017 +0000

    Bug 19563: (follow-up) Restore checking sort variable
    
    This code seems a bit odd, $self->sort_fields()->{$name} is checking if
    there is any mapping in ES for a field, so if one marc field in an index
    is marked as sortable this will exists. We need to check the individual
    marc field to see if it should be added to the sort index here.
    
    If you apply the first patch, reindex, and view a record in es:
    curl -XGET 'localhost:9200/koha_kohadev_biblios/data/19/?pretty' | grep
    -A 10 author__sort
    
    You will see that 245$c is included in the record without that
    additional check
    
    Apply this, reindex again, and that field should not be included
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db776c34d23ddd0d4a78e83a983d5b0c906c188a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 17 12:12:32 2017 +0000

    Bug 19563: Unit tests
    
    To test:
    1 - Apply first patch and this patch
    2 - prove -v t/db_dependent/Koha_Elasticsearch.t
    3 - New tests will fail
    4 - Apply followup patch
    5 - Tests shuld pass
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 963eaeab7bda800ca8bbc123d94a7b4ccaa9de0c
Author: David Gustafsson <david.gustafsson@ub.gu.se>
Date:   Thu Nov 2 13:44:13 2017 +0100

    Bug 19563: Generation of sort_fields uses incorrect condition
    
    Fix incorrect condition for if clause for generating <field>__sort mappings
    for Elasticsearch. Also remove redundant check for same condition when
    generating fixer rules.
    
    Test plan:
    1. Inspect current mappings for example by viewing: http://<elasticsearch_host>:9200/koha_<koha_instance_name>_biblios/_mapping.
    2. If using the default configuraion only "author" has a sort field (author__sort).
    4. Appy patch.
    5. Reindex using rebuild_elastic_search.pl.
    6. All fields except those with sort sort set to "0" should now have sort fields, which in the default configuration is all but "author".
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34cdd536cb16436b407947eecd6975b8d4f44467
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 11 13:57:39 2017 -0300

    Bug 10021: Only display outstanding fines in 'Pay fines'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff9a69ccbd61f862965094ac2332874d895aef11
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 11 13:32:09 2017 -0300

    Bug 10021: Remove notify headers from pay*.tt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad2bd6a36dd48626bf64834fee6a800f85d7665c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 10 15:50:24 2017 +0200

    Bug 19439: (follow-up) Remove four spaces from lines 133-149
    
    Speaks for itself. No test plan.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6a4978f19e9e6694aed1d9fe120d15cc60774e0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Oct 9 15:12:05 2017 +0200

    Bug 19439: Remove eval with exit statements from opac/unapi
    
    The script contains some error responses that get lost when using them
    in an eval statement. (Since exit should not be used within an eval
    construction.) The eval is removed now.
    
    Test plan:
    [1] Before applying this patch, you could look at the current responses
        from unapi for the calls in the next steps. Apply the patch now.
    [2] Call http(s)://[your-server]/cgi-bin/koha/unapi with only a format
        parameter.
        Check if you have a 400 status response. (In Firefox, look at Network
        tab of Developer Tools.)
        Note: Have to admit (reluctantly) that MS Edge shows the status code in
        the browser rightaway in contrast with Firefox.
    [3] Call unapi with a format=marcxml&id=999
        The wrong id parameter should trigger a 404 response.
    [4] Call unapi with format=marcxml&id=koha:biblionumber:[notexist]
        where notexist is a biblionumber that not exists.
        This should trigger again a 404 response.
    [5] Call unapi with format=marcxmlx&id=koha:biblionumber:[exist]
        where exist should be a good biblionumber.
        The wrong format should trigger a 406 response.
    [6] Bonus: The 500 response can be tested by manipulating a XSLT file.
        Create invalid xml in the file for marcxml (identity.xsl in intranet
        xslt folder).
        Call unapi with format=marcxml&id=koha:biblionumber:[exist].
        You should get a 500 response and have warnings in your logfile.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c46e2fe7ac9677216543b848f4f20838e5e25d17
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 1 13:53:16 2017 +0000

    Bug 19726: Move admin templates JavaScript to the footer: Preferences
    
    This patch modifies the staff client's system preferences templates so
    that JavaScript is included in the footer instead of the
    header.
    
    To test, apply the patch and test the JavaScript-driven features of
    both the standard and local use system preferences:
    
     - WYSIWYG editor
     - Confirmation messages
     - Table sorting
     - Multiple selects (CoceProviders for example)
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76d9c74ffaea455bdb8b1756b69ee2af1f40d090
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 28 19:04:43 2017 +0000

    Bug 19710: Move plugins templates javascript to the footer
    
    This patch modifies the staff client plugins template so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    the modified template:
    
    - The plugins link should be bold in the sidebar menu.
    - Choosing "Uninstall" for an installed plugin should trigger a
      confirmation alert.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44e7d5e84b2e4020011500ccf0f0f53f974af73d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 27 15:15:06 2017 +0000

    Bug 19700: Move template JavaScript to the footer: Some circulation pages
    
    This patch modifies some staff client circulation templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    modified templates: All button controls, DataTables functionality, tabs,
    etc.
    
    - Article requests (enable ArticleRequests system preference, have at
      least one outstanding article request)
      - Request article (Bibliographic detail page -> Request article).
    - Item circulation statistics (Bibliographic detail page -> Items ->
      View item's checkout history).
    - On-site checkouts (enable OnSiteCheckouts system preference; Check out
      some items as on-site checkouts; Go to Circulation ->
      Pending on-site checkouts
    - Overdues report (Circulation -> Overdues).
    - Holds to pull (Circulation -> Holds to pull).
    - Renew
    - Holds ratios (Circulation -> Holds ratios).
    - Check in
    - Transfers to receive (Circulation -> Transfers to receive).
    - Holds queue (Circulation -> Holds queue).
    - Holds awaiting pickup (Circulation -> Holds awaiting pickup).
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b541824fddcdbf483c80fedc4d25bd25cce9d28
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 27 12:51:16 2017 +0000

    Bug 19697: Move template JavaScript to the footer: Search results
    
    This patch modifies the staff client catalog search results template so
    that JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the various JavaScript-driven features
    of the results page: Floating toolbar, cart, lists, cover images, search
    to hold, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 571c236264d5bac4441eb3c20bcf67dd24160fce
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 22 19:03:15 2017 +0000

    Bug 19680: Move JS to the footer: Patron and circulation tools
    
    This patch modifies more staff client patrons and circulation tools
    templates so that JavaScript is included in the footer instead of the
    header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    
      - Batch patron deletion/anonymization
      - Overdue notice/status triggers
      - Batch patron modification
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c2628616914b3fd7ff7bc6911fc5be9c6a754ea
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 22 15:53:42 2017 +0000

    Bug 19679: Move templates JavaScript to the footer: More tools templates
    
    This patch modifies more staff client tools templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    
      Export data
      Inventory
      Notices & slips
      Upload local cover image
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a8338fb87dd9a3e5fd1466ad63c5e1d8bffc0ba
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 21 15:14:58 2017 +0000

    Bug 19672: Move tools templates JavaScript to the footer: More MARC tools
    
    This patch modifies some staff client templates from the "Tools"
    section so that JavaScript is included in the footer instead of the
    header.
    
    - Automatic item modifications by age
    - MARC modification templates
    - Stage MARC records for import
    - Staged MARC record management
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a9b8a00ae9c98545b8247c91b3c8b406c2ccf06
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 20 18:05:14 2017 +0000

    Bug 19659: Move JS to the footer: Suggestions and tags
    
    This patch modifies the staff client's suggestions and tags templates so
    that JavaScript is included in the footer instead of the header.
    
    This patch adds a new JS file, acquisitions-menu.js, which will be added
    to each template which has the Acquisitions sidebar menu (in this case,
    suggestions). Highlighting of the current page in the sidebar menu will
    be broken for pages which have not been modified to use this file.
    
    To test, apply the patch and test the JavaScript-driven features of
    suggestions and tags pages: All button controls, DataTables
    functionality, form validation, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03e01e670d14b21abc6d16d4a423e396ad3645ae
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 20 17:05:10 2017 +0000

    Bug 19657: Move lists templates JS to the footer
    
    This patch modifies the staff client's lists templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    lists page: All button controls, DataTables functionality, form
    validation, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cff82b59622adab8307a72d4a1b523f349e84b3c
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Dec 6 16:14:51 2017 +0000

    Bug 19656: (QA follow-up) Add bold style to rotating colections menu item
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e746becc277883281923900891fdb3f5ae755c9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 20 16:41:33 2017 +0000

    Bug 19656: Move rotating collections templates JS to the footer
    
    This patch modifies the staff client's rotating collections templates so
    that JavaScript is included in the footer instead of the header.
    
    The patch moves JavaScript from each template and the rotating
    collections toolbar into a single external JavaScript file.
    
    To test, apply the patch and test the JavaScript-driven features of
    each page: All button controls, DataTables functionality, form
    validation, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d6dff2b39ad94cd196940c1ed752cb2132e1a5d
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Dec 6 15:19:46 2017 +0000

    Bug 19653: (QA follow-up) Add bold style to quotes menu item on quotes-upload page
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6abaca8d0d36835e4a5fd4fb9b906cc9e573953
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 28 15:41:54 2017 +0000

    Bug 19653: Move tools templates JavaScript to the footer: Additional tools
    
    This patch modifies the staff client "Additional tools" templates so
    that JavaScript is included in the footer instead of the header:
    
    - Calendar
    - CSV profiles
    - Log viewer
    - News
    - Task scheduler
    - Edit quotes for QOTD feature
    - Upload
    
    Note that the log viewer template has been modified so that the
    "interface" variable (passed to the template to provide the correct path
    to staff client assets) isn't overwritten by an "interface" variable
    required by the log viewer.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf79a2694eab08613b409bec2b14c8f6949cd8c2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 15 16:08:57 2017 +0000

    Bug 19628: Move course reserves templates JS to the footer
    
    This patch modifies the staff client course reserves templates so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each page: All button controls, DataTables, autocomplete, etc.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e40274411a667e2bdbfc5417638c8a75d6e390b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 9 13:53:19 2017 +0000

    Bug 19601: Move admin templates JavaScript to the footer: Additional parameters
    
    This patch modifies the staff client "additional parameters"
    administration templates so that JavaScript is included in the footer
    instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each page: All button controls, DataTables functionality, tabs, etc.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 634c55aacb752467c6623478a8abdc108ced8e98
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Dec 5 10:58:11 2017 +0000

    Bug 19600: (QA follow-up) Apply css to menu item for item_search_field page
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eaa3287705d607bb9b8e22d3903f5f3a457098e2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 9 13:24:04 2017 +0000

    Bug 19600: Move admin templates JavaScript to the footer: Other catalog pages
    
    This patch modifies the staff client catalog-related administration
    templates so that JavaScript is included in the footer instead of the
    header.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    tabs, etc.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a2002465338a53f8ceb69041a9bb699f8065344
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 17 16:32:56 2017 +0000

    Bug 19647: Move patron lists templates JS to the footer
    
    This patch modifies the staff client patron lists templates so that
    JavaScript is included in the footer instead of the header.
    
    This patch adds a new JS file, tools-menu.js, which will be added to
    each template which has the Tools sidebar menu. Highlighting of the
    current page in the sidebar menu will be broken for pages which have not
    been modified to use this file.
    
    To test, apply the patch and test the JavaScript-driven features of
    each modified template: All button controls, DataTables functionality,
    form validation, etc.
    resolved the issue, sorry about that, everything is working fine!Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c5c516844625592ed68ca91be5a76852b4bfdb6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 8 17:40:55 2017 +0000

    Bug 19594: Move admin templates JavaScript to the footer: MARC-related
    
    This patch modifies the staff client MARC-related administration
    templates so that JavaScript is included in the footer instead of the
    header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    cart: All button controls, DataTables functionality, tabs, etc.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02f46e0a27db0f72bc19e6e7fe99c78090b5f1a0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 8 15:55:23 2017 +0000

    Bug 19592: Move admin templates JavaScript to the footer: Acquisitions
    
    This patch modifies the staff client acquisitions-related adminisration
    templates so that JavaScript is included in the footer instead of the
    header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    cart: All button controls, DataTables functionality, tabs, etc.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53594885286620afd8b96bf1b77fa8c54a5ac4c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 14:30:20 2017 -0300

    Bug 12227: Remove the demo functionality
    
    This is a legacy mode that did not really work.
    
    Test plan:
    Play with frameworks and sysprefs and confirm the changes
    (add/del/update) are taken into account.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76f277930f017b601d30c817b4df796fbf9a2556
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Oct 6 07:26:31 2017 +0000

    Bug 19292: Add MARC code column on libraries list
    
    Test plan:
    0) Apply the patch
    1) Go to admin/branches.pl
    2) In the list of libraries, you should see new column "MARC Organization Code"
    3) Insert some codes to some libraries
    4) Confirm they are shown in new column
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Fixed capitalization.
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e110f90c342841dfb57a88b27e4ef882f7ecc39e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 11 12:49:33 2017 -0300

    Bug 19299: Replace C4::Reserves::GetReservesForBranch with Koha::Holds->waiting
    
    GetReservesForBranch simply returns the waiting holds, for a specific
    branch of not. This can easily be replaced with a call to
    Koha::Holds->waiting
    
    To avoid any regressions, I reuse the exact conditions (priority = 0),
    but I do not think it is useful.
    
    Test plan:
    Make sure the holds information are correctly displayed on the waiting
    holds screen.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e9b7301022f3737f028246d11e9a32883280d53
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Dec 5 15:26:58 2017 +0000

    Bug 19751: Holds awaiting pickup report should not be fixed-width
    
    This patch changes the grid used for the holds awaiting pickup report so
    that the results are full page and fluid instead of fixed-width.
    
    To test, apply this patch and the patch for Bug 19700 if necessary.
    
    View the holds awaiting pickup report. The report should fluidly fill
    the page width.
    
    Test with the CircSidebar system preference enabled and disabled.
    
    Signed-off-by: George Williams <george@nekls.org>
    Signed-off-by: BWS Sandboxes <ByWaterSandboxes@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c8ff1254c92374b888aca8b96121ce6294ae7d3d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 29 15:18:31 2017 -0300

    Bug 10021: DBRev 17.12.00.003
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 528f647ae81977b017b2cf7d1da983b22d1e2f0b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 3 13:40:38 2017 -0300

    Bug 10021: (QA follow-up) Rename variables
    
    To avoid $account, $accounts and @accounts variables in the same scope
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4247994e4636f0747811571371d62626a1427389
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 24 18:45:31 2017 -0300

    Bug 10021: Restore "Pay fines" list
    
    Previous changes were wrong, the notify_id was always equal to 1 and
    GetBorNotifyAcctRecord was used to retrieved the account lines to pay
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b2aa64950ee387e81a5589e6cd0e00d145efe42
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 24 18:25:38 2017 -0300

    Bug 10021: Remove notify columns in circ/branchoverdues.tt
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1465eeb737fd4502891daf0616af1e892eb24c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 23 12:27:58 2017 -0300

    Bug 10021: Remove accountlines columns - DBIC Schema changes
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcbffbbc6153197bed3fcf555c7f09cfa709a462
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 23 12:27:33 2017 -0300

    Bug 10021: Update DB changes
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f54693ac86799cb556fffed412968d688877b585
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 18 10:43:17 2017 -0300

    Bug 10021: Drop columns notify_id and notify_level from accountlines
    
    It appears that has never worked.
    Could someone confirm?
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32fcf995a314094e092f4925e58a007a6fa1b57d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 8 16:24:21 2016 +0100

    Bug 10021: Drop table notifys and related code
    
    This patch drops the notifys table and its related code in C4::Overdues.
    A second patch should remove the 2 columns notify_id and notify_level
    from the accountlines table.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8537d1aad029f0c0f21bac894b53d1b3f6542ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 11 11:22:41 2017 -0300

    Bug 19096: DBRev 17.12.00.002
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9adfd29fc1a25f9da95a55e0fd39b1973db11912
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 17 10:57:28 2017 +0200

    Bug 19096: Add update DB entry to sync kohafield in all frameworks
    
    Squashed the last four follow-ups into one patch. Instead of adding
    two routines to Koha::MarcSubfieldStructures, and instead of moving
    them to Koha::Util::Dbrev, we finally ended up with converting the
    code to raw SQL queries (thx Jonathan). No need to 'pollute' the git
    history with all this moving around.
    
    As Jonathan pointed out, there is a risk in using DBIx calls (with Koha
    objects) while running database revisions. See also bug 17292 and
    bug 19789.
    
    I tested the resulting db revision by adding a few fields to the Default
    framework and adding deviating kohafields in other frameworks. And confirm
    that it works as expected.
    
    Please read the remainder of this commit message in the light of the above:
    
    ===
    
    The dbrev will use two new routines in MarcSubfieldStructures:
    [1] get_kohafield_exceptions is used to report deviating kohafields in
        the additional frameworks,
    [2] sync_kohafield is used to reset kohafield in the other frameworks to
        the mapping in Default.
    
    Test plan:
    
    Unit test and database revision:
    [1] Run t/db_dependent/Koha/MarcSubfieldStructures.t
    [2] Verify that your Default 100a is mapped to biblio.author. Go to another
        framework and clear the mapping via mysql command line:
        UPDATE marc_subfield_structure SET kohafield=NULL WHERE frameworkcode=[your_framework] AND tagfield='100' AND tagsubfield='a';
    [3] Run the db revision. It should report that 100a was adjusted.
    [4] Check in admin/marc_subfield_structure that your 100a is mapped to
        biblio.author again in that framework.
    
    Additional interface testing (ensuring that the changes on this report do
    not interfere with multiple mappings):
    [5] Make two mappings for copyrightdate: 260c and 264a. And make two
        mappings for biblioitems.pages: 300a and say 300g. Toggle with some
        field values in those fields in the cataloging editor and verify the
        contents of biblio.copyrightdate and biblioitems.pages. The former
        should contain one year (due to additional logic) and the latter should
        contain A | B if both fields are filled.
        Remove the mapping for 300g.
    [6] Set AcqCreateItem to ordering or placing. Verify that you can still
        add or receive an order as usual.
    [7] Add a mapping for itemcallnumber to 952f (this should remove the one
        for coded_location_qualifier). This is very unusual but serves well in
        testing multiple mappings for items.
        Add or receive an order (fill 952f and 952o) with same and/or different
        values. Verify the contents of items.callnumber. (Check with regular
        item editor; see note.)
        Do a similar edit in the regular item editor.
        Note: You should expect to see A | B in both 952f and 925o if both
        fields are filled with a different value.
        Set items.coded_location_qualifier back to 952f in koha2marclinks.
    
        Note: When AcqCreateItem==ordering, you will not see A|B in the callno
        field when adding an item on neworderempty.pl. But when you submit
        the main form, addorder.pl is called. At that time an item is created
        and you will see that A|B is in both fields (952f and 952o).
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 19096: (QA follow-up) Move two routines out of Koha::MSS
    
    As requested by RM, this patch moves sync_kohafield and
    get_kohafield_exceptions from Koha/MarcSubfieldStructures.pm.
    
    At this moment they are only used in a database revision; it is not clear
    if they may be of use later on.
    
    In order to keep them in a module and not remove the unit tests, this
    patch adds a Koha::Util module Dbrev.pm. It is now required in the atomic
    update, but could be added in a use statement in updatedatabase.pl.
    
    Test plan:
    [1] Run updatedatabase.pl
    [2] Run t/db_dependent/Koha/MarcSubfieldStructures.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 19096: Use raw SQL queries instead for the update DB entry
    
    I strongly thing we must not use C4 or Koha subroutine in the update DB
    process, only sql queries.
    Especially not DBIC Schema files as they will change.
    For instance the update DB 17.12.00.00X is using a specific Koha::Schema::RS::MSS
    representing the current schema, but in X months/years, this schema will change
    and the ->search we used may failed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 19096: Move the sql queries to the update DB entry
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Print "Field 700$a" instead of "Field 700.a" in the dbrev.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93bd78951d64218b711e4ecf472f3d2f12455182
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 17 11:44:18 2017 +0200

    Bug 19096: Restructure MarcSubfieldStructures.t first
    
    Before adding more tests, move all current tests in one subtest.
    
    Test plan:
    Run t/db_dependent/Koha/MarcSubfieldStructures.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 407e58488875b2499c5f2ad72618a2ff2eb5a50c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 16 14:37:06 2017 +0200

    Bug 19096: Online help changes
    
    On the page admin/marc_subfields_structure we now tell that Koha link
    has been disabled and refer to the help for koha2marclinks.
    On the page admin/koha2marclinks we mention that the Default mapping is
    considered authoritative now.
    
    Test plan:
    Read these online help pages and verify that the changes make sense.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18f4a89ce6108bcabf042e74bfa582f14184e463
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 7 15:02:10 2017 +0200

    Bug 19096: Do not allow changes to kohafield within MARC frameworks
    
    This patch makes two changes in the script for managing the MARC
    frameworks in order to support making the Default authoritative
    as for Koha to MARC mappings:
    
    [1] Disable the kohafield select combo. Add a hidden input to save value.
    [2] When a new subfield is added, the kohafield is still empty and should
        be overwritten with its Default counterpart.
        Note: Although we could leave the field empty, since Koha looks at the
        Default framework only, it does not cost much to keep these fields in
        sync with Default and perhaps catch a bug when someone somewhere looks
        in the wrong framework.
    
    Note: The description of Koha to MARC mapping on admin-home has been
    adjusted accordingly (removing last two lines).
    
    Test plan:
    [1] Add a new tag and subfield in Default.
    [2] Map it to a kohafield in koha2marclinks.pl
    [3] Add the same tag and subfield in another framework.
        Verify that the kohafield is updated after you saved the subfield.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a63523f593736e282d4b8dc590f250f0339c2eb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 10 10:59:07 2017 +0200

    Bug 19096: Adjusts unit tests
    
    The subroutines listed in the former patch are extensively tested in
    Biblio.t, TransformKohaToMarc.t and TransformMarcToKoha.t.
    These tests do no longer use new frameworks to add mappings.
    
    In Biblio.t and TransformMarcToKoha.t we also test passing an individual
    framework code (for an empty framework) to see if Default is still used.
    Note that this parameter will be removed later on.
    
    In Items.t the cache keys MarcStructure-0- and MarcStructure-1- are not
    touched, so they do not need to be cleared. The cache key
    default_value_for_mod_marc- should be used without framework now.
    Similar adjustments in Items/AutomaticItemModificationByAge.t and
    Reserves.t.
    
    Furthermore the subtest for _build_default_values_for_mod_marc in Items.t
    is adjusted since framework is no longer relevant. The biblio record with
    items is created in a new framework, but the mappings from Default are
    consulted.
    
    Test plan:
    Run all adjusted unit tests.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 590cae04fd4cb0fc6fa309d6006fd14f48ea4a03
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 10 10:59:07 2017 +0200

    Bug 19096: Make Default authoritative in core modules
    
    After feedback from the dev mailing list, it seems appropriate here to
    propose making the Default framework authoritative for Koha to MARC
    mappings. This implies checking only the Default framework in the
    routines:
    
    [1] GetMarcFromKohaField: The parameter frameworkcode is removed. A
        follow-up report (19097) will update the calls not adjusted here.
        This is safe since the parameter is silently ignored.
    [2] GetMarcSubfieldStructureFromKohaField: Framework parameter is removed
        and calls are adjusted. Includes acquisitions_stats.pl.
    [3] TransformKohaToMarc: The parameter is removed; all calls are verified
        or adjusted.
    [4] TransformMarcToKoha: The parameter is no longer used and will be
        removed in a follow-up report (19097). It always goes to Default now.
    [5] TransformMarcToKohaOneField: The parameter is removed and all calls
        are adjusted. Including: Breeding, XISBN and MetadataRecord modules.
    [6] C4::Koha::IsKohaFieldLinked: This routine was called only once (in
        C4::Items::_build_default_values_for_mod_marc. It can be replaced by
        calling GetMarcFromKohaField. If there is no kohafield linked, undef
        is returned. (Corresponding unit test is removed here.)
    [7] C4::Items::ModItemFromMarc: The helper routine
        _build_default_values_for_mod_marc does no longer have a framework
        parameter. The cache key default_value_for_mod_marc- is no longer
        combined with a frameworkcode. Three admin scripts are adjusted
        accordingly; some tests will be corrected in the next patch.
    
    Test plan:
    See next patch. That patch adjusts all tests involved.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2164fce41fe2835a909cc952a346ac3e145a5390
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Oct 23 12:07:04 2017 +0200

    Bug 10306: (QA follow-up) More feedback for admins in koha2marclinks
    
    As requested by Tomas, this patch does:
    
    [1] Add a js alert when you did not type field,subfield
    [2] Print a yellow alert div when the field,subfield is not found.
    [3] Bonus: Make it little bit more secure by demanding a POST. (Leaving
        CSRF etc. for another report.)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a74db9e6b862a67dc9b90131e3784d6a5a6b51e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 24 12:23:29 2017 +0200

    Bug 10306: (QA follow-up) Correct a TestBuilder call
    
    In order to create a new framework, MarcSubfieldStructure was used as
    source. This works since that table contains a FK for frameworkcode.
    But obviously, we should use BiblioFramework as source.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24c0c49ab357531e4ffc2ee6d6fc034bcfbb5393
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jul 27 13:18:39 2017 +0200

    Bug 10306: Adjusted online help text for koha2marclinks
    
    Test plan:
    Click on Help. Read the text.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dfff3ab1993aac03873c5f87543df05c778c353
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jul 24 19:09:17 2017 +0200

    Bug 10306: Support for multiple mappings in koha2marclinks
    
    This actually refactors koha2marclinks.pl in order to support multiple
    mappings per kohafield.
    
    Instead of three separate mapping pages for biblio, biblioitems and items,
    the script now lists them together. This gives a complete overview of all
    mappings rightaway. Changes are applied immediately across all frameworks.
    
    Note: This report handles the Default mappings just like it did before.
    In this script Koha already considered them as authoritative, although
    other parts of Koha did not. Follow-up report 19096 makes Default
    mappings authoritative throughout all Koha.
    
    On each line two buttons are provided, Add and Remove, in order to add or
    remove an individual mapping. We do no longer provide a separate form with
    the names of MARC tags. Since this form is targeted for administrators,
    it should be enough to ask for a field tag and subfield code.
    
    Note: The mappings for biblionumber, biblioitemnumber and itemnumber are
    so vital that this form marks them as readonly. It is not recommended to
    change them.
    
    Test plan:
    [1] Add a mapping. Verify via Frameworks or mysql command line that the
        kohafield is saved to the other frameworks too.
    [2] Remove the mapping again. Check Frameworks or mysql cl again.
    [3] Test adding a second mapping. Map copyrightdate to 260c and 264c.
        And map biblioitems.place to 260a and 264a.
    [4] Edit biblio record 1: Put 1980 in 260c. Do not include 264c.
        Edit biblio record 2: Put 1990 in 264c. Do not include 260c.
        Edit biblio record 3: Put 2000 in both 260c and 264c. Put CityA in 260a
        and in 264a.
        Edit biblio record 4: Put 2010 in 260c, and 2015 in 264c (which you
        should refuse normally). Put CityA in 260a, and CityB in 264a.
    [5] Create a report that shows biblioitems.place and biblio.copyrightdate
        for those biblio records.
        Record 4 should have 2010 in copyrightdate (since TransformMarcToKoha
        picks the first year for copyrightdate).
        Record 3 should have place CityA; record 4 should have CityA | CityB.
        Note: The CityA | CityB example illustrates that we should add some
        additional handling in TransformMarcToKoha for multiple 264s.
    [6] Add these four biblio records to a new list. Sort by Year.
        With OPACXSLTListsDisplay==default, check if the order = 1,2,3,4.
        (The order is based on biblio.copyrightdate.)
        Note that (RDA) record 2 would be on top without this patch set, since
        copyrightdate would have been null.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54467a76d73e4ee9f82b039b6db0295ffa7e50ef
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 3 12:56:08 2017 +0200

    Bug 10306: Restructure TransformMarcToKoha and update some POD lines
    
    This patch makes the following changes:
    
    [1] Added POD for CountItemsIssued, GetBiblioItemData
    [2] Moved TransformMarcToKohaOneField closer to TransformMarcToKoha (before
        sub CountItemsIssued)
    [3] Restructured TransformMarcToKoha by extracting individual kohafields via
        TransformMarcToKohaOneField. The latter does no longer call the former.
        This small optimization avoids traversing the whole MARC record again
        and again.
    [4] Moved adjusting copyrightdate/publicationyear to separate helper routine
        _adjust_pubyear
    [5] Removed obsolete sub _get_inverted_marc_field_map.
    
    Test plan:
    Run t/db_dependent/Biblio/TransformMarcToKoha.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9a4e52077cee5d150dac0c39db49930b8cff994
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 19 16:54:40 2017 +0200

    Bug 10306: Add tests for module changes
    
    GetMarcSubfieldStructure: In Biblio.t we are adding a subtest that checks
    the structure returned by this routine. Is it a hashref pointing to
    arrayrefs of hashrefs? ;)
    In Search.t this routine was mocked. The change in the returned structure
    is now applied to this mock too (moving the marc tag hashes into
    arrayrefs).
    
    GetMarcFromKohaField: In Biblio.t we add a subtest for it. We are checking
    if it returns multiple mappings (per kohafield) and calling it in scalar
    context too.
    
    GetMarcSubfieldStructureFromKohaField: The existing subtest in Biblio.t is
    expanded to also test the call in list context.
    
    TransformKohaToMarc: This sub has its own test script. We are adding a
    subtest in TransformKohaToMarc.t for a test with multiple mappings,
    and for mapping to a control field in another framework. This also tests
    the additional framework parameter.
    Additionally, we add a test for the new no_split option used for items.
    
    TransformMarcToKoha: This implicitly tests its helper sub _get_inverted.
    This patch adds a new test script for this routine.
    
    TransformMarcToKohaOneField: A few tests are added to the previous new
    test script.
    
    Test plan:
    [1] Run t/db_dependent/Biblio.t
    [2] Run t/db_dependent/Biblio/TransformKohaToMarc.t
    [3] Run t/db_dependent/Biblio/TransformMarcToKoha.t
    [4] Run t/db_dependent/Search.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db32f394a636848488de4d1637d9efc5b7fcf004
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jul 20 12:37:56 2017 +0200

    Bug 10306: Allow controlfields in TransformKohaToMarc
    
    Since the interface allows you to connect a kohafield to a MARC
    controlfield, this routine should be able to handle that. Unfortunately
    it did not.
    
    Test plan:
    Change will be tested in Biblio/TransformKohaToMarc.t in the next patch.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01fbe2be9925f8586b9a2cb4dc908fc856b672a8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 19 16:25:04 2017 +0200

    Bug 10306: Core module changes for multiple mappings
    
    In order to allow multiple Koha to MARC mappings (for one kohafield), we
    need to adjust a few key routines in C4/Biblio.pm. This results in a few
    changes in dependent modules too.
    
    Note: Multiple mappings also include 'alternating' mappings. Such as the
    case of MARC21 260 and 264: only one of both fields will be used. Sub
    TransformMarcToKoha will handle that just fine; the opposite transformation
    is harder, since we do no longer know which field was the source. In that
    case TransformKohaToMarc will fill both fields. We only use that operation
    in Koha for items (in Acquisition and Cataloging).
    
    Sub GetMarcSubfieldStructure
    This sub used a selectall_hashref, which is fine as long as we have only
    one mapping for each kohafield. But as DBI states it: If a row has the same
    key as an earlier row then it replaces the earlier row. In other words,
    we lose the first mapping if we have two.
    This patch uses selectall_arrayref with Slice and rearranges the output so
    that the returned hash returns an arrayref of hashrefs for each kohafield.
    In order to improve consistency, we add an order clause to the SQL
    statement used too.
    
    Sub GetMarcFromKohaField
    This sub just returned one tag and subfield, but in case of multiple
    mappings we should return them all now.
    Note: Many calls still expect just one result and will work just fine:
        my ($tag, $sub) = GetMarcFromKohaField(...)
    A possible second mapping would be silently ignored. Often the sub is
    called for biblionumber or itemnumber. I would not recommend the use of
    multiple mappings for such fields btw.
    In case the sub is called in scalar context, it will return only the first
    tag (instead of the number of tags and subfields).
    
    Sub GetMarcSubfieldStructureFromKohaField
    This sub previously returned the hash for one kohafield.
    In scalar context it will behave like before: it returns the first hashref
    in the arrayref that comes from GetMarcSubfieldStructure.
    In list context, it returns an array of all hashrefs (incl. multiple
    mappings).
    The sub is not used in C4::Ris. Removed the use statement.
    
    Sub TransformKohaToMarc
    This sub got a second parameter: frameworkcode.
    Historically, Koha more or less assumes kohafields to be defined across all
    frameworks (see Koha to MARC mappings). Therefore it falls back to Default
    when it is not passed.
    When going thru all mappings in building a MARC record, it also supports
    multiple mappings. Note that Koha uses this routine in Acquisition and in
    Cataloging for items. Normally the MARC record is leading however and the
    Koha fields are derivatives for optimization and reporting.
    
    The added third parameter allows for passing a new option no_split => 1.
    We use this option in C4::Items::Item2Marc; if two item fields are mapped to
    one kohafield but would have different values (which would be very unusual),
    these values are glued together. When transforming to MARC again, we do not
    want to duplicate the item subfields, but we keep the glued value in both
    subfields. This operation only affects items, since we are not doing this
    reverse operation for biblio and biblioitem fields.
    
    Sub _get_inverted_marc_field_map
    This sub is a helper routine of TransformMarcToKoha, the opposite
    transformation. When saving a MARC record, all kohafields are extracted
    including multiple mappings.
    Suppose that you had both 260c and 264c in your record (which you won't),
    than both values get saved initially into copyrightdate like A | B. The
    additional code for copyrightdate will extract the first year from this
    string.
    A small fix in TransformMarcToKoha makes that it only saves a value in a
    kohafield if it is defined and not empty. (Same for concatenation.)
    
    Sub TransformMarcToKohaOneField
    This sub now just calls TransformMarcToKoha and extracts the requested
    field. Note that since we are caching the structure, this does not result
    in additional database access and is therefore performance-wise
    insignificant. We simplify code and maintenance.
    Instead of modifying the passed hashref, it simply returns a value. A call
    in C4::Breeding is adjusted accordingly. The routine getKohaField in
    Koha::MetadataRecord is redirected to TransformMarcToKohaOneField.
    NOTE: The fourth patch restructures/optimizes TransformMarcToKoha[OneField].
    
    Sub get_koha_field_from_marc
    This sub can be removed. A call is replaced by TransformMarcToKohaOneField
    in C4::XISBN.
    
    Note: The commented lines for sub ModZebrafiles are removed (directly under
    TransformMarcToKohaOneField).
    
    Test plan:
    For unit tests and interface tests, please see follow-ups.
    Run qa tools in order to verify that the modules still compile well.
    Read the code changes and verify that they make sense.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d203cbbe8e8c38cfb15437fc3d583bfcaa15d834
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 7 14:42:03 2017 -0300

    Bug 19776: Fix random failures (category_type vs categorycode='X')
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54053cb475e98b6fe7c944f5e9df8978dfaffd0e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 7 13:41:06 2017 -0300

    Bug 19775: Try & prevent Search/History.t to fail randomly
    
     #   Failed test 'There are still 8 searches after calling delete with an interval = 6 days'
     #   at t/db_dependent/Search/History.t line 185.
     #          got: '6'
     #     expected: '8'
    
     #   Failed test 'There are still 2 searches after calling delete with an interval = 2 days'
     #   at t/db_dependent/Search/History.t line 191.
     #          got: '0'
     #     expected: '2'
     # Looks like you failed 2 tests of 27.
    [15:04:12] t/db_dependent/Search/History.t
    
    It looks like it does not longer fail with this change (date comparaison wrongly rounded to second in mysql?)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b7f1069c084d3076b51d9a93289cc6d120c8661
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 7 11:28:54 2017 -0300

    Bug 7143: Update about page for new dev - Victor Grousset
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d10327e987c9ced850ad5d885370cc9e1e61c34
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 7 10:52:28 2017 -0300

    Bug 19496: ReplytoDefault is a pref, not a C4::Context method
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5292616ace986c72c174c67e838159725f0dcdf
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Nov 27 21:33:58 2017 +0000

    Bug 19496: Fixing to_address for patron notes
    
    This patch ensures the patron note to_address is the branch email or the
    Koha Admin email, and the from_address is the patron's email.
    
    To test:
    1) Ensure syspref 'allowcheckoutnotes' is turned on
    2) Go to OPAC, leave a note on a checkout
    3) Confirm that the note is received (in mysql message_queue) but the
    to_address is the patron's email - this is wrong
    4) Apply patch and refresh OPAC
    5) Leave a note on a checkout
    6) Confirm that the note is received in message queue
    7) Confirm that the to_address is one of:
    - branch email
    - branch reply to
    - syspref ReplytoDefault
    - syspref KohaAdminEmailAddress
    8) Confirm that the from_address is one of:
    - patron email
    - patron emailpro
    - patron B_email
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8e42c5f2141dca75fbc0e4f80d20898c4df118c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 7 10:26:32 2017 -0300

    Bug 19724: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8915df00601d525e1823e03026f757a0b0e8de49
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 7 10:20:36 2017 -0300

    Bug 19724: DBRev 17.12.00.001
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6de8f50b14ac8babb6b6c932e7e96396d93903b
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Jul 6 15:42:43 2017 +0000

    Bug 18907: Build has deprecating message
    
    Following the instructions at:
    https://wiki.koha-community.org/wiki/Building_Debian_Packages_-_The_Easy_Way
    Receiving the following message in the build:
    dpkg-source: warning: relation < is deprecated: use << or <=
    
    This patch tweaks the list-deps.
    git diff origin/master -- debian/list-deps shows just the one line
    changed from < to << as per the messages suggestion and eythian's
    suggestion on IRC:
    http://irc.koha-community.org/koha/2017-07-06#i_1950698
    
    The control file can be regenerated from the command-line:
    ./debian/update-control
    However, it will be attached separately.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14f8bce9aeae1126b9fe611a8af5e2ec7a4e72dc
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Fri Nov 24 12:02:47 2017 +0100

    Bug 12497: Fix OPAC search history reachable by URL even when disabled
    
    Test plan:
    1. Set EnableOpacSearchHistory syspref to "Keep"
    2. Make a search in the OPAC
    3. Go to /cgi-bin/koha/opac-search-history.pl
    4. Set the EnableOpacSearchHistory syspref to "Don't keep"
    5. Refresh the OPAC page to show that history is still accessible
    6. Apply the patch
    7. Refresh the OPAC page, you should end on the 404 page
    8. Set EnableOpacSearchHistory syspref to "Keep"
    9. Go to /cgi-bin/koha/opac-search-history.pl which should be reachable
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit edc8031f4a2347e65f424eba8a56b7ddd35ca42f
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Thu Nov 23 16:03:14 2017 +0100

    Bug 12497: Fix search history non-accessible when OPAC was private
    
    (when the user didn't have the "borrowers" permission)
    
    Test plan:
    1. Set syspref "OpacPublic" to false (Disable)
    2. Log in as a user without any permission
    3. Try to access the search history. The link is next to "Log out"
    4. Then you should see "Access denied"
    5. Apply this patch
    6. Refresh the page
    7. Then you should see the search history
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Charles Farmer <charles.farmer@inLibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1710014dcf8b5b72f82b9388ae70f4dd882a933
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 21 16:17:32 2017 +0000

    Bug 19674: Broken indicators of changed fields in manage staged MARC records template
    
    This patch returns some CSS to the manage staged MARC records template
    which was incorrectly removed by Gug 16538.
    
    To test, apply the patch and go to Tools -> Staged MARC management.
    Choose a staged MARC file.
    
    Changing any of the <select> fields in the first section should cause a
    label to appear showing that the selection has changed, along with a
    link to reset the option to its original state. Clicking 'Reset' should
    make the label and the link disappear.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9debea25c74de3b0ce48a1b53ef61a7969cd6676
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 9 16:47:42 2017 +0000

    Bug 19602: Add usage statistics link to administration sidebar menu
    
    This patch adds a link to the new usage statistics page in the
    administration sidebar menu.
    
    To test, apply the patch and view an administration page which includes
    the admin sidebar. Confirm that the link to usage statistics is there.
    
    Visit the usage statistics page and confirm that the usage statistics
    link in the sidebar is display in bold.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c4d23a1936fd1b5a06219e3914f8ca76ef01c10
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 10 12:59:58 2017 +0000

    Bug 19595: Clicking plugin link does not fill item's date acquired field
    
    This patch updates the dateaccessioned plugin for the item edit form to
    return functionality which was removed in a previous patch.
    
    To test, apply the patch and open an item for editing. Clicking the
    "..." link next to the "Date acquired" field should insert the current
    date, overwriting the existing date.
    
    Open a blank item add form. Putting the cursor in the "Date acquired"
    field should automatically insert the current date.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Added a comment line in set_to_today.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d77fbd79fc85f9dae92eee2609b570a43a61d29
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 31 13:17:26 2017 +0000

    Bug 19551: Fix wrong order of operations in cash register report
    
    To test:
    1 - Find or create a fine for a patron
    2 - Write it off
    3 - Home -> Reports -> Cash register
    4 - Fill in current date and transaction type 'Write off'
    5 - Click Submit
    -- see your write off
    6 - Fill in previous dates and transaction type 'Write off'
    7 - Click Submit
    -- see your write off (bad)
    8 - Apply patch
    9 - Rerun steps 3-7
    -- write only visible for current date.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db68a2f432bc3ec92fe5fed230fdd24a5dc91c94
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Nov 16 20:45:03 2017 +1300

    Bug 18993: Allow Test::More version 1.302073
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e61e6ee2c3400e6a01b03a46477ddf5bfe5c10c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 3 12:37:14 2017 -0300

    Bug 18993: Bump Test::More to 1.302075
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 215226966b7cb3a35cd178244574b6b4d20c3b10
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Mon Jul 31 11:05:00 2017 +0200

    Bug 18993: Bump libtest-simple-perl to 1.302075
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit daf9d619e5932fce9fe108a72a48450228feb5e6
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 1 12:47:59 2017 +0000

    Bug 19724: Add timestamp to biblio_metadata and deletedbiblio_metadata
    
    Since bug 17196, biblioitems.timestamp is not always updated after a
    change in the MARC record.
    We need to know the last modification time of the MARC record for some
    features (like OAI-PMH parameters 'from' and 'until' for instance)
    
    This patch only adds the missing column in biblio_metadata and
    deletedbiblio_metadata
    
    Test plan:
    1. Run updatedatabase.pl
    2. Verify that both tables have the new column, its value should be the
       greatest timestamp value from the corresponding biblio and
       biblioitems table entries
       You can verify with the following SQL query:
         SELECT b.biblionumber, b.timestamp as biblio_ts,
         bi.timestamp as biblioitems_ts, m.timestamp as biblio_metadata_ts
         FROM biblio_metadata m
         LEFT JOIN biblioitems bi ON (bi.biblionumber = m.biblionumber)
         LEFT JOIN biblio b ON (b.biblionumber = m.biblionumber);
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d828094e8e12a5c8ee814044a46bafb9897a552
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 4 15:39:48 2017 -0300

    Bug 19638: Remove false positive obsolete reports (auth_header.marcxml)
    
    Bug 17898 tries to help users identify reports affected by the move of marcxml to the biblio_metadata table, however, the auth_header table still uses the column name 'marcxml' and so reports as needing updated though it doesn't.
    
    C4::Reports::Guided::convert_sql only converts if the sql query contain biblioitems and marcxml.
    We should use the same regexp in the controler script.
    
    Test plan:
    Use a sql report that use auth_header.marcxml (see https://wiki.koha-community.org/wiki/SQL_Reports_Library)
    After the this the report should not be longer marked as obsolete on the report list view
    
    Replicated bug with the following SQL:
            select marcxml from auth_header;
    
    Patch applied correctly and functioned as expected.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f03da2810cf9fa0f671243f90d31a915c67d6825
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 7 09:47:28 2017 -0300

    Bug 7143: Update about page for new dev - Simon Pouchol
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7db41b379ff2fbf9827a8b752897bf6ee4409026
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Oct 23 14:00:53 2017 +0000

    Bug 10222: Correct and expand to other languages
    
    This added column names, and reformated to be a bit more readable.
    This also adds this change to de-DE, es-ES, fr-CA, and nb-NO.
    While there was printer_profiles for it-IT, the Italian file seems
    to not use the same numbers, and does not visibly look like it needs
    these changes.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8a25307c4d748ee3646cec8753d91d73f1cd58d
Author: Chris Nighswonger <cnighswonger@foundations.edu>
Date:   Thu Apr 16 12:07:29 2015 -0400

    Bug 10222: Error when saving Demco label templates
    
    This patch fixes a bug whereby if you open either of the
    Demco label templates (loaded by the sample data) and
    click "save" without making any changes you will get an
    error:
    
    Can't bless non-reference value at C4/Creators/Profile.pm
    line 92.
    
    It also fixes another minor bug in the creator sample data.
    
    To test:
    
    1. Install all sample data in a clean database.
    2. In the label tool, edit either of the Demco label templates.
    3. Save the template and observe the error mentioned above.
    4. Drop and recreate the database.
    5. Apply the patch.
    6. Repeate steps 1-3 and note the successful save.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e46ab82e2855597274fb927f2eea7265eb4b7565
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 28 11:58:46 2017 +0000

    Bug 18990: Overdue Notices are not sending through SMS correctly
    
    Bug 18478 fixed sms via email problems under the assumption that
    to_address was either smsalertnumber or blank.
    
    It seems overdues set the to_address to email. This patch changes the
    code to enforce that an sms sent with emial driver will use the
    smsalertnumebr and provider defined for the borrower, regardless of what
    is set in the queue
    
    To test:
     1 - Define a messaging prefs for a patron to recieve hold notices via
      SMS
     2 - Ensure you have defined an SMS message for an overdue letter
     3 - Set an SMS alert number for patron
     4 - Set the SMS::Send driver to 'Email'
     5 - Checkout an item as overdue to trigger notice above
     6 - Run overdue_notices.pl
     6 - Check the db and note the address is email
     7 - run process_message_queue.pl
     8 - Check db - address is email followed by service provider
     9 - Apply patch
     10 - repeat
     11 - Message to_address should be populated with smsalertnumber
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d5488ee280137ee216d53df9f82bd27ee8ff663
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 16 19:19:33 2017 +0000

    Bug 19643: Pagination buttons on staged marc management are stacking instead of inline
    
    This patch modifies the template for staged MARC import management to
    correct a problem with the style of pagination links.
    
    To test you must have more than 25 staged imports. Go to Tools -> Staged
    MARC management. The pagination links, both at the top and the bottom,
    should look correct (use multi-page SQL report results for reference).
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 916b057e91f69c86b92bd416011b87cc614632f2
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Wed Nov 22 13:58:21 2017 -0500

    Bug 19681: Correct result count formatting
    
    This simply passes the missing information to the template.
    
    Test plan:
    0) Apply patch
    1) Go to Tools > Label creator > New > Label batch
    2) Press 'Add items'
    3) Do a search that will return few items
    4) The result count will read "Results 1 through X of X"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67741fb69efc071e7dbfea151c919123318089cc
Author: Simon Pouchol <simon.pouchol@biblibre.com>
Date:   Fri Nov 24 16:53:49 2017 +0100

    Bug 19692: fix unclosed div in opac-shelves.tt
    
    Test plan:
    1. set syspref OpacKohaUrl to "Show"
    2. Log into the OPAC
    3. /cgi-bin/koha/opac-shelves.pl
    4. Notice that "Powered by Koha" is not in the footer in this page.
      When on the other tabs it's in the footer (out of .main)
    5. Apply this patch
    6. Notice that "Powered by Koha" now in the footer in the "your lists" page
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68a6b6bba4058f0c9dda79f3789ce3d8a76bcb56
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 26 07:35:53 2017 -0400

    Bug 19533: Hold pulldown for itemtype is empty if hold placement needs override
    
    Test Plan:
    1) Enable AllowHoldPolicyOverride
    2) Enable AllowHoldItemTypeSelection
    3) Create a situation where adding a hold for a patron would trigger a tooManyReserves
       warning.
    4) Note the itemtype pulldown is empty
    5) Apply this patch
    6) Reload the page
    7) Itemtype pulldown should have values
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4eebaabc2efe3a57e748c053e933d9632fa91efc
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jun 21 13:05:40 2017 +0200

    Bug 18833: Plugin unimarc_field_210c pagination error
    
    In plugin unimarc_field_210c, the editors search results have pagination.
    First page works but not other pages.
    
    The main problem whas mainly because $startfrom var was missused. It is defined in C4::Output::pagination_bar as page number.
    This patch corrects by using a $offset var.
    Also removes dead code, obsoleted by using C4::Output::pagination_bar.
    Also changes hardcoded results per page from 19 to 20.
    
    Test plan :
    - Use UNIMARC catalogue
    - Define in framework value builder unimarc_field_210c on 210$c
    - Create autority type EDITORS with heading 200$b
    - Create 22 authorities of that type
    - Index those new authorities
    - Create a new biblio record
    - Click on 210$c plugin
    - Click on "Search"
    - You see 20 results
    - Click on page 2
    => Without patch you get empty table
    => With patch you get 2 results
    - Check that you see "Results 21 to 22 of 22"
    - Delete 2 autorities and retest
    
    Works as intended.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebd7c422b48c53fa037b69a9150f8e0460d24418
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Oct 13 06:44:55 2017 +0000

    Bug 19456: Make patron-title ability to be generated with or without html tags
    
    Modified pages:
    circ/circulation.pl
    circ/circulation_batch_checkouts.pl
    members/boraccount.pl
    members/files.pl
    members/holdshistory.pl
    members/housebound.pl
    members/moremember.pl
    members/notices.pl
    members/purchase-suggestions.pl
    members/readingrec.pl
    members/routing-lists.pl
    members/statistics.pl
    
    Test plan:
    0) Do not apply the patch
    1) Have a patron with title/salution filled in
    2) Confirm bug, go for example to circ/circulation page and see there is
    html in <title> tag (you can see it in your browser page/window title)
    3) Apply the patch
    4) Go through circulation/patron pages (see modified page above) and
    confirm there is no html in <title> tag, but on the page itself the
    salutation should be in <span class="patron-title">
    
    Signed-off-by: David Bourgalt <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1beb65ed4f48af9314ce63ea28054425c1139360
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Nov 16 15:22:48 2017 +0100

    Bug 19640: fix OPAC IdRef webservice display
    
    The OPAC webservice IdRef display was broken.
    The call returns results but citations where empty.
    Maybe the webservice has changed.
    
    This patch corrects the fetch of datas in result.
    Also fixes a small HTML missing tag tr.
    Also adds a comment with link to official doc :
    http://documentation.abes.fr/aideidrefdeveloppeur/index.html#MicroWebBiblio
    
    Test plan :
    1) Enable system preference IdRef
    2) Choose an existing PPN like 032581270
    3) Look result on : https://www.idref.fr/services/biblio/032581270.json
    4) Call in OPAC website : /cgi-bin/koha/opac-idref.pl?unimarc3=032581270
    5) Without patch you see only one role containing empty rows
    6) With patch you see all roles with correct rows
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: removed unused @unimarc3 (not to be confused with $unimarc3).
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42e6716546adfaf5ec9bbc6e01e58f19f6473254
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 24 09:27:14 2017 +0100

    Bug 19646: (QA follow-up) Fix tab character
    
    Resolve qa tools warning:
     FAIL   koha-tmpl/intranet-tmpl/prog/en/modules/cataloguing/value_builder/marc21_linking_section.tt
       FAIL   forbidden patterns
                    forbidden pattern: tab char (line 172)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f7d644001ed0f206d247866e2a461de9a995976
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Nov 17 13:38:06 2017 +0100

    Bug 19646: fix value_builder marc21_linking_section template
    
    When using marc21_linking_section cataloging plugin, you get the error :
    Template process failed: undef error - The method selected is not
    covered by tests! at /home/koha/src/C4/Templates.pm line 122.
    
    It commes from [% IF ( itypeloo.selected ) %], selected is not defined
    in itypeloo.
    
    This patch removes this condition because all item types are fetched
    from database, there is not one selected. It sets "All item types" as
    selected. Also correctes two errors in HTML : ending form and div,
    "<a_class=" instead of "<a class="
    
    Test plan :
    1) Use a MARC21 database
    2) Define marc21_linking_section cataloging plugin in framework, on
       773$t for example
    3) Create a new biblio record
    4) Click on icon in 773$t
    5) Check plugin works fine
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a03e9249f09f9580cb225200544314a709685845
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Wed Nov 22 14:35:27 2017 -0500

    Bug 19683: Fix authority types in tools/export template
    
    Fixes the bug by correcting the variable names in the template.
    
    To test:
    1) Tools > Export > Export authority records
    2) Authority Types dropdown is not empty
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Changing the export script and unblessing is not needed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5a61798522862cb0d230c7a655d5d6999c6940b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 6 16:33:56 2017 -0300

    Bug 19766: (bug 19058 follow-up) Fix Preview routing slip
    
    This patch fixes the following errors:
    The method reserve_id is not covered by tests at /home/vagrant/kohaclone/C4/Reserves.pm line 859.
    The method set is not covered by tests at /home/vagrant/kohaclone/C4/Reserves.pm line 871.
    Can't call method "store" on an undefined value at /home/vagrant/kohaclone/C4/Reserves.pm line 871.
    
    This is caused by
      commit ba1f2f93ef58c8dd935add3e215facdd4a589d12
        Bug 19058: Move C4::Reserves::GetReserveId to the Koha namespace
    
    We are calling ->reserve_id on a Koha::Holds set.
    
    Test plan:
    - Serials -> Find subscription -> "Edit routing list" in the sidebar
    - Add 1+ recipients
    - Save -> "Save and preview routing slip"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af7d618d2b12655631e9febae74c222367495900
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 29 13:50:45 2017 -0300

    Koha 17.12 - Panuku (start of a new dev cycle)
    
    Panaku is a Māori word and have the meaning of "movement".
    It can be used to talk about the unstable/development version of Koha.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b74d72a2d72f2be1361d3d223c403b992c80fab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 27 12:28:18 2017 -0300

    DBRev 17.11.00.000
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb75ae8a12f5cafc51d306026bea8b14c0911459
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 27 12:27:39 2017 -0300

    Add release notes for Koha 17.11
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48d2f861fa85882a36ab30ac901888c40438fc48
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Mon Nov 27 09:31:19 2017 -0300

    Translation updates for Koha 17.11.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7aad1df80c9af0309d60317a6dfb6391099506e2
Author: Stefan Berndtsson <stefan.berndtsson@gmail.com>
Date:   Mon Nov 27 12:33:21 2017 +0100

    Bug 19695: Fix another instance of ->find in list context (uncertainprice.pl)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8981b710d42defc3e0e907ffe0d9b33cd4b3355
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Nov 26 16:37:35 2017 -0300

    Bug 7143: Update timeline (2 new devs)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f9de9f91b022c8919d940968c31a4313cd09ff7
Author: Andreas Jonsson <andreas.jonsson@kreablo.se>
Date:   Sun Nov 26 14:10:38 2017 -0300

    Bug 19675: Fix update notice templates when they are translatable
    
    Avoid the following error:
    DBD::mysql::db do failed: Duplicate entry
    'acquisition-xxx--email-default' for key 'PRIMARY' [for Statement "
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbcf911f0b8ade40d5189542e4180ceac4d1d109
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 27 11:38:31 2017 +0200

    Bug 19536: Odd number of elements in anonymous hash in svc/bib
    
    Resolve:
    Odd number of elements in anonymous hash at svc/bib line 69.
    Odd number of elements in anonymous hash at svc/bib line 118.
    
    You can see such warnings when testing the Rancor editor.
    
    Replacing url_param by param in fetch_bib since it is a GET call.
    Not sure about doing the same in update_bib since that is a POST.
    The scalar context will resolve the odd number warns.
    
    Adding a scalar in svc/new_bib too.
    
    Test plan:
    Try URL /cgi-bin/koha/svc/bib/[number] with and without the patch.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b780a14ad9fef316df51680be7c1d9d066959e31
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 2 13:22:31 2017 -0300

    Bug 18357: Handle unlimited on-site checkouts
    
    If on-site checkouts are set to unlimited (i.e. NULL/undef), they are
    currently blocked.
    
    Test plan:
    1/ Set All/All rule with Unlimited/unlimited for normal/onsite checkouts
    2/ Will be able to perform onsite checkout
    3/ Edit rule to be 15/Unlimited normal/onsite
    4/ Will be able to perform onsite checkout
    => Without this patch it was blocked
    5/ Set rule to 15/15
    6/ Onsite checkouts work again
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec0ff69182d253b37ae15815d0adeb81f51d1bd1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 13 13:43:05 2017 +0000

    Bug 18712: (QA follow-up) Add count of tests
    
    Before patches we did 47 tests or none, we should plan the same number
    of tests now
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c69ff0b0dfb89480212703e82b06d6877d86c99
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 2 10:26:08 2017 -0300

    Bug 18712: Remove unecessary fixtures
    
    2 fixtures are in a subroutine that is never called, it can be removed
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5153d38f489e7b6d135b74b75b63e161e5917aa5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 2 10:13:46 2017 -0300

    Bug 18712: Fix t/Matcher.t if DB is empty
    
    t/Matcher.t is failing with an empty DB, the data are not mocked
    correctly
    
    Test plan:
    drop your DB and recreate it without any data and prove t/Matcher.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00adeb397ff6fb9f01dd68a42d7ed136b7afef55
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 17 09:23:40 2017 +0100

    Bug 19626: (QA follow-up) Small optimization
    
    We are only using $calendar when the pref is set.
    Date calculation can be moved in if-else structure.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 996298340fb7c545559864593d9054369ba2e56d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 15 13:03:57 2017 +0000

    Bug 19626: Calculate expiration date for existing holds based on waitingdate
    
    To test:
    1 - Have/create a 16.11 instance with some waiting holds
    2 - Those holds should not have an expirationdate
    3 - Make sure some of the holds are waiting longer than
    ReservesMaxPickupDelay
    BACKUP THE DB
    4 - Upgrade to 17.05 (or later)
    5 - Check the expirationdate for the holds
    6 - The date wil be in the future (curdate + delay)
    7 - Restore DB
    8 - Apply patch
    9 - Run the upgrade again
    10 - expirationdate should now be based on waitingdate
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c42053021bf6f0d5550df5786c8017b90f634ebd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 8 17:55:00 2017 +0000

    Bug 19596: Don't try to get hold or items count for non-existent biblios
    
    Patch applies and works as expected.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 490ec51af6d5df6f62fb004655ae6e6f45abdfee
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 18 10:29:24 2017 +0000

    Bug 19481: Set default sort options as sortable in ES default mappings
    
    To test:
    1 - Setup Koha with ES
    2 - perform a search
    3 - try sorting by pubdate, acqdate, popularity, or title
    4 - Search fails!
    5 - Apply patch
    6 - visit:
    /cgi-bin/koha/admin/searchengine/elasticsearch/mappings.pl?op=reset&i_know_what_i_am_doing=1
    7 - Re-index ES
    8 - Perform search
    9 - All sorting options should work
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c78e4c97e258c829d09e2d48081efc065619651
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 1 16:13:23 2017 +0000

    Bug 18131: Followup - Use data if biblionumber_tag < 10
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ebb0bbb180f54f216dc90d522223de21a0d227e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 23 14:44:54 2017 -0300

    Bug 18131: ES - Fix matching staged records - Authority
    
    Occurrences of C4::AuthoritiesMarc::SearchAuthorities must be replaced
    by search_auth_compat.
    
    You need to define the search index of matching rule with one of the
    values defined in %koha_to_index_name (from
    Koha::SearchEngine::Elasticsearch::QueryBuilder::build_authorities_query_compat)
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eed1c91c8f4ca6a836d31f081d4d91289cc27fa2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 27 14:20:48 2017 +0100

    Bug 18131: ES - Fix matching staged records
    
    The code in C4::Matches::get_matches is terrible and a bug has been introduced
    by bug 12478 because of its way to handle uniqueness.
    
    If search engine is elastic, simple_search_compat returns array ref of MARC::Record,
    used as a string for the key of the matches hashref we get things like
    "MARC::Record=HASH(0x8f76ab0)".
    Yes, terrible...
    
    The file is never staged and we get an internal server error:
        stage-marc-import.pl: Can't locate object method "fields" via package "MARC::Record=HASH(0x8f76ab0)" (perhaps you forgot to load "MARC::Record=HASH(0x8f76ab0)"?) at /home/vagrant/kohaclone/C4/Biblio.pm line 2691
    
    To recreate the issue:
    - Set SearchEngine == Elastic
    - Create a matching rule on 999$c (you need to edit the existing one and specify
    'Local-number' as search index, not 'local-number')
    - Import a file with bibliographic records and use the matching rule you defined.
    
    Test plan:
    Import authority and bibliographic records with Zebra and Elastic using a matching rule.
    Everything should work correctly.
    
    Note: I found a bug when importing authorities using Elastic, see bug 17255 comment 38.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a081ed16c0c3295253408f999354e6bbfa5fe183
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 1 15:47:39 2017 +0000

    Bug 19559: Add '-' to list of characters we don't split search terms on
    
    Test plan assumes
    QueryAutoTruncate = automatically
    SearchEngine = Elasticsearch
    
    To test:
    0 - Apply Unit test patch only
    1 - prove t/db_dependent/Koha_SearchEngine_Elasticsearch_Search.t
    2 - Should fail
    3 - Apply this patch
    4 - prove t/db_dependent/Koha_SearchEngine_Elasticsearch_Search.t
    5 - should pass
    6 - search for 'Local-number:"4"' (or a vlid biblionumber)
    7 - should get expected result
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26be355fe8c83a187a0cfbdae4f3a9e3b9ba8be9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 1 15:46:59 2017 +0000

    Bug 19559: Add tests
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fe0a816fe64361a07ad8e4dc09f942ec2428666
Author: Stefan Berndtsson <stefan.berndtsson@ub.gu.se>
Date:   Thu Nov 23 14:43:18 2017 +0100

    Bug 19651: SIP/ILS/Item misses title and author
    
    Signed-off-by: Benjamin Rokseth <bensinober@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended $item->biblio by $biblio.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a4b36bc3a186adb07679c2a3549e69974e02c18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Nov 26 12:55:27 2017 -0300

    Bug 19655: Add tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cd9240c362336e390eed01acf3630f33e73825f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Nov 20 11:05:35 2017 -0500

    Bug 19655: Make To.json escape doesn't escape newlines  to create valid JSON
    
    JSON does not allow real line-breaks. If a field contains them and they are not escaped, a JSON parser will be unable to convert the stringified JSON back into an object.
    
    This is clearly exemplified by the guarantor search, where a multi-line note on the guarantor's record will break the ability to select that guarantor.
    
    Test Plan:
    1) Create Patron A with a "Circulation note" that has multiple lines in it
    2) Create Patron B
    3) Attempt to set Patron A to be the guarantor for Patron B
    4) Note selecting the patron does nothing
    5) Apply this patch
    6) Repeat step 3
    7) Selecting the guarantor now works!
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d7dd0c69d82d0b53b352a1f8b5450402993ed41
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 13 15:34:53 2017 +0000

    Bug 18547: (QA follow-up) Add comments to make tests clearer
    
    Tests had some confusion with names and results, though they do seem to
    cover the changes here.
    
    I believe the tests highlight that ReserveControlBranch has no effect,
    and possibly it should? Beyond the scope here but left those tests
    for future work to be done
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eba47394d14fb96c7c715d5c9ba63d79668652d5
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Wed May 3 21:13:49 2017 +0200

    Bug 18547: On shelf holds allowed > "If all unavailable" ignores default hold policy
    
    If in the circ rules matrix you set "On shelf holds allowed" to "If all unavailable",
    default hold policy "From home library" is ignored.
    
    Test plan:
    
    - Have a test user from one branch (eg Centerville)
    
    - Set "On shelf holds allowed" to "If all unavailable" for your patron and item
      category (or everyone and everything)
    - For "Default checkout, hold and return policy", set hold policy to "From home library"
      -> make sure there is no "Default holds policy by item type" to override the setting
    
    - Have two items for a record.
      1. An item with home branch same as test user (eg Centerville)
      -> check this item out to somebody else
      2. an item with a different home branch (eg Fairfield)
      -> available, not checked out
    - Try to place a hold for your test user. Does not work.
    
    - Apply the patch
    - Try to place a hold. Should work now.
    
    Followed test plan, worked as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Followed test plan in the intranet and OPAC, worked as intended.
    With few assumptions made:
    - when the hold works, should be on the item 1 (Centerville)
      item 2 is only there to trigger the bug
    - the circ rules were identically setup on each branch and in "Standard rules for all libraries"
    Signed-off-by: Victor Grousset <victor.grousset@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c7356aab4b6c8acdcdc22ef449c5cc7d9482a71
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 31 15:34:20 2017 -0300

    Bug 18547: Add tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d149f1963e3f23f2fc880fa839dadc488428e52a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 14:22:54 2017 -0300

    Bug 7317: Fix translatable-templates.t failure
    
    Failed with
     /tmp/Lqv0BH2xC9:7979:13: invalid multibyte sequence
     msgmerge: found 1 fatal error
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff8b030970e6e404a777418043994da3e55c9b7c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 12:21:11 2017 -0300

    Bug 7317: DBRev 17.06.000.028
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd88680cbec5d044e604e567cb65bffab091e618
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 12:16:59 2017 -0300

    Bug 7317: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45a87377213e8b487e5bd00063b40a7fe09becb0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 13:25:13 2017 -0300

    Bug 7317: Display all the libraries, not only one
    
    Before this patch only the first library defined in the system where
    displayed.
    TODO: Make sure we want to display all the libraries and not a
    "filtered" list
    see `git grep PROCESS options_for_libraries libraries|grep unfiltered`
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d02e28af03c6f117e214030973c92e3710309370
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 13:24:43 2017 -0300

    Bug 7317: Make fields mandatory when sending emails
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 007caff1514297151567632c786d01f645d08238
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 12:50:00 2017 -0300

    Bug 7317: Do not use GET for deletion requests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2355111d43672e3ae4dd8ad4d7ec08e8feadf83
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 9 12:04:29 2017 -0300

    Bug 7317: Simplify column headers
    
    It will help translators (remove TT tags from po files) and simplify the
    code. We do not need this translate_column that is used only once.
    It also removes sorting option on the last column (actions)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9880bd02ae4f90b507736360c15820d9b57293b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 9 11:02:46 2017 -0300

    Bug 7317: (QA followup) Make query parameters consistent with other endpoints
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 631294e8aa35b974d84877fd8d73fd9229ca0d36
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 8 16:37:52 2017 -0300

    Bug 7317: Remove traces of UnmediatedILL
    
    This patch removes references to UnmediatedILL. This feature is introduced on
    a separate bug.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af59238ba0f5585a2eef9dbced28855f3a74032b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 8 16:12:35 2017 -0300

    Bug 7317: (followup) Remove extra columns from backends on the main list
    
    This patch removes the extra columns functionality, simplifying the code.
    It removes redundant code (in both Perl and JS), unused vars.
    
    It removes the use of here_link and hardcodes the script path on the template.
    
    It also adjusts the AJAX call so it uses the 'library' param instead of 'branch'.
    
    The library column now displays the library name instead of the ID.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2725d3156a99d304422119c340f25c89dd7b4e3b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 8 16:08:01 2017 -0300

    Bug 7317: (QA followup) Rename 'branch' for 'library'
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1c808b525f7c89fa3442887117734882c1c802e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 7 17:26:13 2017 -0300

    Bug 7317: Fix more translation issues
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af29e710da7ae5368afcb7a2542136f8b3ee2ff8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 7 16:07:31 2017 -0300

    Bug 7317: use preventDefault to prevent the scrollbar to move to the top
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d7b0a073d5e9bf48897ed4ade2cff7237df01a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 7 16:52:09 2017 -0300

    Bug 7317: Add missing 'use Encode' statement
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a85ac6b626ea80ba74c114f929b6e4e24b0f7b2d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 6 16:15:32 2017 -0300

    Bug 7317: (QA followup) Fix capitalization and terminology issues
    
    This patch fixed terminology issues on the UI, and removes CSS-based
    case forcing for column names.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f747b10b69386ec7f64749931696b2567c226a9f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 7 12:05:04 2017 -0300

    Bug 7317: Handle missing email addresses gracefuly
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3de8beed381f6caea4a8160ee23c04c7f156263
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 7 12:04:21 2017 -0300

    Bug 7317: (QA followup) ILL sysprefs belong to circulation section
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bcb0dc7286acdc978b048defa09ac73cc3f48ea
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 6 13:51:43 2017 -0300

    Bug 7317: (followup) Make tests independent of data on the DB
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b79948400f1a02549329fe1329e7c0cab004cd0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 6 12:45:24 2017 -0300

    Bug 7317: Add partner_code checks to abot page
    
    This patch adds checks to the configured (or fallback) partner_code.
    It produces two different warnings:
    
    - Configured partner_code doesn't match an existing patron category
    code.
    - partner_code is not defined, a fallback to ILLLIBS is done
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd52583363430b75097dbfc923a83d13a007391c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 3 15:28:56 2017 -0300

    Bug 7317: opac.css update
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfd9af0e58a5f66bc0432949ec60d8d3caab4089
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 1 16:29:54 2017 -0300

    Bug 7317: (QA followup) Get rid of warnings from the tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06f9e5fe3aa95be62e40a9a7a85cb0d31b3278d6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 31 16:28:53 2017 -0300

    Bug 7317: Handle backend absense more gracefuly
    
    5/ This patch makes Koha::Illrequest->load_backend raise an exception
    if the passed backend is invalid. This way we will catch more errors introduced.
    
    The patch also disables the 'New Ill request' when no backends are available. Gets
    rid of a related warnings.
    
    Both OPAC and Intranet now display a warning message when no backends
    are available.
    
    Tests are added for the load_backend changes.
    
    4/ This patch fixes the path for the checkboxes jquery plugin, and removes the include
    for tablesorter, as this implementation uses Datatables. This is obviously code for older
    Koha, ported to master.
    
    TODO: There's something wrong on the styling. My idea is to get rid
    of the custom column visualization tool, and have it display as regular
    DataTables. We can then introduce the use of colvis on a separate bug
    report.
    
    Note: POD coverage for the exceptions file is wrongly tested. It is a false positive.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66727e6c688f5cc61243c8e789ff82bab5b98fae
Author: Magnus Enger <magnus@libriotech.no>
Date:   Tue Oct 31 12:07:00 2017 +0000

    Bug 7317: QA followup
    
    This fixes some of the issues reported by the QA script, but not all.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fafb8bd947884ebf4893a4102fe3b84bf470ac2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 25 15:34:34 2017 -0300

    Bug 7317: Rewrite atomicupdate file
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e3c106b83abb4fc17ff4e559fda04c8b8d37135
Author: Magnus Enger <magnus@libriotech.no>
Date:   Wed Oct 25 11:52:26 2017 +0200

    Bug 7317: (followup) Fix id and class on body tag
    
    The HTML body tag looked like this:
    <body id="acq_suggestion" class="acq">
    Probably an overlooked copypasta. This patch changes it to:
    <body id="illrequests" class="ill">
    This should not have any visual side effects.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba139ec880e06215f6fe1dec9dfa50c8be0d751a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 24 14:16:02 2017 -0300

    Bug 7317: Adjust packages koha-conf.xml
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Original sign off message:
    It's impossible to give a test plan for this...
    I have implemented a "plugin" for Norwegian ILL (based on NCIP):
    https://github.com/Libriotech/koha-illbackend-nncipp
    Several issues have been discovered while writing the plugin, and
    Alex has fixed them along the way. Currently I do not know about
    any funcional issues, and I am happy to sign off.
    
    Update:
    I have applied the new patchset and done some exploratory testing,
    using the Dummy backend. Everything seems to be fine after the
    patches were re-arranged and with the followups from Tomas.
    All tests pass.
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c99e814a6fd5b9e05deaa0adc4fbe8e37aef58fd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Oct 23 15:34:01 2017 -0300

    Bug 7317: (followup) Migrate endpoint to OpenAPI
    
    This patch moves the current endpoint implementation from Swagger2 to
    the OpenAPI plugin.
    
    It also takes advantage of the overloaded Koha::Illrequest::TO_JSON method
    which has now the option to embed what's needed for the REST api.
    
    The path spec is adjusted to fit OpenAPI, and some minor fixes are
    applied:
    - Missing 'metadata' query param
    - 'ill' permissions should be required instead of 'borrowers'
    - Full test coverage
    
    To test:
    - Apply  this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/api/v1/illrequests.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81df964bbd0337df0a202cbec2fc96a2cba3ec33
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 24 13:43:51 2017 -0300

    Bug 7317: Overload Koha::Illrequest::TO_JSON
    
    This patch implements an overloaded TO_JSON method, that introduces
    the option to (selectively) embed information required on the REST
    api.
    
    Tests are included for the new method.
    
    To test:
    - Apply this patch
    - Run:
      $ kshell
     k$ prove t/db_dependent/Illrequests.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d971d15b57579c2185397b565cdc33eecdd1020
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Oct 23 15:33:17 2017 -0300

    Bug 7317: (QA folowup) 404 if module is disabled (intranet)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e86b5e0935ccec38ec543e36d1b571bb8b23354
Author: Alex Sassmannshausen <alex.sassmannshausen@ptfs-europe.com>
Date:   Fri Feb 3 16:58:35 2017 +0100

    Bug 7317: Interlibrary loans framework for Koha.
    
    This Commit is at the heart of adding an interlibrary loans framework
    for Koha.  The framework does not prescribe a particular workflow.
    Instead it provides a general framework that can be extended &
    implemented by individual backends whose responsibility it is to
    implement a specific workflow.
    
    The module is largely self-sufficient: it adds new tables to the Koha
    database and touches only a few files in the Koha source tree.
    
    Primarily, we add our files to the Makefile and the koha-conf.xml,
    define ill paths for the REST API, and introduce links from the main
    intranet, opac pages & user permissions.
    
    Outside of this we simply add new files & functionality.
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a1ff8534a1ddd54fdd6669ef8f8283af375c0b0
Author: Alex Sassmannshausen <alex.sassmannshausen@ptfs-europe.com>
Date:   Thu Sep 22 16:20:14 2016 +0200

    Bug 7317: Add SQL templates & sysprefs.
    
    * installer/data/mysql/atomicupdate/ill_tables.sql: New file.
    * installer/data/mysql/kohastructure.sql: Add tables.
    * installer/data/mysql/sysprefs.sql: Add sysprefs.
    * installer/data/mysql/userflags.sql: Add userflags.
    * koha-tmpl/intranet-tmpl/prog/en/modules/admin/preferences/admin.pref:
      Add sysprefs to UI.
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Benjamin Rokseth <benjamin.rokseth@kul.oslo.kommune.no>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14151769028a8d5304de0e18e81cc43ae9164344
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 8 14:34:13 2017 -0300

    Bug 18882: (follow-up) DBRev 17.06.000.027
    
    No idea how I did that...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecb65def5a33e6a40da0a6ddc21a7f28b5b74daa
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 3 08:50:08 2017 +0100

    Bug 18894: (QA follow-up) POD changes
    
    Add limit parameter to POD section.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58bc11a7d4e50d1f2ce7b09dbb512f3a576f5a61
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jul 5 10:33:16 2017 -0400

    Bug 18894: Add ability to limit the number of messages sent by process_message_queue.pl at a time
    
    Having the ability to limit the number of messages sent by process_message_queue.pl on a single run would be very useful for controlling home many messages are sent at a given time. This can help prevent too many messages being sent out at once and getting flagged as a spammer.
    
    Test Plan:
    1) Apply this patch
    2) Generate some number of messages in the message queue
    3) Run process_message_queue.pl with the new --limit option,
       set limit to a number smaller than the number of pending messages
    4) After the script has run, check the database and note that only
       a number of pending messages were sent, and that the remaining amount
       of pending messages is the original amount less the number specified
       as the limit
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cd88847ae12f461ff134c3ee2a545e59bb7520b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 3 08:24:15 2017 +0100

    Bug 19537: (QA follow-up) Consistent structures
    
    The subfield_loop structure should contain things like:
    $VAR1 = {
              'marc_subfield' => 'v',
              'marc_values' => [
                                 'form'
                               ]
            };
    
    This patches replaces the list by an array ref to restore consistency,
    although Template Toolkit does not really care. Both work.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4927671b15d6d1f95a84257ef293872e1c0c9665
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 27 10:43:03 2017 +0000

    Bug 19537: Correct addition of source subfield from authorities
    
    To test:
    1 - Find or create a subject authority
    2 - Define 008/11 as 's' or 'r'
    3 - Add 2nd indicator '7' to main heading
    4 - Open or create a bibliographic record
    5 - Link to the authority created above
    6 - Subfield $2 is not set
    7 - Apply patch
    8 - Repeat linking, subfield $2 should be set
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 493df11102953c4115b38248964f19bc18911236
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 8 13:33:40 2017 -0300

    Bug 18882: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d701fe12d6011ef6a6d1792fb608b3654f168b3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 8 13:31:06 2017 -0300

    Bug 18882: DBRev 17.06.000.027
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8db65715fa2c769d4f2166cbb2b9c39352cfdc79
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jun 30 10:37:14 2017 -0400

    Bug 18882: (QA follow-up) Ensure stats with no or undef location are set to NULL in db
    
    Confirm that only NULL or a string are in the location field of the
    statistics table. Test with two items, one with shelving location set,
    and one without it set.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fd0555ae828972a7268c56a4f5e56a4a681aa2b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 29 11:10:18 2017 -0400

    Bug 18882: Add location code to statistics table for checkouts and renewals
    
    Some libraries wish to track what the current location of items was at the time they were checked out. This will help libraries track which physical locations in the library patrons are more likely to check out a given book from.
    
    Test Plan:
    1) Apply this patch
    2) Run updatedatabase.pl
    3) Check out an item that has a location set
    4) Renew that item
    5) View the checkout and renewal in the statistics table,
       verify each has the location column populated correctly
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aeacde0ac7e38d0ca92f005fae36355aae740d3d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Nov 6 11:28:46 2017 +0100

    Bug 19420: (QA Follow-up) Change in error reporting affects upload.pl
    
    The change from the first patch requires a similar change in upload.pl
    when a few error codes are passed to the template.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested by deleting a temporary file manually and downloading or deleting
    the file from the upload search results.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c9f01f1758fafe3cd8dbe58cf7482df7b30d761
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 3 10:33:00 2017 +0000

    Bug 19420: (Follow-up) Add errors on other pages
    
    Fix error array (add '0' value)
    Update errors on other places using upload.js
    
    Eventually these should all be using the same code in a js file
    
    upload.tt already dealt with these errors, but has diff code, made it
    work with new error syntax
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Removed the added js comment in upload.tt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b25cb7ab0f3ff892a273d4d8300483afee414fa3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 3 10:19:57 2017 +0100

    Bug 19420: (QA Follow-up) Fix test, correct POD
    
    The test needs the code level in the error hash now.
    And POD is adjusted accordingly.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcfe9844ec5fbb95a42e8140a6b7e9310f15df84
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 19 10:39:23 2017 +0000

    Bug 19420: Improve display of errors from failure of uploading file during stage import
    
    To test:
    1 - sudo chown www-data:www-data /tmp/koha_kohadev_upload/ (or your
                    relevant dir and user)
    2 - Attempt to stage a file
    3 - Error message is: Upload status: Failed
    4 - Apply patch
    5 - Repeat upload
    6 - Error is now: Failed - Directory is not writeable:
    /tmp/koha_kohadev_upload
    7 - Trigger the other errors if you can and note better responses
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77ce1c6b7f8c0f4003df4493d8247d58e8405c86
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 8 13:28:50 2017 -0300

    Bug 10748: DBRev 17.06.000.026
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97c0b5a5dc5b5853e6f52506e104bbf701ec7c8d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Nov 6 09:43:02 2017 +0100

    Bug 10748: (QA follow-up) Add comment in SIP's do_checkin
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43ad66fb07d5f96ac725a8f21a1ef67a53c0461d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 3 13:27:12 2017 -0300

    Bug 10748: Add tests
    
    Sponsored-by: BULAC - http://www.bulac.fr/
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 529793d4aeab4def9c93c96011f0806cfdde3bc2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 4 20:54:24 2017 -0300

    Bug 10748: Add the ability to block return of lost items
    
    Mimicking what does BlockReturnOfWithdrawnItems we can easily add a new
    syspref to block return of lost items.
    This patch adds BlockReturnOfLostItems, if set to 'Block' a item marked
    as lost cannot be checked in.
    
    Test plan:
    1/ Set BlockReturnOfLostItems to 'Do not block'
    2/ Check an item out to a patron
    3/ Edit the item and mark it as lost (*)
    4/ Check the item in
    => The item is checked in
    5/ Edit the item and remove the lost status
    6/ Check the item out again
    7/ Edit the item and mark it as lost (*)
    8/ Check the item in
    => The item is not checked in
    
    (*) There are 2 ways to mark an item lost:
    - From the item list view (/catalogue/moredetail.pl?biblionumber=42)
    If you set the lost status from this form, the issue will be returned
    Maybe this should be optional (?)
    
    - From the edit items form (/cataloguing/additem.pl?biblionumber=42)
    It is the form you must use to not mark the issue returned.
    
    Sponsored-by: BULAC - http://www.bulac.fr/
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff82c9aadc441f9ca18dcad2e58783e733cdd839
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 3 13:50:27 2017 -0300

    Bug 19176: (QA follow-up) few cosmetic changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6d709dcc378aed0f00e13dbe590a5e43370b450
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Nov 3 09:58:28 2017 -0400

    Bug 19576: Remove extra 'use Koha::Biblios' statement
    
    Marcel noticed this while QA'ing another bug.
    
    TEST PLAN
    ---------
    Apply patch and confirm the page still loads and works as expected.
    Run Koha QA Test tools
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa4269777c5893a3f5ecdec65877c2cec88e3ba3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 27 07:49:51 2017 +0200

    Bug 17989: (QA follow-up) Replace bad dots in SuggestionEngine_ExplodedTerms.t
    
    SuggestionEngine_ExplodedTerms.t uses paths like /../.. or /.. in order
    to find a template in opac-tmpl.
    Sub badtemplatecheck does not like these paths.
    Using Cwd::abs_path to resolve the situation (rel2abs does not).
    
    Test plan:
    Run again t/db_dependent/SuggestionEngine_ExplodedTerms.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc0012de2eda1b9f077459df757fd82ea07ca343
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 25 15:32:01 2017 +0100

    Bug 17989: Final changes
    
    [1] The template sco/printslip.tt is in the regular modules directory.
    Should not be prefixed with a slash.
    
    Test plan:
    [1] Try to find another occurrence just like the one corrected in
        sco/printslip.pl where an absolute path is passed to gettemplate or
        get_template_and_user. I already tried several regex variations
        while git grepping template_name, but you may still find one..
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Removed the changes for svc/members/search. Not needed.
    Commit message adjusted accordingly.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdce98487884152549d5aee9e7fb684d54f82d06
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 26 13:14:13 2017 +0200

    Bug 17989: Resolve "verbatim paragraph in NAME section" warning in C4::Templates
    
    *** WARNING: Verbatim paragraph in NAME section at line 28 in file C4/Templates.pm
    
    Test plan:
    Run podchecker on C4::Templates and verify that the warning is resolved.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c510e1a92a4ed76de69748bbda91a33b5edd3cf
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 25 10:22:13 2017 +0100

    Bug 17989: Include full path logic in _get_template_file
    
    Similar to the full path test in sub themelanguage, this patch makes a
    change in _get_template_file. This allows you to pass a template
    outside the modules directory to get_template_and_user. (Note: the sub
    badtemplatecheck already blocks bad paths.)
    
    Especially, this would be helpful for plugins using templates. As can be
    seen in Templates.pm, a change was made earlier to overwrite the filename
    for a plugin in sub gettemplate. This exception can now be removed.
    
    Also note the small change in Koha/Plugin/Base.pm; mbf_path is already
    absolute and if we pass a full path, we do not need it. This allows use of
    a regular Koha template or a shared template between plugins (as long as
    badtemplatecheck allows the path).
    
    What are the side-effects of this change?
    [1] We should not pass absolute paths if we mean relative ones.
        A follow-up patch deals with one occurrence in the codebase.
        No regressions for regular use.
    [2] Plugins can call get_template_and_user directly or go via get_template
        in Koha/Plugin/Base (absolute paths don't go via mbf_path).
    
    Note: replaced two single quotes in Auth.pm to show template name in test
    description.
    
    Test plan:
    [1] Open some page on OPAC or staff client to trigger a template.
    [2] Run t/db_dependent/Auth.t to verify not allowing some bad templates.
    [3] Run t/db_dependent/Templates.t to verify an absolute path.
    [4] Run t/db_dependent/Plugins.t to verify using templates in a plugin.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7703723508195ca116e2ea7d766ff741149d2efc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 30 09:24:22 2017 +0100

    Bug 17989: Extend bad template check
    
    The check is now extended by only allowing templates from the regular
    Koha template directories and additional plugin directories as defined
    in koha-conf.xml.
    
    Note: In order to prevent an uninitialized warning on $theme from sub
    themelanguage for a not-existing file, I added a trivial assignment. Will
    get further attention in a follow-up.
    
    Test plan:
    [1] Run t/db_dependent/Auth.t
    [2] Run t/db_dependent/Templates.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 411d0cf8ead451099704237549a899bb216aece3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 30 08:43:45 2017 +0100

    Bug 17989: Centralize bad template check
    
    The bad template check in get_template_and_user can be removed, since
    this check has been added in gettemplate on bug 18010.
    
    The check moves here to a new sub in C4::Templates. And will be extended
    in a follow-up.
    
    Removed unused variable $path in gettemplatefile.
    
    Test plan:
    [1] Run t/db_dependent/Auth.t (get_template_and_user bad calls).
    [2] Run t/db_dependent/Templates.t (bad call to gettemplate).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 264f69651091350d588a2fa8f2ff05f006126096
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 31 13:25:13 2017 -0300

    Bug 7143: Update 'Koha development team' list
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 844dc871ffc0c664e22be6b14a99a3016580646d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 31 13:09:47 2017 -0300

    Bug 7143: Make about.pl knows about the new epoch column
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1577937057cfeb11419e8c744bf5eaa22cbe5a16
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 31 12:53:12 2017 -0300

    Bug 7143: Add missing entries
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7835ff9780a011476f5cd2438205619f91508b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 31 11:19:09 2017 -0300

    Bug 7143: Add a new "Epoch" column to the history.txt
    
    To allow sort easily. It also fix a few typo and remove 1 duplicated line
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84020230ebee553bccf4bfd895719806a7d211f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 30 11:14:53 2017 -0300

    Bug 19539: (follow-up) Fix column index shift in cirulation rules
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63b7017bd36c80a80fb6e66edf8ee538e1bb38ed
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 27 11:12:57 2017 -0300

    Bug 19539: Fix column index shift in cirulation rules
    
    This patch fixes an index shift introduced by bug 18857 when it introduced
    a new column.
    
    To test:
    - On the Circulation and fine rules page
    - Empty the value of 'Current on-site checkouts allowed' and save
    - Notice 'Unlimited' shows on the saved rule.
    - Click edit
    => FAIL: the 'Unlimited' string displays instead of the empty string on the editing row.
    - Apply this patch
    - Re-open the circ rules page
    - Click edit
    => SUCCESS: An empty string fills the 'Unlimited' fields
    - Sign off :-D
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 888a97f15b3c1c6f89311c726793c6cab14850b4
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Oct 30 14:41:47 2017 +0000

    Bug 19176: Fix how t::lib::Dates::compare handle timezone
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 211dafc6505bbaa9bf6bbc4704937e4c7fed4fa2
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Oct 23 22:29:24 2017 +0000

    Bug 19176: followup - fix POD in t/lib/Dates.pm
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0e737f43a8eec253e81ad06a8be24730fcf61fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 23 11:38:58 2017 -0300

    Bug 19176: Reduce the number of seconds to 5
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfcb2b8071582a55e35c47926d4b5c1b8b2a9a59
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 25 17:56:52 2017 -0300

    Bug 19176: Compare the number of seconds when comparing dates in tests
    
      #   Failed test 'borrowers.updated_on should have been set to now on creating'
      #   at t/db_dependent/Patrons.t line 74.
      #          got: '2017-08-10T20:53:03'
      #     expected: '2017-08-10T20:53:04'
      # Looks like you failed 1 test of 17.
      [20:53:15] t/db_dependent/Patrons.t .....................................
    
    The plan here is to compare the number of seconds between two dates.
    If < 60 the dates are consired as identicals.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 790150b31277e6ded86823add0385c5960a4876e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Aug 2 10:35:49 2017 +0200

    Bug 19021: Fix Inventory columns sorting
    
    In inventory result page, items are shown in a JS DataTable.
    For an inventory with barcode file second column is not sortable for no reason.
    For an inventory without barcode file first column is not sortable but since it is the default sort order the sorting icon is still displayed.
    
    This patch corrects by setting default sort order on callnumber column.
    
    Test plan :
    - perform inventory with barcode file
    - look at result table
    - table is sorted by callnumber
    => Without patch second column is not sortable
    => With patch all columns are sortable
    - perform inventory without barcode file
    - look at result table
    => Without patch first column show sort icon and table is not sorted by callnumber
    => With patch first column is not sortable and table is sorted by callnumber
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41a4a1d0dfcfab069eaca1c09e3645e960e92b8b
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Mon Jul 10 12:44:14 2017 +0100

    Bug 18920: Save DB_USE_TLS and FONT_DIR to install log
    
    Configuration values should be included in the koha-install-log
    so that when running Makefile.PL with the --prev-install-log option
    values can be read from there and reapplied rather than prompting
    the user on each subsequent run.
    This adds FONT_DIR and DB_USE_TLS (and its dependent options) to
    koha-install-log so that the set values will be written by make
    during a make install or make upgrade
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09a49bc96734af8d7615a1c7b024ff69ee2df04c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 15:33:14 2017 -0300

    Bug 19377: (follow-up) Remove charge for 'books' in ru-RU sample data
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dbc12ccede6fa5251bd8abc428ee6fa51cf19fa
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 7 00:20:40 2017 +0000

    Bug 19377: (follow-up) Remove charge for 'books' in all sample data
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcb87888deef5e032ce02882e14afc529b4d11fc
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Sep 28 13:00:27 2017 +1000

    Bug 19377: Remove $5 charge from sample item types
    
    Most of the sample item types come with a rental charge of $5.
    This is really annoying when you're testing Koha with a fast catalogued
    book, since you end up having to write off fines and change the item
    type before you can actually get to the testing you want to do.
    
    I left the rental charge on most other items so that you can test
    rental charges easily by using a item type other than BOOK or REF.
    
    _TEST PLAN_
    
    Before applying
    1) drop your test database
    2) create your test database
    3) install Koha via the web installer and install all sample data
    4) do a checkout
    5) note a $5 rental charge
    
    After applying
    1) drop your test database
    2) create your test database
    3) install Koha via the web installer and install all sample data
    4) do a checkout
    5) note no $5 rental charge
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Applied the patch and looked at the change to the SQL-file. Looks
    good. That fine on books has surprised me one too many times! :-)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f6bab669e5717b2907cb4c4e8644e512fe98006
Author: Marc Véron <veron@veron.ch>
Date:   Thu Sep 7 17:31:12 2017 +0200

    Bug 19274: Translatability: Fix new splitting problems related to database warnings
    
    The warnings about database problems introduce new translatability problems,
    mostly related to sentence splitting by html tags.
    
    To test:
    - Verify that text changes make sense
    - Apply patch, verify that messages properly.
      Note: To force display you might want to add '1 ||' to the related
      if statements, including line 134,  e.g. [% IF 1 || has_ai_issues %]
    - Bonus test: Go through an translation cicle and verify that fragemts as
      mentioned in initial comment are gone.
    
    (Amended to fix tiny typo)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f501ba31cc81c26829086dc4a47016996371d9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 15:29:22 2017 -0300

    Bug 19231: No need to pass the size to the template
    
    We have the array already, we just need to call .size on it
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eba92195b6fef397918eb9b94a7782ecbf3878df
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Aug 31 22:02:05 2017 +0000

    Bug 19231: Add number of attached items to confirm message when deleting course
    
    To test:
    1) Ensure UseCourseReserves is enabled
    2) Go to Course Reserves and create 3 new courses
    3) Add one item to a course, add two items to another course, and add no
    items to the third course
    4) Delete the course with no items. Confirm the error message shows up.
    No need to say how many attached items there are here (because there are
    none).
    5) Delete the course with one item. Confirm the error message shows and
    warns of the one attached item and makes grammatical sense
    6) Delete the course with two items. Confirm the error message shows and
    shows the correct number of attached items and makes grammatical sense
    7) Confirm clicking 'Cancel' and 'OK' does what is expected
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Looks good!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fe241f6100bd7ffc967fcc8e76659e9d861750b
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Aug 30 23:35:57 2017 +0000

    Bug 19212: Preventing warns when asking for discharge
    
    To test:
    1) Ensure the useDischarge syspref is enabled
    2) Log in to OPAC
    3) Go to 'ask for a discharge'
    4) Notice warns
    5) Apply patch and refresh page
    6) Notice warns are gone
    
    Sponsored-by: Catalyst IT
    
    Warnings reproduced in plack-error.log, with patch they are gone.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf493b9b120447e3964679d1b3573871c6801e77
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Aug 29 03:03:45 2017 +0000

    Bug 17039: Adding 'cancel' link and 'add new item' button to item edit form
    
    To test:
    1) Go the the detail page for a record on staff side
    2) Edit an existing item and scroll down to Save button
    3) Notice no easy way to add a new item or cancel out of the form
    4) Apply patch and refresh page
    5) You should now see a new button next to the Save button, 'Add a new
    item', and a link 'Cancel'
    6) Confirm clicking Cancel takes you back to the detail page for the
    record
    7) Go to edit an item again
    8) Change some fields/add some info to the item
    9) Click the 'Add a new item' button and a confirm box should pop up.
    10) Confirm that clicking 'cancel' does NOT take you to a new page, and
    your changes are still there
    11) Click the button again, and this time click 'OK'
    12) Confirm you are redirected to the 'add item' form
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc8c70b7452a524e9219b2da9dfe75f4e07ba087
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Aug 2 10:43:44 2017 +0200

    Bug 19022: inventory location and author display
    
    In inventory result page :
    Location is displayed after branch without any difference.
    Author is displayed into a paragraph making row hight.
    
    This patch adds for location a span with class like in catalogue detail page, and changes author to be on same line in order to have a more compact display for this table that may be huge.
    
    Test plan :
    - Perform inventory with a barcode file
    - Look at result
    => you see localtion in a new line after library and in italic
    => you see author after title on same line with "by" separator
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b95f5c28aa8568c9d6bae241a6c1635c6a773d08
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Sep 20 23:43:22 2017 +0200

    Bug 13796: (follow-up) Move renewal remaining statement back
    
    This moved the renewals remaining statement back out of the
    condition so it's visible always - with and without a rental
    fine on the item type.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3df0c9ac70621b2b434b47424cc9be2d2ba58bc4
Author: Marc Véron <veron@veron.ch>
Date:   Fri Apr 21 17:50:45 2017 +0200

    Bug 13796: OPAC: Display rental charge for renewing
    
    This patch displays the rental fee that will be applied for
    renewing (near "Renew" link on patron's summary page)
    
    To test:
    - Apply patch
    - Enable system preference 'OpacRenewalAllowed'
    - Verify that you have item types with and without rental fee
      for testing
    - Issue items with an without rental fee to a patron
    - In OPAC, display patron's summary page
    - Verify in table 'Checked out', items with rental charge display an information as
      appropriate (near the link 'Renew')
    
    Patch rewritten because of merge issues with previous patches. 2017-04-21 mv
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c094e2dc3413425f1ddfe6e518221749f9373c4
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Mon Oct 2 19:06:23 2017 +0300

    Bug 19400: Reminder to unset gone no address flag after patron makes a modification request
    
    Our librarians requested a reminder to unset "gone no address" flag from patron's
    record once the patron has made a modification request to update their address.
    
    I propose adding a message box under patron modification request to notify
    librarians about patrons that have gone no address flag on, and an option to
    unset the flag without the need of having to navigate into patron's details.
    
    To test:
    1. Apply patch
    2. Set "Gone no address" flag for your test patron. You can do this by going
       to patron modification screen in staff client.
    3. Go to OPAC with your test patron
    4. Make a modification request for your personal details
    5. Go to staff client and see pending modification requests
    6. Open the request you just created
    7. Observe a message dialog that says this patron has gone no address flag set
    8. Check the checkbox to unset the flag and approve the modification request
    9. Click Submit
    10. Observe your test patron no longer has gone no address flag set
    11. Repeat steps 2-7
    12. Do not check the checkbox, but approve the modification request
    13. Observe your test patron still has gone no address flag set
    14. Remove the gone no address flag from your test patron
    15. Repeat steps 3-6
    16. Observe there is no message dialog for gone no address
    
    Followed test plan, patch worked as described. Also ran QA test tools
    and all modified files passed
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9daf668ca3ddda59114d628d1188ab53dec848ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 14:32:40 2017 -0300

    Bug 14919: Remove notificationdate and reminderdate
    
    These columns are not used, we do not need to display them
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b20db441fef5bd19cb48245458eb1f4e5ef3ba28
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Oct 27 09:23:02 2017 -0400

    Bug 14919: (QA follow-up) Make script executable, fix typo
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f20a694f1332edfba9dc204a67f8594e23346166
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Oct 14 20:21:51 2017 +0000

    Bug 14919: (follow-up) Changed status from 'in queue' to 'pending'
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ac50443001dd56c96808ea73d565ac20c540669
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Oct 12 08:40:43 2017 +0200

    Bug 14919: (followup) Show accurate status in holds history
    
    This patch fixes the status showed in holds history table.
    
    The determination of status is following:
    
    1. "hold.found is 'F'" - Fullfilled - the hold was fullfilled by checking the
    item to patron. If hold reaches this state, it can't changed status
    anymore, or be cancelled, that's why this goes first
    
    2. "hold.cancellationdate is filled" - When the hold is cancelled, its
    eventually waiting or in transit status remains the same, only
    cancellation dat is filled, so this has to go second
    
    3. "hold.found is 'W'" - Hold is waiting
    
    4. "hold.found is 'T'" - Hold is in transit to target library
    
    Test plan:
    0) Apply the patch
    2) Read the status determination note in this commit message and confirm
    it makes sense
    1) Have patron/patrons with at least one hold in every status
    2) Go to holds history page and confirm it show the right status
    3) Try to break the status determination ;)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7dcd30d1d8c0375bf57c69b91cbf4e73e000bd46
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Oct 7 22:36:11 2017 +0200

    Bug 14919: (follow-up) Fixing some typos and adding to pref description
    
    - Adds 'holds' to pref description of intranetreadinghistory
    - Fixes typo in link to holds history from patron account
    - Changes reserve date to hold date in table heading
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fa34acc414a1580019df62c28bb39bb6d9f3e85
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Oct 6 13:35:46 2017 +0000

    Bug 14919: Add holds history for patron
    
    Test plan:
    0) Have a patron with some current and old reserves
    1) Go to patron circulation page
    2) Notice, there is new item called "Holds history" in the left
    circulation menu
    3) Go to this page and confirm the data on this page are OK, and that
    ui does behave as expected
    4) Go to adminitration, columns setting, try to change the setting for
    holdshistory table and confirm it is taken into account on holds history
    page
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a0853ef67099a62b29c88da55f70862060748ec
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Oct 6 08:04:34 2017 +0000

    Bug 14919: Add Koha::Patron->old_holds subroutine
    
    Test plan:
    Run t/db_dependent/Koha/Patrons.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4a97bb5aefc2157586577c1c2c7f3331926dae0
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Oct 6 08:03:56 2017 +0000

    Bug 14919: Add test for Koha::Patron->old_holds subroutine
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e7b093a103c95542ed24bdf6cb9d12c19048d04
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 14:57:46 2017 -0300

    Bug 19069: (follow-up) Remove perlcritic error
    
    Subroutine prototypes used at line 6, column 1.  See page 194 of PBP.
    (Severity: 5)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d677ef82f44d44d8533a6fddb14952c60cd88b8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 13 15:16:59 2017 -0300

    Bug 19462: Add koha-elasticsearch documentation
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3cb853ed8feda20b0f619278026aed283d7fa2e5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 13 15:11:07 2017 -0300

    Bug 19462: Add a koha-elasticsearch command
    
    This patch adds a new command to be used for Elasticsearch-related
    tasks.
    
    The current implementation only offers the --rebuild action switch,
    that allows reindexing Elasticsearch on a per-instance basis as we are
    used to with the rest of the koha-* commands.
    
    Other options could be added in a future: --status (ES server status
    report, etc).
    
    To test:
    - Apply the whole patchset
    - Have a suitable Koha+Elasticsearch setup [1]
    - Run:
      $ reset_all
    - Run:
      $ man koha-elasticsearch
    => SUCCESS: A pretty man page is displayed covering all options
    - Run:
      $ sudo koha-elasticsearch blah
    => SUCCESS: The script fails because blah is not a valid instance name
    - Run:
      $ sudo koha-elasticsearch -v kohadev
    => SUCCESS: Reindex happens!
    - Try the -a, -b and -c option switches
    - Sign off happily :-D
    
    Sponsored-by: ByWater Solutions
    
    [1] This is straightforward if you are using KohaDevBox and created the
    box using: $ KOHA_ELASTICSEARCH=1 vagrant up
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9a7333833dbfa4e5f5514afb4654981a7691336
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Sun Jan 1 07:17:55 2017 +0000

    Bug 17467: Restart failing, missing instance parameter
    
    This follow up should make it work. Perhaps there is a more
    elegant way, but wanted to generate something that works.
    
    Before this patch, the --restart stops Zebra, but does not
    restart it. After, it does restart.
    
    Before this patch, the --status gives nasty long help.
    After this patch, reasonable output.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a1120c9ddccb8bb96c030ef906a93f6f84091b2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 19 15:54:52 2016 -0300

    Bug 17467: Add tab-completion for koha-zebra
    
    This patch adds tab-completion for bash, for the koha-zebra script.
    
    To test:
    - Run (on the vagrant user):
      $ source kohaclone/debian/koha-common.bash-completion
    - Run:
      $ sudo koha-zebra -<TAB>
      (<TAB> means press the tab key)
    => SUCCESS: Tab completion works as expected for the koha-zebra command.
    - Sign off :-D
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8003dde3c9014101273902405514d7ca8bee76ea
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 19 11:24:01 2016 -0300

    Bug 17467: (follow-up) Make the install script install koha-zebra
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc0cf2b4562eb8da53fbfb10460e5cb440b57c0b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 18 17:11:55 2016 -0300

    Bug 17467: Add koha-zebra documentation
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6197f92a3f88db2b727f1ece9b4687064aa21f13
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 18 16:23:20 2016 -0300

    Bug 17467: (follow-up) Make koha-zebra handle legacy script names
    
    This patch adds the new koha-zebra script the ability to handle being
    called by other script names, for backwards compatibility with the legacy
    koha-*-zebra scripts.
    
    It is intended to be used in conjunction with a patch that replaces the old
    koha-*-zebra scripts for symbolic links, pointing to the new koha-zebra script.
    
    To test:
    - Apply this patch
    - Create symbolic links to the new script:
      vagrant@kohadevbox:~$ ln -s kohaclone/debian/scripts/koha-zebra koha-start-zebra
      vagrant@kohadevbox:~$ ln -s kohaclone/debian/scripts/koha-zebra koha-stop-zebra
      vagrant@kohadevbox:~$ ln -s kohaclone/debian/scripts/koha-zebra koha-restart-zebra
    - Run:
      $ sudo ./koha-start-zebra kohadev
    => SUCCESS: Same behaviour than the koha-start-zebra script
    - Run:
      sudo ./koha-stop-zebra kohadev
    => SUCCESS: Same behaviour than the koha-stop-zebra script
    - Run:
      sudo ./koha-restart-zebra kohadev
    => SUCCESS: Same behaviour than the koha-restart-zebra script
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d1d3cd7fe5e7bec6fcb92f5553e4229b6d57f16
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 12 18:54:07 2016 -0300

    Bug 17467: Add koha-zebra script to handle Zebra daemons
    
    This script is intended to replace the following currently used scripts
    on packages setups:
    - koha-start-zebra
    - koha-stop-zebra
    - koha-restart-zebra
    
    It also introduces a --status option switch, for asking for daemon statuses
    
    To test
    
    - Apply the patch
    - Run:
      $ sudo debian/scripts/koha-zebra --start kohadev
    => SUCCESS: same behaviour than koha-start-zebra kohadev
    - Run:
      $ sudo debian/scripts/koha-zebra --stop kohadev
    => SUCCESS: same behaviour as koha-stop-zebra kohadev
    - Run:
      $ sudo debian/scripts/koha-zebra --restart kohadev
    => SUCCESS: same behaviour than koha-restart-zebra kohadev
    - Run:
      $ sudo debian/scripts/koha-zebra --status kohadev
    => SUCCESS: It correctly shows the status for the running (or not) process
    
    Play with different combinations of this commands
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22249e4ceda925792a62c203b16bac3c4e35a1af
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jul 11 15:36:54 2016 +0000

    Bug 16899: Add ability to disallow overpayments
    
    Some SIP services ( such as Comprise ) require that an attempt at
    over-paying a patron's account via SIP2 should fail, rather than create
    a credit on the account. We should make this a configurable option on a
    per-login basis in the SIP2 config file.
    
    Test Plan:
    1) Apply this patch
    2) Enable the new parameter
       disallow_overpayment="1"
       for the login to be used in this test.
    3) Restart your SIP server
    4) Create or find a patron with fines
    5) Attempt to send a payment via SIP for more than what the
       patron's balance is
    6) Note the response indicates a payment failure
    7) Attempt to send a payment via SIP for the account balance or
       less
    8) Note the response indicates the payment has succeeded
    9) Verify in Koha that the payment was processed
    
    Signed-off-by: Rhonda Kuiper <kuiper@roundrocktexas.gov>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 377c9f15896e2ee4515f8b31a6424d5ec9d89f17
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 26 15:09:41 2017 +0000

    Bug 19178: Remove outdated sms/* scripts and related files
    
    Those files appear unmaintained and unusable with current
    Koha and should be removed.
    
    It appears at some point there was work done on a feature
    to send SMS messages to a phone number using a form in
    the tools area.
    This has never been documented, files and git history
    make it look like work remained unfinished.
    
    sms/sms_listen_windows_start.pl
    - targetted for Windows, which is not supported by Koha
    
    00-strict.t
    - reference to sms removed
    
    sms/sms_listen.pl
    - refers to a table sms_messages that doesn't exist
    - uses getmember() that doesn't exist
    
    sms/sms.pl
    - script calls routines that no longer exist in SMS.pm
      error_codes(), parse_phone(), write_sms()
    - template sms-home.tt is not accessible form anywhere
      in the templates
    
    sms-home.tt
    - see sms/sms.pl
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Makes sense. 00-strict.t runs OK after applying the patch.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6835760dcfa60abec027af3ff0cfafca8aea6f14
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 26 10:46:03 2017 +0000

    Bug 18389: (QA follow-up) Fix tabs, note used template, info on verbose
    
    Fixed whitespace for QA tools
    Added a verbose note when template found
    Only print 'Modifying MARC' if verbose
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab586abaee5efac2e5f7b652c5b226465698fb87
Author: Jon Knight <J.P.Knight@lboro.ac.uk>
Date:   Wed Aug 23 09:03:38 2017 +0000

    Bug 18690: Add error if there are multiple MARC templates with the same name
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff23e78f7b48e170b5b94864ff3639f8dd151b6a
Author: Jon Knight <J.P.Knight@lboro.ac.uk>
Date:   Tue May 30 18:12:15 2017 +0100

    Bug 18690: Use MARC modification templates with bulkmarcimport.pl
    
    When importing large numbers of MARC records from a legacy LMS to Koha
    using bulkmarcimport.pl, it did not make use of the MARC modification
    templates in the system (which can be useful for coversion of 852
    fields to 952 fields for item holdings for example). This patch allows
    MARC modification templates to be used with bulkmarcimport.pl.
    
    To test:
    1) Apply patch.
    2) Set up a MARC modification template (in Home > Tools > MARC
    modification templates) to make some changes to imported MARC
    records (for example copy a subfield).
    3) Take a test set of MARC records that have fields matching the
    template and import them using the bulkmarcimport.pl tool. For example
    if these MARC records are in testrecords.mrc and the MARC modification
    template is called testtemplate use something like:
    
       perl misc/migration_tools/bulkmarcimport.pl -commit 1000 \\
         -file testrecords.mrc -marcmodtemplate testtemplate
    
    4) Check the imported records in Koha to see that the required
    modifications have been applied when the MARC records are imported.
    5) Sign off.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 774b9d5fd8197ffb40096be89947b3d3efe61398
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 24 18:10:40 2017 -0300

    Bug 10267: Display the message only if the user enters too many characters
    
    It seems better to display the warning if the user tries to enter too
    many characters in the input.
    
    Test plan:
    With max=16
    1. Copy/paste a string with 15, 16 and 17 characters
    2. Enter a cardnumber of 15, 16, 17 characters
    The warning should be displayed only the input overflows
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit edaebf2565fd4e5840d98813f6077445aa9b6bd5
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Apr 20 03:35:47 2017 +0000

    Bug 10267: Show error message if user tries to enter too many characters for cardnumber
    
    This patch displays a message if the user tries to enter more than the
    max number of characters for a cardnumber.
    
    To test:
    1) Apply patch and go to Patrons -> New patron
    2) Scroll down to Card number
    3) Put in any characters. Notice that when you have entered the max
    number of characters, you are unable to type any more.
    4) Click out of the text field (so it loses focus), the error message will show up.
    5) if you backspace some characters and click out of the text field
    again, the message should disappear
    
    Sponsored-by: Catalyst IT
    
    Followed test plan, works as expected
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63a9c26fe5d5ec5b2ca1b5c7e61c78b4a26455bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 14:07:48 2017 -0300

    Bug 13178: DBRev 17.06.000.025
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae4d8942925d1515fdb759fdbf27bf4944c3b158
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 13:26:51 2017 -0300

    Bug 13178: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad1e2a517814b9cdb04dfed30b29d167b5304c85
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 24 15:04:32 2017 +0000

    Bug 13178: (QA follow-up) fix kohastructure and update info in fields
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 966b92a803f79082a10a9d84553f1f0b2d868024
Author: Baptiste Wojtkowski <baptiste.wojtkowski@biblibre.com>
Date:   Mon Jun 26 10:25:44 2017 +0000

    Bug 13178: Correct Max cardnumberlength
    
    ($max is the value of the max size of a card number)
    - $max not hardcoded anymore in C4::Memeber
    - $max now correctly adapts to the field of cardnumber in database
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99caf5329ba2fecd7296c0d85baf49ffb8d6cd81
Author: Baptiste Wojtkowski <baptiste.wojtkowski@biblibre.com>
Date:   Mon Jun 19 15:04:28 2017 +0000

    Bug 13178: increase max value of CardnumberLength
    
    testplan
    1 - Apply patch
    2 - Run updatedatabase.pl
    3 - Update dbix scheme
    4 - set the value of CardnumberLength to a value between 16 and 32
    5 - Check you can enter a propper cardnumber
    (modify to 32 instead 20)
    
    + max value now depends on the database field value to
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d25719d22312f300cde397e3a6d44ce496e998a1
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Aug 31 00:16:17 2017 +0000

    Bug 19216: Fix broken table in OPAC for when club doesn't allow public enrolment
    
    To test:
    1) Apply bug 19214 and bug 19215 to fix other issues with patron clubs
    2) Create a club template that DOES NOT allow public enrollment
    3) Create a club, enrol a user
    4) Log in as that user to the OPAC
    5) Go to 'your summary' and click the Clubs tab
    6) Notice the broken table with empty column
    7) Edit the club template to allow public enrollment
    8) Notice the table is fixed - so this bug is just when the club does
    not allow public enrollment
    9) Apply the patch
    10) Edit the club template to NOT ALLOW public enrollment
    11) Confirm the table in the OPAC is now fixed and does not leave an
    empty column
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f2d84316a445625c406ca22ceb692df01b5acd4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 27 09:30:17 2017 +0200

    Bug 17214: (QA follow-up) Print error message too in fallback case
    
    If the error code is not known or empty, provide the message too.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested this by adding a die on shelves.pl line 180 (my $added = eval ..)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70d72e3d9c072dd5e59c57026898bbd44fe7e1a7
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Apr 20 01:50:38 2017 +0000

    Bug 17214: Add records to lists by biblionumber
    
    To test:
    1) Apply patch and go to Lists
    2) Click on an existing list or create a new list
    3) Add items by barcode, confirm this functionality still works
    4) Trigger error messages (adding duplicate barcodes, barcodes that
    don't exist) to confirm they still show as appropriate
    5) Test adding by biblionumber, confirm this works as expected
    6) Trigger error messages (adding duplicate biblionumbers, biblionumbers
    that don't exist). Confirm wording is appropriate in messages.
    7) Add both barcodes and biblionumbers at the same time, confirm this
    works as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Israelex A Veleña for KohaCon17 <israelex19@gmail.com>
    Signed-off-by: Israelex A Veleña for KohaCon17 <israelex19@gmail.com>
    
    Signed-off-by: Harold <harold.sabanal@gmail.com>
    
    Signed-off-by: macon lauren KohaCon2017 <caballeromaricon@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 17214: [FOLLOW-UP] Using Koha::Biblios instead of GetBiblio
    
    Ready to test
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c27958e6bd711abf34021fdfdf9063567e1e292
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 14:05:14 2017 -0300

    Bug 2093: DBRev 17.06.000.024
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad790bed2df9254416d23418d1c9348516a0ae9f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Apr 29 05:04:38 2017 +0000

    Bug 2093: [Compiled CSS] Add OPAC dashboard for logged-in users
    
    This patch contains the CSS file compiled from LESS.
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    RM note: opac.css regenerated before push:
    lessc --clean-css="--s0 --advanced --compatibility=ie7" bootstrap/less/opac.less > bootstrap/css/opac.css
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 506d669424fd85edb7986fd045bde0821964bc1f
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Aug 2 23:25:35 2017 +0000

    Bug 2093: (follow-up) Add OPAC dashboard for logged-in users
    
    This patch:
    - hides the dashboard if there is no dashboard information to display
    - changes '5.00 due' to '5.00 due in fines and charges' for translation
    - uses Koha::Holds in place of deprecated C4::Reserves methods
    
    To test, confirm all the right information for holds still shows, and
    confirm the dashboard is hidden if there are no checkouts, holds, fines
    or overdues.
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffee02e41dc319d5656addc10c7a63ee4afada8d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Apr 29 04:57:42 2017 +0000

    Bug 2093: (follow-up) Add OPAC dashboard for logged-in users
    
    This patch adds some additional markup for applying styles to and the
    corresponding CSS.
    
    Also modified: Links to opac-user.pl should now open the correct tab.
    
    To test, apply the patch and compile the modified LESS file. Clear your
    browser cache if necessary. Follow the original test plan and confirm
    that the revised links work correctly.
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 657c417a87f356479c82b11a602006f4f9ab375c
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Apr 26 05:18:13 2017 +0000

    Bug 2093: Add OPAC Summary for logged-in users
    
    This patch adds a summary to the OPAC once the user has logged in that
    shows the users number of checkouts, overdues, holds pending, holds
    waiting and total fines. We also have a syspref OPACUserSummary to turn
    this feature on and off. Default is ON.
    
    To test:
    1) Apply patch and update database
    2) Set up some checkouts, overdues, holds pending AND waiting and fines
    for a user
    3) Log into OPAC as that user, see summary. Confirm links all work as
    expected
    4) Confirm that if there are no checkouts / overdues etc that the link
    disappears from the summary
    5) Turn OPACUserSummary OFF and confirm the summary does not show on the
    mainpage.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d6e33134e94f49513e999ab0ca1414ef0e66b4a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 26 12:18:04 2017 +0000

    Bug 19528: (QA follow-up) Adjust language for readability
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f7a6879b2df3cf52c56f4d75d020e34e60e7221
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 25 13:39:35 2017 +0200

    Bug 19528: Fix a few typos like corrosponding
    
    [1] Replace corrosponding => corresponding
    [2] Replace containts => contains
    [3] Replace item_level-itypes => item-level_itypes
    [4] Replace Managment => Management
    [5] Replace should returns => should return
    
    Test plan:
    Note that this patch only deals with POD lines or test descriptions.
    So there is nothing to test, just read the patch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Patch amended by RM: The release notes should not be modified
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64899db254375c39bd8e50583861a5e16f4616e8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 26 09:31:50 2017 +0200

    Bug 9031: (QA follow-up) Final changes to Calendar::days_between
    
    The crash is caused by comparing two datetimes where one datetime is
    floating and the other one was not. In that case the floating is
    converted. Note too that DateTime overloads comparison operators.
    
    This patch clones the two dates first. Puts them in floating both. And
    just after that starts comparing etc.
    
    Similar small change in hours_between.
    
    Adding a test where the parameters are swapped for days_between.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c398cfa37781dd71f0a6eedba0a466f4d6edbee9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 14 12:46:28 2017 -0400

    Bug 9031: Overdue items crossing DST boundary throw invalid local time exception
    
    To test:
    1 - Set TZ to America/New York
    2 - Checkout item and set due date to '2016-03-09 02:29:00"
    3 - Make sure fines are set for the item type, fine mode production,
      calculate fines on return
    4 - Check in item - invalid date time warning in logs
    5 - Apply patch
    6 - Check in item - no error
    7 - prove t/Calendar.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 9031: Use floating instead of UTC
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Squashed the changes for Calendar.pm; will add a follow-up to finally
    overcoming the crash on Invalid local time.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ac7f85375f9474c3f43b18ef6cead0c9a44d53f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 26 09:13:38 2017 +0200

    Bug 9031: (QA follow-up) Pass the same timezone in Calendar.t
    
    We do not need to change $ENV{TZ} or call tzset.
    Pass $tz too for the second date.
    Replace checking the datetime hash by delta calls.
    Replacing the number of minutes.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    We will still crash with:
    Invalid local time for date in time zone: America/New_York
    But the changes in Calendar.pm will now resolve that.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3c4ce01b36bacf1169bd1897bf7f22a4ab992a8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 7 13:03:39 2017 +0000

    Bug 9031: Unit tests for DST crossing in (days|hours)_between
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Without the patch for Calendar.pm, this crashes on:
    Invalid local time for date in time zone: America/New_York
    
    But even with the original change to Calendar.pm, I would see:
    Invalid local time for date in time zone: Europe/Amsterdam
    Adding a follow-up for that.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b4e0e697879a229b2fa213362ebee0f1a988eb2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 12:34:32 2017 -0300

    Bug 19493: Force scalar context to prevent future error
    
    If someone decide the reuse the template->param statement to pass values
    to the template, we will get the same issue.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a4b3aa9486e97cd247042d0e13e418570719be0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 18 16:03:57 2017 +0200

    Bug 19493: Remove few warnings from circulation.pl
    
    If you click Submit on the staff home page without entering a cardnumber, you will find these warnings in the log:
    Problem = a value of override_high_holds has been passed to param without key at /usr/share/koha/masterclone/C4/Templates.pm line 137.
    Problem = a value of nopermission has been passed to param without key at /usr/share/koha/masterclone/C4/Templates.pm line 137.
    Use of uninitialized value $val in concatenation (.) or string at /usr/share/koha/masterclone/C4/Templates.pm line 137.
    Problem = a value of  has been passed to param without key at /usr/share/koha/masterclone/C4/Templates.pm line 137.
    
    Cause is this call to $template->param:
    $template->param(
         CircAutocompl             => C4::Context->preference("CircAutocompl"),
         debarments                => GetDebarments({ borrowernumber => $borrowernumber }),
         todaysdate                => output_pref( { dt => dt_from_string()->set(hour => 23)->set(minute => 59), dateformat => 'sql' } ),
        has_modifications         => $has_modifications,
         override_high_holds       => $override_high_holds,
         nopermission              => scalar $query->param('nopermission'),
    
    In this specific case GetDebarments returns undef in list context (empty list),
    so all items in the list shift one place.
    Either we should force GetDebarments to return []; or we force scalar context in a construction like this. This patch does the last thing.
    
    Note: The calls in memberentry.pl and moremember.pl are not affected.
    
    Test plan:
    [1] Do not apply. Click Submit without cardnumber. Check the log.
    [2] Apply. Click Submit again without cardnumber. Check log.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 377bd10e0cb8c25d7f3201644b2bba4b732d4abf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 20 10:26:04 2017 -0300

    Bug 16660: (followup) Unit tests
    
    This patch adds unit tests for the introduced changes in
    build_query_compat.
    
    It removes a warning too.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 088cdcda5f0d3f2df15644a481b50fbf4eac9fd2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 18 21:00:44 2017 +0000

    Bug 16660: Add support for OpacSuppression to Elasticsearch
    
    To test:
    1 - Enable suppression
    2 - Suppress some records
    3 - Apply all the patches
    4 - Reindex ES
    5 - Search and don't get suppressed records
    6 - Disable suppression
    7 - Search and get all the records
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf6caa81e5dba170f75183caf3479c3d4856832a
Author: Srdjan Janković <srdjan@catalyst.net.nz>
Date:   Tue Feb 28 15:17:49 2017 +1300

    Bug 16660: Moved Opac Supression filtering from opac-search.pl to Zebra::QueryBuilder
    
    To test:
    OPAC: Both SearchEngine "Elasticsearch" and "Zebra" should work with
    OpacSuppression set to "yes"
    
    NB: OPAC suppression is not implemented for Elasticsearch
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27b99bb80b9f7bcf185c91d9fdb283813038ce71
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Dec 1 13:38:51 2016 +1300

    Bug 18118: Unexpected behaviour with 'GoogleOpenIDConnect' and 'OpacPublic' syspref combination.
    
    TEST PLAN
    ----------
    1/ configure a working 'GoogleOpenIDConnect' account
    
    See comment #5 which also links back to
    https://bugs.koha-community.org/bugzilla3/show_bug.cgi?id=16892#c3
    
    2/ set 'OpacPublic' (under OPAC) to 'Disabled' and
       'GoogleOpenIDConnect' (under Administration) to 'Yes'.
    
    3/ log in user successfully via google-auth, observe redirect to
       opac-user.pl (bad)
    
    4/ apply patch
       -- on kohadevbox remember to restart all! Plack is unforgiving. :)
    
    5/ log in user successfully via google-auth, observe expected
       redirect to opac-main.pl (good)
    
    While I would normally suggest running koha qa test tools, because
    this file doesn't end in .pl, it doesn't get picked up by them.
    
    6/ perlcritic -4 opac/svc/auth/googleopenidconnect
       -- notice this is a level better than required. :)
    
    This also eyeballs easily well.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb1c184b840610a7f40409ec801317acd700e406
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 18 16:00:34 2017 +0200

    Bug 19484: Add test before using object itemtype
    
    Patch applies and functions as described. I agree with you that importing NULL itemtypes is possible Marcel. A higher importance level makes sense.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30a0d4f6c97e783868128c051465722aefd95ac7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 25 17:29:16 2017 -0300

    Bug 19531: When saving patron record do not redirect to circ if not authorised
    
    If the logged in patron does not have the necessary permission we should
    not redirect to circulation.pl but moremember.pl instead
    
    Test plan:
    With the borrowers permission, you should be able to edit a patron and
    be redirect to the moremember page
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99e487bc7162cee4bb9a8916637f4e1ddd7ccc00
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 2 14:30:14 2017 -0300

    Bug 19389: Hide library groups pull down if empty
    
    Regression introduced by bug
      commit 141200794da9f27e0231e1c2dad4bcb994d650f3
        Bug 15295: Koha::Libraries - Remove GetBranchCategories
    
    The intranet advanced search page offers to search for groups of
    libraries, even if the pull down is empty as no library groups have
    been defined.
    
    Test plan:
    - Go to the adv search page at the intranet
    - Without library group you must not see the "Groups of libraries"
    dropdown list
    - With at least a library group you must see it
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdf85f5e39edeb1e2e85629044f1df25f56484f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 2 16:42:46 2017 -0300

    Bug 19069: Fix 'does not match' behaviour in MARC modification template
    
    The "does not match" condition does not behave as expected.
    We want it to process the action if the subfield exists and that the
    value does not match a given pattern.
    
    Test plan:
    Be creative and write different template actions using the "does not
    match" condition.
    Using the "Batch record modification" and the "Show MARC" popup, confirm
    that the processed record is the one you are expecting.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a70c38f38001ec34749c9f4cc38a4eef9d2ed04a
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed Oct 11 13:41:27 2017 +0000

    Bug 19029: (follow-up) Make security question appear on clone operations from one library to another
    
    Message pops up for all instances of cloning now.
    Works as expected.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83f97e662d77c99666c7873c947b91f9e8630a17
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Tue Oct 3 08:33:37 2017 +1300

    Bug 19029: (follow-up) Implemented .format() to ease translation
    
    Sponosred by: Catalyst IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 971591d4ee8576d6782d32610bbae7cfe4674231
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Thu Aug 24 21:25:40 2017 +0000

    Bug 19029: Add JavaScript security question for cloning circ rules
    
    This patch introduces a Javascript security question which is displayed
    to the user when they try to clone a circulation rule to a specific
    branch when the rule is a 'Standard rule for all libraries"
    
    The rationale for this patch is when the cloning takes place it
    overwrites the existing rules of the destination branch and there is no
    notification of this to the user. Therefore by implementing this patch
    the user is asked if they want to clone the rule (if the rule is
    standard accross all libraries) and are told that it
    will overwrite the rules in the destination branch.
    
    Test plan:
    1. Create a circulation rule for all libraries
    
    2. Make sure the 'select a library' option is set to 'Standard rules for all
    libraries"
    
    3. Click the 'Clone' button and notice that the cloning takes place
    without any warning that it will overwrite the rules of the destination
    branch
    
    4. Apply patch
    
    5. Return to the circulation and fine rules page
    
    6. Repeat step 2
    
    7. Click the clone button and notice a alert box appears asking if you
    are sure you want to clone the standard rule to the destination branch.
    
    Note: The name of the destination branch is included in the alert.
    Also note that the user is informed of the consequences of performing
    the action, i.e. that it will overwrite the existing rules in the
    destination branch
    
    8. Click 'Cancel' and notice that no cloning occurs
    
    9. Click the clone button again and this time click 'OK' and notice
    that the cloning takes place
    
    10. Return to the Circulation and fine rules page and set the 'Select a
    library' option to the name of an individual branch
    
    11. Click the clone button and notice that the clone action takes place
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a522df7dd97f5d7e646966d9b7f4f18fe8df7e2d
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Thu Oct 12 07:24:33 2017 +0000

    Bug 19443: Remove duplicate message when editing existing patron
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27fca7aceb91124c037bb3545c351d3cf185e7bf
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Tue Oct 10 15:21:35 2017 +0000

    Bug 19443: Wrong HTML in patron creation page (members/memberentry.pl)
    
    The form provided on top of the page if Koha find a duplicate
    patron is not closed. This cause some trouble.
    
    Test plan:
    
     - Edit the syspref IntranetUserJS and type the following code:
       "$(document).ready(function() {
        $("#memberentry_library_management").insertBefore("#memberentry_identity");
        });"
     - create a patron so that Koha will warn you about a duplicate one,
     - click on "Not a duplicate. Save as new record",
     - you should get error(s) about empty field(s).
       Note that now, the library management part's fields are empty or
       reset to default
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18809b137113c36115af1d165a3236901a42bc91
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 27 14:02:53 2017 -0300

    Bug 12363: DBRev 17.06.000.023
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58b6e957638418fea8d5a25e21da3530574db3e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 17 10:55:09 2017 -0300

    Bug 12363: Add a switch to mark|do not mark items as returned when lost
    
    There are several ways to mark an item an lost:
    - item list view (catalogue/moredetail.pl, "Items" tab)
    - cataloguing (cataloguing/additem.pl)
    - Batch item modification tools (tools/batchMod.pl)
    - The long overdue cronjob (misc/cronjobs/longoverdue.pl)
    
    So far only the cronjob is configurable, the others mark the item as
    returned (does the checkin).
    
    This behaviour should be controlable using a syspref, to let libraries
    choose what fit best for them.
    
    Test plan:
    Use the 2 options of the pref, mark checked out items as lost using the
    different possibilities, and confirm that the behaviours make sense to
    you
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 264432f701d47ae166258a0d412b9089a9e05efe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 17 10:54:33 2017 -0300

    Bug 12363: Add new pref MarkLostItemsAsReturned
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48be40d1bfaf13a70b6bf4918e885d9158e25f66
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Oct 10 12:05:16 2017 +1100

    Bug 18884: Advanced search on staff client, Availability limit not properly limiting
    
    Patch applies and functions as described.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f2d59e67b6d938ca2798fe8b7fc3ec6eda1d253
Author: Andreas Roussos <arouss1980@gmail.com>
Date:   Fri Oct 20 22:58:27 2017 +0300

    Bug 19503: Duplicating a dropdown menu subfield yields an empty subfield tag
    
    While editing a record in the staff client, if you clone a repeatable
    dropdown subfield the cloned subfield's tag is empty. This can result
    in data loss if the record is saved, re-opened, and saved yet again.
    This patch (originally written by Sophie MEYNIEUX for bug 17818) fixes that.
    
    Test plan:
    0) [PREREQUISITE] In your MARC framework (Home > Administration > MARC
       bibliographic framework) ensure that you have at least one subfield
       of a particular tag linked to an authorised value (e.g. in UNIMARC,
       tag 700 subfield 4 is 'Relator Code' and can be linked to CCODE for
       testing purposes). This is so that the relevant subfield will be a
       dropdown menu and not a textbox.
    1) In the Staff Client, edit an existing record or create a new one.
       Then, try to clone any subfield that is a dropdown menu. Observe
       that the cloned subfield's tag is empty.
    2) Apply the patch.
    3) Hit CTRL-F5 in your browser (to ensure cataloging.js is re-loaded)
       and try to clone a dropdown menu subfield again. This time the tag
       is cloned as well.
    
    Working as intended.
    
    Signed-off-by: Simon Pouchol <simon.pouchol@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    https://bugs.koha-community.org/show_bug.cgi?id=16503
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f2c1c879c0bdb920f00d968b6d25f3fd8635f95
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 4 17:49:51 2017 -0300

    Bug 19117: Add CSRF protection to paycollect.pl
    
    Security bug, trivial changes, no need to provide procedure for script
    kiddies.
    
    Test plan:
    Pay fines using the different options from the "Pay fines" tab.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4113dce705a700acf1d7d271a044d1f555d7c81
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Sep 13 03:44:19 2017 +0000

    Bug 18956: Fix empty to in message queue
    
    Follow the test plan in comment #20.
    Also tweaked string, because it was really 'or' before too.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended text in added comment.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6336e53aedabccf50481c68c45929d90a463b8dd
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 8 08:53:37 2017 +0200

    Bug 18956: (QA follow-up) Resolve a CGI::Param in list context warn
    
    From the plack-error.log:
    CGI::param called in list context from package CGI::Compile::ROOT::usr_share_koha_masterclone_opac_opac_2dpassword_2drecovery_2epl line 129, this can lead to vulnerabilities. See the warning in "Fetching the value or values of a single named parameter" at /usr/share/perl5/CGI.pm line 436.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e08a0afa264f55294bda4a5d949012ad60639616
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Aug 25 15:09:38 2017 -0400

    Bug 18956: Prevent leaking during password recovery
    
    TEST PLAN
    ---------
    
    It is assumed you have set the OpacResetPassword to 'allowed',
    and likely in combination with OpacPasswordChange to 'Allowed'.
    
    You will have two patrons: one with and another without
    any email address entered. You will want to test this test plan
    with both patrons.
    
    $ git checkout -b bug_18956 origin/master
    
    Prepend the following as understood between step sections:
    opac -> forgot password and then enter...
    
    correct login/cardnumber, it will email
    delete from borrower_password_recovery;
    
    correct email, it will email
    delete from borrower_password_recovery;
    
    correct login/cardnumber && correct email, it will email
    delete from borrower_password_recovery;
    
    wrong login/cardnumber && correct email, error page as expected
    delete from borrower_password_recovery;
    
    correct login/cardnumber && wrong email, error page as expected
    delete from borrower_password_recovery;
    
    wrong login/cardnumber && wrong email, error page as expected
    delete from borrower_password_recovery;
    
    submit empty -- INTERNAL SERVER ERROR?!
    delete from borrower_password_recovery;
    
    -- None of the above step sections displayed email.
    
    correct login/cardnumber, it will email
    
    correct login/cardnumber again, but it leaks email address!
    delete from borrower_password_recovery;
    
    correct email, it will email
    
    correct email again, but it leaks login/cardnumber!
    delete from borrower_password_recovery;
    
    $ git bz apply 18956
    -- choose interactive, and choose this counter patch.
    
    repeat the same test set again
    -- no leaks will occur, error message pages returned should
       be reasonable, code should read reasonably.
    
    run koha qa test tools.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 570eb4026642f71e462c7746a9c91721aa9334c1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 18 14:53:41 2017 -0300

    Bug 19333: Fix XSS in opac-shelves
    
    category is send back to the template, it must be escaped
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6b8e123917275fa483d35649071f5847a425aef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 26 15:40:24 2017 -0300

    Bug 17829: (follow-up) Move GetMember to Koha::Patron
    
    Do not call method on $patron if there is no other reserves
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dafb678b0b11393f189a5a75c1bcba7b8253bd9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 25 16:51:28 2017 -0300

    Bug 12768: (follow-up) DBRev 17.06.00.019
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96a3ee5e0699ebf388c6af841eef12d2901a7012
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 25 16:50:34 2017 -0300

    Bug 19038: DBRev 17.06.00.022
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d2cb42dceeeb004ab7447fd6beccab5fac37e23
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 1 12:19:46 2017 +0000

    Bug 19461: Add floating toolbar to staff client catalog search results
    
    This patch adds a floating toolbar to the staff client search results
    page, making all the various controls visible as the user scrolls down.
    
    To test, apply the patch and perform a catalog search in the staff
    client.
    
    - The toolbar should "stick" to the top of the page as you scroll down.
    - Controls in the toolbar should all work correctly:
    
      - Select all / Clear all
      - Highlight / Unhighlight
      - Add to Cart
        - Cart notifications should be positioned correctly
      - Add to list (and all list menu controls)
      - Place hold (including controls which are visible when
        a "Search to hold" has been initiated
      - Z39.50/SRU search
      - Sort
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cffc99cbe5957c32a9471ac81ec2cea56718207b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 24 15:19:47 2017 +0000

    Bug 19038: QA Followup - Hide barcode column by default (as syspref default is hide)
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e711c8e41847ab57ef84660047535ff44f747f97
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 4 18:38:58 2017 -0300

    Bug 19038: Remove the OPACShowBarcode syspref
    
    This patch removes the OPACShowBarcode syspref in favour of the new
    columns settings option introduced by bug 16759.
    
    On the upgrade step, it picks the value for OPACShowBarcode and uses it
    to populate the columns_settings table.
    
    To test:
    - Verify the upgrade process maintains the current behaviour
    
    Regards
    
    Sponsored-by: Dover
    
    Followed test plan and works as expected. Functionality of patch from bug 16759
    appears intact too.
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 667c07e0480825da10fa9dba4ae9e9625be51d99
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 25 13:16:53 2017 -0300

    Bug 19529: Prevent NoIssuesChargeGuarantees.t to fail randomly
    
    Use a categorycode != "X"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bf15a5f04acbf6cdda8ef645c9b5523197c9096
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 25 12:07:44 2017 -0300

    Bug 17381: DBRev 17.06.00.021
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bb8decf0122d67d20bd870d313b42bea63564fa
Author: Marc Véron <veron@veron.ch>
Date:   Mon Aug 21 15:27:20 2017 +0200

    Bug 17381: Add system preference SCOMainUserBlock
    
    This patch adds a system preference SCOMainUserBlock to display custom HTML
    on the self checkout page.
    
    To test:
    - Set up self checkout (see section Self Checkout in Circulaton sysprefs )
    - Apply patch
    - Update db
    - Add some HTML system preference SCOMainUserBlock
    - Go to sco page
    - Verify that HTML displays on page (logged in and not logged in)
    
    New version based on Koha.Preference TT plugin as of comment #7
    Depends on Bug 12691
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2b9b3f8312f4d33f0e9cecfccb125af7a05415c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 24 14:57:54 2017 -0300

    Bug 19028: DBRev 17.06.00.020
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit afcaccdad2fbbc98a332b065d186beaeb59b009f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 25 11:56:31 2017 -0300

    Bug 19028: Add a note to the pref description
    
    The idea was to keep the current behaviour, plus adding the option to
    display on a separate column.
    We need an explanation on the syspref description, stating that it is not enough to
    choose 'on a separate column', enabling the colum in the columns
    settings is required for it to take effect.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 662a98345a71fb170bc6ae5b3679e3edf4eee96f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 3 12:55:07 2017 -0300

    Bug 19028: Add 'shelving location' to holdings table in detail page
    
    This patch adds the option to show shelving locations on a separate
    column. This is controlled by a new syspref, 'OpacLocationOnDetail',
    which replaces 'OpacLocationBranchToDisplayShelving', adding a
    conveniente 'column' option.
    
    The new 'Shelving location' column is conveniently added to the columns
    configuration entry added by bug 16759 for this purpose.
    
    The current behaviour is preserved.
    
    To test:
    - Apply this patches
    - Run the upgrade:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ perl installer/data/mysql/updatedatabase.pl
    => SUCCESS: Upgrade doesn't fail
    - Have an item with shelving location set to something not void
    - Have the item set home and holding libraries for testing purposes.
    - Set 'OpacLocationBranchToDisplay' to 'home and holding libraries' [*]
    - Visit the OPAC detail page for the record containing the item
    => SUCCESS: Both home and holding libraries are displayed.
    - Loop through all OpacLocationOnDetail options (except from 'column', we leave it for later).
    => SUCCESS: Works as expected.
    - Go to Administration > Columns settings
    - Make item_shelving_location available in the OPAC section
    - Reload the OPAC detail page
    => SUCCESS: No change
    - Set OpacLocationOnDetail to 'on a separate column'
    - Reload the OPAC detail page
    => SUCCESS: Shelving location is displayed on a separate column
    - Sign off :-D
    
    Sponsored-by: Dover
    
    [*] For testing purposes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ecb68346c21bf5fbfb45e502b091aa13e78718a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 3 12:52:52 2017 -0300

    Bug 19028: Add OpacLocationOnDetail syspref
    
    This patch renames the 'OpacLocationBranchToDisplayShelving' syspref into
    'OpacLocationOnDetail' and adds it a fourth option, 'column', that makes
    the OPAC display shelving location on a separate column, instead of the
    library names (home, holding or both).
    
    Sponsored-by: Dover
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7827a941d45997db9d54c4f402257befc1c14082
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 25 10:55:12 2017 +0000

    Bug 16759: Use index of elements in specific table
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c089fa0373dc353fcb4ecaf7c8c360769ece9a74
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 24 19:19:09 2017 -0300

    Bug 16759: Handle the otherholdings tab gracefuly
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92f6f5b049cc6a45917465f87efa93d51ff81a4a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 28 16:28:08 2017 -0300

    Bug 16759: Make OPAC holdings table configurable
    
    This patch makes the holdings table in the OPAC biblio detail page
    configurable using the Columns configuration tools.
    
    This patch:
    - Moves the holdingst table from plain DataTable to KohaTable
    - Creates a sample yml colvis configuration for this table
      containing all the currently available columns
    
    To test:
    - Visit some record's detail page in the OPAC
    - Apply this patch
    - Reload
    => SUCCESS: The page shows the same information
    - On the staff interface, go to:
      Home > Administration > Columns settings
    => SUCCESS: There's a new OPAC section containing the configuration for
       holdingst.
    - Choose to hide some fields (both currently displayed and currently hidden).
    - Reload the OPAC detail page
    => SUCCESS:
       - Required fields are hidden
       - It doesn't explode because of trying to hide stuff that is not there to start with
    - Sign off :-D
    
    Sponsored-by: DOVER
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Followed test plan, patch worked as described. Also passed QA test tool
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ea5fc83d9ac700c580aed411db7a3c988cb6f8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 12 09:32:24 2017 -0300

    Bug 17277: Always display location and *branch item info - opac detail
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a9c905ff097003be6c7e6e87ae4b38866fe4a28
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 24 14:53:36 2017 -0300

    Bug 19513: Re-add AnonymousPatron-related tests
    
    These tests are still useful
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    The AddMember call is considerably slowing it down. A call to TestBuilder
    would be an improvement for performance.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02a42f92eddef8dae5e155cf5137782c2907b63c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 20 09:03:35 2017 +0200

    Bug 19513: More changes to MarkIssueReturned.t (after bug 19487)
    
    This patch was initially created as QA follow-up on 19487.
    
    $dbh is not used
    $categorycode is no longer used
    %item_branch_infos not used
    $borrowernumber is obsoleted by using $patron
    No real need for $anonymous_borrowernumber (Since MarkIssueReturned returns
    undef rightaway for an invalid itemnumber, the privacy stuff is irrelevant.)
    No AddMember calls, removing unneeded modules
    
    Adding a test that calls MarkIssueReturned on an item already returned.
    
    Test plan:
    [1] Run t/db_dependent/Circulation/MarkIssueReturned.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4bf488a2a13b77b76d216acf75234b36e5855f4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 24 12:12:52 2017 +0000

    Bug 18735: QA Followup - add class to new option
    
    New option creates a single item batch, this may cause issues for some
    libraries or they may want to disbale this feature. Adding a class to
    the list item allows it to be hidden easily
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d3353934347b81dded262e1d2d213e9f4302be8
Author: Nazlı Çetin <nazli@devinim.com.tr>
Date:   Thu Jun 29 16:24:21 2017 +0300

    Bug 18735: Print Barcode as soon as adding an item
    
    For testing
    1) Look for any records.
    2) Go to the material edit page.
    3) Under Actions you will see Print label under Duplicate.
    4) When you click Print Label, the relevant material will be redirected
    to the Label Creator module in the Tools menu.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab5c810dacd224444b4ee6f492715aa6027d33ab
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jul 17 22:22:55 2017 +0000

    Bug 18949: Adding thead tags to OPAC MARC details holdings table
    
    So that it can be styled alongside other tables in the OPAC.
    
    To test:
    1) Log into staff side
    2) Find OPACUserCSS syspref and add the following CSS:
    th,
    .table-bordered>thead>tr:first-child>th {
    color: red;
    }
    3) Log into the OPAC
    4) Go to your fines, your search history, your reading history etc -
    notice all of these table's headings are styled with red text
    5) Go to the detail page of an item, then the MARC view.
    Notice this table's headings are now styled with red text
    6) Apply patch and refresh page
    7) Your holdings table should now have red headings.
    (You can delete the CSS from OPACUserCSS if you'd like.)
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8de824115e553f1a1b02333223972f79bc717b62
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Apr 4 23:51:16 2017 +0000

    Bug 18184: Show frequency and numbering pattern info when viewing all subs attached to a biblio
    
    To test:
    1) Go to Serials, find a serial with more than one subscription
    2) Click Serial collection
    3) Notice how Frequency and Numbering pattern are filled out correctly
    4) Click 'see any sub attached to this biblio'
    5) Notice how Frequency and Numbering pattern are now missing info
    6) Apply patch and refresh page
    7) Confirm Frequency and Numbering pattern now show as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: sonia BOUIS <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db14275db430fb76afbab8a18464f54591b30f53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 13:03:04 2017 -0300

    Bug 19298: Placing a hold from a list at the OPAC should respect issuing rules
    
    The issuing rule retrieve to know if a hold can be placed on a record of
    a list is not correct.
    
    Test plan:
    0/ With item-level_itypes = item level
    1/ Define a item.itype=BK and biblioitems.itemtype=CF
    2/ Create a default rule to allow on shelf holds
    3/ Create a specific rule for CF with on shelf holds="If any
    unavailable"
    4/ Add this bibliographic record to a list and view the list
    => Without this patch you will not see "Place hold"
    => With this patch applied you will see the "Place hold" button,
    respecting the correct issuing rule
    
    Followed test plan, patches worked as described.
    
    Note: Just to clarify the test plan slightly in step 4 where it says you will not see 'Place Hold' it means to
    the left of the 'Save to another List' link below the item availability
    in the opac-shelves.pl page. Not the 'Place hold' button in the grey
    page header box.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a8ca21875f86f25c72baf38e29d27af05c988b0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 9 19:17:45 2017 -0300

    Bug 19431: Fix error when checking out an unknown barcode
    
    It seems this has been caused by
      commit 1544f9a5d4a8acd47c97d7c6ac55dee8e759d3ff
        Bug 18276: Remove GetBiblioFromItemNumber - circulation pages
    
    To reproduce the problem you need switch on the two prefs
     - OnSiteCheckouts
     - OnSiteCheckoutsForce
    
    Test plan:
    Try to check an item out using an unknown barcode
    With the 2 prefs set to on and without this patch, you will get the
    following error in the log
    
      Can't call method "materials" on an undefined value at
      /home/vagrant/kohaclone/circ/circulation.pl line 387.
    
    With this patch applied you should not get this error and a correct
    behaviour for the different pref combinations.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6a1f2ab242474c9e477c2f6d4df5c316a4ef448
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Oct 20 10:49:38 2017 -0400

    Bug 19495: Automatic report conversion needs to do global replace on 'biblioitems' and 'marcxml'
    
    Bug 17898 provides a way of converting reports that use biblioitems.marcxml so that they will use biblio_metadata.metadata instead.
    
    This only works with reports that do not refer to other columns in the biblioitems table. This is a known limitation. It means that we should be able to do a substitution of every occurrence of biblioitems with biblio_metadata, and every occurrence of marcxml with metadata.
    
    Unfortunately, we're not doing a global replace, we're only replacing the first occurrence.
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/Reports/Guided.t
    
    All tests successful.
    Files=1, Tests=9, 10 wallclock secs ( 0.11 usr  0.01 sys +  2.85 cusr  0.25 csys =  3.22 CPU)
    Result: PASS
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42c634745cac4fc33a53bc1312a3e143a2e0ffbc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 23 16:59:11 2017 -0300

    Bug 12768: Fix bad merge resolution conflict
    
    RM note:
    I have applied
    https://bugs.koha-community.org/bugzilla3/attachment.cgi?id=68427
    on top of other patches that were already pushed.
    But it was supposed to replace them, this change revert what was in
    https://bugs.koha-community.org/bugzilla3/attachment.cgi?id=68417
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c63d560b041ab67bafc65a6f9e65eee9e43c2a1a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Oct 23 12:51:50 2017 -0400

    Bug 12768: (QA follow-up) Don't use manualinvoice for non-manual invoices in chargelostitem
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d37bf788936b43d942c44caa2e47fc39e5d0e2a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 23 13:19:42 2017 -0300

    Bug 19517: Prevent dateexpiry.t to fail randomly
    
    If categorycode is 'X', the test will fail
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 208500193ef23678793c00ca2a8da4c55dba9724
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 23 12:34:25 2017 -0300

    Bug 12768: DBRev 17.06.00.019
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ea5f9c82ac195c29ebeff2e534eedce54ae84ca
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Oct 23 11:01:25 2017 -0400

    Bug 12768: (QA follow-up) Use specific account offset types for Processing Fee and Lost Item
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 276b0e2587953a28e9bca16c397b2b8227ab9c63
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 23 12:05:04 2017 -0300

    Bug 12768: Fix tests - itemtypes.rentalcharge is now decimal(28,6)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f254997c54d68855e5c12156b021a20f20f4d01d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Oct 23 12:49:20 2017 +0200

    Bug 14826: (QA follow-up) Remove obsolete DBIx schema file
    
    Removes Accountoffset.pm.
    Has been replaced by AccountOffset.pm on bug 14826.
    
    Test plan:
    Run TestBuilder.t. Should pass now again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99f73373e2461c10c3933332b8981dd1a4b403e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 18:14:06 2017 -0300

    Bug 14826: account_offset_types.sql is not in the mandatory subdir
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d637acd08c11d694e04954592e7ac8d7c1ed8c13
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 17:02:31 2017 -0300

    Bug 12768: DBRev 17.06.00.018
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97ff6ae44d24c998502c3fc81d3ade69f7a70f8f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 16:35:03 2017 -0300

    Bug 12768: (follow-up) Add 'Processing fee' to templates
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ecddf87f56361b0b13a76f0d1ae921917001f61
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 18 15:47:30 2017 +0000

    Bug 12768: (QA follow-up) Fix doubled code
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea5aef7841e79e6bb8e62e73c9d487e362d7a4ae
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Oct 13 10:02:41 2017 -0400

    Bug 12768: (QA follow-up) Add 'Processing fee' to templates
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 226d61282a86002805c3c2f533339c3c93f237db
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 12 12:44:49 2017 -0400

    Bug 12768: Fix up unit tests a bit more
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit afe1eacceb3330025bf2c2c3e7710ef518aebc53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 17:32:59 2017 -0300

    Bug 12768: DBIC Schema changes
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4492a3acf4d71f47a4f205d303ad98dfe8d9dfe3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 17:29:00 2017 -0300

    Bug 12768: Fix YAML syntax in circulation.pref
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6cd42bf5f0d8926d892f0c6a03512d753782f24
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 17:01:56 2017 -0300

    Bug 12768: Add missing IGNORE clauses
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9ac1eff7f2cfd87ccca976d14f34ac3c18ff0ca
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Oct 10 10:40:19 2017 -0400

    Bug 12768: Revert changes to getcharges
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1620ece00fdb225cad2f8ffebfe673fd2cdc2cb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Oct 10 10:34:22 2017 -0400

    Bug 12768: Fix up unit tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b6c9178c42698d4734dbbef387000fad5a55b72
Author: Charles Farmer <charles@inlibro.com>
Date:   Wed Apr 22 15:54:04 2015 -0400

    Bug 12768: Replacement cost and processing fee management
    
    Signed-off-by: Eivin Giske Skaaren <eivin@sysmystic.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0931e15f150660f598ed0aa025ec22e8a8884b9f
Author: Charles Farmer <charles@inlibro.com>
Date:   Wed Apr 22 16:03:54 2015 -0400

    Bug 12768: DB changes
    
    Signed-off-by: Eivin Giske Skaaren <eivin@sysmystic.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b04f401b92ef96f0ca2dae05d8fec7dcce0ff7f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 17:06:49 2017 -0300

    Bug 14826: DBRev 17.06.00.017
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4d702c668661f4ef01f5fe0d4ae99d81f89712d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 16:28:52 2017 -0300

    Bug 14826: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2dd0d6c359e12fe7cd30c8c36a5de6b0d23350e7
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 12 12:00:48 2017 -0400

    Bug 14826: (QA follow-up) Make db update idempotent
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7417dd3704174735dd1232a4634f9ded00e44144
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 29 10:55:39 2017 -0300

    Bug 14826: (QA follow-up) POD fixes
    
    This patch just fixes POD. There are still some false positives with the
    QA scripts.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 473bf22e42dfe9297a22ed5c6d5c0bdc3e97b99f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Sep 1 07:51:49 2017 -0400

    Bug 14826: Add account offset type table
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a588b3b996b003eea314add5e97f2b5c98fbbfc6
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Aug 8 10:04:31 2017 -0400

    Bug 14826: (QA follow-up) Only use plural modules in other modules
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7c0cefff761e2c22e00c35b751c231ed4625063
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jun 6 09:33:46 2017 -0400

    Bug 14826: Add unit tests for _FixAccountForLostAndReturned and _FixOverduesOnReturn
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Bug 14826: (QA followup) Fix minor issues with unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Bug 14826 [QA Followup] - Correct number of tests run following rebase
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2c555bb32c7b29b9896e6751ac665076317c3ee
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Feb 15 16:24:57 2017 +0000

    Bug 14826: Add offset for rental fees
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0aa6740d3c32a3cdf53e5d97405c260e4d74ac7
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 21 18:32:05 2016 +0000

    Bug 14826: Unit Tests
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0dccc8ec5b2a4347cbc78e08aa905b79f1136787
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jul 12 14:48:03 2016 +0000

    Bug 14826: Resurrect account offsets table
    
    The account offsets table should be used to track increments and
    decrements of fines via payments and credits, as well as fine accruals.
    It should be able to match fees to payments and visa versa, so we can
    know which fee was paid by a given payment, and which payments applied
    to a given fee.
    
    Test Plan:
    1) Apply this patch
    2) Run updatedatabase
    3) Note the table accountoffsets has been renamed to account_offsets
    4) Ensure fine generation creates offsets
    5) Ensure creating a manual invoice creates an offset
    6) Ensure a lost item charge creates an offset
    7) Ensure Reverse Payment creates an offset
    8) Ensure a payment creates an offset
    9) Ensure a payment for multiple fees creates an offset for each
    10) Ensure writeoffs create offsets
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca34994f23702ba4edeac7d7c5340c2bf7637d07
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jul 12 14:13:04 2016 +0000

    Bug 14826: Add Koha::Account::Offset(s) modules
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49eb0395defb9b21ab89a26eafa9a879bcbb176b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jul 12 13:50:11 2016 +0000

    Bug 14826: Update database
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 399dcaa222c8e49da9aba8b6cac16928608f89ae
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 9 16:31:19 2017 +0000

    Bug 19356: Move staff client cart JavaScript to the footer
    
    This patch modifies the staff client cart template so that
    JavaScript is included in the footer instead of the header.
    
    To test, apply the patch and test the JavaScript-driven features of the
    cart: All button controls, DataTables functionality.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Correction for QA: Removed contditional around footer JS (from
    copy-paste) because it will always be true.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef92ad31bffc80c308e9ed693b9de88391603b05
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 20 13:21:27 2017 +0000

    Bug 19348: Title column in item search is too narrow
    
    This patch adds IDs to the item search results table header so that
    columns can be targeted by CSS or JS. The CSS for the item search page
    has been modified to give the title column a minimum width.
    
    To test, apply the patch and clear your browser cache if necessary.
    Perform an item search and confirm that the title column stays at a
    reasonable width.
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ad872dc88236cae539bb02ac0053a50fbf31684
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 16:15:46 2017 -0300

    Bug 16187: accept --verbose and -h
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 629598704a4ded9425293340bf5b9de8e347bd68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 16:04:04 2017 -0300

    Bug 16187: Do not use DateTime directly
    
    Koha::DateUtils takes care of what you need
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f46d6a8785db490ec9067ba6964b5172e06ee848
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 20 08:11:38 2017 +0200

    Bug 16187: (QA follow-up) Additional fixes
    
    Fix:
    Can't locate object method "next" via package "13" (perhaps you forgot to load "13"?) at misc/cronjobs/holds/cancel_unfilled_holds.pl line 119.
    Undefined subroutine &main::CancelReserve called at misc/cronjobs/holds/cancel_unfilled_holds.pl line 143.
    
    The script does not use Koha::Object's get_column correctly for getting
    the branch codes.
    The call to CancelReserve is obsolete. Was moved in the meantime to
    Koha::Hold->cancel.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0afe6eca76b3160fcdcddb9e376cf277d673acca
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 14 06:46:15 2016 -0400

    Bug 16187: Add a script to cancel unfilled holds after a specified number of days
    
    This script takes parameters:
    days - how many days waiting to concal an unfilled hold on or after
    library - (repeatable) branches to consider
    holidays - whether or not to count holidays (default is no)
    
    This patchset adds two methods and covers them with tests:
    Koha::Holds->unfilled(); To return holds where found = undef
    Koha::Hold->age( $use_calendar ); To return the number of days since a
    hold was placed (including or excluding holidays)
    
    To test:
    1 - Place some holds with varying reservedates
    2 - Run script with different parameters to verify options are respected
    (-v for verbosity will assist here)
    3 - verify that script does nothing without days parameter
    
    Sponsored by:
        Siskiyou County Library (http://www.siskiyoulibrary.info/)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 16187 - Followup
    
    1 - Correct use of original (bad) script name
    2 - Explain options better
    3 - Remove change from 'W' to 'w'
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    RM note: Squashed for readability
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0f3cb32889d6f0d64fb4965e8c00a3a1f31c6c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 12:18:10 2017 -0300

    Bug 18961: Use exact match for select filters on item search
    
    The SQL operator LIKE is always used for filters when searching for
    items.
    
    If the filter is a select, we should search for an exact match.
    That way we avoid problematic search like "%NFIC%" and "%FIC%" (one
    includes the other one).
    
    Test plan:
    - Make sure you have collection codes 'Fiction' and 'Non-fiction'
    - Do an item search
    - Filter column 'Collection', select 'Fiction'
    - Result: Column contains items from Fiction only
    
    Followed test plan, works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ed705ea458d47d199b8f3e20572397d4697516a
Author: Eric Vantillard <eric.vantillard@evaxion.fr>
Date:   Tue May 9 23:10:21 2017 +0200

    Bug 18564: Improve koha-common.cnf parsing to pick the mysql host
    
    my koha-common.cnf is using this form:
    
    [client]
    host=db
    user=root
    password="move_rootpwd_to_dotenv"
    
    this file is working has expected with mysql tools.
    
    but koha-create parsing will not find the db host resulting in
    koha-conf.xml containing no values in hostname element.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 850243ee2ec66a4b569d29ed84423f09c0001690
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 20 15:56:20 2017 -0300

    Bug 19487: Refetch the object to get up-to-date values
    
    This has been raised by failures on t/db_dependent/Circulation/issue.t
    (thanks tests!)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60bb936bc28b73f1653207cce36f432dec094017
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 19 09:02:20 2017 -0300

    Bug 19487: Fix MarkIssueReturned.t
    
    MarkIssueReturned must now return directly if the issue does not exist.
    We then check if the anonymous patron configuration is correct.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b5c1fce5880f8592c5a9dbd40614a760bb2607e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 18 13:59:56 2017 -0300

    Bug 19487: Do not return an item if not checked out
    
    To recreate:
    1 - Manually add a lost fine to a ptron and include a barcode
    2 - Attempt to write off the fine
    3 - Internal server error
    4 - Checkout an item and mark lost to checkin and fine
    5 - Attempt to write off line
    6 - Internal server error
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08357845c3db3b68990e655de3364bc0f4649fc1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 13 09:03:25 2017 +0200

    Bug 19296: (QA follow-up) Correct comment in populate_orders
    
    Just replacing a wrong - by a correct + sign in the comment. The code
    itself is fine.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8b89eead0c7576a295679b3ef3bb90e7dec8283
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 12 16:57:47 2017 +0000

    Bug 19296: Allow all tax processing to happen in C4::Acquisition::populate_order_with_prices
    
    To test:
     1 - Create an order file that includes prices and items
    (MarcFieldsToOrder)
     2 - Stage the file
     3 - Set vendor to 'prices exclude tax'
     4 - Open a basket and add from the file
     5 - View the items in the basket
     6 - Prices are reduced by the tax rate and tax is calculated to return
    prices to the value in the file
     7 - Apply patch
     8 - Repeat steps 1-6
     9 - Prices should now calculate correctly
    10 - Repeat with 'MarcItemFieldsToOrder'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e772277a8aa7402f537ddb3c0886fb9dc3ce2d91
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 18 13:59:06 2017 +0200

    Bug 19463: (follow-up) Cosmetic changes
    
    String::Random version 0.26 (on Jessie) does not yet support the rand_gen
    parameter (0.27 does, newest is 0.29 on CPAN now).
    So alt_rand is only used in determining the size on Jessie.
    That might be enough though.
    Adding a documention line in this regard.
    
    Removing the obsolete max parameter.
    
    Note: I timed alt_rand for the creation of a new Bytes::Random::Secure
    object each time. But each call is about 0.1 milliseconds. So that
    should be fine.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e9edcd3be5ddfcd15c5924166ec509c6445f97b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 17 12:40:45 2017 -0300

    Bug 18298: Fix selenium tests
    
    The password has to be better than "password"...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41e63c44e06fa17959b7cd1c9035c75b2577c633
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 17 16:57:16 2017 +0200

    Bug 19463: Additional changes to gen_text
    
    Use Bytes::Random::Secure instead of perl rand.
    Return a string from 50 to 100% of $size.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 708d02047d67bc5f8d5b43690c6967cc5e191f82
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 17 11:29:06 2017 -0300

    Bug 19463: Reduce the chance to have TestBuilder generate twice the same value
    
    When an id is generated by TestBuilder (branchcode for instance) and the
    size of the generated string is 1, we have too many chances to get
    "Violation of unique constraint in Branch".
    
    This patch increases the number of retries to 5.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended to make room for follow-up.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6bf390f38c7a0a1ae0be91f72baf7aa284ee0edb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 16 11:54:50 2017 -0300

    Bug 19472: Update SYNOPSIS with the correct script name
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a539e62689946d314b4b7afba0aa8f39fa46613a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 11 16:11:33 2017 +0200

    Bug 19472: Add perl extension to script borrowers-force-messaging-defaults
    
    There is no reason to keep this perl script without the regular extension.
    Please see other scripts in the same folder too.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 430527ffb813b11e8950b91cd8766b259ae59084
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 16 11:59:10 2017 -0300

    Bug 13572: Patrons are still active if their expiry date is today
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a3159a01730ad5424b686cad58b5b4be461d01c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 16 11:37:39 2017 -0300

    Bug 13572: Rename option with "--not-expired"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d51b93572660d5c45f0e76c9bf04ff2f45b86d32
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 11 16:09:19 2017 +0200

    Bug 13572: (follow-up) Print since on a separate line
    
    Very trivial change.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93354ff3f1fdad170ad5d89fed0fa019c746027a
Author: Charles Farmer <charles.farmer@inlibro.com>
Date:   Thu Dec 15 10:58:23 2016 -0500

    Bug 13572: Add --actives parameter to force_borrower_messaging_defaults script
    
    1) Apply the patch
    2) Create a new patron with random values, except for it expiration date, make it expired (Patrons > New Patron > Student)
    3) Enable the system preference called “EnhancedMessagingPreferences”
    4) In “Administration" > "Patron categories" > Student, modify the "days in advance", then click "Save"
    5) run the script "./misc/maintenance/borrowers-force-messaging-defaults --doit --actives"
    6) Validate that the student created in step 2 hasn't changed (Patrons > search)
    7) Validate that any other student that isn't expired has changed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9416fdca36f98860fca285dcb77835a0d702f401
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 16 09:57:26 2017 -0300

    Bug 18298: DBRev 17.06.00.016
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9136c3dbf89aa824dcc7e848dcf2c7aeb41235f8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 13 16:42:03 2017 -0300

    Bug 18298: (QA followup) Use Koha.Preference on the template
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f9da34683d7f87570e73b5c401a1a0e4a8604ac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 16 23:03:20 2017 -0300

    Bug 18298: Add server-side checks and refactor stuffs
    
    Now that we have a check client-side, nothing prevents us from a smart guy to
    bypass it and force an invalid password.
    This patch adds two new subroutines to Koha::AuthUtils to check the
    validity of passwords and generate a password server-side. It is used
    only once (self-registration) but could be useful later.
    
    Moreover the 3 different cases of password rejection (too leak, too
    short, contains leading or trailing whitespaces) were not tested
    everywhere. Now they are!
    
    This patch makes things consistent everywhere and clean up some code.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2a1b215dd27c6cb9ed1b45a0613886843c6ba7d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 16 23:02:13 2017 -0300

    Bug 18298: minPasswordLength should not be used as the default password length
    
    The length of the passwords generated for a patron should not be as long
    as the value of minPasswordLength.
    It is the minimum required size of a password, not the maximum!
    So let's fix it to 8 if the minPasswordLength if < 8, that sounds
    reasonable and less risky for patrons.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec4e666bc52b20089f3720d2e2d523fbdcfcf2eb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 16 23:01:34 2017 -0300

    Bug 18298: minPaswordLength should not be < 3
    
    Indeed if RequireStrongPassword is set we need at least 3 characters to
    match 1 upper, 1 lower and 1 digit.
    We could make things more complicated to allow minPasswordLength < 3
    but, really, 3 is already too low...
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac50959dcf99739007907e8549ca22cdd0b97532
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 16 23:00:28 2017 -0300

    Bug 18298: Move password generation to template side
    
    This patch removes a really ugly way to generate a password: the whole
    template was sent and parsed to retrieve the "#defaultnewpassfield" node.
    To avoid the password to be sent plain text it is certainly better to
    generate it client-side.
    The same kind of passwords will be generated: 0-9a-zA-Z
    The while loop prevents to get an invalid generated password.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7cc65af6ffdabbabe7ae3463f51096de375216ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 16 22:59:51 2017 -0300

    Bug 18298: Use the validate jQuery plugin
    
    To validate password fields we need to use the validate jQuery plugin.
    To make things reusable this patch adds a new include file
    'password_check.inc' at the intranet and opac sides, it creates 3 new
    validation methods:
    - password_strong => make sure the passwords are strong enough according
    to the values of the RequireStrongPassword and minPasswordLength prefs
    - password_no_spaces => prevent passwords to be entered with leading or
    trailing spaces
    - password_match => make sure both password fields match
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 558a809144560198c7febac4998f49c56c45c844
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 14 20:01:27 2017 -0300

    Bug 18298: Enforce password complexity
    
    This patchset prevents users to enter too leak password, controlled by
    a new syspref RequireStrongPassword. If set the staff and patrons will have
    to enter a strong password.
    The strongness cannot be modified, it has been arbitrarily set (by the
    author of this enhancement) to at least 1 lowercase, 1 uppercase and 1
    digit. This can be inforce by increasing the value of the existing
    minPasswordLength pref.
    
    I decided to turn this feature on, it cannot hurt! For existing installs
    it will have to be turned on manually.
    
    Writing these patches I found a lot of inconsistencies all around the
    password checks and decided to refactor everything to make things
    consistent and more robust.
    Now the password validity is check at only one place (subroutine
    covered by tests).
    
    Test plan:
    We have several places where a password can be change/created:
    a. Editing a patron (members/memberentry.pl)
    b. Changing the password of a patron (members/member-password.pl)
    c. Changing your own password at the opac (opac/opac-passwd.pl).
    OpacPasswordChange needs to be set
    d. Reseting your own password at the opac
    (opac/opac-password-recovery.pl). OpacResetPassword needs to be set,
    see "Forgot your password?" link when you are not logged in
    e. Self registration feature, PatronSelfRegistration needs to be set.
    
    You will also need to add 'password' to PatronSelfRegistrationBorrowerMandatoryField.
    
    Note that '****' is considered by Koha internally that the password is
    not changed (existing behavior).
    
    To fully test this patch you will need to test the different
    combinations of RequireStrongPassword and minPasswordLength.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a93fef4c71d405fb7548e7d2601320ed0512d27c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 13:55:30 2017 -0300

    Bug 19373: CAS logout - Redirect to the previous page (Intranet)
    
    Signed-off-by: Matthias Meusburger <matthias.meusburger@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7a805691fdae884e6782c29e096ba2d476ef688
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 11 12:15:01 2017 -0300

    Bug 19373: Update tests
    
    Signed-off-by: Matthias Meusburger <matthias.meusburger@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a82d54d4b4f5eb7aa7d45afc13dac0a80c86f9ce
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jul 10 14:54:56 2017 +0200

    Bug 18923: Warning in Biblio::GetCOinSBiblio
    
    Use of uninitialized value in concatenation (.) or string at C4/Biblio.pm line 1456.
    Note: In current master this is now line 1370 (Oct 9, 2017).
    
    Test plan:
    Enable COinSinOPACResults.
    Select a record with leader pos6==a and pos7==a. This triggers genre to be
    journalArticle and titletype to be a.
    Without this patch, do an opac search that includes this record.
    Check the log. You should see the warning.
    Apply this patch, search again and check the log. The warning should not be
    repeated again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e078ae12be45e91f12be8333962bde8c72b0de18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 13 13:54:43 2017 -0300

    Bug 19186: DBRev 17.06.00.015
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5ea2cf3dd60ba55311e851eec025c55c118c5e3
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Oct 13 13:29:53 2017 +0000

    Bug 19186: (QA follow-up) Insert syspref SelfCheckoutByLogin if missing
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3df96634267b40de3b5d2996ac4ed73e236c0373
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 14:13:05 2017 -0300

    Bug 19186: Change pref choice for SelfCheckoutByLogin - barcode vs cardnumber
    
    The SelfCheckoutByLogin lists 'Barcode' as an option, but this should be
    Cardnumber. Especially since more and more libraries are using chip
    cards instead of barcodes.
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47c77c0193db428c34f2410a94b44634d3c34579
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed Oct 11 12:43:45 2017 +0000

    Bug 19413: (follow-up) Changed fieldset id value
    
    Followed test plan again and patch still applies and works as expected.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebffcdf4b938cd5a75ccf02a23341e6af3919ee8
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Thu Oct 5 15:18:01 2017 +1300

    Bug 19413: Moving the OK and Cancel inputs to the top of the 008 builder
    
    Followed test plan and patch applies and functions as described
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fc8c03b59aa72ef27a0de8ced55b4fafd7d9580
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Oct 9 08:07:29 2017 +0000

    Bug 19438: Fix sorting by date due in overdues.pl
    
    Test plan:
    0) Do not apply the patch
    1) Have some overdued checkouts in your database
    2) Go to circulation -> overdues (overdues.pl)
    3) Try to sort the overdues table by due date and notice it is sorted
    alphabetically, not by date
    4) Apply the patch
    5) Try again and confirm, it is sorted by date
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84bc17a894fb5023ca69836b4f584392ecfd8373
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 13 13:41:11 2017 -0300

    Bug 19422: Make sure it will never happen again
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2386e33dbba4c561f3ce465cf1a0970d52b8efd5
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Fri Oct 6 08:42:32 2017 -0400

    Bug 19422: Missing DROP TABLES in kohastructure.sql
    
    Adds DROP TABLE statements to the following tables
        - article_requests
        - biblio_metadata
        - deletedbiblio_metadata
    
    Test plan :
    Clean your database by running 'mysql < kohastructure.sql'.
    Without patch you'll get error messages.
    With patch everything will work fine, no warnings.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c45b2d69bcb17fbadc5e9794e70c5ccc4cfcc0a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Sep 8 11:52:02 2017 -0400

    Bug 19275: clubs table broken at the opac if public enrollment is not allowed
    
    Test Plan:
    1. Create a template club and disable public enrollment
    2. Create a club and add it a patron
    3. login at the opac with this patron
    4. Note the borked clubs table
    5. Apply this patch
    6. Refresh the page
    7. Table is fixed!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2aba85d811c6c4e89d0b2e1e560549898f098fd9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 10:58:24 2017 -0300

    Bug 19083: Fix 'show all details' link on closed basket detail
    
    'Show all details' add columns on the basket summary page.
    This link is broken if the basket is closed.
    
    Indeed there is a JS error raised by $('#toolbar').fixFloat();
    The toolbar is not displayed if the basket is closed.
    
    This is caused by bug 12333, which added the floating toolbar.
    
    Test plan:
    Create 2 baskets with orders
    Close 1 basket
    Click on the 'show all details' links and confirm it works as expected
    Also confirm that the toolbar works correctly
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b830349f45007629f141a9835e05b95f90ee4b92
Author: David Gustafsson <david.gustafsson@ub.gu.se>
Date:   Thu Oct 12 13:57:48 2017 +0200

    Bug 19453: Incorrect jQuery selector for fund drop down validation
    
    Steps to reproduce:
    1. Create a new basket
    2. Choose "Add to masket"
    3. Choose "From a staged file"
    4. Select a file
    5. Save without selecting a fund
    
    Expected results: A validation error should be shown, and form submit
    halted.
    
    Actual results: No validation error is shown and form submits.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a16510a04af5c00b5857e7722cc8c69fb0d0b860
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 13 09:16:29 2017 +0200

    Bug 19425: (QA follow-up) Resolve 'push on reference experimental' warn
    
    QA tools reported for acqui/addorderiso2709.pl
       FAIL   valid: push on reference is experimental
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0dc722c5183bdd162eba6992a4d38a1a9d28f285
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Oct 6 09:47:26 2017 -0400

    Bug 19425: Adding orders from order file with multiple budgets per record triggers error
    
    If you import an order file ( using MarcItemFieldsToOrder ) that has a different budget for each item to be ordered, you will get an error and a partially created basket. This is because Koha attempts to add the item to each order *for each budget*. This is clearly incorrect. Instead, we should be grouping items by budget and for each budget only adding those items that have a matching budget.
    
    Test plan:
    1) Do not apply this patch
    2) Download the provided MARC record
    3) Add the branchcode 'ALD' to your server
    4) Add the ccode 'ACOL' to your server
    5) Add the budget codes 'adultay' and 'branchay' to your server
    6) Stage the order file
    7) Create a basket, import the order file
    8) No we have 3 records, 2 of them have 2 items each with different budget codes
    9) Attempt to import, note the error
    10) Apply this patch
    11) Repeat steps 6-8, note the order completes and results in 5 order lines being added to the basket!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Christopher Kellermeyer <ckellermeyer@altadenalibrary.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    First step of test plan amended (not apply instead of apply).
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c991ac6b6184e299108b5f69d3e0e50dcfc6548d
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Oct 13 10:05:08 2017 +0000

    Bug 18374: (QA follow-up) Fix auto truncation for field:"value"
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6426a82014aacd738dd94ca2ff1c9056af893d45
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Oct 13 09:53:04 2017 +0000

    Bug 18374: (QA follow-up) Simplify _truncate_terms
    
    By using a different split regex, we can simplify a bit the process of
    appending '*' to every word of the query
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d099dc13bb4b9aa991caa0feaf24bed59c3c4844
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 6 15:37:38 2017 +0000

    Bug 18374: (follow-up) Add support and tests for quoted strings
    
    To test:
    1 - prove t/db_dependent/Koha_SearchEngine_Elasticsearch_Search.t
    2 - do some searches in staff client and test results
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e54065197515ec265d4bab6ceead35d4456ef0e5
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Sep 29 16:12:23 2017 +0200

    Bug 18374: (QA follow-up) Tidy up code
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfa1aac9554ea9cba09aec30a4b1f85c09cb5f63
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 12 12:15:07 2017 -0300

    Bug 18374: (QA follow-up) Remove warning in Elasticsearch/Search.pm
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c4d982ae45a3763fd70faedf1bbac225213de19
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 3 14:30:44 2017 -0400

    Bug 18374: Respect QueryAutoTruncate syspref in Elasticsearch
    
    This patchset adds a subroutine '_truncate_terms' to the ES QueryParser.
    
    If QueryAutoTruncate is enabled this function will be called for any
    search to add wildcard '*' to all terms
    
    To test:
    1 - Enable Elasticsearch and have some records indexed
    2 - Search for partial terms
    3 - Note they fail unless '*' is appended
    4 - Apply patch, leave QueryAutoTruncate disabled
    5 - Note partial term searches still fail
    6 - Enable QueryAutoTruncate
    7 - Note partial term searches succeed
    8 - Do some regular and advanced searches to make sure results are as
    expected
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b3d53db08a5d27a22df338ea4c3c2426992c12a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 6 14:27:50 2017 -0400

    Bug 18374: QueryAutoTruncate unit tests
    
    To test:
    1 - Apply just this patch - should fail
    2 - Apply the other patch - should pass
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 307e55a7debdf5e1c960cbfea443b6b160c0ce9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 12 11:19:40 2017 -0300

    Bug 19455: Prevent SwitchOnSiteCheckouts.t to fail randomly
    
    If categorycode is 'X', the test will fail
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1dba61e93307e5772faaa60b5141788d0f1763bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 11 13:10:32 2017 -0300

    Bug 15685: DBRev 17.06.00.014
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce0c12e7762df5bf6330c3236b2ec7ac2ad48e3c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 18:15:01 2017 -0300

    Bug 15685: Send the basket to _cancel_items_receipt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da6824d6e24393caa891908cf9ce487dbd6fbc1e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 18:06:55 2017 -0300

    Bug 15685: Avoid "Use of uninitialized value" warning in logs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a8d910b4ef1436f5b1bd73db348940967723d0d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 17:32:49 2017 -0300

    Bug 15685: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34032504e60a1a9e93157256e775521db69b7e92
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 17:01:25 2017 -0300

    Bug 15685: Fix DB columns order
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04aea91de0f2fe1103e4021f880d135da1fd11a9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 10 12:11:14 2017 +0000

    Bug 15685: (QA follow-up) Address QA issues
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aceb98983267f6ef0ac735ec334ffd6674275936
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 5 12:17:33 2017 -0300

    Bug 15685: Add tests for Koha::Acquisition::Order->basket
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87ccf546b2073e9b65a824a9c508d3cdc270c366
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 5 11:38:52 2017 -0300

    Bug 15685: POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7041f4798ddb7be51ee08822c8a45fb6e9a08644
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 5 11:12:57 2017 -0300

    Bug 15685: (QA follow-up) Tidy tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f18af55a39e132c57e25774b94acec8cbc0f280e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 5 11:12:35 2017 -0300

    Bug 15685: (follow-up) K:A:O->find and ->fetch are no longer used
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 520afc589076b15dd796aacaee0c6699730bfc11
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 11 11:59:21 2017 +0000

    Bug 15685: (QA follow-up) Fix typo
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f511378c7d07fec934123cd5438a7538c7a53da
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 7 14:54:11 2017 +0000

    Bug 15685: (QA follow-up) Improve Update DB entry + Add tests
    
    DB revision fixes
    Unit tests
    
    Edit: fixed the update step description (tcohen)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb57b47e0cd363701b09a7685cf361aeecc33cc5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Nov 10 14:07:18 2016 +0000

    Bug 15685: (QA follow-up) Fix qa script errors
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7135a4cbd3f5c0338292acac5cc3a4f1b034d379
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Nov 10 14:01:37 2016 +0000

    Bug 15685: Implement needed changes in Koha::Edifact::Order
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b29493265b3ae9f660eee2d4b911da036d100b0d
Author: Jesse Weaver <jweaver@bywatersolutions.com>
Date:   Thu Jan 28 15:01:24 2016 -0700

    Bug 15685: Allow creation of items (AcqCreateItem) to be customizable per-basket
    
    This adds a new basket attribute (create_items) that can optionally be
    set to override AcqCreateItem.
    
    The following have been modified to reflect this (with the value of
    create_items that causes them to behave differently in parentheses):
      * Cancelling receipt of an order (receiving)
      * Creating an order by hand or from MARC (ordering)
      * Receiving an order (receiving)
      * Showing orders with uncertain price (ordering)
      * Showing orders (receiving)
      * Showing acquisition details in the OPAC (ordering)
    
    Test plan:
      1) Create baskets with "Create items when:" set to ordering,
         receiving, cataloging and unset.
      2) Test each of the above for each of these baskets, verifying that
         the basket-specific attribute overrides AcqCreateItem if set and
         falls back to the syspref otherwise.
    
    NOTE: A check of AcqCreateItem in opac-detail.tt was removed because it
    was redundant; the code path in question cannot be triggered unless
    create_items/AcqCreateItems is set to the correct value anyway.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Barbara Fondren <bfondren@roundrocktexas.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4869f1b6ec88eaea1fed5af2a9c697a58559cc63
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Wed Oct 11 10:16:36 2017 +0000

    Bug 18399: (follow-up) Escape reason input
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b9140e8eff89fdad149023aa292f62462e07fae
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Wed Oct 4 15:04:15 2017 +0000

    Bug 18399: Add reasons in edit suggestion page
    
    Test plan:
    
     - Fill the authorised values's category 'SUGGEST' with reason
     - Edit a pending suggestion. Set the status to rejected
       and select a reason
     - Check the reason has been saved (i.e in the suggestions
       table of rejected tab)
     - Check in the corresponding message_queue that the reason
       is here
     - Re-edit the same suggestion
     - Check that the correct reason is selected by defaut
     - Edit an other pending suggetion. Set the status to rejected,
       select other reason and fill the input text
     - Re-edit the previews suggestion and make sure the input
       "other" is displayed by default with the correct value
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f279be86040da34cbc6a3936d4b483a2e70a4377
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 09:49:46 2017 -0300

    Bug 19085: Remove empty files patron_attributes.* in installer
    
    These files has been added and emptied in the same patch set (bug 5670).
    It does not make sense to keep them.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c32d41107bd514a6c28a4014a0900216450b79e
Author: Emma Nakamura Smith <emma.nakamura.smith@gmail.com>
Date:   Thu Oct 5 05:54:55 2017 +0000

    Bug 19414: Move the location of the 'Import this batch into the catalog' button
    
    Moves the location of the button in question to be below the framework selector
    
    Test plan:
    1. Go to Tools -> Stage MARC records for import
    2. Upload a .mrc file and stage it for import
    3. Click Manage staged records
    4. Note that the import button appears above the framework selector
    5. Apply patch
    6. Refresh the window
    7. Notice that the button has now moved to below the framework selector
    
    Sponsored-By: CALYX information essentials
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e872cec54d4f648335cf7e2566d2e38d9f71a3a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 11 12:56:24 2017 -0300

    Bug 16401: DBRev 17.06.00.013
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95acb17c58e7c8adb6fd154fe099568e27c7f18f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 11 12:50:26 2017 -0300

    Bug 16401: Add a warning if letter.content matches staffClientBaseURL
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d1794123e902132671fbc5f9278c05bf5c4eb15
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Sep 20 23:28:49 2017 +0200

    Bug 16401: (follow-up) Avoid changing empty staffClientBaseURL preference
    
    Adds a condition to check that the staffClientBaseUrl is not empty
    before updating it with 'http://'.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36c3d454262d814c2174483bec2a6a181c3fd3b0
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Aug 15 17:23:00 2017 +0200

    Bug 16401: System preference staffClientBaseURL hardcoded to 'http://'
    
    Test plan:
    1) Insert some value to staffBaseURL preference, without starting http://
    2) Apply the patch
    3) Update database
    4) Go to system preferences adminsitration, find the staffBaseURL
    preference, the inserted value should be prepended with 'http://' and
    the comment should be "This should be a complete URL, starting with
    http:// or https://. Do not include a trailing slash in the URL. (This
    must be filled in correctly for CAS, svc, and load_testing to work.)"
    5) prove t/db_dependent/Auth_with_cas.t
    6) prove t/db_dependent/selenium/basic_workflow.t
    7) prove t/db_dependent/check_sysprefs.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7211fd22bad5b3a3939cca6fe766ee65a7c62b13
Author: Marc Véron <veron@veron.ch>
Date:   Sun Sep 17 11:53:34 2017 +0200

    Bug 19328: Internal server error because of missing currency
    
    This patch fixes internal server errors because of missing active currency
    in files aqbudgetperiods.pl, aqbudgets.pl and aqplan.pl.
    
    To reproduce:
    - Make sure that no active currency is defined. You can undefine the active
      currency in Administration->Currencies and exchange rates
    - Try to go to Administration->Budgets and Admistration->Funds
    Result: Internal server error
    
    To test:
    - Apply patch
    - Restart plack
    - Try to reproduce issue, it should no longer occur. There should be a
      yellow message box "No active currency is defined"
    - From Administration-> Budgets administration try to edit a fund and go to
      "Planning". Verify that the message box appears here as well.
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75994dc94a2f5d1a500a7789ed113575c49f8b51
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 27 11:55:45 2017 -0300

    Bug 18709: Make koha-foreach use koha-shell internally
    
    This patch simplifies the koha-foreach script, making it use koha-shell
    to gain instance privileges and have all environment variables set.
    
    To test:
    - Apply the patch
    - Have one or more instances created (kohadev already exists in kohadevbox, add
      another onewith $ sudo koha-create --create-db test)
    - Run:
      $ sudo kohaclone/debian/scripts/koha-foreach echo "This is instance __instancename__"
    => SUCCESS: The script runs gracefuly, and outputs something like:
    This is instance kohadev
    This is instance test
      Note: this means the command was executed for each instance and the current behaviour
            of replacing the placeholder __instancename__ for the actual instance name still
            works as expected.
    - You can try the different filter switches, but the logic has not been touched. only the
      command call.
    - Sign off :-D
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c83fa0bc67690f388f5e968095b6d55ef18a70f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 13:07:59 2017 -0300

    Bug 19259: Enforce type of the delay value when editing overdue rules - template side only
    
    Overdue rules do not save when a delay that is not an integer > 0,
    without any warnings.
    This patch forces the user to select a number > 0.
    
    Test plan:
    Without this patch applied, enter non-integer value or negative or 0
    => The rule will not be inserted without any warnings.
    With this patch applied you will get an message from the browser and the
    form will not save
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c88716730118c83c482be5fe7095a504c3e45b28
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 14:23:39 2017 -0300

    Bug 13766: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c208a44313ed1f4bd12f8c9d3b45c5f2d386c5b
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Fri Oct 6 07:19:15 2017 +0000

    Bug 19418: (bug 12833 follow-up) Add missing use statement
    
    Patron search fail on calling svc/members/search. This script
    return a 500 error and the search stay on "Processing..."
    
    Test plan:
      - Enable ExtendedPatronAttributes system preference,
      - make a standard search (search fields),
      - check the search works and it doesn't stick on "Processing..."
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    I do not recreate the issue, but the change make sense and the issue has
    been raised by several people

commit 83e82028fa9d0492cbc3567b9a200b67f9355ab0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 10 10:14:41 2017 -0300

    Bug 14039: Fix patron search
    
    The JSON was malformed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fed86d50420dcb3fb468c5743a1e370d075bc5e0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 9 15:57:46 2017 -0300

    Bug 19440: Existing calls need to be done in scalar context
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e90874241808354777cc1c27ad3ad106ffdc7cd4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Oct 9 15:36:41 2017 -0300

    Bug 19440: Identify overlimit problems in XISBN tests
    
    This patch makes C4::XISBN::get_xisbns() return an errors hashref
    including information of the failing fetches from xisbn services.
    
    It tackles the situation of XISBN, which in some cases returns 'overlimit'
    errors.
    
    The patch makes the relevant functions check if the response->{stat} string
    is 'ok' and returns the string in $errors otherwise.
    
    This only happens when in list context. This allows to fix the randomly failing
    tests while keeping the current behaviour.
    
    All this code should be rewritten. It does the job bug doesn't have problems handling
    or reoprting. This is just a band aid.
    
    To test:
    - Make sure
     k$ prove t/db_dependent/XISBN.t
    => SUCCESS :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ac69e3a19bb3a30554d41f862516bb92a70508a
Author: Marc Véron <veron@veron.ch>
Date:   Wed May 3 16:23:22 2017 +0200

    Bug 18528: Patron card creator template: switch form fields for card height and card width
    
    This patch changes the sequnce of form fields for card height and card width.
    
    To test:
    - Apply patch
    - Edit or create a patron card template
    - Verify that the fields display in sequence Page height - Page width -Card height - Card width
    
    Followed test plan, worked as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c82c9793062b93c463798db0fd606fbd2905d56
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 25 15:01:51 2017 -0300

    Bug 19196: Rename page and per_page
    
    This patch just renames 'page' and 'per_page' params, for
    '_page' and '_per_page' respectively.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c84cab61b73574ae451fe93a09057252bcb830e4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 29 17:02:13 2017 -0300

    Bug 19196: Make plugin available to endpoints
    
    This patch just initializes the plugin on the main controller class so
    it is available for all endpoints to use.
    
    As it is not used, in order to test just restart plack and make sure the
    endpoints work (run the t/db_dependent/api/v1 tests).
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26f3ca8d88486e5948c400f0d19d8c5bdf392d2e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 29 16:52:48 2017 -0300

    Bug 19196: Add Koha::REST::Plugin::Pagination
    
    This patch introduces a Mojolicious plugin to be used on the REST api.
    It adds a helper method:
    
    add_pagination_headers
    ======================
    
    When used, it adds a _Link_ header to the reponse with the calculated
    values for pagination, and X-Total-Count containing the total results
    like this:
    
        my $params  = $c->validation->output;
        my $patrons = Koha::Patrons->search;
        my $count   = $patrons->count;
    
        $c->add_pagination_headers({
                total  => $count,
                params => $params )};
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/Koha/REST/Plugin/Pagination.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Sponsored-by: ByWater solutions
    Sponsored-by: Camden County
    
    Edit: I fixed a mistake on the POD (tcohen)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b811dbbd8d8cdbe226bf123bc52daff426eac72f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 29 17:00:50 2017 -0300

    Bug 19196: Unit tests
    
    This patch adds unit tests for the new pagination Mojo plugin.
    
    Sponsored-by: ByWater Solutions
    Sponsored-by: Camden County
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b0cc8584f223fff54cd729043f448be028ad792
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Oct 2 14:33:02 2017 +0200

    Bug 19397: Release team for 17.11
    
    This patch adds the release team for 17.11 to about template.
    
    Test plan:
    Check the changes with the wiki pages for 17.05 and 17.11.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00b871e880ec93910671ee7294171c7d76a4794d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 7 00:07:31 2017 +0000

    Bug 19255: QA Followup - Fix tabs for spaces
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77a28050a6e4c68c25576ccbd576402a2e9590aa
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Sep 6 13:01:17 2017 +0200

    Bug 19255: [Follow-up] Typo "will accessible"
    
    This patch speaks for itself.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09a16fc493c5082a47f0bc677972c4dc9ee18abf
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 5 15:10:53 2017 +0200

    Bug 19255: Correct explanation about list types on shelves.pl in staff
    
    The explanation on list categories on the shelves form is removed.
    The online help text is actualized.
    
    Test plan:
    Go to Lists in staff. Edit a list. The remarks about private and public
    lists on the right side are gone.
    Click Help. Read the adjusted text. Does it make sense?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 972d6c946a193d070b56efafe0f4e3251e0dbd84
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Aug 9 11:30:00 2017 +0200

    Bug 18785: Force scalar context in Koha::Subscription::biblio
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f46ec652b7f88acfba73db0ab66dcc69d2d05b3
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 12 13:01:14 2017 +0200

    Bug 18785: Add the Koha::Subscription->biblio method
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38526ca13aa63bf6dee90e8a408a8dfa93316b58
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 9 16:45:31 2017 -0300

    Bug 14039: Add the title to all places
    
    There are other scripts where the borrower variable is not defined and
    the fields are passed one by one.
    To have a consistent behaviour we should add the title at the different
    places.
    
    Note that this script also add the use of the include file for
    statistics.tt and remove the pass of parameters to the template, already
    done later:
     99 $template->param(%$borrower);
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 359907e9a225235c299d736c26462b8cf3735828
Author: David Roberts <david.roberts@ptfs-europe.com>
Date:   Wed Jun 7 00:01:17 2017 +0100

    Bug 14039: Add patron salutation to checkout screen
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4553aa704038a7c797c10b39f3acc59b190b4021
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jul 10 00:14:10 2017 +0000

    Bug 18916: Add pagination to top of search results in staff client
    
    To look the same as OPAC.
    
    To test:
    1) Do a catalogue search in staff client that results in more than one
    page
    2) Notice pagination is only at the bottom
    3) Apply patch and refresh page
    4) Notice pagination is at top also
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69ee06a490a64985dfccd01cf689ae77eea1d2d5
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jul 10 00:07:38 2017 +0000

    Bug 13205: [FOLLOW-UP] Fixing math and variable names
    
    Have changed
      my $last_page = $pages * ( $results_per_page - 1 );
    to
      my $last_page = ( $pages - 1) * $results_per_page;
    which seems to fix the 'last' button offset! (Comment 10)
    
    Will add the box to jump to a page in a separate patch.
    Adding the pagination to the top on the staff client will be dealt with
    in Bug 18916 as it is slightly out of the scope of this bug.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fc0a1f5b1ad58b4fa0a538cef5d2106fd39c71a
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Jun 27 04:36:56 2017 +0000

    Bug 13205: [FOLLOW-UP] Some extra logic
    
    See Comment 8.
    
    Test:
    When on first page of results, confirm that the 'First' and 'Previous'
    buttons do not show. Confirm they come back on the second page and every
    page after.
    When on last page of results, confirm that the 'Last' and 'Next' buttons
    do not show. Confirm they come back on all previous pages.
    Check on both staff side and OPAC.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a157575d360d663aed2c3c56f70aeeef64ca762
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Feb 16 02:28:13 2017 +0000

    Bug 13205: Last/first page options for result list paging for OPAC
    
    Same fix but on OPAC side. Same test plan
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Dilan Johnpulle <dilan@calyx.net.au>
    Signed-off-by: Your Full Name <your_email>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b97de5af12d54d2cce197e7ad755ac27df3a9604
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Feb 15 02:42:10 2017 +0000

    Bug 13205: Last/first page options for result list paging
    
    This patch adds first and last page buttons to the pagination at the
    bottom of a page of catalog search results.
    
    To test:
    1) Apply patch
    2) Do a number of searches
    3) For each search, ensure that the first and last page buttons work as
    expected
    
    Sponsored-by: Catalyst IT
    
    Followed test plan, works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1fc0b652548510ef00a7e072cdf923357d5610aa
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 28 12:13:26 2017 +0200

    Bug 19190: [Follow-up] Do not rely on the return of ModItem
    
    touch_all_items looks at the return of ModItem to determine if the
    operation was successful. But ModItem does not return a meaningful
    value. This patch puts the ModItem call in an eval and looks at $@.
    
    Test plan:
    Run touch_all_items with a where condition and verbose option.
    Put print 1/0; at the end of ModItem.
    Run touch_all_items again. You should see: ERROR WITH ITEM xxx !!!!
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3b86caaa5473ea51dc7223146e4c7cf0db431dc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 28 11:59:19 2017 +0200

    Bug 19190: Silly calculation of average time in touch_all scripts
    
    When you want to calculate average time, do not divide count by time :)
    
    Test plan:
    Run the script with a where condition and verbose option and see that
    the average time is meaningful.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a18b12ea7f52d5d017cb0f74723cbb50b6d04749
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 9 14:29:41 2017 -0300

    Bug 19043: DBRev 17.06.00.012
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecc5daaceb3c2bb4ea9be2860b839c1686eee2d8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Oct 9 12:51:34 2017 +0200

    Bug 19043: (QA follow-up) Add update DB entry and print warning
    
    This follow-up takes care of the requested warning at upgrade time.
    At the same time it removes the obsolete Columbia record when host and
    port are equal to the formerly used values. Note that the new host for
    on-campus use has been changed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f6f98e00c319e60e9296b96913c8321366a7d12
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Aug 8 15:03:19 2017 +0200

    Bug 19043: Z39.50 target clio-db.cc.columbia.edu:7090 is no longer publicly available
    
    Test plan:
    0) Apply the patch
    1) Install all affected languages: de-DE, es-ES, fr-CA and pl-PL
    2) Remove and recreate Koha database
    3) Go through web installer in English and don't forgot to load sample Z39.50 servers
    4) Go to Administration -> Z39.50/SRU Servers and confirm the sample
    servers are here, but columbia.edu is not here
    5) Repeat 2-4 for other languages: de-DE, es-ES, fr-CA and pl-PL
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c07f63ae84dc16099999e3f7c38e1a49b758af8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 16:04:04 2017 -0300

    Bug 18449: Rename misleading button when renewing
    
    If you hit the renewal limit on the renewal tab, the message gives you a
    message like:
    
    "Windows 8 / ( 50610018249545 ) has been renewed the maximum number of
    times by Johnny Test ( 12345678 )"
    
    And has a button that reads:
    
    "Ignore and continue"
    
    This button is misleading, as it may be interpreted as "ignore the limit
    and continue to renew the item".
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b583e806c73cb79b35ee727a18f6b30ee32197f8
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed Sep 27 07:20:34 2017 +0000

    Bug 19371: Changed table column text to 'Cancel?' on the patron circulation page
    
    Test plan:
    1. Place a hold on an item
    
    2. Search for the patron who the hold is associated with
    
    3. View the Hold(s) tab of the Checkouts page and notice there is a
    column with the text 'Delete?' and a button below the table with the
    text 'Cancel marked holds'
    
    4. Apply patch
    
    5. Notice that the column text described in step 3 now has the text
    'Cancel?' and the button text is the same as it was in step 3
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 799293c40fc4419b9df9ea941836778c2e359684
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 9 14:24:31 2017 -0300

    Bug 13766: DBRev 17.06.00.011
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0152e95c979ff38ed53887f5b1140fdd5e148812
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Sep 4 20:36:38 2017 +0000

    Bug 13766: Follow-up - use index_exists()
    
    Changes check for existing index to use index_exists.
    Also checks deletedbiblioitems for an existing ean index
    and drops it if one is found.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c367705d9d154b195b29bf7c229046928a5f4718
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Aug 17 13:54:36 2017 +0200

    Bug 13766: Change *bibioitems.ean to mediumtext and add indexes
    
    - biblioitems.ean and deleteditems.ean are changed
      to mediumtext to match issn and isbn.
    - An index is added for ean on both tables.
    
    Patch cleans up inconsistencies caused by bug 5337 that
    causes some older databases to have an existing index
    on biblioitems.ean.
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 347ade5c1089813ccecbbd1bb0c91e828a914265
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Sep 26 11:45:25 2017 +1000

    Bug 19367: $biblio variable redefined in same scope in ISBDdetail
    
    The following warning is generated by ISBDdetail.pl:
    my" variable $biblio masks earlier declaration in same scope
    at ./catalogue/ISBDdetail.pl line 171.
    
    This patch removes this unnecessary declaration, which removes the
    warning.
    
    _TEST PLAN_
    
    After applying patch:
    
    1) Check code compilation with "KOHA_CONF=/path/to/koha-conf.xml perl -c catalogue/ISBDdetail.pl"
    2) Note the only message is "./catalogue/ISBDdetail.pl syntax OK"
    2) On /cgi-bin/koha/catalogue/ISBDdetail.pl?biblionumber=1,
    view the source of the page and verify that the Javascript
    contains a holdcount e.g. "var holdcount = 0".
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f59484df2246c0ee11c5d44f2dca762908864fe8
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue Sep 19 12:58:12 2017 +0100

    Bug 19340: Read basket details of transfer partner
    
    Details of the basket an order is tranferred to or from
    are displayed in the basket display.
    Unfortunately these details were not being read so
    the display incorrectly showed the details
    of the current owning basket.
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36821be142b49a4c42ff740c33bda882d39bb885
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 9 14:12:24 2017 -0300

    Bug 13208: Display complete breadcrumbs on successful deletion
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3822105060bf266a1064caaf14f9af270b9f1e11
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 5 03:31:54 2017 +0000

    Bug 13208: [FOLLOW-UP] Tests for Koha::Acquisition::Baskets
    
    To test:
    prove -v t/db_dependent/Koha/Acquisition/Baskets.t
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit faf1bd1e6e7478aec724e4dc33707d89d7820812
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 1 13:18:21 2017 +0000

    Bug 13208: (QA follow-up) Remove blank breadcrumbs on successful deletion
    
    After order is deleted we don't have a vendor or basket so we get blank
    breadcrumbs, this removes them
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87448e82d27921b867bc6982a279f8bdd2b85cb7
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Aug 18 03:23:55 2017 +0000

    Bug 13208: [FOLLOW-UP] Perl documentation for modules
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bdee4a05f782376e7851e1025c9909426f78c57
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Jul 27 01:54:35 2017 +0000

    Bug 13208: [FOLLOW-UP] Creating and implementing new Koha::Acquisition::Basket[s] modules
    
    Test plan remains the same.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 639d7f308f6581880bc2f03cd722af6c76ecd7c5
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Jun 28 01:24:00 2017 +0000

    Bug 13208: Improving breadcrumbs for when cancelling an order
    
    To test:
    1) Go to Acquisitions -> Find a vendor -> View a basket with orders in
    it (or make a new basket and add an order)
    2) Click Cancel order
    3) Notice incomplete breadcrumbs, and 'Acquisition' typo
    4) Apply patch and refresh page
    5) Breadcrumbs should be fixed. Confirm links to vendor and basket work
    as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: severine.queune <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1a5c9e8c9e75bbb82184c732803ae8623b50bfd
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Oct 9 08:43:32 2017 +0000

    Bug 19437: (followup) Rearrange CancelExpiredReserves tests - fix typos
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 511b3253576262878c953e7a3fe4a2941686ab1e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 6 10:41:29 2017 +0200

    Bug 19437: Rearranging tests for CancelExpiredReserves
    
    This patch originates from a QA Follow-up on bug 19260.
    
    The first 19260 patch adds CancelExpiredReserves tests to Reserves.t.
    But note that we already have some tests in Holds/CancelReserves.t.
    
    This patch does:
    Renames Holds/CancelReserves.t to Reserves/CancelExpiredReserves.t.
    Rearranges modules there.
    Moves its existing tests into a first subtest.
    Moves the new subtest from Reserves.t to CancelExpiredReserves.t.
    Replaces $dbh->do('DELETE FROM reserves').
    Adds some TestBuilder statements for missing data (by the move): adding
    biblio, item, borrower (removing slow AddMember call).
    
    Test plan:
    Run Reserves.t and Reserves/CancelExpiredReserves.t.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56500e8e676782155c5717e8db9786af394252d8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 5 10:41:33 2017 +0200

    Bug 19415: FindDuplicateAuthority is searching on biblioserver since 16.05
    
    Commit b4392018bc1f9bf6a2f7dfe70b488856ad3a3897 [Bug 12478: make things using SimpleSearch use the new version] changed sub FindDuplicateAuthority and replaced this call (from 3.22.x) in 16.05 (pushed April 2016):
        my ($error, $results, $total_hits) = C4::Search::SimpleSearch( $query, 0, 1, [ "authorityserver" ] );
    
    The new call does unfortunately not include the authorityserver:
        my ($error, $results, $total_hits) = $searcher->simple_search_compat( $query, 0, 1 );
    Simple_search_compat redirects to C4/Search/SimpleSearch and SimpleSearch assumes a biblioserver if no server is passed.
    
    This effectively makes FindDuplicateAuthority useless since we will no longer find duplicates and we could see an error like this in the log:
        16:51:42-04/10 zebrasrv(51) [request] Search biblios ERROR 114 1 1+0 RPN @attrset Bib-1 @and @attr 1=authtype PERSO_NAME @attr 1=Heading Moerenhout
    
    The fix is obviously trivial.
    
    Test plan:
    [1] Go to Authorities.
    [2] Add a new authority PERSO_NAME with 100a Moerenhout.
    [3] Repeat step 2. Verify that you get the duplicate authority warning.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 725a3022c9ca025755a2d86a36ed84039deab232
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Oct 6 16:41:28 2017 +0000

    Bug 19260: (followup) Fix CancelReserves.t test
    
    Test plan:
    Run t/db_dependent/Holds/CancelReserves.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 090b450a502340e3d03b5ee6a075cc92e647aada
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 6 12:30:18 2017 -0300

    Bug 19423: Prevent DecreaseLoanHighHolds.t to fail randomly
    
    CanBookBeIssued returns STATS if categorycode is X
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d124e1bc322e6823c192c51effa0f3eecb2ac1f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 28 16:27:41 2017 +0000

    Bug 19193: When displaying the fines of the guarantee on the guarantor account, price is not in correct format
    
    1 - Have a patron with guarantees
    2 - Charge some fines to the guarantees
    3 - View the patron
    4 - Fines are displayed unformatted
    5 - Apply patch
    6 - Refresh
    7 - Fines should now be formatted correctly
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e63a3838102ee1fe8a1bc15640196ab611dbc89
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Nov 21 12:08:52 2016 -0500

    Bug 17664: Silence non-zebra warnings in t/db_dependent/Search.t
    
    TEST PLAN
    ---------
    0) back up database
    1) drop database; create database
    2) run web installer
    3) prove t/db_dependent/Search.t
       -- the spammy warnings (other than zebra index warnings) may
          already be fixed, but the mocked value was not realistic.
    4) apply patch
    5) prove t/db_dependent/Search.t
       -- notice only zebra index warnings.
    6) run qa test tools
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 078eb77451dacd6042b783edf6f89f5ab95732b5
Author: David Bourgault <david.bourgault@inlibro.com>
Date:   Tue Sep 19 13:37:54 2017 -0400

    Bug 19345: Add missing error flag to template
    
    Adds a missing error flag to the template->param { } call.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5aa0280c6db66b8961ebfd644ebbdb80ca0081ba
Author: Marc Véron <veron@veron.ch>
Date:   Thu Sep 7 14:48:48 2017 +0200

    Bug 18550: [Follow-up] Add POD descriptions to subs
    
    This patch simply adds POD descriptions to subs affected by first patch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7c3fc0a63c50c2741a636201880c59c57287a51
Author: Marc Véron <veron@veron.ch>
Date:   Fri May 5 15:08:56 2017 +0200

    Bug 18550: Patron card creator: Print output does not respect layout units
    
    To reproduce:
    Text, images and barcode positions are always layed out based on PostScript points, regardless of unit defined in card layout.
    
    To reproduce:
    - Test on top of Bug 18541 (introduces layout grid)
    - Create a card layout with a text field, an image and a barcode. Use points
      as layout unit
    - Activate layout grid
    - Create PDF output, save
    - Change layout unit to mm
    - Create PDF output, save
    - Compare PDFs. Verify that the positions are unchanged (still using points)
    
    To test:
    - Apply patch
    - Create again PDF
    - Verify that elements are positionad as expected (using unit, e.g. mm)
    - Bonus test: Repeat with other units
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f92328332380c805f83ca7f4aed2e828bd112778
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 6 08:21:23 2017 +0200

    Bug 19315: [QA Follow-up] Trivial edits
    
    Replace $subs->{bibnum} by $biblionumber on a following line.
    The scalar in the boolean expression is not needed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 285d72a023daab65626a3ba0f90e20ccfad45c95
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 14 12:23:09 2017 +0000

    Bug 19315: Use bibnum instead of biblionumber in routing-preview.pl and add item check
    
    To test:
     1 - Create a serial subscription attached to a record
     2 - Receive some issues
     3 - Edit the subscription
     4 - Go to serails collection
     5 - Try to print a routing list
     6 - You may or may not get the right serial
     7 - Additionally create a subscription attached to a bib with no items
     8 - Try to print a routing list for this serial
     9 - You will get 'Internal server error'
    10 - Apply patch
    11 - Print routing list for first serial
    12 - You will always get the correct bib
    13 - Print routing list for second serial
    14 - You should no longer get an error
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4edfc7900f6132c6771e4cfc820a5a3dc08d3e13
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 2 14:22:27 2017 -0300

    Bug 19398: Format date of birth in circ patron search
    
    When searching for a patron from the circulation tab, the results table
    shows the date of birth unformatted.
    
    Test plan:
    Apply this patch, search for patrons in the circ tab and confirm that
    the date of birth are correctly formatted according to the dateformat
    syspref
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12a754a703bc8f4279bb23aab09c39c0514b0a75
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 6 11:39:42 2017 +0200

    Bug 19386: [QA Follow-up] Remove some default values
    
    In the meantime bug 19403 added default nulls for gonenoaddress, lost
    and debarred. So these lines can be removed safely.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6545cfe3f30789723b6f3c2e6e13af6e6c8e5fb9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 28 17:31:04 2017 -0300

    Bug 19386: Prevent t/db_dependent/SIP/Patron.t to fail randomly
    
    Depending on the values used by TestBuilder, some tests from t/db_dependent/SIP/Patron.t can fail
    
        #   Failed test 'Not blocked without overdues when set to 'Don't block''
        #   at t/db_dependent/SIP/Patron.t line 55.
        #          got: '0'
        #     expected: '1'
    
        #   Failed test 'Not blocked without overdues when set to 'confirmation''
        #   at t/db_dependent/SIP/Patron.t line 61.
        #          got: '0'
        #     expected: '1'
    
        #   Failed test 'Not blocked without overdues when set to 'Block''
        #   at t/db_dependent/SIP/Patron.t line 67.
        #          got: '0'
        #     expected: '1'
    
    Caused by this check in C4::SIP::ILS::Patron->new
    110     for (qw(EXPIRED CHARGES CREDITS GNA LOST DBARRED NOTES)) {
    111         ($flags->{$_}) or next;
    [...]
    115         if ($flags->{$_}->{noissues}) {
    116             foreach my $toggle (qw(charge_ok renew_ok recall_ok hold_ok inet)) {
    117                 $ilspatron{$toggle} = 0;    # if we get noissues, disable everything
    118             }
    119         }
    120     }
    
    Test plan:
    Execute several times (50x?) these tests.
    Without this patch they may fail
    With this patch they must never fail
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d805c1ce81b38a659c7504d6b7620ab3b10e4089
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 6 11:58:42 2017 -0300

    Bug 19198: Prevent the test to fail randomly
    
    If categorycode is 'X', the test will fail
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30b22c660f76f7a4c25a1239b020a7541a35b5d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 6 11:49:38 2017 -0300

    Bug 19198: do not autovivify
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b41e7799b0071e97e37c63da4fe9d685d3b3fc3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 13 11:59:19 2017 +0000

    Bug 19198: (QA followup) Fix typo in conditions
    
    '&' should be '&&'
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c204171ff3cf4dedc64ea953c968447bcf7d9f65
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 29 14:25:20 2017 +0000

    Bug 19198: Renewal as issue causes too many error
    
    This patch moves some code and prevents checking for too many checkouts
    when performing a renewal via checkout
    
    To test:
    1 - Set a rule to limit checkouts to a single issue, allowing renewal
    2 - Issue an item to a patron
    3 - Issue the same item
    4 - In staff client you get a confirm to renew and a notice of Too Many
    checkouts, don't confirm
    5 - VIA Sip - you get a renewal response, but in logs the renewal fails
    as a 'too
    6 - Apply patch
    7 - Via staff client you shoudl get renewal confirm with no too many
    error
    8 - SIP checkout should renew
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d3eefd8f1cc474346f8804197ac5fb28776191e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 29 14:10:54 2017 +0000

    Bug 19198: Unit tests
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07764f2b3114e5ccb72f7737e316d2cda3ad5068
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Wed Sep 27 17:59:55 2017 +0300

    Bug 19374: CircSidebar overlapping transferred items table
    
    When CircSidebar is activated, "Transferred items" table at
    Circulation -> Transfers goes under the sidebar. This patch fixes the issue.
    
    To test:
    1. Enable CircSidebar system preference
    2. Go to cgi-bin/koha/circ/branchtransfers.pl
    3. Enter a barcode and click submit
    4. Observe transferred items table under the circulation side bar
    5. Apply patch
    6. Enter a barcode and click submit
    7. Observe transferred items is now correctly displayed
    8. Also test with CircSidebar system preference deactivated
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Bug 19374: (follow-up) Remove stray closing div tag
    
    To test:
    1. Apply first patch and validate the document e.g. here
       https://validator.w3.org/#validate_by_input
    2. Observe "Stray end tag div." error
    3. Apply this patch and validate again
    4. Observe no errors
    5. Go through test plan from first patch to make sure things still look nice
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46ff8df19544e3e7c16a4e3f21b3b14bc043dd88
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 20 14:28:20 2017 -0400

    Bug 19135: Restore AllowHoldsOnPatronsPossessions behaviour
    
    Bug caused by
      commit bc39f0392bbebaad4c083f81308f652a325be042
      Bug 14695 - Add ability to place multiple item holds on a given record per patron
    
    Test Plan:
    1) Set AllowHoldsOnPatronsPossessions to "Don't"
    2) Check out an item to a patron
    3) Place a hold on that item for the same patron
    4) Note you are allowed to with no alert
    5) Delete the hold
    6) Apply this patch
    7) Place a hold on that item for the same patron
    8) Note you recieve an alert now
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3cf0caf05ca9577a26bb76d4910d8be8970aa06a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 6 11:05:49 2017 +0200

    Bug 19260: [QA Follow-up] Remove obsolete $dbh
    
    The variable is no longer used.
    Removed a few empty lines on the way.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49c879150de0bb0b8a5d384f8ff1fa51a80d8c10
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Oct 5 20:37:25 2017 +0000

    Bug 19260: Holds marked as problems being seen as expired ones and deleted wrongly
    
    Test plan:
    0) Apply just the first patch - the one with test
    1) Run t/db_dependent/Reserves.t - test for CancelExpiredReserves should
    fail
    2) Apply the second patch
    3) t/db_dependent/Reserves.t should pass now
    
    Followed test plan, patch worked as described. Passes QA test tool
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b91c20da903d1330bf7a997b794f83042bf86fb6
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Oct 5 20:36:31 2017 +0000

    Bug 19260: Add test for CancelExpiredReserves
    
    Passes QA test tool
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea9255c00439fbedccab14a4a50b47fcb1ba05ac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 29 11:49:30 2017 -0300

    Bug 19388: FIX display item status if item is checked out
    
    In course reserves, if an item which was added to a course is checked
    out, it is not possible to show details for that course on OPAC.
    The error says: "Template process failed: undef error - The method
    onsite_checkout is not covered by tests! at
    /home/koha/src/C4/Templates.pm line 121."
    
    onsite_checkout is an attribute of Koha::Checkout, not Koha::Item
    
    Test plan:
    Create a course with 2 items that are checked out (standard and on-site)
    At the OPAC, add them to your cart and confirm the status of these 2
    items is correct
    Confirm that on the detail page of the bib record as well as the detail
    of the course.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10b5e1ee049605ae6a0614214a7dab76e20e0ca5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 2 14:11:52 2017 -0300

    Bug 19122: (bug 18098 follow-up) Fix IncludeSeeFromInSearches behaviour
    
    The IncludeSeeFromInSearches system preference is designed so that 'See from' headings from the authorities are included when you search in the catalog.
    That means that you could find an author not only by the name printed on the book, but for example also by their pseudonym or a different spelling of their name.
    
    It was added by bug 7417.
    
    This regression has been introduced by
      commit 5ef1b6710e7520b844e145e248da0deeee707fde
      Bug 18098: Add an index with the count of not onloan items
    
    -        } elsif ($record_type eq 'biblio' && C4::Context->preference('IncludeSeeFromInSearches')) {
    -            my $normalizer = Koha::RecordProcessor->new( { filters => 'EmbedSeeFromHeadings' } );
    [...]
    +            push @filters, 'IncludeSeeFromInSearches'
    +                if C4::Context->preference('IncludeSeeFromInSearches');
    
    Test plan:
    - Activate IncludeSeeFromInSearches
    - Catalog an authority for a person
      - main heading in 100
      - see from headings in 400
    - Catalog a bibliographic record and link it to the authority
    - Make sure the record is indexed
    - Verify that the record can be found searching for the main heading
    - Verify that the record can be found searching for the see from headings
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Yet another reason to get rid of all this functions from this script.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1bf319829c9d44991daa2fcf2593420f8445c5b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 3 19:20:18 2017 -0300

    Bug 19405: Prevent api/v1/holds.t to fail randomly
    
    DBD::mysql::st execute failed: Duplicate entry 'cEMggO40gdPLhcVXbpry8x0izO8lHr8NafFIBJwm0D1HgiXA57YR0a0VVxhQBzvn' for key 'userid' [for Statement "INSERT INTO `borrowers` ( `branchcode`, `categorycode`, `flags`, `surname`, `userid`) VALUES ( ?, ?, ?, ?, ? )" with ParamValues: 0='N2ElsY9', 1='Kk8G', 2=80, 3='Test Surname', 4='cEMggO40gdPLhcVXbpry8x0izO8lHr8NafFIBJwm0D1HgiXA57YR0a0VVxhQBzvnnbgezJqmxqwz'] at /usr/share/perl5/DBIx/Class/Storage/DBI.pm line 1832.
    DBIx::Class::Storage::DBI::_dbh_execute(): Duplicate entry 'cEMggO40gdPLhcVXbpry8x0izO8lHr8NafFIBJwm0D1HgiXA57YR0a0VVxhQBzvn' for key 'userid' at /kohadevbox/koha/Koha/Object.pm line 121
    [18:52:19] t/db_dependent/api/v1/holds.t
    
    Reading the code I guess it happens if TestBuilder generates a userid with the size of borrowers.userid (75 chars). In that case the following lines are wrong:
    
    $borrower->userid($nopermission->{ userid }."z");
    $borrower2->userid($nopermission->{ userid }."x");
    $borrower3->userid($nopermission->{ userid }."y");
    
    The 3 patrons will have the same userid.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb26219903c30ee6acce926d4a1bb6152f35668c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 3 14:16:02 2017 -0300

    Bug 19403: Prevent Circulation.t to fail randomly
    
    Due to the number of test cases handle by CanBookBeIssued, Circulation.t
    fails randomly. To prevent that it is better to set some values.
    For instance if the patron is a statistical patron (category_type=X),
    the subroutine will return a STATS flag.
    
    This patch also adds a subroutine to the test file to display the keys
    of $error, $question and $alert set by CanBookBeIssued.
    It will be easier to track other random failures.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b0059afb42aca25a3d10dfb372c2b26adcd6e41
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 3 14:15:47 2017 -0300

    Bug 19403: Add some default values when building patrons for test
    
    To avoid some tests to fail randomly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2cc68e8b7a33dd7983c2125e32ba269777b8ace
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 3 12:15:30 2017 -0300

    Bug 19350: Add tests

commit 5c873a408f40fd1660d0b09c6de8c1ca2e252d11
Author: Dobrica Pavlinušić <dpavlin@rot13.org>
Date:   Wed Sep 20 16:01:16 2017 +0200

    Bug 19350 - Holds without link in 773 trigger SQL::Abstract::puke
    
    Test:
    1. find bibio without items which has something in field 773
       (for us, it's article) but doesn't have 0 or 9 (host item entry)
    2. click on hold in left menu
    3. verify application error
    4. apply patch and verify that it works
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>

commit 9dca694b04d0f5e5e0a307e0d5243ce61fb1ef79
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 3 11:03:43 2017 -0300

    Bug 16726: Do not display "You searched for:" if not needed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a60e52bd8e04f039f04e8418db42fc563222aa1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 29 19:39:34 2017 -0300

    Bug 19276: Update the number of tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e09d233eee78f1ee401505f15dd62af99103744c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 29 17:08:28 2017 -0300

    Bug 18120: Tidy up
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08b6f7799b2ad06ff4f9ef88e236f5c928c387b5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 22 15:37:41 2017 -0300

    Bug 18120: (QA followup) Add POD to controler class
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7367274c6230b947b85abf9d4f0463d3c0724171
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 24 14:36:07 2017 -0300

    Bug 18120: (QA followup) 'vendors_manage' permission fits better than full acq
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52c677166d5b35dac0e216e24dc0912e56a7fbd4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Aug 15 23:58:19 2017 +0200

    Bug 18120: Update field descriptions
    
    Trying to clarify some of the descriptions.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d52d57fac6094a245a10d4736c4451702cc4c3b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 28 09:00:07 2017 -0300

    Bug 18120: Add '/acquisitions/vendors' endpoint
    
    This patch introduces an /acquisitions/vendors endpoint.
    To test:
    - Apply the patch
    - Run:
      $ sudo koha-shell kohadev
     k$ prove t/db_dependent/api/v1/acquisitions_vendors.t
    => SUCCESS: Tests pass
    - Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Matthias Meusburger <matthias.meusburger@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17764fbe90c93daeb619742312920a50f5402e1e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 6 16:40:11 2017 -0300

    Bug 18120: /acquisitions/vendors unit tests
    
    This patch introduces unit tests that need to be passed by an
    /acquisitions/vendors/ REST endpoint.
    
    To test:
    - Apply the patch
    - Run:
      $ sudo koha-shell kohadev
     k$ prove t/db_dependent/api/v1/acquisitions_vendors.t
    => FAIL: The endpoint is not present, should fail.
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Matthias Meusburger <matthias.meusburger@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 269c21d984ef451dadcad2e803035cc1cd052825
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 29 16:28:13 2017 -0300

    Bug 19392: Clean-up behind auth_values_input_www.t
    
    The two categories created by this test script are not removed
    
    Test plan:
    without this patch, the two authorised value categories 学協会μμ and
    tòmas are not removed when the script finishes.
    Now it does!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6f8cf43698979914704dd08c45f11e6b8e406ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 29 16:16:56 2017 -0300

    Bug 19391: (bug 19128 follow-up) Fix failing tests from auth_values_input_www.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 995fb8c14f4d78122566588d095ece549c45ffa1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 29 16:49:06 2017 -0300

    Bug 13912: DBRev 17.05.00.010
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5144cee9a9be49dd901dd5afefc6414ce76f6edc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 20 10:52:16 2017 -0300

    Bug 13912: (QA followup) Make it explicit that syspref applies to MARC21
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d818e13887be22a39d35e849dca86b30b06a61e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 7 16:18:00 2017 -0300

    Bug 13912: (QA followup) Update database
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21ee44ff1278ca66a94a9701195da3f6ed7932fe
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Mar 26 09:10:13 2015 +0100

    Bug 13912: Fix LOC link
    
    Signed-off-by: m23 <black23@gmail.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5705c13d3805ca8da2a142780d51f364a0d7a4ec
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Mar 26 08:46:45 2015 +0100

    Bug 13912: Add DefaultCountryField008 syspref
    
    This syspref is going to be used for populating field 008, range 15-17
    with a desired default. It is currently hardcoded to 'xxu'. If not set,
    it will still fallback to 'xxu'.
    
    Signed-off-by: m23 <black23@gmail.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56a0aabc58a3475912894523cc92757153b967bd
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Sep 29 15:52:50 2017 +0200

    Bug 18422: (QA follow-up) Check if select2 is available before using it
    
    cataloging.js might not always be loaded with select2.js, so we should
    check its availability to prevent JS errors
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f5a319b0a9f93dde7600decae5df989b842ca58
Author: Oleg Vasylenko <synapse.ova@gmail.com>
Date:   Wed Apr 12 10:45:48 2017 +0300

    Bug 18422 - Add Select2 to authority editor
    
    Overview:
    Repeat tag fails if authority field has select subfield (for example, UNIMARC 700$8, 800$a)
    This patch adds Select2 to authority editor
    
    Steps to Reproduce:
    In authority editor repeat field that has select subfield
    
    Actual Results:
    Field does not repeat (copy is not created).
    Console shows a js TypeError in cataloging.js: «$(...).select2 is not a function»
    
    Expected Results:
    Field will repeat (copy is created)
    
    Additional Information:
    Error happens in version 16.11+ after adding Select2 js functions. The easiest way to fix is to add Select2 to authority editor
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e2e1247c9bcd15514dc395be891a9a3607e5ea5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 13 12:06:50 2017 +0000

    Bug 19307: Mock the AllowFineOverride preference to ensure expected result
    
    To test:
     1 - Set 'AllowFineOverride' to allow
     2 - prove t/db_dependent/Circulation/NoIssuesChargeGuarantees.t
     3 - 1 test fails
     4 - Apply patch
     5 - prove t/db_dependent/Circulation/NoIssuesChargeGuarantees.t
     6 - All tests pass
     7 - Set 'AllowFineOverride' to 'Don't allow'
     8 - Tests should still pass
    
    Signed-off-by: David Bourgault <david.bourgault@inlibro.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c328f339455fa41a68c0d96015b37b5cb3b86c6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 29 16:47:04 2017 -0300

    Bug 19344: DBRev 17.05.00.009
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e65ee89aae7802a31e47b5343c77f8a8a62d3a38
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 19 13:32:31 2017 -0300

    Bug 19344: Reorder lang and login_attempts in the [deleted]borrowers tables
    
    Due to a bad rebase, the borrowers and deletedborrowers table structure
    may different from a new install and upgraded install
    For new installs, the order was: lang, login_attempts
    For upgraded installs, it was lang, last_seen, login_attempts
    
    After this patch, the order must be:
    - last_seen
    - lang
    - login_attempts
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0aec9e11d5fa355738cb3475ad72c4aad8efeafa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 14 10:57:40 2017 -0300

    Bug 19317: (bug 18966 follow-up) Remove leftover
    
    Nothing important here, but this line should have been removed by bug
    18966:
    
    2177         # Update the fines
    2178         $dbh->do(q|UPDATE accountlines SET issue_id = ? WHERE
    issue_id = ?|, undef, $old_checkout->issue_id, $issue->issue_id);
    
    The issue_id is now the same when moved from issues to old_issues. We do
    not need to update the accountlines table.
    
    No test plan here, you need to understand previous changes to validate
    this patch.
    
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb61d5bc384102fe1dc8db4e69bfdb797337b968
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 8 12:47:03 2017 -0300

    Bug 19276: (bug 17829 follow-up) Fix Statistic patrons behaviour
    
    Bug 17829 must have been handle this specific case: GetMember set
    category_type, but now $borrower is a Koha::Patron unblessed and does
    not contain the category_type.
    The fix is to call ->category->category_type on the Koha::Patron object
    to be able to know if they are a statistic patrons.
    
    Test plan:
    Run the tests
    
    Tests pass, as does QA test tool
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b343df13e6d154296cf968cb709aa910c58f336
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 29 11:29:24 2017 -0300

    Bug 18999: (QA followup) ModReceiveOrder expects a hashref
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit caef98c7f64e02bba996c4da4f862bb55a86171a
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sat Jul 22 19:19:44 2017 +0000

    Bug 18999: Modified SQL query in GetBudgetSpent() in C4/Budgets.pm
    
    Removed the SQL select condition 'AND closedate IS NOT NULL' because
    this was not returning shippingcost values and it does not exist in the
    SQL query to return the shipping cost in spent.pl
    
    Also removed the retrieval of shipping cost and the associated addition
    of item(s) cost and shipping cost in GetBudgetOrdered() in C4/Budgets.pm
    to prevent the shipping costs being subtracted off the fund total twice
    
    Test plan:
    1. Go to Acquisition and create a currency, budget (make this value of
    100), fund ( make this the value of 50), vendor (if
    neccessary)
    
    2. Create a basket and click 'Add to basket'
    
    3. Add 2 items with the vendor price of 10
    
    4. Click 'Receive shipment' and write in the shipment cost of 6
    
    5. Click 'Finish receiving' and go back to Acquisitions
    
    6. Notice the spent column value is 0.00 but if you click on the value then
    the spent.pl page is displayed and shows that the shipment cost was 6.00
    
    7. On the acquisition page also notice that the ordered column value is 26.00
    
    8. Click on the name of the fund and notice the spent column value is
    0.00 in the fund page table
    
    9. Apply patch
    
    10. Refresh acquisition page and notice that 6.00 is the value in the
    Spent column and 20.00 is the value in the ordered column. Both of which
    match the subtotal of the full-list tables displayed when you click on these
    values
    
    11. Also notice the spent value in the fund page table is 6.00
    
    12 Observe the changes to GetBudgetSpent() and GetBudgetOrdered() C4/Budgets.pm and check they make sense
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90c5391b349a339b3f1fea1ebfeb044cfa76c8a6
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sat Sep 16 07:52:25 2017 +0000

    Bug 18999: (QA followup) Minor fixes for tests
    
    Removed unneccessary declaration of $budget and changed
    Koha::Acquisition::Order->new->insert into
    Koha::Acquisition::Order->new->store as requested in tester feedback
    
    Test plan:
    1. Go into your koha-shell
    
    2. set the PERL5LIB variable
    
    3. Run t/db_dependent/Budgets.t
    
    All tests should pass
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 776692f31167f32c1621168249a9ebfea2accc96
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Fri Aug 18 15:16:55 2017 +0000

    Bug 18999: Add regression tests
    
    Added regression test for GetBudgetSpent() and GetBudgetOrdered() into
    the t/db_dependent/Budgets.t
    
    Test plan:
    1. Go into your koha-shell
    
    2. set the PERL5LIB variable
    
    3. Run t/db_dependent/Budgets.t
    
    All tests should pass
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89528af3b089b2d17e3e7b212ea5608478f0ca84
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Aug 30 23:26:38 2017 +0000

    Bug 16463: Replace discharge link with error message if user has checked out items
    
    To test:
    1) Ensure the useDischarge syspref is enabled
    2) Check out an item to a borrower
    3) Log in to the OPAC as this borrower
    4) Click the 'ask for a discharge' link in the nav
    5) Click the 'Ask for a discharge' link
    6) Notice you cannot be discharged because you have checkouts
    7) Apply the patch, click the 'ask for a discharge' link in the nav
    8) Notice the link has been replaced with an appropriate error message
    9) Attempt to force the discharge URL:
    /cgi-bin/koha/opac-discharge?op=request
    10) Notice the message and you cannot be discharged.
    11) Confirm that when you check in your item, the discharge link shows
    again and works as expected.
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1404654d65baccacb2928f59171ec6f41d9b653b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 7 23:09:05 2017 -0400

    Bug 18318: Unicode support for Elasticsearch
    
    You must install the icu plugin for elasticsearch
    https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-icu.html
    
    Once installed, apply this patch
    Reindex your data, deleting the existing indexes
    perl /home/vagrant/kohaclone/misc/search_tools/rebuild_elastic_search.pl
    -d
    Find (or add) some titles with accented characters
    Verify that a search for the exact character or the unaccented version
    works
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 632e2ad51d2510a412224ded5e51a9f991d566b4
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Sep 1 21:23:20 2017 -0400

    Bug 19120: Leave cancelled ordered items alone when reopening basket
    
    TEST PLAN
    ---------
    1) Apply first patch
    2) prove t/db_dependent/Acquisition/close_reopen_basket.t
       -- FAILS
    3) Apply this patch
    4) prove t/db_dependent/Acquisition/close_reopen_basket.t
       -- SUCCESS!
    5) run koha qa test tools
    
    Followed test plan, patch worked as described
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d34fae94995977b730e4bbfc11bdecaa3ce310a8
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Sep 1 21:21:40 2017 -0400

    Bug 19120: Add tests to reproduce the problem
    
    TEST PLAN
    ---------
    1) apply this patch
    2) prove t/db_dependent/Acquisition/close_reopen_basket.t
       -- FAILS!
       -- This proves the test works.
    3) run koha qa test tools
    
    Followed test plan, patch worked as described
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7b2d9bcf37dcded7cba49b1e520a0234850adf7
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Sep 19 07:13:53 2017 +0000

    Bug 19329: Update IntranetSlipPrinterJS system preference description.
    
    Test plan:
    0) Apply the patch
    1) Go to administration -> system preferences -> staff client
    2) Read the description by IntranetSlipPrinterJS and confirm it's right
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60a17c1b2b8582620fc94ab9eadd7e8336a5d1fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 12:54:18 2017 -0300

    Bug 19372: (bug 15801 follow-up) pass selected frameworkcode to the template
    
    Bug 15801 removes the 2 lines that were necessary to retrieve the
    framework selected by the user and pass it to the template.
    All bibliographic records created when adding an order to the basket
    using an external source used the default framework.
    
    Test plan:
    Add an order to a basket from an external source
    Select another framework than the default one
    => Without this patch, whatever the framework you picked, the default
    one is used
    => With this patch applied the framework code you will pick will be used
    
    Signed-off-by: Marijana Glavica <mglavica@ffzg.hr>
    
    Signed-off-by: Marijana Glavica <mglavica@ffzg.hr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae02cf97e469a17d3bdc9d5c7db702960fd620c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 27 13:44:00 2017 -0300

    Bug 19366: Do not block patron's detail update if EmailMustBeUnique
    
    If the pref PatronSelfRegistrationEmailMustBeUnique is set ("consider"),
    a patron is not allowed to register with an existing email address.
    The existing code is wrong and reject a patron that is updating their
    personal details with "This email address already exists in our
    database.", even if the patron did not modify their email address.
    
    This is caused by the query we made, we must search for patron with this
    email address but who is not the current patron.
    
    Test plan:
    - Set PatronSelfRegistrationEmailMustBeUnique to "consider"
    - Register a new patron with an existing email address
    => you should not be allowed
    - Use a non-existent email address
    => You should be allowed
    - Edit your patron details
    - Modify some infos
    => Should pass
    - Modify your email address with an existing one
    => You should not be allowed to do that
    
    Followed test plan, patches worked as described
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99f6e1adf3d3236c2a08ad31d4282d429d50974b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 21 11:09:57 2017 -0300

    Bug 19357: (bug 18260 follow-up) Remove non-relevant attributes
    
    When created, batch_record_modification.tt has been based on
    batch_delete_records.tt
    These attributes are not used in the template and not set in the pl
    script.
    Since bug 18260, biblio is a Koha::Biblio and calling a non-existent
    method will raise an error.
    
    This patch get rid of the following error:
    batch_record_modification.pl: Template process failed: undef error - The
    method itemnumbers is not covered by tests!
    
    Test plan:
    Modify bibliographic records with the "Batch record modification" tool.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c84d03c582976cb590c62b25d59505b982a71d97
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 16 15:12:07 2016 +0100

    Bug 15173: Restore SubfieldsToAllowForRestrictedEditing
    
    Bug 7673 introduced SubfieldsToAllowForRestrictedEditing but bug 12176
    broke it assuming that only selects were impacted by this feature.
    
    Test plan:
    Go back on bug 7673 and confirm that
    SubfieldsToAllowForRestrictedEditing is working as expected with this
    patch applied.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    For clarification, the item fields that are entered in
    SubfieldsToAllowForRestrictedEditing should EXCLUDE the desired
    fields you want to disable.
    
    Test plan (updated to test the scenario in the bug Description):
    1. Create a patron with only the following permissions:
        - catalogue (Required for staff login)
        - editcatalogue -> edit_catalogue
        - editcatalogue -> edit_items
        - editcatalogue -> edit_items_restricted
    2. Navigate to Administration -> Global system preferences -> Cataloging
        -> Record Structure -> SubfieldsToAllowForRestrictedEditing
    3. In the input field for SubfieldsToAllowForRestrictedEditing enter in
        all the 952 fields EXCEPT the ones desired to be disabled. In this
        case, we want to disallow editing of 952$2, 952$a, 952$b, 952$e, 952$h,
        and 952$o so we enter the following into the
        SubfieldsToAllowForRestrictedEditing (without quotes) "952$0 952$1
        952$3 952$4 952$5 952$7 952$8 952$c 952$d 952$f 952$g 952$i 952$j
        952$p 952$t 952$u 952$v 952$w 952$x 952$y 952$z"
    4. Click Save all Cataloging preferences
    5. Login to the staff client as the created restricted editing patron
    6. Edit an item
    7. Note that all fields except for the ones excluded from the syspref
        are editable
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12bd6358cfe6c9348cb111d22f04097f7911babf
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 15 11:12:01 2017 +0200

    Bug 19323: subscription edit permission issue
    
    If a librarian has edit_subscription but not create_subscription :
    When trying to edit a subscription, after saving permission is denied.
    
    This is because permissions in serials/subscription-add.pl depends on arg 'op' and on edit this arg starts with 'modify' but changes to 'modsubscription' when saving.
    
    Test plan :
    - Create a user with staff access
    - Define its permissions on serials : only edit_subscription
    - Edit a subscription
    - Click 'Next'
    - Click 'Test prediction pattern'
    - Click 'Save subscription'
    => Without patch you get to page serials/subscription-add.pl with permission denied
    => With patch subscription is saved and you get to subscription details page
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f270c4a3b56a8b92554670ae9aceb857b50b897e
Author: Dobrica Pavlinušić <dpavlin@rot13.org>
Date:   Mon Sep 18 19:17:35 2017 +0200

    Bug 19334: Circulation history doesn't set biblionumber so left navigation is broken
    
    Navigation on the left (Normal, MARC, etc...) needs biblionumber in
    template variables to work.
    
    Test:
    1. go to checkout history for any biblio
    2. verify that normal, MARC, etc links on the left no longer work
       due to missing biblionumber in URL
    3. apply patch and test it again
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80fd5cd0dbfe8c5612325ca65251d36a97fcfc1c
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Aug 22 08:58:11 2017 +0000

    Bug 19116: Hold not set to waiting after transfer
    
    Test plan:
    
    0) Do not apply the patch
    1) Place hold on item from another branch
    2) Switch to that branch
    3) Check them in at the other branch to set them into transport status (T)
    4) Switch back to your homebranch
    5) Check items in again, use the different confirm buttons and
        compare: Only "confirm and print" will be set to waiting, "confirm"
        remains in transport.
    6) Apply the patch
    7) Repeat 1-5 - now should work as expected - the hold is marked waiting
    on "confirm" button too
    8) Check the hold from the same branch, to make sure this doesn't add
    regression
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0c73b7bdafd21e19e0c1ba6a7ea222216d70500
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Sep 22 08:40:56 2017 +0000

    Bug 19116: (followup) Add tests to highlight the problem in CheckReserves
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 021d1d3714602be64609b9db82fd92e8bb1b42c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 4 14:14:31 2017 -0300

    Bug 19116: Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 357d51c8c4bd0eeffd83bc04f96b9c3dc66afa02
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 11:21:27 2017 -0300

    Bug 19127: (follow-up) Fix Stored XSS in csv-profiles.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b90662073ff99d25e0f32156924f79981f9d5707
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Wed Aug 16 17:56:17 2017 +0530

    Bug 19127: Fix Stored XSS in csv-profiles.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/tools/csv-profiles.pl?op=add_form
    2. Add a text in the field Profile name, Profile description
       and Profile MARC fields that contains js
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 914577fdb788b70fdb0979a6ea88ca10e3345796
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 11:06:11 2017 -0300

    Bug 19108: (follow-up) Fix Stored XSS in biblio_framework.pl
    
    Prevent software error
    Template process failed: undef error - text: filter not found at
    /home/vagrant/kohaclone/C4/Templates.pm line 121.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 624eb9e1f5f7ca87a6d8fbbaef0bbaa3dea3bc21
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 16 13:52:07 2017 +0200

    Bug 19108: (follow-up) Fix Stored XSS in fieldmapping.pl and items_search_fields.pl
    
    To test:
    - Add a framework with script in the description
    - Access the Keywords to MARC mapping page
    - Add an item search field where both name and label are script
    - Try to edit/delete the added mapping
    
    With the patch no script should be executed and everything
    should still work ok.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a482880352c4e9b363402a83358e1c239fbc1d74
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 14:37:50 2017 +0530

    Bug 19108: Fix Stored XSS in biblio_framework.pl and marctagstructure.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/biblio_framework.pl?op=add_form
    2. Add a text in the field Description that contains js
    3. Save the page.
    4. Notice js is execute
    5. Click on Actions -> MARC structure
    6. Apply patch and reload, the js is escaped
    
    Fixed for both the pages biblio_framework.pl and marctagstructure.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec85c6b0a23088e91922c0b095f39bfbca2f4456
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 14:10:43 2017 +0530

    Bug 19108: Fix Stored XSS in fieldmapping.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/fieldmapping.pl
    2. Add a text in the field Field name that contains js
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a68fd033035491a1e8060d47ca30f8640cd835e
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 14:06:47 2017 +0530

    Bug 19108: Fix Stored XSS in authtypes.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/authtypes.pl?op=add_form
    2. Add a text in the field Description that contains js
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b09750ca2b1446bdeaf78a5989b4325e41789362
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 13:55:45 2017 +0530

    Bug 19108: Fix Stored XSS in classsources.pl
    
    Fixed for both Classification sources & Classification filing rules
    
    To Test
    1. first case classification source: Hit the page
       /cgi-bin/koha/admin/classsources.pl?op=add_source
       second case classification filing rules:
       Hit the page /cgi-bin/koha/admin/classsources.pl?op=add_sort_rule
    2. Add a text in the field Description that contains js
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfbba2339f3c39fcf19ec1b12585f15f9ea68993
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 13:49:10 2017 +0530

    Bug 19108: Fix Stored XSS in items_search_fields.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/items_search_fields.pl
    2. Add a text in the field Name and Label that contains js
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload, the js is escaped
    
    Fixed for new and edit page
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1aa11c51c0b7312ea08327b57b4adb04f3c7c48
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 13:33:57 2017 +0530

    Bug 19108: Fix Stored XSS in oai_sets.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/oai_sets.pl
    2. Click on New set
    3. Add a text in the field setSpec, setName that contains js
    4. Save the page.
    5. Notice js is execute
    6. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab7b35fe2466bbca5082a315dfb5bd33add3d956
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 10:58:24 2017 -0300

    Bug 19103: (follow-up) Fix Stored XSS in itemtypes.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 233741e937cade658de0181d41fe2d315a7ab993
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 10:15:54 2017 +0530

    Bug 19103: Fix Stored XSS in matching-rules.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/matching-rules.pl
    2. Click on new record matching rule
    3. Add a text in the field Description that contain js.
    4. Save the page.
    5. Notice js is execute
    6. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 617e2f822141c9a430f87304e6030f3d2fb4a6d7
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 10:07:45 2017 +0530

    Bug 19103: Fix Stored XSS in patron-attr-types.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/patron-attr-types.pl
    2. Click on new patron attribute type
    2. Add a text in the field Description that contain js.
    2. Save the page.
    3. Notice js is execute
    4. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9374c646e164db5f48f88e3a8fcb904a79922013
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 08:52:40 2017 +0530

    Bug 19103: Fix Stored XSS in itemtypes.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/itemtypes.pl
    2. Add a text in the field Description, Checkin message that contains js
    2. Save the page.
    3. Notice js is execute
    4. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3734f02e1e76dfe9710b85887df826303feff14
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 10:35:10 2017 -0300

    Bug 19128: Fix Stored XSS in admin/authorised_values.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4608887f664ed73d6813375f503b2bebd542adb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 16 14:34:17 2017 +0200

    Bug 19128: Fix Stored XSS in patron-attr-types.pl, authorised_values.pl and categories.pl
    
    Preparation:
    - Add a branch with script in the branch name
    - Add a patron category with script in the category name
    - Add a new authorised value cateogory with script
    - Add a new authroised value for this category with script
      in all possible fields
    
    - Test editing patron categories
    - Test editing patron attribute types
    - Test viewing and editing authorised values
    
    Verify that with this script there is no more script executed
    and everything works fine.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d308456010745b90bcd99f40d56db0fcd9cad65
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 16 12:05:50 2017 +0200

    Bug 19125: Fix Stored XSS in members.pl
    
    In preparation to test this patch:
    - Add a patron list named <script>alert("patron list")</script>
    - Add a library named <script>alert("library")</script>
    - Add a patron category named <script>alert("patron category")</script>
    
    To test:
    - Access patron search page and do a search
    - Verify that the alerts added above are executed
    - Apply patch
    - Verify that no alerts are displayed
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bbe968fe57316b8bb28ad02df87c0b97c249904
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 16 13:07:18 2017 +0200

    Bug 19086: Fix Stored XSS in subscription-detail.pl
    
    Add script to the callnumber field on adding a subscription.
    
    Verify script is executed without this patch, but not with it.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13e65432ce6f78c277835d5a5fe22fe99ed0b20c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 16 12:59:13 2017 +0200

    Bug 19086: (follow-up) Fix Stored XSS in supplier.pl
    
    In preparation:
    Make sure you enter <script>alert("sth")</script>
    in all fields of a new vendor that are not validated
    and save.
    
    1) Access vendor summary page.
    2) Verify scripts are executed
    3) Apply patch
    4) Verify scripts are on longer executed
    
    This works in combination with the other patches for XSS
    on this bug.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec86950780e908f5b2a5d53e21cffede6d570b08
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 02:44:11 2017 +0530

    Bug 19086: Fix Stored XSS in subscription-add.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/serials/subscription-add.pl
    2. Add a text in the field Public note and Nonpublic note
       that contains js (Internalnotes, notes)
    2. Save the page.
    3. Notice js is execute
    4. Apply patch and reload, the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d22674da5062cc61b6bd8667f8fb5775f71b05a
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 02:33:59 2017 +0530

    Bug 19086: Fix Stored XSS in supplier.pl
    
    1. Hit the page /cgi-bin/koha/acqui/supplier.pl?op=enter
    2. Add a text in the field company_postal, physical, company_fax,
       accountnumber, contactposition, contact_fax, contact_notes, notes that contains java script
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload the js is escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50dcae4b504a4a54a830ae87848ba3fa5161ad57
Author: Chris Cormack <chris@bigballofwax.co.nz>
Date:   Fri Aug 11 19:54:34 2017 +0000

    Bug 19086: Fix Stored XSS in circulation.pl
    
    1/ To test add a message to a borrower that contains js
    2/ hit /cgi-bin/koha/circ/circulation.pl?borrowernumber=[number]
      where number is the borrowernumber of the borrower you set the message
      for
    3/ Notice js is execute
    4/ Apply patch, reload, js is escaped
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c176b8ceefc8a4b964b8671c4d3198af053b59c8
Author: Chris Cormack <chris@bigballofwax.co.nz>
Date:   Fri Aug 11 19:36:43 2017 +0000

    Bug 19086: Fix Stored XSS in members/member.pl
    
    To test
    1/ hit /cgi-bin/koha/members/member.pl?&searchmember=<script>alert('XSS Payload')</script>
    2/ Notice js is executed
    3/ Apply patch, reload
    4/ js is now escaped
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae86b7ca9ea60bba47d3a999ff13d6140cdc5e1c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 28 14:49:11 2017 -0300

    Bug 19385: Fix random t/Calendar.t failure - clear the cache before
    
    The cache 'exception_holidays' may be populated when we run these tests,
    we need to clear it before the tests are run.
    
    Test plan:
      prove t/db_dependent/Circulation/CalcDateDue.t  t/Calendar.t
    
    Without this patch, t/Calendar will fail with:
      #   Failed test 'Exception holiday is not a closed day test'
      #   at t/Calendar.t line 159.
      #          got: '1'
      #     expected: '0'
      # Looks like you failed 1 test of 38.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4e525e4f6382a421cb7e77632fca8ecaaf8f3d6
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Thu Mar 16 13:53:44 2017 +0200

    Bug 18282: operationId must be unique
    
    operationId has the following documentation:
     "Unique string used to identify the operation. The id MUST be unique among all
      operations described in the API."
    
    This patch modifies operationIds to be unique accross our API operations.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 256c66752f2817892b03938edb375b234a616fcd
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Fri Mar 17 08:09:05 2017 +0200

    Bug 18290: Fix t/db_dependent/Koha/Object.t, Mojo::JSON::Bool is a JSON::PP::Boolean :)
    
    Mojolicious 7.21 onwards, no longer returns Mojo::JSON::Bool-objects but JSON::PP instead.
    Which might be pretty smart.
    
    This version is required by bug 18137 and so this patch for the tests is
    needed.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Tested along with 18137 and its dependencies (libs).
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2bf98402a2d98461b638a584413184b57beaee17
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 9 11:11:13 2017 -0300

    Bug 18137: (QA followup) Make sure the session exists and is expired on expiration tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47b6026c6a3d57cfc86d90fcb72c0d68266b214c
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Feb 17 13:14:09 2017 +0200

    Bug 18137: List Mojolicious::Plugin::OpenAPI and JSON::Validator as dependencies
    
    Edit (tcohen): I've changed the version numbers to match those Mirko has already
    successfully packaged and are known to work for this patchset.
    
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbda925f85ec96651483bd51efed5853b34e8dfb
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Thu Mar 16 14:24:52 2017 +0200

    Bug 18137: (follow-up) Sort definitions.json
    
    Before this file grows, we should sort it alphabetically.
    
    To test:
    1. prove t/db_dependent/api/v1
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c93ea0be10080817cc84a75f5e99c69655d012e
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Tue Mar 7 13:31:04 2017 +0200

    Bug 18137: (QA-follow-up) Fix pod fail
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2918cc9c2712d5b658a207b15dcd63718b8f952e
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Tue Mar 7 13:37:09 2017 +0200

    Bug 18137: (follow-up) Fix handling DBIx::Class::Exception messages
    
    - DBIx::Class::Exception should use ->{msg}
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f9e262ab5d3ac8aa95c771e236693135a2a2c1b
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Tue Feb 21 19:55:28 2017 +0200

    Bug 18137: Remove x-mojo-around-action
    
    Mojolicious::Plugin::OpenAPI does not support x-mojo-around action. This patch
    removes it from our specification document.
    
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 047508bb8d6f3cedfe50d7be360972cd8df3d68a
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Mon Feb 20 20:07:26 2017 +0200

    Bug 18137: Make /holds Mojolicious::Plugin::OpenAPI compatible
    
    Also
    - adding some missing and new response definitions into Swagger spec.
    - fixing failing tests due to Bug 17932's change of boolean values
    
    To test:
    1. prove t/db_dependent/api/v1/holds.t
    
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b007919e35c7588b0d95c5257b5334e26a38300b
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Mon Feb 20 19:58:28 2017 +0200

    Bug 18137: Make /cities Mojolicious::Plugin::OpenAPI compatible
    
    Also:
    - adding some missing and new response definitions into Swagger spec.
    
    To test:
    1. prove t/db_dependent/api/v1/cities.t
    
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 915963ba7f1580f8d7aaa0b5563c974b7254874a
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Feb 17 14:59:24 2017 +0200

    Bug 18137: Make /patrons Mojolicious::Plugin::OpenAPI compatible
    
    Also:
    - adding some missing and new response definitions into Swagger spec.
    - fixing failing test due to Bug 17932's change of boolean values
    
    To test:
    1. prove t/db_dependent/api/v1/patrons.t
    
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2fc5247012a99b4242370248a061681d84174f2
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Feb 17 14:36:36 2017 +0200

    Bug 18137: Migrate from Swagger2 to Mojolicious::Plugin::OpenAPI
    
    This patch migrates from Swagger2 to Mojolicious::Plugin::OpenAPI as Swagger2 is
    no longer actively maintained.
    
    This migration involves some minor changes to our Swagger specification documents
    and to controllers. Each operation is migrated in following patches separately.
    Please see Mojolicious::Plugin::OpenAPI and its tutorial for more documentation.
    
    The patch also refactors some API authentication -related code by taking advantage
    of Koha::Exceptions. Authentication is now handled via Mojolicious's "under->to"
    functionality. The actual authentication & authorization checks are moved to
    Koha::REST::V1::Auth. Added a HTTP 503 response for when database update is
    required, instead of returning an authentication failure as before.
    
    To test:
    1. prove t/db_dependent/api/v1/auth.t
    
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea6c6f3026adce1f0eecf58752f7ae01494d60ed
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Feb 17 14:34:42 2017 +0200

    Bug 18137: Add useful Koha::Exceptions
    
    Signed-off-by: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 164b13690ab133b499ebeb2a809c8c8649debbfe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 20 12:45:24 2017 -0300

    Bug 19119: Remove definitions.t
    
    This patch removes t/db_dependent/api/v1/swagger/definitions.t
    
    Its goal is not simple to achieve, and worth moving into the QA tools instead.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 779089a62af26e2566d60340773331d25316a09a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 20 09:15:42 2017 -0300

    Bug 18508: Fix t/db_dependent/api/v1/swagger/definitions.t (follow-up of 6758)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50a2efdcc1e39c2e2994da637e54150d00b4e419
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Fri Apr 28 12:33:33 2017 +0000

    Bug 18508: Fix t/db_dependent/api/v1/swagger/definitions.t (follow-up of 18137)
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 402c7f756707eb3205b1ddc4a2d1f2df54a32daf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Aug 25 06:26:21 2017 -0400

    Bug 19173: Add opac payment and marc conversion plugins to the pulldown filter list
    
    Edit: fixed tab-for-space errors (tcohen).
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    New categories are added to the pulldown and work as expected.
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 323b1553b0538abb25f61f85e76f12f34e0e33e3
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 24 06:55:49 2017 -0400

    Bug 19173: Make OPAC online payments pluggable
    
    While PayPal is fairly universal, there is a plethora of online
    payment system that are far more localized, servicing a single
    country ( e.g. Bug 18968 ) or even a single  city! Instead of
    adding support for each and every one of these payment options
    directly into Koha, it makes more sense to add the ability to
    create online payment plugins.
    
    Test Plan:
    1) Apply this patch
    2) Download and install the Kitchen Sink plugin version 2.1.1 or later
       https://github.com/bywatersolutions/koha-plugin-kitchen-sink/releases
    3) In the plugin options, enable the opac payments option
    4) Create a patron with one or more fines
    5) Log into the opac as that patron, note you now have the option
       to pay online via KitchenSink ImaginaryPay
    6) Make an online payment
    7) Note the payment was processed correctly
    
    Sponsored-by: Washoe County Library System
    
    Signed-off-by: Kyle M Hall <kyle@gmail.com>
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Awesome enhancement! I know we want to add at least one Norwegian
    payment service at some point.
    I followed the test plan and everything works as advertised. Turning
    off the "opac payments option" makes the option dissappear cleanly
    from the OPAC. I have *not* looked at the code or done any
    considerations about security.
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4270d24338f40f2e59e0814019dac9830fa09553
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 19 13:03:50 2017 -0300

    Bug 6758: DBRev 17.05.00.008
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfbcafb7bc665fc3992c24d4e3e6de73cfef0303
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 19 13:20:41 2017 -0300

    Bug 6758: DBIC Schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 889fee73133d405be55e60c610746cdb7ba85865
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 19 13:13:47 2017 -0300

    Bug 6758: Use 'is' instead of 'ok' in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5803d746a4cc12402b4b72f8b465f629e23fb3c9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 4 09:03:43 2017 +0200

    Bug 6758: [QA Follow-up] Typo popular vs populate
    
    Typo popular resolved.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b57088868ee53bce1ee6dff95cf18d8005b4b34d
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 25 13:27:00 2017 -0400

    Bug 6758: Add new patron column for date of renewal
    
    Test Plan:
    1) Apply this patch
    2) Run updatedatabase
    3) Create a new patron
    4) Note the new column date_renewed is NULL
    5) Renew the patron
    6) Note the date in the column date_renewed is today's date
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8088e3a3379fb8708226cabeadc190f7310d93f4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 19 11:57:10 2017 -0300

    Bug 19195: Do not explicitely force scalar context when unecessary
    
    These ones are already called in scalar context
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e98c178c081d4bb5673e6b04bf817b9c452cba8c
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Aug 29 05:02:29 2017 +0000

    Bug 19195: Preventing noisy warns when creating or editing a basket
    
    To test:
    1) Open the koha intranet error log
    2) Go to Acquisitions -> Find or create a vendor
    3) Create a new basket, filling all fields
    4) Notice warns in error log
    5) Edit this basket
    6) Notice warns in error log
    7) Apply patch
    8) Create another basket, confirm warns do not show
    9) Edit this basket, confirm warns do not show
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ce1cc6aada33d7f72b8d3b0b9af4add65a93842
Author: Dobrica Pavlinušić <dpavlin@rot13.org>
Date:   Mon Sep 18 17:37:21 2017 +0200

    Bug 19332 - Basket grouping PDF and CSV exports empty
    
    This bug was introduced in commit 2bf3ce268de6bc8b2386cfb5d768f60b05d75f44
    Bug 17196: [QA Follow-up] Additional fix on acqui/basketgroup
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06b602b0976e2a8d53ff31f95a2213cbeb98e9cb
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Aug 29 21:21:00 2017 +0000

    Bug 19180: [FOLLOW-UP] Renaming all instances of 'name' variable to 'booksellername'
    
    ... when referring to the name of the vendor.
    
    To test:
    1) Confirm vendor shows on webpage title (tab name)
    2) Confirm vendor shows in breadcrumbs
    3) Confirm vendor shows in heading when viewing basket ('Basket x (1) for
    vendor')
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 438a3dea0c8ef1a5adcec58d8b97474d14ccca9b
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sun Aug 27 23:00:15 2017 +0000

    Bug 19180: Add vendor name to breadcrumbs when closing an order
    
    To test:
    1) Go to Acquisitions
    2) Find a vendor and a basket
    3) Click 'Close basket' button
    4) Notice that on confirmation page, breadcrumbs are missing vendor
    5) Apply patch and refresh page
    6) Vendor name should now show
    7) Confirm link to vendor works as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17c5b76597b9a356bc215a3682d7293e307fcc46
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Aug 30 04:36:50 2017 +0000

    Bug 16204: Show friendly error message if trying to edit record which no longer exists
    
    To test:
    1) Create a record
    2) Click Edit -> Edit record. open this in another tab
    3) Delete the record in the original tab
    4) Refresh the edit form in the other tab. Notice the software error
    5) Apply patch and refresh page
    6) There should be a nice error message with the form fields and buttons
    hidden. Confirm links work as expected.
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a59eaa5277b60055df216373247efc654551d579
Author: Marc Véron <veron@veron.ch>
Date:   Wed Sep 6 17:46:27 2017 +0200

    Bug 18541: (QA follow-up) Add some POD for draw_guide_grid
    
    Add description to POD for draw_guide_grid
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Moved the description from draw_guide_box to .._grid.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f5e8668a75e2a75b638fbb39ca3b5576bcf76d3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Sep 6 16:14:26 2017 +0200

    Bug 18541: [QA Follow-up] Add POD to Patroncard.pm
    
    Just adding the POD framework to make qa tools happy. The authors
    are encouraged to complete this information.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7ac741e6a5d5e9bf4fb96dda3e4fabeace7f025
Author: Marc Véron <veron@veron.ch>
Date:   Wed Sep 6 15:56:55 2017 +0200

    Bug 18541: (QA follow-up) Fix wrong variable name ($layout_xml vs $print_layout_xml)
    
    This patch changes variable names as mentioned in comments #11 and #13
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45aea7ae1df815d241e7a34fbb5c42e9475f6d04
Author: Marc Véron <veron@veron.ch>
Date:   Thu May 4 17:36:24 2017 +0200

    Bug 18541 - Patron card creator: Add a grid to support layout design
    
    Add a layout grid to patron card creator to figure out the positions of text
    fields, barcode and images.
    
    To test:
    - Apply on top of patch 18465
    - Go to Home > Tools > Patron card creator
    - Edit or create a layout
    - Turn on new choice 'Guide grid' in section 'General settings'
    - Leave 'Units' unchanged
    - Crate a PDF using 'Card batches'
    - Notice that card is printed with a layout grid that reflects selected unit
      with each 5th and 10th line in different color, unit description displayed
      bottom left, card dimensions displayed top right in small print inside the
      layout grid
    - Print PDF. Set printer settings in Adobe Reader or other PDF printing
      software to 'Actual size' to prevent scaling to printer's printable
      region
    - Mesure out printed PDF and verify that grid corresponds to selecte unit.
    - Go back to layout definition and choose an other unit, repeat steps
      to verify that grid respects selected unit.
    - Go back to layout definition, turn grid off, create PDF, verify that grid
      does not display in PDF
    
    Note for testers / QAers: Position of card elements (text, image...) do not
    respect the unit, this will be fixed in Bug 18550
    
    Followed test plan and it worked as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9355e5204074349c232c58caa678a8ab40c18efe
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 6 18:35:07 2017 +0000

    Bug 18739 - Add SVG version of staff-home-icons-sprite image
    
    Images display correctly. Followed test plan and patch works as described.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83704cb1fab33feb0262fdab99bccf0052243d14
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 8 16:01:32 2017 +0000

    Bug 15644 - City dropdown default selection when modifying a patron matches only on city
    
    This patch modifies the include files which contain the form fields for
    city, state, zipcode, etc. shown on the patron entry screen. The files
    are modified so that the city/state/zip <select> preselects a value
    based on city, state, and zipcode matching the values in the
    corresponding text fields.
    
    To test, confirm that the bug's steps to reproduce are fixed:
    
    - Enter two cities via Administration -> Patrons and circulation
      -> Cities and towns:
        Springfield, MA 01101
        Springfield, VT 05156
    - Edit a patron choosing, Springfield VT, and save.
    - Edit the patron again and confirm that the correct city is
      pre-selected.
    - Confirm this result with all three different settings of the
      "AddressFormat" system preference.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e722c0a29f730869df24cbe48afcedc12bb57344
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 29 13:03:39 2017 +0200

    Bug 18149: Move CountUsage calls to Koha namespace
    
    After the introduction of Koha::Authorities->get_usage_count with bug
    9988, we can now replace the remaining occurrences of CountUsage.
    
    At the same time we remove CountUsageChildren. This was an empty sub.
    The typo get_count_usage in a subtest title is adjusted.
    
    Test plan:
    [1] Run t/db_dependent/Koha/Authorities.t
    [2] Perform a search on authorities-home.pl and verify that you see
        plausible numbers for 'used in xx records'.
    [3] Click on Details for one authority. See the same number?
    [4] Do the same as in 2/3 for Authority search on OPAC.
    [5] Remember the authid and enter this in the record numbers box on
        tools/batch_delete_records.pl. Select Authorities and click
        Continue. The next form shows a column "Used in". Do you see
        the same count again?
    [6] Git grep CountUsage.
        You should see just one hit in a comment that can be kept in
        Koha/Authorities.pm.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f9dce409f6dba60cbb52ae682e70d8203e96ea1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 19 11:46:51 2017 -0300

    Bug 10132: DBRev 17.05.00.007
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80c749df80f08be46b895715045b38cd1ded2ed1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 19 09:59:36 2017 -0300

    Bug 10132: Simplify code, call the method only once
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30311019987dcddd410fd86c018443e9480253b5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 11 16:14:41 2017 -0300

    Bug 10132: (QA followup) Open LOC URL on a separate window
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ead305ba4ee9ae5795b3956b41b6a723d7c894d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 11 16:08:09 2017 -0300

    Bug 10132: (QA followup) Add POD to ->get_effective_marcorgcode
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fcf6e88ba6c95461df127293ffd4931a48118f4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 11 16:02:00 2017 -0300

    Bug 10132: (QA followup) Organize tests in subtest
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b36a0e1a59b92294cabe0ea33886f43f8ef1a5fe
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Jun 11 19:23:41 2017 +0000

    Bug 10132: Add ability to set MARC Organization Code at library level
    
    Test plan:
    0. Apply patches
    1. Update database
    2. Go to administration -> libraries, try to update some library and
    fill in some value into Marc Organization code field
    3. Save this library and edit again - the code should be stored
    correctly
    4. Go to system preferences and fill in some value into MARCOrgCode
    preference, note there is enhanced description mentioning the ability to
    set organization code on library level
    5. Set active library to the one with own org code stored
    6. Go to cataloguing, create new empty record and click into field 003 -
    there should be the code you filled for that library
    7. Set active library to one withou marc org code
    8. Go to cataloguing, create new empty record and click into field 003 -
    there should be the code from system preference
    9. Go to system preferences again and set AutoCreateAuthorities to
    'generate' and BiblioAddsAuthorities to 'allow'
    10. Go to cataloguing and create some biblio record, fill in any author
    in to create its authority record, save the biblio
    11. Go to authorities and find this created authority, go to details and
    check the fields: 003, 040$a, 040$c, 670$a - there should be used right org code
    12. prove t/db_dependent/AuthoritiesMarc.t t/db_dependent/Biblio.t t/db_dependent/Koha/Libraries.t
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2d56c0b2b6b45af2926fe3c8b80c35868fb3738
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Jun 11 19:22:06 2017 +0000

    Bug 10132: Admin pages changes
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4eee19747cb4c1bea2b71b9759a7bc940079492
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Jun 11 19:48:50 2017 +0000

    Bug 10132: Unit tests
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91bdd9533b38f79e084dbfd34c7db4ada2b4041c
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Jun 11 19:21:16 2017 +0000

    Bug 10132: DBIC update
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed94450bd6bfa509b96d0c2dcd77a3b1cf20086c
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Sun Jun 11 19:19:38 2017 +0000

    Bug 10132: Database changes
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0d4313e571d44841cb2a472487e0616cd91c88f
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Jun 20 13:06:47 2017 +0200

    Bug 18810: Update Font Awesome to 4.7.0
    
    Test plan:
    
    0) Apply the patch
    1) Edit a template and use any of the new icons, see
    http://fontawesome.io/icons/
    2) Verify that the added icon is shown
    
    For alternative test see comment #2. Works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ae70349809d51552e4297625db1382aa4e26dc5
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Sep 1 16:07:36 2017 +0200

    Bug 18742: (QA followup) Fix indentation
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff22cb46a5f6a1f75422c2a90e1f80ccb05c30b9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 7 10:56:47 2017 -0400

    Bug 18742: Circulation statistics wizard no longer exports the total row
    
    To test:
    - Run the circulation wizard
    - Export to csv
    - Note there is no total row
    - Apply patch
    - Export to csv
    - Total row totally there!
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d03f143e25f498de780d2ddd1972c3be7947519
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 18 14:23:54 2017 -0300

    Bug 19335: Fix 00-merge-conflict-markers.t when dockerised
    
    This does not make sense, but fix a bug (why?)
    Without this patch, the tests failed on po files:
    
    [17:14:26] t/00-merge-conflict-markers.t .. Failed 1/1 subtests
    Test Summary Report
    -------------------
    t/00-merge-conflict-markers.t (Wstat: 9 Tests: 0 Failed: 0)
      Non-zero wait status: 9
      Parse errors: Bad plan.  You planned 1 tests but ran 0.
    Result: FAIL
    
    Note that this is not related to bug 19227.
    
    if the ^>>>>>> and ^<<<<<< matches are done on the same line, the test fail
    As saw it failed on *-pref.po files
      misc/translator/po/kn-Knda-pref.po
      misc/translator/po/ja-Jpan-JP-pref.po
      misc/translator/po/nl-BE-pref.po
      misc/translator/po/sr-Cyrl-pref.po
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bb19808bb23a01a257a0970bd7e2ae43fb5b3d6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 18 15:58:15 2017 -0300

    Bug 19337: Make basic_workflow.t configurable through ENV
    
    This patch makes the basic_workflow.t selenium tests read ENV for the
    following vars:
    
    KOHA_USER
    KOHA_PASS
    KOHA_INTRANET_URL
    SELENIUM_ADDR
    SELENIUM_PORT
    
    to properly configure the running environment. If absent, all variables
    fallback to current behaviour:
    
    KOHA_USER // 'koha'
    KOHA_PASS // 'koha'
    KOHA_INTRANET_URL (unchanged)
    SELENIUM_ADDR // 'localhost'
    SELENIUM_PORT // 4444
    
    [*] Selenium defaults are documented on the Selenium::Remote::Driver docs.
    
    Prerequisites:
    Make sure you have a working environment for the Selenium tests:
    - Run:
      $ sudo apt update
      $ sudo apt install xvfb firefox-esr
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ wget https://selenium-release.storage.googleapis.com/2.53/selenium-server-standalone-2.53.1.jar \
         -O /tmp/selenium.jar
     k$ SELENIUM_PATH=/tmp/selenium.jar
     k$ Xvfb :1 -screen 0 1024x768x24 2>&1 >/dev/null &
     k$ DISPLAY=:1 java -jar $SELENIUM_PATH &
     k$ prove t/db_dependent/selenium/basic_workflow.t
    => SUCCESS: Tests pass
    - Apply this patch
    - Run:
     k$ prove t/db_dependent/selenium/basic_workflow.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c73b6d51dac3d07d32135f0f891cc6418101a53b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 7 14:34:18 2017 +0200

    Bug 19059: [QA Follow-up] Typo holds for hold
    
    Resolves:
    The method found is not covered by tests at C4/Reserves.pm line 815.
    
    Test plan:
    Run t/db_dependent/Holds/CancelReserves.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c43a555dbce3a50a752cdf397379766c46fb3555
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 1 16:50:26 2017 -0300

    Bug 19059: Fix compilation issues
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adf4077b39c96bd353fb733b3e8093550cb9db09
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 7 15:13:17 2017 -0300

    Bug 19059: Remove CancelReserve
    
    It's done!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71b9dc1e3932db29e8fa7a32dd25e7e54c95f228
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 4 10:44:56 2017 -0300

    Bug 19059: Remove CancelReserve - do not log DELETE
    
    There is something wrong with the DELETE log, it should be replaced with
    a FILLED log.
    Anyway, here we do not want it to be logged.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db5848bf2a5b5f881a1cf59fb794ecfd01841c8d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 3 18:00:22 2017 -0300

    Bug 19059: Remove CancelReserve - add new tests
    
    This is bonus, let's add new tests
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a86d7fd3d097987da8e97054ff37e3061eeb9811
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 3 15:12:25 2017 -0300

    Bug 19059: Remove CancelReserve - move tests
    
    Move the existing tests
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82115d164a15767965d267826cc64e74132bd374
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 2 14:00:12 2017 -0300

    Bug 19059: Move C4::Reserves::CancelReserve to Koha::Hold->cancel
    
    This patch adds a new Koha::Hold->cancel method and replaces the calls
    to C4::Reserves::CancelReserve with it.
    
    Test plan:
    - Add and cancel holds
    - Change priority of holds
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5400795a6651adc021801052fa0186747983b587
Author: Dominic Pichette <dominic@inlibro.com>
Date:   Tue Sep 12 10:13:58 2017 -0400

    Bug 18584 - removed white space in C4/Accounts.pm
    
    Test Plan:
        1-go to C4/Accounts.pm
        2-there should not be a trailing space at line 279.
    
    Signed-off-by: Dominic Pichette <dominic@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6eebfe5fe02be3c2ab3285b58cf50fac980cb302
Author: Jon Knight <J.P.Knight@lboro.ac.uk>
Date:   Mon Aug 21 15:04:20 2017 +0000

    Bug 19068: Add quantity field to the opac suggestions form
    
    This enhancement just exposes the quantity field to the OPAC suggestions
    form to permit the end user to enter this if they wish.  The librarians
    can of course override this quantity when they process the suggestion.
    
    Test Plan (assuming using kohadevbox VM):
    1) apply patch and turn on purchase suggestions
    2) Go to http://localhost:8080/cgi-bin/koha/opac-suggestions.pl?op=add
    and notice that there is now a quantity field available.
    3) Make a purchasing suggestion using this form, including a quantity.
    4) Log in as a member of library staff and go to Home › Acquisitions ›
    Suggestions
    5) Confirm that the previously entered suggestion is there, and that the
    correct quantity appears in the "Acquisition information" section.
    6) Edit the purchasing suggestion, change the quantity, save it and
    check that the new quantity appears in the suggestion.
    
    I've popped an ID attribute of "opac-suggestion-quantity" to the
    surrounding <li> so that CSS can easily make this optional field
    disappear (as suggested by cait on IRC).
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4efe251f353cb9eddd302b6214e1f4392620b395
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 6 11:23:10 2017 -0300

    Bug 12346: Display the correct number of pending patron modifications on the patron module home page
    
    Due to the way members-home.pl handles the variable $branch, the number
    of patron modifications listed on members-home.pl may differ from the
    number listed on mainpage.pl. When the librarian clicks this link, he or
    she may see a different number than was listed, or none at all!
    
    Test Plan:
    0) Set IndependentBranchesPatronModifications = Yes
    1) Create a number of modification request for BranchA
    2) Log into the staff intranet with a patron without superlibrarian
    permissions and set your branch to BranchB
    3) Note the modifications alert to does not display on mainpage.pl
    4) Click the "Patrons" link to take you to members-home.pl
    5) Note the modifictions alert does display on this page
    6) Apply this patch
    7) Reload members-home.pl, note the alert no longer displays
    
    QA notes: What was the point of the branch variable?
    
    Followed test plan, patch worked as described. Also passed QA test tool
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d07449358010392b111a674c3606cdfe2cbe47e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 1 14:39:25 2017 +0000

    Bug 17380: [QA Follow-up] Report error to user instead of throwing exception
    
    Internal server errors are good, user feedback is better.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tiny change: removed the obsolete 'use Koha::Exceptions'.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0c372c5fa0e867d346b342ae470b31c33d52b26
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 1 14:39:03 2017 +0000

    Bug 17380: (QA followup) Fix parameter in tests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87773a6d661f122a52b34f6c67255424c335e297
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jun 26 12:51:59 2017 +0200

    Bug 17380: Do not allow Default template in merge form
    
    This patch makes the following changes:
    [1] Removes Default from the template list. We should not merge with the
        Default framework, since it does not have a reporting tag.
    [2] Rearranges the error section in the template. It is confusing to have
        two error sections in this template. The error CANNOT_MOVE is not used.
        The error FRAMEWORK_NOT_SELECTED is replaced by WRONG_FRAMEWORK.
    [3] Do not allow to merge a record with itself.
    [4] Check if the merge reference record still contains any MARC tags.
    [5] Additional polishing: Simplify passing frameworks to template. Remove
        an unused Koha::Authority::Types->search. Remove obsolete POD header
        for functions from the script.
    
    Test plan:
    [1] Select two authorities to merge. Verify that you cannot select Default
        anymore as framework for the reference record.
    [2] Reproduce error WRONG_COUNT by adding another authid=999 in the URL
        after you selected two authority records for merging.
    [3] Remove the third authid from the URL and change the first or second
        authid into an unexisting record id. You should generate an Internal
        Server Error. The log should show the exception message.
    [4] Merge two authorities. Deselect all MARC tags. Should trigger the
        error EMPTY_MARC in the template.
    [5] Select the same authority record twice for merging. Should trigger the
        error DESTRUCTIVE_MERGE in the template.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 434162c1756b16b5fc715fd1cb762aaf8aff7b2b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jul 4 14:31:21 2017 +0200

    Bug 17380: Graceful resolution of missing reporting tag in merge
    
    Altough this patch deals with a mostly hypothetical case and this report
    makes it practically impossible anymore to merge with records in the
    Default framework (having no reporting tag), we can make the code of
    sub merge still a bit more robust here.
    
    If you would merge biblio records from one authtype to another and the new
    framework would not have a reporting tag, before this patch the result would
    be data loss. Merge would handle this request as a delete. This patch makes
    merge handle it differently: instead of clearing the biblio records, it
    keeps $a and $9 in order to make a future corrective merge possible.
    
    Note: The additional condition on line 1468 for $tags_using_authtype
    makes sure that we do not select all fields when the authtype should
    unexpectedly be empty string (Default). This prevents crashing on
    a "Control fields do not have subfields" error.
    
    Test plan:
    [1] Run t/db_dependent/Authorities/Merge.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db35492c795540d6c3b10f7cba18698aeb84a816
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jun 26 13:41:56 2017 +0200

    Bug 17380: Do not use GuessAuthTypeCode in MetadataRecord::Authority
    
    If we got an authtypecode from the database and this value is not NULL
    since the table column does not allow it, there is no need to call
    GuessAuthTypeCode for empty string (read: Default framework) in the
    sub get_from_authid.
    
    Furthermore, we remove three Koha::MetadataRecord::Authority->new calls.
    They are useless, since we do not pass a record. It just generates:
      No record passed at authorities/merge.pl line 96.
      Can't bless non-reference value at Koha/MetadataRecord/Authority.pm line 66.
    Instead we throw an ObjectNotFound exception.
    
    Test plan:
    [1] Run t/db_dependent/Koha_Authority.t
    [2] Interface will be tested in the following patches.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e631f418a3fafa485b650f0975ee0d06e366884
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Feb 23 10:02:57 2017 +0100

    Bug 17380: Add some checks around Authorities::Types->find
    
    Resolves:
    Use of uninitialized value $biblio_fields in scalar chop at authorities/detail.pl line 212.
    Can't call method "authtypetext" on an undefined value at authorities/detail.pl line 216.
    Can't call method "authtypecode" on an undefined value at authorities/detail.pl line 180.
    
    NOTE: Some of these problems have actually been resolved now by bugs 18801
    and 18811, but it is still better imo to have these checks.
    
    Test plan:
    [1] Verify unchanged behavior. Search for some authorities on authorities.pl
        and click on the details of a record.
    [2] Open an authorities detail page and change the authid in the URL to a
        not existing number. Instead of an internal server error, you should see
        a message like "The authority record you requested does not exist".
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc60c344768540c5e02c8e46e8ae43f7921d252a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 12 12:04:50 2017 -0300

    Bug 18811: DBRev 17.05.00.006
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 562435e767c99670dd9fb8935a2ed483b7a61930
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Sep 4 09:27:09 2017 +0200

    Bug 18811: [QA Follow-up] Resolved POD warnings
    
    Trivial changes to silence qa tools on POD warnings for Subfields and Tags.
    
    Note: Since Subfield and Tag only contain one sub which is considered as
    private by Pod::Coverage, these modules are listed as unrated (no public
    symbols defined) and trigger a FAIL on pod coverage in qa tools. This fail
    can be ignored.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac653bc7cec4e2ca1f8653efff4a9c44f4255540
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Sep 4 09:19:01 2017 +0200

    Bug 18811: [QA Follow-up] Add tests for Koha::Authority::Subfields/Tags
    
    Renaming t/db_dependent/Authorities to Authority
    Adding Subfields.t and Tags.t
    
    Test plan:
    [1] prove t/db_dependent/Authority
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f45fc4d10b84dfbd8040d12484553db8c87ec45a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 23 07:59:04 2017 +0200

    Bug 18811: Atomic update to print warning at upgrade time
    
    The warning encourages people to run the auth_show_hidden_data script
    to check for data in hidden fields and adjust their frameworks.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15dee475180ac362e182e1708d1c8b1b1e25e635
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 22 15:39:41 2017 +0200

    Bug 18811: Add a script for checking authority data in hidden fields
    
    If you edit an authority record while having data in hidden fields or
    subfields, that data will be lost now.
    This script can help you to unhide some fields and prevent data loss.
    
    Test plan:
    [1] Add a PERSO_NAME record. Fill e.g. 100b.
    [2] Hide 100b in the PERSO_NAME framework.
    [3] Run auth_show_hidden_data.pl and verify that it reports 100b in
        the PERSO_NAME framework.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca8f8b4cd91fac4acb6e2338720b8e0a82bce0b0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 22 13:42:38 2017 +0200

    Bug 18811: Add Koha Objects for authority tags and subfields
    
    Trivial copy and paste activity.
    Will be used in a later patch.
    
    No test plan needed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e222bb0796196f1e466b73d909fd28d529cab75
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 15 12:30:27 2017 +0200

    Bug 18811: Change visibility checks in authorities.pl
    
    The check is now <=-4 or >=5, but the framework uses 0 for Show all and
    -5 for Hide all. (Note that sql installer scripts also use 8.)
    When modifying an authority, the script also showed hidden fields when
    filled, since it did not check the hidden field but only the tab field.
    
    NOTE: The proposed solution restores consistency, but will remove hidden
    fields from the MARC record.
    
    Test plan:
    [1] Set field 942a to Show all in an authority framework.
    [2] Open a new record in this framework and verify that you see 942a.
    [3] Edit an existing record in this framework and verify again.
    [4] Set field 942a now to Hide all in this framework.
    [5] Open a new record in this framework and verify that 942a is hidden.
    [6] Edit an existing record in this framework and verify again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35e3de845c591958d66c6602940453f2a803a7ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 6 10:42:28 2017 -0300

    Bug 19262: Remove xt/author/pod_spell.t
    
    If you run `prove xt/author/pod_spell.t` without having Test::Spelling installed, it will skip the tests.
    
    If you install the lib-test-spelling-perl, the test will fail:
    xt/author/pod_spell.t .. You said to run 0 tests at xt/author/pod_spell.t line 21.
    xt/author/pod_spell.t .. Dubious, test returned 25 (wstat 6400, 0x1900)
    No subtests run
    
    This is because the call to all_pod_files_spelling_ok is expecting a path
    
    If we try to fix it with adding "." as parameter, the tests will raise tone of errors.
    
    Let's remove this file
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8502b0d197bab4b4966e9e02253d30f7fcf29f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 31 11:47:11 2017 -0300

    Bug 19227: Reduce the number of tests run by 00-merge-conflict-markers.t
    
    The number of tests on jenkins is sometimes confusing:
    
    https://jenkins.koha-community.org/job/Koha_Master_D8/lastCompletedBuild/testReport/(root)/t_00_merge_conflict_markers_t/
    
    shows that 00-merge-conflict-markers.t ran 10,751 tests, 124 less than
    the previous run. However 124 files have not been removed from the
    codebase!
    
    I suggest to count only 1 test for all files.
    
    Moreover files from blib and cover_db are counted, they should be
    excluded.
    
    Test plan:
      prove t/00-merge-conflict-markers.t
    must return green
    
    echo ">>>>>>>" >> mainpage.pl
    and run the test again
    It should now fail
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Works as advertised.
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99e691feee5ef29bbc9d24a916fc4aa2fab6bba6
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Sep 1 13:16:43 2017 -0400

    Bug 19235: Password entry visible in OPAC Self-registration
    
    The HTML code was "text" instead of "password".
    
    TEST PLAN
    ----------
    1) 'Allow' PatronSelfRegistration system preference
    2) Define the PatronSelfRegistrationDefaultCategory system preference (e.g. PT)
    3) Open OPAC
    4) Click 'Register here' on the right.  (/cgi-bin/koha/opac-memberentry.pl)
    5) Scroll to bottom
    6) enter some passwords
       -- visible
    7) apply this patch
    8) refresh page
    9) repeat 5-6 as needed
       -- passwords should not be visible while entering
    10) run koha qa test tools
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ae69d27815dc01ab515b6d8f0239ef5fe59251c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 8 09:41:21 2017 -0300

    Bug 19277: Make sure the tests will pass even if they are slow
    
    This patch was my first attempt to fix the issue.
    I think it is good to have it, if issue.timestamp and issue.issuedate are the same,
    the result will be orderd by issue_id.
    The tests highlight the fact that checkouts must be displayed in the
    correct order.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a64723e6d3d21b3e0d9302b273b6fbb43c969af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 8 09:38:28 2017 -0300

    Bug 19277: TT syntax - Display ordered data
    
    This issue has been highlighted by a failing test: ISSUESLIP displays checkouts in random order
    
    I thought it was because of dates comparison, but it comes from the following line in C4::Letters::_get_tt_params
      my $objects = $module->search( { $key => { -in => $values } } );
    
    The DBMS will return data like there is ordered in the DB.
    For instance:
      select borrowernumber from borrowers where borrowernumber in (5, 3, 1);
    or
      select borrowernumber from borrowers where borrowernumber=5 or borrowernumber=3 or borrowernumber=1;
    
    will return 1, 3, 5
    
    I did not find a generic way to do that, so used "ORDER BY FIELD" which will not be portable.
    
    Test plan:
    If you do not apply this patch, the tests will sometime fail
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ed469525fe16e36663c1f5266568beb5e27672d
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Mar 30 04:15:54 2017 +0000

    Bug 18351: Able to delete budget with funds
    
    To test:
    1) Create a budget, add a fund
    2) Delete budget. Notice this is successful and triggers no warning
    message etc.
    3) Go to Funds. Notice the funds appear as if they are not there
    4) Go into mysql and view the aqbudgetperiods table - notice the funds
    are still there and are now inaccessible.
    5) Apply patch
    6) Create a budget, add a fund
    7) Attempt to delete budget. Notice you can't click Delete button.
    Confirm number of funds in hover message is correct.
    8) Delete fund
    9) Confirm you can now delete budget.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Felix Hemme <felix.hemme@thulb.uni-jena.de>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Bug 18351: [FOLLOW-UP] Some code fixes
    
    See Comment 5. Ready to test.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Bug 18351: [FOLLOW-UP] Code fix
    
    See comment 10.
    Ready for testing.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Bug 18351: [FOLLOW-UP] Prevent deletion from forcing URL
    
    This patch adds a check in the script for existing funds so that the
    budget cannot be deleted when forcing the URL and has other small fixes.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Bug 18351: [FOLLOW-UP] Prevent deletion if funds are added after clicking 'Delete' and before confirming delete
    
    Followed test plan and patch works as described.
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 133e25c56ac79e0b88b89e3b749df338e63a93d0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 8 10:14:10 2017 +0200

    Bug 15438: [QA Follow-up] Moving POD statement for CanBookBeIssued
    
    The statement for head3 NB ('nota bene'?) looks like a hash key
    in the list of possible return values for $needsconfirmation.
    Moved it up and prefixed it with IMPORTANT.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d223bdc6156fab0667867f3990854fddfab5684
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Wed Aug 24 13:52:52 2016 +0100

    Bug 15438 - Checking out an on-hold item sends holder's borrowernumber in AF (screen message) field.
    
    The returns from C4::Circulation::CanBookBeIssued used
    to be structured as a hashref of entries like
       REASON => {
           data => 'foo',
           moredata => 'bar',
       };
    Some entries still are. But many are now
       REASON => 1,
       data   => 'foo',
       moredata => 'bar',
    
    The sip Checkout routine still assumed the former, as it
    reports any causes it was not aware of (to maintain support for
    a changing api) The data fields could leak into the screen message
    field of the response. e.g. the borrowernumber or surname of the
    borrower who has a hold on an issued title. Some real messages were
    getting obscured by this
    
    This patch sanatizes the return from from CanBookBeIssued
    by removing keys which are not all uppercase
    It also fixes a case where the key's data element was used
    for the screen message when we should use the key itself
    
    Updated the documentation of CanBookBeIssued to flag up
    the assumption re case and the fact that 3 elements rather
    than two may be returned
    
    The loop through the returned keys was a bit bogus
    so we now explicitly jump out if noerror is unset
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested quite extensively. Test results put on Bugzilla.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 889fabe9f28f3b6ef35fc36e73b12652f258510c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Sep 12 14:57:25 2017 +0200

    Bug 18654 - Translatability: Get rid of tt directives starting with [%% in translation for itemsearch.tt
    
    Followup correcting a typo of previous patch :
      name="holdingbranch" options = branche
    it is branche[s]
    
    Test plan :
    - Look at 'Current location' in item search
    => Without patch you see only 'All libraries'
    => With patch you see 'All libraries' and each existing library, like in 'Home library'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4653629f63d410326036cef5aa8a70c55d17f45
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 6 14:45:00 2017 -0300

    Bug 19256: (QA followup) Add missing POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad9f89c6c32ba8e8fc52566d5e8c7e5b8c9d43e9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Sep 6 10:15:55 2017 -0400

    Bug 19256: (QA followup) Remove warn from unit test
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3aeb1fc7e85e01cebf7ef726ea1d877b7b0edab6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 5 10:15:59 2017 -0300

    Bug 19256: Make Koha::Acq::Order using Koha::Object
    
    At the moment we have 2 different modules for acquisition orders:
    Koha::Tmp::Order[s] and Koha::Acquisition::Order
    The later has been added before the creation of Koha::Object.
    Koha::Tmp::Order[s] has been created to make the TT syntax for notices
    works with acquisition order data.
    
    This patch removes the temporary packages Koha::Tmp::Order[s] and adapt
    the code of Koha::Acquisition::Order[s] to be based on Koha::Object[s].
    
    It also overloads Koha::Object->new to add the trick that was done in
    Koha::Acquisition::Order->insert. This is needed because acqui/addorder.pl
    is called from several places and CGI->Vars is used to retrieved order's
    attributes (and so much more). To avoid regression, the easiest (but not
    cleanest) way to do is to filter on aqorders column's names.
    This is *not* a pattern to follow!
    
    Test plan:
    Create basket and add orders from different ways, then continue a whole
    acquisition process
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b56c19528e332381384639ed347d11508086c547
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 5 22:42:14 2017 +0000

    Bug 19258: Prevent warn when reversing a payment
    
    The following warn is triggered when I click the Reverse button next to
    an individual payment on the Account tab:
    CGI::param called in list context from package
    CGI::Compile::ROOT::home_vagrant_kohaclone_members_boraccount_2epl line
    63, this can lead to vulnerabilities. See the warning in "Fetching the
    value or values of a single named parameter" at /usr/share/perl5/CGI.pm
    line 436.
    
    To test:
    1) Go to a members detail page in staff side, create a manual invoice,
    pay it
    2) Go to the Account tab, click Reverse next to the payment you just
    made
    3) Notice warns
    4) Apply patch and repeat steps 1 & 2
    5) Warns should be gone
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddf494b18f6c422d3654b0a78a63be86f5356065
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 5 22:38:12 2017 +0000

    Bug 19258: Preventing warns when paying a fine or charge from Pay selected button
    
    The following warns are triggered when I click the Pay selected button:
    CGI::param called in list context from package
    CGI::Compile::ROOT::home_vagrant_kohaclone_members_pay_2epl line 267,
    this can lead to vulnerabilities. See the warning in "Fetching the
    value or values of a single named parameter" at
    usr/share/perl5/CGI.pm line 436.
    CGI::param called in list context from package
    CGI::Compile::ROOT::home_vagrant_kohaclone_members_pay_2epl line
    273, this can lead to vulnerabilities. See the warning in "Fetching
    the value or values of a single named parameter" at
    /usr/share/perl5/CGI.pm line 436.
    
    To test:
    1) Go to a members detail page in staff side and create a manual
    invoice
    2) Go to the pay fines tab, select the fine you just created and click
    Pay selected
    3) Notice warns
    4) Apply patch and repeat steps 1 & 2
    5) Warns should be gone
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 693cc1122b2b96ef2fc176b07371a4608104eaaf
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 5 22:34:18 2017 +0000

    Bug 19258: Prevent warns when writing off an individual fine
    
    The following warns are triggered when I click the Write Off button next
    to an individual fine or charge:
    CGI::param called in list context from package
    CGI::Compile::ROOT::home_vagrant_kohaclone_members_pay_2epl line 171,
    this can lead to vulnerabilities. See the warning in "Fetching the
    value or values of a single named parameter" at
    /usr/share/perl5/CGI.pm line 436. (this shows many times)
    Use of uninitialized value in subroutine entry at
    /usr/share/perl5/URI/Escape.pm line 184.
    
    To test:
    1) Go to a members detail page in staff side and create a manual
    invoice
    2) Go to the pay fines tab, click the Write off button next to the
    invoice you just created
    3) Notice warns
    4) Apply patch and repeat steps 1 & 2
    5) Warns should be gone
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ffda7a7bc9f627165954b8272f1bb71c1b2beff
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 5 22:05:36 2017 +0000

    Bug 19258: Prevent warn when paying a fine or charge
    
    To test:
     1) Go to a members detail page in staff client
     2) Select the Fines tab in the left pane
     3) Select the Create manual invoice tab below the button menu bar
     4) Create a fine and click save (e.g. Type: Fine, Amount: 5.00)
     5) Select the Pay fines tab below the button menu bar
     6) Click Pay on the item
     7) Blank the staff error log
     8) click confirm
        -- staff error log has message
     9) apply this first patch
    10) repeat steps 3-8
        -- staff error log is blank
    11) run koha qa test tools
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ed1513e5fe91772c1720963006bf8f04452416d
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 5 21:16:05 2017 +0000

    Bug 19257: Prevent warn when reopening a basket
    
    To test:
    1) Go to Acquisitions, find a vendor and a basket (create if you don't
    have either)
    2) Close the basket
    3) View the basket and reopen it
    4) Notice the warn
    5) Apply the patch and repeat steps 1-3
    6) Notice the warn no longer shows and the basket is reopened as
    expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f989a81dff29db78620057d70ed864b32486bc0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jul 10 14:15:09 2017 +0200

    Bug 18921: Resolve a few warnings in C4/XSLT.pm
    
    Resolves warnings like:
    
    Use of uninitialized value in hash element at C4/XSLT.pm line 262.
    Use of uninitialized value in numeric eq (==) at C4/XSLT.pm line 267.
    Use of uninitialized value $status in concatenation (.) or string at C4/XSLT.pm line 300.
    
    Note: Line numbers are not exactly the same anymore.
    
    Test plan:
    [1] Enable XSLT view in OPAC
    [2] Without this patch, you will probably have some of these warnings when
        doing some opac searches.
    [3] Apply this patch. Check the logs again.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a9fafe3090333647244db99ccd39d53e51b781c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 7 14:15:20 2017 -0300

    Bug 19214: prevent crash if club_template_field is called in list context
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 594c48fb5b2c03f5d638d7115e42820294e32343
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Aug 30 23:54:56 2017 +0000

    Bug 19214: Prevent crash if ->club or ->patron is called in list context
    
    To test:
    1) Create a club template and a club.
    2) Add a user to the club
    3) Log in to the OPAC as that user
    4) Go to 'your summary' and click the Clubs tab
    5) Notice clubs do not load and a warn shows:
    Template process failed: undef error - Cannot use "->find" in list
    context at /home/vagrant/kohaclone/Koha/Club/Enrollment.pm line 62.
    6) Go to the staff side and go to the member page of that user
    7) Go to 'details' and click the Clubs tab
    8) Notice clubs do not load and a warn shows:
    Template process failed: undef error - Cannot use "->find" in list
    context at /home/vagrant/kohaclone/Koha/Club/Enrollment.pm line 71.
    9) Apply patch
    1) Repeat steps 4-7, confirming the errors do not show and clubs info
    loads correctly
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24003b84ce637d228a4062dcf29415eb8e4f2162
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 12 11:49:37 2017 +0000

    Bug 17893 - Move JavaScript to the footer on staff client catalog pages
    
    This patch modifies multiple catalog-related pages in order to move
    embedded JavaScript to the footer.
    
    The JavaScript previously embedded in cat-toolbar.inc is moved to a
    separate file (catalog.js).
    
    To test, apply the patch and test JavaScript-driven interactions on all
    modified pages, including JS which isn't page-specific (menus, help,
    etc). The functionality of the catalog toolbar should be tested on each
    page.
    
    - Bibliographic detail pages (standard, MARC, labeled MARC, ISBD).
    - Advanced search page
    - Local cover image viewer
    - Item search page
    - Item detail page
    - Search history page
    - Checkout history page
    
    https://bugs.koha-community.org/show_bug.cgi?id=17839
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c31e6e795cda3ea9b2ae4372d36572fc9e06f61
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Jan 27 03:37:31 2017 +0000

    Bug 12691: Use Koha.Preference in Self-Checkout
    
    For calls to SCOUserJS, SCOUserCSS, OPACUserCSS, AllowSelfCheckReturns,
    OpacFavicon, ShowPatronImageInWebBasedSelfCheck, SelfCheckoutByLogin
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 12691: [FOLLOW-UP] Follow-up patch
    
    This patch fixes merge conflicts and fixes the problems in Comment 7
    
    QA tools complain about missing bracket, will be fixed in next followup
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 12691: [FOLLOW-UP] Missing bracket
    
    Patch adds bracket to template file (Comment 16)
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 12691: [FOLLOW-UP] Fixing some logic
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Patches have been squashed for readability and 1 removal occurrence of
    display_patron_image has been reintroduced.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7aef2f3298b0348c2a3994e344e32e5bc41f1f07
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Aug 31 21:18:24 2017 +0000

    Bug 19228: Trigger confirm delete when removing item from course
    
    To test:
    1) Enable UseCourseReserves syspref
    2) Go to Course Reserves
    3) Add a new course if you don't already have one
    4) Add an item to the course
    5) Click 'remove' to delete the item from the course
    6) Notice the item deletes straight away with no confirmation prompt
    7) Apply the patch
    8) Repeat steps 4 and 5
    9) Confirm the confirmation box pops up and works as expected
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f55af2fc078a7d6a05238232bc276e6924307179
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Aug 31 21:25:28 2017 +0000

    Bug 19229: Return to course when cancelling out of edit form
    
    To test:
    1) Ensure UseCourseReserves is enabled
    2) Go to Course Reserves, create a course
    3) Edit course
    4) Click Cancel
    5) Notice you are returned to the courses home page rather than returned
    to the course
    6) Apply patch
    7) Go to edit course and click cancel again
    8) Confirm you are returned to the course and that this feels like the
    natural expectation.
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ffba42465faaaa257a3a82555aaeaed0c23ae43
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 7 11:48:09 2017 +0200

    Bug 19268: Fix TestBuilder parameter in C/Branch.t and K/P/Messaging.t
    
    The values parameter should be called value.
    See bug 15339.
    
    Test plan:
    Run the adjusted tests.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62605145932c452bee8e5b6f49ce1b5a75803bd7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 7 13:55:01 2017 -0300

    Bug 15339: Remove extra 'my'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cb6ed24ffb6f7bfa74b7ea4062070cc5cd0e6d2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 7 09:24:28 2017 +0200

    Bug 15339: [QA Follow-up] Add a warning too when source is not supplied
    
    When you do not supply a source and add a few wrong parameters, you
    would not be warned. Because build simply returns undef.
    Adding a carp and a test for that situation too.
    
    Note: In the earlier subtest 'trivial tests' build was called without
    source. This now generates a warning. We just catch if there is a warning
    and test the actual warning itself later on.
    
    Test plan:
    Run t/db_dependent/TestBuilder.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d60cc56613755a432bb0962b2e808229c8c575c1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 6 13:41:47 2017 -0300

    Bug 15339: Improve parameter validation
    
    Only value and source are allowed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d53f7607b57d253e7f95bb6c2d699ed3e93c84b1
Author: Martin Persson <xarragon@gmail.com>
Date:   Wed Dec 9 11:31:12 2015 +0100

    Bug 15339: TestBuilder warnings (tests)
    
    Makes TestBuilder::build() alert the user when unreognized parameters
    are passed, which happens when the user supplies the column values
    directly, forgetting the 'value' hash.
    
    This patch contains the tests that doubles as a demonstration
    of the kind of error the patch is intended to prevent.
    
    Sponsored-By: Halland County Library
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebd1039bbdb041c7691eaaa2a977af9cd1687d3e
Author: Martin Persson <xarragon@gmail.com>
Date:   Tue Dec 8 20:55:01 2015 +0100

    Bug 15339: TestBuilder warnings (code)
    
    Makes TestBuilder::build() alert the user when unreognized
    parameters are passed, which happens when the user supplies
    the column values directly, forgetting the 'value' hash.
    
    This patch holds the code changes. Examples of the kind of
    errors that it catches are in the tests (separate patch).
    
    Sponsored-By: Halland County Library
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c6538f033f43cde33d186561a93a197467bd9a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 6 13:14:56 2017 -0300

    Bug 17834: Make translation easier
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1417f83e8b8a57e70e9120244a36204cf4acb3c2
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Apr 20 03:12:14 2017 +0000

    Bug 17834: Change library news text for single-branch libraries
    
    To test:
    1) Log into OPAC, go to home page
    2) Confirm that the text shows as 'RSS feed for (branchname) library
    news' if single-branch library
    3) Confirm text shows as normal for libraries with more than one branch
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: maricris <mlabancia@gmail.com>
    
    Signed-off-by: anafe <anafeazuela@yahoo.com>
    
    Signed-off-by: iflora <iflora@unimas.my>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7e8391fd3aa38cdd00ce943bd826399685253d7
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Aug 31 00:01:59 2017 +0000

    Bug 19215: Fixing typo in URL for patron clubs
    
    To test:
    1) Go to Tools -> Clubs
    2) Create a new club template if you do not already have one
    3) Edit the template
    4) Notice the URL is incorrect and the page is not found
    5) Apply patch and go back to Clubs
    6) Click edit button
    7) Link should work as expected
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2671eb2f93340e8fb3c794cff918d86c526cc47f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 4 12:06:56 2017 -0300

    Bug 18927: Use fully qualified subroutine names in C4::Items
    
    rebuild_zebra.pl fails in some conditions (perl version?)
    I do not recreate but it has been reported that reindex fails with:
      error retrieving biblio 94540 at /usr/share/koha/bin/migration_tools/rebuild_zebra.pl line 683, <DATA> line 751.
    
    To fix it we can use fully qualified subroutine names for:
      GetMarcFromKohaField
      GetMarcBiblio
      GetBiblionumberFromItemnumber
      TransformKohaToMarc
      GetFrameworkCode
    
    Test plan:
    Confirm the rebuild_zebra script still works correctly after this patch
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88e82a01218775b8d780769d9fdc8c0054e37180
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 6 12:52:46 2017 -0300

    Bug 11580: Add one more test and clear the cache
    
    Make sure we are not just returning J-1 and clear the cache before and
    after the tests.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b37ba1be0b8eaf6b778881d3e6e3c9d213757d06
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Wed Sep 6 15:36:15 2017 +0000

    Bug 11580 - Fix expiry calculation and rewrite tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecf6ca5d6e1472bab68f174ab50a20eec6b74888
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 31 13:58:27 2017 +0000

    Bug 18708 [Revised] Show itemBarcodeFallbackSearch results in a modal window
    
    This patch modifies the circulation template so that
    itemBarcodeFallbackSearch results show in a modal window.
    
    To test, enable the itemBarcodeFallbackSearch system preference and open
    a patron's account in circulation.
    
    - Submit a string which will return search results. When the page
      reloads a modal should display showing a table of title search
      results.
      - Test the "Check out" button and confirm that the correct item is
        submitted.
      - Test closing the modal and re-displaying it using the new "Show
        matching titles" button.
      - Confirm that the "Add record using fast cataloging" button still
        works correctly.
    - Submit a string which will return no results. No modal window should
      display, and only the "Add record" button should appear.
    - Confirm that normal checkout works correctly.
    - Test with itemBarcodeFallbackSearch disabled, and with a user who
      lacks Fast Cataloging permission.
    
    Revision removes a heading which was made redundant by the modal markup.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c758e222428ba6ad69b3d52ee6030d02e17ae964
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 19 20:14:51 2017 +0100

    Bug 17967: TT syntax for notices - Prove that ODUE is compatible
    
    Nothing new here, unless we are introducing a regression.
    The items.fine is a trick of our historical syntax.
    We need to provide a way to access this value from the a notice template
    using the TT syntax.
    A bug 17976 has been opened for discussion.
    
    Test plan:
    Define ODUE and OVERDUES_SLIP notice templates and use it to generate
    overdue notices from the cronjob script (misc/cronjobs/overdue_notices.pl)
    or the interface (members/print_overdues.pl).
    
    You should be able to generate the same notices with and without using
    the TT syntax
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be4f624b326574a14260c94c90aeb10a9ab56d91
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 17 04:32:58 2017 +0100

    Bug 17966: TT syntax for notices - Prove that ISSUESLIP is compatible
    
    Here we go, you will notice at the dependency list that this one is a
    bit different.
    In our former syntax we have 2 custom tags <checkedout> and <overdue>.
    These tags were allowed to permit loop on the checked out items and the
    overdue items.
    
    In this patch, we will use the "loops" parameter, introduced by bug
    17971, to pass the list of checkouts and overdues to the template.
    
    Note that Kyle suggested another approach on bug 15283: all the
    checkouts were send into the same array and each element of this
    array calls the is_from_today method, to know if the checkout is an
    overdue.
    I don't think we should rely on the Koha API, that's why I suggest to
    pass 2 differents object list, 1 which contains the checkouts and
    another one with the overdues.
    Note that we do rely on the Koha API, we call the Koha::Checkout->item
    and Koha::Item->biblio to propose an equivalent TT notice. But I think
    we can accept that.
    
    Test plan:
    Define the ISSUESLIP and ISSUEQSLIP notice templates to generate the
    same notices you generated with the historical syntax.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    https://bugs.koha-community.org/show_bug.cgi?id=17969
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba1f2f93ef58c8dd935add3e215facdd4a589d12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 2 12:46:11 2017 -0300

    Bug 19058: Move C4::Reserves::GetReserveId to the Koha namespace
    
    GetReserveId can easily be replaced with a call to
    Koha::Holds->search->next->reserve_id
    
    It will ease next changes to use Koha::Hold objects
    
    Test plan:
    Cancel a reserve and print a slip reserve
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fba915e911a3b50ff9a0ea96d25a464836471073
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 2 12:00:00 2017 -0300

    Bug 19057: Remove C4::Reserves::GetReserve
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6de2b66d19b8418dcb792c23e17b211e4c17719
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 2 12:21:20 2017 -0300

    Bug 19057: Move C4::Reserve::GetReserve to Koha::Holds
    
    This GetReserve subroutine can be replaced with Koha::Holds->find
    
    Test plan:
    -  git grep GetReserve
    must not return results where GetReserve is called
    - Cancel a reserve
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49778103ce528ccfc7fcc8be26bcae3b4ae7815b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 1 16:20:18 2017 -0300

    Bug 9857: Fix failing tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 185927f20981f36757c97fd33cc4c8ccd0ad5a3a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 11 15:39:53 2017 +0000

    Bug 19076 - followup - delete fines from additional renewal
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b66b86402cd84026f7dabaa2e567a1956b9bbe86
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 10 15:20:58 2017 +0000

    Bug 19076 - Move issue logging in AddIssue into condtional clause
    
    Currently AddIssue tests if renewal, but logs an issue even if so. This
    patch moves the logging into the conditional so a log entry is only
    added if we aren't renewing (as renewals are logged separately)
    
    To test:
    1 - prove t/db_dependent/Circulation.t - one test should fail
    2 - Enable both issue and renewal logs
    3 - Checkout an item to a patron
    4 - View the logs - the issue is captured
    5 - Checkout the item to the patron again and confirm renewal
    6 - Both an issue and a renewal are logged
    7 - Apply patch
    8 Repeat 1-6, tests should pass and only renewal should be logged
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8901f5702a7c6755c1f84cde01d75765687bb060
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 10 15:20:19 2017 +0000

    Bug 19076 - unit tests
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d928038a523b7ef44257ddfe97c405173c9b3b2e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 28 14:00:28 2017 -0300

    Bug 19081: Do not list plugins that have been uninstalled
    
    Under plack, can_load should not check if a package is in cache, but
    reload it. Otherwise plugins that have been uninstalled will still get
    listed.
    The error raised by can_load must only be displayed if the plugin has
    been removed.
    
    Test plan:
    1/ Upload a plugin
    2/ Note the plugin is listed as installed
    3/ Modify the package of the plugin to add a compilation error (use
    'Foo' for instance)
    4/ Reload the page
    5/ The plugin is not listed and a warning appear in the logs
    6/ Remove the compilation error and uninstall the plugin
    7/ The plugin is no longer listed and no warning appear in the logs
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 19081: Remove useless $plugin_file variable
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e744d49b557e3401ae7b700b1410b022a4e851c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 28 08:51:24 2017 +0200

    Bug 19004: [QA Follow-up] No need to check item-level_itypes again
    
    As Jonathan pointed out, GetItem already called effective_itemtype.
    So we can just use $item->{itype} here.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0fc3f19605d3979333dc333237205b9bef6ab60b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 9 16:30:03 2017 +0200

    Bug 19004: Adjust AddReturn for retrieving item type
    
    In the regular situation, you can get itemtype via biblio and then
    biblioitem as well as via biblioitem (at least when item-level_itypes
    is set to biblio).
    
    But since Koha unfortunately defined two relations in item, one for
    biblioitemnumber (the good one) and one for biblionumber (redundant),
    TestBuilder (correctly) builds one biblioitem and two biblios.
    
    If you item-level_itypes to biblio record, this will result in failing tests
    when calling AddReturn (in this case Koha/Patrons.t).
    It will crash on:
        Can't call method "itemtype" on an undefined value at C4/Circulation.pm line 1826.
    Cause: AddReturn goes via the biblionumber to biblio and than to
    biblioitems, and it does not find a biblioitem. (Not a fault from TestBuilder
    but a database design problem.)
    
    This patch makes a small change in AddReturn to retrieve the itemtype via
    biblioitem. It actually is a shorter road than items->biblio->biblioitems.
    
    Note: I do not test the Biblioitems->find call, since we already checked
    the GetItem call before and we have a foreign key constraint.
    I did not call $item->effective_itemtype since we still use GetItem; this
    could be done later.
    
    Adjusted Circulation/Returns.t too: If we add an item with TestBuilder and
    we called AddBiblio before, we should link biblioitemnumber as well.
    
    Test plan:
    [1] Do not apply this patch yet.
    [2] Set item-level_itypes to biblio record.
    [3] Run t/db_dependent/Koha/Patrons.t. (It should fail.)
    [4] Apply this patch.
    [5] Run t/db_dependent/Koha/Patrons.t again.
    [6] Run t/db_dependent/Circulation/Returns.t
    [7] Git grep on AddReturn and run a few other tests calling it.
        Note: Bugs 19070/19071 address three tests that call AddReturn too.
    [8] In the interface, check in a book.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Note: Bugs 19070 and 19071 are already pushed. The command in comment #4
          has all the tests successful.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57427f7a10c887964fa4d4397c6ec238af2bc694
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Sun Jul 30 16:53:00 2017 +0200

    Bug 19004: Patrons.t should create its own data for enrollment fees.
    
    If the patron categories J, K, YA would not exist, Patrons.t would fail.
    
    Test plan:
    [1] Remove one of these patron categories.
    [2] Run t/db_dependent/Koha/Patrons.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 327495b5e0ec4de47d20bd27d6a1c5b88e0be191
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 19 10:22:44 2017 +0200

    Bug 14316: Clarify meaning of record number in Batch record modification tool
    
    Same change as the first patch, but for the batch record
    modification tool.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4934ee4a1601bd268a7153b7189387bb073dd11f
Author: Katrin Fischer <Katrin.Fischer.83@web.de>
Date:   Mon Jun 8 02:03:34 2015 +0200

    Bug 14316: Clarify meaning of record number in Batch record deletion tool
    
    Changes the label from 'list of record numbers...' to
    'List of biblionumbers or authority ids...' to make it
    more clear to the user which kind of input is expected.
    
    To test:
    - Go to Tools > Batch record deletion
    - Check the new description
    - Decide if it's more clear or not
    
    Signed-off-by: Marc Veron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1b0dae9a6055e8ba5e9a9638af32060c1e17e33
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Sep 1 08:41:51 2017 -0400

    Bug 18946 [QA Followup] - code cleanup
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48f54016a7accfc0cc43bf01cbac70a8482bc3f9
Author: Karam Qubsi <karamqubsi@gmail.com>
Date:   Wed Jul 19 00:06:48 2017 +0800

    Bug 18946 - Change language from external web fails
    
    How to reproduce:
    1. Get a multilingüal Koha like
    http://demo1.orex.es/cgi-bin/koha/opac-changelanguage.pl?language=en
    http://demo1.orex.es/cgi-bin/koha/opac-changelanguage.pl?language=es-ES
    
    2. Copy that urls to any web page in an other domain -it must be in some
    host - and try to link to the spanish or english version,it will keep you in the same position.
    
    3. Apply this patch and try again , everything should work fine .
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb31d99065c468fbec2443cd15894b03657a24d5
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Wed May 31 17:03:54 2017 +0300

    Bug 18692 - intranet part
    
    Fixes misplaced columns introduced by previous patch and adds the "-" for phone
    transport type.
    
    To test:
    1. Set SMSSendDriver system preference on
    2. Go to intranet messaging preferences
    3. By default you should see checkboxes for all messages for SMS
    4. Ensure columns are not misplaced (pushing one column too much to the right)
    5. Delete sms method from one of the messages in message_transports table
    6. Observe that "-" is displayed instead of checkbox for that message for SMS
    7. Repeat same for TalkingTechItivaPhoneNotification system preference.
       By default it may not have transports in message_transports, so make sure
       to assign some in order to have the checkboxes visible.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fd0847c82adbcaf0af3285dd9cfc5e646ba6500
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jun 1 17:22:42 2017 +0200

    Bug 18692 - same with syspref TalkingTechItivaPhone
    
    Fixes misplaced columns introduced by previous patch and adds the "-" for phone
    transport type.
    
    To test:
    1. Set SMSSendDriver system preference on
    2. Go to intra and OPAC messaging preferences
    3. By default you should see checkboxes for all messages for SMS
    4. Ensure columns are not misplaced (pushing one column too much to the right)
    5. Delete sms method from one of the messages in message_transports table
    6. Observe that "-" is displayed instead of checkbox for that message for SMS
    7. Repeat same for TalkingTechItivaPhoneNotification system preference.
       By default it may not have transports in message_transports, so make sure
       to assign some in order to have the checkboxes visible.
    
    https://bugs.koha-community.org/show_bug.cgi?id=8692
    
    Signed-off-by: Michael Andrew Cabus <michael@bywatersolutons.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a932d05ace6500a3b67888aad1306e58cfa8014f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 29 16:32:18 2017 +0200

    Bug 18692 - When SMS is enabled the OPAC messaging table is misaligned
    
    Bug 6726 had corrected the fact that when SMS is enabled the messaging table is missing a column.
    Bug 6458 has broken this.
    The SMS column is missing an else case with cell containing only "-" like other columns.
    
    Test plan :
    - set SMSSendDriver preference empty
    - go to OPAC patron messaging
    - column SMS should not be visible
    - set SMSSendDriver preference not empty
    - go to OPAC patron messaging
    - column SMS appears with checkboxes
    
    Signed-off-by: Michael Andrew Cabus <michael@bywatersolutons.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65bce82b1fb32d3d98fe4d4ef1e1738a97749632
Author: Marc Véron <veron@veron.ch>
Date:   Wed Aug 9 09:46:02 2017 +0200

    Bug 18636: Sysprefs: Add explanation for conflict autonumbernum / BorrowerMandatoryFields
    
    This patch adds a note to the system preferences autonembernum and
    BorrowerMandatoryFields regarding a conflict if automembernum is on
    and BorrowerMandatoryFields contains cardnumber.
    
    To reproduce issue: See initial comment.
    
    To test:
    - Apply patch
    - Verify that in system preferences note appears with both prefs
      automembernum and BorrowerMandatoryFields
    
    Followed test plan, works as described
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c1504cfdb301cb0f9f3a14b5db31a63f5c3b0a5
Author: Marc Véron <veron@veron.ch>
Date:   Tue Jun 27 18:50:44 2017 +0200

    Bug 16485: collection column in Item search is always empty
    
    This patch fills the column 'Collection' in item search from the item values.
    
    To test:
    - Go to item search
    - Reproduce issue from initial comment
    - Apply patch
    - Verify that the column 'Collection' is filled
    
    Still to do, but outside of my datatable skills:
    Filter by drop down in the column header does a substring search.
    Example: Filter for 'Fiction" returns both 'Fiction' and 'Non-fiction' items.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Laurence Rault <laurence.rault@biblibre.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e9165001f69312255ad1b6706f040784460d5d1
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Wed Aug 2 17:12:44 2017 +0100

    Bug 19024 Do not unset order cancelled status on basket close
    
    On closing a basket, status is updated to ordered for orders not
    completed. However the operation  was resetting the status for
    cancelled as well as new orders.
    While display is correct from the basket view (it checks the
    cancellation date). The status in the acquisitions tab from the
    catalogue view reverts erroneously to ordered.
    
    This patch adds cancelled to the statuses not updated on basket
    close.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16c25a36988b47fb9fcbabd91fdace5f98f9caed
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue Aug 15 11:44:12 2017 +0100

    Bug 19024 Fix some infelicities of phrasing in test messages
    
    The test messages were awkwardly phrased, re phrase them to
    sound more natuaral. Patch is cosmetic (grammar) only
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7db6067dc4cc55bee771fedb31e2454b72123ac0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 9 16:09:32 2017 -0300

    Bug 19024: Add tests
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 786deba62beb5a52a543af5415610e14f7d0a8c5
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Aug 18 08:36:59 2017 +0000

    Bug 9857 - Follow-up - Fix for searches with su= or su:
    
    When the initial search is su=.../su:... the links was
    not constructed correctly. With this change, it should
    be the case.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0e3891e251a6a11188d70a5480af0e44b8c1fb0
Author: Katrin Fischer <Katrin.Fischer.83@web.de>
Date:   Fri Dec 4 01:17:50 2015 +0100

    Bug 9857: Did you mean? uses wrong punctuation in search links
    
    The link changes the search links generated by the plugins
    from an=authid to an:authid, as suggested by Jared on the
    bug report.
    
    - Turn on the AuthorityFile und ExplodedTerms  plugins
      for the OPAC from the "Did you mean" section of the
      administration module
    - Search a term in your OPAC where one or several
      authorities exist.
      A last name or a place name might work well.
    - Verify that there are suggestions displayed on top of
      your result list.
    - Verify that the link created is something like:
      /cgi-bin/koha/opac-search.pl?q=an=14084
    - Apply patch.
    - Verify the link has changed a little and still works
      correctly:
      /cgi-bin/koha/opac-search.pl?q=an:14084
    
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 515e62992893b72c54a34311088a9442a37d8138
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed Jul 12 10:09:48 2017 +1200

    Bug 18621: Added in value attribute to dateexpiry field
    
    Test plan:
    1. Create a patron category with the dateexpiry value of 29/9/2017
    
    2. Create a patron user from that patron category (which I'll refer to as patron A) with the date
    expiry value of 1/10/2017 and submit the form
    
    3. Notice that the manual dateexpiry you have submitted is correctly
    displayed
    
    4. Create a duplicate patron with the same firstname and surname and
    patron A, and set the date expiry value of 1/10/2017 and submit the form
    
    5. The form displays a duplicate patron message. Notice that the dateexpiry input box is empty now
    
    6. Select the new member (not a duplicate member) option in the
    messagebox
    
    7. The form successfully submits and notice that the date expiry value
    displayed is that of the patron category (i.e. it is 29/9/2017) not the
    dateexpiry value of 1/10/2017 that you manually set for this patron
    
    8. Apply patch
    
    9. Repeat step 4
    
    10. The form displays a duplicate patron message. Notice the dateexpiry input box still
    contains the value you entered which is 1/10/2017. Select the new member
    (not a duplicate member) option in the messagebox
    
    11. The form successfully submits and notice that the date expiry value
    displayed is 1/10/2017 that you manually set for this patron
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a887aeb2dff4e52f35f1f64bfc267867987cbb53
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Aug 18 00:14:52 2017 +0200

    Bug 19129 - Follow-up - Add changes to patron duplicate warning
    
    Adds logic from the previous fix to the brief patron summary
    shown when checking a possible patron duplicate.
    
    Bonus: Also fixes missing patron category description there.
    
    To Test:
    - Add 2 patrons
    - Add a patron with the same surname and firstname as an
      existing patron in order to trigger the duplicate message
    - Click "View existing patron"
    - Verify display is correct when existing patron is
      - an organisation
      - not an organisation
    - Verify that the patron category description shows
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82f183c5ea802e3231cb2442cf32474c92bd6ab4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Aug 17 14:51:08 2017 +0000

    Bug 19129 - Clean up Details tab for Organisation patrons
    
    Problem: A patron category "I" would cause display problems
    on the details in the intranet. This is because the templates
    confused patron category "I" with patron type "I" (organisation).
    
    Patch:
    - Cleans up variable confusion between categorycode and
      categorytype.
    - The template contained code to change the labels below
      the address to 'Organisational phone:" etc., I have removed
      this part as it does not match the edit form anymore.
    - Initials, date of birth and gender are still hidden for
      organisation - matching the edit form.
    
    Bonus:
    - The patron category description was missing on the
      right and left side of the details tab. Now it displays.
    - Fixes some html issues:
      - doubled up class attribute in a tag
      - doubled up </li></li>
    
    To test:
    - Create 3 patrons
      - patron category code doesn't matter, but category type organisation
      - patron category code 'I', category type NOT organisation
      - patron category code NOT I, category type NOT organisaton
    - Check details tab in patron account in staff for all 3
      - Verify patron category description shows correctly
      - Verify information added to the account displays correctly
        (phone numbers, emails, ...)
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee49d5698a11ee5806aff8c8581fa22002435cff
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Sep 1 09:56:09 2017 +0000

    Bug 11580 - [QA Followup] Remove debug statements
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 947834f1821449faf9148f06c84f5638b0941435
Author: Baptiste Wojtkowski <baptiste.wojtkowski@biblibre.com>
Date:   Thu Feb 23 16:21:05 2017 +0000

    Bug 11580 : Added unit test
    
    Added one unit test when the syspref useDaysMode is active.
    This does not move code anymore
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 391bf4f38dcaa89745115409d01cca9cd1e99dce
Author: Sophie Meynieux <sophie.meynieux@biblibre.com>
Date:   Wed Nov 16 16:46:04 2016 +0100

    Bug 11580 - If returnBeforeExpiry is ON, use calendar to calculate return date not on closed day (depending on useDaysMode)
    
    Test plan:
    1. ReturnBeforeExpiry is activated
    2. useDaysMode is different from "circulation rules only"
    3. Set expiry date of a patron to a near date
    4. Set a closed day on calendar for this date
    5. Do a checkout
    
    Without patch, return date will be patron expiration date
    With the patch, return date will be last open day before patron expiration day
    
    Signed-off-by: Claire Gravely <claire_gravely@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f24e339dd603e015557107048d1a678293cb2e65
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Jun 27 04:14:47 2017 +0000

    Bug 16726: [FOLLOW-UP] Putting text in h1
    
    Works as outlined in test plan, search terms now appear at top as h1 as well
    
    Signed-off-by: Dilan Johnpullé <dilan@calyx.net.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f10f6a19c53beb37e3ee0808ef6bb18bd88bef8a
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Jun 7 02:09:36 2017 +0000

    Bug 16726: Clear text in syspref searchbox after submitting
    
    To test:
    1) Go to Admin -> search for a system preference
    2) Notice your search stays in the search box (this is inconsistent with
        search behaviour across Koha)
    3) Apply patch and refresh page
    4) Make another search
    5) Confirm search still works as expected and search terms have been
    cleared from search box
    6) Confirm search terms show at the top of the results
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae7e0ee56a17ae2a0c6fdaa96c6b04229aabca74
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Dec 20 16:58:05 2016 +0100

    Bug 17797: Add XSLT_Handler in opac/unapi
    
    Replaces some code by a call to existing module.
    Removes the $@->code and $@->message calls.
    
    Test plan
    [1] Run /cgi-bin/koha/unapi?id=koha:biblionumber:[number]&format=marcxml
    [2] Try some variations.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d207f3832bc49232f30e8d7dbf2ac60e3ab9699
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Aug 30 12:06:36 2017 -0400

    Bug 19209 [Followup] - Ensure checkouts don't prevent deleting patrons
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c90bb78c9fe411c5ea549f8100939e29b7a4bc1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 30 12:30:05 2017 -0300

    Bug 19209: (QA followup) Improve tests
    
    This path merges the pager() test and adds search results count tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7abe6e9670ecb9b879e3b8c237fd9fad35f5ff18
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 30 12:09:37 2017 -0300

    Bug 19209: Add ->is_paged method to Koha::Objects
    
    This patch adds ->is_paged to Koha::Objects. It is inherited from the underlying resultset
    from DBIC so there's no code besides adding it to the known methods in AUTOLOAD.
    
    Tests are added for the newly exported method.
    
    To test:
    - Apply this patch
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/db_dependent/Koha/Objects.t
    => SUCCESS: Tests pass!
    - Sign off :-D
    
    Sponsored-by: Camden County
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff4f0858950c37eeede38b2f067841602b97d7ba
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jun 15 11:07:03 2017 -0400

    Bug 18812 - SIP Patron status does not respect OverduesBlockCirc
    
    To test:
    1 - Set 'OverduesBlockCirc' to block
    2 - Find or create a patron with overdues
    3 - Perform a SIP patron lookup on that patron
    misc/sip_cli_emulator.pl -a 127.0.0.1 -p 6001 -su term1 -sp term1 -l CPL
    --patron {userid or cardnumber} --password {pass} -m patron_information
    4 - Note the first character of response is a ' '
    5 - Apply patch
    6 - Restart memcached, apache, and plack
    7 - Perform SIP patron lookup
    8 - Note the first character of response is 'Y'
    9 - prove t/db_dependent/SIP/Patron.t
    10 - Test should return green
    
    Signed-off-by: Chris Kirby <chris.kirby@ilsleypubliclibrary.org>
    Works as advertised
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f27ef71e26720604b738c86c084b91858ef7c1a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 7 17:29:43 2017 -0300

    Bug 19056: Replace C4::Reserves::GetReserveCount with Koha::Patron->holds->count
    
    This subroutine is only used once and can easily be replaced with
    Koha::Patron->holds->count
    
    Test plan:
    - Set maxreserves=5
    - Place 3 holds for a given patron
    - Place again 3 holds for this patron
    3+3 > 5 => The holds must not be placed
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cc7268362219e39b22aebb03a83e013f467d93a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 7 17:25:15 2017 -0300

    Bug 19055: Remove C4::Reserves::GetReservesToBranch
    
    This subroutine is no longer in used and can be removed
    
    Test plan:
      git grep GetReservesToBranch
    must not return any results
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10311769d460a775aa8c8ee8a190836a8f2b1f1e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jul 31 09:18:15 2017 -0400

    Bug 19007 - Allow paypal payments via debit or credit card again
    
    A recent change in Paypal has removed the previous default option of paying via debit or credit card without an account. To bring this option back, we need to send an additional parameter to the PayPal API.
    
    Test Plan:
    1) Enable paypal for your Koha instance
    2) Ensure you are not logged in to PayPal
    3) Attempt to pay a fine via PayPal
    4) Not the the "Pay with Debit or Credit Card" option is missing
    5) Apply this patch
    6) Refresh opac-account.pl
    7) Attempt to make a payment via PayPal again
    8) Note the option "Pay with Debit or Credit Card" is now available
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: George Williams <gwilliams@nekls.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d08254b2202353517c16f34172cb92dcdd5befa
Author: Marc Véron <veron@veron.ch>
Date:   Sat Feb 18 18:35:39 2017 +0100

    Bug 14353 - Show 'damaged' and other status on the 'place holds' page in staff
    
    This patch adds status 'Damaged' to 'Information' 'Status' in the items
    table on 'Place hold' page.
    
    To test:
    - Apply patch
    - In staff client, try to place an item level hold for items with 'Damaged'
      status.
    - Verify that the status 'Damaged' appears in the column 'Information'.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85b963d11fb5d8674ca6b0ec60821663f9d8cf19
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 26 14:46:45 2016 +0000

    Bug 15924 - Coce not enabled on lists
    
    To test:
    Enable Coce and disable other image services
    Load a list and not there are no covers
    Apply patch
    Load a list and note there are covers
    
    https://bugs.koha-community.org/show_bug.cgi?id=15924
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 831d75d09c276f25f919cbdc16c8e4105fe8ddc9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Aug 30 10:35:03 2017 -0400

    Bug 19208 - Pay select option doesn't pay the selected fine
    
    The "Pay selected" option on the Fines tab in the borrower account page doesn't work as intended.
    The fine on top of the list gets the amount deducted, even if another fine is choosen from the list.
    
    Test Plan:
    1) Create two or three fines, using the Create manual invoice function.
    2) Choose one of the fines (not the one on the top) and click Pay selected
    3) Pay a partial amount
    4) Go back to the Pay fines tab an notice that the fine you selected has not changed. Instead, either the top fine or the total (see attachment) has ben affected.
    5) Apply this patch
    6) Repeat steps 1-3
    7) Note the correct fine is paid
    
    Signed-off-by: Andreas Hedström Mace <andreas.hedstrom.mace@sub.su.se>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccac8ba6d3799c52adc80298b96a8efaf05c4a9e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 1 12:58:18 2017 -0300

    Bug 18718: DBRev 17.05.00.005
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 239589b119c88a321fb8245f859855c41dda6566
Author: Marc Véron <veron@veron.ch>
Date:   Fri Jun 2 12:11:47 2017 +0200

    Bug 18718: Language selector in staff header menu similar to OPAC
    
    This patch adds a language selector menu to the top menu of staff client
    similar to the OPAC.
    Display of language selectors at top, bottom or both can be configured
    with system preference StaffLangSelectorModer. It defaults to bottom.
    
    To test:
    - Apply patch
    - Udate database
    - Restart plack and memchached
    - Go to staff client, verify that language selector displays at
      the bottom of the page (as before)
    - Go to system preferences, verify that there is a new preference
      StaffLanguageSelectorMode (name similar to the sypref ror OPAC), and
      that it is set to 'footer'
    - Change mode for top, both and footer and verify, go to staff client
      and verify for each that the language selector displays as appropriate
    
    (Amended for comment #2  2017-06-02 mv)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5ea914f4dc41f78dbb3a59f894f6ecbb9a1afa4
Author: Сергій Дубик {Serhij Dubyk} <serhijdubyk@gmail.com>
Date:   Tue Aug 22 17:19:32 2017 +0300

    Bug 17827 - Untranslatable "by" in MARC21slim2intranetResults.xsl
    
    Signed-off-by: Serhij Dubyk {Сергій Дубик} <serhijdubyk@gmail.com>
    
    The "by" after the title was not translatable in the result
    lists of the intranet. This patch fixes it by removing
    a comment, that caused a problem with the translation
    scripts.
    
    To test:
    Test:
    
    Before this patch in file en-GB-marc-MARC21.po present next paragraph:
    
    msgid "by "
    msgstr " by "
    
    According string "by " in the file MARC21slim2intranetResults.xsl can not be translated (in other languages).
    
    After applying this patch performed next command:
    cd /usr/share/koha/misc/translator
    sudo env KOHA_CONF=/etc/koha/sites/mykohainstance/koha-conf.xml PERL5LIB=/usr/share/koha/lib perl -I /usr/share/koha/lib "./translate" update
    
    Now in the file en-GB-marc-MARC21.po present the following (modified) paragraph:
    
    msgid "by "
    msgstr " by "
    
    https://bugs.koha-community.org/show_bug.cgi?id=17827
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51a65731c0fa15c37351ce6bc478fa6dc63fc64f
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Aug 29 04:51:40 2017 +0000

    Bug 19194: Check itemtype is defined when receiving an order
    
    To test:
    1) Find a record with an item that has no itemtype (or remove the
    itemtype of an item)
    2) Go to Acquisitions -> Find a vendor or make a new one -> create a new
    basket
    3) Add the record from Step 1 to your basket
    4) Close the basket
    5) Go back to the vendor and click 'Receive shipments'
    6) Put in an invoice number, click Next
    7) Click the Receive link for your item
    8) Confirm you see an internal server error
    9) Apply the patch and refresh the page
    10) The error should be gone and behaviour should continue as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d51059807690797aa4d16b0c0dd2932235a3b683
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Jun 28 00:40:00 2017 +0000

    Bug 18871: Make patron list name a link to view contents of list
    
    The link is the same as the 'Add patrons' button in Actions dropdown,
    but requires one less click, and makes finding the contents of the list
    more obvious.
    
    To test:
    1) Go to Tools -> Patron lists
    2) Create a patron list if you haven't already
    3) Confirm that clicking the name of the list takes you to the correct
    list and shows the expected content.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6babeeccabd71c0cd7990847d5c615012740ffdb
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Jun 27 01:59:55 2017 +0000

    Bug 18860: Adding thead tags to OPAC messaging settings table
    
    So that it can be styled alongside other tables in the OPAC.
    
    To test:
    1) Log into staff side
    2) Find OPACUserCSS syspref and add the following CSS:
    thead {
    color: red;
    }
    3) Log into the OPAC
    4) Go to your fines, your search history, your reading history etc -
    notice all of these table's headings are styled with red text
    5) Go to your messaging. Notice this table's headings are not styled
    with red text
    6) Apply patch and refresh page
    7) Your messaging table should now have red headings.
    (You can delete the CSS from OPACUserCSS if you'd like.)
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a8a6da3f460b19ba483f944dac962aed2571eca
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jul 10 03:39:21 2017 +0000

    Bug 18869: [FOLLOW-UP] Show enrollments as disabled link
    
    if club has no enrolled patrons
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af293fd8867729a9670d19231ca4377093a00438
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sun Jul 9 21:57:06 2017 +0000

    Bug 18869: [FOLLOW-UP] Make page reload after club or template delete
    
    If deleting the last club or template in a table, the row is deleted
    from the webpage by ajax so the nice blue bubble message does not show.
    This patch forces the page to reload so the blue bubble message shows
    instead of the empty table.
    
    To test:
    Confirm that the blue message shows when tables are empty. Add a
    template and a club, then delete a club. Confirm the page reloads and
    the message shows. Test with template
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79439a02626a6b14558091a958a27cafcefe73e0
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Jun 28 02:29:27 2017 +0000

    Bug 18869: Fixing display of patron clubs tables
    
    This patch
    1) Hides the club templates table if there are no club templates, shows
    an appropriate message
    2) Hides the clubs table if there are no clubs. Shows an appropriate
    message for whether templates exist
    3) Puts the actions in one column, or a dropdown menu
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23cc8b39682fea7b0a9150933c65c34ef22d23dd
Author: Marc Véron <veron@veron.ch>
Date:   Mon Jun 12 09:07:28 2017 +0200

    Bug 18781: Translatability: Get rid of exposed tt directives in openlibrary-readapi.inc
    
    The file koha-tmpl/opac-tmpl/bootstrap/en/includes/openlibrary-readapi.inc
    exposes template directives to translation. The only string that should
    appear in .po from this file is "Open Library: "
    
    To test:
    - Apply patch
    - Verify that code changes make sense
    - Bonus test: create a new language 'aa-AA', verify in aa-AA-opac-bootstrap.po
      that there is only the following string for openlibrary-readapi.inc:
    msgid "Open Library: "
    msgstr ""
    
    NOTE: Followed a test plan similar to bug 18776 comment 3
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 255cadeb772d63b06f77146c95b8d6e4b31d5836
Author: Marc Véron <veron@veron.ch>
Date:   Mon Jun 12 08:41:41 2017 +0200

    Bug 18780: Translatability: Get rid of exposed tt directive in masthead-langmenu.inc
    
    The file opac-tmpl/bootstrap/en/includes/masthead-langmenu.inc exposes following tt directive to translators:
    
    "[%% IF ( ( opaclanguagesdisplay ) && ( ! one_language_enabled ) && "
    "( languages_loop ) && ( OpacLangSelectorMode == 'both' || "
    "OpacLangSelectorMode == 'top') ) %%] "
    
    This patch fixes it.
    
    To test:
    - Apply patch
    - Verify that language selector in OPAC (top of the page) works as expected
    - Bonus test: create a new language 'aa-AA', verify that line above does not
    show up in aa-AA-opac-bootstrap.po
    
    NOTE: Followed a test plan similar to bug 18776 comment 3
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 331320f93a5ef5293c3bcad80b9554ddea0196b0
Author: Marc Véron <veron@veron.ch>
Date:   Mon Jun 12 08:20:56 2017 +0200

    Bug 18779: Translatability: Get rid of exposed tt directives in authorities-search-results.inc (OPAC)
    
    The file opac-tmpl/bootstrap/en/includes/authorities-search-results.inc
    exposes template directives to translation where translators should not
    be confronted with.
    
    Example:
    "[%% PROCESS showreference heading=seeals.heading linkType='seealso' "
    "type=seeals.type authid=seeals.authid %%] "
    
    To test:
    - Apply patch
    - Verify that Authority search in OPAC works as before
    - Bonus test: create a new language 'aa-AA', verify that line above
      does not show up in aa-AA-opac-bootstrap.po
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c8551645d5bdd3e6fb5b7e03280521a2fbaef636
Author: Marc Véron <veron@veron.ch>
Date:   Mon Jun 12 07:48:57 2017 +0200

    Bug 18778 - Translatability: Get rid of tt directive in translation for item-status.inc
    
    The file opac-tmpl/bootstrap/en/includes/item-status.inc exposes a template directive where translators should not be confronted with.
    
    "%s %s [%%#- This include takes two parameters: an item structure and an "
    "optional loan (issue) structure. The issue structure is used by course "
    "reserves pages, which do not use an API to fetch items that populates item."
    "datedue. -%%] %s %s %s %s "
    
    This patch fixes new lines inside a tt directive (comment).
    It is merely a string patch.
    
    To test:
    Verify that the code changes make sense.
    (Bonus test: create a new language 'aa-AA', verify that line above does not
    show up in aa-AA-opac-bootstrap.po)
    
    NOTE: Followed test plan similar to bug 18776 comment 3.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ed4bdc87e92506ba4a51f92cc198f3c5ce282eb
Author: Marc Véron <veron@veron.ch>
Date:   Sun Jun 11 20:16:46 2017 +0200

    Bug 18777: Translatability: Get rid of exposed tt directives in opac-memberentry.tt
    
    The file opac-memberentry.tt exposes template directives to translation where
    translators should not be confronted with.
    
    Example from po file:
    "%s [%% UNLESS hidden.defined('B_address') && hidden.defined('B_address2') && "
    "hidden.defined('B_city') && hidden.defined('B_state') && hidden."
    "defined('B_zipcode') && hidden.defined('B_country') && hidden."
    "defined('B_phone') && hidden.defined('B_email') && hidden."
    "defined('contactnote') %%] "
    
    To test:
    - Apply patch
    - Verify that advanced search in OPAC the page 'your personal details'
      behaves as before
    - Verify that you can change values and submit an update request
    - Create a new translation for a 'language' aa-AA (perl translate create aa-AA)
    - Verify that template directives ar no longer exposed in aa-AA-opac-bootstrap.p
    
    NOTE: Followed test plan similar to bug 18776 comment 3.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae684fc9491102ba0b560ca6f414a325e763b31a
Author: Marc Véron <veron@veron.ch>
Date:   Sun Jun 11 16:54:28 2017 +0200

    Bug 18776: Translatability: Get rid of exposed tt directives in opac-advsearch.tt
    
    The file opac-advsearch.tt exposes template directives to translation where translators should not be confronted with.
    Example in po file:
    "[%% IF ( ( OpacAdvSearchOptions and OpacAdvSearchOptions.grep('itemtype')."
    "size > 0 and not expanded_options ) or ( OpacAdvSearchMoreOptions and "
    "OpacAdvSearchMoreOptions.grep('itemtype').size > 0 and expanded_options ) ) "
    "%%] "
    
    To test:
    - Apply patch
    - Verify that advanced search in OPAC behaves as before
    - Create a new translation for a 'language' aa-AA (perl translate create aa-AA)
    - Verify that template directives ar no longer exposed in aa-AA-opac-bootstrap.po
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff591f2c77a2a3c1de4a0e7167ccfeba08c2f128
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 4 16:44:51 2017 +0200

    Bug 18754: [QA Follow-up] Tiny corrections
    
    Converted one INCLUDE directive to PROCESS; we are not changing variables here. (The PROCESS directive is slightly faster than INCLUDE because it avoids the need to localise (i.e. copy) the variable stash before processing the template.)
    
    Removed one vim inserted letter i.
    
    Error in [% IF ( XISBN.publicationyear ) _ ', ' _ XISBN.publicationyear %][% END %] The concatenation became part of the condition.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 752aef4593f1aa2d64700bf9738e7e03907eb1cd
Author: Marc Véron <veron@veron.ch>
Date:   Fri Jun 9 15:43:36 2017 +0200

    Bug 18754: Translatability: Get rid of exposed tt directives in opac-detail.tt
    
    The file opac-detail.tt exposes a lot of template directives to translation where translators should not be confronted with.
    
    Some examples from po file are:
    
    $[% SUBFIELD.code %] [% SUBFIELD.value %]
    
    %s [%% INCLUDE \"openlibrary-readapi.inc\" bib = { normalized_isbn => "
    "normalized_isbn, lccn => lccn, normalized_oclc => normalized_oclc } %%]
    
    See: [% IF ( nextTitle ) %][% nextTitle |html %][% ELSE %]next biblio[% END "
    "%]
    
    To test:
    - Apply patch
    - Do a search in OPAC that has more than 1 results
    - Go to the detail page of one of the items found
    - Verify that the details display as before and that you can
      browse the results with Previous and Next
    - In staff client, change OPACXSLTDetailsDisplay from 'default' to
      empty for "no xslt" and repeat steps above
    - In staff client, set HTML5MediaEnabled to 'OPAC' or 'OPAC and staff client'
    - Verify that media catalogued in field 856 still work
    - Create a new translation for a 'language' aa-AA (perl translate create aa-AA)
    - Verify that template directives ar no longer exposed in aa-AA-opac-bootstrap.po
    
    Followed test plan which works as intended
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e39bbc61aedd6383f4d6a1b4728711c6922e877
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 23 17:09:49 2017 +0200

    Bug 18660: Translatability: Get rid of template directives [%% in translation for patroncards-errors.inc
    
    Translation for koha-tmpl/intranet-tmpl/prog/en/includes/patroncards-errors.inc
    contains a lot of (partial) template directives like:
    %%]%s %sLayout: [%%
    
    This patch fixes it
    
    To test:
    - Verify that code changes make sense
    - Apply patch
    - Create a translation (cd misc/translator , then: perl translate create aa-AA
    - Verify that in po/aa-AA-staff-prog.po contains no fragments like %%] or [%%
      for patroncards-errors.inc
    - Try to get an error: Try a link like
      http://[YOUR SERVER]/cgi-bin/koha/patroncards/create-pdf.pl?batch_id=1&template_id=999&layout_id=999&start_card=1
      ...where template_id and layout_id do not exist
    
    (Amended for comment #2 2017-06-05 mv)
    (Amended for comment #6 2017-08-02 mv)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03c7f9366c97d6402e1e16182d7a2ddbbe37eccb
Author: Marc Véron <veron@veron.ch>
Date:   Sun May 28 09:34:21 2017 +0200

    Bug 18687: Translatability: abbr tag should not contain lang attribute
    
    In manage-marc-import.tt, we have an abbreviation:
    
    <abbr title="Differences between the original biblio and the imported" lang="en">Diff</abbr>
    
    In translations (e.g. German), the line appears as follows:
    <abbr title="Unterschiede zwischen Originaltitelsatz und importiertem Titelsatz" lang="en">Diff</abbr>
    
    The lang attribute is wrong here, it is still "en".
    The text language is the same as defined at the top of the page - or with other
    words, the lang tag is superfluous.
    
    This patch removes it.
    
    To test:
    Verify that code change makes sense.
    
    Passes QA test and the change is logical
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25fa02272d16c98d49a6020e867f60bc0510d960
Author: Marc Véron <veron@veron.ch>
Date:   Thu Jun 29 15:22:54 2017 +0200

    Bug 18654 - Translatability: Get rid of tt directives starting with [%% in translation for itemsearch.tt
    
    This patch removes entries like the following in translations of itemsearch.tt:
    "[%% INCLUDE form_field_select name=\"homebranch\" options = branches "
    "empty_option = \"All libraries\" %%] [%% INCLUDE form_field_select name="
    "\"holdingbranch\" options = branches empty_option = \"All libraries\" %%] %s "
    "[%% INCLUDE form_field_select name=\"location\" options = locations "
    "empty_option = \"All locations\" %%] %s "
    
    New patch on top of Bug 18633 that resolves parts of initial comment.
    
    To test:
    - Verify that in itemsearch.tt no tt directives are splitted by new lines
      (search for [% INCLUDE )
    - Verify that itemsearch.tt works as before
    
    Followed test plan and verified that tt directives are not split by new
    lines, the changes to the fieldset tags in comment 3 have been removed
    and itemtype.tt still works correctly as before
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ee82801c7a8686523f9c5e95b0f43d44e52e4ab
Author: Marc Véron <veron@veron.ch>
Date:   Mon May 22 21:09:06 2017 +0200

    Bug 18652: Get rid of tt directive in translation for uncertainprice.tt
    
    Translation tool shows toe following for ncertainprice.tt
    0; url=[% scriptname %]?booksellerid=[% booksellerid %]
    
    This patch fixes it.
    
    To test:
    - Apply patch
    - Verify that code change makes sense
    - Verify that Home > Acquisitions > [vendor] > Uncertain prices for [vendor]
      works as before
    
    - Additional test (for a langunage 'aa-AA')
      perl translate create aa-AA
      verify that line 41 no longer appears in aa-AA-staff-prog.po
    
    Amended to switch from BLOCK to a template variable, see comment #5
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79338bde3e01708fe331a54745f45c620c121805
Author: Marc Véron <veron@veron.ch>
Date:   Fri Aug 4 10:52:13 2017 +0200

    Bug 18649: Translatability: Get rid of tt directive in translation for admin/categories.tt and onboardingstep2.tt
    
    New patch without trailing IF construction in tt directives as
    requested in comment #28
    
    To test: Verify that translation tool no longer shows tt directives as
    described in comment #1
    
    New patch, needs SO.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59e95182cf1862095fb307cc08ba2a45d5630c11
Author: Marc Véron <veron@veron.ch>
Date:   Wed Jun 14 09:02:59 2017 +0200

    Bug 18629: (followup) Plain text "Continue..." instead of BLOCK
    
    Remove
    [% BLOCK txt_continue %]Continue to the next step[% END %]
    ...and restore original text
    
    See comment #19 and comment #20
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd81047f42164328654b9fb65d21de7ec8532b3b
Author: Marc Véron <veron@veron.ch>
Date:   Fri May 26 13:32:06 2017 +0200

    Bug 18629 - Translatability: Fix problems with web installer 17.05
    
    The new web installer for 17.05 has a great new design - but it has a lot of
    translatability issues. Some strings are not picked for translations,
    some expose the content of tt directives, and others are splitted by
    html tags, resulting in small text fragments that are not easy to translate.
    
    This patch weeds out such translation problems for step1.tt, step2.tt and
    step3.tt
    
    To test:
    - Apply patch (on top of Bug 18665 because of html tags inside of
      tt directives in step2.tt)
    - Prepare a fresh install (drop database, create database)
    - Walk through the installation process and verify that it works as before
    - Verify that string changes (in English) make sense
    - Create a translation( cd misc/translator, then perl translate create aa-AA)
      then: vim po/aa-AA-staff-prog.po and search for: /installer\/step
      Verify that strings for step1.tt, step2.tt, step3.tt are not fragmented,
      do not contain [%%, and are easily translatable (make sense without having
      to search in source files for context).
    
    (Amended to remove some superfluous chomps 2017-06-27 mv)
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 921e39a7ae123c112a7f09ec4bebf91e20235fec
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jun 6 13:31:29 2017 +0200

    Bug 17807: [Follow-up] Use marcxml for marc21 prefix
    
    Not sure what happened here, but this is an easy fix.
    
    Test plan:
    Try oai.pl with marcxml, marc21 and oai_dc again.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6719eee83a5232af18693ff8aef71d7464881d03
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Dec 21 15:03:18 2016 +0100

    Bug 17807: Use XSLT_Handler in Koha::OAI
    
    Replacing some code in the OAI modules by a call to an existing module.
    Note that the xmldoc format is used in the transform call to get a xml
    document object.
    
    The stylesheet method of Repository now only returns the name of the xsl
    file to be used instead of a cached xslt object. Similar functionality
    inside XSLT_Handler is used when calling transform.
    
    Note: We still lack unit tests in this area. I did not see the need for
    adding something for stylesheet since it only returns a simple string.
    The other change is made in Record::new; there are no tests for this
    module yet and the heart of the change here is actually tested already
    in XSLT_Handler.t.
    
    Note: I benchmarked calls to Repository in the old and the new situation
    and did not see significant changes.
    
    Test plan:
    [1] Run t/db_dependent/OAI/Server.t
    [2] Run oai.pl with ListRecords and marcxml.
    [3] Run oai.pl with ListRecords and oai_dc.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60bddbcc96bf92777a5954c2842d36ca55f12d46
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Dec 21 15:50:31 2016 +0100

    Bug 17807: Add format parameter to XSLT_Handler->transform
    
    Format may be chars (default), bytes or xmldoc.
    Note: xmldoc is a XML::LibXML document object.
    Since the default is chars, this does not affect current use.
    
    Note: The format parameter (xmldoc) will be used later in one of the OAI
    modules to prevent duplicated xml parsing.
    
    Test plan:
    Run t/db_dependent/XSLT_Handler.t
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30048f4aabeec27fdf0a4f195f82c822eddab501
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 7 12:05:54 2017 -0300

    Bug 17969: (QA followup) Add POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e63eee05a09cc0373491cce213e012ffc011b9f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 19 20:11:21 2017 +0100

    Bug 17969: Refactor the way <<items.content>> is generated
    
    <<items.content>> is generated 4x in advance_notices.pl and once in
    overdue_notices.pl
    It would be better to have it in C4::Letters.
    It will enforce the fact that it already has the same behavior, make it
    testable and reusable.
    
    Test plan:
    Use the <<items.content>> tag for advance and overdue notices.
    The generated notices must be the same as before this patch.
    
    Followed test plan, works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc09af634c92dc83f4eb28761bcff428481f6daf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 2 11:52:11 2017 -0300

    Bug 19025: Remove C4::Reserves::GetReserveInfo
    
    Test plan:
      git grep GetReserveInfo
    should not return results
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ecc6fd8c68af0ed410ee2ea77060999993220a7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 2 11:49:08 2017 -0300

    Bug 19025: Move GetReserveInfo to Koha::Holds
    
    This subroutine is only used once and can be replaced with a call to
    Koha::Holds->find
    It will avoid unnecessary joins.
    
    Test plan:
    - Define a HOLD_SLIP template notice using fields from the tables
    reserves, branches, borrowers, biblio, biblioitems and items.
    - Generate one and make sure the values are correctly filled
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1076a0edf32b621da54c53ea71595885f7e14c38
Author: Lee Jamison <ldjamison@marywood.edu>
Date:   Fri Aug 11 18:58:53 2017 +0000

    Bug 19088: plugins-upload causes error log noise
    
    After uploading a plugin the error log indicates
    use of uninitialized value in $op. This patch
    silences the noise.
    
    To test:
    1) Set <enable_plugins> to 1 (one) in koha-conf.xml.
    2) Set the UseKohaPlugins system preference to 'Enable'.
    3) Navigate to Administration -> Manage plugins.
    4) Install the test plugin KPZ file attached to this bug.
    5) Notice the uninitialized value noise in the error log.
    6) Uninstall the plugin (plack restart may be required if plack is
        enabled).
    7) Apply patch.
    8) Install the plugin again.
    9) Notice no noise in the error log.
    10) Run qa tools.
    11) Run prove t/db_dependent/Plugins.t
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 86e8612c020cea44be123be45f2e503af38ef98b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Aug 30 09:37:48 2017 -0400

    Bug 19205 - Pay selected fine generates 500 error
    
    Using the pay selected option from the borrowers account, to pay for one specific fine among other gives a 500 error, despite the payment going through.
    
    Test Plan:
    1) Add two fines using the Create manual invoice function.
    2) Select one fine and "pay selected".
    3) Pay a part of the amount.
    4) Note error
    5) Apply this patch
    6) Repeat steps 1-3
    7) No error!
    
    Signed-off-by: Andreas Hedström Mace <andreas.hedstrom.mace@sub.su.se>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce2561441c3c6e5bdc5ee7011d250c24a2d49105
Author: Сергій Дубик {Serhij Dubyk} <serhijdubyk@gmail.com>
Date:   Wed Aug 23 17:15:17 2017 +0300

    Bug 18537 - Update Ukrainian installer sample files for 17.05
    
    Update and translate sample SQL files of the Ukrainian installer.
    
    To test:
    - Start with an empty database
    - Install uk-UA
    - Run the web installer in uk-UA/Ukrainian
    - Verify all files load without any problems.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36ba8be88a9543942102580f2b1abe1e5e108c35
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 08:33:41 2017 +0530

    Bug 19035 - Stored XSS in lists.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/patron_lists/lists.pl
    2. Click on new patron list
    3. Add a text in the field Name that contains js
    4. Save the page.
    5. Notice js is execute
    6. Apply patch and reload, the js is escaped
    
    Fixed in both the pages list.pl and list.pl?patron_list_id=xx
    xx is patronlist id
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8534ca278022e82f55b1907bac31afa7e86b9d5f
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 20:58:34 2017 +0530

    Bug 19114 - Stored XSS in parcels.pl
    
    Test
    1. Hit the page /cgi-bin/koha/acqui/parcels.pl?booksellerid=xx
       xx is booksellerid
    2. Add a text in the field Vendor invoice that contains java script
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload the js is escaped
    
    Fixed XSS for parcels.pl/parcel.pl/orderreceive.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d31c635fe2cc6d0b715661d35a02723a48e42e2b
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 19:51:48 2017 +0530

    Bug 19112 - Stored XSS in basketheader.pl page
    
    To Test
    
    1. Hit the page /cgi-bin/koha/acqui/basketheader.pl?booksellerid=1&op=add_form
    2. Add a text in the field Basket name, Internal note, Vendor note that contains java script
    3. Save the page
    4. Notice js is execute
    5. Apply patch, reload, js is escaped.
    
    Fixed XSS on pages basket.pl/basketheader.pl/bookseller.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4b588aca834a94ed9fa6b5af2f8b1c1cbed2667
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 15:00:55 2017 +0530

    Bug 19110 - XSS Stored in branches.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/admin/branches.pl?op=add_form_category
    2. Add a text in the field Name and description that contains js.
    3. Save the page.
    4. Notice js is execute
    5. Apply patch and reload, the js is escaped
    
    Fixed for js escaped execute for both pages
    
    1. /cgi-bin/koha/admin/branches.pl?op=delete_confirm&branchcode=xx
       xx is branchcode
    2. /cgi-bin/koha/admin/branches.pl?op=add_form with Group(s):
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73a66ccaf47f8815bbe74326dbe24dba915456fb
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 23:22:32 2017 +0530

    Bug 19100 - XSS Flaws in memberentry.pl
    
    1. Hit /cgi-bin/koha/members/memberentry.pl?op=add&guarantorid=xx<script>alert('amit')</script>
       xx - is a guarantorid
    2. Notice the java script is executed.
    3. Apply patch.
    4. Reload page, and hit the page again /cgi-bin/koha/members/memberentry.pl?op=add&guarantorid=xx<script>alert('amit')</script>
       xx - is a guarantorid.
    5. Notice it is no longer executed.
    
    NOTE: I had to test in Microsoft Edge, because Chrome was blocking XSS for me.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b3449627fe53851b92428e57bb12d6c6492e2b9
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 09:23:13 2017 +0530

    Bug 19105 - XSS Stored in holidays.pl
    
    To Test
    1. Hit the page /cgi-bin/koha/tools/holidays.pl
    2. Select the date
    3. Add a text in the field Title and Description that contains js
    4. Save the page.
    5. Notice js is execute
    6. Apply patch and reload, the js is escaped
    
    Fixed for all holidays
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd44f2fed7415feb8605c94b7c533dcd48d27b15
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 22:58:02 2017 +0530

    Bug 16069 - XSS issue in basket.pl page
    
    1. Hit /cgi-bin/koha/acqui/basket.pl?basketno=xx<script>alert('amit')</script>
       xx - is a basketno
    2. Notice the java script is executed.
    3. Apply patch.
    4. Reload page, and hit the page again /cgi-bin/koha/acqui/basket.pl?basketno==xx<script>alert('amit')</script>
       xx - is a basketno.
    5. Notice it is no longer executed.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbdfbc64f0301df4c69b3112f0512ff07e6a61ed
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Fri Aug 11 21:08:14 2017 +0530

    Bug 19079 - XSS Flaws in Membership page
    
    1. Hit /cgi-bin/koha/members/moremember.pl?borrowernumber=xx<script>alert('amit')</script>.
       xx - is a borrowernumber
    2. Notice the java script is executed.
    4. Apply patch.
    5. Reload page, and hit the page again /cgi-bin/koha/members/moremember.pl?borrowernumber=xx<script>alert('amit')</script>.
       xx - is a borrowernumber.
    6. Notice it is no longer executed.
    
    Signed-off-by: Chris Cormack <chris@bigballofwax.co.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c3da351307be664a879148ce4ca9215ca1c2da7
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Fri Aug 4 09:44:52 2017 +0530

    Bug 19033: XSS Flaws in Currencies and exchange page
    
    1. Hit /cgi-bin/koha/admin/currency.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> search currencies box.
    3. Notice the iframe is executed
    4. Apply patch
    5. Reload page, and enter iframe again on search currencies box.
    6. Notice it is no longer executed
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Fixes the issue, follows common practice on the codebase.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b11d0c8627d31ad026c7494852cd25db0a5295c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 15 13:26:12 2017 -0300

    Bug 19034: (followup 2) Fix letters.tt XSS flaw
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e9a71a43851d8b2a67577a83c8d7d2e68efcf8e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 7 11:27:33 2017 -0300

    Bug 19034: (followup) Fix letters.tt XSS flaw
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46b0b0a75b01d700ec02c458896c27760e604465
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Fri Aug 4 10:41:49 2017 +0530

    Bug 19034: XSS Flaws in Z39.50/SRU servers administration
    
    1. Hit /cgi-bin/koha/admin/z3950servers.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> search Z39.50/SRU servers box.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on search Z39.50/SRU servers box.
    6. Notice it is no longer executed.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f7fc907ba9bf5cc2a077e541646118a213c8563
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Fri Aug 4 10:38:12 2017 +0530

    Bug 19034: XSS Flaws in Cities
    
    1. Hit /cgi-bin/koha/admin/cities.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> search cities box.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on search cities box.
    6. Notice it is no longer executed.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0dd5666341940b6310ac0c8c05e0f594b5386eb
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Fri Aug 4 10:34:19 2017 +0530

    Bug 19034: XSS Flaws in Patron categories pages
    
    1. Hit /cgi-bin/koha/admin/categories.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> search patron categories box.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on search patron categories box.
    6. Notice it is no longer executed.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c57d0b71c7b9bac44cd79c822e3009136bbf25fe
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Aug 7 20:49:56 2017 +0530

    Bug 19050 - XSS Flaws in Quick spine label creator
    
    1. Hit /cgi-bin/koha/labels/spinelabel-home.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> barcode text box.
    3. Notice the iframe is executed
    4. Apply patch
    5. Reload page, and enter iframe again on barcode text box.
    6. Notice it is no longer executed
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 861cec577317d4ef56cdad23afc94a7d1968c1c9
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Aug 7 21:43:56 2017 +0530

    Bug 19051 - XSS Flaws in - Batch item modification page
    
    1. Hit /cgi-bin/koha/tools/batchMod.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> in the Barcode list (one barcode per line) text area.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on Barcode list (one barcode per line) text area.
    6. Notice it is no longer executed.
    7. Fixes for both barcode and itemnumber.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f19d3d44c410be80bf8fd468b86ac7f7d9d4bcd
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Aug 7 21:24:44 2017 +0530

    Bug 19051 - XSS Flaws in Batch item deletion page
    
    1. Hit /cgi-bin/koha/tools/batchMod.pl?del=1
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> in the Barcode list (one barcode per line) text area.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on Barcode list (one barcode per line) text area.
    6. Notice it is no longer executed.
    7. Fixes for both barcode and itemnumber.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92d58c60b0fa20a4c1e67edaf6cd4be50dcdce21
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Aug 7 21:08:36 2017 +0530

    Bug 19051 - XSS Flaws in - Batch record deletion page
    
    1. Hit /cgi-bin/koha/tools/batch_delete_records.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> in the Record number list (one per line) text area.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on Record number list (one per line) text area.
    6. Notice it is no longer executed.
    7. Fixes for both biblio and authority records.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cf9eb0cfbedf7a5a852b86a6e4e6ce4fbc43c14
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Aug 7 22:17:14 2017 +0530

    Bug 19052 - XSS Flaws in - Invoice search page
    
    1. Hit /cgi-bin/koha/acqui/invoices.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> Invoiceno,
       ISBN/EAN/ISSN, Title, Author, Publihser, Publication year search box.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on Invoiceno,
       ISBN/EAN/ISSN, Title, Author, Publihser, Publication year search box.
    6. Notice it is no longer executed.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3199cff63924520a4cc4564f3590427dbed867f8
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Aug 7 22:04:30 2017 +0530

    Bug 19052 - XSS Flaws in vendor search page
    
    1. Hit /cgi-bin/koha/acqui/booksellers.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> vendor search box.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on vendor search box.
    6. Notice it is no longer executed.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a7040b7b0596a25a988568f0da0b47dd12c9f28
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Mon Aug 7 22:34:05 2017 +0530

    Bug 19054 - XSS Flaws in Report - Top Most-circulated items
    
    1. Hit /cgi-bin/koha/reports/cat_issues_top.pl
    2. Enter <IFRAME SRC="javascript:alert('XSS');"></IFRAME> in Callnumber, Day, Month, Year search box.
    3. Notice the iframe is executed.
    4. Apply patch.
    5. Reload page, and enter iframe again on Callnumber, Day, Month, Year search box.
    6. Notice it is no longer executed.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee3bfd5d69f8f649c74e58385b8180faade875d0
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Thu Aug 10 21:51:38 2017 +0530

    Bug 19078 - XSS Flaws in System preferences
    
    1. Hit /cgi-bin/koha/admin/preferences.pl
    2. Enter <script>alert('amit')</script> in search system preferences box.
    3. Notice the java script is executed.
    4. Apply patch.
    5. Reload page, and enter <script>alert('amit')</script> in search system preferences box.
    6. Notice it is no longer executed.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f94162564ad57ac9747d3967ba6671d982545dbc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 9 14:08:24 2017 -0300

    Bug 18726: Fix XSS at the OPAC - biblionumber
    
    The biblionumber parameter is sent by the user, we must escape all of
    them to avoid XSS.
    
    Fixes: Cross-site scripting OPAC pages
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea886885d0efa0200cfa166453a4495692afc4d4
Author: Amit Gupta <amit.gupta@informaticsglobal.com>
Date:   Tue Aug 15 22:21:37 2017 +0530

    Bug 19118 - Due to wrong variable name passed vendor name is not coming in browser title bar
    
    Test
    
    1. Hit the page /cgi-bin/koha/acqui/supplier.pl?booksellerid=xx
       xx is a booksellerid
    2. Apply the patch and reload the page.
    3. You can see vendor name in browser title bar.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44a8fc5b9363eb27223f32e1150fb8fff6f55d08
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 16 13:15:19 2017 +0200

    Bug 19126: Fix Members.t with IndependentBranches set
    
    If you enabled that pref, Members.t fails with:
    t/db_dependent/Members.t .. 63/63 # Looks like you failed 15 tests of 63.
    
    The first one is:
    t/db_dependent/Members.t .. 32/63
       Failed test 'Staff patron not deleted from list'
       at t/db_dependent/Members.t line 304.
    
    Bottle neck is GetBorrowersToExpunge. The results of that sub depend on the
    state of this preference.
    Trivially fixing it here by disabling the pref before the first call.
    
    Test plan:
    [1] Do not apply this patch yet. Enable IndependentBranches.
    [2] Run Members.t and observe that it fails.
    [3] Apply this patch. And run Members.t again. It should pass now.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5d6a1885ed4dcb650e7f9f23733b4ff9ad2b37b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 22 13:11:56 2017 -0300

    Bug 19130: (followup) Controller scripts should preserve behaviour
    
    This patch is a followup to making
    Koha::Acquisition::Booksellers->search work as any other Koha::Objects
    (DBIC) query instead of having a different behaviour hardcoded.
    
    To achieve it, this patch makes the controller scripts add
    wildcard/truncation chars as prefix and sufix for searches, and make the
    default sorting for results be by 'name', ascending.
    
    To test:
    - Just verify the behaviour remains unchanged by this patchset on the
    controller scripts (re. searching).
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf630b19745df8caea47669a9a76de26eddbfeee
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 22 12:13:19 2017 -0300

    Bug 19130: (followup) Add POD
    
    This patch adds POD to the following files:
    
    - Koha/Acquisition/Bookseller.pm
    - Koha/Acquisition/Booksellers.pm
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3481b7b9dac8935befe631131570591ec2c84cce
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 22 12:03:37 2017 -0300

    Bug 19130: (followup) Add t/db_dependent/Koha/Acquisition/Booksellers.t
    
    This followup patch adds a proper file in which add tests for
    Koha::Acquisition::Bookseller(s) methods.
    
    All current methods are covered.
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/db_dependent/Koha/Acquisition/Booksellers.t
     => SUCCESS: Test pass!
     - Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e4ce56b27025b05ee572100529eaa4f28e0933c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 22 12:01:24 2017 -0300

    Bug 19130: Remove ->search() overloading and adjust tests
    
    This patch removes the custom ->search() function. Tests are adjusted
    so the results from ->search() calls are not expected to return in the
    previously hardcoded order.
    
    To test:
    - Apply this patch
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/db_dependent/Bookseller.t
    => SUCCESS: Tests pass
    - Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 249e721ba4b5f60c1d6f4567efd71a4609e60a98
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 28 10:52:45 2017 +0000

    Bug 18447 - QA Followup - fix opac usage
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05a8a1c7b43c63d5a06ad5beb49b2f9b20254f68
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 19 17:31:03 2017 +0000

    Bug 18447 - Remove redundant line
    
    This line was added by bug 12342 but seems to have stopped working.
    
    These patches set default so this specific case should not be needed.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e852b9f69a06710e5b0c7e2a26011d8dacda808
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 19 17:27:24 2017 +0000

    Bug 18447 - Add changes to opac
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cbe9abcc88dcfbcf495a5d39d4b4de00858080e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 18 10:57:20 2017 -0400

    Bug 18447 - Datepicker only shows -10/+10 years
    
    This patch makes 2 changes:
    1 - Global datepicker defaulted to c-100:c+10
    2 - Dateofbirth datepicker defaulted to c-100:c
    
    To test:
    1 - Open some date pickers (patron entry, subscriptions, anywhere really)
      - Make sure to check some dateofbirth datepickers
    2 - Note that default is 10 years in either direction, updated when you
    select
    3 - Apply patch
    4 - Note we now get -100 years / +10 years from current selection
    5 - Now find a dateofbirth datepicker and note default is -100:+0
    6 - Sign off
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01e02364c905048908391615828f5878c2c5aac9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 23 11:42:34 2017 -0300

    Bug 19080: Fix perlcritic in routing-lists.pl
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2480474cdf8f27c4114ab404f4669f052e5a49c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 15 15:08:46 2017 -0300

    Bug 19080: Fix member vs borrowernumber in delmember
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9af6c4e34bc41616c03bb786201a9c10ebf13dab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 10 14:44:50 2017 -0300

    Bug 19080: Handle non-existing patrons gratefully
    
    This is a recurrent bug we have over the last years. When a script is
    called with non-existent borrowernumber it will crashes.
    We need to handle this gracefully instead of letting the script crashes.
    
    On bug 18403 a new subroutine is added to the codebase
    (output_and_exit_if_error) to handle this kind of errors correctly.
    Since it is not pushed yet, I propose to just redirect to a script that
    handle it correctly (circulation.pl) instead of adding this message to
    all these scripts.
    
    Test plan:
    Hit different scripts from the members module and pass a non-existent
    borrowernumber.
    You must be redirected to circulation.pl with a friendly message.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9917d9cad1d9eb7adf9cc40b55693e24dc3cf0e8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 11 15:02:29 2017 +0000

    Bug 18581 - Add standard edit and delete buttons to suggestions list
    
    This patch modifies the table of suggestions in the staff client, moving
    the edit link to the standard last column and styling it correctly. A
    delete button is added as well.
    
    Unrelated change: I removed the column containing suggestionid because I
    don't think it's human-relevant information.
    
    To test, apply the patch and go to Acquisitions -> Suggestions.
    
    - In each tab, the table of suggestions should have an unsorted last
      column containing "edit" and "delete" links which should be styled
      correctly and working correctly.
    - On the detailed view of a suggestion, the "delete" button in the
      toolbar should still work correctly.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51b7af9d9bee17c5fc6b6f2c2dfa27224b1da512
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 25 12:26:53 2017 +0200

    Bug 18354: [QA Follow-up] Add a prefix for the itemtype class
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d1a11b85faff823c25fc0e4a75d147777c1b789
Author: Michael Andrew Cabus <michael@bywatersolutons.com>
Date:   Tue May 23 15:43:10 2017 +0000

    Bug 18354 Adding item type attribute to cover image div
    
    This adds item type so we can do things with javascript.
    
    To Test:
    
    1.) Do a search on OPAC
    2.) Inspect element to confirm item type is not present
    3.) Apply patch
    4.) Do a search on OPAC to confirm item type is present as a class
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 729c2986b5b7100e55d7f9b81ea53cfe716c15c4
Author: Héctor Eduardo Castro Avalos <hector.hecaxmmx@gmail.com>
Date:   Tue Sep 27 13:39:14 2016 -0600

    Bug 17288: (follow-up) Remove unneccessary Date() function
    
    Remove line:
    var now = new Date(); from both subfields
    Also fix 18 positions (00-17) for default data in 006 field
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fd2e87af4e933779199a071332cb1eebe51c272
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 27 14:02:55 2016 +0000

    Bug 17288 (QA Followup)
    
        Don't default char 5 (is undefined in some forms)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3f5fb8d133e743d0776a5810f3e0b80e2f9e097
Author: Héctor Eduardo Castro Avalos <hector.hecaxmmx@gmail.com>
Date:   Tue Sep 13 15:25:47 2016 -0600

    Bug 17288: (follow-up) Fix marc21_field_007.xml
    
    Bad formatted data in 007 field. Fixed
    To test follow the previous commit.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd58a0debf60156883325c291ab901e668f3f3c7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 9 22:30:26 2016 +0000

    Bug 17288 - Advanced Editor - Rancor - Helpers for 006 and 007 fields
    
    To test:
    Open advanced cataloging editor
    Experiment with 006 and 007 fields and ensure helpers function for all
    material types
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f54a0f902ad419562929dd5a4514a478ee615f97
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 25 10:57:46 2017 -0300

    Bug 16892: DBRev 17.05.00.004
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ed19fedcad419c6a639b7daa03bb3533f5798e0
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jul 28 11:45:20 2017 -0400

    Bug 16892: Address error checking in comment #47
    
    Tweaked logic to include error check for category
    and branch being valid. If not, the user is told
    about a configuration error to share with the
    library. Otherwise, it should proceed as normal.
    
    TEST PLAN is comment #35 still.
    Though include a run with an invalid category
    and/or branch code in the two system preferences:
    GoogleOpenIDConnectDefaultBranch and/or
    GoogleOpenIDConnectDefaultCategory
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88f616277a8b11edadb66d01bf4b33a6c99641b7
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Apr 3 13:05:41 2017 -0400

    Bug 16892: Follow up use AddMember as per QA comment
    
    Same Test plan as before.
    
    Signed-off-by: Eugene Jose Espinoza <eugenegf@yahoo.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6e6817a284764ced35dc84a1ee3af461e2a9b0d
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Jul 19 10:48:35 2016 -0400

    Bug 16892: Follow up with adding missing IGNORE
    
    Signed-off-by: Eugene Jose Espinoza <eugenegf@yahoo.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88672849c732e03b1b462515fabc9b7d43ce88d4
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Jul 19 08:55:42 2016 -0400

    Bug 16892: System Preferences
    
    This adds the missing system preferences for a fresh install.
    
    Signed-off-by: Eugene Jose Espinoza <eugenegf@yahoo.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae45243fae9e1ca584d72abaf050b1fc94742722
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Jul 11 00:42:40 2016 -0400

    Bug 16892: Add automatic patron registration via OAuth2 login
    
    10988 added the ability to log into the OPAC authenticating with
    Google Open ID Connect. This extends it, by allowing an
    unregistered patron to have an account automatically created
    with default category code and branch.
    
    This is accomplished by adding 3 system preferences.
    - GoogleOpenIDConnectAutoRegister
          whether it will attempt to auto-register the patron.
    - GoogleOpenIDConnectDefaultCategory
          This category code will be used to create Google OpenID Connect patrons.
    - GoogleOpenIDConnectDefaultBranch'
          This branch code will be used to create Google OpenID Connect patrons.
    
    Sponsored-by: Tulong Aklatan
    
    Signed-off-by: Eugene Jose Espinoza <eugenegf@yahoo.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4237785d9a2bf2bbf4cf988bc98ac4935842e91
Author: Magnus Enger <magnus@libriotech.no>
Date:   Thu Aug 17 22:48:07 2017 +0200

    Bug 19134: C4::SMS falils on long driver name
    
    Code in C4::SMS takes the part of the SMS::Send-driver that comes after
    SMS::Send and tries to turn it into part of a path to a YAML file
    that can contain additional parameters to SMS::Send. The current
    code works for e.g. SMS::Send::A::B, but if there is one or more
    extra names, it fails to turn :: into /. So we have:
    SMS::Send::A::B    -> SMS/Send/A/B
    SMS::Send::A::B::C -> SMS/Send/A/B::C
    This patch makes sure all occurrences of :: are turned into /, by
    adding a "g" modifier at the end of the regex.
    
    Testing:
    Testing this preperly would take a whole lot of setup for a very
    small change. I would suggest that the following two oneliners
    are enough to demonstrate that the change makes sense:
    $ perl -e '$x = "a::b::c"; $x =~ s|::|/|; print $x, "\n";'
    $ perl -e '$x = "a::b::c"; $x =~ s|::|/|g; print $x, "\n";'
    
    So:
    - Check that the output of these oneliners make sense
    - Check that the patch changes the code in a similar way to the
      change from the first oneliner to the second.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a89d60e88bb6d6ead99921c447dce36a9e651078
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 25 10:34:48 2017 -0300

    Bug 19040: Update 2 occurrences of GetMarcBiblio in 22_to_30
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e018f8319a87dac480fc8dd74e49916a9d122871
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 25 09:43:02 2017 +0200

    Bug 19040: [QA Follow-up] Adjust embed_items parameter in showdiffmarc
    
    Trivial adjustment
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5986c9b972e6634fbc3f52e544316ed607eb502
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Aug 4 13:42:56 2017 -0400

    Bug 19040: Refactor GetMarcBiblio parameters
    
    Change parameters to a hashref.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Looks good to me.
    Two calls in migration_tools/22_to_30 still in old style.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b08913370f77fcc1c574d9c0264f0523b6e2a53b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 14 16:19:15 2017 -0300

    Bug 18817: Update links manually
    
    Without the anchor it is not possible to retrieve the html page, so
    these occurrences have been updated manually (and yes it was painful)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 674c32a094f0545f54d1d0240a642cc1d5587bc6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 14 15:38:05 2017 -0300

    Bug 18817: Update links with anchor automatically
    
    I generate a mapping files (old anchor > new anchor) from the doc files.
    Here are the links that have been updated automatically
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0250fb7b7681aa72ed3d5607c0c896cd5fd6659e
Author: Joy Nelson <joy@bywatersolutions.com>
Date:   Mon Jun 19 07:45:16 2017 -0700

    Bug 18817 Correct Manual URL
    
    Corrected the manual url in the help screen for 17.05 onward.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13ca4962068b184f803b6588e53e39209a77f2b6
Author: Chris Cormack <chrisc@catalyst.net.nz>
Date:   Wed Aug 2 10:15:10 2017 +1200

    Bug 18046: CAS logout infinite redirect
    
    To test (You need a CAS server and CAS configured in Koha)
    
    1/ Login using CAS in Koha
    2/ Logout in Koha
    3/ Notice you get redirected again and again
    4/ Apply patch
    5/ Login with CAS, then logout
    6/ Notice logout works, but no longer infinitely redirected
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Patch has been in production use for several months
    on several instances. Fixes a critical bug.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Looks like a typical workaround, but evidently works.
    Not tested with CAS.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af791d83e435587494fa04a45375f48a3e2ad236
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Aug 22 16:41:46 2017 +0200

    Bug 19163: Critical typo in stage-marc-import process
    
    Template says ISO2709 but script wants MARC or MARCXML..
    Slipped in with bug 19049.
    Trivial but critical fix.
    
    Test plan:
    Import a MARC file.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    I picked this fix because I think MARC is always ambiguous. ISO2709
    clearly denotes the serialization format used.
    
    Signed-off-by: Liz Rea <liz@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f595e4c95c22ba444f49c61c9d101483309871f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 22 13:41:16 2017 -0300

    Bug 17829: (follow-up) Fix import patron
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1262962a7d22b9c9b712025c5220033356c857e0
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Aug 18 04:45:41 2017 +0000

    Bug 18996 [QA Followup] - Fix some minor whitespace issues
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37d07b28ce4089f691631bde3f6e9a2fe7b81b10
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 2 13:01:47 2017 +0200

    Bug 18996: [QA Follow-up] Remove global variables from Message.t
    
    As per request of Colin in comment18, this patch makes the use of global
    variables in Message.t no longer needed.
    The three subtests are now completely independent and could well be moved
    to separate test scripts.
    
    Note: Strictly speaking, the use of global (package) variables could
    potentially introduce new bugs (e.g. if the value is modified outside the
    script). This seems not to be the case here, but we are safe now.
    
    Test plan:
    Run the test again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2490401be149d825108fc9c9f8bf556e64e2323d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Sat Jul 29 13:38:31 2017 +0200

    Bug 18996: Add checkin subtest in SIP/Message.t
    
    Variable $branch was not used.
    Promoted some global vars to our.
    Shared the branchcode between all three subtests now.
    The third subtest contains all six cases mentioned in the first patch.
    
    Test plan:
    Run t/db_dependent/SIP/Message.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66a7565995c00495fe670c809d9c7cf0c900fc7f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Aug 1 14:10:56 2017 +0200

    Bug 18996: Resolve an uninitialized warning from ILS/Item.pm
    
    From the syslog call on line 107/108. The field $item->{title} has not
    been initialized. When catching the warns in a test script with Test::Warn,
    I got:
        Use of uninitialized value $args[1] in sprintf at /usr/lib/x86_64-linux-gnu/perl/5.20/Sys/Syslog.pm line 423.
    
    This simply resolves the warning. We might have a closer look to this title
    field on another report though.
    
    Test plan:
    Run Message.t from the next patch without this fix. It will fail since the
    additional warning makes warnings_like return false.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97ec4ae98c8792835717bf1de19f8782b7cb1994
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 28 10:29:51 2017 +0200

    Bug 18996: Handle data corruption from old_issues at SIP checkin
    
    As per bug 18966 AddReturn returns false with a DataCorrupted message
    when the issue_id at hand already occurs in the old_issues table.
    This should be handled when returning an item via SIP too. SIP should
    not pretend that the checkin was successful, since this item needs
    special care.
    
    The following six different situations are handled:
    
    [1] An attempt to checkin an invalid barcode is handled as before. The
    ok flag is false; the screen message shows 'Invalid Item'.
    [2] We receive a DataCorrupted message: the alert type is set to the
    unused 98 code to indicate this new error condition. The ok flag
    is false; the screen message shows 'Checkin failed: data problem'.
    [3] The item checked in was not checked out AND the option checked_in_ok
    is active. The ok flag is set to true; no screen message.
    [4] The item checked in was not checked out AND the option checked_in_ok
    is not active. The ok flag is not changed (normally false); the screen
    message shows 'Item not checked out'.
    [5] (The regular checkin) The item was checked out and AddReturn returned
    true. The ok flag is true; no screen message.
    [6] ("Otherwise") The item was checked out, but AddReturn returned false.
    The ok flag is false; the screen message shows 'Checkin failed'.
    Note: Currently this case only refers to the Wrongbranch and withdrawn
    messages from AddReturn (where doreturn==0).
    
    Note: Situation 1 and 5 are unchanged. Behavior is slightly changed for
    situation 3 and 4; the option is only used when the item was not checked
    out. Situation 2 and situation 6 are changed. After bug 18966 SIP
    returned OK in case of data corruption (while checkin failed). In the
    remaining cases under [6] SIP also returned OK while checkin failed.
    
    Test plan:
    [1] Test all six cases listed above. In order to simulate data corruption
    insert the issue_id at hand in old_issues before you check in.
    In cases 3 and 4 you need to toggle the option in your SIPconfig.xml and
    restart the SIP server.
    Case 6 can be tested by checking out at branch A, adjusting the value
    of pref AllowReturnToBranch and checking in at branch B.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b5457cd0f17173ae9ebca2e71696cc09709a910
Author: Baptiste Wojtkowski <baptiste.wojtkowski@biblibre.com>
Date:   Mon Jul 10 08:11:33 2017 +0000

    Bug 18919: Repair "Transaction branch" in cash_register_stats.pl
    
    - values of the option fields are now correctly loaded
    
    TEST PLAN:
    go to domain/cgi-bin/koha/reports/cash_register_stats.pl
    1 - Make a report for all branches => it works
    2 - Make a report for any branch => you will get the same or no result
    3 - apply patch
    4 - Repeat 2 => it should work
    
    Followed test plan worked as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d934e72f5d7ee919b7a1e2e013a317371c20d37f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 25 12:40:43 2017 +0000

    Bug 12644 - Add subtitles to staff client cart
    
    This patch adds display of subtitles to the staff client cart.
    
    To test you should have some values mapped to subtitle in Administration
    -> Keyword to MARC Mapping.
    
    1. Apply the patch.
    2. Add some records to the staff client cart which have subtitles.
    3. Open the cart and onfirm that subtitles display correctly in both the
       brief and "More details" view.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a43a8cb1be575fce59f7327c2f906fff36bce48d
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Jun 28 23:31:12 2017 +0000

    Bug 18877: Add documentation on dbhost for koha-create help
    
    TEST PLAN
    ---------
    apply bugs 9409 and 14533 (order is irrelevant)
    trigger message about missing database name
    -- notice it fails to mention dbhost
    apply this patch
    trigger message again
    -- notice it mentions dbhost
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34587fafecf8e274586715dce2c04b0f557ce313
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Jun 22 19:26:33 2017 +0000

    Bug 14533: Make --use-db display a message if no DB defined
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73aa4e65c0a45c230479de93cdee3dc55f93c3f9
Author: Yarik Dot <yarikdot@gmail.com>
Date:   Thu Jun 22 17:53:00 2017 +0000

    Bug 14533: remove CREATE USER when koha-create --use-db
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7efb871fa31869044045ccef0b37be438ba704ff
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 11 15:09:00 2017 -0300

    Bug 9409: (QA followup) Add --dbhost help to koha-create man page
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4573d709936bbd7f454a26f073e2131aa9c8df3
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jun 23 01:46:50 2017 +0000

    Bug 9409: Add --dbhost parameter and dbhost field
    
    This allows setting the remote db host correctly for
    request-db either with a command-line or passwd file.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a66c0b1dd76a2fe08ed7ac189ad8a564372ab3a9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 7 11:25:24 2017 +0000

    Bug 18469: QA Follow-up
    
    Restore datepicker class
    Use Koha.Preference
    Copy changes to moremember
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a58745d9dbbf98c79f4c1a3e7cd40fb45425fc91
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 21 10:08:27 2017 -0400

    Bug 18469: Suspend all holds when specifying a date to resume hold does not keep date
    
    Name of field had 'datepicker' embedded, this caused variable issue
    
    To test:
     1 - Place several holds for a patron
     2 - Go to holds tab in circulation
     3 - Select a date for suspend all holds until
     4 - Suspend all holds
     5 - Note date is not used, suspended indefinitely
     6 - Apply patch
     7 - Resume all suspended holds
     8 - Select a date for suspend all holds until
     9 - Suspend all holds
    10 - Note date is used
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0936f642d558d2866d675d0120f047ad02ecbb1f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 11 08:11:20 2017 +0200

    Bug 19061: [QA Follow-up] Wrong interpolation
    
    Interpolating "$object->method" does not work.
    Unable to execute query [Object class]=HASH(0x3c21cc8)->method.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c2ee5903cfe19379d20a847558fb0c176580cc0
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue Aug 8 11:47:40 2017 +0100

    Bug 19061: Avoid SQL Injection vulnerability
    
    Embedding values in the SQL statement allows the passing of values
    that would normally be rejected resulting in mysql errors
    variables should always be passed via placeholders and
    the execute call
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e03f590fa1080b1c3fbe25c91af08094620609d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 9 13:01:37 2017 -0300

    Bug 18292: Tests do not need to return 1 - xt
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1ba7fac2c246c2dd52aa4d35884a03d542a26f4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 9 08:59:41 2017 -0300

    Bug 18292: Remove return 1 statements in tests
    
    The test files do not need to return 1
    
    Patch generated with:
    perl -p -i -e "s/^1;\n//xsm" t/**/*.t
    
    Test plan:
      git grep '^1;$' t/**/*.t
    should not return any results
    
    NOTE: does not fix C4/SIP/t, nor xt tests.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b57d682edd5040eb342047aefa95b84402f4c3ae
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Fri Mar 17 09:05:47 2017 +0200

    Bug 18292 - t/db_dependent/Circulation.t doesn't need to return 1;
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a423fcff42da05e9ebf9f2b4a2f192023346e93e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 11 08:34:45 2017 +0200

    Bug 19049: [QA Follow-up] Mock config, default format
    
    As requested by QA:
    [1] Mock_config enable_plugins in the test.
    [2] Fallback to MARC when format is empty. Remove die statement.
    Added:
    [3] Remove $marc. This variable got obsolete during development.
    [4] Add test on $input_file and $plugin_class. Test $text before calling
        Handler or processing $text. No need to split undef if somehow Handler
        returned undef, etc. If the routine returns an empty arrayref,
        stage-marc-import will do fine.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8f6315b6d9b1c7145f6036b55b7927f6d6e6e48
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 10 09:02:37 2017 -0400

    Bug 19049 [QA Followup] - Make plugin name first item in description
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0987b135ea0bb8fbd4fc39643b19715dc6e3a1c8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 10 13:02:23 2017 +0200

    Bug 19049: [Follow-up] Make sure that GetPlugins finds the plugin
    
    We have to mock_config the pluginsdir before Plugins is loaded, and
    we should pass an absolute path (not a relative one).
    If you did not install the test to_marc plugin, this test would fail.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Verified patch is compatible with original KitchenSink to_marc plugin
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83f60adbab8e96f0f14ec547029582623ac3a068
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Aug 8 14:51:41 2017 +0200

    Bug 19049: Testing RecordsFromMarcPlugin with a to_marc plugin
    
    This patch adds a simple to_marc plugin in t/Koha/Plugin that is used
    in the added subtest in ImportBatch.t.
    
    Test plan:
    [1] Run t/db_dependent/ImportBatch.t
    [2] Copy the to_marc test plugin from t to your plugin directory.
        Under Debian packages, you should do something like:
        mkdir -p /var/lib/koha/master/plugins/Koha/Plugin/
        cp [yourclone]/t/Koha/Plugin/MarcFieldValues.pm /var/lib/koha/master/plugins/Koha/Plugin/
    [3] Check if you see this plugin on plugins/plugins-home.pl
    [4] Create a text file with some fields like:
        (Note: The plugin needs an empty line between both "records".)
        100,a = Test Author 1
        245,a = Title One
    
        100,a = Author 2
        245,a = Title Two
    [5] Go to stage-marc-import.pl. Upload the created file. Select the plugin
        in the format combo and proceed. Did you create two records ?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d24568b67256fab79b42ead54302c76d1c9653d7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 7 21:24:48 2017 +0200

    Bug 19049: Fix regression on stage-marc-import with to_marc plugin
    
    Bug 12412 added the use of to_marc plugins allowing arbitrary file formats
    in stage-marc-import (as long as the plugins can handle them). The feature
    was not very visible in the code, and when bug 10407 added the marcxml
    format, it made some changes that broke the use of to_marc.
    
    This patch restores the functionality by:
    [1] Adding a sub RecordsFromMarcPlugin to ImportBatch.pm, specifically
        addressing the conversion from arbitrary formats to MARC::Record.
        The original to_marc interface is used: pass it the file contents,
        and it returns a string consisting of a number of MARC blobs separated
        by \x1D.
        Consequently, the call of to_marc is removed from routine
        BatchStageMarcRecords where it did not belong. The to_marc_plugin
        parameter is removed and two calls are adjusted accordingly.
    [2] Instead of a separate combo with plugins, the format combo contains
        MARC, MARCXML and optionally some plugin formats.
    [3] The code in stage-marc-import.pl now clearly shows the three main
        format types: MARC, MARCXML or plugin based.
    
    Note: This patch restores more or less the situation after bug 12412, but
    I would actually recommend to have the to_marc plugins return MARC::Record
    objects instead of large text strings. In the second example I added a
    to_marc plugin that actually converts MARC record objects to string format,
    while RecordsFromMarcPlugin reconverts them to MARC::Records.
    
    Test plan:
    See second patch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c6168d37436b7312e130f796d47271ff2de77cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 14 10:26:48 2017 -0300

    Bug 18331: POST_CHOMP everywhere!
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14484ba4234fd1cbb925b5f3a4844da863c65d5a
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Aug 8 08:23:57 2017 +0000

    Bug 18331: Followup - fix path to orders_by_budget csv header
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ee4e0ac381ed23fa23b1117725b2f6a0e0db4de
Author: Lee Jamison <ldjamison@marywood.edu>
Date:   Fri Aug 4 19:27:22 2017 +0000

    Bug 18331: Followup - Fix CSV export (once and for all!)
    
    Follow-up on Comment 21 to correct the empty_line.inc
    include in basket.tt
    
    https://bugs.koha-community.org/show_bug.cgi?id=18331
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a10e5383016a5cb4117719ac858cbe02a53e457b
Author: Marc Véron <veron@veron.ch>
Date:   Thu Aug 3 17:50:30 2017 +0200

    Bug 18331: Force tt to insert newline to empty_line.inc
    
    See end of comment #4 and IRC:
    http://irc.koha-community.org/koha/2017-08-03#i_1958062
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8403799c7212349bee70090249e3425afd62423b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 12 17:04:47 2017 -0300

    Bug 18331: Fix CSV export (once and for all!)
    
    I am going to try and explain the problem here in order to make it a
    have-to-read for next changes.
    
    There are several things to test when and most of the time we break
    something when we try to fix something else.
    
    You have to test different CSV export, not only one. There are not all
    processed the same way. For instance acqui/csv/basket.tt does not
    contain any strings to translate and the translate script will copy the
    original file as it.
    But reports/csv/orders_by_budget.tt will not! Indeed it contains "TOTAL"
    which will be translated. The generated tt file for the translated
    language will remove all the carriage returns! That's why we cannot rely
    on TT for newlines (contrary to bug 16914 assumption).
    
    There are two possible methods:
    1/ Fix the translate script
    => Hum... nope
    2/ Remove all carriage returns and make them explicit by including an
    file that only contains 1 carriage return
    
    This second method is implemented in this patch.
    
    How it works: Use the PRE_CHOMP "[%-" and POST_CHOMP "-%]"
    (http://www.template-toolkit.org/docs/manual/Config.html#section_PRE_CHOMP_POST_CHOMP)
    to remove all the newlines that could be added by TT in the original
    (en) files. Then include the new_line.inc to add a new line.
    That way original and translated files will behave the same way.
    The BLOCK in the csv_headers avoid to have the newlines added, in any
    cases. For instance: by default we will have an empty line at the end of
    the headers, but the translated headers will not have it.
    
    Test plan:
    At least 2 signoffs will be needed, please test carefully!
    You will need to generate CSV with at least 2 entries!
    Test with the non-translated interface (en) and with the language you
    want. To test with a translated language you will *have to*:
    - cd misc/translator
    - perl translate update LANG
    - manually edit the po file, remove the fuzzy tags, correctly translate
    the string (do not forget the additional %s in the headers)
    - perl translate install LANG
    1/ Export basket and basketgroup as CSV
    2/ Export late orders as CSV
    3/ Export items (from the item search) as CSV
    4/ Export the 2 reports "Orders by fund" and "Cash register" as CSV
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07c0d968b70421852ac4915633fa7f3cbd0d18cd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 7 17:55:50 2017 +0000

    Bug 16976 - Unit tests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c8a04acb05466356fec8e9d6d13183295719c7d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 16 06:36:22 2017 -0400

    Bug 16976 - Authorities searches with double quotes gives ZOOM error 20003 [Alternate]
    
    I dug into this a little bit, it seems the issue is that we were double
    processing the query because of an extra call to
    C4::AuthoritiesMarc::SearchAuthorities
    
    I think we can simply remove this call
    
    To test:
    1 - Perform an authority search for a value that returns results
    2 - Wrap it in quotes and search
    3 - 'Internal server error'
    4 - Apply patch
    5 - Search with quotes succeeds
    
    https://bugs.koha-community.org/show_bug.cgi?id=16796
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3808dbc1d22b3adc43a09ba7ce00aaca01f95f5a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 7 13:50:32 2017 -0300

    Bug 19053: Keep auto_renew flag if a confirmation is needed
    
    If an item is checked out with the auto renewal flag and a confirmation
    is needed (holds exist, past due date, etc.) the auto renewal flag will
    get lost.
    
    Test plan:
    - Check an item out and specify a past due date
    - Confirm the checkout on the confirmation screen
    => Without this patch the checkout is not marked as auto renewal
    => With this patch applied the auto renewal flag will be set to the
    checkout
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03c5eb0babc3fd7b0ecf45a8a5db91a67718d3b4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 15 12:16:33 2017 -0300

    Bug 18624: Do not return 1 in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d7d524f21fbf83ef7e1031e36c9772ffe21db90
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 7 16:23:24 2017 -0300

    Bug 18624: (followup) opac-authorities-home.tt uses 'any'
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfb52579ec2f8859226e0e40f66d5a6d7a2ed73f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 16 09:53:39 2017 -0400

    Bug 18624: Run time errors when searching authorities with Elastic search 5.3
    
    It seems we have a syntax mismatch - any vs all
    
    all seems to the be list we expect so updating code that way
    
    To test:
    1 - Enabled Elasticsearch
    2 - Index some authorities
    3 - Perform a 'Search entire record' search
    4 - Internal server error (
            Invalid marclist field provided: all at
            /usr/local/koha/Koha/SearchEngine/Elasticsearch/QueryBuilder.pm
            line 433.
            )
    5 - Run:
        $ sudo koha-shell kohadev
       k$ cd kohaclone
       k$ prove t/db_dependent/Koha/SearchEngine/Elasticsearch/QueryBuilder.t
    => FAIL: Tests fail because 'any is used'
    6 - Apply patch
    7 - Search should work
    8 - Run:
       k$ prove t/db_dependent/Koha/SearchEngine/Elasticsearch/QueryBuilder.t
    => SUCCESS: Tests pass!
    9 Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Edited the test plan so it mentions the new tests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b308b0814bcd149e3f899058e693938d982bb425
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 7 16:09:56 2017 -0300

    Bug 18624: Regression test for 'any' vs 'all'
    
    This test makes it explicit that the only string producing _all as index on build_authorities_query_compat is 'all'.
    To test:
    - Apply this patch
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/db_dependent/Koha/SearchEngine/Elasticsearch/QueryBuilder.t
    => FAIL: Test fails because the list of valid values is wrong in Koha.
    
    Note: this list has to be in sync with the templates passing the same values. A followup will be added
    to fix a discrepancy found between OPAC and Intranet.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff41b87302c1b242f9edd7b2e8c253bd18b57ac1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 7 16:07:40 2017 -0300

    Bug 18624: Minor refactoring to ease testing
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c140b9129124262db27c9ba17f47134ec3232ada
Author: Marc Véron <veron@veron.ch>
Date:   Wed Aug 2 18:01:06 2017 +0200

    Bug 19027 - Circulation rules: Better wording for standard rules for all libraries
    
    In Home > Administration > Circulation and fine rules, the standard value for
    "Select a library: All libraries" is confusing and leads to support cases.
    
    Change wording to "Standard rules for all libraries".
    
    To test:
    - Apply patch
    - Go to Home > Administration > Circulation and fine rules
    - Verfiy that text in drop down 'Select a library' makes sense.
    
    Followed test plan which works as intended. I agree with the wording it
    is significantly clearer than previously
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3304c7c4ca49db1b95aa564b3550bacf260b9b4f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 1 17:07:33 2017 +0000

    Bug 18985 - SQL reports 'Last edit' and 'Last run' columns sort alphabetically, not chronologically
    
    This patch alters the DataTables configuration of the SQL reports list
    so that date columns are identified via class rather than position.
    
    To test, apply the patch and go to Reports -> Use saved.
    
    Test the re-ordering of the creation date, last edit, and last run
    columns. Each should sort correctly based on the date.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e2c823e8806c35673505d0e2a03081cac00190a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 14 11:25:42 2017 +0000

    Bug 18941 - C4::Budgets GetBudgetByCode should return active budgets over inactive budgets
    
    To test:
    1 - Create an active budget
    2 - Create an inactive budget
    3 - Ensure they each have a fund with the same code
    4 - Set MarcFieldsToOrder to get the budget_code from a marc field
    5 - Stage a file using the duplicated code
    6 - Add to a basket from the staged file
    7 - Add the items
    8 - Note funds are encumbered from the inactive budget
    9 - Apply patch
    10 - Repeat 5-8 with a new basket
    11 - Note the active budget is now used
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22944fb61241239124b4db218d098b8510327276
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 14 11:06:16 2017 +0000

    Bug 18941 - Unit tests
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28a979487f3d8c4a5887c484ae71c7c63e7ee03d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 10 15:52:35 2017 -0300

    Bug 13012: Add more tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2a8e726fe32d4aae3f279f4142af240c60d7fe5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jul 19 14:57:26 2017 -0400

    Bug 13012 - suggestion.suggesteddate should be set to NOW if not defined
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/Koha/Suggestions.t
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8651016ce8e959b5b6ca19ccddbb3f5342b5d456
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 10 09:24:08 2017 +0200

    Bug 19071: Fix Members/IssueSlip.t
    
    Resolve:
    DBD::mysql::db do failed: Cannot delete or update a parent row: a foreign key constraint fails (`koha_master`.`clubs`, CONSTRAINT `clubs_ibfk_2` FOREIGN KEY (`branchcode`) REFERENCES `branches` (`branchcode`)) [for Statement "DELETE FROM branches"] at t/db_dependent/Members/IssueSlip.t line 44.
    
    We do not need to delete all branches here.
    
    Note: The test still needs attention for noisy userenv warns, but it should
    pass now.
    
    Test plan:
    Run t/db_dependent/Members/IssueSlip.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b80704aa1b763c7a29c3b95c162dfb12ded8faa2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 10 09:13:44 2017 +0200

    Bug 19071: Fix Circulation/issue.t
    
    Resolve:
    DBD::mysql::db do failed: Cannot delete or update a parent row: a foreign key constraint fails (`koha_master`.`clubs`, CONSTRAINT `clubs_ibfk_2` FOREIGN KEY (`branchcode`) REFERENCES `branches` (`branchcode`)) [for Statement "DELETE FROM branches"] at t/db_dependent/Circulation/issue.t line 65.
    
    Cause:
    See also bug 19070.
    We do not need to delete all branches here.
    
    Test plan:
    Run t/db_dependent/Circulation/issue.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2cceb95b47983b28242819c95e57439958b0da5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 10 09:04:16 2017 +0200

    Bug 19070: Fix Circulation/Branch.t
    
    Resolve:
    DBD::mysql::db do failed: Cannot delete or update a parent row: a foreign key constraint fails (`koha_master`.`clubs`, CONSTRAINT `clubs_ibfk_2` FOREIGN KEY (`branchcode`) REFERENCES `branches` (`branchcode`)) [for Statement "DELETE FROM branches"] at t/db_dependent/Circulation/Branch.t line 49.
    
    Resolve:
    not ok 14 - AddReturn respects branch item return policy - noreturn
       Failed test 'AddReturn respects branch item return policy - noreturn'
       at t/db_dependent/Circulation/Branch.t line 279.
              got: 'yqiKrIkX'
         expected: undef
    
    Cause:
    There is a record in clubs. The constraint in clubs on branchcode does not
    include a cascaded delete. The test deletes all branches.
    Test 14 depends on item-level_itypes==1. When you set it to Biblio, it fails.
    
    Test plan:
    Run t/db_dependent/Circulation/Branch.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a328a20bf3a74268346104281688b2a81be80e6
Author: Alex Sassmannshausen <alex.sassmannshausen@ptfs-europe.com>
Date:   Thu Aug 10 13:00:19 2017 +0200

    Bug 19073: (bug 15758 follow-up) Dereference correct value from Koha::Object.
    
    * tools/modborrowers.pl: Dereference 'branchcode' rather than
      'value'.
    
    Test Plan:
    - Carry out "Batch patron modification" with any number of patrons.
      + Change the library.
      + Hit Save.
    - The library will not have been updated.
    - Apply patch.
    - Run same modification.
    - The library will have been updated
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be0bf8731a2361f4fabbfff8059fef60dd364d88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 10 15:20:43 2017 -0300

    Bug 19074: Do not crash if cardnumber does not exist
    
    If a cardnumber does not exist, $borrower will be undef and the ->category call will explode
    Can't call method "category" on an undefined value at
    /home/vagrant/kohaclone/tools/modborrowers.pl line 370.
    
    This patch makes sure the patron exists before calling any methods.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad1182411220d74cd13ea5cd1525b71cf7fef981
Author: Alex Sassmannshausen <alex.sassmannshausen@ptfs-europe.com>
Date:   Thu Aug 10 13:33:36 2017 +0200

    Bug 19074: Fix category display in Batch patron modification.
    
    * tools/modborrowers.pl (GetBorrowerInfos): Fix setting of patron
      category description.
    * koha-tmpl/intranet-tmpl/prog/en/modules/tools/modborrowers.tt: Use
      it.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b63d3e041602318b16a51a4b1798fbdc25f34bb
Author: Marc Véron <veron@veron.ch>
Date:   Tue Aug 8 10:05:44 2017 +0200

    Bug 18555: (QA-Followup) Remove duplicate code
    
    Remove duplicate code as of comment #7
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b87ec988dd786ca1286a7baa9f14fabdcb1c6c2
Author: Marc Véron <veron@veron.ch>
Date:   Mon May 8 16:18:41 2017 +0200

    Bug 18555: Create patron list from patron import
    
    Create a patron list from imported patrons to be used for printing patron
    cards and other patron list related actions.
    
    To test:
    - Apply patch
    - Go to Home > Tools > Import patrons
    - Select a file to import and check new checkbox 'Create patron list'
    - Import file
    - Verify that in import results you see the time stamped name of the
      patronlist containig the imported patrons (if any patrons were imported)
    - Go to Home > Tools > Patron lists
    - Verify that the list shows up and contains the imported patrons
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4ce1feb1bc6b4f20cf71bd545e018917cf518db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 10 15:06:39 2017 -0300

    Bug 19047: Fix AddBiblio call in ShelfBrowser.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6f8cf69d3943599fa6a0c250ae0e8221ead44ff
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 7 08:44:43 2017 +0200

    Bug 19047: Fix AddBiblio call in Reserves.t
    
    AddBiblio does not return a title; the biblioitemnumber is stored in the
    title variable.
    The variables for biblioitemnumber are not used and can be removed.
    
    Test plan:
    Run t/db_dependent/Reserves.t
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3dafbfccd06af8fca45fada449e93e3d0616cd6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 10 15:02:23 2017 -0300

    Bug 19042: Add mock IndependentBranches=0 for the other test
    
    These tests do not cover correctly getletter, but it is not the goal of
    this patch. Superlibrarian behaviour must be tested as well.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d01ce104a7711814152e4f8228064f79c8a7f68c
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Aug 4 14:24:38 2017 -0400

    Bug 19042: Silence warnings t/db_dependent/Letters.t
    
    TEST PLAN
    ---------
    prove t/db_dependent/Letters.t
    -- there will be a message: "C4::Context->userenv not defined!"
    apply this patch
    prove t/db_dependent/Letters.t
    -- there will no longer be that message.
    run qa test tools
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e35903574ce666bca32eb4676f311b99bb268ec2
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jul 6 08:48:18 2017 +0200

    Bug 18900: wrong number format in receiving order
    
    Bug 18471 added number formating in order receive.
    
    I found a bug generated by this.
    Koha::Number::Price defines methods to (un)format price depending on CurrencyFormat syspref.
    The bug is that for CurrencyFormat US, some params are not defined in this module so there are retrieved from system locale. If system locale is not en_US, the params will be wrong. For example fr_FR will define ',' as decimal and so saved unit price is divided by 1000.
    
    To recreate:
    - On a server with locale 'fr_FR'
    - With Plack mode
    - Set CurrencyFormat on 'US'
    - Open a basket
    - Place an order for an item
    - Close basket
    - Receive order with changing 'Actual Cost' to '1,234'
    - Note the 'Actual Cost' is now '1.23'
    - Run unit test t/Number/Price.t without and with patch
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61f2ec769073709be3b688654ec355b3f4fbe522
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 9 12:01:17 2017 -0300

    Bug 18900: (QA followup) Make tests conditional to locale existence
    
    It is important to highlight that tests have been skipped instead of having them pass
    on the absence of the required fr_FR.UTF-8 locale installed on the system.
    
    This patch does that check and effectively skips them.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91dee226cdd089353dc71e559aa9e0b34fddf72e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jul 6 08:44:51 2017 +0200

    Bug 18900: add UT to Number/Price.t
    
    This patch adds unit tests to t/Number/Price.t in order to valid the problem.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04966a6203646cae79a48a00ef0873c1f6c64b06
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 10 13:15:27 2017 -0300

    Bug 5471: Use uri_escape_utf8 to handle utf8 chars correctly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee6f8e186bc93df9d7943ea38f05615b2e8a813f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jun 9 12:29:58 2017 +0000

    Bug 5471 - Quotes in tags fail
    
    This patch makes changes to the tag moderation template and JavaScript
    to fix handling of tags with double or single quotes. This patch also
    moves the tags moderation JavaScript out of the template and into a
    separate JS file.
    
    To test you should have multiple tags awaiting moderation, including
    tags which contain double and single quotes.
    
    - Go to Tools -> Tags.
    - In the list of tags pending approval, test approving and rejecting
      tags, including those containing single or double quotes.
      - The state of the "Approve" or "Reject" buttons should correctly
        change according to the action you chose.
      - The label in the status column should update correctly.
    - In the "Check lists" form, submitting approved, rejected, and
      unclassified terms should result in the correct message.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Works correctly based on test plan. Tested using single- and
    double-quoted tags. Passes QA Tools.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a302b17afee055c5d123d78328d50bdc7531259
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 22 10:14:29 2017 +0200

    Bug 18980: Show distinction between shared and private lists in staff
    
    Just as we show this distinction in OPAC, this patch adds a type column
    in the Your lists tab that displays Private or Shared. It always contains
    Public in the other tab.
    
    Test plan:
    [1] Check if you see Shared for a private lists with shares in staff.
    [2] Run t/db_dependent/Utils/Datatables_Virtualshelves.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit efc4caec968dd0394c6d1ee8a2c4be66cc697afb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jun 21 16:53:56 2017 +0200

    Bug 18980: Remove js function Check from opac-shelves
    
    This function only serves to check if the shelf name is not empty. It
    does not even work since it incorrectly refers to f.addshelf (while it
    should test #shelfname).
    We can solve this and improve consistency by doing the same as in the
    staff template with html5 required.
    
    Test plan:
    [1] Without this patch it was possible to add a list without a name in
        OPAC (with js error: TypeError: f.addshelf is undefined).
    [2] With this patch, verify that you cannot do this anymore.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93366e10fbe2b018caa9d6b388b74cc3ef302a86
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jun 21 16:24:57 2017 +0200

    Bug 18980: Add js to dynamically show/hide the Anyone remark
    
    If we we move from Private to Public or vice versa, this should reflect
    on the Anyone remark from the first patch.
    If we go back to a private list without shares, we should show it.
    
    Handled in a js sub AdjustRemark, triggered by onchange of the category
    combo or the permission combo.
    
    Test plan:
    [1] Edit a private list without shares in OPAC. Toggle category and/or
        permissions. Is the remark shown or hidden accordingly?
        Note: Include a test with OpacAllowPublicListCreation enabled.
    [2] Edit a shared list or public list in staff. Toggle category/permissions.
        You should never see the remark.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e5cad0f03d5d90eff2d6cedfb4ff6014c0610c0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jun 21 13:13:17 2017 +0200

    Bug 18980: Add remark next to "Anyone seeing this list" permission
    
    This is a follow-up of report 18228 that simplifies the permissions for
    lists. It reapplies the idea behind bug 10865 by adding a remark next to
    the Anyone permission if it is not actually effective. A next patch will
    make it behave dynamically.
    
    Note: The Anyone permission is not relevant if it is a private list that
    has no shares. Note that looking at the prefs OpacAllowPublicListCreation
    and/or OpacAllowSharingPrivateLists is not decisive. You should look at
    list permissions and shares in the database; turning off the Sharing pref
    does not automatically remove all shares in the system. It only blocks
    creating new shares.
    
    We only need changes in opac-shelves.tt and virtualshelves/shelves.tt.
    
    Test plan:
    [1] Verify that you see the remark now in OPAC and staff.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffe659e92ac023d59ebe6dca40a79056d15fae87
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Tue Jun 27 11:42:44 2017 +1200

    Bug 18857 - Add buttons to left hand side of circ rules table
    
    To test:
    * Apply this patch
    * Define some rules in the interface using the left hand buttons
    * Define some rules in the interface using the right hand buttons (scroll to see)
    * Delete some rules in the interface using the left hand buttons
    * Delete some rules in the interface using the right hand buttons (scroll to see)
    * Choose a rule to edit using the left hand buttons
    * Edit the rule, saving using the left hand button
    * Edit a rule, but clear the values using the left hand buttons
    * Choose a rule to edit using the right hand buttons (scroll to see)
    * Edit the rule, saving using the right hand buttons (scroll to see)
    * Edit a rule, but clear the values using the right hand buttons (scroll to see)
    
    Signed-off-by: Guillaume <guillaume_lair@ville-limoges.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19eb17c7894c4d2d53ecfc1ad4e417aa86ab9410
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 9 12:59:20 2017 -0300

    Bug 19067: Test Makefile.PL mapping
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e57b3a6c4d9bb6319f038909832281dd4a9e39e5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 9 12:27:00 2017 -0300

    Bug 19067: Map clubs/ into INTRANET_CGI_DIR in Makefile.PL
    
    This patch adds the required entry in Makefile.PL so the clubs/ dir is correctly installed
    during the make install step.
    
    To test:
    - Run:
      $ cd kohaclone
      $ perl Makefile.PL
    - Follow any install method and options
    - Run
      $ make
      $ ls blib/INTRANET_CGI_DIR/ | grep clubs
    => FAIL: No clubs dir
    - Run:
      $ make clean
    - Apply this patch
    - Run:
       $ perl Makefile.PL
    - Follow any install method and options
    - Run
      $ make
      $ ls blib/INTRANET_CGI_DIR/ | grep clubs
    => SUCCESS: The clubs/ dir is correctly picked for inclussion in the intranet cgi dir
    - Sign off :-D
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1da47215516206d51545e5bc662a34e335127ff6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 9 16:52:21 2017 -0300

    Bug 17829: (follow-up) Move GetMember to Koha::Patron - routing-lists.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95f1844e6c46ff51de9f95f99fcdf3369c756fd4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Aug 2 11:21:58 2017 +0200

    Bug 19023 - inventory tool performance
    
    Inventory tool performance seems to be worst since 16.11.
    I think it is because of authorized values computing changed by Bug 17249.
    
    For each subfield of each item, we try to get the authorized value description with Koha::AuthorisedValues->search_by_marc_field.
    But this method does not use cache like Koha::AuthorisedValues->get_description_by_koha_field.
    
    I propose to use Koha::AuthorisedValues->get_description_by_koha_field and also to look for authorized value description only for item fields used in TT : location, notforloan, itemlost, damaged, withdrawn.
    
    I have experimented inventory time on 100 items from 5s to 1s.
    
    Test plan :
    - Without patch
    - Perform inventory with barcode file
    - Check results and mesure execution time
    - Apply patch
    - Reperform inventory with same barcode file
    - Check results is the same
    - Compare execution time
    - Run prove t/db_dependent/Items/GetItemsForInventory.t
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fdfbaf0ddbf214c0efb9a3a3c2595a54517f795
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Jul 27 11:58:28 2017 +1000

    Bug 18898 - Some permissions for Reports can be bypassed
    
    If you manually visit the following links when you only have
    permission to run reports, you'll still be able to access the ability
    to create and edit reports:
    
    /cgi-bin/koha/reports/guided_reports.pl?phase=Create%20report%20from%20SQL
    /cgi-bin/koha/reports/guided_reports.pl?phase=Edit%20SQL
    
    This patch ties these 2 unaccounted for phases to the create_reports
    permission.
    
    With patch, issue no longer can be reproduced.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19a7b498e1f4355ab1e4ee0adb5db299613f3f5c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 6 18:10:10 2017 -0300

    Bug 18906: Display all funds the logged in user can use
    
    There are complex conditions to know if a librarian can use a fund, we
    cannot do that with a SQL query, we need to use C4::Budgets::CanUserUseBudget
    
    When this patch is applied then all funds are visible to both
    superlibrarian patrons and patrons with all acq permissions
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bb56bf336187cde38e1a3b89c792ee6dc231acf
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Sat Jul 29 17:06:52 2017 +0200

    Bug 19003: Add a TestBuilder default for borrowers.login_attempts
    
    Bug 18314 causes t/db/SIP/Message.t to fail (quite often) since
    TestBuilder fills login_attempts with a random number. (Note: Only
    when FailedLoginAttempts is non-zero.)
    Trivial fix: TestBuilder should have a zero default for login_attempts.
    
    Test plan:
    Do not yet apply this patch.
    Set pref FailedLoginAttempts to say 3.
    Run t/db_dependent/SIP/Message.t. Might fail on the password test (CQ).
    Apply this patch.
    Run t/db_dependent/SIP/Message.t again. Does not fail anymore.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0853c4e2b4366a235077a24a873fc81a754afecb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 1 11:44:29 2017 -0300

    Bug 17699: Reset time simulation
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec9b691de934f82c50057c15fb7d3a1b32717b72
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 31 11:30:00 2017 -0300

    Bug 17699: Add test descriptions
    
    Test plan:
      prove -v t/db_dependent/Koha/Patrons.t
    
     Subtest: renew_account
        1..30
        ok 1 - 2016-02-29T00:00:00 + 12 months must be 2017-02-28T00:00:00
        ok 2 - 2016-02-29T00:00:00 + 12 months must be 2017-02-28T00:00:00
        ok 3 - With BorrowerLogs, Koha::Patron->renew_account should have logged
        ok 4 - today + 12 months must be 2017-03-31T00:00:00
        ok 5 - today + 12 months must be 2017-03-31T00:00:00
        ok 6 - Without BorrowerLogs, Koha::Patron->renew_account should not have logged
        ok 7 - today + 12 months must be 2017-03-31T00:00:00
        ok 8 - today + 12 months must be 2017-03-31T00:00:00
        ok 9 - 2016-04-30T00:00:00 + 12 months must be 2017-04-30T00:00:00
        ok 10 - 2016-04-30T00:00:00 + 12 months must be 2017-04-30T00:00:00
        ok 11 - 2016-10-30T00:00:00 + 12 months must be 2017-10-30T00:00:00
        ok 12 - 2016-10-30T00:00:00 + 12 months must be 2017-10-30T00:00:00
        ok 13 - With BorrowerLogs, Koha::Patron->renew_account should have logged
        ok 14 - today + 12 months must be 2017-11-30T00:00:00
        ok 15 - today + 12 months must be 2017-11-30T00:00:00
        ok 16 - Without BorrowerLogs, Koha::Patron->renew_account should not have logged
        ok 17 - today + 12 months must be 2017-11-30T00:00:00
        ok 18 - today + 12 months must be 2017-11-30T00:00:00
        ok 19 - 2016-12-30T00:00:00 + 12 months must be 2017-12-30T00:00:00
        ok 20 - 2016-12-30T00:00:00 + 12 months must be 2017-12-30T00:00:00
        ok 21 - 2017-06-30T00:00:00 + 12 months must be 2018-06-30T00:00:00
        ok 22 - 2017-06-30T00:00:00 + 12 months must be 2018-06-30T00:00:00
        ok 23 - With BorrowerLogs, Koha::Patron->renew_account should have logged
        ok 24 - today + 12 months must be 2018-07-31T00:00:00
        ok 25 - today + 12 months must be 2018-07-31T00:00:00
        ok 26 - Without BorrowerLogs, Koha::Patron->renew_account should not have logged
        ok 27 - today + 12 months must be 2018-07-31T00:00:00
        ok 28 - today + 12 months must be 2018-07-31T00:00:00
        ok 29 - 2017-08-31T00:00:00 + 12 months must be 2018-08-31T00:00:00
        ok 30 - 2017-08-31T00:00:00 + 12 months must be 2018-08-31T00:00:00
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24b4006ecbc0a258b09500bdd8f639c7018067c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 31 11:03:37 2017 -0300

    Bug 17699: Use limit as end_of_month
    
    From DateTime::Duration pod:
    ""
    For positive durations, the "end_of_month" parameter defaults to wrap.
    For negative durations, the default is "limit". This should match how
    most people "intuitively" expect datetime math to work.
    """"
    
    We need end_of_month => limit for  positive durations as well.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9512b015662f8ec56d8b8884b4e4bb14d5e563f1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 31 11:02:42 2017 -0300

    Bug 17699: Add more tests to highlight the problem
    
    Add problematic cases to highlight the problem.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bbec5c382590f881e6d2af62b2608fe9cf9e051
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 31 11:18:23 2017 -0300

    Bug 19009: Fix random failures from Circulation.t
    
    From jenkins output:
     Subtest: CanBookBeIssued + Koha::Patron->is_debarred<7c>has_overdues
    1..8
    not ok 1
    [SKIP]
    
    I executed it several times and display the different $error, $alerts and question keys.
    GNA and RESTRICTED were sometimes set, which block the issue.
    Reading the code it seems that some patron's attributes must be removed to avoid the checkin rejection.
    
    Test plan:
    Execute the tests several times and notice that it fails randomly
    With this patch they should always pass.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae5f5c479929cbfad3193c6ce9471a406a2a41f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 14 11:32:30 2017 -0300

    Bug 18802: Fix Circulation.t if finesMode ne 'production'
    
    If finesMode is not set to production, only 1 fine will be created (the renewal
    one will not). This is what assumes the tests.
    If set to 'production', the tests will fail because the fines will not
    be deleted (because of the DBIx::Class) warning.
    Now we mock the value before charging.
    
    prove t/db_dependent/Circulation.t
    t/db_dependent/Circulation.t .. 16/95 DBIx::Class::Storage::DBI::select_single(): Query returned more than one row.  SQL that returns multiple rows is DEPRECATED for ->find and ->single at t/db_dependent/Circulation.t line 491
    t/db_dependent/Circulation.t .. 56/95
        #   Failed test 'Can auto renew, OPACFineNoRenewals=10, patron has 10'
        #   at t/db_dependent/Circulation.t line 670.
        #          got: 'auto_too_much_oweing'
        #     expected: 'auto_renew'
        # Looks like you failed 1 test of 6.
    
    Test plan:
      prove t/db_dependent/Circulation.t
    should return green whatever the value of finesMode
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bcf6a79427297c332588317dde749e923c7bbdc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 7 11:04:51 2017 -0300

    Bug 19013: (QA followup) Set guarantorid to NULL patron sample data
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7d291a1ee692d6de71503683a3e61c9311c33d8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 31 16:12:16 2017 -0300

    Bug 19013: Fix borrowers.guarantorid in sammple_patrons.sql
    
    That breaks randomly tests on Jenkins (Koha/Patrons.t)
    
    It certainly affects data in other languages but I did not find a quick
    and easy way to modify this file (replace all guarantorid values with
    NULL)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Easy fix
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b94eb77d1ba2f407f79c12c3fff44312ea964d77
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 7 12:33:50 2017 -0300

    Bug 18851: (QA followup) Test doesn't need sessions on DB
    
    As the DB structure is not initialized for sessions, running this tests raise an irrelevant warning.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1917e0c89fc275bf402b79ddad924b51731f47bf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 10 16:11:44 2017 -0300

    Bug 18851: Fix few other tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1185533c61e8266f9d89136e8e0debddf71d497
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 24 12:44:30 2017 -0300

    Bug 18851: Make OverDrive.T pass if dbms is not running
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 972281c77d1315dde2a988510a8c4102de16d7d2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 17:38:41 2017 -0300

    Bug 18851: Tests must be skipped in cardnumber.t if Test::DBIx::Class is not installed
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31f5c43d54a2bb6d61402889cb6dcff630683015
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 17:38:22 2017 -0300

    Bug 18851: Test::DBIx::Class is not needed in 00-load.t
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f79beb52708ed211f4ef6386ed358b21ed511efb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 17:37:41 2017 -0300

    Bug 18851: Database handler must not be created at runtime
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64a0aa541ed96b45bdc5525f35bf7dfea9c25104
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 7 09:54:27 2017 -0300

    Bug 19048: (bug 17829 follow-up) Fix regression in self checkout
    
    $patronid is not necessarily set or does not match a valid cardnumber.
    These cases must be taken into account to avoid the script to crash and
    raise the following error:
    Can't call method "unblessed" on an undefined value at
    (...)/koha/opac/sco/sco-main.pl line 117
    
    Test plan:
    Hit sco/sco-main.pl and confirm that the error is gone with this patch
    applied
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbfb6dca269acdc417e51e84e0c0b88e57f095ba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 7 10:01:40 2017 -0300

    Bug 19041: (bug 17855 follow-up) Fix regression on bug 16058
    
    From
      commit 0492fcf87f170846d1e6c8683916a56cb67ce9a7
        Bug 17855: Onboarding tool
    
    +++ b/koha-tmpl/intranet-tmpl/prog/en/modules/intranet-main.tt
    @@ -1,5 +1,3 @@
    -[% USE Koha %]
    -[% SET footerjs = 1 %]
    
    +[% USE Koha %] has been re-added by
      commit 151cdcd133d8618a3faf9b47723d66ac3dc71b4e
        Bug 18673: News author does not display on staff client home page
    
    But not the footerjs = 1
    
    Test plan:
    From the main page of the staff interface, delete a news item
    Without this patch applied you will not get a JS confirmation message
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Trivial fix.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b73cae6eb4ce7e7ca675d6db84fe8ce0cd2f499
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 28 11:38:33 2017 +0000

    Bug 18367 - (QA Followup) Only warn if doing a lookup and not having an item
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5e5402f36c923775b341bd1900aa6468d42aa9a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 28 11:58:24 2017 +0200

    Bug 18991: [QA Follow-up] Use schema txn_begin and txn_rollback
    
    We also need just one rollback at the end here.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f49f5a67d3512ea75d92cb551ebd79a9de7e53d7
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Thu Jul 27 14:56:18 2017 +0000

    Bug 18991: Fix cleanup in t/db_dependent/Log.t
    
    There is an action_logs entry via logaction() without transaction to be rolled
    back in t/db_dependent/Log.t. This leaves an entry in action_logs after
    the test is over.
    
    To replicate:
    1. prove t/db_dependent/Log.t
    2. Observe a new entry in action_logs table
    
    To test:
    1. Apply patch
    2. prove t/db_dependent/Log.t
    3. Observe there are no new entries in action_logs
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac8e39d1e742b196677d395dc89d92848560b903
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Fri Jul 21 08:47:48 2017 +0000

    Bug 18987 - Added Koha::Account package pragma to Patron.pm
    
    Test plan:
    1. On an up to date branch go to Patrons and try to browse for a patron
    by last name
    2. Notice that the page processes indefinately
    3. Apply patch
    4. Repeat step 1
    5. Notice the patron results are displayed
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Works as described.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c87b6f387831053e01ecc86b91d61669af9696b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 28 07:56:21 2017 +0200

    Bug 19000: Fix typo in closing p tag for items
    
    Close the p tag and add a br tag to visually divide the two sections
    Data problems and Warnings regarding system configuration.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Discovered the problem when testing a duplicate key in deleteditems.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a6cef0d5194151b53486d9e126f0df157a8ddb9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 28 10:29:51 2017 +0200

    Bug 17680: [QA Follow-up] dt_from_string failing silently
    
    This is a trivial fix, but finding the cause for a failing checkin in
    SIPServer surely was not.
    Without this simple change, I could not checkin an item while the SIP server
    just closed the connection and syslog contained nothing useful.
    
    The error can be easily reproduced without this patch by:
        use Modern::Perl;
        use C4::SIP::ILS::Item;
        my $item = C4::SIP::ILS::Item->new('some_barcode');
    where some_barcode should refer to an item checked out.
    You should trigger the error (with your due date):
        2017-07-28 23:59:00 is not an object at line 3.
    
    Why the ILS/Item.pm module still compiles without a warning, is not clear
    though.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Colin Campbell <colin.campbell@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5017931c5a414f3f2267127309c3b1c031aec770
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 26 16:39:17 2017 -0300

    Bug 17829: Execute rollingloans tests in a transaction
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d5fa221e80aec69051ed011751fada84e5c4b61
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 21 14:06:06 2017 +0000

    Bug 15140 (QA Followup) lowercase the search index
    
    Zebra doesn't care about cases, but ES does and default mapping is
    'control-number'
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03f5c5b4f82d6f3eba2b4e7dd4eae7e28d53a60a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon May 1 13:04:07 2017 +0200

    Bug 15140: Display $i when ind2==8
    
    See MARC specification.
    Note that we have a preceding text before all 776s too.
    
    Test plan:
    [1] Set field 776 ind2 to 8. And add text in $i.
    [2] Look for this text on OPAC detail and staff detail.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Felix Hemme <felix.hemme@thulb.uni-jena.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b7ffef53db3e8f1ffe2bda17f11a0ae18d3bf3b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 16 12:37:12 2017 +0100

    Bug 15140: Add MARC21 776 to OPAC and staff display
    
    Adds code to opac and staff detail XSLT in order to show 776$t (or $a) and
    a link based on 776$w (record control number). $w should be in the form:
        (MARCOrgCode)Record-number
    For instance: (NL-AmRIJ)12345
    
    Note: You should have enabled default opac/intranet XSLT view.
    
    Test plan:
    [1] Add two 776s (one with $t and $w and one with $t only)
    [2] Verify that you see "Additional physical formats" on opac-detail. Does
        the link for $w work?
    [3] Check intranet detail too.
    [4] Empty 776$t and put text in $a. Check detail page again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Felix Hemme <felix.hemme@thulb.uni-jena.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d8b26b01f505771fe0d359d29fff8bc963e5291
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Mon Jul 24 18:16:25 2017 +0300

    Bug 18976: (follow-up) Fix t/db_dependent/Search/History.t cleanup
    
    Same problem in t/db_dependent/Search/History.t.
    
    To replicate:
    1. Check the row count of borrowers, branches, categories, sessions, sms_providers
       tables
    2. prove t/db_dependent/Search/History.t
    3. Repeat step 1
    4. Observe borrowers the following tables have increased in row count:
       - borrowers
       - branches
       - categories
       - sessions
       - sms_providers
    
    To test:
    1. Before applying the patch, go through steps at "To replicate" plan
    2. Apply patch
    3. Go through steps at "To replicate" plan
    4. Observe step 4 no longer applies and those tables have the same number of
       rows as before executing the test.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99d18bf0f3f729261b6560f0dd3c5d757aba3a19
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Mon Jul 24 16:43:18 2017 +0300

    Bug 18976: Fix t/db_dependent/Auth.t cleanup
    
    Test t/db_dependent/Auth.t seems to have an ineffective test data cleanup.
    Data generated by TestBuilder is left in borrowers, branches, categories,
    sms_providers and sessions tables after the test.
    
    To replicate:
    1. Check the row count of borrowers, branches and categories tables
    2. prove t/db_dependent/Auth.t
    3. Repeat step 1
    4. Observe borrowers the following tables have increased in row count:
       - borrowers
       - branches
       - categories
       - sessions
       - sms_providers
    
    To test:
    1. Before applying the patch, go through steps at "To replicate" plan
    2. Apply patch
    3. Go through steps at "To replicate" plan
    4. Observe step 4 no longer applies and those tables have the same number of
       rows as before executing the test.
    
    This issue has been happening in REST tests as well, and this solution is
    directly copy-pasted from t/db_dependent/api/v1/cities.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 139b66f65611cff0a2551662e0fd5c2e50b4c10f
Author: Lari Taskula <lari.taskula@jns.fi>
Date:   Mon Jul 24 18:30:10 2017 +0300

    Bug 18977: Rollback branch in t/db_dependent/SIP/Message.t
    
    To test:
    1. Before applying patch, check the amount of branches in database
    2. prove t/db_dependent/SIP/Message.t
    3. See that a new branch is stored
    4. Apply patch
    5. prove t/db_dependent/SIP/Message.t
    6. See that a new branch is no longer stored
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e0bb409aef75ac0f18a50d3a34a749f4e87da84
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 17 15:58:49 2017 -0300

    Bug 18910: Revert "Bug 18152 : fix unimarc label in SetMarcUnicodeFlag"
    
    This reverts commit bf551a07222a7b9beffd7ca6cba38c675aa3ab28.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd60cd9635fd51073d01ec5a24340564f61cd5e7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 17 15:58:33 2017 -0300

    Bug 18910: Revert "Bug 18152: Add tests"
    
    This reverts commit a807d7199ea025aa507e0ca7e3ff2330902844f8.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9a500e81d5d90c7a83a785c48014fce8bc17eec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 20 13:39:43 2017 -0300

    Bug 18966: Do not deal with duplicate issue_id on checkin
    
    Koha suffers of big bugs due to its history: When data are deleted, they
    are moved to another tables.
    For instance issues and old_issues: when a checkin is done, it is moved
    to the old_issues table.
    That leads to a main problem that is described on
    https://wiki.koha-community.org/wiki/DBMS_auto_increment_fix
    
    However we tried first to fix the problem (for issues/old_issues) at
    code level on bug 18242.
    The goal was to prevent data lost.
    Data lost may happens in this case:
    Check an item out (issue_id = 1)
    Check an item in (issue_id = 1)
    Restart MySQL (reset auto increment for issue_id to 1)
    Check an item out (issue_id = 1)
    Check an item in => BOOM, the issue_id is a PK in old_issues and the
    move fails.
    Before bug 18242 the data were lost, we inserted the value into
    old_issues, which fails silently (because of RaiseError set to 0 in
    Koha::Database), then delete the row from issues.
    That has been fixed using a transaction.
    
    This patch introduced a regression we tried to fix on bug 18651 comment
    0, the patron was charged even if the checkin was rejected.
    A good way to fix that would have been to LOCK the tables:
    1- Start a transaction
    2- LOCK the table to make sure nobody will read id and avoid race
       conditions
    3- Move the content from one table to the other, dealing with ids
    4- UNLOCK the table
    5- Commit the transaction
    But there were problems using LOCK and DBIx::Class (See commit
    905572910b3a - Do no LOCK/UNLOCK the table).
    
    Finally the solution implemented is not acceptable for several reasons:
    - batch checkins may fail
    - issue_id will always stay out of sync (between issues and old_issues)
    See 18651 comment 66.
    
    Since the next stable releases are very soon, and we absolutely need to
    fix this problem, I am suggesting to:
    1- Execute the move in a transaction to avoid data lost and reject the
       checkin if we face IDs dup
    => It will only reject 1 checkin (max is 1 * MySQL restart), no need to
       deal with race conditions,
    2- Display a warning on the checkin page and link to a
       solution/explanation
    3- Communicate as much as we can on the proper fix: Update auto
       increment values when the DBMS is restarted -
        https://wiki.koha-community.org/wiki/DBMS_auto_increment_fix
    4- Display a warning on the about page for corrupted data (see bug
       18931)
    5- Write and make available a maintenance script to fix corrupted data
       (TODO LATER)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45ff2ef129ea8a52ad7d08a531aad6b3e1e665f3
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Jul 26 18:42:19 2017 +1200

    Bug 18931 - Follow up - Typo fix in template for holds
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5988bb3d233fa29f2af649748bbca611c99b739
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jul 25 14:37:55 2017 -0300

    Bug 18931: (followup) Tidy text
    
    Some minor style and idiomatic issues.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3dca8c24b53aa63838687f536a5509855ccc21c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Jul 24 23:26:04 2017 +0200

    Bug 18931 - Follow up - Typo fix in SQL statement
    
    Fixes the table alias in the SQL statement for items and
    adds items to the if clause for showing data problems.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 193ecb0a2bb397bf67488f6342f02adda0328031
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 24 17:46:27 2017 -0300

    Bug 18931: Add items/deleteditems tables
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d1d6ddc9d1e4929d9eb232e0745bcf31749cfdb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 12 15:52:19 2017 -0300

    Bug 18931: Add a "data corrupted" section on the about page - MySQL AI
    
    See the following wiki page for more information
    https://wiki.koha-community.org/wiki/DBMS_auto_increment_fix
    
    Test plan:
    Create (at least) a patron, a checkout, a biblio and a hold
    Then fill the old_* or deleted* tables with:
     INSERT INTO deletedborrowers SELECT * from borrowers WHERE  borrowernumber=XXX;
     INSERT INTO deletedbiblio SELECT * from biblio WHERE biblionumber=XXX;
     INSERT INTO old_issues SELECT * from issues WHERE issue_id=XXX;
     INSERT INTO old_reserves SELECT * from reserves WHERE reserve_id=XXX;
    
    Go to the about page, 'System information' tab. You should see a new
    "Data problems" section with the list of the ids that are wrong
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cb3abcbd95fe673d5b0426f5f8c23a0c7683e65
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 26 13:50:14 2017 -0300

    Bug 18982: Remove data in the correct order
    
    To respect FK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b84987f28b43f0c92eeff9ed1067ed61f822a4b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 25 16:49:38 2017 -0300

    Bug 18982: Create a circ rule for the data we created
    
    No need to have a default circ cule, we create one for the categorycode
    and itemtype we are going to use.
    The 3 checkouts will not be rejected (5 are allowed)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca0568f58393cff3fce6b362e59e90daa1b1524a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 25 16:48:06 2017 -0300

    Bug 18982: Create a specific itemtype for these tests
    
    No need to require rentalcharge=0 for all itemtypes, we create our own.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60478e6544ddfd37dc82829f684c3837b534d146
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 25 16:46:08 2017 -0300

    Bug 18982: category.categorycode must be uppercase
    
    Otherwise it is not selected in the dropdown list and the patron created
    does not belong to this category
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78d77163af407dc639764cdf1b8936b8f0f715d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 25 14:37:27 2017 -0300

    Bug 18982: Use KOHA_INTRANET_URL instead of syspref staffClientBaseURL
    
    That way we do not need to set the syspref, we can define it setting an
    env var, like other tests.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c650764e951eb35c60482e06494816ecaeedb200
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 25 10:29:06 2017 -0300

    Bug 17829: Fix import patron
    
    Can't call method "unblessed" on an undefined value at
    /home/vagrant/kohaclone/tools/import_borrowers.pl line 230, <$fh> line 2.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37fc0d817d46d21897015a8e1df754b59ba477a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 24 14:25:21 2017 -0300

    Bug 18545: Re-add call to enableCheckboxActions
    
    This call is used to refresh the page correctly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04a601ef659c64446790758ebbe369a2ce090875
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jun 9 15:50:41 2017 +0000

    Bug 18545 [Follow-up] Remove use of onclick from OPAC Cart
    
    This patch makes a few corrections:
    
    - Use 'e.preventDefault()' instead of 'return false' in changed
      sections.
    - Modify the event handler on checkboxes to successfully handle the
      un-check action as well as the check action. (QA comment 5).
    
    To test, follow the original test plan.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b4d4f989b1d6c589a08f21ce19a48dca9072ec7
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri May 5 03:58:49 2017 +0000

    Bug 18545: Remove use of onclick from OPAC cart
    
    To test:
    1) Apply patch and add one or more items to your cart
    2) Confirm that clicking the following things still works as expected:
     - more details
     - brief display
     - send
     - download
     - print
     - select all
     - clear all
     - selecting by clicking checkbox
     - remove title
     - add title to list
     - place hold
     - add tag
     - empty and close
    
    Sponsored-by: Catalyst IT
    
    Followed test plan, works as expected. Resolves issue with two
    print dialogues from Bug 18544.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db64c94953be772fb316d508fdfffd374ea1d835
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon May 15 10:38:43 2017 +0200

    Bug 18605: Remove TRUNCATE from C4/HoldsQueue.pm
    
    Replaces TRUNCATE by DELETE, since truncate implicitly commits. We don't
    need to do that here. (Would complicate testing it too.)
    Fixes typo disablig.
    Add a simple test to HoldsQueue.t.
    
    Test plan:
    Run t/db_dependent/HoldsQueue.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 214a0e61021934c7e6deee5a24cf11606a57199b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jul 19 09:48:04 2017 +0200

    Bug 18955 - autocomplete is on in OPAC password recovery
    
    In OPAC password recovery form autocomplete is not disabled.
    So when login or email is entered, it is saved in browser input history for autocomplete.
    This is a major issue for OPAC on computers with public access.
    
    This patch adds autocomplete off on forms.
    
    Test :
    - Enable system preferences OpacPasswordChange and OpacResetPassword
    - Go to OPAC
    - Be sure to not be logged in
    - Click on "Forgot your password?"
    - Enter a loggin and email and Submit
    => Without patch there is an autocompletion with values you entered
    => With patch there is no autocompletion
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51e8b7bbc9d4fe1d560b65eef3285ec3c0b74e71
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 24 14:04:06 2017 -0300

    Bug 18572: Remove AddRenewal parameter
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b92d79817c359635f463fd5a1e5715affe96356
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 19 18:26:07 2017 +0000

    Bug 18572 - QA Followup
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9374dcf6308256f4597e1c83920559d2673b90c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 23 12:27:19 2017 +0000

    Bug 18572 - Improper branchcode set during OPAC renewal
    
    To test:
    1 - Set 'OpacRenewalBranch' to various settings
    2 - Renew an item for a ptron under each setting
    3 - Confirm action_log entries reflect the correct branch for each
    secnario
    4 - prove t/db_dependent/Circulation/issue.t
    
    Signed-off-by: David Kuhn <techservspec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a306d72ab98f2abf2266716761820f1098ede9b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jul 20 16:08:59 2017 +0200

    Bug 18965 - branch transfer limits pagination save bug
    
    In branch transfer limits, tables are paginated with 20 rows by default.
    
    The bug is that datatable not only hides rows, they are not in form.
    So when submitting form, rows not visible are erased.
    
    Test plan :
    Wihout patch :
    - Create 22 branches, you can hack the creation form by manualling calling URL : /cgi-bin/koha/admin/branches.pl?op=add_validate&branchcode=Bxx&branchname=Bxx
    - Go to Administration > Library transfer limits
    - You see table first page : only 20 first rows are shown
    - You see all checkboxes are checked
    - Go to second page of this table
    - Save
    => You see table first page with all checkboxes unchecked
    With patch the is no pagination, all checkboxes are shown when you save
    
    Signed-off-by: Axelle Clarisse <axelle.clarisse@univ-amu.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40c719a5248877d200920c2c9a028e273a5f1370
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 19 13:59:45 2017 +0200

    Bug 18951: Adjust Isbd.t
    
    Add schema calls.
    Remove an unneeded AddBiblio call.
    
    Test plan:
    Run t/db_dependent/Biblio/Isbd.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f839955db707415368d23ae81bdb14505dd058ee
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 19 13:48:55 2017 +0200

    Bug 18951: Create data for TransformKohaToMarc.t
    
    Adding schema and caching statements.
    Adjust it so that the Koha to MARC mappings are not assumed to be present,
    but are created as needed.
    Remove the mock on marcflavour. It is no longer needed.
    Resolving a small typo.
    
    Test plan:
    Run t/db_dependent/Biblio/TransformKohaToMarc.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50bc4170cec172de04db2033d464c96348d5a508
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 19 13:33:34 2017 +0200

    Bug 18951: Some t/Biblio tests are database dependent (git mv)
    
    Move Isbd.t and TransformKohaToMarc.t to db_dependent.
    Next patch will add a few adjustments too.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a696843f82dc026ab6545f18b113af8efc753715
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 21 12:07:19 2017 +0000

    Bug 18826 - (QA Followup) Add mock SessionStorage to patrons.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5dc473382ccfa118e78e91507384245ce0dcfcb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 12 17:24:24 2017 -0300

    Bug 18826: rollback transaction for api tests
    
    The holds.t tests for the REST api do no rollback properly and modify
    the DB (no cleanup).
    This comes from a bug caused by SessionStorage = mysql (default)
    
    The error is:
        "rollback ineffective with AutoCommit enabled"
    
    Test plan:
      select count(*) from borrowers;
      prove t/db_dependent/api/v1/holds.t
      select count(*) from borrowers;
    => The number of entry must be the same before and after the tests have
    been executed
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f55b8493460116c06e88058af6d86de6700c7b37
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Sat Jul 22 21:48:49 2017 +0200

    Bug 18971: Typo Koha::ItemsTypes for Koha::ItemTypes
    
    As reported by Nick, a typo from bug 17843.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd42ce2252b275092bf704447777f25ebd3d31dc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 18 11:30:18 2017 -0300

    Bug 18262: Fix api/holds.t tests
    
    biblioitem must be created with a biblio
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc0e6469f5540d40307d30d66e61f1bd7ea69191
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 17 17:18:38 2017 -0300

    Bug 18262: Fix C4::XISBN
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 490a68c98b919605d0c1d4780b49cb4d7ea3b2dd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 17 14:48:55 2017 -0300

    Bug 18942: (QA followup) Add new tests descriptions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14d53117943f4a151ad47de1112e8fb92efd23b9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 17 13:48:17 2017 -0300

    Bug 18942: Simplify syntax
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2d784a917d64ce982fdf8c20ac2a5653b6b037f
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jul 14 14:15:20 2017 +0000

    Bug 18942: Internal Server Error symptomatic of using system user
    
    TEST PLAN
    ---------
    1) sudo koha-shell -c bash kohadev
    2) prove -v t/Budgets/CanUserUseBudget.t
       -- works
    3) prove -v t/Budgets/CanUserModifyBudget.t
       -- works
    4) exit
    5) git bz apply 18942
       -- interactive just the test patch
    6) repeat steps 1-4
       -- prove fails (similar message with 919 in comment #0)
    7) git bz apply 18942
       -- interactive just the actual fix
    8) repeat steps 1-4
       -- works
    9) run koha qa test tools
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01f2440dcbc011dc9d2448b2a63d5cb65904f624
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jul 14 14:41:39 2017 +0000

    Bug 18942: Add test case to prove change
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb940292c2a24417eae6540bf3dc51194f2d1e02
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 23 12:33:26 2017 +0200

    Bug 18672: [QA Follow-up] Simplify without sleep
    
    Set the creation date one hour back, store and check again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19439a54aaddab702da5d5ae92738f5bb3ea6d97
Author: Marc Véron <veron@veron.ch>
Date:   Mon May 29 10:17:06 2017 +0200

    Bug 18672: Test for fixing overwriting creation date
    
    Use this test to highlight issue:
    prove -v t/db_dependent/Virtualshelves.t
    
    After applying patch for Koha/Virtualshelf.pm it should turn green
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Works correctly according to test case. Passes QA Tools and the
    indicated t/db_dependent/Virtualshelves.t unit test.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a355e31701b32bd16517af57a585444c93eef771
Author: Marc Véron <veron@veron.ch>
Date:   Mon May 29 08:56:14 2017 +0200

    Bug 18672: Fix overwriting creation date with modification date when editing list
    
    To reproduce:
    - In staff client, create a new list (if you have not already one)
    - In db, update virtualshelves and set field created_on to an earlier date,
      something like:
      update virtualshelves set created_on = '2017-04-01 02:09:12' where shelfnumber = 1;
    - Go to Home > Lists > Your lists
    - Verify that the modified creation date for this list appears in staff client
    - Edit list in staff client, save
    - Verify that creation date is overwritten by modification date (wrong)
    
    To test:
    - Apply patch
    - Repeat steps above, verify that creation date no longer is overwritten
      by modification date
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Amended patch: Use existing indendation

commit 85b895c2dfdf9499fdb12bd108c740144597c89e
Author: Marc Véron <veron@veron.ch>
Date:   Wed Jun 21 09:47:13 2017 +0200

    Bug 18832: Missing space between icon and label in button 'Patron lists'
    
    On page Home > Patrons the button 'Patron lists' misses a space between
    icon and text. This patch adds it to make the button display like the other
    ones.
    
    To test, apply patch and verify that the button displays as expected.
    
    Signed-off-by: fcouffignal <fcouffignal@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad367a47003f341e1c517c6fbcc96246cbf21609
Author: Baptiste Wojtkowski <baptiste.wojtkowski@biblibre.com>
Date:   Tue Jul 11 09:12:37 2017 +0000

    Bug 18613: Add unit tests for getletter
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 648e2a2b808efac22a8b88545d53b05112a1f6f0
Author: Baptiste Wojtkowski <baptiste.wojtkowski@biblibre.com>
Date:   Fri May 19 09:23:17 2017 +0000

    Bug 18613: Remove letter rule correctly as superlibrarian
    
    TEST PLAN
    
    (reproducing bug)
    1 - Set 'IndependantBranches' to enable
    2 - Log in as Superlibrarian.
    3 - Create 3 rules
        - 1 for all librairies (1)
        - 1 for the library of the superlibrarian (2)
        - 1 for another library (3)
    4 - Try to delete them and see them and see that (3) isn't the good one
    
    (checking patch)
    5 - Apply patch
    6 - Try again 3-
    7 - Connect as not superlibrarian
    8 - Try again 3-
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2c9513b1c3449a34f942d8fa53f8ce1fe374e3f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 12 13:33:51 2017 +0200

    Bug 18901: [QA Follow-up] Do not translate zzpref either
    
    Adding one backslash makes a difference :)
    We need to escape the dot in the regex to exclude a file like zzpref
    from translation too. Perfect_regexes++
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec51335e9cc4e090ef80f592cc0cc7a0786661f8
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Jul 6 14:39:20 2017 +0200

    Bug 18901: Sysprefs translation: translate only *.pref files (not *.pref*)
    
    Text editors can create temporary files in this folder and this can
    confuse the translator.
    For instance, vim can create a file named '.opac.pref.swp' which will
    make the translator dies with the following error message:
    
    Can't use string ("b0VIM 8.0") as a HASH ref while "strict refs" in use
    at LangInstaller.pm line 248.
    
    Test plan:
    1. echo 'Oops' > .../en/modules/admin/preferences/whatever.pref.whatever
    2. cd misc/translator && ./translate update fr-FR
    3. Verify that you have the error message mentioned above
    4. Apply patch
    5. cd misc/translator && ./translate update fr-FR
    6. No more errors!
    
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 441f6fac33975f7e0f7c96b262bc0c0ee3b0c82e
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Jun 7 12:53:52 2017 -0400

    Bug 18748: Noisy t/db_dependent/AuthorisedValues.t
    
    This noise is from a failure. This patch expands the delete
    to 952$c for the ACQ framework as per comment #5.
    
    TEST PLAN
    ---------
    
    insert into marc_subfield_structure (tagfield,tagsubfield,liblibrarian, libopac, repeatable, mandatory, kohafield,tab,authorised_value,authtypecode,value_builder,isurl,hidden,frameworkcode,seealso,link,defaultvalue,maxlength) values (952,'c','Shelving location','Shelving location',0,0,'items.location',10,'LOC','','',0,0,'ACQ','','',null,9999);
    -- this makes sure you have a pre-existing 952$c ACQ record.
    
    prove t/db_dependent/AuthorisedValues.t
    -- should have ugly message like in comment #0
    apply patch
    prove t/db_dependent/AuthorisedValues.t
    -- should be green
    run koha qa test tools
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10d78b9a424d2719c52aa99d3cd642bf7e37e129
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 16:52:36 2017 -0300

    Bug 18262: Fix test in MultiplePerRecord
    
    The biblioitem entry must be added
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd3b1c1a33e4bb14bbcd10a0fcf871b39362430d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 13 17:44:25 2017 -0300

    Bug 18262: Koha::Biblio - Remove GetBiblioData - part 1
    
    Most of the time C4::Biblio::GetBiblioData is used to retrieve the title
    and/or the author of a bibliographic record.
    
    This patch replaces the easy occurrences of GetBiblioData, the ones
    where the 2 joins are needed, but only data from biblio and biblioitems
    table are.
    
    Test plan:
    It will be hard to test everything, I'd suggest a QAer to review this
    patch and confirm that the difference occurrences of GetBiblioData have
    been correctly replaced by calling Koha::Biblios->find or
    $biblio->bibioitem
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f1a1fc4b96a91fc054646f91643d8ff46456055
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 14 12:19:13 2017 -0300

    Bug 18938: (bug 17829 follow-up) Replace 2 occurrences of GetMember left behind
    
    Between patch submission and push, 2 new occurrences appeared in the
    codebase.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 313e1f2f271bad995f33db6884b553efe79e9438
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 14 08:07:31 2017 +0200

    Bug 18880: [QA Follow-up] Finishing touch
    
    Do not fill @return if retval == -1 for LDAP (see cfc484b17).
    No need to call store after an DBIx update. Rearranged the if statement.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d852b332666da212f1ab8667fa044b16eb151717
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 11 12:24:36 2017 -0300

    Bug 18880: Fix authentication fallback for external authentications
    
    A regression in commit cfc484b17 / bug #18314 breaks the local
    authentication fallback for all external authentications like LDAP, CAS
    and Shibboleth.
    
    The regression itself is a logical error as "@return = (0)" is
    considered to be "false" when checked with "unless" (line 1814). That's
    wrong as "unless" tests the number of elements in a list.
    
    This patch tries to simplify the logic by adding a $passwd_ok and
    $check_internal_as_fallback flags to be more verbose and hopefully more
    understandable.
    The goal here is simply to restore back the same logic as before cfc484b17
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70eafe4484d360d936a367434649f0e3dbdb6e11
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 14 11:20:28 2017 +0200

    Bug 18259: [QA Follow-up] Replace variable name
    
    The variable name has_subscriptions implies that it is a boolean. In reality
    we save the number of subscriptions into it. Renaming has_ to cnt_.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 035e0beb8cfc1efd2a27836b0a6261010b352bd7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 13 15:38:54 2017 -0300

    Bug 18259: Koha::Biblio - Remove GetSubscriptionsId
    
    C4::Biblio::GetSubscriptionsId can be replaced using
    Koha::Biblio->subscriptions
    
    Test plan:
    Create a new order for a bibliographic record
    Create a new subscription on this biblio
    From the basket (acquisition), confirm that you are not able to delete
    the order with the biblio ("Can't cancel order and delete catalog record
    1 subscription(s) left")
    Receive the order
    On the parcel page, confirm that you are not able to delete the order
    with the biblio
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f47bd88252e201f9f06fd734dae154d9bc41543
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 10 11:56:46 2017 -0300

    Bug 18854: Protect few other occurrences of offset
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aabf001232fc46ee04cecb3a43fe8c0366a091df
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 10:44:55 2017 -0300

    Bug 18854: Make sure offset will not be < 0 - protect from DoS
    
    There was a bug that meant a very large offset in the search params
    will cause the search script to run forever (or long enough to crash
    the machine)
    
    To test
    
    1/ Get ready with sudo top so you can kill the thread before it causes
    your machine to OOM
    2/ Hit a page like yourdomain.com/cgi-bin/koha/opac-search.pl?q=1&offset=-9999999999999999999
    3/ Notice the process runs for a long time
    4/ Kill the process
    5/ Apply the patch
    6/ Hit the page again, notice the it loads (offset is set to zero)
    7/ Do the same to search in the staff client
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99b32717cd2596ce89a2d46b8cb4ddbba2dea5ad
Author: Chris Cormack <chris@bigballofwax.co.nz>
Date:   Sun Jun 25 17:34:12 2017 +1200

    Bug 18854 - Protect from DOS
    
    There was a bug that meant a very large offset in the search params
    will cause the search script to run forever (or long enough to crash
    the machine)
    
    To test
    
    1/ Get ready with sudo top so you can kill the thread before it causes
    your machine to OOM
    2/ Hit a page like yourdomain.com/cgi-bin/koha/opac-search.pl?q=1&offset=-9999999999999999999
    3/ Notice the process runs for a long time
    4/ Kill the process
    5/ Apply the patch
    6/ Hit the page again, notice the it loads (offset is set to zero)
    7/ Do the same to search in the staff client
    
    Signed-off-by: Mirko Tietgen <mirko@abunchofthings.net>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: changed -2 to 0 in opac-search.pl.
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 068db9aaabb0694b4d12404bda16525efad0fde7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 6 15:50:19 2017 +0000

    Bug 17639 - Remove white filling inside of Koha logo
    
    This patch modifies the Koha logo SVG file to remove the fill from two
    letters. This patch also optimizes the file and converts the text object
    to paths for better cross-platform portability.
    
    To test you could:
    
    - Open the file in an editor and confirm that the change is correct
      - or -
    - Open the file in a browser and use the code inspector to add a
      background-color attribute to the top-level <svg> tag. The logo should
      appear transparent, with no white fills.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88ab0ef5791d2b428399690c505ac42aba4616df
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Jul 13 05:16:53 2017 +0000

    Bug 18934: Preventing warns in Admin -> SMS providers
    
    This patch initialises the $op variable to prevent the warns
    
    To test:
    1) Go to admin -> sms providers
    2) Notice warns in error log
    3) Apply patch and refresh page
    4) Notice warns are gone
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ed66a6c8ae1c3c824e496c2d312e23db1dd8e41
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Jun 27 01:40:48 2017 +0000

    Bug 18858: Prevent warn when deleting a borrower debarment
    
    To test:
    1) Look at intranet log
    2) Go to delete a debarment on a borrower
    3) Notice warn
    4) Apply patch
    5) Add a new debarment
    6) Delete this debarment
    7) Notice warn is gone
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91e02ffdb31a560dd166bd45bca5a7815213f266
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Apr 29 19:29:11 2017 +0000

    Bug 16545 - Make edit link a styled button in item search results
    
    This patch replaces the item search results "edit" link with a dropup
    button which offers "Edit item" and "Edit record" links.
    
    To test, apply the patch and perform an item search. Each results should
    have an "Edit" menu. Confirm that the menu links work correctly for
    items on more than one page.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f87435c933616c648c50ab609d1fea2ac51785a7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Apr 29 19:36:18 2017 +0000

    Bug 18542 - Move and style "new field" link in item search form
    
    This patch modifies the item search page JavaScript so that the "New
    field" link has a "+" icon and is always placed at the end of the last
    row in that section of the form.
    
    To test, apply the patch and open the item search form in the staff
    client. In the third section there should be a "+ New field" link at the
    end of the first row of fields.
    
    Clicking the "New field" link should clone that row and move the link to
    the end of the cloned row.
    
    Behaves as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Amended patch: Fix indentation

commit afddf4145fbbfd978e4c5cd22f0ae2cbbef70560
Author: Chris Kirby <chris.kirby@ilsleypubliclibrary.org>
Date:   Wed Jun 21 18:27:21 2017 +0000

    Bug 18839: Suggestion.pl spelling mistake
    
    On the suggestion management page, 'unknown' is spelled 'unkown'
    
    This patch corrects this spelling mistake in
    
    suggestion/suggestion.pl
    
    koha-tmpl/intranet-tmpl/prog/en/include/strings.inc
    
    koha-tmpl/intranet-tmpl/prog/en/include/search_indexes.inc
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: sonia BOUIS <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58f9eded86c01d2889ed5a25551aba30c9b824a8
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jul 10 02:12:18 2017 +0000

    Bug 18917: Use font-awesome buttons for CSV profiles
    
    To test:
    1) Go to Tools -> CSV profiles
    2) Notice old style of links for Edit and Delete
    3) Apply patch and refresh page
    4) Notice buttons for Edit and Delete
    5) Confirm they work as expected
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7723ffdd130996ec946d5b9149f90cb0cdc447fc
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jul 10 02:31:22 2017 +0000

    Bug 18918: Disable CSV option if no CSV profiles exist
    
    To test:
    1) Confirm you have no MARC CSV profiles (tools -> csv profiles)
    2) Go to Tools -> Export data
    3) Select the CSV file format for biblios
    4) Notice the CSV profile dropdown shows up but the dropdown is empty
    5) Click the Export button, notice Koha breaks
    6) Go back and apply the patch, refresh
    7) Notice the CSV option is now disabled in the file format menu
    8) If you hover over CSV, an appropriate message should show explaining
    why it is disabled
    9) Create a CSV profile for MARC
    10) Go back to Export and you should be able to use CSV now without
    problem
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1fc3751804146e92c0d8d85517ffcd6ec338808e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 11 16:09:27 2017 -0400

    Bug 18367 - Fix untranslatable string from Bug 18264
    
    Restore display of message when no barcode found
    
    To test:
    1 - Go to course reserves
    2 - Add an item to a course
    3 - Try adding an invalid barcode - should get an alert
    4 - Try force adding an item with itemnumber:
        http://localhost:8081/cgi-bin/koha/course_reserves/add_items.pl?op=lookpup&course_id=11&itemnumber=1234523546
    5 - Should recieve an error
    
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1485ae8ce5432936cc28c066c9a28d3f6ec2f99
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 13 14:39:08 2017 -0300

    Bug 18775: Use Koha::Patron->library instead of Koha::Libraries->find
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0b6bcfd55c0bdfc45f229ea5cc6373cece24432
Author: David Kuhn <techservspec@gmail.com>
Date:   Sat Jun 10 13:08:20 2017 -0700

    Bug 18775 - The "Password Reset" notice should use the patron's homebranch's email as "from" address
    
    To test:
    1. Enable the password recovery feature.
    2. In the OPAC, click on "Forgot you password?" link and enter requested information.
    3. The email with the password reset link has the Koha Admin Email Address listed as the sender.
    4. Apply the patch.
    5. Repeat step 2. The email with the password reset link now has the the "from" address set for the patron's home branch listed as the sender.
    
    Signed-off-by: Jessica Freeman <jessicafreeman@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e21d2ac864b651375a366b12ab30b0f5b506f1d3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 24 17:51:18 2017 +0000

    Bug 18667: Show a diff view of SQL reports when converting
    
    This patch reformats the SQL conversion before-and-after view so that it
    shows a diff between the two, just as the Manage MARC Import interface
    does.
    
    This patch also makes a correction to the JavaScript which is triggered
    by the closing of the modal. In Bootstrap 3 "hidden.bs.modal" is the
    event name instead of "hidden."
    
    To test, apply the patch and find an SQL report in your reports library
    which requires updating.
    
    - Click the "Update SQL" button.
    - In the modal window, the "existing" and "updated" SQL should be shown
      side-by-side with colored highlighting of the differece.
    - Confirm that the "Update" button still works correctly.
    - Also confirm that if you open the preview of another report, the
      "Close" button hides the modal and updates the contents of the modal
      markup. Use your browser's DOM inspector to confirm that <div
      class="modal-body"> contains only <div id="loading"> and its contents.
    
    Revision moves inline style attributes to CSS block.
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f9d4aa4b067be60af423b2e2497ae370ef2484d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 21 18:57:04 2017 +0000

    Bug 18847 - Add "Save and continue" option to notice editing
    
    This patch adds an option to "Save and continue editing" when editing
    notices. The submit button is now a split button in a floating toolbar.
    The secondary action of the split button is "Save and continue editing."
    
    To test, apply the patch and go to Tools -> Notices.
    
    - Open any notice for editing. Verify that the toolbar looks correct and
      floats as it should when sections of the form are expanded and the
      page scrolls.
    - Edit a notice and click the "Save" button. Confirm that you are
      redirected to the main Notices page and that your changes were saved.
    - Edit a notice and click the "Save and continue editing" menu item.
      The page should reload with your updates in place.
    
    Signed-off-by: NickUCKohaCon17 <nicansjr@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c91eb80efb3b715fcb825f5cfd11cc6b152cbcb2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 11 15:23:17 2017 -0300

    Bug 17829: (follow-up) Move GetMember to Koha::Patron
    
    Prevent crash at the opac when no user is logged in
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd28b02202aa2b47d23cb503ba1e63844638a928
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat May 6 09:40:16 2017 +0000

    Bug 12349: Show card number in detailled suggestion pages
    
    This patch modifies the main suggestion management page to link patron
    names to their details rather than with a "mailto:" link.
    
    This patch also includes the following changes:
    
    - A fix for Bug 18154, Show card number in suggestion details view.
    - Changes for brevity to labels in the suggestion details & edit view.
    - Addition of the datepicker class to date fields in the suggestion edit
      view.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d6813e0708a54a9113cd74cc6a2558c77b5fc33
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 10 18:09:23 2017 -0300

    Bug 18577: Add FIXME about the missing FK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96b1f92ae218bc889d1490385f934deec28f630a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 23 14:11:44 2017 +0000

    Bug 18577 - Importing a batch using a framework not fully set up causes and endless loop
    
    To test:
    1 - Create a new framework - don't set it up
    2 - Stage some records for import
    3 - Manage the import, note your new framwork is in the list
    4 - Apply patch
    5 - Reload the page
    6 - Note the framework is no longer an option
    
    Followed test plan,  worked as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f7bad7039137fe1b3263cbaded1ce68f8daba04
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 12 09:18:30 2017 +0200

    Bug 18633: Remove remaining use of CGI.param in template
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a000d95a4d322607eccdbf08abc94dd78d4e5617
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Jun 28 13:05:42 2017 -0400

    Bug 18633: Remove useless use of CGI TT plugin
    
    The form is sent using AJAX so there is never a query string in
    the URL (no POST parameters either)
    
    Tested both patches together, item search behaves as before, log
    entries are gone
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94513d0739757f0c5db4b7d1040aaae40622a60e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 10 14:18:12 2017 -0300

    Bug 17829: Update CanUserManageBasket to fix tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cad748de79f6b11026e3a112c2dd3dbc6c0cfc8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 10 11:54:05 2017 -0300

    Bug 17829: (followup) Fix small rebasing errors
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b2435cb4a56c125022da6fabbff99cdc0473b66
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 5 14:05:07 2017 -0300

    Bug 17829: followup for request.pl
    
    This script is really ugly and need to be rewritten completely to
    separate the different action.
    $patron is not always defined, we need to take it into account.
    Note that this patch is mainly indentation changes.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b90ea2cb0e5e976de7ddef0151ae83d8ac578e6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 29 14:24:03 2016 +0100

    Bug 17829: Move GetMember to Koha::Patron
    
    GetMember returned a patron given a borrowernumber, cardnumber or
    userid.
    All of these 3 attributes are defined as a unique key at the DB level
    and so we can use Koha::Patrons->find to replace this subroutine.
    Additionaly GetMember set category_type and description.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06c53f21dbf6258451999358e4f4fd59d3315111
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 7 10:42:55 2017 +0200

    Bug 18260: [QA Follow-up] Always something left?
    
    Remove second Koha::Biblios->find in imageviewer.pl
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa48e204f21e72c82b557b1ac9e4ba5859b7226e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 16:26:37 2017 -0300

    Bug 18260: Handle nonexistent biblionumber in imageviewer.pl
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c73e269a13f64fe016dc90941280c9d2e9cfb02c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 13 16:43:40 2017 -0300

    Bug 18260: Koha::Biblio - Remove GetBiblio
    
    C4::Biblio::GetBiblio can be replaced with Koha Biblio->find
    
    Test plan:
    Import batch, view issue history, search for items, see the image of a
    bibliographic record, modify and delete records in a batch
    
    Followed test plan, works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c14a76049061a581c508a8abe032bbb7844fabe
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 7 09:55:54 2017 +0200

    Bug 18277: [QA Follow-up] Additional polishing
    
    Fix POD error in Biblio.pm, as reported by qa tools:
        Apparent command =cut not preceded by blank line
    
    Resolve crash in t/db_dependent/Items/DelItem.t:
      Can't call method "biblio" on an undefined value at C4/Items.pm line 669.
    
    Add find test in tools/batchMod.pl. Increase readability of map statement.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98aaa69d38eda8bf9beee3ac8dd8e5d60443eb3f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 12:42:33 2017 -0300

    Bug 18277: Remove the C4::Biblio::GetBiblionumberFromItemnumber
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed03edddbdb6846588ff42e967b44c190cdb019b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 12:39:01 2017 -0300

    Bug 18277: Remove GetBiblionumberFromItemnumber - create_analytical_rel.pl
    
    I have no idea how to test this patch, see bug 5528, or simply read the
    code.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c9aeb9b0f4449d1a25274b8fbf8dae4ec11d3bf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 12:30:53 2017 -0300

    Bug 18277: Remove GetBiblionumberFromItemnumber - linkitem
    
    Test plan:
    Enable EasyAnalyticalRecords and link an item to another one (Edit >
    link to host item)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa467223eaedc2a6a09f0796ae57463de573d832
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 12:28:13 2017 -0300

    Bug 18277: Remove GetBiblionumberFromItemnumber - Easy ones
    
    To retrieve a biblionumber from an itemnumber, we can use:
      Koha::Item->biblio->biblionumber
    
    This is only what this patchset does.
    Doing that we will be able to get rid of the
    C4::Biblio::GetBiblionumberFromItemnumber subroutine.
    
    Test plan:
    - Acquisition module: cancel a receipt
    - Export a record to CSV
    - Modify items in a batch
    
    Item's info should be correct
    
    Other changes with be checked by QA team, by reading the code.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eed1447a63b9e3d80fcb8171b5d2bfde3994e554
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 10 12:54:35 2017 -0300

    Bug 18276: (follow-up) Remove GetBiblioFromItemNumber - Easy ones
    
    - Item does not have a title attribute, it comes from biblio
    - There is an additional call to effective_itemtype done on AddReturn,
    so we need to catch both warnings
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4ded893c56a89a24dd8ed0192350044093386bf
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 7 09:04:21 2017 +0200

    Bug 18276: [QA Follow-up] Fix two new calls
    
    Found two calls in opac-issue-note.pl and svc/patron_notes.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b977e9ec241d9f5865e5882f60518e90076b5a29
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 14:53:57 2017 -0300

    Bug 18276: barcode may be nonexistent when checking out/in
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08e8a6f1ec66c93f8194bc747625f12272796129
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 30 10:58:28 2017 +0200

    Bug 18276: [QA Follow-up] Two newlines to make qa tools happy
    
    FAIL pod Apparent command =cut not preceded by blank line in file misc/cronjobs/advance_notices.pl
    FAIL pod Apparent command =cut not preceded by blank line in file C4/SIP/ILS/Item.pm
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05b0956957cffd0851ea38e3f4ba9597f9178d55
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 5 10:11:02 2017 -0300

    Bug 18276: (follow-up) Remove GetBiblioFromItemNumber - ILSDI
    
    Take into account biblio level holds
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e54375398965829f1d5c2e679b9529cb9c86311
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 20 12:49:51 2017 -0300

    Bug 18276: FIX status display for course reserves
    
    This include file is terribly wrong, it's called from different places
    that do not set the same flag.
    The status from detail and result page might be different from the one
    display on the course reserve table.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ed00ad6dc9d08542b29b8e7592e6081189482f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 12:21:16 2017 -0300

    Bug 18276: Remove the C4::Biblio::GetBiblioFromItemNumber subroutine
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6eade474ed3a84a5ba372a26ac27bf9fb4bd2299
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 16:02:38 2017 -0300

    Bug 18276: Remove GetBiblioFromItemNumber - Easy ones
    
    The subroutine C4::Biblio::GetBiblioFromItemNumber was wrong for several
    reasons:
    - badly named, we can get biblio info from a barcode
    - SELECT * from items, biblio and biblioitems
    makes things hard to follow and debug, we never know where do come from
    the value we display
    - sometimes called only for trivial information such as biblionumber,
    author or title
    
    This patchset suggests to replace it with calls to:
    - Koha::Items->find for item's info
    - $item->biblio for biblio's info
    - $item->biblio->biblioitem for biblioitem's info
    
    Test plan:
    Item's info should correctly be displayed on the following pages:
    - circulation history
    - transfer book
    - checkin
    - waiting holds
    
    QA will check the other changes reading the code, it's trivial
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1544f9a5d4a8acd47c97d7c6ac55dee8e759d3ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 16:02:31 2017 -0300

    Bug 18276: Remove GetBiblioFromItemNumber - circulation pages
    
    Test plan:
    1. Checkout items in a batch
    The information displayed should be ok (title, subtitles, author,
    itemnotes, barcode)
    2. Checkout an item using the standard checkout page
    You should correctly see the information of the item that has been
    checked out (title and author)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2e305b10b3ee0545799c2f752b4483cb3373970
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 10:41:29 2017 -0300

    Bug 18276: Remove GetBiblioFromItemNumber - ILSDI
    
    Test plan:
    Hit /cgi-bin/koha/ilsdi.pl?service=GetPatronInfo&patron_id=51&show_holds=1
    The results should be the same before and after this patch
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dadfeabc379ffeb417aad28e544fbdcc292d2755
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 10:15:30 2017 -0300

    Bug 18276: Remove GetBiblioFromItemNumber - Course reserves
    
    Values from the items, biblio and biblioitems tables are used in the template,
    so we need to pass all of them to the template, but separately.
    That way we easily see which field from which table we are displaying.
    
    Test plan:
    Create a course reserve and add items.
    Correct information must be displayed on the detail page of the course
    reserve, on staff and OPAC interface.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8d188caa9370a435690882f93cf6850e39c7fb2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 7 16:53:09 2017 -0300

    Bug 17680: Remove Koha::Upload use incorrectly added
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89c7d328fdeaea96adca3d9a179ad26695dbc292
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 17:11:24 2017 -0300

    Bug 17680: Fix conflict with bug 18651
    
    $issue is now a Koha::Checkout, not a hashref
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcfa31a8e37f88ab07c1e7ed954ab57684d0dcfa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 15 12:18:49 2017 -0300

    Bug 17680: Add few tests for AddReturn when overdue
    
    To make sure the last patch fixes the issue
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8599d5b675072977dec4a78831017cd395e96cfe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 14 10:48:29 2017 -0300

    Bug 17680: Fix regression - is_overdue must be called
    
    is_overdue must be called even if there is not dropbox date (!)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa592a9685a5f072b20ef16c3f3fbcd2fa6e36b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 25 13:53:03 2016 +0100

    Bug 17680: C4::Circulation - Remove GetItemIssue, complex calls
    
    There are a few calls to GetItemIssue where it's not as easy to make
    sure everything will be fine just replacing the calls with a
    Koha::Issues->find
    - In AddReturn the overdue flag is used (that's why this patch depends
    on bug 17689)
    - In CanBookBeRenewed, as well as the overdue flag the dates converted
    to DateTime were used. It's now our job to convert them when we need
    them.
    - Same in AddRenewal but we also call _CalculateAndUpdateFine, so we
    need to update the variables in this subroutine.
    
    Note that, prior to this patch, AddReturn returned the GetItemIssue
    hashref in the $iteminformation. Most of the time this variable is not
    used, I have found only 1 place where it's used: circ/returns.pl
    TODO: In this script we should call ->is_overdue instead of the
    DateTime->compare calls
    
    Test plan:
    All the circulation tests must pass (it's how I have caught the specific
    cases).
    Do some checkins/checkouts/renewal and focus on the due date
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff100eb77362781ce901066818baa03b4ff1f7eb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 25 14:00:34 2016 +0100

    Bug 17680: C4::Circulation - Remove GetItemIssue
    
    This patch simply removes the C4::Circulation::GetItemIssue subroutine
    
    Test plan:
    At this point, `git grep GetItemIssue` should not return any occurrence
    in the codebase
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 546379cc92b733cb29a0b70247a72c770afdad26
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 25 12:02:01 2016 +0000

    Bug 17680: C4::Circulation - Remove GetItemIssue, simple calls
    
    C4::Circulation::GetItemIssue returned all the issue and item
    informations for a given issue. Moveover it also did some date
    manipulations. Most of the time this subroutine was called, there
    additional information were useless as the caller usually just needed
    the basic issue's infos 'from the issue table).
    
    This first patch updates the simple calls, ie. the ones that just need
    the issue's infomations.
    
    Test plan:
    The following operations should success:
    - transfer a book
    - create a rule for on-site checkouts and confirm that a patron cannot
    check more items out that it's defined in the rule.
    - Renew an issue using ILSDI
    - Using SIP confirm that you are able to see your issues
    
    Followed test plan, works as expected
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9c8eea442bbe4e30be172d547e519dcd781341d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 23 10:12:44 2017 +0200

    Bug 18104: [QA Follow-up] Add a test for customized name in AE
    
    Test plan:
    Run t/db_dependent/SIP/Message.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df4a87d4a69761715791a10cbf94383af345350d
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Mar 6 12:05:31 2017 +0000

    Bug 18104 - allow SIP2 field AE (personal name ) to be customized
    
    Koha's SIP2 server sends the patron's name in the format "Firstname
    Surname" which is not very good for machine reading. We need to allow
    the format of the patron name to be customized in a manner similar to
    what is done with the DA field on bug 16755.
    
    Test Plan:
    1) Apply this patch, start or restart your SIP server
    2) Find a patron with a first and last name
    3) Send a patron information request via the sip2 cli tool
    4) Note the AE field has the format "<firstname> <surname>" ( i.e. the current behavior )
    5) Add this parameter to the login stanza you are using:
       ae_field_template="[% patron.surname %][% IF patron.firstname %], [% patron.firstname %][% END %]"
    6) Restart your SIP server
    7) Repeat step 3
    8) Note the AE field now has the format "<surname>, <firstname>"
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Benjamin Daeuber <BDaeuber@cityoffargo.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a78bb5ba1c51d995a597cb0ac7e5e9f95345ed3e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 29 14:22:04 2016 +0000

    Bug 16755 - allow SIP2 field DA ( hold patron name ) to be customized
    
    The SIP2 DA field that Koha transmits is an odd and arbitrary format
    that some SIP2 clients cannot handle. It would be best if this
    format were customizable on a per-login basis in the same manner as
    the AV field.
    
    Test Plan:
    1) Find an item that is checked out with holds
    2) Return the item via SIP2 ( using the SIP2 cli emulator )
    3) Note the value of the DA field
    4) Apply this patch, restart your SIP2 server
    5) Repeat step 2
    6) Note the DA field value has not changed
    7) Add this parameter to the login stanza you are using:
       da_field_template="[% patron.surname %][% IF patron.firstname %], [% patron.firstname %][% END %]"
    8) Restart the SIP2 server again
    9) Repeat step 2
    10) Note the DA field returned is now in the format "$surname, $firstname"
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Benjamin Daeuber <BDaeuber@cityoffargo.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29a1f0fd9cb98473157e72b5782cb8bbd6623a51
Author: Marc Véron <veron@veron.ch>
Date:   Fri Jun 23 18:48:00 2017 +0200

    Bug 18465: (followup) Fix issue with patron lists an do not use clone
    
    This followup fixes duplex printing with patron lists.
    
    Additionaly, it uses simple copy instead of clone and removes a
    superfluous line, see comments #15 - #17
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65c32eee8eef7102544a579a2a68c7ebb4a6b0bd
Author: Marc Véron <veron@veron.ch>
Date:   Thu Apr 20 20:43:11 2017 +0200

    Bug 18465 - Patron card creator: Print on duplex card printer
    
    Card printers with duplex functionality need as input a PDF file where odd pages contain
    the front side and even pages the back side of the cards.
    
    This patch adds such functionality.
    
    To prepare test:
    - In Patron card creator > Templates, prepare a 1 up template (1 column / 1 row) that
      fits to a single card. Give it a name like 'Duplex card template'
      (Attention, Card with and Card height seem to have wrong labels, that will go
      to a separate bug).
    - In Patron card creator > Layouts create a layout for the front side and one for
      the back side. Give them names to easily remember (Card front layout, Card back layout)
    - Go to Patron card creator > Batches and test both layouts together with the
      1 up template. Save and keepp both test files as reference.
    
    To test:
    - Apply patch. Restart memcached and plack.
    - Go to Patron card creator > Batches
    - Click "Export" for a batch
    - In the following screen, note the new field "Select a layout for the back side"
      with a hint what it is used for
    - Leave it on 'Back side layout not used', export and compare output with test ooutput
      from preparation. It should be the same
    - Select the layout you prepared for the back side.
    - Export - this file should contain 2 PDF pages per patron, one first with the
      front side, second with the back side.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e29163af4cde7ce33060716091726e6fa2eef65e
Author: David Kuhn <techservspec@gmail.com>
Date:   Tue Jun 6 09:38:07 2017 -0700

    Bug 18616 - The "Add forgot password link to OPAC" should allow patrons to use their library card number in addition to username
    
    Allow patrons to enter either their library card number or user name in the "Log in" box for password recovery.
    
    Most patrons at our library use their card number to log in and are unaware of what their userid is. However there are some who have set a
    
    customized userid and would prefer to use that. This patch would allow either to be entered for password recovery.
    
    To test:
    1. Enable the password recovery feature.
    2. In the OPAC, click on "Forgot you password?" link and enter a valid library card number.
    3. The error message "No account found with the provided information" appears.
    4. Apply the patch.
    5. Repeat step 2. The recovery email is now sent.
    
    Note: Moved patch from 16711 back here and re-tested.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3829020c2664ec531354f78f0c04d00f5dd6795d
Author: Marc Véron <veron@veron.ch>
Date:   Sun May 21 18:28:48 2017 +0200

    Bug 16711: OPAC Password recovery: Handling if multiple accounts have the same mail address
    
    To reproduce:
    - Create 3 Accounts, login names are test01, test02, test03, Email is the same
    for all.
    - Go to OPAC -> Password recovery and indicate E-Mail only
    - You will get an email for only one of the accounts above.
    
    To test:
    - Apply patch, restart memcached and plack
    - Go to db, delete from borrower_password_recovery;
    - Try steps above to reproduce. You will get an error message:
        Account identification with this email address only is ambiguous.
        Please use the field 'Login' as well.
    - Verify that other cases work as before (provide valid / invalid login only,
      provide valid email for an existing account, provide unknown email, provide
      both login and email with all combinations of valid / invalid)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Bug 16711: (QA-followup) Use count directly
    
    See comment # 13
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3bf4fc8bb821456305d587a8d49fe39b07abd06
Author: Lee Jamison <ldjamison@marywood.edu>
Date:   Thu Jun 22 16:42:15 2017 +0000

    Bug 18848: borrowers.lastseen comment typo
    
    Typo in comment for the lastseen column in the borrowers table.
    
    To test:
    1. Verify lastseen column displays "last time a patron has been seed"
    2. Apply patch
    3. Verify lastseen column changed to "last time a patron has been seen"
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a0ecda6c4ff368b9ff7a18593d7bdf4fc07e541
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue Jun 20 16:35:35 2017 +0100

    Bug 18830: Fix phrasing of screen message
    
    Verb should be plural in this message
    
    Signed-off-by: Israelex A Veleña for KohaCon17 <israelex19@gmail.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce176fd170227456fa725e5f1f2f6b1b04fd044d
Author: Marc Véron <veron@veron.ch>
Date:   Mon Jun 19 21:23:54 2017 +0200

    Bug 18824: Remove stray i from matching-rules.tt
    
    The file
    koha-tmpl/intranet-tmpl/prog/en/modules/admin/matching-rules.tt
    contains a stray i that should not be there.
    This patch removes it.
    
    Signed-off-by: Chris Kirby <chris.kirby@ilsleypubliclibrary.org>
    Applied patch.
    Checked line 516. Stray i had been removed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23b84c0b6532d9c42894b648891d835e7624db49
Author: Lee Jamison <ldjamison@marywood.edu>
Date:   Thu Jun 22 16:42:15 2017 +0000

    Bug 18848: borrowers.lastseen comment typo
    
    Typo in comment for the lastseen column in the borrowers table.
    
    To test:
    1. Verify lastseen column displays "last time a patron has been seed"
    2. Apply patch
    3. Verify lastseen column changed to "last time a patron has been seen"
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e48a5fb560123bac31e9a692026601ddd320f966
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jul 3 09:31:52 2017 +0200

    Bug 18881: [QA Follow-up] Remove even more
    
    Removing the commented section from the template: If it does not work, it should not be here.
    When it works again, put it back in.
    
    Since @itemtypesloop is not used, remove it from the script too.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f40c093c19e21c6a8aa7a41d4e51fc4e3fc1d8e9
Author: Marc Véron <veron@veron.ch>
Date:   Fri Jun 30 20:20:44 2017 +0200

    Bug 18881: Remove dead code from view_holdsqueue.pl
    
    Aleisha spotted the typo in $itemtypes and proposed a correction on bug 18859.
    The description was not even used. Template calls GetDescription.
    
    To test:
    Verify that viewing the holds queue still works as expected.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b94b16f67963b03fd17170d2c2f2efa581c12c0f
Author: Rodrigo Santellan <rsantellan@gmail.com>
Date:   Wed Jun 21 15:40:43 2017 -0300

    Bug 14572 - insert_single_holiday() forces a value on an AUTO_INCREMENT column, during an INSERT
    
    Removing all the id from the columns on the inserts and removing the
    parameter '' of the values for the id.
    
    Test plan:
    1) Go to tools -> calendar
    2) Add a Holiday only on this day.
    3) Add a Holiday repeated every same day of the week.
    4) Add a Holiday repeated yearly on the same date.
    5) Add a Holidays on a range.
    6) Add a Holidays repeated yearly on a range.
    7) You should have the five calendars displayed.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebb887e5c93c96c6fc51d95b76de6a221ba4463e
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Thu Jun 8 12:59:55 2017 +0100

    Bug 18755: Allow empty passwords in Patron Info to return OK
    
    With this patch a parameter 'allow_empty_passwords="1" can be added to a
    login in the SIP configuration file to allow the behaviour as was normal
    before the patch for bug 16610 was applied. Some sip clients rely on
    this behaviour sending an empty password field when they wish to
    validate to user but do not have the password.
    If a password is supplied it will be validated
    
    A test has been added to Message.t to confirm this behaviour
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d222da0602ba96f08cc6c026f39451b0aa7de01e
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jun 9 13:01:14 2017 -0400

    Bug 18771: CGI.pm: Subroutine multi_param redefined
    
    The commands in the test plan are examples, and may need varying
    depending on your installation. This was created as a result
    of attempting to clean the installation process up. However,
    I believe the redefine might exist normally too. I just didn't
    check. This is tested on a Debian 8 box sudo apt-get update'd
    fully.
    
    TEST PLAN
    ---------
    empty error log
    $ echo > ~/koha-dev/var/log/koha-error_log
    
    drop and recreate and empty db
    > drop database koha_library;
    > create database koha_library;
    > quit
    
    run the web installer, but DO NOT LOG IN!
    *opening chrome to Staff Client URL*
    
    check the error log
    $ less ~/koha-dev/var/log/koha-error_log
    ...
    [Fri Jun 09 13:08:52.793627 2017] [cgi:error] [pid 5802] [client 192.168.71.101:58169] AH01215: [Fri Jun  9 13:08:52 2017] CGI.pm: Subroutine multi_param redefined at /usr/share/perl5/CGI.pm line 419.
    ...
    
    apply patch
    
    empty error log
    $ echo > ~/koha-dev/var/log/koha-error_log
    
    refresh the installation login page
    
    recheck the error log
    $ less ~/koha-dev/var/log/koha-error_log
    
    notice no reference to "Subroutine multi_param redefined"
    
    run koha qa test tools
    
    Notice that it is just a require CGI; and comment added.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d98089ec701bc96893e68408ce2dedad36f7235
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jun 14 15:37:55 2017 +0200

    Bug 18634: Handle colliding translation for preference sections
    
    Problem on this report was caused by translating the tabs Privacy
    and Payments by the same string. This caused overwriting a hash entry.
    
    This patch tests if the key already exists and if so, it merges the
    entries instead of overwriting the old contents.
    
    Test plan:
    [1] Make sure that e.g. Privacy and Payments translate to e.g Vie privee.
    [2] Run translate install fr-CA (or the language you altered)
    [3] Without this patch you should loose preferences from either Privacy or
        Payments. With this patch, they should be merged.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested with fr-CA.
    
    Signed-off-by: Blou <philippe.blouin@inlibro.com>
    Reset the .po files, reproduced the problem.  Applied the patch and suddenly 'paypal' appeared.
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83e4adf0abff0e81febf4bcee473ce9c599e8311
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 6 14:28:18 2017 -0300

    Bug 18801: DBRev 17.05.00.003

commit aa03981e79a10bd5a032f13533d93f0b87bd37f7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 15 15:47:21 2017 +0200

    Bug 18801: [Follow-up] Dbrev to repair bad auth type codes
    
    Test plan
    Run updatedatabase.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1112236f908626b273f7dc950807ce2e085db2d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 14 09:19:10 2017 -0400

    Bug 18801 - Merging authorities has an invalid 'Default' type in the merge framework selector
    
    To test:
    1 - Find two authorities and start a merge
    2 - Leave the dropdown at 'Default'
    3 - Merge records and note you get an error and can no longer view the
    new record
    4 - Check DB value of record authtypecode = 'Default'
    5 - Apply patch
    6 - Find two other authorities
    7 - Merge leaving selector at default
    8 - Success
    9 - Check DB value of record authtypecode = ''
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 540d488e980b2521b424bed0f0267002c6dbd03e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jul 3 09:42:21 2017 +0000

    Bug 18434 - Followup fix tests for sorting and factes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 241be8ff1ae24fff6165c8d6877945637467ee9a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 16 10:01:12 2017 -0400

    Bug 18434 - Followup - same changes for sort and facet fields
    
    To test:
    1 - Index some stuff with multiple fields defined for sorting
      i.e. Authorites - make heading sortable - default is 110a and 111a for
      heading - a record with 111a empty will make the sort field empty
    2 - view the record:
    curl http://localhost:9200/koha_kohadev_authorities/data/30?pretty=true
    3 - Note the blank field
    4 - Apply patch
    5 - Reindex
    6 - Fields should be correctly populated
    
    Unit tests to follow (once I have the originals working for all)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b5529c3abca87afb4f66f5bc7d3aa0fe005c1aa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 15 11:46:00 2017 -0300

    Bug 18434: (QA followup) Move _convert_marc_to_json tests into Indexer.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9eb88f588bd13ddf25135c26acd905abe71f326a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 14 10:03:11 2017 -0400

    Bug 18434: Elasticsearch indexing broken with newer catmandu version
    
    To test:
    1 - Make sure you have latest koha deps, catmandu versions should be:
        libcatmandu-marc-perl   1.09-1~kohadev1
        libcatmandu-perl        1.0304-2~kohadev1
    2 - Reindex elastic
    3 - Try searching and likely notice odd results
    4 - Try:
    curl -XGET
    'http://localhost:9200/koha_kohadev_biblios/data/792?pretty=true'
    with a known biblionumber and notice some null fields
    5 - Apply patch
    6 - Reindex
    7 - Note fields are populated and search works as expected
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d19a34529bc313922a085a99288e55d8634c8b6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 12 15:39:25 2017 -0300

    Bug 18434: Add tests for K:SE:E::get_fixer_rules
    
    This patch tries to introduce exhaustive tests for this class method.
    I didn't try to provide a regression test for the current bug per-se, but
    cover the current method behaviour as much as I could.
    
    (kidclamp) I added a quick test of _convert_marc_to_json to use the mocking here
    and illuminate what the change does, before the patches this should
    fail (fields are indexed in place of one another), after it should succeed (new indexed fields are appended).
    
    A minor bug is highlighted by this new tests, I'll provide a followup for it.
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ de kohaclone
     k$ prove t/db_dependent/Koha_Elasticsearch.t
    => FAIL: The returned fixer rules are not the expected ones
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b15c064405ff4a48cb3f5803dd6bd16d49d5b9b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jun 14 12:33:25 2017 +0200

    Bug 18756 - add Unit Test
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c09adbfc87b950b9f08aebede131ba694997290
Author: Christophe Croullebois <christophe.croullebois@biblibre.com>
Date:   Thu Jun 8 13:17:56 2017 +0000

    Bug 18756: Users can view aq.baskets even if they are not allowed
    
    Due to bad use of grep syntax if there is one or more Basket Users the result of grep is not equal to 0 and the borrower is allowed.
    
    Test plan :
    1- select system preference 'AcqViewBaskets' on 'user'
    2- create 2 borrowers (A, B) with only permissions on acquisition :
    group_manage
    order_manage
    order_receive
    staff
    3- login with A and create a basket
    4- add a basquet manager other than B
    5- relog with account B
    6- you can see the basket
    
    Apply the patch.
    The basket is no longer visible.
    1- relog with A
    2- add basquet manager B
    3- relog with B
    5- you must see the basket
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a81947782bb884feccd5401499f1a6e8f469b0b0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 5 20:03:24 2017 -0300

    Bug 18870: Force scalar context for Koha::Club methods
    
    These 2 methods are called from the template in list context.
    However since bug 18539 Koha::Objects->find can no longer be called in
    list context.
    Forcing the context to scalar fixes the problem and should not
    introduced side-effects.
    
    Test plan:
    - Create a club template
    - Create a club using this template
    => Without this patch you should no longer get the following error:
    Template process failed: undef error - Cannot use "->find" in list
    context at /home/vagrant/kohaclone/Koha/Club.pm line 51.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 520d1acac832fe299408eb393daaa5e434e88927
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 6 13:58:05 2017 -0300

    Bug 18228: DBRev 17.05.00.002
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60e55c857c0e59693eaea138fbcc025f0de23960
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jun 26 15:25:19 2017 -0300

    Bug 17554: (followup) Shibboleth check should use ->find too
    
    There was a remaining use of C4::Members::GetBorrowersWithEmail in Auth.pm.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 69ddc094345e995aabf0b0be79813c2019419caa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 4 14:43:21 2016 +0000

    Bug 17554: Koha::Patrons - Remove GetBorrowersWithEmail
    
    C4::Members::GetBorrowersWithEmail can be easily replaced with
    Koha::Patrons->search({ email => $email });
    
    Test plan:
    Confirm that you are still able to use PKI authentication
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit adff45cd8de804cf64f73ff3fec2fe0151a9e6b5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 30 12:02:00 2017 +0200

    Bug 17738: [QA Follow-up] Remove second find of same patron
    
    We can just use the $patron from line 77 here.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 57ebe9aefcfc77dbc79b671eb98e1ee997d07d4a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 17 09:00:33 2017 -0300

    Bug 17738: Remove warning about redeclaration of $patron
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit e5929123b9d735d8c4b14c56c134fb9f1c37b3ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 7 14:43:43 2016 +0100

    Bug 17738: Remove C4::Reserves::GetReservesFromBorrowernumber
    
    At this point, there should not be any occurrences of
    GetReservesFromBorrowernumber anymore.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit bbe22168873220d8db5ba9160df20d24f99cdf55
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 7 14:42:48 2016 +0100

    Bug 17738: Replace GetReservesFromBorrowernumber with Koha::Patron->get_holds
    
    This patch replace the different calls to GetReservesFromBorrowernumber
    with a calls to Koha::Patron->get_holds.
    In some places we need to get a restricted set of holds, that's why we
    process a search on this holds returned by ->get_holds (on the found
    status for instance).
    
    The changes are quite trivial and reading the diff should be enough to
    catch bugs.
    
    Test plan:
    I would suggest to test this patch with patches from bug 17736 and bug 17737,
    to place different kind of holds (biblio and item level, future and
    past).
    Then do a whole workflow to detect bug, view a record, delete record,
    order, place a hold on an item which has been ordered, etc.
    The hold's informations should always be the same without or without
    these patches.
    
    Tested both patches together, works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit ca0bde1e7e168982efc8917c5836aeedea183621
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 23 10:43:16 2017 +0200

    Bug 17843: [QA Follow-up] Some polishing
    
    Resolve warning from members/summary-print.pl:
        "my" variable $itemtype masks earlier declaration in same scope
    
    Test if find returns a Koha object in GetDescription.
    Test if find returns a Koha object too in shelves.pl. While testing, I had
    a crash on a biblioitem with itemtype NULL (bad record, but these things
    tend to happen somehow.)
    Can't call method "imageurl" on an undefined value at virtualshelves/shelves.pl line 253.
    Same for opac/opac-shelves.pl.
    
    Note: Did not add tests everywhere but generally, I have the impression that
    we do not sufficiently test on the results of Koha::Object->find. Mostly we
    just assume that it will find a record. Several reports include fixes to
    resolve that wrong assumption.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit a2be532dc244ca2e7073c4dd7693011d6aca679e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 4 10:32:26 2017 +0100

    Bug 17843: Remove C4::Koha::getitemtypeinfo
    
    At this point there should not be any calls to this subroutine.
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 091d6c513bcbee224ff06477e79be48cea7fe825
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 4 10:30:47 2017 +0100

    Bug 17843: Replace C4::Koha::getitemtypeinfo with Koha::ItemTypes
    
    The C4::Koha::getitemtypeinfo subroutine did the almost same job as
    GetItemTypes. On top of that it returned the imageurl value processed by
    C4::Koha::getitemtypeimagelocation.
    This value is only used from the 2 [opac-]shelves.pl scripts. Then it's
    better not retrieve it only when we need it.
    
    Test plan:
    Play with the different scripts touched by this patch and focus on item
    types. The same description as prior to this patch must be displayed.
    Note that sometimes it is not the translated description which is
    displayed, but that should be fixed on another bug report. Indeed we do
    not expect this patch to change any behaviors.
    
    Signed-off-by: Lari Taskula <lari.taskula@jns.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit c69e02c4419a2d4a7ca31af6441081cadd4e51b3
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 12 12:28:31 2017 +0200

    Bug 18782: Remove unused C4::Serials::getsupplierbyserialid
    
    TEST PLAN
    ----------
    git grep -i getsupplierby
    -- only the code removed and the test tweaked
    git bz apply 18782
    sudo koha-shell -c bash kohadev
    prove -v t/db_dependent/Serials.t
    qa -v 2 c 1
    exit
    -- sign off
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 8f54bc6ee4f75cebb0f91a023d1e7959bc3ab503
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jul 3 17:01:02 2017 +0000

    Bug 18228: QA Followup - use gender neutral language in new tests

commit e14f761754b551096dbc5a1f33bb66cb493f1f27
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 15 10:44:47 2017 -0300

    Bug 18228: Add missing comma in kohastructure.sql
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit ad2528a1027dcc8ce55d76d76500040feecac06c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 8 16:28:59 2017 +0100

    Bug 18228: Adjust Virtualshelves.t
    
    Test plan:
    Run t/db_dependent/Virtualshelves.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Eric Gosselin <eric.gosselin@inlibro.com>
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit a58aca056b004dcc9c751cf29ef4e1e860b6baef
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 8 15:31:25 2017 +0100

    Bug 18228: Implement the new columns in code
    
    The two new columns as mentioned in the commit message of the table
    revision must be used in the codebase now.
    
    Highlighting some changes in Koha::VirtualShel[f|ves]:
    [1] Additional methods is_public and is_private.
    [2] Method add_biblio did not check permissions. Does now. No impact on the
        interface, but one call in the unit test was affected.
    [3] Method remove_biblios is signficantly simplified. Removed a FIXME.
    [4] Method can_biblios_be_removed now redirects to can_biblios_be_added.
        A followup report may deal with unifying those routines.
    [5] Condition in get_some_shelves changed.
    [6] The reference to allow_add in get_shelves_containing_record can simply
        be removed.
    
    opac-shelves.pl and shelves.pl now pass the default setting of Owner only
    to the template.
    Templates shelves.tt and opac-shelves.tt now include the new permission
    field with three choices as mentioned in the table revision patch.
    
    opac-addbybiblionumber.pl and addbybiblionumber now need a check on
    allow_change_from_owner; search conditions slightly adjusted to the new
    permission scheme.
    
    Test plan:
    When we refer to visibility in the test plan, please check the Add to-combo
    on opac search results and staff results. And check opac-addbybiblionumber
    by clicking Save to Lists from opac results.
    The step 'Check delete' means: open the list in opac and check if you see
    the Delete button below the entries (only check, do not delete).
    
    [ 1] Create private list I01 (perm=Owner)
    [ 2] Check visibility: Seen.
    [ 3] Add a book. (Change by owner should be allowed.)
    [ 4] Check delete: Yes.
    [ 5] Edit list I01, set perm=Nobody
    [ 6] Check visibility: Not seen.
    [ 7] Check delete: No.
    [ 8] Share list I01 with another patron.
    [ 9] Check visibility for the other patron: Not seen.
    [10] Check delete for the other patron: No.
    [11] Change permission of list I01 to Anyone (by owner).
    [12] Check visibility for the other patron: Seen.
    [13] Let other patron add a book (change is allowed).
    [14] Let owner delete the same book again (change allowed).
    
    [15] Create public list U01 (perm=Owner)
    [16] Check visibility: Seen.
    [17] Add a book. (Change by owner should be allowed.)
    [18] Login as other user. Check visibility: Not seen. Check delete: No.
    [19] Change permission of U01 to Nobody (by owner)
    [20] As owner: Check visibility: Not seen. Check delete: No.
    [21] As other user: Check visibility: Not seen. Check delete: No.
    [22] Create public list U02 (perm=Anyone)
    [23] Add a book by owner.
    [24] Delete the same book by other user. Add another book.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 1ef053564fdd8a037e9c276b3f2a2cdf58a2f06d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 8 14:19:34 2017 +0100

    Bug 18228: DBIx schema changes for Virtualshelve.pm
    
    No test plan.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit 4fe1724e306e9063243d8bda0f71d9aad091a154
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 8 14:10:32 2017 +0100

    Bug 18228: Table revision of virtualshelves
    
    In order to make the permissions easier, we will replace the columns
    allow_add, allow_delete_own and allow_delete_other by two new columns
    allow_change_from_owner and allow_change_from_others.
    
    The distinction between adding or deleting an entry is no longer made.
    If you have change permission, you can do both. Also deleting an entry
    does no longer depend on who added the entry.
    Formerly, the owner could always add entries. It is now possible to
    make a list readonly.
    
    We will not use the combination of owner=no and other=yes. This will
    leave us three possibilities:
    [1] owner=no, other=no: The list is read-only. No one can change
        contents of the list. Naturally, the owner can edit permissions.
    [2] owner=yes, other=no: Only the owner can change contents.
    [3] owner=yes, other=yes: Anyone seeing the list can change contents.
        This especially applies to shared lists and public lists.
    
    The two database columns will be presented in the interface as one
    permission field offering the three abovementioned options.
    
    Test plan:
    [1] Run the db rev.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>

commit b494837c8d17a29936e2c2bcc067120c26876855
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 22 08:55:16 2017 +0200

    Bug 18214: Add check for shared or public list
    
    Following the idea behind bug 10865, we are only showing the permissions
    when the list is shared or public.
    Adding a simple test in opac-shelves here.
    
    Note 1: Since the owner can always add or delete entries, the permissions
    will not be relevant anymore for a strictly private list.
    
    Note 2: Staff view always shows the permissions. This could have been
    changed here too, but that change is far less urgent (bug 10865 did not
    touch staff view and bug 18228 will rearrange permissions anyway).
    
    Test plan:
    [1] Verify on OPAC that you see the permissions for a private list with
        shares or a public list. And you do not see them for a private list
        without shares.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 3d2eddaf3da3e090d00b4e5823f8f70a70c06ea1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 6 09:44:48 2017 +0100

    Bug 18214: Cannot edit list permissions of a private list
    
    If you have disabled the pref OpacAllowPublicListCreation, your users are
    not able to edit the list permissions for private/shared lists.
    For a private list they may only be theoretically relevant, but for a shared
    list they are relevant.
    Since we do not always know the history of a list (has it been public or
    shared, does it contains entries from other users) and therefore permissions
    are even relevant for a currently private list, we should just allow editing
    these permissions.
    
    Test plan:
    [1] Do not yet apply this patch.
    [2] Disable OpacAllowPublicListCreation.
    [3] Create a private list in OPAC. Edit the list. Verify that you do not
        see the permission combo boxes.
    [4] Apply this patch. Edit the list again. Do they appear now?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Works as advertised.

commit 905572910b3af03d86fdbd3e52c72614f41c978b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 21 14:14:09 2017 -0300

    Bug 18651: Do no LOCK/UNLOCK the table
    
    We cannot LOCK the old_issues table here, other tables are accessed and DBIx::Class rename it with "me":
    DBD::mysql::st execute failed: Table 'me' was not locked with LOCK
    TABLES [for Statement "SELECT `me`.`issue_id`, `me`.`borrowernumber`,
    `me`.`itemnumber`, `me`.`date_due`, `me`.`branchcode`,
    `me`.`returndate`, `me`.`lastreneweddate`, `me`.`renewals`,
    `me`.`auto_renew`, `me`.`auto_renew_error`, `me`.`timestamp`,
    `me`.`issuedate`, `me`.`onsite_checkout`, `me`.`note`, `me`.`notedate`
    FROM `old_issues` `me` WHERE ( `me`.`issue_id` = ? )" with ParamValues:
    0='2'] at /usr/share/perl5/DBIx/Class/Storage/DBI.pm line 1832.
    
    Consequence: We could have a checkin refused if there is a race, but
    this is the simplest and safest way to fix it.

commit 2702b4688e31e62fb6851b7979dc56011d38ce89
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 21 12:41:22 2017 -0300

    Update mailmap - Jonathan Druart
    
    I do not longer work at biblibre

commit 053fbaf9267cce79ba80d23389b26f46a91111f8
Author: Marc Véron <veron@veron.ch>
Date:   Wed Jun 14 11:10:56 2017 +0200

    Bug 18800: Patron card images: Add some more explanation to upload page and fix small translatabiity issue
    
    The file
    koha-tmpl/intranet-tmpl/prog/en/modules/help/patroncards/image-manage.tt
    has a small translatability issue (sentence splitting by html tags).
    
    This patch fixes it and adds a little bit more explanation about
    uploading, using and replacing such images.
    
    To test:
    - Verify that text changes make sense
    - Apply patch
    - Go to Home > Tools > Patron card creator > Images and verify
      that the page displays properly
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58f5a73f41b73361821b847e55a663cc0801c998
Author: Marc Véron <veron@veron.ch>
Date:   Fri May 26 21:08:27 2017 +0200

    Bug 18684 - Get rid of %%] in translation for currency.tt
    
    File add koha-tmpl/intranet-tmpl/prog/en/modules/admin/currency.tt exposes
    parts of template directives due to html tags inide directives. Fix it using
    the HtmlTags filter.
    
    To verify:
    - Create a translation for a language 'aa-AA
    - po file aa-AA-staff-prog.po / translate.koha-community.org for 17.05 contains a line
      '%%]'%sCurrencies %s
    To test:
    - Apply patch on top of Bug 18665
    - Recreate translation
    - Verify that line above is gone
    - Verify that in staff client currencies administration wors as before
    
    Followed test plan and it worked as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>
    
    Bug 18684: (followup) Move 2 closing h3 tags to end of previous lines
    
    See comment #4
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05b308403152d2287bc0b5d191a60ea88db4ac11
Author: Marc Véron <veron@veron.ch>
Date:   Thu May 25 21:52:09 2017 +0200

    Bug 18665: Add test for HtmlTags.pm
    
    This patch adds tests for the tt filter HtmlTags.pm
    
    To test: prove -v t/HtmlTags.t should pass
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c7761fe89d05fc7114f426ecffdf9635ba1fe97
Author: Marc Véron <veron@veron.ch>
Date:   Wed May 24 16:06:31 2017 +0200

    Bug 18665 - Translatability: Add tt filter to allow html tags inside tt directives
    
    HTML tags inside template toolkit directives are not allowed because of translation issues.
    Add a filter that handles HTML tags.
    
    Note you need to write quotes ' around the text you want displayed as a
    heading
    
    To test:
    - Apply patch
    - Add [% USE HtmlTags %] to the top of a tt file
    - Add something like [% 'My nice title' | $HtmlTags tag="h1" %] to the tt file
    - Verify that in output 'My nice title' has h1 tags
    - Change template directive to something like
      [% 'My nice title' | $HtmlTags tag="h1" attributes='title="This is a nice title attribute"' %]
    - Verify that title attribute displays in output (source code or tooltip on 'My nice title')
    
    Notes: - Tests are planned for a second patch
           - Update for Wiki coding guidelines
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 939eadc5d987429db04887623c3f260ee02b86d2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 21 10:59:57 2017 -0300

    Bug 18835: Fix SQL syntax error in overdue_notices.pl
    
    Caused by bug 17952, an extra / is in the middle of the query.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66f435149a8f2e116070ed28c34bdd5cd627a30f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 21 11:05:59 2017 -0300

    Bug 18651: Fix tests if no circ rule exist
    
    The following test is failing on Jenkins:
     # Subtest: Handle ids duplication
        1..4
        ok 1 - No account lines should exist on old issue_id
        not ok 2 - Two account lines should exist on new issue_id
        ok 3 - AddReturn should return the issue with the new issue_id
        ok 4 - If an item is checked-in, it should be moved to old_issues even if the issue_id already existed in the table
    not ok 4 - Handle ids duplication
    
    When no circ rule exist
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee7969d3461e6ce08b4fbfd982c90f263f19f693
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jun 20 15:03:35 2017 +0200

    Bug 18651: [QA Follow-up] Fix the MAX(issue_id) calculation
    
    Found this by inserting the same issue_id in old_issues before checkin:
    The call to ->search( )->get_column is in scalar context and will
    return the number of results, i.e. always 1.
    If you have an issue_id 2 in old_issues, it will crash:
        DBIx::Class::Storage::DBI::_dbh_execute(): Duplicate entry '2' for key 'PRIMARY'
    
    The fix is fairly simple: Put get_column in list context and pick the first
    array entry.
    NOTE: Using DBIx's get_column()->max here might look simpler here.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 4906d58f7c507613c9ad20c4524afd278fca467c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jun 20 14:19:12 2017 +0200

    Bug 18651: [QA Follow-up] Remove unused variable
    
    Variable $original_issue_id is not used. The id is retrieved later from
    $issue when updating accountlines.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 26957fea0d438046aa5d08c117099f5d2d57406d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 15 20:25:18 2017 -0300

    Bug 18651: Limit the life span of the LOCK
    
    We only need the table to be locked for the fetch, increment, store sequence
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 59fcad685e8143bfaeb7a148f248cc7b7f80b742
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 24 12:24:53 2017 -0300

    Bug 18651: Use a READ and WRITE LOCK
    
    For more info, see:
      commit be156d9ad9e5bcfadab34d44f90e04fd61e256ad
        Bug 15854: Use a READ and WRITE LOCK on message_queue
    and
      commit b40456f7dd4b8a988f9c6a5718452936101cb8ff
        Bug 18364: Do not LOCK/UNLOCK tables from tests
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 79cb157b3b4bee9f1c079937bd13019c7b7f650f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 23 10:27:31 2017 -0300

    Bug 18651: Copy the row before modify the id
    
    If the "max(issue_id) from old_issue + 1" already exists in issues, the
    move fails.
    
    For instance we have
    1, 2, 3, 4 in issues
    
    checkin 4
    1, 2, 3 in issues (AI=5)
    4 in old_issues
    
    Restart mysql => AI is reset to MAX(issue_id) => 4
    
    checkout a new one
    1, 2, 3, 4 in issues (AI=5)
    4 in old_issues
    
    checkin 4 (will get id 5 in old_issues)
    1, 2, 3 in issues (AI=5)
    4, 5 in old_issues
    
    => This works with and without this patch
    
    Now we have
    1, 2, 3 in issues (AI=5)
    4, 5 in old_issues
    
    Restart mysql => AI is reset to MAX(issue_id) => 4
    
    checkout 2 new ones
    1, 2, 3, 4, 5 in issues (AI=7)
    4, 5 in old_issues
    
    checkin 4 (4 becomes 6 in old_issues)
    1, 2, 3, 5 in issues (AI=6)
    4, 5, 6 in old_issues
    
    => This did not work without with patch
    The update of the issue_id was made before the move (so in the issues
    table), the PK did not allow it
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit be3d39c8b1e2671790ee5cb5cc7295eec3774a35
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 22 14:30:48 2017 -0300

    Bug 18651: Update accountlines.issue_id is the issue_id has been changed during the move
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit acb7a717482c2a47f7da6a0d883784415bf3b8d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 22 14:26:25 2017 -0300

    Bug 18651: Do not charge if the checkin failed
    
    2. If the move fails for whatever reason (see
    https://lists.katipo.co.nz/pipermail/koha/2017-May/048045.html for an
    example), fines can be charged. It should not
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit c3c9d61570b61ec49d508261f0500463a73925d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 22 12:02:20 2017 -0300

    Bug 18651: Update issue_id in AddReturn
    
    1. AddReturn returns a $issue hashref with the old issue_id value
    => At first glance it does not affect anything, but would be good to fix
    it for future uses.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 7bcc226facc17eca9bc94cbab9535b2677462446
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 11 16:45:42 2017 +0000

    Bug 18582 - Hide empty rows in detailed suggestion view
    
    This patch adds a check for the existence of various template variables
    before showing the row containing that data. This will prevent the
    display of rows containing labels but no data in the suggestions
    detailed view.
    
    To test, apply the patch and go to Acquisitions -> Suggestions.
    
    View the detail page of various suggestions and confirm that only fields
    with data are displaying.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e9701c36a6743eff72b8127de2cc79ff463013b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed May 31 16:19:35 2017 +0200

    Bug 18697: Final polishing
    
    GetFictiveIssueNumber:
    Returns undef instead of 0 for irregular frequencies. Also added to POD.
    Removed unused variable $wkno.
    Adding a return makes the if(unit) unneeded.
    Replaced (a+b)/b by 1+a/b.
    
    _delta_units:
    Added a comment about its parameters.
    
    GetFictiveIssueNumber.t:
    Adjusted the tests for irregular frequencies accordingly.
    
    Test plan:
    [1] Run t/db_dependent/Serials/GetFictiveIssueNumber.t
    [2] Run t/db_dependent/Serials/GetNextDate.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8eae9660839750d95c53f6cc2a4287a6196f0cc6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed May 31 15:20:40 2017 +0200

    Bug 18697: Adjusting unit tests for dayly serial frequencies
    
    No changes were needed for GetNextDate.t.
    In GetFictiveIssueNumber.t we add a subtest for daily frequencies.
    
    Test plan:
    [1] Run t/db_dependent/Serials/GetFictiveIssueNumber.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f65ca90b0f3d12a22c02918a37131b0c1ff8bd5e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 30 16:44:46 2017 +0200

    Bug 18697: Fix date calculation for dayly frequencies in Serials
    
    The changes in _get_next_date_day are actually only cosmetic. The sub
    now reads exactly the same as its counterparts for other units, but
    the results are exactly the same as before.
    
    In GetFictiveIssueNumber we now call _delta_units for each type of unit.
    The two Delta_Days calls are moved to _delta_units. Note that this also
    is a cosmetic change; results should be exactly the same.
    
    Test plan:
    [1] Edit a subscription. Test predication pattern for some daily freq.
    [2] Run t/db_dependent/GetNextDate.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e25f4670f36e53db44931cbbcfb3c5df2125c71a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 30 15:56:22 2017 +0200

    Bug 18697: Adjusting unit tests for weekly serial frequencies
    
    Corrections and added unit tests following the changes of the first patch.
    
    GetFictiveIssueNumber.t: New subtest for weekly frequencies.
    
    GetNextDate.t: Correcting a few dates one day. If we use 2/week, we will
    calculate an interval of 3 days and correct with 4 days at the end of
    the cycle. The connection with firstacqui is not relevant anymore.
    
    Test plan:
    [1] Run t/db_dependent/Serials/GetFictiveIssueNumber.t
    [2] Run t/db_dependent/Serials/GetNextDate.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffb1c87d2962b19a07798da3bf81bef328270145
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 30 15:01:52 2017 +0200

    Bug 18697: Fix date calculations for weekly frequencies in Serials
    
    Same solution applied as in bug 18356/18607. Consistency++
    
    The code in _get_next_date_week is again very similar to the code in
    _get_next_date_month or _get_next_date_year. I will not merge them here,
    but we could consider that in the future.
    
    Code in GetFictiveIssueNo has been adjusted similarly to month and year.
    
    Test plan:
    [1] Do not apply this patch. Create a subscription for 3/week.
        When the first issue date is on a Saturday or Sunday, the
        intervals in the prediction pattern are 0,0,7,0,0,7,etc.
        Starting on Wed-Fri 1,1,5,etc. Starting on Mon-Tue 2,2,3,etc.
    [2] Apply this patch. Check again.
        The interval should be always 2,2,3 now and no longer depend on the
        day_of_week of first issue date.
    [3] Check another weekly frequency with multiple units per issue.
        Say 1 issue/3 weeks.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05a49035ccff1d962ef0c21ca1b154e07ba5dba7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon May 29 12:08:40 2017 +0200

    Bug 18607: Adjusting unit tests for monthly serial frequencies
    
    The changes in the first patch require some corrections as well as
    additional test cases.
    
    GetNextDate.t: Since the calculation for multiple issues per unit has
    slightly changed, a few dates (day 15 or day 16) have been changed in the
    unit test; when we use 2/month, the algorithm now always adds 15 days.
    Added a few test descriptions in this regard too.
    
    GetFictiveIssueNumber.t: Add the monthly subtest with two test cases. In
    the first case we tests multiple units per issue, and in the second case
    we test multiple issues per unit (month).
    
    Test plan:
    [1] Run t/db_dependent/Serials/GetFictiveIssueNumber.t
    [2] Run t/db_dependent/Serials/GetNextDate.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adfcd8d79c6691fb1062a2a5874a736b7792d303
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 16 14:46:55 2017 +0200

    Bug 18607: Fix date calculations for monthly frequencies in Serials
    
    Similarly to the solution of bug 18356, this patch fixes the date
    calculation for monthly frequencies.
    
    The calculation in GetFictiveIssueNumber now makes use of the new
    _delta_units sub introduced on bug 18356.
    
    The calculation in _get_next_date_month is also very similar to the one
    in _get_next_date_year. I do not merge them here, but this could still
    be considered later on. At least consistency is achieved now between
    both routines. The connection with firstacquidate has been cut thru
    just like for year units.
    
    Test plan:
    [1] Without this patch, look at the prediction pattern for a
        subscription with first issue on Feb 21 and 5 per month. The first
        issues will be 21, 22, 23, 24, 25. Then jumping to 21, 23, 25, etc.
    [2] Apply the patch. Look at the same prediction pattern. You will now
        see 6 day intervals and a new cycle starting on the 21st.
        So Feb 21, 27, Mar 5, 11, 17 and Mar 21, 27, etc.
    [3] Edit an subscription. Try a few other monthly frequencies.
    [4] The next patch adjusts related unit tests.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d71fb0e17c87a39fc5abe7c9b2d866636c244347
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 9 17:01:46 2017 +0200

    Bug 18356: Fix date calculations for yearly frequencies in Serials
    
    The problem as described on BZ 18356 is a combination of an error in
    GetFictiveIssueNumber and GetNextDate for unit==year.
    
    [1] In GetNextDate the Add_Delta_YM calculation should be applied only to
    frequencies based on years per unit.
    In the case of multiple units per year we calculate the number of days to
    add. And if we have reached the end of a cycle, we correct the
    rounding applied in the cycle.
    NOTE 1: We obsolete the idea here of rebasing dates on firstacqui. In case
    of manual adjustments, we probably do not want it. And otherwise we do not
    need it anymore due to the correction at the end of a cycle.
    NOTE 2: The calls to Add_Delta_YM are intentionally not corrected for leap
    years. Say you start at 2016-02-29. If you use 1/yr or 1/2yr, you will
    switch to the Feb 28th in the following years. In 2020 there will be no
    switch to Feb 29 again; if someone should need it, please use a manual
    adjustment. This is probably highly exceptional.
    
    [2] In GetFictiveIssueNumber the year should be decreased by one if you
    have more units per year and you did not yet reach firstacqui day and
    month. This affects calculations in GetNextDate with irregularities.
    NOTE 1: I added a wrapper around Date::Calc::N_Delta_YMD in order to improve
    its results; this will especially be needed when we use it later for
    month units.
    NOTE 2: In case of manual adjustments this calculation does not really make
    sense. Another report should deal with improving irregularities.
    
    Test plan:
    [1] Verify that both GetNextDate.t as well as GetFictiveIssueNumber.t pass.
    [2] Look at the prediction pattern for a few frequencies.
        For example: 1 iss/y, 1 iss/2y, 5 iss/y.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 285f6bd945373c06633b2c42621d754d93c37903
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu May 11 10:47:22 2017 +0200

    Bug 18356: Extend GetNextDate.t, add GetFictiveIssueNumber.t (unit=year)
    
    This patch deals with tests for yearly frequencies.
    
    Adjust/extend GetNextDate.t:
    [1] Adjust mixup of units/issues in a description.
    [2] Add testing +2 years on 29-2 of leap year for freq 1 issue/2 years.
    [3] Add tests for freq 9 issues/year.
    
    Add GetFictiveIssueNumber.t:
    [1] Two subtests are provided for irregular frequencies (very trivial) and
        for year frequencies (with four specific test cases).
    
    Test plan:
    [1] Run t/db_dependent/Serials/GetNextDate.t
    [2] Run t/db_dependent/Serials/GetFictiveIssueNumber.t
    
    Note: Without the second patch both tests should fail. This shows the need
    of the adjustments in the second patch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da10c3169b8cae71bf4a98b6585654a09704c323
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Thu Jun 15 18:07:53 2017 -0400

    Bug 18807: t/db_dependent/www/batch.t fails
    
    get() does not take two parameters. fixed.
    prove and run koha qa test tools
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 768c5758a2bb34876528e64edbb9d651942668c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 14 16:56:13 2017 -0300

    Bug 18807: Fix tests www/batch.t
    
    Several things are wrong here:
    1. It assumes that import_record_id is the biblionumber
    => Wrong, it is only true when the DB is empty and that the 2 AI equal 1
    2. The encoding in the template is 'UTF-8', not 'utf8', it leaded to
      "stage-marc-import.pl: marc21record.mrc: Unexpected charset UTF-8, expecting utf8"
    3. We did not test that the biblio was correctly imported
    
    Test plan:
    Make sure the tests now pass.
    For the www tests you need to set the following env vars:
    KOHA_USER, KOHA_PASS, KOHA_INTRANET_URL and KOHA_OPAC_URL
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3db0401366b8e099ab2046d68cf20a9f754e1eae
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 14 15:53:18 2017 -0300

    Bug 18806: Fix batch revert
    
    Since bug 18242: When a biblio is deleted, a new transaction is created.
    tools/manage-marc-import.pl use the AutoCommit flag, which does not
    allow nested transaction.
    AutoCommit must not be used.
    
    Test plan:
    Import a batch, then revert it.
    The biblios must have been correctly deleted, they were not before this
    patch
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dd9236c6ebdfff33abcf97b6ea254ed1e63ffbe
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Jun 6 08:09:19 2017 +0000

    Bug 18703 - Followup, fix typo "statment"
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>

commit 9fb5f8519f2937aa7db6b53d6501f09ada11db4f
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 20:44:30 2017 +0200

    Bug 18703 - Translatability: Resolve some remaining %%] problems for staff client in 6 Files
    
    There are some more files that expose parts of tt diretives to translations, mostly due to
    line breaks inside directives.
    
    Files covered with this Bug:
    
    koha-tmpl/intranet-tmpl/prog/en/includes/authorities-search-results.inc
     koha-tmpl/intranet-tmpl/prog/en/includes/circ-menu.inc
    koha-tmpl/intranet-tmpl/prog/en/includes/search_indexes.inc
    koha-tmpl/intranet-tmpl/prog/en/modules/catalogue/issuehistory.tt
    koha-tmpl/intranet-tmpl/prog/en/modules/intranet-main.tt
    koha-tmpl/intranet-tmpl/prog/en/modules/members/members-update.tt
    
    To test:
    - Review code, verify that line breaks are removed
    - Run QA tools
    - Bonus test: Create a "language" aa-AA and verify that no fragments
      containign %%] are picked for the 6 files
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>

commit 3b64ebe2346de50d2fa3745d0febb935b5cc8b75
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 16:08:32 2017 +0200

    Bug 18699: Get rid of %%] in translation for edi_accounts.tt
    
    Translation for edi_accounts.tt exposes:
    [%% transport_types = [ 'FTP', 'SFTP', 'FILE' ] %%]
    
    Translators should not be confronted with such code internals.
    
    To test:
    - Review code change (it removes line breaks)
    - Bonus test: Create a new translatin for "language" aa-AA and
      verify that the line no longer appears in aa-AA-staff-prog.po
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Brendan A Gallagher <brendan@bywatersolutions.com>

commit 0f105285910d6a14b44d7cd789475a144552a627
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 16 17:00:23 2017 -0300

    Bug 18804: Add additional information to execute successfuly selenium tests

commit 8035a467f0b5d8441d4164bc183286d4f2593438
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 14 13:08:43 2017 -0300

    Bug 18804: (bug 13501 follow-up) Fix add item form (select2)
    
    Hard to say here, select2 adds so many elements that we need to ignore.
    Here we just assume that input text with an id starting with
    tag_952_subfield must be filled
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 08ab41aa9825e48f6321a90bf0bef09b572d4000
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 14 13:08:20 2017 -0300

    Bug 18804: (bugs 16400,11088 follow-up) Update the "save category" elt selector
    
    With bug 11088 and bug 16400 the submit node switched from:
      <input type="submit" name="save" onclick="return check_form_borrowers();" value="Save" />
    to:
      <button type="submit" name="save" onclick="return check_form_borrowers">
    then finally to:
      <button class="btn btn-small" id="saverecord" type="submit" name="save" onclick="return check_form_borrowers();">
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit a88f540ec1a0f7e1f876f3811d0e44cb3ff3a612
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 14 13:07:41 2017 -0300

    Bug 18804: (bug 16286 follow-up) Update the "save category" elt selector
    
    Bug 16286 replaced the submit node:
      <input type="button" value="Save" onclick="Check(this.form);" />
    with
      <input type="submit" value="Save" />
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 943a3a5c3ab4df6337607e1e237ff4f059d23da4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 13 17:43:39 2017 -0300

    Bug 18804: Skip selenium tests if Selenium::Remote::Driver is not installed
    
    We do not want these tests to fail if the module is not installed.
    This module is not in the dependencies of Koha and it is good as it.
    A developper who wants to use it will know what to do.
    It is part of RM duties to make sure these tests pass
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit e1afa469f8313144c70ae91d7efa356beb8168b8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 16 07:57:14 2017 +0200

    Bug 18361: [QA Follow-up] Resolve warning on undef values supplied
    
    The following warning was raised in Letters.t:
    DBIx::Class::ResultSource::_minimal_valueset_satisfying_constraint():
    NULL/undef values supplied for requested unique constraint 'primary' (NULL
    values in column(s): 'id'). This is almost certainly not what you wanted,
    though you can set DBIC_NULLABLE_KEY_NOWARN to disable this warning.
    
    This warning is triggered by this line in C4/Letters.pm:
        Koha::SMS::Providers->find( $member->{'sms_provider_id'} );
    As you already guessed, the sms_provider_id returns undef.
    
    Resolved in sub find by testing if there are parameters and if so, they
    should not be all undefined. (In most cases there will be only one
    parameter; but this report is about composite keys.)
    
    Added a trivial test case in Objects.t too.
    
    Test plan:
    Run t/db_dependent/Koha/Object.t
    Run t/db_dependent/Koha/Objects.t
    Run t/db_dependent/Letters.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit e1f943b9992ea1a3c5d4659ca6fa787834d66376
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 19 11:57:33 2017 -0300

    Bug 18361: (QA followup) Add tests for the no params case
    
    This patch adds a test for the trivial case in which no param is passed
    and the ->find method returns undef.
    
    For completeness purposes.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de74a4e5a0ec0fcf85a42b637d07c2bcd81d63f0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 13 13:15:30 2017 +0200

    Bug 18361: Additional tests for Koha::Objects->find
    
    Adding a subtest find in t/db_dependent/Koha/Objects.t.
    
    Test plan:
    Run t/db_dependent/Koha/Objects.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec288a50def5c4fdcd7b001087fed0b120e4a211
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 31 13:52:15 2017 +0200

    Bug 18361: Koha::Objects->find should accept composite primary keys
    
    Changes the $id parameter to an array. (IssuingRule has three keys.)
    The build_object method in TestBuilder.pm has been adjusted to pass
    multiple primary key values to find.
    
    Also adjusted the POD section to show more clearly that we accept
    the same parameters as DBIx ResultSet does.
    
    Test plan:
    Run t/db_dependent/Koha/Object.t
    Run t/db_dependent/Koha/Objects.t
    Run t/db_dependent/TestBuilder.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad7ff09b995e5275f2c6d664b31351321b1674af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 15 15:46:17 2017 -0300

    Bug 18539: remove occurrence in ReNewSubscription.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15cbf14f4d4f8039ad7820ce37da202b19e0075d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 18 13:49:18 2017 -0300

    Bug 18539: Forbid list context calls for Koha::Objects->find
    
    Reading https://perlmaven.com/how-to-return-undef-from-a-function
    this sound like the more correct behaviour.
    
    Considering:
    $template->param(
        stuff => Koha::Stuffs->find( $id ),
        foo   => 1,
    );
    without this patch, if the $id does not represent any rows in the DB,
    stuff will be assigned to 'foo' and $foo will be undef in the template.
    That can lead to very bad side-effects.
    
    With this patch we make sure that it will never happen again.
    
    Test plan:
      prove t/db_dependent/Koha/Objects.t
    should return green
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8218f2b55c544ac9fbb29153f2b1727d75cae5d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 27 08:59:53 2017 +0000

    Bug 17975: Let C4::Letters manage today param substitution
    
    The today parameter is properly handled from C4::Letters subroutines, we
    do not need to pass it from callers.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b28d25e9cd2939460c4b4043bafd7013e7248515
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 16 17:33:39 2017 +0100

    Bug 17975: TT syntax for notices - Prove that HOLD_SLIP is compatible
    
    Here we need to test <<today>>.
    We already pass a value, but it was wrong. We must pass a string, not a
    DateTime object, otherwise the KohaDates plugin will not display the
    hours part if we need it.
    
    Test plan:
    Define a HOLD_SLIP notice template to match your need.
    Do not forget to use
      [% today | $KohaDates %]
    or
      [% today | $KohaDates with_hours => 1 %]
    To access data from the reserves table, use the 'hold' variable
    
    Tested both patches together with several date formats, works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a740e773c6bfeb2b42945f16047b1f5dfba67af4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 16 16:58:23 2017 +0100

    Bug 17965: TT syntax for notices - Prove that DUEDGST is compatible
    
    This notice template have the particular feature of using <<count>>.
    This value is substitued during the process of the notice template.
    For the TT syntax, all what we need is to send the values to substitute to the
    template.
    
    Note that items.content can also be used in these template, you can have
    a look at bug 17967 to see a better alternative to this marker.
    
    Test plan:
    Generate DUEDGST and DUE notice messages.
    You should be able to generate the same messages with the TT syntax.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48f847025d2963c7d5583d46e27e59b28620e4b7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Mar 12 22:56:19 2017 -0300

    Bug 18254: Remove call to GetItemsByBiblioitemnumber call from additem.pl
    
    The code from additem to delete all the items of a bibliographic record
    is very ackward.
    This patch simplifies the algorithm and make the code more readable.
    
    Test plan:
    Remove all the items of a bibliographic records
    If at least 1 item is checked out you should get an error.
    
    No change with the current behavior is expected.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 628d8391d29a59f7d6a0ecfb52081684cee81403
Author: Marc Véron <veron@veron.ch>
Date:   Thu May 18 20:02:33 2017 +0200

    Bug 18630: Translatability (Clubs): 'Cancel' is ambiguous and leads to mistakes
    
    The button to cancel a club enrollement is labelled with 'Cancel'. That is ambiguous and translates e.g. in German to 'Abbrechen' which can lead to
    mistakes.
    
    To test:
    - Apply patch
    - Enroll a patron to a club
    - Enable public enrollment in OPAC
    - Verify that the button to cancel enrollment in both OPAC and staff client
      reads 'Cancel enrollement' (instead of 'Cancel' without patch)
      (The button appears on the patron's detail pages in OPAC and staff client)
    
    Amended for comment #4 / mv
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6906b848a78ad4c7d52c1e7c7ce195f08cc6d2a6
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Jan 11 15:36:05 2017 +1100

    Bug 17710 - C4::Matcher::get_matches and C4::ImportBatch::GetBestRecordMatch should use same logic
    
    C4::ImportBatch::GetBestRecordMatch uses SQL to sort by score descending
    then candidate_match_id descending. With C4::Matcher::get_matches, I
    implement the same sort but use Perl code to do it, since we're sorting
    search results.
    
    It's a simple change, but it's in a big block of code, so I don't have
    unit tests.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f97addef42826c0007f91cace1f365de358a8b60
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Jun 5 18:18:07 2017 -0400

    Bug 18732: Noisy t/SMS.t triggered by koha_conf.xml without sms_send_config
    
    Upgraded systems may be lacking sms_send_config which makes t/SMS.t noisy.
    This silently bypasses the problem.
    
    Remove sms_send_config from your koha-conf.xml file
    prove t/SMS.t
    -- it will be noisy, but pass.
    apply patch
    prove t/SMS.t
    -- noise gone.
    run koha qa test tools.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Works correctly as indicated by the testing plan.
    No "uninitialized" noise after patch is applied.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Slightly amended: turned the iif around.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4c965781d82e9537015b695cc15677cd06d72cd
Author: Marc Véron <veron@veron.ch>
Date:   Sun Jun 4 19:55:08 2017 +0200

    Bug 11235: Names for reports and dictionary are cut off when quotes are used
    
    To reproduce for saved reports:
    
    - Go to Home > Reports > Guided reports wizard
    - Create a report with double quotes in it's name, e.g. 'My "double quoted" report'
    - Go to "Saved reports", locate in the list the new report (name is correct here,
      is correct in database as well)
    - From the selection button at the right choose "Edit"
    - Result: Content of edit field for the report name is truncated (displays only: 'My')
    
    To reproduce for Reports dictionary:
    
    - Go to Home > Reports > Guided reports wizard
    - Create a new definition, give it the name 'The "double quoted" definition' and enter
      a text with double quotes for "Description"
    - Save
    - Verify that in the list of definitions both name and descriptions are truncated
      (in database as well)
    
    To test:
    - Apply patch
    - Verify that issues described above can no longer be reproduced
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a44f202fdb9c933e0b5ac88656e2c8f74e498023
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Oct 12 12:38:16 2016 +0200

    Bug 13452: Fix for plack
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25d28e7c8100c1993f8794e39ed135781de04a47
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Oct 2 11:31:10 2015 +0200

    Bug 13452: Fix obvious issues in issues_avg_stats.pl
    
    - Remove joins with issuingrules which are not needed
    - Fix the SQL query so that $weight is now the value of COUNT(*) instead
      of a timestamp
    - QA fix: '$column eq $itype' instead of '$column =~ $itype' (same for
      $line)
    
    Signed-off-by: Srdjan <srdjan@catalyst.net.nz>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0bf036c1828bbbd37a022f8449e217e8e269475
Author: Katrin Fischer <Katrin.Fischer.83@web.de>
Date:   Tue Jun 9 01:04:07 2015 +0200

    Bug 13452: 'Average loan time' report to obey item-level_itypes preference
    
    Fixes the 'Average loan time' report so that the system
    preference setting item-level_itypes is taken into account.
    
    Before the patch, the report was always using the biblio
    level itemtype. With the patch, it will depend on the pref
    setting.
    
    To test:
    - Run various reports, compare results with both
      possible pref settings
    - Try limiting your search in various ways, especially
      on a specific itemtype
    - Make sure you switch checkboxes in testing,
      using itemtype as the row or as the column
    
    Notes:
    - Filtering on a specific itemtype on master was not working
      if the itemtype was chosen as column. The patch should fix that.
    - Fixes headings and breadcrumbs so that the name of the report
      is the same as on the reports start page
    
    Signed-off-by: Indranil Das Gupta (L2C2 Technologies) <indradg@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75a62e93922834dd511ee7eb1fbdd31f2006fe1d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 8 16:28:41 2017 -0300

    Bug 18763: Fix swagger/definitions.t
    
    Test plan:
      prove api/v1/swagger/definitions/patron.json
    must return green
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    swagger/definitions.t test returns green

commit 6ae6d4bcb5238b1ffc0a22cc1d83ac05ba982b92
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 12 11:38:59 2017 -0300

    Bug 18685: (bug 18551 follow-up) Fix patron toolbar
    
    Bug 18551 moves the way the filters are displayed and so the position of
    the patron toolbar must be recalculated.
    
    Test plan:
    Edit patron's detail
    open the filters, scrolldown
    close the filters, scrolldown
    => The toolbar must be correctly placed
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>

commit 6d78d7a6108afc75546f933d601b04fde8b76c9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 8 16:11:45 2017 -0300

    Bug 18762: Remove some warnings from Search.t
    
    Note that some are caused by CGI, see bug 18632
    
    Test plan:
    Confirm there are less warnings with this patch applied
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>

commit 15f9e830ece26b5eead340e67b8d05b4bd07e930
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 8 15:36:40 2017 -0300

    Bug 18762: Remove a warning from History.t
    
    Test plan:
      prove t/db_dependent/Search/History.t
    should not display any warnings
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>

commit ab29b5efdc763269399c06aa62ac0a36a93152f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 8 15:35:02 2017 -0300

    Bug 18762: Remove warnings from xt/author/valid-templates.t
    
    Test plan:
    Read the changes and make sure they make sense
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>

commit c3a115916146e7c1e98c58c0b0a429e9841af461
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 8 14:17:53 2017 -0300

    Bug 18761: Fix tests for AutomaticItemModificationByAge.t - clear cache
    
    The mapping structure is cached and may be wrong if already populated.
    We need to clear the cache when a framework is modified
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Works as described in test plan and passes QA tools.

commit 1bc45a470e55bcbb5e4031c001749a1ec9b35160
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 8 15:19:22 2017 +0000

    Bug 18752 - Automatic item modifications by age should allow 'blank' values
    
    This patch modifies the automatic item modification by age template to
    correct errors in form validation:
    
    - Age in days should not be required
    - A value should not be required in substitutions.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Go to Tools -> Automatic item modification by age.
    - Confirm that when editing or creating a rule the only required field
      is the substitutions field name.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0444e8600efbe06016ff857f23ea85893a93041
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon May 15 09:58:04 2017 +0200

    Bug 18601: OAI/Sets.t mangles data due to truncate in ModOAISetsBiblios
    
    This patch replaces the TRUNCATE statement in ModOAISetsBiblios by a
    DELETE statement. A truncate will cause an implicit commit and will
    therefore commit the transaction started in the test script.
    
    Also simplifying the module load in the test script.
    
    Test plan:
    Do not apply this patch and observe that biblio records are added to your
    database by running t/db_dependent/OAI/Sets.t.
    Apply this patch, run the test again and verify that it does no longer
    add records to your biblio table.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 323cc1501fc91d67e8ecaa0a2cdf272f642d8e46
Author: Lee Jamison <ldjamison@marywood.edu>
Date:   Wed Jun 7 11:34:29 2017 +0000

    Bug 18749 - xt/sample_notices.t fails
    
    Bug Description:
    When performing a unit test on xt/sample_notices.t with the command
    'prove xt/sample_notices.t' 11 tests fail with the error message
    "No sample notice to delete".
    
    Cause of bug:
    The failures are caused by an incorrect file path on Line 25 of
    xt/sample_notices.t.
    
    Patch Description:
    This patch corrects the failures by changing $base_notices_file from
    "en/default/sample_notices.sql" to "en/mandatory/sample_notices.sql"
    
    Test Plan:
    1) Drop into koha-shell and run the command 'prove xt/sample_notices.'
    2) 11 unit tests fail.
    3) Apply the patch.
    4) Re-run 'prove xt/sample_notices.t'
    5) All of the tests pass now.
    6) Quit out of koha-shell
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b3f0c798b7770ecd7211be5998790e4a9f3999a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 12 18:56:45 2017 -0300

    Bug 18794: Fix test ListMetadataFormats in OAI/Server.t
    
    This test may fail on slow servers, it compares the response date with
    'now', but both can differ a bit.
    
    https://jenkins.koha-community.org/job/Koha_Master_D8/198/consoleFull
    
       Failed test 'ListMetadataFormats'
       at t/db_dependent/OAI/Server.t line 150.
         Structures begin differing at:
              $got->{responseDate} = '2017-06-12T14:31:51Z'
         $expected->{responseDate} = '2017-06-12T14:31:50Z'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a80ed84d070f81065b1fb2fa14f5ced3c25d6431
Author: Lee Jamison <ldjamison@marywood.edu>
Date:   Sat Jun 10 09:26:51 2017 +0000

    Bug 18584: Fix trailing spaces in C4/Accounts.pm
    
    Removed trailing spaces at line 182 of C4::Accounts.
    
    Test plan:
    1. Edit C4/Accounts.pm and verify trailing spaces
    2. Apply patch
    3. Verify that trailing spaces in C4/Accounts have been removed
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec478e18f352d340c7a1ec4416121928229c2907
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 08:41:53 2017 +0200

    Bug 18694: Translatability: Get rid of exposing [%% FOREACH in csv/cash_register_stats.tt
    
    Code exposed is:
    %s %s %s [%%- FOREACH field IN row; field IF !loop.last; ItemTypes.GetDescription(field) IF loop.last; sep IF !loop.last; END %%] %s TOTAL [%%- FOREACH field IN total; field; sep IF !loop.last; END %%]
    
    Similar for: csv/orders_by_budget.tt
    
    To test:
    - Apply patch
    - In staff client, verify that Cash register statistics work as before
      (Home > Reports > Cash register statistics)
    - Verify the same for Home > Reports > Orders by fund (triggers orders_by_budget.tt)
    - Bonus test: Create a "language" aa-AA (perl translate create aa-AA
      from folder misc/translator, verify that lines mentioned above do
      no longer appear in aa-AA-staff-prog.po )
    - Run QA tools (newest version with test for newlines in tt directives)
    
    Rebased on top of Bug 18734 2017-12-06 / mv
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 855ff0fb9a1cf7755a0805910c367150b37b5f2a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 9 10:17:25 2017 -0400

    Bug 18734 - Internal server error in cash_register_stats.pl when exporting to file
    
    To test:
    Output cash reigster stats report to file
    Internal server error
    Apply patch
    Export to file
    File is generated and correctly formed
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a38ffe2d48c35029ef80ea0a4294e36b408cd1a4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 24 13:46:50 2017 +0000

    Bug 18656 - Require confirmation of deletion of files from patron record
    
    This patch adds a JavaScript confirm to the deletion of files. It also
    styles the file deletion link as a Bootstrap button.
    
    To test, apply the patch and open the "Files" page for a patron who has
    files attached.
    
    - Verify that clicking any "delete" link prompts for a confirmation.
    - Verify that confirming the dialog triggers the deletion of the correct
      file.
    - Verify that canceling the confirmation dialog aborts the deletion.
    - Confirm that the "Delete" button looks correct.
    
    Signed-off-by: David Roberts <david.roberts@ptfs-europe.com>
    
    Revision for QA: Replaced '.click(function' with '.on("click",function'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25bbc181c9ceacd84582368f0006d4025250ea1f
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jun 9 18:52:17 2017 -0400

    Bug 18773: Fix failing history.t test
    
    changed get() to get_ok() and increased test count to match.
    Now the master build will only fail on search_utf8.t
    
    TEST PLAN
    ---------
    assuming KOHA_CONF is set.
    $ export KOHA_INTRANET_URL=...
    $ export KOHA_OPAC_URL=...
    $ prove -v t/db_dependent/www/history.t
    
    run koha qa test tools
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Works correctly using text plan provided and passes QA tools.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd14d2db9c6f6ac34a1dc0ea4ab741c05c22e5d3
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Fri Jun 9 19:23:49 2017 -0400

    Bug 18411: Fix failing search_utf8.t tests
    
    TEST PLAN
    ---------
    export KOHA_INTRANET_URL=...
    prove -v t/db_dependent/www/search_utf8.t
    
    something like seen before failure:
    t/db_dependent/www/search_utf8.t .. 9/66 Error GETing http://koha_16_11:8080/cgi-bin/koha/tools/background-job-progress.pl?jobID=741d649f9d4472fe75f30761ba2488c0: Bad Request at t/db_dependent/www/search_utf8.t line 170.
    
    apply this patch
    prove -v t/db_dependent/www/search_utf8.t
    
    Now it is the marc staging that is failing.
    And that is failing in master for me.
    So, I don't think it is the test that is a problem at this point,
    but the actual staged marc records process.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    I'm not sure why you had problems. All 66 tests passed
    after patch application and the patch also passes QA Tools.
    I tested this patch on a brand new kohadevbox without issue.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6999dbafbd2d6708d4c3a8fae7e83855902ebdbb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 9 13:24:07 2017 -0300

    Bug 18648: Restore hyphen

commit 8d2270254187b7d876d466860a76fd231b9549c2
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Jun 7 11:29:46 2017 +0200

    Bug 18741: Fix loading of SQL files in web installer
    
    Test plan:
    1. Start a normal install using the web installer
    2. When asked to select data to load, verify that
       'message_transport_types' is checked, and check some optional data
       files
    3. Continue the install to the end
    4. Verify that message_transport_types is not empty, and that the
       optional data you checked is there
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6bb4a0405abe0d03be3915644c6a05e2e3ee1e9f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 31 16:10:41 2017 +0200

    Bug 18706 - Remove useless Javascript
    
    Whe checking a subfield to be deleted, the code
      $(this).val($(this).siblings("[name='subfield']").val());
    is useless, the checkbox already contains the subfield code :
      <input type="checkbox" ... name="disable_input" value="[% ite.subfield %]" />
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c9273be169ca4da47059aa152f8c6ea11137a52
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 31 16:02:44 2017 +0200

    Bug 18706 - subfields to delete not disabled anymore in batch item modification
    
    In Tools > Batch item modification, one can click a checkbox to delete a subfield.
    This click use to disable the input to change the field value.
    
    This comes from the patch : Bug 13501: Move "Required" and checkbox after input/select
    Because input is found using JQuery next().
    
    This patch replaces with $(this).parent().find("[name='field_value']").
    
    Test plan :
    - Go to Tools > Batch item modification
    - Enter a barcode and submit
    - Click on a checkbox on a non-mandatory subfield
    => Without patch the input or select is not disabled
    => With patch the input or select is disabled
    - Submit
    => Check that subfield is deleted
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c35932923407e9ec088957f877e8607289b6b914
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jun 1 23:52:07 2017 -0300

    Bug 18716: Remove CGI::param warns from updatesupplier.pl
    
    This script floods the logs with this kind of warnings.
    
    To test:
    - Run:
      $ koha-plack-err
    - Edit a vendor in the acquisitions module
    - Save
    => FAIL: Logs show lots of warnings that look like:
     CGI::param called in list context from package CGI::Compile::ROOT::home_vagrant_kohaclone_acqui_updatesupplier_2epl
    - Apply this patch
    - Run:
      $ restart_all
      $ koha-plack-err
    - Edit a vendor, add/delete vendor contacts
    => SUCESS: No more warnings
    - Verify editing and storing vendor contacts works as expected.
    - Sign off :-D
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78a9f39f9a97179af3e3a38cf8cb17b3f043d88a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 9 11:16:08 2017 -0300

    Bug 18767: Remove useless diags from GetDailyQuote.t
    
    This tests print useless debugging info.
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/db_dependent/Koha/GetDailyQuote.t
    => FAIL: Some output telling what is doing on each step is printed.
    - Apply the patch
    - Run
     k$ prove t/db_dependent/Koha/GetDailyQuote.t
    => SUCCESS: No output, YAY!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e7c125a56be8971ec9c9bb52373bff5004a936a
Author: Marc Véron <veron@veron.ch>
Date:   Mon Jun 5 06:52:58 2017 +0200

    Bug 18727: System preferences loose part of values because of double quotes
    
    System preferences do not display values of text fields properly if they
    contain doulbe quotes.
    
    To recreate:
    - Go to Home > Administration > System preferences , then tab Acquisitions
    - Enter values to both system preferences like proposed in the example (o=5|a="bar foo" and  o=5|a="foo bar")
    - Save
    - Click on tab Acquisitions to reload
    - Wrong result: Both preferences show a value of: o=5|a=
      (parts with double quotes are truncated)
    
    - Edit any of the email addresses (Bug 9814):
      KohaAdminEmailAddress, NoticeBcc, ReplytoDefault, PayPalUser
    - Set value to: "The Library" <thelibrary@example.com>
    - Search for this email address syspref to re-display it
    - Wrong result:
      Use [     ] " autocomplete="off" /> as the email address for the
      administrator of Koha.
    
    To test:
    - Apply patch
    - Try to recreate issues above
    - Additionally, edit other system preferences that could contain double
      quotes, e.g. LibraryName or UsageStatsLibraryName
    - Set value to: Bibliothek "Zur Leseratte"
    
    (Note: patch contains a tiny fix for a typo in acquisitions.pref)
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1d90f205e3dc8177c0d524b208d9d4a367cf56e
Author: Marc Véron <veron@veron.ch>
Date:   Sun Jun 4 18:04:00 2017 +0200

    Bug 18689: calendar error with double quotes in title or description of holiday
    
    This patch fixes the calendar display with holidays having double qoutes in
    title or description.
    
    To test:
    - Apply patch
    - Go to Home > Tools > Calendar
    - Create new holidays of each type (Day only, repeated wekly/yearly,
      range, yearly repeated range and enter double qoutes in their titles and
      descriptions
    - Verify that calendar displays and works as expected
    - Verify that you can edit the holidays
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a2ef935ac63c67a4b31d8c3eb9bcb8d974d844e
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Jun 5 11:20:18 2017 +0000

    Bug 18722: Fund name is not shown in received orders fund subtotals
    
    Test plan:
    1) Go to acquisition and receive some orders
    2) Show the receive summary for invoice
    --> without patch, the fund name in subtotal is not shown
    --> with patch the name is shown as expected
    
    Signed-off-by: Michael Cabus <michael@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb0a67ea10c9210dbfb42f810c280b7515b04a16
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Mon Jun 5 12:24:07 2017 -0400

    Bug 18730: Batch Mod Edit <label> HTML validation fails
    
    [tag] [reply] [−] Description M. Tompsett 2017-06-05 16:30:21 UTC
    Know the barcode of an existing item.
    Home -> Tools -> Batch Item Modification
    Enter the barcode
    Click
    View Page source
    select and copy it into validator.w3.org direct input.
    There will be complaints about <labels>.
    
    Apply this patch
    
    refresh the page.
    select and copy it into validator.w3.org direct input.
    There will be no complaints about <labels>.
    
    This is intended to be a highly focused HTML bug, as the
    missing form tag which will fix the <div> issues at the bottom
    is corrected on bug 18710.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>

commit e426da4e009ce63c10923eaddd1ca271dca8005e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 9 10:46:49 2017 -0300

    Bug 18766: Remove itemtype-related warnings from ArticleRequests.t
    
    This patch fixes a small mistake on that test file (itype vs. itemtype
    in itemtypes table)
    
    To test:
    - Run:
      $ sudo koha-shell kohadev
     k$ cd kohaclone
     k$ prove t/db_dependent/ArticleRequests.t
    => FAIL: itemtype-related warning displayed
    - Apply the patch
    - Run
     k$ prove t/db_dependent/ArticleRequests.t
    => SUCCESS: No warnings, YAY!
    - Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcec2c71b4e362ffa7e1a443cdff9ace91761b9d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 9 10:21:33 2017 -0300

    Bug 18746: Add license and remove diag
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89d36585bb3483ac46c87224391b6867ae8468bb
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Jun 7 18:07:13 2017 -0400

    Bug 18746: Text_CSV_Various parse failures
    
    While it might be an idea to just delete it,
    this patch attempts to catch everything and make it
    clear that Text::CSV::Unicode (binary) is the parser
    that should be used.
    
    Signed-off-by: Lee Jamison <ldjamison@marywood.edu>
    Running 'prove xt/author/Text_CSV_Various.t' passes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1577460c713e3ac7e602dce81738f974e86ddf9d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 9 10:08:37 2017 -0300

    Bug 18759: (follow-up) Try to fix random failure from Circulation.t
    
    If IndependentBranches, CanBookBeRenewed will set ITEMNOTSAMEBRANCH
    or BORRNOTSAMEBRANCH flags, if the branches do not match.

commit 78b30baf3fa975ab9eabc58733a2252b08d22f25
Author: Marc Véron <veron@veron.ch>
Date:   Sat May 20 09:18:10 2017 +0200

    Bug 18641 - Translatability: Get rid of template directives in translations for *reserves.tt files
    
    Template directives should not be exposed in translation, but lines like the following pop up in the translation tool:
    Cancel [% IF TransferWhenCancelAllWaitingHolds %]and Transfer [% END %] All
    
    This patch fixes it.
    
    To test:
    - Apply patch
    - Verify that code changes make sense
    - Verify that submit buttons of pendingreserves.tt and waitingreserves.tt
      still work and display the same string as before
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 18641: (RM-followup) for waitingreserves.tt
    
    Code changed for waitingreserves.tt as asked for in comment #7
    
    Bug 18641: Followup for pendingreserves.tt (less %s)
    
    Change as of comment #13 to reduce %s
    
    After creating a new translation for a "language" aa-AA, we have
    the following in the file aa-AA-staff-prog.po
    
    msgid ""
    "(Inclusive, default is %s days ago to %s days ahead. Set other date ranges "
    "as needed.)"
    msgstr ""
    
    msgid ""
    "(Inclusive, default is %s days ago to today. Set other date ranges as "
    "needed.)"
    msgstr ""
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a55f5783c91b92cb8518f423ab23bd9727051ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 8 11:54:18 2017 -0300

    Bug 18759: Try to fix random failure from Circulation.t
    
    Circulation.t is failing randomly on our CI
    https://jenkins.koha-community.org/job/Koha_Master_D8/192/console
    
        #   Failed test at t/db_dependent/Circulation.t line 1147.
        #          got: '1'
        #     expected: '0'
    
        #   Failed test at t/db_dependent/Circulation.t line 1152.
        #          got: '1'
        #     expected: '0'
    
        #   Failed test at t/db_dependent/Circulation.t line 1156.
        #          got: '1'
        #     expected: '0'
    
        #   Failed test at t/db_dependent/Circulation.t line 1170.
        #          got: '1'
        #     expected: '0'
    
        #   Failed test at t/db_dependent/Circulation.t line 1184.
        #          got: '1'
        #     expected: '0'
        # Looks like you failed 5 tests of 23.
    
    Sometimes one of the alert or impossible flags is set.
    This patch guesses that it's because of the 'restricted' value of the item that is evaluated to 1.
    If it is not fixed by this patch, we will have more info next time (at least know
    if alert or impossible is set).
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    The fix is trivial. Using random data will lead to this situations. The good thing is that
    it lets us spot places in which tests need more fine-grained data.

commit b5b046599b6604c6cfd681d8392c560b3df738d2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 8 11:59:38 2017 -0300

    Bug 18296: Remove perlcritic error (request.pl)
    
    "$itemnumbers_of_biblioitem" is declared but not used at line 314,
    column 5.  Unused variables clutter code and make it harder to read.
    (Severity: 3)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88e50b6a68a9b433c55cea2d2c8d525edc1887ea
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 19:50:18 2017 -0300

    Bug 18296: C4::Items - Remove GetItemInfosOf
    
    At this point this subroutine is only used once, from reserve/request.pl.
    Since we already have the items, it's easy to populate the different
    hashes as the rest of the code is expecting it.
    
    Test plan:
    You need to create analytical record relationships (
    EasyAnalyticalRecords needs to be set). Link an item to a biblio using
    the 'Edit > Link to host item' menu from the biblio detail page.
    From the staff interface place a hold on the biblio. You should see the
    items from the biblio and the one you just linked
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>

commit 023b0890a25d1420a0f4ecb28d54c08a06e6479e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 6 11:06:29 2017 -0300

    Bug 18648: Fix syntax 'unexpected end of input'

commit 61f556d47d37e677411200ed29e12118d73f482c
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Thu Mar 16 21:28:08 2017 +0200

    Bug 18289 - Fix t/Prices.t having a Test::DBIx::Class cache issue
    
    REPLICATE ISSUE:
    
    perl t/Prices.t -> fails
    
    AFTER THIS PATCH AND DEPENDENCIES:
    
    perl t/Prices.t -> OK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5abcef4f54269a0c39eb6852795d4b6350ad30f1
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Thu Mar 16 21:26:36 2017 +0200

    Bug 18288 - Fix t/SocialData.t having a Test::DBIx::Class cache issue
    
    REPLICATE ISSUE:
    
    perl t/SocialData.t -> fails
    
    AFTER THIS PATCH AND DEPENDENCIES:
    
    perl t/SocialData.t -> OK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b237b4f34785286e844cc7aedf82dfbebb5c3438
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Thu Mar 16 21:17:24 2017 +0200

    Bug 18287 - Fix t/Koha.t having a Test::DBIx::Class cache issue
    
    REPLICATE ISSUE:
    
    perl t/Koha.t -> fails
    
    AFTER THIS PATCH AND DEPENDENCIES:
    
    perl t/Koha.t -> OK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92c0ea7d76323b03d1fc089e8770b604eeccbcb6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 5 17:32:43 2017 -0300

    Bug 18226: Perltidy + license
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57469b3b19d23ac5b8e6c67a72278c505eeba1b4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed May 24 14:14:50 2017 +0200

    Bug 18226: [QA Follow-up] Remove verbose
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1f42859b54dfbfb06316826375b4608bdc3fefb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed May 24 14:10:29 2017 +0200

    Bug 18226: [QA Follow-up] Remove further assumptions on branch count
    
    See also follow-up on bug 18286.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bf72439c0e20c5fa8f3f735ebc36b04ec6a749f
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Tue Mar 7 18:56:29 2017 +0200

    Bug 18226 - Remove "use Test::DBIx::Class" instantiations' dangerous code duplication
    
    Is 'instantiations' even a word?
    
    Use a Test::DBIx::Class defaults instead.
    
    Save your keyboard and prevent horrible bugs from emerging from rampant code duplication.
    
    This change doesn't seem to have any impact on the speed of executing those tests.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 617988a7c10d5807f1d2be3b026a30466adb0b33
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Wed Mar 8 17:34:28 2017 +0200

    Bug 18226 - Remove "use Test::DBIx::Class" instantiations' dangerous code duplication. Replace mock_dbh 2
    
    Couldn't make the tests pass using Test::DBIx::Class, so reverted to the "usual way" since these tests are
    in db_dependent anyway.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1985e6e4b3bd5fafe685b1a1e4874ea239f44261
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Tue Mar 7 19:19:52 2017 +0200

    Bug 18226 - Remove "use Test::DBIx::Class" instantiations' dangerous code duplication. Replace mock_dbh 1
    
    t/00-load.t already checks if all of the perl modules can be compiled.
    
    The tests deleted in this commit do a duplicate test with t/00-load.t
    Hence they have become unnecessary.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb3654077ff7331c71c033ddcedfe576fd8d7e28
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 2 16:18:41 2017 +0200

    Bug 18286: [Follow-up] Remove assumption on branch count
    
    A test in db_dependent should not make assumptions on the number of
    branches in the database. If you need one, create one. Removing the
    assumption of a non-zero count.
    
    Removing the library count statement outside the subtest.
    Replacing C4::Context by Koha::Database.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70ae3a9dc26bb0af8567431c3e0e5d236a527103
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 2 15:46:08 2017 +0200

    Bug 18286: [QA Follow-up] Fix some warnings from qa tools
    
    [1] Resolve warning on variable assignment before use strict.
    [2] Remove unused $schema variable.
    [3] Remove eval expression construction.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71c75f4773015ffe36811b6d5de6b995ccf7a2f3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 2 15:44:47 2017 +0200

    Bug 18286: [Follow-up] Add t/etc/schema.pl
    
    We need this file here already.
    Copied from bug 18226 and adjusted in order to keep qa tools quiet.
    
    Test plan:
    Run t/db_dependent/01-test_dbic.t again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5b1d3282e52427b16f1133742908ed27b28ea80
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Thu Mar 16 21:08:31 2017 +0200

    Bug 18286: Test::DBIx::Class connection/schema is shadowed by a cached connection/schema
    
    If Koha::Database->schema gets called before
    
        use Test::DBIx::Class
    
    The DB connection from $KOHA_CONF is cached.
    
    This happens most of the time because when C4::Context and friends are loaded
    (in compile-time?), they already access the DB.
    
    After Test::DBIx::Class is instantiated and hooks put in place to overload
    Koha::Schema connection, those hooks are never called due to getting the old
    connection from cache.
    
    This feature introduces a test case to replicate the behaviour and shows how
    flushing the connection cache solves the problem.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 149d8a6ec2413fc59a8bb51d520adec49b46bbe5
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Thu Mar 16 20:59:35 2017 +0200

    Bug 18285: Koha::Database schema cache accessors
    
    Safe way of getting and flushing the $database->{schema} -cache.
    
    This is needed by Test::DBIx::Class to overcome pre-initialization connection
    caching from C4::Context and others.
    
    See Bug 18286.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd9da3e8f64ac4eb8fde5a1a58e0d692542ce2e6
Author: Marc Véron <veron@veron.ch>
Date:   Fri May 26 11:06:56 2017 +0200

    Bug 18675: Translatability: Get rid of [%% in translation for csv-profiles.tt
    
    Translation tool for file csv-profiles.tt picks following line:
    %s [%% IF csv_profile.encoding == encoding OR NOT csv_profile AND encoding == 'utf8' %%]
    It is is due to a line break inside a template directive. This patch removes it.
    
    To test:
    - Verify that code change makes sense
    - Apply patch
    - Verify that csv exports behave as before
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 279126d710233f7925432ab1f8fa6ae9f947889e
Author: Marc Véron <veron@veron.ch>
Date:   Mon May 29 20:13:03 2017 +0200

    Bug 18690 - Typos in Koha database description (Table "borrowers")
    
    This string patch fixes typos in kohastructure.sql as described in initial
    comment.
    
    To test:
    - Carefully verify that string changes make sense
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 880c2e19c3c5f10f110fd80a44f0d111b9d05472
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 09:37:02 2017 +0200

    Bug 18681 - (followup) Remove on more [%% in translation for about.tt
    
    Test plan same as in previous patch
    Run QA tools in newest version (test for line breaks in tt directives)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c8c84f4be8665d95ededf5174c406e1a63d6529
Author: Marc Véron <veron@veron.ch>
Date:   Fri May 26 19:11:59 2017 +0200

    Bug 18681: Translatability: Get rid of [%% in translation for about.tt
    
    Translation tool picks a line
    %s [%% IF warnPrefBiblioAddsAuthorities || warnPrefEasyAnalyticalRecords ||
    ...due to a line break inside a template directive.
    This patch fixes it.
    
    To test:
    - Update QA tools
      (see https://bugs.koha-community.org/bugzilla3/show_bug.cgi?id=18675#c2)
    - Verify that code change makes sense
    - Apply patch
    - Run QA tools
    
    Followed test plan and everything was as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5726913774ed25c4125e65a12054a00c2f7dd76
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 10:47:48 2017 +0200

    Bug 18695: Translatability: Get rid of [%% INCLUDE in translation for circulation.tt
    
    The file circ/circulation.tt exposes the following line to translation:
    %s %s [%% INCLUDE 'blocked-fines.inc' fines = chargesamount %%] %s %s
    Translators should not be confronted with code internals.
    
    This patch fixes it by removing a line break.
    
    To test:
    - Verify that code change makes sense
    - Run QA tools in newest version (check for line breaks in tt directives)
    - Bonus test: Create a "language" aa-AA (perl translate create aa-AA
      from folder misc/translator, verify that line mentioned above do
      no longer appear in aa-AA-staff-prog.po )
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ee3249438b85cb47aa9ff623bac4f405df7161f
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 07:13:31 2017 +0200

    Bug 18693: Translatability: Get rid of exposing a [%% FOREACH loop in translation for branch-selector.inc
    
    The file branch-selector.inc exposes the following line to translation
    (due to newlines insied a tt directive):
    %s %s [%% FOREACH branch IN branches; IF branch.selected; selectall = 0; END; END %%]
    
    Additionally, export.tt exposes the following line to translation:
    [%% INCLUDE 'branch-selector.inc' branches = libraries %%]
    
    To test:
    - Apply patch
    - In Staff client, go to Home > Tools > Export data
    - Verify that library selection behaves as before
    - Bonus test: Create a "language" aa-AA (perl translate create aa-AA
      from folder misc/translator, verify that lines mentioned above do
      no longer appear in aa-AA-staff-prog.po
    - Run QA tools (newest version with test for newlines in tt directives)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a30dea05b158fd6a77b0495ee047310865072eb
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 11:23:20 2017 +0200

    Bug 18644: Translatability: Get rid of pure template directives in translation for memberentrygen.tt
    
    Translation for memberentrygen.tt exposes a lot of template directives
    like the following:
    [% UNLESS opduplicate %][% othernames | html %][% END %]
    Translators should not be confronted with such code internals.
    
    To test:
    - Review code changes
    - Verify that creating / editing patrons works as before
    - Bonus test: Create a "language" aa-AA (perl translate create aa-AA
      from folder misc/translator, verify that lines like mentioned above
      do no longer appear in aa-AA-staff-prog.po
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 953504a0769a38a60f379a2e9c72bf7b71814fd0
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 14:27:56 2017 +0200

    Bug 18682 - Translatability: Get rid of [%% in translation for 2 files av-build-dropbox.inc
    
    Two files av-build-dropbox.inc has linebreaks inside template directives,
     exposing internals (comments and tt code) to translations as mentioned
    in initial comment.
    Translators should not be confronted with such interal code.
    
    This patch fixes it.
    
    To test
    - Verify, that code changes make sense and have no more line breaks insied
      tt directives.
    - Run QA tools in newest version (checking for line breaks inside tt
      directives)
    - Bonus test: Create a "language" aa-AA (perl translate create aa-AA
      from folder misc/translator, verify that lines mentioned above do
      no longer appear in aa-AA-staff-prog.po and in aa-AA-opac-bootstrap.po
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a023a670c1bf0faffe51faefc42fdd6407c2320
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 17:50:57 2017 +0200

    Bug 18701: Translatability: Get rid of exposed tt directives in matching-rules.tt
    
    Translation for file matching-rules.tt exposes a lot of template directives.
    
    Translators should not be confronted with internal code like the following:
    
    [%% PROCESS norms_select selected_norm=\"none\" id=\"mc_1_src_c_1_n_1_norm\" "name=\"mc_1_src_c_1_n_1_norm\" %%]
    
    To test:
    - Apply patch
    - Verify that code changes make sense (removes line breaks in directives)
    - Run QA tools in newset version (tests for line breaks in tt)
    - Bonus test: create a new translation e.g. fpr language 'aa-AA', verify
      that such lines no longer appear in po/aa-AA-staff-prog.po
      (for matching-rules.tt)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17fd5a4ffb6fa92e1ce522ac8f8cf5fdeb343868
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 18:50:16 2017 +0200

    Bug 18702: Translatability: Get rid of exposed if statement in tt for translated onboardingstep2.tt
    
    The file onboardingstep2.tt exposes the following to translations:
    
    "[%% IF (categories && categories.count > 1 ) # This if statement checks if "
    "the categories variable handed to this template # by onboarding.pl has data "
    "in it. If the categories variable does have data # in it this means that the "
    "user has previously imported sample patron category # data and so we do not "
    "need to show them the create patron category screen 1, #instead we can "
    "display a screen with ubtton redirecting the user to step 3 %%] "
    
    Translators should not be confronted with such internals. This patch removes it
    
    To test:
    - Verify that code change makes sense
    - Run QA tools
    - Bonus test: Create a new "language" aa-AA and verify that the lines above
      are no longer exposed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00d3a883b5e4d2ff1f5badef3c5dc33d7913bebe
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 30 21:10:32 2017 +0200

    Bug 18648: Translatability: Get rid of tt directives in translation for macles.tt
    
    koha-tmpl/intranet-tmpl/prog/en/modules/cataloguing/value_builder/macles.tt contains
    template directives inside a div tag:
    <span title="[% FOREACH lib IN cell.libs %][% lib.lib |html %] - [% END %]">
    This is exposed in translation tool.
    
    To test:
    - Carefully examine code changes
    - Apply patch, verify that the directive is no longer exposed (picked for
      po files), e.g. by creating a new "language" aa-AA and examing aa-AA-staff-prog.po
    - If you know where / how this macles is used, verify that it behaves as before
    
    (Note: New patch, needs new sign off)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16307c40343cdb0ed4ff69c9c001fc4d9e1a459f
Author: Marc Véron <veron@veron.ch>
Date:   Sun Jun 4 22:09:14 2017 +0200

    Bug 13747: Fix problems with frequency descriptions containing quotes
    
    If a serial frequency description contains quotes or is surrounded by
    quotes, the description is empty ("TEST" > empty) or shown without the
    quotes part (TEST "sth" > TEST) on editing the frequency.
    
    To verify:
    - Create a new frequency with description: "Test"
    - Modify frequency
    - Verify the description field is empty
    
    To test:
    - Apply patch
    - Try to recreate, verify that the description field is
      correctly filled when editing
    - Test also with a name like: 'A "souble quoted" name'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eddf975cf0244c731f987c64af5126090f73f9f2
Author: Marc Véron <veron@veron.ch>
Date:   Tue May 23 07:08:41 2017 +0200

    Bug 18653: Possible privacy breach with OPAC password recovery
    
    OPAC password recovery allows to find out which email address belongs to an account. An attacker could systematically guess login names. If they hit an existing one, OPAC displays a message like:
    An email has been sent to "xxx@yyy.zz".
    
    Having a combination of login name and email, attackers could use the information e.g. for phishing or other personalized actions.
    
    To reproduce:
    - Enable OPAC password recovery (syspref OpacResetPassword)
    - 'Guess' a login name e.g. by using a common pattern like ptester for Peter Tester
    - If such account exists, you get to know the related email address
    
    This patch removes the email address from the success message. Additionaly, it changes
    wording to address Bug 18570 ('will be sent' instead of 'has been sent')
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Simplified the wording. "Will be sent shortly" is used elsewhere too.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f6e1e00c265a552cf6faa7b7fa30db725204eb6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 5 12:55:36 2017 -0300

    Bug 8612: Update installer files for late_issues
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e40ced5c27fa704b48ff4e1a226bb2693192545
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 5 12:27:12 2017 -0300

    Bug 8612: DBRev 17.06.00.001
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3519f15382351d04827b1d64e413f4ffbae0637
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 5 12:35:10 2017 -0300

    Bug 8612: Remove warnings from tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 273659cc031b9be0c79fe199f4ec76c7bb44ac26
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 2 08:08:57 2017 +0200

    Bug 8612: [QA Follow-up] Remove two newlines from template output
    
    When using the Default profile from the basket form, the resulting csv
    file has an additional newline after the headers and at the end.
    This patch removes them.
    Unit test adjusted accordingly.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e111f1b3f1056e1cf75c5805dd2f85958ef9484
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 20 09:05:13 2017 +0000

    Bug 8612: [Follow-up] Fix unit test GetBasketAsCSV.t
    
    Test plan:
    Run t/db_dependent/Acquisition/GetBasketAsCSV.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ca8275862e5730595fdd99d90295c90ba708e15
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu May 4 07:43:27 2017 +0000

    Bug 8612: [Follow-up] Fix regular expression
    
    Fix regular expression to do what is described in the comment
    Make header in CSV profile definition optional
    Strip white chars from csv profile definition
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23e0db00784a3de3642e87dbff3d858cb92b5a74
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 20 11:13:47 2017 +0000

    Bug 8612: [Followup] Update DBIx schema
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7457f278af685eb3f71eed57db2ff333c1c32814
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 20 11:12:54 2017 +0000

    Bug 8612: [Follow-up] Make usage and type different columns in table
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c83e117869e501275fffc88ac10c9e1aee92160
Author: Philippe Blouin <philippe.blouin@inlibro.com>
Date:   Thu Mar 26 16:07:44 2015 -0400

    Bug 8612: Use CSV profile for exporting basket
    
    This patch allows the user to use a CSV export profile to create the fields to export the basket as CSV in a basket page.
    
    Test plan:
    1) Apply the patch
    2) Go to Tools › CSV export profiles and create a profile of type "SQL for basket export in acquisition"
      example:
      biblionumber=biblio.biblionumber|auteur=biblio.author|titre=biblio.title|date=biblioitems.copyrightdate|editeur=biblioitems.publishercode|isbn=biblioitems.isbn|quantite=aqorders.quantity|prix=aqorders.rrp|panier=aqorders.basketno
    3) In acquisition module, create a new basket and add an order to the basket
    4) On basket detail page, there should be the split button labelled "Export to CSV"
    5) Try to use the button and export CSV with your CSV profile you defined in step 2
    6) Validate the CSV file.
    7) Repeat 4-6 with a closed basket.
        a) close the basket
        b) View the basket
        c) validate that there is an export button
        d) test it with an export
    8) prove t/db_dependent/Acquisition/GetBasketAsCSV.t t/db_dependent/Koha/CsvProfiles.t
    
    Initial work:
    
    Sponsored by: CCSR
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: mehdi <mehdi.hamidi@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbade9e587b349449a50e6d6ba78309533268e51
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 13 12:34:06 2017 -0400

    Bug 18430 - Plugins page should have a link to viewing other types
    
    To test:
    Go to the plugins page from
    Reports->Report plugins
    Tools->Tool plugins
    Admin->Manage plugins
    
    Ensure that you have a 'View plugins by class button'
    
    Ensure the button does what you would expect
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d76f61a6b0b6b429246c5a9398ec55f97d98027
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 9 15:56:32 2017 -0300

    Bug 17944: QA follow-up
    
    - Remove an unused use statement
    - Fix pod
    - Use snake_case
    - Fix test "An itemtype cannot be deleted if and only if there is
    biblioitem linked with it"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db3ebe47e859e85659b1a2565a03bcb6b59df0ff
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sun Jan 22 01:52:50 2017 +0000

    Bug 17944 - Add Koha::ItemType->can_be_deleted and use it from admin/itemtypes.pl
    
    Removed the sql code from Itemtypes.pm and replaced  it with DBIx
    database query in the itemtypes.pl administrative script
    
    Test plan:
    1. In the staff interface, stage and manage MARC records for import
    
    2. Try to delete an itemtype. If there are items of that itemtype in the
       database then a message telling you the number of items of that
       itemtype there are will be displayed.
    
    3. Record that number
    
    4. View the admin/itemtpes.pl script and confirm that there is sql code
       written in this file.
    
    5. Apply this patch
    
    6. View the admin/itemtypes.pl script and observe that there is no sql
       in this file. There is however DBIx code, for example
       $schema->resultset('Item')->search({ 'itype' => $itemtype_code} );
       which is searching for items with the itype value matching
       $itemtype_code value.
    
    7. In the staff interface try to delete the same itemtype
    
    8. Record the number of items there are with that itemtype in the
       resulting message
    
    9. The numbers recorded in steps 3 and 8 should match showing that the
       DBIx code is working as intended
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 281e1253777d2bd635610075fe610bedb2d47360
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Apr 29 17:14:10 2017 +0000

    Bug 13913 - Renewal error message in OPAC is confusing
    
    This patch adds some formatting to the error message a patron receives
    when there are renewal failures in the OPAC.
    
    This is pretty much the least which could be done to address this
    problem. However, I don't think the issue can be fixed without
    re-thinking how renewals are processed. Sending error messages back to
    opac-user.pl via URL parameter isn't flexible enough.
    
    To test, apply the patch and attempt to renew multiple items in the OPAC
    which cannot be renewed for some reason, for instance because they have
    been renewed too many times. The error messages should appear in a list
    rather than strung together in one long block of text.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cbb5096934907ec56df27d6ee3e77d752cd5e401
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue May 2 01:08:02 2017 +0200

    Bug 11122: Follow up - Fix some display issues and typos
    
    This patch fixes the display of copyrightdate for MARC21 installations.
    As MARC21 already requires you to add punctuation in cataloguing, there
    is usually no need for punctutation in the templates.
    
    Also fixes a template variable name typo and the basket summary page.
    
    To test (all 3 patches):
    - Add several order lines to an order, one should be uncertain
    - Verify that the publisher and publication year are displayed
    - Check the uncertain price page
    - Verify that the publisher code and publication year are displayed
    - Fix uncertain price and close your order
    - Basket summary: Verify... (you know what)
    - Cancel one of your orders
    - Verify... for cancelled orders
    - Receive shipment
    - Verify... for unreceived orders
    - Receive order
    - Verify ... for received orders
    - Finish receiving
    - Verify ... on the invoice summary page
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c470b3e38486e3c6040a10f6b0bf90af069f4566
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Sun Apr 19 20:28:21 2015 -0400

    Bug 11122: Address MARC21 vs. UNIMARC issue
    
    In comment #6 and comment #17, Katrin pointed out the discrepancy
    between UNIMARC (using publisheryear) vs. Other MARC installations
    (using copyrightdate). This was dealt with in invoice.tt already.
    This patch does similar logic for the other 3 template files.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c59e395b749132080fefb81e5b12f8c0b6654665
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Oct 23 12:05:23 2013 +0200

    Bug 11122 - publisher code and publication year not fetched in acq orders
    
    In acquisition, several templates try to display publisher code and publication year : invoice.tt, parcel.tt, transferorder.tt.
    Thoses pages use C4::Acquisition methods GetPendingOrders or GetInvoiceDetails.
    The bug is that in the SQL query of those methods, biblioitems.publishercode and biblioitems.publicationyear.
    In uncertainprice.pl those datas are fetch using GetBiblioData.
    It whould be better to fetch them in GetPendingOrders and GetInvoiceDetails.
    
    This patch changes SQL queries to fetch wanted datas : aqorders.*,biblio.title,biblio.author,biblioitems.isbn,biblioitems.publishercode,biblioitems.publicationyear. GetInvoiceDetails also needs : biblio.seriestitle,biblioitems.volume.
    This patch also unifies the way biblio datas are displayed :
      <a href="link to catalog using biblionumber">[title]</a> <em>by</em> [author] &ndash; [isbn]
      <em>Publisher:</em> [publishercode], [publicationyear]
    
    Test plan :
    - Choose a biblio record containing a data in :
        biblio.title,
        biblio.author,
        biblioitems.isbn,
        biblioitems.publishercode,
        biblioitems.publicationyear,
        biblio.seriestitle,
        biblioitems.volume.
    - Create an order using this biblio.
    - Look at this order in pages : parcel.pl, transferorder.pl, uncertainprice.pl
    => You see publisher code and publication year
    - Look at this order in page : invoice.pl
    => You see publisher code, publication year, series title and volume
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60b31a7a2219dea16f124684bd21e6d12a35c05a
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue May 30 15:17:58 2017 +0100

    Bug 18700 Fix grammar (data cannot be pluralized)
    
    data is a mass noun or plural of datum - datas is ungrammatical
    and jarring for a native speaker.
    Split the awkward sounding sentence into two for more clarity,
    thanks to Marc Véron for the suggestion.
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 151cdcd133d8618a3faf9b47723d66ac3dc71b4e
Author: Marc Véron <veron@veron.ch>
Date:   Thu May 25 23:04:14 2017 +0200

    Bug 18673: News author does not display on staff client home page
    
    News authors do not display on staff client homepage, independently of
    syspref 'NewsAuthorDisplay'. This patch fixes the issue.
    
    To verify:
    - Create news with display location 'All'
    - Set syspref NewsAuthorDisplay to 'Staff client only' or 'Both OPAC and staff client'
    - Go to staff client
    - Verify that news author does not appear (but it should)
    
    To test:
    - Applly patch
    - Verify that news author is displayed as expected
    
    Followed test plan works as intended
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc91ce5997fab0e186e75945f3df87ce413ce4fd
Author: Marc Véron <veron@veron.ch>
Date:   Sat May 20 11:46:00 2017 +0200

    Bug 18643: Remove dead code in reports/statistics 'Till reconciliation'
    
    File koha-tmpl/intranet-tmpl/prog/en/modules/reports/reports-home.tt contains a link to /cgi-bin/koha/reports/stats.screen.pl with label 'Till reconciliation' that is commented out since years.
    Remove this link and the related files:
    cgi-bin/koha/reports/stats.screen.pl
    koha-tmpl/intranet-tmpl/prog/en/modules/reports/stats_screen.tt
    
    To test:
    - Apply patch
    - Verify that Koha > Reports still display the same
    - Verify that two files stats.screen.pl and stats_screen.tt are gone and thet they are not used
      anywhere in the Koha codebase
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf5a1d5e5905664cd1a73691a75ecca40e575b99
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 2 10:27:26 2017 +0200

    Bug 18279: [QA Follow-up] Correct @EXPORT
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e7718ee655fd9846b2a44ad436995b9ea9a1f90
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 17:47:13 2017 -0300

    Bug 18279: Remove C4::Items::GetLostItems
    
    The JOIN done by this subroutine are not always useful (depending on
    item-level_itypes). They also search with LIKE when it is not needed.
    
    Since we have now Koha::Items, we can replace this subroutine with a
    call to Koha::Items->search with the correct parameters.
    
    A change in previous behaviours can happen: If a items.itemlost contains
    a value that is not defined as a LOST authorised value, the item will
    not be displayed. I think it's the expected behaviour, even if it should
    not happen in correctly configured installations.
    
    Test plan:
    To test with item-level_itypes set to item and biblio:
    List the lost items you have on your system, using the different
    filters available.
    The result table should contain the correct item's info.
    
    Followed test plan, works as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f466a856a99f3109985e3867296d9b7467f32e58
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 19:02:21 2017 -0300

    Bug 18295: C4::Items - Remove get_itemnumbers_of
    
    The code from scripts and subroutines using this subroutine was not very
    elegant. Most of the time the code was unnecessarily complex.
    This patch removes this subroutine and adapt the code to use
    Koha::Items instead.
    
    1. C4::Items::get_hostitemnumbers_of
    I did not understand why the code was so complicated, it seems that we
    only want to know if a given item has a given biblionumber
    2. cataloguing/merge.pl
    We want to retrieve the itemnumber for a given biblio.
    We could also have done that with:
      Koha::Biblios->find( $biblionumber )->items;
    3. labels/label-item-search.pl
    We want to loop over the items for a given biblio, no need to use
    get_itemnumbers_of and GetItemInfosOf.
    We just need to use:
      Koha::Items->search({ biblionumber => $biblionumber })
    4. reserve/request.pl
    We want to retrieve the itemnumbers of the biblio's items
    We could also have done that with:
      Koha::Biblios->find( $biblionumber )->items->get_column('itemnumber');
    
    Test plan:
    1.You need to create analytical record relationships (
    EasyAnalyticalRecords needs to be set). Link an item to a biblio using
    the 'Edit > Link to host item' menu from the biblio detail page.
    From the staff interface place a hold on the biblio. You should see the
    items from the biblio and the one you just linked
    2. Merge two bibliographic records (with items), the resulting record
    should contain items from both original records
    3. Create a new label batch, edit it.
    Add items to this batch ('Add items' button).
    Fill the input with a barcode.
    You should see all the items of a biblio.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0acd9bdf8500aa3cc2e5aeccbd1631f0b841040
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 15 17:14:56 2017 -0300

    Bug 18278: C4::Items - Remove GetItemLocation
    
    This subroutine is no longer in used.
    It was previously call from serials/serials-recieve.pl, which was not used and has been removed by
        commit 65b7ad030cd5cd0e3148fbbd1496d31b5cf149f7
        Bug 13423: Remove unused serials-recieve
    
    Test plan:
      git grep GetItemLocation
    
    Signed-off-by: Marc Véron <veron@veron.ch>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef6211b319b58b4c35e8cb8555e1caa4da9b2a8f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 30 16:55:19 2017 -0400

    Bug 18704 - File types limit in tools/export.pl is causing issues with csv files generated by MS/Excel
    
    To test:
    1 - Save a csv of biblionumber from MS/Excel
    2 - Attempt to export records using this file
    3 - It fails (mimetype is appliction/vnd.ms-excel)
    4 - Apply patch
    5 - Try again
    6 - It succeeds!
    
    Signed-off-by: Jason Palmer <jpalmer@switchinc.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc54b596c3bb225f45ca0443728452444b807d4e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 28 12:11:28 2017 -0400

    Bug 18179: Update 1 occurrence in booksellers.pl
    
    To test:
    1 - Load http://localhost:8081/cgi-bin/koha/acqui/booksellers.pl?booksellerid=1
    2 - Should get internal server erro
    3 - Apply patch
    4 - Reload
    5 - Should not get error
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb22703dcaa53400c17674b8bb7ba1cf76dffac8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 18 13:50:36 2017 -0300

    Bug 18179: Update existing calls
    
    This patch updates the existing occurrences of ->find called in a list
    context.
    There are certainly others that are not easy to catch with git grep.
    Test plan:
    Confirm that the 4 modified scripts still works as expected.
    
    We need this one ASAP in master to make sure we will not get other
    side-effects of this kind and to catch possible uncaught occurrences
    before the release.
    
    Tested scripts changed by this patch, they work as expected.
    Signed-off-by: Marc Véron <veron@veron.ch>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe22e9d99c99881077cc5abf837125b8e1c107c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 31 15:35:15 2017 -0300

    Koha 17.06 - unstable (start of a new dev cycle)
