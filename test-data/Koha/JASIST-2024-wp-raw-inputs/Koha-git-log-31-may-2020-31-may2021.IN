commit 949f0aad6889d830697504cc5b597e05bafb6c8f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 28 13:36:02 2021 +0200

    Koha 21.05.00 is here!

commit 07af6c7370af6c766f25f004476515288ecae273
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 28 13:34:01 2021 +0200

    Add release notes for Koha 21.05.00

commit a93f45ecc9c5fdeaf8ed75bc9df6dc94ed009615
Author: Andrew Nugged <nugged@gmail.com>
Date:   Fri May 28 13:36:45 2021 +0300

    Add and fix few messages in second plural form for pl, be, ru languages
    
    Fixed missed "singular" message which had word "one" instead of "{count}" for uk and ru because it should be used not only for "1" but also for "21, 31, ...".
    
    Add formula for 2/3 form for Russian (Plural-Forms:...)
    and Belarusian and Ukrainian formulas normalized to be the same for all three languages

commit 152733f66c7d8e247b12a170d63dc5d880054714
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 28 11:03:58 2021 +0200

    Fix translation issues
    
        sudo apt-get install translate-toolkit
        junitmsgfmt misc/translator/po/*.po

commit 1f80ab7f62375fb61a6d8bcfbd5794f005451e55
Author: Koha translators <>
Date:   Fri May 28 04:18:38 2021 -0300

    Translation updates for Koha 21.05.00

commit 8c23cdd25c74cc7b8345e96cf60fc476a40b7ef2
Author: Jonathan Druart <jonathan.druart@gmail.com>
Date:   Fri May 28 08:44:04 2021 +0200

    21.05.00 - Update history.txt
    
    See previous commit to know how to regenerate this

commit bbb4c847b42c30ab785f21aa3195bf8831b452c6
Author: Jonathan Druart <jonathan.druart@gmail.com>
Date:   Fri May 28 08:43:50 2021 +0200

    21.05.00 - Update contributors.yaml
    
        git reset --hard origin/master
        git remote add kumara https://git.koha-community.org/koha-community/kumara
        git remote add oldkoha https://git.koha-community.org/koha-community/oldkoha_1_0_7
        git merge --no-edit -s subtree kumara/master --allow-unrelated-histories
        git merge --no-edit -s subtree oldkoha/master --allow-unrelated-histories
        perl $releate_tools_dir/koha-update-contributors
        git commit -a -m"21.05.00 - Update contributors.yaml"
        perl $releate_tools_dir/koha-update-history
        git commit -a -m"21.05.00 - Update history.txt"
        git format-patch HEAD -n2

commit 69fb1be22d42bdfe1421b4e23ea783c858ec23d2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 27 12:36:32 2021 -0300

    Bug 28475: Fix searching all headings
    
    This patch fixes the value of a hidden input that was mistakenly
    changed and prevents search all headings from working.
    
    To test:
    1. Open the authorities section in the OPAC
    2. Choose the 'Search all headings' tab
    3. Search for 'a'
    => FAIL: No results
    4. Empty the search box, and make sure 'Search all headings' is selected
    => SUCCESS: There are authority records
    5. Apply this patch
    6. Reload the page
    7. Retry 3 and 4
    => SUCCESS: Searching is back!
    8. Sign off :-D
    
    Sponsored-by: Asociación Latinoamericana de Integración
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79fe1a6ab9fe8720f1be3d3a7edb4162adae7ffe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 17 10:29:01 2021 -0300

    Bug 28364: Make log4perl.conf belong to the instance user
    
    This patch makes koha-create generate the log4perl.conf file for the
    instance, belonging to the instance user. This is done in order to have
    the z3950 responder work.
    
    My original idea was to make the responder accept a '-g' parameter but
    that is not supported by Net::Z3950::Responder. Also, as the library
    insists on handling the PID file on its own, it wont' work to handle the
    responsability to start-stop-daemon. The only solution I found was
    making the fiel be owned by the instance user.
    
    1. Create a Koha instance:
       $ koha-create --create-db test
    2. Initiate all the things
    3. Enable and start the z3950 responder
       $ koha-z3950-responder --enable test
       $ koha-z3950-responder --start test
    4. Try doing some search:
       $ yaz-client localhost:2100
    => FAIL: you get:
    Connecting...OK.
    Sent initrequest.
    Target closed connection
    Z> quit
    See you later, alligator.
    => FAIL: No warning or anything on the logs
    5. Stop the daemon
       $ koha-z3950-responder --stop test
    6. Run it manually:
       $ PERL5LIB=/usr/share/koha/lib KOHA_CONF=/etc/koha/sites/test/koha-conf.xml \
                  /usr/bin/perl /usr/share/koha/bin/z3950_responder.pl \
                  -c /etc/koha/sites/test/z3950 -u test-koha \
                  -p /var/run/koha/test/z3950-responder.pid -d test-koha-z3950
    7. Repeat the 4, on a separate terminal (no daemon mode this time)
    => FAIL: You get:
    Cannot open /etc/koha/sites/test/log4perl.conf (Permission denied) at /usr/share/perl5/Log/Log4perl/Config/BaseConfigurator.pm line 51.
    8. Change the file owner:
       $ chown test-koha /etc/koha/sites/test/log4perl.conf
    9. Repeat 6, and 4
    => SUCCESS: It doesn't break anymore!
    10. Apply this patch
    11. Create a new instance, with the patched koha-create:
        $ debian/scripts/koha-create --create-db test1
    12: Check the generated files permissions:
        $ ls -l /etc/koha/sites/test2
    => SUCCESS: You get:
    -rw-r----- 1 root       test2-koha 19720 May 17 13:26 koha-conf.xml
    -rw-r----- 1 test2-koha test2-koha  2825 May 17 13:26 log4perl.conf
    -rw-r----- 1 root       test2-koha  2014 May 17 13:26 zebra-authorities-dom.cfg
    -rw-r----- 1 root       test2-koha  2279 May 17 13:26 zebra-biblios-dom.cfg
    -rw-r----- 1 root       test2-koha    26 May 17 13:26 zebra.passwd
    
    13. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Ere Maijala <ere.maijala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 748b2e91a310a9d774c32a53c1e5036167fe6d7e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 27 10:07:12 2021 -0300

    Bug 28463: Add summary to all routes
    
    This patch adds a 'summary' entry to all routes and verbs. This way,
    ReDoc will display a human-friendly description of the route, instead of
    the operationId.
    
    To test, repeat the testing steps in the previous patch, and notice that
    we now have good descriptions.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b4cde96d504382f0df3ac7926998258769f5b88
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 27 10:06:38 2021 -0300

    Bug 28463: Add missing tags
    
    This patch adds entries for:
    
    - Rotas
    - Circulation rules
    - Macros
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1dca080d4c451df32019bb0df26406180de9582
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 26 17:29:42 2021 -0300

    Bug 28463: Add tags definitions in swagger.yaml
    
    This patch starts the work of curating the spec documentation-related
    aspects. It doesn't involve any functional change on the API, just
    labels (used to render docs) and some descriptions basis is added.
    
    - A top level 'tags' entry is added to swagger.yaml.
    - The 'name' attribute is left with double quotes. This is on purpose,
      to differentiate from 'x-displayName' which is the actual text to be
      displayer and should be handled by documentation folks, not us, devs
      :-D
    - I add a very limited 'description' attribute there. It is the top
      level description of the section. For example the description for the
      'Biblios' section is 'Manage bibliographic records'. As it expects
      Markdown, anything we want can be added there.
    - Some labels have been tweaked in paths, to rollback the decision of
      making the labels in paths more end-user friendly. We don't want them
      to be typed much, and I picked what we use the most: snake_case.
    - The order in which things are displayed, is the one we specified on
      the swagger.yaml file. The 'batch import profiles' one is left at the
      bottom on purpose. But this is subject to discussion. As a general
      rule, I put them all in alphabetical order (on the x-displayName label
      I mean).
    
    I submit early before family duties so others can pick where I left in
    the morning. So:
    
    TODO:
    - I'm not sure what's best for Advanced editor macros. My bet is we
      should define a 'Macros' label, and use a summary on the routes
      themselves to specify this are not just 'macros', but advanced editor
      macros. Look at the return claims paths to understand how I propose to
      use the 'summary' attribtue.
    - I understand how we use 'rotas', but someone more familiar with the
      terminology,... please... step in.
    - Related to the first item here, we need to add summary to all routes,
      so ReDoc doesn't display the operationId anymore. Again, I put an
      example in Return claims that we can follow.
    
    To test:
    1. Have KTD running
    2. Open your browser at:
       http://localhost:/8080/api/v1/
    3. Save the page as spec.json in some known dir
    4. Go to that dir and run:
       $ docker run -it --rm -p 8083:80 \
           -v $(pwd)/spec.json:/usr/share/nginx/html/swagger.json \
           -e SPEC_URL=swagger.json redocly/redoc
    5. Open your browser at
       http://localhost:8083
    => SUCCESS: You see the docs
    6. Look at the list of 'categories' on the left
    => FAIL: They look a bit weird
    7. Apply this patch
    8. Ctrl+c on the terminal running docker
    9. Reload plack
    10. Repeat 2 through 6
    => SUCCESS: Wow, things look better!
    11. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59a301be71a487a939a55e0092099835b19d0e75
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 27 12:07:17 2021 +0200

    Update kohastructure.sql for 21.05.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e66d69fa3eaa42f484d47f1fffbf7a91156c3223
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 27 14:25:11 2021 +0200

    Bug 26734: Rename activethemes with availablethemes
    
    There was an existing call to $self->activethemes that behave as setter:
       85     $self->activethemes($activethemes);
    
    I am not sure what are the side-effects but it does not look good.
    
    It caused warning in the logs:
    
    Use of uninitialized value $interface in string eq at /kohadevbox/koha/C4/Templates.pm line 279.
    Use of uninitialized value $interface in string eq at /kohadevbox/koha/C4/Templates.pm line 280.
    Use of uninitialized value $interface in string eq at /kohadevbox/koha/C4/Templates.pm line 282.
    Use of uninitialized value $lang in concatenation (.) or string at /kohadevbox/koha/C4/Templates.pm line 296.
    Use of uninitialized value $lang in concatenation (.) or string at /kohadevbox/koha/C4/Templates.pm line 296.
    Use of uninitialized value $lang in concatenation (.) or string at /kohadevbox/koha/C4/Templates.pm line 296
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cc6fca618707898117363971460833ed3684539
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 15 14:07:26 2021 +0000

    Bug 27899: Missing description for libraryNotPickupLocation on request.pl
    
    This patch adds text to the holds template in the staff client so that
    if a particular item is at a library which isn't a hold location the
    error message is descriptive.
    
    To test, apply the patch and go to Administration -> Libraries.
    
     - Change one of your libraries so that "Pickup location" is set to
       "No."
     - Locate a title in the catalog which has an item at that location.
     - The "pick up at" list will exclude the library so and additional steps
         must be taken to get the message
     - Select a patron and set their library to the one we can't pick up at.
     - Start the process of placing a hold on the title.
     - After selecting the patron to place the hold for, look at the table of
       items under "Place a hold on a specific item."
     - The item located at the library you modified should show an error
       message in the "Hold" column, "Library is not a pickup location."
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e8b14aa8e07703c5e3d8a42b6431352e3883f68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 27 14:38:44 2021 +0200

    Bug 28386: Sort authors by lastname || firstname
    
    If several authors have the same lastname, they are swapped in the list between the different runs.
    
    This is reusing the code from the release_tools, see issue #24
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a403dec40fd89f08d9fcb478e27e5fb23ec6d73
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 27 14:36:48 2021 +0200

    Bug 28386: Remove _others_ from the contributor list
    
    We arbitrarily use "_others_" for unknown contributors (biblibre,
    bywater, ptfs-e teams, etc)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac00d757ab3e30cd4db2fb9694d28847d009a218
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 25 15:55:52 2021 +0100

    Bug 28442: Sort by lastname for array type roles
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b427d79d69579d78a6bb2784edacc64aa781934
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 25 13:59:31 2021 +0100

    Bug 28442: Fix 'accessibility_advocate' for current release
    
    The accessibility_advocate block was positioned incorrectly so wasn't
    appearing properly for the current stable releases, only the
    development/maintainter block.
    
    This patch fixes that issue
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16abe0f5321bc7165c1bf7051d6fa53f7608e0ec
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 25 09:29:48 2021 +0100

    Bug 28442: Update template for new roles
    
    We have multiple accessibility advocates this cycle, so we needed to
    adapt the template. I've also added the meeting facilitator as a case
    but not added to the team block as a whole.. seeking opinions, perhaps
    wait and see if it lasts more than a cycle before adding it fully?
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 467e7e4788ae771c26004a6b5e2951ddf19ed82d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 25 09:29:23 2021 +0100

    Bug 28442: Add 21.11 release team to teams.yaml
    
    Add the 21.11 release team.
    
    Test plan
    1/ Check against https://wiki.koha-community.org/wiki/Release_Teams
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 120a95cdb6bdb244a11b705466077a5f7e6792d8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 18 15:57:29 2021 +0100

    Bug 28368: Add fallback language for anonymous payment receipts
    
    This adds a fallback for when a payment is made anonymously to allow
    printing a receipt in the staff members current session language.
    
    Test plan
    1. Set `EnablePointOfSale` and `UseCashRegisters`
    2. Add new cash register`
    3. New debit type that 'can be sold'
    4. Make a sale (via Point of Sale) using the above debit type.
    5. Attempt to 'print receipt' from the subsequent prompt
    6. Not the ISE: Can't call method "lang"
    7. Apply patch
    8. Attempt to 'print receipt' again, this time it should work.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 235370092158d8cc5845e9f4b2c16e2201f10d39
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 25 13:55:39 2021 +0200

    Bug 28158: Allow batchMod to run under plack
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48e5171214378ce5e4fcbae6d41aa89e02a50d26
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 25 09:20:45 2021 +0200

    Bug 28158: Remove additional backgroundjob related code
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41551dfda72df88ed6056301872a37c921154f69
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 24 16:53:48 2021 +0200

    Bug 28158: Remove backgroundjob from batchMod
    
    == Test plan ==
    1 - In the default framework make sure the 952$1 is visible in opac & catalog & editor
    2 - Set WhenLostChargeReplacementFee to charge
    3 - Set MarkLostitemsAsReturned to return from batch modification
    4 - Find/edit an item with a replacement cost
    5 - Check out the item to a patron
    6 - Batch modify the item
    7 - Set the lost status
    8 - Item is not returned or charged
    9 - with the patch, it is
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6b562da6d86d9a19e2e5245014595a398f6b283
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 25 14:46:05 2021 +0200

    Bug 28419: Remove suspicious occurrence in opac-shelves.tt
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7efdbccfc2dd79ff6658a60f6381182aff8c84b6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 25 14:38:27 2021 +0200

    Bug 28419: Fix addorderiso2709.tt translatability
    
    It seems that the html tag within the TT comment breaks the translate
    script
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a15c972a89fe155112b8e8d9a8e297c4a9033fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 26 15:02:51 2021 +0200

    Bug 28461: Fix orders, biblios, holds
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09e47b434c4fcb4ad60608f50ecff4fde4785f5e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 26 09:48:06 2021 -0300

    Bug 28461: Fix SMTP servers and extended attributes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9de4594cf7ddb1c6b82b643e611055b72d7e70ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 26 14:30:00 2021 +0200

    Bug 28461: Specify only one tag per route
    
    Or the route will be misplaced when generated by redoc
    
    git grep tags api|grep '",'
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe65caf5fb1a353e4ec971b6c638bdfccfa90b78
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 26 12:30:50 2021 +0200

    Bug 28386: Disambiguate Tomas and Blou
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16851a23aa914cf7426e4cc62e8a6fc040dcbea8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 17 18:34:21 2020 +0000

    Bug 15720: Add connexion user and password options to connexion daemon
    
    Currently the connexion daemon does not utilize the user and password passed in the requests, it expects a
    user and password to be defined in the config file and for that user to be a valid Koha user with
    cataloging permissions.
    
    With that user in place all requests to the daemon are authorized.
    
    As the connections are over TCP we allow defining a new connexion user and password to protect Koha account information.
    
    If not defined current behaviour is preserved. Connexion user and password must both be set it either is set.
    
    Sample config file:
    host:
    port: 8888
    koha:http://localhost:8081
    log:/var/log/koha/kohadev/connexion.log
    match:ISBN
    user:kohauser
    password:kohapass
    overlay_action:replace
    nomatch_action:create_new
    item_action:always_add
    import_mode:redirect
    debug:1
    
    To test:
     1 - Create connexion file and save on the Koha serve
     2 - perl misc/bin/connexion_import_daemon.pl -c /kohadevbox/koha/connexion.cnf
     3 - Ensure the user specified above (connexuser) exists and has edit catalogue permissions
     4 - In another terminal make a request to the server:
            echo -en 'U6turtleA9connexionP5shell00024    a62clear00024   4500' | nc -v localhost 8888
     5 - The request should succeed and record added to batch (probably the import fails, but not important)
     6 - Add to config file
            connexion_user:conuser
     7 - Stop and restart the daemon - it should fail on missing connexion_password
     8 - Comment out connexion_user and add
            connexion_password:conpass
     9 - Stop and restart daemon, it fails on missing connexion_user
    10 - Uncomment the user and restart
    11 - Make another request
            echo -en 'U6turtleA9connexionP5shell00024    a62clear00024   4500' | nc -v localhost 8888
    12 - It fails 'Unauthorized request'
    13 - Make another request
            echo -en 'U7conuserA9connexionP7conpass00024    a62clear00024   4500' | nc -v localhost 8888
    14 - It succeeds!
    
    Signed-off-by: Allison Blanning <ablanning@hotchkiss.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 146f7314cf983ae20c35b2606acce7408e42e00e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 17 11:38:47 2021 +0100

    Bug 27942: Prevent XSS vulnerabilities in quote-upload
    
    When uploading new quotes the JS variables are not escaped correctly.
    
    Test plan:
    Create a new file with the following content (remove the first and last lines containing """):
    """
    ":this is a source","this is a text"
    "this is another ❤one","and another text❤"
    "this <script>alert('foo');</script>","and <script>alert('❤');</script>"
    """
    
    Go to Home › Tools › Quote editor
    Click Import quote
    Select the file
    Edit the third line, hit enter
    Import quotes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit abf1b6596c39b55b8a929c9c0329d113ea1f72df
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 20 08:34:48 2021 +0200

    Bug 20982: Sanitize category to prevent XSS on opac-shelves.pl
    
    == Test plan ==
    1. Go to http://localhost:8080/cgi-bin/koha/opac-shelves.pl?category=function(){window.location.href%20=%20%27https://git.koha-community.org/stats/koha-master/authors.html%27}()
    2. Note that you are redirected to another website
    3. Apply the patch & restart services
    4. Repeat the above and you are not redirected
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 335382e4553cd8bdd3b8ad07408888a0bae4b111
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 25 16:16:11 2021 +0200

    Bug 28386: Add more disambiguations to .mailmap
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b4f2db7ef41964b522a58fba6b4601c42f93069
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 25 10:34:49 2021 +0200

    Bug 28385: Use ldapserver only if exists
    
    Fix test
    t/db_dependent/Auth_with_ldap.t .. 1/4
     #   Failed test 'use C4::Auth_with_ldap;'
     #   at t/db_dependent/Auth_with_ldap.t line 123.
     #     Tried to use 'C4::Auth_with_ldap'.
     #     Error:  No ldapserver "id="ldapserver"" defined in KOHA_CONF: /etc/koha/sites/kohadev/koha-conf.xml at /kohadevbox/koha/C4/Auth_with_ldap.pm line 55.
     # Compilation failed in require at t/db_dependent/Auth_with_ldap.t line 123.
     # BEGIN failed--compilation aborted at t/db_dependent/Auth_with_ldap.t line 123.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e10b25d5944a467053303d0fec3b0e238c633a59
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 21 08:24:51 2021 +0200

    Bug 28385: Add tests
    
    This does not test bug 28385 directly but 28278 instead.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c9f8defcb69991bf7f0ee70f8787228505e8537
Author: Dobrica Pavlinušić <dpavlin@rot13.org>
Date:   Wed May 19 12:24:53 2021 +0200

    Bug 28385: ldap server configuration broken since migration from XML::Simple
    
    Bug 28278 removed usage of XML::Simple which had side-affect that
    C4::Context->config("ldapserver") returns one more level of hash
    based on id of element, so ldap configuration was no longer
    available generating error in log:
    
    No ldapserver "hostname" defined in KOHA_CONF: /etc/koha/sites/srvgit/koha-conf.xml
    
    which is very confusing since hostname is there, but we are looking
    at wrong place for it.
    
    == Test plan ==
    1. Setup an LDAP server with users or use a public one
         See https://wiki.koha-community.org/wiki/Ldap_testing
    2. Configure Koha to use it, see example config above
    3. Go to OPAC
    4. Koha doesn't compile due to LDAP config not parsed correctly
    5. Apply the patch
    6. Koha compiles and page loads
    7. Log in successfully with one of the LDAP users
    8. Bonus: Try to log-in with a wrong username & a good password and
         vice-versa
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07e760bff827dae0d905a9f3af6368a8b5982a98
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 21 09:55:25 2021 -0300

    Bug 28414: Fix labels for return claims
    
    The way labels are used with RedDoc, we need to tidy them better. We
    should do it with all the routes, but this one is specially noisy on the
    UI.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f8abe3618a054238910cbdbf2ffdf1416b8a03b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 25 09:13:40 2021 +0200

    Bug 28386: Add the 3 unknown authors back into the contributors list with a note
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9aced846d3066c08fbb6cf58e2fc67d3bfd41bb8
Author: Jonathan Druart <jonathan.druart@gmail.com>
Date:   Mon May 24 15:51:42 2021 +0200

    Bug 28386: Update history using script
    
    This is an example of what will be regenerated.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c5dc08598af727b9381d1e34cd154a33db94cc8
Author: Jonathan Druart <jonathan.druart@gmail.com>
Date:   Mon May 24 15:50:57 2021 +0200

    Bug 28386: Update contributors using script
    
    This is an example of what will be regenerated.
    It will need to be regenerated once it will be pushed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4139e39aaafc7ee1a86296f4eeeb05ccb1d974c
Author: Jonathan Druart <jonathan.druart@gmail.com>
Date:   Mon May 24 15:32:06 2021 +0200

    Bug 28386: Fix Pawel history notes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88d2db265cdd72c002d15ba322bf2ebe4db5d429
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 24 15:08:55 2021 +0200

    Bug 28386: fisheye is certainly Olwen
    
    After a chat with Chris it seems that fisheye was Olwen.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d102651d1b6e9bb7c20835f8e4ca4645926f6ec5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 15:48:11 2021 +0200

    Bug 28386: Add sponsors to .mailmap
    
    They were in dev_map.yaml, we are cheating with the <sponsor> email but
    it seems to work fine in my tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d7363cd52335153b80f4092fa929c16d4cdc5101
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 15:35:41 2021 +0200

    Bug 28386: Disambiguate Séverine (to squash)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d7a6bd08ba4288b9d203a33d4201c4d85477524c
Author: Jonathan Druart <jonathan.druart@gmail.com>
Date:   Wed May 19 11:10:25 2021 +0200

    Bug 28386: Add history_notes
    
    The "developer" lines of history.txt will be regenerated using the git
    history so we need to add this as a separate info.
    See the release_tools changes for more info
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c906e55c01834a2a0ba8334943d03fec77a3f785
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 08:54:04 2021 +0200

    Bug 28386: Update Hector
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb943607218e56c99a41eb9c10077ceaf1c3f0d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 08:47:46 2021 +0200

    Bug 28386: Meenakshi.R vs Meenakshi R
    
    Needs to match .mailmap
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 137c2715121bbf8abe3836b47dbe5ad76b39cca4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 08:40:21 2021 +0200

    Bug 28386: Update Kyle
    
    Need to match .mailmap
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e51ed3ba64f19234a02ca16e092511129acbf45
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 08:32:50 2021 +0200

    Bug 28386: Update Nicole
    
    Need to match .mailmap
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a701b363fe807389c49358c43bc33d61282e685
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 08:09:45 2021 +0200

    Bug 28386: Remove unknown authors
    
    Those 3 authors are not in the git history, we should remove them from
    the author list.
    However we could re-add them to the contributor list with a note saying
    for instance they were part of the Catalyst Academy (need to double
    check that first)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8818ac568657bc114ee1468de9d86fc27d477cb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 07:47:30 2021 +0200

    Bug 28386: Some manual removals from contributors.yaml
    
    Those are not real authors and should be removed from the
    contributors.yaml file
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b44702027b4ac732acdc54f6482857e0c451992
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 18 15:48:48 2021 +0200

    Bug 28386: Adjust .mailmap
    
    Again, we need to adjust our .mailmap
    This time the goal is the use it in place of the dev_map.yaml we have in
    the release tools.
    
    This will be generated for the release notes, history.txt and
    contributors.yaml file
    
    This can be tested using:
      git check-mailmap "author <email>"
    
    For instance:
      git check-mailmap "Wrong name <jonathan.druart@bugs.koha-community.org>"
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 223541bba481d795a0f8c3cf30eb793707ee06b8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 18 12:39:39 2021 -0300

    Bug 28369: (QA follow-up) Restore PUT with deprecation message
    
    This patch restores the PUT route, but adding a deprecation message. The
    controller method is the same, and relevant patch tests are duplicated
    but calling PUT, so it still gets tested.
    
    To test:
    1. Apply this patch
    2. Reload plack
    3. Open https://<>/api/v1/.html and find the PUT /holds/{hold_id} route
    => SUCCESS: There's a deprecation wargning!
    4. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a554b5a54572334029ca4f5f036e63140d2a4bcd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 18 09:06:45 2021 -0300

    Bug 28369: Set additionalProperties: false and fix things
    
    This patch performs a cleanup on the holds routes:
    - It adds additionalProperties: false to all missing routes
    - It syncs the spec with the guidelines
    - additionalProperties: false highlighted some attributes read in the
      controlled weren't declared on the spec, adding them
    - PUT /holds/:hold_id is moved to PATCH, as it makes more sense and
      gathered opinions lean towards that
    
    To test:
    1. Apply the tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => FAIL: Lots of things are wrong with the API
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfe3e013a2e79c5b3a6868d1c2c0eb8618fd79e0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 18 09:06:34 2021 -0300

    Bug 28369: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6308ae4f110936f58fcb13b3dcf7aebe888dc16
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 21 17:16:19 2021 -0300

    Bug 28370: Fix invalid responses in /patrons
    
    This response codes are not actually used.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18a332e608841a13e24db2aa233c42aeefb19bde
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 21 12:52:02 2021 -0300

    Bug 28370: (follow-up) More cases
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65927d0acb8f8c415e922707c6ebbdd8a4dfda04
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 21 17:05:27 2021 -0300

    Bug 28370: Rewrite tests
    
    This patch rewrites the tests, and also doesn't enforce
    additionalProperties to be false. We could need it, and there are routes
    that need to be reviewed that would break otherwise now: error.json, for
    example, is used everywhere, and some routes add some payload to it.
    
    The main change this patch introduces is using the resolved spec instead
    of finding each .json file, which wasn't even correct as we have .yaml
    files already. Parameters and responses are tested.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove xt/api.t
    => SUCCESS: Tests fail! A nice report on the failures is printed
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49ce9d97263a89c8746fa2488b17932984280442
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 21 10:48:44 2021 +0200

    Bug 28370: Add tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 051a06e69b98ad0f436fa41045c5bff006020b58
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 18 10:03:11 2021 -0300

    Bug 28370: Add missing additionalProperties in spec
    
    This patch adds missing attribute to the object definitions in the spec.
    We wrongly supposed it was the default, but it proved not.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1
    => SUCCESS: Tests pass, nothing breaks!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef2f0665033560034bbe5683b805bf61cfb8dafc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat May 22 18:03:25 2021 -0300

    Bug 28424: (follow-up) Do not create account lines manually
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d934d66f00e0ac196cc31de6176b117d174a3ef5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 21 18:32:03 2021 -0300

    Bug 28424: (28370 follow-up) Fix response definition
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfcc34fde792d0ee536abc63b2d708ca773939d8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 21 18:25:12 2021 -0300

    Bug 28424: Fix patron credits route (POST)
    
    This patch makes the route follow the coding guidelines and thus:
    - Return the generated object
    - Use the status code 201 for the response
    
    To test:
    1. Apply the tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons_accounts.t
    => FAIL: Tests fail. The reponse body and status is incorrect
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d86fbe95d38280c766ea0fc5c9d9ce6f49660046
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 21 18:22:44 2021 -0300

    Bug 28424: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 421fdc3d8f0df2ceba238e1ad23ed9478fd12cec
Author: Mason James <mtj@kohaaloha.com>
Date:   Fri May 21 02:50:58 2021 +1200

    Bug 28302: Update packages to ignore CGI::Compile 0.24 (2)
    
    to test...
     1/ build package
     2/ install package on focal
     3/ check that libcgi-compile-perl 0.24 is not installed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2c16cde6e2ce426584278c4c4866488bb31257a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 13 09:49:16 2021 -0300

    Bug 28273: (follow-up) Remove unused variable
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2510a51b58609fc62f80dce2b567d2f95e2687c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 13 09:03:52 2021 -0300

    Bug 28273: Add form validation for pickup locations
    
    This patch introduces validation on the new pickup locations column.
    This way, if a selected title doesn't have a pickup location set, it
    will prevent form submission and a suitable error message will pop-up.
    
    To test:
    1. Apply this patch
    2. Attempt to place multi-title level holds
    3. Make sure some selected titles don't have the pickup location set
    4. Submit
    => SUCCESS: Form submission halts, an idiomatic error message shows.
    5. Unselect all biblios and repeat 4
    => SUCCESS: You are not allowed to proceed, a message is displayed.
    6. Have all selected titles set a pickup location, submit
    => SUCCESS: Holds are placed as they should.
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26b6b10d34153c3fac8537706789f9873ff1f289
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 3 11:42:47 2021 -0300

    Bug 28273: Multi-hold should not offer invalid pickup locations
    
    This patch makes the multi-hold page offer only valid pickup locations
    for the selected biblios. Prior to this, all system-wide pickup
    locations were offered.
    
    To test:
    1. Set 'Hold pickup library match' to 'Item's home branch' so we put a
       constraint on the valid pickup locations for easier testing.
    2. Choose two or more biblios from a search, which contain  in total 2
       or 3 item home branches.
    3. Click 'Place hold'
    4. Choose a patron
    => FAIL: The dropdown offers all system's pickup locations
    5. Apply this patches
    6. Reload the page
    => SUCCESS: Only valid pickup locations are offered
    7. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc2aea0df493a350aa9824bbceb0521610c13364
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 3 09:45:41 2021 -0300

    Bug 28273: Add Koha::Biblios->pickup_locations
    
    https://bugs.koha-community.org/show_bug.cgi?id=26273
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2cd24f34b78c00f1a6180891027d515db0ba5edc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 3 09:45:25 2021 -0300

    Bug 28273: Unit tests
    
    https://bugs.koha-community.org/show_bug.cgi?id=26273
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac35ef738523b9d234b338c5d81daeb21d4833d5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 13 15:17:29 2021 +0000

    Bug 16785: Remove Autocomplete from overdues report filter
    
    This patch removes code and markup related to an autocomplete input
    field in the overdues report filter. The autocomplete was intended
    to enable easy entry of patron attributes, but it's simpler to use a
    Select2-styled <select>
    
    The patch removes circ/ypattrodue-attr-search-authvalue.pl, which was
    only used on this page and is now obsolete.
    
    To test, apply the patch and create at least one patron attribute type
    which is linked to an authorized value:
    
     - Administration -> Authorized values -> New category
       - Create a new category to test with
       - Add multiple authorized values under this category
     - Administration -> Patron attribute types -> New patron attribute
       type.
       - Create an attribute which is linked to the authorized value
         category you created AND which is marked "Searchable."
     - Go to Circulation -> Overdues.
       - In the sidebar filter you should see your patron attribute as an
         option, styled as a Select2 dropdown.
       - Clicking the dropdown should trigger a list of the authorized
         values you created above.
       - Test that the search field at the top of the list works correctly
         to filter the results.
       - Test that any repeatable attribute field can be cloned by clicking
         the "Add" link, and that cloned fields can be removed using the
         "Delete" links.
       - Test that cloned fields remain in place after submitting the fitler
         form, and that any selected entry in a Select2 widget is
         preselected.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 300210e8c372c90d1851bff156da7ece5eda5bb9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 19 16:43:47 2021 +0100

    Bug 28272: (QA follow-up) Add 'manager' to cashups definition
    
    The embeddable 'manager' relation field was missing from the
    specification file and as such calls using this embed would result in a
    500 error since we introduced 'additionalProperties: false'.
    
    Test plan
    1/ Enable 'UseCashRegisters'
    2/ Navigate to the register details page
    3/ Inspect the network traffic and note a 500 error on the cashups api
    call
    4/ Apply the patch
    5/ The 500 should have gone away and been replaced with an empty
    resultset 200 page.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3faeb901263609aa2a015f446944ef79cbe396c9
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu May 20 03:17:52 2021 +1200

    Bug 28302: Update packages to ignore CGI::Compile 0.24
    
    to test...
     1/ build package
     2/ install package on focal
     3/ check that libcgi-compile-perl 0.24 is not installed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6d323a0b20e74c52a93793eed2e7c3d7b656912
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 19 15:04:07 2021 +0200

    Bug 28187: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1d81d1fa7d417ca1e3f4b382d876252b6267ae7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 14 11:15:58 2021 +0100

    Bug 28187: Exclude dtrg-group from row striping.
    
    The odd row lowlighting stripe effect added to datatales wasn't
    accounting for classes introduced by the rowGroup plugin to denote
    grouping header rows. This patch adds the required exclusion rule to
    properly highlight rowGroup grouping rows.
    
    Test plan
    1/ Enable POS
    2/ Create a register and make some transactions.
    3/ Have both debits and credits
    4/ Have some older tranactions so you can look at the past_sales table.
    5/ Apply patch and regenerate the staff CSS:
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_interface)
    6/ Look at the sales and past_sales table.
    7/ Make sure each row header is the darker shade of gray (#e0e0e0)
    7a/ You will need to have made some transactions with even and odd
    numbers of items in the sale highlight the problem before applying the
    patch
    7b/ The rowGroup plugin is also used for the checkouts table and
    this patch should also fix that case.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 423421eb64f0130d9cb194e572f4ca89937b02a4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 28 17:56:11 2021 +0000

    Bug 28255: Follow up to bug 23463 - use item_object in misc/cronjobs/delete_items.pl
    
    This looks like just an assumption that the $item variable was an object
    
    Correct the code to use $item_object
    
    To test:
    1 - perl misc/cronjobs/delete_items.pl -where="barcode LIKE '%8'" --commit --verbose
    2 - Can't call method "safe_delete" on unblessed reference at /usr/share/koha/bin/cronjobs/delete_items.pl line 67.
    3 - Apply patch
    4 - Repeat
    5 - Success! You deleted a bunch of items
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e00dc78e4ed01678f037a970487fd871fa3e70f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 11 11:08:17 2021 +0000

    Bug 27837: (follow-up) Do not check subfield unless tag defined
    
    This was causing extra warnings when the permanent_location field was
    unmapped.
    
    We only need to check if there is a field defined as you can define a mapping
    without both a field and subfield, so the existence of one implies the other
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5bd16410a5c2dc597c265eec46a771cceec72bb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu May 6 09:09:03 2021 -0400

    Bug 27837: Always pass permanent location from items editor if it was defined
    
    By always passing permenent location from the items editor, we can know
    if permanent location was defined in the framework. This means we can
    know if we should update permanent location independently of location
    even if permenent location has an empty value.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db382ebaffd393151e0ebd8e6579f5c11969a90c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu May 6 08:09:04 2021 -0400

    Bug 27837: Check the MARC directly, not the transformed item
    
    If permanent location is mapped, it will exist in the MARC.
    However, when we are transforming our item hash to MARC,
    we are losing our permanent location mapping, at least in unit tests.
    
    By checking the original MARC for the permenent location, we remove the
    risk of losing it the "empty" permenent location through the
    transformation process. We only need to know that it existed in the
    original item marc to know we need to update it in the database.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa1d86920bd0392b4894fa2e756dcb41f2f7a5ec
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Mar 4 10:30:31 2021 -0500

    Bug 27837: Permanent location to be empty string, check if key exists
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56d895da8be38bed9587ff480786ed6cf55cacce
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon May 3 14:44:49 2021 +0000

    Bug 27837: Unit tests for blank permanent location
    
    Bug 27837: (QA follow-up) Minor Spelling/Typo correction
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b1c4c4f65c787e1c6a9548b087d4e0f760a0533
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 4 09:42:23 2021 +0100

    Bug 27837: Prevent the tests to fail is the field is mapped
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99f67cb04c2bd03e9ac5c6d01688bf9520d10595
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 3 08:54:39 2021 -0500

    Bug 27837: Add unit tests
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Rhonda Kuiper <rkuiper@roundrocktexas.gov>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97647da9a0541cb02ab0777ead388c8ff99a0424
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 3 08:33:21 2021 -0500

    Bug 27837: Update permanent location if passed into ModItemFromMarc
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Rhonda Kuiper <rkuiper@roundrocktexas.gov>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32f2026c1b6d5b97e6594020383940063d2b6fca
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 18 15:37:15 2021 +0100

    Bug 27724: Use lenient also in Elasticsearch authorities search
    
    In Elasticsearch, query for biblios uses lenient=true.
    This is also needed for authorities search.
    In case a search field is defined as type numeric.
    
    Test plan :
    1) Use Elasticsearch searchengine
    2) Define a search field 'local-number' as type 'Number'
    3) Be sure to us 'local-number' in autorities mapping
    4) Rebuild autorities
    5) Performe a search for autorities with 'Search entire record' and
       'contains' with term '123'
    => Without patch you get error :
    [query_shard_exception] Can only use prefix queries on keyword and text fields - not on [local-number] which is of type [integer]
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb3c3d56855e001bf608a3bf157c087e655c5c04
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 18 15:36:43 2021 +0100

    Bug 27724: Add unit test
    
    Run t/db_dependent/Koha/SearchEngine/Elasticsearch/QueryBuilder.t
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 539396fb27e02118d34f3b914fd2baffee752aa7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 18 09:10:26 2021 +0200

    Bug 28351: (bug 26261) Fix datepicker for dateformat ne mm/dd/yyyy
    
    This patch restores the same code we have prior to bug 26261
    
    0. Set dateformat to mm/dd/yyyy
    1. Go to a patron detail page
    2. Open the 'Restrictions' tab
    3. Choose a future date in which the day is higher than 12
    => SUCCESS: The input has the date we chose
    4. Set dateformat to dd/mm/yyyy
    5. Repeat 3
    => FAIL: It sets the current date, the browser console shows an error.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomás Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb90cbf4eb42e2ac63363a113cb5eb7f33459ac0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 11 14:27:21 2021 +0200

    Bug 28317: Use the default CGI::Session serializer
    
    We remove YAML::Syck on bug 22824 and YAML on 27673, to use YAML::XS.
    However we need one of them for CGI::Session::Serialize::yaml
    It's preferable to change the serializer and use the default one instead
    of writing one based on YAML::XS (or patch the existing ::yaml that does
    not seem maintained).
    
    There was an encoding bug reported on the default serializer (see commit
    a858e8a8b895640f2) but we fail to recreate it.
    
    Test plan:
    Create 3 libraries with branchcode=branchname: "CPL", "ÄÄÄ~ÄãÃ" and "✔️ ❤️ ★"
    Use the 3 options of SessionStorage and switch from one logged in
    library to another.
    Confirm that everything is working correctly (ie. no ending issue in the
    library name at the top-right corner)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecb0ff8bbef93cabfd7a346254bb928a5af1a915
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 18 11:26:25 2021 +0200

    Bug 28367: (follow-up) Fix plack condition in C4/Auth_with_shibboleth.pm
    
    There were 2 occurrences!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21d8298c7708281a9ab87851ea55f75559e57cf4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 18 10:43:05 2021 +0200

    Bug 28367: Fix plack condition in C4/Auth_with_shibboleth.pm
    
    C4/Auth_with_shibboleth.pm has:
      if ( any { /(^psgi\.|^plack\.)/i } keys %ENV )
    When others have:
      if ( any { /(^psgi\.|^plack\.)/i } keys %ENV )
    
    This has been highlighted by https://gitlab.com/koha-community/koha-testing-docker/-/issues/249 that introduces a PLACK_WORKERS env vars, and t/Auth_with_shibboleth.t was failing with
    
     #   Failed test 'checkpw_shib tests'
     #   at t/Auth_with_shibboleth.t line 335.
     Invalid parameter passed, categorycode= does not exist# Looks like your test exited with 255 just after 5.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5c155203e803ff94ab87e51ab753d919d493dc7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 17 16:07:17 2021 +0200

    Bug 28189: Fix PluginRoutes.t
    
    So, this one was hidden.
    
    The failures were:
        #   Failed test 'Bad plugins raise warning'
        #   at t/db_dependent/Koha/REST/Plugin/PluginRoutes.t line 75.
        # found warning: Warning: Could not load REST API spec bundle: Invalid JSON specification HASH(0x556972b22da0):
        # found warning: Warning: Could not load REST API spec bundle: Invalid JSON specification HASH(0x5569735b8368):
        # expected to find warning: (?^u:Could not load REST API spec bundle: Invalid JSON specification)
        # expected to find warning: (?^u:The resulting spec is invalid. Skipping Bad API Route Plugin)
    
    And the correct error was (after a debug warn in JSON::Validator):
    Warning: Could not load REST API spec bundle: Invalid JSON specification HASH(0x55fd0c3d3160):
    - /info/version: Expected string - got number. at /usr/share/perl5/JSON/Validator.pm line 165.
    
    So this patch fixes it, but I don't understand why it's only failing for
    plugin routes however.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46bff3b8a58669a14135341ef729ce7f0d885983
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon May 10 10:30:27 2021 +1000

    Bug 28305: Remove doc reference to XML::Simple in C4::Context
    
    We don't need a See Also reference to XML::Simple in the C4::Context,
    especially since Bug 28278 replaced the parsing of koha-conf.xml
    with XML::LibXML.
    
    Test plan:
    1. Apply patch
    2. perldoc C4/Context.pm
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c004934231e4420ef6ff0a2413a08c269ca26e5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 13 10:39:38 2021 +0000

    Bug 28345: Patron attributes no longer have option to select empty class
    
    This patch adds the "empty" parameter to the PROCESS directive which
    builds the "Class" dropdown. This allows the user to choose a blank
    option when creating or editing a patron attribute.
    
    To test, apply the patch and go to Administration -> Patron attribute
    types -> Add patron attribute type.
    
    In the entry form the "Class" dropdown should have a blank option. When
    editing an existing attribute with a class defined, the correct class
    should still be preselected.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d85ae826c64ef43d1f606aceb6eaa6d3174cba52
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 11 13:43:51 2021 +0000

    Bug 28320: Add DB connection check to the SIP SC status message
    
    This patch adds a lookup of the sip user during an SC status, confirming that
    our DB ocnnection is working, and that our user is still valid
    
    Additionally, it adds support for SC status to the sip_cli_emulator and adds basic
    test coverage for the SC status message
    
    To test:
    1 - Apply patch
    2 - Restart SP server
    3 - perl misc/sip_cli_emulator.pl -a localhost -p 6001 -l CPL -m sc_status_request -su term1 -sp term1
    4 - prove -v t/db_dependent/SIP/Message.t
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e14b054b2fd5b6fddc2046b46d3bd431acf689a
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Fri Apr 30 10:00:23 2021 +0300

    Bug 28268: Improve memory usage when indexing authorities in Elasticsearch
    
    Retrieves the complete records one by one to avoid huge memory usage.
    
    Note that this removes the call to GuessAuthTypeCode, but it is done later in Koha::SearchEngine::Elasticsearch::marc_records_to_documents (and was never done if you asked to index a single record with --authid parameter).
    
    Test plan:
    1. Apply patch
    2. Reindex authorities: perl misc/search_tools/rebuild_elasticsearch.pl -a -d -v
    3. Check that indexing completed successfully and results are correct.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25b1ada137806b4b57925bd9f584fcdc73f9eaf2
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Mar 2 23:32:28 2021 +0000

    Bug 27844: Launch koha-worker systemd service as koha linux user
    
    This patch adds the User directive to the koha-worker systemd unit file
    
    Test plan:
    0a. DO NOT APPLY PATCH YET
    0b. Start a Koha testing environment running systemd
    1. koha-worker --stop kohadev
    2. cp debian/templates/koha-worker@.service /etc/systemd/system/.
    3. systemctl start koha-worker@kohadev.service
    4. ps -efww | grep "background_jobs_worker"
    5. Note koha-worker is running as root
    6. APPLY THE PATCH
    7. cp debian/templates/koha-worker@.service /etc/systemd/system/.
    8. systemctl daemon-reload
    9. systemctl restart koha-worker@kohadev.service
    10. ps -efww | grep "background_jobs_worker"
    11. Note that koha-worker is now running as kohadev-koha
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a3049a8be8dc2d22eac796521a4185f1248282a
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri May 7 17:57:58 2021 +0200

    Bug 28302: Forbid CGI::Compile 0.24
    
    CGI::Compile 0.24 has a bug:
    https://github.com/miyagawa/CGI-Compile/issues/25
    
    It can cause weird bugs, like breaking the authority detail display
    after trying to modify an authority.
    
    Steps to reproduce:
    1. Install CGI::Compile 0.24
    2. Restart starman with only 1 worker
    3. Go to the detail page of an authority (authorities/detail.pl)
    4. Go to the edit page (Edit » Edit record)
    5. Check starman logs, you should see "Subroutine build_tabs redefined
    at [...]"
    6. Click on cancel to go back to the detail page, which should now show
    a "blank" authority. Now the only way to get the authority back is to
    restart starman.
    
    Test plan:
    1. Reproduce the bug
    2. Install CGI::Compile 0.25 and restart starman
    3. Make sure the bug is gone :)
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0109dd751b05b3dae0a1ae0cb24575224ae4b0a2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 12:38:52 2021 +0200

    Bug 28220: UI changes
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4de341c2d0fe88c8ac160ba916a86a382be8a6b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 12:31:47 2021 +0200

    Bug 28220: Add more tests
    
    * Add the transaction when a patron is created
    * The changes in merge_and_replace_with prevent the creation of the
    patron and so the attributes if several non-repeatable attributes are
    passed
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e75513933463b21b310af12133484f4b3f376f9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 11:59:23 2021 +0200

    Bug 28220: Add test for updating an existing patron
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7624ab0a96a795aeb7fec3852659c5861b4fef8d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 10:50:07 2021 +0200

    Bug 28220: Handle NonRepeatable
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b369d32bdf3b035e9b3e91f1125c74571ba8a68e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 10:46:24 2021 +0200

    Bug 28220: Handle InvalidType
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa100d8e5e66aa94cd7b41e314514807a56c3178
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 10:35:16 2021 +0200

    Bug 28220: prevent patron to be created if attributes not stored
    
    Using a transaction
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e769cc0044d732197e7b50d62399631df2d89b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 10:13:55 2021 +0200

    Bug 28220: Add tests to import
    
    failure expected, we need to add a transaction
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6b3537ff72262e793cb7a0830a9abcca55012f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 5 17:37:31 2021 +0200

    Bug 28220: Deal with merge
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06fe908a4ed842033f980e58fa62cfb2474a0055
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon May 10 23:33:19 2021 +0000

    Bug 28200: Remove unit test using abbreviated format
    
    This patch removes the unit test that uses the abbreviated format,
    since it's not supported in newer versions of Net::Netmask without
    a workaround.
    
    Test plan:
    0. Set up Koha dev environment on Debian 11
    1. perl t/Koha/Middleware/RealIP.t
    2. Tests should pass
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Alvaro Cornejo <cornejo.alvaro@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ec1b978e0715cbf52964176fe527ffb1cdfde1a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri May 7 14:02:35 2021 -0400

    Bug 28091: Only show for logged in users
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52b4908dd386f05aae91134332e54fb6c390a70c
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Apr 5 17:58:28 2021 +0000

    Bug 28091: add meta content with Koha version to staff client pages
    
    TO test:
    -apply patch
    -go to the Koha staff client and inspect the page, look at the HTML <head>
    -there should be a line that looks like this:
    <meta name="generator" content="Koha 20.12.00">
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1915eb24bb74ec909cee6d208ad2e5f5d58586a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 10 08:34:41 2021 -0300

    Bug 28189: (QA folloq-up) Fix fallback case
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c16e0110e62f57d7eedf07d9ffe3ddc334f4070
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 21 12:18:31 2021 -0300

    Bug 28189: Move swagger file to YAML format
    
    This patch changes the base OpenAPI file (swagger.json) into YAML. The
    motivation for this, is adding more documentation, in Markdown.
    
    JSON doesn't accept multiline strings, so this seems like a good move
    for readability.
    
    To test:
    1. Verify your API is functional
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: No changes, really
    4. Point your browser to /api/v1/.html
    => SUCCESS: Some nicely formatted description of the API can be seen. It
    includes information about x-koha-library.
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2612d32390fc5e6825427799f9ddc1c7f949982
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 12 15:29:01 2021 +0000

    Bug 18989: DBRev 20.12.00.050
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48951c791a376a8a8945c6b9a37ac6bdb3efc3a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 4 12:18:40 2021 +0200

    Bug 18989: Restore hidding items on detail
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Good catch. I forgot this file didn't get the hiding logic refactoring
    yet.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8de3d9a95f2f3a01b5ed309805d81c698ac8e550
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 23 16:55:35 2021 -0300

    Bug 18989: (QA follow-up) Make controllers use Koha::Biblio->hidden_in_opac
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98263bf00973e58ffba50d02b74f2301b80d6649
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 23 15:30:03 2021 -0300

    Bug 18989: (QA follow-up) Make Koha::Biblio->hidden_in_opac aware of OpacHiddenItemsHidesRecord
    
    This patch makes the method aware of the new syspref. It will only eval
    the rules against items if the OpacHiddenItemsHidesRecord syspref is
    set.
    
    Tests are added to reflect this.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Biblio.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7998536866e8be46033507e0dd53f7085b3e4585
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 13 11:19:06 2021 +0200

    Bug 18989: Fix syspref's value selection
    
    See commit 1fe1b704f9a81172f2a6b86367b314572a854d18
        Bug 22824: Fix yes/no vs 1/0
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d43d8c905cc518170fe858f717feab44597cd17a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Jan 29 00:00:34 2021 +0100

    Bug 18989: (QA follow-up) Have new preference default to current behaviour
    
    At the moments the records are hidden when all items are hidden, so
    we need to make sure that we keep this behaviour when the preference
    is added.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c257d7dd3f9872b329a82f5f97111416c653cf21
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jan 24 16:33:55 2021 +0000

    Bug 18989: (QA follow-up) Terminology fixes and linking the system preference in pref description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9a2be7ef7c274c24bf5aa5bf40c6d61387c257d
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 4 14:49:40 2020 +0200

    Bug 18989: Add atomic update
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a0be09d633dbff5e7ca010361394844b3d1e5e3
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 4 14:33:12 2020 +0200

    Bug 18989: Allow displaying biblios with all items hidden by OpacHiddenItems
    
    Bug 10584 made Koha hide biblios for which all items match some criteria (in OpacHiddenItems) so they are hidden.
    Add syspref OpacHiddenItemsHidesRecord controlling this behaviour.
    
    Test plan :
    1)
    1.1) Create some biblio records with one item having damaged=1
    1.2) Define system preference OpacHiddenItems = damaged: 1
    2)
    2.1) Set system preference OpacHiddenItemsHidesRecord to 'don't hide'
    2.2) At OPAC : perform a search showing those records and some more
    2.3) Check you see the all the records
    2.4) For a record with hidden item check you don't get HTTP 404 for : normal view, ISBD view, MARC view
    2.5) Check you can had tags on this record
    2.6) Add record to basket, check you see it in basket
    3)
    3.1) Set system preference OpacHiddenItemsHidesRecord to 'hide'
    3.2) At OPAC : perform a search showing those records and some more
    3.3) Check you don't see the records with hidden item
    3.4) For a record with hidden item check you get HTTP 404 for : normal view, ISBD view, MARC view
    3.5) Show basket, check you see the records with hidden item
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21658717de3d8da3516eb23d2f7869fc6fe88922
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 12 11:25:35 2021 +0000

    Bug 28135: Replace use of input type number in additem.js
    
    This patch corrects in instance where JavaScript is creating an input
    tag with type "number."
    
    To test, apply the patch and make sure the AcqCreateItem system
    preference is set to "when receiving."
    
    - Go to Acquisitions -> Vendor -> Invoices -> Invoice -> Go to receipt
      page -> Receive.
    - On the page for receiving items you should see an add item form.
    - Click the "Add multiple items" button at the bottom of the form.
    - Test the "Number of items to add" field. It should not accept any
      input except numbers.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91fb5d6a1548f7b270163d18b05467c6fd45a7f0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon May 10 12:14:08 2021 +0000

    Bug 23406: Don't translate suppressed authorised values
    
    We have a test in C4/XSLT/transformMARCXML4HTML which is meant to exclude the 942n, however,
    it doesn't work because it checks the $subfield parameter against n
    
    $subfield is an arrayref with the code and value as members
    
    we need to check $subfield->[0]
    
    To test:
     1 - Apply only unit tests
     2 - prove -v t/db_dependent/XSLT.t
     3 - It fails
     4 - Confirm 952$n in default framework is tied ot authorised value 'YES_NO' or do so
     5 - Set OpacSuppression to 'Hide'
     6 - Edit a record in the default template, changing 942$n to 'Yes
     7 - Confirm the record is suppressed in opac
     8 - Note there is no suppression notice in the record in staff client
     9 - Apply second patch
    10 - Reload and confirm staff side shows suppression notice
    11 - Confirm record still suppressed in OPAC
    12 - Edit record, set 942$n to 'no'
    13 - Confirm there is no suppression notice in staff client
    14 - Confirm you can view the record in OPAC
    15 - prove -v t/db_dependent/XSLT.t
    16 - Tests pass!
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1489950a593fb9caf5db52017580302bca7daf75
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon May 10 12:01:55 2021 +0000

    Bug 23406: Unit test
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 894a0ba5cfe2c8eb0f8c06de19b99d1a44d61443
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 4 11:14:51 2021 +0100

    Bug 28283: Add `inputmode="numeric"` to quantity on orderreceive
    
    This patch adds an inputmode to the quantity field on the order receive
    page in acquisitions.
    
    Test plan
    1. Go to Acquisitions -> Vendor -> Invoices -> Invoice -> Go to receipt
       page -> Receive.
    2. Note that the 'Quantity received' input has an inputmode now.
    3. Note that the 'Quantity received' input also has a pattern attribute.
    4. Note that you should not be able to enter non-integer values.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a98759e3b78c1fec0ef7ddc269beccc4eace777c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 11 15:36:13 2021 +0200

    Bug 18112: Use GetAuthValueDropbox from the template
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3c7aa02a02fd21227bb05a22e02e55be186c3fb
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri May 7 18:59:26 2021 +0000

    Bug 18112: (follow-up) add required class to select
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit efe0fe85f2ad7e9759aa9b2f635c96e0472ad299
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue May 4 20:48:18 2021 +0000

    Bug 18112: Add street type to self reg/self mod form
    
    1. Add some values to the ROADTYPE authorized value
    2. Go to PatronSelfRegistrationBorrowerUnwantedField and make sure
       streettype is NOT checked
    3. Go the self reg form, no street type field
    4. Apply patch
    5. Check the self reg form, streettype should be there with all the
       options defined in ROADTYPE a.v.
    6. Check the self modification form, street type should be there.
    7. Make sure PatronSelfRegistrationBorrowerUnwantedField and
       PatronSelfModificationBorrowerUnwantedField hide the field correctly.
    8. Make sure PatronSelfRegistrationBorrowerMandatoryField properly makes
       the field required.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7aac53e9a33763724b7f0a0e9ac69518f0a926b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jan 14 09:02:38 2013 -0800

    Bug 27562: itiva notices break if record title contains quotes
    
    itiva has reported to us that quotes in the title of a record cause the
    call to not be made to the patron. The fix is to remove quotes from
    the title, as quotes are not spoken anyway ( That is, "Queens" and
    "Queen's" are pronounced the same ).
    
    Test Plan:
    1) Set up itiva to send phone notes
    2) Find a record with quotes in the title
    3) Trigger an itiva notice ( checkout, checkin, place hold, etc )
       using the itiva outbound cronjob
    4) View the CSV, note the title has the quotes in it
    5) Apply this patch
    6) Repeat steps 2-3
    7) View the CSV, note the title contains no quotes!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac1fd207aec54b4a0da1f6aa00a3f4f4d0752f07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 11:52:12 2021 +0200

    Bug 13613: Move similar JS code to a function
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d176758fe4139f2c2bb226cdd8e9ed7b305fc4f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 23 12:20:07 2021 +0000

    Bug 13613: (follow-up) Add tooltip when disabled
    
    This patch adds a tooltip to the digest checkboxes when disabled.
    
    When enabled the tooltip is hidden
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6e66b560b37b0300e10e161277ff85b447451ff
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 17 13:49:25 2021 +0000

    Bug 13613: (follow-up) Use more unique classes
    
    This resolves the issue of being unable to save email as it was being hit by the validator
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d15224c78b61e89f22eb44c4819475555808095
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 17 13:25:44 2021 +0000

    Bug 13613: (Bug 22744 follow-up) Remove js handling for 'none'
    
    There was a function and a set of onclick events to handle the 'Do not notify'
    checkboxes.
    
    Those have been removed, so should this code
    
    To test:
    1 - Sign in to opac
    2 - Click on 'your messaging' tab from 'your account'
    3 - Check/uncheck some boxes
    4 - Note error in the console:
        Uncaught TypeError: document.opacmessaging.none2 is undefined
    5 - Apply patch
    6 - repeat
    7 - no more error
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e95ffe8da341b44184dfe1c9b9c2c18d44ff8482
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jan 22 12:36:31 2015 -0500

    Bug 13613: Don't allow digest to be selected without a digest-able transport selected
    
    By default, only the email transport is enabled. This gives the
    messaging preferences the look of having email and digest and two
    options. I.E. to some users it appears that you check email for single
    emails, *or* you check digest for a digest email.
    
    To help remove this possible confusion, the digest mode checkbox should
    be disabled if no digest-able transports are checked for a given notice.
    
    Test Plan:
    1) Apply this patch
    2) For both the staff interface and the opac, note that the digest
       checkbox is disabled any time that no digest enabled transport (
       email, sms if enabled ) is checked for the patron editor.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2da36e3f175de1fcf23bdfbc96b8053f3a0a7d26
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 11:18:55 2021 +0200

    Bug 28293: (bug 20443 follow-up) Fix wrong key in Patrons::Import->generate_patron_attributes
    
    It generates warnings
    Use of uninitialized value in string comparison (cmp) at /kohadevbox/koha/Koha/Patrons/Import.pm line 550, <$fh> line 2.
    
    And does not sort correctly (no fallback on the attribute's value for repeatable attributes)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66d26fa301a8e5375998da513a0a18d21974ce94
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 17 12:21:32 2020 +0000

    Bug 27203: Calculate tax based on ecost if unitprice not set
    
    There is code in populate_order_with_prices that is intended to use ecost over unitprice,
    it just doens't seem to be working.
    
    Making it more explicit seems to take care of the issue.
    
    To test:
    1 - Create a basket
    2 - Add an order line, don't set 'Actual cost: ', but use vendor price
    and a discount.
    3 - Save
    4 - Display all columns, 'Actual cost tax inc.' are GST columns aren't set.
    5 - Apply batch
    6 - Redo 1,2, 3
    7 - Display all columns, GST is calculated correctly, unitprice remains 0.
    
    Signed-off-by: Marjorie <marjorie.barry-vila@collecto.ca>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5d42896b8076e24c6948009d7552b6cdba964f0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 5 15:28:26 2021 +0000

    Bug 27203: Adjust unit tests
    
    It seems the issue here is that the price passed in is a string, and not a number, so the tax
    value is not calculated when no unitprice is provided
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8adfddf2cc08889f3a29e11c81d02e16448536f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 11 08:30:59 2021 -0300

    Bug 28272: issues.notseen needs to be marked as a boolean
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3b50e9e97e917090ce09283807168caaad3de4a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 11 10:46:15 2021 +0200

    Bug 26995: Remove one remaining occurrence in moremember
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3f1ebec619977d60387ab6b182c2919f62ce689
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 11 09:26:38 2021 +0200

    Bug 28272: Add unseen_renewals for checkouts
    
     t/db_dependent/api/v1/checkouts.t ...................... 7/93
     #   Failed test '200 OK'
     #   at t/db_dependent/api/v1/checkouts.t line 198.
     #          got: '500'
     #     expected: '200'
    
     #   Failed test 'exact match for JSON Pointer ""'
     #   at t/db_dependent/api/v1/checkouts.t line 198.
     #     Structures begin differing at:
     #          $got->{unseen_renewals} = Does not exist
     #     $expected->{unseen_renewals} = '0'
     t/db_dependent/api/v1/checkouts.t ...................... 88/93
     #   Failed test '200 OK'
     #   at t/db_dependent/api/v1/checkouts.t line 218.
     #          got: '500'
     #     expected: '200'
    
     #   Failed test 'exact match for JSON Pointer ""'
     #   at t/db_dependent/api/v1/checkouts.t line 218.
     #     Structures begin differing at:
     #          $got->{max_renewals} = Does not exist
     #     $expected->{max_renewals} = '1'
     # Looks like you failed 4 tests of 93.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 741d8a0e5373be3150572e547518974ca47ba565
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 10 17:44:23 2021 -0300

    Bug 28272: Fix many things...
    
    This patch could've been splitted into several. But, overall, adding
    additionalAttributes: false made the API fail on requests that send
    extra info (i.e. cases in which a dev added an attribute to the
    underlaying class/table and forgot to deal with it on the API (either
    adding it on the spec, or removing it from the response using
    Koha::Class::to_api_mapping).
    
    - Koha::Account::Line was missing: credit_type, interface, status,
      register_id and credit_number. I decided to call cash_register_id, and
      to remove credit_number from the response.
      FIXME: We need consensus on a name for the credit_number attribute, and
      add it to the response on the API. It deserves a separate bug. Too
      opinionated for a last-minute fix.
    - Koha::Club::Hold::add was returning bad auto-calculated values on
      field that (also) wasn't specified on the spec. Needs a test.
    - import_batch_profile had a typo: id_profile vs. profile_id.
    - error.json: In this case I reverted the change. This is because some
      routes are adding more 'info' with the error message, and I consider
      this should be done in a more generic approach. Time is required for
      us to think about this. So don't break the API in the meantime.
      FIXME: Implement a generic way to add a payload to error messages on
      the API. Maybe something to work on while on bug 28020.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/
    => FAIL: Lots of tests fail
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68bb349593aa8bbbf2b8a0e7dad4a875a56bcc9f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 17:55:30 2021 +0200

    Bug 28272: Fix note_seen, desk_id, cancellation_reason
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e7a3b494493de1ae39577b091cc4864cd2a436e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 13:27:04 2021 +0000

    Bug 28108: DBRev 20.12.00.049
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e037c082dd12cb53fcdc58ee32393f3ff0791b01
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 10 14:34:49 2021 +0100

    Bug 28108: (QA follow-up) Fix syspref text
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd2d257d2397704a85c171297fd2c221a7bfa3a9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 10 14:21:46 2021 +0100

    Bug 28108: (QA follow-up) Move 'ORDER' back into 'ACQUISITIONS'
    
    With the re-introduction of 'AQUISITIONS' as a logging module in Koha,
    it makes sence to move the ORDER notice logging back into that module
    whilst leaving the other 'CLAIMS' notices under their own logging module
    code.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc2f433a61a1e376f0654ce463d82e4c44f03463
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 12:12:47 2021 +0200

    Bug 28108: Replace one remaining occurrence
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93c1873069a4783da64abd6a6fb3f3249568f721
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue May 4 09:34:08 2021 +0000

    Bug 28108: (QA follow-up) Add actions to log viewer
    
    The following actions were missing from the template,
    so the code showed instead of a translatable description:
    
    * ACQUISITION CLAIM
    * ACQUISITION ORDER
    * SERIAL ORDER
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56bacdd389f53795d501ab8e929075c98921393b
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue May 4 09:07:10 2021 +0000

    Bug 28108: (QA follow-up) Make the system preference description more precise
    
    There has been some confusion on what the pref really covers, so
    I hope this helps to resolve.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a3c3aad6f5e398cae82962910412b146c9b3809
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 7 14:25:24 2021 +0100

    Bug 28108: Fix filtering
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aae9f03e7919e1c262b8cee8f347cc8ecfa62a8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 10 14:20:13 2021 +0100

    Bug 27625: Add currencies to custom.sql
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4cd9d312b43f4cbace1f1e603cfe7bacb6a0d962
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 10 14:16:07 2021 +0100

    Bug 27625: Fix sample_notices.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec8c63550e0252c6b26cd192e6df59ce1f758825
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 10 14:15:47 2021 +0100

    Bug 27625: Remove uk-UA installer data
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12e7e17220d373ae9b25a9457245a8233206dabd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 8 11:46:10 2021 +0100

    Bug 27624: Add some stuffs to ru-RU custom.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02c60a1f12d161a9b1bbc40c816bbb9aecb91eae
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 8 11:37:01 2021 +0100

    Bug 27624: Fix sample_notices.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f41f1b36e733a1119f117f6e80f652a528260d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 11:55:35 2021 +0100

    Bug 27624: Remove ru-RU installer data
    
    With installer data in YAML format and it's translations,
    there are no need for localized installer files.
    
    This patch removes ru-RU installer files.
    
    1) Apply the patch
    2) Translate to ru-RU
       cd misc/translator
       ./translate update ru-RU
       ./translate install ru-RU
    3) Do a clean install using ru-RU,
       check no problems during install
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 444dd28b02d3bd65dc03eb4b2ce7ec8925a14712
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 8 11:32:06 2021 +0100

    Bug 27623: Add PLN currency to custom.sql
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7457303704ac11ad80547aac1f4abc3a62047d1b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 8 11:31:48 2021 +0100

    Bug 27623: Fix sample_notices.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a6459bd065380c003bc04ebe641a70fb9354354
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 11:57:42 2021 +0100

    Bug 27623: Remove pl-PL installer data
    
    With installer data in YAML format and it's translations,
    there are no need for localized installer files.
    
    This patch removes pl-PL installer files.
    
    1) Apply the patch
    2) Translate to pl-PL
       cd misc/translator
       ./translate update pl-PL
       ./translate install pl-PL
    3) Do a clean install using pl-PL,
       check no problems during install
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe9fed3efcc4db6a037d7db68b886d3480c4e9b8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 10 08:00:54 2021 +0100

    Bug 27621: Keep COUNTRY and LANG
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef6d7b48bac09708a580259cc0da63cd3c568d09
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 13:25:09 2021 +0100

    Bug 27621: Remove it-IT installer data
    
    With installer data in YAML format and it's translations,
    there are no need for localized installer files.
    
    This patch removes it-IT installer files.
    
    1) Apply the patch
    2) Translate to it-IT
       cd misc/translator
       ./translate update it-IT
       ./translate install it-IT
    3) Do a clean install using it-IT,
       check no problems during install
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32c1cf0f6fc85849a9deaae990a24f80857f92b2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 3 18:08:49 2021 +0000

    Bug 28179: (follow-up) Remove console.log
    
    This patch removes a "console.log" from detail.tt and replaces it with
    similar output to the user. It will probably never be triggered, but
    better to handle it gracefully than have a hidden log.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7034f29df744ac7f7c7b84e8908864d9c4ab1f0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 23 13:52:29 2021 +0000

    Bug 28179: (follow-up) Updates to styling of lightbox controls
    
    This patch fixes a bug and adds some style changes which I think are
    nice. The bugfix is to change the z-index of the lightbox footer so that
    it isn't hidden when there is a language menu in the footer.
    
    The cosmetic changes replace the Chocolat image icons with new SVG
    assets based on Bootstrap Icons (https://icons.getbootstrap.com/). The
    color changes I think help the controls to be more visible.
    
    License information about Bootstrap Icons has been added to the About
    page.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ac89ca85586b2ef99f1b06ca66ba1785a0a076e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 20 16:35:39 2021 +0200

    Bug 28179: Adjust chocolat.js to display href
    
    In order to display link in the description we need to adjust
    chocolat.js
    
    Maybe this needs to be reported upstream
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50a4f9834c83c2511b4b051593880782a6d6c4d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 19 11:37:55 2021 +0200

    Bug 28179: Add a lightbox gallery to display cover images - detail page, staff interface
    
    This patch adds the ability to display the cover images of a
    bibliographic record in a gallery. Cover images attached to items can
    also be displayed in separated galleries.
    
    Test plan:
    All the cover images are affected, all the different sources will be
    tested.
    All the steps will be done on the same bibliographic record.
    1. Local cover images
     a. Turn on LocalCoverImages and AllowMultipleCovers
     b. Add several local cover images to a bibliographic record
     c. Add several local cover images to an item
     d. Click on an image and confirm that it is displayed in a gallery and
     you can navigate see all the images attached to the bibliographic
     record
     e. Same for items
    2. Adlibris
     a. Turn on AdlibrisCoversEnabled
     b. Edit the biliographic record and add an ISBN that will return a
     cover image for this service (9780670026623 for instance)
     c. Display the cover images in the gallery
     d. Note the link to the adlibris.com website at the bottom
    3. Amazon
     a. Turn on AmazonCoverImages
     b. Display the cover images in the gallery
    4. Coce
     a. Turn on IntranetCoce, set CoceHost to "http://coce.tamil.fr:8080"
     and select some values for CoceProviders.
     b. Display the cover images in the gallery
    5. Custom cover images
     a. Turn on CustomCoverImages and set CustomCoverImagesURL to https://covers.openlibrary.org/b/isbn/{isbn}-M.jpg
     of anything else meaningful
     b. Display the cover images in the gallery
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17e9e06bd61983fa46bfb8b3f8a0ce03f17488e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 19 11:38:33 2021 +0200

    Bug 28179: Add the Chocolat gallery lightbox JS library
    
    Chocolat is a lightbox JS library.
    https://chocolat.insipi.de
    https://github.com/nicolas-t/Chocolat
    https://chocolat.gitbook.io
    
    Why Chocolat? It's released under the GPL v3 license, easy to use,
    configure and extend, and is still maintained/active.
    
    (and it has a nice name)
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d50a868f5219599425ad37d75f2d9bb3ce66b61
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sun Apr 25 04:02:04 2021 +0000

    Bug 27876: changed Your tags title to caption in OPAC
    
    On the tags page, changed the <h2> "Your tags" to a <caption> to reduce
    heading redundancy but keep the information available.
    
    To test:
    1) Apply patch
    2) Go to OPAC
    3) Go to opac-tags.pl
    4) Ensure that there is a caption above the table that says "Your tags"
    and that it is not a heading tag
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64a188a423eadfe067f46c4151fd79977e6186d8
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Fri Apr 23 03:18:48 2021 +0000

    Bug 27876: took away redundant heading in OPAC full serial issues
    
    Changed <h2> to <h1> and deleted current <h1> to eliminate redundancy.
    
    To test:
    1) Apply patch
    2) Go to OPAC
    3) Go to opac-serial-issues.pl
    4) Check there is only one main heading and it is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5eab1c83edb3b95c49491b7585dfa0a2fbf9f484
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Fri Apr 23 03:09:20 2021 +0000

    Bug 27876: added sr-only to caption of table in Charges page
    
    Made the "Your charges" caption of the table in the Charges page of the
    OPAC hidden and for screen-readers only so that it takes out redundancy.
    
    To test:
    1) Apply patch
    2) Go to OPAC
    3) Go to Charges page
    4) Ensure that there is no visible caption above the table that says
    "Your charges"
    5) Check that the code has the caption still with sr-only class
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35b71040cf9b7e617fc355628654e756d5777eb5
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Fri Apr 16 11:44:14 2021 -0700

    Bug 28160: Values from 150$a aren't prefilled in z39.50 search form from an existing authority record
    
    For names and uniform titles, when you do a z39.50 search from an authority
    record, we prefill what's in the relevant tag's subfield a in the search
    form, but for subjects, we don't, both because GetMandatoryFieldZ3950 thinks
    the param is topic when it's actually subject, and because
    z3950_auth_search.tt doesn't bother putting the value of &subject into the
    form.
    
    Test plan:
    
    1) Authorities - New authority - Topical Term
    2) Tab 1, click on HEADING-TOPICAL TERM to expand subfields
    3) In subfield a, type goats
    4) Click Z39.50/SRU search and verify that the Subject heading search field
       has goats prefilled
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d3ee964c9cb2a2737efc1feb184f64911fb8fbf
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Fri Apr 16 09:55:25 2021 -0700

    Bug 28159: URI-encode existing values put into query string for z39.50 authority search
    
    When you trigger a z39.50 search from an existing authority record,
    Koha prefills the search form with the value in the record. But because
    that value passes through a URL, if it isn't URI-encoded characters like
    & or ; will cut off the value.
    
    Test plan:
    1) Authorities - New authority - Corporate Name
    2) Tab 1, click "HEADING-CORPORATE NAME" to expand subfields
    3) Subfield a, type foo & bar ; baz
    4) Click Z39.50/SRU search
    5) Ensure the whole string appears in the Author (corporate) field in
       the popup
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 685fcb1880b5be44283620a0f7eacc3f2064680d
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Apr 27 21:23:55 2021 +0000

    Bug 28241: Fix regex to allow for content before and after comma
    
    1. Set up the OPACNoResultsFound with the {QUERY_KW} placeholder.
    2.Do a search with a comma that will return no results. Like "King, Martin Luther". If the returns results add some additional characters to the search until no results are returns.
    3. Look at the #noresultsfound HTML element. Anything before (or after) the comma is omitted. So the placeholder looks something like 'Martin Luther' instead of 'King, Martin Luther'.
    4. Apply patch
    5. Try the search again, you should see the content before and after a comma
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e61c657c638c83a35a5b8f724c63641220ead0c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 15:50:23 2021 +0200

    Bug 26995: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 690b073478b04c7c801058b49f85275281c502d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 15:41:50 2021 +0200

    Bug 26995: Remove occurrences in sample_patrons.yml
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a36435835fffe4b113d737c1d38acd55eff921f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 12:45:32 2021 +0000

    Bug 26995: DBRev 20.12.00.048
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1131bb687f14fef7b4cb5f3b194711e85f9227af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 14:27:58 2021 +0200

    Bug 26995: Fix SQL syntax error on the about page
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c3e7f78b536bd5103e8ae563a45872b85b531bc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 4 13:48:23 2021 +0100

    Bug 26995: (QA follow-up) Fix logic in database update
    
    The logic was reversed.. if the column exists we want to delete it ;)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cc8a77c287666ed878ea58f17216793f52ce224
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jan 21 06:59:00 2021 -0500

    Bug 26995: Remove references to relationship column
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca0e7541ecdff13ada9ba8ffbd992c963959d30f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jan 21 06:58:45 2021 -0500

    Bug 26995: Drop column relationship from borrowers, deletedborrowers and borrower_modifications tables
    
    Bug 14570 added a borrower_relationships table but it didn't remove the relationship column from the following tables:
    - deletedborrowers
    - borrowers
    - borrower_modifications
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc09de362e927668eb06e8ec90493ed5c7fd17b6
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Apr 30 21:40:17 2021 +0000

    Bug 28266: fix spelling mistake on registers.tt
    
    TO test:
    1. look at the cashup modal, see the wrong spelling of 'recieved'
    2. Apply patch and see the right spelling
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68266cc1b4e80589c728b315901fcfac2f939ac8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 14:07:14 2021 +0200

    Bug 28286: Replace < 1 with <= 0
    
    It's the same but read more natural
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17fbf29d0e369ba0df7c38eca69f7a0a5d159b44
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Wed May 5 16:30:26 2021 +0300

    Bug 28286: show "Place hold" button if item is holdable
    
    This patch adds "filter_by_for_hold" method in "Items.pm" and
    uses it in "cat-toolbar.inc" instead of "filter_by_for_load".
    
    Also this patch removes "filter_by_for_loan" method.
    
    To reproduce the bug:
    1) go to /cgi-bin/koha/catalogue/detail.pl?biblionumber=XXX     that has
    item with notforloan value set as "Ordered" (-1)
    2) see that button "Place hold" is not present
    3) apply the patch
    4) refresh the page and ensure that "Place hold" button appears even if
    item is "Ordered"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6754e92c1cab51cf4052cc9278e28ae842e904e7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 8 20:12:28 2021 +0000

    Bug 25760: (bug 15422 follow-up) Display record with hold ratio greater than or equal to the value entered
    
    On bug 15422 we made it so that only holds with copies to buy to acheive the holds ratio
    showed
    
    Users have reported that they want to see record where there are 0 copies to buy i.e.
    the holds ration matches the value entered
    
    This patch changes the criteria for returning holds to be if the ratio for a given title
    is equal to or greater then the ratio specified in the form
    
    I also renamed 'ratiocalc' to 'copies_to_buy' since that is what is contains
    
    Test plan:
    1. Create bibliographic records with 1, 2 and 3 items
    2. Place 1 hold on each of them
    3. Go to the Hold ratios report and search with ratio = 1, 2 then 3
    4. You expect to see:
       the title with 1 item with ratio 1
       nothing otherwise
    5. Place another hold on each of the record
    6. Repeat 3 you expect to see:
       titles with 1 or 2 items with ratio 1
       title with 1 item for ratio 2
       nothing with ratio 3
    7. Place another hold on each of the record
    8. Repeat 3 you expect to see:
       titles with 1 or 2 or 3 items with ratio 1
       title with 1 item or 2 items for ratio 2
       nothing with ratio 3
    9. Make sure there is no regression in the test plan of bug 15422
    
    Comments from Frank Hansen:
    
    Some comments.
    When I adding the third hold on each record in step 7, It will result in
    the following result:
    
    titles with 1 or 2 or 3 items with ratio 1
    title with 1 items with ratio 2 because the title with 2 items will get
    a ratio of 1.50 and not 2.
    title with 1 items with with ratio 3
    
    Signed-off-by: Frank Hansen <frank.hansen@ub.lu.se>
    Signed-off-by: Galen Charlton <gmc@equinoxinitiative.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b26e5575049738e6ce18eb7a259c64db1ff1334
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 22 13:11:59 2021 +0100

    Bug 28181: Filter out archived debit types in point of sale
    
    The filter for only displaying un-archived debit types on the point of
    sale page had been missed.
    
    NOTE: It would be beneficial to move this to a default filter in the
    Koha:: objects search method for both debit_types and credit_types.. but
    I opted for the quick fix here to resolve the bug and will impliment
    default filtering in a subsequent enhancement bug.
    
    Test plan
    1/ Archive a debit type that is marked as 'Can be sold'
    2/ Go to the point of sale page and confirm the above debit type appears
    3/ Apply the patch
    4/ Confirm the debit type no longer appears in the point of sale page.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a197a09febd996176c841fa64080a663a4122e60
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 12:08:21 2021 +0200

    Bug 28229: Count only if needed
    
    We don't need to count the number of clubs if we selected a patron or
    club already
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4a8902b79d7cae21cf2647b06a24ef36333810c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 7 11:20:48 2021 +0000

    Bug 28229: (follow-up) Adjust for easier translation
    
    I think moving the [% IF %] out of the HTML tag makes for easier
    translation.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8a664fe7d3fe210b6f2d798b1ce5c0c0f86f6f0
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed May 5 21:27:25 2021 +0000

    Bug 28229: Only show clubs on request.tt if clubs exist
    
    1. Have no existing clubs
    2. Apply patch
    3. Go to request.tt and you will not see the club tab or any mention of clubs
    4. Create at least 1 club
    5. Go back to request.tt and now see the tab for clubs
    6. Make sure you can place holds as an individual with and without clubs.
    7. Make sure you can place holds for clubs.
    8. rejoice and sign-off
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b65d099d7ca1d280d355f3f06c963e6e1a010fb
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Sun May 2 13:37:38 2021 +0200

    Bug 28276: Do not fetch config ($KOHA_CONF) from memcached
    
    memcached address and namespace are in $KOHA_CONF, so it is required to
    read it before being able to access the cache. And after that,
    configuration is kept in memory forever. Storing this in memcached is
    useless and even counter-productive, since Koha reads both the file and
    the cache
    
    This patch addresses this issue by removing the cache-related code from
    C4::Context->new.
    It means that C4::Context->new will always read the configuration file,
    so this patch also replaces inappropriate calls to
    C4::Context->new->config by appropriate calls to C4::Context->config
    
    It also fixes a bug where C4::Context->new would ignore the filepath
    given in parameters if there was something in cache.
    
    It also removes a problematic call to Koha::Caches->get_instance.
    Because this call was outside of any subroutine, it would have happened
    before the initialization of $C4::Context::context (which happen in
    C4::Context::import)
    
    Test plan:
    1. Do not apply the patch yet
    2. Add the following line at the beginning of Koha::Config::read_from_file
        warn "read_from_file($file)";
       This will allow you to check how many times the file is read.
    3. Flush memcached and restart starman
    4. Check the logs, you should see "read_from_file" a bunch of times
    5. Apply the patch
    6. Re-add the line from step 2
    7. Flush memcached and restart starman
    8. Check the logs, you should see "read_from_file" only once
    9. Make sure the memcached config from $KOHA_CONF (memcached_servers,
       memcached_namespace) is taken into account by checking the About page
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14ab5abf442209e87701aa51b7c2ce79264031f1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 6 15:11:51 2021 +0200

    Bug 28272: Prevent api spec to accept extra parameters
    
    Some of our definition files are missing { additionalProperties: false }
    We must have it to make sure all properties are defined and prevent the
    spec to accept extra parameters (being more strict but also allowing to
    catch errors more easily)
    
    grep -rL additionalProperties api/v1/swagger/definitions/*.json
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b66fbf093505b61089e715d52c168c50172434f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 9 16:20:36 2021 +0100

    Bug 26471: Remove invalid Map URL
    
    There is a warning in the console:
    Error en el mapeo fuente: SyntaxError: JSON.parse: unexpected character at line 1 column 1 of the JSON data
    URL del recurso: http://kohadev-intra.mydnsname.org:8081/intranet-tmpl/lib/datatables/datatables.min_20.1200011.js
    URL del mapa fuente: pdfmake.min.js.map
    
    https://developer.mozilla.org/en-US/docs/Tools/Debugger/Source_map_errors
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26a7219495c162fedb9258f02bda39e15f01c18d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 5 18:41:47 2021 +0000

    Bug 24154: Adjust assignment
    
    The code seems to work either way
    We have a mix in our code:
    git grep "}) %]"
    
    Using '=>' over '=' does look nicer
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c05872ff1da1a94bf7cd66d279fc02ac9748c9a3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 23 10:34:06 2021 +0000

    Bug 24154: (follow-up) Make parameter and variable more explicit, add tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c2a4295a22d0397b8b624454d70d155f623a7e4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 16 16:59:44 2021 +0000

    Bug 24154: Get rules rather than values to determine if set or not
    
    Template plugin CirculationRules.Search returns "" if a rule doesn't
    exist or if the rule exists but is set to ""
    
    To get more info, we add a 'want_rule' parameter and use that to test
    if defined but blank
    
    To test:
    1 - In circulation rules set the 'Default checkout, hold and return
        policy' without setting values
    2 - Unset it
    3 - Notice there is no visual difference
    4 - Apply patch
    5 - Reload the page
    6 - note there is no 'Unset button' and first column says 'Not set'
    7 - Save the rule with no values
    8 - Now 'Defaults' is displayed and the unset button exists
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c74f6848ed119b2a2fff687f3bddf87d23e20fd7
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 1 11:04:35 2021 +0200

    Bug 24564: Use the same tab as the other subfields within a field
    
    For each subfield added, we check if other subfields exists in the same
    field. If that's the case we use the same tab as the first subfield
    found.
    
    Test plan:
    1. Find a biblio subfield in
       misc/migration_tools/ifla/data/biblio/default.yml that doesn't exist
       in your default biblio MARC framework (or delete one). The field
       should exist and have other subfields with a tab set.
    2. Change the tab of all subfields within that field it's different from
       what's in the .yml file
    3. Run misc/migration_tools/ifla/update.pl
    4. Verify that the subfield has been added and have the same tab as
       others subfields
    5. Do the same for authorities (files are in
       misc/migration_tools/ifla/data/auth/)
    
    Signed-off-by: Koha team <koha@univ-lyon.fr>
    
    Signed-off-by: sonia <sonia.bouis@univ-lyon3.fr>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f522d8ad4d0ce4a05250063bcc1dcba9fabd7ee
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Mar 31 10:44:48 2021 +0200

    Bug 24564: Do not modify the tab of existing subfield in ifla/update.pl
    
    Test plan:
    1. Find a biblio subfield in
       misc/migration_tools/ifla/data/biblio/default.yml that you have in
       your default biblio MARC framework (or create one).
    2. Change the tab of this subfield so that it's different from what's in
       the .yml file
    3. Run misc/migration_tools/ifla/update.pl --force
    4. Verify that the tab of this subfield has not been changed.
    5. Do the same for authorities (files are in
       misc/migration_tools/ifla/data/auth/)
    
    Signed-off-by: sonia <sonia.bouis@univ-lyon3.fr>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 539fc6809aec8db9426a9652c182174c70edc502
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 11:22:29 2021 +0100

    Bug 27756: Fork background jobs to prevent memory leak
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f412878b64da7c780ba641c4491150ccc52d2f57
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 12:38:35 2021 +0000

    Bug 23215: DBRev 20.12.00.047
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 523b4533f8878d81857fdbe9558ed430eefcc0d5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 5 10:16:50 2021 -0300

    Bug 23215: Remove traces of the PayPal feature
    
    This patch removes the PayPal payments feature. It has been moved to
    its' own plugin.
    
    To test:
    1. Apply this patches
    2. Run:
       $ updatedatabase
    => SUCCESS: Database updates correctly
    3. Run:
       $ koha-mysql kohadev
       > SELECT * FROM systempreferences WHERE variable LIKE 'paypal';
    => SUCCESS: No results
    4. On the sysprefs, OPAC section
    => SUCCESS: No PayPal-related sysprefs show up
    5. Add some charges to your patron
    6. In the OPAC, log in and see your charges
    => SUCCESS: Nothing broken
    7. Install the PayPal plugin [1] or any other payment plugin
    8. Restart plack (mandatory for the PayPal plugin)
    9. Set some random data in the config (or better, real sandbox testing
       data)
    10. Go to the OPAC's account page and try to pay your debts (use the
        checkbox to select lines)
    => SUCCESS: The PayPal payment method shows, you can click the button,
        it fails due to bad config, but things work as expected.
    11. Sign off :-D
    
    [1] https://gitlab.com/thekesolutions/plugins/koha-plugin-pay-via-paypal/-/releases
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37a10f012bfa19676cb7ddaa8e359bc6315e3085
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 5 10:16:18 2021 -0300

    Bug 23215: Remove PayPal-related sysprefs
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67137b3f3efa58f506f3172146130992b0baa230
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed May 5 17:20:38 2021 +0300

    Bug 28291: Make koha-translate script produce valid UTF-8 YAML files
    
    We had two problems in the LangInstaller.pm module:
     1) the PO file was read as bytes instead of as a UTF-8 text stream
     2) The YAML file being outputted was double encoded, once by setting
        the file handle to output UTF-8 and other time in the DumpFile
        function internally
    
    To test:
    1. Before applying patch do the following
    $ cd misc/translator
    $ ./translate update pl-PL
    $ ./translate install pl-PL
    $ cd -
    $ less installer/data/mysql/pl-PL/marcflavour/marc21/mandatory/authorities_normal_marc21.yml
    2. Notice the output of the authorities_normal_marc21.yml contains
    invalid looking UTF-8 characters
    3. $ git clean -d -f # to remove the old translation files
    4. Apply patch and repeat the steps and notice the
    authorities_normal_marc21.yml contains valid looking UTF-8 characters
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 311b0b3c21ac16368d352d645ae7980590094124
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 5 11:50:16 2021 +0200

    Bug 28281: Add tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2810dc2aa1e5095197ff102f6af3e1930e33379
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed May 5 12:12:44 2021 +0300

    Bug 28281: Remove double decoding when importing installation data
    
    The YAML::XS::Load and YAML::XS::LoadFile functions already decode the
    YAML to Perl objects/strings, therefore decoding the output yet
    another time is not needed and causes an error to happen.
    
    To test:
    
    1. Go through the following steps and notice without this patch the
    error happens and with this patch it doesn't:
    
    $ koha-mysql kohadev < installer/data/mysql/kohastructure.sql
    $ restart_all
    $ ./translate update pl-PL
    $ ./translate install pl-PL
    $ restart_all
     --> Go to the Koha web installer page and select pl-PL as the installer
     language, click through it and notice it gives following error at the
     MARC21 step:
    
     Cannot decode string with wide characters at /usr/lib/x86_64-linux-gnu/perl/5.24/Encode.pm line 202
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1426cfce0e63409f7130fe9e7d510c90c11a356c
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Fri May 7 09:58:09 2021 +0200

    Bug 28298: fix DB update 19.12.00.076
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34858be03581b68ebfdf55ae253b49b6d87cb19c
Author: Victor Grousset <victor@tuxayo.net>
Date:   Mon May 3 22:42:15 2021 +0200

    Bug 27594: (follow-up) don't display "Copy link[...]" when not possible
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d10b9f16fe339776fdfe484a8d9ac67385d0d3b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 9 15:44:28 2021 +0000

    Bug 27594: (follow-up) Check for secure context
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fa5632b905ceca5db77197b39987265631c5572
Author: Victor Grousset <victor@tuxayo.net>
Date:   Tue Apr 6 20:10:22 2021 +0200

    Bug 27594: (QA follow-up): Display message only if copy worked
    
    And check if writeText is available.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb8f254ebc3b3ed392483cd4008b7b9573c2f832
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 2 14:10:49 2021 +0000

    Bug 27594: Add access to public download link for publicly-accessible uploads
    
    This patch adds a link to the display of publicly-accessible uploads so
    that the user can copy the public link. This will hopefully lead to
    easier use of sound file uploads in the Audio Alerts system.
    
    To test, apply the patch and go to Tools -> Upload.
    
    - If necessary, upload a file with the "Allow public downloads"
      checkbox checked.
    - Upon upload you should be shown the results of your upload in a table
      with the file details.
    - In the "Public" column you should see that "Yes" is a link.
      - When you hover your mouse over the link you should see a tooltip,
        "Copy link to this file."
      - When you click the link the tooltip should say "Link copied to the
        clipboard."
      - Verify that the correct link has been copied.
    - Test uploading a file which is not publicly-accessible.
      - Confirm that the information in the "Public" column says "No" and is
        not a link.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Bug 27594: (QA follow-up): Use clipboard API
    
    While the Clipboard API doesn't
    have 100% coverage (https://www.caniuse.com/?search=clipboard), it has
    enough coverage for the "copy" operation that it can be counted on for
    use in the staff interface.
    
    This patch removes the global copyToClipboard function and replaces it
    with a call to ndavigator.clipboard.writeText() in the template.
    
    To test, follow the previous test plan and confirm that the public
    download link is still copied correctly to the clipboard.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33c8d6f175bf5c5f2a2f08db9e95d363027c276a
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Thu Feb 25 10:59:24 2021 +0000

    Bug 27793: Store FTX free text in vendor note
    
    This is important for proquest ordering to distinguish types of
    material.
    
    FTX segment from quote is stored as vendor note.
    Contents of vendornote are included in the order FTX segment.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9d97e9e652a0b6bb70ac9a531fe71bff74cf34d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 11:31:21 2021 +0200

    Bug 28278: Uncomment and test access_dirs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a892f655efae77b302c9cd5978d4881eac14589c
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 30 17:13:48 2021 +0200

    Bug 28278: Improve $KOHA_CONF parsing speed by using XML::LibXML
    
    - Without the patch:
    
    $ hyperfine --warmup 1 \
      'perl -MKoha::Config -e "Koha::Config->read_from_file(\$ENV{KOHA_CONF}) for (1..1000)"'
    
      Time (mean ± σ):      3.585 s ±  0.018 s    [User: 3.531 s, System: 0.049 s]
      Range (min … max):    3.547 s …  3.612 s    10 runs
    
    - With the patch:
    
    $ hyperfine --warmup 1 \
      'perl -MKoha::Config -e "Koha::Config->read_from_file(\$ENV{KOHA_CONF}) for (1..1000)"'
    
      Time (mean ± σ):      1.122 s ±  0.028 s    [User: 1.104 s, System: 0.014 s]
      Range (min … max):    1.095 s …  1.189 s    10 runs
    
    Test plan:
    1. Apply the first patch (the one with the unit tests) and make sure
       tests pass: `prove t/Koha/Config.t`
    2. Apply the rest of the patches and verify that tests still pass:
       `prove t/Koha/Config.t`.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d19e85d04f8d26deba37533b0a1d516dd42d78f
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 30 17:11:14 2021 +0200

    Bug 28278: Add unit test for Koha::Config::read_from_file
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e74d86a3431558b97d2fcd0922467e265cb749c3
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Mon Feb 1 13:25:04 2021 +0200

    Bug 27584: Refactor OAI-PMH paging to improve performance
    
    Includes the following optimizations:
    - Use next biblionumber instead of large offset in the queries.
    - Use unions instead of subqueries
    - Avoid fetching item timestamps when items are not included.
    
    Test plan:
    
    1. Without the patch, try harvesting a Koha database with (and without for good measure) `include_items: 1` in the OAI-PMH configuration file pointed to by preference OAI-PMH:ConfFile and take note of performance. For useful metrics the database must be large enough to not fit in InnoDB buffers or OS file cache.
    2. Apply the patch.
    3. Run tests: prove -v t/db_dependent/OAI
    4. Try again the harvesting from step 1 and compare performance with step 1.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3139750d6006ec0cc291285f633d6d0374583fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 14:17:00 2021 +0200

    Bug 14723: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca06eccb6a7e26f112fb8e3697dff3b68bebbd3d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 11:46:52 2021 +0000

    Bug 14723: DBRev 20.12.00.046
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 276ab0a48963da6723a586d1508a51e7596d0958
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 11:49:40 2021 +0200

    Bug 14723: Make DB rev idempotent
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ced2b3a4f4f1ef0f6dbdb0a26b0e8b2209e8b5e
Author: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
Date:   Mon May 3 10:37:02 2021 +0300

    Bug 14723: Use DATETIME instead DATE
    
    Letters.t tests failed since time_queued didn't
    include timecode. Use DATETIME when inserting
    into message_queue.
    
    To test prove t/db_dependent/Letters.t
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68ccd536f927cfd1063b2fa900441eba41bb6e0d
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Apr 29 09:48:12 2021 -0400

    Bug 14723: (QA follow-up) Fix typo
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2405a21d6ec3841e51644a682f0620acf21e4878
Author: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
Date:   Wed Apr 28 08:55:02 2021 +0300

    Bug 14723: Add error codes and replace strings with them in template
    
    This patch adds error codes for delivery notes and replaces English
    strings with them in template.
    
    To test confirm everything works as intended.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e58256d7f341476fae5a25edc9ffeccf43acc02
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Thu May 14 12:32:13 2020 +0300

    Bug 14723: Make delivery notes translatable
    
    Delivery notes weren't translatable. This patch adds
    them in notices.tt. If note is Mail::Sendmail error generic
    'Error occured while sending email' is shown.
    
    Also fixes MySQLisms and adds AFTER to atomicupdate file.
    
    To test prove t/db_dependent/Letters.t
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: Stina Hallin <stina.hallin@ub.lu.se>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa450994422fb62742e3b20931c6f2f07c638602
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Wed Apr 12 11:14:44 2017 +0000

    Bug 14723: Additional delivery notes to messages
    
    This patch adds additional delivery notes to messages in message queue as there
    can be multiple reasons for a delivery to fail.
    
    Currently in message_queue we are given only two delivery statuses for messages,
    "sent" and "failed". When the status becomes failed, we have no idea why it fails.
    
    This feature can be useful with SMS gateway providers. Many SMS gateways inform
    the application the reason of SMS delivery failure. With this feature, this
    information can now be stored. As well as for emails, instead of simply logging
    failures, we can now store the reason of failure directly into the message row
    of message_queue.
    
    Test plan:
    
    1. Enable EnhancedMessagingPreferences syspref
    2. Find a borrower with notices at members/notices.pl
    3. Observe that there is no column for Delivery notes
    4. Apply patch and run the given database update
    5. Repeat step 1.
    6. Observe that there is now a column for Delivery notes
    
    Sponsored-by: Hypernova Oy
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a41fb3e4b81b156b7debd7de48a7c9212e52e49
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 11:46:52 2021 +0000

    Bug 21249: DBRev 20.12.00.045
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cb2ff0ce9c275037b8a1b303a4ecf4255ebb09f
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed May 5 17:22:06 2021 +1200

    Bug 21249: (follow-up) Adding parentheses to fix query
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1698c36a8ee9cf3de2ad4d87b8c2fade0910d4ab
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Feb 24 10:48:10 2021 +1300

    Bug 21249: (follow-up) Implement SearchLibraryLimit for individual library
    
    before this patch, the limit only applies to groups of libraries
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b85b33f28c08178e8b73eb22baf654b7457c093e
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Apr 21 11:48:06 2020 +0000

    Bug 21249: (follow-up) Fixing syspref name, description, get working with OPAC masthead search
    
    Syspref is now called SearchLimitLibrary, and the description better
    explains what the feature does. It works with the advanced search on the
    staff client and OPAC, and the masthead search on the OPAC when
    OpacAddMastheadLibraryPulldown is enabled.
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73689bad1740b99d7d1db2d58289ed2f09dac32b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 6 12:19:11 2019 +0100

    Bug 21249: Code cleaning
    
    Trying to make the code a bit more readable removing unecessary
    variables and parenthesis.
    
    Code is duplicated but no idea where we could move it to.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b5496b1c0c8ca30193da0d249296cd4efa55b6c
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Thu Dec 27 01:44:22 2018 +0000

    Bug 21249: Made the SQL INSERT statement idempotent
    
    Sponsored-BY: Brimbank Library, Australia
    
    Signed-off-by: Amandine Zocca <azocca@ville-montauban.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 195531c038f8d3ca23981c765a880a5372549254
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Aug 20 21:49:43 2018 +1200

    Bug 21249: New syspref controlling branch fields queried against selected library group value in advanced search
    
    This commit allows librarians to choose whether they want to query the
    homebranch, holdingbranch or homebranch AND holdingbranch when they set
    a library or library group search condition in the staff client and OPAC
    advanced searches.
    
    Test plan:
    1. Apply patches, update database, restart services
    2. Set up a record with one item. Edit the item so that:
    home branch = Branch A
    holding/current branch = Branch B.
    Note the barcode of your item.
    3. Go to Administration -> Library Groups. Create a library group that
    only contains Branch A.
    
    = homebranch and holdingbranch =
    
    4. Go to Administration -> System preferences and find the new
    SearchLimitLibrary syspref. Confirm it is set to 'homebranch and
    holdingbranch' by default. Keep this tab open.
    5. Go to Advanced Search in the staff client in another tab. Under 'location and
    availability', select your library group from the dropdown. Under
    'search for', select the barcode option and enter your item's barcode.
    6. Submit the search and confirm you are taken to your item as expected.
    7. Go back to Advanced Search. Under 'location and availability', select
    Branch A from the individual libraries dropdown. Under 'search for',
    select the barcode option and enter your item's barcode.
    8. Submit the search and confirm you are taken to your item as expected.
    9. Go back to Advanced Search. Under 'location and availability', select
    Branch B from the individual libraries dropdown. Under 'search for',
    select the barcode option and enter your item's barcode.
    10. Submit the search and confirm you are taken to your item as expected.
    
    = homebranch only =
    
    11. Go back to your System preferences tab. Set the SearchLimitLibrary
    syspref to 'homebranch'. keep this tab open.
    12. Go to Advanced Search in the staff client in another tab. Under 'location and
    availability', select your library group from the dropdown. Under
    'search for', select the barcode option and enter your item's barcode.
    13. Submit the search and confirm you are taken to your item as expected,
    because the syspref is set to homebranch and the library group contains our item's
    homebranch.
    14. Go back to Advanced Search. Under 'location and availability', select
    Branch A from the individual libraries dropdown. Under 'search for',
    select the barcode option and enter your item's barcode.
    15. Submit the search and confirm you are taken to your item as expected.
    16. Go back to Advanced Search. Under 'location and availability', select
    Branch B from the individual libraries dropdown. Under 'search for',
    select the barcode option and enter your item's barcode.
    17. Submit the search and confirm you are NOT taken to your item and your item
    does not show in the search results.
    
    = holdingbranch only =
    
    18. Go back to your System preferences tab. Set the SearchLimitLibrary
    syspref to 'holdingbranch'. keep this tab open.
    19. Go to Advanced Search in the staff client in another tab. Under 'location and
    availability', select your library group from the dropdown. Under
    'search for', select the barcode option and enter your item's barcode.
    20. Submit the search and confirm you are NOT taken to your item and your
    item does not show in the search results, because the syspref is set to
    holdingbranch and the library group does not contain our item's holdingbranch.
    21. Go back to Advanced Search. Under 'location and availability', select
    Branch B from the individual libraries dropdown. Under 'search for',
    select the barcode option and enter your item's barcode.
    22. Submit the search and confirm you are taken to your item as expected.
    23. Go back to Advanced Search. Under 'location and availability', select
    Branch A from the individual libraries dropdown. Under 'search for',
    select the barcode option and enter your item's barcode.
    24. Submit the search and confirm you are NOT taken to your item and your item
    does not show in the search results.
    
    25. Repeat the above test plan but do your searching with the OPAC
    advanced search.
    
    Sponsored-By: Brimbank Library
    
    Signed-off-by: Amandine Zocca <azocca@ville-montauban.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 786c1c8ca0f2f77af2114691ffcbe74117d52416
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Apr 21 05:15:25 2020 +0000

    Bug 16486: Display the timestamp when an accountline is updated
    
    This patch updates the Date field to be 'Created' and adds a new column
    'Updated' which shows the timestamp of the accountline.
    
    To test:
    1) Apply patch, restart services
    2) Test the following staff client pages:
    - Reports -> Cash register
    - Patron Accounting tab -> Transactions
    - Create a manual invoice. Click 'Print' on the transactions tab to
    generate Invoice slip
    - Make a payment. Click 'Print' on the transactions tab to generate
    Receipt slip
    3) Test the OPAC:
    - your charges
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3baca4137ae6d4ef88022d3407d90b9677fcacf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 29 13:33:34 2021 +0000

    Bug 27577: Autolink biblio after biblionumber is generated
    
    If BiblioAddsAuthorities and AutoCreateAuthorities are enabled, a new record is auto linked when saving and authorities generated with a 670 field that indicates which record generated the new authority.
    
    The code to do this is called before the biblionumber is generated, so the variable that adds the biblionumber to the citation is empty
    
    This patch moves the linking code to after the biblionumber is generated
    
    To recreate:
    1 - Enable BiblioAddsAuthorities and AutoCreateAuthorities
    2 - Import or create a new record
    3 - Ensure the record has controlled fields that do not have authorities before saving, i.e.:
        Add a 650 with "test_bug_27577_01"
    4 - Search for the authority record
    5 - Note the 670 field does not contain the biblionumber
    6 - Apply patch, restart all the things
    7 - Repeat 2-4
    8 - Note the 670 now has the biblionumber
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fab281e54d232cf026c838855869e76a7543718
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 5 18:20:05 2021 +0000

    Bug 27577: Unit test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 640ba470cfe2ac82b4ae96dfe3b4f945252a212f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 4 16:38:27 2021 +0200

    Bug 28288: Prevent XSISBN.t to fail if service is returning 500
    
    16:00:45 koha_1       | WARNING: URL Request Failed 500 read timeout
    16:00:45 koha_1       | WARNING: URL Request Failed 500 read timeout
    16:00:45 koha_1       | WARNING: URL Request Failed 500 Can't connect to www.librarything.com:443
    16:00:45 koha_1       | # Looks like you planned 6 tests but ran 5.
    16:00:45 koha_1       | [13:59:51] t/db_dependent/XISBN.t
    16:00:45 koha_1       | Dubious, test returned 255 (wstat 65280, 0xff00)
    16:00:45 koha_1       | Failed 1/6 subtests
    16:00:45 koha_1       |         (less 3 skipped subtests: 2 okay)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07089e6bf17bedd24d54b282370a9f23c44ec200
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 4 15:24:02 2021 +0200

    Bug 27740: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 074238728a07fd97a6d576b307d30f789139a63e
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Wed Apr 21 15:16:49 2021 +0000

    Bug 27740: (follow-up) changed "User summary" css
    
    Changed user summary CSS to style H2 not H3 heading
    
    To test:
    1) Go to OPAC homepage
    2) Login as a user with at least one loan
    3) See that the "User summary" heading is not styled
    4) Apply patch
    5) Run yarn build --view OPAC
    6) Confirm the heading is now styled with grey background
    
    Signed-off-by: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7cfcb6e6aded578663167f5ace79a550b2198ae3
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sun Apr 18 07:56:55 2021 +0000

    Bug 27740: (follow-up) Added User summary heading
    
    Added a User summary <h2>
    
    To test:
    1) Go to OPAC
    2) Go to home page
    3) Check that there is a <h2> saying "User summary"
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa78a88414b510e531042b9c5e37799cb0dceda3
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Fri Apr 16 03:19:13 2021 +0000

    Bug 27740: (follow-up) quote of the day to <h2>
    
    If the quote of the day feature is enabled, a "Quote of the day" heading
    is displayed. It was an <h3> which was not proper hierarchy, so this has
    been changed to an <h2>.
    
    To test:
    1) Go to staff client
    2) Enable quote of the day preference
    3) Go to the OPAC
    4) Observe "Quote of the day" heading
    5) Ensure it is an <h2>
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4740d3dff323a2d288a2f4a2ba978a00a17ce74
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Fri Apr 16 03:08:21 2021 +0000

    Bug 27740: (follow-up) changed welcome user to <p>
    
    In the 'user_summary block', the "Welcome, user" was an <h3>. This has
    been changed to a <p> as it isn't really a heading.
    
    The styling can be changed to make it appear as it was before, or to
    make it appear more significant on the page.
    
    To test:
    1) Go to the OPAC
    2) Go to the home page
    3) Go to the 'user_summary' block
    4) Check that the part where is says "Welcome, user" is now a <p>
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 780e7b0f1ab2423e7f498bc1b9f5e561ed3c6e56
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 15 15:38:16 2021 +0100

    Bug 27740: (QA follow-up) Fix 'Your purchase suggestions'
    
    On the purchase suggestions page you could end up with two "Your
    purchase suggestions" headings, one as an h1 and one as an h2..
    
    Test plan
    1/ Add at least one purchage suggestion to a patron
    2/ Navigate to 'Purchase suggestions'
    3/ Note that just one 'Your purchase suggestsions' heading appears with
    a top level '1'.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c8a79d46bca481aa1698a0c7e6c181b7904f1a7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 15 15:00:52 2021 +0100

    Bug 27740: (QA follow-up) Fix 'Payment method'
    
    The 'Payment method' heading now needs to be moved to the second level
    to ensure consistent header heirarchy.
    
    Test plan
    1/ Add some debts to a patrons account
    2/ Enable online payments (Paypal is a good example)
    3/ Login to the OPAC and navigate to the 'Charges' page
    4/ Note the header hierarchy has no gaps... (h1 -> h2, not h1 -> h3)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5811fd3989ac8ebf9db1409fc128acd448d5169
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Thu Mar 25 23:49:20 2021 +0000

    Bug 27740: Corrected tags & hierarchy of headings
    
    Bug 27610 corrected the <h1> tags in each of the OPAC files. This patch
    corrects the hierarchy of the rest of the headings on each of the pages.
    
    To test:
    1) Go to the OPAC
    2) Apply Bug 27610 patch
    3) Apply patch (Bug 27740)
    4) Go to each of the pages and check that the headings under <h1> are in
       the correct order and hierarchy
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19af6f9b37ba5081c4acf35619a614d706804988
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 12 10:49:45 2021 +0000

    Bug 28134: Replace use of input type number in onboarding templates
    
    This patch changes the instances of input of type="number" to input
    type="text" with attributes inputmode="numeric" and pattern="[0-9]*"
    
    To test, apply the patch and run through the process of installing Koha.
    When you reach onboarding step 2, "Create a patron category," check the
    enrollment period -> "In months" field. The field should not accept any
    input except numbers.
    
    Continue onboarding until step 5, "Create a new circulation rule." On
    this page, check that these fields accept only numbers:
    
     - Current checkouts allowed
     - Loan period
     - Renewals allowed
     - Renewals period
     - Holds allowed (total)
     - Holds allowed (daily)
     - Holds per record (count)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a4d4b9478a58c77bc69cfa764b08c75088ea50f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 16 11:04:48 2020 +0100

    Bug 27246: Remove obsolete BEGIN code from C4::Context
    
    We don't longer enter the HTTP_USER_AGENT conditional in the BEGIN block
    of C4::Context. It was used when apache only was used.
    
    I am suggesting to remove it but keep the $CGI::VERSION < 4.08 condition
    to keep support of all version (not sure it's needed but won't hurt).
    
    I have not found a lot of occurrences of KOHA_BACKTRACES and I am
    assuming not much people are using it, we should prefer the dev_install
    flag instead (to set environment="development" when plack is started and
    enabled the starman trace)
    
    Test plan:
    Regression test what you think is useful
    Confirm the above statements
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c18d683f995d6d0f7d2ca53284d346b239a97dee
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 8 14:36:41 2021 -0300

    Bug 27865: Pass the x-koha-override header to PUT /holds/:hold_id from the patron's page
    
    This patch makes the AJAX call to update an existing hold, pass the
    'x-koha-override' header with the value of 'any', so any pickup location
    policy override that is needed, is applied.
    
    As the override is taken into account only if AllowHoldPolicyOverride is
    enabled, this in fact restores the previous behavior.
    
    To test:
    1. Have a patron with a hold
    2. Have AllowHoldPolicyOverride set to 'yes'
    3. Try changing the pickup location to an invalid one
    => FAIL: The options are the same as before 27205, yet the AJAX call
             fails because of invalid pickup location.
    4. Apply this patch
    5. Repeat 3
    => SUCCESS: The API call succeeds, and the hold is updated (it is
            actually refetch, so just verify it has the value you selected
    6. Sign off :-D
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f22a7e323949a720baadbea2315febe788d0fdca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 4 15:04:17 2021 +0200

    Bug 28254: Add missing tests for PUT and POST
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5627f69b2c2f7b14f47e75cd197d891c77af5387
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 4 14:56:24 2021 +0200

    Bug 28254: Simplify tests
    
    This is only cosmetic, and maybe personal preferences.
    It seems easier to create the library object with the pickup_library we
    want to use.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 102deb8cd9619e0ca9eb3e7820b742c6bad2c446
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 30 14:41:43 2021 +0100

    Bug 28254: (QA follow-up) override -> force
    
    After some discussion we decided that the parameter should be called
    'force' for pushign through an action against policy. (as per the
    Transfers work).
    
    We decided to stick to 'override' at the API level however as it
    highlights the 'human interaction' element of the call.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01b936762569f09fe6f4bf4872c05406a1e66010
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 28 14:56:33 2021 -0300

    Bug 28254: Make PUT /holds/:hold_id/pickup_location honour x-koha-override
    
    This patch adds a new parameter (x-koha-override header) to the route,
    and makes the controller pass this information (override requested) when
    the AllowHoldPolicyOverride syspref is set, to
    Koha::Hold->set_pickup_location.
    
    This way, under certain conditions, we can be sure the update wont'
    fail.
    
    To test:
    1. Apply this patchset
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3baa979cff8a5cf02ab620e56444430b7ea3e53
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 28 14:55:52 2021 -0300

    Bug 28254: Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de25586ba0c89ac2f843f772114b8297066e2d88
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 28 14:37:12 2021 -0300

    Bug 28254: Add 'override' parameter to Koha::Hold->set_pickup_location
    
    This patch adds a new parameter to the method. If passed+true it makes
    the method skip the pickup validation test.
    
    Tests and POD added for this change.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ede8290c5d8677d83b5fa70e9ff3afc061ea3924
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 8 13:05:34 2021 -0300

    Bug 27898: Make PUT /holds/:hold_id accept overrides
    
    This patch makes the route handle overriding pickup locations by passing
    the 'x-koha-override' header (set to 'any').
    
    To test:
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => FAIL: Tests fail, because things cannot be overridden ATM.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 542db8c440637a3df11ce95940cdc8aeb25e428d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 8 13:03:43 2021 -0300

    Bug 27898: Unit tests
    
    This patch adds unit tests for the PUT /holds/:hold_id route so it
    accepts the x-koha-override header and is able to override pickup
    location constraints.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5d5fbdd3e76bf3df62a5ec4462a482ecbe0545d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 8 12:03:01 2021 -0300

    Bug 27797: (QA follow-up) Pickup locations can be overridden too
    
    This patch adds regression tests for overridding pickup locations, which
    was inadvertedly not covered by the original dev. What this does, is
    moving the $can_override variable definition above, and avoid returning
    400 if conditions are not met for the passed pickup_library_id, when
    $can_override is true.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35f7e0ca1c24f4a4d74187f86020a85301a5308e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 8 11:43:04 2021 -0300

    Bug 27797: (QA follow-up) Make tests more robust
    
    This patch makes the tests mock things so the complex holds scenarios
    where existing data could interfere, don't get in the middle with what
    we need to test.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Nothing broke
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5c8f741f96d3429bac34b1a8443efbdc91276a4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 8 10:25:06 2021 -0300

    Bug 27797: (follow-up): Remove stray x-koha-override definition
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01209c228d196925f00124ce71b206321d7f4132
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 4 19:50:22 2021 +0000

    Bug 27797: (QA follow-up) Additional tests and operator change
    
    I added a few tests to cover additional cases and found the operator precedence
    was failing, switched 'and' to '&&'
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 098e93e7cc77f32e3d3f20697421d197627f89d9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 26 10:51:52 2021 -0300

    Bug 27797: Make POST /holds use the stashed koha.overrides
    
    Bug 26181 introduced a way to override behavior through a new header,
    x-koha-override. And bug 27760 introduced a generic approach to handle
    x-koha-override.
    
    This patchset makes the POST /api/v1/holds route rely on this new way of
    handling x-koha-override instead of doing it manually.
    
    The header is added to the spec as a parameter.
    
    Note: the header should be defined as:
    
        "type": "array",
        "collectionFormat": "csv",
        "items": {
            "type": "string",
            "enum": [
                "any"
            ]
        }
    
    but the versions of JSON::Validator we use have lots of bugs related to
    header type coercion, so it just doesn't work. The changelog for
    JSON::Validator is fairly elocuent about it.
    
    The override now takes a list of valid keywords (right now only 'any'
    but it would be fairly straight-forward to add a fairly granular set of
    options based on each possible AddReserve failure.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    4. Sign off!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66e7d7fd945b7aff4678366b30b226f91bd38298
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 26 10:50:46 2021 -0300

    Bug 27797: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c80d4655cc56eb5afe0f4a24ac75dbbfdadb01b5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 08:03:13 2021 -0300

    Bug 27760: (QA follow-up) Improve POD
    
    This patch improves the POD for the added helper, and also adds
    references to the JSON::Validator issue that explains the current
    implementation. A FIXME is added for when we upgrade our used
    JSON::Validator version.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25b08f998957a37e4655f4733957f26bd61a8952
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 11 11:15:26 2021 +0100

    Bug 27760: Improve readabiliity using map
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91ce8a098c7a7a3b42fff84a2f95e70e1d60dd16
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 25 09:43:11 2021 -0300

    Bug 27760: Make authenticate_api_request call stash_overrides
    
    By making this method call the helper, we make sure the overrides
    hashref is available to any controller to make us of it.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/auth_authenticate_api_request.t \
               t/Koha/REST/Plugin/Query.t
    => SUCCESS: Tests pass! The helper works as expected and the
    authenticate_api_request method invokes it!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2cc6b401a286523dd5585520169a3da708d2f3b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 25 09:35:28 2021 -0300

    Bug 27760: Add stash_overrides helper
    
    This patch adds a simple helper that reads the x-koha-override request
    header, and processes it to stash a hashref with the passed overrides.
    
    No check on the overrides themselves is done, as they should be
    validated using the OpenAPI spec.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/auth_authenticate_api_request.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fe090ffe3ba8e2ecff3011ef1b967fcc198bada
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 30 11:31:13 2021 -0300

    Bug 27864: (QA follow-up) Select2 style on multi-holds
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fa87a516158ba86028167a3b24026e706d130a6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 30 09:55:26 2021 -0300

    Bug 27864: (QA follow-up) Hide logged-in option if invalid pickup location
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4fe7ac0864a330c7f1514f135abd70f54720cd3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 26 08:21:41 2021 -0300

    Bug 27864: (QA follow-up) Remove size=1 on selects (28066 follow-up)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 153160723398623e3c802134d49d7c83a2603fd9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 15 11:36:04 2021 -0300

    Bug 27864: Correct dropdown size
    
    This patch makes the dropdown width inherit the existing style.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd5e603c3d80975867d95bdd7de714a16b58c0fd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 12 18:01:28 2021 -0300

    Bug 27864: Visual feedback on overridden pickup locations when placing hold
    
    This patch makes the form for placing a hold, use the API to retrieve
    the valid pickup locations for a biblio.
    
    To test:
    1 - In Circulation and fines rules > Default checkout, hold and return policy, change 'Hold pickup library match' to 'item's home library'
    2 - Set AllowHoldPolicyOverride system preference to Allow
    3 - Try placing a hold on a biblio with several items.
        Ensure that there is one item with homebranch of the patrons branch and
        one at another branch
    4 - Note the pickup location dropdown lists all branches, even those not matching the policy (Item's home library)
    5 - FAIL: There's no sign they are overrides to rules
    6 - Apply the patch
    7 - Repeat 3
    8 - SUCCESS: Same behavior as before all libraires listed, but there's a sign
        + tooltip for overridden ones.
    9 - Sign off :-D
    
    Note: styling follow-up coming
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2db98432d85568943c92bb1cd092960edb1e64eb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 15:47:10 2021 -0300

    Bug 27932: Add GET /biblios/:biblio_id/pickup_locations route
    
    This patch adds the mentioned route. It does so by:
    - Adding the new path in paths.json
    - Adding the full route spec in biblios.json
    - Adds a controller method that takes care of the task
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/biblios.t
    => SUCCESS: Tests pass!
    3. Play with your favourite REST tool. Pay special care to
       the AllowHoldPolicyOverride syspref and the expected behaviors.
    => SUCCESS: All works as expected
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5047557cbf3b33e3066fcd5d0ff65cebcf78c230
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 15:46:57 2021 -0300

    Bug 27932: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47ecad6ad74262a6871a4dd4b17ae947b023ef08
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 30 14:27:20 2021 +0200

    Bug 28270: (bug 24279 follow-up) Fix tooltip for the claim lost status
    
    It says "At least one item is available at this library" instead of
    "Return claims must be processed from the patron details page"
    (like on cataloguing/additem)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b1dbee18fcd0d55065b0758690c0c58296e6029
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Mon Apr 19 14:54:34 2021 +0000

    Bug 28170: Fix upload.tt search result buttons for page two onwards
    
    From https://datatables.net/faqs/index
    
    "When attaching events to cells in a table controlled by DataTables, you need
    to be careful how it is done. Because DataTables removes nodes from the DOM,
    events applied with a static event listener might not be able to bind
    themselves to all nodes in the table."
    
    Before this patch, there were three non-functional buttons on upload search
    result page, "+ Choose", "Download" and "Delete".
    
    This patch binds the handlers to a static element so that the three buttons
    in upload.tt on page two onwards are functional again.
    
    To test:
    1. This test is for the "Download" and "Delete" buttons
    1.1. Before applying patch, go to cgi-bin/koha/tools/upload.pl
    1.2. Make sure you have at least 21 files uploaded
    1.3. Perform a search via "Search term" form so that at least 21 results are
         returned (e.g. a dot (.) as the search term should return all files with
         filetype)
    1.4. Press "Download" and "Delete" for the first result row, it should work
         as expected (no need to actually delete the file - as long as it pops up
         a confirmation, it works as expected)
    1.5. Go to page 2 of results
    1.6. Press "Download" and "Delete" for the first result in page 2
    1.7. Observe nothing happening
    1.8. Apply patch
    1.9. Repeat steps 3-6
    1.10. Observe buttons working as expected
    
    2. This test is for the "+ Choose" button
    2.1. Go to cgi-bin/koha/admin/marc_subfields_structure.pl?op=add_form&tagfield=856&frameworkcode=#subufield
    2.2. Under "Other options (choose one), for "Plugin", select "upload.pl"
    2.3. Find a biblio and click Edit Record
    2.4. Go to 856$u and click "Upload"
    2.5. Repeat steps 1.1. - 1.10., but this time for the "+ Choose" button
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3b28bfe44bfbf1a7d0bf771bb7e3476faa2c117
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 26 10:49:12 2021 +0200

    Bug 28207: Fix biblio_framework.frameworktext isn't in GROUP BY
    
    When a new framework is created and "Marc structure" is opened, a SQL
    error happened if sql_strict_mode is on.
    
    Test plan:
    Create a 2 new biblio frameworks
    Click "Marc structure" for one of them
    => You see the list of all frameworks with an existing structure
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92db5e22474bec148cf4346300bc246bedbc6a7c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 15:37:46 2021 +0200

    Bug 28217: Prevent several non-repeatable attributes to be merged
    
    When using the patron merge feature it's possible to generate a patron
    with several non-repeatable attributes.
    
    This patch prevents that.
    
    Test plan:
    Create 2 patron attribute types, one repeatable and one non-repeatable
    Create 2 patrons and add them repeatable attributes
    Add a non-repeatable attribute to one of them
    Merge the 2 patrons
    => It succeeds, the resulting patron has all the repeatable attribute
    and the non-repeatable one.
    
    Do it again but this time add non-repeatable to both patrons
    Merge them
    => It fails, you should see an error on the UI
      Merge failed! The following error was reported: Tried to add more than one non-repeatable attributes. type=TYPE value=VALUE.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 915c5d13bea82d8ff76e2c76525aa70a1f22961e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 20 09:04:30 2020 +0100

    Bug 27061: Remove duplicate permission check in svc/mana/search
    
    There is a call to check_cookie_auth then another one to get_template_and_user
    
    Test plan:
    Use mana to create new report and new subscription.
    Confirm that you need the necessary permissions to use it
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36c54d818578e4853254e80d6c59ba7cb3db5bd1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 30 07:49:22 2021 +0000

    Bug 28244: DBRev 20.12.00.044
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eaddf573e9accc603f6a3d56b3570cb62d6fa9b1
Author: Victor Grousset <victor@tuxayo.net>
Date:   Fri Apr 30 03:38:28 2021 +0200

    Bug 28244: Fix typo in Ukrainian in history
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 945548533bac519ff66f9af429954586e58ee883
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Apr 28 04:53:07 2021 +0000

    Bug 28244: Fix typo in Ukrainian in language tables in English
    
    This changes the English of Ukranian to Ukrainian.
    
    1) Apply patch
    2) Go to http://localhost:8080/cgi-bin/koha/opac-search.pl
    3) Click on "Language" drop-down
    4) Note near the bottom it says "Ukrainian" instead of "Ukranian"
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e09cfd5d55291b6046272bd45d53a9dab5d8c668
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 30 07:50:26 2021 +0000

    Bug 28258: DBRev 20.12.00.043
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d299e1ffc6372fb9768b8baaea86d20d5380e009
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 29 10:43:31 2021 +0200

    Bug 28258: Fix existing occurrence
    
    I think it's good to fix the original problem as well
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8491c6eb294a3cfb77665daa444682e7bee8dd5
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Apr 28 20:48:37 2021 +0000

    Bug 28258: Update bad formatting in AUTO_RENEWALS notice
    
    To test:
    -Look at the AUTO_RENEWALS notice and see the syntax [% checkout.date_due as_due_date => 1 %]
    -Apply patch, updatedatabase
    -Look at the AUTO_RENEWALS notice and see the syntax [% checkout.date_due | $KohaDates as_due_date => 1%]
    
    Additional test:
    1 - Checkout an item to a patron
    2 - Find their borrowernumber, the itemnumber, and the biblionumber
    3 - Use the get_prepared_letter script to test the letter content
        perl misc/devel/get_prepared_letter.pl --module circulation --letter-code AUTO_RENEWALS --tables="{\"borrowers\": 5,\"issues\": 1040,\"items\": 1040,\"biblio\": 2 }"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4da4b75686015a2a25f3ed81768d18023561c40
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 28 12:18:36 2021 +0200

    Bug 28250: Remove upload of debug for Selenium failures
    
    We added an upload of the source page and of the screenshot but both services are discontinued.
    
    If we need them back we must host them ourselves.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e751ce8cf2be1648fe424d08d9eefeb75d639967
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 28 14:52:20 2021 +0200

    Bug 28249: Prevent Selenium->wait_for_element_visible to fall in an infinite loop
    
    Stop if max_retries is reached
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df9d0a849d204b2216827262532a8f2957d187e2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 22 14:23:05 2021 +0200

    Bug 27811: Hide the Accounting tab if needed
    
    Same as the previous patch for the "Accounting" tab of the circulation
    module.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffbb0fd3c2238991baa09728bc0da64610de6bfc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 22 14:20:27 2021 +0200

    Bug 27811: Hide payment buttons if not enough permission
    
    If the logged in librarian does not have the updatecharges >
    remaining_permissions subpermission, we should hide the 2 "Make payment"
    and "Pay all fines" button from the patron detail/circ page.
    
    Test plan:
    1 - Grant an account circulation/staffaccess permissions and any subpermissions in updatechagres but NOT 'remaining_permissions'
    2 - Add some charges to a patron account
    3 - Sign in with the account created in #1
    4 - Bring up the patron you added charges to
    => The two buttons are not displayed
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bc1f7d0fa5fe6955ade4c95ec43e74aa1cbaabe
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 29 07:39:21 2021 +0100

    Bug 27636: (QA follow-up) Unit tests for AutoReconcile
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19f89a131e9f888673f2e8e2d1b3b992fa6c1f02
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 28 14:36:27 2021 +0100

    Bug 27636: (QA follow-up) Restore force AutoReconcile
    
    This patch restores the behaviour ->pay always acting as though
    `AccountAutoReconcile` was enabled.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2ba01d982e476b0da2e12c60ed2058ac503fa60
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 28 11:32:09 2021 +0200

    Bug 27636: Be explicit on the exception we expect
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c88df82893521d9fad106f39c9c39db9cfd68c7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 28 10:21:14 2021 +0100

    Bug 27636: (QA follow-up) Fix tests and validate
    
    This patch fixes the tests for when a negative amount is passed to the
    pay method.  Prior to now, a negative amount would have been passed
    through and recorded. This was inconsistent with all other accounts
    methods and has been deprecated to ensure consistent amounts handling.
    
    This patch also introduces basic validation to prevent negatives being
    entered into the UI.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80c13cfb31efd9aea67508c1203f1fe0bff9c8c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 29 09:55:38 2021 +0200

    Bug 17202: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a6dd5f82da1f45456b953421e699abc179a6fb9
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 23 11:10:15 2021 +0200

    Bug 28202: Pickup libraries must be sorted by name when placing hold
    
    When placing hold, the pickup libraries are not sorted by name but by code.
    
    You can see in other places : pickup_locations() calls
    Koha::Libraries->search with { order_by => ['branchname'] }
    
    Test plan :
    1) Go to staff interface
    2) Create a new libary with code 'AAA' and name 'ZZZ'.
    2) Select a record
    3) Begin placing hold
    4) Look at list in "Pickup at:"
    => Without patch library 'ZZZ' is first
    => With patch library 'ZZZ' is last
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 061c4c3f115cd15c669edbbdc6f4d54a9db850a0
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 23 12:49:33 2021 +0200

    Bug 28202: Unit test
    
    Run prove t/db_dependent/Koha/Biblio.t
    
    Note that sort must be case insensitive.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 631cd5d8a7de68b5c67ef5cd0d5765a0535378f9
Author: Andrew Nugged <nugged@gmail.com>
Date:   Mon Apr 19 15:02:09 2021 +0300

    Bug 28169: Add quotes around value in template to render proper JS
    
    There is code in request.tt:
    
        homebranch: "[% ... %]",
        holdallowed: [% ... %]
    
    There only digits where expected earlier in holdallowed
    but now it can be string value ('from_any_library' for example),
    so it should be in quotes.
    
    To reproduce the problem:
    1. Add circulation rules which allow 1 hold only to the itemtype
    2. Make sure AllowHoldPolicyOverride syspref enabled
    3. Make 1 hold to patron for any biblio which has a few items available,
       for example on "reset_all dev db set":
       /cgi-bin/koha/reserve/request.pl?biblionumber=4&findborrower=1
       (this biblio record has 4 items)
    4. Start another hold for same patron on any biblio record or the same,
       and keep browser's JS console open,
       for example on "reset_all dev db set":
       /cgi-bin/koha/reserve/request.pl?biblionumber=4&findborrower=1
    5. You should see now JS error in browser console:
       Uncaught ReferenceError: from_any_library is not defined
       Uncaught ReferenceError: columns_settings_borrowers_table is not defined
    6. Apply the patch
    7. Repeat the steps 4-5 (reload the page) and now the JS error should be gone
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 011ee862d375d1aceb694159cebe5b54d6e0f6b5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 14 15:17:53 2021 +0000

    Bug 28148: Remove 'print' class from 'Print transfer slip' when transfer exists
    
    The 'print' class triggers JS to create the transfer and update a form
    
    When a transfer exists we have no form and use 'openWin' to trigger the
    print
    
    Also, I remove a stray '1' in the template
    
    To test:
    1 - Set AutomaticItemReturn to "Don't"
    2 - Check in an item from another branch
    3 - Confirm the transfer
    4 - Check it in again
    5 - Click 'Print slip'
    6 - Note error in console:
        Uncaught TypeError: this.form is null
    7 - apply patch
    8 - Repeat
    9 - No error!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 680a3323fa2588b07fc034c4a9c534b1c6095065
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Feb 27 17:48:29 2021 +0000

    Bug 27819: Fix Object POD
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02a404ef42683b3c19bb937cdd3bd7449c5fbd3a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Feb 27 17:24:56 2021 +0000

    Bug 27819: Spurious item deletion errors from delete_records_via_leader.pl
    
    The job reports errors when deleting items.
    
    The issue seems to be that Koha::Object->delete claims in the POD to
    return -1, 0, or 1 as a result, but it in fact returns the Object
    itself on a successful deletion
    
    The errors are reported as:
    ERROR DELETING ITEM 501740: Koha::Item=HASH(0x55ce407a1a78)
    
    To recreate:
     1 - Find or create a record with some items
     2 - Ensure those  items can be deleted (not on loan, etc.)
     3 - Edit the record leader and set position 5 to 'd'
     4 - perl misc/cronjobs/delete_records_via_leader.pl -i -v --confirm
     5 - Deletion succeeds, but reports failure on items
     6 - Apply patch
     7 - Find or create a new record as above, but this time add an
         additional item and check it out to a patron
     8 - perl misc/cronjobs/delete_records_via_leader.pl -i -v
     9 - Test mode should report 1 item to be deleted, one with error
    10 - perl misc/cronjobs/delete_records_via_leader.pl -i -v --confirm
    11 - One item should be deleted, one item not, record not deleted
    12 - check the item in
    13 - perl misc/cronjobs/delete_records_via_leader.pl -i -v --confirm
    14 - Successful deletion with no error reported
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebecee43a26a4efa2c84248f35a37ce0ac70eb94
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 28 09:07:26 2021 +0000

    Bug 17202: DBRev 20.12.00.042
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7560fb7e144015f9f52818f6684a5bfd4d50b715
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 27 12:52:26 2021 +0000

    Bug 17202: (follow-up) Conditionally add FK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f910772cba50e4e034b6f7b1aff90394c6dc8319
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 23 09:36:03 2021 -0400

    Bug 17202: (QA follow-up) Add foreign key constraint
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e96c8439ffada76efe4eae5b1b13bf9a82640bd8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 7 13:56:56 2021 +0000

    Bug 17202: Don't report an item in a collection if the collection doesn't exist
    
    This simply adds a JOIN to the collections table - if the collection is gone
    then the item is not considered to be in a rotating collection
    
    Also remove variable to store the return that is not used later
    
    To test:
    Create a rotating collection
    Add an item
    Delete the rotating collection
    View the db (SELECT * FROM collections_tracking;)
    The item is still in the collection
    Enable AutomaticItemReturn
    Checkin the item at a branch not its home
    The item does not get transferred home
    Apply patch
    Restart all the things
    Check in the item, it is transferred home
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e5c00da4f2baf4f5eefb1e637982f4261638ce1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 27 12:48:26 2021 +0000

    Bug 17202: Unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0633590f55b2dcf0c515e50469b034e563819ced
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 26 11:10:11 2021 +0200

    Bug 28213: Prevent crash if patron or club deleted after search to hold
    
    Deleting a patron or patron club causes server error on searching.
    
    To recreate:
    - create a club template
    - create a club
    - enroll a patron in the club
    - from the clubs page, select Search To Hold for your club
    - do a search, see that it says "Hold for [club name]" in your search results page
    - go back to the clubs page and delete your club
    - try to perform a search
    => Without this patch you get "Can't call method "name" on an undefined value at /kohadevbox/koha/catalogue/search.pl line 207"
    
    Same when placing a hold for a patron (check the search result and the
    detail pages)
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f29a41288c67015f28b0fe56c0de531ee247e139
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 4 12:42:59 2021 +0000

    Bug 27842: (follow-up) Correct existing serail/subscriptionhistory before deletion
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e6f30e60eabcf3a18690fbe5eff3ec901d6f067
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 3 12:21:33 2021 +0100

    Bug 27842: Update serial.biblionumber when a subscription is linked with another record
    
    It seems that a librarian can edit the biblionumber for a given subscription, however, when receiving serials the biblionumber is pulled from the existing serials, so all new received issues are received on the old biblionumber.
    
    This is problematic in light of bug 21901 - you can change the biblionumber, the serials still point to the old biblionumber - and deleting the biblio deletes the serials. Additionally, the update will delete serials where this was the case
    
    Test plan:
    1 - Create a new subscription
    2 - Receive an issue
    3 - Edit the subscription and change the biblionumber
    4 - Receive another issue
    5 - SELECT biblionumber FROM serial
    => the biblionumber link must have been updated
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46b2f5b488c7a8879c3d457cf82ac7e0a1dfcc0e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 3 12:21:20 2021 +0100

    Bug 27842: Add tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb1961f682e13724d402d5a3f242bfce00ee3d8e
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Apr 27 10:29:21 2021 +0300

    Bug 28230: Store C4::Message->{metadata} as Perl string always
    
    When loading C4::Message->{metadata} we load it as perl string in all
    other cases, see e.g. the subroutine find_last_message(). In this one
    case we incorrectly populate the C4::Message->{metadata} as an UTF-8
    octet instead of a Perl string. This causes a problem later on because
    encode_utf8 later on in the line:
    
    YAML::XS::Load(Encode::encode_utf8($self->{metadata}));
    
    excepts a perl string and not a UTF-8 octet (please refer to the
    functions perldoc). This breaks the encoding and causes an internal
    server error:
    
    To test the error is gone:
    1. Create biblio with "AE" (bugzilla doesn't let me write the real
    letter here, see it in the bugzilla comments) in title
    2. Enable RenewalSendNotice
    3. Enable "Item checkout and renewal" message preference for patron
    4. Checkout an item from biblio "AE" to patron
    5. Try to renew the patron's loan and notice the renewal fails
    6. Apply patch and restart plack
    7. Notice renewal works now and message h's the AE letter displayed correctly
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62444c1b9f095b98f6bcddd37ea505a43f578730
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 27 10:06:39 2021 +0200

    Bug 28230: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 28230: Add execute bit to test
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fce3401e75604b36cf0aad2ccb4ce65941e0f55
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 27 08:24:57 2021 -0300

    Bug 28234: TestBuilder->build_sample_biblio should set UTF-8 encoding for record
    
    This patch makes the build_sample_biblio method, correctly set the UTF-8
    flag for the MARC::Record object.
    
    Tests are added.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/TestBuilder.t
    FAIL: Tests fail! An unexpected encoding warning shows
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: No warning! Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5f43c686841f3d144eec98b314e84a8f44f9f4d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 27 09:47:43 2021 -0300

    Bug 28234: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad2dec0737657bd61a4c05ee0073eb813d0187b6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 27 15:37:20 2021 +0200

    Bug 27790: Add the new column to columns_settings.yml
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a568716e92d91a69b2e26b9ae8297dc679bdfb7e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 23 12:53:34 2021 -0400

    Bug 27790: (QA follow-up) Fix offsets due to new columns
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9abbdf7065ea67cfc54cd15231a2c8138dcdfb71
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Thu Feb 25 12:28:17 2021 +0200

    Bug 27790: separate earliest hold date into two different columns
    
    Currently "Earliest hold date" and "Pickup place" are displayed
    in one single column, but to make filtering possible it is necessary
    to split those fields into separate ones.
    This patch does exactly that and adds sorting list drop down feature to
    the "Pickup place" column.
    
    To reproduce:
        1) Make a few holds and head over to "Circulations->Holds to pull".
        2) Ensure that pickup place and earliest hold date are
    in the same column "Earliest hold date"
        3) Apply the patch.
        4) Check "Circulations->Holds to pull list" again, this time
    booking date and pickup place should have their own columns.
    Ensure that filtering by "pickup location" works fine.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3181539df6aae5361a9e5e6bcb5f67fd484c682a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 19 12:06:31 2021 +0000

    Bug 27636: Update failing test
    
    It would appear that ->pay didn't fully respect AccountAutoReconcile!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 630aa51502bf39d6fc5e32ccf5a5e7535e720b59
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 19 12:00:36 2021 +0000

    Bug 27636: Update ->pay to use ->payin_amount internally
    
    This patch is an interim patch to update Koha::Account->pay to use the
    new Koha::Account->payin_amount method internally. It simply utilises
    that method for the logic and acts as an input/output shim for
    compatability and to allow us to use the existing tests.
    
    Test plan
    1/ Run t/db_dependent/Koha/Account.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bb73229b8fce7527909d72b02a43e265336f0d6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 5 12:56:43 2021 +0000

    Bug 27636: Add payin_amount to Koha::Account
    
    This patch adds a `payin_amount` method to the Koha::Account as a modern
    replacement to the `pay` method.
    
    The new method uses the `add_credit` and `Koha::Account::Line->apply`
    methods internally for consistency and returns the created credit
    Koha::Account::Line result.
    
    Test plan
    1/ Run t/db_dependent/Koha/Account.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c29873160d9102d9a4b2648f0f441e0561ad486
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 23 08:08:19 2021 -0400

    Bug 27995: (QA follow-up) Update POD
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb3a67f21b90433fa73bf8a739f1508e226025b0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 19 10:52:54 2021 +0000

    Bug 27995: Update return for Koha::Account::Line->apply
    
    This patch updates the return value of Koha::Account::Line->apply to return the
    updated Koha::Account::Line object with Koha::Object::Messages embedded
    for the results of any triggered renewals.
    
    Available credit, the former return value, is still availabe via the
    object directly as `amountoutstanding`.
    
    Koha::REST::V1::Patrons::Account->add_credit has been updated to reflect
    the change. No other area's of Koha relied upon the return value.
    
    This patch also fixes a bug whereby if you passed a list of debits with
    an outstanding debit larger than the outstanding credit then you could
    end up with superflous offest lines with zero amounts that was
    highlighted by the improved unit tests in
    t/db_dependent/Koha/Account/Line.t
    
    Test plan
    1/ Run t/db_dependent/Koha/Account/Line.t
    2/ Run t/db_dependent/api/v1/patrons_accounts.t
    3/ If both tests pass then signoff
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 479c8d997e3c73415861b5d15b6bf207d6c59ca1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 19 09:45:45 2021 +0000

    Bug 27995: Unit tests
    
    This patch updates the unit tests for Koha::Account::Line->apply to
    reflect the change we wish to make to the return value.
    
    Instead of returning the scalar amount of available credit left on the
    credit line after calling apply, we want to return the full, updated,
    Koha::Account::Line object including Koha::Object::Messages for the
    result of renewals that may have taken place.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1937f1b1d10aa6ddf8bea8b6da05ae4361149fe0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 27 14:15:05 2021 +0000

    Bug 26734: DBRev 20.12.00.041
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 643aed1af6a607d1dc5fc657165e9f78713624cc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 23 12:50:27 2021 +0100

    Bug 26734: Add notices for translations
    
    This patch updates the translated sample_notices.sql files for each of
    the remaining translations.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f38832d95b2ded90f049c4d6002273ff81e88cf4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 15 16:31:26 2021 +0100

    Bug 26734: (QA follow-up) Add warning to database update
    
    This patch adds a warning to the database update to highlight to the
    user which notices have been updated and that a backup exists.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0327fa6bc2a4c796bba1ff5f496f7029763a459
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 9 09:23:02 2021 +0100

    Bug 26734: (follow-up) Add back 'UPGRADE' type to logviewer
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f507d60f4fee138547175be6111878d0e19e224
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 12 14:21:41 2021 +0000

    Bug 26734: (QA follow-up) Add 'tendered' and 'change' to notice
    
    We include 'tendered' and 'change' parameters in the call to
    GetPreparedLetter for the fee receipt slip.. we may as well include them
    in the sample notice ;)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9a508a49944f8a73d64c615e070490c6195e102
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 12 13:50:14 2021 +0000

    Bug 26734: (QA follow-up) Unit tests for C4::Letters
    
    This patch adds unit tests for the addition of 'include handling' to the
    C4::Letters template toolkit functionality.
    
    Test plan
    1/ Run t/db_dependant/Letters/TemplateToolkit.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a748520188e4cada61c84ca395d3c34019cc480
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 12 11:03:55 2021 +0000

    Bug 26734: (QA follow-up) Add missing copyright statement
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bdfedc13e63f3e70ace2eac37b04307cd39d75b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 3 14:49:04 2021 +0000

    Bug 26734: (follow-up) Replace db update with backup and default
    
    The inline update of variable for the notice template was proving
    troublesome.. this patch replaces it was a backup of the existing notice
    followed by replacing the notice with the default.
    
    Test plan
    1/ Run the database update
    2/ Check that the templates have been replaced by the defaults (for all
    languages enabled)
    3/ Check that a backup of the original notices was made by naviagating
    to view the action log (/tools/viewlog.pl) and selecting 'all modules' +
    'all actions'
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6ed0c7151ed0e5de137a9ad17daf3a6d17aa39b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Oct 19 14:11:11 2020 +0100

    Bug 26734: Update existing notices to new syntax
    
    This patch adds a database update to replace existing notice variable
    used in ACCOUNT_CREDIT and ACCOUNT_DEBIT notices with the modern
    equivilents.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f7b1e4230959808f4a85727be50428241484500
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Oct 19 13:54:58 2020 +0100

    Bug 26734: Update sample notices to use standardised syntax
    
    This patch updates the default notices shiped with Koha to use the new
    syntax.
    
    Test plan
    1/ Install Koha afresh
    2/ Check the notices print as expected
    3/ Signoff
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cff7ed4fd3358b079283b57a8946a05b87542a4d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 11:58:26 2020 +0100

    Bug 26734: Convert printfeercpt/printinvoice to use GetPreparedLetter
    
    This patch updates C4::Letters to allow use of existing koha template
    includes from notices, then updates the printfeercpt and printinvoice
    slip print option to use GetPreparedLetter rather than calling getletter
    directly.
    
    As part of this work, we also add credits and debits handling to the
    _parseletter_sth and _get_tt_params routines in C4::Letters to allow for
    recognisable variable names in the notice template.
    
    Test plan
    1/ Update the ACCOUNT_CREDIT and ACCOUNT_DEBIT notices to use
    'accounts.inc' include for account descriptions
    1a/ Add `[% PROCESS 'accounts.inc' %]` to the top of the notice
    1b/ Replace manual account descriptions with `[% PROCESS
    account_type_description account=credit %]`
    2/ Print one of each slip and check that descriptions are properly
    substituted
    3/ Clone the notice to another language
    4/ Print the in the other language and note the translated descriptions
    are properly substituted.
    5/ Signoff
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90d8667cf9bd8fa7ca2032080162f16967405f8a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 16 09:42:20 2020 +0100

    Bug 26734: Ratify account slip printing
    
    This patch simplifies the members/print*.pl controller scripts to only
    pass around the minimum required data for the templates.
    
    Test plan
    Slips should continue to print as they did prior to the patch
    1/ Add a manual invoice and manual debit to a patrons account
    2/ Print a slip for the manual invoice, compare to a printed slip prior
    to the patch.
    3/ Print a slip for the manual debit, compare to a printed slip prior to
    the patch.
    4/ Signoff.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd9e576d55dc95e71604f333136078a0e055d3e4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 15 14:49:09 2021 +0000

    Bug 27455: (follow-up) Add automatic focus to library name when editing
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91ee3a31cd861b5ac5e3af9e65cd5f2e17ecdbbd
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Mar 4 09:35:37 2021 +0000

    Bug 27455: (follow-up) Switch form JavaScript to focus class
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64b457925cd47b58ed9962f43decbafe32a2dbfe
Author: Ava Li <rubyli208@gmail.com>
Date:   Tue Jan 19 01:36:27 2021 +0000

    Bug 27455: Add focus to branch code when a new library is added
    
    TEST PLAN:
    From the koha home, go to administration, go to Libraries which is under
    Basic parameters. Click +New library the focus should go to the first
    field of the form (library/branch code) the patch has worked.
    
    https://bugs.koha-community.org/show_bug.cgi?id=27455
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7a199ffe742545234ca97d5c2a199eed0ef44a1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 23 12:36:54 2021 +0000

    Bug 15563: (follow-up) Combine methods, add count, obey confirm
    
    This patch moves the SQL to a subroutine and uses the Label delete method to
    remove the batches
    
    We now return a count and do not delete if --confirm flag is not passed
    
    Repeate previous test plan, confirm works as expected
    
    JD amended patch: perltidy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit daf2669405a282a14d35525678d4b8c9d6077002
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Mon Jul 20 15:09:30 2020 +0000

    Bug 15563: add label and card creator batch deletion to cleanup_database
    
    To test:
    For item label batches:
    1- Create 3 item label batches of at least 2 items each
    2- Perform the following updates via the database
    3- In Batch 1, set all items' timestamps to 10+ days prior to today
    4- In Batch 2, set 1 item's timestamp to 10+ days prior to today
    5- In Batch 3, do not update any timestamps
    6- Run cron with --labels 9
    7- Confirm batch 1 is deleted, batches 2 and 3 are not
    
    Repeat with card creator batches
    8- Create 3 card creator batches of at least 2 items each
    9- Perform the following updates via the database
    10- In Batch 1, set all cards' timestamps to 10+ days prior to today
    11- In Batch 2, set 1 card's timestamp to 10+ days prior to today
    12- In Batch 3, do not update any timestamps
    13- Run cron with --cards 9
    14- Confirm batch 1 is deleted, batches 2 and 3 are noti
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Deb Stephenson <dstephen@dubuque.lib.ia.us>
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95cbefe12d5b5d901d545b602627224dfc2c7034
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Thu Dec 3 10:41:47 2020 +0200

    Bug 26405: Prevent Circulation.t failing on 'AddRenewal left both fines'
    
    Bug 23051 added option to skip calculating fines even when
    "CalculateFinesOnReturn" is enabled. Due this Circulation.t
    fails on  test  "AddRenewal left both fines" if
    "CalculateFinesOnReturn"  is disabled on ones system.
    Mocking syspref while testing fixes failig tests.
    
    To test:
    1. Disable "CalculateFinesOnReturn".
    2. Run prove t/db_dependent/Circulation.t
    => Tests fail
    3. Apply patch.
    4. Run prove t/db_dependent/Circulation.t again
    => Tests are succesful
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92f69a01936a361456b962f114e168c48539ee87
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 26 12:40:48 2021 +0000

    Bug 28223: Add data elements to negative budgets
    
    To test:
    1 - Have a parent fund and a child fund
    2 - Order an amount from the child fund that is greater than the amount available
    3 - Browse to acquisitions
    4 - Confirm the totals look right
    5 - Click on the over spent fund to go to 'Funds for main budget'
    6 - Note the totals are incorrect
    7 - Apply patch
    8 - Reload
    9 - Totals are now correct
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0140f1e626471c10b487c65e2db91766d31ac225
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 27 15:04:35 2021 +0200

    Bug 28144: Add a regression test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf13a36c8a80d2b7b38c897b4ae3bdf2c91fb934
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 13 15:14:11 2021 +0000

    Bug 28144: Check if issue_id defined
    
    Historical OVERDUE fines may not have an issue_id - this causes
    flooding of the logs when calling update fine
    
    Trivial change, reading the code should be enough, but test plan below
    
    To test:
    1 - Create some fines without an issue_id
      - Either checkout an old version of Koha and add manually or
      - Checkout some items (backdated) to a patron, run fines.pl then
        UPDATE accountlines SET issue_id = NULL;
    2 - Checkout a backdated item with fines in the circ rule to the same patron
    3 - Run fines.pl
    4 - Note the errors
    5 - Apply patch
    6 - Repeat and note no errors
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 808d9a9f81a65921b70af92dba83d407e8e71caf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Apr 26 06:30:17 2021 -0400

    Bug 28221: Script process_message_queue.pl uses Try::Tiny but doesn't 'use' it
    
    The message queue processor has a try/catch block, but does not have a 'use Try::Tiny' line. Because of this the following error ocurrs if an instance has any plugins installed that use the before_send_messages hook:
    
    Can't locate object method "catch" via package "1" (perhaps you forgot to load "1"?) at /usr/share/koha/bin/cronjobs/process_message_queue.pl line 86.
    
    Test Plan:
    1) Install a plugin that uses the before_send_messages hook
    2) Run the message queue processor
    3) Note the error message
    4) Apply this patch
    5) Run the message queue processor again
    6) No error!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dc9855b461a598487f2e7395a95f092f1f3e1c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 19 12:11:36 2021 +0200

    Bug 28178: Display the correct image in the image viewer
    
    When there are several images attached to a bibliographic record, one can click
    an image and see it in the image viewer. But the first image is always displayed.
    
    Test plan:
    0. Turn on LocalCoverImages and AllowMultipleCovers
    1. Attach at least two images to a bibliographic record
    2. Go to the detail page, click the "Images" tab and click the second
    image.
    => With this patch applied you should see the image you selected
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff849fadbade8b72faec52284b58e6f5dd8a71c9
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 11 11:46:46 2021 +0100

    Bug 21818: Replace AutoCommit flag with DBIx transaction in stage-marc-import.pl
    
    Like it was done in Bug 18806.
    
    Test plan :
    Use stage-marc-import.pl with and without patch, with a matcher to find
    duplicates
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c45d15e231efd11d5f19f3a1186013daef19d300
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 23 00:21:30 2021 +0000

    Bug 28193: (follow-up) Correct OpacLoginInstructions in login modal
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee4755c97404e464b8d9af6cd2f253201c1f21d7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 22 14:33:25 2021 +0000

    Bug 28193: OpacLoginInstructions news block broken by Bug 20168
    
    This patch fixes a regression which was introduced by Bug 20168, causing
    the OpacLoginInstructions template code to revert back to the old system
    preference behavior. This patch returns the correct markup.
    
    To test, apply the patch and view the OPAC login page
    (/cgi-bin/koha/opac-user.pl)
    
     - With no news entry for OpacLoginInstructions you should see the
       default: A block of text with two headings, "Don't have a password
       yet?" and "Don't have a library card?"
     - Go to Tools -> News and create an entry for OpacLoginInstructions.
     - Return to the OPAC and confirm that your custom text appears.
     - Try updating/installing another translation and adding a different
       news entry for that language. Confirm that the correct entry appears.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0a8f8a5b467dae47f6757690ced3f7ae6f5cfa0
Author: Victor Grousset <victor@tuxayo.net>
Date:   Tue Apr 27 03:08:59 2021 +0200

    Bug 28198: Correct sample HOLD_REMINDER notice for it,nb,pl,ru
    
    It turns out that ea6467724cf8e6fac2224e1dcb6c6ddee73736af also caused the same issue in these locales
    Also e0b0e908f767e510c5538d8e5cfb25f994579441 (a follow up) caused the issue in it-IT
    
    == Test plan ==
    Paste all this :D
    ```
     # doesn't work without this patch applied
    echo "DELETE FROM letter;" | sudo koha-mysql kohadev
    cat installer/data/mysql/nb-NO/1-Obligatorisk/sample_notices.sql | sudo koha-mysql kohadev
    echo "DELETE FROM letter;" | sudo koha-mysql kohadev
    cat installer/data/mysql/pl-PL/mandatory/sample_notices.sql | sudo koha-mysql kohadev
    echo "DELETE FROM letter;" | sudo koha-mysql kohadev
    cat installer/data/mysql/ru-RU/mandatory/sample_notices.sql | sudo koha-mysql kohadev
    echo "DELETE FROM letter;" | sudo koha-mysql kohadev
    cat installer/data/mysql/it-IT/necessari/notices.sql | sudo koha-mysql kohadev
    
     # test all the rest
     ## fixed by previous patch, double checking
    echo "DELETE FROM letter;" | sudo koha-mysql kohadev
    cat installer/data/mysql/fr-FR/1-Obligatoire/sample_notices.sql | sudo koha-mysql kohadev
     ## was already working, just double checking
    echo "DELETE FROM letter;" | sudo koha-mysql kohadev
    cat installer/data/mysql/fr-CA/obligatoire/sample_notices.sql | sudo koha-mysql kohadev
    echo "DELETE FROM letter;" | sudo koha-mysql kohadev
    cat installer/data/mysql/uk-UA/mandatory/sample_notices.sql | sudo koha-mysql kohadev
    ```
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb367742927132b145298069a003220cf47fb491
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 26 18:20:27 2021 +0000

    Bug 28198: Correct sample HOLD_REMINDER notice for French
    
    To test:
    1 - sudo koha-mysql kohadev
    2 - DELETE FROM letter
    3 - cat installer/data/mysql/fr-FR/1-Obligatoire/sample_notices.sql | sudo koha-mysql kohadev
    4 - Error!
    5 - Apply patch
    6 - Repeat 1-3
    7 - Success!
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13bcc7e0bbf51587c7aa3a012f61282fc5f675b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 27 15:28:34 2021 +0200

    Bug 15986: Remove \r from HOLD_REMINDER in the yml
    
    To prevent the following errors on `gulp po:update`
    
    misc/translator/Koha-installer.pot:952: warning: internationalized messages should not contain the '\r' escape sequence
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00883fc411975905710c1a53fedd300a6d3a37ab
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 23 16:48:52 2021 +0100

    Bug 28210: Pass skip_record_index through LostItem
    
    This patch restores the skip_record_index optional parameter for
    LostItem and passes it through to MarkIssueReturned as required.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dbe57b5648b776298576d91c684154f8cc54a39
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 26 15:57:09 2021 +0000

    Bug 28210: Add issue, replacementprice, and set onloan so check-in tests work
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc0cf683eee210909012f068c8ea30c0c2055e90
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 23 16:52:59 2021 +0100

    Bug 28210: Unit test
    
    Add a unit test to check that skip_record_index is adhered to when
    passed to LostItem with the force_mark_returned option enabled.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b15138278518227b64e725c7a4ac5ad97f5e99b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 23 14:37:28 2021 +0100

    Bug 27281: (QA follow-up) Fix Indexer Test
    
    With bug 27281 we removed a call to reset an items holdingbranch back to
    the 'frombranch' of the transfer.  This is correct, as with bug 23129
    (and friends) we ensure that the holdingbranch was not changed at
    transfer request time and instead would only be updated at the reciept
    of transfer. As such, it's safe to remove the update here as it would be
    just setting the same branch as is already present.
    
    However, when removing this ModItem call, I neglected to realise that
    also remoes the requirement for passing around the defered indexing bit
    as we no longer need to trigger a re-index as there's not any change to
    the item.
    
    This patch therefore cleans up the POD for LostItem, removes the no
    longer references 'params' parameter and drops the corresponding index
    test.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9d14bc5a0581080c97c5775571a2b99657d1070
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 23 15:22:44 2021 +0000

    Bug 24446: (follow-up) Fix tests
    
    The tests were failing because we weren't actually changing the item, so store was doing nothing.
    
    We need to transfer 'from' a new branch so that the holdingbranch is changed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ec4820a6554e5dc0683aa9d20a09d34129205a2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 23 11:19:21 2021 +0000

    Bug 23271: (follow-up) Fix typo 'limlits'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfa381167a7be567ae2d3eae95e839fc18dc41dc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 12:45:27 2021 +0200

    Bug 23971: Fix UsageStats.t
    
    Hum, what's the point of these tests?
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 769a939b254cbbf08b2910cea4202f6ee9a7a493
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 09:40:10 2021 +0000

    Bug 27971: DBRev 20.12.00.040
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cdde98445413e17bff9051d042bf2a4c967c578
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 17 16:23:56 2021 +0000

    Bug 27971: Enhance unit tests
    
    This patch adds some additional unit tests for extra functionality
    included with this patchset.
    
    Test plan
    1/ t/db_dependent/Koha/Account/Line.t should pass
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35d1c7c41c93e9419ca39ad3d710c64202c309d3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 17 09:10:17 2021 +0000

    Bug 27971: Update void method to use double entry accounting
    
    This patch adds double-entry accounting to the Koha::Account::Line->void method.
    
    This results in the addition of a VOID debit type line that is offset
    against the original credit type line that is being voided. This allows
    us to accurately record when the void took place, at what branch and by
    whome the void was triggered.
    
    Test plan
    1/ Apply the database update
    2/ Add some debts to a borrower account
    3/ Pay those debts
    4/ Void the payment
    5/ A new 'VOID' line should appear on the account for the full amount of
    the original payment.
    6/ Payments should have all been reversed
    7/ t/db_dependent/Koha/Account/Line.t should still pass
    8/ Signoff
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91775dc298e38c4b992f07ba9a6469534ae5edca
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 18 14:00:43 2021 +0000

    Bug 24300: (QA follow-up) Enhance test and catch failures
    
    The tests did not include testing for offset lines. This patch adds such
    tests and updates the function to pass them
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2026b6624f0f12e012be81741b3752444de3c14
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 17 14:12:37 2021 +0000

    Bug 24300: (QA follow-up) Update payout_amount to use internal methods
    
    Tomas pointed out that we could, and probably should, use the internal
    'add_debit' method within this function.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f32b62d1c3be39459eabd7898b2d9aa0dbe7d9e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 16 16:06:36 2021 +0000

    Bug 24300: (follow-up) Set minimum for amount input
    
    Add a 'min' attribute for validation of the amount field in the payout
    modal so that negative amounts cannot be submitted.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a92554c6b94203ff3ed682be6acb58a85ed1b63
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 17 14:17:29 2021 +0000

    Bug 24300: (QA follow-up) Add Unit Tests
    
    Doh! I forgot the unit tests first time around!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57212f76b3069f1699d3eb7632a7d82764184373
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 5 15:11:37 2021 +0000

    Bug 24300: Add payout amount to boraccount page
    
    Test plan
    1/ Add some debts and credits to a patrons account, resulting in an
    overall credit
    2/ Note the appearance of a 'Payout amount' button next to the total due
    line.
    3/ Try paying out an amount with the button
    4/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cfe0c3e67389f337d033d7953d014049150b1bb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 5 14:28:32 2021 +0000

    Bug 24300: Add payout_amount method to Koha::Account
    
    This patch adds a 'payout_amount' method to the Koha::Account class to
    allow payout of an amount against a list of credits (or any outstanding
    credits, oldest to newest).
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 144bc5fe3e6971489b8234b649f9570b705cb8bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 11:52:36 2021 +0200

    Bug 12362: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d70a60e5ce32547d823ea48b519d686311e3be07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 09:40:10 2021 +0000

    Bug 12362: DBRev 20.12.00.039
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbba09f63f200d3e57a8612554984d807867cf84
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Apr 20 10:28:40 2021 +0100

    Bug 12362: (QA follow-up) Fix ModItemTransfer cancellation handling
    
    ModItemTransfer is still used, sparingly. It force cancels transfers
    regardles of whether they are already marked as in_transit. We do not,
    however, want to enqueue a return transfer in this case as
    ModItemTransfer is itself an enqueue function.  This patch updates the
    internal logic of ModItemTransfer to enqueue the passed transfer prior
    to cancelling the pre-existing one.. in this way the result is one
    cancelled transfer and one new transfer and not three transfers.
    
    Test plan
    1/ Run t/db_dependant/Items.t and verify it fails prior to applying this
    patch
    2/ Apply patch and run the test again, verifying it now passes.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c105829144cd341a4bc65ad8d0ee1f996b423d4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 22 14:57:06 2021 +0000

    Bug 12362: Cancel transfer with hold cancelation
    
    This patch adds a transfer cancellation when a hold is cancelled.
    
    Test plan
    1/ Check an item out from it's homebranch
    2/ Place a hold on that item for another user at a different branch
    3/ Check the item in at it's homebranch and accept the transfer
    4/ Cancel the hold
    5/ Change to the second branch and check the item in
    6/ Note that a transfer is triggered with the reason 'Transfer was
    cancelled whilst in transit'
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    JD amended patch: remove trailing whitespace
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0407686eb070c5bdf0302147a198027abea5ac0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 22 14:36:42 2021 +0000

    Bug 12362: Reverse transfer upon cancellation
    
    This patch adds a reverse transfer if a transfer is cancelled whilst it
    is in transit.  This makes sure the item returns to it's original
    location.
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c04cc02cc1cd95b96c3fc8b0a086022098f7493
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 22 14:43:42 2021 +0000

    Bug 12362: Add 'TransferCancellation' as a transfer reason
    
    This patch adds the database update to add 'TransferCancellation' as a
    reason for transfer.
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c9d15ba493e0485a11a03adea3cac96cfee94ba
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 8 15:30:09 2021 +0000

    Bug 27896: Remove DeleteTransfer
    
    This patch removes the last mentions of DeleteTransfer
    
    Test plan
    1/ Grep the codebase for DeleteTransfer
    2/ It should no longer exist
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 27896: (QA follow-up) Fix number of unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cd0e927e4dc1a557aafcbb9b93a7d8f4803e6ae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 8 15:24:14 2021 +0000

    Bug 27896: Remove DeleteTransfer from circ/return.pl
    
    This patch replaces the DeleteTransfer call in circ/returns.pl with a
    call to Koha::Item::Transfer->cancel.
    
    Test plan
    1/ Check an item out
    2/ Add a transfer request for the item to a second library
    3/ Attempt to check the item in at the first library
    4/ Note that you should be given a 'WrongTransfer' modal and have to
    option to cancel.
    5/ Cancel the transfer
    6/ Check in the database that the transfer now has 'datecancelled' set.
    7/ Add a transfer for the item again
    8/ From the transferstoreceive page cancel the transfer
    9/ Click cancel and again check that datecancelled is set in the
    database for your transfer
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 27896: (follow-up) Fix Typo
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1863e0284140aaf08ea5e78e23f5b542e2c4c9af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 09:40:10 2021 +0000

    Bug 27281: DBRev 20.12.00.038
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5db8e9a372a2132456db34c084ec2325b78ca8c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 22 09:35:11 2021 +0100

    Bug 27281: (QA follow-up) Restore test for holdingbranch
    
    I inadvertantly removed the test that varified that the items
    holdingbranch is unaffected by the call to LostItem. This restores such
    a test and adds a few comments to clarify the test transfers.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a1fb1406aef6ae3d1cd870f3d06b86e59bdec31
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 16 11:22:50 2021 -0400

    Bug 27281: (QA follow-up) Fix typo
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d2da1382279e94fea46110f07daa8394bdf660c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 8 14:59:06 2021 +0000

    Bug 27281: (follow-up) Clean up LostItem test
    
    The LostItem test was rather messy, and wasn't actually testing much in
    reality. This patch cleans it up and adds testing for transfer queue
    handling of ListItem cancellations.
    
    Test plan
    1/ Confirm t/db_dependent/Circulation.t still passes
    2/ Read the tests before and after and confirm that they test what is
    required.
    3/ Signoff
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcd1f2faed412aedff090af95620f87c9a1f7b92
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 8 14:14:20 2021 +0000

    Bug 27281: Add unit test for Koha::Item->get_transfers
    
    In the previous patch we introduced the new get_transfers method to the
    Koha::Item object. This patch adds proper unit tests for that addition.
    
    Test plan
    1/ Apply patches and confirm t/db_dependent/Koha/Item.t passes.
    2/ Signoff
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    JD amended patch: fix spelling reqeusted ==> requested
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 115ed5eb5bb3c7d9eae9d3b2e455cbf4f1aabee3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 8 13:43:11 2021 +0000

    Bug 27281: Update LostItem to use Koha::Item[::Transfer] methods
    
    This patch updates C4::Circulation::LostItem to use the Koha::Item and
    Koha::Item::Transfer methods to cancel transfers when an item is marked
    as lost.
    
    Test plan
    1/ Confirm t/db_dependant/Circulation.t passes prior to applying the
    patches
    2/ Apply the patch and run updatedatabase.pl
    3/ Confirm that t/db_dependant/Circulation.t still passes
    4/ Signoff
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb3c38f4c401be51fada5ed7f03c2c6d27aa5d07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 09:40:10 2021 +0000

    Bug 23971: DBRev 20.12.00.037
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad45e6c59da2f6f65b550ee9cb6858842ba79852
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 14:39:16 2021 +0200

    Bug 23971: Do not always flag AcquisitionLog as 'not enabled'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e2679528e8f6bc6c8216df0ae03186fa1359164
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 14:26:19 2021 +0200

    Bug 23971: Rename pref with AcquisitionLog
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef23baed3dc9b1c4e09aa7d9d013ca726fcaf767
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue Jan 5 11:34:28 2021 +0000

    Bug 23971: (follow-up) Remove stale param
    
    As highlighted by Jonathan in comment #90, we were passing
    borrowernumber to ModBasket. This was a hangover from when we explicitly
    logged the borrower, which was later discovered to be unnecessary
    duplication, and was removed in commit "Remove data duplication".
    
    This commit removes this unnecessary parameter.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9bd5a3c39823922f34bb74b48361a863c4edf172
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue Nov 10 11:31:30 2020 +0000

    Bug 23971: (follow-up) Log entire objects
    
    As requested by Tomás and Jonathan, we now log the entire basket object
    when logging an action.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2609228dc1b95e2f3afe4fbb4cad18ca9bc02d7
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Oct 23 15:44:32 2020 +0100

    Bug 23971: (follow-up) Make changes for 26582
    
    This commit makes changes necessary to allow this bug to be dependent on
    Bug 23562:
    
    - Move basket closure logging from C4::Acquisision::CloseBasket to Koha::Acquisition::Basket::close
    - Move basket closure unit test from t/db_dependent/Acquisition.t to
    t/db_dependent/Koha/Acquisition/Basket.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab61e94dc90a9997182621265ad3790f62f36313
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Oct 23 15:14:28 2020 +0100

    Bug 23971: (follow-up) Fix tests
    
    Following a discussion with Tomás on Slack, this commit implements the
    following suggestions:
    
    - Switch from ->find to ->search in tests. ->find is only ever going to return 0
    or 1 rows, which doesn't help us if there is breakage which results in
    more than 1 row being returned, the test would fail due to ->find not
    expecting more than 1 row, but we should be testing for it. So switching
    to ->search returns all matching rows.
    - Moved tests into their own subtest, they had the potential to pollute
    surrounding tests
    - Remove all action logs before each test, this ensures we're only
    testing the result of the current test
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fd3eaa24736bc7370980d21aea26f0713209182
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Oct 19 10:48:57 2020 +0100

    Bug 23971: (follow-up) Respond to feedback
    
    As requested by Jonathan in commit #28:
    
    - We now no longer pass a flag to CloseBasket indicating if the closure
    was due to an EDI basket approval, we log the closure and approval as
    separate events.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7aeda0e34fea58b4ce8352a3253b2464b5346b0
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue Oct 6 13:40:41 2020 +0100

    Bug 23971: (follow-up) Add unit tests
    
    This commit adds unit tests for the logging done in Acquisitions.pm
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17670bd7608de67c451ddd349760f65c7257d700
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 22 14:05:01 2020 +0000

    Bug 23971: (QA follow-up) Fix punctuation, doubled up return and syspref order
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79c2999c6e916ddc5c4435e4cb7775abe766f025
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Dec 6 11:35:00 2019 +0000

    Bug 23971: (follow-up) Add additional basket logging
    
    This patch adds additional basket logging as discussed in comment #14
    
    - Basket reopening
    - Basket users (manager) modification
    - Basket header modification
    
    Signed-off-by: Holly <hc@interleaf.ie>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac4ac649aaeffb3082fb7a1d84323fac5842ad52
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Dec 6 10:30:20 2019 +0000

    Bug 23971: (follow-up) Remove data duplication
    
    In response to Séverine observations in comment #10, this patch removes
    the duplicate logging of the borrowernumber
    
    https://bugs.koha-community.org/show_bug.cgi?id=23971
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 565726e5565c186c3b45f9ac4859a680e649b738
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Nov 29 15:40:58 2019 +0000

    Bug 23971: Add logging for basket related actions
    
    This patch adds logging for the following Acq actions:
    
    - Basket creation
    - Basket editing
    - Basket approval (via EDI)
    - Basket closure
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Bug 23971: (QA follow-up) New DBrev syntax
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb5f0eea74c71056e7efdaabeef0b92b2cc769ac
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 21 16:25:48 2021 +0000

    Bug 27924: Display number of holds awaiting pickup on check out screens
    
    This patch modifies the checkout page so that waiting holds are
    displayed separately depending on whether they are waiting at the
    current branch or not. A count of each number of waiting holds is
    displayed too.
    
    Unrelated change: A missing </li> has been added for markup validity.
    
    To test, apply the patch and view the checkout screen in these
    situations:
    
     - A patron with no waiting holds.
     - A patron with one or more holds waiting at the current library.
     - A patron with one or more holds waiting at another library.
     - A patron with holds waiting at both the current library and at other
       libraries.
    
    In each case, the display of waiting hold information should be correct,
    including the count of holds of each kind.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35226bab685a9b0693d41e9761ccb29f4e0c97ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 10:31:32 2021 +0200

    Bug 27814: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff317f4e375db08bcee7d8879791d9da59de6298
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 5 13:40:13 2021 +0000

    Bug 27814: (follow-up) Adjust container padding, button flow
    
    This patch makes minor changes to the SCSS so that the user summary
    page's DataTables button flow better at very narrow widths.
    
    Also, the main container should have less padding at narrow widths.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b2fbcb66de8e630e371f5676ea5d9874fedd42a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 26 19:12:53 2021 +0000

    Bug 27814: Improve responsive behavior of the user page in the OPAC
    
    This patch makes minor changes to OPAC CSS in order to improve the way
    the logged-in user's "your account" page works at narrower browser
    widths.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Log in to the OPAC as a user who has multiple checkouts.
     - Test the page at various browser widths, from > 1200 pixels wide to <
       300 pixels wide. Your browser's built-in responsive design mode,
       found in developer tools, can make these measurements easier.
     - At "phone-size" width the tabs ("Checked out," "Overdue," etc) should
       start displaying full-width.
     - The DataTable controls at the top of the checkouts table should
        adapt well as the browser width changes.
     - At narrower widths the tables on this page should display much better
       than they did before the patch: They should expand to fit the width
       of the page.
    
    Edit: Tweaked the display property of the table search field at narrower
    browser widths; Converted iCal download link to button to match other
    elements in the toolbar.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aebd3f6a5358a70e8533d315435030821ca9d0bd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 23 10:29:54 2021 +0200

    Bug 27566: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4cc224baa77b9879ee64691c8dec565a489f83f4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 7 13:43:40 2021 +0000

    Bug 27566: (follow-up) Add generic font family to prevent unstyled select tags
    
    This correction fixes the previous patch which was dumb and stupid.
    
    This patch adds a default font family "sans-serif" to the OPAC CSS as a
    workaround for this Firefox bug:
    
    font-family isn't honored in `<option>` element within `<select>`
    dropdown
    https://bugzilla.mozilla.org/show_bug.cgi?id=1536148
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Open the OPAC main page in Firefox.
     - Click the search type dropdown. The options should be styled using
       your system's default sans-serif font rather than a serif font.
     - Check that other areas of the OPAC are still styled with the correct
       "NotoSans" font. An error with this patch should be obvious when
       looking at a logged-in user's checkouts.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34575f1f1a063380c1e3f05dd300302bc42ac460
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Wed Apr 21 14:45:14 2021 +0300

    Bug 28168: leave the field empty if amount variable is empty
    
    Add "if" check to the template so that it uses the value of
    "debit_type.default_amount" only if it's true, i.e. not null or 0.
    
    The reason for this patch is there's requirement from librarians -
    to have this field completely empty if it's 0, so they could paste the
    amount (as they usually do) without the need to clear the field first.
    And anyway if you try to save the form with 0.00 value,
    it won't accept it saying "Debit amount passed is not positive" so
    in my opinion there's no point to preset it with zeroes to begin with.
    
    To reproduce:
        1) head to /cgi-bin/koha/members/maninvoice.pl?borrowernumber=XXXX
        and check that field "Amount" is prefilled with 0.00;
        2) apply patch;
        3) refresh page and ensure that field "Amount" is empty now;
        4) go to /cgi-bin/koha/admin/debit_types.pl and change default
        amount to some decimal amount;
        5) refresh manual invoice page again and ensure that "Amount"
        field is prefilled with that exact decimal number;
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01f0e04172432e28f37a94bf6df51a3fd6cdc960
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 17 09:18:48 2021 +0100

    Bug 27968: Fix framework import if isurl has an incorrect value
    
    If isurl is set to undef in the DB, it will be exported as an empty
    string, which is an invalid value for isurl (int)
    
    Incorrect integer value: '' for column 'isurl'
    
    Test plan:
    Export framework structure in CSV and ODS, then reimport it and check that
    all the subfields are important correctly
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f096a8dffcb35c153c3f4f27ce5767b1c7fb3f75
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 22 15:22:49 2021 +0000

    Bug 16787: (follow-up) Add and adjust ILSDI tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e77fa64e31cdf026030c4a354bf73e4ee7e2bb14
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 22 11:45:01 2021 +0100

    Bug 28064: (QA follow-up) Remove value from button
    
    To clarify that the value is not used on buttons that are not submit
    type we remove the value entirely.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccd72425327d50ec7595f48021f9e53a30c0b90d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 31 13:06:49 2021 +0100

    Bug 28064: Add dotransfer field to slip print submission
    
    By changing the code to only do a javascript triggered submission from
    the from button we lose the original buttons name and value elements
    upon submission.
    
    This patch checks for those fields in the JS capture and triggers the
    addition of a new hidden form field to contain the dotransfer data.
    
    Test plan
    1/ Set AutomaticItemReturn system preference is set to "Don't"
    2/ Check in an item that belongs to another library, a dialog will ask
       you if you want to transfer.
    3/ Click 'Yes, print slip'
    4/ Look at the item record and note the status is 'Available'.
    5/ Apply patch
    6/ Follow steps 2 - 4
    7/ Note the status is now 'In transit to...'
    8/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fee4a653f4819c5b73e6dcb46149a980385b3349
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 31 10:07:32 2021 -0300

    Bug 28002: Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79087e0674258f79a3e810f0bcbcb6a0246b2bdf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 31 08:04:12 2021 -0300

    Bug 28002: Add extended_attributes support to POST /patrons
    
    This patch adds support for the 'extended_attributes' parameter in the
    route for adding a patron. It relies on
    Koha::Patron->extended_attributes for the tests. Exceptions are catch
    and the whole operation is rolled back.
    
    I chose to handle each exception on its own if branch, with bug 28020 in
    mind.
    
    To test:
    1. Apply this patchset
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCES: Tests pass!
    3. Check they cover all the exception situations!
    => SUCCESS: They do!
    4. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d1b7ca3a05466d5b6307e112adcb94c311f668b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 20 14:23:36 2021 -0300

    Bug 28157: Add handling for the x-koha-library header
    
    This patch introduces a new header handling. The key idea is that on
    Koha's base classes there's broad usage of C4::Context->userenv to
    determine the current library and make decisions based on that.
    
    API requests, on the other hand, might not be tied to sessions
    (stateless) which is the way current library is retrieved. So we need a
    way to properly specify what library the request is trying to act as
    coming from.
    
    To test:
    1. Apply this patchset
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/auth_authenticate_api_request.t
    => SUCCESS: Tests pass!
    3- Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d84ca49570343b729dd515d50742833cdd07e5fb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 20 14:23:30 2021 -0300

    Bug 28157: Regression tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a8855b789bd9595639cac8e6ed74a3a9cefb5a1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 20 14:21:04 2021 -0300

    Bug 28157: Add Koha::Patron->can_log_into
    
    This patch adds a new method that tells if the patron is allowed to be
    logged into certain library.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/auth_authenticate_api_request.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49d764e413c58b580e45541626e007d2aa993c7c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 31 08:59:10 2021 -0300

    Bug 23666: (follow-up) Adjust to new exceptions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d011bd9983926488f783730ca43e98e6e07dabe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 25 10:25:41 2021 -0300

    Bug 23666: Add PATCH /patron/:patron_id/extended_attributes/:extended_attribute_id
    
    This patch adds the described route. It is designed to use the
    underlying libraries' methods to update an existing attribute.
    
    The tests cover the use cases.
    
    Note: I added handling for two exceptions that can only occur on bad
    data (i.e. not by using our codebase). This are:
    - Koha::Exceptions::Patron::Attribute::InvalidType
    - Koha::Exceptions::Patron::Attribute::NonRepeatable
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons_extended_attributes.t
    => SUCCESS: Tests pass!
    3. PLay with the route
    => SUCCESS: Expected behavior!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12b6d1f79201f7d0702199afb841dc3ed24ff94b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 19 12:05:24 2021 -0300

    Bug 23666: (QA follow-up) Fix wrong required permissions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd2e57a13f0ce4e27b55eb23481b104e78a53af8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 18 15:15:13 2021 -0300

    Bug 23666: Add extended attributes routes
    
    This patch adds routes to handle patron's extended attributes:
    
    GET    /patrons/:patron_id/extended_attributes
    POST   /patrons/:patron_id/extended_attributes
    PUT    /patrons/:patron_id/extended_attributes <- to overwrite them all
    DELETE /patrons/:patron_id/extended_attributes/:extended_attribute_id
    
    Controllers rely on the Koha::Patron methods for retrieving/adding
    extended attributes. Exceptions are correctly catch and handled in the
    responses. This is all covered by tests as well.
    
    Note: I decidedto override the default sorting on the PUT response,
        because the overloaded search sorting it felt a bit wrong on the API.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons_extended_attributes.t
    => SUCCESS: Tests pass!
    3. Play with your favourite tool and this routes
    => SUCCESS: They work well!
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13bebbaa26161badb4ad490d7477a17cb9d8b420
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 18 15:14:26 2021 -0300

    Bug 23666: Add spec
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e964b12284355e973265cbf1645526e3e5dfad9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 19 08:01:31 2021 -0300

    Bug 23666: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e5d654c7ae16167af347adfd1e5008cb4d99034
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Tue Dec 15 14:41:11 2020 +0100

    Bug 27240: Basket export cleanup.
    
    Remove spaces and irrelevant links.
    
    Test plan:
    1 - Create a basket
    2 - Export it in excel
    3 - There's a lot of spaces in Order column and irrelevant 'Add internal note'
    4 - Apply patch
    5 - Export file
    6 - It's tidier, fewer spaces and no useless Add/edit note links
    
    https://bugs.koha-community.org/show_bug.cgi?id=27240
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cabe5e184fb1d02464eda4de859bb6ebf2109d9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 21 11:16:18 2021 +0000

    Bug 23195: (follow-up) One text invoice should be open
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83941d2ee18c4c94485b0feea510d5899c1ee050
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 12 18:13:47 2021 +0000

    Bug 23195: Always count shipping costs as 'spent'
    
    As shipping costs are created when an invoice is created, and creation
    of an invoice implies that items have been received, the shipment costs
    are always assumed to be 'spent'
    
    This logic is true in GetBudgetSpent/GetBudgetOrdered, however, GetBudgetHierarchy
    treats open invoices shipping costs as 'ordered' and closed invoice shipping costs
    as 'spent'
    
    This leads to inconsistencies in acqui-home vs spent.pl and ordered.pl
    
    To test:
     1 - Find a vendor
     2 - Click 'Receive shipments'
     3 - Create a new invoice with a shipping cost on budget A
     4 - Repeate and create a new invoice with a shipping cost on budget B
     5 - Close the second invoice
     6 - View acquisitions ome
     7 - Note budget A includes the shipping under ordered
     8 - Note budget B includes the shipping under spent
     9 - Click the 'ordered' column on budget A - no shipping is listed on ordered page
    10 - Click the spent column on budget A - the shipping is listed here
    11 - Apply patch
    12 - Both budgets list the shipping as 'spent'
    13 - Both 'spent' pages include the shipping
    14 - Neither 'ordered' page includes shipping
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d505e5ba06ba12194676b5183bed4827d4b9eea
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 12 18:13:21 2021 +0000

    Bug 23195: Unit tests
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ac1067b64edfb8d250d61b5242bdefbe241cf83
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 22 09:09:13 2021 +0000

    Bug 16787: DBRev 20.12.00.036
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9c2416b94cec6718d29ccd24750dbec2560d6d1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 21 11:27:46 2021 +0000

    Bug 16787: (follow-up) Add noReservesAllowed to ERROR_MAP
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 750a7646b8529eb228d8192464bc5821c58c10fb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 15 12:20:08 2021 +0000

    Bug 16787: (follow-up) Fix check to ensure reasons are passed to template
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e5d8a8567f13384292beff5e788ea875e0f6239
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 4 18:43:37 2020 +0000

    Bug 16787: DBIC schema changes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 087a4f4bc9a882a1b9c8e68cd644ca72e69e3676
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Mar 2 16:49:16 2020 +0000

    Bug 16787: Add noReservesAllowed to club holds
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f23622041dba9d882ff27b0a879aae7f642a6c8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jun 21 09:52:47 2016 -0400

    Bug 16787: 'Too many holds' message appears inappropriately and is missing data
    
    This patch alters C4/Reserves.pm to pass back 'noReservesAllowed' when
    allowedreserves=0. This allows passing to the user an appropriate
    message about the availability of items for holds
    
    This patch also fixes a FIXME about using effective_itemtype to fetch item rules
    
    To test:
    1 - Set one itemtype to allow no holds
    2 - Set 'Holds per record' to 0 for another itemtype/patron combination
    3 - Create or find 2 records, each with items only of the itemtypes above
    3 - Attempt to place a hold for a patron on each record above
    4 - The message will be 'Too many holds'
    5 - Apply patch and repeat
    6 - Message should be "Cannot place hold: no item are available to be placed on hold"
    7 - Try placing a multihold with either record above and a holdable record,
      message should end "Cannot place hold on some items'
    8 - prove -v t/db_dependent/Holds.t
    
    Rebase - Fix test expectation
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3625010bbf4e1eff428d9d1d7c5db2cd24045aa
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 11 09:14:38 2021 +0100

    Bug 27120: (follow-up) also send biblionumber
    
    Like in after_biblio_action hook
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e4d37b03158aa24c5bd01a13a7acd53df8e2213
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 1 09:27:01 2020 +0100

    Bug 27120: Send biblio to Koha plugins hook 'intranet_catalog_biblio_tab'
    
    Koha plugins hook 'intranet_catalog_biblio_tab' should have the datas of the current biblio record.
    Koha::Biblio is aleady in template, send it with hooks call.
    
    This will be very usefull to be able to fetch external datas
    (wikipedia, youtube, ...) depending on current biblio record.
    
    Test plan :
    1) Enable Koha plugins
    2) Install plugin attached to this bug
    3) Go to staff interface on a biblio record details page
    4) Check you see tab 1 containing 'Tab for record {title}'
    5) Check you see tab 2 containing 'Tab for record {isbn}'
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b385e1f529a26e1c592355b9f7c2cec3259812df
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 9 16:47:35 2021 +0000

    Bug 27114: (QA follow-up) Add missing POD
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0fecf3ff77da1344e915fe027a6fb11af475bb5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Nov 30 08:39:41 2020 +0100

    Bug 27114: Use Template Toolkit plugin for Koha plugins hook 'intranet_catalog_biblio_tab'
    
    Koha plugins hook 'intranet_catalog_biblio_tab' is for a template,
    it will be better it uses Template Toolkit plugin like intranet_js, ...
    It will allow using it in other places like MARC details page for example.
    
    Test plan uses a plugin from git.biblibre.com because this hook is not
    yet in KitchenSink.
    
    Test plan :
    1) Enable Koha plugins
    2) Download and install the latest version of this plugin
    https://git.biblibre.com/biblibre/koha-plugin-intranet-detail-hook
    3) Browse to catalogue/detail.pl for a record
    4) Note you see two new tabs with content
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adcc5d6273a82ae37251e8b861f43243273a52cd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 22 11:13:33 2021 +0200

    Bug 23207: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2efad4356ce347ef36e92b66a21bb3322db4d178
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 22 09:09:13 2021 +0000

    Bug 23207: DBRev 20.12.00.035
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 137b845f23043c0f1f64d956b28c5cd4d8124e23
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 22 09:03:01 2021 -0300

    Bug 23207: Automatic checkin items should never be overdue
    
    This patch makes Koha::Checkouts->automatic_checkin pass the date_due as
    return date to AddReturn.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Checkouts.t
    => FAIL: The feature is not working properly
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78f6bb6fa150eb2773fecbbbe5d7d07acb4ea742
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 22 08:57:19 2021 -0300

    Bug 23207: Regression tests
    
    This patch introduces a regression test for the case the automatic
    checkin happens after the date due. In that case the item souldn't
    really be overdue, and the checkin should be recorded with the date due
    as return date.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Checkouts.t
    => FAIL: The feature doesn't behave correctly
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d379cf6981a4ac726df78a9f15918111893c063
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 21 16:29:20 2021 -0300

    Bug 23207: (QA follow-up) Add to cron files
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 253534673b5be46adc020cba113a8f2598254515
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 21 16:20:32 2021 -0300

    Bug 23207: (QA follow-up) Add new column on item types UI table
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c92c568574edf532baf360881d71fb4be730bf44
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 21 16:17:25 2021 -0300

    Bug 23207: (QA follow-up) Add COMMENT to new column
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    JD amended patch: FIX syntax error.(swap COMMENT and AFTER)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cdf324f135699e32f41c2ff0e92b145de1cd13aa
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 16 13:40:08 2021 +0100

    Bug 23207: (QA follow-up) Move option
    
    This patch impliment the changes as suggested by Andrew on the bug
    report. I agree that the suggested location fits better in the page and
    the updated description is clearer.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7439579b8b75a8b1b1a146b55c03b108df0c621d
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Dec 4 18:47:31 2020 -0300

    Bug 23207: Add automatic checkin feature
    
    This patch adds the posibility to set an itemtype with automatic
    checkin. It means that when the checkout is due, it will
    automatically check in.
    
    To test:
    1. apply patches
    2. updatedatabase
    3. go to koha administration -> item types and edin an item type (from
       now on called itemtype1)
    CHECK => there is a checkbox almost at the end called automatic checkin
    4. check that checkbox and save
    5. checkout 2 items from itemtype1 and one item from another itemtype
       (from now on called itemtype2)
    6. go to mysql database console (koha-mysql) and manually set date_due = current_timestamp
       in issues table for the item of itemtype2 and only one of the items of
    itemtype1
    7. run cronjob at misc/cronjobs/automatic_checkin.pl
    8. go to mysql database console again and select * from issues
    SUCCESS => All issues are present except for the issue of itemtype1
    which had it's date_due set to current_timestamp. That one was
    automatically checked in.
    9. prove t/db_dependent/Koha/Checkouts.t
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Hasina Akhter <HasinaA@pascolibraries.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b1b2be4c3fa65a9b3f65b368b2b9a9439ab3db9
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Dec 4 18:47:31 2020 -0300

    Bug 23207: Set automatic_checkin column as boolean in Itemtype schema
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Hasina Akhter <HasinaA@pascolibraries.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6af090d3a3b7cfda1b9871283471d11144e09119
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Dec 4 18:47:30 2020 -0300

    Bug 23207: Add automatic_checkin column to itemtypes table
    
    installer/data/mysql/kohastructure.sql
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Hasina Akhter <HasinaA@pascolibraries.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit afa9359d1947afcfcc19dc53447f7fee19907ee5
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Dec 4 18:47:32 2020 -0300

    Bug 23207: Add test
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Hasina Akhter <HasinaA@pascolibraries.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 295d865b061e5502d07c1127ec7dcc79255e8361
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 21 16:05:35 2021 -0300

    Bug 28190: Fix columns_settings.yml itemtypes entry
    
    The parent_code column is missing on the columns_settings.yml file, so
    columns are shifted and thus 'Library limitations' is not toggable.
    
    To test:
    1. Verify you are not offered the chance to hide the column
    2. Apply this patch, restart all the things
    => SUCCESS: You can toggle the column
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f233d930b4623be18a7e2b8ac7e71b2a2820bb7
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Thu Apr 22 01:50:07 2021 +0000

    Bug 26703: (follow-up) fixed some page titles in files
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name
    of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Esnure each othe files auth.tt, admin/transfer_limits.tt and
    circ/transfers_to_send.tt have page titles that are swapped around to
    display the most unique information first, and the wensite name is at
    the end
    3) Esnure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    
    JD amended patch: remove dup "IP address change"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5b715a8538cc71bb74eade8464821845f40dc4a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 17:25:20 2021 +0200

    Bug 23271: Fix random failure from Categories.t
    
     #   Failed test 'The branch limitation should have been stored and retrieved'
     #   at t/db_dependent/Koha/Patron/Categories.t line 57.
     #     Structures begin differing at:
     #          $got->[0] = 'fm0A1a'
     #     $expected->[0] = 'vNquBvCa'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd3b509d551e9d2f1c1154cb3cc9ff5344213905
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 16:57:08 2021 +0200

    Bug 23271: Fix Template/Plugin/Branches.t
    
        #   Failed test 'Without selected parameter, my library should be preselected'
        #   at t/db_dependent/Template/Plugin/Branches.t line 81.
        #          got: '0'
        #     expected: '1'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit feaeff330cfa9d49c99a0d70da0df87f5316652b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 15:25:33 2021 +0200

    Bug 27644: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58c275e04b11b2f0f54b014f31e4054cd92f5a1f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 6 11:28:35 2021 -0300

    Bug 23583: Handle OpacHiddenItems with yaml_preference
    
    This patch makes all places in Koha that rely on OpacHiddenItems
    actually use C4::Context->yaml_preference instead of manually calling
    the YAML libraries and handling it.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Items* \
               t/db_dependent/Koha/Item* \
               t/db_dependent/Koha/Filter/EmbedItems.t
    => SUCCESS: Tests pass!
    3. Try hiding things with opac-ISBDdetail.pl and opac-search.pl
    => SUCCESS: Things work the same!
    4. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bb9b8b5514f512dfba74ca1ace97ec7fbcb4884
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 9 12:09:28 2021 +0000

    Bug 28119: Use full description in layout type selection
    
    This patch changes the template for editing label layout so that a full
    description of label types is shown to the user rather than brief names.
    
    To test, apply the patch and go to Tools -> Label creator -> New ->
    Layout.
    
    - On the "Choose layout type" line you should see selections with full
      descriptions, e.g. "Only the barcode is printed."
    - Choose a layout type and save the layout. Confirm that your choice was
      saved correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 28119: (follow-up) Remove unnecessary punctuation
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a01f7fac96a43b3f1ab3bcff8901ef1be088181e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 6 12:12:47 2021 +0000

    Bug 28086: OpacMaintenance page should use ReplytoDefault if set
    
    This patch changes the OPAC maintenance template so that it checks for a
    value in the ReplyToDefault system preference when displaying the
    "please contact the site administrator" email link.
    
    Also changed: If neither ReplytoDefault nor KohaAdminEmailAddress is
    defined, it won't show the link at all.
    
    To test, apply the patch and set the OpacMaintenance preference to
    "Show."
    
     - In the OPAC you should see the "System Maintenance" page.
     - Test this page with various settings:
       - ReplytoDefault and KohaAdminEmailAddress both populated.
       - Only ReplytoDefault
       - Only KohaAdminEmailAddress
       - Neither.
    
     Confirm that the correct email address is used in each case.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1c28724408eb08b22ab9d8720d6acb37e174288
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Apr 18 02:06:17 2021 +0200

    Bug 27644: (QA follow-up) Remove size=1 from template
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 983feccf648cd3c77d05795cfc0eb2c098977835
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 7 18:09:09 2021 +0000

    Bug 27644: (follow-up) Wrap strings in translation function
    
    This patch updates the in-template JavaScript so that some English
    strings which were previously untranslatable. This patch wraps them in
    the _() function.
    
    To test, apply the patch and test that the correct strings are
    translatable. In this example I'm testing fr-FR:
    
    - Update a translation:
    
      > gulp po:update
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for the strings pulled from
      JavaScript  e.g.  misc/translator/po/fr-FR-staff-prog.po
    - Locate strings pulled from reports/guided_reports_start.tt for
      translation, e.g.:
    
      #: koha-tmpl/intranet-tmpl/prog/en/modules/reports/guided_reports_start.tt:1324
      #, fuzzy, c-format
      msgid "Authorized value category:"
      msgstr "Catégorie de valeur autorisée&nbsp;: "
    
    - Edit the "msgstr" string if necessary, or remove the "fuzzy," before
      "c-format"
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    In the staff interface, switch to the language you're testing. Confirm
    that your translated strings appear. In this case, test in particular:
    
     - The controls on the modal window when you preview a report's SQL from
       the list of saved reports.
     - The controls and modal dialog for inserting a runtime parameter.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9a15b73f01796e1f6f71e5eca8efbee94958af5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 5 18:28:15 2021 +0000

    Bug 27644: Add button to SQL report editor for inserting runtime parameters
    
    This patch adds a button menu to the SQL report CodeMirror editor for
    inserting runtime parameters. Each menu item triggers a modal dialog
    where the user can specify a parameter label and any other relevant
    option.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Reports -> Use saved.
    - Create or edit a report.
    - You should see a menu button above the SQL editor field, "Insert
      runtime parameter."
    - The menu should contain the options "Authorized value," "Date," "Item
      types," "Libraries," "Patron categories," and "Text field."
    - Test each option. Each should trigger the display of a modal dialog
      with a heading which corresponds to your choice.
    - In all cases except the "Authorized value" choice you should see a
      single form field for "label."
    - Enter text in the label field and click the "Insert parameter" button.
    - The correct runtime parameter should be inserted into the SQL editor.
      - If you placed a cursor somewhere in the SQL editor first, your
        parameter should be inserted in that location in the editor.
      - If you selected some text in the editor before selecting a
        parameter, the paramter should replace the selected text.
    - In the case of the "Authorized value" selection, the modal dialog
      should include both a label field and a field for choosing an
      authorized value category.
    - Try submitting the form without selecting an authorized value. It
      should warn you that the field is required.
    - After testing the authorized value selection, try inserting another
      parameter to confirm that the authorized value selection (now hidden)
      is no longer required.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08c575f8d6e3fafae8ba455404429d7446d768c8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jun 2 15:26:31 2020 +0100

    Bug 23243: (follow-up) Update wording as requested
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ddba2b7371fc139f21439aafa691ca9c42b0a7c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 12 11:07:31 2019 +0100

    Bug 23243: Adjust previous patch
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eeca29afed1b9b9dfc04d3c7ecdc120ff4072fe8
Author: Maxime Pelletier <pelletiermaxime@gmail.com>
Date:   Mon Aug 11 10:53:01 2014 -0400

    Bug 23243: Restore filtering out historic expired subscriptions
    
    The 'Check Expiration' page in Serials is now hardcoded to display all
    expired subscriptions before the entered date. This patch restores the
    ability to limit the results to just those expiring between 'today'
    and the date entered.
    
    Original code taken from bug 6968 autored by Maxime Pelletier, rebased
    by Charles Farmer and then moved to a new report and rebased again by
    Martin Renvoize.
    
    Test plan:
    1) Without the patch any results after a search from this page will
       result in matches both before after todays date (but before the date
       you entered).
    2) With the patch you should see a 'Show historic expirations' checkbox
       which will allow you to limit the results to just those that expire
       between the date you enter and today.
    
    Sponsored-by: CCSR
    Rescued-by: Charles Farmer <charles.farmer@inlibro.com>
    Rescued-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e07c9e9f0646352b25d36602e7b6dbb3e839c9c2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 16 11:03:11 2021 +0100

    Bug 14300: Add %P to SIP LogPattern
    
    This patch adds `%P` to the SIP log4perl configuration so that PID is
    recorded against log lines.
    
    This allows transactions to be more easily tied together under one
    SIPServer, thus making it easier to pick out a whole transaction from
    start to finish.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 572c0981c3f678fbb32476b8060ca79f0e642016
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Sat Apr 10 15:48:17 2021 +0000

    Bug 28127: add transaction timestamp to register details tables
    
    To Test:
    -Enable POS and setup some registers
    -Make some transactions
    -Go to Point of Sale > Register details and look at the two tables, sales and past sales
    -No timestamp or transaction date
    -Apply patch and look again
    -See Tranactions dates in the Transaction column
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 596e59f2a91ac8f2756a7b83083f2bac606cd3bb
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 4 14:02:52 2021 +0100

    Bug 21883: Show authorized value description for withdrawn in check-in
    
    During check-in (circ/returns.pl) the withdrawn information may be
    displayed in a message :
    "Item is withdrawn".
    
    Like Bug 21877 we should display the withdrawn authorized value description during check-in.
    
    This patch adds this display.
    
    Text changed in order to look maximum like in checkout :
    https://git.koha-community.org/Koha-community/Koha/src/commit/a57278f39b8c5b7a82b21671f266dbf32e2d41a0/koha-tmpl/intranet-tmpl/prog/en/modules/circ/circulation.tt#L368
    Uses class 'ci-withdrawn' to ease hidding this new information via CSS.
    
    Test plan :
    1) On a catalog with items.withdrawn defined with authorized values
       category WITHDRAWN
    2) Define in WITHDRAWN an authorized values 1 with description
      'dropped in trash'
    3) Define in WITHDRAWN an authorized values 2 with description
       empty
    4) Check-out an item
    5) Edit this item with withdrawn=1
    6) Check-in this item => You see 'Item has been withdrawn (dropped
       in trash)'
    7) Edit this item with withdrawn=2
    8) Check-in this item => You see 'Item has been withdrawn'
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00dfcfcbe8c2f974dd3fe0939fcf8a8087c18dbd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 1 13:40:41 2020 +0100

    Bug 21883: Pass the item to the template
    
    This patch update the controller to pass a full item object to the
    template instead of a subset of item fields and updates the template to
    utilise the object.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cef6bbd660e45f49aee165e72f2448d92aeac32b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 18 16:18:09 2021 +0100

    Bug 27465: Add column visibility to admin/cities.pl
    
    We want admin/cities.pl to be using as much DT features as possible to be used as an example.
    
    Test plan:
    Add some cities, go to admin/cities.pl confirm that you can show/hide
    column.
    
    Go to the tables settings admin page and confirm that you can set some
    default settings from there.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a941e5b86f36256327d3a890c5037145cb935f7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 11:53:53 2021 +0200

    Bug 23271: Prevent crash if called without parameters
    
    Can't use an undefined value as a HASH reference at /kohadevbox/koha/Koha/Objects/Limit/Library.pm line 87.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfdb4961d9e57a22a3e7dc6cdc10e86c5ff32e9e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 13 15:47:30 2021 +0200

    Bug 23271: Remove 'selecteds' from Branches
    
    Restoring the first version of this from the first patch and reverting
    what hit master first.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10b82a72fa6ef39a43c4dd9de04eb01f7196ab62
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 13 09:09:11 2021 -0300

    Bug 23271: (QA follow-up) Minor POD fix
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6e0b04f48e8f0a02dbb8d48152646257d9accba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 16 14:53:48 2019 +0200

    Bug 23271: Replace search_limited with search_with_library_limits
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c0c62316854287acb611a1966dbf762f9524419
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 16 14:49:42 2019 +0200

    Bug 23271: Use Koha::Object::Limit::Library for Koha::Patron::Categories
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 140926c210617decd58825ed7c2f5d2931c528b3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 16 14:37:28 2019 +0200

    Bug 23271: Improve library limitation selection for item types
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff3d99eded25202c565ca78b934e8809b719e247
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 13 08:58:58 2021 -0300

    Bug 23271: (QA follow-up) Make search_with_library_limits fallback to userenv if required
    
    This patch makes  the generic method rely on C4::Context->userenv if the
    library_id is not passed.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron/Attribute/Types.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99eaab903f4b3576809f42f98c78db8101aae0e2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 8 11:27:21 2021 +0200

    Bug 18912: Split info into different columns
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f72e0d4f9f6b3b59b8303360648c5b5173c6308b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 18 11:47:44 2021 +0000

    Bug 18912: (follow-up) Add even more information
    
    This follow-up proposes that we add even more information (collection
    code, item type) and puts the new information in to table columns.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63cc298016e512197f94072d9ce76d7e8e725099
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 10:01:00 2021 +0100

    Bug 18912: Display more info when using itemBarcodeFallbackSearch
    
    Using itemBarcodeFallbackSearch entering a barcode on checkout will do a keyword
    search and provide you with a list of items matching the search term for checkout.
    This allows checking out items, where there is no barcode in the item (you still need
    a dummy barcode in Koha).
    
    At the moment the table of items to choose from will only chow the title and the dummy barcode.
    
    In order to make it more useful and easier to identify the correct item,
    we should show more information here:
    
    - callnumber (952$o)
    - serial enumeration (952$h)
    - copy number (952$t)
    - inventory number (952$i)
    
    (description copier from comment 0)
    
    Test plan:
    - Turn on itemBarcodeFallbackSearch
    (If you have ES you need bug 27597)
    - Check an item out using "street" or a search that will return several
    items
    - Note that you have now more info about the items
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ae4f91f3b60845751eb17d323fb1798a559823e
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed Mar 3 14:12:34 2021 -0500

    Bug 27852: Link YES_NO authorized value category to 942dev in Default framework
    
    This patch add the YES_NO authorised value category to
    942dev in the Default framework and sets the default value
    to 0 (No).
    
    To test:
    1) Load the yaml file
    1) Load the yaml file
    (I used the load_yaml.pl script after deleting the values from my database)
    2) Go to cataloging and open an empty cataloging form
    using the Default framework
    2) Go to 942dev: the value should read No and there should
    be a drop down choice between Yes and No
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4568e7f7c47d783064573d2e23046e7f22344c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 12:01:54 2021 +0200

    Bug 26703: Fix selenium tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6017705e3d91422d8c6042a0eed1658eadc9d33
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Tue Apr 20 09:00:57 2021 +0000

    Bug 26703: (follow-up) remove starting separator from csv profiles title
    
    Rearranged the separators in the csv profiles page title to match other page title formats.
    
    To test:
    1) Go to the staff client
    2) Go to the CSV profiles page in the Tools module
    3) Check that the page title is "CSV export profiles › Tools › Koha"
    4) Check that the page title when adding a new profile is "New CSV profile › CSV export profiles › Tools › Koha"
    5) Check that the page title when editing a profile is "Modify a CSV profile › CSV export profiles › Tools › Koha"
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0229996ad385296db1a9fdf66b88cace4a631fe0
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sun Apr 18 09:38:03 2021 +0000

    Bug 26703: (follow-up) corrected currencies title
    
    Corrected the page title in the admin/currency file.
    
    To test:
    1) Go to staff client
    2) Go to admin/currency
    3) Check that the page title is "Currencies > Currencies & Exchange rates > Administration > Koha"
    4) Check that when adding a currency, the page title is "New currency > Currencies & Exchange rates > Administration > Koha"
    5) Check that when modifying a currency, the page title is "Modify currency '[Currency name]' > Currencies & Exchange rates > Administration > Koha"
    6) Check that when deleting a currency, the page title is "Confirm deletion of currency '[Currency name]' > Currencies & Exchange rates > Administration > Koha"
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2124ee96efc24247560bb9f3ff098510fd7ba92e
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sun Apr 18 09:21:29 2021 +0000

    Bug 26703: (follow-up) corrected aqbudgets title
    
    Corrected the admin/aqbudgets file so that the page title displays
    correctly.
    
    To test:
    1) Go to staff client
    2) Go to admins module
    3) Go to aqbudgets page
    4) Check that the page title is "Funds > Administration > Koha"
    5) Check that when modifying a fund the page title is "Modify Fund > Funds > Administration > Koha" or "Modify Fund [Fund Name] > Funds > Administration > Koha"
    6) Check that when adding a fund the page title is "Add Fund > Funds > Administration > Koha"
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef9d877a123e641ce545d80a4b6c7e37634b0c55
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 10 16:29:27 2021 +0000

    Bug 26703: (follow-up) Reverse title for mana report search results
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e4aaf09f9babfbd3b3dfa654a32298f7fa6e73b
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 2 00:39:53 2021 +0000

    Bug 26703: virtualshelves folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the virtualshelves folder are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6f036a7ac8aa9036cd3d6025e8793dfc41a9aaa
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 2 00:35:20 2021 +0000

    Bug 26703: tools folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the tools folder are swapped around
    to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8b3ae3819bf262fe98aa6c14fe7632c0e09f64d
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 8 01:14:21 2021 +0000

    Bug 26703: suggestion and tags folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the suggestion and tags folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f292b25ce7b1f6ccb0d526fd03ccf9b96928e93
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 23:49:42 2021 +0000

    Bug 26703: serials folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the serials folder are swapped around
    to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cc05042e22c4ff46afb32a49f481038154370a0
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 23:23:04 2021 +0000

    Bug 26703: reserve, reviews & rotating_collections folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the reserve, reviews and rotating_collections folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0de41be96a128455c9eb295934c4b0a0e6be3e10
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 23:20:43 2021 +0000

    Bug 26703: reports folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the reports folder are swapped around
    to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82741d0043fffce81b573dc05a7a84f9b00283be
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 22:17:19 2021 +0000

    Bug 26703: plugins and pos folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the plugins and pos folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2c1ca6ca81cbaa247e97cf8c52a297581d5a7e6
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 21:43:53 2021 +0000

    Bug 26703: patroncards and patron_lists folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the patroncards and patron_lists folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93d2f8fb286bb01333db5861d5e7c4b768864d81
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 21:26:41 2021 +0000

    Bug 26703: offline_circ and onboarding folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the offline_circ and onboarding folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1701149e900f6cd23755483da2052be413365c87
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 21:23:22 2021 +0000

    Bug 26703: members folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the members folder are swapped around
    to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51d4c23a7e089f66a4a8856b2f3eddf1e54980ba
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 20:50:04 2021 +0000

    Bug 26703: labels folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the labels folder are swapped around
    to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 208b277d7e6323a101603b77f2ad428ee1e6c14b
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 02:36:28 2021 +0000

    Bug 26703: errors, ill and installer folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the errors, ill and installer folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33f5b83c858015f154d4c8c4efbb14bb04167282
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 02:23:12 2021 +0000

    Bug 26703: clubs, common & course_reserves folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the clubs, common and course_reserves folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d71899ec3a4f2dbd3556e982fb9dfa5f4ed93e5
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 02:15:26 2021 +0000

    Bug 26703: circ folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the circ folder are swapped around
    to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f451e7712bd4a330530adbe7e4842220d01d20ba
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 01:54:45 2021 +0000

    Bug 26703: cataloguing folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the cataloguing folder are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8815bdc8cfed1b4e04e85cf32a1aaa7e461cce1
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 01:17:59 2021 +0000

    Bug 26703: catalogue folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the catalogue folder are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fa9a60406328715458faad660088e5ff1711509
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 1 00:50:54 2021 +0000

    Bug 26703: authorities, basket and batch folders
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the authorities, basket and batch folders are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 001095eae58b508ce43c7004a87c9a105c71fa37
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sun Feb 28 23:14:17 2021 +0000

    Bug 26703: admin folder
    
    Swapped the order of the page titles to have the unique information
    first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the admin folder are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 559e64a5f2ad5d9166e39c59d9fec1dd8319dd4d
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Fri Feb 26 02:32:31 2021 +0000

    Bug 26703: modules and modules/acqui folders
    
    Swapped the order of the page titles to have the unique information first, i.e. the name of the specific page displays first, and the name of the website (e.g. Koha) displays at the end.
    
    To test:
    1) Apply patch
    2) Ensure each of the files in the modules folder and the modules/acqui folder are swapped around to display the most unique information first, and the website name is at the end
    3) Ensure the pages displayed on the Staff Client that correspond to
    these files also display the changes
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99c10bf4484635e9befdc9c09a56c0f7278c7976
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 10:50:29 2021 +0200

    Bug 27830: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 953088f8167c545318fe63d41912eda657cde705
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 14 11:35:17 2021 +0000

    Bug 27830: (follow-up) Merge DE and FR address formats
    
    Library addresses don't include the use of "Street Type" and "Street
    Number." DE and FR address formats differ only in the position of street
    type and number in the address sequence.
    
    This patch merges DE and FR address markup and uses the unified block if
    the address format system preference ISN'T "us".
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1e309c62802100b2db1b2cdf2109c275be8da06
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 4 13:57:32 2021 +0000

    Bug 27830: OPAC library list does not use AddressFormat
    
    This patch adds a new include file for displaying library addresses
    according to the AddressFormat system preference. It differs from the
    include file used for patrons in the staff interface because library
    addresses don't use streetnumber or road types.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Make sure you have fill address information entered for at least one
      library.
    - In the OPAC, view the "Libraries" page.
    - Check that the format of the library addresses is correct when using
      any of the three address formats: de, fr, and us.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55b050b607869169aae2c52d1f89fd79f62af400
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Jan 7 15:57:16 2021 +0000

    Bug 27282: fix all occurrences
    
    This patch fixes all the occurrences, staff and OPAC. The problem only happens on some versions of Chrome.
    TO TEST:
    -set up a new list with a few items
    -go to /cgi-bin/koha/virtualshelves/shelves.pl and view that list.
    -Click 'Print List' in Chrome.
    -The tab opens but immediately closes itself.
    -Apply patch and clear cache
    -Try again, the print dialouge remains open
    
    -Go to cgi-bin/koha/sco/sco-main.pl in Chrome, make sure you can finish and print successfully
    -In the staff client in Chrome makes sure printing works in the following areas:
        1. /cgi-bin/koha/circ/circulation.pl Print Slip and Print Quick Slip
        2. /cgi-bin/koha/members/boraccount.pl Make a payment and make sure you can print the invoice
        3. cgi-bin/koha/labels/spinelabel-home.pl Make a quick spine label in Chrome and make sure that prints.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fae72d031a080f840b39d892c95f3a9ee6f659ab
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Dec 18 17:28:54 2020 +0000

    Bug 27282: Add window.onafterprint function
    
    TO TEST:
    -set up a new list with a few items
    -go to /cgi-bin/koha/virtualshelves/shelves.pl and view that list.
    -Click 'Print List' in Chrome.
    -The tab opens but immediately closes itself.
    -Apply patch and clear cache
    -Try again, the print dialouge remains open
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61d8ec5075ba95c1fd84be6bfefd547749eaae1d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 14 14:44:53 2020 +0100

    Bug 27232: Add missing space between : and </label> in member-alt-contact-style.inc
    
    It caused the strings to appear twice in the po file
    
    Test plan:
    Apply this patch and regenerate the PO for a given language.
    Notice that the string "%s State: " only appears once in the PO file
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a58cf90a3146f385671e6d82ae65de4f36d33316
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Mar 10 10:33:16 2021 +1300

    Bug 26533: Fix 'is exactly' search for authorities
    
    The exact search 6=3 is implemented, but it isn't used as expected when
    you select 'is exactly' from the authorities search dropdown. This patch
    remedies that.
    
    To test:
    1) Ensure you have an authority with more than one word in the name,
        i.e. Electric power production
    2) Go to Authorities in the staff client.
    3) Change the dropdown to 'is exactly' and search for one of the words
    in your record's title, i.e. 'power' in the 'main heading' search
    4) Confirm your authority shows in the results, even though it is not an
    exact match.
    5) Search for a biblio record and go to edit the record.
    6) Go to Tab 6 and click the plugin button next to one of the 6xx$a
    fields to trigger the authority finder plugin
    7) Repeat Step 3 and Step 4
    8) Go to the OPAC and go to Authority Search
    9) Repeat Step 3 and Step 4
    
    Apply patch
    
    10) Repeat Steps 1 to 9, confirm that this time the record does NOT show
    in search results.
    11) Repeat Steps 1 to 9 but this time search for the authority record's
    full title, i.e. 'Electric power production'. Confirm the record does
    show in the search results because the search term now matches title exactly.
    
    Sponsored-by: Education Services Australia SCIS
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da29bf48db6a5e5c383174962c7b81e6ea5bd5d4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 08:48:26 2021 +0000

    Bug 20854: DBRev 20.12.00.034
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6aa6f115bd2330342675781400199a2f3152abf1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Apr 17 13:38:43 2021 +0000

    Bug 20854: (QA follow-up) Rephrase of the new casServerVersion pref description
    
    For another related change, see:
    https://en.wikipedia.org/wiki/Central_Authentication_Service
    
    CAS = Central Authentication Service
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c3c066714ce568e507348f1e3a9a6b7db0c4815
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 16 16:50:34 2021 -0300

    Bug 20854: (QA follow-up) Improve readability
    
    The logout_cas method does too little tasks. In this case, I consider we
    should not split it into a separate method. As the CAS implementation
    lacked tests, it made sense to do it like this, so it is testable. But
    now we have higher-level tests for logout_cas, we can bake the behavior
    inside of it, and it is testable.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c71dda04c605b68b439e1a0ea3132447eeb28b45
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 16 16:46:14 2021 -0300

    Bug 20854: Add more CAS tests
    
    This patch aims to add full test coverage for 'logout_cas' the way we do
    it nowadays (in a subtest, mocking things, etc). It is provided as a
    separate patch so we can test the follow-up tidy and see no behavior
    change.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Auth_with_cas.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Apply the refactoring follow-up
    5. Repeat 3
    => SUCCESS: Tests still pass!
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91307707ed2ff874ec5e2f25658a286019204e54
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Mon Oct 12 15:58:31 2020 +0200

    Bug 20854: Allow correct redirect on logout for Cas servers 3.0 and superior.
    
    Test plan:
    
     1) Apply the patch
     2) Set the system preference casLogout to "Yes"
     3) Set the new system preference CasServerVersion to "CAS 3 or superior"
     4) Check that you are redirected to Koha after a CAS logout from a CAS 3 server
     5) Set the new system preference CasServerVersion to "CAS 2 or inferior"
     6) Check that you are redirected to Koha after a CAS logout from a CAS 2 server
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04631818e3c0a56859cb0f029b53111303b60f11
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Apr 16 19:49:36 2021 +0000

    Bug 28162: fix doubled scalar sigil
    
    TEST PLAN:
    
    1 Set up some patron extended attributes
    2 Make sure you check 'Display in OPAC' and 'Editable in OPAC'
    3 Go to self registration and attempt to register
    4 you get an error ( Not a SCALAR reference at /kohadevbox/koha/opac/opac-memberentry.pl line 110 )
    5 Apply patch
    6 repeat steps 1-3, ther should be no error now
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1dcab586427fb2aa1b1c676a4dc2046c202ee671
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 6 17:56:17 2021 +0200

    Bug 28096: Fix table settings for API datatables wrapper
    
    Bug 25287 added the table settings to the API datatables wrapper but it does not
    handled correctly the hidden columns.
    
    Test plan:
    Go to Home > Administration > Table settings
    Administration > libraries
    Tick "Is hidden by default" for "library_address"
    Go to Home > Administration > Libraries
    Click Columns and check the "Address" column, it must be hidden
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c285de980266a23919fe64d26665ccd53355b820
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 11:39:36 2021 +0200

    Bug 28028: Remove misc/migration_tools/fix_onloan.pl
    
    There is an obvious error in the script since bug 23463 and it's known
    to be broken for 10 years now (since bug 5579). As nobody complains we
    can safely remove this script.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bda9b9e122df436d48e6416d140a7bbb45c8546c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 4 17:27:16 2021 +0100

    Bug 27861: Warning in C4/XSLT.pm - use of uninitialized value in numeric eq (==)
    
    In C4/XSLT.pm :
     elsif ( exists $itemtypes->{ $item->effective_itemtype }
                && $itemtypes->{ $item->effective_itemtype }->{notforloan} == 1 )
    
    itemtype.notforloan is null by default, its generated a warning in logs.
    
    Test plan :
    1) Choose a record with itemtype.notforloan = NULL
    2) Perform a search in the OPAC which will return results which
       include the record using XSLT
    3) See patch removed warning
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adf73341e6883a80323695a4e85a2fd37bf7f53e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 08:48:25 2021 +0000

    Bug 26940: DBRev 20.12.00.033
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 789ddd59c92183af350eba427ad545e3dce82422
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 18 12:23:48 2020 +0100

    Bug 26940: Take empty strings into account
    
    Signed-off-by: Katariina Hanhisalo <katariina.hanhisalo@xamk.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c309ee36dde958ff8049c4ed6e381c2d5858dc68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 17 12:18:48 2020 +0100

    Bug 26940: Put in sync borrowers.debarredcomment with comments from borrower_debarment
    
    Signed-off-by: Katariina Hanhisalo <katariina.hanhisalo@xamk.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b9f1e1560d4cf565f48a4cd09d048b2ee38689e
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Thu Nov 5 15:04:41 2020 +0100

    Bug 26940: don't reset debarredcomment on patron update
    
    Test plan:
    1) Create a patron
    2) In koha/members/moremember.pl add a manual restriction, with comment foobar
    3) try to checkout, you have a message like
        Restricted: Patron's account is restricted with the explanation:
          foobar
    4) Got to Edit patron, save
    5) try to checkout, foobar is no more
        Restricted: Patron's account is restricted with the explanation:
    6) Apply patch
    7) Redo 1-4
    8) try to checkout, foobar is there.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katariina Hanhisalo <katariina.hanhisalo@xamk.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d82684a328fd4a6d11bd6b414536ee4c05642f0e
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue Nov 10 14:30:15 2020 +0000

    Bug 26989: Safeguard Order Messages from unwanted characters
    
    Carriage returns in notes were causing a supplier's parser
    to truncate Order messages received from Koha.
    Have removed those and also made a global removal of CR, Line feeds
    and tabs - the latter two having the possibility of causing
    errors in the future
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    There was no test plan to follow, but the patch appears to be making
    sensible changes. If someone wants to provide a thorough test plan I can
    re-test.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 078c88ea95a9f12b324786efb66a84b9c823374e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 09:46:46 2021 +0200

    Bug 27857: Remove unecessary $attribute_type3 var
    
    It could be created with mandatory=1 and will make tests fail
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d667150e162dc4fd978112a215367f76af9ea4b6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 21 09:44:58 2021 +0200

    Bug 27857: Start a transaction foreach subtest
    
    There is a random failure
    
         # Looks like you planned 15 tests but ran 2.
    
     #   Failed test 'extended_attributes'
     #   at t/db_dependent/Koha/Patron.t line 664.
     Missing mandatory extended attribute (type=B0vCQxlI)# Looks like your test exited with 255 just after 7.
     [17:00:24] t/db_dependent/Koha/Patron.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f964efacb92997a45e5e46d3309a5f091c10b461
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Mar 2 17:06:09 2021 +0200

    Bug 27836: Document that CirControl changes which calendar is being used
    
    You can verify that which branch's Koha calendar is being used to
    calculate fines by reading for example the code in
    C4::Circulation::_CalculateAndUpdateFine() There you can see that
    $control_branchcode variable is being passed to
    C4::Overdues::CalcFine() and if you trace that you will see in the end
    it decides which branch's calendar to use for calculating chargeable
    overdue fine days.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e62687a1df5e99b013b760353877a2f2be689871
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Wed Apr 14 16:23:35 2021 +0000

    Bug 27277: Queued vs Enqueued
    
    Changed the other occurences of "Enqueued on", "Started on", and "Ended
    on" to "Queued", "Started", and "Ended" (As pointed out by Jonathan).
    
    Task Plan:
    1. Navigate to th background jobs page
    2. Ensure that the spelling of the changes are correct, and that there
       are no other instances of "Enqueued on", "Started on", and "Ended on"
       that have been missed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df71a27a667936ea5e2ef96f0a31b45179ce53c7
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Tue Jan 19 02:07:41 2021 +0000

    Bug 27277: Queued Vs Enqueued
    
    This patch changes "Enqueued on", "Started on", and "Ended on" to
    "Queued", "Started", and "Ended" respectively on the bacground jobs
    page.
    
    Task plan:
    1. Navigate to the background jobs page
    2. Ensure the spelling change, and that the spelling is correct.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d60439b96a708d28bd8612f99c279e69972811b5
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Tue Apr 13 10:49:09 2021 +0000

    Bug 28140: Accessibility: OPAC - "sort_by" select isn't labelled on search results page
    
    This patch adds a label to the sort function on the OPAC
    results page to provide context to screen readers and improve
    accessibility.
    
    The label is visually hidden and does not change how the page
    displays.
    
    To test:
    - Search for something on the OPAC
    - Change how the results are sorted and confirm sort still works
    - Confirm that there are no visual changes to the page
    - Inspect the sort function to confirm it now has a label
    - Ideally confirm the label works with a screenreader
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21ddbae73524d927116d37083a33febc0dfd7818
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Mon Nov 23 15:57:46 2020 +0000

    Bug 26679: Use index-term-genre for 655
    
    To test:
    1 - have a bib with a 655 that is not linked to an authority
    2 - confirm link on OPAC and intranet details uses subject index
    3 - apply patch, restart, reload pages
    4 - confirm links now use index-term-genre and give correct results
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c359c154364b0aa2aff0f368e21bd30e458173a9
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Wed Mar 24 13:56:15 2021 +0100

    Bug 27827: (follow-up) add a hint for clarification
    
    When adding a new authority type, there is no indication of how big
    the authority type code can be (auth_types.authtypecode in the DB has
    a maximum length of 10 characters).
    
    This patch fixes that.
    
    To test, apply the patch and notice the hint appearing right above the
    "Authority type:" text box as you add a new authority type: it should
    display "10 characters maximum" in grey colour.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e20e0006914a118c8c6278be6165ae241a94f0c3
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Tue Mar 2 05:12:37 2021 +0200

    Bug 27827: make the 'Authority type:' input field wider
    
    When adding a new authority type in the Staff client, the 'Authority type'
    input field is too narrow. If you enter something like "OOP_CORPUS" inside
    the textbox, you will have to scroll right and left inside the textbox in
    order to view its contents.
    
    This patch fixes that.
    
    Test plan:
    1) Try to add a new authority type with name "OOP_CORPUS". Notice how
       the input field is too narrow and cannot contain the entire string.
    2) Apply this patch.
    3) Repeat step 1), this time the input field has been widened and can
       accommodate the entire string.
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e56d083461fb5381a21b44c50a06e32a57fee046
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 14 12:27:05 2020 -0300

    Bug 18729: Adapt holds.js
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60a253c983df1cf50193ee60df730e762ce8f504
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 14 12:13:38 2020 -0300

    Bug 18729: (follow-up) Adjust API to new spec
    
    The previous patch introduces some behavioural changes to the API, as
    well as the data types that need to be passed; all happens in the tests.
    
    This patch adapts the route so it complies with those changes:
    - JSON object containing pickup_library_id attribute is now passed back
      and forth.
    - The controller should take care of checking the pickup location is
      valid, using the available tools.
    
    To test:
    1. Apply the patches, up to the tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => ERROR: Tests fail because the controller doesn't implement the
    desired behavior
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9294ab967af113e39a575b116f6a1aa680931bfd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 11 09:11:15 2020 -0300

    Bug 18729: Add more tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf2c59a182837ec397c850ac6e22d52c0ec8d045
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 1 12:29:38 2020 +0100

    Bug 18729: Add PUT /holds/{hold_id}/pickup_location
    
    This patch adds a route to overwrite the current pickup location.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 491147896d5cced31861243b862e403f09d62d98
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 16 12:12:41 2021 +0200

    Bug 28156: Rename Koha::Account::Line->renewal with is_renewal
    
    It's a boolean, it must be named is_*
    
    Test plan:
    Confirm that
      prove t/db_dependent/Koha/Account/Line.t
    is still returning green
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f35571410b191770337708f4e389b49bde15e04e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 6 17:35:33 2021 +0200

    Bug 28069: (bug 27715 follow-up) Fix sort for lists
    
    Sort functionality has been broken by bug 27715. We need to specify the
    table.column in the datatable init
    
    Note that "count" needs to be handled separately (which is a bit dirty
    but cannot find something better)
    
    Test plan:
    Create some lists, add contents, change owner and dates
    Sort using the different attributes and confirm that it's now working
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 891145130c1fd4f216026eeb94c37300c8e3fd01
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Feb 8 15:28:35 2021 +0100

    Bug 27656: misc/cronjobs/longoverdue.pl better error message
    
    There are two ways of configuring misc/cronjobs/longoverdue.pl :
    use --lost arg or system preferencies DefaultLongOverdueLostValue and DefaultLongOverdueDays.
    
    Actually if you don't use any of it, you get a message :
      "ERROR: No --lost (-l) option defined"
    Should also say something about preferencies :
      "ERROR: No --lost (-l) option no system preferences DefaultLongOverdueLostValue/DefaultLongOverdueDays defined"
    
    Test plan:
    1) Set empty preferences DefaultLongOverdueLostValue and DefaultLongOverdueDays
    2) Run : misc/cronjobs/longoverdue.pl --maxdays 365
    3) You see error message
    4) Set DefaultLongOverdueLostValue = 1 and DefaultLongOverdueDays = 90
    5) Run : misc/cronjobs/longoverdue.pl --maxdays 365
    6) You don't see error message
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a155973fbd0fc9cd422cf9e10b3f64c909b05eb
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 1 14:28:24 2020 +0100

    Bug 27125: Show authority type also for UNIMARC in authority search result display
    
    Bug 12533 added authority type in authority search result display.
    But it does not work for UNIMARC, due to :
    https://git.koha-community.org/Koha-community/Koha/src/commit/be9f64b638335cac7465ca302e187c7914534fbe/C4/AuthoritiesMarc.pm#L798
    
    I propose to use result->{authtype}
    
    Test plan :
    1) Use UNIMARC catalogue
    2) Search for autorities
    3) Check you see autority type in column
    4) Same for a MARC21 catalogue
    
    Signed-off-by: Andreas Roussos <a.roussos@dataly.gr>
    I followed the test plan, and the patch works as expected for both
    UNIMARC and MARC21. There is actually an improvement in the MARC21 case:
    previously, the 'Authority type' column for records in the Default
    framework would not display anything, whereas now it displays 'Default'.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8f34430d17fd70e65318532c27dceed184eb7bc
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Thu Sep 24 10:13:08 2020 +0200

    Bug 26528: Z39.50/SRU ignore invalid replies
    
    When searching for authorities if an authorities server reply has invalid records
    none are displayed.
    
    At least french BNF SRU server doesn't fully follow norm and can return an error
    confusing Koha protocol handler which then returns an empty MARC record.
    
    This patch silently removed bogus records.
    
    To Test:
    1- Add BNF SRU server
    2- Go to authorities page
    3- Add an authority
    4- Search for keyword(any) droits de l'homme
    5- No result (Internal Server Error)
    6- Apply patch
    7- restart starman
    8- redo 4
    9- Many records are displayed
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0b0e908f767e510c5538d8e5cfb25f994579441
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 16 16:07:40 2021 +0200

    Bug 15986: Add missing notice template for it-IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb83da9b1d6578ef2c8c6b8e447283324f1e4435
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 22 11:07:03 2020 +0100

    Bug 18017: Use index_heading and index_match_heading in UNIMARC authorities zebra configuration
    
    For a good management of autorities linking to biblio records,
    MARC21 uses index_heading and index_match_heading in authorities zebra configuration.
    UNIMARC configuration must use the same.
    
    This patch adds in UNIMARC authorities zebra configuration index_heading and index_match_heading to earch heading
    in order to be maximum close to MARC21 authorities zebra configuration.
    See changes made in MARC21 :
    https://git.koha-community.org/Koha-community/Koha/commit/32cf2af700dfea15d9c4f99bee97e97c85643896
    
    It fixes some indexes names : Personal-name-see => Personal-name-see-from
    
    Removes useless Term-geographic index, a duplicate of Name-geographic.
    
    Sometimes parallel 7xx form whas only on $a, it must contains same subfields
    has the main heading.
    
    Test plan :
    ===========
    1.0) Use a UNIMARC install without patch
    1.1) Set sysprefs
         BiblioAddsAuthorities = ON
         AutoCreateAuthorities = ON
         LinkerModule = First Match
    1.2) Replace authorities zebra configuration files
         cp $KOHA_CLONE/etc/zebradb/marc_defs/unimarc/authorities/authority-koha-indexdefs.xml $KOHA_CONF_DIR/zebradb/marc_defs/unimarc/authorities/authority-koha-indexdefs.xml
         cp $KOHA_CLONE/etc/zebradb/marc_defs/unimarc/authorities/authority-zebra-indexdefs.xsl $KOHA_CONF_DIR/zebradb/marc_defs/unimarc/authorities/authority-zebra-indexdefs.xsl
    1.3) Restart zebra server and indexer services
    1.4) Reindex authorities
         ./misc/migration_tools/rebuild_zebra.pl -r -a -v
    1.5) Search in Z3950 a record with complex heading (with subdivisions),
         for example ISBN 2877620115 "Facteurs culturels et sociaux de la santé en Afrique de l'Oues"
    1.6) Import this record and save it : authorities are created
         go to staff:/cgi-bin/koha/cataloguing/addbooks.pl
    1.7) Reimport the same record (when asked, say that it's not a duplicate)
    1.8) The authority should have been duplicated :
         different url and different $9 value
    2.0) Apply this patch
    2.1) Replace again the authorities zebra configuration files
    2.2) Restart zebra server and indexer services
    2.3) Reindex authorities
    2.4) Reimport the same record
    2.5) The authority should have not been duplicated. Compare with both
           existing records to see which the 3rd has been matched against.
    3.0) Play with authorities search to check every mode :
         Search main heading ($a only)
         Search main heading
         Search all headings
         Search entire record
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb0f2793908b1b2f7da01c2b32a706508902a1b6
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 17 15:47:48 2020 +0100

    Bug 18017: Add subdivisions to UNIMARC authorities zebra configuration
    
    Like for MARC21, UNIMARC authorities has subdivisions form, general,
    chronological and geographic.
    
    In C4::Heading::UNIMARC, use subdivisions in _get_search_heading like in C4::Heading::MARC21.
    
    Adds subdivisions variables into UNIMARC authorities zebra configuration.
    
    Note that unlike MARC21 geographic is subfield $y and chronological is subfield $z.
    See https://www.ifla.org/publications/unimarc-formats-and-related-documentation
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 051a9d740f8eb3260e814284d80c63ee21beaf9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 16 12:16:47 2021 +0000

    Bug 15986: DBRev 20.12.00.032
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e44788d8c0b749349ad2f7fec6614cb48dfc6cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 16 14:33:24 2021 +0200

    Bug 15986: move holds_reminder.pl to misc/cronjobs/holds/
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3314c0bf0f65d8d9a4f5e49539cce2b64fdcb030
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 15 12:50:32 2021 +0000

    Bug 15986: (follow-up) Switch nomail to confirm
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d20be4f2703e37f3feb6f0588f612df7b29dbdf7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 16:32:12 2021 +0200

    Bug 15986: Fix typo following vs follwing
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d17438eb432368b0ab8e8be985efb13ac91a5af2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 16:18:10 2021 +0200

    Bug 15986: Use KohaDates filter to correctly format the waitingdate
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 340f5426247da1fb4ab195cba0d1bd17c2e5d7d8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 9 14:15:09 2021 +0000

    Bug 15986: (follow-up) Add atomic update
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea6467724cf8e6fac2224e1dcb6c6ddee73736af
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 8 14:55:27 2021 +0000

    Bug 15986: Add sample notice to translated notices
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a351b2379b05cc66ff2b2481eae7b9f85c8c7f82
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 8 14:43:10 2021 +0000

    Bug 15986: Add sample notice and use as default
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2812c418d2fcbdf07baa323087d1a4c62c34cc9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 8 13:43:40 2021 +0000

    Bug 15986: (follow-up) Add all holds per patron
    
    This changes the code to loop through all the holds and group by patron,
    we then send the holds to the letter using the 'loops' option
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97a1beb4e44f7903c35c0c924728ea59ebb965db
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 7 15:01:29 2021 +0000

    Bug 15986: (follow-up) Use inbound_email_address for library
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03b0b98fb26b3a771fc5cee84d2a06efcd0f235c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 7 11:42:37 2021 +0000

    Bug 15986: (follow-up) Fix usage statement
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92cbab3133672d6dcdcd90b9adc17a183b48f222
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 24 11:48:45 2021 +0000

    Bug 15986: (QA follow-up) Fix spelling mistake
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bafcda2c2618e5fdc4f70cbcde8257fb5fd2cc5d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 24 11:40:09 2021 +0000

    Bug 15986: (QA follow-up) Account for bugs 25333 and 25334
    
    Bug 25333 changed the existing 'phone' message transport type to 'itiva' and
    bug 25334 added a new 'phone' message transport type.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1213134a6c998872990c014f045bb0b82eb1fd6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 16 16:46:22 2020 +0000

    Bug 15986: Rename send_notice to queue_notice and update test count
    
    Signed-off-by: Kim Gnerre <kgnerre@hotchkiss.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e014ad644d5d5432c8108654d052d9abbaa368a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 16 16:34:26 2020 +0000

    Bug 15986: Update for bug 24159
    
    The job is concerned with holds waiting and takes days, I think using days_mode 'Calendar'
    makes sense as we are not calculating due dates
    
    Signed-off-by: Kim Gnerre <kgnerre@hotchkiss.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f71937166233743cf554e18886f7174db0faaa78
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jul 12 13:16:45 2016 -0400

    Bug 15986: Add a script for sending hold waiting reminder notices
    
    This patch adds a script for sending holds reminder notice to patrons.
    
    We add a 'send_notice' routine to Koha::Patrons - this will either send using the patron's
    email prefs, or allow forcing of a single method via the cron
    
    To test:
     1 - Create an email hold reminder notice for a single library (Koha module: Holds, code HOLDREMINDER, branch: CPL)
     2 - Set some waiting holds today for patrons at CPL, ensure those patrons have 'email' as the transport for hold filled notices
     3 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -n -li CPL
     4 - You should see the patrons here would have received emails
     5 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -li CPL
     6 - You should see the emails that were sent
     7 - Check the patron notices tab to confirm
     8 - Note a ptron with two holds waiting receives only one notice
     9 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -li CPL -days 3
    10 - No notices are sent
    11 - Adjust the waiting date for the holds:
        UPDATE reserves SET waitingdate=DATE_SUB(CURDATE(), INTERVAL 3 DAY) WHERE waitingdate = CURDATE();
    12 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -li CPL -days 3
    13 - Confirm the holds are now reminded
    14 - Set yesterday as a holiday for CPL
    15 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -n -li CPL -holidays -days 3
    16 - Notices should not be sent
    17 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -n -li CPL -holidays -days 2
    18 - Notices should be sent again
    19 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -n -holidays -days 2
    20 - Should get feedback that notice was not found for other libraries
    21 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -n -holidays -days 2 -mtt sms
    22 - Notice is not found
    23 - Add the notice for sms
    24 - perl misc/cronjobs/holds_reminder.pl -v -lettercode HOLDREMINDER -n -holidays -days 2 -mtt sms
    25 - The notice should be sent
    26 - Check patrons messaging tab to confirm
    27 - prove -v t/db_dependent/Koha/Patrons.t
    
    Sponsored by: The Hotchkiss School (http://www.hotchkiss.org/)
    
    Signed-off-by: Kim Gnerre <kgnerre@hotchkiss.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a5c946d95fabaa4fcea03e4c456b5ef6197ca44
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Mar 16 10:41:53 2021 +1300

    Bug 27961: Ensure external URLs are filtered
    
    TT variables are used to build the link in items.uri . This is a problem
    particularly when TrackClicks is enabled because the items.uri value
    doesn't get escaped, resulting in a 404.
    
    To test:
    1) Enable the TrackClicks system preference (set to Track or Track
        anonymously)
    2) Find a record with an item
    3) Edit the item and put an external URL under the Uniform Resource
    Identifier field
    4) Go to that record in the OPAC
    5) Click on Link to resource
    6) Confirm you are not redirected to the URL and instead see a 404
    7) Apply the patch and refresh the page
    8) Click on Link to resource
    9) Confirm you are redirected as expected
    10) Go back to the staff client to edit your item. This time put two
    URLs in the Uniform Resource Identifier field, separated by ' | '.
    (Don't forget the spaces around the pipe, and don't forget to add a
     trailing slash to the URL).
    11) Go back to the OPAC and refresh the page.
    12) Confirm both URLs redirect as expected.
    
    Sponsored-by: Parliamentary Library New Zealand
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21ed3887fbe3c5f1cb5f8209b434ca32e43f6ade
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 16 14:13:45 2021 +0200

    Bug 21325: Add tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8277db5fe628a4d45aa4c3d37b2f588e9322451a
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Dec 24 01:43:59 2020 +0000

    Bug 21325: Fix t/db_dependent/Auth.t test
    
    This patch fixes some warnings in t/db_dependent/Auth.t.
    
    Note that it doesn't add any tests.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da9006b20dc7439259043822902e05d392df7351
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Dec 24 01:24:08 2020 +0000

    Bug 21325: Prevent authentication when sending userid and password in querystring
    
    This patch permits authentication via userid/password only when the
    HTTP method is POST when using C4::Auth::checkauth().
    
    The goal is to stop people from supplying userid and password in querystrings
    in order to log into web pages.
    
    Test plan:
    0. Do not apply patch yet
    1. Open a new browser (ie we don't want any existing CGISESSID cookies
    available - opening a new tab/window isn't enough. It must be a
    new instance or you can clear your cookies)
    2. Go to http://localhost:8080/cgi-bin/koha/opac-reserve.pl?biblionumber=29&userid=koha&password=koha
    3. Note the user has been logged in and is being asked to confirm hold.
    
    4. Apply the patch
    
    5. Go to http://localhost:8080/cgi-bin/koha/opac-reserve.pl?biblionumber=29&userid=koha&password=koha
    6. Note the user is not logged in and the user is presented with a login screen
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99c3b9ae1f55066f4fd2bd0e37ba336f18592780
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 25 15:34:31 2021 +0000

    Bug 27529: Choose patron's branch or item's homebranch if following group rules and patron cannot choose branch
    
    This patch defaults the holds pickup location to the items homebranch or the patron's branch when a group option is selected
    for the hold fulfillment policy and the patron is not allowed to choose the branch on the OPAC
    
    To test:
    1 - Set 'Default checkout, hold and return policy' -> 'Hold pickup library match' to item's hold group or patron's hold group
    2 - Set  OPACAllowUserToChooseBranch to 'Don't allow'
    3 - Try to place an item level hold on the opac
    4 - Ka-boom, etiher:
        The method Koha::Item->patrongroup is not covered by tests!
        The method Koha::Item->itemgroup is not covered by tests!
    5 - Apply patch
    6 - Repeat
    7 - Note the pickup location is set to either the patron's branch or the items homebranch
    8 - Repeat plan with the other group setting
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a17134a0d1c144ee7cbe2cebb875c98691c63328
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 16 09:41:44 2021 +0200

    Bug 28154: Fix encoding issues on Koha-installer.pot
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10139a2124a06838adb326943d3d4b8d169150ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 15 16:55:30 2021 +0200

    Bug 28154: Fix encoding issues on Koha-pref.pot
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0da874bde2eb9592e6c2036e840aac3ed09dab44
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Mar 18 09:38:06 2021 +1300

    Bug 27979: Modify TrackClicks to verify URL exists in DB when multiple uri
    
    To test:
    1) Go to Admin -> system preferences and enable the TrackClicks syspref
    (set to Track or Track anonymously)
    2) Find a record in the staff client with an item. Edit the item and put
    two external URLs in the Uniform Resource Identifier field, e.g.
    "https://www.google.com/ | https://twitter.com/"
    3) Search for that record in the OPAC. Notice the two links in the
    holdings table.
    4) Click a link and confirm that you are directed to a 404.
    5) Apply the patch and refresh the page
    6) Click a link and confirm that you are directed to the page as
    expected
    7) Go back to edit the record in the staff client and remove one of the
    links from the URI field
    8) Go back to the OPAC and confirm you can still access the link as
    expected when there is only one URI
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 559950cae607e64614a6e860e1d966430a59e1f8
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Apr 13 00:45:42 2021 +0000

    Bug 28123: Fix expected value in unit test
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52f997fcfc88488e1a8bab4a8d52eba6c0501895
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Apr 13 00:39:04 2021 +0000

    Bug 28123: Quote filename value in Content-Disposition header
    
    Chrome throws a ERR_RESPONSE_HEADERS_MULTIPLE_CONTENT_DISPOSITION
    error if a Content-Disposition header includes an unquoted filename
    that contains commas.
    
    This patch adds quotes around the filename in the Content-Disposition
    header, which fixes the problem.
    
    Test plan:
    0. Do not apply the patch yet
    1. Obtain a PDF and rename it to include a comma in its name
    2. Enable the upload.pl plugin in the 856$u of the Default framework
    3. Add/edit a record in the Default Framework and upload a file
    using the 856$u upload plugin.
    4. Click on the resulting file URL in the saved file
    5. Note the error ERR_RESPONSE_HEADERS_MULTIPLE_CONTENT_DISPOSITION
    is returned instead of the file
    
    6. Apply the patch and restart your Plack instance
    
    7. Click on the resulting file URL in the saved file
    8. Note that you now get the PDF file instead of the error
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54c5ee570648ef9b35f0333ab88e1353a74d9ffa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 11:58:34 2021 +0200

    Bug 28103: Fix barcode plugin on the order receive view
    
    Fix the following error:
    Uncaught TypeError: Cannot read property 'field_value' of null
    
    Test plan:
    Set "AcqCreateItem" to "receiving an order"
    Set "autoBarcode" to "generated in the form <branchcode>yymm0001"
    
    Create an order and go to receive it at a path like
    /cgi-bin/koha/acqui/orderreceive.pl?ordernumber=2&invoiceid=1
    
    Click on the barcode input and confirm that it's prefilled
    automatically
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71574961f7322e04e996b11f9932b2006ea93215
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 13 10:47:19 2021 +0200

    Bug 28125: Display a warning on the about page for OPACHiddenItems is needed
    
    If OPACHiddenItems is containing badly construct it will lead to
    inconsistent behaviours. For instance the holds view will not display
    any items, when the detail page will display all of them (because we are
    not using the same code, we are in transition to merge it).
    
    This patch suggests to add a warning to the about page in case the query
    generated by Koha::Items->filter_by_visible_in_opac produces a warning
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 28125: (QA follow-up) Fix missing filter
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70239b355c6776065e20ed371f93483b110b7cda
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Apr 13 11:34:55 2021 +0300

    Bug 28139: Simplify logic for handling found holds in returns.pl
    
    We are handling in this if-else block 3 cases:
     - Hold found and waiting
     - Hold found but not waiting AND whether HoldsAutoFill is enabled
     - Hold found but not waiting AND whether HoldsAutoFill disabled
    
    If we simply first handle hold found = Waiting case first then we
    don't have to individually list all those other found cases and that
    simplifies this code a lot.
    
    To test:
     1. Apply patch
     2. Make sure HoldsAutoFill is disabled
     3. Make item-level hold on branch A
     4. Check-in the item at branch A and you should get pop-up confirming
        the hold, ignore it
     5. Set HoldsAutoFill is enabled
     4. Check-in the item again and you now the hold should have been
        automatically filled
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49da7cd462488e58572730da2ccd8dbf8aed839c
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Apr 13 11:22:16 2021 +0300

    Bug 28139: Handle Processing status with HoldsAutoFill pref turned on
    
    To test:
     1: Turn on HoldsAutoFill setting
     2: Place a item-level hold on item X at Branch A
     3: Make the hold to Processing state:
     $ koha-mysql kohadev
     > select * from reserves; # look up the reserve_id
     > UPDATE reserves SET found = 'P', priority = 0 WHERE reserve_id = XXX;
     4: Check in the item X at Branch A - A pop-up asking confirmation comes
     5: Apply patch & restart plack
     6: Check in the item X again at Branch A - now the hold is confirmed automatically
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddad57a468706c16c2cf0165cda84f6cdb7adb9f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 14 13:48:08 2021 +0000

    Bug 28147: Pass itemnumber through to Account->pay
    
    Currently the itemnumber is not passed through when paying a single fine,
    we should do that
    
    To test:
    1 - Create a manual debit and provide a barcode so the debit is linked to an item
    2 - Go to the 'Make a payment' tab. Click the 'Writeoff' button on the individual line
    3 - View the 'Transactions tab' The writeoff has no item details
    4 - Apply patch
    5 - Repeat 1 & 2
    6 - View the transactions tab. The writeoff shows item details
    7 - Confirm 'Writeoff amount' and 'Writeoff selected' still work and do not link to item
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53e1002e1110896ca96624a7bcf616afa18879b7
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Thu Apr 1 11:36:43 2021 -0700

    Bug 27739: Advanced editor should use DefaultCountryField008 preference
    
    Uses the system preference DefaultCountryField008, falling back to ||| (no
    attempt to code) if it is not set, for 008/15-17 place of publication in
    the advanced cataloging editor..
    
    Test plan:
    1) Apply patch and restart all the things, something's over-cached here
    2) Administration - Toggle the preference  EnableAdvancedCatalogingEditor
       to "Enable", verify the preference DefaultCountryField008 is empty
    3) Cataloging - Advanced editor
    4) In field 008, verify that the three characters after the two sets of
       four blank spaces are |||
    5) Administration - Set DefaultCountryField008 to fr
    6) Cataloging - Advanced editor
    7) In field 008, verify that the three characters after the two sets of
       four blank spaces are "fr " (including the space, so following
       characters haven't shifted left, and the last character is still d)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7529e1fd9cb5c1022bdfc846756c536284bda3c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 12 16:01:03 2021 -0300

    Bug 28118: Default to current branch when placing hold
    
    During bug 27071 development, this line got inadvertedly changed. This
    patch restores the original behaviour.
    
    To test:
    1. Search for a title
    2. Go try place a hold
    => FAIL: Look at the HTML, there's no pickup location with
    selected="selected"
    3. Switch branch and repeat 2
    => FAIL: Still the same
    4. Apply this patch
    5. Repeat 2 and 3
    => SUCCESS: Branch is selected, chosen current branch is picked
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e8c014f7a9d779f24ae2e4b8245ffd353dd541c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 15 15:43:23 2021 +0000

    Bug 28001: (QA follow-up) Clarify messages and indicate test mode
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1dfa520da5a6fba2e1b1cd3d24539a2d2fd524ea
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 11:00:37 2021 +0200

    Bug 28001: (bug 27050 follow-up) Fix delete_patrons if no category passed
    
    GetBorrowersToExpunge must not crash if called with an empty patron
    category list
    
    Test plan:
    Call delete_patrons.pl with and without patron categories. The script
    must work as expected
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21ea89d774d50b1667b18e252f56abe295a97d34
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 11:22:11 2021 +0200

    Bug 28015: Fix inventory for timeformat=12h
    
    Inventory explodes with the following stacktrace if timeformat is set to 12h
    
    Invalid value passed, datelastseen=2021-04-09 12:00 AM expected type is date at /usr/share/perl5/Exception/Class/Base.pm line 88
            Exception::Class::Base::throw('Koha::Exceptions::Object::BadValue', 'type', 'date', 'value', '2021-04-09 12:00 AM', 'property', 'datelastseen') called at /kohadevbox/koha/Koha/Object.pm line 196
            Koha::Object::catch {...} ('DBIx::Class::Exception=HASH(0x557a052baeb0)') called at /usr/share/perl5/Try/Tiny.pm line 124
            Try::Tiny::try('CODE(0x557a051931d8)', 'Try::Tiny::Catch=REF(0x557a052bfc30)') called at /kohadevbox/koha/Koha/Object.pm line 206
            Koha::Object::store('Koha::Item=HASH(0x557a0521a048)') called at /kohadevbox/koha/Koha/Item.pm line 202
            Koha::Item::store('Koha::Item=HASH(0x557a0521a048)') called at /kohadevbox/koha/tools/inventory.pl line 220
    
    Test plan:
    Set TimeFormat to 12h
    Use the inventory
    => Confirm that it's working with this patch applied
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3683d873ad4cbc6a94cea2d4040675e2ddecd85
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 15 18:58:33 2021 +0000

    Bug 27796: (QA follow-up) Missing filters
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1dd6e0bd30cf3e9570adcea112ba65cb6f69b608
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 11 15:03:18 2021 +0000

    Bug 27796: (QA follow-up) Fix for missing 'Account credit'
    
    Good catch Sally!  The data-member attribute was using an incorrect
    parameter name to fetch the accountline borrowernumber data.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89cea3d7a791be8f160e492d664b0bfd2bd8d496
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 25 17:28:33 2021 +0000

    Bug 27796: Centralise payment/transaction type handling
    
    This patch centralises the payment/transaction type select options
    handling so the SIP types are properly in all cases.
    
    Test plan
    1) Check that SIP payment types are properly hidden on the following
       modals.
    1a) Refund modal on the borrower account page (The 'Account credit'
    option should appear here)
    1b) Payout modal on borrower account page
    1c) Payment via paycollect
    1d) Payment via point of sale
    1e) Refund via point of sale, register details page (The 'Account
    credit' option should only appear for debts associated to a patron and
    not for payments accepted via point of sale)
    2) Signoff
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac233efccf089c9981e81bba30554339007729f4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 24 17:13:57 2021 +0000

    Bug 27927: Prevent renewal on lost forgive
    
    The `RenewAccruingItemWhenPaid` preference should only renew upon
    payment (and writeoff) and not upon automatic forgival triggered by
    `WhenLostForgiveFine`.
    
    Test plan
    1/ Enable `WhenLostForgiveFine` and `RenewAccruingItemWhenPaid`
    2/ Checkout an item and backdate it's due date
    3/ Run longeroverdue.pl to mark the item as lost and create the fine
    4/ Confirm that the item is not renewed as part of the process
    5/ Signoff
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6eea10dc538d76af1f1545010439d4fcb3d288ab
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Apr 6 11:19:04 2021 +0100

    Bug 27927: Add Unit Tests
    
    Add a unit test to check that 'FORGIVEN' credits do not prompt an
    auto-renewal with `RenewAccruingItemWhenPaid` enabled.
    
    Test plan
    1/ Apply the test patch
    2/ Run t/db_dependent/Koha/Account/Line.t and confirm it fails
    3/ Apply subsequent patch
    4/ Re-run the test and confirm it passes
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59f1dc09acfcf602bb2700eb4ee64ecc10f4d09b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 16 12:07:49 2021 +0200

    Bug 25508: Add info about caller responsabilities
    
    We are removing the test on the existence of item and patron, callers
    must call renewable before.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97c168704b576bf59e4778417f066c1097d3014d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 15 15:28:58 2021 +0000

    Bug 25508: (QA follow-up) Add interface
    
    These patches are making the call for an amount match the call for a specific line,
    we should also match the passing of interface to ensure the correct pref is checked
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4dc15ee36dc108e074e4d1b78edc055b1a22597
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 24 16:38:32 2021 +0000

    Bug 25508: Only return renewal outcomes to the controller
    
    There are a few cases where the `renew_item` method in
    Koha::Account::Line will return `undef`. For these cases, we should not
    pass the error up the chain to the controllers as it leads to malformed
    error messages in the UI.
    
    Test plan
    1 - Make sure FinesMode is on, RenewAccruingItemWhenPaid is off
    2 - Checkout an item to a patron and make it overdue (can backdate the
        checkout)
    3 - Make sure the itemtype has fines that will be charged
    4 - Charge the fines:
        Set finesMode = production
        perl misc/cronjobs/fines.pl -v
    5 - Check the fine appears on the patrons account
    6 - Pay off the fine
    7 - Receive alert after payment that reads: "The fines on
        the following items were paid off, renewal results are
        displayed below:
            No title ( ): Not renewed - Unknown error"
    8 - Apply the patch
    9 - Repeat steps 1 through 6 and note that you no longer trigger the
        error message.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66ad8f77278e7ceb18bc5e027a470fd621e5f9b2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Apr 6 08:48:38 2021 +0100

    Bug 25508: Add Unit Tests
    
    Enhance the unit tests to check for the return values of
    Koha::Account->pay.
    
    Test plan
    1/ Apply just this patch
    2/ Run t/db_dependent/Koha/Account.t and watch it fail
    3/ Apply the rest of the patch series
    4/ Run t/db_dependent/Koha/Account.t and watch it pass
    5/ Signoff
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc8787bf879630f1c5572008c3637598f56d7aff
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 1 13:49:19 2021 +0000

    Bug 26312: (follow-up) Fix passing of exception messages
    
    'error' has special meaning in exceptions so naming the fields:
    type, details
    
    Rather than only dealing with a single exception type, we generically
    get the ES exception info and pass it up.
    
    I could not recreate timeout still, however, I simply restarted the
    ES docker during commit stage to cause NoNodes exceptions
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72e6999db7cbfc077f200930dd28400d1f86831e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 27 16:04:57 2020 +0000

    Bug 26312: Catch ES Client errors, log, and continue indexing when error encountered
    
    This catches a timeout response from the ES server, logs this, and continues the indexing
    
    To test:
    1 - perl misc/search_tools/rebuild_elasticsearch.pl
    2 - Make the ES server timeout (I don't have good instruction yet)
    3 - Watch the job crash
    4 - Apply patches
    5 - perl misc/search_tools/rebuild_elasticsearch.pl
    6 - Make the server timeout
    7 - Note the job reports failed commit, and continues
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Bug 26312: (follow-up) Reset buffers even if commit fails
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Bug 26312: (follow-up) Fix whitespace and missing semicolon
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d7f55a8748c5e148d805195e314f189c886a492
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 12 14:18:20 2021 +0000

    Bug 28136: Handle Transferred status for ResFound
    
    bug 25690 added a new 'Transferred' status to 'ResFound', this status
    needs to be handled in circ/returns.pl
    
    To test:
    1 - Place a hold on an item at Branch B for pickup at Branch A
    2 - Check in the item at Branch B - confirm hold and transfer
    3 - Check in the item at Branch A - nothing happens?
    4 - Apply patch
    5 - Checkin in the item at Branch A - hold popup appears
    6 - Clear the hold and place it again
    7 - Set system preference 'HoldsAutoFill' to do
    8 - Check in the item at Branch B - hold is found and confirmed
    9 - Check in the item at Branch A - hold is found and confirmed
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49a795ceb3273627c9f3ec8edd95f709ef7ebce9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 14 14:07:07 2021 +0000

    Bug 21260: DBRev 20.12.00.031
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7956605401be015d34367ce474a1b3b574c31ca
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Apr 14 11:25:57 2021 +0000

    Bug 21260: (follow-up) Consolidate preference
    
    The bug added a local preference. This should now become a real one.
    Renamed in the process to better reflect its use.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 871a2fc6ffe4f8f6fb21bb15ce6d27a241c60595
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 14 13:28:28 2021 +0000

    Bug 21549: DBRev 20.12.00.030
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b010b6905225a64c2e265d92d66365ea1c4a646b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 12 16:22:55 2021 +0200

    Bug 21549: Make filter_by_last_update returns a Koha::Objects-based object
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c58590f58df6825d39c8c973e56f237722fcfa2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 12 16:12:50 2021 +0200

    Bug 21549: Rename filter_by_dateexpiry with filter_by_expiration_date
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4ad6987f76b018b21705a276ec149e0619776b9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 12 16:12:03 2021 +0200

    Bug 21549: Use filter_by_last_update from filter_by_dateexpiry
    
    To not reengineer the patch this patch does not remove the new
    subroutine but make it use the logic from
    Koha::Objects->filter_by_last_update
    
    It also adds a new parameter "days_inclusive"
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f0effd9a0bb80b2d504d8f2f886461730f3b7d7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 19 12:03:15 2021 +0000

    Bug 21549: (QA follow-up) Get pref at start of run and rename variable
    
    This patch ensures the script will lock patrons if the pref is set but no other actions
    specified
    
    It also changes the variable name to be a bit more explicit
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b43cedcd86754a6f590a756b7398c61f77844db0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 19 08:15:10 2021 +0000

    Bug 21549: (follow-up) Adjust preference description
    
    See QA remarks.
    
    Test plan:
    Check the preference in staff client.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cad75c394018055270f9204066d74c014894cb8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 19 08:11:27 2021 +0000

    Bug 21549: (follow-up) Switch to filter_by
    
    See QA remarks.
    
    Test plan:
    Run t/db_dependent/Koha/Patrons.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46ae8a2cdb899d21e02a867bc86d02a37caf3b72
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 10 13:37:42 2020 +0000

    Bug 21549: Database revision for new preference
    
    Introducing LockExpiredDelay.
    
    Test plan:
    Run upgrade. Check syspref.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e85ac9612fd942bf613d52f2e3f06fc0da28162
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 11 15:34:48 2018 +0200

    Bug 21549: Lock expired patron accounts
    
    Adding a search on locked patrons to the search_expired in cron script.
    This prevents relocking.
    
    Test plan:
    Prove Koha/Patrons.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24f510d479a2d6bbcd1a0d73b51e388e15824b6c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 22 14:16:49 2021 +0000

    Bug 28014: Add table settings to batch patron modification
    
    This patch adds table settings to the tables shown before and after
    a batch of patrons has been submitted for batch patron modification.
    
    To test you must have ExtendedPatronAttributes enabled and at least one
    configured.
    
    - Go to Tools -> Batch patron modification
    - Submit a set of patrons for modification
    - In the table showing patron records which will be modified, confirm
      that all DataTables controls work correctly.
      - Confirm that the column visibility settings work correctly,
        including the controls for extended patron attribute columns.
    - Submit a change to your patron batch.
    - On the page showing the results, confirm that the DataTables controls
      continue to work as expected.
    - Go to Administraion -> Table settings and confirm that making changes
      to the default configuration for this table (Tools ->
      batch_patron_modification -> borrowerst) results in the correct
      default columns being shown on the batch patron modification pages.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0aadb774a981b3599e3445d0bd0e61ad544808c
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Apr 8 14:51:36 2021 +0000

    Bug 28114: Fix error in MARC21slim2OPACResults - correctly select singleBranchMode
    
    To test:
    -Look at search results and see something like: Availability: Items available for loan: 1 , 1 , 2 .
    -Apply patch
    -See something like: Availability: Items available for loan: Midway (1), Centerville (1), Fairview (2)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ad325b82718462a223164957dba356968d2aa9c
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Apr 7 16:41:04 2021 +0200

    Bug 28110: Require YAML::XS 0.67
    
    $YAML::XS::Boolean, which is used in Koha::SearchEngine::Elasticsearch,
    was introduced in 0.67
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a75139bfccc7e856efcc3a6996f78d09bdd0a08
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 14 15:28:09 2021 +0200

    Bug 27773: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c42c24fa03709496d0c21b98fe7db228f02d3983
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 9 18:07:48 2021 +0000

    Bug 27695: (follow-up) Add specificity to CSS changes
    
    This patch moves the definition of .alert and .error classes into the
    block for .dialog in order to make sure they don't have an effect beyond
    the desired scope.
    
    The ".closebtn" section is redundant and has been removed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9d2aa498b38343f51a51822c68995bd72110d50
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 12 17:08:25 2021 +0000

    Bug 27695: Fix style of messages on Elasticsearch configuration page
    
    This patch makes minor modifications to SCSS and HTML to make messages
    on the Elasticsearch configuration page more consistent with other
    interfaces.
    
    To test you should have Elasticsearch selected as your search engine.
    
    - Apply the patch and rebuild the staff interface CSS
      (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    - Go to Administration -> Search engine configuration (Elasticsearch)
    - You should see a full-width "note" style message under the page
      heading, "Warning: Any changes..."
    - Click the "Reset mappings" button at the bottom of the page. The
      confirmation alert you see should appear above the note-style message.
    - I'm not sure how to trigger an "error" type message on this page, but
      you can test the updated style by going to Administration ->
      Currencies and submit a new currency with the same name and symbol as
      one which already exists.
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d3bf55cdcc6619959edac8db3715e5238210e65
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 24 01:09:33 2021 +0000

    Bug 27773: Hide unique holidays and exceptions which have passed
    
    This patch modifies the display of unique holidays and holiday
    exceptions so that dates in the past are hidden by default. A
    corresponding "Show past entries" checkbox can be checked to show the
    hidden entries.
    
    To test you should have some unique holidays and holiday exceptions in
    your system from the past and in the future.
    
     - Apply the patch and go to Tools -> Calendar
     - In the tables of existing holidays, check that no dates in the past
       appear in the "Exceptions" or "Unique holidays" tables.
     - Checking the checkbox at the top of each of these tables should
       trigger the display of the hidden rows.
    
    Signed-off-by: Pascale Nalon <pascale.nalon@ensmp.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a34e1f9f0d32e4cf0f282016e52166d309b25ef7
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Feb 22 13:46:44 2021 +0200

    Bug 27746: prevent regexp undefined warning when checking subfield contents ($oclc)
    
    Some of the books have subfield "a" of field "035" absent
    and it's possible to have such
    (it doesn't says "Require" in the interface),
    which causes "Use of uninitialized value $oclc in pattern match (m//)"
    error.
    
    Solved by screening regex with check for empty variables before the
    match.
    
    To reproduce:
        1) Edit existing book or create a new one with empty marc
    subfield "a" of field "035"
        2) Use the search feature that will find it along with some other
    books.
        3) Check /var/log/koha/kohadev/plack-intranet-error.log to find
    "Use of uninitialized value $oclc in pattern match (m//)" error.
        4) Apply the patch.
        5) Repeat the search and check the logs again to ensure
    that error didn't appear again.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c30c8c7a5367cb68bd1a2db16972f8668a630282
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 14 10:31:35 2021 +0000

    Bug 28132: (follow-up) Update basket group page
    
    This patch makes the same change to the basket group page:
    
    Reopen this basket -> Reopen basket
    Export this basket -> Export basket
    Print this basket -> Print basket
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bc0dd56a4550447f9f7d6ecd6fe22219d2571db
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 12 11:44:58 2021 +0000

    Bug 28132: Remove "this" from button descriptions on basket summary page
    
    This patch modifies button text on the Acquisitions basket page to
    remove the word "this."
    
    To test, apply the patch, go to Acquisitions, and locate a vendor with
    baskets.
    
     - View an open basket.
     - You should see in the button toolbar, "Delete basket," and "Close
       basket."
     - View a closed basket.
     - You should see a "Reopen basket" button.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac87c68b56180aaf9b6853678672d66d1fb8f6b1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 2 19:54:30 2021 +0000

    Bug 28081: Make card number a label in patron search results
    
    This patch modifies the output of the AJAX patron search results so that
    the number in the card number column is wrapped in a <label> tag which
    triggers the corresponding checkbox.
    
    To test, apply the patch and go to the Patrons module.
    
     - Perform a patron search which will return more than one result or
       click on a letter to browse.
     - In the search results, confirm that clicking any card number triggers
       the corresponding checkbox.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f33c0a7d58704dba0e4c30b0b8904131adea111
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 7 16:27:31 2021 +0000

    Bug 28112: Z39.50 does not populate form with all passed criteria
    
    This patch adds output of some already-existing template variables in
    the Z39.50 search form so that all parameters can be used to prepopulate
    the form.
    
    To test, apply the patch and go to Cataloging.
    
    - Click the "New from Z39.50/SRU" button
      - A window should pop up and the form should be empty.
      - Confirm that searching works correctly.
    - Perform the same test from a bibliographic detail page using the Edit
      menu -> Replace record via Z39.50/SRU.
      - Some fields in the search form should be prepopulated, e.g. ISBN,
        title, author.
    - Paste this link into your browser:
      http://path.to.your.koha/cgi-bin/koha/cataloguing/z3950_search.pl?frameworkcode=&isbn=isbn&issn=issn&title=title&author=author&dewey=dewey&subject=subject&lccall=lccall&controlnumber=controlnumber&stdid=stdid&srchany=srchany&publicationyear=publicationyear
      - The search form should appear with all fields prepopulated.
    
    - Perform the same tests in Acquisitions with the option for adding to a
      basket via an external search.
      - The link for testing all parameters:
        http://path.to.your.koha/cgi-bin/koha/acqui/z3950_search.pl?booksellerid=4&basketno=3&isbn=isbn&issn=issn&title=title&author=author&dewey=dewey&subject=subject&lccall=lccall&controlnumber=controlnumber&stdid=stdid&srchany=srchany&publicationyear=publicationyear
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66aa12e874919e911d2e81a9d1e102ae66d6e517
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 14 15:22:29 2021 +0200

    Revert "Bug 26734: Ratify account slip printing"
    
    This reverts commit 58ec862da2243d9210a419c210e7b469ac2f6872.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4625df32284b2432397fe447d2c26707bb5e1632
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 12 17:29:09 2021 +0000

    Bug 28055: (follow-up) Revert changes to aoColumnDefs option name
    
    This patch undoes changes to two lines in columns_settings.inc which
    were triggering unwanted side-effects. There are several templates and
    JavaScript files which use "aoColumnDefs" to pass options to columns
    settings, and if we change this file without changing those at the same
    time things will break.
    
    When these lines are updated it must be done so at the same time as we
    modify the templates which pass that same option.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa71e7132c3a5d956ef35e3e4d47502852f65808
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 13 10:45:58 2021 +0200

    Bug 14233: Set default for NoticesLog to 0
    
    To prevent a warning on the about page:
     System preference 'NoticesLog' must be '0' or '1', but is ''.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a3a9a17c643b056594407af0ffba2998113a1a2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Apr 12 13:22:50 2021 +0000

    Bug 27069: (follow-up) Only display rules if one is set
    
    Testing that the rule is != 'hold_allowed' is true for each itemtype where
    the rule is not set. This means it appears that no holds are allowed
    for any item type if no rules are set
    
    To test:
    1 - With a fresh testing DB or no holdallowed rule set, you can use SQl below to clear:
        DELETE from circuation_rules WHERE rule_name='holdallowed';
    2 - Load smart-rules.pl (Administration->Circulation and fines rules)
    3 - Scroll to "Default holds policy by item type"
    4 - Note all item types appear as 'No holds allowed'
    5 - Apply patch
    6 - Reload
    7 - All clear
    8 - Confirm adding rules displays correctly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65542edbe021d58ca6ef1332a8e3ca760b198391
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 2 16:33:29 2021 -0300

    Bug 27839: (follow-up) Update docs for koha-worker
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90291914f9c45cf3c79472b95307ea27ae986412
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 2 15:20:41 2021 -0300

    Bug 27839: Add tab-completion in bash for koha-worker
    
    This patch simply adds tab-completion for this script.
    
    To test:
    1. Apply this patch
    2. Run:
       $ cp debian/koha-common.bash-completion  /etc/bash_completion.d/koha-common
    3. Open a new bash instance
    4. Type 'koha-worker <tab>'
    => SUCCESS: All options are there
    5. Play with Koha instances
    => SUCCESS: they show up, once chosen they are not offered anymore
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14d843f5f4822e590593536711e0991c35ea37db
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 9 12:41:04 2021 -0400

    Bug 24695: (QA follow-up) Fix POD
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48ac552699996ec5cb8632f2098174ac2dbeb61f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 27 10:31:13 2020 +0100

    Bug 24695: Move to Koha::Report->is_sql_valid
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba5be802e045de49654a5f3f4e9d0e62b1489ae4
Author: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
Date:   Thu Feb 20 11:31:08 2020 +0200

    Bug 24695: Improve SQL report validation
    
    The saved SQL report code validates the SQL in multiple places:
    when saving, when updating, and when executing the query.
    Move the validation code into Koha::Reports, and write tests for it.
    
    Test plan:
    1) Apply patch
    2) Create a new valid SQL report, save it (success)
    3) Create a new illegal SQL report, try to save (fails)
    4) Update already saved SQL report by adding one of
       the forbidden words, eg. delete or drop (saving will fail)
    5) Edit a save_sql in the database, changing it to eg.
       "drop borrowers", and try to execute it (fails)
    6) Prove t/db_dependent/Koha/Reports.t
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Work as described, no qa errors.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 24695: (QA follow-up) Fix number of tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 925eecd6bd07dbe3026c6f1172da6848aaf09e2c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 9 11:45:03 2021 -0400

    Bug 27049: (QA follow-up) Add short params, replace warn with say
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac7f878959d97e367bfa67544d3c277a69114a1d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 18 13:21:05 2020 +0000

    Bug 27049: Add /misc/cronjobs/writeoff_debts.pl
    
    This patch adds a new misc/cronjobs/writeoff_debts.pl script to allow the bulk
    waiver of debts from the system. The script accepts some filter parameters,
    including the option to pass a line delimited file of accountline_ids, and will
    apply a WRITEOFF account against them for the amount of the outstanding debt.
    
    Examples:
    ./writeoff_debts.pl --added_before $(date -d '-18 month' --iso-8601) --confirm
    ./writeoff_debts.pl --type COPY --verbose --confirm
    ./writeoff_debts.pl --file path/to/file --verbose
    
    Test plan
    1/ Add some debts to the system for various users.
    2/ Output a line delimited report for accountlines for those debts.
    3/ Run the script with the --file parameter and confirm those debts were
    written off.
    4/ Repeat steps 1-3 above but add in a step to partially pay some debts
    prior to running the script.
    5/ Repeat steps 1-3 above but pay of some of the debts prior to running
    the script.
    6/ Repeat steps 1-2 above, but instead of passing --file use a
    combination of the other parameters to limit your list of debts to
    writeoff.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58ec862da2243d9210a419c210e7b469ac2f6872
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 16 09:42:20 2020 +0100

    Bug 26734: Ratify account slip printing
    
    This patch simplifies the members/print*.pl controller scripts to only
    pass around the minimum required data for the templates.
    
    Test plan
    Slips should continue to print as they did prior to the patch
    1/ Add a manual invoice and manual debit to a patrons account
    2/ Print a slip for the manual invoice, compare to a printed slip prior
    to the patch.
    3/ Print a slip for the manual debit, compare to a printed slip prior to
    the patch.
    4/ Signoff.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c6e7ec55dca08bbd2b65ea465f304eca7c60903
Author: Séverine Queune <severine.queune@bulac.fr>
Date:   Fri Apr 9 15:25:16 2021 +0200

    Bug 28121: Correct the place of the question mark
    
    Question mark is wonrgly placed when you want to delete a desk.
    Test plan :
    - Enable 'UseCirculationDesks'
    - On Administration > Desks menu, create a new desk
    - Try to delete it : note the question mark in inside the quotation
    marks
    - Apply patch and refresh page
    - Question mark should now be after the last quotation mark
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a10d45ea18e94c532614b5480fdd8ab8897a2f60
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 12 15:27:36 2021 +0200

    Bug 27726: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 611d3aa4836c2810159937c3bc32f4228a9359e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 12 13:25:56 2021 +0000

    Bug 27726: DBRev 20.12.00.029
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c854a87d221a92051411d822121398f2440ae1e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 25 14:29:06 2021 +0000

    Bug 27726: Increase 'content' field size
    
    This alternate patch increases the field size from a 255 character
    varchar to a 65535 character text field. This allows for more detailed
    problem reports to be submitted.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 031dd035ab7c7f8a4b05f5f139942e4dceb7aeb7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 12 11:08:01 2021 +0200

    Bug 27857: Fix Pseudonymization.t
    
    t/db_dependent/Koha/Pseudonymization.t .. 2/3
        #   Failed test 'Attribute 1 should be retrieved correctly'
        #   at t/db_dependent/Koha/Pseudonymization.t line 198.
        #     Structures begin differing at:
        #          $got->{borrowernumber} = Does not exist
        #     $expected->{borrowernumber} = '58'
    
        #   Failed test 'Attribute 2 should be retrieved correctly'
        #   at t/db_dependent/Koha/Pseudonymization.t line 204.
        #     Structures begin differing at:
        #          $got->{borrowernumber} = Does not exist
        #     $expected->{borrowernumber} = '58'
        # Looks like you failed 2 tests of 3.
    t/db_dependent/Koha/Pseudonymization.t .. 3/3
    
    Highlighted by
      commit 7b40ee22035210e3fbdfe75785d68ca314285409
      Bug 27857: Make Koha::Patron->extended_attributes validate data
    
    Koha::Patron->add_extended_attributes should not modify the $attribute
    hashref parameter we passed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f25235b9ea4838cf1a875b10f873dc68c00ba0b
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu May 14 04:00:32 2020 +0000

    Bug 25476: Add ability to browse file uploads by category
    
    This patch adds the ability to search/browse files by category.
    (Note it doesn't include temporary uploads since they don't have
     a "category" per se.)
    
    Test Plan:
    0) Apply patch
    1) Go to /cgi-bin/koha/admin/authorised_values.pl
    2) Create "UPLOAD" authorized value category
    3) Create "test" authorized value in "UPLOAD" category
    4) Go to /cgi-bin/koha/tools/upload.pl
    5) Note "Search uploads by category" fieldset
    6) Upload new file to "test" category
    7) Click "Back"
    8) Choose "test" category in "Search uploads by category"
    9) Click "Search"
    10) Note that your file upload is displayed in result list
    
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aad8699b015024a2cb1fb63b149ea803a542013b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 14:04:23 2021 +0000

    Bug 14233: DBRev 20.12.00.028
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e5f65863da221d2bfc4ea302a34920a2ed9d1b7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 7 15:05:15 2021 +0200

    Bug 14233: Select the correct tab
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 058884ed4f41e97d7bf0957156cf2a0b99bb33bf
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 7 15:02:17 2021 +0200

    Bug 14233: Add logging support to notices and slips management
    
    This enhancements adds support for logging changes to notices and slips.
    Features include:
    - a system preference (NoticesLog) which allows you to enable logging changes for notices and slips
    - logging new notices, changes to notices, and deletion of notices
    - filtering in the log viewer so you can show all changes for a specific notice
    - a comparison feature, so you can see what changes were made to a notice.
    
    Test plan:
    1/ Add some 'Notice' action logs by adding a new notice or updateing an
    existing notice
    2/ Go to the 'Log viewer' under 'Tools'
    3/ Note you can filter by 'Notices'
    4/ Confirm the changes you made appear in the logs and that the 'Object'
    field links back to the updated notice ready for editing.
    
    1/ Make some changes to at least two different notices to trigger logs
    2/ Go to the 'Log viewer' from 'Tools' and filter on 'Notices'
    3/ Note, you can now see the 'Compare' checkbox option for these logs
    4/ Select the checkbox on one of the notices and note that the results
    are now filtered by that specific notice.
    5/ Select a second checkbox to expose the option to 'View comparison'
    6/ Click 'View comparison' to see the 'Diff view' of the two notices.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00ec2839ce57a493e6686ad6494d605370aa3982
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 7 15:02:09 2021 +0200

    Bug 14233: DB changes - NoticesLog pref + letter.id PK
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5267bae7eaef86a87696df6440476e9256ef435
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 7 14:56:12 2021 +0200

    Bug 14233: DBIC schema changes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c32d46b854a73e636b1568eab758868ea9d74a13
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 6 16:26:23 2021 +0200

    Bug 28094: Deal with encoding for overriden sysprefs
    
    The string we retrieved is UTF-8 encoded, to prevent encoding issue we
    must decode it first.
    
    Test plan:
    Easily testable with LibraryName:
    1. edit /etc/apache2/sites-available/kohadev.conf
    2. Add
      RequestHeader add X-Koha-SetEnv "OVERRIDE_SYSPREF_LibraryName Library of ❤️"
    3. restart_all
    4. Hit the mainpage and look at the source (or title) and confirm that
    the string is displayed correcty
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d57c65c2bda1e21848043b8f961f366a94b9e142
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 15:37:36 2021 +0200

    Bug 28031: Add missing txn_begin in Attribute.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 359c1661408dfa39910e6744233ee748332ec1a8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 15:26:45 2021 +0200

    Bug 28031: Remove type from parameter of *_ok methods
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a431cb8ddfafa53ebe5fb0dc04c922c7f18bf0b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 9 15:24:32 2021 +0200

    Bug 28031: Fix patron.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b9b1b0e2a1810af2905ca77d7a70fc07a72aa26
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 25 17:22:29 2021 +0000

    Bug 28031: (follow-up) Clarify check methods
    
    The check methods were positioned under the 'Internal methods' section
    of the meodule but are used externally.
    
    It also felt strange to have a noop or die method. Instead, I propose
    renaming them to `repeatable_ok` and `unique_ok` and returning a
    boolean denoting their state.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a48cad0f625dedc9fd881b65a1d40578e4ed80c9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 25 10:02:22 2021 -0300

    Bug 28031: (follow-up) Retrieve type only once
    
    The current implementation of store+check_repeatable+check_unique_id
    notably retrieves the related Koha::Patron::Attribute::Type object three
    times.
    
    This can be easily solved by retrieving it once and reusing. This patch
    does that.
    
    This changes the signature for the helper methods.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron/Attribute.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Verify the old _check_repeatable method is not used anywhere
       $ git grep _check_repeatable
    => SUCCESS: It is not!
    5. Verify check_unique_id is not used anywhere, so no risk changing the
       signature
       $ git grep check_unique_id
    => SUCCESS: It is safe to update it!
    6. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9489054527badf8713d198cf08521a5b0804902d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 25 09:53:13 2021 -0300

    Bug 28031: Avoid wrong exception on saving updated attribute
    
    In the case a non-repeatable attribute for a patron is being updated
    (its value) the routines that check the type is repeatable should
    exclude its own id from the search for things to work.
    
    This patch solves that.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron/Attribute.t
    => FAIL: Tests explode! An unexpected exception is thrown!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f382fafae0ff29097296c83e0670f94110874331
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 25 09:48:35 2021 -0300

    Bug 28031: Regression tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e453ff963af6b8f868b7262d32de274c89c582ab
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 30 11:03:09 2021 -0300

    Bug 27857: (follow-up) Use a more fine-grained exception for mandatory attributes
    
    On using this dev for the API, I found that the original FKConstraint
    exception was too generic, and could be confused with those risen by
    Koha::Patron->store. So this patch changes the exception that is thrown
    in Koha::Patron->extended_attributes
    
    The change is reflected on the test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => SUCCESS: Tests pass, and they include the new exception
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d59e57508201778ff4481dcc75be19a0e9a3cd0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 19 07:56:39 2021 -0300

    Bug 27857: Get the right column
    
    This patch makes the search for mandatory attribute types actually use
    'code' instead of 'class' for comparisson.
    
    Tests are added to cover this behavior.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    https://bugs.koha-community.org/show_bug.cgi?id=27587
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 881b610db65d077b46194c1f3056f5e1826170e0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 8 17:24:28 2021 +0000

    Bug 27857: Add handling for globally mandatory attributes
    
    This patch adds handling for globally mandatory extended attributes and
    the corresponding unit tests.
    
    To test:
    1. Apply the patch
    2. Run:
       $ kshell
       k$ prove t/db_dependent/Koha/Patron.t
       => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b40ee22035210e3fbdfe75785d68ca314285409
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 09:37:42 2021 -0300

    Bug 27857: Make Koha::Patron->extended_attributes validate data
    
    This patch makes the extended_attributes method use
    Koha::Patron->add_extended_attribute inside the loop, instead of direct
    DB access. This way, it takes advantage of the validation that is done
    there.
    
    All happens inside a transaction, so if 'add_extended_attribute' throws
    an exception, everything is rolled back.
    
    To test:
    1. Apply the previous patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => FAIL: The behavior is not the correct one, tests fail
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e7903dfd6714b22c670acdadc4a030f3e6c2ceb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 09:34:12 2021 -0300

    Bug 27857: Regression tests
    
    This patch adds regression tests for the changed behavior.
    Koha::Patron->extended_attributes will now throw exceptions and rollback
    on invalid attributes.
    
    The existing tests are amended so they don't try to deal with skipping
    bad attributes.
    
    Specific subtests are added for error situations.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => FAIL: Tests fail because the new behavior is not implemented.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1746f286704dbfa97b8bee8dcf94353c08c70b04
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 07:12:30 2021 -0300

    Bug 27857: Move extended_attributes tests to Koha/Patron.t
    
    They really belong here. both Patron.t and Patrons.t got lengthy and it
    is not intuitive to look for tests for a Koha::Patron method in the
    Patrons.t file.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t \
               t/db_dependent/Koha/Patrons.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass, no new stuff
    4. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2b3099a9f95b8303928acac4434e7642d49b76d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 30 10:52:01 2021 -0300

    Bug 28056: Add Koha::Exceptions::Patron::MissingMandatoryExtendedAttribute
    
    This trivial patch adds a new exception for more fine-grained control on
    the errors when dealing with patrons and their extended attributes.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/Koha/Exceptions.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ee844ff56368ddb8adb2b4f0e98c765e6e0ccff
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 30 10:51:34 2021 -0300

    Bug 28056: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f3ad7112f573c8da5e1670cb3ffc2fcc5953613
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 18 12:07:00 2021 -0300

    Bug 27858: (follow-up) Consistency in stringified exception
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d816bad357b0ef29512754ee9de63dcb1408a9d5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 08:24:54 2021 -0300

    Bug 27858: Make Koha::Patron::Attribute->store raise an exception on invalid type/code
    
    This patch adds type validation to the ->store method. And exception
    should be thrown if the type is invalid. Things currently explode in
    such situations, so this doesn't change the behavior (just adding more
    informative failure information).
    
    To test:
    1. Apply the previous patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron/Attribute.t
    => FAIL: No exception is thrown on the bad case, weird error
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! Exception thrown!
    5. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 032c66bfc96a3f9381e2734a63d0664f62313dba
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 08:23:09 2021 -0300

    Bug 27858: Unit tests
    
    This patch introduces unit tests for the new exception to be thrown.
    It generates a new extended attribute type, keeps the randomly generated
    'code' and deletes the object. This way we can be sure the code doesn't
    exist on the DB. It then tries to generate an attribute of that type, to
    force the exception to be thrown.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2fe2d217fdb3ab23fbcd77672205753dd3cda73
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 08:10:51 2021 -0300

    Bug 27858: Reorganize tests
    
    This patch renames the tests file, and also groups subtests by method.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron/Attribute.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 577a4054070338ff5a135dca9f033a28b7abf5f3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 07:39:27 2021 -0300

    Bug 27833: (follow-up) Add InvalidType exception
    
    Working on bug 27857 showed we needed one more exception, for when the
    passed attribute type is invalid.
    
    This patch adds the Koha::Exceptions::Patron::Attribute::InvalidType
    exception. It adds a format for stringifying it, and tests are added.
    The previous exceptions tests lacked one case, so I add them on this
    patch as well.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove tt/Koha/Exceptions.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35aefaa11c72f91d4d6d64d88389f3e33a91f4fc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 2 11:10:12 2021 -0300

    Bug 27833: Make K::P::Attribute add the object to the exception
    
    This patch makes the 'check_unique_id' and '_check_repeatable' methods
    pass the 'attribute' parameter when throwing an exception. This way we
    can provid emore meaningfull error messages.
    
    To test:
    1. Apply the previous patches
    2. Run
       $ kshell
      k$ prove t/db_dependent/Koha/Patron/Attributes.t
    => FAIL: The exceptions are not passed the attribute!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e43ce6cc7f8d53c33b9263d7b4cf91e919fcc49f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 2 11:06:35 2021 -0300

    Bug 27833: Add unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1444fa7641fa5e747da6caf9c25b754e60d3267e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 2 11:04:38 2021 -0300

    Bug 27833: Make Koha::Exceptions::Patron::Attribute::* have parameters
    
    This patch adds a 'field' to this exceptions. They now have an
    'attribute' parameter referencing the object itself,
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/Koha/Exceptions.t
    => SUCCESS: Tests pass!
    3. Sign off!
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a26303138cf75c669129a527e309f2fbfc240af6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 8 15:41:55 2021 +0200

    Bug 22773: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b7937f3e5c048fa42f925c1c7942eb403fa205b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 7 13:01:03 2021 +0000

    Bug 22773: (follow-up) Fix id clash and data element
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72ce742597c32b1d2c50a5a16be6cfdd24afb991
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 29 08:46:48 2021 +0100

    Bug 22773: Assign different id to checkboxes
    
    Otherwise clicking the label does not work
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca2028d0e74950564e53f7335e0b66be111f445b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 20 12:15:49 2021 +0000

    Bug 22773: (follow-up) Ensure buttons only affect their related table
    
    Also cleans up a few rebase issues
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc4e1b513c0fc29aa109b865f16388c056654db1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Jul 1 04:25:10 2020 +0000

    Bug 22773: (QA follow-up) Fix missing filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e074c844e6c4c384346892ff85a0a73e8a36902
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Jul 1 04:20:48 2020 +0000

    Bug 22773: (QA follow-up) Improve existing merge button and fix checkbox label
    
    Fixes the checkbox label by adding an id, so that when you click on
    "Show only subscriptons" the checkbox will be checked.
    
    Adds standard classes to the existing "Merge selected invoices" button
    to make things more consistent. Also added the fa-compress icon that
    we use in cataloguing on the merge records button.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f41d896d0da1a5c46572fd8b7a5ea7469fc99b4f
Author: Mengü Yazıcıoğlu <kohadevinim@devinim.com.tr>
Date:   Fri Oct 18 13:51:55 2019 +0000

    Bug 22773: (follow-up) Recommended changes are made on datatable and butons
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Christopher Kellermeyer <ckellermeyer@altadenalibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Rebase add comma
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3f40686797c6fb4e98a1d456b797e379a495b54
Author: Mengü Yazıcıoğlu <kohadevinim@devinim.com.tr>
Date:   Thu Oct 3 15:59:37 2019 +0000

    Bug 22773: Message appearing if any invoice selected
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 366ee356969940033dc1e1c754c1c87a33599b33
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Oct 2 12:02:24 2019 +0000

    Bug 22773: (follow-up) Fix capitalization
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b86c0ed4df243f6223956ba1e136c37cd9840ef
Author: Mengü Yazıcıoğlu <kohadevinim@devinim.com.tr>
Date:   Tue Oct 1 09:38:24 2019 +0000

    Bug 22773: Bulk Close invoices and Filter invoice view (open/closed)
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 22773: The deprecated plugin is removed
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Christopher Kellermeyer <ckellermeyer@altadenalibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Remove asset for removed js
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3e81738c83f6f2bae869f056ba934fc45315c1f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 7 12:10:38 2021 +0100

    Bug 28097: Mock finesModes to disable recalculation
    
    Since bug 8338 the recalcuated zero amount fine is subsequently removed
    in _FixOverduesOnReturn which causes this test to fail if finesMode is
    'production' and 'CalculateFinesOnReturn' is enabled.
    
    Perhaps we should be 'VOID'ing fines rather than completely deleting
    them, but that's a question for another day.
    
    Test plan
    1/ Enable finesMode in the staff client
    2/ Run the test and watch it fail
    3/ Apply the patch
    4/ Run the test and watch it pass
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bfc2584e02f3233fed8c8f329205d712f3bfe0b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 8 10:15:04 2021 +0000

    Bug 27069: DBRev 20.12.00.027
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6d2a50478d7c5ae4307518a478a1c46398e0e32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 8 10:15:04 2021 +0000

    Bug 26498: DBRev 20.12.00.026
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 626d1f22a0be9ea1abfc9ee656448c9822ee3438
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 2 14:35:08 2021 +0000

    Bug 28013: (follow-up) Reset the patron loop
    
    To test:
    1 - Apply all other patches and dependencies
    2 - prove -v t/db_dependent/Circulation.t
    3 - It fails
    4 - Apply this patch
    5 - It passes
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 850ad303935ddd3008db1ad5d8a100f8a22778d7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 2 14:33:55 2021 +0000

    Bug 28013: Unit tests
    
    Cover the case of multiple patrons and multiple items that can fill them
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ded05deb102de13de95c5e0f76bfaf79075423cf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 2 14:32:33 2021 +0000

    Bug 28013: (follow-up) Correct and update call to CanItemBeReserved
    
    The current call checks for truth against a returned hash, we need
    to check the 'status' value
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25d60246558f9e22015e350125627bbd2b96fe89
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Mar 29 13:47:17 2021 +0300

    Bug 28013: (QA follow-up) Remove unused variable
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b8f4ec614f8e526f814c1d79a6729f7abcac874
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Mar 22 13:03:11 2021 +0000

    Bug 28013: Performance improvements to CanBookBeRenewed
    
    In the case of 'AllowRenewalIfOtherItemsAvailable' we check all existing reserves against
    all existing items. This patchset reduces the number of DB/subroutine calls
    
    To test:
    1 - Apply patch
    2 - prove -v t/db_dependent/Circulation.t
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a620c1bb116d82ea27934f643789a84f5c002a2b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 6 13:21:50 2021 +0000

    Bug 28078: (follow-up) Add param check to 'itemAlreadyOnHold' test
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3adcec676f97a1456dbb072479a99f7224e724c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 2 14:29:19 2021 +0000

    Bug 28078: Add 'ignore_hold_counts' param to CanItemBeReserved
    
    This patch adds an optional param 'ignore_hold_counts' to the routine, while still forbidding holds when 0 are allowed
    
    To test:
    1 - prove -v t/db_dependent/Holds.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    JK: Commit message amended: Fixed title formatting
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34acb76a21c01c849283efe066d10d5ee78cd9e5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 15 15:33:03 2021 -0300

    Bug 27069: Update existing rules
    
    This patch adds an atomic update file that takes care of translating
    existing rules. It constrains the rules to translate to those currently
    expected by Koha and leaves any other value out.
    
    To test:
    1. Have some manually added rules:
       $ koha-mysql kohadev
       > INSERT INTO circulation_rules (rule_name,rule_value) VALUES
       ('holdallowed', -1);
       > INSERT INTO circulation_rules (rule_name,rule_value) VALUES
       ('holdallowed', 1);
       > INSERT INTO circulation_rules (rule_name,rule_value) VALUES
       ('holdallowed', 2);
       > INSERT INTO circulation_rules (rule_name,rule_value) VALUES
       ('holdallowed', 3);
       > INSERT INTO circulation_rules (rule_name,rule_value) VALUES
       ('holdallowed', 0);
       > INSERT INTO circulation_rules (rule_name,rule_value) VALUES
       ('holdallowed', 4);
    2. Apply this patch
    3. Run:
       $ updatedatabase
    => SUCCESS: It doesn't explode
    4. Verify the created rules were updated correctly:
       > SELECT * FROM circulation_rules WHERE rule_name='holdallowed';
    5: Verify all the tests that dealt with this rule still pass!
       $ kshell
      k$ git diff origin/master --name-only | grep -e '\.t$' | \
             xargs prove
    => SUCCESS: Tests pass!
    6. Verify the UI handles setting things correctly
    7. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d9d05613b90779b3ce214918cf1f2dffb64d264
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 15 15:39:52 2021 -0300

    Bug 27069: Adapt uses of holdallowed
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b46d69de37be994e28ebb2d75d23905a240340d0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 15 15:39:30 2021 -0300

    Bug 27069: Adjust tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7523bb35bf906513f688ad5f428279b356c863ba
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Apr 5 22:39:43 2021 +0000

    Bug 28092: Add reserve notes column to holds to pull
    
    To test:
    -PLace a hold and add a reserve note to that hold
    -Go to Circulation > Holds to pull
    -Notice there is no reserve notes column
    -Apply patch and restart all the things
    -Reload the Holds to pull report and you should see a reserve notes column
    -Go to table settings (/cgi-bin/koha/admin/columns_settings.pl) and make sure you can properly hide the column.
    -Test other columns in the table and make sure you can properly hide them
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2a46916380f5793cf586b3ce10ecfd43d741b1e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 10:46:58 2021 -0300

    Bug 27894: Add visual feedback on overridden pickup locations
    
    This patch takes advantage of the previous changes, and makes the
    select2 dropdown display a warning sign (with a tooltip) on pickup
    locations that, if chosen, it would mean a circ rule would be
    overridden.
    
    To test:
    1. Have some pickup locations that are not valid for existing holds and
       AllowHoldPolicyOverride set to "Don't allow"
    2. Visit a biblio with some holds
    3. Choose a hold that cannot use some pickup location and use the
       dropdown
    => SUCCESS: Only valid pickup locations are retrieved
    4. Set Allow HoldPolicyOverride to "Allow"
    5. Refresh the page (I usually click on the Holds tab)
    6 .Repeat 3
    => SUCCESS: All pickup locations in the system are displayed
    => FAIL: No visual feedback on overridden pickup locations :-(
    7. Apply this patch and refresh the page
    8. Repeat 3
    => SUCCESS: All pickup locations in the systema are displayed
    => SUCCESS: Visual feedback on overridden pickup locations is shown!
    9. Set AllowHoldPolicyOverride to "Don't allow"
    10. Repeat 3
    => SUCCESS: Only valid pickup locations are retrieved
    => SUCCESS: No overrridden warn/symbol, as expected
    11. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8be3d5084bf6d74a40c162a6b6e221bbbfc86ae
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 09:34:05 2021 -0300

    Bug 27894: Adapt /holds/:hold_id/pickup_locations
    
    This patch makes the controller for the route, return all valid pickup
    locations (i.e. pickup_location => 1) when AllowHoldPolicyOverride is
    set to 'Allow', but also adds a calculated attribute: 'needs_override'
    so the consumer knows the specific pickup location needs an override
    (and thus be able to provide visual feedback on a single run).
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => FAILURE: Tests fail, the change is not implemented
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f98c4cec8eeb058357666af9e356a1dc251c19af
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 09:26:32 2021 -0300

    Bug 27894: Unit tests
    
    This patch adds tests for the changed behavior.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f470bee2e5467b19dd9cea7ef09466fd578248a8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Nov 9 09:36:28 2020 +0100

    Bug 26970: Add row highlight on drag in Elasticsearch mapping template
    
    In Elasticsearch mapping tables :
    In order to better see which row is currently in drag-an-drop,
    add an highlight color like in circulation and fine rules when editing a row.
    
    Test plan :
    1) Go to Administration > Search engine configuration (Elasticsearch)
    2) In each table : biblio, authorities, facets
    3) Clik on a row to start a drag => See row turning orange
    4) Release to drop => See row turning back to original color
    
    https://bugs.koha-community.org/show_bug.cgi?id=26970
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc587182632030c25eccbf771c765a8f301f2eb9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Mar 29 18:51:59 2021 +0000

    Bug 26459: (follow-up) Clarify language and remove duplicated code
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ff8bb69e1e91596dec7b21cb75aeaaa04c6b097
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 14 17:02:20 2020 +0000

    Bug 26459: Add hold-mode option to sip_cli_emulator
    
    To test:
    1 - Apply patch
    2 - Restart all
    3 - Place an item level hold for a patron via the staff client
    4 - Cancel the hold using the sip_cli_emulator with hold-mode: -
    perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 --patron {cardnumber} --item {BARCODE}  -m hold -l CPL --hold-mode -
    5 - Run the sip_cli_emulator with no params
    6 - Verify help text is understandable
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee84877a87ad79ce2deaf9e1b2ad0c11eb214952
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Mar 25 17:58:04 2021 +0000

    Bug 28034: Make club enrollment tables in to DataTables
    
    To test:
    -Add some clubs
    -Go to a patron record and enroll them in some clubs but not in others.
    -There should be two table under the clubs tab, Clubs currently
     enrolled in and Clubs not enrolled in
    -Neither are DataTables
    -Apply patch
    -With the same patron check the clubs tab, they should be datatables
     now
    -Make sure all the controls, pagination works good
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff60284b0100f8fbda6f16a5f7354358073985dd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 7 14:32:12 2021 +0200

    Bug 26498: Add default values
    
    Just in case
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2eb0ac6a3e08b86eba140f5135ebc717eccc70ae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 23 15:50:54 2021 +0000

    Bug 26498: (QA follow-up) Add handling for update
    
    This follow-up adds handling for updates as well as the create action as
    highlighted by Jonathans comments.  We also adds tests for these cases.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 910be084250a8c653cd0ec48e8c6c19ff6abbf6e
Author: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
Date:   Tue Mar 2 09:48:33 2021 +0200

    Bug 26498: Add POD for "store"
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fe3c489f486e185a30c82bab8ff6008e5a583bf
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Thu Nov 26 14:59:42 2020 +0200

    Bug 26498: Set default expiration date for holds
    
    Koha doesn't automatically set expiration date for holds
    so they can live in the system forever. This patch adds
    new sysprefs to control setting of default expiration
    date for holds. Note that expiration date is only set
    if input field for it is left blank.
    
    To test:
    1. Apply patch and update database.
    2. Enable syspref "DefaultHoldExpirationdate" and set some values
    to "DefaultHoldExpirationdatePeriod" and
    "DefaultHoldExpirationdateUnitOfTime".
    3. Add some holds for patron from staff client or OPAC and leave
    expiration date input field blank.
    => Holds expiration date should be set according your settings
    4. Disable "DefaultHoldExpirationdate" and repeat step 3.
    => Expiration date shouldn't be set.
    
    Also prove prove t/db_dependent/Hold.t
    
    Sponsored-by: Koha-Suomi Oy
    Signed-off-by: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b258a0684473da3f04c3b0835c821de3a03b1ad3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 29 11:35:02 2021 +0000

    Bug 28046: Add "Additional fields" link on acquisition navigation menu
    
    This patch adds a link to the "Additional fields" page in Administration
    to the sidebar menu shown on Acquisitions pages.
    
    To test, apply the patch and go to Acquisitions.
    
    - In the sidebar menu you should see a "Manage order basket fields"
      link.
    - The link should take you directly to the "Additional fields for
      'aqbasket'" page.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fae22c77efa15ced2dc05c07cdfcfeef401cd94
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 26 14:01:40 2021 +0000

    Bug 28006: Restore "Additional fields" on navigation menu
    
    This patch adds a link to the "Additional fields" page in Administration
    to the sidebar menu shown on Serials pages.
    
    To test, apply the patch and go to Serials.
    
    - In the sidebar menu you should see a "Manage subscription fields"
      link.
    - The link should take you directly to the "Additional fields for
      'subscription'" page.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f50897bd2539cd27412f680c23e29d306de9b542
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Mar 29 18:46:18 2021 +0000

    Bug 28066: (QA follow-up) Fix some single quote occurences
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58446226657c6dd32e15c7e1e98fb0d2155f003a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 31 12:41:59 2021 +0000

    Bug 28066: Remove select tag's size attribute where it is 1
    
    This patch removes the "size" attribute from <select> tags where the
    value of the attribute is 1. The attribute is unnecessary because the
    default value when the attribute is undefined is 1.
    
    This will allow for more careful sizing of <select> tags without a size
    attribute while preserving the desired behavior of <select> tags which
    have a size greater than 1.
    
    The patch modifies 83 files but makes the same minor corrections to
    each. I think examining the diff is sufficent, or testing a
    representative set of pages:
    
     - Administration -> MARC frameworks -> MARC structure -> Edit tag:
       The "Authorized value" select.
     - Patrons -> New patron: The "Library" select.
     - Reports -> Patrons with no checkouts: The "Into an
       application" selects.
    
    If anyone would like help testing any particular template I can
    follow-up.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 627897857cd493324ae875e0763cb20a961f919c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 30 12:23:12 2021 +0000

    Bug 28055: Convert DataTables option names to current version
    
    This patch makes changes the two global DataTables files in the staff
    interface, replacing older 1.9.x option names with the current 1.10.x
    version.
    
    To test, apply the patch and confirm that default DataTables behaviors
    continue to work correctly: Table information, "Show XX entries"
    controls, pagination, search.
    
    - Test tables which use the default DataTables configuration from
      datatables.js:
      - Administration -> Z39.50/SRU servers
      - Administration -> MARC frameworks -> MARC structure
    - Test tables which use the DataTables configuration in
      columns_settings.inc, including column visibility and export controls.
      - Administration -> Libraries
      - Patrons -> Patron search results
      - Circulation -> Holds queue
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd42e891862861d1d79629635b4d96ebbba8fb9a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Apr 3 14:42:26 2021 +0200

    Bug 28047: (QA follow-up) Fix a few more Callnumber entries
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b33ad0bd4f32276b761620da8e10ca87414315e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 29 18:35:16 2021 +0000

    Bug 28047: Standardize: Call number, callnumber, Call no. etc.
    
    This patch modifies instances in the template where variations of "Call
    number" are used. Instead of "Call no." "Call no" or "callnumber," "Call
    number" is used instead.
    
    To test, apply the patch and test the following pages to confirm that
    the label has been correctly updated. In the staff interface:
    
    - Circulation -> Check out to a patron with checkouts -> View the table
      of checked-out items.
      - Check out to a patron who is guarantor to a patron with checkouts ->
        View the table of the relative's checked-out items.
    - Catalog -> Bibliographic detail page
      -> Holdings table
      -> Place hold -> Check "specific items" table
      -> Rota (Stock rotation)
    - Pending on-site checkouts
    - Circulation -> Transfers to receive
    - Circulation -> Transfers to send
    - Patron -> Patron details
      -> Print -> Print summary
      -> Circulation history
    
    In the OPAC:
    
    - Log in as a user with checkouts
      -> View the checkout tab on the "Your summary" page
      -> Your checkout history
    
    In self checkout:
    
    - Log in as a user with checkouts -> View the checkouts table.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a3392bbbe16f50a9f6e42d2166fca5016effaa8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 26 11:37:52 2021 +0000

    Bug 28041: Improve breadcrumbs and headings on label creator pages
    
    This patch changes various label creator templates so that breadcrumbs
    menus and headings are more specific to each operation.
    
    To test, apply the patch and confirm that headings, page titles, and
    breadcrumbs menus are correct for the various pages:
    
    - New -> Label batch: "Label creator -> Batches -> New label batch."
    - New -> Layout: "Label creator -> Layouts -> New label layout."
    - New -> Label template: "Label creator -> New label template."
    - New -> Printer profile: "Label creator -> New printer profile."
    - New -> Barcode range: "Label creator -> Print barcode range."
    - Manage -> Label batch -> Edit: "Label creator -> Batches -> Edit
      label batch X."
    - Manage -> Layout -> Edit: "Label creator -> Layouts -> Edit label
      layout X."
    - Manage -> Label templates -> Edit: "Label creator -> Templates -> Edit
      label template X."
    - Manage -> Printer profiles -> Edit: "Label creator -> Profiles -> Edit
      printer profile X."
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18bbf42b33cc1872bd9fea5c495abf0b97df7b04
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 18:20:39 2021 +0000

    Bug 28037: Improve breadcrumbs of CSV profiles page
    
    This patch expands the logic around the page title and breadcrumbs of
    the CSV profiles page.
    
    The name of the page has also been changed from "CSV export profiles" to
    "CSV profiles" to match links elsewhere in Koha.
    
    To test, apply the patch and go to Tools -> CSV profiles.
    
    - The initial state of the page title and breadcrumbs menu should be
      "Tools > CSV profiles."
    - Click "New CSV profile." The page title and breadcrumbs should show
      "Tools > CSV profiles > New CSV profile."
    - Edit an existing CSV profile. The page title and breadcrumbs should
      show "Tools > CSV profiles > Modify a CSV profile."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1fc05de2ef183541abbeb5b022c4311227af81bd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 18:05:13 2021 +0000

    Bug 28036: Improve breadcrumbs of serial claims page
    
    This patch modifies the serial claims script and templates so that
    better context can be shown in the page title and page breadcrumbs when
    a vendor has been selected.
    
    To test, apply the patch and go to Serials -> Claims.
    
    - The initial state of the page title and breadcrumbs should show
      "Serials > Claims."
    - Select a vendor. The page title and breadcrumbs show show "Serials >
      Claims > Claims for <vendor name>."
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc13552ddc2dc548bfeedf31444e595b34766e4d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 16:44:33 2021 +0000

    Bug 28035: Improve breadcrumbs of cataloging search page
    
    This patch expands the logic around the cataloging search page's
    breadcrumbs so that more context is provided in the breadcrumbs menu.
    
    The page title should also reflect this change.
    
    Some markup in the body of the page has been updated to clarify the page
    structure using headings.
    
    To test, apply the patch and go to Cataloging.
    
     - The page title and breadcrumbs menu should show "Home > Cataloging"
     - Perform a search which will return results from the catalog, from the
       reservoir, or both. The page title and breadcrumbs menu should show:
       "Home > Cataloging > Search results."
     - Perform a search which will return no results. The page
       title and breadcrumbs should be: "Home > Cataloging > No results
       found."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da2d583591b0896367b81374725cefa4e1719d7d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 22 18:08:49 2021 +0000

    Bug 28018: Replace obsolete title-string sorting: OPAC templates
    
    This patch modifies OPAC templates to replace the use of the
    "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - As a logged-in user, (proper testing will depend on having the
      relevant data associated with your user, e.g. holds, searches, ill
      requests, etc.):
      - Your summary
        - Checkouts
        - Overdues
        - Holds
      - Your charges
      - Your search history
      - Your checkout history
      - Your holds history
      - Your interlibrary loan requests
      - Your tags
    - Bibliographic detail page
      - With a non-serial record: Holdings
      - With a serial record: Latest issues
        - More details -> Full history: Test multiple years if possible
    - Course reserves -> Course details
    - Self checkout -> Check out to a patron with checkouts
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 565591f649835da69d7f05032cd3064ed8266890
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 22 16:55:13 2021 +0000

    Bug 28016: Replace obsolete title-string sorting: Assorted templates
    
    This patch modifies various templates to replace the use of the
    "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - Cataloging -> Edit items
      - Easiest to test with an title with many items. You can follow the
        "Edit items" link from search results.
    - Tools -> Patron lists
      - View the contents of a patron list
    - Catalog -> Place hold
      - Locate a title with multiple items and check out each item with a
        different due date.
      - Start the process of placing a hold on that title for a patron.
      - On the "Place hold" screen, check the table of "specific" items and
        test sorting of the "Information" column by date due.
    - Tools -> Tags
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c96821861be4692487278aeb23c200f593cd2494
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 12:47:41 2021 +0000

    Bug 28007: (follow-up) Address missing instances
    
    This patch removes the "title-string" option from some dataTable
    initializations.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78d504eb06c326e14c8a2202bac198353b5f0568
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 22 10:41:33 2021 +0000

    Bug 28007: Replace obsolete title-string sorting: Tools templates
    
    This patch modifies several tools templates to replace the use of
    the "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - Tools -> Access files
      - You must modify koha-conf.xml to uncomment and populate the
        access_dirs section with a path to a directory containing some
        files.
    - Tools -> Calendar
      - Test the date sorting in the "Exceptions," "Yearly - Repeating
        holidays," and "Unique holidays" tables.
    - Tools -> Inventory (I wasn't able to test this because of Bug 28015).
    - Tools -> News
    - Tools -> Notices
    - Tools -> Batch patron modification
    - Tools -> OPAC problem reports
      - You must enable the "OPACReportProblem" system preference and submit
        some problem reports from the OPAC.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 769556b42a8ad2aadf89318094a5e828909e7991
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 12:33:53 2021 +0000

    Bug 27998: (follow-up) Address missing instances
    
    Remove title-string option from dataTable configurations.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e44b187b4720bb419c00e8afd50b80b4bca07958
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 19 12:32:35 2021 +0000

    Bug 27998: Replace obsolete title-string sorting: Serials templates
    
    This patch modifies several serials  templates to replace the use of
    the "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - With the Mana service configured in system preferences, go to Serials
      -> New subscription and add a subscription for a bibliographic record
      which will match titles in Mana. In the Mana search results, the "Last
      import" column should sort correctly.
    - Serials -> Claims
    - Serials -> Search
    - Serials -> Subscription details
      - The affected table is "Acquisition details," so your subscription
        must have orders associated with it (I eyeballed this change, so
        could use extra help testing this area).
    - Serials -> Subscription details -> Serial collection
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0c2ee57adbfe729dc7779fd47f8a1d3b77bd5bd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 12:20:45 2021 +0000

    Bug 27994: (follow-up) Address missing instance
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67a60c24a3e42980d62ba3272478f387ce5514a5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 19 11:38:54 2021 +0000

    Bug 27994: Replace obsolete title-string sorting: Reports templates
    
    This patch modifies several reports templates to replace the use of
    the "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - Guided reports -> Saved SQL reports
    - Guided reports -> Saved SQL reports -> New SQL from Mana -> Search
      results.
    - Reports -> Items lost
    - Reports -> Serials
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bb9cb649bf36a650d3b84c29c5c9ddd3b01caa5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 18 17:59:15 2021 +0000

    Bug 27991: Message field for OPAC problem reporting should have a maxlength set
    
    This patch adds a maxlength attribute to the form field for entering
    checkout notes in the OPAC, matching the character limit of the database
    column. A note is added to show the 255 character limit.
    
    To test, apply the patch and enable the AllowCheckoutNotes system
    preference.
    
     - Log in to the OPAC as a user who has checkouts.
     - On the "Your summary" page, the "Report a problem" fields should
       have a hint below them, "255 characters maximum."
     - Try entering text in one of the fields. You should not be able to
       enter more than 255 characters:
    
       Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse
       nunc mi, fringilla in mauris quis, hendrerit feugiat mi. Sed ultrices
       mollis nulla sit amet faucibus. Sed volutpat augue risus, eu rutrum
       eros commodo eu. Proin rhoncus nisi vitae magna_
    
     - Test that your submission is saved correctly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 330c0542fee7089c780a7329bb25c6516884451f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 12:15:56 2021 +0000

    Bug 27990: (follow-up) Address missing instances
    
    With multiple pending discharge requests, follow the "Discharge
    requests pending" link from the staff interface home page.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ea68db08f05f09b78424521f3b05ea06214fab2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 19 10:33:55 2021 +0000

    Bug 27990: Replace obsolete title-string sorting: Patrons
    
    This patch modifies several patron templates to replace the use of
    the "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view a patron record in the staff
    interface. Check the following pages to confirm that columns containing
    dates sort correctly when using any setting of the "dateformat" system
    preference:
    
    - Details: DataTables initialization removed because it is obsolete.
      Confirm that table of holds in the holds tab is still a working
      DataTable.
    - Accounting
    - Accounting -> Transactions,
    - Accounting -> Transactions -> Details of a fee (DataTables-related
      markup removed because there are no DataTables).
    - Circulation history
    - Holds history
    - Notices
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3937fcb143888a2fce9bfaec294c0355dcf0b0ab
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 11:41:16 2021 +0000

    Bug 27983: (follow-up) Address missing instances
    
    This patch cleans up some instances I missed on the first round:
    
    - Acquisitions -> Vendor -> Receive shipments
    - Acquisitions -> "All available funds" table
      -> Click an "Ordered" value
      -> Click a "Spent" value
    - Acquisitions -> Vendor
     -> test sorting of contracts in the "Contracts" table
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71fcfa95218b96df1b62272bea05898977811789
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 18 15:38:14 2021 +0000

    Bug 27983: Replace obsolete title-string sorting: Acquisitions templates part 2
    
    This patch modifies several acquisitions templates to replace the use of
    the "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - Acquisitions -> Late orders
    - Acquisitions -> Vendor -> Basket -> Add to basket -> From a
      subscription
    - Acquisitions -> "All available funds" table
      -> Click an "Ordered" value
      -> Click a "Spent" value
    - Acquisitions -> Vendor -> Receive shipments
    - Acquisitions -> Vendor
      -> test sorting of contracts in the "Contracts" table
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 995988c801806caef4db3bcceb872898e5d21515
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 12:23:59 2021 +0000

    Bug 27982: (follow-up) Address another missing instance
    
    Remove "title-string" option from staged file dataTable
    initialization.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fbfa0e2ac2cab6508e93eb221e3a8d168393128
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 11:50:25 2021 +0000

    Bug 27982: (follow-up) Address missing instances
    
    - Acquisitions -> Invoices
      - With AcqEnableFiles enabled, attach some files to an invoice:
        - Invoice details
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 716b74bf7116cfa2821f42e37a6d7a9619b98e03
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 18 14:18:07 2021 +0000

    Bug 27982: Replace obsolete title-string sorting: Acquisitions templates part 1
    
    This patch modifies several acquisitions templates to replace the use of
    the "title-string" DataTables sorting method with the newer "data-order"
    attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - Acquisitions -> Vendor search
    - Acquisitions -> Vendor -> Basket -> Add to basket
       -> From a staged file
       -> From existing orders (copy)
    - Acquisitions -> EDIFACT messages
    - Acquisitions -> Order search
    - With AcqEnableFiles enabled, attach some files to an invoice:
      - Acquisitions -> Invoices
        Acquisitions -> Invoices -> Manage invoice files
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7fef23763754ad65c5a59438ed370d53aeec4b6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 6 15:10:29 2021 +0200

    Bug 27980: Remove itemdata_publisheddate from controller
    
    This TT var was only used once, and remove in the previous patch
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70fe2b128658b3a483254b797209029f35bc91f3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 26 12:03:13 2021 +0000

    Bug 27980: (QA follow-up) Add missing case
    
    We missed one last case ;)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1eda15cfc7b2023518c03cc44e6f9416d9209b26
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 13:47:53 2021 +0000

    Bug 27980: (follow-up) Address missing instance
    
    - Search history -> Current and previous catalog searches
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce2f1625897eb9c6f101cc359b49d71bf6e93916
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 18 12:47:15 2021 +0000

    Bug 27980: Replace obsolete title-string sorting: Catalog templates
    
    This patch modifies several catalog templates to replace the use of
    the "title-string" DataTables sorting method with the newer
    "data-order" attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
     - Catalog -> Search -> Bibliographic detail page
     - Catalog -> Search -> Bibliograhpic detail page -> Checkout history
     - Search history
       - Current and previous catalog search sessions
       - Current and previous authority search sessions
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0b56714162109201d48bbecf4ad508fb8c1fd44
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 17 18:27:16 2021 +0000

    Bug 27975: Replace obsolete title-string sorting: Administration templates
    
    This patch modifies two administration templates to replace the use of
    the "title-string" DataTables sorting method with the newer
    "data-order" attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - Administration -> Currencies and exchange rates
    - Administration -> Budgets
      - Both the "Active budgets" and "Inactive budgets" tabs
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b98ac36f345a2c6d1585b1c6d3336873785e11f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 13:40:26 2021 +0000

    Bug 27974: (follow-up) Address missing instance
    
    - Circulation -> Article requests
      - Both the "Pending" and "Processing" tabs.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e64c760059b53818b38c9e9786e7b303b7a9abec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 17 18:01:17 2021 +0000

    Bug 27974: Replace obsolete title-string sorting: Circulation templates
    
    This patch modifies several circulation templates to replace the use of
    the "title-string" DataTables sorting method with the newer
    "data-order" attribute.
    
    To test, apply the patch and view the following pages to confirm that
    columns containing dates sort correctly when using any setting of the
    "dateformat" system preference:
    
    - Circulation -> Checkout notes
      - To populate the table, enable the "AllowCheckoutNotes" system
        preference enabled, log in to the OPAC as a user with checkouts.
        From the "Your summary" page use the "Report a problem" fields to
        submit notes.
    - Circulation -> On-site checkouts
      - Requires the "OnSiteCheckouts" system preference to be enabled and
        and for some items to be checked out as on-site checkouts.
    - Circulation -> Overdues
    - Circulation -> Holds to pull
    - Circulation -> Transfers to send
      - Requires the "StockRotation" preference to be enabled, some rotas
        to be set up, and for the stockrotation cron job to be executed.
    - Circulation -> Transfers to receive
    - Circulation -> Holds queue
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad701eac465857d7f7fe37ecb747a9bd2763faaa
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 29 11:57:48 2021 +0000

    Bug 27805: (follow-up) Update more instances
    
    This patch updates some preferences I missed in the first round:
    
    - NoticeBcc
    - ILLDefaultStaffEmail
    - PayPalUser
    - EmailSMSSendDriverFromAddress
    
    I've also modified the preferences CSS so that fields with type "email"
    are styled the same as fields with the "long" class to give more room
    for email addresses.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01e4ba089f9fb1961b8562547a8644c40b0b99f0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 26 12:43:28 2021 +0000

    Bug 27805: Use input type "email" for email preferences
    
    This patch changes the way input fields are output in the system
    preferences template for preferences which have an "email" class. The
    input type will now be "email" instead of "text."
    
    Email type inputs are "loosely" validated. Mozilla's documentation says
    valid patterns are "username@domain or username@domain.tld," so Koha's
    default "root@localhost" will still work.
    
    The other advantage of an "email" type input is that it typically
    triggers different keyboard options in mobile devices.
    
    To test, apply the patch and go to Administration -> Global system
    preferences.
    
    - Search system preferences for "email."
    - Test the email type preferences you find (e.g. KohaAdminEmailAddress,
      ReplytoDefault, SendAllEmailsTo), confirming that email
      addresses like username@domain or username@domain.tld work correctly.
    - Confirm that any other value triggers a validation error.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a717cc052ef5300ecd7c894901ab72fc4168d747
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Feb 13 03:40:21 2021 +0000

    Bug 27607: (QA follow-up) Make label match patron form: ZIP/Postal code
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 848993a24acb3782e8d66d23c6c33ec0ef29fb95
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 11 16:33:15 2020 +0000

    Bug 27607: Add the ability to compare patron records during merge process
    
    This patch adds an option to compare two patron records during the
    patron merge process. It can't work with more than two patrons, so the
    option only appears if one has selected only two patrons to merge.
    
    This patch also adds links to the patron names for opening the patron
    record in a new tab.
    
    To test, apply the patch and perform a search for patrons in the staff
    client Patrons module.
    
     - Select two patrons in the list of search results and click "Merge
       selected patrons."
     - On the merge patron records page, confirm that the two patron names
       are links which, when clicked, open the patron details in another
       tab.
     - Click a radio button to select the patron whose record will be
       the basis of the merge. The "Compare patrons" button and "Merge
       patrons" should go from disabled to enabled.
     - Click the "Compare patrons" button. A modal window should display
       highlighting the differences in some selected values in the patron
       record. The patron you selected as the basis for the merge should
       appear on the left.
     - Close the modal and select the other patron as the basis of the
       merge. "Compare patrons" again. The other patron should now appear in
       the left pane of the comparison.
     - Test that the "Merge patrons" button in the modal window works
       correctly to submit the merge form and that the correct patron is
       used as the basis for merging.
     - Repeat the same process above but select more than two patrons for
       merging. The "Compare patrons" button should not appear.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4eb9abba1b633e8ec392f8facdfdda7ed214e29
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 22 15:31:41 2021 +0000

    Bug 27749: Phase out jquery.cookie.js: Search to hold
    
    This patch modifies the "search to hold" process for patrons and clubs
    so that the newer jquery-cookie plugin is used instead of jquery.cookie.
    
    To test, apply the patch and locate a patron in the staff interface.
    
     - From the patron checkout or details page, click "Search to hold" in
       the toolbar."
     - Perform a catalog search which will return results.
     - On the search results page you should see a "Place hold for..." link
       with the correct patron information under each result.
     - In the toolbar above the search results you should see a "Place hold"
       button with a dropdown menu which also references the patron you
       selected.
     - Test that each option works to place a hold for your patron.
     - Test that the "Forget..." menu option works to remove "place hold
       for" options.
     - Test that your "Place hold for" option is also remembered on the
       bibliographic detail page.
    
    To test the changes to Patron Clubs:
    
     - If necessary, create a patron club:
       https://koha-community.org/manual/20.11/en/html/tools.html?highlight=club#patron-clubs
     - Add one or more patrons to the club:
       https://koha-community.org/manual/20.11/en/html/tools.html?highlight=club#enrolling-a-patron-in-a-club-from-the-staff-client
     - From the patron clubs page, choose "Search to hold" from the club's
       "Actions" menu.
     - Perform the same tests above.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41ac4254257b96ba1742cf249fdab57fa2e2b9a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 6 14:39:32 2021 +0200

    Bug 27738: Fix wording
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab02c660cd05105766569e6616097be5b1ee30db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 6 14:24:14 2021 +0200

    Bug 27889: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9a3ac31919794e3d892ba3735a7051c411fccb1
Author: Magnus Enger <magnus@libriotech.no>
Date:   Tue Feb 23 10:39:33 2021 +0100

    Bug 27748: Encoding problem in link to OverDrive results
    
    If you have OverDrive enabled and do a search for e.g. "Göteborg",
    you will get a link above the regular Koha search results that
    says e.g. "Found 1 results in the library's OverDrive collection".
    If you follow this link, a search will be made in OverDrive, but only
    for "G", because the search term is cut off at the first non-ASCII
    char.
    
    To test:
    - Make sure OverDrive is enabled
    - Do a search that contains a non-ASCII char, like "Göteborg"
    - Click on the link "Found x results in the library's OverDrive
      collection"
    - Verify the query string is cut off at the first non-ASCII char,
      and that the number of hits is different from the number given
      in the link on the previous page
    - Apply the patch, restart all the things
    - Repeat the search, and verify that the numbers match and that the
      query string is intact after clicking on the OverDrive link
    
    Lookin at the code, the same problem seems to be shared between
    OverDrive and RecordedBooks. I have applied the same fix to both,
    but I do not have access to RecordedBooks, so I have not been able
    to verify that the problem exists there and is fixed by my patch.
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dad0a18c7a8a95c3bca7bf97d010953c5a41a0f1
Author: Séverine Queune <severine.queune@bulac.fr>
Date:   Fri Apr 2 14:13:28 2021 +0200

    Bug 28077: Add a colon after the 'Reason' label on edit suggestion page
    
    This patch corrects the missing colon on the 'Edit purchase suggestion'
    page.
    To test :
    - go to Acquistions > Suggestions
    - edit a suggestion
    - on 'Suggestion management' bloc, see the colon missing after the
    'Reason' label
    - apply patch
    - refresh the page
    - colon should now be displayed
    
    Happy sign off !
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4df8e3ef02b4490dc813b76b853e3fb706d4a301
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 29 10:33:13 2021 +0000

    Bug 28044: Increase specificity of calendar tables CSS
    
    This patch adds increased specificity to the CSS which should add colors
    to the tables of holidays. The default DataTable CSS was overriding the
    custom color-coding.
    
    This patch also moves the calendar CSS into a separate file.
    
    To test, apply the patch and go to Tools -> Calendar.
    
    If necessary, add at least one of the following:
    - Unique holiday
    - Holiday repeating weekly
    - Holiday repeating monthly
    - Holiday exception
    
    In the table listing each kind of holiday, the color of the table header
    should match the colors in the "Key" section under Hints. The color
    should be correct regardless of how the table is sorted.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08bebe336cc11df566d89055b9792f02cfbb5f85
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 15:37:31 2021 +0000

    Bug 28033: Fix minor capitalization errors
    
    This patch corrects capitalization in two templates:
    
    - Administration -> Desks:
      "Modify Desk" / "New Desk" -> "Modify desk", "New desk" in breadcrumbs
      menu.
    - Reports -> Most-circulated items:
      "Most-circulated Items" -> "Most-circulated items" in breadcrumbs.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b607d84140e5870a641c845d8bd3f79448bf714
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Tue Jan 19 03:16:45 2021 +0000

    Bug 24000: Some modules do not return 1
    
    This patch adds "1;" to the end of the following perl files:
    Koha/Filter/MARC/EmbedItemsAvailability.pm
    Koha/Filter/MARC/EmbedSeeFromHeadings.pm
    Koha/Filter/MARC/Null.pm
    Koha/Item/Search/Field.pm
    Koha/SearchEngine.pm
    misc/translator/VerboseWarnings.pm
    t/lib/Koha/Plugin/Test.pm
    
    This indicates the succesful execution of the initialization code.
    
    Test plan:
    Ensure that there are no other perl files that need "1;", but dont have
    it.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6016791fc0bc589dfe70db7e2c25cab8410c88ec
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 8 11:06:52 2019 +0000

    Bug 24000: Koha::Item::Search::Field does not return 1
    
    Test plan:
    Run t/db_dependent/Koha/Item/Search/Field.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5e7d37d8a0427f50d31d922df89ba4b16e15c98
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Sun Feb 21 10:41:04 2021 -0800

    Bug 27738: Set fallback for unset DefaultCountryField008 to |||, "no attempt to code"
    
    Current code intended to set a fallback of xxu, an unknown state in the US,
    but because the preference is always defined, just sometimes unset, it
    actually falls back to three spaces, an invalid value. This patch instead
    uses the fallback value ||| which means no attempt to code.
    
    Test plan:
    1. Without the patch, verify that the value of the system preference
    DefaultCountryField008 is empty.
    2. Cataloging - New record - Default framework (if you have the Advanced
    editor enabled, Settings - Switch to basic editor, this only applies to the
    basic editor)
    3. On tab 0, click in the text input for field 008 which fills in default
    values, then click the Tag editor button at the end of the field
    4. In the popup window, verify that the value for 15-17 is shown as ###
    indicating three spaces
    5. Apply patch, repeat the steps above, verify that the value is now |||
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 147b1ced1dee259c4f210d88a5ec902b549d2836
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 16 17:46:33 2021 +0000

    Bug 27889: (follow-up) Adjust width of OpacAddMastheadLibraryPulldown
    
    This patch adds some responsive classes to the
    OpacAddMastheadLibraryPulldown container so that it will adjust better
    at various browser widths.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd6ccd828a0578b0d1558e2d79916d2823a9a926
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 16 16:00:57 2021 +0000

    Bug 27889: Adjust responsive width of OPAC advanced search form
    
    This patch tweaks the CSS for the advanced search form in the OPAC so
    that it adjusts well at various browser widths, including preventing the
    form from taking up the whole width of the page at higher browser
    widths.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - In the OPAC, go to the advanced search page.
    - Test the appearance of the fields in the first "Search for" section,
      confirming that everything adjusts well at all widths large and small.
    - Click the "More options" button and test that configuration as well.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af0fc2f0f0f58f8caf80ae965ecf6024f3e915e8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 12 08:48:59 2021 +0000

    Bug 27926: (QA follow-up) Switch to using data-order
    
    This patch switches away from using the title attribute for ordering and
    instead uses data-order which is supported in modern DataTables.  This
    has the effect of allowing our ordering to continue to work but without
    adding the unwanted tooltip on hover.
    
    Test plan
    1/ Ensure sorting is still working as expected
    2/ Hover over any of the date of birth fields and note that you are not
    longer faced with a tooltip.
    3/ Signoff
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1f5f363bc8c29f3374e4751599c420caa43ef9a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 11 12:15:25 2021 +0000

    Bug 27926: Add 'title-string' for dates on circ-patron-results
    
    This patch adds the title string sorting for the data of birth field in
    the circulation patron results table.  This has the side effect of
    adding a tooltip that displays the date of birth in ISO format, so I'm
    not entirely sure it's the right approach.
    
    Test plan
    1/ Set your date format preferences to British English (dd-mm-yyyy)
    2/ Do a search that will yield multiple patrons via "Check out"
    3/ Try sorting on date of birth and not the order is incorrect.
    4/ Apply the patch
    5/ Refresh the page and try sorting on date again
    6/ The order should now be correct
    7/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5787203a708429bfb746dfa16cfa6fee75a8714a
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Apr 1 22:51:07 2021 +0000

    Bug 28074: Make current_search.offset an integer instead of string
    
    To test:
    1. Do a search with 3-4 results, go to the record and use the browse
       controls, when you get to the last record if you attempt to go to the
       'next' you'll end up on a page which says 'record not found.'
    2. Do a search with exactly 10 results. Click on the first record, the
       'next' arrow is not a link, you cannot move to the next result.
    3. Apply patch
    4. Repeat steps 1-2 and the problems should be gone.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a6bb8c6cddbb5b9e7458d6c923f6818794528bb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Mar 29 18:17:37 2021 +0000

    Bug 27900: (QA follow-up) Rephrase link text
    
    See discussion on IRC from today :)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f9d888942b134458796bf9d8a389238492b915d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Mar 29 17:53:53 2021 +0000

    Bug 27900: (QA follow-up) Add missing filter
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 191184f28a5efd95994f42cafbe1e94ffff38475
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 11 15:03:07 2021 +0100

    Bug 27900: Add a link back to the basket view if no result
    
    Since bug 24347 the neworderbiblio view has been removed and we now
    display the usual search result.
    When adding a new order from a search, if there is no result we should
    let the user get back to the basket view.
    
    Test plan:
    Add to basket from an existing record
    Do a search with no results and confirm that there is a new "Go to the
    basket view" link
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb77238117cf94388bea896d57b7cf78e47fd43a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 6 12:56:50 2021 +0000

    Bug 21958: Allow 'e' subfield for authorities
    
    This bug specifically changed the code to allow for e in authority record
    
    This is a tricky issue, see link for discussion:
    https://www.loc.gov/marc/marbi/2008/2008-dp05-1.html
    
    It seems to be allowed, but possibly not useful?
    
    In either case I think for now we can allow in the test to fix this error
    and possibly open a new bug for further discussion
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 789a7a863426c7887055095ca58e09fd46f67972
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 6 08:16:37 2021 -0300

    Bug 28017: (follow-up) Fix Letters.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02d82b142d998f1544fbab6e7f35f6f0fceef084
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Thu Mar 11 01:06:35 2021 +0000

    Bug 27610: (follow-up) Hide <h1> on opac-main.tt
    
    This patch visually hides the <h1> on opac-main.tt so that libraries' customisations of their home pages are not disturbed by the introduction of a descriptive <h1>, but the heading is still available to be read out by screenreaders in the summary of headings on the page.
    
    Test plan:
    
    1) Apply dependencies and all patches on this bug report
    3) Ensure the <h1> "Koha home" heading on the OPAC main/home page is hidden visually, but in the source code you can see it
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9db6630c61208d680c76020d1fff50a4664cc5ba
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Feb 16 09:11:08 2021 +0000

    Bug 27610: Changed pages of OPAC to have a <h1>
    
    Changed each of the pages in the OPAC to have one <h1> tag showing that describes the page, rather than the <h1> describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this will be dealt with in a follow up patch or bug.
    
    To test:
    1) Go to the OPAC
    2) Apply patch
    3) Go to each of the pages and check that they have an obvious and
    descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored by: Catalyst IT
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e49f4e6ceade009ca02f7d0a6d4db7d9ec826283
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Wed Feb 3 22:37:47 2021 +0000

    Bug 27610: Changed <h1> around logo to <div>
    
    To test:
    1) Look at OPAC and the logo
    2) Apply patch
    3) Check Koha logo looks the same as before applying the patch
    4) Ensure page source shows logo inside <div> and not <h1>
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ca5eca203b1a9983e47508704bf4522e1be2e0a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 23 11:41:19 2021 +0000

    Bug 27742: (follow-up) Add title for record blocked page
    
    This modifies the title for the template used when a bibliographic
    record is blocked.
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eecc4d3e8be7e15ed550b1ead8fb4c04e8cf4df2
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Feb 22 07:19:05 2021 +0000

    Bug 27742: Page titles have unique info first
    
    Changed the titles of each page on the OPAC to display the unique
    information first, and the name of the website (e.g. Koha library
            catalog). This is fot accessibility reasons, such as when a
    screen reader user is going through tabs, they do not have to waste time
    listening to the website name, they can just find the unique page title
    first.
    
    To test:
    1) Go to the OPAC
    2) Apply patch
    3) Go to each of the pages and check that the page title has the unique
    information about the page first, and the name of the website is at the
    end
    
    Sponsored by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d972ddb79e50a69be56ed8d5166e7b2eabb68e30
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 1 18:50:12 2021 +0200

    Bug 27846: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bad2e0fb5d9def4b31356b205e5d0bafeb5a49ad
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 24 17:41:45 2021 +0000

    Bug 27846: (follow-up) Use background SVG for breadcrumb dividers
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a4c089dc1e67d1551759d295f9781838e9ba5be
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 24 13:32:18 2021 +0000

    Bug 27846: (QA follow-up) Apply changes to transfers_to_send
    
    It looks like the transfers to send page was added after these changes
    were coded up.. This patch just impliments them for this page too.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a682c620ee4c3e8e76100e4cae8a3a03b775475b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 24 10:43:45 2021 +0000

    Bug 27846: (follow-up) Add id back to breadcrumbs container
    
    I think the "breadcrumbs" ID is worth saving for past and future CSS
    customization reasons.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d415a5c7485b7e058e59a61ca6ae1a310eba525f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 23 12:01:06 2021 +0000

    Bug 27846: (follow-up) Indentation corrections
    
    This patch makes some indentation changes to make things (in my opinion)
    more consistent. Diffing while ignoring whitespace should show no
    changes except to acqui/basket.tt where some lines were broken up.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9126cdc0232f23586e13d0c6c20fe9c1972b12a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 23 12:16:43 2021 +0000

    Bug 27846: (follow-up) Use SCSS-style nesting for style additions
    
    This patch takes the changes introduced to the SCSS file in the previous
    patches and converts it to use SCSS-style nesting to generate the
    same output.
    
    There should be no visible changes as a result.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf2fc6aadd590ebede7e4e9a72c6fa7ac4a280c2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 23 18:33:17 2021 +0000

    Bug 27846: (follow-up) Markup corrections
    
    This patch makes minor markup corrections which were introduced by the
    previous patches or discovered during testing.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a6183763f1dd8cac411076a0086422ae51e2e6e
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Wed Mar 10 02:38:52 2021 +0000

    Bug 27846: tools and virtualshelves folders
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the tools and virtualshelves folders have
       breadcrumbs that are in a <nav aria label="Breadcrumb"
       class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 311ddeddf9325cfda53aa3c9e6eab3f6eca72b59
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 9 23:51:42 2021 +0000

    Bug 27846: rotating_collections, serials, suggestion and tags folders
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the rotating_collections, serials,
       suggestion and tags folders have breadcrumbs that are in a <nav aria
       label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47ea9c89871ad2e68aa0aed60cf3eea4d3ce1382
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 9 22:52:31 2021 +0000

    Bug 27846: reports, reserve and reviews folders
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the reports, reserve and reviews folders
       have breadcrumbs that are in a <nav aria label="Breadcrumb"
       class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2203900066668c8c4eed3b68e950cf8744816505
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 9 04:54:45 2021 +0000

    Bug 27846: offline_circ, patroncards, patron_lists, plugins and pos
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the offline_circ, patroncards,
       patron_lists, plugins and pos folders have breadcrumbs that are in a
       <nav aria label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to
       the page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d237208de5cccf0ea79f79a3b4a710c30f7a103a
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 9 03:32:52 2021 +0000

    Bug 27846: members folder
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the members folder have breadcrumbs that
    are in a <nav aria label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
    belonging to these files look the same as before, but the '>' symbol is
    replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
    page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e16fe97a28730aede57b06e3886780fd4329547
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 9 02:03:34 2021 +0000

    Bug 27846: labels folder
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the labels folder have breadcrumbs that
       are in a <nav aria label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ae1e6dfe32849b5fafbda7c3d7771f407f7aa6f
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Mar 8 23:39:38 2021 +0000

    Bug 27846: clubs, course_reserves, errors and ill folders
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the clubs, course_reserves, errors and
       ill folders has breadcrumbs that are in a <nav aria
       label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0053d3263c0625455fbadc05cbc8c77e33edb67
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sat Mar 13 09:32:18 2021 +0000

    Bug 27846: circ folder
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the circ folder have breadcrumbs that are
       in a <nav aria label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec04fcb16ac1a1d11af860ccb7f1ddbdca4ea358
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sat Mar 13 09:29:07 2021 +0000

    Bug 27846: authorities, catalogue and cataloguing folders
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the authorities, catalogue and
       cataloguing folders have breadcrumbs that are in a <nav aria
       label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cde5aa10506eca2f76cf323dcdc9e02ac7ca8878
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Thu Mar 11 04:14:02 2021 +0000

    Bug 27846: admin folder
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the admin folder has breadcrumbs that are
       in a <nav aria label="Breadcrumb" class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b4b52fd25f8310e03555bd431c9d485b70c50aa
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Thu Mar 11 02:40:25 2021 +0000

    Bug 27846: modules and modules/acqui folders
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader.
    
    Made the block of breadcrumbs be a <nav aria label="Breadcrumb"
    class="breadcrumb"> with an ordered list inside. The last breadcrumbs
    also has aria-current="page" to specify that it is the current page.
    
    To test:
    1) Apply patch
    2) Build scss file
    3) Ensure each of the files in the modules folder and the modules/acqui
       folder has breadcrumbs that are in a <nav aria label="Breadcrumb"
       class="breadcrumb"> block
    4) Ensure that there is an ordered list in the block of breadcrumbs
    5) Ensure that the last breadcrumb has aria-current="page"
    6) Ensure that the breadcrumbs on each page of the staff client
       belonging to these files look the same as before, but the '>' symbol
       is replaced with '/' and the last breadcrumb has bold text
    7) Ensure that when the last breadcrumb is clicked it takes you to the
       page you are currently on
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21c6c6c38396ff3dd379242f9fba491bb805d8b1
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Mar 2 10:13:06 2021 +0000

    Bug 27846: changed scss for breadcrumbs
    
    Changed styling for breadcrumbs to be accessible
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62848497033c601ea928890f903acf32c72d08d2
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Mar 23 23:08:51 2021 +0000

    Bug 28004: Fix breadcrumbs on authorised_values.tt
    
    To Test:
      - go to a category with at least one value, see the complete breadcrumb "Home › Administration › Authorized values › Authorized values for category" with link on the 3 first menus
      - create a new category / go to an empty category ; see the incomplete breadcrumb "Home › Administration › Authorized values" with link only on the 2 first menus
      - Apply patch
      - go to category with at least one value, breadcrumbs should look like Home › Administration › Authorized values › Authorized values for category CATEGORY
      - got to category with no values, breadcrumbs should look the same as category with values
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3aee4f4eca0a7dfbcb4704416f646dfaef39da70
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Mar 17 13:27:27 2021 +0200

    Bug 27936: Clarify AllowItemsOnHoldCheckoutSIP syspref help text
    
    The waiting reserves have always been impossible to checkout via
    SIP2. There was some confusion whether this is actually true but if
    you check the commit "Bug 25690: Remove duplicated logic in SIP2
    checkouts" (338ba1d769) and the removed code around line
    
      $self->screen_msg("Item is on hold for another patron.");
    
    you will be sure that it has been impossible to checkout waiting holds.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd40febe67b4d75e57311ff1673d0c34299b58fe
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue Mar 30 12:13:27 2021 +0100

    Bug 28052: Do not check SYSENV values only keys in loop
    
    Loop is only interested in key values, because 'keys' is omitted
    it is checking values as well. This can lead to misleading errors
    being logged (e.g. key is undefined)
    Extract keys only to loop array as in the other loops below this
    
    Testing:
    1 - tail /var/lib/koha/kohadev/sip-output.log
    2 - in another tab use the sip cli tester:
       perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 -l CPL -m checkin --item CHESS1
    3 - Note errors:
    Use of uninitialized value $key in index at /kohadevbox/koha/C4/SIP/Sip/MsgType.pm line 337, <STDIN> line 1.
    Use of uninitialized value $key in index at /kohadevbox/koha/C4/SIP/Sip/MsgType.pm line 337, <STDIN> line 2.
    4 - Apply patch and restart all the things
    5 - Repeat 2
    6 - Errors mentioned are gone
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 607d7f0a60d8c002dbac7ce22e7bcc128062f208
Author: Catherine Ma <catherinem2003@gmail.com>
Date:   Tue Jan 19 02:26:54 2021 +0000

    Bug 27397: The description input field when defining numbering patterns is too short
    
    Test Plan:
    1. go to the serials module
    2. click on manage numbering patterns in the left hand navigation
    3. add or edit a pattern
    4. check the description field is as short as the name field, but can
    take much more text
    5. add patch
    6. repeat steps 1-3
    7. check the description field is larger than the name field (it should)
    
    Sponsored by Catalyst IT
    
    Works OK!
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0053cc6c3e5a8a5791f96fbcd61a29f92d36fc61
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 26 12:05:44 2021 +0000

    Bug 28042: Button corrections in OAI set mappings template
    
    This patch makes minor markup changes in the OAI set mappings template
    so that the "Add" button looks consistent with other buttons in the
    table.
    
    Also changed: Removed unnecessary inline style attributes.
    
    To test, apply the patch and go to Administration -> OAI sets
    configuration
    
    - If necessary, create an OAI set.
    - Click the "Actions" button and choose "Define mappings."
    - In the table of form fields, confirm that the "Add" button is styled
      similarly to the "Delete" button.
    - Confirm that the "Add" button works as expected.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d156d5a9fe3b30a0e65f70a5203a8a99bc30e651
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 25 15:08:03 2021 +0000

    Bug 28032: Button corrections in point of sale pages
    
    This patch corrects some markup inconsistencies in some templates
    related to point of sale:
    
    - Point of sale -> Library details. The "btn-xs" class has been added to
      "Record cashup" and "Cashup all" buttons.
    - Administration -> Debit types and Administration -> Credit types:
      - Font Awesome icons are removed from the "save" and "cancel" controls
        in order to keep them consistent with other templates.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 367f19f6273fa26af9e653625156da0dba9dfc17
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 5 15:33:02 2021 +0000

    Bug 27881: Markup error in masthead-langmenu.inc
    
    Some markup errors were introduced into the masthead-langmenu include
    file by Bug 20168, presumably during the update to the dropdown menu
    markup:
    
    '<a class="dropdown-item" <a href="'
    
    ...resulting in validation errors like "Attribute <a not allowed on
    element a at this point." This patch correct the errors.
    
    To test you should have at least two languages enabled in the
    OPACLanguages system preference, opaclanguagesdisplay set to "allow,"
    and OpacLangSelectorMode set to "top" or "both top and footer."
    
    - Apply the patch and view the OPAC.
    - The "Languages" menu at the top of the page should look correct and
      work correctly.
    - Validating the source of the page should return no errors related to
      the language menu's markup.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 297dbf4a5935931cdb8ebf6b9f00f60e291699df
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 30 12:15:22 2021 +0100

    Bug 28053: Squash warning in C4::Members
    
    This patch sets guarantess_non_issues_charges to '0' upon creation of
    the variable and thus prevents 'Use of uninitialized value
    $guarantees_non_issues_charges in numeric gt (>) at
    /home/martin/kohaclone/C4/Members.pm line 183.' being thrown when the
    patron has guaruntees without any charges.
    
    Test plan
    1. Run t/db_dependant/SIP/SIPServer.t and note the warning above is
       thrown at least once.
    2. Apply the patch
    3. Run the test again and note the warning has gone.
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df3a8d25482e10c748a52cb0a7e66ecf9b854364
Author: Magnus Enger <magnus@libriotech.no>
Date:   Fri Mar 12 11:28:02 2021 +0100

    Bug 27940: Fix missing email in OpacMaintenance page
    
    To reproduce:
    
    KohaAdminEmailAddress = Some valid email address
    OpacMaintenance = Show
    
    OPAC/cgi-bin/koha/maintenance.pl shows this text:
    
    "Koha online catalog is offline for system maintenance. We'll be back
    soon! If you have any questions, please contact the site administrator."
    
    "site administrator" is a link, but it only links to "mailto:", the
    actual email address from KohaAdminEmailAddress is missing.
    
    To test:
    - Apply the patch
    - Reload the maintenance page
    - Click on the "site administrator" link and verify it contains the
      address from KohaAdminEmailAddress
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfe3753deeddb40610a27ccc48ad71110c2bb350
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Tue Mar 30 12:49:00 2021 +0100

    Bug 28054: Reinstate the shebang in SIPServer.pm
    
    Bug 26673 renoved the shebang from SIPServer.pm. This was an error
    SIPServer.pm is a program not a perl module, and needs the shebang
    for the OS to assign an interpreter unless the command line
    calls it as an argument to perl. Restore the shebang
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5aa24a6a479bd2066499d115f33004885264e3ee
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Mar 4 19:37:10 2021 +0000

    Bug 27869: let user know something went wrong with csv upload
    
    To test:
    -attempt to upload a malformed CSV file
    -nothing happens, check the console and see the error: Uncaught TypeError: arrData[(arrData.length - 1)] is undefined
    -apply patch
    -try again
    -now you should at least see a warning that something went wrong
    -attempt to upload a good CSV file, it should work
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb03909af62585aa7a280cd49b2008b0e7b2cbb8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 11 16:11:15 2021 +0100

    Bug 27921: Log correct timestamp for HOLD MODIFY when set waiting
    
    The HOLD MODIFY log at the end of ModReserveAffect is not using an
    up-to-date $hold object.
    
    $hold is modified at
    1201         $hold->set_waiting($desk_id);
    But not refreshed before logged (and so the timestamp is not logged
    correctly).
    
    Test plan:
    Turn on HoldsLog
    Place an item on hold
    Check it in to mark it waiting
    
    Confirm that the timestamp logged is the one from the check in, not when
    you created the hold
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6840e8d6fb05dd8c4915f30b925f5a229ded13c3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 23 12:19:48 2021 -0300

    Bug 28017: Test IPs are supported
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4413557b0074bc7b7fc6b2614889f23521ecb0ee
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 22 14:47:33 2021 -0300

    Bug 28017: Allow non-FQDN (@localhost) addresses
    
    This patch makes Koha::Email support using @localhost addresses.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/Koha/Email.t
    => FAIL: Koha::Email doesn't support non-fqdn addresses
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: All tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d949c4fc20882397b24cbb28fd6f20c7ecb102be
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 22 14:47:11 2021 -0300

    Bug 28017: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0fd2be61e8376ad0db0f8ecf1eacde706cec6816
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 15 08:33:49 2021 -0300

    Bug 26999: (follow-up) Simplify code
    
    Doing
    $ git grep pickup_locations_code
    
    shows there's some calculated data that is not actually used anywhere.
    We can get rid of it.
    
    This patch also reuses $item_object (which is in the same loop scope) to
    avoid an extra DB call.
    
    To test:
    1. Run:
       $ git grep pickup_locations_code
    => FAIL: It is only used/set as a comma separated string, inside
    request.pl
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: The unused stuff is not there anymore
    4. Open the page for placing some holds
    => SUCCESS: It doesn't explode
    5. Sign off :-D
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13bb39f4c670d72686dd6b76cc0757c2f07b04d5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 15 08:05:02 2021 -0300

    Bug 26999: Make 'Any library' translatable when placing a hold
    
    This patch makes the 'Any library' string translatable, by converting it
    into a flag and using it accordingly on the request.tt template.
    
    To test:
    1. Have the 'Hold pickup library match' set to 'any library' on the
       circultation rules.
    2. Open the page to place a hold on a biblio with some items
    => SUCCESS: The item says 'Any library' on the 'Allowed pickup
    locations' column.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: No behavior change
    => SUCCESS: The string is on the template
    5. Sign off :-D
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20d5a458f38ef622920f083cac97ef753cf41d95
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 26 18:36:19 2021 +0000

    Bug 28043: Some patron clubs operations don't work from later pages of results
    
    This page changes the way event handlers are defined for some operations
    on the patron clubs page. These changes make it possible for the
    controls to work on multi-page tables of clubs.
    
    To test, apply the patch and got to Tools -> Patron clubs.
    
    - If necessary, add enough patron club templates and patron clubs that
      there are more than 10 of each.
    - Click to the second page of club templates and try to delete a
      template. It should work correctly.
    - Click to the second page of clubs and try to delete a club. It should
      work correctly.
    - Add one or more patrons to a club (from the checkout or patron details
      page).
    - Click to the second page of clubs and try the "Search to hold" menu
      item. It should redirect you to the search page.
    - After entering a search, the results page should include "Place hold
      for <club>" links with each result.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07bf1726e8bb0c35e60ca0a742f4edfb69f0c32b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 19 13:00:32 2021 +0000

    Bug 27999: Display the description of authorized values category
    
    This patch corrects a parameter in the authorized values template so
    that the right value is passed for displaying the description of an
    authorized value category.
    
    To test, apply the patch and go to Administration -> Authorized values.
    
    - In the table of authorized values, click on one which has a
      description in the "Description" column.
    - On the page titled "Authorized values for category XXX," you should
      see that description under the heading.
    - Use the "Show category" dropdown to try some other categories.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39742718af01b565718b233df3d70e34b0eaea1c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 1 17:24:34 2021 +0200

    Bug 27566: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dee61a7c3e30629f8651823a6dd761e98560d60c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 28 16:37:13 2021 +0000

    Bug 27566: Add generic font family to prevent unstyled select tags
    
    This patch adds a default font family "sans-serif" to the OPAC CSS as a
    workaround for this Firefox bug:
    
    font-family isn't honored in `<option>` element within `<select>`
    dropdown
    https://bugzilla.mozilla.org/show_bug.cgi?id=1536148
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Open the OPAC main page in Firefox.
     - Click the search type dropdown. The options should be styled using
       your system's default sans-serif font rather than a serif font.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7dcb4287e0642b87b3f66b421ea64ad712e49661
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 19 15:02:12 2021 +0000

    Bug 28003: Invoice adjustments using inactive budgets do not indicate that status
    
    This patch affects the display of existing invoice adjustments to indicate when using an inactive budget
    
    To recreate
    1 - In acquisitions go to a vendor
    2 - Click 'Receive'
    3 - Create an invoice
    4 - Finish receiving
    5 - Go to Admin->budgets
    6 - Duplicate your current budget
    7 - Mark the original budget inactive
    8 - View the invoice you created
    9 - No indication the budget is inactive
    10 - Apply patch
    11 - Reload the page
    12 - The fund shows '(inactive)'
    13 - The dropdown to edit the funds also indicates which funds are inactive
    
    Note that adding new adjustments does show only the active budget unless you request to see inactive.
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08c6e629de50ba0f54cc9550d24b575cd7d820dd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 16 13:13:57 2021 +0000

    Bug 27937: Set datepicker when date is valid
    
    When validating dates in JavaScript it is acceptable to have single digit days or months e.g,:
    2011-6-16
    
    When parsing in Koha::DateUtils->dt_from_string we die on these
    
    This patch uses JS to set the datepicker which normalizes the date as Koha expects
    
    To test:
     1 - Add new patron
     2 - Enter birthdate as 2/11/1986
     3 - Complete required fields
     4 - Save
     5 - Get ISE
         The given date (2/11/1986) does not match the date format (us) at /kohadevbox/koha/Koha/DateUtils.pm line 175
     6 - Apply patch
     7 - Repeat 1-2
     8 - Note that when you change focus (click on another field) the date is formatted as '02/11/1986'
     9 - Save patron, success!
    10 - Edit patron, try setting DOB to 2/1/1986
    11 - Change focus and note date is formatted as '02/01/1986', save
    12 - Repeat with other settings of system preference 'dateformat'
    
    Signed-off-by: Donna <donna@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Bug 27937: (QA follow-up) Fix indentation
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93a297a7a2de41df699d59107e43862518048d6e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 11 13:33:43 2021 +0000

    Bug 27928: FindDuplicate should use simple_search_compat
    
    This patch switches from calling SimpleSearch directly to using the compat
    method so that Elastic is used when it is the chosen search engine
    
    To test:
     1 - Set SearchEngine syspref to 'Zebra'
     2 - Add a suggestion with an existing title, e.g.:
       'E street shuffle'
     3 - Confirm you get a duplication warning
     4 - Change SearchEngine to ES
     5 - Repeat get same warning
     6 - sudo koha-zebra --stop
        'ps aux | grep zebra'  to confirm they are stoped
        'sudo pkill -9 zebra' if they arent;
     7 - Repeat suggestion - no duplication warning (because zebra returns nothing)
     8 - Delete the suggestion
     9 - Apply patches
    10 - Restart all the things, stop zebra
    11 - Repeat suggestion
    12 - Successful warning from ES
    13 - prove -v t/db_dependent/Search.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b60fe963f91a370fd254b23f1104fd660fbeee38
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 19 13:31:49 2021 +0000

    Bug 27993: Add handling for datecancelled in in_transit
    
    This patch adds handling for the datecancelled field in the in_transit
    method.
    
    Test plan
    1/ Run the new unit test in t/db_dependent/Koha/Item/Transfer.t
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87cc346e48f3c41746ae12fede6cb447ce336953
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 19 13:31:10 2021 +0000

    Bug 27993: Add unit tests
    
    This patch adds a unit test to check that 'in_transit' takes
    datecancelled into account.
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8424f402bed2e71d9080d3adabf5e3255bc79629
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 2 11:19:42 2021 +0000

    Bug 27807: (QA follow-up) Unique values only
    
    This patch filters the final _order_by clause such that we only have
    unique data fields present and we take the first occurence of a field.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 548562ca17ae06088e84d8fe9287a9f4043ce80e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 2 10:36:06 2021 +0000

    Bug 27807: Add multi-column ordering support to datatables wrapper
    
    This patch add mutli-column ordering support to the datatables api
    wrapper.
    
    Test plan
    1/ Add a series of cities to the system with various combinations of
    city and state such that you can distinguish sorting on city + state in
    city ascending + state ascending, city ascending + state descending etc.
    2/ Attempt to sort on the two fields in the table (Click the 'City'
    heading to sort on city name, then Shift Click on 'State' to add 'state'
    ordering on top.. Shift click again on state to reverse the 'state'
    ordering but maintain the 'City' ordering.
    3/ Confirm the various ordering comes out correctly.
    4/ Signoff
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7d5f477ac62935f37b1b4046564283acacf4f39
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 26 13:59:58 2020 +0000

    Bug 21260: (follow-up) Fix typo in holdingbranch segment
    
    Copy-and-paste error. We need holdingbranch here.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ava li <rubyli208@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24f56d872eb0cba822c2349d9cf9c20b3e3261a6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Aug 25 14:44:38 2020 +0000

    Bug 21260: Move the count before the callnumbers
    
    The current display is a bit confusing [Call number: A](2) seems
    to indicate that we have two call numbers A. But what it means here,
    is: we have two items and we list only one, being A.
    
    So, we'd better do something like:
        Items available for loan: Centerville (2) [Call number: A, ..]
    Which says we have two items at Centerville, listing only one (A),
    but indicating with the two dots that there are more.
    
    Test plan:
    Pick a biblio with multiple available items at a branch.
    Include it in a search and check results display.
    Test the same but with only one branch in Koha.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ava li <rubyli208@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07741c30b64e420343c44cfcb2c8824b01b53154
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 19 16:52:13 2020 +0200

    Bug 21260: Introduce local pref to affect status grouping
    
    Introducing a local preference Available_NFL to control which not for
    loan statuses are considered to be 'available for reference'.
    Standard value is '1|2' which comes down to the former >0 when using
    the initial Koha defaults.
    
    Test plan:
    [1] Pick a biblio with an available item A, an item B with notforloan 1,
        an item C with notforloan 2 and two damaged items. (Former patch.)
        Include it in a OPAC search. You should see:
            Available: A. Reference: B, C. Not-available: Damaged(2).
    [2] Add local pref Available_NFL with value '1'. Repeat the search.
        You should see now:
            Available: A. Reference: B. Not-available: S.C.(1), Damaged(2).
        [where S.C. stands for Staff Collection]
    [3] Run test t/db_dependent/XSLT.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ava li <rubyli208@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 950ec5555c2f2f860b5c4984a0fb0ef5ebd73e22
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 24 15:05:23 2020 +0200

    Bug 21260: Remove item details from reallynotforloan block
    
    No need to display itemcallnumbers and branch info for items that
    are ('really') not available.
    We only show a status and a count for the reallynotforloan ('ordered')
    categories (not per branch). This simplifies the code too.
    We use the preceding-sibling axis to loop over the unique substatuses.
    
    Test plan:
    [1] Pick a biblio with an available item A, an item B with notforloan 1,
        an item C with notforloan 2 and two damaged items.
        Include it in a OPAC search. You should see:
            Available: A. Reference: B, C. Not-available: Damaged(2).
    [2] Edit item C (notforloan 2). Change to notforloan -1.
        Search again. You should see:
            Available: A. Reference: B. Not-available: On order(1), Damaged(2).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ava li <rubyli208@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f05bff428c898cda480c8b85539cc2c058a2b30c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 19 16:52:13 2020 +0200

    Bug 21260: Create three main XSLT Availability segments
    
    XSLT changes:
    [1] Add an item count at the start. Also add variables for counting
        status available and reference. Use these vars in the corresponding
        'blocks'.
    [2] Refine the No items-test with the new itemcount.
    [3] Combine the reallynotforloan block with the other statuses by
        refining (extending) its initial test. All if's are moved up into
        the former block but are unchanged.
    
    Result of these changes makes that the Availability line consists of three
    segments: 1 Available items, 2 Reference items, 3 Other statuses.
    
    Test plan:
    [1] Check a biblio without any items in the OAPC results. You should
        see the No items only here.
    [2] Check a biblio with one item checked out. You should see only the
        'third' segment with Checked out(1).
    [3] Check a biblio with one available and a notforloan==1. You should
        see segment 1 and 2. Both listing item call numbers.
    [4] Check a biblio with one available and a notforloan==-1. You should
        see segment 1 and 3. Both listing item call numbers. (See also the
        following patch.)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ava li <rubyli208@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 325a6dfd7015e9fd1a89f4ea8f6a948e873cd5a2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 19 16:20:27 2020 +0200

    Bug 21260: Simple adjustments in Availability blocks
    
    [1] Add reallynotforloan=0 test to 'Block 1'. Add a period after No items available.
    [2] Remove the if with colon block. Remove the <br> and add a span for reallynotforloan (items on order).
    [3] Add a 'Not available' label for the reallynotforloan block.
    [4] Remove the On order status, since it is not used anymore since 7611.
    
    Test plan:
    See subsequent patches.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ava li <rubyli208@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d2d6aa8bc0b7e4fdbfcd8400897ddc71acb4c07
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 19 14:35:22 2020 +0200

    Bug 21260: Indentation at higher levels for Availability/Location
    
    Only whitespace changes and few comments.
    
    Test plan:
    Nothing to test. Count the spaces ;)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ava li <rubyli208@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27fce8b0c2575021400023d9a7460adef20dadd6
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Jan 22 22:50:51 2021 +0000

    Bug 26942: Allow style and link tags in NewsEditor TinyMCE
    
    To Test:
    -Make sure the sys pref 'NewsToolEditor' is set to TinyMCE
    -Go to any news item and add this line:  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    -Save the news item
    -Re-open the same news item again in TinyMCE.
    -The editor has removed that line. Annoying!
    -Apply patch
    -Try again, the <link> should stay now
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f071b01f5c851a6b066e7084643bd6430e6e8d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 16 11:36:17 2021 +0100

    Bug 27963: (bug 23463 follow-up) Fix touch_all_items.pl
    
    This script is used to fix inconsistencies in the items table. Prior to
    bug 23463, ModItem dealt with that.
    
    We need to make some attributes as dirty to make sure the
    Koha::Item->store method will fix them.
    
    Test plan:
    Be familiar with how touch_all_items is supposed to work and confirm
    that the different inconsistencies are fixed.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit faf33a27abccfb0b7fbf5542375b834a1acba059
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 25 13:32:39 2021 +0000

    Bug 21958: (QA follow-up) Correct indirect object notation
    
    Our coding guidelines now forbit indirect object notation calling.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 016bb29b60effec161e71ba34266acb27038afba
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Tue Jan 22 14:38:32 2019 +0200

    Bug 21958: Fix bibliographic record field comparison with authority
    
    This makes the comparison between bibliographic field and authority field more robust and per subfield. This makes the comparison not consider the same e.g. the following fields:
    
    $a Test User
    $a Test $b User
    
    The actual issue cannot be as easily reproduced with the patches for bug 21826 applied, but here's a test plan anyway:
    
    1. Make sure tests pass (especially t/db_dependent/AuthoritiesMarc*)
    2. Make sure authority linking still works properly
    3. Make sure authority and biblio frameworks allow subfield i
    4. Make sure that even if you add subfield i to 700 in biblio, authority link is kept the same
    5. Make sure that even if you add subfield i to the authority record, the authority link is kept the same
    
    Signed-off-by: Frank Hansen <frank.hansen@ub.lu.se>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f79cdf9925c86856775a28bede9fec0dabfcd99
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 23 11:14:43 2021 -0300

    Bug 28023: Fix Reply-To typo
    
    This patch fixes a typo making the header useless.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/Koha/Email.t
    => FAIL: The Reply-To header is not being set!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! the header is set!
    5. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad55a2b4d820d914ad398224a62633f6df1e1d8a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 23 11:14:37 2021 -0300

    Bug 28023: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 539c9e5c9b04ac6e6151de839dd5e08bd603c371
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 23 16:58:04 2021 -0300

    Bug 26705: (QA follow-up) Do not rely on latest Email::MIME
    
    This patch makes the implementation use lower-level methods to deal with
    headers. So the Email::MIME library in Debian 9 works.
    
    Params are sorted for testing purposes.
    
    To test:
    1. Apply this patch
    2. Run the tests
    => SUCCESS: Things pass in D9+
    3. Sign off :-D
    
    Thanks Kyle!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d7bd9a8e7a62d01e0cec5095f5641fe87dfbeb3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 23 14:26:02 2021 +0000

    Bug 26705: (QA follow-up) Clarify test result
    
    Simple output string improvement to fix the copy/paste of the previous
    tests comment string.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebf9c134d160ab9dfd905a0b26fe7db6ad04d093
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 23 10:57:13 2021 -0300

    Bug 26705: Make Koha::Email->send_or_die handle Bcc
    
    Koha used to rely on Mail::Sendmail for sending emails. As an SMTP
    client, the library took the job of extracting Bcc headers (and removing
    them) to pass them along with the recipients listed on To: and Cc: to
    the SMTP protocol in the form of RCPT TO: lines. [1]
    
    This was overlooked when we moved to Email::Stuffer/Email::Simple and
    there's a different behavior, that is a design decision [2].
    
    This patchset re-introduces the behavior from Mail::Sendmail by
    overriding the send_or_die method locally (in Koha::Email) and doing the
    right thing.
    
    Unless an explicit {to} parameter is passed, it extracts the recipients
    from the headers, as Mail::Sendmail does, and calls
    $self->SUPER::send_or_die with the right parameters.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/Koha/Email.t
    => FAIL: Bcc is not handled correctly!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! The recipients list is correct! No Bcc header
    sent!
    5. Sign off :-D
    
    [1] https://metacpan.org/release/Mail-Sendmail/source/lib/Mail/Sendmail.pm#L331
    [2] https://metacpan.org/pod/Email::Sender::Manual::QuickStart#Hey,-where's-my-Bcc-support
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58a5a040661c150d455c5942bc56cecbb1a0e2d1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 23 10:56:59 2021 -0300

    Bug 26705: Regression tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f744dfe60cea1aca2883b02c8c33c4467bc81c30
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 30 15:47:12 2021 +0100

    Bug 25946: (QA follow-up) Add Unit tests
    
    Add a unit test for the empty relationship availability.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8245bc6f2de7276d7e98788b115e3b983c915941
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Tue Mar 30 14:42:11 2021 +0300

    Bug 25946: borrowerRelationship can be empty
    
    Do not show the empty dropdown with no options if borrowerRelationship
    is disabled (empty) in the syspref.
    
    To reproduce:
        1) Go to system preferences and disable borrowerRelationship.
        2) Create a new patron or modify the existing one.
        3) Under "Guarantor Information" click on "Search to add" button.
        After performing the search, select different patron to act as
        guarantor.
        4) Observe that there's empty dropdown for the relation type.
        5) Apply the patch.
        6) Repeat steps above.
        7) Observe that dropdown is no longer there.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0cc5fa97a529d9f59562ce9969d26a6fb5ef01e
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Mar 29 16:59:32 2021 +0300

    Bug 25946: borrowerRelationship can be empty
    
    When borrowerRelationship is empty in system preferences, Relationship
    dropdown is not required and we accept empty value.
    
    Also fixes bug that didn't let you to pick empty value even when you
    specified that it should be possible in system preferences but in the
    end of the string (i.e. "|father|mother" worked,
    but "father|mother|" don't).
    
    To reproduce (borrowerRelationship can be empty):
        1) Go to system preferences and make borrowerRelationship empty.
        2) Create a new patron who is assumed to have a guarantor or modify
        the existing one.
        3) Under "Guarantor Information" click on "Search to add" button.
        After performing the search, select a user to act as guarantor. Try to save your changes.
        4) Observe that relationship field is required in order to save but
        you can't actually choose anything as it doesn't contain anything.
        5) Apply the patch.
        6) Repeat steps above.
        7) Observe that it allows you to save the form now.
    
    To reproduce (can't choose empty value bug):
        1) Go to system preferences and set borrowerRelationship exactly
        to "father|mother|".
        2) Create a new patron who is assumed to have a guarantor or modify
        the existing one.
        3) Under "Guarantor Information" click on "Search to add" button.
        After performing the search, select a user to act as guarantor.
        4) Observe that there's no option to leave relationship field empty.
        5) Apply the patch.
        6) Repeat steps above.
        7) Observe that it has empty option that you can choose and save
        the form.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4490dfdf089c1e1eef44bfd4c71b84e7e9c8610a
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Mar 29 16:58:25 2021 +0300

    Bug 25946: borrowerRelationship can be empty
    
    Do not split the config using comma.
    
    From syspref description of borrowerRelationship preference:
    
    > Guarantors can be the following of those they guarantee:
    > (input multiple choices separated by |). Leave empty to deactivate.
    
    As it doesn't mention comma at all, I removed ',' from split.
    Of course if comma is actually a viable way to split separate choices,
    I can obsolete this patch and append to the syspref description that it
    also can be separated by comma.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7697cc23b2efb58547b91abcfe85e5729b90be36
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Sep 24 09:08:43 2020 +0200

    Bug 26517: Add unit test
    
    Run prove t/db_dependent/Members.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4c33e532d4abeb66bbbafe0ab75797a8e801349
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Sep 23 16:50:09 2020 +0200

    Bug 26517: Avoid deleting patrons with permission
    
    The patron deletion script misc/cronjobs/delete_patrons.pl uses C4::Member::GetBorrowersToExpunge() to get patrons that may be deleted.
    This method filters patrons from a staff category.
    I propose to also filter patrons having permission, so a staff member.
    Some small libraries do not define a "staff" category and give permissions to regular patrons.
    
    Test plan :
    1) Create a patron on adult type category with expiry date in the past and permission to access staff interface
    2) Without patch
    3) Run delete script : ./src/misc/cronjobs/delete_patrons.pl -v --expired_before='$(date -I)'
    4) You see the patron will be deleted
    5) Apply patch
    6) Run delete script : ./src/misc/cronjobs/delete_patrons.pl -v --expired_before='$(date -I)'
    7) You dont see the patron
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e177268294ebb8a9c7430cfaca16a0724d73a6a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 18 15:04:47 2021 +0100

    Bug 27835: DBRev 20.12.00.025

commit 126326b8b3933cd64f8ddf34ad96fd69f3db3d0e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 15 17:06:16 2021 +0000

    Bug 27816: "Click to edit" in Point of sale is untranslatable
    
    This patch adds an option to the Point of sale jEditable configuration
    to explicitly set the title attribute to "Click to edit." This will
    allow the string to be picked up for translation.
    
    To test, apply the patch and test that the correct string is
    translated. In this example I'm testing fr-FR:
    
      - Update a translation:
    
        > cd misc/translator
        > perl translate update fr-FR
    
      The "Click to edit" string should already have been translated, so
      it's not necessary to update the .po file.
    
      - Install the updated translation:
    
        > perl translate install fr-FR
    
    In the staff interface, switch to the language you're testing and open
    the point of sale page. Add some items for purchase. They should appear
    in the "This sale" table. Hover your mouse over the values in the "Coût"
    and "Quantité" columns. You should see the translated string, "Cliquer
    pour modifier."
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit a6d77fb4286c3be6fe513a95bc258b7b3fb45c03
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 16 16:39:13 2021 +0000

    Bug 27967: Add min attribute to borraccount modals
    
    This patch adds a min attribute to the form fields of the borrower
    account page modals to prevent negative values being entered
    inappropriately.
    
    Test plan
    1/ Trigger the refund modal from the borrower account page.
    2/ Attempt to enter a negative value for the amount to refund and note
    with the patch applied you face a validation error (without the patch,
    upon submission of a negative value you will be faced with a server side
    error)
    3/ Trigger the discount modal from the borrower account page.
    4/ Attempt to enter a negative value for the amount to discount and note
    with the patch applied you face a validation error (without the patch,
    upon submission of a negative value you will be faced with a server side
    error)
    5/ Signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 1b32e66380d5d7701b3f252e8d2be1cbf1622388
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 17 10:14:43 2021 +0100

    Bug 27933: Fix patron search result ordering
    
    On bug 27715 we restrict the order by dt params for security reasons.
    However in some cases the param passed is "columnname" instead of
    "table.columnname".
    We should make sure the table is part of the sort fieldname.
    
    Test plan:
    Do a "normal" patron search (from the patrons home page) and another
    patron search (guarantor for instance).
    Sort by cardnumber, date of birth, expiration date, asc, desc and
    confirm it works as expected.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 675088752afcee77ddfd3279e617f0d657f1f81d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 17 10:34:16 2021 +0100

    Bug 27835: Turn off by default
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit deb2f6317a10ec202b2c45dbab663d7a61a43de2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 16 13:22:26 2021 +0000

    Bug 27835: (follow-up) Update language, remove warn, add feedback
    
    This patch:
     - Updates lanugage to be clearer 'ChargeFinesOnClosedDays' vs 'ChargeFinesOnCloseDay'
     - Removes a stary warn
     - Add an 'updated' counter and provides feedback in fines.pl
    
    Test plan:
     0 - Apply patches, updatedatabase
     1 - set finesCalendar to 'ignore', ChargeFinesOnClosedDays to "Don't charge"
     2 - Checkout an item due yesterday
     3 - Ensure circ rules have a fine amount and interval set
     4 - Make today a holiday
     5 - perl misc/cronjobs/fines.pl -v
     6 - 0 updated
     7 - ChargeFinesOnClosedDays to "Charge"
     8 - perl misc/cronjobs/fines.pl -v
     9 - 1 updated
    10 - set fines calendar to 'use'
    11 - perl misc/cronjobs/fines.pl -v
    12 - 1 updated (NOTE: This is wrong maybe, but handle on another bug)
    13 - set ChargeFinesOnClosedDays to "Don't charge"
    14 - perl misc/cronjobs/fines.pl -v
    12 - 0 updated
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 151966d0967786ab235158b4c1a84e19788610b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 16 10:16:55 2021 +0100

    Bug 27835: Add a syspref to control fines calculation on closed days
    
    Bug 27180 added a patch to not update fines on holidays if finesCalendar was set to ignore.
    At least it's what it advertised, but not what it did.
    
    It seems that we need to add a new pref to control the calculation of
    fines on closed days to answer the different use cases.
    
    Test plan:
    With this patch applied you can run the fines.pl cronjob and play with
    the new pref ChargeFinesOnCloseDay to generate fines on close days.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 5007e24e90efeb76fe3d86a8fa832d52af30abc0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 16 10:16:51 2021 +0100

    Bug 27835: Add new syspref ChargeFinesOnCloseDay
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 1c4b4cbd91cc9888e9cdbdf1fe43a10c91bd157b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 16 09:55:10 2021 +0100

    Bug 27835: Revert "Bug 27180: (follow-up) Remove unused %is_holiday"
    
    This reverts commit a26d529a2bc7faee3743b4cd1e603ba29411a0b9.
    
    Revert "Bug 27180: Update fines on holidays"
    
    This reverts commit 80e1b4e66f01a07cad9bf37625d879f649edf52a.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit ec4bb0539a2b2479130159408c33ccfb82292888
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Tue Mar 16 18:59:11 2021 +0000

    Bug 27969: Change wording on returns page
    
    To test:
    1- go to /cgi-bin/koha/circ/returns.pl, click Checkin settings to show options
    2- it says "Remember due date ..."
    3- apply patch, reload
    4- it says "Remember return date ..."
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c28b85740495b4fe65bdb290f7b4f7145a2bd050
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 17 08:23:10 2021 +0100

    Bug 18532: Add missing notice template for it-IT
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e01bff1135dfdb01bfcc4a515020eb409a67ad15
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 16 16:07:37 2021 +0100

    Bug 18532: DBRev 20.12.00.024
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42483f651a03d6826775a809c314782e0c59df8e
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Mar 16 11:44:19 2021 -0300

    Bug 18532: (follow-up) fix messages and bug in automatic_renewals script
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bbed39585ae5a0a0405ea5c62a1482b8edd39f8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 16 10:18:38 2021 -0300

    Bug 18532: (follow-up) Fix atomic update
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ba6200191ff6c80bebf4c4738cb1174c29f8280
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 12 11:38:04 2021 -0300

    Bug 18532: (follow-up) Fix rebasing issue
    
    When the ILL notices were added, a bad rebase got rid of the notice
    description in both messaging-preference-form.inc and opac-messaging.tt
    
    This patch restores that line:
    
    1. Set AutoRenewalNotices to 'according to patron...'
    2. Edit a patron category
    => FAIL: There's an 'Unknown' label for 'Auto renewal'
    3. Look at a patron's messaging preferences
    => FAIL: There's an 'Unknown' label for 'Auto renewal'
    4. Look at a patron's messaging preferences in OPAC
    => FAIL: There's an 'Unknown' label for 'Auto renewal'
    5. Apply this patch
    6. Repeat 2, 3, 4
    => SUCCESS: 'Auto renewal' is displayed as expected
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc0ee173df096c1e7811581921d999c3e9ea6ca1
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Dec 10 16:27:45 2020 -0300

    Bug 18532: (follow-up) Fix notice message, add notice to all installer languages and fix preference message
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39faff6606c9eefdf61a1e74182aa4a6b38fb156
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu May 14 13:21:22 2020 +0000

    Bug 18532: Add individual issues to digest notice and hide auto_renewals messaging preference when not needed
    
    This patch enhances auto_renewals message, removes auto_renewals messaging preference when AutoRenewalNotices is not set to ‘preferences’ and uses that preference to send notices in automatic_renewals.pl script.
    
    To test:
    
    1. Apply patches
    2. updatedatabase
    3. make sure automatic renewals are allowed in circ rules, have a positive number of allowed renewals and a positive number for renewal period
    4. Check AutoRenewalNotices preference
    SUCCESS => AutoRenewalNotices has the value ‘cron’ (means that It keeps the usual behaviour)
    5. Checkout two items for a patron, and set them as automatic renewal and set due date as your current yesterday
    6. perl misc/cronjobs/automatic_renewals.pl -c -v
    SUCCESS => items were renewed, but there is no message in message_queue table in mysql
    7. Repeat step 5
    8. perl misc/cronjobs/automatic_renewals.pl -c -s -v
    SUCCESS => items were renewed, and there is one message per item in message_queue table in mysql
    9. Change AutoRenewalNotices to ‘never’
    10. Repeat step 5
    11. perl misc/cronjobs/automatic_renewals.pl -c -s -v
    SUCCESS => items were renewed, but there is no message in message_queue table in mysql, even with the -s switch
    12. Check any patron’s category, and any detail page in staff or OPAC interface, and in any of them you should find Auto Renewals messaging preference
    13. Change AutoRenewalNotices to ‘preferences’
    14. Repeat step 12, but this time all of them shows the Auto Renewals messaging preference.
    15. Repeat step 5 with a patron that has no messaging preference setted
    16. perl misc/cronjobs/automatic_renewals.pl -c -s -v
    SUCCESS => items were renewed, but there is no message in message_queue table in mysql, because patron didn’t choose to receive messages
    17. Grab a category and modify auto renewals messaging preferences, and save
    18. Create a new patron from that category.
    SUCCESS => created patron has the same messaging preference for auto renewals
    19. Grab that patron and change auto renewals messaging preference to email but not digest
    20. Repeat step 5 for that last patron.
    21. perl misc/cronjobs/automatic_renewals.pl -c -v
    SUCCESS => Items were renewed, and there is a message for each item in message_queue table in mysql.
    22. Change auto renewals messaging preference from the same patron and set to email and digest.
    23. Repeat step 5.
    24. perl misc/cronjobs/automatic_renewals.pl -c -v
    SUCCESS => items where renewed, and now there is only one message in message_queue table with the details of both renewed items.
    25. Check that any changes to a patron’s auto renewals messaging preference in staff is reflected in OPAC, and the other way arround too.
    26. Sign off
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14896e2032cccd833f74c251121aabc5da471715
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu May 14 12:53:30 2020 +0000

    Bug 18532: (follow-up) Remove digest switch and add preference
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b29e015f7d930e5dfe592c9801ebb77c98a9d5d8
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Oct 29 15:27:38 2019 -0300

    Bug 18532: set auto_renewals as patron messaging preference
    
    This patch adds the "Auto renewals" messaging preference on intranet and OPAC, and adds digest feature to misc/cronjobs/automatic_renewals.pl script.
    
    (Deprecated test plan. Please check the last patch)
    To test:
    1. apply patches
    2. perl installer/data/mysql/updatedatabase.pl
    3. make sure automatic renewals are allowed in circ rules, have a positive number of allowed renewals and a positive number for renewal period
    4. go to patron categories in administration of staff interface and choose a category.
    CHECK => in "Default messaging preferences for this patron category" has a "Auto renewals" row and has email and digest options checked
    5. grab a patron and go to details page
    CHECK => patron's messaging preferences has a "Auto renewals" row with email and digest options checked
    6. some settings and save
    7. go to opac with that same patron to "your messaging" option
    CHECK => patron's messaging preferences has a "Auto renewals" row, and displays changes made in staff interface.
    8. uncheck email and digest from "Auto renewals" row and save
    9. check out an item for that patron, and set it as automatic renewal and set due date as your current yesterday
    10. perl misc/cronjobs/automatic_renewals.pl -c --send-notices -v
    SUCCESS => item was renewed, and in message_queue table there is no new message for the patron
    11. update patrons messaging preferences and set email option of "Auto renewals" row as checked
    12. repeat steps 9 and 10
    SUCCESS => item was renewed, but in message_queue table there is a new message of type AUTO_RENEWALS
    13. update patrons messaging preferences and set email and digest options of "Auto renewals" row as checked
    14. repeat steps 9 and 10
    CHECK => item was not renewed
    15. run step 10 again, but add -d flag, like this:
        perl misc/cronjobs/automatic_renewals.pl -c --send-notices -v -d
    SUCCESS => item was renewed, and in message_queue table there is a new message of type AUTO_RENEWALS_DGST
    16. Sign off
    
    Signed-off-by: tgoat <tgoatley@gmail.com>
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Marti Fuerst <mfuerst@hmcpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe781ba2163b8160b0e2ad2040bb69c1cbf5e882
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Oct 29 15:27:37 2019 -0300

    Bug 18532: Add new letter AUTO_RENEWALS_DGST, new Auto_Renewals in message_attributes, and configured message_transports
    
    Signed-off-by: tgoat <tgoatley@gmail.com>
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Marti Fuerst <mfuerst@hmcpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 18532: (QA follow-up) Atomicupdate syntax
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da233f82d086ca046f00d1802d1dd8fc14666763
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 8 13:16:35 2021 -0300

    Bug 27366: Add controller
    
    Add a patron holds controller for the REST api and impliment the #list
    methods.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5c5d0cdc825b7cefbb5e3cfe240f33442dc9c06
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 8 13:16:19 2021 -0300

    Bug 27366: Unit tests
    
    Addd unit tests for the new patrons/{patron_id}/holds api route.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e32b2a944962286da97472ab136b2d6a782af65a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 8 13:15:58 2021 -0300

    Bug 27366: Spec changes
    
    Add /api/v1/patrons/{patron_id}/holds route and holds object description
    to the OpenAPI specification.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 242ae7a6d8b7f41f9373605e922cc84e529869ba
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 28 09:08:24 2021 +0000

    Bug 26272: Add ajax driven cashup modal to library page
    
    This patch adds an ajax driven cashup summary modal to the library
    registers summary page.
    
    Test plan
    1/ Enable UseCashRegisters in the system preferences
    2/ Add at least one cash register to your library
    3/ Make some payments of various types (Cash, Card) against the cash
    register
    4/ View the register transactions details page
    5/ Make a refund against a payment
    6/ Cashup
    7/ View the cashup summary by clicking on the 'Summary' link on the
    register page.
    8/ Navigate to the 'libraries' summary page
    9/ View the cashup summary by clicking on the 'Summary' link in the
    registers table.
    10/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fdbb20e6a1bedbfc0695e44e2d7082118feb447
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Nov 24 12:24:32 2020 -0500

    Bug 26633: Add advanced editor link on admin home page
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51eaf2467bd140f48a22b81815f21e728eb5f420
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Nov 16 12:16:50 2020 -0500

    Bug 26633: (QA follow-up) Add error handling for loading transfer limits table
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fcec196b005b510ec7e72a8e4924079ac01e391
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Nov 6 13:29:33 2020 -0500

    Bug 26633: Add ability to bookmark the page you are viewing
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22cd0ee3953d036feb2a89ad1a37f18906915a7c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Nov 6 13:15:14 2020 -0500

    Bug 26633: Add API documentation
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94cefde05db5c9c6f0b3be53e206285a0d9d1fe2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 10:41:32 2020 +0100

    Bug 26633: Remove jquery.checkboxes.min.js include
    
    No longer exists and not used in this template
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82de600f6dfd9bbe5e272ee25b54fb2b4c519a35
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 3 11:14:26 2020 -0300

    Bug 26633: POD for the exceptions file
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f91ae728bf1b7f21389328de97680a9ba1a0bc53
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 3 11:06:58 2020 -0300

    Bug 26633: (QA follow-up) Tests on error condition
    
    This patch highlights a problem with the try/catch conditions in the
    ad() controlled method. Tests are added, and the controller is fixed to
    reflect the right behaviour.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/transfer_limits.t
    => SUCCESS: Tests pass! 409 is returned as appropriate!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 953980a5dd1866bc24316be3dc0a37736466221f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Oct 27 14:01:47 2020 -0400

    Bug 26633: (QA follow-up) Action buttons should not remain grayed out if the same action is used multiple times in a row
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 241acf9714bee55f6fc0d2885532e3afd3b23889
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Oct 23 00:51:34 2020 +0000

    Bug 26633: (QA follow-up) Change label to "collection" as we display the description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc919ed914ab109e89a6dceaf9c62c1a4329ff50
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 25 02:54:54 2020 +0200

    Bug 26633: Fix indirect object notation
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd575181480dc822e1903959962c2a248e147584
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 8 11:15:44 2020 -0400

    Bug 26633: Add advanced editor for transfer limits
    
    The current transfer limits editor works great for Koha instances with
    small numbers of branches. However, for consortiums with dozens or even
    hundreds of libraries, the editor does not work well or effectively.
    
    We should provide an "advanced" editor displays all to/from library
    combinations in a grid and allows them to be edited in a manner somewhat
    similar to the transport cost matrix editor.
    
    Test Plan:
    1) Apply this patch
    2) Browse to the transfer limits editor
    3) Click the new "Switch to advanced editor" link
    4) Select a collection code/item type to edit limits for
    5) Test the "Check all" function
    6) Test the "Uncheck all" function
    7) Test the "Check" column function
    8) Test the "Uncheck" column function
    9) Test the "Check" row function
    10) Test the "Uncheck" row function
    11) Test individual checkboxes/table cells
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8aec8a80216c81c523596d334d58db94b1051fdb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 8 11:14:26 2020 -0400

    Bug 26633: Add REST API for managing transfer limits
    
    Test Plan:
    1) prove t/db_dependent/api/v1/transfer_limits.t
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26633: Convert transfer_limit.json to YAML
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc5decc913b34468b1355925dc8ba260b060365c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 19 10:12:32 2021 +0000

    Bug 27716: Update permissions for patroncards creator
    
    The various subpages of the label creator tool we're under the
    'catalogue' permission. There is however a 'label_creator' subpermission
    of tools which is more appropriate.
    
    Test plan
    1/ Setup a user with just the 'catelogue' permission (to enable logging
    into the staff interface)
    2/ With the patch applied you should not be able to access the following
    pages (either via navigation in the UI or by typing them into the
    browser address bar directly)
      - /patroncards/add_user_search.pl
      - /patroncards/edit-batch.pl
      - /patroncards/edit-layout.pl
      - /patroncards/edit-profile.pl
      - /patroncards/edit-template.pl
      - /patroncards/home.pl
      - /patroncards/image-manage.pl
      - /patroncards/manage.pl
      - /patroncards/print.pl
    3/ Signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 260b0ccdc71bfd02908e623e6931843ac3caaae0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 16 16:05:17 2021 +0100

    Bug 27939: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b416c98f4573440b7e6b230ccab013616f161de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 12 09:30:02 2021 +0100

    Bug 27939: Update yarn.lock file
    
    There is a minor security vulnerability, it is good to fix it even if there is no impact on security: yarn is only used for dev purpose.
    
    The the logs of https://wiki.koha-community.org/wiki/Development_IRC_meeting_24_February_2021
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    https://bugs.koha-community.org/show_bug.cgi?id=27938
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 510958d90b6b99bd808ecffa8ded1fc85771f1f9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 10:14:08 2021 +0100

    Bug 27860: Fix password recovery
    
    Same as the previous patch but for the password recovery feature.
    
    Test plan:
    1. Do not apply the patches
    2. Set KohaAdminEmailAddress to an invalid email (root@localhost for
    instance)
    3. Use the password recovery feature
    5. Boom (that must be fixed on a separate bug report)
    6. Set KohaAdminEmailAddress to a valid email (root@example.org)
    7. Use again the password recovery for a different user
    8. Still Boom! (because it's processing the first invalid email)
    9. Apply the patches, restart_all
    10. Try again the password recovery
    => The email is sent!
    Notice the change in DB, the first email is still there with status
    "pending" and second email is sent!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87eaaf302c5f228598bdbb055bd6bcdccf9883d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 10:04:14 2021 +0100

    Bug 27860: Fix self-registration if messages with incorrect email are inqueued
    
    If the pref KohaAdminEmailAddress was not set correctly (invalid email)
    and has been used to generate message, the message_queue table can contain
    some messages that are not sent (pending) and will be processed each
    time a new self-reg is done.
    The PatronSelfRegistrationVerifyByEmail feature must send only the
    notice we just generated, not the whole pending queue.
    
    Test plan:
    1. Do not apply the patches
    2. Set KohaAdminEmailAddress to an invalid email (root@localhost for
    instance)
    3. Turn on PatronSelfRegistrationVerifyByEmail
    4. Self-reg a patron
    5. Boom (that must be fixed on a separate bug report)
    6. Set KohaAdminEmailAddress to a valid email (root@example.org)
    7. Self-reg a patron
    8. Still Boom! (because it's processing the first invalid email)
    9. Apply the patches, restart_all
    10. Self-reg a patron
    => The email is sent!
    Notice the change in DB, the first email is still there with status
    "pending" and second email is sent!
    
    QA: at step 10. TODO first email must be 'failed' (highlight in tests)
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2bad23f1c1dbd74b81fefb1939b2bcefd914b3d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 10:01:30 2021 +0100

    Bug 27860: Add message_id param to SendQueuedMessages
    
    We could use C4::Letter::GetMessage, but the query in
    _get_unsent_messages join on borrowers and return the branchcode.
    To prevent any regressions it's preferable to not modify
    SendQueuedMessages.
    
    Ideally we obviously need a Koha methods to have better and clean code..
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ff9160a620519e1626044ff7d9205a0015ac1e4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 3 10:33:35 2021 +0100

    Bug 27597: Remove leading colon in ES query
    
    If we are searching on kw there is a leading colon at the beginning of
    the generated query:
      kw:foo becomes :foo
    
    Note that it only happens when there is no other terms before.
    
    Test plan:
    0. Don't apply the patch
    1. Search for kw:foo
    2. Notice the error
      Error: Unable to perform your search. Please try again.
    and the logs say
      Failed to parse query [(:foo*)]
    3. Apply the patch
    4. Repeat the search and notice that you know get:
       "12 result(s) found for 'kw:foo'."
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41d33deba40622ca132560d6827157fb11322e79
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Mon Mar 8 19:33:06 2021 -0800

    Bug 27737: (follow-up) Minimal CSS changes to avoid regressions
    
    To keep the specificity of the rules we want to have apply to both the
    biblio editor and also the authorities editor, we need to add the ID for
    the authorities editor, rather than remove the ID for the biblio editor.
    
    Also, the removal of the selectors for #authoritiestabs descendents was
    regressing the display of authority record details, which is where that
    plural authoritiestabs element lives.
    
    Test plan:
    
    1.  With neither patch from this bug applied, Cataloging - New record -
        Default framework.
    2.  Shrink and widen your browser window, noticing how the input fields
        flex to remain the full width, keeping the controls to duplicate and
        delete a subfield out directly to the right of the input.
    3.  Authorities - search for Perl (or any term that will match a record),
        click the linked authority term to open the Authority detail display
    4.  Note how the field number, field description, and subfield descriptions
        are all different colors, and subfield codes are on the same line as
        the subfield contents.
    5.  Apply both patches from this bug.
    6.  Cataloging - New record - Default framework
    7.  Verify that the input fields still behave the same as you widen and
        shrink your browser window
    8.  Authorities - New authority - Chronological Term
    9.  Verify that the input fields now behave like the ones in the biblio
        editor, shrinking and widening to fill the width of the page, keeping
        the controls to duplicate and delete subfields immediately to the
        right of the field
    10. Authorities - search for Perl, click the linked authority term to open
        the Authority detail display
    11. Verify that the tag number, field description and subfield descriptions
        are still properly colored and subfield codes are still on the same
        line as the subfield contents.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Trivial fixup for a copy-paste failure, missed the y on
    subfield_loop_mandator
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2ef47a49860902e7ff441ab3343475958c80efb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 2 17:44:35 2021 +0000

    Bug 27737: Tag editor for authority lookup broken in authority editor
    
    This patch changes the markup structure for the authorities
    editor so that it better matches that of the basic bibliographic
    record editor. This allows the authority-linking JavaScript to
    correctly target fields on both pages.
    
    To test, apply the patch and go to Authorities in the staff client.
    
     - Create or edit an authority record.
     - Switch to tab 5 and if necessary click one of the tag names (e.g.
       "SEE ALSO FROM TRACING--PERSONAL NAME") to expand the subfields.
     - Click the "..." plugin link next to subfield a ("Personal name" in
       this example).
     - In the popup window, search for an authority record.
     - Click "Choose" next to one of the results.
     - The popup window should close and the authority editor should contain
       data from the record you chose, including a value in $9 and $a.
     - Test with various records to confirm that data in other fields is
       copied correctly, for instanct $d, dates associated with a name, $t
       title of a work.
     - Test other JavaScript-driven interactions in the editor:
       - Duplicate repeatable tag
       - Remove repeatable tag
       - Empty tag
       - Reorder sortable tags (e.g. multiple 500 tags)
       - Reorder sortable subfields
       - Duplicate repeatable subfield
       - Remove repeatable subfield
       - Empty repeatable subfield
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=22737
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a2dfc5ea36d45d7af9c0e4102f92a601e192b46
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 1 11:40:56 2021 +0100

    Bug 27820: add all missing use in misc/cronjobs/plugins_nightly.pl
    
    Koha::Plugins and C4::Context where missing.
    Try::Tiny was missing for try/catch.
    
    Test plan :
    1) Use a plugin using hook 'cronjob_nightly'
    2) Run script : misc/cronjobs/plugins_nightly.pl
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3267648dedd04085f0adaa0bd70979cd839e7344
Author: Samir Shah <samir@regulusweb.com>
Date:   Mon Mar 1 10:49:03 2021 +0300

    Bug 27820: fix missing import in plugins_nightly.pl
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29de576ae94f947e47d054dca3e615473045061a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 11 13:55:00 2021 +0000

    Bug 26273: (QA follow-up) Use escape_str/price for escaping
    
    This patch uses the global escape_str/escape_price functions in the register
    page.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ff61e7206169cb814f464a2a575c755c09e5311
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 11 10:19:57 2021 +0000

    Bug 26273: (follow-up) Add 'Cashier' to the cashups table
    
    This patch adds the 'Cashier' field as discussed on the bug report.
    
    Test plan
    1/ Apply patch and reload the register page to refresh the table
    2/ Note that a 'Cashier' field now appears in the table
    3/ Sorting and searching on 'Cashier' should work as expected
    4/ Default sorting should remain as 'Date' order.
    5/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26273: (QA follow-up) Check for null firstname
    
    This patch adds a test for firstname being defined before constructing
    fullname from it.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45baee1aaede0c83e7afa26b596b7748db1a97fd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 10 17:31:56 2021 +0000

    Bug 26273: (follow-up) Format dates and money correctly.
    
    This patch adds the missing formatting for the Datetime and Amount
    fields.
    
    Test plan
    1/ Apply patch and reload register page to re-display the cashups table
    2/ Note that the 'Date' field now displays a nicely formatted date
    without an offset.
    3/ Note that the 'Amount' field now displays the number according to
    your money formatting preferences (with 2 decimal places in most cases)
    4/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26419d5560c52d8137f5e060b250eb54ee635426
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 1 14:50:02 2021 +0000

    Bug 26273: Add historic cashups table to register page
    
    This patch adds a historic cashups table to the bottom of the register
    transaction details page.  It will only display if one or more cashups
    have taken place and contains links to allow display of the summary
    detail modal for each cashup.
    
    Test plan
    1/ Enable UseCashRegisters
    2/ Undertake a few transactions and cashups
    3/ View the 'Register details' page
    4/ Note the appearance of a 'Cashup history' section at the bottom of
    the page
    5/ Note that 'Summary' button displays the relevant modal
    6/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Daniel Jones <daniel.jones@cheshiresharedservices.gov.uk>
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26273: (QA follow-up) Remove unrequired table_controls div
    
    Looks like a copy/paste issue.. I don't believe we need this div at all
    for the table to function as expected and adding it just creates uneeded
    whitespace.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26273: (QA follow-up) Add horizontal rule to distinguish tables
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68c37861c0f4ee6b3b985ee69f87e58b454fa6df
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 11 14:22:54 2021 +0000

    Bug 27930: Move _escape_* from acqui/parcel.tt to js/staff-global.js
    
    This patch moves the _escape_str and _escape_price functions into the
    staff-global.js include
    
    Test plan
    1/ The acquisitions parcel page should look the same before and after
    the patch.
    2/ Signoff
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c65a3cdfeb513c3ca68a0e29307d18506cabd60
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 5 12:33:41 2021 +0000

    Bug 22569: (QA follow-up) Use itemtype description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc452492916e9f2cd22cbaf9024aa9ea5f6f2612
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 5 12:29:42 2021 +0000

    Bug 22569: (QA follow-up) Make 'reason' translatable
    
    Add a transfer_reasons include file for easy translation of the transer
    reason codes.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 320f82857c521b2fc194ef14fb55918c5039c44a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:37:49 2020 +0000

    Bug 22569: Add Unit Tests
    
    Test plan:
    1/ Run the updated unit tests
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8df1af9e51e02785e5adeceb0010adbb707a246
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:37:44 2020 +0000

    Bug 22569: Add a 'Transfers to send' report
    
    This patch adds a 'Transfers to send' report to the circulation page
    which displays items which have been triggered for transfer but not
    marked as sent.
    
    Test plan
    1) Setup a rotation plan and add some items to it as per the
       manual
    2) Run the stockrotation cronjob with the --execute flag
    3) Check that the expected items appear in the new 'Transfers to send'
       page.
    4) Confirm that items marked with 'StockRotationAdvance' provide the
       option to mark the item as 'In demand' (Which will cancel the
       transfer and mark the item as in demand such that it will wait at the
       current branch for an additional stage period before being
       automatically picke for transfer again)
    5) Setup a rotating collection
    6) Trigger a collection transfer for the above collection
    7) Check that the expected items appear in the new 'Transfers to send'
       page'.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    
    Bug 22569: (QA follow-up) Rename script to snake_case
    
    As requested, we simply rename the script, and references to it, to use
    snake_case to make it clearer.
    
    Bug 22569: (QA follow-up) Rename branchesloop to libraries
    
    Bug 22569: (QA follow-up) Fix indentation in template
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9140ea69150520f7a9b4fcc453020af91bd6ed38
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 12 07:07:07 2012 -0400

    Bug 8426: Diacritics not being mapped for searching
    
    Add mappings for ︡a to a, and for t︠ to t.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25f391b00df34f452e341039abf448c780df1d7d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 12:22:27 2021 +0100

    Bug 27813: Restore default order on suggestion list view
    
    Prior to 20.05, suggestions on /cgi-bin/koha/suggestion/suggestion.pl sorted by
    suggesteddate by default. On 20.05 and later, they're sorting by title instead.
    We should go back to the previous behavior.
    
    Test plan:
    Create some suggestions
    Edit the suggestions.suggesteddate in the DB
    List the suggestions and confirm that there are sorted by oldest first
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0381d9e52407fa7172ac18a85e0db8e62edc6c90
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 1 12:24:41 2021 +0000

    Bug 27815: "Remove" in point of sale untranslatable
    
    This patch modifies the Point of Sale template so that the "Remove"
    button can be translated. The string in the JavaScript block wasn't
    wrapped in the correct function.
    
    To test, apply the patch and test that the correct strings are
    translatable. In this example I'm testing fr-FR:
    
    - Update a translation:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for the strings pulled from
      the template: e.g. misc/translator/po/fr-FR-staff-prog.po
    - Locate strings pulled from pos/pay.tt for translation to confirm the
      update, e.g.:
    
      #: koha-tmpl/intranet-tmpl/prog/en/modules/pos/pay.tt:189
      #, c-format
      msgid "Remove"
      msgstr "Enlever"
    
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - In the staff client, go to Point of Sale.
    - Switch to the French translation and click the "Ajouter" button next
      to one of the items for purchase.
    - In the "This sale" table, the item you added should have a
      corresponding "Enlever" button.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e81fff97c2ec3332f6b3d41800895e4613db21da
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 5 07:57:42 2021 +0000

    Bug 27268: (QA follow-up) Add Koha::Biblios to basket scripts
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90491bb85aa86fb452515e799d10c9597356965f
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Dec 18 14:55:48 2020 +1300

    Bug 27268: Move GetMarcNotes to Koha namespace
    
    This patch moves C4::Biblio::GetMarcNotes to
    Koha::Biblio->get_marc_notes. This is so get_marc_notes can be
    used in templates and notices.
    
    To test:
    1. Find a record that has a note (3xx for UNIMARC, 5xx for MARC21).
    Confirm the notes still show as normal under the Descriptions tab.
    2. Add the record to the cart.
    3. View your cart and click 'more details'. Confirm notes show as
    normal.
    4. Log in to the OPAC. Find the record and add it to the cart
    5. View the cart and click 'more details'. Confirm notes show as
    normal.
    6. View the record detail page and confirm the notes show as normal
    under the Title Notes tab.
    7. Confirm tests pass:
    - t/Biblio.t
    - t/db_dependent/Koha/Biblio.t
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Württemberg (BSZ)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed582b4558304142cff802bb3e79662a9569ad2d
Author: David Nind <david@davidnind.com>
Date:   Sat Feb 20 23:06:01 2021 +0000

    Bug 27405: (follow up) Updates to accommodate currency entry
    
    This patch makes two modifications to allow the entry of
    currency strings (for example, 1.25) so that it is consistent with other
    payment entry forms.
    
    - Inputmode changed to "decimal"
    - Regex pattern changed to "^\d+(\.\d{2})?$" as found in
      admin/debit_types.tt
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7de833b5277b4db4433f0ad879bbb31fc4591283
Author: Catherine Ma <catherinem2003@gmail.com>
Date:   Wed Jan 20 00:56:59 2021 +0000

    Bug 27405: Update koha-tmpl/intranet-tmpl/prog/en/modules/pos/register.tt for ACC2
    
    This replaces the number type input in
    intranet-tmpl/prog/en/modules/pos/register.tt so that it is
    consistent with ACC2 guidelines.
    
    Test plan:
    1. Enable the EnablePointOfSale (set to Enable) and UseCashRegisters
       (set to Use) system preferences.
    2. Add a new cash register for a library (Home > Point of sale > Create
       a new cash register)
    3. Add some sample items for sale (Home > Point of sale > Configure
       items for purchase)
    4. Add some sales (Home > Point of sale > Add some items, enter a
       payment and sleect Confirm)
    5. Issue a refund (Home > Point of sale > Register details > select
       Issue refund for an item)
    6. Try to enter text, numbers with several decimal places, and , or
       multiple .
    7. Apply the patch.
    8. Repeat steps 4-6 - should continue to function as expected, with
       appropriate warning messages for invalid entries.
    9. Search koha-tmpl/intranet-tmpl/prog/en/modules/pos/register.tt for
       input type="number" - there should be no occurences.
    10. Sign off!
    
    Sponsored by Catalyst IT
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit baa2260503356af15ad4df835a24abf084ec41a2
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Dec 17 04:05:39 2020 +0000

    Bug 26199: Include LDR for match check/match point
    
    This patch adds the ability to specify the LDR instead of a numeric tag
    when defining match checks in record matching rules. This is particularly
    useful for checking LDR6 "Type of record" when importing records.
    
    Test plan:
    0. prove t/Matcher.t
    
    1. Go to http://localhost:8081/cgi-bin/koha/catalogue/detail.pl?biblionumber=1
    2. Click "Save" and choose "MARCXML"
    3. Copy bib-1.marcxml to bib-1-mod.marcxml
    4. Change "01344cam a22003014i 4500" to "01344cmm a22003014i 4500"
    5. Go to http://localhost:8081/cgi-bin/koha/admin/matching-rules.pl?op=edit_matching_rule&matcher_id=3
    6. Click "Add match check"
    7. Fill out the match checks:
    Source:
    Tag: LDR
    Offset: 6
    Length: 1
    Target:
    Tag: LDR
    Offset: 6
    Length: 1
    
    8. Go to http://localhost:8081/cgi-bin/koha/tools/stage-marc-import.pl
    9. Choose "bib-1-mod.marcxml" and click "Upload file"
    10. Choose "KohaBiblio (999$c)" for "Record matching rule"
    11. Click "Stage for import"
    12. Click "Manage staged records" on resulting page
    13. Note the "Match type" says "No match"
    
    14. Go to http://localhost:8081/cgi-bin/koha/tools/stage-marc-import.pl
    15. Choose "bib-1.marcxml" and click "Upload file"
    16. Choose "KohaBiblio (999$c)" for "Record matching rule"
    17. Click "Stage for import"
    18. Click "Manage staged records" on resulting page
    19. Note the Match type says "Match found"
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c14cf08ddf9ee4194812ee00be33a4322f7366a2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 25 15:15:00 2021 +0100

    Bug 27545: Keep the location if passed
    
    Change in behaviour here, but expect. We must keep the location value if
    passed to store.
    Same for the permanent_location
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d776fa7b271644790219f56eb1f53e4be1ad5a12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 25 14:04:31 2021 +0100

    Bug 27545: Use NewItemsDefaultLocation from places where an item is created
    
    The syspref NewItemsDefaultLocation is used to set a default value for item's location.
    
    But it seems that there are some weirdness in the behaviour:
    1. It's only used from additem. It seems that it should be used from acq and serial modules as well. And maybe for the items import too.
    2. It set the location even if another one has been picked from the UI
    => We UI must preselect the syspref's value, but the controller must pick what has been selected on the UI
    
    This patch is adding the default to the UI and extend the use of the
    pref to other areas.
    
    Test plan:
    Set a value to NewItemsDefaultLocation
    Catalogue a new item and confirm that the syspref's value is picked to
    selected the default value on the add item form
    Same behaviour should apply to the acquisition and serial modules
    When importing items, the default location must be used if the imported
    items did not have a location defined.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8efc21385a176c428151c7a2b5e0fee04e576041
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 9 16:18:19 2021 +0000

    Bug 27652: DBRev 20.12.00.023
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b25e526bfeee0b4537e132caca32a10d2ade4e7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 10 18:58:57 2021 +0000

    Bug 27652: (follow-up) Correct typo in database update
    
    This patch adds a missing "SET" in the database update. Before:
    
       UPDATE systempreferences
       value=REPLACE(value, '|', ',')
    
    Corrected:
    
       UPDATE systempreferences
       SET value=REPLACE(value, '|', ',')
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 010181a6a007339edc4ed63d50cc8ba33fe0f5ab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 9 17:19:59 2021 +0100

    Bug 27652: Display patron's categories for sysprefs expecting them
    
    This patch adds a new type of system preference entry option: patron
    category. A preference with this type will show either a <select> with
    patron categories to choose from or a multiple-select menu for choosing
    one or more.
    
    This prevents possible errors from incorrect category codes being
    entered manually.
    
    To test, apply the patch and run the database update.
    
    - Go to Administration -> System preferences.
    - Test each of the updated preferences to confirm that the available
      options are correct and that your selections are correctly saved.
    
      - Single category selections, PatronSelfRegistrationDefaultCategory
        and GoogleOpenIDConnectDefaultCategory. With each of these you
        should see a dropdown where you can select of all the existing
        patron categories.
    
      - Multiple selections, OPACHoldsIfAvailableAtPickup and
        BatchCheckouts: These preferences should have an option for
        selecting one or more system preferences at once.
    
    - Test the pages affected by the updated system preferences:
    
    - With BatchCheckouts enabled, confirm that the batch checkout page is
      correctly limited by patron category.
    
    - Set the OPACHoldsIfAvailableAtPickup preference to "Don't allow" and
      select at least one patron category in the
      OPACHoldsIfAvailableAtPickupExceptions preference.
    - Log in to the OPAC as a patron whose category was not selected in
      the OPACHoldsIfAvailableAtPickupExceptions preference.
    - Try to place a hold on an item which is available at a library.
    - When confirming the hold, the libraries where the item is available
      should be disabled in the "Pick up location" dropdown.
    - Repeat the process as a patron whose category was selected in
      OPACHoldsIfAvailableAtPickupExceptions. There should be no disabled
      pickup locations.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3432b3bd5e9b5a5384bc3243e3d4b1629bd76496
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 23 17:25:47 2021 +0000

    Bug 27766: Hide expired news items by default
    
    This patch modifies the news page in the staff interface so that expired
    news items are hidden by default. A checkbox in the sidebar can be
    checked to show the hidden rows.
    
    To test you should have multiple news items, some expired and some
    unexpired.
    
     - Apply the patch and go to Tools -> News
     - The table of news items as it initially appears should not include
       any expired news items.
     - In the sidebar, check the "Show expired" checkbox.
     - The expired news items should now appear.
    
    Signed-off-by: Barbara Johnson  <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c473a703329f9ff9edaa0b5788eb38be4bf2f897
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 22 16:49:12 2021 +0000

    Bug 27751: Phase out jquery.cookie.js: Batch item modifications
    
    To test, apply the patch and go to Tools -> Batch item modification.
    
    - Submit a batch of barcodes for modification.
    - Uncheck some checkboxes to hide columns in the table showing your
      submitted items.
    - Return to the batch item modification page and submit your batch
      again.
    - The columns you selected should still be hidden.
    - Submit a batch of items for deletion.
    - The same columns should be hidden here too.
    - Also test that the "Show all columns" and "Hide all columns" buttons
      work and that the changes persist across batches.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 745ba3d9d341e3fa7ed56c8bd4860bfdfc204b9f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 12 19:34:05 2021 +0000

    Bug 27699: Add register information to responsive staff interface header menu
    
    This patch adds register information to the version of the header menu
    shown when the browser width is narrower.
    
    To test, apply the patch and enable the UseCashRegisters system
    preference.
    
    - If necessary, create at least one cash register for your library under
      Administration -> Cash registers.
    - From any page in the staff interface you should see a menu in the
      header showing your username and logged-in branch.
    - Expand the menu and choose "Set library, desk and register."
    - Select a cash register and save.
    - The cash register information should now appear in the header menu.
    - Narrow the width of the browser until the menu collapses and shows
      only a user icon.
    - When you expand this version of the menu you should see the
      currently-suggested register.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76f929f7600417cd15d046a7c6e0c6edf74c96e9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 4 18:39:15 2021 +0000

    Bug 27682: (follow-up) Make sure table is drawn with correct width
    
    The DataTables plugin calculates the width of the fixed header based on
    the initial width of the corresponding table. Since these tables are
    inside jQueryUI tabs, the width changes when the tabs are initialized
    and jQueryUI adds its classes to the table's container.
    
    This patch "manually" adds the relevant classes to the markup so that
    the table's container is drawn with the right padding from the start.
    
    Also fixed: Don't try to destroy "oldTableId" if the tableInit function
    didn't pass an oldtabid.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9b4abac0fef33e94469d47915a30db86d482b6a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 12 12:57:56 2021 +0000

    Bug 27682: Add a floating table header for Search engine configuration
    
    This patch adds DataTables options to the tables on the search engine
    configuration pages. The table on the "Search fields" tab will be
    sortable, all tables will be searchable, and all tables will have
    floating headers.
    
    To test you should have the SearchEngine preference set to
    "Elasticsearch."
    
    - Apply the patch and go to Administration -> Search engine
      configuration (Elasticsearch)
    - Test the tables under each tab, "Search fields," "Bibliographic
      records," and "Authorities," the table has a search filter and the
      header row "sticks" to the top of the browser window as you scroll
      down.
    - The "Search fields" table should be sortable, but the other two should
      not--they have drag-and-drop row reordering.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4896a30f0720a9e6e496eb48ade89613689e6e47
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 11 13:08:35 2021 +0000

    Bug 27681: Style OPAC self-registration CAPTCHA as uppercase
    
    This patch adds an inline "text-transform:uppercase" style attribute to
    the OPAC self-registration CAPTCHA field so that the user doesn't have
    to match the case of the CAPTCHA they're shown.
    
    To test, apply the patch and start the process of self-registration in
    the OPAC.
    
    - At the end of the form, under verification, confirm that any text you
      type in the verification field is uppercase by default.
    - Confirm that the CAPTCHA is accepted when you submit the form.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d6298567c732122d9a82dde4f5c239f08c7578a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 19 12:40:01 2021 +0000

    Bug 27728: Add a search box on OPAC Search history
    
    This patch makes changes to the OPAC search history DataTables
    configuration so that table controls appear, including search, copy,
    CSV, and print.
    
    The patch also makes some improvements to the checkbox interactions: The
    date column is now a label for the checkbox, and the "Remove selected
    searched" button is now disabled until a checkbox has been checked.
    
    To test, apply the patch and log into the OPAC as a user with a search
    history. If possible, past and current searches of both bibliographic
    and authority records.
    
    - On the search history page, confirm that the DataTables controls
      appear above each table: "Current" and "Previous" under both the
      "Catalog" and "Authority" tabs.
    - All controls should work correctly and affect only the corresponding
      table: Search, Clear filter, Copy, CSV, and Print.
    - Confirm that clicking a date in the date column checks the correct
      checkbox.
    - Confirm that toggling a checkbox correctly enables and disables the
      "Remove selected searches" button as well as the "Select searches to:"
      menu at the top of the table.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cef2ecdfeb2a0c0ef6233279fae16b5264468c4d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 4 11:59:37 2021 +0000

    Bug 27855: (QA follow-up) Rename extended_attribute to patron_extended_attribute
    
    This path renames the extended_attribute definition to
    patron_extended_attribute to clarify that these attributes are always
    attached to a patron and not a more generic class of attributes.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18ee07409a9a651700484721e017e5ca5f8103da
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 06:45:47 2021 -0300

    Bug 27855: Add 'extended_attributes' embedding to the spec
    
    This patch just adds:
    - The optional 'extended_attribute' attribute to the patron object
      OpenAPI definition. It consists of an array of extended_attribute
      objects.
    - Add the x-koha-embed: [ 'extended_attributes' ] definition on the GET
      routes for patrons, allowing immedite availability of the
      'extended_attributes' embedding feature.
    
    To test:
    1. Apply this patchset
    2. Restart Plack
    3. Have some known patron_id/borrowernumber that has some extended
       attributes ('Patron attributes' on the UI).
    4. Enable Basic authentication
    5. Assuming the known patron_id is 1, point your favourite REST tool to http://kohadev-intra.myDNSname.org:8081/api/v1/patrons/1
       e.g.: if your user/pass is koha/koha
       curl --location --request GET 'http://kohadev-intra.myDNSname.org:8081/api/v1/patrons/1' \
            --header 'Content-Type: application/json' \
            --header 'Authorization: Basic a29oYTprb2hh'
    => SUCCESS: You get the patron object correctly, no extended_attributes
    6. Repeat 5, adding the x-koha-embed header like this:
       curl --location --request GET 'http://kohadev-intra.myDNSname.org:8081/api/v1/patrons/1' \
            --header 'Content-Type: application/json' \
            --header 'x-koha-embed: extended_attributes' \
            --header 'Authorization: Basic a29oYTprb2hh'
    => SUCCESS: You get the patron, with the extended attributes inside!
    7. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa7a80a475792294da4116fc147c8a1201641ccb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 4 06:43:01 2021 -0300

    Bug 27855: Make GET /patrons/:patron_id use objects.find
    
    This patch makes the route for fetching a patron use the objects.find
    helper instead of a plain Koha::Patrons->find. This gives the controller
    embedding superpowers.
    
    To test, we just need to check nothing broke:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f790ca45ab97dfdb630900603d4d7bf4c822c92d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 3 16:51:41 2021 -0300

    Bug 27855: Implement Koha::Patron::Attribute->to_api_mapping
    
    This patch introduces a mapping to render extended attributes on the
    API. As they have an ID, and they will generally be used on the
    /patrons umbrella, I removed the borrowernumber on the mapping.
    
    Another option would be to add the field, but make it optional. It
    really feels redundant, so I take it out for now.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d77a1226df936a62782b9a0ebf6349c9f02b6636
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 3 16:50:39 2021 -0300

    Bug 27855: Add extended_attribute OpenAPI spec
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46a024a6e09a5ff7ace3be5ac5f171ec8d53a427
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 3 16:37:09 2021 -0300

    Bug 27854: Clean GET /patrons controller
    
    The controller method was written a lot of time before the enhancements
    we added to the objects.search helper, and it is now much easier to
    handle the 'restricted' param use case.
    
    No need to do it like that anymore.
    
    This patch fetches the 'restricted' param from the query parameters and
    cleans it from the validated data, so we can just pass the resultset to
    $c->objects->search as in all other controllers.
    
    And we had tests for the expected behavior, so testing this is as easy
    as:
    
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass! Of course!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a65fe61f482a08932a5d210df1ec0c59dd7771e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 16:39:40 2021 -0300

    Bug 26636: (QA follow-up) Handle no results correctly
    
    Sponsored-by: Virginia Polytechnic Institute and State University
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 653fe3962597c7cf0de1a9dc2e2eb4a814a1d43e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 16:28:07 2021 -0300

    Bug 26636: Regression tests for undef case
    
    This patch adds tests for the case in which there's no object identified
    by the supplied $id. It should return undef.
    
    Sponsored-by: Virginia Polytechnic Institute and State University
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22940955745fc91d978a28865e62da04b08be432
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 16:22:07 2021 -0300

    Bug 26636: (QA follow-up) Add POD
    
    Sponsored-by: Virginia Polytechnic Institute and State University
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 329d09abb6cc705838b724742c89fd95b9c89b79
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Oct 9 10:20:33 2020 -0300

    Bug 26636: Add objects.find helper
    
    This patch adds the objects.find helper. Much like objects.search, it
    returns the to_api method with embedded.
    
    Sponsored-by: Virginia Polytechnic Institute and State University
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6620c5638120ff52d82e2aa9c64fe46184c69c5f
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Oct 9 11:53:43 2020 -0300

    Bug 26636: Add tests
    
    This patch adds tests for the new objects.find helper.
    
    Sponsored-by: Virginia Polytechnic Institute and State University
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac7d1124ab0db1a532496b2b3f5c0c75a781a20f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 1 15:41:21 2021 -0300

    Bug 24359: (QA follow-up) Fix tests
    
    This patch fixes a rebase issue, and also makes sure the tests do not
    rely on any prior data. The query on tmp_holdsqueue is done against the
    actual reserve_id so no need to delete all the data from the
    tmp_holdsqueue and hold_fill_targets table.
    
    I also noticed the previous subtest wasn't run inside a transaction even
    if the code was designed to not depend on prior data as well.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/HoldsQueue.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 445ca21ff06ca2e4f3a59d0a70c8bce6533168db
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Oct 28 10:48:18 2020 -0300

    Bug 24359: Remove hold from holds queue when captured
    
    This patch removes a hold from holds queue when captured by check in.
    
    To test:
    
    1. check out an item from a book with multiple items for patron_1
    2. place a biblio level hold for patron_2
    3. perl misc/cronjobs/holds/build_holds_queue.pl
    CHECK => holds queue shows the placed hold
    4. check in the item from step 1 and confirm hold for patron_2
    SUCCESS => hold for patron_2 is no longer in holds queue
    5. prove t/db_dependent/HoldsQueue.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cdc668764cefde4924291b8d51bd97ec8a4157d1
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Oct 28 10:48:09 2020 -0300

    Bug 24359: Add test
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fce91d2bb0cca48ec69e3c91b4567e370ef17091
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 5 15:17:56 2021 -0300

    Bug 27863: Use the /libraries route when AllowHoldsPolicyOverride is set
    
    This patch makes the dropdown for changing the pickup location for
    existing holds use the GET /libraries route instead of GET
    /holds/:hold_id/pikcup_locations if the configuration allows the
    override.
    
    Terminology:
    - Pickup location, means a library that is marked as valid pickup
      location on its configuration.
    
    To test:
    1. Have the circ rules set so 'Hold pickup library match' is set to
       'Item's home library' or 'Any'. The goal is to be able to
       differentiate when all libraries are returned, from the case only
       'valid pickup locations' are returned. The easiest one is 'Item's
       home library'.
    2. Set AllowHoldsPolicyOverride
    3. Pick a patron from a library that is not a valid pickup location and
       an item that belongs to a library that doesn't match any of the valid
       ones.
    => SUCCESS: Notice Koha allows you to choose any library (because of the
            syspref)
    4. Place the hold.
    5. Now check on the holds list for the bib, if you can use the dropdown
       to change the pickup location for the hold
    => SUCCESS: You can, sort of
    => FAIL: It doesn't show/search all pickup locations. It only shows the
            valid ones, even though we should be able to override it.
    6. Apply this patch
    7. Restart all just in case, and reload the holds page for the bib
    8. Repeat 5
    => SUCCESS: You are presented all pickup locations!
    9. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f17d3dd62cfcbe7de3b74573b48e09e42e6b0eab
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Fri Feb 26 13:39:37 2021 -0800

    Bug 26964: Newly created macros should be selected in the Advanced editor
    
    The problem is that the newly created macro isn't selected, because the
    return values from the call to create it are accidentally thrown away. There
    isn't actually any option to save, just a timeout that automatically saves,
    but you can tell you are in this broken state because the Delete macro
    button is disabled.
    
    Test plan:
    
    1. Prior to applying the patch, Administration - set the preference
       EnableAdvancedCatalogingEditor to Enable
    2. Cataloging - Advanced editor - Macros... - New macro...
    3. Give it a name, click OK, notice that the Delete macro button is disabled
    4. Apply patch, shift+reload
    5. Macros... - New macro...
    6. Give it a name, click OK, notice that the Delete macro button is enabled
    7. Type something in the editor, delete 999 will do nicely, wait half a
       second to see Saved appear at the far right, close the macro popup
    8. Macros..., click the name of your macro, verify it really was saved
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dcceb66fabc7569040c61fc7838d7d5e888e596
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Mar 5 17:26:02 2021 +0200

    Bug 27058: (follow-up) Clarify notforloan checks with a comment
    
    In IsAvailableForItemLevelRequest the check is for holdability and in
    ItemsAnyAvailableAndNotRestricted the check is for
    checkoutability. These comments should make it more clear because the
    notforloan value is used for these two different purposes and is a bit
    confusing (we might want to add a new field "notforhold" in future to
    make the code self documenting)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c68fa762efe68e7d708c2f41aff7bcb848d69c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 14:49:22 2021 +0100

    Bug 27058: Add test for IsAvailableForItemLevelRequest and notforloan
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da81064b8b8b8efc6950084231b1943f25f7820d
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Feb 19 09:49:51 2021 +0200

    Bug 27058: Remove confusing and unnecessary $biblionumber1 variable
    
    The code is much more understandable now because with $biblio2 and
    $biblionumber1 variables use to point to the same biblio one might
    have thought $biblionumber1 points to $biblio1 which in this case is
    not true. Let's just drop the extra variable because the object
    notation of accessing is just as simple.
    
    To test:
     1) prove t/db_dependent/Holds/DisallowHoldIfItemsAvailable.t => passes
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18128cc810a00a46f8d4af19bebaa4c562761456
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Nov 19 16:55:18 2020 +0200

    Bug 27058: Make checkout availability use all notforloan reasons
    
    The ItemsAnyAvailableAndNotRestricted function is checking whether an
    item can be checked out and it incorrectly only checks the positive
    notforloan values when there can be also negative notforloan
    values. If notforloan value is not 0 then it means the item cannot be
    checked out. In the case of ordered items the value is negative (-1)
    and thus before this change the checkout availability was reported
    incorrectly.
    
    To test:
     1) Run prove t/db_dependent/Holds/DisallowHoldIfItemsAvailable.t
        Notice it fails
     2) Apply this patch
     3) Run prove t/db_dependent/Holds/DisallowHoldIfItemsAvailable.t
        Notice it passes now.
    
    To test via Koha sandbox (Alternatively):
     1) Create circ rule with If all unavailable
     2) Create new biblio
     3) Order a new item to the biblio via acquisitions and set the not
        for loan value to Ordered / -1
     4) Notice you cannot place a hold to the biblio
     5) Apply patch
     6) Notice you can now place a hold to the biblio
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c0acc36ba1b075add4c930c7fd875cf75b8a476
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Nov 19 17:13:25 2020 +0200

    Bug 27058: Add test to show ordered items cannot be checked out
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca4ef19a2bb400d4348ee84eaddf6af0c429d1c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 10 07:26:15 2021 +0100

    Bug 27650: Fix variable passed to the template in opac-main
    
    $template->param(
    +    koha_news           => @all_koha_news,
    
    We must not pass an array, the number of elements of the hash passed to the template may be inconsistent.
    
    It's working because of an error earlier in the script:
    +    @all_koha_news   = &GetNewsToDisplay($news_lang,$homebranch);
    
    GetNewsToDisplay returns an arrayref
    
    Test plan:
    Define at least 2 news to display on the OPAC main page
    Hit opac-main.pl
    => All news are displayed
    Click one
    => You see the single news you selected
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5a44214eb9ceb4646f23dd6962bcdc85e58d5b8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Mar 6 16:02:34 2021 +0000

    Bug 27886: Move non-rancor code into correct section
    
    The template was including code that was not compatible with Rancor, moving
    the end of the conditional seems to fix the error
    
    To test:
    1 - Open a record in the advanced catalog editor
    2 - Create or edit a 100 field with some content, I used 'bruce'
    3 - Press Ctrl+shift+l to launch authority search
    4 - Perform a search and select an authority
    5 - Note the field copies but the pop-ups don't close
    6 - Apply patch
    7 - Reload the page
    8 - Repeat 1-4
    9 - The field copies and the windows close
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f96b6767a1be022a4e38a856491b2b1eae782fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 11:45:12 2021 +0100

    Bug 27851: Use filter_by_todays_checkins in members/readingrec.pl
    
    Test plan:
    Do some checkouts
    Checkin with different return dates (several today however)
    Check the circulation history and confirm that the checkout list is correct
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e54fa9a076a4d9f2d908e14f8e9010e922880c83
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 11:44:42 2021 +0100

    Bug 27851: Use filter_by_todays_checkins in printslip.pl
    
    Test plan:
    No regression from bug 12224 test plan
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6e65d4f99b23e692989bcd10be4a59b0832d46c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 11:43:46 2021 +0100

    Bug 27851: Add Koha::Old::Checkouts->filter_by_todays_checkins
    
    The logic for this code is handled at two different places (and in 2
    different ways).
    Better to centralize and provide tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6161fc11864940af75b5fb99d83cf34d49a09c17
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 11:43:21 2021 +0100

    Bug 27851: Add tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e66d32be4d0d6e3a1afffb4ab788cc4466bc4d2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 12:53:34 2021 +0000

    Bug 12224: DBRev 20.12.00.022
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05b55cc49f6a2c2037a1f06bffbbb558ecd8e55d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Mar 5 12:29:41 2021 +0100

    Bug 12224: (follow-up) Format today with KohaDates
    
    Updates the slip templates to use [% today | $KohaDates %].
    Adding an explicit USE statement is not necessary in this case.
    
    To test:
    - When testing the feature according to the test plan, make sure
      that the date for today shows up formatted to the DateFormat
      system preference.
    
    Note: As we are printing today's checkins, I have intentionally left
    oft the time. But it could be easily added if a library wanted it.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe2bbc7cd886008dbbfdb2cb847c0f4067296c3b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 3 16:44:52 2021 +0100

    Bug 12224: Some code improvements
    
    * Use Koha::Patrons->old_checkouts
    * perltidy
    * Make sure $today_start and $today_end will always be on the same day
    (we never know!)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a68ab5178e3808461c2c8e0608825f0286ba3e1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 24 10:21:36 2021 +0000

    Bug 12224: (QA follow-up) Ensure patron language is respected
    
    Things have moved on a bit since this code was first written, we now
    expect a 'lang' parameter passed into GetPrepparedLetter to allow for
    translated notices.
    
    Simple fix, so a quick QA follow-up will suffice :)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7784174e3bf788574cd3adac5339e96d9ded38e1
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Feb 1 11:11:51 2021 +1300

    Bug 12224: (follow-up) Loop old_issues with itemnumber
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28b90b684ee6254b81feea2fbb317b637dc1fa4f
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Dec 3 11:04:23 2020 +1300

    Bug 12224: (follow-up) Switching to TT notice
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bf59acce668988080c7d9f23088ca97fc77a4cb
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 22 09:37:34 2020 +1200

    Bug 12224: (follow-up) Access old_issues table when editing notice
    
    This QA follow-up allows access to the old_issues table when editing the
    notice in Tools.
    
    Signed-off-by: Alexandra Speer <alexandra.speer@bsz-bw.de>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a343bb5d81535b55e22ebe387047ace96156de1e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 18 13:53:29 2020 +0000

    Bug 12224: (follow-up) Move button to patron column in checkins table
    
    This patch moves the "Print checkin slip" out of its own column and into
    the colum containing patron information. I think this makes more sense
    because the slip is specific to a patron, not the individual item which
    has been checked in.
    
    Also changed: printcheckinslip function should be triggered via a class,
    not a non-unique ID. The function should handle the click using
    "preventDefault" rather than "return false."
    
    To test, apply the patch and check in some items checked out to various
    patrons.
    
    - In the table of checked-in items, confirm that the "Print checkin
      slip" appears correctly in the column of patron information.
    - Confirm that the button works correctly to print the correct slip for
      the associated patron.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Alexandra Speer <alexandra.speer@bsz-bw.de>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29d173a6fd150a975afff4f87d9d22cd6a4a15e0
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Sep 18 11:58:05 2020 +1200

    Bug 12224: Print a slip of borrower's checkins for today
    
    To test:
    
    1) Apply patch and run installer
    2) Check out two items (or more) to a borrower
    3) Check in two items (or more) for this borrower (you should end up on
        circ/returns.pl)
    4) Notice the checked-in items table has started building. There should
    be a new column with the button 'Print checkin slip' in each row.
    5) Click the button and confirm the checkin slip opens for printing in a
    new window.
    6) Go to the patron's account
    7) Click the Print dropdown. Confirm there is a 'Print checkin slip'
    option. Click this and confirm the checkin slip opens for printing in a
    new window.
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Württemberg (BSZ)
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Alexandra Speer <alexandra.speer@bsz-bw.de>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebf123bf139b28d274ade70016c1af0e3aeffb1b
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Wed Mar 3 11:32:48 2021 +0200

    Bug 27745: prevent warning for uninitialized value as a hash key
    
    When you edit and save items with an empty "c - Shelving location"
    field, it gets stored into the database as "NULL",
    which is allowed in the database, and the field is not "required",
    so this seems expected.
    
    But when the search page is rendered, it gets value by location key
    ($shelflocations->{ $item->{location} }) which gives undef warning.
    
    Solved by checking if $item->{location} is perl true.
    
    To reproduce:
        1) Edit the book or create new one with an empty shelving location.
        2) Use the search feature to have that book in the searched list.
        3) Check plack-intranet-error.log to find "Use of uninitialized
    value in hash element" error.
        4) Apply the patch.
        5) Repeat the search and check the logs again to ensure that error
    didn't appear again.
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42a32bc1727dc4723e07a83cc53e5951a09a20b2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 25 14:20:14 2021 +0000

    Bug 27795: Misalignment of TOTAL value in lateorders page
    
    This patch corrects the colspan in the footer of the late orders page.
    
    It also adds a quantity total cell to the footer and changes the
    container of the buttons at the bottom of the page from a <p> tag to
    the standard <fieldset class="action">.
    
    To test, apply the patch and go to Acquisitions -> Late orders.
    
    In the footer of the late orders page, there should be a total under the
    "Quantity" column. The total cost number should be correctly aligned
    under the "total cost" header cell.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4add0cbc2d6c3aec6e71d6148ed86cc2e811d1ef
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 22 15:44:54 2021 +0000

    Bug 27752: Correct eslint errors in batchMod.js
    
    This patch makes minor changes to batchMod.js in order to address errors
    raised by ESLint. These changes include whitespace changes, so diff
    accordingly.
    
    To test, apply the patch and go to Tools -> Batch item modification.
    
    - Submit a batch of barcodes for modification.
    - Uncheck some checkboxes to hide columns in the table showing your
      submitted items.
    - Return to the batch item modification page and submit your batch
      again.
    - The columns you selected should still be hidden.
    - Submit a batch of items for deletion.
    - The same columns should be hidden here too.
    
    To confirm that ESLint is happy with the changes you could open the file
    for editing using an editor with ESLint integration, or install ESLint
    on the command line:
    https://eslint.org/docs/user-guide/command-line-interface
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e91308d7291ed5e3b83f7d7d4b935c3c61c2c522
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 21 14:40:52 2021 +0000

    Bug 27410: (follow-up) Updates to accommodate currency entry
    
    This patch makes two modifications in order to allow the entry of
    currency strings (e.g. 1.25).
    
     - Inputmode changed to "decimal"
     - Regex pattern changed to "^\d+(\.\d{2})?$" as found in
       admin/debit_types.tt
    
    To test, apply the patch and test entry of various strings in the manual
    invoice "amount" field. Confirm that the field only accepts digits or
    digits followed by a decimal and two digits.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1c89f5c50c0ee537df8ba5512acadfee1093f2b
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Tue Jan 19 09:36:34 2021 +0000

    Bug 27410: Update intranet-tmpl/prog/en/modules/members/maninvoice.tt to reflect ACC2
    
    Test Plan:
    1. Open intranet-tmpl/prog/en/modules/members/maninvoice.tt
    2. Search for instances of 'input type="number"'
    3. If none are found then patch was successful
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0d4fac8dd50f57518d62f0b56ee588d2710f0b8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 21 14:29:03 2021 +0000

    Bug 27408: (follow-up) Updates to accommodate currency entry
    
    This patch makes two modifications in order to allow the entry of
    currency strings (e.g. 1.25).
    - Inputmode changed to "decimal"
    - Regex pattern changed to "^\d+(\.\d{2})?$" as found in
      admin/debit_types.tt
    
    To test, apply the patch and test entry of various strings in the manual
    credit "amount" field. Confirm that the field only accepts digits or
    digits followed by a decimal and two digits.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b3c5dc376a89d3cb780b820c374f2ea20e65726
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Tue Jan 19 09:45:34 2021 +0000

    Bug 27408: Update intranet-tmpl/prog/en/modules/members/mancredit.tt for ACC2
    
    Test Plan:
    
    1. Open intranet-tmpl/prog/en/modules/members/mancredit.tt
    2. Search for instances of 'input type="text"
    3. If none are found then patch was successful
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99d37eaa6e5d714dd61f724dc5bbff5fe77d1833
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 5 13:15:51 2021 +0100

    Bug 27668: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit efeed28f7f58dffe0a307616a5f565321b55e8c0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 10 19:43:25 2021 +0000

    Bug 27668: Improve validation of patron entry form in the OPAC
    
    This patch improves the way we handle required fields in the patron
    entry/update form in the OPAC. Instead of doing multiple checks for each
    field using mandatory.defined(), the template now loops over a list of
    fields and sets a "required" variable for any which are required.
    
    Then, for each form field, the "required" variable is used to set
    classes on labels, input fields, and the "required" text hints. The
    class on form fields acts as a hook for the jQuery validator plugin. The
    class on the text hints allows us to hide the text hint using CSS,
    eliminating the necessity of using a template conditional.
    
    The patch also adds the missing validator-strings include which enables
    translation of the jQuery validator plugin's validation error messages.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Go to Administration -> System preferences and enable
       PatronSelfRegistration.
     - Select multiple fields to be required using the
       PatronSelfRegistrationBorrowerMandatoryField preference.
     - In the OPAC, start the process of registering for an account.
     - The fields you designated as mandatory should each have a "Required"
       label under them.
     - Try to submit the form without entering any data. The required fields
       should now be highlighted in red and have another label, "This field
       is  required."
     - Fill in the required fields and submit the form. It should submit
       correctly.
     - Modify the PatronSelfRegistrationBorrowerMandatoryField preference
       and select all fields as mandatory. Confirm that all fields in the
       patron entry form work correctly.
     - Test that form validation works correctly when modifying a logged-in
       patron's existing account.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63ce989b610ea21044e57ccc5fdf04c06c53bd46
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 24 16:58:28 2021 +0000

    Bug 27777: (alternate) Improve tables on Point of Sale page for low screen resolutions
    
    This alternate solution makes these minor changes:
    
    - The Bootstrap grid classes are adjusted so that the breakpoint
      between the two-column layout and the single-column layout happens at
      a wider browser-width.
    - The DataTable configurations are modified to set "autoWidth" to
      "false," which gives us a more fluid behavior.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 755081fdc394bbf457bee00acf1037a0ba6b29f0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 24 15:53:13 2021 +0000

    Bug 27776: Remove default sort order of sales table
    
    This patch drops the default sort on table initialisation so that the
    table remains sorted in the order in which items are added unless the
    user explicitly chooses to apply a sort order.
    
    We also correct a mistake in the targets for disabling sorting on the
    'Actions' column and update the hidden 'CODE' column to use the same
    syntax as the other definitions for consistency.
    
    Test plan
    1/ Enable the point of sale system and set some debit types to allow
    sale.
    2/ Navigate to the point of sale page and added some items to sell
    3/ Update the price for a few lines and note the sort order does not
    change.
    4/ Update the quantity for a few lines and note the sort order does not
    change.
    5/ Sort a column using the headers and note it works
    6/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35b5e29988f9781516b7e09327741455bfa202a5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 17 12:25:34 2021 +0000

    Bug 27717: Display date of birth even if the patron is under 1
    
    This patch moves the 'age' condition to below the date of birth display,
    allowing the date to display for babies.
    
    Test plan
    1/ Add a user with a date of birth within the last year
    2/ Check that the date of birth appears on the patron details page
    (under contact details) with the patch applied.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2cd4c6011a13ec85c35005216be3f3ed39a5278b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 10:04:07 2021 +0100

    Bug 25674: Remove default vhost
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 476ab4758ce6663de2df0ee03fdef0d1882cb3fe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 13:15:08 2021 -0300

    Bug 25674: Add documentation
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac5f62855907bb91042180b8c518594b47f8c1dc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 13:14:52 2021 -0300

    Bug 25674: Adapt koha-create
    
    This patch adds the following option switches to koha-create:
    
    --mb-host
    --mb-port
    --mb-user
    --mb-pass
    --mb-vhost
    
    They are used to override the default values on instance creation.
    
    To test:
    1. Play with the several option switches and verify that the resulting
       koha-conf.xml contains the expected data.
    => SUCCESS: It works as expected
    2. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce11b59ce194d4328770271755a180d2e7238ab3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 13:14:34 2021 -0300

    Bug 25674: Add placeholders for RabbitMQ configuration
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0104de7c22d1370c836703b683c9cc8112275da5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 14 10:05:02 2020 +0100

    Bug 26742: Remove die from connect
    
    The change was not advertised and it needs to be done on a separate bug
    report (+ test coverage)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8663f23a931edea9f8fcd341e67804f613bb1d8d
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Oct 20 11:54:46 2020 +1100

    Bug 26742: Add configuration to koha-conf.xml for message broker
    
    The connection details for the message broker should be configurable.
    This patch adds configuration options to koha-conf.xml. If they
    are not specified, then default connection details will be used.
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75a210aef48776969007bac6d29d510f5657048e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 4 16:26:04 2021 +0000

    Bug 22824: DBRev 20.12.00.021
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9df71447b42a46eb1ccc66bdd175772a785b5ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 13:34:02 2021 +0100

    Bug 22824: Add warning to the about page
    
    Just in case, add a warning to the about page.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch: there was a "bad space" between "warnNoActiveCurrency"
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9aa20245fccea699ee7bee6c342864845a7b8368
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Feb 19 10:48:42 2021 +0100

    Bug 22824: Fix encoding of misc/admin/koha-preferences output
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc19a4c2849a70cd1a636e2523257d8b7124c566
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 15 11:37:58 2021 +0100

    Bug 22824: Prevent YesNo to be filled with invalid values
    
    This patch prevents koha-preferences to set other values than 1/0 to be
    used for YesNo prefs
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 211b8e7414d643dcca82f8ab5b350320fe3adbe8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 15 11:10:00 2021 +0100

    Bug 22824: Fix koha-preferences dump
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccfe1d5e21e8e07d3d1d49c0962654661ae8dbab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 15 11:03:24 2021 +0100

    Bug 22824: Adjust POD for koha-preferences
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54351c4fb3a23ea2c16ccecdf6eebfd05b7507ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 14:56:57 2021 +0100

    Bug 22824: Fix ES reindex
    
    koha-elastic --rebuild was failing with
    Unable to update mappings for index "koha_kohadev_biblios". Reason was: "Could not convert [marc_data.index] to boolean"
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84410a11252c5bf6db6742c2ed6cf53abea7df9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 14:27:56 2021 +0100

    Bug 22824: Adjust tests to match final behaviours
    
    Finally we diverge quite a lot with how it worked prior to this patch
    set. Reflect the changes in the tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f92cae1381acb1c35e7bb6b6e73aba6f1e7a3e9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 12:31:25 2021 +0100

    Bug 22824: Atomic update
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83d07dec7f16fb2dedee1e257aa5d42a8523c068
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 12:31:05 2021 +0100

    Bug 22824: Fix default values for YesNo
    
    select variable, value from systempreferences where type="YesNo" and ( ( value <>'1' and value <>'0' ) or value is null );
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 592ab10fe5085bddb078cf019a6fb5ce9a92dc73
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 12:18:31 2021 +0100

    Bug 22824: Remove C4::Boolean, true_p, boolean_preference, etc.
    
    It seems that we don't really need all this overhead.
    YesNo must be a boolean and contain 1 or 0.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 241a7958f23cb666d32f461e2d2a95e0773146a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 12:12:36 2021 +0100

    Bug 22824: Replace wrong auto replacement
    
    This must be "no", it has been caught by the previous sed
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1fe1b704f9a81172f2a6b86367b314572a854d18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 12:12:03 2021 +0100

    Bug 22824: Fix yes/no vs 1/0
    
    Patch generated with:
     perl -p -i -e 's# no: # 0: #' **/*.pref
     perl -p -i -e 's# yes: # 1: #' **/*.pref
    
    no must be 0 and yes must be 1!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebb8c02266125c5ee368cd9baec0928a6a6aedb6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 11:49:54 2021 +0100

    Bug 22824: Correct on/off behaviour
    
    Here things are starting to be a bit tricky.
    IMO we don't want to replicate the ImplicitTyping behaviour from
    YAML::Syck but handle correctly the different value.
    We have the list of available values in the .pref file, the values in DB
    must match them.
    
    We want 1 or 0 in DB.
    
    2 more occurrences:
    finesMode => Dealt on bug 27676 ('off' is ok here)
    itemBarcodeInputFilter => 'OFF' is correct here
    
    Note that we don't use ~ or true/false in *.pref
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f882b1c60ac6c2dee6976659eeb9037d1308a432
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 11:44:50 2021 +0100

    Bug 22824: Fix searching.pref
    
    One .pref file make YAML::XS fails.
    The correct display must be, before and after this patchset:
     If "Unescape escaped" is selected this will allow writing regular expressions "\/like this\/" while "/this/", "or/this" will be escaped and interpreted as regular strings.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6d01169509999e22fbf33d839a41e402cb93a38
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 10:19:29 2021 +0100

    Bug 22824: Replace YAML::Syck with YAML::XS
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64e5a55f852ee93844921122c050aca9a2e2d3bf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 10:10:32 2021 +0100

    Bug 22824: Fixing first error in tests
    
    There was an encoding issue. The parent bug report have been fixed, see
    bug 27673 and patches related to Encode
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2afcb23e314013876a6f1bf8e32317dcd8ad448
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 10:09:48 2021 +0100

    Bug 22824: Replace YAML::Syck with YAML::XS in tests
    
    In order to understand how things will work after the changes
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0f45b55cad30ed4761b4bfb61dafaa95d387c83
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 10:01:02 2021 +0100

    Bug 22824: Add tests
    
    Writing some tests to see how things are working currently
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecb56647632305132fd32eece0a5bf89b018689c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 1 14:00:39 2021 +0000

    Bug 27048: (follow-up) Correction to elapsed printing
    
    JD Amended patch: Remove perlcritic error
    "$d" is declared but not used at line 839, column 5.  Unused variables clutter code and make it harder to read.  (Severity: 3)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe1705f947952fa5b4238c802f5d024cf3d7b7e1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 18 10:36:43 2020 +0000

    Bug 27048: Add basic timekeeping to rebuild_zebra
    
    This patch adds a start time, end time and elapsed times on the 'records
    exported' lines to the verbose output of the rebuild_zebra.pl script.
    
    Test plan
    1/ Run rebuild_zebra.pl -a -b -v
    2/ Note the new timestamps included on the verbose output
    3/ Signoff
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb954554b3498d97257b4423a6e897982885b474
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 19 00:01:26 2021 +0000

    Bug 24623: Phase out jquery.cookie.js: Advanced MARC editor
    
    This patch changes cookie handling in the MARC editor templates so that
    the js-cookie plugin is used instead of jquery.cookie.
    
    To test, apply the patch and go to Cataloging.
    
     - Search for a title using the cataloging search in the header search
       form.
     - In the search results, choose "Edit record" from the "Actions" menu.
     - By default you should be taken to the "basic" MARC editor.
     - From the "Settings" menu button, choose "Switch to advanced editor."
     - Return to the cataloging home page and perform another search.
     - Now when you choose "Edit record" you should be taken directly to the
       advanced editor.
     - In the advanced editor, choose "Switch to basic editor" from the
       "Settings" menu.
     - The basic editor should now be saved as the default.
     - Test also with "Edit record" links in catalog search results.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aeb55f4138a710a9c84f226dafb5ac356d73ce1c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 18 18:07:02 2021 +0000

    Bug 24624: Remove unused jquery.cookie.js plugin
    
    This patch removes inclusion of the jquery.cookie.js plugin from the
    "Receive orders" page in Acquisitions. It is unused.
    
    To test apply the patch and follow the process for receiving an order in
    Acquisitions:
    
    - Acquisitions -> Vendor -> Receive shipments -> Receive a new shipment
    - The table of pending orders should display correctly, and there should
      be no JavaScript errors in the browser console.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74d6f85742b50a423802901627df1f41e79d9f27
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 6 18:55:19 2020 +0000

    Bug 26960: Move batch item modification template JavaScript to the footer
    
    This patch modifies the batch item modification template so that the
    JavaScript is in the footer, conforming with best practices.
    
    The items form can contain <script> tags injected by cataloging plugins.
    These are moved from the body of the page into the footer be repeating
    the template loop that previously output the script tag.
    
    To test, apply the patch and test the process of submitting items for
    batch modification.
    
    After submitting a batch of items, test the "Edit items" form.
    Confirm that JavaScript-dependent interactions work correctly:
    
     - Select2-styled dropdowns
     - RegEx checkboxes
     - Datepicker
     - Plugins like:
       - dateaccessioned.pl on 952d
       - stocknumberam123.pl on 952i
       - callnumber.pl on 952o
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64127b42fff17972c5c8ed88cb67b7cdb65954b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 4 14:29:48 2021 +0100

    Bug 26959: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cec3eb7513a6e52aebe9a8808def316867c0ebd0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 3 17:53:47 2021 +0000

    Bug 26959: (follow-up) Fix CSS for column selection labels
    
    This patch modifies the staff interface SCSS in order to fix the display
    of column selection checkbox labels on the batch item modification page.
    Even though the style of the elements defines the "white-space" as
    "nowrap," adding whitespace within the element (as was done to correct
    indentation) still created problems.
    
    Changing the display property of the elements to "inline-block" corrects
    this.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b0a3f8753d37a818865107ae17501924d07a4db
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 6 18:29:56 2020 +0000

    Bug 26959: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff49528a04a139a3e7d40e03a34a06880c1fff82
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 6 17:16:36 2020 +0000

    Bug 26959: Reindent batch item modification template
    
    This patch reindents the batch item modification template to make
    indentation consistent. Some lines have been split up.
    
    Some markup issues have been corrected: Removed script "type" attribute,
    removed obsolete "CDATA" markers, removed obsolete IE-specific
    conditional comment.
    
    To test, apply the patch and go to Tools -> Batch item
    modification.
    
    - Test the process of submitting a barcode file, and item number file,
      and a list of barcodes.
    - Confirm that everything works as expected.
    
    Use your preferred method for checking the differences between files
    while ignoring whitespace. I use diff with the  "-w" flag, but I've been
    known to leave my car keys in the refrigerator from time to time. The
    only changes you see should be split lines.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17479dd3f942098b165ba15a2739ad6949ae6dc4
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Mar 4 12:33:24 2021 +0200

    Bug 25690: (follow-up) Supress warning about unitialized string
    
    This fixes the warning:
    Use of uninitialized value in string eq at /kohadevbox/koha/C4/Reserves.pm line 860.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 948b7ff598e5af001126ae3168877c0a8a896559
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Feb 26 13:33:15 2021 +0200

    Bug 25690: (follow-up) Correct grammar in warning messages
    
    This makes the meaning of the warnings a bit more clear.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b289f74cc5b08a87e8d5b612f946a930c5e7e24
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 19 12:06:10 2021 +0000

    Bug 25690: (QA follow-up) PROCESSED -> PROCESSING for consistency
    
    PROCESSED gave the apearance that the item processing had been completed
    whereas in reading the code it appears to actually signify that the item
    is awaiting/in proessing state.
    
    This patch updates the variable to be PROCESSING consistently throughout
    the codebase.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f5fc09f2fe77204c62fc2307b4e2ee71ce9e2f3
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Feb 18 17:37:36 2021 +0200

    Bug 25690: Add SIP2 tests for checking out with holds
    
    This should cover whether checking out is allowed for all different
    hold states:
    
    Attached:
     - Waiting
     - In processing
     - Transfer
    
    Unattached:
     - Reserved
    
    To test:
     1) prove t/db_dependent/SIP/Transaction.t => passes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd0bc2204c2a99e5bb61cdda88eb173ee6d81f2a
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Feb 17 16:20:28 2021 +0200

    Bug 25690: Make CanBookBeIssued return In Processing state as needing confirmation
    
    This prevents checking out to a patron an item with hold to someone
    else in the In Processing state via staff interface.
    
    Also the checkout error message via SIP is now a more clearer one: "Item is
    on hold for another patron." Before it was "Item cannot be issued:
    $confirmation".
    
    Also the branch transfer and batch checkout pages are adapted to this new
    confirmation message as well.
    
    To test:
     1) Create bib level hold to an item for patron A
     2) Check-in that item via SIP2, now the hold state should be "In processing"
     3) Apply patch
     4) Try to checkout the item to patron B via staff interface and
        notice we get now confirmation prompt do we really want to do it
        because it is in processing.
    
     In order to not have to setup SIP2 server, alternatively steps 1) and
     2) can be done so that you check-in the item in staff interface and
     make it Waiting, and then with SQL change it to "In processing":
    
     UPDATE reserves SET found = "P" WHERE reserve_id = XXX;
     UPDATE reserves SET waitingdate = NULL WHERE reserve_id = XX
     UPDATE reserves SET expirationdate = NULL WHERE reserve_id = XXX;
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 338ba1d7692c1f75af7b0fb75eb5aac00a04a3df
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Feb 17 14:17:36 2021 +0200

    Bug 25690: Remove duplicated logic in SIP2 checkouts
    
    Because AllowItemsOnHoldCheckoutSIP only affects the checkoutability
    of non-attached, i.e. RESERVED holds in SIP2 we can therefore use the
    common code from CanBookBeIssued and ignore only the RESERVED confirmation
    message case in SIP2 checkout code.
    
    This slightly changes the checkout error message given for "In
    processing" holds that someone other than the holdee tries to
    checkout. Otherwise there is no logic changes. The message that this
    changes is "Item is on hold for another patron." vs. now "Item cannot
    be issued: $confirmation". It is easier to create follow-up patch to
    properly add INPROCESSING confirmation to CanBookBeIssued and then
    show correct message based on the CanBookBeIssued return value.
    
    To test:
     1) Apply all patches from bug 25690 to get latest Transaction.t version
     2) prove t/db_dependent/SIP/Transaction.t => passes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b5913d308e4aa03306c5275d0e638e922a6db32
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Feb 17 14:28:03 2021 +0200

    Bug 25690: SIP2: Don't allow checking out attached hold that is being transferred
    
    Items that are attached to a hold and being transferred (found = T) is
    final decision and you cannot checkout those to other patrons.
    
    To test (if you have applied all patches from bug 25690):
     1) prove t/db_dependent/SIP/Transaction.t => passes
    
    To test (if you don't have all patches):
     1) Create hold and set pickup library to something else where the
        item is at
     2) Return the item and it should confirm the hold and start transfer
     3) Apply this patch
     4) Try to checkout this item now to some other patron via SIP2 and
        notice it doesn't allow it
     5) Revert this patch
     6) Notice you can now checkout somebody else's hold that is being transferred!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbef5478325bbc71064f9ecb3c4c50eaed0b223d
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Feb 17 14:04:47 2021 +0200

    Bug 25690: Remove double usage of 'Reserved' return value
    
    The patch "Bug 19116: Hold not set to waiting after transfer" added a
    new meaning to 'Reserved' return value of C4::Reserves::CheckReserves
    function. Let's remove double usage and have separate Transferred
    return value so we can differentiate between attached and non-attached
    holds. This will come useful in future refactorings.
    
    This patch does no changes to the logic except in the
    /cgi-bin/koha/circ/branchtransfers.pl and circulation.pl we now give
    similarly to waiting state notice about hold being transferred.
    
    To test:
       1) Apply this patch
       2) Create a new item level hold so that pickup library is different
       than where the item is currently. Then return the item so that hold
       is being attached and transferred.
       3) Go to branchtransfers.pl and try to create a new transfer: it
       should prompt you with message "Item is attached to a hold and
       being transferred for XXX" and provide you with option to cancel
       the hold or to ignore the transfer.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 979b9c4678e79622c53b318c191333d8444c21d6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 4 08:21:29 2021 +0000

    Bug 26057: (QA follow-up) Fix Biblios, Reserves, Z3950Responder and XSLT tests
    
    With the introduction of datecancellation we now have two fields to
    check to varify if a transfer is 'complete' or not.  I forgot to update
    these tests at the time to ensure the datecancellation field was not set
    when adding the mock transfer.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf06f36fd0d1f76865c269931375f823c300352f
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Mar 4 15:41:12 2021 +1300

    Bug 26363: Remove tmp file during package build (follow-up)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db5aadaeb9761a8e4d1be974a05d59bea865ca3d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 3 17:26:39 2021 +0000

    Bug 25846: (follow-up) Show "No cover image available" message
    
    This patch restores the use of a "No cover image available" message in
    staff interface search results when no cover image was found by any
    image service.
    
    The patch also corrects markup in the search results template which was
    preventing the "Adlibris cover image" text from being correctly hidden.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 965f65340a2a00f92484e251e7f855cf6d098fea
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 14:16:34 2021 +0100

    Bug 27473: Remove the redirect after 10sec
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79dba46e3add07f83569a9bc79f683bb6933e596
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 1 13:05:22 2021 +0000

    Bug 27473: (follow-up) Remove the redirect message
    
    I don't think it's necessary to remove the redirect because I don't
    think it does any harm, but why include a message about it? I think we
    should treat this step like all the others and provide a button to take
    the user to the next page.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0762bd39424136ff6739970d3a9121403c4951cd
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Feb 7 00:06:02 2021 +0000

    Bug 27473: (follow-up) Change wording of the button
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6d7a6d3e1edb24f8ba6b122faf627d64a2c0fa1
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Wed Jan 20 02:12:11 2021 +0000

    Bug 27473: Improved link text in installer
    
    Test Plan
    1. run reset_all to run koha installer
    2. Check that after importing sample data step that link says 'Continue
    to the next stage'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15d4aa2b4dc06ed628f11eb263d90be35d8a8e06
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 18 10:48:41 2021 +0000

    Bug 26618: Improve Exception Class Names
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 138212f856f760427cf9d0f50bce357620576ebe
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 22 12:15:44 2021 +0000

    Bug 26618: (QA follow-up) Fix unit test for TranferCollection change
    
    We update TransferCollection to use the settled upon standard for
    passing error messages back from a method. This patch updates the
    corresponding unit test.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7369fa5e507261040c17015cb09cb10f845c2ec8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 18 15:25:42 2021 +0000

    Bug 26618: (QA follow-up) Update messages syntax
    
    As highlighted, we were not using the standard form of message passing
    here. This patch updates the template and controller to adopt the more
    usual syntax.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87c3911bb8352b7e678c22ce7630c1a76c8c6b15
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:37:29 2020 +0000

    Bug 26618: Remove use of transferbook in RotatingCollections
    
    This patch replaces the use of C4::Circulation::transferbook in
    C4::RotatingCollections with calls to Koha::Item->request_transfer and
    adds handling for the various failure cases which that can throw.
    
    We also introduce additional feedback for the end user where it did not
    exist before. Now we notify the user if some of the collection could not
    be transfers or if transfers were queued rather than set to request
    immediately.
    
    Test plan
    1/ Set up a rotating collection
    2/ Transfer the collection
    3/ Confirm the action succeeds
    4/ Set up some branch transfer limits that will affect items in your
    collection
    5/ Transfer the collection
    6/ Note that the transfer succeeds but some items are returned as
    failures
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80e3bfd3763056b74e64c8ea628d7d201592cf52
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 3 13:44:52 2021 +0000

    Bug 24446: DBRev 20.12.00.020
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1b92345cdb30a055f1788c57447451ddf8f40a9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 18 14:45:38 2021 +0000

    Bug 24446: (QA follow-up) Use 'receive' method in ModReserveAffect
    
    ModeReserveAffect was setting all transfers in the queue to received by
    looping through a resultset. This patch updates the logic to try and
    catch the in_transit transfer and receive just that one instead.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fdaac5394cc77d43da2f7fd9c34a4c854b5ed898
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 18 10:54:34 2021 +0000

    Bug 24446: (QA follow-up) Remove superflous store calls
    
    The original code here called store after setting each field. Instead,
    we set all the fields and call store at the end and save ourselves a few
    database hits.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a82279c3620b137620e64b07438371a446022ff1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 18 08:43:25 2021 +0000

    Bug 24446: (QA follow-up) SIP test fix for bug 27166
    
    A new test was introduced in bug 27166 since this code was written, this
    patch simply updates the test for the additional 'TransferTrigger'
    message that is returned by this patchset.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bf43fc06652cd4fc7af4dec1258836a91b845d2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 18 08:42:48 2021 +0000

    Bug 24446: (QA follow-up) Set TransferTrigger to 'Reserve' for bug 24298
    
    The SIP initiated transfer was set to use the 'TransferTrigger' passed
    back from AddReturn; However, TransferTrigger is not set for reserves in
    AddReturn (It's is set controller side by circ/returns.pl). We thus need
    to also hard code the trigger type in the SIP transaction for reserves.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bfccf58648537540ba39d207dcc6909dcf244d8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jan 22 11:11:53 2021 +0000

    Bug 24446: (QA follow-up) Correction to datecancelled for ModItemTransfer
    
    ModItemTransfer always replaces any existing transfers, including those
    in transit.. so we needed to add a 'force' option to
    Koha::Item::Transfer->cancel();
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25d1d22082dd620ca785913554246bada3ba5892
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 21 14:49:48 2021 +0000

    Bug 24446: (QA follow-up) Fix ModItemTransfer tests
    
    Seems I missed passing trigger in the tests for ModItemTransfer. This
    patch corrects that oversight.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b14cf94f33be8aeeaa4dc5da0d3c769b1628db3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 21 14:43:26 2021 +0000

    Bug 24446: (QA follow-up) Update transferbook Test
    
    Needed for a rebase, a new test was introduced so we need to add the
    trigger option into that test now too.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 719a3b8d9213b5e8e80939090f9f1bd68c2563d3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 22 12:50:55 2021 +0000

    Bug 24446: (QA follow-up) Update unit test for ModItemTransfer
    
    Update unit test to reflect we now use cancellationdate and
    cancellation_reason in ModItemTransfer
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ec94fb198fbe7693f665bc0328c0dbc5515a2d3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:29:32 2020 +0000

    Bug 24446: Update ModItemTransfer for daterequested/datecancelled
    
    C4::Items::ModItemTransfer is used throughout the codebase and currently
    it will never set the daterequested or datecancelled fields.  With the
    modifications to how circulation deals with transfers we need to update
    this function to set those fields appropriately. Functionality has been
    retained, ModItemTransfer will continue to add a transfer regardless of
    limits or current transits existing.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2675c4ef05f7c7e1a15880eb36237df9f2b600bc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 7 08:21:16 2020 +0100

    Bug 24446: Add datesent/datecancelled handling to GetTransfersFromTo
    
    With the first uses of Koha::Item->request_transfer and
    Koha::Item::Transfer->cancel having been added, we need to update
    GetTransferFromTo to respect transfers that have been requested but
    not yet sent and not cancelled.
    
    Test plan
    1/ Run the included unit test
    2/ Confirm the "Transfers to recieve" page loads
    3/ Signoff
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b3befe58b4c7e6bd0bc5f8416e6b62cdfb1662e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 7 08:31:56 2020 +0100

    Bug 24446: Add datecancelled handling to GetTransfers
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1ef7571c0f2ad9e122a81b9b4fa7cf2ad1a7dc7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Oct 6 14:13:47 2020 +0100

    Bug 24446: Prioritize RotatingCollection transfer over StockRotationAdvance
    
    This patch prioritizes the RotatingCollection transfer type over the
    StockRotationAdvance transfers allowing us to queue up a our transfer
    behind it.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ac337b4e74182d8d4b0ddbaefcd98e041911ae7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:36:51 2020 +0000

    Bug 24446: (follow-up) Handle cases of pre-existing transfers
    
    This is a long standing bug in stockrotation (and transfers in general)
    where by if a transfer is in progress and another transfer is requested
    then the original transfer is inexplicitly cancelled. This patch updates
    the stockrotation code to handle queued transfers, either adding a
    StockrotationAdvance transfer to the queue when an in progress transfer
    was triggered to fulfil a Reserve, or otherwise cancelling the transfer
    as stockrotation should take precidence.
    
    To test
    1/ Run t/db_dependent/StockRotationsItems.t.
    2/ Signoff
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfe6ebc66784ad6bdfc1645009ca05ab7f2a2ad2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 7 14:10:46 2020 +0100

    Bug 24446: Update GetTransfers Unit Test
    
    We updated the return signature for GetTransfers and as such need to
    update the corresponding unit test
    
    Test plan
    1/ Run t/db_dependent/Circulation/transfers.t
    2/ Confirm it passes
    3/ Signoff
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d25c667d063b273e1a8b8415ce5ff00a5d18d1bc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 8 09:02:50 2020 +0100

    Bug 24446: Update transferbook Unit Test
    
    We updated C4::Circulation::transferbook to return the to_branch branchcode as
    the data entity for 'WasTransfered'. This patch updates the corresponding unit
    test.
    
    To test:
    1/ Run t/db_dependent/Circulation/transferbook.t
    2/ Signoff if it passes
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e919d12d846c72fd5d376c4c8549f6b7135f9d9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jan 17 13:58:12 2020 +0000

    Bug 24446: Catch daterequested in circ returns
    
    Update C4::Circulation::AddReturn to use Koha::Item->get_transfer to
    find requested transfers and use Koha::Item::Transfer->receipt to complete
    transfer requests if they have arrived at their destination or return the
    relevant 'WrongTransfer', 'WasTransfered' and 'TransferTrigger' messages
    to the end user.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aca8b71364f549d939fdde6a234419d7ba86fe25
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 24 07:46:10 2020 +0000

    Bug 24446: Update StockRotationItem to use daterequested
    
    This patch updates the stockrotation functionality to utilise the new
    branchtransfers.daterequested field to more accurately track the state
    of stockrotation transfers.
    
    We also opt to start using the new Koha::Item and Koha::Item::Transfer
    methods to achieve this goal.
    
    Test plan
    0/ Setup stockrotation and configure some rotas and assign items to
    them.
    1/ Run the stockrotation cronscript
    2/ Check the database for branchtransfers initiated by stockrotation and
    confirm that that now populate the daterequested field and not the
    datesent.
    3/ Run the stockrotation tests and verify they pass
    4/ Signoff
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf8ce2aa13ba2c136e9871465bb9d0f087d41ec4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:36:20 2020 +0000

    Bug 24446: Improve StockRotationItem->advance tests
    
    This patch adds additional checks in the tests for item homebranch
    updates and cyclical transfers caused by the StockRotationItem->advance
    method.
    
    It highlights a bug in the original logic whereby a cyclical rotation
    would always result in a completed transfer but the physical item would
    not have actually been moved between branches.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99e3bb18b098c98d0a125084ae2dbf05544050d7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jan 17 15:18:24 2020 +0000

    Bug 24446: Update branchtransfers.daterequested for stockrotation
    
    This database update catches existing stockrotation triggered
    branchtransfers and moves the datesent value into daterequested
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84c0339acc4811ab405b917cdcb0d753adaa6b26
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 3 14:50:39 2021 +0100

    Bug 26057: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c004a9128a8ee60292dc7d62d6020e21589ae8fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 3 13:44:52 2021 +0000

    Bug 26057: DBRev 20.12.00.019
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f10c7b5c74755c789f19b781042d78888d46e039
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 22 12:31:50 2021 +0000

    Bug 26057: (QA follow-up) Fix Indexer tests
    
    The addition of cancellationdate meant that our test objects in the
    Indexer tests now longer matched expectations and as such the tests
    failed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26b6f2f1d0f9f3be8da2f738f2e458b540e01083
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 21 14:27:44 2021 +0000

    Bug 26057: (QA follow-up) Drop test for 'reason'
    
    We decided this test was superflous to requirements and as such I've
    removed it as requested.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9378fb03a7c734d15eb268d821d77737d4d5a38e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:36:07 2020 +0000

    Bug 26057: Add 'cancel' method to Koha::Item::Transfer
    
    This patch adds the 'cancel' method to Koha::Item::Transfer which sets
    the transfer as cancelled by updating the datecancelled field. We also
    update Koha::Item->get_transfer here to accomodate for the new
    resolution available for a transfer.
    
    Test plan:
    1/ Run the included unit tests additions (t/db_dependent/Koha/Items.t,
    t/db_dependent/Koha/Item/Transfer.t
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d0006f7722fcb2a769e276171da269d92ddce76
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Sep 21 15:20:12 2020 +0100

    Bug 26057: Add datecancelled, cancellation_reason fields
    
    This patch adds the datecancelled and cancellation_reason fields to the
    branchtransfers table to record when and why transfers have been
    cancelled.
    
    To test
    1/ Run the database update
    2/ Check the database for the 'datecancelled' and 'cancellation_reason'
    fields
    3/ Signoff
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6becadc96ea52f246d7063a9fda25d68c8c136f0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:35:44 2020 +0000

    Bug 26481: Add Koha::Item::Transfer->in_transit method
    
    This method returns a boolean representing the in_transit state of the
    transfer.
    
    Test plan
    1/ Run the included tests
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca9ce62ee859a435dbb6045adfbf01e5d93c5803
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jan 20 15:51:39 2020 +0000

    Bug 25767: Add Koha::Item::Transfer->receive method
    
    Was Bug 25767: Add Koha::Item::Transfer->receipt method
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Bug 25767: Add unit tests for Koha::Item::Transfer->receipt
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Bug 25767: (QA follow-up) receipt -> receive
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62e16bbbe4a914b7cfe2b4efaf5f2e9ed7722a6a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:35:21 2020 +0000

    Bug 25757: Add unit tests for item relation
    
    Test plan
    1/ Run the unit test
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74bcdd3765db812d7aec4086a54904373777e476
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 18 16:35:15 2020 +0000

    Bug 25757: Add Koha::Item::Transfer->transit method
    
    Test plan
    1/ Run the included unit tests
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94056d8df2a150cf3d3274f9b6c3b765fa5f6d4e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jun 16 11:36:19 2020 +0100

    Bug 25757: Add item relation to Koha::Item::Transfer
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 165cb84dd86a69117154e2973423faad796d5837
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 21 14:37:01 2021 +0000

    Bug 25755: (QA follow-up) Further POD clarifications
    
    This patch attempts to further clarify the queueing nature of transfer
    requests in the get_transfer method POD.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit edbde02775e2e3fdbaf96306505c3c1cf3e8e92b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Sep 21 14:35:25 2020 +0100

    Bug 25755: (follow-up) Fix unit test
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3fb0ce392dcbb36bff94adc709ca89d3cb3ca91
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 20 17:41:30 2020 +0000

    Bug 25755: Fix typo in POD
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f81ecbb19dec8a716c46d35972a5ab0ec3b25712
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 18 14:56:23 2020 +0100

    Bug 25755: Add Unit tests for update to get_transfer
    
    We updated Koha::Item->get_transfer here to account for the new
    daterequested field availability. It is now possible to set requested
    without setting datesent simultaneiously.. as such we need to update
    get_transfer to ensure we always return the right transfer (either the
    one 'in transit' or the oldest request first.
    
    This patch update the unit tests to test for this.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17007f03451024cf0c9d629173d7189f8b17537d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 18 12:14:25 2020 +0100

    Bug 25755: (QA follow-up) Clarify POD and parameters
    
    This patch removes a FIXME that signified possible future work and also
    updates the POD and optional parameters to more clearly specify their
    function.
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33e1ec0ed02c5804502f84d8386a13b04c46fdd7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jan 20 15:11:53 2020 +0000

    Bug 25755: Add Koha::Item->request_transfer method
    
    This patch adds the request_transfer method to the Koha::Item object.
    The new method requires `to` and `reason` parameters and will throw an
    exception if an active transfer request is found on the item.
    
    Test plan
    1/ Run the included updated tests in t/db_dependent/Koha/Item.t
    2/ Verify the tests pass
    3/ Signoff
    
    Signed-off-by: Kathleen Milne <kathleen.milne@cne-siar.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1845ff19bff50e7932f8434c62ac0cbb26df60b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 3 15:34:56 2021 +0100

    Bug 25846: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa349d4cf1c28d486be89c9d84f18fddbaeaf5db
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 16 13:27:34 2021 +0000

    Bug 27703: Make ID of category select field unique
    
    Duplicate element IDs on the authorized values page are invalid and
    cause a problem with the JavaScript intended to submit the form when the
    category select field changes.
    
    This patch changes the ID of the label and the field and makes the
    corresponding change to the JavaScript.
    
    To test, apply the patch and go to Administration -> Authorized values.
    
     - Click an authorized value category to view its contents.
     - Using mouse or keyboard, make a selection from the "Show category"
       dropdown menu.
     - The form should submit automatically and direct you to the
       corresponding category.
     - Validate the HTML of the page and confirm that there are no errors.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d67fc5e010f5efba79980626beed88755f420c48
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 26 14:28:42 2021 +0000

    Bug 27784: Don't parse subdivision authorities as headings
    
    Subdivision authorities are not used for linking, however, they are recognized by
    C4::AuthoritiesMarc
    
    While these records are not used for linking, they could provide reference and
    should be allowed to exist in the catalog without breaking ES indexing
    
    THis patch simply skips the step of parsing the authorities into the linking form
    if the type contains '_SUBD'
    
    To test:
    1 - Import a subdivision authority record via Z39 or use the one attached to this bug
    2 - perl misc/search_tools/rebuild_elasticsearch.pl -v -d
    3 - Authority indexing dies:
       Use of uninitialized value $tag in hash element at /usr/share/perl5/MARC/Record.pm line 202.
       Use of uninitialized value $tag in regexp compilation at /usr/share/perl5/MARC/Record.pm line 206.
       Use of uninitialized value $tag in hash element at /usr/share/perl5/MARC/Record.pm line 207.
       Can't call method "tag" on an undefined value at /kohadevbox/koha/C4/Heading.pm line 71.
    4 - Apply patches
    5 - reindex
    6 - Success!
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e0dbf0adb63818b08ee77843706255dcaf00051
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 26 14:28:16 2021 +0000

    Bug 27784: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b4be9486e6e37e724560863f36e4835b6a66f43
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 11:36:49 2021 +0100

    Bug 27828: (bug 24469 follow-up) Add missing import
    
    Caused by
      commit 03a9bdc851dcfe114c1676ac55def1e1c5d51970
      Bug 24469: Move the new queries to a dedicated ImportBatch subroutine
    
    Undefined subroutine &CGI::Compile::ROOT::kohadevbox_koha_acqui_neworderempty_2epl::SetMatchedBiblionumber called at /kohadevbox/koha/acqui/neworderempty.pl line 183
    
    Test plan:
    Create a new order from a staged file, select "Add order" next to a
    title
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2542687f68d67ec1b36b1c1994920827515ce0a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 16:08:51 2021 +0100

    Bug 27822: Fix default value for AddressFormat (es-ES)
    
    It must be "us" not "US" otherwise you get
    Template process failed: file error - member-main-address-style-US: not found at /usr/share/koha/lib/C4/Templates.pm line 122" because the system expects "us", not "US".
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c75c482491c6924989a42d49b7bb34e4542d0eb
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Mar 2 14:40:49 2021 +1300

    Bug 27803: Ensure publicationyear or copyrightdate shows in Holds to Pull
    
    If marcflavour is set to MARC21, use biblio.copyrightdate. If
    marcflavour is set to something other than MARC21, use
    biblioitem.publicationyear. This is to match previous behaviour of this
    feature.
    
    To test:
    1) Set your marcflavour system preferenece to MARC21.
    2) Go to Administration -> Koha to MARC mapping to confirm what MARC tag
    maps to biblio.copyrightdate.
    3) In your terminal, run misc/batchRebuildBiblioTables.pl from the shell
    to confirm the mapping is locked.
    4) Edit a biblio, fill in whichever field is mapped to biblio.copyrightdate
    and Save.
    5) Place a hold on this biblio. (It must have an available item to allow
    placing holds.)
    6) Go to Circulation -> Holds to Pull.
    7) Confirm your hold shows in the table with the copyrightdate.
    8) Set your marcflavour system preference to something other thatn
    MARC21.
    9) Go to Administration -> Koha to MARC mapping to confirm what MARC tag
    maps to biblioitem.publicationyear.
    10) In your terminal, run misc/batchRebuildBiblioTables.pl from the shell
    to confirm the mapping is locked.
    11) Edit a biblio, fill in whichever field is mapped to biblioitem.publicationyear
    and Save.
    12) Place a hold on this biblio. (It must have an available item to allow
    placing holds.)
    13) Go to Circulation -> Holds to Pull.
    14) Confirm your hold shows in the table with the publicationyear.
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfaae614871f9ff12aea44ebf518c117c5c69a3b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 10:38:10 2021 +0100

    Bug 8976: (follow-up) Code cleaning
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab19068a4b8af523b356454578c17e5ddde35de9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 2 10:18:34 2021 +0100

    Bug 8976: Use existing Koha::Authority::Subfield[s]
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96aa6877ae39c987214e46d00c70c76591da0174
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 2 08:56:14 2021 +0000

    Bug 27680: (QA follow-up) Update test for dbic_merge_sorting
    
    The order_by handling will now always return an arrayref of ordering
    hashrefs even when only one ordering hash is present. This is
    interpreted by dbic as equivilent so I just update the test to pass
    here.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8df3e02885f94ef8a6f960f693c398b6646daf09
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 1 11:56:23 2021 -0300

    Bug 27808: (QA follow-up) Make sure the update catches the items we want
    
    This query:
    
    SELECT *
    FROM items
    LEFT JOIN issues
    ON issues.itemnumber=items.itemnumber
    WHERE items.onloan IS NULL;
    
    returns 961 rows on the sample data, with 2 items checked out and onloan
    set to NULL.
    
    With this tweak, the query only matches the 2 checkout items with onloan
    set to NULL:
    
    SELECT *
    FROM items
    LEFT JOIN issues
    ON issues.itemnumber=items.itemnumber
    WHERE items.onloan IS NULL AND issues.issue_id IS NOT NULL;
    
    This is the query that needs to be used on the atomic update for
    filtering the items to be updated.
    
    This patch does that.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa41987dbfebcd61e1a7b5847095f55261c55d5e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 14:10:40 2021 +0000

    Bug 27808: DBRev 20.12.00.018
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb2758839e56c78b5f4d47f28d26053a29ae4d68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 13:34:56 2021 +0100

    Bug 27808: DB changes - adjust items.onloan when needed
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26b57ad5d20e385ff922cc8737afebfece17a3cf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 26 16:55:59 2021 -0300

    Bug 27808: Refresh the item object when AddReturn is called
    
    This patch changes the original implementation so the item object is
    refreshed altogether instead of explicitly pinpointing a specific field
    we identified an edge case can leave out from ->store. I propose this
    alterate implementation because what this bug highlights is the fact we
    don't code thinking calls to things can have side-effects (like this
    case, with AddReturn updating the onloan status (and maybe other
    things?).
    
    To test:
    1. Make sure circ tests pass with and without this patch
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44a54eb526eff58b860d699ee3c5fb11b3b25fab
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Feb 26 09:56:07 2021 -0500

    Bug 27808: Mark the onloan column as dirty in AddIssue
    
    If any item is currently checked out to a patron, and the item is then checked out directly to another patron without manually checking the item in first, the items.onloan column will remain NULL.
    
    This will only happen if the new checkout will be due the same day as the previous checked.
    
    This is caused by the item being returned without updating the item object from storage afterward. Even though AddIssue will call AddReturn which sets the value of onloan to NULL in the database, we are not passing in the item object by reference, so it's onloan value remains set to a date. Then we set the onloan value to the same date. Because the value does not change in the object, the column does not get marked dirty.
    
    We could update the object from storage first, but it seems more efficient to mark the column as dirty manually to avoid that otherwise unnecessary fetch.
    
    Test Plan:
    1) Apply these patches
    2) prove t/db_dependent/Circulation.t
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Marti Fuerst <mfuerst@hmcpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36c49aa2a865a069592c5d7695127252a3007f44
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Feb 26 09:44:30 2021 -0500

    Bug 27808: Add unit tests
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Marti Fuerst <mfuerst@hmcpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12d50cb5d8529d993ef5abccd84535540c938bee
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 25 14:03:43 2021 +0000

    Bug 27794: Add link to biblio in lateorders page
    
    This patch modifies the late orders page so that the late order title
    uses the "biblio-title" include to display a standard title with a link
    to the bibliographic detail page.
    
    To test, apply the patch and go to Acquisitions -> Late orders.
    
    In the table of late orders, confirm that the title display correctly
    and links to the correct bibliographic record.
    
    Signed-off-by: Severine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8a92cb8e8b731f1526500f32cf115dbd5636cf6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 25 13:55:15 2021 +0000

    Bug 27792: (follow-up) Double escape the escape
    
    The JSON patturn wasn't getting interpreted correctly for me.. the `\`
    characters needed escaping with a second `\`.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50c4efb18dc4e666d60e57f8412d6553eccbfe72
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 25 12:15:02 2021 +0000

    Bug 27792: Improve jEditable configuration for point of sale fields
    
    This patch alters the configuration of the "cost" and "quantity"
    editable fields in the "This sale" table on the Point of Sale page:
    
     - Reduce field with to reduce jumpy table re-draws.
     - Replace "numeric" input type with "text"
     - Add pattern attribute for enforcing currency/number entry
    
    To test you must have EnablePointOfSale and UseCashRegisters enabled and
    configured.
    
     - Apply the patch and go to the Point of Sale page.
     - Add some items for purchase.
     - In the "This sale" table, click the values in the "cost" and
       "quantity" columns and try editing their values.
     - The form field which appears should not fill the width of the table
       column.
     - The fields should enforce the correct input: Currency for the "cost"
       column, digits for the "quantity" column.
     - The fields should update when you click out of them and the correct
       values should appear in the "Collect payment" area.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4f17c10ff7901b8900c1913fc1edac9d6e176c1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 2 12:54:39 2021 +0000

    Bug 27592: Link audio alerts to corresponding preference and back
    
    This patch adds links from the audio alerts page to system preferences
    and back.
    
    To test, apply the patch and disable the "AudioAlerts" system
    preference.
    
    - Log in to the staff interface as a user with permission to access
      audio alerts and system preferences.
    - Go to Administration -> Audio alerts.
    - You should see an alert, "Audio alerts are disabled."
      - Test the link to system preferences. It should take you a
        preferences search which returns only "AudioAlerts."
    - On the system preference page, test that the link to audio alerts
      works correctly.
    
    - Disable audio alerts again.
    - Log in to the staf interface as a user with permission to access audio
      alerts but WITHOUT permission to access system preferences.
    - Go to Administration -> Audio alerts.
    - You should see an alert, "Audio alerts are disabled."
    - There should be no link to system preferences.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 927a62ba6f2c35f6c55709ed6c297767a01fa8aa
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jun 19 11:24:00 2020 +0000

    Bug 25846: Improve handling of multiple covers on catalog search results in the staff client
    
    This patch modifies the template, JS, and CSS for the staff
    interface catalog search results in order to gracefully handle multiple
    cover images.
    
    The changed version loops through any cover images which might be
    embedded and checks that they are successfully loaded. Only
    successfully-loaded images are shown. Only the first image is shown, and
    the others can be "paged through" using generated navigation controls.
    
    To test, apply the page and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Enable multiple cover image services. The patch was developed with these
    services available:
    
     - Amazon
     - Local cover images (including multiple local cover images)
     - Coce (serving up Amazon, Google, and OpenLibrary images)
     - Images from the CustomCoverImages preference
    
    Perform a variet of searches and confirm that cover images are
    displaying correctly, whether there be 0, 1, 2, or more covers
    available for each.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb9cd28bac1eef9f24cff98f2bf1b05d3a76baf2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 14:10:40 2021 +0000

    Bug 26937: DBRev 20.12.00.017
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d55746004be15a15568fcf8bf7d56ebd61849534
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Feb 13 04:52:57 2021 +0000

    Bug 26937: (QA follow-up) Rephrase and link CheckPrevCheckoutDelay description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a31f88d52f5ab88c561f9cca6025ef7ae51dc74
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Thu Jul 23 16:24:39 2020 +0200

    Bug 26937: Add an optional delay to the CheckPrevCheckout syspref.
    
    The CheckPrevCheckout allows to check a borrower's checkout history to see if
    the current item has been checked out before.
    
    This patch adds an optional syspref: CheckPrevCheckoutDelay
    
    It allows to specify the maximum number of days since the last checkin
    that will trigger CheckPrevCheckout's warning.
    
    Test plan:
    
     - Apply the patch.
    
     - Set CheckPrevCheckout to "Do" and CheckPrevCheckoutDelay to n.
    
     - Checkout and check-in an item for a patron.
    
     - Try to checkout the same item.
    
     - Check that you have a warning:
       "Patron has previously checked out this title: Check out anyway?"
    
     - Update the returndate column from the old_issues table to have a returndate
       older than n days ago.
    
     - Try to checkout the same item.
    
     - Check that you don't have the warning.
    
     - Prove t/db_dependent/Patron/Borrower_PrevCheckout.t
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 86918091118d1e2ead99a943dfe783c7f1740789
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Tue Nov 3 14:49:31 2020 +0000

    Bug 26591: SIP option prevcheckout_block_checkout to block checkout of previously checked-out documents
    
    This patchs adds a new SIP option to block checkout of previously
    checked-out documents: prevcheckout_block_checkout
    
    See the CheckPrevCheckout system preference to enable previously
    checked-out verification in Koha.
    
    Test plan:
      1) Apply this patch
      2) Enable the CheckPrevCheckout syspref (on "Do" for instance)
      3) Enable prevcheckout_block_checkout in the SIP server config file
      4) Checkout and checkin an item for a user
      5) Checkout the item again with the SIP CLI tool
      6) Check that the SIP message is "This item was previously checked out by you"
         and that the item was not checked out
      7) Disable prevcheckout_block_checkout in the SIP server config file
      8) Checkout the item again with the SIP CLI tool
      9) Check that the SIP message is "This item was previously checked out by you"
         and that the item was checked out.
     10) Prove t/db_dependent/SIP/Message.t
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24df8530646562ea76ee79faf7c83c8f94e691eb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 14:10:40 2021 +0000

    Bug 8976: DBRev 20.12.00.016
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70b5f6bedd05d831639777becac74ba3b8f8bd9c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 24 12:20:18 2021 -0300

    Bug 8976: (QA follow-up) Trivial POD fixes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a46391f0779a9e3ecc21137146fa8029deaa47cc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 24 12:12:31 2021 -0300

    Bug 8976: (QA follow-up) Add a better feature decription
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 380a7ef1c054d7d873a17cd5732f9b0437f23c5e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 10 10:51:02 2020 +0100

    Bug 8976: DBIC schema changes
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8650f8111b1699e3f90f509efad19f318e4f7280
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 18:51:56 2020 +0100

    Bug 8976: Code cleaning
    
    It was tricky to write the previous patch so I decided to clean the
    ground (a bit) for later, taking advantage of having people who are
    going to test the whole area.
    We can move it to its own bug report if QA wants to.
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02c6935115422c0fa855a8a6d23d5048ea63a568
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 18:56:06 2020 +0100

    Bug 8976: Add Koha::AuthSubfieldStructure[s]
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9ff0b5023c9f3fbb86b76d91c703a6c811388a7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 18:06:18 2020 +0100

    Bug 8976: Change for the item forms
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebe11f70e288ddd0d2f1b448fa09550483fce453
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 17:07:36 2020 +0100

    Bug 8976: Sort subfields for authority records
    
    Same patch for the authority frameworks/records
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b387502eaf23235cc5faa75c5bf1463529b20b1c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 1 18:08:20 2020 +0100

    Bug 8976: Add the ability to sort subfields for the MARC frameworks
    
    This new enhancement adds the ability to change the default order the subfields.
    
    Both bibliographic and authority MARC subfield structure are taken into
    account. And so the item edition as well (in the different screens when
    item can be added/edited).
    
    This will answer the following needs that have been listed in the
    comments of the bug report:
    - $i in 7xx fields should be the first subfield in the sequence
    - 300 fields are sorted number first when cataloguers enter the letter fields first
    - 100 field, it's commonly $a, $q, $d.
    
    Test plan:
    1. Edit a MARC frameworks, field 300
    2. Resort the subfield (drag and drop the tab of the subfield) as you
    like
    3. Save
    => Notice that the list of fields are displayed following the order you
    chose
    4. Edit it again
    => The order is correctly kept!
    5. Create a new bibliographic record
    6. Notice that the subfields are order in the same sequence
    7. Fill different subfields, not all
    8. Save, edit again
    9. Note that the subfields that have been filled are listed first, then
    the empty ones. But the sequence defined at the framework level is kept.
    10. Do the same for an authority framework and create/edit an authority
    record
    11. Modify item (952) subfields order
    12. Create an item and confirm that the order is correct
    13. Modify the ACQ framework, 952, modify the order of the subfield
    14. Create a new order and confirm that the item form has the subfield
    ordered following the sequence defined at the framework level
    
    QA: Note that this patch is about bibliographic records only, next
    patches deal with authotiries and items.
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 742483e7e3d99a7cc9c66608bc0c2adce9a3e1cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 1 18:11:35 2020 +0100

    Bug 8976: Add marc_subfield_structure.display_order
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 482d77b536ed89b9c6b354ab50dfb4a86fa472ca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 14:10:39 2021 +0000

    Bug 27316: DBRev 20.12.00.015
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1d85738cca1acb0f2b1617d5607bfd644cb7b99
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 8 13:13:48 2021 +0000

    Bug 27316: (follow-up) Default to 1 if undef in mappings
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dd997e2d38a0ec07411166e5e497d48d95f9437
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 7 20:14:33 2021 +0000

    Bug 27316: Convert 'undef' for sort to Yes and use Yes/No instead of 0/1
    
    This patch changes the interface to remove the undef option
    We also update existing mappings and set default of 1
    
    Comment previously indicated undef was treated differently, but in the code we treat undef as 1
    That code is untoched to avoid creating problems for older mappings that may be reloaded
    
    To test:
    1 - View the ES mappings, note you can set columns to Undef, 0, 1
    2 - Set some to undef
    3 - Apply patches
    4 - Update database
    5 - Undef now show as 'Yes'
    6 - Confirm you can set columns as Yes/no
    7 - Confirm that mandatory columns display correct value when readonly (see issues field)
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79064a88639ba725cc898cb940c85ff3fb1d4bee
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 26 14:44:23 2021 -0300

    Bug 27680: Add support for param[] syntax
    
    While not that common nowadays, it is the syntax PHP uses, and
    DataTables also generates such thing in 'traditional' mode. We should
    support it as well.
    
    This patch adds support for that. It does so by adding _order_by[] to
    the reserved param names, and proper handling on the dbic_merge_sorting
    helper.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/Objects.t
    => SUCCESS: Tests pass!
    3- Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Bug 27680: (QA follow-up) Minor perlcritic issue
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc23981b46e67a6d9ee91a2065293ac472341bed
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 12 19:25:10 2021 +0000

    Bug 27680: Allow traditional multi-params to work
    
    This patch allows the preceeding test to pass. Strictly, we want a comma
    delimited string for our _order_by parameter, but we cannot easily block
    a traditional multi-passed parameter.  As such the 'nice' thing to do is
    handle it when such a thing is passed as it will pass through validation
    regardless.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2a43a77aabd9cf885d6dc9b72458a00bbc28ac9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 12 14:05:13 2021 +0000

    Bug 27680: Add tests for various ways of passing multi-params
    
    This patch adds unit test to increase the coverage of parameter that
    accept multiple values.  There are a number of different ways end users
    can send such parameters and we should test to ensure we are recieving
    the correct option.
    
    Options
    `?param1=this&param1=that` - traditional multiple pass params
    `?param1[]=this&param1[]=that` - php multiple pass params
    `?param1=this,that` - comma delimited list param
    `?param1=this|that` - pipe delimited list param
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa1671aba529e55f124eb759f3b09e237a7282fe
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 12 13:14:16 2021 +0000

    Bug 27680: Add support for sorting fields with multiple data points
    
    This patch adds proper handling for sorting a single column that is
    constructed of multiple data entities.. i.e `"data": "string1:string2"`
    
    It does NOT add support for filtering on multiple columns yet.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba7f51f3d12fe2a66b8094d9a10a234a3f4e7c4d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 12 10:53:27 2021 +0100

    Bug 27680: Take first order column for ordering
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2b6e414824952a5b9ee2537fd11f1a8e824e316
Author: Mason James <mtj@kohaaloha.com>
Date:   Fri Feb 19 02:39:19 2021 +1300

    Bug 27673: remove libyaml-syck-perl, and lower libyaml-libyaml-perl to 0.41 (for u16)
    
    1/ apply patch
    2/ build koha package
    3/ confirm that libyaml-libyaml-perl package is installed, and
        libyaml-syck-perl is not
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae62da0ff6a3fa5df3e01fce656fccc02ce6a55e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 22 17:51:16 2021 +0000

    Bug 27754: Correct eslint errors in basket.js
    
    This patch makes minor changes to basket.js in the staff interface
    templates in order to quiet warnings from ESLint. Besides whitespace,
    most changes are to correct undeclared or unnecessarily declared
    variables.
    
    To test, apply the patch and verify that the cart still works
    correctly.
    
     - Perform a catalog search in the staff interface.
     - Test adding single or multiple items to the cart from the search
       results page.
     - Testing adding and removing titles to the cart from the bibliographic
       detail page.
     - Open the cart and test the various controls in the toolbar to confirm
       that they still work correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f0b0e0556127c9ed191b1b741c4cf466b28e1d6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 29 13:47:22 2021 +0000

    Bug 27578: Initialize searchid as blank when not populated
    
    This patch simply sets the searchid to a blank string if not passed in
    
    To test:
    1 - Add a new biblio and save it
    2 - Check the logs: /var/log/koha/kohadev/plack-intranet-error.log (or similar)
    3 - Note warn about uninitialized value
    4 - Apply patch
    5 - Add a new biblio
    6 - No warn
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a2a04a641289f6043971dd98037e02fbb30f64f
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Jun 17 04:34:02 2020 +0000

    Bug 25777: Disable misleading datatables table information display z3950
    
    This patch disables the table information display on z3950_search.pl,
    since it only includes search result counts for that page, which is
    misleading to end users.
    
    To test:
    1)  Do not apply the patch
    2)  Do a Z39.50 search from cataloguing for "test" against Library of
        Congress.
    3)  Note the bottom of the page says "Show 1 to 20 of 20" and
        "Showing page 1 of 501"
    4)  Do a Z39.50 search from Acquisitions for "test" against Library of
        Congress (Acquisitions -> Vendor -> Basket -> Add to basket -> From
        external source).
    5)  Apply the patch and restart Plack
    6)  Repeat Step #2
    7)  Note the bottom of the page now only says "Showing page 1 of 501"
    8)  Note the search bar is gone
    9)  Repeat step #4
    10) Note the bottom of the page now only says "Showing page 1 of 501"
    11) Note the search bar is gone
    
    Squashed and mixed authorship added below
    Co-authored-by: Owen Leonard <oleonard@myacpl.org>
    Co-authored-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa8a60ddc8ac45404b6159fde5c758e4b0dad60b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Feb 25 13:33:31 2021 -0500

    Bug 27798: Add warning to IndependentBranches system preference
    
    Test Plan:
    1) Apply this patch
    2) Search system preferences for IndependentBranches
    3) Note the warning about changing the setting on a production system
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD Amended patch:
    * Fix commit title
    * Don't split the syspref's description, otherwise the sentence will be
    split in the POs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37b7d0a4ed9536108710b5df4d46ebfb8b47e53b
Author: Andrew Nugged <nugged@gmail.com>
Date:   Wed Feb 24 11:45:07 2021 +0200

    Bug 27718: (follow-up) add missing return
    
    Missing return doesn't allowed for "wantarray" state to DBIXc so sub returned scalar in any context.
    
    Also blank line to match with coding style removed.
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffe5eefcbc873ad60780a5339c24d0925f65e6e9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 16:11:52 2021 +0100

    Bug 27718: (bug 24488 follow-up) Hide items not holdable
    
    After bug 24488 was merged Holds to Pull list (/cgi-bin/koha/circ/pendingreserves.pl)
    doesn't respect anymore the 'holdallowed' circulation rules (we bisected it to this change).
    If we look at the patch "Bug 24488: Show correct first patron details on Holds to pull"
    (2285c2d6575) then we can notice that previously the items that were shown in the list
    must had holdallowed != 0:
    
    Now it seems like similar circ rule check is missing in the newly rewritten Holds To Pull implementation.
    (description copied from comment 0)
    
    Test plan:
    Have several pending holds
    Mark some item type as not holdable in the circulation rules
    Confirm that the non holdable items are no longer listed on the "Holds
    to pull" view
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42e9cceebc66d7fb02d01cbfd96cc3520e1f2875
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 16:11:19 2021 +0100

    Bug 27718: Add tests
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3710f34f1b3ec73e44824ead8fb16a2c9e81c072
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 10:27:20 2021 +0000

    Bug 7806: DBRev 20.12.00.014
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ede97e3aeb761a93c60e89623855f7aa3f49d53
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 24 15:07:38 2021 +0000

    Bug 7806: (follow-up) Update to use sanitize_zero_date
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 099e2fe2b700c388e4939b2b2505773056d3383e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 18 15:16:11 2020 +0100

    Bug 7806: Fix remaining occurrences of 0000-00-00
    
    We should remove all SQL queries that contain 0000-00-00 and finally
    assume we do not longer have such value in our DB (for date type)
    
    We already dealt with such values in previous update DB entries.
    The 2 added by this one haven't been replaced already.
    
    The code will now assume that either a valid date exist, or NULL/undef.
    
    Test plan:
    QA review is needed and test of the different places where code is
    modified.
    
    Not sure about the change from reports/issues_avg_stats.pl
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e3803ee20dc3dfc3d21e5cafa7a76159c8d4aba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 1 11:14:32 2021 +0100

    Bug 27821: Make sanitize_zero_date support datetime and timestamp
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 782ae187797d27ead5405a591cbfa203a5f0c58e
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Jan 5 05:08:54 2021 +0000

    Bug 26363: Change SyslogIdentifier to match koha-worker script style
    
    This patch changes the SyslogIdentifier so that it matches
    the style used by koha-worker.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e21b86f66938c12ddc62b06ac08c9e510ef2e8e
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Oct 6 06:33:05 2020 +0000

    Bug 26363: Provide a systemd unit file for koha-worker in package installs
    
    While the packages already have a koha-zebra script that creates a service
    using the 'daemon' utility, this unit file template provides an alternative.
    
    Note that currently you'd have to start the service using the following:
    
    ```systemctl start koha-worker@NAME.service```
    
    Where NAME is the name of your Koha instance.
    
    The systemctl enable/start commands could be automated more with helper
    scripts in debian/scripts, but this is a first step.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21a850a3dccc07bd5b6423bc8c9a902aba7958fc
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Oct 6 06:30:56 2020 +0000

    Bug 26363: Provide a systemd unit file for koha-worker for source installs
    
    This patch adds a systemd unit file which gets rewritten according to
    the configuration specified by Makefile.PL. This can be linked or
    copied to systemd directories for running a systemd service for
    background_jobs_worker.pl
    
    Test plan:
    1. perl Makefile.PL
    1a. Choose "single" installation
    1b. Choose "/opt/koha" for a file path
    2. make
    3. vi blib/KOHA_CONF_DIR/koha-worker.service
    4. Verify that PERL5LIB, KOHA_CONF, ExecStart, and SyslogIdentifier
    all appear to be correctly filled in
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3beeb020ef7d8ef733f34ffef5202bb328a8b867
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 26 10:26:27 2021 +0000

    Bug 26457: (QA follow-up) Switch to PK index in UPDATE on issues
    
    The deadlock reports tell us that multiple transactions are
    waiting for a X lock on a record but using a secondary index
    on borrowernumber and itemnumber. Since we have the issue_id
    at hand already, we should use that and benefit from the clustered
    index (on PK) instead of using a secondary index.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e05ad0c1f827c9670f7bfb7f2112c380f0da5c04
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 24 12:22:49 2020 +0000

    Bug 26457: Unit test
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4062116352e6136e846f8a1c0567323c2c122213
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Dec 4 12:03:52 2020 +0000

    Bug 26457: Throw exception if update of issues table fails
    
    While this won't prevent the deadlock, it should catch the case where
    a deadlock causes the DB update to fail and provide feedback to the user
    and rollback the transaction
    
    I don't know how to trigger the deadlock, I can only confirm that we see it, and
    that this should catch it.
    
    To test:
    1 - Apply patches
    2 - Checkout several items to a patron
    3 - Confirm that 'Renew all' feature continues to work as expected and all items are renewed
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3495a7e9af70706e3ebba60e3fac7aa3845d1d78
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Feb 22 09:27:12 2021 -0300

    Bug 27071: (follow-up) Get rid of loop
    
    This patch gets rid of a loop on the librarary's groups siblings, and
    acknowledges ->get_hold_libraries returns a proper Koha::Libraries
    iterator that can be chained with a new query on the passed branchcode.
    This way we only fetch  a count from the DB and no loop needs to take
    place on the code.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Libraries.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e8e15cc64a8b09fc9575af4b9fcbae437293715
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 9 12:26:50 2021 -0300

    Bug 27071: (follow-up) Provide a more meaningful error message
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa221e0c8bcf0fa0377d6c2154bad0ef61c97a2b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 9 12:14:19 2021 -0300

    Bug 27071: Use GetReservesControlBranch to pick the branch
    
    Pretty much like the opac-reserve.pl does, this patch makes the staff
    request.pl script get the branch from the specialized routine from
    C4::Reserves instead of falling back to userenv.
    
    To test:
    1. Follow the original test plan:
    - Create two local hold groups containing distinct lists of libraries.
    - In default rules for all libraries, set Hold Policy = "From local hold group" and Hold pickup library match to "Patron's hold group"
    - Make sure AllowHoldPolicyOverride is set to Don't Allow
    
    - Make sure you're logged in at a library in Group 1
    - Find a bib with only 1 item from Group 1. Confirm you can place a hold on this title for a patron in Group 1 (correct), but not for a patron in Group 2 (correct).
    - Find a bib with only 1 item from Group 2. Confirm you cannot place a hold for a patron from Group 1 (correct), BUT you also cannot place a hold for a patron from Group 2 (incorrect) -- Koha gives the erroneous message "pickupNotInHoldGroup"
    
    - Change your library to a something in Group 2
    - Find a bib with only 1 item from Group 1. Confirm you cannot place a hold on this title for a patron in Group 1 (incorrect), and not for a patron in Group 2 (correct).
    - Find a bib with only 1 item from Group 2. Confirm you cannot place a hold for a patron from Group 1 (correct), but you can place a hold for a patron from Group 2 (correct)
    => FAIL: Things expected to fail on the plan, fail.
    2. Apply this patches
    3. Repeat 1
    => SUCCESS: It now works!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1de7ec0697c75c3161d950b9f6f6c8d99640b607
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 24 11:55:14 2020 -0300

    Bug 27071: More tests for Koha::Library->validate_hold_sibling
    
    This patch adds tests for more than one non-same sibling libraries in
    the hold group. Tests pass which means it is working as expected.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Libraries.t
    => SUCCESS: Tests pass
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6606d4a6567a00f2defd72a32ff466c01a54e96
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 23 15:52:56 2020 +0100

    Bug 27071: Code simplification
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b445425ebaffe4ec4aab3c45cb4ae4f2d4bf172
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 23 15:49:35 2020 +0100

    Bug 27071: Fix Hold pickup library when using hold groups
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 197c1fedc67d65dce6935f1bac863b078b94e885
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Sat Feb 20 09:57:20 2021 +0000

    Bug 27715: (QA follow-up) Remove conditional declaration
    
    Resolves:
    FAIL critic # Variables::ProhibitConditionalDeclarations: Got 1 violation(s).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2b5570f083c30a8f22f6b4e93a1a1e44bc55778
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Feb 19 14:18:15 2021 +0200

    Bug 27715: Use $dbh->quote_identifier to quote untrusted input
    
    The sanitization using regex and \w class of characters might be
    enough but given the vast number of unicode characters in \w and
    possibility of in the future the database engines interpreting some of
    those characters with special meaning it is better to wrap the column
    identifier to quotes using $dbh->quote_identifier so it is only
    interpreted as identifier and nothing else.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9223d4d9be7cbf1b978f1d6a7855fccc703c27e8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 18 15:54:56 2021 +0100

    Bug 27715: Add a deprecation notice
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 893e60acbc1f0acb22a9bfe85219fcf76af41092
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 18 15:49:40 2021 +0100

    Bug 27715: Sanitize order by DT params
    
    We are not on the safe side when we build the ORDER BY clause from the
    DataTables parameters.
    
    I've started to limit the columns by using Koha::Objects->columns, but
    for instance for the patron search we need (at least) the columns from
    the branches, categories and members tables.
    It seems easier, and still safe, to use a regex.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88dce684cfdab8db96589d005ffb6119ecc58b79
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 18 15:42:48 2021 +0100

    Bug 27715: Add tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Amended: chmod 755.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a8fcc28db29e07e36bd17fbaf29bd463a79c7bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 18 14:49:02 2021 +0100

    Bug 27715: Remove unused dt_build_having
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Amended: removed warn.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0fb19a9e035b8fbfdaafbbff3d46bc419b845188
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 18 14:47:03 2021 +0100

    Bug 27715: Remove unused build_dt_query
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83277da4e23c4a2c8e8de172ebf104d4e345a477
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 23 13:20:08 2021 +0100

    Bug 27661: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2387ac731c03ecfa6cd20e7e71037bbd3c3ac046
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 11:22:50 2021 -0300

    Bug 27593: Consistent behavior for club holds route
    
    This patch:
    - Fixes a malformed response when biblio_id is invalid
    - Fixes the return status (400 => 404) when biblio_id is invalid
    - Adapts the error strings to be consistent with the Cities.pm file
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/clubs_holds.t
    => FAIL: Tests fail
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 024a32ca807bb69b3d46136421dce871ba0bddbf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 11:18:27 2021 -0300

    Bug 27593: Regression tests
    
    This patch introduces tests for the behaviour change (400 => 404) and
    also adds tests for untested (error) behaviours. Notably, the 'Biblio
    not found' problematic return value couldn't be triggered, because the
    OpenAPI plugin returns a 500 because the response was malformed
    (expected { error => 'message' } and it was returning a string).
    
    For the above reason, running the regression tests will show a 500...
    instead of the expected 400.
    
    I covered the rest of the codepaths that trigger errors to have full
    coverage.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/clubs_holds.t
    => FAIL: Tests fail loudly
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b1939fe927079f1fb0e7533002df7788f33575d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 19 14:42:49 2021 +0000

    Bug 27733: Add "_sort_by" paramter to pickup_locations API query
    
    On the place hold page in the staff interface, add a "_sort_by"
    parameter with the "name" value so that the list of libraries is
    returned in name order.
    
    To test, apply the patch and locate a title in the staff interface which
    has holds on it.
    
    - View the holds information for that title.
    - In the table of exising holds, expand the "Pickup library" dropdown
      for any of the entries. The list of libraries should be in order by
      library name.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a9865d40a14ff9ecbbd53637f7bb28e6acda9ae
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 19 14:27:08 2021 +0000

    Bug 27732: JavaScript error on place hold page in the staff interface
    
    This patch moves the "$.fn.select2.defaults" definition from the top of
    the page to the bottom so that jQuery will be loaded first.
    
    The patch also changes the "dropdownAutoWidth" default so that the
    dropdown is sized correctly for its contents, regardless of the width of
    the initial <select>.
    
    To test, apply the patch and place a hold in the staff interface for a
    title which already has existing holds.
    
    - On the "Place a hold" page, before selecting a patron, you should see
      a table of exising holds. Test the "Pickup library" dropdown. It should
      work correctly.
    - The width of the dropdown should accommodate its contents without
      forcing any library name to wrap.
    - There should be no errors in the browser console.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebb70e4d16df961698e379c8208984809ad340be
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 16 13:48:04 2021 +0000

    Bug 27713: Duplicate search field IDs in MARC framework administration template
    
    This patch makes a minor change to the MARC framework administration
    template so that the ID of a form field on the page isn't a duplicate of
    one in the header search form.
    
    To test, apply the patch and go to Administration -> MARC bibliographic
    framework -> MARC structure.
    
    - Test the "Search for tag" form field to confirm that it works
      correctly.
    - Validate the HTML of the page to confirm that there are no "Duplicate
      ID" errors.
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0182ab805b436f346637cae196e851371005552
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 5 09:54:54 2021 +0100

    Bug 27332: Hide branchcode and note is RenewSerialAddsSuggestion if off
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6aa9f78258444a5db6ba9997491865f13ff96404
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 5 08:10:33 2021 +0100

    Bug 27332: Use the branchcode from the subscription when renewing
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2029b7ef8b414c207bc703e769b7e3721e9488b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 19 08:57:25 2021 +0100

    Bug 27661: Use td.bg-success for ES and memcached as well
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab23dfa3a14fd7d1ecdd78d755476f8afcd69efa
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 18 16:56:21 2021 +0000

    Bug 27661: (QA follow-up) Use bootstrap classes
    
    This patch removes the local status_* css rules in favour of using the
    bg-* rules that are shipped with the bootstrap version we are using and
    then updates the relevant lines in the template to use those classes.
    
    We also update the default table styling which adds background color to
    the odd table rows so that our local classes take precidence.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fdd6f94844139fd54d82dabf1c0d571def47c10e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Feb 12 15:41:24 2021 +0000

    Bug 27661: (QA follow-up) Capitalization
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ed120dfb587e7c82ebda391abbfe9806d15dc81
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Feb 9 13:53:55 2021 +0000

    Bug 27661: Update about for message broker status
    
    This patch updates the about page with regards to the message broker
    status and adds some small formatting improvements for displaying the
    status.
    
    Test plan
    1/ Run through the yarn build process to update the CSS file.
    2/ View the about page without RabbitMQ installed
    3/ View the about page with RabbitMQ installed
    4/ Note the formatting and message change and signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4c3d1e93c337d93679e50f2354c8b060e50bcd9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 19 10:17:26 2021 +0000

    Bug 27729: Fix use of grep and split in CheckReserves
    
    A few lines of code were added to CheckReserves containing the wrong
    use of two perl functions: grep and split on bug 25232.
    A test was added even making these things pass.
    
    Test plan:
    Run t/db../Holds.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9c6365793de79730210429d1689300881181277
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jan 12 11:15:28 2021 +0000

    Bug 27014: (QA follow-up) Add regression tests
    
    This patch adds a regression test for the change introduced in the
    patchset.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05e16389efa6e66476484ee12c3a5c5fdd48757b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Nov 13 08:24:43 2020 -0500

    Bug 27014: Enable C4::SIP::ILS::Patron::new to accept a hash
    
    Caused by bug 23403 - when performing a checkin we lookup the SIP patron
    using the borrowernumber, however, SIP only knows how to find a patron
    via cardnumber or userid
    
    The change on 23403 was to avoid using an 'id' that didn't always exist
    (as some users don't have a userid or cardnumber
    
    When checking in, however, we are not passed a user cardnumber or
    borrowernumber, so we don't have those on hand to get the patron.
    
    Test Plan:
    1) Check in an item via SIP, note patron is not found
    2) Apply this patch
    3) Restart all the things!
    4) Check in an item via SIP, patron should be found!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 506b8f125b7c7dda1dc70b4963026ea975a8c655
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 12:03:56 2021 +0100

    Bug 27714: Prevent Koha::NewsItem->author to explode
    
    If the author of a news has been removed, Koha::NewsItem->author must
    not explode
    
    DBIC result _type  isn't of the _type Borrower at t/db_dependent/Koha/News.t line 68.
    
    Test plan:
     prove t/db_dependent/Koha/News.t
    must return green, and changes must be consistent
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6527b105897e4611dd702ffbe627ca579baff77
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 11:52:17 2021 +0100

    Bug 23675: Add leader and default value for ACQ
    
    When UseACQFrameworkForBiblioRecords is set, the ACQ framework will be
    use when ordering.
    But the leader is not defined for this framework and then we will face
    encoding issues (I haven't go far investigating this as the suggested
    solution worked correctly).
    
    The idea is to define a 000 and default to '     nam a22     7a 4500'
    (which is what returns the marc21_leader.pl plugin) for ACQ.
    
    Test plan:
    0. Apply this patch and reset_all
    1. Create a new basket and place a new order
    2. Note that the leader is now displayed on top of the other ACQ
    subfields
    3. Fill in 245 with "❤️", "ö" or other UTF-8 characters you like
    4. Save
    5. Notice that 245$a in biblio_metadata is correctly filled with the
    title you entered
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a52a0f80b890d70bb51c8629afbf4d81c2901491
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 8 13:14:42 2021 +0000

    Bug 26051: We should sort callnumber based on cn-sort
    
    In zebra we sort by callnumber using 8007 cn-sort
    
    We should do the same in elasticsearch
    
    To test:
    1 - Have Koha using Elasticsearch
    2 - Perform a search
    3 - Attempt to sort by callnumber
    4 - Error in logs: No mapping found for [local-classification__sort]
    5 - Apply patch
    6 - Restart all
    7 - Perform a search and sort by callnumber
    8 - Success!
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8790fe908d0207f1923aaad87dc48eecb5747d40
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 22 09:02:11 2021 +0100

    Bug 26051: Add sort=1 on cn-sort in mappings.yaml
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdfb78a69a1f78488b800bd38392c60812717cc7
Author: Philippe Blouin <blou@inlibro.com>
Date:   Tue Jan 26 15:36:31 2021 -0500

    Bug 23929: Invoice adjustments should filter inactive funds
    
    Looking at invoice details, this makes the Adjustments Fund dropdown act
    exactly like the Shipping Fund dropdown above, with a Show inactive
    checkbox to help filter (by default) the inactive funds out of the list.
    
    Test plan:
    0) requires a database with inactive (old) funds along with active ones.
    1) Go to invoice details page
    2) Click "Add adjustment"
    3) Open the drop down beside the Fund label, you should see EVERY fund in database.
    4) Compare with behavior of Shipping fund dropdown above.  Not every fund is listed there
    5) Apply patch
    6) Now behavior is the same, only active fund are listed by default.
    7) click "Show inactive" checkbox and see all the funds in the dropdown.
    
    Signed-off-by: Sonia BOUIS <sonia.bouis@univ-lyon3.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f45d083f9aafb512ea615e99e0ac4228f0872077
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 19 11:46:16 2021 +0000

    Bug 27731: Remove hold class from individual OPAC search result hold link
    
    This patch removes the "hold" class from the "Place hold" link
    associated with each search result in the OPAC. The class isn't required
    for any functionality or style and it unintentionally triggers the "hold
    multiple" JS function which requires that a checkbox be checked.
    
    To test, apply the patch and log into the OPAC as a user who can place
    holds.
    
    - Perform a catalog search which will return multiple results.
    - Click the "Place hold" link under any search result.
    - You should be taken to the hold confirmation page.
    - On the search results page, confirm that the "Place hold" link at the
      top of the search results still works to place multiple holds at once.
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74ae74d5faec9a4ba4fbf573b4a81b1274402773
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 4 17:37:26 2021 +0100

    Bug 27626: Fix self registration if categorycode is hidden and PatronSelfRegistrationVerifyByEmail
    
    If categorycode is selected in
    PatronSelfRegistrationBorrowerUnwantedField and
    PatronSelfRegistrationVerifyByEmail is turned on, the patron self registration
    fails with
    
       [You must provide a patron's category to validate password's strength
       and length] at /usr/share/perl5/Exception/Class/Base.pm line 88
    
    Test plan:
    0. Select categorycode in PatronSelfRegistrationBorrowerUnwantedField
       and turn on PatronSelfRegistrationVerifyByEmail
    1. Self register a patron
    2. Confirm that it works as expected with this patch applied.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57a15eb474b5a8a6a199df1d324c30b7df0544d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 27 09:43:02 2021 +0100

    Bug 27534: Add missing ON UPDATE/DELETE clause to message_transport_type_fk
    
    Bug 9016 (3.15.00.039) added message_transport_type_fk but the ON DELETE
    CASCADE ON UPDATE CASCADE clause was missing from the updatedatabase
    entry.
    If we are upgrading from an old version, 20.06.00.058 will fail on
    updating the message_transport_type, with
    "Cannot delete or update a parent row: a foreign key constraint fails".
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63e3311b109797a60bf6dcaf34e16abb8e3f9fda
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 19 12:14:55 2021 +0000

    Bug 26997: (QA follow-up) Fix Typo
    
    Feel free to squash this ;)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a40b4bb509c306794930ef734513a982e418af5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 19 10:52:45 2021 +0100

    Bug 26997: CAST AS CHAR to prevent the error
    
    To prevent the DBMS to fail on 0000-00-00 we can cast it as a char and
    compare.
    This patch also moves to a subroutine, in case we need to adjust (or
    reuse) it later.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e0700a691621b2ef1de46fa0ea18ee771daadaf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 13 13:59:46 2020 +0100

    Bug 26997: Remove 0000-00-00 from aqorders.datecancellationprinted
    
    This patch remove the 0000-00-00 from the WHERE condition from
    ordered.pl and spent.pl to prevent an error under MySQL 8
    
    It also fixes the wrong values in DB (if possible, ie. under other DBMS
    that MySQL 8)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c087bc216eeab8fe0d68a2d33407b554bc57074
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 14:22:50 2020 +0100

    Bug 26997: Fix upgrade process under MySQL 8
    
    If you are coming from an old version of Koha, you may face an upgrade
    error for the SQL query using 0000-00-00.
    The idea was to fix it, but actually the DBMS will raise an error (not
    blocking the upgrade process however).
    
    We can hide them to not cause confusion
    
    Errors are like:
    DBD::mysql::db do failed: Incorrect date value: '0000-00-00' for column 'suggesteddate' at row 1 [for Statement "UPDATE suggestions SET suggesteddate = '1970-01-01' WHERE suggesteddate = '0000-00-00';"] at /kohadevbox/koha/installer/data/mysql/updatedatabase.pl line 23312.
    
    Test plan:
    Checkout an old version of Koha (3.20, not older)
    Insert a dump, install Koha
    Checkout a recent version of Koha, apply the patch (or use master)
    Execute the upgrade process
    You should not see the errors
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a825c729386e7f528846445937e00eda92f01f68
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 3 19:13:15 2020 +0000

    Bug 26208: Perform batch checkin/renewals serially rather than asynchronously
    
    The issue here seems to be that when multiple requests hit at once they may not register that the renewal
    performed by the request should lift restrictions on the account.
    
    To mitigate this we can simply perform the renewals one after the other.
    
    To test:
    1 - have multiple overdue items on one patron
    2 - run overdues.pl with triggers set to generate a restriction
    3 - renew all overdues with the Renew All button
    4 - restriction is not removed even though patron no longer has overdue items
    5 - Apply patch
    6 - Make all items overdue again
    7 - Click Renew All
    8 - Items are renewed and restriction removed
    9 - Checkout items to patron again (overdue or not)
    10 - Click 'Select all' in checkin column
    11 - Click 'Renew/Checkin selected items'
    12 - Confirm checkin succeeds as before patches
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26208: (follow-up) Remove debugging statements
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 010f361fe6e8c8d102af4e4cd6559f10d046f305
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 18 12:00:42 2021 +0100

    Bug 27131: Improve POD for the new method
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d2092e36f3d801802856452195726b1baf494cb
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Feb 12 15:57:22 2021 +0000

    Bug 27694: use HTML filtering on News Tool textarea
    
    To test:
    1. Add some HTML enties to your codemirror in the News Tool. Example: <option value="(itype:DVD and loc:*NEW) AND NOT index-term-genre:&quot;television&quot;">Movies</option>
    2. Save and re-eneter the tool, the HTML entites have been converted
    3. Apply patch
    4. Try again, HTML entities should not be converted
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3cf9a1ef9370df59aedb4a441bbab2644f214d3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Feb 18 07:47:11 2021 +0000

    Bug 27131: (QA follow-up) POD and comments
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 731ec77b99fdfc3bf5e92ea8a8a661c27ca69dc7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 5 09:29:07 2021 +0100

    Bug 27131: Add tests for get_items_that_can_fill
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 919caa19c888cd1a01f9ddbcbbb39caa85f096e6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 09:23:42 2020 +0100

    Bug 27131: Add get_items_that_can_fill
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03a9bdc851dcfe114c1676ac55def1e1c5d51970
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 12 10:27:43 2021 +0100

    Bug 24469: Move the new queries to a dedicated ImportBatch subroutine
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: POD line for $import_record_id.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bc460e00501a5161a5ac1700dc8d1ce7b76730c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 12 16:22:02 2020 +0100

    Bug 24469: Record biblionumber in import_biblio when adding to basket via file
    
    The column import_biblios.matched_biblionumber was not populated when an
    order is created from a staged file.
    
    Test plan:
    A/ Create a new order from a stage file.
    Use the "Save" button at the bottom of the "Add orders from" page
    Then note the matched_biblionumber value. It should be populated correctly
    
    B/ Import again the same record, this time you will have to use the "Add
    order" link in the list of order (ie. not the "Save" button)
    Note the matched_biblionumber value. It should be populated correctly
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Sarah Daviau <sdaviau@arlingtonva.us>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 740331c39e65aca18244bbf759ed6f722eeb0ac9
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Feb 17 12:49:32 2021 -0300

    Bug 27719: Apply _escape_str and _escape_price where needed
    
    This bug replaces calls for .escapeHtml and format_price for there null
    checking counterparts
    
    To test:
    
    1: have a fresh Koha Testing Docker
    2: have a basket set to create item records on ordering
    3: populate basket from a marc file, only setting price and fund for the items
    4: close basket
    5: click to Receive, create invoice
    6: on parcel.pl, "Processing" alert never resolves
    CHECK => The console shows:
    parcel.pl?invoiceid=1:810 Uncaught TypeError: Cannot read property 'format_price' of null
        at render (parcel.pl?invoiceid=1:810)
        at datatables.min_20.1200012.js:57
        at Object.b.fnGetData (datatables.min_20.1200012.js:51)
        at B (datatables.min_20.1200012.js:56)
        at Ha (datatables.min_20.1200012.js:64)
        at P (datatables.min_20.1200012.js:68)
        at vb (datatables.min_20.1200012.js:79)
        at datatables.min_20.1200012.js:76
        at i (datatables.min_20.1200012.js:74)
        at Object.success (datatables.min_20.1200012.js:75)
    
    And that error points toward:
                            "data": "replacement_price",
                            "render": function(data, type, row, meta) {
                                return (row.replacement_price).format_price();
                            },
                        },
    7: apply patch
    8: redo steps 5 and 6
    SUCCESS => "Processing" alert doesn't hangs, and prices with null values
    are empty.
    
    Sponsored-by: Virginia Polytechnic Institute and State University
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6bd75d6dcaf77a7d5b11c1eabcbdb17ae0f6e12a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 15:28:41 2021 +0000

    Bug 24108: DBRev 20.12.00.013
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0269d2b30ec3f0a90c57782229a575113c3dfc96
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 16 12:17:29 2021 +0100

    Bug 24108: Remove extra spaces
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f755c3ab150c1a530b63cad188d0171ae81efb0
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Feb 15 22:48:04 2021 +0100

    Bug 24108: (QA follow-up) Add staff detail page to syspref description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 231b3487e225af66a4bade50249567a3c2048c9a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Feb 15 22:47:28 2021 +0100

    Bug 24108: (QA follow-up) Add missing comma in sysprefs.sql
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 234cced91df51c2460152897f8c08e0b891d240c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 11 14:57:45 2021 +0000

    Bug 24108: Make export file names consistent
    
    This patch renames the systempreference to be a bit clearer and uses
    explicit options rather than a yes/no
    
    Additionally it standardizes the export from the advanced cataloging editor
    with that from the details page
    
    To test:
     1 - Apply patches
     2 - Update database and restart all the things
     3 - Open a record in the advanced editor and save it as marc and xml
     4 - Note the file name is 'bib-{biblionumber.{format}'
     5 - Edit the syspref 'DefaultSaveRecordFileID' to be control number
     6 - Repeate 3-4 on a record with and without a control number
     7 - If control number present fiule name should be 'record-{controlnumber}.{format}'
     8 - Otherwise it should be as above
     9 - Repeat tests from the details page of a record
    10 - Repeat tests from the opac details page of a record
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b1f162dccfe0f7edc1505fc0648dfa7f7792ca8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 11 14:08:35 2021 +0000

    Bug 24108: (QA follow-up) Adjust wording and use perl for update file
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88b751e54fef91ca69156ea02895d7dcdcafbf99
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Dec 1 18:45:50 2020 +0000

    Bug 24108: (follow-up) Fix typo with .xml extension
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch:
    * Fix author's patch
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 227077c43dee8f2837cceaa23f9a0d97d721f01e
Author: Cori Lynn Arnold <carnold@dgiinc.com>
Date:   Tue Dec 1 18:16:23 2020 +0000

    Bug 24108: Advanced editor: configure if biblionumber or control number is used for saved files
    
    Creates a new system preference "SaveRecordbyControlNumber" (renamed in
    follow-up patch with "DefaultSaveRecordFileID") which is
    initially set to 0 (off/no). By default saving .mrc (and .xml) will be
    saved by the biblionumber. If the record does not yet have a biblionumber,
    the record will be saved as record.mrc or record.xml
    
    Test plan:
    1)  Apply the patch, flush_memcached and restart_all
    2)  Enable the "EnableAdvancedCatalogingEditor" system preference
    4)  Save the record using the drop down box selecting "Save as MARC (.mrc)
        file.
    5)  Note that the file saved is the same as the biblionumber at the top of
        the Advanced Editor interface.
    6)  Repeat steps 3-5 for the .xml save option
    7)  Update the new system preference "SaveRecordbyControlNumber" and
        change to "Save by ControlNumber"
    8)  Verify that there is not a 001 field in the record (delete it if
         there is)
    9)  Repeat steps 3-5 for both .mrc and .xml options (the file should still
        be saved as the biblionumber if there is no control field)
    10) Add a 001 field to the record such as "001  abc00012345"
    11) Repeat step 4 for both .mrc and .xml and verify that the files
        saved are named abc00012345.mrc and abc00012345.xml
    12) Sign off!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch:
    * Remove change to obsolete sysprefs.sql
    * Fix author's patch
    * Update commit message to tell the syspref has been renamed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02b9c904fee4f910fc71dcad1a473659830702d8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 17 15:00:15 2021 +0000

    Bug 26274: (QA follow-up) Fix the order of summary groups
    
    The grouped income/outgoing summaries were not being explicitly
    ordered and it appears the default ordering for MySQL 8 is different to
    that of MariaDB and previous versions of MySQL and as such was causing
    test failures for that version. This patch adds an explicit sort on the
    'description' for each debit_type and credit_type grouping.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02b056508df4c4e7e3eb33a5f354300339e8048d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 09:20:59 2021 +0100

    Bug 27673: Fix t/Context.t
    
    YAML::XS is not failing on that string, it generates
      'uno - dos' => "asd"
    
    This new string is not YAML valid because of
    "found a tab character that violate intendation"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aba8a17713377ecd36a11f3b8961fd6b4e8e0c9d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 12 15:37:22 2021 +0100

    Bug 27673: (follow-up) Fix encoding issues - Dump
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e5c5b9fba2af0cabc1f36ebb9d48615a52136ae
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Feb 11 14:49:18 2021 +0000

    Bug 27673: (QA follow-up) Remove unused YAML::XS import
    
    The last use of this module was removed in commit
    "Bug 27673: Fix encoding issues - Dump".
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a562101fdcdf5e276baff5b5c130979a3398cadf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 10:52:44 2021 +0100

    Bug 27673: Fix encoding issues - Dump
    
    Same as Load, but for Dump.
    
    Test plan:
    Edit ES mappings, replace withdrawn's label with "withdrawn ✔️ ❤️ ★"
    Export the mappings
      perl misc/search_tools/export_elasticsearch_mappings.pl > admin/searchengine/elasticsearch/mappings.yaml
    Reset mappings from the UI
    => Notice that the label is correct
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61f88c4c50aa05c1283fd0a715663e4ad3e369b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 10:44:04 2021 +0100

    Bug 27673: Rename C4::Circulation decode to _decode
    
    To prevent conflict with Encode::encode
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fafcbff015fe8e7abe31cf8a0668b17d1bc729bb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 10:37:13 2021 +0100

    Bug 27673: Fix encoding issues
    
    There is a difference between YAML::Load and YAML::XS::Load
    From YAML::XS pod:
    "YAML::XS only deals with streams of utf8 octets"
    
    Test plan:
    We are going to test 1 occurence and QA will confirm others don't
    contain typos.
    0. Don't apply the patches
    1. Create a new itemtype with code=❤️
    2. Create a new item using this itemtype (to biblionumber=1 will work)
    3. Fill OpacHiddenItems with
     itype: [❤️]
    4. Search for "street shuffle" or any terms that will return the biblio
    Notice that the item is there (there is an error in logs)
    5. Apply the patches
    6. Repeat 4 and confirm that the item is now hidden
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46f7239b08691a34616748db6cc10d18cc4fb16f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 10 15:28:10 2021 +0100

    Bug 27673: Replace YAML with YAML::XS
    
    From tht YAML pod:
    
    """
    This module has been released to CPAN as YAML::Old, and soon YAML.pm will be changed to just be a frontend interface module for all the various Perl YAML implementation modules, including YAML::Old.
    
    If you want robust and fast YAML processing using the normal Dump/Load API, please consider switching to YAML::XS. It is by far the best Perl module for YAML at this time. It requires that you have a C compiler, since it is written in C.
    """
    
    See also
    https://gitlab.com/koha-community/qa-test-tools/-/merge_requests/35
    
    Test plan:
    Try some place where YAML::XS is not used and confirm that it works
    correctly
    
    QA note: This patch removes some uses of YAML that were not useful
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76c38d10d06dfcc377ab82cd312b12b8457a2dc8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 16 09:06:03 2021 +0100

    Bug 27707: (bug 26639 follow-up) Fix renewals when RenewalSendNotice is set
    
    Since bug 26639 we have auto savepoint enabled and the LOCK TABLE query
    in C4::Circulation::SendCirculationAlert is not correctly handled.
    From the MySQL doc that is copied few lines before, "LOCK TABLE will
    commit any transactions", but here we don't have a savepoint and the
    release for a non-existent savepoint will throw a DBI exception.
    
    This patch removes the unecessary transaction and prevent the following
    error when a renewal is done:
    > DBIx::Class::Storage::DBI::mysql::_exec_svp_release(): DBI Exception: DBD::mysql::db do failed: SAVEPOINT savepoint_0 does not exist [for Statement "RELEASE SAVEPOINT savepoint_0"] at /usr/share/koha/lib/C4/Circulation.pm line 3590
    
    Test plan:
    1. Enable RenewalSendNotice
    2. Add some email address to patron and select the email box from the message preference "Item checkout and renewal" in order to receive renewal emails.
    3. Check 1 item out to a patron
    4. Renew it
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93bc3af5a9b72d5d15a76648e9b9cd7a963bd05f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 15:57:24 2021 +0100

    Bug 27569: Fix ODS export - take empty string into account
    
    If a cell contains an empty string it was not taken into account.
    
    Test plan:
    Same as CSV but with ODS
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0f1d27dd2160a39bb76fd27ecd8b2b9c6056db5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 15:56:08 2021 +0100

    Bug 27569: Change av for 100$2
    
    Switch from "#" to ""
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce92a756a8e4058b29cf32ea016bac75f6228b9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 15:27:53 2021 +0100

    Bug 27569: Add tests for ODS export
    
    Looks ok so far
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad5de74cbc43e500c34ae6fa50958c6848d1586f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 14:50:52 2021 +0100

    Bug 27569: Fix CSV export for biblio frameworks
    
    The CSV import of the biblio frameworks is broken.
    A change in LibreOffice resulted in CSV not formatted how the
    C4::ImportExportFramework code is expected.
    This code is quite broken, it expects all the CSV cells to be quoted.
    
    The "add tests" patch shows the different between what we expected
    before this patch, and what is the new version generated by LibreOffice.
    
    Test plan:
    Export a biblio framework in CSV
    Open it with LibreOffice and save it undef a different name
    Create a new biblio framework and use the new file to construct it
    Compare the 2 frameworks and make sure they are identical
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c11f056268195bac6c660182db97d4f2684b50a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 14:54:15 2021 +0100

    Bug 27569: Add tests
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c0b2c09173ddf7a576b4373e831937e8370b159
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 15:27:19 2021 +0100

    Bug 27569: Don't hide errors!
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfd42a4eb26a2ac00fe116f22409779047edd02b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 15:59:37 2021 +0100

    Bug 27569: Remove non mysql code
    
    Remove a bit of the confusion by removing unless code (not related to
    mysql)
    
    Signed-off-by: Ron Houk <rhouk@ottumwapubliclibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0e64bde51b85d7477119be8ec147cbb0df51d21
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 15 10:34:15 2021 +0100

    Bug 27706: (bug 24488 follow-up) Fix libraries column filter
    
    From commit 2285c2d65752dcc899d3fdcff634e6927a1cbbf0
         Bug 24488: Show correct first patron details on Holds to pull
    
                   $('select', this).change( function () {
    -                  var filter_value = $(this).val();
    -                  holdst.fnFilter( filter_value, 5, true );
    +                  holdst.fnFilter( $(this).child().val(), 5 );
                   });
    
    This does not make sense, we need to filter on $(this).val(), it's a
    select element.
    
    Test plan:
    Place some holds
    Hit the pending holds page
    Use the "libraries" column filter and confirm that it works correctly
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d459283e81a57cb1c417d79c47b0f9965ba56ae
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 16 10:15:38 2021 +0100

    Bug 27380: Add missing use statement
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 121b633cad109b2873ecc1b2ead3f9e3734bfb13
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 16 09:30:20 2021 +0100

    Bug 27604: Deal with empty pref
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 539af7bd5afedb5b1749e05c084fb9ef2ec44a7f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 15 11:01:46 2021 +0000

    Bug 27598: DBRev 20.12.00.012
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 701055f8891527dd21688d2d31a082fdb39b74f7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 8 14:10:19 2021 +0000

    Bug 27598: (QA follow-up) Add category description and installer data
    
    This follow-up makes two additions:
    
    - The UPLOAD category is added to auth_val_cat.sql for new
      installations.
    - A description of the category is added to the authorized values
      template.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 289fe72614c43eb18aa911c8e6f54879db15918e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 2 16:42:03 2021 +0000

    Bug 27598: Add UPLOAD as a built-in system authorized value category
    
    This patch updates the database so that it includes an "UPLOAD"
    authorized value category with the "is_system" flag set to 1.
    
    The upload tool template is updated to add a link to the authorized
    value category from the hint which appears if no authorized values exist
    in the UPLOAD category.
    
    To test, apply the patch and run the database update.
    
    - If you have manually added an UPLOAD category it should now be
      classified as a system category.
    - If you did not have an UPLOAD category it should have been created for
      you.
    - With no authorized values in the UPLOAD category, go to Tools ->
      Upload.
      - Logged in as a user with permission to manage authorized values you
        should see a note, "No upload categories are defined..." It should
        contain a link directly to the UPLOAD category of authorized values.
      - Logged in as a user without authorized value permission you should
        see a similar note without the link.
    - Add an authorized value in the UPLOAD category and confirm that the
      note disappears.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30d92f92481c6ab6871f1b92df9600793ded98a1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 29 15:24:20 2021 +0000

    Bug 18146: (follow-up) Remove warn for uninitialized value
    
    In the previous patch you may have noticed many warns when running the tests
    
    We add guarantor charges to a variable to determine if over the limit, but we don't initialize that value
    
    We should
    
    To test:
    1 - Apply first patch and follow test plan
    2 - Note warns when proving test
    3 - Apply this patch
    4 - prove
    5 - No more warns
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03bb55f1047621ba41c589d8d3774f23cdde6241
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 29 15:19:26 2021 +0000

    Bug 18146: Fix tests for OverduesBlockRenewing
    
    This pref was supposedly covered by tests, but the conditions were wrong
    and we didn't test the reasons we were failing so the code was being missed
    
    To test:
    1 - Add a warn around in the conditional at line 2748:
    } elsif ( ($hasoverdues and $overduesblockrenewing eq 'block') || ($itemissue->{overdue} and $overduesblockrenewing eq 'blockitem') ) {
         warn "SUCCESS!"
         return ( 0, 'overdue');
    }
    2 - prove -v t/db_dependent/Circulation.t | grep SUCCESS
    3 - No output
    4 - Apply patch
    5 - Repeat
    6 - SUCCESS!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9a97d4802716dab50ba90272d93d3dcf5ea98c8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 29 12:39:21 2021 +0000

    Bug 12966: Add edition field to Card view
    
    To test:
    1 - Search Z3950 to add a record
    2 - Find a record with an edition statement
    3 - It shows in the table of results
    4 - Check the card view
    5 - No edition
    6 - Apply patch
    7 - Repeat
    8 - Edition shows in card view
    
    Signed-off-by: Marjorie <marjorie.barry-vila@collecto.ca>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dce123700bbc330a5500b9138877ab515e90523a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 11:04:32 2021 +0100

    Bug 8326: Add tooltips
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c038b0f1664f267a635790fefb43971ffc88d06b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 11:03:17 2021 +0100

    Bug 8326: Add aria-disabled to li's
    
    To have the same display of "Editable in OPAC"
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a066f03b5e89f1a031565c024c05864449153ba6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 7 15:36:24 2020 +0200

    Bug 8326: Make repeatable and unique_id modifiable when editing patron attribute type
    
    This patch add the ability to modify the attribute "repeatable" and
    "unique_id" for a patron's attribute type.
    Prior to this patch it was not possible, to keep data integrity.
    
    When editing an attr type, the controller will check is the value can be
    modified, depending on the existing patron's attributes.
    
    Test plan:
    0/ Setup
    Create 1 patron attribute PA1 that can be repeatable
    Create 1 patron attribute PA2 that does not have the unique restriction
    Create 1 patron attribute PA3 that cannot be repeatable and does not
    have the unique restriction
    
    1/
    Edit them and confirm that you can modify the repeatable and unique
    restrictions
    
    2/ Restore values from 0.
    Create a patron P1 with several PA1, PA2=42 and whatever in PA3
    
    3/ Edit PA1 => you cannot remove the repeatable flag but can still
    remove the unique
    
    4/ Create a patron P2 with PA2=42
    
    5/ Edit PA2 => you cannot add the unique flag
    
    Play a bit more with the different combinaisons and confirm that it
    works as advertised.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35994c1da5f5a7d29a192310822bf41a978d0a1f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 16 15:28:50 2020 +0100

    Bug 8287: Improve "show checked out items" filter on the overdues report
    
    The "Show any items currently checked out" was confusing, especially if
    the "From" and "To" due date filters were passed.
    
    This patch moves the checkbox close to the 2 other filters and show/hide
    the due date filters when needed.
    
    Test plan:
    0. Have some overdue
    1. Search for overdues
    2. Confirm that the filters are shown/hidden depending on the status of
    the checkbox
    3. Fill "To" with a date, tick the checkbox, submit the form
    => Confirm that the date was not taken into account
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a63748e241ccfc2ae4dc4487c5c6cb87b1b54b84
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 9 19:31:33 2021 +0000

    Bug 27653: Use div instead of caption for controls
    
    The funds and acquisitions home page tables use captions for additional
    table controls. These are more appropriate as "toolbar" divs.
    
    This patch converts the <caption> to <div class="toolbar btn-toolbar">
    and moves it just above <table> in the markup to keep it valid.
    
    To test:
    1 - View the tables on acquisitions home and budgets views
    2 - Note the 'Expand all...' control row
    3 - Apply patch
    4 - The row remains, but is below the table controls
    5 - The row is not included when printing or copying the table
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1acbe07f0b0b8b3fa8af604054027c7dfe7cf64a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 5 19:38:03 2021 +0000

    Bug 27646: Allow export of Acquisition home and Funds tables
    
    This patch swtiches these tables ot use KohaTables with exporting enabled
    
    To test:
    1 - Apply patch
    2 - Confirm acquisitions home and funds tables display correctly
    3 - Confirm you can export the tables
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee0384184630b6c1b4c74e7a250e1cbc71c3e17f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 8 15:21:24 2020 +0200

    Bug 26406: Fix suggestions filter at the OPAC
    
    There is an input filter but it does nothing
    
    Test plan:
    You need 2 differents users, U1 and U2
    Create several (at least one) suggestions for each of them
    Test the following with and without OPACViewOthersSuggestions:
    With U1 logged in, go to the suggestions tab and use the input to filter
    the suggestions.
    It should work correctly.
    Also play with the "Suggested by" options
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a86242c2ea6ecdc2e9cf26dd7343c09926f68287
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 10 11:30:45 2021 +0100

    Bug 27669: Fix 'importing' and 'reverting' statuses when importing/reverting a batch
    
    SetImportBatchStatus is not called with $batch_id
    
    It has been caught by bug 25026, and www/search_utf8.t fails with
    t/db_dependent/www/search_utf8.t .. 14/87 Error POSTing http://koha:8081/cgi-bin/koha/tools/manage-marc-import.pl: Internal Server Error at t/db_dependent/www/search_utf8.t line 240.
    
    And, from logs:
    
    manage-marc-import.pl: C4::ImportBatch::SetImportBatchStatus(): DBI Exception: DBD::mysql::st execute failed: Truncated incorrect DOUBLE value: 'importing' [for Statement "UPDATE import_batches SET import_status = ? WHERE import_batch_id = ?" with ParamValues: 0=undef, 1='importing'] at /kohadevbox/koh
    a/C4/ImportBatch.pm line 579: /kohadevbox/koha/tools/manage-marc-import.pl, referer: http://koha:8081/cgi-bin/koha/tools/manage-marc-import.pl?import_batch_id=2
    
    Test plan:
    Read the changes and confirm it does make sense.
    Import and revert a batch
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e128c6e93fc7cb87db0d054b6c2778e40555543
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 12 14:31:01 2021 +0100

    Bug 27380: FIX Reports/Guided.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40ccb7f37138e0bf31345608459eb7a9ba666027
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 12 12:11:54 2021 +0100

    Bug 27068: Perltidy _checkHoldPolicy
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20c97bca2dc1b742dff5d8828cf83a5543571e91
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 12 12:10:31 2021 +0100

    Bug 27068: Don't 'cache' Koha::Libraries
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fac4c54eadf7794ef3fae04131cb3e132cdd7d39
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jan 29 07:48:21 2021 -0500

    Bug 27068: Add unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fba0bda9a9899dd7efa157ea11ee68ef836a5159
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 3 06:48:13 2020 -0500

    Bug 27068: Fetch libraries once for speed
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f71452b934ef83c57ac2f74c0c7b0ea2b39e2cd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 3 06:34:33 2020 -0500

    Bug 27068: Fix errors in _checkHoldPolicy
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e82091f40a5193ff3fb47073ddb9b11f94645276
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Dec 2 20:04:51 2020 -0300

    Bug 27068: Control hold group logic in HoldsQueue
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b27a85f83966cd86b60609d04aa5a31a06c2684
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 4 10:56:15 2021 -0300

    Bug 26274: (QA follow-up) Minor fixes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7878aa00123d79065692b046e2a7538d313a6c1f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 28 17:20:29 2021 +0000

    Bug 26274: Update register.tt to use the API
    
    This patch updates the existing register details page to utilise the new
    api routes to gather the summary details on demand.
    
    Test plan
    1/ Enable cash registers
    2/ Add some transactions
    3/ Perform a cashup
    4/ Click 'Summary' next to the last cashup date
    5/ Note the modal appears as it did prior to the patch being applied.
    6/ Check the print option still works
    7/ Signoff
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ba40e1adf53ad84ac1e123ce08e2c7c242704ba
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 19 08:34:35 2020 +0100

    Bug 26274: Add cashups api routes
    
    This patch creates a Koha::Cash::Register::Cashup(s) class pair which
    subclass Koha::Cash::Register::Action(s) and moves the cashup specific
    code into these new classes to improve code separation.
    
    We then introduce API routes based on these classes to allow fetching
    a list of cashups associated to a cash register and a full cashup with
    emeddable summary for individual cashups.
    
    Test plan
    1/ Run the updated unit tests.
       t/db_dependent/Koha/Cash/Register/Action.t
       t/db_dependent/Koha/Cash/Register/Cashup.t
    2/ Run the incuded api tests.
       t/db_dependent/api/v1/cashups.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3cfa9b1e993481defd6e7ec796031ec31279bf71
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 6 16:18:07 2020 +0000

    Bug 26958: Move Elasticsearch mapping template JS to the footer
    
    This patch moves inclusion of JavaScript to the footer of the
    Elasticsearch mapping template. It also moves the JS into a separate
    file.
    
    To test you should have SearchEngine system preference set to
    "Elasticsearch."
    
     - Apply the patch and go to Administration -> Search engine
       configuration (Elasticsearch).
     - Confirm that JavaScript dependent interactions work correctly:
       - Tabs
       - Under the bibliographic records and authorities tabs, table row
         drag-and-drop
       - Under the bibliographic records and authorities tabs, test the
         "Add" line at the bottom of the table.
       - Under the bibliographic records and authorities tabs, test the
         "Delete" button.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2f5ecc069693314e2db4393615b904e54003d3b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Feb 1 14:54:48 2021 +0000

    Bug 27380: (follow-up) Remove earlier declaration and unused assignment
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45ec6ba3a4596c8cd82247ca00852e894f0bba01
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 11 20:07:39 2021 +0000

    Bug 27380: Move get_prepped_report to object and use for svc/reports
    
    This patch moves get_prepped_report to Koha:Report->prep_report
    and adds some basic tests
    
    To test:
    1 - Using the report created in last test, hit the report svc api like:
    http://localhost:8081/cgi-bin/koha/svc/report?id=6&param_name=One&sql_params=One&param_name=Listy|list&sql_params=2345%0D%0A423%0D%0A3%0D%0A2%0D%0A12
    2 - Note the use of %0D%0A to separate list params
    3 - Test with combinations with and without param_name specified
    http://localhost:8081/cgi-bin/koha/svc/report?id=6&sql_params=5&sql_params=2345%0D%0A423%0D%0A3%0D%0A2%0D%0A12
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD Amended patch: Perltidy prep_report
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3acbc9f4dc2da565f589934b25e642d960b032fb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 11 17:13:38 2021 +0000

    Bug 27380: Add 'list' option to Koha report parameters
    
    TODO: Need to address the svc endpoints
    
    To test:
    1 - Create a 'New SQL report' like:
        SELECT * FROM items WHERE itemnumber IN <<Itemnumbers|list>>
    2 - Run the report
    3 - You should have a text area where you can enter various itemnumbers
    4 - Enter some valid and invalid itemnumbers
    5 - You get the info for the valid itemnumbers, no error for the others
    6 - Test adding other params to the report and ensure things still work as expected
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f58c271b4255e85b3b6ddf90a9e802249954cc13
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Feb 8 16:04:48 2021 +0200

    Bug 27654: Sort module.keys hash when render columns_settings.tt
    
    On the "Administration -> Table settings" page, the order of
    "tables related to pages" sections is different with each page refresh.
    Cause of that is that Perl gives random order for hash keys where
    those elements are stored on template render. To avoid that we
    add a "sort" method where getting keys similarly how it was done
    previously to display tables always in the same order.
    
    To reproduce:
        1) Head over to /cgi-bin/koha/admin/columns_settings.pl
        2) Open any collapsed module settings, for example
    "Acquisition tables". Check the order of pages.
        3) Reload the page. Check the order of the same elements again.
    They always come in random order, it's easily distinguishable.
        4) Apply the patch.
        5) Repeat steps 1-3 again and ensure that the order of pages
    stays the same no matter how many times you reload the page.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4bb20fdb30202018f1519c6bd336e33fa6732d9e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 9 16:01:59 2021 +0100

    Bug 27645: Prevent "is on hold" warning to be displayed twice
    
    During a batch checkout we display the "item is on hold" message
    depending on different conditions.
    However it can happen the message is displayed twice.
    
    If the checkout is not impossible then we see:
    This item is on hold for another patron.
    This item is on hold for another patron. The hold will be overridden, but not cancelled.
    
    We should only display the second one.
    
    Test plan:
    With a default ktd setup you can simply place an item on hold and use the
    batch checkout tool to check it out
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15fcd755a24b07fc959210d2cb812d571bea3faf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 10 17:30:25 2020 -0300

    Bug 26181: Disable override by default in /holds
    
    This patch disables AllowHoldPolicyOverride by default in /holds. It
    also adds a header that can be used to request the override explicitly.
    
    Tests are added for this behaviour
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => FAIL: Tests fail because the behaviour is not implemented
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 758732c052bc56f0f24213d95febfe5736baa1f0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 10 17:30:13 2020 -0300

    Bug 26181: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f3152d453c8b5f2a366b916b50d3265d3ef135b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Feb 3 14:48:37 2021 +0000

    Bug 23767: Total children only if parents not visible
    
    This patch changes the way to calculate the footer. It adds the budget and parent ids to the cell
    as custom data elements. When totaling we grab a list of all the rows we are showing - if a
    row has a parent and the parent is showing then we skip adding its value to the total.
    
    As the function is used on both acqui-home and aqbudgets I adjusted both templates
    
    To test:
    1 - Follow the test plan on previous patch
    2 - Try filtering the table so you see only the child funds
    3 - Confirm the totals show the child alone when it is visible
    4 - Confirm the child total is excluded when the parent is visible
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07150a0a850845e8ff16bee6f85fdc74d510ec5e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 7 17:19:27 2019 +0000

    Bug 23767: Include child funds in total spent and ordered on acqui-home
    
    To test:
     1 - Have three funds, two parents and one child
     2 - Open a basket and add an order to each fund
     3 - View acqui-home.pl
     4 - Note that ordered values are only added from the two parent funds
     5 - Complete these orders (close basket, receive)
     6 - Note the spent only includes parent funds
     7 - Place three more orders, one from each fund
     8 - Now you can see both spent and ordered are incorrect
     9 - Apply patch
    10 - Reload, all should add correctly
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c242e98f9e1724902690ced4e913b589125ca59
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Aug 19 10:30:29 2020 -0400

    Bug 26059: Add unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cd08373b1eca33ba1b8bd867b6de5d40c0d7242
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 24 12:18:44 2020 -0400

    Bug 26059: Create guarantor/guarantee links on patron import
    
    The change to allow multiple guarantors was meant to maintain the
    ability to import patrons with a Koha patron guarantor, but is not
    working as intended.
    
    A) Adding the guarantor simply doesn't work
    B) We have two columns named 'relationship', one for the borrowers
    table, and one for the guarantor relationships table. This clearly
    doesn't work and will cause confusion. The one for the guarantor
    relationships table should be renamed.
    C) guarantor_firstname and guarantor_surname in the CSV file do nothing
    and should be removed.
    
    This patch also fixes a minor issue that causes warnings like:
    CGI::param called in list context from
    /kohadevbox/koha/tools/import_borrowers.pl line 124
    
    Test Plan:
    1) Create a CSV with contents like:
    cardnumber,surname,firstname,branchcode,categorycode,guarantor_relationship,guarantor_id
    bloop,gloop,froop,MPL,J,father,48
    brim,flim,zim,MPL,J,father,48
    2) Attempt to upload this file, ensure you have a borrowernumber 48 that
    can have guarantors
    3) Note the accounts are not linked
    4) Apply this patch
    5) Restart all the things!
    6) Upload the file again
    7) The patrons should now be linked!
    8) Download the starter CSV file
    9) Note the second relationship column is now guarantor_relationship
    10) Note the columns guarantor_firstname and guarantor_surname are no longer present
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Marti Fuerst <mfuerst@hmcpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00b012c82d78fed0658758514d393d093f2ece0e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 16:39:19 2021 +0100

    Bug 27671: Use Koha.Preference for UniqueItemFields
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7166fabeeb03e2d4e803fab9a9e6f1181318a42d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 10 11:04:42 2021 -0300

    Bug 27671: Restore missing include in orderreceive.tt
    
    Caused by
      commit 15e35f77fb29137a5421ff79a1186087508aa68f
      Bug 23376: Move AcqCreateItem logic to template
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f831130525c62f799c831dd7eb1b36065b60c172
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 11 11:21:43 2021 +0100

    Bug 27676: Correct finesMode ne off condition
    
    finesMode is 'off' by default (sysprefs.sql), but if you modify its value from
    the UI and set it to 'production' then back to 'off', the DB value becomes an
    empty string '', because of $YAML::Syck::ImplicitTyping
    
    This has been found when working on on removing YAML::Syck (bug 22824),
    so it's not perfect but the situation will be cleared in the follow-up
    bug report.
    
    Test plan:
    0. Don't apply the patch
    1. reset_all
    => finesMode eq 'off' in DB
    2. Set the pref's value to production
    3. Switch it back to 'off'
    4. Value is '' in DB
    5. Check an item in that should generate overdue charges
    => Charges are not generated
    6. Apply the patch
    7. Check an item in that should generate overdue charges
    => Charges are generated
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa178bcf6a31cc4335fe417c89d85bc94f279667
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 3 10:46:31 2020 +0100

    Bug 25026: Use HandleError to not raise or print error
    
    DBIC has its own HandleError, and so it does not work to unset
    RaiseError or PrintError if unsafe is not set (what we don't want here).
    
    The idea of this patch is to overwrite the HandleError when we need it:
    Either if KOHA_DB_DO_NOT_RAISE_OR_PRINT_ERROR is set (misc4dev)
    Or if the installer is triggered (we don't want to explode if the DB
    does not exist).
    
    There is an additional trick, when the installer is completed, we want
    to restore the original behaviour, and so a disconnect is made.
    Note that during the installer we want to display eventual SQL errors,
    that's why we still display the errors.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de14c96249e648c29aecbf759413c3c7ec094d18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 30 15:30:45 2020 +0100

    Bug 25026: Turn on RaiseError
    
    This is a follow-up for bug 22001.
    
    The patch "Bug 22001: Set unsafe only if RaiseError is not set" proved that
    unsafe => 1 and RaiseError => 0 was wrong.
    We should move forward and turn RaiseError for the UI, and... see what's happening.
    The change goes to the right direction, but we need to know how big is the task
    to have a stable release with these parameters correctly set.
    
    We will have a lot of fun once this patch is pushed! :)
    
    Test plan:
    0. Does not apply the patch
    1. Add, somewhere in mainpage.pl
      C4::Acquisition::NewBasket();
    2. restart_all
    3. Hit the mainpage
    => Hum... nothing happens! However there is an error in the logs
     DBI Exception: DBD::mysql::db do failed: Column 'booksellerid' cannot be null
    No basket has been created!
    4. Apply the patch, restart_all
    5. Hit the mainpage
    => Here we go, there was something wrong and the user is aware of that!
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91ddddd8ebefaeb079b093ae71fb02bc5481fec7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 9 08:44:00 2021 +0000

    Bug 18506: DBRev 20.12.00.011
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a5e8a2d0adcfeecc2ee0b62fb53ae0c7e1488626
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Feb 3 15:48:29 2021 +0000

    Bug 18506: (QA follow-up) Indentation and more conditionals
    
    Indentation fixes for readability
    
    Cleaned up a few places where the ability to login otherwise was leakign through
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch: Remove trailing spaces
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5ab335d1b312791b6353379ddd34cbd162a6529
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 3 12:45:45 2021 +0000

    Bug 18506: (QA follow-up) opacShibOnly -> OPACShibOnly
    
    As requested
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a81264ac1fff96d6a678ec7abe730e1ac2c9dbc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 26 12:39:15 2017 +0100

    Bug 18506: Add xShibOnly preference for Shibboleth authentication
    
    This patch adds two system preferences to Koha, opacShibOnly and
    staffShibOnly, allowing users to restrict authentication to just
    one method, Shibboleth.
    
    We do however, allow for local fallback for the SCO/SCI logins.
    
    A system preference was chosen over a configuration file update to
    allow for local override at the virtualhost level. In this way a
    hosting provider can setup a 'backdoor opac' for example to allow
    fallback to local logins for support operations.
    
    Signed-off-by: Matthias Meusburger <matthias.meusburger@biblibre.com>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 768c113bc00109faf730c51c2b26d39d4d5d7671
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 9 09:43:45 2021 +0100

    Bug 27605: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c02351ff94c416292f48270bda024fa2f201289
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 8 21:47:59 2021 +0000

    Bug 27605: (follow-up) Make the feature work with Bug 27403
    
    This patch adds the "fh-fixedHeader" class to the floating toolbar so
    that the floating DataTable header knows what element to append itself
    to.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6117ca9958ad937d602cb25adec2fe2d9e25a4f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 3 15:39:26 2021 +0000

    Bug 27605: Add floating toolbar to patron search page
    
    This patch modifies the patron search results page so that the toolbar
    with results-related controls "floats" when the user scrolls down. This
    gives access to the controls for adding patrons to a list and for
    merging patrons.
    
    Other templates are modified to incorporate a change to the CSS which
    changes "#searchheader" to ".searchheader," enabling multiple instances
    of a <div> styled with the .searchheader class.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Go to Patrons in the staff interface.
     - Perform a patron search which will return many results.
     - Scroll down the page far enough to trigger the floating toolbar.
     - Confirm that the toolbar is positioned correctly when paging through
       results.
     - Confirm that the patron list and merge controls still work correctly.
     - Confirm that other pages which used the "#searchheader" id are still
       styled correctly:
       - Catalog search results
       - List contents
       - Patron list contents
       - Add orders from MARC file
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59941d0b904f950abf0007ff0aac5fd61bf11b36
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 19 14:02:37 2021 +0000

    Bug 27403: (follow-up) Make basket toolbar and table header work together
    
    The fixed header option for DataTables does the same thing that the
    hcSticky jQuery plugin does for us on toolbars, so I've gone through the
    templates looking for places they might conflict.
    
    On the acquisitions basket page we can add a special class,
    "fh-fixedHeader," to the sticky toolbar to tell DataTables that the
    table header should float *below* the toolbar.
    
    To test, apply the patch and go to Acquisitions.
    
    - Locate a vendor and a basket for that vendor with multiple orders.
    - Adjust the browse window height if necessary to trigger vertical
      scrolling.
    - Confirm that as you scroll down the toolbar (with buttons "Add to
      basket," "Edit basket," etc) sticks to the top of the browser window.
    - Confirm that as you continue to scroll, the table header sticks below
      the floating toolbar.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f16e88d59bd8a888d8b0a30a0d481f7ef02ddd0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 19 16:20:32 2021 +0100

    Bug 27403: Disable fixedHeader on itemsearch
    
    It does not work.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acb024396b836176e17a7b41ffa133e5e7399ff7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 16:33:43 2021 +0100

    Bug 27403: Add fixedHeader to Datatables
    
    That's a great plugin to have fixed header.
    
    Test plan:
    On the cities table or the patron search table confirm that the header
    is floating is you scroll down
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c8adefecb7bde4243717cd8a52fbe689f21939ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 16:07:48 2021 +0100

    Bug 4037: Correctly join the itemtypes array
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8057a433f6fed432367a0a80e3c62446fd5697c2
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jan 18 10:12:59 2021 +1300

    Bug 4037: Add item type filter to inventory tool
    
    This patch adds the ability to filter inventory by item type. Multiple
    item types can be selected at once.
    
    To test:
    1) Apply patch and restart services.
    2) Set up (at least) one item of a specific item type.
    3) Go to Tools -> Inventory.
    4) Scroll down to find the item types filter. Confirm the 'select all'
    and 'clear all' buttons work as expected.
    5) Select a few item types, but DO NOT include the item type that you
    just set for your item. Confirm that your item does not show in the
    results.
    6) Go back to the Inventory tool. This time submit a search that DOES
    include the item type you just set for your item. Confirm that your item
    does show in the results.
    7) Confirm tests pass:
    prove t/db_dependent/Items/GetItemsForInventory.t
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Württemberg (BSZ)
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 175a1eddd1efdf70a60b5fb0fb8dc52a9211c65f
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Feb 8 16:11:04 2021 +0200

    Bug 27655: Add barcode "columnname" to "column_settings.yml"
    
    Preferences of the "Holds to pull" table missing the "Barcode" column.
    This patch appends that column name to the "column_settings.yml"
    in correct order. This also led to checked out columns in this settings
    page that were not those which were hidden when the table displayed
    (i.e. columns were shifted).
    
    To reproduce:
        1) Head over to /cgi-bin/koha/admin/columns_settings.pl
        2) Open the collapsed "Circulation" list, go to the "Holds" page
    and find preferences of the "Holds to pull" table there.
        3) Check that the "Barcodes" column is missing from it.
        4) Mark the last few columns for not to be
    displayed (for example, three) and save the preferences.
    Remember the column names you checked out.
        5) Open the circulations section, then open "Holds to pull" report
    when you have there some elements displayed, you should notice that
    hidden columns shifted by one, as well if you press "gear" icon to
    quickly enable/disable the columns, you will see those unchecked in
    list last three will be not those you marked out.
        6) Apply the patch.
        7) Reload the "table settings" page, check that the "Barcodes"
    column is present.
        8) Check that on the "Circulation -> Holds to Pull" page all
    columns hidden accordingly and properly (as explained in step 5.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05a3d926f00d8b8f8b0d14bb91f23290e8684c18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 9 09:20:40 2021 +0100

    Bug 27154: Fix test if the cache is populated already
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e6b5483503e7feb0afc6ef526a675bde767dd8e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 10:27:34 2021 -0300

    Bug 27587: Use Basic auth on API tests - stockrotationstage.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 368104ec267fbd6558ffe82ede1f28153768b951
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 10:09:47 2021 -0300

    Bug 27587: Use Basic auth on API tests - illrequests.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50ae6e371f90a506905aada052abd0300b4dc743
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 09:58:50 2021 -0300

    Bug 27587: Use Basic auth on API tests - acquisitions_vendors.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9bcc8596177a01fd583604423965f844bcc0bb8a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 09:10:16 2021 -0300

    Bug 27587: Use Basic auth on API tests - patrons_password.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db2c902f28acea5f5adc9ff77f08348da10fd6d4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Feb 2 09:09:54 2021 -0300

    Bug 27587: Use Basic auth on API tests - patrons_accounts.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca5efc9aa45c3c7893a09cf0067718fdaab63507
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 3 19:50:29 2021 -0300

    Bug 27422: YouTube videos are HTTPS only
    
    This patch hardcodes HTTPS as the protocol to use when generating
    YouTube content embedding. It is the supported protocol and without this
    patch it falls back to 'http', or it can be 'ftp' depending on the first
    indicator of the 856 field. They are all not supported so hardcoding it.
    
    To test:
    1. Have a record with 856 $uhttps://youtu.be/sMNkDPFycNU
    2. Enable the HTML5MediaYouTube and HTML5Media sysprefs
    3. Open the OPAC detailed view of the record
    4. Open the Multimedia tab
    => FAIL: There's no embedded video
    5. Apply this patch
    6. Restart all
    7. Repeat 4
    => SUCCESS: There's a live performance of Heroes del Silencio!
    8. Sign off :-D
    
    Sponsored-by: Banco Central de la República Argentina
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba5eff837b9d6d004ada5d7289c2c1b7b07ce544
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 28 17:23:45 2021 -0300

    Bug 23830: Adapt callers
    
    This patch is the result of making the same changes we did on the
    t/db_dependent/AuthorisedValues.t file (replacing the calls to
    Koha::AuthorisedValues->search with the tricky branchcode param, and
    call ->search_with_library_limits, with the library_id as a third
    parameter.
    
    What I did was:
       $ git grep 'Koha::AuthorisedValues\->search'
    
    and then revisited each of the grep results to check if they added the
    'branchcode' parameter to the filters.
    
    This patch changes the calls to ->search, for
    ->search_with_library_limits in all the places that require it in the
    current codebase [1].
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Charges/Sales.t \
               t/db_dependent/Ill*
    3. Verify the batchmod.pl script is working and filtering the authorised
       values keeps working
    
    [1] Some places like the Koha/Template/Plugin/AuthorisedValues.pm plugin
    don't seem to be tested, at first glance.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f24b281057fd6a52e59da3ff5136a5aee88b5acb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 28 17:16:24 2021 -0300

    Bug 23830: Make Koha::AuthorisedValues use Koha::Objects::Limit::Library
    
    This patch makes Koha::AuthorisedValues inherit the
    'search_with_library_limits' method from Koha::Objects::Limit::Library.
    This was left out of the original implementation and this patch makes
    this library have a similar implementation to that of Koha::ItemTypes,
    etc.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/AuthorisedValues.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Notice Koha::AuthorisedValues now inherits this new library
    4. Notice the overloaded ->search method is removed
    5. Repeat (1)
    => SUCCESS: The behavior of the newly used method on the tests is the
    same as before. We only changed the method name and how we pass the
    library_id.
    6. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fbfa9da187341d892f230b30ff1d5cf85357293
Author: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
Date:   Fri Nov 27 13:21:11 2020 +0000

    Bug 27050: Allow multiple category_codes in delete_patrons.pl
    
    This patch allows multiple --category_code <categorycode> in delete_patrons.pl
    
    The t/db_dependent/Members.t test has 2 added testcases with multiple category_code.
    
    To test:
    1) Run the test: prove -l . -v t/db_dependent/Members.t
    2) This requires records in the database with at least two category codes. For example PT and ST.
    3) Run the script: delete_patrons.pl --category_code PT
    4) Confirm the number of patrons that would have been deleted.
    5) Run the script: delete_patrons.pl --category_code PT --category-code ST
    6) Confirm the number of patrons that would have been deleted.
    7) Sign Off
    
    Sponsored-by: Lunds Universitetsbibliotek
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58cc70a0cbc5721cdac79954faedf90c4214996c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 5 18:14:55 2021 +0000

    Bug 27643: Add CodeMirror custom syntax highlighting for SQL runtime parameters
    
    This patch adds some additional configuration to CodeMirror so that
    runtime parameters have a distinct color in the CodeMirror SQL editor.
    
    To test, apply the patch and create or edit an SQL report which contains
    one or more runtime parameters, e.g. <<branches>>, <<categorycode>>,
    etc.
    
    Confirm that when editing the SQL, these parameters should appear as
    green text. Save your report and view it. The syntax highlighting should
    be updated in this view too.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fecb9a11fc44f9d1c8bb9be37ad532c7b2ad710a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 4 12:20:27 2021 +0000

    Bug 27618: Don't show dropdown if PatronSelfRegistrationLibraryList only has one library
    
    This patch modifies the patron entry form in the OPAC so that if there
    is only one library to choose from, the input is hidden and the single
    library displays as text.
    
    To test, apply the patch and enable PatronSelfRegistration.
    
    - Modify the PatronSelfRegistrationLibraryList system preference to
      include only one library.
    - Go to the self-registratoin page in the OPAC.
    - Under "Home library," you should see the library name. If you inspect
      the source you should see the library branchcode in a hidden form.
    - Confirm that the form submission includes the correct library
      information.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66bd88a6e621cdf26e81734d7985a00a322b1e06
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 17:08:18 2021 +0100

    Bug 27005: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d32423311a9531ae46fe7bd17009cfc3fd4c043
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 29 12:04:51 2021 +0000

    Bug 27005: (follow-up) Add missing aria-hidden attributes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0214cabf514e05786c2e7c03ce7cc5d3ff5c1042
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 27 12:13:07 2021 +0000

    Bug 27005: (follow-up) Exclude links column from sort and export
    
    I'm adding this as an additional follow-up in case anyone disagrees that
    the "Links" column (defined in the OPACMySummaryHTML preference) should
    be excluded from print and export.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ecd26e4bb926315b4b49709fde6a62ce3804bf5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 27 11:48:47 2021 +0000

    Bug 27005: (follow-up) Enable the exclusion of columns from export
    
    This patch copies code from the staff interface which allows us to add a
    class to table columns which should not be included in print or export
    operations. The hidden column which facilitates the "Checkouts" and
    "On-site checkouts" tabs can now be hidden in prints and exports.
    
    To test, apply the patch and follow the previous test plan. When testing
    the export and print buttons, confirm that the column with
    "standard_checkout" data is not included.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebc20ffef41a62ef31f0be5e5f16cea68ed0107f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 12 11:37:33 2020 -0500

    Bug 27005: Adding a filter in the datatable of opac-readingrecord page
    
    This patch adds a search field and export options to the
    patron's checkout history table in the OPAC.
    
    This patch also adds some showing/hiding classes to controls which
    should only be seen by users with or without JavaScript: The <select>
    for resorting the table is hidden when JS is enabled. The tabs for
    filtering checkouts from on-site checkouts are hidden when JS is
    disabled.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Log in to the OPAC as a user who has both regular and on-site
       checkouts.
     - Go to "Your checkout history."
     - The table of checkouts should have controls at the top: A search
       field, "Clear filter," "Copy," "CSV," and "Print."
     - Confirm that the search filter works: Enter some text which will
       return results among regular or on-site checkouts.
       - It should work correctly to filter the results.
       - If you switch tabs, the filter should persist, and correctly filter
         the results under "Checkouts" and "On-site checkouts."
       - The "Clear filter" button should work correctly to clear your
         search.
      - Test the export and print button to confirm that they work for each
        table.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3323881d508d17d5fcfd9e134281c0778a6590f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 27 20:09:09 2021 +0000

    Bug 26708: Add SQL popup when hovering over name of report
    
    This patch adds an option to preview a report's SQL by selecting
    "Preview SQL" from the "Actions" menu.
    
    To test, apply the patch and go to Reports -> Saved reports.
    
     - In the table listing saved reports, open the "Actions" pop-up menu
       and click the "Preview SQL" link.
     - You should be shown a modal with a syntax-highlighted view of the SQL
       code.
     - The footer of the modal should have options for Edit, Duplicate,
       Schedule, Delete, Run report, and Close.
     - Test that all these buttons work correctly.
     - Test that all of these features work correctly any page of the saved
       reports DataTable.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0751f9b0c9aedf4fd0c35f87895c19a567602e24
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Feb 7 01:56:39 2021 +0000

    Bug 23763: (QA follow-up) Add +x to Search.t file permissions
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 832aa322a822ed3be5d2a2f0b8e3f4f65f4bc32a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 7 14:20:32 2019 +0000

    Bug 23763: Make search on staff and opac use new routine
    
    To test:
    1 - Apply patch
    2 - Search on staff and opac side
    3 - Confirm you can paginate results
    4 - Confirm you see 10 pages on pagination if under page 10
    5 - Confirm you see 20 pages in pagination if over page 10
    6 - Confirm you can go to first or last page
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: perltidy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98e778335015dc822bdd8a053d1c45d9b8eb7b3f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 7 14:19:07 2019 +0000

    Bug 23763: Create a pagination_bar routine
    
    To test:
    prove -v t/Koha/SearchEngine/Search.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: perltidy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05bfbe629f9e34b75fac641a461cf93574c1964d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 1 12:13:03 2021 +0000

    Bug 27582: Fix breadcrumb for POS > Library details page
    
    This patch adds a link back to the top level 'Point of sale' page in the
    breadcrumb for the 'Library details' summary page.
    
    Test plan
    1/ Enable 'UseCashRegisters' and 'EnablePointOfSale'
    2/ Navigate to 'Point of sale' > 'Library details'
    3/ Note the breadcrumb now includes the unlinked' Library details' page
    title and a linked 'Point of sale' in the list.
    4/ Signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 670f00cbaf74653f84353285cea3dda5c3ed82ae
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Feb 4 20:56:11 2021 +0000

    Bug 27606: Add link back to vendor in breadcrumbs for parcel.tt
    
    To Test:
    1. recieve an order:
    When receiving, we get these breadcrumbs:
    Home › Acquisitions › Receive orders from My Vendor
    
    2. apply patch
    Now we get these breadcrumbs:
    Home › Acquisitions › My Vendor› Receive orders from My Vendor
    
    3. Make sure the link sends you back to the correct vendor
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6932e05569aa6be0ed165a28ddc2a4213a3a263e
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Nov 10 21:21:17 2020 +0000

    Bug 26943: Add notforloan statuses to catalog search
    
    - create a positive value and a description of "Positive"
    - set an item to your "Positive" value
    - pull up the related bib in a cataloging search
    - confirm it shows "Not for loan" in the Location column
    - create a negative value and a description of "Negative"
    - set an item to your "Negative" value
    - pull up the related bib in a cataloging search
    - confirm it shows "On order" in the Location column
    - Apply patch
    - re-do the cataloing search, instead of 'Not for loan' or 'On order' you should instead see the actual nfl description
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Telishia Mickens <tmickens@gc.edu>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 133023f3ad86a95da4106669114d3dce39e2db25
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 17:08:01 2021 +0100

    Bug 12260: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8205f0d859bf190b10a52c29a59f253c6bf761c1
Author: Ava Li <rubyli208@gmail.com>
Date:   Tue Jan 19 02:21:01 2021 +0000

    Bug 12260: Hide unnecessary links when printing
    
    TEST PLAN:
    try printing every page in the opac and confirm these sections don't
    show
    
      #cartmenulink { display: none; }
      #listsmenu { display: none; }
      #koha_url { display:none; }
      .breadcrumb { display:none; }
      a[href]:after { display:none; }
      #social_networks { display:none; }
      a.tag_add { display:none; }
      .results_summary.online_resources { display:none; }
      a#Normalview,
      a#MARCview,
      a#ISBDview { display:none; }
      .ui-tabs-panel { border:none !important; }
      #addcomment { display:none; }
      #ulactioncontainer { display:none; }
      #usermenu { display:none; }
      #didyoumean { display:none; }
      #top-pages, #bottom-pages { display:none; }
      #selections-toolbar { display: none; }
      .actions-menu { display: none; }
      #numresults a { display:none; }
      #numresults { float:left; }
    
    Signed-off-by: Stina Hallin <stina.hallin@ub.lu.se>
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8302be444a396a457293b4afd621f6cf1713b738
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 16:06:53 2021 +0000

    Bug 20410: DBRev 20.12.00.010
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06a58fe56df512d6aa770a8a5478bed93e0a17fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 2 16:00:22 2021 +0100

    Bug 20410: Remove OpacGroupResults and PazPar2
    
    This feature is not used as far as we know and it's not known to work.
    It's preferable to remove it.
    
    Test plan:
    Make sure the OpacGroupResults pref code is removed, as well as the
    PazPar2 files and code.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0abc04c774b4de1dd92ab8b678bf76bb7880804
Author: Ella Wipatene <ellawipatene@gmail.com>
Date:   Wed Jan 20 01:56:53 2021 +0000

    Bug 27476: Improve link text for logging in on OPAC
    
    (Note: Must have Shibboleth and CAS added to OPAC)
    1. (Before downloading patch) Go to OPAC
    2. Search for an item in the search bar (i.e. type 'a')
    3. On one of the items, click on 'Place hold'
    4. The links should say 'If you have a Shibboleth account, please click
    here to log in', 'Please click here to log in' and 'If you have a CAS
    account, please click here to log in'
    5. Add patch
    6. Repeat steps 1-3
    7. The links should now say 'Log in using a Shibboleth account', 'Log in'
    and 'Log in using a CAS account'
    
    NOTE: Also noticed on the initial log in box there was the same issue -
    here is the testing for that:
    1. Go to OPAC home page
    2. In the top right click 'Log in to your account'
    3. The link should say 'If you have a Shibboleth account, please click
    here to log in.'
    4. Apply patch
    5. Repeat steps 1&2
    6. The link should now say 'Log in using a Shibboleth account'
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3485c82478a25624e0106eeeb501f3ad84105fbc
Author: Catherine Ma <catherinem2003@gmail.com>
Date:   Tue Jan 19 23:17:39 2021 +0000

    Bug 27404: update labels/label-edit-range.tt for ACC2
    
    Form has been edited in
    intranet-tmpl/prog/en/modules/labels/label-edit-range.tt
    
    Test Plan:
    - Go to Tools > Label Creator > New > Barcode range
    - Verify the input filds for the barcode range behave as
      expected.
    
    Sponsored by Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9195d166e8175044f6f76ff24ecc9399cf0abbe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 3 13:54:27 2021 +0100

    Bug 27454: Pass the arrayref
    
    Otherwise you mess with the following hash elements :)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0821a5890d98d17b58ffecaebbb02d673a864714
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jan 18 10:21:28 2021 +0000

    Bug 27454: Add sorting of patron attributes
    
    This patch adds sorting on class code for the patrons attributes forms
    on the memberentry page.
    
    Test plan
    1) Create a couple of different patron attributes
    2) Go to the patron add page
    3) Note the order in which the patron attributes load at the bottom of
       the page.
    4) Reload the page and note the order of those attribues may change (if
       it doesn't, try reloading again.. it's random)
    5) Apply the patch
    6) Reload the page a few times and confirm the attributes are now
       ordered.
    7) Signoff
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9df4daab1f780f14fed1fba9f4afad8c4c73d30
Author: Ava Li <rubyli208@gmail.com>
Date:   Wed Jan 20 22:37:36 2021 +0000

    Bug 27398: Made values in number patterns subscription length translatable
    
    TEST PLAN:
    Check that the subscription length options when editing or adding a
    numbering pattern in the serials module are translatable. check that
    the hard coded values are gone.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f259298fd4f7b20ccd458af923e6d57a87df32dd
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sun May 31 20:43:38 2020 -0300

    Bug 25632: Update MARC21 frameworks to update Nr. 30 (May 2020)
    
    New
    subfields 0 1 2 in 310 and 321
    
    Changes
    310 change to repeatable
    883 renamed
    883 a d q renamed
    
    To test:
    1) Remove bibliographic frameworks
    2) Check mandatory bibliographic fw load without problem
    misc/load_yaml.pl --load --file=installer/data/mysql/en/marcflavour/marc21/mandatory/marc21_framework_DEFAULT.yml
    3) Check new/renamed fields/subfields
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb692e83ea97a32eb16eb1b1336a67f41c66d0de
Author: Philippe Blouin <blou@inlibro.com>
Date:   Wed Feb 3 11:46:33 2021 -0500

    Bug 27608: Corrects 'accepted by' inconsistency in suggestion.tt
    
    When looking at an accepted suggestion in suggestion.pl, under 'Suggestion management', the displayed cardnumber in parenthesis is the wrong one.  It displays the "suggestedby"'s cardnumber instead of the acceptedby.
    
    Test:
    - create a suggestion in OPAC or staff client with user A.
    - In staff client, go to accept it with User B.
    - Click Edit
    - Under section "Suggestion management", you have a "Accepted on".
    - In the By column, the cardnumber in parenthsis is not the B one.
    - Apply patch, refresh.
    
    Looking at the code patch is self-explanatory.
    
    Sponsored-by: Collecto
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD Amended patch: Add sponsor line
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9cbcbc3120ec32d79660771c268f4ed299f3488
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 14:53:47 2021 +0100

    Bug 27628: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15c3be55afbcff1d5f149f53273bfb25009582a7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 4 17:40:24 2021 +0000

    Bug 27628: Fix minor HTML markup errors in OPAC search results templates
    
    This patch makes a couple of minor corrections to templates related to
    OPAC search results: An errant quote, and invalidly repeating ids.
    
    The #login4tags id is changed to a class, and CSS related to this id
    (which was not used) is removed. For consistency, the id is changed to a
    class on the detail page as well.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Perform a search in the OPAC. Confirm that the "Log in to add tags"
       link still looks correct at various browser widths.
     - Confirm that it works to trigger the login modal.
     - Validate the source of the page. There should be no errors.
    
     - View the detail page for a bibliographic record.
     - The "Log in to add tags" link should look correct and work correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3439d04e1ea9e4232a87a5d10509e763e113aad4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 13:54:53 2021 +0000

    Bug 27581: DBRev 20.12.00.009
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8924206c914154957647bf28e862ed8c8662a677
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 14:47:46 2021 +0100

    Bug 27581: Fix missing occurrences in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3431ddedc71ffecd870cbc138a864c01c25cd8ed
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Feb 6 23:57:41 2021 +0000

    Bug 27581: (QA follow-up) Fix occurence in it-IT custom.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c8f1fad8f2b1881af3da269871a9b3aae54ba52f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 29 19:48:53 2021 +0000

    Bug 27581: Rename USeICU preference to UseICUStyleQuotes
    
    Rather thna have a poorly named preference with an explanation of how it doesn't
    do what it implies it does, let's rename it!
    
    To test:
     1 - Set UseICU to 'Using'
     2 - Go to the details page of a record in the staff interface
     3 - Hover over a subject heading that has subfields
     4 - Note the link has curly brackets around the subject, like:
         http://localhost:8081/cgi-bin/koha/catalogue/search.pl?q=su:{Winnie-the-Pooh Fictitious character}
     5 - Change UseICU to 'Not using'
     6 - Note the link is now:
         http://localhost:8081/cgi-bin/koha/catalogue/search.pl?q=su:"Winnie-the-Pooh Fictitious character"
     7 - Repeat on OPAC
     8 - Apply patch
     9 - Restart all
    10 - Repeat tests, the behaviour has not changed
    11 - Read the new syspref description and confirm it makes sense
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3feade167f2713e3dc3e47fda35b423443af9f07
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 27 19:53:21 2021 +0000

    Bug 27563: Remove check-url.pl in favor of check-url-quick.pl
    
    The check-url.pl script has been deprecated since Koha 3.8 - this patch removes it.
    If any users are still referencing that script in their cronjobs they will need to
    update to the new script upon upgrade.
    
    To test:
    1 - verify the script is gone
    2 - verify check-url-quick.pl works
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01fc41ca593ee030a77c2462acda0dc59dfe7ec0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Dec 21 16:25:47 2020 +0000

    Bug 27290: Clean up validation
    
    It seems we had the validator instantiated twice and we used a mix of
    validation of required at form element level and in JS instantiator.
    
    This patch moves the rules to consistently apply at the instantiation
    and removes the duplicate lines.
    
    To test:
    1 - Enable 'useCashRegisters' and 'EnablePointofSale'
    2 - Add a cash register
    3 - Add a debit type that can be sold
    4 - Go to point of sale and sell the item multiple times
    5 - Enter 'Amount tendered' less than amount being paid
    6 - Click confirm
    7 - Transaction is processed as if full funds received
    8 - Try with a negative number - goes through again
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4904abf1c323c6d1c4d41108e3e2eb283f008676
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 5 11:06:25 2021 +0000

    Bug 27289: (follow-up) Update payment type too.
    
    The payment type field is also required when using cash registers, this
    patch updates the formatting to work as expected in that case too.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f27e91f1ad4a0048e360e67e6bd0c6723a981577
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Dec 21 13:22:15 2020 +0000

    Bug 27289: Template tweaks for point of sale page
    
    This patch makes a couple of minor changes to the point of sale page in
    order to make it consistent with other pages in the staff interface:
    
    - Buttons inside table cells should have the "btn-xs" class.
    - Required fields should have a "required" class and should have a
      "Required" label.
    
    Also changed: Replaced <input type="number"> according to coding
    guidelines.
    
    To test, apply the patch and enable the EnablePointOfSale and
    UseCashRegisters system preferences if necessary.
    
    - On the Point of Sale page, add some items to purchase. Confirm that
      the "Add" buttons in the "Items for purchase" table and the "Remove"
      buttons in the "This sale" table are correctly sized.
    
    - In the "Collect payment" form, confirm that "Amount tendered" and
      "Cash register" fields are styled red with "Required" text after them.
    - Confirm that the "Amount tendered" field will only accept numeric
      input.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3c58aafcf249efdfe91b00d4da9c66472c4a141
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 5 15:41:34 2021 +0100

    Bug 27633: (bug 15436 follow-up) Fix duplicate of 440$v at the OPAC
    
    Only display a in link, not v that is displayed later.
    
    It has been fixed in different other places by
      commit 81f71d45fe4fee92596ea8d8edb57c602490e9b1
      Bug 15436: Use semicolon between series name and volume
    
    but missed one occurrence.
    
    Test plan:
    Add a 440$a and $v and confirm that the display at the OPAC is now the
    same as the staff interface.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4784b8ffe52b78a1a0a7fe168b9ffc27657d0196
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 14:43:27 2021 +0100

    Bug 27604: Init to {}
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60a749ff5a6ab1e7bbbcc28d7db69bdca51b2eed
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 5 17:29:54 2021 +0000

    Bug 27604: (QA follow-up) Limit the libraries during the query
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 376bf9b980b877a38acc6680445ad5aa0078620c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 3 16:14:12 2021 +0100

    Bug 27604: Make sure PatronSelfRegistrationLibraryList is used
    
    The value of PatronSelfRegistrationLibraryList is used to display the dropdown
    list of the libraries, but not after the form is submitted.
    
    Test plan:
    1. Empty PatronSelfRegistrationLibraryList
    2. Self register a new patron
    => Confirm the dropdown list with the libraries contain all the
    libraries
    3. Fill in PatronSelfRegistrationLibraryList with branchcodes (eg. "CPL|MPL")
    4. Self register a new patron
    5. Edit the HTML form and replace the option's value with another
    branchcode (FPL)
    6. Save
    => Without this patch the branchcode FPL is used
    => With this patch applied an ugly 500 is returned
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac11405321ae3e5fdd72701ddb41b62675e42c97
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 5 12:01:38 2021 +0100

    Bug 27154: Remove Koha::Util::SystemPreferences
    
    On bug 15494, the same method "get_yaml_pref_hash" has been added to two modules,
    Koha/Config/SysPref.pm and Koha/Util/SystemPreferences.pm
    
    We only need the one from Koha::Config::SysPref and remove the whole
    Koha::Util::SystemPreferences module.
    
    Test plan:
     prove t/db_dependent/Circulation/issue.t
    must return green
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6118d24904297c3b4bc44bf13e5e354b60feb33d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 5 17:45:34 2021 +0000

    Bug 26602: (QA follow-up) Cleanup datatables settings
    
    On letter.tt we had nosort and set things via settings that are default in KohaTable so removed
    those from letter.js. Also made the last updated column exportable
    
    On upload.tt the noExport didn't do anything, because we couldn't export, so moved to used KohaTable
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 655f11fd60ddf2a7ae690de340ed9945070ef3e2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 18 11:26:22 2021 +0100

    Bug 26602: Don't export "actions" column
    
    This patch add the noExport class to all "Actions" columns in the
    codebase.
    It's a stupid search and replace, maybe the class is added to table
    where there is no export button.
    
    Test plan:
    Search tables where the export button is available. Confirm that the
    "Actions" columns is not exported.
    Example: /admin/branches.pl, /admin/cities.pl
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 419d816f1fa1c5661622c83c0cf3b5f7fe09d25b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 5 09:03:31 2021 +0100

    Bug 24488: create a loop to avoid copy paste
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD amended patch: Rename variables
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e296e78be98cc1c5e289f9bf1b206d2fa8f3779
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Nov 19 06:27:49 2020 +0000

    Bug 24488: (QA follow-up) Go to next loop as early as possible
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97a6cb4b90f9eedf5cb8d5f6fb3be8dd934ef52e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 18 11:45:41 2020 +0100

    Bug 24488: perf - Move holds search out of the loop
    
    This will need attention from QA.
    We are assuming that the hold with the highest priority has priority=1
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9bc3a11f1d9398d8c44a2a80fdfa93a14285ebf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 18 11:14:45 2020 +0100

    Bug 24488: Simplify structure passed to the template
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d54e32fa3a98950af84b3e308f84b4d5adb520c5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 18 11:14:10 2020 +0100

    Bug 24488: perf - move patrons_count out of the loop
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 774d4e9ab4ebb44fc31045a5b5b5ca31d8f52b59
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 18 10:42:39 2020 +0100

    Bug 24488: perf - Group by at DBMS level
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83944dc2327d2c0e97dff9ba646bbe4f837305c5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 18 10:36:40 2020 +0100

    Bug 24488: Fix count distinct patron on a given hold
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1af4bc0c3a1c37f684a39d0876a73de624fd5d4
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Nov 17 20:38:10 2020 +0000

    Bug 24488: (QA follow-up) Move getting items out of cycle
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d7a12302bd219e8766b2eee075251f4f06af0a4
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Nov 17 19:02:16 2020 +0000

    Bug 24488: (QA follow-up) Remove two queries out of foreach cycle
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c4985fbd65d7d0690ecfa94eeb68f6cbc9afbbf
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Nov 17 18:35:07 2020 +0000

    Bug 24488: (QA follow-up) Make pending reserves faster
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed4ad48c567e6daaaa766fdf307227cc0d099dc8
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Nov 17 10:45:00 2020 +0000

    Bug 24488: (QA follow-up): Fix small bugs, add checkk for waiting holds
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e313bcf1303a7c334327b37e1e8a629ffb2e0005
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 7 18:33:59 2020 +0200

    Bug 24488: [DISCUSSION] For comparaison
    
    I'd like someone to run a benchmark with and without this patch on a
    quite big database and see which approach is the best
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de0cded95c1f89a535487403f1ce7c962fadf3f7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 7 18:06:05 2020 +0200

    Bug 24488: Simplify searches
    
    It also:
    Use dtf for date handling
    add missing td
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1dc3d55ea275c1429a9f1adfad6c469f5ca8f401
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 7 17:23:11 2020 +0200

    Bug 24488: Display patron with the highest priority hold
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19361b797def597e5e12c59d4daabf75be6166a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 08:58:04 2020 +0200

    Bug 24488: Fix reserve.reserve_id' isn't in GROUP BY
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2285c2d65752dcc899d3fdcff634e6927a1cbbf0
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Jan 23 03:59:37 2020 +0000

    Bug 24488: Show correct first patron details on Holds to pull
    
    This patch rewrites the complex search query to reduce the risk of
    reordering the results multiple times.
    
    This patch includes a change to schema files so may need to upgrade
    schema and/or restart memcached
    
    To test:
    1) Reproduce problem following test plan in Description
    2) Apply patch and refresh page
    3) Notice the correct patron is now shown
    4) Play with date selection, confirm correct results are still shown
    5) Test cancelling holds
    6) Test filtering table results
    7) Test with biblios with multiple items
    8) Test with making items unavailable (i.e. not for loan, checked out)
    
    Sponsored by: IHC New Zealand
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18368d6a0c6b35d91ad80a832435e57144d32b6d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 4 12:00:10 2021 +0000

    Bug 27589: Access item fields as hash
    
    SIP item stores the item unblessed so field must be accessed as a hashref
    
    This patch changes the code in handle_item_information to match the code in
    handle_checkin
    
    To test:
    1 - In sip config set the cr_item_field='itype' for a sip account
    2 - Restart SIP
    3 - Attempt an item information requests using the sip_cli_emulator
         perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 -l CPL -m item_information --item 39999000011791
    4 - It fails!
    5 - Apply patch and restart
    6 - It succeeds!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48e306f5d2bc4c49329e082823cbf85c67089a0d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 4 11:59:11 2021 +0000

    Bug 27589: Unit test
    
    Previous tests only covered CHECKIN, this adds a test for ITEM_INFORMATION
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48e56b320a0dc2d096b19bc0bab62d3bad92d25c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Feb 5 06:15:06 2021 -0500

    Bug 27586: Rollback should be before return statement
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3005a2a4c493c624ffd6204f6fccc83ea350361
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Feb 1 13:22:58 2021 -0500

    Bug 27586: Import patrons script has a confirm switch that doesn't nothing!
    
    If the script misc/import_patrons.pl is run without "--confirm" it reports
    that it is "running in dry-run mode" but it is not!
    
    Test Plan:
    1) Import a CSV of patrons using import_patrons.pm *without* the --confirm parameter
    2) Note that it does actually import the patrons
    3) Apply this patch
    4) Note that this time the patrons are not actually imported
    5) Import again with --confirm
    6) Note that the patrons were actually imported this time!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bab6a08ac98c1e6a72b346d554f020c0943e243d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 20 11:16:48 2021 +0100

    Bug 27466: Don't use set_preference from updatedatabase.pl
    
    We must never use subroutines or methods from updatedatabase.pl!
    
    Having it using C4::Context->set_preference will call
    Koha::Config::Syspref->store then C4::Log::logaction and finally
    Koha::Logger->get which will need the log4perl configured correctly
    (which is not necessary the case when you upgrade).
    
    Test plan:
    git checkout ed3e4540d73c1c3009375ad339e09a2e676fa1bd (20.06.00.022)
    reset_all
    Set the value of QuoteOfTheDay to 0
    git checkout bug_27466 (master + this patch)
    updatedatabase
    => QuoteOfTheDay is an empty string
    git checkout ed3e4540d73c1c3009375ad339e09a2e676fa1bd (20.06.00.022)
    reset_all
    Set the value of QuoteOfTheDay to 1
    git checkout bug_27466 (master + this patch)
    updatedatabase
    => QuoteOfTheDay is set to "opac"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 940c0e319a1df9fb2d218d816079b5f5034972f0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 16:18:57 2021 +0000

    Bug 25552: DBRev 20.12.00.008
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 527c8cd28842429a4715f8e64aaada92de6ca9c2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 17:24:37 2021 +0100

    Bug 25552: Simplify tests using build_sample_item
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c6cbabaedab05c1b36d6ac3303e51a354dbfe1a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jan 22 13:00:59 2021 +0000

    Bug 25552: (QA follow-up) Fix spelling mistake
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c09123197bc4bf8997ba4cd1b727c80eef9077e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jan 22 12:56:02 2021 +0000

    Bug 25552: (QA follow-up) Improve claim_returned POD
    
    The POD for the Koha::Checkout->claim_returned method was somewhat
    lacking; This patch attempts to explain what the code appears to
    achieve.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd7a3e6ccbe1e9731b9baf0a8cbd2bd85d44cc69
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jun 8 09:16:00 2020 -0400

    Bug 25552: Unit tests
    
    Signed-off-by: Marti Fyerst <mfuerst@hmcpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e46d4017f310d6011ef66eb2611b6524dc4044c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 4 11:17:35 2020 -0400

    Bug 25552: Mark issue as returned if MarkLostItemsAsReturned, even if not charging a lost fee
    
    Signed-off-by: Marti Fyerst <mfuerst@hmcpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e53d559f4212fa4b25412fdd6325ae469328f26a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed May 20 09:30:45 2020 -0400

    Bug 25552: Add missing Claims Returned option to MarkLostItemsAsReturned
    
    Marking an item as a return claim checks MarkLostItemsAsReturned to see if claim_returned is a value in MarkLostItemsAsReturned.
    However, this option was never added to MarkLostItemsAsReturned so an a return claim can never be automatically removed from the patron record, even if they wanted such behavior.
    
    Test Plan:
    1) Apply this patch
    2) Restart all the things
    3) Note the new return claims option on MarkLostItemsAsReturned in the system preferences
    
    Signed-off-by: Marti Fyerst <mfuerst@hmcpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1af07787032275813e1e458cfed8504b482cd1c6
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jan 25 17:37:37 2021 +0200

    Bug 27549: "use of uninitialized value" warning on renew.pl
    
    On the beginning we have empty "barcode" parameter for this form, but that not taken into account in regular expression  warning emitted: "Use of uninitialized value $barcode in substitution (s///) at /usr/share/koha/intranet/cgi-bin/circ/renew.pl line 47." in renew.pl
    Fixed by making $barcode to become an empty string by default.
    
    To reproduce:
        1) Head over to the "Circulation -> Renew" page.
        2) Check intranet-error.log there will be a warning "Use of uninitialized value $barcode in substitution (s///) at /usr/share/koha/intranet/cgi-bin/circ/renew.pl line 47".
        3) Apply the patch, refresh the "Renew" page.
        4) Ensure that the new "use of uninitialized value" warnings didn't appear in the console.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3d22687568640930bad9ffbb426033423e7efe9
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jan 25 17:35:18 2021 +0200

    Bug 27548: "use of uninitialized value" warning on branchoverdues.pl
    
    On the beginning we have empty "location" parameter for this form,
    but that not taken into account in comparison and undef warning emitted:
    "Use of uninitialized value $location in string eq at
    /usr/share/koha/intranet/cgi-bin/circ/branchoverdues.pl line 72" in branchoverdues.pl
    
    Fixed by adding pre-check for $location.
    
    To reproduce:
        1) Head over to "Circulation ->Overdues with fines" page. Check
           intranet-error.log where there will be many warnings
           "Use of uninitialized value $location in string eq at /usr/share/koha/intranet/cgi-bin/circ/branchoverdues.pl line 72".
        2) Apply the patch, refresh the "Overdues with fines" page.
        3) Ensure that the new "use of uninitialized value" warnings didn't appear in the console.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65d09dc52097a6630d54ae45e3df1086b55a59ae
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Sun Jan 24 21:42:10 2021 +0200

    Bug 27538: fix correlation of fields in Holds to Pull table
    
    Bottom filtering row of "Holds to pull" table do not correlate to other
    ones, columns diverged from "Call numbers" cell: it should be under
    "Available call numbers" while it's under "Available barcodes", and so
    on to the last cell (while number of cells still adjusted).
    
    To reproduce:
       1) Head to the Holds to Pull page, check that bottom filtering row
          shifted to the left by one, starting from the "Call number"
          column and don't correlate to the upper table (for example, "Call
          numbers" cell should be under "Available call numbers" while it's
          under "Available barcodes"), and so on for all cells till the end
          of the filtering row.
       2) Apply patch.
       3) Refresh Holds to Pull page and ensure that all filtering row
          columns correlate to other rows columns correctly.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc072ee4ba9361d35d92efd46b2935ff1b608b0d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 29 11:06:34 2021 +0000

    Bug 27576: Don't show import recordds table after cleaning a batch
    
    Currently if you clean a batch from the manage marc records page, the import records table appears with no items  at the bottom of the screen
    
    This is because we test for import_batch_id, we should also make sure we didn't just clean a batch
    
    To recreate:
    1 - Stage a batch for import
    2 - Go to 'Manage staged records'
    3 - 'Clean' the batch you just imported
    4 - Note the empty table that appears at the bottom of the page
    5 - Apply patch
    6 - Repeat 1-3
    7 - Note the table no longer appears
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 253c21afd4af7a0c8bbdea81858b5fe18ff04d88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 17:20:23 2021 +0100

    Bug 27321: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 814bb1cf41f4de6ac1b6a5f93f1a7b6413ff13ae
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Jan 12 23:42:27 2021 +0000

    Bug 27321: Make disabled DB columns clearly disabled visually
    
    To test:
    1. Apply patch and its dependency (bug 17364)
    2. Rebuild the CSS (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    3. Go the system pref BorroweUnwantedFields
    4. branchcode should cleary stand out as disabled (#cccccc)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cc252c145ff20cc01756a5aa3dbeb16cfb90e77
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 29 13:19:12 2021 +0000

    Bug 27571: "Add to lists" on MARC and ISBD view of OPAC detail page doesn't open in new window
    
    This page corrects the global click handler in the OPAC so that all
    "addtoshelf" links will work correctly to trigger the popup window for
    adding titles to a list.
    
    To test, apply the patch and test the process of adding a title to a
    list in the OPAC from various places:
    
    - Search results
    - Bibliographic detail page (normal)
    - Bibliographic detail page (MARC view)
    - Bibliographic detail page (ISBD view)
    
    Test both adding to an existing list and adding to a new list.
    Everything should work correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c686091100d5451de0eb9a8e09b2aaa095152ec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 27 12:48:57 2021 +0000

    Bug 27561: Remove type attribute from script tags: Various templates
    
    This patch replaces remaining instances of <script type="javascript"> in
    templates with "<script>."
    
    To test, apply the patch and check the changes to the template. Verify
    that the changes look correct.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef5ec1731a971cfcf562f0744ef3a78ac0e75058
Author: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
Date:   Mon Jan 18 11:20:06 2021 +0200

    Bug 27430: Change password minimum value hint when patron category is changed
    
    If patrons category is changed during add or edit password
    minimum value doesn't change. This patch adds ajax call to
    fix this.
    
    To test:
    1. Add password minimum length for patron
    categories A and B.
    2. Create a new patron with category A.
    3. Change patrons category to B.
    4. Note that password minimum value doesn't change
    on hint text.
    5. Apply patch.
    6. Repeat patron creation, password minimum value
    should now change correctly.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 545c384205534fc52557bbe0eb4990405a44c7f7
Author: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
Date:   Thu Jan 14 14:39:08 2021 +0200

    Bug 27430: Use password minimum length for patron category on password hint
    
    Hint for password minimum length should use minimum length
    set for patron category  not "minPasswordLength" value.
    
    To test:
    1. Set "minPasswordLength" e.g. 6
    2. Set "Patron" category minimum password length e.g. 4
    3. Create new a patron.
    4. Note that hint after password input field reads "Minimum
       password length: 6"
    5. Apply patch.
    6. Hint should now read "Minimum password length: 4".
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd272244157ad0dc5e83a0cfb6430bbf1d3b90c8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 27 07:37:05 2021 -0300

    Bug 27330: (QA follow-up) Return 409 instead
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2593558952909f6c8df5d2ed8c6fea60cf7dcb9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 11:29:38 2021 -0300

    Bug 27330: (follow-up) Cleanup missed on bug 23843
    
    This patch makes some cleanup missed on bug 23843. The catch condition
    on the controller was copied and pasted from other controller and should
    be avoided unless there's a known case that needs special handling.
    Otherwise it will be catched by the $c->unhandled_exception call.
    
    All the old mappings were inadvertedly kept in the controller as well as
    the (unused) _to_api method.
    
    The base class is also cleaned from unnecessary mappings. Only mapped
    things need to be added.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/clubs_holds.t \
               t/db_dependent/Koha/Club/Hold.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea0696831fadd4b633c90fc7ccd29144e9a6b87a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 11:24:51 2021 -0300

    Bug 27330: Return 403 if club has no enrollments
    
    This patch makes the controller script return a 403 as it should [1]
    instead of a plain 500.
    
    To test:
    1. Apply the regressions tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/clubs_holds.t
    => FAIL: Tests fail!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    [1] https://www.restapitutorial.com/httpstatuscodes.html
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2af262e1f2fac89dada52e60c0653f0ad8ba987a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 11:19:58 2021 -0300

    Bug 27330: Regression tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94d966ecec327c5dbde22abc5259d380a3610d24
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 09:59:26 2021 -0300

    Bug 27330: Use Basic auth in tests
    
    This patch puts the tests in line with the current codebase. Some bits
    are passed through perltidy to aid readability...
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/clubs_holds.t
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    => SUCCESS: Tests look more like the rest of the API tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a8b1b904eb05fec95834bcba0336e9d975f5d32
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 30 12:52:28 2020 +0000

    Bug 26578: Clean overdrive searches before passing to OD
    
    This patch copies regex used in buildQuery to detect ccl code in queries, but here we adapt
    it to remove any ccl signifiers to ensure correct results from OD
    
    To test:
    1 - Have OverDrive enabled and configured
    2 - set UseAuthoritiesForTracings to "Don't use"
    3 - Search in the catalog for a record
    4 - From the details page for a record click on an author link
    5 - Note the query in catalog is like 'au:&quot;Whitford, Bradley.&quot;'
    6 - Some overdrive catalogs will return records matching 'au:'
    7 - Apply patch
    8 - Reload the page, if there were spurious results before, they should now be gone
    9 - Perform a search that returns overdrive results
    10 - For a title in overdrive search koha with:
        au:{Author} AND ti:{Title}
    11 - Confirm overdrive results are returned
    12 - Check the link to overdrive results and note query section is:
        q=Author AND Title
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae76d7626b0a23830b0269c00cbc2be73720d9ec
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 28 18:56:39 2021 +0000

    Bug 26298: Don't set too_many_items_to_process if equal to limit
    
    In the code we prepare items for display if less than or equal to the pref, but we don't allow
    the edit if greater than or equal to the pref. The second case should be only 'greater than'
    
    To test:
     1- Set MaxItemsToProcessForBatchMod to 1000
     2- Go to Reports
     3- Make a report for itemnumbers that will give you at least 1000 items (ex. SELECT itemnumber FROM items)
     4- Save and run the report
     5- In "Rows per page", choose 1000
     6- Click on "Batch operations with 1000 visible records" > Batch item modification
     7- Notice that the item modification form isn't there and that the message says "Too many items (1000): You are not allowed to edit more than 1000 items in a batch."
     8- Apply patch
     9- Restart all the things
    10- Run the report again and display 1000 rows
    11- Click on "Batch operations with 1000 visible records" > Batch item modification
    12 - Sucess!
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05724721d6c8677d62048bd733d9d2d108dd8b3a
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Dec 17 15:52:52 2020 +0000

    Bug 27261: exlude branchcode from PatronSelfRegistrationBorrowerUnwantedField
    
    To test:
    1 - Alter PatronSelfRegistrationBorrowerUnwantedFieldand select branchcode
    2 - Attempt to self register via the OPAC
    3 - Kabloom, internal server error
    4 - Apply patche
    5 - Alter the preference again
    6 - Note that branchcode is unchecked and disabled
    7 - Save the pref
    8 - Attempt to self register again
    9 - It succeeds
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92f1c60a0e94f5ef16ce13e8f5f05c432503a0a5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 17 09:05:25 2020 +0100

    Bug 17364: (follow-up) Do not check excluded fields
    
    When clicking on "Select all" excluded fields are selected.
    Even if they are not saved into preference, this is disturbing.
    
    Test plan :
    1) Edit BorroweUnwantedFields system preference
    2) Click "Select all"
    3) See that branchcode is not selected
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b986a8419b2012565e5bf2d4f942b06901c7ad74
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 6 11:17:56 2020 +0000

    Bug 17364: Add ability to exclude some columns from selection for system preferences
    
    Bug 22844 Added the option to provide a modal for selecting database columns for system preferences
    
    Some system preferences are limited to a subset of the columns allowed. For instance, setting branchcode
    in BorrowerUnwantedFields prevents adding new patrons
    
    This patch allows for defining exclusions in the .pref file
    
    To test:
    1 - Alter BorroweUnwantedFields and select branchcode
    2 - Attempt to add a new patron
    3 - Get a message like "Something went wrong. Check the logs"
    4 - Apply patches
    5 - Alter the preference again
    6 - Note that branchcode is unchecked and disabled
    7 - Save the pref
    8 - Add a patron
    9 - It succeeds
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 17364: (follow-up) Add missing filter
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a5232412fee9a9811b7354c8ea98ee889eaee3c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Dec 11 07:13:12 2020 -0500

    Bug 27204: Fix end boundary index, never return results for non-existant accountlines
    
    There are two primary issues I've identified with requesting line items
    for fees via SIP:
    
    1) The end boundary is incorrect. For example, if send a request with a
    BP ( starting item) of 1, and a BQ (end item) of 1, I should get just
    the first item. Instead I will get two items
    
    2) Our SIP server does not check bounds. For example, if I have 3 fines,
    but I send a BP of 1 and a BQ of 5, I will get back 5 AVs, two of
    them being "empty" because the patron only has 3 accountlines!
    
    Test Plan:
    1) Apply the unit test patch
    2) prove t/db_dependent/SIP/Patron.t
    3) Note the failures
    4) Apply the second patch
    5) prove t/db_dependent/SIP/Patron.t
    6) All tests should pass!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb9b72b783c2951c348934dfa8358ccd2a65f986
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Dec 11 07:13:06 2020 -0500

    Bug 27204: Add unit tests for fine_items
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b647aff01d504533a5a3720c66e6adcf0067792f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 27 10:22:27 2021 +0100

    Bug 27530: Set correct dateofbirth for 'C'
    
    Categories B, J, K and YA have a upper age limit of 17 years.
    We are setting the dateofbirth to today - 15 years to prevent juvenils
    to be 70!
    
    Note that DATE_SUB is a MySQLism, but there is no way to be portable
    here.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3205b4c41497d83084a8a216eefa6dd377788b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 27 10:17:57 2021 +0100

    Bug 27530: Set dateexpiry to 2099 in sample patrons
    
    To prevent them to be expired.
    
    Note that the last patron is kept expired.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b2c284092eda3f70eaeaa1b136e9c0ae8f17f82
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 20 12:09:30 2021 +0100

    Bug 27450: Remove password from the mandatory fields when editing details
    
    When a patron edit their personal details at the OPAC, the password must
    be removed from the mandatory fields
    
    Test plan:
    0 - Don't apply the patch
    1 - Set PatronSelfRegistrationBorrowerMandatoryField to require password
    2 - Create or sign in as a patron on the opac
    3 - Click 'Your personal details'
    4 - Attempt to edit
    5 - Save changes
    => They are rejected because not all required fields are populated
    6 - Apply the patch
    7 - Repeat 3 to 5
    => details are saved successfully
    8 - Test the self registration feature and confirm that the password is
    required
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecb6703d7a627060fc7e21a149e5226262c97e8d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 28 13:58:14 2021 +0000

    Bug 27554: Clarify and add tests for update_category_to
    
    This patch adds a comment to the existing tests, clarifying what they test, and verifying the expected patron is affected. The
    original test should be broken by 26307 when the behvaiour is prevented
    
    I additionally add a test for 'too old'
    
    To test:
    1 - Apply patch
    2 - Prove tests, they should pass
    3 - Verify the comments make sense
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: behvaiour ==> behaviour
    and add more info to the commit title
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b60ff6452ef2212a02f16ddc5c46edeb3d83a5e3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 29 16:43:06 2021 -0300

    Bug 27580: Handle NULL values correctly in Koha::Items->filter_by_visible_in_opac
    
    This patch fixes the internally used query so it doesn't consider NULL
    values as IN the set.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Items.t
    => FAIL: Tests fail :-/
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00ea18282e622805321425789209ed9e0f8f7ea0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 29 16:40:27 2021 -0300

    Bug 27580: Regression tests
    
    This test makes all the generated sample items have undef copynumber,
    and all rules are added copynumber => [ 2 ] on the tests as
    suggested by Andrew on his failing example.
    
    The tests are expected to pass. i.e. copynumber is clearly not equal to
    2, so those items shouldn't be hidden.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Items.t
    => FAIL: Tests fail! undef is considered in [ 2 ]
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3094bf9bad45cfba064f40ac6b6e0e1a1672c1f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 10:35:12 2021 +0100

    Bug 25670: Fix random failure on Orders.t
    
    It has failed at least 3 times:
    
     #   Failed test 'The right order is returned'
     #   at t/db_dependent/Koha/Acquisition/Orders.t line 153.
     #          got: '50'
     #     expected: '49'
    
     #   Failed test 'The right order is returned'
     #   at t/db_dependent/Koha/Acquisition/Orders.t line 154.
     #          got: '49'
     #     expected: '50'
     # Looks like you failed 2 tests of 6.
    
    I cannot manage to make it fail locally
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1379cbb3634aa2ad3e0cb65be7b55f6b1c32eab5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 10:26:00 2021 +0100

    Bug 27486: Fix UsageStats.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e27df3b582d83c9c6cd1cc608e00a93b11e0768
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 1 10:24:47 2021 +0100

    Bug 20212: Add missing html filter
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a637084f412b38c98ad520203a74d50e7d16d7b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 18 11:21:26 2021 +0100

    Bug 27251: Add missing html filter
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c446026366121d1c4dc055b11653798304c66c0a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 18 11:18:55 2021 +0100

    Bug 27251: Don't export the actions column
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0259ae949b6c471f149314f0f516d9d9e8823c42
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 18 11:14:09 2021 +0100

    Bug 27251: Fix sort by displayed_on
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e16ad052bd583c3c05c7eef972e908901f106ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 6 10:40:12 2021 +0100

    Bug 27251: Don't hide the table on delete if empty
    
    If we filtered the result, delete the only row displayed then the table
    was hidden. This is a nice behaviour, especially if there was no filter.
    However we must show it again if the filters are removed.
    I am suggesting to simply to not hide the table and avoid adding more JS
    code to deal with this very specific use case.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 401987bdad8d754e9bf2d49f0f209e2168fa8963
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 16 12:34:43 2020 +0100

    Bug 27251: Rewrite QOTD with the Koha REST API
    
    This patch replace the QOTD editor with our new way to CRUD the
    adminitration page (like libraries and STMP servers)
    
    Test plan:
    Play with the QOTD by adding, removing, updating quotes
    Try to find bugs :)
    
    Bug 27251: Fix capitalization
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcb5b076ce2b9ef9676f1f702c90ea2b0703a827
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 6 13:11:34 2021 -0300

    Bug 27352: Missed case in bug 25032
    
    Probably because of the order things got pushed.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee3094d7f042831f143b18acb9f712545dd6d92f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 6 13:10:12 2021 -0300

    Bug 27352: Unit tests
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f11d6acbb5d61c8b8fafd845eb8de650a84a201
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 6 12:00:40 2021 -0300

    Bug 27352: Add GET /biblios/:biblio_id/items
    
    This patch adds a route to fetch the items for a biblio. It relies
    entirely on already existing methods.
    
    To test:
    1. Use your favourite REST tool
    2. Play with the new route.
    => SUCCESS: It works as expected!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4249048a9e83a326026859307d5f89d95be06a69
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 12:23:46 2021 -0300

    Bug 27034: (follow-up) Remove unneeded params tweak
    
    As $c->objects->search doesn't consider path params anymore, there's no
    need to manually tweak the query parameters.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ddd0ef3cb8d9b36421672eb1a57f3b4c3c51434
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 07:55:09 2021 -0300

    Bug 27034: Do not use path parameters on building the query
    
    This patch simply removes the use of path parameters on building the
    query in $c->objects->search.
    
    The sample usage in the original tests considers a specific use case in
    which the 'nested' resultset has the path param in its attributes:
    
    GET /patrons/:patron_id/holds
    
    In this case, $c->objects->search would be passed a Koha::Holds
    resultset into which it would build a query. As the patron_id param can
    be mapped into a Koha::Hold attribute, this works.
    
    We don't actually use this approach in code. What we do is searching for
    the patron, and properly return a 404 if the patron doesn't exist [1]. If it
    exists, we actually call $patron->holds to get the related resultset, so
    there's no gain in having the path param on the query afterwards.
    
    That said, if we wanted to build:
    
    GET /holds/:hold_id/pickup_locations
    
    as the latter is a calculated value, from a resultset that doesn't
    actually include a (mapped to some attribute) hold_id attribute, there's
    no way to use it if it will automatically add the hold_id to the
    pickup_locations resultset. It will give errors about hold_id not being
    an attribute of Koha::Library (Branches.pm actually).
    
    So this patch removes the automatic use of path parameters in
    $c->objects->search. We can extract them in the controller and add them
    to the passed resultset if required. But this patch removes a constraint
    we have for building routes controllers right now.
    
    [1] If we didn't return the 404, and we just passed a fresh Koha::Holds
    resultset to be feeded with the patron_id, we would always return an
    empty array in cases where the patron doesn't exist. This would be
    misleading, but I'm open to discuss it. Design-wise.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0bdaab6669e2f8912f83828973589aa0fd57cd5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 29 08:01:04 2021 +0000

    Bug 27486: DBRev 20.12.00.007
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 377866914b2b6aea3fa4aec6f87e4873cdce924b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 29 08:11:54 2021 +0100

    Bug 27486: Replace one missing occurrence
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 009ec76b1a3316423e43a64aea9cc808c1a5e550
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jan 24 15:51:03 2021 +0000

    Bug 27486: (QA follow-up) Fix occurence in aqplan.pl
    
    There was another mention of the old system preference name in the
    budget planning code. This patch replaces it with the new name.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71c1aa44a9c9d1a2437437a7e0a47a86c7990e72
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Thu Jan 21 01:40:50 2021 +0000

    Bug 27486: Rename system preference delimiter to CSVDelimiter
    
    Test Plan:
    
    1. Go to Administration
    2. Go to System Preferences
    3. Find 'delimiter' (note the name)
    4. Apply patch
    5. Repeat step 1 and 2
    6. Find 'CSVDelimiter' (note the name)
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72346502d9c7c61267cdd2ef2b2cedd3df980a00
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 29 08:01:04 2021 +0000

    Bug 27487: DBRev 20.12.00.006
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc1eeab6bd1f35c59ddd0cd9a2be753e11b28bae
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Thu Jan 21 05:23:31 2021 +0000

    Bug 27487: Rename system preference reviewson to OPACComments
    
    This patch renames the reviewson system pref to OPACComments
    
    Test Plan:
    1. In Koha Administration, search for the reviewson system preferance
    2. Note the presence of the reviewson system preferance
    3. Apply the patch and run updatedatabase.pl
    4. Repeat steps 1 and 2. The reviewson preferenace should be gone
    5. Seach for and note the OPACComments system preferance
    6. Ensure that the OPACComments system preferance operates correctly, as
    if it were reviewson
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=27484
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ede297cfab18e85c5b40892c058be3355ee8407d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 28 09:32:09 2021 +0100

    Bug 27440: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab4267f18cc73e92a17d4caa89c16939c4d6c490
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 15 15:41:39 2021 +0000

    Bug 27440: Improve structure and style of result toolbars in the OPAC
    
    This patch makes markup and CSS changes to areas of the OPAC classed
    with "selections-toolbar," an area of controls found at the top of some
    lists of titles: The cart, search results, search history, lists, and
    suggestions.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Perform a search in the OPAC. On the search results page, confirm that
      the various controls work correctly:
      - With OpacHighlightedWords enabled, hightlight and unhighlight links
      - Select all and clear all links
      - Selecting one or more checkboxes should enable the "Select titles
        to..." menu.
        - Test that adding items to the cart and lists works correctly.
        - Test that placing multiple holds work.
        - Test that tagging multiple items works.
    - From the search results page, add multiple items to the cart.
      - Open the cart and confirm that the the controls described above
        continue to work correctly.
    - Open the search history page, confirm that the toolbar controls work
      correctly for all four categories: Current session catalog searches;
      previous session catalog searches; current session authority searches;
      previous session authority searches.
    - On the purchase suggestions page, confirm that "select all" and "clear
      all" work, and that deleting multiple suggestions from the toolbar
      link works.
    - On the list contents page test the same controls: selection,
      multi-hold, tagging, and "Remove from list."
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fbfecdb2f9dc690eec4a03569edef624fd6f452
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 15:20:00 2021 +0000

    Bug 26755: Make the guarantor search popup taller
    
    This patch changes the dimensions of the popup window in which
    guarantors are chosen during the patron edit process.
    
    The patch also removes an obsolete function delcaration for "Dopop"
    which is unused.
    
    To test, apply the patch and open a "child" type patron account for
    editing.
    
    Click the "Add guarantor" button. This should trigger a popup window.
    Eyeball the size of the window, you'll be able to tell that it is
    exactly 800 pixels wide.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f2a0bdea8fdb8e5d71d8c4b3821f7760e1a57a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 28 09:32:43 2021 +0100

    Bug 21851: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f53606b6006a3a6b8e00a33b496640d3d552e960
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Sep 26 19:44:25 2020 +0000

    Bug 21851: Improve style of sidebar forms
    
    This patch makes minor changes to staff client CSS in order to improve
    the style of forms in sidebars. It adjusts the style of nested fieldsets
    and gives more room to list items (and the form fields they contain).
    
    To test, apply the patch and regenerate the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    
     - View pages with forms in the left-hand sidebar, especially:
       - Circulation -> Overdues
       - Patrons -> Patrons search results
       - Acquisitions -> Invoices
       - Acquisitions -> Order search results
       - Tools -> Tags
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36975a143819dda6fb44dd7bae244d051f1291f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 28 09:31:41 2021 +0100

    Bug 27493: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfabf09d7051c12ccab6b361b04d4b95c9deac57
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 28 12:45:09 2021 +0000

    Bug 27493: (follow-up) Remove redundant class
    
    This patch modifies the templates so that instances of "class='select
    selectcol' are replaced with "class='selectcol'". I could find no
    instances of the "select" class being used in CSS or JS.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25106761cee20d54b5d222a65c8ac0ce07b48526
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jan 20 12:42:58 2021 +0000

    Bug 27493: Add styling for hidden columns
    
    I'm sure adding a 'hidden' class to a table column used to remove it
    from display entirely.. seems that's no longer the case so we add the
    CSS back in here.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d7175906eaddcd970d879998f41a403bf2a6053c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jan 20 09:19:21 2021 +0000

    Bug 27493: Set column width for checkbox only columns
    
    This patch updates the global OPAC css such that selectcol type columns
    in tables are fixed width at 1ch to ensure these columns do not get
    unneccessarily wide.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Test plan
    PAGES: opac-basket, opac-messaging, opac-results, opac-search-history,
    opac-suggestions and opac-tags.
    1/ Notice that the column containing a checkbox on each of the above
    pages is of a mised width, often much larger than required
    2/ Apply the patch and rebuild the css file as described above
    3/ Notices that the column containing a checkbox on each fo the above
    pages is now of a standard, sensible, width.
    4/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 065c955cc67b6f113c9fb5d5ed918ba1400b5af9
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Tue Jan 19 21:21:51 2021 +0000

    Bug 27395: Add a warning to PatronSelfRegistrationDefaultCategory
    
    This patch adds a warning to the PatronSelfRegistrationDefaultCategory system
    preference to not use a regular patron category for self registration.
    
    If a regular patron category code is used and the cleanup_database cronjob is setup
    to delete unverified and unfinished OPAC self registrations, it permanently and
    and unrecoverably deletes all patrons that have registered more than
    PatronSelfRegistrationExpireTemporaryAccountsDelay days ago.
    
    It also removes unnecessary apostrophes at the end of two self registration
    and modification system preference descriptions.
    
    Test plan:
    1. Apply the patch.
    2. Check that the warning message for the PatronSelfRegistrationDefaultCategory
       system preference is clear and makes sense.
    3. Sign off!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1e12c95e1d1ec907f6ed4465270569aa6c5a40d
Author: Amy King <amyking386@gmail.com>
Date:   Thu Jan 21 22:41:09 2021 +0000

    Bug 20238: Display description of ITEMTYPECAT in search category
    
    When adding or editing item types (Koha administration > Basic
    parameters > Item types) the drop down list currently displays
    the ITEMTYPECAT authorized value description. However, on the
    item types page the authorized value is displayed in the search
    category column.
    
    This enhancement changes the item types page so that the search
    category column displays the authorized value's description
    instead of the authorized value code.
    
    Test plan:
    1. Go to Staff interface home page > Koha administration > Basic
       parameters > Authorized values.
    2. Find ITEMTYPECAT and add a new authorized value - make sure it
       has a description.
    3. Go to the Basic parameters > Item types page.
    4. Edit an item type.
    5. For the search category, select the new authorized value you
       created. The desciption should be shown in the dropdown list.
    6. Save the changes.
    7. In the search category column for the item type you edited, it
       should now display the description instead of the code.
    8. Sign off!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03fa53c4475c2d2ca2288c63a1107fdbb618b996
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 28 16:07:29 2021 +0100

    Bug 20212: Restore price formatting for ecost and replacement_price
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0669a0c1afd922db6f3a3c14ddafaf81fd7b52a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 28 09:08:22 2021 +0100

    Bug 20212: Filter on publisher and notes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24a7fec4459250ff2461213da22dbb4dc2ed8f18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 13 11:53:15 2021 +0100

    Bug 20212: Remove fix_query and assume ugliness
    
    It seems better to do things in an ugly way but simple than complicated.
    This patch removes the fix_query method that deals with ean and isbn and
    explicitly tell that it's a trick that must not be reused somewhere
    else.
    It should only be used by Koha internally and we should not advertised
    it until it's ready.
    This problem will have to be fixed properly when the GET /biblios route
    will be implemented.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43e0b298bf5c235dd21a60bbd42cddb04c505264
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 13 11:39:27 2021 +0100

    Bug 20212: Fix query for the global filter
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41c20e07cd4748556f125cd74289b51c3cee531c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 13 11:17:48 2021 +0100

    Bug 20212: Re-add EAN for UNIMARC
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6180725e61796252e3f9f735b0af2e91876acf86
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 15:42:18 2021 +0100

    Bug 20212: Use the DT column filtering provided by the wrapper
    
    Bug 27402 is adding it, we do not longer need the query_from_filters JS
    function.
    
    This patch also remove the filters on the left. As we have DT
    remembering the filter on the table we don't need them anymore.
    
    Technical note:
    Prior to this patch, the search on biblio.author, biblio.title and
    biblio.isbn was done by adding hidden columns. Now we are using:
      "data": "biblio.author:biblio.title:biblio.isbn"
    to tell the wrapper we are going to build a search on these 3
    attributes.
    
    Another trick is to pass a default_filters parameters to the wrapper, to
    tell it we want to filter on the orders of a given vendor (this is a
    bugfix, the original implementation was returning all the orders).
    However We should not use /acq/orders?vendor_id=42 but /acq/vendor/42/orders instead (which does not exist yet),
    otherwise (with bug 27353 ) we are going to display the wrong number of non-filtering rows.
    
    The change in Orders.pm is only formatting to match what's done in
      Bug 27353: Set X-Base-Total-Count header for REST API
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 379b949d247a772126c794dcf02ea4d98e639a0a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 12 09:55:36 2021 +0100

    Bug 20212: Remove fixedHeader
    
    It's an extension that needs to be added.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f853584d55b7c890121a9e48de86cf4f59e0158
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 8 15:04:32 2021 +0100

    Bug 20212: Search on fund's name instead of id
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39f8f3988c6c3af5509d96d1b414451e7cb1f1ca
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 8 10:33:26 2021 -0300

    Bug 20212: (follow-up) Avoid pagination on full resultset test
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9493814a230b89484bc504c416efe08255e3baf1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 8 14:15:07 2021 +0100

    Bug 20212: Use functions to escape variables
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53a4ee59902b88e0d04a57764554768d489d5668
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 8 10:13:05 2021 -0300

    Bug 20212: Fix test after 25670 follow-up
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b04c1bcf53a39d03c03b91b27c78799ed831a87
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 16:45:36 2021 -0300

    Bug 20212: (QA follow-up) Fix escaping
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f10553a936d531e47011eb387d42a4320907df1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Dec 22 15:50:02 2020 +0000

    Bug 20212: (QA follow-up) Spelling typo fix
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acc94c90120618cb14d1ecba3780f9209f8421e7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Dec 22 15:45:13 2020 +0000

    Bug 20212: (QA follow-up) Restore missing comma
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 948cbf1c988ca32bbeeedda2ff6bd3ff6ffd5689
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 6 16:44:25 2020 -0300

    Bug 20212: Make all biblioitems.* fields searchable
    
    Prior to this bug, only a few bilbio fields were actually searchable through
    the orders API. This patch adds all of them to the mapping, so other
    pages can take advantage of them.
    
    My first approach was to add things as needed. But this is trivial to
    make complete.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c932f0434099a11a0471e56afeb9365d83dcc0c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 6 15:16:00 2020 -0300

    Bug 20212: (QA follow-up) Resurrect column filtering
    
    This patch adds per-column filtering to the order receiving table.
    
    The order cost column proved difficult to filter, because of the syntax
    DBIC requires for comparing replacement_cost * quantity, and passing
    that all the way down from the API request to DBIC itself.
    
    I'm still looking for options.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b209f3958bf8a43300e78c36caab0828f6d6dbf1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 4 09:33:40 2020 -0300

    Bug 20212: (QA follow-up) Restore table filter sticky
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61d2095a842a6067447272a1dbc522491dab6a7a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 2 19:51:38 2020 -0300

    Bug 20212: Controller changes regression tests
    
    This patchset did a copy and paste of the objects->search helper inside
    the controller, to handle a very special case that wasn't worth
    generalizing: the fact that the biblio object (that this patchset makes
    embeddable) is actually built from two tables, and we want to filter by
    fields in both tables.
    
    This requires us to translate:
    - Any filter reference to fields in biblioitems we allow to search on, through
      an allow list.
    - For filtering to work, we need to tweak the stashed 'embed' object so
      the prefetch is done correctly
    
    This patchset also adds a new query parameter: only_active. It is used
    to only request active orders (see the spec for more details).
    
    This patch adds tests for:
    - Filtering by a column in bilbioitems (this implies correctly
      prefetching the bilbio => biblioitems relation, and translating the
      filtering parameter.
    - Using the only_active query parameter to retrieve only active orders
    
    To test:
    1. Apply this patchset
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/acquisitions_orders.t
    => SUCCESS: Tests pass!
    3. Verify the tests check for the explained behaviours.
    => SUCCESS: They do!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31bd1296ec259dfc6e990df70e0a95c7e5436405
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 2 17:15:31 2020 -0300

    Bug 20212: (QA follow-up) Remember current filter
    
    This patch restores the original behaviour: if you jump into receiving
    an order, and then go back to receiving, you want the page to remember
    your filters.
    
    This feature was overlooked. On fixing it, I wrapped some JS code in a
    function for reusing it and simplified it a bit as well.
    
    To test:
    1. Enter a search term in either of the search fields
    2. Add a note, receive or do another action
    => SUCCESS: The search term is kept
    3. Apply this patch set
    4. Repeat 2
    => SUCCESS: The search term is kept
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3496ab75ee4ec51241e1561b632731dfda614505
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 10 16:03:50 2020 -0300

    Bug 20212: Use API to render orders datatable
    
    This patch makes the pending orders datatable render using the API
    instead of hte old controller script. It implements native server-side
    pagination thanks to the API and the datatables wrapper.
    
    On polishing it, we found that data can contain many null values, and it
    got dirtier in the process.
    
    This code with all the checks that are done on the data is the result of
    testing this dev with real-life production databases, huge ones with
    thousands of orderlines.
    
    To test:
    1. You should compare the behaviour between this table, and the original
       one in master.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 717643e7f361d61d7f505c78d3c4239f5b61bbef
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 27 17:47:14 2020 -0300

    Bug 20212: Add missing relation in Biblio
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1270e14df5f4ea1c9a3d553c35af20c735a6508e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 11 17:10:10 2020 -0300

    Bug 20212: Clean parcel.pl
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ade441def457c0856b0cf13ba416331cc32f7ba3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 17 13:05:24 2020 -0300

    Bug 20212: Add more embeddable objects to orders
    
    This patch adds options to embed more related objects based on the needs
    by parcel.tt.
    
    For filtering by biblioitems fields (ISBN and EAN) I had to make the
    'list' method a modified version of the objects->search helper. I
    thought of doing it in a more generic way but I didn't find any other
    use cases and it would certainly make an already complex piece of code
    even more complex.
    
    So this is quite similar, but at some steps the biblio.<biblioitem
    field> gets translated into the proper relation names, and the same
    happens for prefetching.
    
    A new parameter is also added: only_active. It makes the controller use
    Koha::Acquisition::Orders->filter_by_active, avoiding the need to build
    complex queries in the UI.
    
    The same handling is done when the order_id parameter is passed (outside
    the q= parameters). In this case using Koha::Acquisition::Orders->filter_by_id_including_transfers
    
    This is all respecting the C4::Acquisitions::SearchOrders behaviour.
    
    TL;DR:
    
    This patch adapts the code from the list() sub so it manipulates the
    query parameters and the embed header so:
    - the biblioitem relationship is prefetch
    - any queries on biblio.isbn and biblio.ean are correctly translated into search on the
      biblioitems table.
    - Adds an only_active parameter to the /acquisitions/orders route to
      easily request only the active orders.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70136ff9d0ea2b36de2410041f9a63a1caea9eea
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 28 16:17:38 2021 +0100

    Bug 27402: Reverse search filter texts
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59b5abd2574fa78ff0863f307e18aaad25475f9f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 13:36:14 2021 +0100

    Bug 27402: Column filters must AND, not OR
    
    Test plan:
    Use the column filters and the global filter
    Confirm that the rows are filtered as you expect
    
    QA Note: There is more code on top of this, see bug 20212.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29d5e8c5a57c159872d320a9f1eb200e9e1d7ff7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 14:19:23 2021 +0100

    Bug 27402: Move to datatables.js
    
    To make it reusable we need to move the code to datatables.js
    
    So far only the cities table is using the column filters so there is no other
    view to test.
    
    Note that the existing implementation didn't work at all, and were base
    on what is done on the detail.pl page (using table_filters.js)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 829d193a1aee8492336c300b2314473420f7bb80
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 8 12:10:22 2021 +0100

    Bug 27402: Add DT column filtering to the cities admin page
    
    Bug 24561 added a wrapper to use easily all the DataTables functionalities when a REST API route was used within Koha.
    
    The filtering method used is working for the global search filter, but not if we have a filter on top of each column.
    
    This patchset is going to, first, add the filters on top of each column
    of the cities table, then the code will be moved to the DT REST API wrapper to make it reusable easily.
    
    Test plan:
    
    Generate some cities:
      use Koha::Cities;
      for ( 1 .. 42 ) {
          Koha::City->new({city_name => "name_$_", city_state => "state_$_", city_country => "country_$_", city_zipcode => "zipcode_$_" })->store;
      }
    Hit /admin/cities.pl
    Use the filters
    
    The general filter must do a OR query on each of the cities' attributes,
    when column filters must use AND
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab5663ca84c88f8b76481c238dbae8b4dcdf2c79
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 25 14:50:20 2021 -0300

    Bug 27353: (QA follow-up) Fix number of tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ddb60e292bd0014cff9ab8416f6138c8e6b03b7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 6 16:34:23 2021 +0100

    Bug 27353: Set X-Base-Total-Count header for REST API
    
    We already set X-Total-Count to the total number of filtered rows,
    but we don't have the total number of non-filtered rows.
    
    Test plan:
    This is easy to test on top of bug 27352 or bug 27251, apply them if not
    pushed yet.
    1. Create 40 items with public notes = "xxx" for biblionumber=4
    then, using Postman (or whatever you prefer):
    http://kohadev-intra.mydnsname.org:8081/api/v1/biblios/4/items?_page=1&_per_page=20&q=[{"me.public_notes"%3A{"like"%3A"%25x%25"}}]&_match=contains
    Check the headers and confirm you see X-Total-Count=40 and
    X-Base-Total-Count=44
    
    2. go to /cgi-bin/koha/tools/quotes.pl
    You see "Showing 1 to 20 of 28 entries"
    Search "he"
    Showing 1 to 20 of 22 entries (filtered from 28 total entries)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58c1ddc15176a347c2d2a8a8b3b0feda3d7084b8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 6 17:11:30 2021 +0100

    Bug 27353: Add tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 316dc934d3a792bc233d71372f41d9800fbd73b3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 25 10:35:20 2021 -0300

    Bug 27544: Simplify GET /checkouts implementation
    
    This patch makes the list() controller method simpler, by removing the
    checked_in parameter, and passing the appropriate restulset.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/checkouts.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat (1)
    => SUCCESS: Tests still pass! (no behaviour change)
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcd336168300b453749d5ec12355a74fd4ff57f3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 16:16:00 2021 -0300

    Bug 25670: New orders included only if standing
    
    The original implementation included new orders regardless they were
    standing orders.
    
    This patch makes the query respect that conditions found on
    C4::Acquisitions::SearchOrders.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Acquisition/Orders.t
    => FAIL: More orders than expected are returned
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! New orders are only considered if the basket
    they are attached to, is marked as standing!
    5. Verify the tests make sense
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52a75bba8771f2c4eec4e684970b7035b9efc761
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 16:15:54 2021 -0300

    Bug 25670: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44c570e4330a052e4e92b7fbc04465ed3a7a9340
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jun 3 16:58:33 2020 -0300

    Bug 25670: Add filter_by_active and filter_by_id_including_transfers
    
    This patch introduces a method to filter on the ordernumber, looking for
    it on the aqorders_transfers table ('ordernumber_from' field).
    
    It also adds a method for filtering on active orders.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Acquisition/Orders.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    lib
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94f27023d88ab6dbff8ae83f2ee0aa4c71f86ae4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jun 3 16:58:25 2020 -0300

    Bug 25670: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b23c0634b43a60f0a434d4c43a3e57718ad0806
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 27 12:03:33 2021 +0100

    Bug 14004: Set the syspref's value to an empty string
    
    It's tested with "defined" in C4::Context->preference
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c009eeafed32f0da9ef3c81e5b3e748745c9f900
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 21 17:09:27 2021 +0100

    Bug 14004: Add OpacAdditionalStylesheet and opaclayoutstylesheet
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 180db2f63b83dc4052b42e3073be9893e7495a1f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jan 12 11:15:25 2021 +0100

    Bug 14004: Add ability to temporarily disable JS/CSS sysprefs
    
    It would be *super* handy if intranetuserjs and/or opacuserjs could be
    temporarily disabled via a check-box or syspref.
    Right now, debugging issues in intranetuserjs usuaally starts with
    copying the contents into a text file, blanking the syspref and re-testing.
    
    This patch adds this feature by setting syspref via ENV
    OVERRIDE_SYSPREF like override via Apache config.
    
    Implemented only for preferences :
    OPACUserCSS OPACUserJS IntranetUserCSS IntranetUserJS
    => replaced with ' '
    intranetcolorstylesheet intranetstylesheet
    => replaced with 0
    
    Test plan :
    1) Set some CSS in IntranetUserCSS like : #breadcrumbs{color:red}
    2) Go to staff interface home page like : /cgi-bin/koha/mainpage.pl
    3) See CSS impact is visible
    4) Edit URL : /cgi-bin/koha/mainpage.pl?DISABLE_SYSPREF_IntranetUserCSS=1
    5) See CSS impact is not visible
    6) Check with the other preferences
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7193759e54d6521a64b551a22481fef1babe1ab7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 11 13:49:33 2021 +0000

    Bug 23302: (QA follow-up) Fix filters
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 523370998434303b10071cce18c7e3de7b70dad4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 12 14:47:47 2020 +0000

    Bug 23302: Less clicks on Z3950 search results
    
    Functional change: Instead of requiring two clicks for each option in
    the Actions menu, we add a default action based on previous activity.
    
    NOTE: In order to prioritize MARC and Card preview actions, we will only
    remember Import and Order when it is not preceded by a preview. In other
    words: If you directly click Import, Import comes back. If you click Card
    and Import, Card comes back.
    
    Technical changes:
    [1] Combine Preview and Order button on Acquisition Z3950 search.
    [2] Use Actions link as default action and add button with caret to open the dropdown.
    [3] Keep last action in localStorage (sessionStorage makes not much sense for the popups), prioritizing previews.
    [4] Where needed, add title attributes to dropdown links. Use class 'chosen' to differentiate preview popups from import/order actions.
    [5] Replace previewMARC by previewData in Authority Z3950 search. Remove duplicate code.
    [6] Use link href from template instead of constructing link in javascript.
    [7] Removing unused linktools markup from acqui template.
    
    Test plan:
    [1] Start on acqui Z3950. Choose Card once from the menu and then Order.
    [2] Start auth Z3950. Verify that Default is MARC now. Close popup.
        (Since Card is no option here.)
    [3] Start cataloguing Z3950. Verify that you have Card as default.
        Click Import rightaway.
    [4] Back to auth Z3950. Verify that Import is default. Click Import.
    [5] Back to acqui Z3950. Verify that MARC is default (no Import here).
        Click Order. Go back and verify that Order is now default.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff494ecbadfadf568ce0c06426d993b36c0991e3
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Jan 21 22:38:57 2021 +0000

    Bug 11257: (QA follow-up) Add thank you
    
    Even if we are grumpy because they still have not returned the items,
    we should be nice :)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99888359533b3643d7634fb4b599d6bb8301f7d3
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Thu Jan 21 05:53:46 2021 +0000

    Bug 11257: (followup) Document <<items.content>> for DUEDGST and PREDUEDGST and update sample notices
    
    This patch changes the default text for the DUEDGST sample notice to the
    following:
        Dear <<borrowers.firstname>> <<borrowers.surname>>,
        The following item(s) are due:
        <<items.content>>
    (it does not include an atomic update)
    
    Test plan:
    1. Select "edit" on DUEDGST in the notices and slips page (Home ->
            tools -> Notices and slips)
    2. Open "email", and note the default text.
    3. Apply the patch, and peform a fresh install of Koha.
    4. Navigate to the same page. The default text should have changed.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d7a91654cf3e30afe48303cc66aac7bdd1dcb9a
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Tue Jan 19 22:47:53 2021 +0000

    Bug 11257: PREDUEDST should have more useful default text
    
    This patch changes the default text of PEDUEDST to the following:
        Dear <<borrowers.firstname>> <<borrowers.surname>>,
        The following item(s) will be due soon:
        <<items.content>>
    
    Note: I dont beleive ive done everything requesting in the bug, ie there
    was a request to add  <<items.content>> to the documentation of
    sample_notices.yml, but I couldn't find documentation for it. If there's
    things I missed, please tell me so I can make the appropraite changes,
    or feel free to make the changes yourself.
    
    Test plan:
    1. Select "edit" on PREDUEDST in the notices and slips page (Home -> tools
            -> Notices and slips)
    2. Open "email", and note the default text.
    3. Apply the patch, and peform a fresh install of Koha.
    4. Navigate to the same page. The default text should have changed.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD amended patch: Remove double spaces in PREDUEDST
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03dea5f51e3859090f563f72475cffa1da9c7645
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 27 11:35:35 2021 +0100

    Bug 27029: Add a selenium regression test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e60ab4f032642200b8a3c19ad2ff05d98641460
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 22 10:58:06 2021 +0000

    Bug 27029: (QA follow-up) Adding html filter
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f17a631d873f971ac139534fc2867c7ac86b7bd5
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon Nov 16 00:31:21 2020 +0000

    Bug 27029: Add data-biblionumber attribute to OPAC detail page
    
    This patch adds a data-biblionumber attribute to the
    div#catalogue_detail_biblio elements on opac-detail.pl, so that
    Javascript running on the page can easily fetch and use the
    record's biblionumber.
    
    Signed-off-by: Mark Hofstetter <mark@hofstetter.at>, <koha@trust-box.at>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e063bd4f5909f0f9babb328bbecce3354d75d20b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 11:22:30 2021 +0000

    Bug 27525: Replace "wich" with "with" in batch delete template
    
    This patch corrects two typos: "wich" -> "with."
    
    To test, apply the patch and check the batch delete template
    (batchMod-del.tt) and confirm that the two instances of this sentence
    are correct:
    
    "Last item for bibliographic record with biblio-level hold on it"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43c475bc96214109af78d2aae4e87809c802e8dc
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Mon Jan 25 09:59:57 2021 -0500

    Bug 27547: Typo in parcel.tt
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8b02439ab65a9f121cbb91abd3fd1ae95c5e84e
Author: Amy King <amyking386@gmail.com>
Date:   Thu Jan 21 21:21:24 2021 +0000

    Bug 27471: Change auth merge success link text and don't redirect
    
    Test Plan:
    1. Follow the steps above to reproduce
    2. Notice how there is no message telling the user that the merge was
    successsful
    3. Apply patch
    4. Repeat step 1
    5. Now notice how the user is redirected to a page with a message that
    says that the merge was successful, and there is a link with helpful
    text to view the merged record
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52b3ff7258a0d2c0809decce0e72cd488fb0ad07
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jan 24 02:30:29 2021 +0000

    Bug 27446: (QA follow-up) Add missing filters
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42419de5e33c5d8f01c380213db8969f0f6b1cf3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 25 11:30:30 2021 +0000

    Bug 27446: Markup errors in suggestion/suggestion.tt
    
    This patch makes various corrections to the suggestions template in the
    staff interface:
    
     - Correct indentation
     - Fix unclosed tags
     - Fix non-unique IDs
     - Add comments to highlight markup structure
    
    To test, apply the patch and test the suggestions interface in the staff
    client:
    
     - Viewing the list of suggestions
     - Viewing the details of a single suggestion
     - Filtering suggestions
     - Organizing suggestions
    
    Test that labels on form controls work correctly, including under each
    tab.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43f9758c3d3fe660cff464e1b575bb3e99cb73da
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Thu Jan 21 14:11:24 2021 +0200

    Bug 27508: do nothing if tag label elements don't exist
    
    When JavaScript make copy of DOM set for MARC tag, it tries to reassign
    label elements to another id, the problem is there is no check for
    existence of that label element, so in case when option
    "advancedMARCeditor" is set to "Don't display", labels were absent
    which caused JavaScript to crush in the middle of process with uncaught
    exception.
    
    This patch wraps this label assignment in try/catch hook like it's done
    in the code around for other elements, to allow the script to proceed
    when description labels are not present.
    
    To test:
    1) Check in the system preferences interface subsection that
       "advancedMARCeditor" is set to "Display".
    2) Go to the "Add MARC record" cataloguing section and press "Repeat
       this tag" button near the MARC tag record to ensure that it makes
       duplicate in the interface as expected.
    3) Then again in the system preferences interface subsection change
       "advancedMARCeditor" to "Don't display".
    4) Return back to the "Add MARC record" interface, refresh the page to
       have no MARC field labels displayed, and try duplicating the tag
       again.
    5) Ensure that it doesn't work, also you can notice a JavaScript error
       "Cannot read property "setAttribute" of undefined..." in the
       JavaScript console of your browser.
    6) Apply the patch.
    7) Repeat the test sequence (changes will be in the step 5), ensure that
       the tag gets duplicated even when description labels are not present.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32d482130749fdb17cb33e2ee48b0ae0acce835a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 16:43:58 2021 +0000

    Bug 27531: Remove type attribute from script tags: Cataloging plugins
    
    This patch removes the no-longer-valid "type" attribute from script tags
    found in cataloging plugin templates.
    
    I don't think testing each plugin individually is a reasonable thing to
    ask for a test. I think a visual verification of the changes in the
    patch should be enough.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c5ad42eddce1c357bf6dc64301f774f93a06e0e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 27 12:23:45 2020 +0000

    Bug 25614: Move ILL request keyword filter to sidebar
    
    On the ILL request list page there are two filters for the table: One in
    the sidebar and one configured automatically by the DataTables plugin. I
    think these two systems are conflicting somehow to prevent the "clear
    filter" button in the table toolbar from working correctly.
    
    This patch doesn't fix the bug but avoids it: Since the filter field in
    the table toolbar is duplicating the functionality of the form in the
    sidebar, we could hide it and rely on the sidebar filter instead.
    
    To test, apply the patch and go to the ILL requests page in the staff
    interface.
    
     - The table of requests should display without a search form or "clear
       filter" button at the top.
     - The left-hand sidebar form should now have a "keyword" filter option
       which searches any column in the table.
     - Other filter fields should work as before.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c117df8e30c2067dd70a4573989d24e354145adc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 22 09:04:07 2021 +0000

    Bug 11344: (QA follow-up) Fix empty section warning
    
    *** WARNING: empty section in previous paragraph at line 28 in file misc/cronjobs/advance_notices.pl
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cb6927458dfd9195a7f9cb536b2ca386f7ffb88
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Tue Jan 19 21:16:49 2021 +0000

    Bug 11344: Perldoc issues in misc/cronjobs/advance_notices.pl
    
    This patch removes the double ups in the perldoc of the above file,
         deleting the less clear double ups. The missing "-c" in OPTIONS
         appears to have been fixed in an earlier patch (it is there
                 already).
    
    Task Plan:
    1. Run perldoc misc/cronjobs/advance_notices.pl in the terminal. Note
    the double ups of NAME, SYNOPSIS, and DESCRIPTION
    2. Apply the patch
    3. Run the command again. The double ups should be gone, with the more
    clear version of each of NAME, SYNOPSIS, and DESCRIPTION remaining.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5f3fdcc15bc5d1a013321944c90ce49f5c58e6c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 11:10:12 2021 -0300

    Bug 27333: Throw the right exceptions
    
    If parameters are missing, we need to throw
    Koha::Exceptions::MissingParameter exceptions.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Club/Hold.t
    => FAIL: Tests fail because the method doesn't throw the right
    exceptions
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ece5964861577185d96e2834f04f42bcc68d40e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 11:09:54 2021 -0300

    Bug 27333: Regression tests
    
    Test for the right exceptions
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17a3476d7e45fae092fdd20ce78df8b0945d1fb1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 4 10:35:37 2021 -0300

    Bug 27327: Get rid of indirect object notation in Koha::Club::Hold
    
    This patch makes the code follow the PERL29 coding guideline. Period.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 582fc2730a9cc64e11410829f11d9f09067471af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 27 10:45:51 2021 +0100

    Bug 27543: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fad566dbccd669f5119fc978d01850d1e8080f2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 25 12:30:55 2021 +0000

    Bug 27543: Tooltip on opac-messaging.pl obscured by table headers
    
    This patch corrects which Bootstrap assets are compiled with the OPAC
    CSS -- The file for Bootstrap tooltips should be included.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    1)  Log into the OPAC.
    2)  Go to 'your messaging' (opac-messaging.pl).
    3)  Hover over the Digests only tooltip.
    4)  Note that the tooltip looks correct.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fdceaa3b5b2bb37127e53638857f4196498d077
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Jan 21 01:02:49 2021 +0000

    Bug 26048: Use ErrorDocument middleware for Plack HTTP errors
    
    This patch uses the ErrorDocument middleware to use Koha's
    custom error pages instead of generic Plack error responses
    
    Test plan:
    0. Apply patch
    1. vi /usr/sbin/koha-plack (and change "development" to "deployment")
    2. vi ./opac/opac-main.pl
    3. Add "die" to line 2
    4. vi ./mainpage.pl
    5. Add "die" to line 2
    6. cp ./debian/templates/plack.psgi /etc/koha/sites/kohadev/plack.psgi
    7. koha-plack --restart kohadev
    8. Go to http://localhost:8080/cgi-bin/koha/opac-main.pl
    9. See a beautiful OPAC 500 error instead of "Internal Server Error"
    10. Go to http://localhost:8080/cgi-bin/koha/blah.pl
    11. See a beautiful OPAC 404 error instead of "not found"
    12. Go to http://localhost:8081/cgi-bin/koha/mainpage.pl
    13. See a beautiful Staff interface 500 error instead of "Internal Server Error"
    14. Go to http://localhost:8081/cgi-bin/koha/blah.pl
    15. See a beautiful Staff interface 404 error instead of "not found"
    
    For bonus points:
    16. koha-plack --disable kohadev
    17. koha-plack --stop kohadev
    18. service apache restart
    19. Repeat the above test plan to show CGI still works for 404 (although 500
    will show "Software Error" due to C4::Context needing some improvements)
    20. Using the "Network" tab on your developer tools, make sure 404 and 500
    are returned by the appropriate error pages
    
    Signed-off-by: Eden Bacani <eden.bacani@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1969157e1596a36fdf3d63507e2bbbf7a26ddc53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 25 10:52:02 2021 +0100

    Bug 27491: Fix t/Languages.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b7aecb00634e2fe4c8358dd99cef880916a5fc4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 22 14:52:07 2021 +0100

    Bug 7143: Update about page for new devs
    
    Eden Bacani
    Ella Wipatene
    Ava Li
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44fa29014774b49f73c3c27fe4043df437b0b8d8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 22 14:19:54 2021 +0100

    Bug 22150: (follow-up) ensuring superlibrarian flag not checked when select all
    
    Use #flag-0 to select the superlibrarian checkbox
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 019d4af0f28c1f82fd6d9bd627ba6671f68fead0
Author: Ava Li <rubyli208@gmail.com>
Date:   Wed Jan 20 21:38:15 2021 +0000

    Bug 27478: Improved link text when viewing ILL reqested item
    
    TEST PLAN:
    1) Follow
    
    https://koha-community.org/manual/20.11/hi/html/ILL_requests.html
    and
    https://wiki.koha-community.org/wiki/ILL_backends
    to enable Interlibrary loans if you haven't already.
    
    2)In the Koha staff website or OPAC website, make an ILL request.
    (if in the Koha staff website, use your own card barcode)
    
    3) Go the the OPAC website, your account (top right), 'your
    interlibrary loan requests', view request
    
    4) The text should be as follows "Requested item: View the requested
    item" If so the patch has worked.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e54ceac8dbf855260adea9c1808cdc5d2c94636
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 20 14:02:43 2021 +0000

    Bug 27469: (follow-up) Correct terminology
    
    We should use "vendor" instead of "bookseller."
    
    https://wiki.koha-community.org/wiki/Terminology
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccbf02cc47a1dcb37d17dc27e17d09a21f4506d5
Author: Ella Wipatene <ellawipatene@gmail.com>
Date:   Wed Jan 20 00:29:00 2021 +0000

    Bug 27469: Improve link text when returning to booksellers page
    
    This is to make the link more accessible for screen readers.
    1. (Without patch) go to 'Acquisitions' and then 'Basket'
    2. The link for the booksellers page should say 'Click here to go back
    to booksellers page'
    3. Add patch
    4. The link should now just say 'Go back to booksellers page', i.e.
    there is now no 'Click here'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5b4f7663b0ed991ad892b54647a4a2a32bb01b8
Author: Ella Wipatene <ellawipatene@gmail.com>
Date:   Tue Jan 19 03:34:08 2021 +0000

    Bug 27415: Add note to ILLHiddenRequestStatuses
    
    1. (Before adding patch) Go to 'Koha administration' - then to 'Global
    system preferences'
    2. On the left-hand side of the screen, go to 'Circulation' and then
    'Interlibrary loans'
    3. Look at the ILLHiddenRequestStatuses preferance - it should not have
    any text talking about request codes in ILLSTATUS
    4. Add the patch
    5. Redo steps 1-3
    6. The ILLHiddenRequestStatuses preferance should now have the sentance
    'The request code can be found in the ILLSTATUS authorizes value
    category.' under the value column.
    
    Sponsored.by: Catalyst IT
    
    JD Amended patch: fix commit title
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 638f5106352fc1c5a758af06061a68f65264b791
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Wed Jan 20 22:24:05 2021 +0000

    Bug 27495: Added Accessibility advocate role in team page
    
    Test Plan
    1. Click on 'About Koha' from the home page
    2.Check on the  Koha Team page that the role Accessibility advocate is
    listed under the Koha release teams and that the name of the person with
    the role  appears.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b3b3f5d78abd1acd3c7bde6c9f993e2e44c62a3
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Tue Jan 19 02:21:32 2021 +0000

    Bug 27098: Renames Relatives fines to Relative charges
    
    1. Check on website that users that are guarantor see charges under
    Relative charges instead of Relatives' fines
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2379b57973175e28bfaca2f5fdddb13c8e555bd
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Tue Jan 19 01:44:12 2021 +0000

    Bug 25802: Change addDate to addDuration
    
    1. Check using git grep command that addDate does not exist
    2. Check the patch that addDuration is spelt right
    3. Check that tests pass t/Calendar.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 214ff006e1fd230c95c43da60804b72a92238079
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Tue Jan 19 20:14:32 2021 +0000

    Bug 22152: Hide tools navigation when printing reports
    
    1. Go to reports and print any report
    2. Check that navigation does not show up when report is printed.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f7eb070cc7baadd305b3546f36c40b434504abf
Author: Catherine Ma <catherinem2003@gmail.com>
Date:   Thu Jan 21 02:23:22 2021 +0000

    Bug 27022: Publisher number 028 does not display according to framework settings
    
    Test plan:
    1. search the catalogue for an item
    2. check if you can see the publisher number below the item title (you shouldn't)
    3. click on the item and check if you can see the publisher number on
    this page (you shouldn't)
    4. in a new browser, repeat steps 1-3 on the OPAC
    5. apply patch
    6. repeat steps 1-4, however this time the publisher number SHOULD
    display under the item titles
    
    Sponsored by Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c826c9e22c119c127e8ec2a1e0ab537b8cab99d5
Author: Amy King <amyking386@gmail.com>
Date:   Wed Jan 20 23:06:41 2021 +0000

    Bug 27479: Improve link text to be more helpful (opac-password-recovery.tt)
    
    Test plan:
    1. Follow the steps above to reproduce, and notice how the link says
    "Click here to login"
    2. Apply patch
    3. Follow the steps above to reproduce again, but now notice how the
    link says "Log in to your account"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0ff0064ff223991a2812d7b1b4b5a4c53dd8213
Author: Amy King <amyking386@gmail.com>
Date:   Wed Jan 20 03:00:11 2021 +0000

    Bug 27477: Improve link text to be more helpful (opac-detail.tt)
    
    Test plan:
    
    1. Follow the above steps to reproduce, take note of the link saying
       "click here"
    2. Apply patch
    3. Repeat step 1, but now notice how the link says :View all the
       physical items"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68cf7982e2afd57a5e3077c516fd8482bef00bb3
Author: Amy King <amyking386@gmail.com>
Date:   Wed Jan 20 22:21:21 2021 +0000

    Bug 27474: Improve link text when no avaliable printer profiles
    
    Test plan:
    1. Go to tools, click on label creator.
    2. Make sure you have some(1-2) printer profiles free to attach to a
    label template. You can do this by clicking on manage, printer profiles,
    if there is a blank space under the "Template name" header, then it is
    free to attach to a label template.
    3. Click on add new label template.
    4. Note how there is a drop down menu beside "Profile:", to select a
    printer profile.
    5. Assign all of the avaliable printer profiles by making new label templates.
    6. Now woth no avaliable printer profiles, click on add a new label
    template.
    7. Note how there is a drop down menu beside "Profile:" only "No
    Profile/Na" is avaliable to select.
    8. Apply patch.
    9. Repeat steps 2-6.
    10. Now note how there is a link to make a new printer profile, under
    the drop down menu next to "Profile:"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93240e2d39b04d6d86788a002b01c63b4c267c7f
Author: Amy King <amyking386@gmail.com>
Date:   Wed Jan 20 20:12:44 2021 +0000

    Bug 27472: Improve link text (merge.tt)
    
    Test plan:
    1. Complete the steps above to reproduce, specially noting the last
    step.
    2. Apply patch
    3. Complete step 1 again, but now notice how the link says "View the
    merged record"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7aea86377fbbb3c3f21fa91ad901e79e9a535076
Author: Amy King <amyking386@gmail.com>
Date:   Thu Jan 21 01:51:24 2021 +0000

    Bug 22150: ensuring superlibrarian flag not checked when select all
    
    Test plan:
    1. Go to a patron account page
    2. Click more, set permissions
    3. If you select Superlibrarian, you can't unselect on box.
    4. Apply first patch by Jasmine Amohia
    5. Follow steps for that patch
    6. Apply patch
    7. Go through steps 1-4 from Jasmine Amohia, but now notice how when you
    click "Select all" the Superlibrarian checkbox is not checked
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7241e519956213bff7851d21a4788bf0ef5b0a61
Author: Jasmine Amohia <jasmineamohia.student@wegc.school.nz>
Date:   Thu Jan 21 12:00:38 2021 +0000

    Bug 22150: Ability to select or unselect all member flags
    
    To test:
    1) Find a patron
    2) Click More -> Set permissions
    3) Click 'Clear all', confirm all checkboxes get cleared and disabled
    4) Click 'Select all', confirm all checkboxes get selected
    5) Unselect one checkbox (not superlibrarian), and confirm that the
       superlibrarian checkbox also gets unselected
    6) Confirm that saving still works as expected
    
    Edit: Rebased by Owen Leonard
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a22b3bb504b0a9a77aa9ce3e9f326cc71fcf8d96
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Tue Jan 19 02:01:43 2021 +0000

    Bug 27179: Misspelling of Method in REST API files
    
    Test Plan:
    1. Run "git grep -i mehtod" (which should return 2 files)
    2. Apply patch
    3. Rerun grep command (should return no files)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e8f526cceaacde89c0fb386533191b0da74523e
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Tue Jan 19 09:50:09 2021 +0000

    Bug 27407: Update reserve/request.tt for ACC2
    
    Test Plan:
    1. Open intranet-tmpl/prog/en/modules/reserve/request.tt for ACC2
    2. Check for instances of 'input type="number"'
    3. If none are found then patch was successful
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5170f8ee1b6ce3007787d2415aba7794dbaded3
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Tue Jan 19 01:49:43 2021 +0000

    Bug 27210: Typo in patron-attr-types.tt
    
    Test Plan:
    1. Make sure the ExtendedPatronAttributes syspref is active
    2. Go to Administration > Patron attribute types
    3. Click New patron attribute type
    4. Check the sentence next to the Editable in OPAC checkbox (Should say
            "Requires above, does not work during self-registration if
            PatronSelfRegistrationVerifyByEmail if set." - Notice the use of
            'if set')
    5. Apply Patch
    6. Repeat steps 2-4 (Should now say "Requires above, does not work
            during self-registration if PatronSelfRegistrationVerifyByEmail
            is set." - Notice the use of 'is set')
    7. If it says 'is set', the patch works as expected.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dd87e9b73e9b8999b35a3b9cb7fc0583cd79767
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 22 13:44:51 2021 +0000

    Bug 27491: DBRev 20.12.00.005
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c90ee1be60f04391bd63781938be73747ec7ef2e
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Thu Jan 21 06:26:54 2021 +0000

    Bug 27491: Rename system preference opaclanguages to OPACLanguages
    
    Test Plan:
    
    1. Go to Administration
    2. Go to System Preferences
    3. Find 'opaclanguages' (note the lack of capitalisation)
    4. Apply patch
    5. Repeat step 1 and 2
    6. Find 'OPACLanguages' (note the use of capitalisation)
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46a403a356c6ec4a54cac445659e66ff332a75f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 22 13:44:51 2021 +0000

    Bug 27485: DBRev 20.12.00.004
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ddf2e8ec01794b4d6eba5ab285e7772bb7a53d7
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Wed Jan 20 21:23:28 2021 +0000

    Bug 27485: Rename system preference gist to TaxRates
    
    Test Plan:
    
    1. Create a vendor
    2. Create a basket
    3. Add an order to the basket (note the existence of the option 'gist'
    4  Apply patch
    5. Create another order (note the existence of the option 'TaxRates'
        instead)
    6. Run 'prove t/Prices.t' to confirm the tests were successful
    7. If everything above is correct then patch was successful
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6009f32205c7b6c19a4dfe0346a1ebed0c05a71
Author: Ava Li <rubyli208@gmail.com>
Date:   Tue Jan 19 21:01:15 2021 +0000

    Bug 24811: French SQL files "news" link fixed
    
    This fixes a broken link in the sample news items for fr-FR and fr-CA.
    
    Test plan:
    
    1) Apply the patch.
    
    2) Install the French language files - see
    https://wiki.koha-community.org/wiki/Installation_of_additional_languages_for_OPAC_and_INTRANET_staff_client
    
    3) When Koha is in French, from the home page of the staff interface go to Tools/Outils > News/Annonces, and make sure the two news items are there.
        -If not, try importing the two files into your database or reset and install Koha in French (fr-FR or fr-CA).
    
    4) There should be a news item with the heading Et maintenant ?, click the 5th link "proposez des correctifs et des améliorations".
    
    5) If should take you to
    https://wiki.koha-community.org/wiki/Version_Control_Using_Git
    and there is no 404 error, the patch has worked!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42aac43290dbcb8cb1cfecbe685e738c8a95ee67
Author: Ava Li <rubyli208@gmail.com>
Date:   Tue Jan 19 03:44:44 2021 +0000

    Bug 24810: French SQL files for "news" removed "3"
    
    TEST PLAN
    Follow https://wiki.koha-community.org/wiki/Installation_of_additional_languages_for_OPAC_and_INTRANET_staff_client in order to install french.
    When koha is in french, from home go to tools/outils, then
    news/Annonces, make sure the two files are there.
    Preview them there or view them from the homepage and check that the 3
    is gone.
    If the files are not there, try importing the two files into your
    database.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 297d93ec449c08430c13ba75659f48e6a3f563c0
Author: Ella Wipatene <ellawipatene@gmail.com>
Date:   Thu Jan 21 02:45:07 2021 +0000

    Bug 24055: (follow-up) Description of PayPalReturnURL system preference
    
    Have rephrased it as 'configured return URL' as this is what they call
    it on the PayPal website.
    
    To test:
    - Go to Administration/ System preferences
    - Search for PayPalReturnURL
    - Verify description has changed to 'configured return URL' as one of
    the options.
    
    Sponsored.by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b31073af292e391cd1df1be3894029460fa6040
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Apr 11 20:05:14 2020 +0000

    Bug 24055: Rephrase description of PayPalReturnURL slightly
    
    changes 'OPAC's alias' to 'specified URL' as suggested by
    Tomas on comment#2.
    
    To test:
    - Go to Administration / System preferences
    - Search for PayPalReturnURL
    - Verify description has changed to "specified URL" as
      one of the options
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c706b8aa13edd39769324ad2d5937d9d4d5ae583
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 21 16:09:58 2021 +0000

    Bug 20527: (QA follow-up) Fix type 'Wiriteoff'
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3992816b20bf97de904d485e775c32b93df0726
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Thu Jan 21 02:54:30 2021 +0000

    Bug 20527: Corrected paid to amountwrittenoff
    
    Test Plan
    1. Go to My account and go into accounting
    2.Create manual invoice (If you already have invoices skip this step)
    3.On the Make a payment tab click on Write off under actions of an
    invoice
    4. Click on Writeoff amount label and make sure that the amount written
    is highlighted in green.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 040d79a02c8bb9a860e2c431e1c3ade8732a607a
Author: Amy King <amyking386@gmail.com>
Date:   Tue Jan 19 01:55:00 2021 +0000

    Bug 27027: Fixed typo - extra dot removed
    
    Test Plan
    Before applying patch
    1. Open koha-tmpl/intranet-tmpl/prog/en/modules/admin/background_jobs.tt
    2. Note how in line 125 "has successfully been modified.." has two full
    stops
    3. Apply patch
    4. Repeat step 1
    5. Note how there is only now one full stop in line 125 "has been
    successfully ben modified."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 732e69f4b25b7af22ab034f143b8df5d7ffd263a
Author: Ella Wipatene <ellawipatene@gmail.com>
Date:   Thu Jan 21 01:46:21 2021 +0000

    Bug 11996: (follow-up) Updating the uk-UA currency
    
    I have changed GRN to UAH in both
    installer/data/mysql/ru-RU/optional/sample_currency.sql and in
    installer/data/mysql/uk-UA/optional/sample_currency.sql
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6bb8065af69438673ca5ed0bca0664c366a87e02
Author: Ethan Amohia <ethan.amohia@gmail.com>
Date:   Thu Jan 17 02:42:32 2019 +0000

    Bug 11996: Made RUB default currency for ru-RU
    
    Didn't know how to change the uk-UA default currency.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a0ff7c5ceab836631be060a4571681ff40e275c
Author: Eden Bacani <eden.bacani@gmail.com>
Date:   Thu Jan 21 01:20:49 2021 +0000

    Bug 24447: Changing 'DUE' to example in database that exists.
    
    Test Plan:
    1.Using  perldoc C4/Members/Messaging.pm check that message_name
    attribute name example  is Item_Due and not DUE.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02adae8a5f7ecf8f6e44042d078e406b0aacf19a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Jan 21 23:44:10 2021 +0000

    Bug 25381: (QA follow-up) Fix occurence in the one file that escaped
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10c08b6552c7063c4c029701018d6f54e6549acb
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Fri May 8 15:19:54 2020 +0200

    Bug 25381: XSLTs should not define entities
    
    Bug 23290 explicitly disabled entity expansion during XML parsing for security reasons.
    
    However, many XSLTs define the following entity:
    <!ENTITY nbsp "&#160;" >
    
    They don't use the entity &nbsp, but its presence could lead to confusion.
    
    Signed-off-by: Eden Bacani <eden.bacani@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcd4ab94cd0a7b0a599cdc507810f9a8eb819202
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 21 17:21:15 2021 +0100

    Bug 27509: Prevent cn_sort value to be lost when editing items
    
    This is a bit dirty, cn_sort is not passed from the UI but built in
    Koha::Item->store depending on the values of itemcallnumber and
    cn_source.
    It must be updated only if one of those 2 attributes are modified.
    The problem is that, as it's not passed, $item->{cn_sort} does not exist,
    and set_or_blank will set it to undef.
    The trick here is to backup the value before set_or_blank and set it
    back to the item object.
    Another solution would be to force the processing of cn_sort each time
    we call Koha::Item->store. I don't think that's a good idea.
    
    Test plan:
    - Create a new item with a cn_source value and an itemcallnumber value
    - write a quick report to see the cn_sort value: SELECT cn_sort FROM items WHERE itemnumber=your itemnumber, see your item has a cn_sort value
    - edit your item and save it without changing either the cn_source of the itemcallnumber
    - run your report again, cn_sort is not modified
    - edit your item, changing either the cn_source or itemcallnumber
    - run report again, cn_sort is modified as expected
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a57278f39b8c5b7a82b21671f266dbf32e2d41a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 21 16:01:19 2021 +0100

    Bug 7143: Update about page for new devs
    
    Mazen Khallaf
    Amy King
    Catherine Ma
    James O'Keeffe
    Victoria Faafia
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 400b4e08aa27875af328733961b6cce2d45333c3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 21 15:12:26 2021 +0000

    Bug 22752: (follow-up) Add style; Only show message about item-level holds
    
    I think it's generally assumed that a hold has, by default, been made at
    the bibliographic level. I think it's sufficent to add a note for only
    item-level holds.
    
    To test, apply the patch and log into the OPAC as a user who has
    multiple holds, some at the bibliographic level and some at the item
    level.
    
    - Go to Your summary --> Holds
    - Confirm that any item-level hold has a note under the title: "Item on
      hold <barcode>".
    - The note should be on a new line and styled differently than the other
      text.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46ba6fec505cf1dd9d4836c85ab87b2cd96a5ee3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 21 10:57:11 2021 +0000

    Bug 22752: (QA follow-up) Add missing filters
    
    For security, we filter all template variables.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d16215ba076fd1323aa761205dc55b288985be81
Author: Victoria Faafia <vfaafia29@gmail.com>
Date:   Tue Jan 19 03:45:28 2021 +0000

    Bug 22752: Show if a placed hold is a record or item level in the patron account in the OPAC
    
    Test Plan
    1. Have a record with an item
    2. You will need to set a hold through staff account (to import books
            Cataloging>New from Z39.50/SRU>
    3. Keyword(enter any keyword e.g pokemon)
    4. tick library of congress
    5. choose a title and click actions then import
    6. 003 should be OSt
    7. tab 9 koha item type can be books or whatever and press save
    8. select the hold and place hold
    9. on Koha OPAC click on your account and go to the holds and
    underneath the title it should say Only item and the barcode
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e52f554f4a09e8d7da53011aa1703950e5497de
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Nov 18 23:44:43 2020 +0000

    Bug 26630: Add OpacSuggestionInstructions options to News
    
    Test plan:
    1. Apply patch
    2. Go to /cgi-bin/koha/tools/koha-news.pl and create 'New entry' with a dsiplay location of OpacSuggestionInstructions
    3. Login to the OPAC and go to the purchase suggestion page (/cgi-bin/koha/opac-suggestions.pl)
    4. Your new content should be there.
    5. Delete the OpacSuggestionInstructions news entry.
    6. Re-load the OPAC purchase suggestion page and the original text will be restored.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c32111642aa8ddae65aca44fafd9c724dbcddc51
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Tue Jan 19 01:33:19 2021 +0000

    Bug 26982: Typo in system preference UsageStats: statisics
    
    Test Plan:
    1. Go to Administration
    2. Go to System Preferences
    3. Go to Administration (on the right)
    4. At the bottom, under 'Share anonymous usage statistics', find
    UsageStats
    5. In the value box, the bottom line should say 'statisics' instead of
    'statistics'
    6. Apply the patch
    7. Repeat steps 1-4
    8. In the value box, the bottom line should now say 'statistics'
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6bd1258a63d13aa12d4fe9c29f18625141d95dc7
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Wed Jan 20 02:12:08 2021 +0000

    Bug 27475: Improve link text to define a patron card printer profile if none are defined
    
    This patch changes the text on the text link for defining a printer
    profile to make it more clear. It does this by removing the "Click
    here".
    
    Test plan:
    1. Navigate from home -> tools -> patron card creator
    2. Ensure you have no printer profiles
    3. Select "new", and create a new card template
    4. Note the text link "Click here to define a new printer profile"
    5. Apply the patch, and repeat steps 1-3
    6. Note that the "Click here" has been removed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3d556955965df21dde7db3e8d2f8ced15704c9b
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Wed Jan 20 01:04:25 2021 +0000

    Bug 27412: Update tools/overduerules.tt to adhere to ACC2
    
    This patch changes the 1 occurance of an input of type="number" to input type="text" inputmode="numeric" pattern="[0-9]*"
    The "min" attribute has also been removed (Thanks Owen)
    
    Test plan:
    Open the file and ensure that no other inputs of type="number
    were missed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39249b18a299003823eb34f8ab3d5028d77e7c58
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Wed Jan 20 01:26:54 2021 +0000

    Bug 27411: Update tools/automatic_item_modification_by_age.tt to reflect ACC2
    
    This patch changes instances of type="number" in inputs to adhere to
    ACC2 guidelines
    
    Test plan:
    Open the file and ensure all instances of type="number" in inputs are
    changed to 'type="text" inputmode="numeric" pattern="[0-9]*"'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b8a2805f54c6edb5957f2b49af740080e1cb7cf
Author: James O'Keeffe <jamespfk@gmail.com>
Date:   Wed Jan 20 01:52:03 2021 +0000

    Bug 27409: Update members/boraccount.tt for ACC2
    
    This patch changes all instances of type="number" in inputs to adhere
    with the ACC2 guidelines
    
    In addition, all "min" and "step" attributes have been removed from
    these inputs (Thanks Owen).
    
    Test plan:
    Go through the boraccount.tt file and insure that no instances of
    type="number" were missed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53e0f7424cc136f2c1d76b7f3d307a0dbe976245
Author: Catherine Ma <catherinem2003@gmail.com>
Date:   Wed Jan 20 02:53:36 2021 +0000

    Bug 27406: Update elasticsearch mapping to adhere to ACC2
    
    This patch changes the 1 occurance of an input of type="number" to input
    type="text" inputmode="numeric" pattern="[0-9]*"
    
    Test plan:
    open the file and ensure that no other inputs of type="number"
    were missed
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 958a91dc4ec3965956bfbdb8d4cdae5db07c7a0f
Author: Catherine Ma <catherinem2003@gmail.com>
Date:   Tue Jan 19 01:08:28 2021 +0000

    Bug 27457: Set focus for cursor to Debit type code field
    
    Test Plan:
    1.Click administration
    2.Click debit types
    3.Click new debit type
    4.Check if the cursor is in the first form field (it shouldn't)
    5.Add patch
    6.Repeat steps 1-3
    7.Check if the cursor is in the first form field (it should)
    
    Sponsored by Catalyst IT
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d05547dcb64895febca9a79b818d47119fee9a6b
Author: Amy King <amyking386@gmail.com>
Date:   Wed Jan 20 00:57:35 2021 +0000

    Bug 27458: Set focus for cursor to Credit type code field
    
    Test Plan:
    Before applying patch
    1. Click on Administration
    2. Scroll down to Accounting and click on Credit types
    3. Click New credit type
    4. Note how the cursor does not focus on Credit type code field
    5. Apply patch
    6. Repeat steps 1-3
    7. Note how the cursor now focuses on Credity type code field
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch: Edit commit title
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 113992e620095aac59253cf653acfa47f1ec7768
Author: Amy King <amyking386@gmail.com>
Date:   Tue Jan 19 03:27:27 2021 +0000

    Bug 27011: Remove unused $name variable
    
    The variable is no longer used in the template, it has been removed by:
    
      commit 76eb3a0549efe4c1f1557071a6cb4b33d4bd3e4d
      Bug 18789: (follow-up) Pass a Koha::Patron object from returns.pl
    
    -            <td>[% name %]</td>
    +            <td>[% INCLUDE 'patron-title.inc' patron=patron %]</td>
    
    We can simply remove the $name variable from the controller script.
    
    Test Plan:
    1. Check out a book
    2. Check in a book
    3. Note what happens
    4. Apply patch
    5. Repeat step 1-2
    6. Note that it doesn't break and everything still works
    
    JD Amended patch: fix commit message
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c66a88aea7579b67f869163c11fec70cd73b98c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jan 20 09:35:33 2021 -0500

    Bug 25808: (QA follow-up) Fix unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdf1ec7b71042e26a952329838093391fe8a21f6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 14 14:40:31 2021 +0000

    Bug 25808: (QA follow-up) Add regression test
    
    This patch adds a basic regression test for the bug.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch: remove trailing space char
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cdfa37e63901c713f817fb44c279367a0c21ab0
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 18 13:23:04 2020 -0400

    Bug 25808: Renewal via the SIP 'checkout' message gives incorrect message
    
    If a renewal via SIP cannot be made because the patron has reached the maximum number of renewals,
    the AF screen message should read "Item has reached maximum renewals!",
    instead we get "Item checked out to another patron".
    
    Test Plan:
    1) Check out an item to a patron
    2) Using the SIP CLI tool, run checkout messages until the checkout has
       reached the maximum number of renewals
    3) Note the incorrect message in the AF field
    4) Apply this patch
    5) Restart the SIP server
    6) Run another SIP checkout message
    7) Note the message is now correct!
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2f438b881db89ee83e8aef9121b47f65ef9c433
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 21 14:39:51 2021 +0100

    Bug 26947: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a219a78239049245768ae3abd781136745f9a01f
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Fri Jan 8 15:45:32 2021 +0100

    Bug 27192: Automatically set focus to the item type input box
    
    When adding a new item type, you have to click inside the
    "Ιtem type:" input box before you can start entering text.
    
    This patch fixes that by adding the "focus" class to the relevant
    <input> element so that cursor focus is set when the page loads.
    
    Test plan:
    
    1) Try to add a new item type: notice how you have to manually
       click inside the "Item type:" input box before you start typing.
    2) Apply this patch.
    3) Repeat step 1) -- this time the "Item type:" input box should
       gain focus automatically.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e55b18e9a45a233e09c15de04d036e9530333cb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 20 15:20:51 2021 +0100

    Bug 17229: Fix perlcritic on ILSDI_Services.t
    
    Subroutine "new" called using indirect syntax at line 456, column 14.  See page 349 of PBP.  (Severity: 4)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ce9e0160cf7e7264400244f23b314cc8a94ad0e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 22 12:10:56 2020 +0100

    Bug 25245: Add plugins_nightly.pl to the default cron
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 441ba0bd2365b52753c2acbf887466df84245224
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 27 13:30:24 2020 +0100

    Bug 25245: (follow-up) Use Koha::Logger
    
    Update script to use Koha::Logger to capture method failures.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63b926b28b7cb8905fbc12ff3c016231bcc05e7d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 22 12:04:37 2020 +0100

    Bug 25245: Add plugins_nightly.pl cronjob script
    
    This script simply iterates through installed plugins that impliment a
    cronjob_nightly method and runs said method.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df7933d34ea03555dc47fbd58f09b7b0078361b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 20 13:49:18 2021 +0100

    Bug 27439: Remove repetition in hint
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6bf70a9fcf8ab91acd36ecc46d5f62c629b3766
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 14 17:53:49 2021 +0000

    Bug 27439: Improve hint labels on patron attribute type entry form
    
    This patch makes some minor changes to the patron attribute type
    template in order make corrections and improve consistency:
    
    - Change some generic <span>s to <div class="hint">
    - Correct terminology: Branch -> Library
    - Improve hint text:
      Before: "Select All if this attribute type must to be displayed all
      the time."
      After: "Select "All libraries" if this attribute type should always
      be displayed"
    - Link reference to authorized values "PA_CLASS" directly to that page
      for users with permission.
    
    To test, apply the patch and go to Administration -> Patron attribute
    types -> New patron attribute type.
    
     - Confirm that the hints on these fields are properly styled:
       Authorized value category, Library limitation, Category, and Class.
     - Confirm that the text uses the term "library" instead of "branch."
     - Confirm that the hint on the "Class" field links directly to
       authorized values if you are logged in with a user with permission.
    
    Signed-off-by: Victoria Faafia <vfaafia29@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 726cfda78b24df8a87cf060455430c91cb41a930
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 14 16:56:00 2021 +0000

    Bug 27437: Improve hint labels on library creation form
    
    This patch makes a few minor template changes to the form for creating
    and editing libraries:
    
    - <br /><span class="hint"> changed to <div class="hint">
    - References to system preferences are linked directly to that
      preference if the user has permission.
    - The MARC organization code label has been corrected so that it works
      now.
    
    To test, apply the patch and go to Administration -> Libraries -> New
    library.
    
    - Confirm that the hints for Ill staff email, Reply-to, Return-path, and
      MARC organization code look correct, including aligning with the input
      field above them.
    - Confirm that clicking the "MARC organization code" label moves focus
      to the correct field.
    - View the page as a user who both does and does not have permission to
      access system preferences, confirming that system preferences are
      linked correctly if the user has the correct permission.
    
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD Amended patch: Add missing space to correctly align input with label
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4349cc182e56c070b69bb89f81df75a0b6b78c85
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 13 12:44:08 2021 +0000

    Bug 26985: Remove code for "Upcoming events" from codebase as not implemented
    
    This patch removes references to an unimplemented feature for "Upcoming
    events" notices. As far as I can tell the templates are the only files
    affected.
    
    To test, apply the patch and verify that no instances of "Upcoming
    events" or "Upcoming_events" are found in the codebase.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67b1b20e33f5d73ea515ea3b4d244dde73576448
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 20 10:02:45 2021 +0100

    Bug 24272: Correctly encode output to prevent 'Wide character in say'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1915293441b7f61d0e61c6b7dd105de1bbd5d8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 20 10:02:10 2021 +0100

    Bug 24272: Use Pod2Usage and surround values with ''
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9ea5d1ba42d8d0bbf3f8ad01e22521f20efdd38
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 15 11:00:39 2021 +0000

    Bug 24272: (follow-up) Test defined not true
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de5527f37d898e756cac4d8ed9de63c6576c1241
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 19 03:20:36 2019 +0000

    Bug 24272: add check_sysprefs_cache.pl
    
    This script ensure that no sysprefs have been changed directly in the database and/or
    that the cache has not become corrupted. We have occasionally seen this happen on production sites
    
    To test:
    1 - In the staff interface go to Administration
    2 - Search for system preference 'IntranetUserJS'
    3 - Add content to the syspref:
        console.log('Hi!');
    4 - On the command line launch mysql
        sudo koha-mysql kohadev
    5 - Alter the syspref directly
        UPDATE systempreferences SET value = "console.log('Bye!');" WHERE variable = 'IntranetUserJS';
    6 - run the script
        perl misc/maintenance/check_syspref_cache.pl
    7 - You are warned about the altered system preference
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2110299db00969beecbff445c1233b4349ac53cb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Jan 6 03:04:42 2021 +0000

    Bug 27023: (QA follow-up) Fix span tags
    
    One of the opening tags was missing the > and another was in the
    wrong spot (started after the IF, but ending outside ouf it)
    
    Move spaces around a bit so the strings don't start with spaces.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33ede26f32feb64d8e0bb98510b1e5f9a110647f
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Nov 13 23:01:29 2020 +0000

    Bug 27023: Add class names in acq suggestion table (suggestions column)
    
    Test plan:
    1. Apply patch
    2. Add some suggestions via the OPAC, fill out all the input fields
    3. Go to the suggestion managemnet page and look specficially at the Suggestions column.
    4. There should be no display change in the table but you should now <span> with classes like 'suggestion_coprightdate', suggestion_isbn, suggestion_publishercode, suggestion_collectiontitle, and suggestion_itype
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00734f1689fc0fdd16f8497de841323923195d3b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 19 15:43:36 2021 +0000

    Bug 27324: (follow-up) Remove references to intranetbookbag from Auth.pm
    
    This patch removes references to intranetbookbag from Auth.pm. Now that
    the templates use Koha.Preference("intranetbookbag") everywhere it is
    unnecessary.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77f36d49a64e678f74438fd375349caca2aa6dc8
Author: Mazen Khallaf <mazen.i.khallaf@gamil.com>
Date:   Tue Jan 19 02:25:08 2021 +0000

    Bug 27324: Use Koha.Preference() for intranetbookbag everywhere
    
    Test Plan:
    1. Check the shelves and results page in the intranet
    2. Apply the page
    3. Check theres no change
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1cbdc3691a95ae297b275a9bd8978fa01806f92
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jan 20 09:37:45 2021 +0100

    Bug 17229: Fix unit test warning
    
    Remove warning :
    t/db_dependent/ILSDI_Services.t .. 3/10 Null value for biblionumber in Item not allowed at /home/koha/src/t/lib/TestBuilder.pm line 387
    
    $biblio_with_no_item is a Koha::Biblio object.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a7f7787376253e0c0cda905734006ceba472d60
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Thu Jun 21 11:15:23 2018 +0300

    Bug 20971: Prevent Storable::thaw to fail on LastCreatedItem
    
    Sometimes additem.pl will complain about "Storable::thaw failed to
    thaw LastCreatedItem-cookie.", see bug 14844. Now, actually fix the bug.
    
    The bug is caused by trying to URI (un)escape MARC::Record, binary data.
    We'll use a base64 url-safe version instead.
    
    Test plan:
    1: Set PrefillItem to 'The new item is prefilled...'
    2: Set a SubfieldsToUseWhenPrefill, 'c' for example
    3: Add a new item for biblio A with 'c' set.
    4: Double check 'c' value is set for next new item A.
    5: search and add a new item for biblio B
    6: 'c' is not set
    Apply patch
    7: logout, login
    8: repeat steps 3, 4, and 5 .
    9: now 'c' is set.
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@joensuu.fi>
    Signed-off-by: James O'Keeffe <jamespfk@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: fix commit title and add test plan
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 920d3efcdfe1efc79e81017f8340227063ae2973
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Tue Dec 29 10:41:38 2020 +0100

    Bug 17429: document the --plack/--noplack options of koha-list
    
    The man page of koha-list does not list the --plack and --noplack
    options.
    
    This patch fixes that.
    
    Test plan:
    
    1) View the current man page for `koha-list` (with `man koha-list`)
       and notice how the --plack and --noplack options are missing.
    
    2) Apply this patch.
    
    3) Run the following command to re-generate the man page:
    
       xsltproc /usr/share/xml/docbook/stylesheet/docbook-xsl/manpages/docbook.xsl \
       debian/docs/koha-list.xml
    
       View the manual page again (with `man -l koha-list.8`), the
       two options are now displayed under SYNOPSIS and OPTIONS.
    
    4) Make sure this test passes:
       prove -v xt/verify-debian-docbook.t
    
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb95c9140316d4b9dc28cd696d14106b460774aa
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Dec 22 19:28:28 2020 +0000

    Bug 27297: Add required and blank options to av-build-dropbox.inc
    
    This patch adds two options to av-build-drobx
    required - which will add the required attribute to the select
    blank - which will add a blank option to avoid preselecting others
    
    To test:
    1 - In OpacSuggestionMandatoryFeilds select itemtype
    2 - Go to OPAC
    3 - Add a suggestion
    4 - Don't fill out any fields
    5 - Submit
    6 - Suggestion is added
    7 - Delete it
    8 - Apply patch
    9 - Add a suggestion
    10 - Note itemtyp edefaults to 'None'
    11 - You cannot submit until you select a value
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a26d529a2bc7faee3743b4cd1e603ba29411a0b9
Author: Victor Grousset <victor@tuxayo.net>
Date:   Sat Dec 26 15:19:59 2020 +0100

    Bug 27180: (follow-up) Remove unused %is_holiday
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80e1b4e66f01a07cad9bf37625d879f649edf52a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 9 15:39:09 2020 +0000

    Bug 27180: Update fines on holidays
    
    This patch removes code that prevents fines from being update on holidays.
    The fines are already being calculated, and that takes the calendar into account if
    needed, so fines won't be assessed on holidays if they shouldn't.
    
    To test:
     1 - set finesCalendar to 'ignore'
     2 - Checkout an item due yesterday
     3 - Ensure circ rules have a fine amount set
     4 - Make today a holiday
     5 - run fines.pl
     6 - No fine assessed
     7 - Apply patch
     8 - run fines.pl
     9 - Fine assessed!
    10 - set finesCalendar to 'use'
    11 - checkout an item, due yesterday
    12 - run fines.pl
    13 - no fine assessed
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f595aab028d0d5835b8e7ed3ffaf534e83c0db0
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Thu Feb 27 14:45:17 2020 +0100

    Bug 17229: Move tests to t/db_dependant/ILSDI_Service.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD Amended commit message
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c3f267350b07c16b4c8297ee7c05853748a26f9
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Aug 31 15:27:44 2016 +0200

    Bug 17229: Check if patron is expired in CanItemBeReserved
    
    This way, calls to ILS-DI HoldTitle and HoldItem do this check too
    
    Added test plan to commit message :
    -Set Syspref  BlockExpiredPatronOpacActions to "ON",
    -Set a patron's category variable "Block expired patrons" to "Follow SysPref" or -"Block" (ideally test both).
    -Get the id of a patron from this category (ie : 1234).
    -Set this patron's expiration date to a date earlier than today.
    -Get a biblionumber which can be reserved (ie : 5678).
    
    Put the following string in your webbrowser (replacing OpacBaseUrl, 1234 and 5678 by your own values) :
    http://[OpacBaseUrl]/cgi-bin/koha/ilsdi.pl?service=HoldTitle&patron_id=1234&bib_id=5678&request_location='127.0.0.1'
    
    Should not create a new hold for the patron and report an error.
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a369a9c8c1867536ec537dfcae20a49349fffb34
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Aug 31 15:52:08 2016 +0200

    Bug 17229: Add unit test for BlockExpiredPatronOpacActions check
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85ae9bd021aef4e7423669a61df7c4c7fd5b726b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 15 11:27:47 2021 +0100

    Bug 27413: Restore debarred and debarredcomment to batch patron mod tools
    
    It was added by bug 13552 but removed by 19793.
    
    Test plan:
    Update patron in a batch and confirm that you can modify the restriction
    expiration and comment.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63c49e1f89c298d6b385729fbfd9d30c7674a33a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 15 11:16:26 2021 +0100

    Bug 27047: Fix suggestions filtering at the OPAC
    
    There is a "Search" input box that appears to be broken for... ever?
    
    This patch replaces it with the DataTables filtering.
    
    Test plan:
    Create some suggestions, go to your suggestion list at the OPAC
    Confirm that the filtering now works correctly
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f9c909d5a603c40125064e7e32f24e595d596e2
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Dec 23 09:57:38 2020 +1100

    Bug 27299: Remove tokenization for phrase register/index with ICU
    
    This patch removes tokenization for phrase register/index when
    using ICU.
    
    This should cause "exact" searches to work the same way with ICU
    as they do with CHR.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08396d4b2ffe7db4f7550631a751603f01387095
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jan 13 11:22:53 2021 +0000

    Bug 27420: Use object accessor for $attr_type->class()
    
    We introduced a bug in the patron attribute forms with bug 5161.
    
    Test plan
    1/ Create two PA_CLASS authorized values
    2/ Create two corresponding patron attribute types referencing the above
    classes.
    3/ Edit a patron, both attributes should appear within their own
    fieldsets at the bottom of the member entry form.
    4/ Set a value for the first of the two patron attributes and save
    5/ Edit the patron again, note that the first attribute no longer
    resides within it's own fieldset
    6/ Apply the patch
    7/ Edit the patron again, note that the first attribute now resides
    inside it's own fieldset again
    8/ Signoff
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f448b1a86ff9a27d547e4d93cf84b3752e0201c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Jan 12 21:53:49 2021 +0000

    Bug 25054: (QA follow-up) Add space after comma for multiple aliases
    
    Just a little formatting change to help readability by adding
    a space after comma: alias1, alias2, ...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd8aee927005f27fb10ed8944afbbd318e610dfb
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Nov 12 10:11:33 2020 +0100

    Bug 25054: Display search field aliases in Search Engine Configuration
    
    It'd be great if the Search Engine Configuration page would display
    the various aliases (shortcuts) available : ti for title, sn for local-number, etc.
    
    Patch changes Koha/SearchEngine/Elasticsearch/QueryBuilder.pm to move
    hard-coded vars at the beging and adds a method to provide to %index_field_convert via a method.
    
    Test plan :
    1) Use Elasticsearch
    2) Go to Administration > Search engine configuration (Elasticsearch)
    3) Check you see new column 'Aliases' with for example ti for title.
    4) Perform a search 'ti:<title>' and check you get results
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a1dea7612895d56ddd39095935b3d267e8ff97e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 7 14:27:09 2021 +0000

    Bug 11299: (follow-up) adjust tests for bug 26641, fix styling, fix population of new record
    
    This corrects parameters in tests to adjust for new parameter in LinkBibHeadings
    
    We also add lines to remove classes before adding the correct class while linking and restore
    a missing class to the icons
    
    Lastly we correct fetching the paramters to pass to authority creation popup to ensure
    values are populated on save
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01e965fb7e8dc042348cbf40e74299bc4c343ea4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 15:46:56 2021 +0100

    Bug 11299: Adjust call to check_cookie_auth
    
    Why were we using CGI::Cookie?
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf7a645cbe2dfb4b75771ecce34babfb8bc05a04
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 12 16:16:42 2020 +0000

    Bug 11299: (follow-up) Rebase on recent changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02d15034208dff324ec4e2e31080147500c6b7bc
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Oct 21 04:37:28 2020 +0200

    Bug 11299: Fix indirect object notation
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68713d36f74adbd4d6a885cfa63184bb255e4c6a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 22 13:11:40 2020 +0000

    Bug 11299: (follow-up) correct link
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebe6dddc8c23b736cc4888265fcf7b4ca56eb118
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 25 11:26:31 2020 +0000

    Bug 11299: (follow-up) Skip fields with no 9 subfields
    
    To test:
    1 - Disable the 'thesaurus' for a controlled field like 600a or 650a
    2 - Edit a record and put random data in this field
    3 - Try to link, get a JS error
    4 - Apply patch
    5 - Repeat
    6 - No more error, field is not linked (as it has no $9 subfield)
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d65cfd570e585d7a15d7aab6a020286b0413d46d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 25 10:56:51 2020 +0000

    Bug 11299: (follow-up) Correct rebase errors and add message class to dialog
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85950bdbc1d3afbbeddbda170c18021ad12d0f6f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 21 15:47:08 2020 +0000

    Bug 11299: (QA follow-up) Fix tests, spaces, and CSS update
    
    Removed my from variables in test
    
    Undid stray line deletions
    
    Undid adding 1; to test file
    
    Fix CSS replace command
    
    Update license
    
    Fix spelling
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 11de34063970d7a74dc0541000287957b7790225
Author: Bouzid Fergani <bouzid.fergani@inlibro.com>
Date:   Wed Nov 6 10:49:09 2013 -0500

    Bug 11299: Add a button to the biblio edition page to automatically add authority links in the current biblio record via AJAX. Also adds a button to easily create missing authority records.
    
     add authority type in the form to create the missing  authority.
     when authority was found, the 600$9 field have the authid.
    
    Testing scenario (Creating an authority record for a failed automatic link) :
    
     1 - In your system preferences set:
        AutoCreateAuthorities: Don't generate
        BiblioAddsAuthorities: Allow
     2 - Go to the Cataloging -> New record (koha/cataloguing/addbiblio.pl)
        Ensure you are using the basic editor
     3 - Click the "Link authorities automatically" button.
        A message should appear, telling the user "No authority link was changed."
     4 - Add random informations in field 600$a of the biblio record.
     5 - Click the "Link authorities automatically" button.
       the message box should now show  "600 - No matching authority found.".
       the 9 subfield is red
       Above the 9 subfield is a red X with a blue plus next to it
       Hover on the plus, see it is titled 'Create authority'
     6 - Click the 'Create authority' link
     7 - A new authroity form pops up, the info from the cataloging editor is prefilled
         Click the 100 field heading to expand and confirm info is transferred
     8 - Fill in necessary fields and save the new authority
     9 - The cataloging screen now has the 9 subfield populated and is green
    10 - Click "Link authorities automatically" again
         Dialog says "No authority link was changed"
    11 - In another tab go to System preferences and set AutoCreateAuthorities to 'Generate'
    12 - Add random information to the 650 field
    13 - Click 'Link authorities' button
    14 - Dialog says:650 - No matching authority found. A new authority was created automatically.
    15 - The subfield 9 is green and has the id of the new authority record
    16 - In another tab search authorities and find an existing subject heading
    17 - Add a new 650 with the info from the existing record
    18 - Click 'Link authorities'
    19 - The new field is correctly linked to existing authority
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=12299
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cd68dd05bdac2787fa0b67b7f90a5836c57745c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 14 10:44:46 2021 +0100

    Bug 15448: Remove items fetch
    
    We fetch them already too many times.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9790b5ca3a1b8a92d56a14207d6245c02dfe7fd6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 14 10:42:53 2021 +0100

    Bug 15448: Fix ISE
    
    The method Koha::Items->itemnumber is not covered by tests!
    
    Trace begun at /kohadevbox/koha/Koha/Objects.pm line 592
    Koha::Objects::AUTOLOAD('Koha::Items=HASH(0x55981fd94790)') called at /kohadevbox/koha/opac/opac-reserve.pl line 465
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8af3ecdd538f22bfbf4d99bda629283fe856f3de
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 21 16:30:31 2020 -0300

    Bug 15448: (follow-up) Adapt to changes on bug 24254
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9f66f5e6b5360a57885c26436c7eb3f2747bd28
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 4 08:33:43 2020 -0300

    Bug 15448: (follow-up) Fetch the patron category once
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 051f5519861cb2365ddd06d08a9047648af2318b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 4 08:21:36 2020 -0300

    Bug 15448: Filter out items hidden in OPAC on placing hold
    
    This patch leverages on bug 24254's
    Koha::Items->filter_by_visible_in_opac to filter out items that
    shouldn't be presented to the end user in the OPAC interface.
    
    To test:
    1. Circulation and Fine rules for item-level holds are set to allow.
    2. Setting the OpacHiddenItems preference to "ccode: [SUPPRESS]"
    3. An item with collection Code Suppress is set.
    4. Search for the title in the OPAC.
    => SUCCESS: The Suppress ccode item isn't shown.
    5. View the detail page for the title.
    => SUCCESS: The suppress ccode item isn't shown.
    6. Place a hold on the item:
      -- Click "Show more options"
      -- Select "A specific item"
    => FAIL: the ccode with the opachiddenitems rule has an item that appear in the list to place a hold
    7. Apply this patch and repeat 6
    => SUCCESS: The item doesn't show!
    8. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e26e9266d341dec77ae4c8ca17c08e9d78fc777b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 14 11:28:35 2021 +0000

    Bug 24254: (QA follow-up) Inlines opachiddenitems handling
    
    We decided to inline the opachiddenitems filter as we don't believe it
    will be used exclusively.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42c4089fad79461f5aaea3c3354e902d192af543
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 21 15:50:13 2020 -0300

    Bug 24254: Implement separate filters and add patron param
    
    This patch introduces two new methods for stacking filters on
    Koha::Items:
    
    - filter_out_lost
    _ filter_out_opachiddenitems
    
    This two filters are what actually happened inside the
    filter_by_visible_in_opac. Everything is covered by tests.
    
    In the process I added a Koha::Patron param to the method that is
    internally used to decide if the OPACHiddenItems syspref needs to be
    honoured or not. This *could* be better done with a fallback to
    C4::Context->userenv if no param is passed.
    
    I decided to leave that part for later, if we really find it would help
    (e.g. if bug 10589 gets some action and we really need something here to
     handle that).
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Items.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1eda4facde26883e76ee321e142650525438846
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Dec 19 10:21:18 2020 -0300

    Bug 24254: Read the OpacHiddenItems preference internally
    
    After discussing the 'rules' parameter usefulness we decided it was not
    the best idea, and the gains in terms of 'performance' would me
    meaningless (in-memory caching of sysprefs). This patch makes a really
    minor tweak to the tests so they mock the C4::Context->yaml_preference
    method, but keeping the same original rules to highlight no behaviour
    change takes place.
    
    Then the rules parameter is removed from the calls, and the tests should
    keep passing.
    
    A minor change to make $rules = undef is made to highlight the // {}
    behaviour when reading the syspref..
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Items.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a592ebb3bb115f05812f140e8528dc1297a9dbfa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Dec 19 10:05:16 2020 -0300

    Bug 24254: Compare itemlost with 0
    
    On C4::Search and C4::Circulation the uses of the items.itemlost field
    highlight the fact that the comparisson itemlost <= 0 was wrong, as it
    is evaluated as a Perl boolean.
    
    The column can only be an int and NOT NULL, so we need to check if it is
    0 to ponder if not hidden.
    
    This patch changes the tests to reflect this, and adjust the
    Koha::Items->filter_by_visible_in_opac implementation to adapt to this.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Items.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2250cf0293c690c6d1e79090aa3cec7b43cb2797
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 3 15:11:14 2020 -0300

    Bug 24254: Add Koha::Items->filter_by_visible_in_opac
    
    This patch adds a method based on the original idea from Nick, but on
    Koha::Items.
    
    The idea is to build a proper filter, based on the current rules for
    hiding things, directly on the DBIC query. The caller takes care of
    knowing if the filtering should apply (i.e. checking the patron category
    exceptions) and then it would do something like:
    
        my @items;
        if ( <patron_category_does_not_have_exception> ) {
            @items = $biblio->items->filter_by_visible_in_opac(
                {
                    rules => $rules
                }
            );
        }
        else {
            # still want to enforce 'hidelostitems'
            @items = $biblio->items->filter_by_visible_in_opac;
        }
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Items.t
    => SUCCESS: Tests pass!
    3. Look at the use cases on the tests, read the code
    => SUCCESS: It all makes sense
    4. Compare with Koha::Item->hidden_in_opac
    => SUCCESS: It all makes sense
    5. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab6711572a4b107684c9f1a7b3d7f98998714a61
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 3 15:11:00 2020 -0300

    Bug 24254: Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87a485d101dd2b7f3c5070124e13a80d3dcc396f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 14 14:03:32 2021 +0100

    Bug 25775: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bfd83d21bce38238d5b032a390821f338f398cb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 9 18:23:38 2020 +0000

    Bug 25775: Add DataTables controls to user's checkouts table in OPAC
    
    This patch updates the "your summary" page in the OPAC so that tables on
    the logged-in user's page have DataTables controls. The patch also
    tweaks the DataTable configuration of some other pages to make them all
    more consistent.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Log in to the OPAC as a user who has checkouts, overdues, and holds.
    - On the "your summary" page, confirm that the checkouts table has
      controls at the top: A search form and link-style buttons: Clear
      filter, Copy, CSV, Print, iCal, Renew selected, and Renew all.
    - Confirm that each work correctly.
    - At the bottom of the page, the style of the "Renew selected" and
      "Renew all" buttons should now be side by side.
    - Confirm that both buttons work correctly.
    - If necessary, enable the UseCourseReserves system preference.
    - Go to the OPAC course reserves page.
    - Confirm that there is a working "Search courses" field at the top of
      the table.
    - View the contents of a course reserve.
    - There should be a "Search course reserves" field at the top of the
      table.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7d6ac62a8ac5d14f4cbdc7fcb073bb09ed4c7cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 13 17:19:28 2021 +0100

    Bug 26962: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2a537c88b8b632eb3393a51012ca51c893e7ca5
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Jan 13 00:06:27 2021 +0000

    Bug 26962: (follow-up) Catch other #000066 occurrences
    
    Addtional test steps:
    -Check printing an invoice, inscept the page and make sure none of the colors are set to #000066
    -For the OPAC you must rebuild the CSS ((https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    -Look at some areas where you might print in the OPAC (try a list), inscept the page and make sure there is no colors set to #000066
    -You can also use Jonathan's method of 'git grep -l -c 000066' to make sure no occurrences are left.
    -I left macles.tt as is because I am not sure about that template
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0b82280f82f0846938bf101502c403a09cfc4e4
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Nov 6 22:48:06 2020 +0000

    Bug 26962: Make print.css pure black
    
    Test plan:
    1. Generate some different notice/slips like ISSUESLIP, HOLD_SLIP, any slip you like
    2. Inspect and see that body, p tags and see that the computed color is #333333 or #000066.
    3. Apply patch
    4. The computed style for color should not be #00000
    5. This prints much better, especially on thermal/receipt printers
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eccc6ee7159fd1e589ee6b3d3a8477c2f88a5b38
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 17 18:30:38 2020 +0000

    Bug 27263: Link to preferences mentioned in system preference descriptions
    
    This patch attempts to locate all references to system preference names
    in various system preference descriptions and link those preference
    names to a search for that preference. This will allow the user to
    easily jump between preferences which are related or depend on each
    other.
    
    To test, apply the patch go to Administration -> System preferences.
    
    - Open each preference category and confirm that the page loads without
      error.
    - Test any system preference links you find to confirm that they work
      correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 231d74702198f1513223a8cb2fd93c3e575c690a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 6 16:41:48 2021 +0000

    Bug 27325: Fix singular/plural forms on the OPAC dashboard
    
    This patch adds handling of plurals to the display of counts on the
    logged-in user's dashboard: checkouts, overdues, etc.
    
    To test, apply the patch and log in to the OPAC.
    
     - Go to the OPAC main page and check the user dashboard area.
     - Confirm that the correct numbers and plural forms are shown for
       checkouts, overdues, holds pending, holds waiting, and messages.
     - Test each of those categories with counts of 0, 1, and more than one
       to confirm that the plural forms are correct.
     - Test with various counts of each type of message: OPAC notes as
       defined when editing a patron record and notes added via the checkout
       page.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4491cdd803226c22c585f3a23f6aa77000841bed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 13 11:11:36 2021 +0100

    Bug 27416: Make "Modify tag" and "Add tag" translatable
    
    Those two strings are not translatable as they are passed from the
    controller.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a861e9c008ab9192521b61b10c555a0c86490b0b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 13 17:14:37 2021 +0100

    Bug 26950: Fix SIP/Message.t
    
    t/db_dependent/SIP/Message.t .. 2/9
        #   Failed test 'DBIx error on duplicate issue_id'
        #   at t/db_dependent/SIP/Message.t line 643.
        # found warning: DBIx::Class::Storage::DBI::_dbh_execute(): DBI Exception: DBD::mysql::st execute failed: Duplicate entry '1' for key 'PRIMARY' [for Statement "INSERT INTO `old_issues` ( `auto_renew`, `auto_renew_error`, `borrowernumber`, `branchcode`, `date_due`, `issue_id`, `issuedate`, `issuer_id`, `itemnumber`, `lastreneweddate`, `note`, `notedate`, `noteseen`, `onsite_checkout`, `renewals`, `returndate`, `timestamp`, `unseen_renewals`) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )" with ParamValues: 0=0, 1=undef, 2=57, 3='m_HHGh', 4=undef, 5=1, 6=undef, 7=undef, 8=973, 9=undef, 10=undef, 11=undef, 12=undef, 13=0, 14=0, 15='2021-01-14 16:12:47', 16='2021-01-13 16:12:48', 17=0] at /kohadevbox/koha/Koha/Object.pm line 169
        # found carped warning: The checkin for the following issue failed, Please go to the about page and check all messages on the 'System information' to see if there are configuration / data issues (Duplicate ID)$VAR1 = {
        # expected to find warning: (?^u:Duplicate entry)
        # expected to find warning: (?^u:data corrupted)
        # Looks like you failed 1 test of 35.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bc62d240cfa0e026876cbbbef79731ed3877949
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Nov 10 15:51:24 2020 +0100

    Bug 26991: Add action logs to search engine administration
    
    Search engine administration is very important,
    we should log who/when it is changed.
    I don't add a preference system to disable it,
    like there is no for preference system logs.
    
    Test plan :
    1) Use searchengine Elasticsearch
    2) Go to Administation > Search engine configuration (Elasticsearch)
    3) Click on 'Reset Mappings' and accept
    4) Edit some lines and save
    5) Go to 'Tools' > 'Log viewer'
    6) Select only 'Search engine' in Modules and submit
    7) Select only 'Edit mappings' in Actions
    8) Check you see a log
    9) Select only 'Reset mappings' in Actions
    10) Check you see a log
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 261fb8ac6173ba2a6c6837a9a79dd7aba92bc2a8
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Oct 7 14:53:37 2020 +0000

    Bug 26123: Add message notification to patron dashboard
    
    Test plan:
    1. Apply patch, restart_all
    2. Add some OPAC messages by clicking 'Add a message' on Home › Circulation › Checkouts › patron
    3. Log into the OPAC as that patron and you should see a notice about how many messages you have with a link to opac-user.pl
    4. Add multiple OPAC messages and make sure it all continues to work.
    5. Also add an OPAC note from memberentry.pl. Refresh the OPAC and you should see a 1 message added to the total
    6. Try an OPAC without any messages. If there are no messages or any other kind of notification the dashboard should NOT appear at all.
    7. Add a 'staff - internal' note. It should not count towards your total messages in the dashboard.
    8. Test it with some other notices that would appear on the dashboard, checkouts, holds, overdues.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c8d4abeed95113ff5da56d3438a68ed64c8fedf
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jan 10 23:41:46 2021 +0100

    Bug 27306: (QA follow-up) Add space between title and subtitle
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee6c4548ad27c3efd4c78956e70336baffb994b0
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Dec 23 20:47:32 2020 +0000

    Bug 27306: Add subtitle to return-claims-table
    
    To test:
    -turn on claim returned
    -find some items with a 245b or add a 245b to some items
    -check those items out and mark them as claimed returned
    -on the borrowers /cgi-bin/koha/circ/circulation.pl page look at the return-claims-table
    -no subtitle
    -apply patch and clear browser cache, restart_all
    -now you should see the subtitle
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 371a9d1c2aa083f27b7e659260251eea16c7b8d9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jan 11 11:21:59 2021 +0000

    Bug 25306: (QA follow-up) Remove framework from bulkmarcimport
    
    One last instance of ModBiblioMarc in bulkmarcimport still passed the
    frameworkcode.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a96c73eb769a4796623740ee11e6c9656e5bd430
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 28 18:36:49 2020 +0000

    Bug 25306: Remove framework paramter from ModBiblioMarc
    
    Tested with :
    
    For a framework (not the default) :
    
    Creation of a biblio record
    Edition of this biblio record
    Creation of an item of this record
    Creation of an item of this record
    
    ./misc/batchRepairMissingBiblionumbers.pl OK
    
    prove t/db_dependent/Biblio/ModBiblioMarc.t OK
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 489b08ab4c1da6933b6d23483aab75a6c2e923b5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 6 12:34:11 2020 +0000

    Bug 26950: Make Anonymous patron warnings 'errors' and refer to the system information tab on about.pl
    
    Currently checkins can fail for one of two known reasons:
    1 - Duplicate issue ids
    2 - Anonymous borrower configuration issues
    
    In the first case we refer to the 'data problems' or 'data corrupted' section of the about page. All errors are on the 'System information' tab and this is what we should mention
    
    In the second case we refer to the data problems section, but information is in another section on the tab. Additionally, during checkin we issue an 'Error' but on the about page we call it a 'Warning' we should upgrade to error and specify what is broken
    
    Additionally this patch fixes the warning that should display while issuing to a patron if anonymous is not set and patron has selected privacy
    
    To test:
     1 - Enable system preference OPACPrivacy
     2 - Set system preference AnonymousPatron to '0'
     3 - Log in a a patron on OPAC and set your privacy to never
     4 - Issue a book to that patron in the staff client
     5 - Note there is no warning
     6 - Return the book
     7 - Note the circulation page displays an error and the checkin fails and refers to 'data problems'
     8 - Apply patch
     9 - Issue another book to patron
    10 - Note warning on the circulation page
    11 - Try to check in a book again
    12 - Check the new message makes sense
    13 - Click the link to 'about.pl' check that errors are displayed
    14 - Check the logs
    15 - Confirm updated error message makes sense
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dbc74154754c4d5d03baa7c96b8511e0c2e0d036
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 3 12:06:46 2020 +0000

    Bug 26713: Add pagination to bottom of saved SQL reports table
    
    This patch adds a second pagination menu to the bottom of the report
    results table.
    
    To test, apply the patch and go to Reports.
    
    - Run a report which will return multiple pages of results (greater
      than 20).
    - The results should display with a pagination bar at the top and bottom
      of the table.
    - Confirm that both pagination menus work correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b0f86b53173d30da5dbb42710a7c9bf9edaa3bb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 24 13:35:28 2020 +0000

    Bug 27308: Skip blank lines when inserting new
    
    The intent of the macro insert new function is to add a new field at the correct numerical place in the record. If you have a blank line while editing, however, the new line will be inserted at the blank line, rather than checking the rest of the record.
    
    To test:
    1 - Create a macro like
        new 690=‡aLOCAL SUBJECT
    2 - Insert a blank line into your record somewhere before where the 690 should be inserted
    3 - Run the macro
    4 - Line is inserted before the blank line
    5 - Apply patch
    6 - Reload (ensure cache is cleared and JS files are reloaded)
    7 - Remove the previously created field, but leave the blank
    8 - Run the macro
    9 - Field is created at correct position
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 27308: (QA follow-up) Remove commented line
    
    I don't think we need to keep the original line as a comment.. this
    patch simply cleans it up.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cfce5f010c485ee5e046bcc99a9d33a70d9213a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 24 14:04:55 2020 +0000

    Bug 27307: Don't drop phrase directive when searching keyword index
    
    We convert 'keyword' to '' as an index since we want it to search all fields
    
    When we are searching 'as phrase', however, we should not drop the search type
    
    To test:
     1 - Enable IntranetCatalogPullDown
     2 - Set searchEngine to Elasticsearch
     3 - Perform a search for 'Keyword as phrase' for a phrase that does appear in a record
     4 - You get the result
     5 - Reverse the order of words in the phrase
     6 - You still get a result?
     7 - Apply patch
     8 - Restart all the things
     9 - Reversed search does not return record
    10 - Correct order and search, correct record returned
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e9344d2e3e959f9c474d43f59ff7688d1a784ee
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 24 14:04:17 2020 +0000

    Bug 27307: Unit test
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a52a9d787544aae384aee1a33c9d3bb35d98f8fa
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 23 18:37:48 2020 +0000

    Bug 26957: Don't remove words that are also operators from search terms
    
    FindDuplicate has a hardcoded regex to remove 'and', 'or', and 'not' from any search fields, however,
    is does this with no regard for these terms being embedded in the middle of a word or phrase.
    
    E.g.:
    'Coupland' becomes 'Coupl'
    'Frog and toad' becomes 'frog toad'
    etc.
    
    This patch simplay removes the substitutions as we already quote the terms as well
    
    To test:
    1 - Add records to your system like:
        The night circus by Erin Morgenstern
        Frog and toad all year
        Nothing ever happens
    2 - Attempt to add purchase suggestions like
        title: the night circus, author:Morgenstern, Erin
        title: For and toad all year
        title:nothing ever happens (case is important)
    3 - No warnings about existing biblios
    4 - Apply patches
    5 - Delete existing suggestions
    6 - Repeat step 2
    7 - Each attempt should warn you of existing biblio
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1f44a831e2c41da8074bca4fcf250335687135a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 23 18:37:39 2020 +0000

    Bug 26957: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77f3d48dee24ad51dfbed65922712064dedff1ff
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 2 12:05:47 2020 +0000

    Bug 26894: Handle subfield 0 and delete empty fields
    
    This patch corrects handling of subfield 0 when copying/moving. Before these
    patches copying from subfield 0 would copy the entire field.
    
    We also correct an error that if moving a single subfield, we can leave behind empty
    fields with no subfields. They should be deleted.
    
    To test:
    1 - Define a new MARC Modification template with actions:
            Delete field 100$0
            Add new field 100$0 with value Test
            Update existing or add new field 100$0 with value TestUpdated
            Move field 100$0 to 600$0
            Copy field 600$0 to 100$0
            Copy and replace field 245$0 to 700$0
    2 - Define a new record like:
        LDR 00334nam a22001217a 4500
        003 ff
        005 20201102111604.0
        008 201102b        xxu||||| |||| 00| 0 eng d
        040 _ _ ‡cvsd
        100 1 _ ‡012345‡aKnuth, Donal Ervin‡d1938
        245 _ _ ‡012345‡aThe aty of computer programming‡cDonald E. Knuth
        650 _ 0 ‡042‡aComputer programming‡9462
    3 - Modify this record using the template above
    4 - Note that entier 245 is copied to 700, same for 600 field
    5 - Apply patch
    6 - Now only subfields 0 are copied
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4253eb91a6a21d301178c1a7b58301cc34b013b9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 12 12:29:25 2021 +0100

    Bug 26947: Remove AUTO_INCREMENT
    
    Sending a cake there
    https://bugs.mysql.com/bug.php?id=20786
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c5845ef9ecd92584723cd60a221ecd4710a2516
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 4 15:39:32 2020 +0100

    Bug 26947: Update kohastructure.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af90c4018d8767422ad7c6462169c62922441413
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 25 15:43:52 2020 +0100

    Bug 26947: Correct path for chown and chmod
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6bf5dc96555a241b3b756468865db17d216c4bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 19 11:09:54 2020 +0100

    Bug 26947: Replace double quotes from comments
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a341902bee66e52175a08f7ae14d93888230e606
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 19 11:08:08 2020 +0100

    Bug 26947: Move -- comment to the COMMENT clause
    
    Sed command from bug 26947 comment 8
    sed -r --in-place 's/,\s*-- (.*)$/ COMMENT "\1",/g;' installer/data/mysql/kohastructure.sql
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit affa3164eb475ff09654c690c9df810be8dc670f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 18 17:08:11 2020 +0000

    Bug 26947: (follow-up) Set key checks to disabled for kohastructure
    
    This patch adds sql calls to disable foreign key checks for the initial
    kohastructure schema load and then re-enables them again for subsequent
    actions.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d406d9016460ec8819d68d5d861627c5b3b5accb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 13 13:48:48 2020 +0000

    Bug 26947: Add schema-only option to koha-dump
    
    This patch adds a new --schema-only optoin to the koha-dump script.
    
    This can be used to generate a new kohastructure.sql file during the release, and later to
    compare the DB structure of a koha instance to the kohastructure.sql file shipped with a version
    to identify any missing constraints or other db structure issues
    
    To test:
    1 - debian/scripts/koha-dump kohadev
    2 - Confirm db and configs are dumped correctly
    3 - Apply patch
    4 - debian/scripts/koha-dump --help
    5 - Confirm new option is listed and makes sense
    6 - debian/scripts/koha-dump --schema-only kohadev
    7 - Confirm only schema is dumped and is not zipped
    8 - debian/scripts/koha-dump kohadev
    9 - Confirm entire db is dumped as before
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b193b9a4fd22df7607029f077e9c42d8842f1cc
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Thu Dec 17 12:19:59 2020 -0500

    Bug 27264: Reword sentence of OPACHoldsHistory
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 518e42d17c43a34f198ca4779546d72596160726
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 7 11:13:48 2021 +0100

    Bug 27356: Don't hide the SMTP servers table when last displayed is deleted
    
    Found on bug 27251 which was mimicking SMTP server code for QOTD.
    
    To recreate:
    Create a SMTP server with name "a"
    Create a SMTP server with name "aa"
    
    Filter by "aa"
    => Only 1 row displayed
    
    Delete it, confirm
    => The table disappears
    
    Note that we could re-add this test when bug 27353 will be pushed, as
    recordsTotal will contain the unfiltered number of records in the DB.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 356973126195f72a5eca54b62045ed86f79952c1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 7 15:23:17 2021 +0100

    Bug 26701: Remove unused C4/SIP scripts
    
    Those scripts are not known to be used, we can remove them from the Koha
    codebase.
    
    Test plan:
    Confirm that the scripts removed by this patch are not used anywhere
    from Koha.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d61203fab02038a615be979315e509b8fbdeafd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 3 17:04:19 2020 +0000

    Bug 27149: Don't strip itemnumber when adding item status via Z3950Responder
    
    This breaks MARCEdit integration as svc/bib uses the itemnumber field to update items
    
    To test:
    1 - sudo koha-z3950-responder --stop kohadev
    2 - Run it manually:
        perl /kohadevbox/koha/misc/z3950_responder.pl -c /etc/koha/sites/kohadev/z3950 -u kohadev-koha -p /var/run/koha/kohadev/z3950-responder.pid -D -d kohadev-koha-z3950 -l /var/log/koha/kohadev/z3950.log
    3 - Connect and search to verify itemnumber is in item records
        yaz-client localhost:2100
        base biblios
        find shuffle
        show 1+1
    4 - sudo koha-z3950-responder --stop kohadev
    5 - Run it manually to add item status
        perl /kohadevbox/koha/misc/z3950_responder.pl --add-item-status k -c /etc/koha/sites/kohadev/z3950 -u kohadev-koha -p /var/run/koha/kohadev/z3950-responder.pid -D -d kohadev-koha-z3950 -l /var/log/koha/kohadev/z3950.log
    6 - Connect and search, no itemnumber in records
    7 - Apply patch
    8 - Stop, restart all the things, and manually start server with item status again
    9 - Connect and search, itemnumbers are included
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ae737603f3043c590e33e517d7d95ca8a8283ce
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 3 17:03:40 2020 +0000

    Bug 27149: Unit tests
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b66458901268e6cb19585e8de3ea6adb458522fc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 2 08:55:38 2020 +0100

    Bug 27130: Don't display itemnumber under "File type" section
    
    There is no need to have the "File type" section when we attach a cover
    item to an item (we cannot upload a zip file)
    
    This patch removes the fieldset abd adds the itemnumebr to the breadcrumbs and headings.
    It also adjusts the help text, removing ZIP as an option when uploading for a biblio or item
    
    Lastly it adjusts the results page to use a heading to make things a bit clearer
    
    Test plan:
     1 - Enable 'LocalCoverImages' system preference
     2 - Browse to the details page for a record
     3 - Under the 'Images' tab click 'Upload'
     4 - Note the display includes File type section with a biblionuber input
     5 - Upload an image and note the results page
     6 - Return to the biblio, this time on the 'Holdings' tab
     7 - Click the down arrow next to 'Edit' and choose 'Upload image'
     8 - Note the form has a File type section with an itemnumber input
     9 - Apply patch
    10 - Repeat steps 2-9, making sure changes to page make sense
    11 - Note the breadcrumbs have been updated
    12 - Confirm you can complete the upload of the cover for an item and that results look as expected
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9769160083d614601997945f29a0fe9d353bf7ec
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 28 19:00:28 2020 +0000

    Bug 26851: Don't generate a notice to library if no content
    
    To test:
     1 - Check out an over due to a patron
     2 - Set overdue triggers to a trigger less than number of days overdue
     3 - Make sure the patron has no email
     4 - Set content of ODUE notice to:
        [%# Comment will not print %]
     5 - perl misc/cronjobs/overdue_notices.pl
     6 - Check the message queue
     7 - There is a notice sent to the library:
        "These messages were not sent directly to the patrons."
        With no messages
     8 - Apply patch
     9 - Repeat
    10 - No new message generated
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c055685ac4f59b2a83730c67792c6fb3c81d2123
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 19 15:46:52 2020 +0000

    Bug 26593: Remove _get_discount_from_rule
    
    This patch remove the private sub used in GetIssuingCharges in favor
    of get_effective_rule
    
    It corrects the wrong precedence for rules and adds tests to cover this
    subroutine
    
    NOTE: the 'branch' for the discount will be determined by the signed in branch,
        this is a bug to be fixed in the future
    
    To test:
    1 - Define a rentalcharge for an itemtype
    2 - Define a 10% discount for library A, category A, all itemtypes
    3 - Define a 50% discount for all libraries, category A, same itemtype
    4 - Attempt to checkout an item from library A of the matching itemtype
    5 - The 50% discount is applied
    6 - Apply patches
    7 - Attempt to checkout an item from library A of the matching itemtype
    8 - The 10% discount is applied
    
    prove -v t/db_dependent/Circulation.t
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3af9563a4f52e050461942e4f25c7e9e4918f3d0
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Oct 28 16:29:16 2020 +0100

    Bug 26848: Fix Readonly dependency in cpanfile
    
    - It is a required module. If it is missing, Koha will not start
    - Set the minimum version to 2.00. While not strictly required, it's the
    version that states that "Deprecation of Readonly::XS as a requirement
    for fast, readonly scalars is complete", it is available in Debian
    oldoldstable (jessie, 8), and Readonly::XS was not even needed with Perl
    > 5.8, which allows us to:
    - Remove dependency on Readonly::XS
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d828feafbd5f3b788d76a1a79bc4c0522bdb600e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 4 10:01:20 2020 +0200

    Bug 21301: add unit tests
    
    Run t/db_dependent/ILSDI_Services.t with and without previous patches
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83f5fef84edb0306f401f736008423a5871bdbc5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 26 15:02:14 2020 +0300

    Bug 21301: (follow-up) Remove borrowernumber in issues for GetRecords ILS-DI service
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97d94bad13bc2d14a954cb67aca6c6605f9d4906
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 8 07:07:32 2019 +0000

    Bug 21301: (QA follow-up) Fix number of tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37c042b9f3d3c307dac8e9205c65227e3c956ee3
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Oct 3 15:43:56 2019 +0200

    Bug 21301: Remove patron informations in reserves for GetRecords ILS-DI service
    
    Actually, the GetRecords service gives many information :
    borrowernumber (reserves field)
    
    The issue data should not be sent by these service, its a privacy problem.
    
    Test plan :
    1) Enable ILS-DI webservice
    2) Place hold on an item
    3) Go to {opac}/cgi-bin/koha/ilsdi.pl?service=GetRecords&id={biblionumber}
    4) Check the reserves tag content
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ae0ef6eb529cb866914ee8cffba469a9486a53c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Oct 2 16:28:21 2019 +0200

    Bug 21301: Remove patron informations in issues for GetRecords ILS-DI service
    
    Actually, the GetRecords service gives many information :
    bibliographic data (marcxml field)
    item data (items field)
    issue data (issues field)
    
    The issue data should not be sent by these service, its a privacy problem.
    Biblio title and author are redundant.
    This patch changes to use Koha::Checkouts to get issues informations with only the addition of item barcode.
    
    Test plan :
    1) Enable ILS-DI webservice
    2) Checkout an item
    3) Go to {opac}/cgi-bin/koha/ilsdi.pl?service=GetRecords&id={biblionumber}
    4) Check the issues tag content
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99cebb82dc6fd1aa3f7466f03a267cac9deedc6c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 15:22:35 2020 +0100

    Bug 24470: Mark a batch as 'imported' if all the bib has been imported
    
    When a staged MARC file is used to populate a basket in acquisitions,
    the status of the batch is kept as "staged" until a user repeat the operation.
    The "imported" status is added to the batch when new orders are added to
    a basket "from a new file" (yes!...)
    
    Test plan:
    - Create a basket
    - Add to basket From a New File
    - Select a marc file and stage
    - Add titles to your basket
    Until all your records are imported the batch will have the status
    "staged"
    When all your records will be imported, the status of the batch will be
    "imported"
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6be845a785db29a946742edb7c52a0057d6b5f8b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 10:20:11 2021 +0100

    Bug 27336: Fix xt/find-missing-filters.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0db3787a20e928c2ee8e5b0ce2d636c5bf8763cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 10:17:25 2021 +0100

    Bug 27336: Add POD for new package
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d89f6027be001d537b0eb73ea3fb4641d5fcd292
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Jan 8 10:58:45 2021 +0100

    Bug 27336: Sanitize correctly HTML id
    
    Valid characters are alphanumeric characters (a-zA-Z0-9), hyphen (-)
    and underscore (_)
    
    https://www.w3.org/TR/CSS21/syndata.html#value-def-identifier
    
    All invalid characters will be replaced by '_'
    
    Test plan:
    1. Go to Administration » System preferences and click on 'Searching'
       tab
    2. You should see a console error (Uncaught Error: Syntax error,
       unrecognized expression: #collapse_Did_you_mean/spell_checking)
    3. Apply patch
    4. Make sure the error is gone
    5. prove t/Koha_Template_Plugin_HtmlId.t
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ab65aa6c36754db9c6b9e90efde6b05fec147a7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 1 15:41:56 2020 +0100

    Bug 27109: Improve labels on the background job views
    
    Replace "enqueued_on" with "Enqueued on", same for started_on and
    ended_on
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30cb954cc698853423d7afa4ead6716c73ad5c6d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 1 15:43:38 2020 +0100

    Bug 27109: Remove Replay action - not implemented
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13fb0906be41e6f2f5effb89321bcac8371c8b45
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 11:25:13 2020 +0100

    Bug 26797: Escape firstname to prevent relative's checkouts to crash
    
    If no firstname is defined for a relative, the "Relative's checkouts"
    tab will be "processing" forever.
    JS error:
      TypeError: oObj.borrower.firstname is null
    
    Test plan:
    1 - Create a patron (PatronA) in a category with type 'Org'
        'School' in sample data works
    2 - Add a guarantee (Patron B)
    3 - Check out an item to PatronA
    4 - Go to PatronB's record and click relativwe's checkouts
    5 - There is an error and the table doe snot load
    6 - Apply patch
    7 - Reload
    8 - Table loads correctly
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e466c4130406748fdd2d74d5fbee161e4f79cf92
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 27 16:25:32 2020 +0200

    Bug 25292: Flushing L1 on every Z3950 server search
    
    This patch flushes the L1 cache on each Z3950 server search.
    
    There is no need to flush it in init_handler (when the connection is
    made), the L1 cache is not accessed (this behaviour goes against what I
    expected).
    
    This means each search will fetch values from the
    L2 cache (ie memcached) and persist the L1 cache (in Perl
    memory cache) until the result are returned (or longer?).
    
    Test plan:
    % perl misc/z3950_responder.pl --config-dir=/kohadevbox/koha/etc/z3950
    % zoomsh
    ZOOM>connect localhost:2100
    ZOOM>set databaseName biblios
    ZOOM>search x
    ZOOM>search x
    
    Between the 2 searches you can modify the value of SearchEngine, you
    will notice that the number of hits is different
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f03a9e974a930416e237b846fe78b8e0e5b3404
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 11 09:10:06 2021 +0000

    Bug 27349: DBRev 20.12.00.003
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37b5a14f4ca07a6b25960764a4214b00f9831542
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 8 14:37:30 2021 +0000

    Bug 27349: (QA follow-up) Move DB update to perl file and add description
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 557d2137d6dcfa1ce6f816c1d55c254418fe581c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jan 6 11:47:59 2021 +0100

    Bug 27349: Fix Mana system preference wrong type
    
    Mana system preference type 'YesNo' is wrong since it has 3 values.
    Change to 'Choice'
    
    Test plan :
    1) Run atomic update
    2) Check in database 'Mana' system preference type is 'Choice'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7be57c66085071fea763a572ac2a6ceb82641297
Author: Christophe Croullebois <christophe.croullebois@biblibre.com>
Date:   Wed Nov 25 11:29:40 2020 +0100

    Bug 27090: Opac basket: fix the 'In transit from' and 'to'
    
    To see the 'In  transit from' and 'to' fields in an Opac basket we have :
    
    <span class="item-status intransit">In transit from [% Branches.GetName( item.transfertfrom ) | html %]
        to [% Branches.GetName( item.transfertto ) | html %] since [% item.transfertwhen | $KohaDates %]</span>
    
    But in koha-tmpl/opac-tmpl/bootstrap/en/includes/item-status.inc we have no :
    
    [% USE Branches %]
    
    This patch just corrects this lack
    
    Test plan:
    1° find an item in a transit status or create one with this status
    2° put it in an Opac basket
    3° note that in the location column of the Opac basket the 'In transit from' and 'to' fields are empty.
    4° apply the patch
    5° check again and validate that the 2 fields are now filled
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c9acd7f28f3204ffb13cf18894a47fcf3f17c85
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 5 11:35:05 2021 +0100

    Bug 27345: Add missing global permissions for superlibrarian
    
    When a superlibrarian is logged in, C4::Auth::get_template_and_user pass the CAN_user_$flag to the template, but some are missing:
    suggestions, lists, cash_management
    
    So far they are not used in the template but it will avoid a developer to spend time on it if we fix it now.
    
    Test plan:
    Compare with installer/data/mysql/mandatory/userflags.sql
    Note that we don't need selfcheck
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e15446af125d0986cc3d9f122e91b21a5e21c6f6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 10:26:25 2020 +0100

    Bug 26983: Fix [un]select all links in inventory
    
    The select/unselect all links took into account only the items displayed
    when the page was loaded (so 20).
    
    Test plan:
    1. Go to Tools-> Inventory-> Do a Search to produce more than 20 results
    2. Select 50, 100 or All entries to show
    3. click on Select All
    => All items must be selected, not only the first 20
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 555080c1ddb5178d9673b22fde385219d0fd22ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 8 14:21:22 2021 +0000

    Bug 27351: DBRev 20.12.00.002
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6426a540bfdc64c55abc824c901d0ed24dc8779
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 8 13:35:38 2021 +0000

    Bug 27351: (QA follow-up) Use skeleton.perl and add description
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbab6615637c60c757df79bdc695a606622ed96a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jan 6 15:32:37 2021 +0100

    Bug 27351: Fix UsageStatsCountry system preference wrong type
    
    UsageStatsCountry system preference type 'YesNo' is wrong since it has
    several values.
    Change to 'Choice'.
    Looks like this error whas only in updatedabase 3.17.00.030.
    
    Test plan :
    1) Run atomic update
    2) Check in database 'UsageStatsCountry' system preference type is
       'Choice'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1700c393b1de3c32b3b572efd0cf935255813e2b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Dec 7 17:03:40 2020 +0100

    Bug 27164: Fix item search CSV export
    
    In item search CSV export, data cells are exported with double quotes.
    There should also be double quotes in header cells.
    Also some spaces can be removed.
    Delimiter must be from system preference 'delimiter'.
    TT filter must be $raw not html, only double quotes must be espaped by
    duplication of it.
    
    This may help to open the CSV with any table/calc software.
    
    Test plan :
    1.0) Create a record with title : Laurel & "Hardy"
    1.2) Create an item on this record
    2.0) Without patch
    2.1) Perform an item search on title 'Laurel'
    2.2) Export as a CSV file and save the file locally
    2.3) Open the file with a table/calc software
    3.0) Apply patch
    3.1) Perform same item search
    3.2) Export as a CSV file and save the file locally
    3.3) Open the file with a table/calc software
    4.0) Compare files with diff/meld
    => you see double quotes arround header cells
       and removal of space after coma
    4.1) Check that delimiter is from system preference 'delimiter'
    4.2) In table/calc software they should look the same
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f042c804cda09deaee614f73ec9a888bea4ab99a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Sep 9 13:54:34 2020 +0200

    Bug 26417: Remove warn in Koha::Patron is_valid_age
    
    In Koha::Patron is_valid_age the is a compare : $age < $low
    But $low may be undef.
    It generates a warn :
    Use of uninitialized value $low in numeric lt (<)
    
    Needs a test like for $high.
    
    Test plan :
    1) Run prove t/db_dependent/Koha/Patrons.t
    2) Edit a patron catetory, empty "Age required" and save
    3) Edit a patron of this category
    4) Check in logs you don't see "Use of uninitialized value $low in numeric lt (<)"
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31ec92bfab16654b2a3f763d141559d0f882a1e7
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Dec 23 04:41:58 2020 +0000

    Bug 27292: Add TablesSettings directive to fix columns_settings_borrowers_table
    
    This patch adds the USE TablesSettings directive which allows the plugin
    to be invoked to fill the columns_settings_borrowers_table variable.
    
    Test plan:
    0. Do not apply the patch
    1. Go to http://localhost:8081/cgi-bin/koha/reserve/request.pl?borrowernumber=51&biblionumber=29
    2. View source on the page and note columns_settings_borrowers_table has no value assigned
    2. Apply the patch
    3. In a new tab, go to http://localhost:8081/cgi-bin/koha/reserve/request.pl?borrowernumber=51&biblionumber=29
    4. Note that nothing has changed on the surfeace
    5. View source ont he page and note columns_settings_borrowers_table now has a value assigned
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a90c0b647fdfdb0a39b43f6b10adba3bca53215
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 18 14:41:12 2020 +0100

    Bug 27245: Replace AutoCommit=0 with txn_begin in bulkmarcimport.pl
    
    To prevent
    DBD::mysql::db begin_work failed: Already in a transaction at /usr/share/perl5/DBIx/Class/Storage/DBI.pm line 1588, <GEN45> line 1.
    
    Test plan:
    1 - Export more than 100 records
    2 - Use bulkmarcimport (with -commit=10) to import them
        perl misc/migration_tools/bulkmarcimport.pl -b -file testbmi.xml -v -m=MARCXML --commit=10
    3 - Modify a record to make the import fail (for instance having a too long
    lccn)
    4 - Use bulkmarcimport (with -commit=10) to import them
        perl misc/migration_tools/bulkmarcimport.pl -b -file testbmi.xml -v -m=MARCXML --commit=10
    5 - Notice that the import stops but that the imported record are imported (apart from the last batch of 10)
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2e2a3975fb66d8c2e2766ecbe014fb71952e6d0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 3 12:15:57 2020 +0000

    Bug 26367: Prevent warn about undefined values when record level hold has an itemtype
    
    To test:
     1 - set AllowHoldItemTypeSelection to 'Allow'
     2 - Find a patron from Library A
     3 - Find a record with an item from Library A
     4 - Place a title level hold with itemtype specified for a delivery at Library A for patron and record above
     5 - perl misc/cronjobs/holds/build_holds_queue.pl
     6 - There are warns:
     Use of uninitialized value in hash element at /kohadevbox/koha/C4/HoldsQueue.pm line 523.
     Use of uninitialized value in string eq at /kohadevbox/koha/C4/HoldsQueue.pm line 523
     7 - Apply this patch
     8 - perl misc/cronjobs/holds/build_holds_queue.pl
     9 - No more warns!
    10 - prove -v t/db_dependent/HoldsQueue.t
    11 - All tests pass!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd83fbe58d6f3ee2cd15880acaaccd495007c83f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 3 12:06:51 2020 +0000

    Bug 26367: Unit test
    
    This warn only appears when:
      The borrower and item branches match
      AND
      The hold fulfillment policy is any or the pickupbranch matches the items branch specified by hold_fulfillment_policy
      AND
      The request has an itemtype set
    
    To trigger we simply add some itemtype to existing hold requests in the test
    
    To test:
    1 - prove -v t/db_dependent/HoldsQueue.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9063ba246bd020de83bc67964a08855a73ccb24
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 9 14:34:26 2020 +0000

    Bug 26364: Adjust unit tests
    
    We shouldn't rely on knowing exactly which ISBNs we get, we should specifically
    check for what we do or don't expect.
    
    I believe we should return biblios that have the same isbn we passed, as it signlas we have another
    biblio in the catalog that matches the one we are on.
    
    To test:
    prove -v t/db_dependent/XISBN.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit feb7f5f6dd89f58f3b027898705fb0fa57a051ab
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 9 13:44:45 2020 +0000

    Bug 26364: Don't discard the passed isbn
    
    I don't know, if we get rid fo this check we can now check the db for the same isbn we passed
    
    This may be useful as we may want to see the biblio with the same isbn as long as number is different?
    
    This will make tests fail
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b22c3846caa2004b411c6bd19a5d41bc602e704
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 9 13:40:37 2020 +0000

    Bug 26364: Remove useless condition
    
    $response_data is a hash with one key, content
    
    Why are we checkiing it against a string?
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 854d404a9c161845731d39980165f8d641713a80
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 9 13:33:17 2020 +0000

    Bug 26364: Remove false matches on isbn
    
    The test here was returning 0590353403 when searched for 9780590353403
    because of the regex matching
    
    Koha doesn't work this way unless SearchWithISBNVariations is set to 'search'
    and you use a dropdown to select ISBN for searching
    
    To test:
    1 - Search catalog for nb=9780590353403
    2 - Confirm you don't have results, or delete the records with results
    3 - Add isbn 0590353403 to a record
    4 - Repeat search, fails
    5 - Enable SearchWithISBNVariations
    6 - Repeat search, fails
    7 - Go to advanced search, select ISBN, search for 9780590353403
    8 - Get results
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 86617ba7cd54cbeb7f2241468cd3e10f20d2bc27
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 9 13:24:20 2020 +0000

    Bug 26364: Don't skip records that match the isbn we passed
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f255be3e510942ee1d0211792a4d650aaf938808
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 7 14:36:20 2021 +0000

    Bug 27252: DBRev 20.12.00.001
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 181267bd2bf66a5efd065b48149eed4ff1044599
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 16 18:50:55 2020 +0000

    Bug 27252: Add deprecation warning, cross_fields pref, and add version to ES info
    
    This patch prepares Koha to officially no longer support Elasticsearch 5.X
    
    It adds a new system preference 'ElasticsearchCrossFields' to allow users to choose whether or not
    to enable this feature
    
    It updates the about page to add a deprecation warning if a site is running ES5
    
    To test:
     1 - Be running Koha with Elasticsearch 5.X
     2 - Attempt to search
       Error: Unable to perform your search. Please try again.
     3 - Apply patch
     4 - Update database
     5 - Searching works
     6 - Find syspref 'ElasticsearchCrossFields'
     7 - Enable it
     8 - Searching is now broken
     9 - Check the about page
     10 - you can now see the Elasticsearch version
     11 - The systeminformation tab has a deprectaion warning
     12 - Set SearchEngine preference to 'Zebra'
     13 - View the about page - no warnings
     14 - Test again with ES6 - searching should "work" with either pref setting
     15 - There should be no warning on about pages
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de739259298b323bb881b62b1bc96bc9e3589496
Author: Victor Grousset <victor@tuxayo.net>
Date:   Tue Jan 5 13:56:32 2021 +0100

    Bug 26847: (follow-up) fix get_attribute() call
    
    Since the upgrade to Selenium 3 in bug 27055, an additional parameter is
    required for get_attribute() to actually work.
    https://metacpan.org/pod/Selenium::Remote::WebElement#get_attribute
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f112b782b706d906fb39dd0d7a708f7d12da45f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jan 4 08:12:25 2021 -0500

    Bug 27276: Fix syntax error
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f228c9ee9fc7094054b687b26ae4306254922019
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 18 14:28:13 2020 +0100

    Bug 27276: Prevent borrowers-force-messaging-defaults.pl to crash
    
    MySQL 5.7 does not allow queries using 0000-00-00
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca50623a6082c0aec51d817bd8fddfdb022c8d1b
Author: Victor Grousset <victor@tuxayo.net>
Date:   Mon Dec 28 15:48:25 2020 +0100

    Bug 17809: FR installer: fix duplicate authorised value qualif 370
    
    Monteur vs Réalisateur
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 016c51f3a444e50029a7053c28c6f0821d204605
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 22 16:03:57 2016 +0100

    Bug 17809: Fix ER country appearing twice in fr-FR database files
    
    In installer/data/mysql/fr-FR/1-Obligatoire/authorised_values.sql, ER is defined twice, for "Erythrée" (correct one) and "Allemagne".
    
    Test plan :
    - Create a new database using fr-FR or import the sql file
    - Look at authorised values COUNTRY
    => without patch you have ER / Allemange
    => with patch you have ER / ErythrÃe
    
    NOTE: Allemange occurs twice as well, correctly with DE.
          This patch correctly removes the ER one.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b2dbfab9412d8c4e163c3f83241fa621b3a8123
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Tue Jan 3 13:02:40 2017 -0500

    Bug 17809: Correct authorised values for fr-FR
    
    This corrects:
    CC -- duplicate, but name not full.
    GQ -- duplicate, but only one name correct.
    PK -- Poland was mislabelled.
    
    This removes and edits duplicates and corrects PK to PL.
    
    Signed-off-by: Luke Honiss <luke.honiss@gmail.com>
    
    Signed-off-by: Brendan Gallagher <brendan@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80029ad4725b64bb6197ced5bd867721769b04a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 14:41:56 2021 +0100

    Bug 27331: (bug 27331 follow-up) Fix syntax error in authorised_values.sql for fr-FR
    
    ERROR 1064 (42000) at line 724: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '+
    +INSERT INTO authorised_values (category, authorised_value, lib) VALUES ('HOLD' at line 1
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea1691268cf8fa0d8bf2b95e85f5a2a74d147160
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 16:24:21 2021 +0100

    Bug 27016: Use $.fn.select2.defaults.set to set select2's width
    
    See commit ff7318c62ec7097c5b88f7278b71d0cc7feb1f39
        Bug 27124: JS error "select2Width is not defined"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b02655817526f4f695d3f62d6b48206a041f301
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 18 15:48:13 2020 +0000

    Bug 27016: (QA follow-up) Move allowClear out of ajax
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d3d7fd7a257bd34a3a1846c88223bf2923f4d90
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 17 12:08:39 2020 -0300

    Bug 27016: Make the pickup locations dropdowns use Select2
    
    On the shoulders of bug 27015, this patch makes the pickup locations
    dropdowns use Select2 to handle both fetching the pickup location
    on-deman through the API, and also searching for them.
    
    This provides a better user experience for really big lists.
    
    To test:
    1. Have some holds on a biblio
    => SUCCESS: Bug 26988 works, made it load the data when you click on the
    dropdowns.
    2. Apply this patch
    3. Reload the page
    => SUCCESS: Similar-ish behaviour
    => SUCCESS: Notice you can search for branch names and make the list
    shrink
    4. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a60c1b77f8d5175707afcafe543cda9d404b1883
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 13 19:09:52 2020 -0300

    Bug 27015: Make pickup locations searchable
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a282f5f490a92107976450c55d015d073d059268
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 17 10:45:00 2020 -0300

    Bug 27015: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41bca0e0ca42429cead48f647a9b3533de5d1670
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Dec 1 12:50:28 2020 +0000

    Bug 21886: (QA follow-up) Fix indentation, prevent warns, fix parameter, simplify SQL
    
    The SQL code was duplicated, I combine them here
    
    frombranch needs to take input
    
    switch owning to frombranch in second script
    
    initialize hash as empty list, not a reference
    
    add a newline after printed output if not mailing notices
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12d8b26bc2a617ded8959da3688860a17e77d4a3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 4 13:19:08 2020 +0000

    Bug 21886: (QA follow-up) Update parameters
    
    As discussed, this patch updates the --owning parameter to more clearly
    represent it's function.
    
    --owning boolean => --frombranch=item-homebranch|item-issuebranch
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04548e4c8050ec1d31f8e90adc05124c6ceea37f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 16 14:22:58 2020 +0100

    Bug 21886: (QA follow-up) Fix QA script errors
    
    This patch fixes a perlcritic issue and also replaces tabs with four
    spaces where appropriate.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d765eb5c994df4cc62ec243d1728f2e13e03ba4
Author: Stefan Berndtsson <stefan.berndtsson@ub.gu.se>
Date:   Tue Nov 20 11:35:45 2018 +0100

    Bug 21886: Add option to send notices from owning library instead of issuing library
    
    The provided patch adds the following functionality:
    
    * Add --owning to both advance_notice.pl and overdue_notice.pl
    * Add --library to advance_notice.pl like the way overdue_notice.pl already works
    
    When specifying "--owning" both scripts will use items.homebranch instead of
    issues.branchcode to determine sending library.
    
    For advance_notice.pl this affects non-digest DUE and PREDUE, but not digest notices.
    
    To test:
    
    1.  Have a patron who wants advance notices as email with 2 days in advance (not digest)
    2.  Have the first overdue date set 3 days past due date
    3.  Have issue for that patron where date_due is 2 days away where the item homebranch differs from the issuing branch
    4.  Have issue for that patron where date_due is 3 days old
    5.  Run advance_notices.pl without --owning
    6.  Run overdue_notices.pl without --owning
    7.  Confirm that two messages were created for that patron with the sender being the issuing branch
    8.  Delete messages or create two more issues according to (3) and (4)
    9.  Run advance_notices.pl with --owning
    10. Run overdue_notices.pl with --owning
    11. Confirm that the two messages created has the item homebranch as sender
    
    Extra feature for advance_notices.pl is that it adds "--library" the same way overdue_notices.pl has.
    Adding variants of that flag in steps (5) and (9) above can confirm this option as well.
    
    Sponsored-by: Gothenburg University Library
    Signed-off-by: Björn Nylén <bjorn.nylen@ub.lu.se>
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fe582f0669eed1ede5145ca50f8343ca9cd2a26
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 16:32:16 2021 +0100

    Bug 26707: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66a3ec9452d20bb53a3ddc39cd69e4702a10d1ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 16:06:34 2021 +0100

    Bug 26707: Prevent warning
    
    Argument "" isn't numeric in numeric gt (>) at /kohadevbox/koha/koha-tmpl/intranet-tmpl/prog/en/includes/cat-toolbar.inc line 158.
    
    See commit ab29b5efdc763269399c06aa62ac0a36a93152f8
        Bug 18762: Remove warnings from xt/author/valid-templates.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff2c52e09392a0be47b16fe92b537c9941b43f40
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 16 15:32:03 2020 +0000

    Bug 26707: Split cart and lists button on bibliographic detail pages
    
    This patch modifies the toolbar shown on bibliographic detail pages so
    that the "Add to cart" and "Add to lists" buttons are separate. The "Add
    to cart" will now reflect whether the title is in the cart. The "Add to
    lists" button will now be a menu of list choices like it is on the
    search results page.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Search for a title in the staff client and view the detail page for one
    of the results.
    
    Testing the cart button:
    
    - In the toolbar you should see an "Add to cart" button and an "Add to
      lists" menu button.
    - Clicking the "Add to cart" button should show the cart message
      associated with cart link in the header.
      - The label showing the number of items in the cart should be
        incremented.
      - The button  should change to a "Remove from cart" button.
    - Clicking the "Remove from cart" button should correctly remove the
      item from the cart:
      - The label showing the number of items in the cart should be
        decremented.
      - The button should change to "Add to cart."
    - Add a title to the cart and click the cart link in the header to open
      the cart pop-up window.
      - Click the "Empty and close" button in the cart window.
      - After you confirm the cart window should close. The "Remove from
        cart" button should now be an "Add to cart" button.
    - Add a title to the cart and navigate between each of the other views
      of that title: Normal, MARC, Labeled MARC, and ISBD. On each page you
      should see a "Remove from cart" button.
    - Test the add and remove functions from each of the other bibliographic
      detail views.
    
    Testing the lists button:
    
    - On the normal bibliographic detail page you should see an "Add to
      list" menu button. Clicking it should reveal the same kind of lists
      menu you see on the catalog search results page, with recent public
      and private lists and options for "More lists" and "New list."
      - Test that each of these options works correctly to trigger the
        expected pop-up window.
      - Confrim that the correct title is added to the correct list.
    - Perform this test from each of the bibliographic detail pages: Normal,
      MARC, Labeled MARC, and ISBD.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7e228c60cfe352ccd7f1dee54990dcaa22c0240
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 4 14:53:57 2020 +0000

    Bug 26847: Add data-categorycode to opac pages
    
    This patch adds the data-categorycode attribute to the loggedinuser span
    for all pages in the opac.
    
    Test plan
    1/ Apply first patch, varify unit test fails.
    2/ Apply second patch, varify unit test now passes.
    3/ Navigate to opac and login
    4/ Varify that data-categorycode is present in the loggedinuser span in
    the client.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69bf6e80cf4c35601dbeea871c973c7ce3997e41
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 4 14:45:27 2020 +0000

    Bug 26847: Add UI test for categorycode in masthead
    
    This test adds a regression test for the addition of categorycode
    into the masthead of the staff client.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 137cf586551be4affb112eba3a61bc49b0099342
Author: Lisette Scheer <lisettes@latahlibrary.org>
Date:   Sat Oct 24 19:09:59 2020 +0000

    Bug 24863: QueryFuzzy syspref says it requires Zebra but ElasticSearch has some support.
    
    This patch updates the description of the QueryFuzzy system preference
    to make it more clear how it works with Zebra and how Elasticsearch has
    some amount of fuzzy available for searches.
    
    To test:
    1. Go to administration
    2. Search for QueryFuzzy
    3. Observe the current description, which only includes Zebra.
    4. Apply patch
    5. Repeat steps 1-2
    6. Observe the updated description.
    7. Sign off
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ead1493f5b3baedcc1eaf062991b8792aba7f231
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Thu Jan 30 10:35:31 2020 +0100

    Bug 24541: Purge old messages
    
    misc/cronjobs/cleanup_database.pl provides some database cleanup.
    
    This patch adds cleanup for messages table.
    
    Test plan :
    - Count messages : select count(*),date(message_date) from  messages group by date(message_date);
    - Run cleanup : misc/cronjobs/cleanup_database.pl -v --confirm --messages 365
    - Recount messages
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae1ae478fd5004ba8527822aef9ce5b45b061a33
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 16:31:27 2021 +0100

    Bug 25462: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 847ef673440733c3e76bf4c520838bf8fa3db3eb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 5 11:34:54 2020 +0000

    Bug 25462: (follow-up) Remove <br /> as it is no longer needed
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0da7cd5359bd1b2b96b2fd9204a07e5e10b45948
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue May 12 12:44:45 2020 +0000

    Bug 25462: Show shelving location on a new line after home library (OPAC)
    
    This patch updates the OPAC CSS to move the shelving location a
    new line after the 'Home library' in list of holdings on the
    bibliographic detail page.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Locate a title in the OPAC which has items with a shelving
      location.
    - View the detail page for that title. In the table of holdings,
      confirm that the shelving location information is on a separate line
      from the home library information.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 088e798ea33b43c7dfe9a3aa3e6cdd895d32dc9c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue May 12 12:43:21 2020 +0000

    Bug 25462: Show shelving location on a new line after home library (staff client)
    
    This patch updates the staff client CSS to move the shelving location a
    new line after the 'Home library' in list of holdings on the
    bibliographic detail page.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Locate a title in the staff client which has items with a shelving
      location.
    - View the detail page for that title. In the table of holdings,
      confirm that the shelving location information is on a separate line from
      the home library information.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 287d4aae129cb2958eae67073b9208b7db94bef4
Author: David Roberts <david@koha-ptfs.co.uk>
Date:   Tue May 12 09:56:28 2020 +0000

    Bug 25462: Shelving location should be on a new line in holdings table
    
    This patch moves the shelving location a new line after the Home library
    in the holdings table.
    
    To test:
    
    1) Assign a shelving location with a long description to an item.
    2) See that it displays on the same line as the Home Library in /cgi-bin/koha/catalogue/detail.pl
    3) Apply the patch
    4) Check that the shelving location is now on a new line
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7bc53d9431b32d6560f3cf987d2c4e30c6cf34c
Author: Victor Grousset <victor@tuxayo.net>
Date:   Mon Dec 28 18:28:58 2020 +0100

    Bug 26875: (follow-up) Fix error message ("greater or equal")
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e581255eccb1b6851735f9eb2c297dd0c01ffa06
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Oct 30 16:25:05 2020 +0000

    Bug 26875: Allow printing of just one barcode in batch
    
    To test:
    1- go to the Print Barcode Range page
    2- enter From=1 and To=1
    3- confirm error "Must be greater than from value."
    4- apply patch, restart, reload page
    5- enter From=1, To=1
    6- confirm no error
    7- change From to 2, error reappears
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b13982d6a52dc9660e0d35ccfc40193774a336a4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 15:09:19 2021 +0100

    Bug 25954: Prevent two elements with id="description" in the DOM
    
    It also fixes t/db_dependent/selenium/administration_tasks.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ad7d034e65d0b518335086345f2f533d1898c56
Author: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
Date:   Wed Nov 25 07:45:39 2020 +0000

    Bug 27085: Corrections in overdue_notices.pl help text
    
    -library      <branchname>     only deal with overdues from this library (repeatable : several libraries can be given)
    Should be <branchcode>
    
    Help text should also be proper sentences.
    
    To test:
    0) Run misc/cronjobs/overdue_notices.pl -h
    1) Check that the text is now:
       -library      <branchcode>     Only deal with overdues from this library.
    2) Check that the rest of the help text are proper sentences,
       with leading capital letter and punctuation.
    3) Sign off.
    
    Sponsored-by: Lunds Universitetsbibliotek
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d7b353b628077d99d7503a3afb343e315d00e1e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 4 13:59:38 2021 +0100

    Bug 25954: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b2bd038279911e8f29b376b2e70a2b9f9b6bb66
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Nov 17 17:34:12 2020 +0000

    Bug 25954: (QA follow-up) Correct label "for" attribute in authorities search
    
    Change it from first select box to text input for consistancy with other
    search forms
    
    Test plan:
    1) Apply the patch
    2) Go to authorities search
    3) Confirm the labels in all search tabs are linked to text input field
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1920c92d811dc5477a9cb1064f6f7e2dd473a380
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 6 19:09:43 2020 +0000

    Bug 25954: (follow-up) Correct label "for" attribute
    
    This patch updates a couple of search include forms to change the "for"
    attribute of the label. Although "idx" is the first field in this
    situation, the label's text applies to the keyword field so it should
    give focus to the keyword field.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38bc9eb2a8c01c8625b1c33c7e098cd0022b2710
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 8 13:40:37 2020 +0000

    Bug 25954: Replace paragraph tags with labels in header search forms
    
    This patch replaces instances of <p class="tip"> with <label
    class="tip"> in header search forms where there is not already a label
    tag corresponding to the first form field.
    
    In cases where there is already a label on the first form field the <p>
    is kept.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    
    Test the header search forms on the following pages:
    
     - Staff interface home page
     - Acquisitions home
     - Acquisitions -> Vendor -> Contracts
     - Acquisitions -> Vendor -> Add to basket -> From a suggestion
     - Advanced catalog search
     - Authorities
     - Administration
     - Administration -> Funds
     - Administration -> Desks (UseCirculationDesks must be enabled)
     - Administration -> Cities and towns
     - Administration -> Currencies and exchange rates
     - Administration -> Patron categories
     - Administration -> Z39.50/SRU servers
     - Catalog -> Search results
     - Cataloging
     - Circulation
     - Circulation -> Check in
     - Patrons
     - Serials
     - Tools -> Notices and Slips
    
    In each case, check that the search form labels work as expected to move
    focus to the corresponding form field.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71aaf8b458254921022b5e14440f158c8c7eb7bd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 10 11:35:50 2020 +0100

    Bug 27178: Add 'str' namespace to exclude-result-prefixes
    
    Some nodes in the generated HTML document contain the 'str' namespace.
    For instance, at the OPAC on the search result list, you can see:
    <a xmlns:str="http://exslt.org/strings" href="/cgi-bin/koha/opac-detail.pl?biblionumber=18566&amp;query_desc=kw%2Cwrdl%3A%20spin" class="title">
    
    The solution is to add 'str' to exclude-result-prefixes.
    From https://developer.mozilla.org/en-US/docs/Web/XSLT/Element/stylesheet
    """
    Specifies any namespace used in this document that should not be sent to the output document. The list is whitespace separated.
    """
    
    Test plan:
    0. Don't apply this patch
    1. Launch a search at the OPAC
    2. Inspect the title link for the records
    => Note the 'xmlns:str' attribute on tag "a"
    3. Apply this patch
    4. restart_all
    5. Repeat 1. and 2.
    => Note that the attribute is gone now.
    
    QA will check that no other occurrences is missing (note that one
    NORMARC xsl is missing it, but NORMARC is deprecated)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b42e08029e91fdb2d3cb9a8725314236d862269c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 16:27:41 2020 +0100

    Bug 27168: Sort most popular by number of issues desc
    
    It seems that there is a weird behavior when the title is used as a
    second sort
    
    Test plan:
    Turn on OpacTopissue
    Make sure the table always displays entries sorted by number of issues
    desc
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ef7cbededc424e93622b30832ebc7f609d7308d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 10:52:27 2020 +0100

    Bug 26953: Hide phone and itiva from "Overdue notice/status triggers"
    
    If the prefs are off we should not display the checkboxes
    
    Test plan:
    1. Turn off PhoneNotification and TalkingTechItivaPhoneNotification
    2. Go to the "Overdue notice/status triggers" and confirm that phone and
    itiva columns are not displayed
    3. Turn the prefs on and confirm the checkboxes are now displayed
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48b39167bb2f7fc06ece57d0fbcf94fe949b426a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 29 11:55:25 2020 +0100

    Bug 27310: Remove CSS float on 'Visibility' in framework edition
    
    In administration > framework edition > subfield edition, 'Visibility' label as a CSS rule float none.
    This seems obsolete, removing it will align label like others.
    
    Test plan :
    1) Go to Administration
    2) Edit any framework
    3) Edit any subfield
    4) Look at 'Visibility'
    => Without patch label is sticked to the left
    => With patch label postion is like others
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4186a5873bdeca5b57b153f07494d800ca93cb8b
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Dec 24 00:07:04 2020 +0000

    Bug 27031: Use Koha.Preference() more often in header.inc and js_includes.inc
    
    This patch uses the Koha.Preference() macro more often in key includes.
    (In the longer term, it will help reduce dependency in problematic C4::Auth code.)
    
    Test plan:
    0. Apply patch
    1. Go to http://localhost:8081/cgi-bin/koha/mainpage.pl
    2. Note "Cart" link in nav bar
    3. Click "Cart" and note "Your cart is currently empty" text
    4. Click "More" and note "Course Reserves" in dropdown menu
    5. Go to http://localhost:8081/cgi-bin/koha/catalogue/search.pl?q=test
    6. Click "Select all" above search results
    7. Click "Add to cart"
    8. Note "Cart" now has 3 displaying next to it
    9. Click "Cart"
    10. Note there are three titles in the cart
    11. Click "Empty and close" and click "OK" to confirm
    12. Note "Cart (0)" now appears in the top nav
    13. Go to http://localhost:8081/cgi-bin/koha/admin/preferences.pl?op=search&searchfield=IntranetNav
    14. Save the following content in the system preference: <li><a href="/index.html">New Home</a></li>
    15. Refresh the page
    16. Note "New Home" appears in the top nav between "Cart" and "More"
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba9c9cc794123d60c92a4ce499aa4554299936b6
Author: Björn Nylén <bjorn.nylen@ub.lu.se>
Date:   Wed Nov 11 08:35:21 2020 +0100

    Bug 26996: Convert Elasticsearch indexer commit buffer size to integer
    
    When multithreaded indexing is used, the commit size for children are spread
    out resulting in them being of type float. When records are processed and the
    commit counter decreased it may then never reach *exactly* 0. This means records
    are never commited. This patch makes sure the counter is an integer to avoid the
    problem.
    
    To test you must find a set of circumstances that causes the issue. For me:
    1. Run: ./rebuild_elasticsearch -v -b -p 2 -c 400
    2. Note that only one process is logging "Committing xxx records..."
    3. Kill processes.
    4. Apply patch.
    5. Repeat 1
    6. Note that both processes are logging "Committing xxx records..."
    
    Sponsored-by: Lund University Library
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0209415245fec941f44ed40ee47d8f163e5bb48
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 3 09:40:45 2020 +0100

    Bug 27135: Adjust "upload image" button when viewing item's cover images
    
    When viewing the cover image of an item, the "upload image" button is
    about to upload an image at biblio level.
    
    Test plan:
    - Attach a cover image to an item
    - View it
    - Notice the "Upload image" button, confirm that with this patch applied
    the wording changed and that clicking it will attach a cover image to
    the item
    - Attach a cover image to the biblio
    - View it
    - Notice the "Upload image" button, confirm that with this patch applied
    the wording changed and that clicking it will attach a cover image to
    the biblio
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dc90c66c7e3e53c6fab1792ebac65767e770c5e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Nov 17 14:49:58 2020 +0100

    Bug 27043: Add to number_of_replicas and number_of_shards to index config
    
    With Elasticsearch 6 (>6.4), we have a warning on index creation :
      the default number of shards will change from [5] to [1] in 7.0.0
    
    See https://github.com/elastic/elasticsearch/pull/30587
    
    I propose to add number_of_shards in index config.
    
    Also add number_of_replicas that is better explicit.
    In case on only one node, it must be 0.
    
    Test plan :
    1) Use Elasticsearch
    2) Apply patch and flush memcached
    3) Rebuild indexes : misc/search_tools/rebuild_elasticsearch.pl -v -b -d
    4) Check you dont have a warning about number of shards
    5) Check the settings of index :
       curl '<cluster>:9200/<myindex>_biblios/_settings?pretty&filter_path=**.number_of_*'
    6) You should see :
       "number_of_shards" : "5",
       "number_of_replicas" : "1"
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f7bbb64df376cd0998d6e882ad2f0a699187863
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 21 19:24:05 2020 +0000

    Bug 26171: (QA follow-up) Add table name and object type to message
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c961b238a2c726f7bf2dc70a672d31c43da84f29
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Aug 7 10:30:55 2020 +0200

    Bug 26171: adapt Koha/Exceptions.t
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b987412f699d16794520e1b3ec1b04b82fdd4e4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Aug 7 10:05:52 2020 +0200

    Bug 26171: Show biblionumber in Koha::Exceptions::Metadata::Invalid
    
    Bug 23846 added a check for invalid MARCXML in search_for_data_inconsistencies.pl.
    But the error message does not show the biblionumber of invalid biblio record.
    
    Test plan:
    1) Import a bibliographic record with invalid XML, you can add non printable characters, like 0x1F (CTRL-V 1F with vim)
    2) Run misc/maintenance/search_for_data_inconsistencies.pl
    3) Check you see correct biblionumber in error message :
    Invalid data, cannot decode object (id=xxx, biblionumber=yyy, format=marcxml, schema=zzz, decoding_error=...
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92dbe809021ea1f7ee44e51387b48d9ffbda1fea
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 21 11:05:26 2020 +0100

    Bug 27004: Prevent claim resolution to fail
    
    If the account of the patron who created a claim is removed, then the
    claim won't be resolvable.
    Trying to resolve the claim will result in a 500:
    [2020/12/21 10:05:55] [ERROR] PUT /api/v1/return_claims/1/resolve: unhandled exception (Koha::Exceptions::Checkouts::ReturnClaims::NoCreatedBy)<<[created_by is mandatory]>> Koha::REST::Plugin::Exceptions::__ANON
    
    We should not check if created_by exist when we update an existing hold,
    only when we create it.
    
    Test plan:
    - Login with patron A
    - set a value to syspref ClaimReturnedLostValue
    - Check an item out
    - Claim returned it
    - Login with patron B
    - Delete patron A
    - Resolve the claim
    - ERROR in api-error.log an UI never confirming the resolution
    - apply patch & restart services
    - Resolve the claim
    - it works
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4702149b2a9d3ec6216a7526a2c52b91de5d4cd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 29 14:35:27 2020 -0300

    Bug 27004: Regression tests
    
    This patch introduces regression tests for the change in
    Koha::Checkouts::ReturnClaim->store.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Checkouts/ReturnClaim.t
    => FAIL: Tests fail
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f2414686dbba56ee8140cad55051d7b900cb47d
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Dec 30 15:06:56 2020 +0100

    Bug 27317: (Bug 27127 follow-up) fix t/db_dependent/Koha/BackgroundJobs.t
    
    Bug 27127 changed  Koha::BackgroundJob->messages to return arrayref instead of array.
    This impacts Unit Test t/db_dependent/Koha/BackgroundJobs.t failling on :
      not ok 10 - 10 messages generated
    
    Test plan :
    prove t/db_dependent/Koha/BackgroundJobs.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Edit: I fixed the indentation of the test label.
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>

commit 3c3406257e78a9407320d22820807f767b4c4df3
Author: Victor Grousset <victor@tuxayo.net>
Date:   Thu Nov 19 13:47:45 2020 +0100

    Bug 27055: Fix compatibility with newer Firefox+Selenium version
    
    Fix "submit is not a function error"
    A submit button should not be named "submit", in this case, it's id.
    https://stackoverflow.com/questions/833032/submit-is-not-a-function-error-in-javascript
    
    Fix some uses of get_attribute()
    
    Fix a fail by setting a global implicit_wait_timeout, default value is 0
    in our lib. Other libs set it higher which helps to not have to manually
    deal with part of the timing issues.
    
    Fix: remove usage of click_when_visible() because it doesn't work with
    elements not in the top of the page. Because they are off screen.
    
    Fix: use $driver->quit() in error_handler to not forget an open Firefox.
    With the current version, it fills /dev/shm and fails with around 5
    Firefox opened.
    Also use quit() it at the end of every script.
    
    Fix: filling item fields, to fill only the displayed one (not those
    with display:none)
    
    == Test plan ==
    1. Update selenium/standalone-firefox to the latest version [1]
    2. prove t/db_dependent/selenium/authentication.t
    3. It fails with: arguments[0].form.submit is not a function
    4. Apply patch
    5. Retest
    6. Success
    
    [1] In koha-testing-docker you can do it with
    docker-compose.yml:
         selenium:
    -        image: selenium/standalone-firefox:2.53.1-americium
    +        image: selenium/standalone-firefox
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 084d64b84a536c1d88f2fa477865134f97388489
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 17 11:53:16 2020 -0300

    Bug 27250: Fix stacked event listeners in SMTP delete modal
    
    There is a design issue on the click event listener that makes the modal
    get added new event listeners on each row being deleted. This makes the
    page call all the event listeners and generates an error.
    
    This patch replaces the flawed logic (adding the event listener inside
    the event listener). It makes the event listener be defined at startup
    time, and make the .on('click') action just pass information around as
    required.
    
    To test:
    1. Create at least 2 SMTP servers
    2. Open the browser inspector, on the network tab
    3. Click "Delete" for server 1
    => SUCCESS: You get a successful message (OK)
    4. Click "Delete" for server 2
    => SUCCESS: You get a successful message (OK)
    => FAIL: You get also an alert message about server 1 (KO)
    => FAIL: The inspector shows more than one AJAX call has been made
    5. Apply this patch and reload the page
    6. Repeat 3-4
    => SUCCESS: Everything goes smooth this time
    7. Sign off :-D
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2498cdcc88be798b88d6a23bf6e592cff5a80f45
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Dec 14 12:30:03 2020 +0000

    Bug 27099: Stage for import button not showing up
    
    In the latest version of Chrome, pages where the Humansmg library is
    included have a problem where the language footer obscures the bottom of
    the page.
    
    The problem traces back to some CSS in the Humanmsg library's CSS file:
    
    html, body {
        height: 100%; /* Damn you IE! */
    }
    
    Removing the line doesn't have any ill effects that I can see in Chrome
    or Firefox, and it fixes the problem in Chrome. IE can be damned.
    
    To test you must have one or more translations enabled in the staff
    interface.
    
    - Apply the patch and clear your browser cache if necessary.
    - View pages in the staff interface which use the Humansmg library,
      e.g.:
      - Administration -> System preferences. Choose a category of
        preferences which will be numerous enough to require scrolling to
        reach the bottom of the page.
      - Tools -> Stage MARC records for import. Upload a file to display the
        form for staging the import.
      - Cataloging -> Advanced MARC editor
    
    On each page the language footer should not obscure the bottom of the
    page.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a067f145b85870328fbcd10b2e510cb7006b749
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 18 16:23:54 2020 +0100

    Bug 27280: (bug 27026 follow-up) Make consistent the explanation for "Days mode"
    
    We have "Skip closed days" in the dropdown, but "Calendar" on the table. Both must match
    
    Test plan:
    Go to the circ rules, select a value for "Days mode", save the rule,
    confirm that the dropdown list values are matching the ones we displayed
    in the cells
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eddf09da53b0ad21e2b2649266ca201623372d0c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 16 11:32:20 2020 +0100

    Bug 27247: Re-add highlighting to the quote editor
    
    Caused by
      commmit 247dca306407ac9568344a0a37aca3bbcffc2468
      Bug 23013: Upgrade DataTables in the staff client
    
    which removed
    
    -tr.even.selected td {
    -    background-color: #D3D3D3;
    -}
    
    There was no more highlighting when trying to delete an imported quote, as there was before
    (see screenshot from the manual https://gitlab.com/koha-community/koha-manual/-/blob/master/source/images/tools/qotd/selectfordelete.png)
    
    It was, however, possible to delete imported quotes, you just don't see which ones you are deleting.
    
    Test plan:
    1) Create a CSV with two columns first the name, then the quote (I've attached a CSV that I've done for testing purposes)
    2) Go to Tools > Edit quotes for the QOTD feature
    3) Click 'Import quotes'
    4) Click 'Browse' and choose the CSV created earlier
    5) Click on the id of a couple of quotes. Notice those lintes are highlighted
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7063f2c4763d7fec870a4c326837b8b64e64004f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 14 14:51:17 2020 +0100

    Bug 27230: Display OPAC description for OPAC_SUG
    
    The authorised values OPAC_SUG displayed at the OPAC show the staff
    description.
    
    Test plan:
    1. Create an auth value in opac_sug, with different text for the description and OPAC description.
    2. Go to the OPAC and open the purchase suggestion form.
    3. Note in the Reason for purchase drop down, the descriptions appear, the text entered in the OPAC description field.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a461382ba944a8e9f4a7c4e534dca74745f0f55
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 10:34:50 2020 +0100

    Bug 26956: Allow guarantor's controls to be set when a guarantee is created
    
    With AllowStaffToSetCheckoutsVisibilityForGuarantor and
    AllowStaffToSetFinesVisibilityForGuarantor set to Allow, one can only see the
    controls for these values in the patron record *after* the patron has been saved
    with a guarantor. That makes a frustrating 2-step process. We should be able to
    set those values regardless of whether or not there is currently a guarantor on
    the account.
    
    Test plan:
    Create a guarantee and confirm that the 2 options "Show checkouts to
    guarantors" and "Show fines to guarantors" are displayed
    Select Yes, save
    Confirm that the values have been correctly saved
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ffa71fbd1fa0e4b8c036f02b8a73eacbdfac066
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Jan 31 09:40:08 2019 +0000

    Bug 22243: Fix unescaped apostrophe in Z target
    
    This patch escapes apostrophes in the z39.50 target name prior to them
    being embedded in the template.
    
    To test:
    
    - Create a z39.50 target containing an apostrophe in the title
    - Note that the Advanced Cataloguer editor does not load
    - Apply the patch
    - TEST: Note that the Advanced Cataloguer editor does load
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28423fa756439607fbbe72d70806e964098345a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Dec 26 18:13:57 2020 +0100

    Bug 27200: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e12e0ef016247003a7a97916aa760277b56782cf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 16 18:38:11 2020 +0000

    Bug 27200: (follow-up) Browse search interface update
    
    This patch updates the browse search interface to confirm to new
    interface patterns in the Bootstrap 4 framework, especially in the form
    markup.
    
    The results list has been changed to a Bootstrap "Collapse" component
    configured as an accordion
    (https://getbootstrap.com/docs/4.5/components/collapse/#accordion-example).
    
    Instead of loading the bibliographic record results below the list of
    terms returned, the bibliographic results are now displayed in the
    "panel" expanded below the selected term. Subtitle has been added to the
    information displayed about the bibliographic record.
    
    To test you must be using ElasticSearch and the OpacBrowseSearch
    preference must be enabled. Apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Open the "Browse search" page in the OPAC.
    - Test various searches: Author, Subject, and Title.
    - When results are found, the should be displayed as a Bootstrap-styled
      accordion widget. Clicking any individual result should expand the
      panel containing the corresponding records.
    - Clicking the record link should open the bibliographic detail page in
      a new window.
    - When no results are found, a Bootstrap-style "alert" box should
      appear.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc2c86ba78420a083cfad726b15ed52f9cd19d53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 11 11:19:55 2020 +0100

    Bug 27200: (bug 20168 follow-up) Fix 'Browse search'
    
    The 'hidden' class has been replaced by 'd-none' on bug 20168
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b9b7d8e779b29ec5bb9ec2a2e84c91eb1c5b19e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 14 15:54:54 2020 +0100

    Bug 27196: Don't explode if item that is waiting if checked in by SIP
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd36b9bb5b05e66f01ecd32d028247894820523c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 21 13:43:21 2020 +0000

    Bug 24398: (QA follow-up) Add POD
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c596f450d96e04befe6d5335d8ad12679541d220
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 10 15:10:10 2020 +0100

    Bug 24398: Fix 500 when viewing a single news item at the OPAC
    
    Test plan:
    0. Set the NewsAuthorDisplay preference to 'OPAC' or 'Both OPAC and staff client.'
    1. Open the OPAC main page and click on an individual news item
    Without this patch you get an ugly 500
        Template process failed: undef error - The method Koha::NewsItem->author_title is not covered by tests!
    With this patch applied you see the news with the author's info
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68047132a4888db6eb5169e1cd3ceac49aa84b3b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Dec 16 19:26:11 2020 +0000

    Bug 27256: Update click handler for point of sale
    
    This patch updates the click handler to bind to the table element in the
    DOM as aposed to the individual buttons by their classes. We then use
    the event propogation and filter on the button class to catch the clicks
    we want.
    
    Test plan
    1/ Add 22 debit_types that can be sold to the system (or reduce the
    datatable paging size)
    2/ Confirm that items on the second page of results cannot be added for
    sale on the point of sale page.
    3/ Apply the patch
    4/ Confirm items from the second table page can now be added correctly
    5/ Clicking add when navigating to such an item should leave the items
    table unmodified.
    6/ Clicking aa when the table was filtered should reset the filters
    bringing the table back to the first page
    7/ Signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b56076405bd0d171b702a63564339d80fa99359
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 21 16:06:35 2020 +0000

    Bug 27148: (QA follow-up) Calculate default_strong_password correctly
    
    Fix a typo lenght for length
    
    If category strong password is not set, then we fall back to the preference, but that can be "" - which should be treated as 0
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03839d40b1fd58a3863a1153a6ae44d1002d9afb
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Dec 9 15:17:15 2020 -0300

    Bug 27148: (follow-up) Fix require_strong variable set
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5373b7a5ea125f5b3123ab038a727d13315390f
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Dec 3 13:10:18 2020 -0300

    Bug 27148: Fix bug on self registration when user category is hidden
    
    This patch fixes the bug when there is no patron category available for
    selection in self registration form. It uses PatronSelfRegistrationDefaultCategory
    to get patron's password length and strength.
    
    To test:
    1. Do not apply this patch
    2. Allow SeflRegistration, set PatronSelfRegistrationDefaultCategory to
       a valid patron category and finally add categorycode to PatronSelfRegistrationBorrowerUnwantedField
    3. Go to opac and enter self registration form
    CHECK => There is no patron category available for selection
          => Password's info alert shows "Password must contain at least
    undefined characters"
    4. Fill the form setting a password and send.
    CHECH => You get an exception saying "You must provide a patron's
    category to validate password's strength and length"
    5. Apply this patch and restart_all
    6. repeat steps 3 and 4
    SUCCESS => Password's info alert message shows a number instead of
    "undefined"
            => Password's strength and length checks are working
            => If you change default category's lenght or strength parameter it get's reflected when you refresh the page
            => When you click send, patron is saved
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6982680ae9e71d5d038e894842125860fcc986d6
Author: Mirko Tietgen <mirko@abunchofthings.net>
Date:   Sun Jul 19 17:16:12 2015 +0200

    Bug 14564: Set permissions on configuration backups
    
    This patch sets the group and group read permissions on
    configuration backups, so that they can be downloaded
    via the web staff interface.
    
    Test plan:
    0. Apply the patch
    1. cp debian/scripts/koha-dump /usr/sbin/koha-dump
    2. koha-run-backups --days 2 --output /var/spool/koha
    3. Note *.tar.gz backups in /var/spool/koha/kohadev
    now have root:kohadev-koha ownership and 640 permissions
    4. vi /etc/koha/sites/kohadev/koha-conf.xml
    5. Set backup_db_via_tools and backup_conf_via_tools to 1
    6. echo 'flush_all' | nc -q 1 memcached 1121
    7. koha-plack --restart kohadev
    8. Go to http://localhost:8081/cgi-bin/koha/tools/export.pl
    9. Click on "Export configuration"
    10. Choose a file
    11. Click Download configuration
    12. Note that *.tar.gz file downloaded correctly
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 470c7606695bff93a6c6f4491227bfb6705c21e8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Nov 5 15:52:47 2020 +0100

    Bug 26941: Fix OPAC password recovery error messages
    
    In OPAC password recovery perl opac/opac-password-recovery.pl
    there are some error codes not in Template koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-password-recovery.tt
    
    This patch fixes several bugs:
    - remove 'use Koha::Patrons' defined twice
    - remove vars $errTooManyEmailFound $errBadEmail, not used in any template
    - add in template text for error 'errNoBorrowerEmail'
    
    1) Create a patron A with login but no email
    2) Create a patron B with login and valid email
    3) Go to system preferences set 'OpacResetPassword' to ON
    4) Make sure that OpacPasswordChange is also ON
    5) Go to 'Forgot your password' in OPAC
    6) Enter login if patron A and save
    => You get message 'This account has no email address we can send the email to.'
    7) Enter login if patron B and save
    => Password recovery is send, no error message
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 080288bce48cf4fa94b19d35a117dd3e1967a4c9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 2 16:45:58 2020 +0000

    Bug 24519: Match paycollect form validation for change collection
    
    This patch adds form validation to the Point Of Sale payment page such
    that one cannot submit the form with a 'collected' value that is less
    than the 'owed' amount.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a43fcaf1416057905c277951fb2b0bff13977d33
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Oct 28 16:46:32 2020 +0100

    Bug 26849: Fix Array::Utils dependency in cpanfile
    
    Since bug 26434, if the module is missing Koha does not start. So it
    should be marked as required
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5efece0dc8db3a1438bab40afbcaa7f164f2f75
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 1 15:35:11 2020 +0100

    Bug 27127: Make Koha::BackgroundJob->messages return a scalar
    
    Otherwise the code in the template is not handled correctly:
    112                     [% FOR m IN job.messages %]
    
    m will become each key/val of the message hash:
    {"type":"success","biblionumber":"1","code":"biblio_modified"}
    And not the whole hash
    
    Test plan:
    Modify one biblio using the batch record modification tool
    Modify two biblios using the batch record modification tool
    Go to the detail view of each job and confirm that with this patch the
    display is correct
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69c01ee0f2dccd04cfbe8201ba580a15727f5280
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 1 11:44:04 2020 +0100

    Bug 27117: Only place_holds permission is needed to adjust pickup locations
    
    The GET /pickup_locations route is requesting the whole reserveforothers
    permission whereas only the subpermission place_holds is needed.
    
    Test plan:
    0. Don't apply this patch
    1. Set the subpermission place_holds but modify_holds_priority
    2. Edit a hold and click the pickup library dropdown list
    3. You get a JS alert and log displays
      GET /api/v1/app.pl/api/v1/holds/5/pickup_locations
      403 Forbidden
    4. Apply this patch
    5. Reload the page, click the dropdown list, modify the pickup location
    and save
    => Success!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ea55acd0c997b96039a2a1a4a9f9941d2558bda
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 16:02:14 2020 +0100

    Bug 26921: Don't generate an invalid custom cover image if the url cannot be generated
    
    In case a custom cover image url is used to generate the cover image of
    bibliographic records, we should not build one if the record does not
    have the necessary data.
    
    For instance if you have
    CustomCoverImagesURL set to https://covers.openlibrary.org/b/isbn/{isbn}-M.jpb
    and a biblio does not have the isbn defined, we should not generate and
    empty image (empty or invalid src)
    
    Test plan:
    0.
    Set CustomCoverImagesURL to https://covers.openlibrary.org/b/isbn/{isbn}-M.jpb
    Enable CustomCoverImages and OPACCustomCoverImages
    To highlight the issue you should disable LocalCoverImages and OPACLocalCoverImages.
    1. Make sure you have some of your bibliographic records with a valid
    isbn
    2. Make sure you have at least 1 bibliographic record without an isbn
    set
    3. Visit the search result and detail views (OPAC and staff interfaces)
    => Without this patch you should see a "Cover image" link, and an empty
    block/div on the detail page
    => With this patch applied you should only see images when the url can
    be generated
    
    Note that the problem will persist if the isbn is not valid (ie. no
    image is generated)
    
    Sponsored-by: Orex Digital
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85c25260853aa1c8003b0a041dba2772cd2f316b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 18 11:56:22 2020 +0100

    Bug 27205: Improve logic readability in conditional
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c913bd7d698a8fbc9992f93db426a35c79f330c7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 14 10:19:05 2020 -0300

    Bug 27205: Check valid pickup location on POST /holds
    
    This patch adds a check for valid pickup location to the POST /holds
    route. A 400 code is returned if the supplied pickup library is not
    valid.
    
    To test:
    1. Apply this patch
    2. Run;
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bfe7ea16ef1346585211345ba89d18e303a0c32
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 11 17:55:40 2020 -0300

    Bug 27205: Check valid pickup location on PUT /holds/:hold_id
    
    This patch adds a test for valid pickup locations when updating a hold
    through the API.
    
    Tests are adjusted to reflect this change.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 865a1dab5c346920c61237c4b7593202328e04f8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 14 07:37:53 2020 -0300

    Bug 27209: (follow-up) Add ->is_pickup_location_valid
    
    This patch simply refactors the pickup location check into a method that
    can be called on its own. Tests are added, and the tests for
    ->set_pickup_location should pass unmodified.
    
    To test:
    1. Apply the first two patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => SUCCESS: tests pass
    3. Apply this refactoring patch
    4. Notice the tests are similar, but check for boolean output
    5. Repeat 2
    => SUCCESS: New tests pass, set_pickup_location() behavior unchanged.
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 672413ea294679d4b5b30d30839650f6d30b45ca
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 11 16:51:42 2020 -0300

    Bug 27209: Add Koha::Hold->set_pickup_location
    
    This patch introduces a method to safely update a hold's pickup
    location. It will raise exceptionis if the passed parameters are invalid
    or absent.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => SUCCESS; Tests pass
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 295787223e4dbbe116cba20119db05da4992e0b1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 11 16:51:34 2020 -0300

    Bug 27209: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff7318c62ec7097c5b88f7278b71d0cc7feb1f39
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Dec 10 11:48:43 2020 +0000

    Bug 27124: JS error "select2Width is not defined"
    
    This patch changes the default width paramter passed to the
    select2 plugin. This allows the basic MARC editor's Select2
    widgets to be styled differently than on other pages.
    
    To test, apply the patch and view various pages where the select2 plugin
    is used:
    
     - Basic MARC editor
     - Items edit
     - Batch item edit
     - Authority editor
    
    In each case check that the Select2 plugin works correctly to style
    fields like collection code and home library.
    
    On the basic MARC editor page these <select>s should have a width
    that adjusts as the browser window changes. On other pages the width
    should be fixed.
    
    Check the browser console and confirm that there are no JavaScript
    errors.
    
    Update: Thanks to Julian for the suggested optimization
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de4d6983ab614f56d0514ff4060543da69b2b651
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Nov 24 20:21:07 2020 +0000

    Bug 26634: Remove GetHoldRule subroutine in C4::Reserves
    
    This routine is only used internally and incorrectly overrides
    the precedence of holds rules - it should be removed
    
    This patch removes the routine, adjusts tests, and adds test to
    confirm correct precedence is followed
    
    To test:
    1 - At the All Libraries level, create a circ rule for a specific patron category and a specific item type that only allows 1 hold
    2 - At the branch-specific level for Branch A, create an All/All rule that allows 2 holds
    3 - confirm ReservesControll is set to patron's library
    4 - find a patron from Branch A of the category for which you made your rule
    5 - find two bibs with items of the itype got which you made your rule
    6 - place a hold on one bib. success!
    7 - try to place a hold on the second bib. you're told you cannot because the patron is only allowed 1 hold
    8 - apply patch, restart services
    9 - try to place your second hold again, success!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec1979a385cb35228d39d139d7c0bd8c685dd4a2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 11:31:07 2020 +0100

    Bug 27133: (bug 19351 follow-up) Add missing "Copy no" header to relative's checkouts
    
    Test plan:
    Add a guarantee, go to the relative's checkouts list and confirm that
    the number of headers is not correct
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ec0744ccce7a5027373154fc0a5098e8c5260c3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Dec 8 14:18:35 2020 +0000

    Bug 27166: Set destination_loc to item->homebranch
    
    In bug 21020 we used the issue to fetch the item and then the homebranch.
    This fails when the item is not issued. We fetch the item already, so we
    can use it directly
    
    To test:
    1 - Have an item belonging to branch A
    2 - Check it in via sip at branch B:
        perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 --item CHESS1 -l FPL -m checkin
    3 - The read command is blank and there is a warn about uninitialized data
    4 - Apply patch
    5 - Restart sip server
    6 - Check the item in at branch A using the sip cli emulator
    7 - Check it in at branch B
    8 - This time the checkin should succeed and the output msg should be included
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3126ae34433abe1ca1559e8123e6e1e732c1ed6c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Dec 8 14:18:11 2020 +0000

    Bug 27166: Unit tests
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cae0ef76f398bb3d9f60235ff10611cc8d8eacb7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 11:50:24 2020 +0100

    Bug 25583: Improve wording
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ae3981d3c881bbbd136015ae94e91961236d15e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 20 09:18:26 2020 +0100

    Bug 25583: Disable the "claim returned" button if the feature is disabled
    
    It's possible to display the "Return claims" column on the checkout
    list, even if the feature is disabled.
    We should disable the link and add an explanation.
    
    Test plan:
    - Make sure ClaimReturnedLostValue is empty
    - Go to a patron account
    - Check out an item
    - Make the claims returned column visible in the table of checkouts
    => The button is disabled and a tooltip explains that the feature is
    disabled
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30acf1a9884b98b5e7e965fc057aa632cd781f8f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 2 14:21:27 2020 +0000

    Bug 26905: Purchase suggestion button hidden for users with suggestion permission but not acq permission
    
    This patch adds a link to purchase suggestions from the header menu's
    "More" submenu for users with suggestions management permission.
    
    To test, apply the patch and log in to the staff interface as a user
    with "suggestions_manage" permission.
    
    - Click the "More" menu item in the header. You should see a link to
      "Suggestions" which takes you to the suggestions management page.
    
    - Log in as a user without "suggestions_manage" permission. The link
      should not appear.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 012229c5ea77a009dc708db4370bf499e48dad01
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Nov 9 12:57:13 2020 +0000

    Bug 26946: Set maxlength for cash register name
    
    The cash register names is limited to 24 characters at the database
    level and so that restriction should also be reflected in the UI.
    
    Test plan
    1/ Add or Edit a cash register ( admin > accounts > cash registers )
    2/ Note that you can enter a cash register name longer than 24
    characters, but upon save the value is truncated.
    3/ Apply patch
    4/ Note you can not longer enter a cash register name longer than 24
    characters.
    5/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b62806a979fea789661b3d85113b57dbff0e62d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 3 13:30:34 2020 +0000

    Bug 27142: Don't interpolate batch_type variable
    
    To test:
    1 - Create a report like:
        SELECT * FROM borrowers LIMIT 50
    2 - Run the report
    3 - Attempt batch modification - it fails showing every row as an unfound cardnumber
    4 - Apply patch
    5 - Repeat
    6 - Success!
    7 - Edit report to:
        SELECT * FROM biblio LIMIT 50
    8 - Repeat test
    9 - Ensure batch modification and deletion work
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb0a659684a70204c1922675df18efca257bddd9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 17 15:15:02 2020 +0100

    Bug 24658: (bug 22008 follow-up) Correct update DB entry 18.12.00.031
    
    If the original constraint does not exist, the second one is not added.
    
    Test plan:
    1. checkout dbrev 18.12.00.030
    2. Remove the constraint: ALTER TABLE accountlines DROP FOREIGN KEY accountlines_ibfk_2
    3. checkout master
    4.
    % updatedatabase
    => The constraint accountlines_ibfk_items is not added
    5. Repeat 1 to 4
    => The constraint is added correctly
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a37ba7903d6e7c18b2e2f8d9e145936b0dc8b938
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 9 10:52:15 2020 +0100

    Bug 12430: Fix Search.t failure
    
    t/db_dependent/Search.t ..
        #   Failed test 'buildQuery should keep 0 value'
        #   at t/db_dependent/Search.t line 669.
        #          got: 'su,phr=(rk=(0)) '
        #     expected: 'su,phr=0(rk=(0)) '
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48e74cebedea733e0a6528cd275c1b2925ff46bd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 4 17:05:30 2020 +0100

    Bug 12430: Fix selenium/regressions.t failure
    
    Test failed with
        # Looks like you planned 4 tests but ran 3.
    t/db_dependent/selenium/regressions.t .. 2/5
     #   Failed test 'OPAC - Remove from cart'
     #   at t/db_dependent/selenium/regressions.t line 109.
    Error while executing command: clickElement: An unknown server-side error occurred while processing the command.: Element is not clickable at point (583.7000122070312, 14). Other element would receive the click: <a class="page-link" href="/cgi-bin/koha/opac-search.pl?idx=kw&amp;q=d&amp;offset=420&amp;sort_by=relevance_dsc&amp;count=20" aria-label="Go to the last page"></a>
    
    https://pic.infini.fr//Qhq7pLBq/jT9wZ7F1
    The remove from basket link for the biblio 3 is hidden by the floating
    toolbar.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c4cd7f3f260d44801e36a7582c8dc384afb93e7
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Nov 16 09:43:03 2020 +0000

    Bug 27030: Add missing perldoc for Processing hold status to C4::Reserves
    
    Test plan:
    
    Look into diff and confirm the comment does make sense
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc1158389f5a25ee9d62c2cb84742daa5b97ec50
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 17 12:45:54 2018 -0300

    Bug 16067: Remove FastMmap
    
    It is known to be broken, we should remove its implementation
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cdae4c64b7da609ddeb94d77ffa5bdbb4cb8ca1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 1 16:36:43 2020 +0000

    Bug 26336: Add hint before and remove select after staging with no items
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cee2e630b4e26ebfaef6cf3f41a79df3cf697b01
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 1 15:47:27 2020 +0200

    Bug 26336: Disable 'Item processing' dropdown if no item
    
    If there is no item to process and they have been ignored during the
    stage step, we should not let the user modify the dropdown value
    
    Test plan:
    0 - Check the count of import_items
        SELECT COUNT(*) FROM import_items;
    1 - Import a marc file with items , process the items
    2 - Check the count of import items, it has increased
    3 - Stage the file again, do not process items
    4 - Count of import_items has not increased
    5 - Manage the stage batch
    Confirm that you cannot modify the "Item processing" value
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01a7dc70670801fab021ba7e4f782542c744bbee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 20 11:27:45 2020 +0100

    Bug 26976: Display 0 if renewalsallowed is not defined
    
    If the circulation rule "renewalsallowed" is not set (or an empty
    string) then the checkout list displays
    (0 of  renewals remaining)
    It should display "0 of 0"
    
    Test plan:
    Set renewalsallowed to an empty string
    Check an item out
    Notice the change
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6263d078e9374b1712d7b2a452a1ccb614deaef
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 1 16:22:15 2020 +0100

    Bug 27128: (bug 25728 follow-up) Don't prefill av's code
    
    Bug 25728 patch "Don't prefill av's code" does not work.
    Calling empty val() retruns the attribut.
    Should be val('').
    
    Test plan :
    1) Without patch
    2) Edit a record
    3) Edit a subfield with AV
    4) Enter a new value to create it
    5) You see the modal popup, edit and save
    6) Enter another new value to create it
    7) You see the modal popup => value is prefilled
    8) Re-do test plan with patch (+ clear JS cache) => value is empty
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66b2bb7ca898007533f775a2bdc413c9d00c6ca7
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Feb 18 03:02:55 2020 +0000

    Bug 12430: Add unit tests for C4::Search::buildQuery
    
    This patch adds unit tests for buildQuery, especially focusing on
    the use of the (rk=()) wrapper.
    
    Note that the Net::Z3950::ZOOM library is used to test the queries
    for CCL validity on top of the string matching used in the
    got/expected comparisons.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch: fix spelling connexion ==> connection
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6b5dfa4b718fb74654448b5663cb264b5c376b7
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Jun 17 16:59:32 2014 +1000

    Bug 12430: Use releance ranking without QueryWeightFields
    
    The system preference "QueryWeightFields" is mutually exclusive with
    the system preference "QueryAutoTruncate" and the * truncation
    modifier, when not using QueryParser.
    
    If you use truncation, relevance won't work anymore. (N.B. Relevance
    doesn't work probably when using QueryParser, but for a very different
    reason beyond the current scope of this bug.)
    
    This patch adds relevance ranking when using truncation (or basically
    when QueryWeightFields is disabled).
    
    _TEST PLAN_
    
    1) Turn on "QueryWeightFields" and set "QueryAutoTruncate" to auto
    2) Turn off "UseQueryParser"
    3) Do a keyword search in the OPAC
    4) Note that the results are ordered by biblionumber ascending
    
    5) Apply patch
    
    6) Do the same keyword search in the OPAC
    7) Note that the results are never ordered differently
    (presumably in relevance order :P)
    
    If you're a stickler, throw in some warns so that you can see
    what CCL query is being sent to Zebra.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61f1f02dd791ee587d545d71e3c08fc5eb35c770
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 14:34:18 2020 +0100

    Bug 26665: (bug 20168 follow-up) Fix path to bootstrap js file
    
    20168 moved it to /opac-tmpl/bootstrap/lib/bootstrap/js/bootstrap.bundle.min.js
    
    It fixed the OAI-PMH view
    
    Test plan:
    Hit <OPACBaseURL>/cgi-bin/koha/oai.pl?verb=ListRecords&metadataPrefix=marc21
    and confirm that you can click "Metadata" and it opens
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3b3781ea3745a382cd38e808a2846a6fd933f3c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 2 09:56:04 2020 +0100

    Bug 27003: Item creation log must be done after the item is created
    
    Otherwise we don't have its itemnumber yet!
    
    Test plan:
    Add and modify an item and confirm that the action logs are created
    correctly
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08c34b33e4f9bf8f4f515ca769ed923999d3991f
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Dec 3 15:23:22 2020 +0200

    Bug 27144: Fix syntax error that prevents deleting patrons
    
    To test:
     1) In staff interface open up a patron record
     2) Click More -> Delete, and then "Yes, delete"
     3) Notice 500 error
     4) Apply patch
     5) Notice error is now gone when deleting
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be9f64b638335cac7465ca302e187c7914534fbe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 30 11:19:16 2020 +0100

    Correct Ubuntu versions in release notes - md
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44be943feda8ffc0425219f11af8bdaa6d358036
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 20 19:53:51 2020 +0000

    Bug 23475: Unset the storage if the values do not exist
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45400055e443b991953e81248424cec0a8663b9a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 19 19:38:52 2019 +0000

    Bug 23475: Use localStorage to preserve simple search values
    
    To test:
    1 - Enable IntranetCatalogSearchPulldown
    2 - Perform a search that brings you to a single title
    3 - Note the search is not displayed on the details page
    4 - Apply patch
    5 - Repeat
    6 - Note the search is retained on details page
    7 - Try with different dropdown values and search terms
    8 - Test search terms including accented characters etc
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Bug 23475: (follow-up) Fix selectors and stray use statements
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e5d4ab20568d96f8dd2c49282d24bad9a36c4d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 30 11:14:27 2020 +0100

    Correct Ubuntu versions in release notes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcb0c4ed4954edfc1e7d8b76b0a09be0d29880b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 30 10:47:25 2020 +0100

    Koha 20.12 - start of a new dev cycle
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12491ffca843f5db1aefbc630743dc22c1cd6443
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 17:36:04 2020 +0100

    v20.11.00
    
    Previous commit was pushed without the tag (git push remote master),
    and now git rejects a git push v20.11.00
    So, adding another commit with the tag!

commit 5deae26ae8fa886ea6830f1e7242082e6f7bd38c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 13:19:16 2020 +0100

    Koha 20.11.00 is here!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02bc85cbef22a4db7b4a92f1b324c8e4b287ee81
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 16:41:21 2020 +0100

    Add release notes for Koha 20.11.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adf0293c7bc6b46dbd9c10e86a4684c602b23e16
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 27 14:08:24 2020 +0000

    Bug 27108: Add 21.05 release team to teams.yaml
    
    This patch update the docs/teams.yaml file to add the elected 21.05
    release team and update the include to reflect the minor change of
    structure.
    
    Test plan.
    1/ Apply the patch
    2/ Update Koha.pm to state 20.11.00.000
    3/ Update preferences to Version to 20.1100000
    4/ Navigate to the about page
    5/ Note that the 20.11 team is shown on the left and the new 21.05 team
    is shown on the right.
    6/ Pay particular attention to the 'Packaging manager' on the left and
    'Packaging team' on the right. (We have not had a team of packaging
    people before, so the template had to be updated to allow for an array
    of packaging people).
    7/ Signoff.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Bug 27108: (QA follow-up) Fix Agustin and Documentation manager
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db5da36c9126cbcf7c8482bef3adfe7faa1a4160
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 14:21:54 2020 +0100

    Adjust history and contributors list
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3acf7bebc0084be622e1f0e1c655523e2ddc1cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 12:53:17 2020 +0100

    Fix translation issues
    
    sudo apt-get install translate-toolkit
    junitmsgfmt misc/translator/po/*.po
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 373835c1360096ca4f0bfc63e566256adab6bef8
Author: Koha translators <>
Date:   Fri Nov 27 12:09:13 2020 -0300

    Translation updates for Koha 20.11.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b52d2eb09b75a9fd47d83fa64e69c96599e80cc6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 13:15:28 2020 +0100

    Fix some updatedatabase.pl issues
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8dc44290cfdeb8373f32a992c35a38759f25b161
Author: Mason James <mtj@kohaaloha.com>
Date:   Sat Nov 28 01:16:10 2020 +1300

    Bug 26672: Add 'experimental' info to koha-core and koha-full descriptions
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e69d96a0370366fada6168867b658c152fd8ec2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 12:59:51 2020 +0100

    Bug 27103: Remove from fr-FR
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f47e16ef6008e6494128fa400fae61bc3adbef3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 27 09:24:46 2020 +0000

    Bug 27103: Remove HOLD_CANCELLATION notice
    
    We are really close to release, and the 'proper' fix to make the sending
    of hold cancellation notices optional will introduce string changes.
    
    This patch takes the alternative approach of removing the default notice
    template there by disabling the feature for 20.11.00 release and giving
    us time to properly impliment a solution and re-instate the default
    notice template for the 20.11.01 release.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f99a22f276e429863d4168f7f92c60e66deeb82d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 25 12:58:56 2020 +0000

    Bug 27079: Floating point comparison correction
    
    We cannot compare calculated values directly as those calculations may
    have introduced floating point differences.  We have the
    Koha::Number::Price->round function to consistently round the floating
    point number to a decimal with 2 points precission for comparison.
    
    Test plan
    1/ Set a circ rule to have a .15 per day fine and enable finesMode
    syspref.
    2/ Issue an item of this type to a borrower (making it 12 days overdue
       by setting the due date to 12 days in the past)
    3/ Run the fines job:
    4/ Pay the fine for the patron
    5/ Check in the item
    6/ Note that the patron does not have an 'Overpayment refund' of $0.00
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Bug 27079: (QA follow-up) Round both sides for clarity
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 442802d77629586fe906f1055ce386ace8165d8c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 25 14:10:34 2020 +0000

    Bug 27079: Unit tests
    
    Add a unit test to check for floating point errors in UpdateFine
    relating to catching matching CalcFine amounts compared to DB amount
    values.
    
    Test plan
    1/ Run the unit test and confirm it fails
    2/ Apply the second patch in the series
    3/ Run the unit test and confirm it passes
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68079c72744bbb93a3f512e445a1dd15323d9694
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 27 09:25:56 2020 +0100

    Bug 25534: Add missing td in tfoot in pendingreserves
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dd3bbb5c83b77f2cf2b51d291d5cf241a2a6559
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Nov 26 22:18:46 2020 +1300

    Bug 26672: Add deps to koha-core, via debian/rules file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 802b843ac295f14b7be22bf0117ac7c9ee13f67f
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Nov 26 04:29:44 2020 +1300

    Bug 26672: Remove unrequired default-mysql-* references
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d6a5315007c6e1d5c85f57dcbd9e4b5faa01e27
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 25 16:31:58 2020 +0100

    Bug 27092: Remove note about "synced repo" from README.md
    
    Now it's displayed on our git.k-c.org by gitea.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b11be998c7e07ddbefe9b1889f1ecbbf74a29a50
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Oct 15 01:21:13 2020 +0000

    Bug 26672: Add koha-core and koha-full definitions to debian/control files
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 425cb6ec25210a7832ca0de39e2404daae1c8bc2
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Nov 26 01:04:27 2020 +1300

    Bug 26672: Add additional koha-core and koha-full files to ./debian
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8b89fe66a3e03cc951737a3dfcd235b81c982a7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 23 12:09:47 2020 +0000

    Bug 26518: (QA follow-up) Expect warnings, don't supress them
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9038cdd9a45c06266b18167900fd428b0b1395ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 15:01:22 2020 +0200

    Bug 26518: Move BiblioAutoLink within the transaction
    
    We don't want the authorities to be created if the biblio insert fails
    later
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1519050205d0f4411ca01e312732e5861da4ac3d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 9 12:09:08 2020 +0200

    Bug 26518: Hide expected DBI warnings
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0c39296c5c557bfcb00a762036bb269efd04a46
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 13:29:49 2020 +0200

    Bug 26518: Raise exception if the insert failed
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1e9453f1dcd5cc477ccd7fbecadb2a36176a4be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 13:29:33 2020 +0200

    Bug 26518: Use Koha::Biblio[item] in AddBiblio
    
    Bug 26518: Does not return from the catch block
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92720f9b5e37a84aa4b35dd07f32e8a42453757e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 17 16:22:59 2020 +0100

    Bug 27026: (bug 24159 follow-up) Add a tooltip to explain the values of "Days mode"
    
    There was a tooltip for values of the existing rules, but not the only
    you were editing.
    
    Now there is the same tooltip (title) on the option elements of the
    dropdown list.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Bug 27026: Use meaningful descriptions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 443c004bc64543b1755bf0579a68ef32aa36cee5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 18 13:29:33 2020 +0000

    Bug 25942: Fix batch report operations for cardnumbers and biblionumbers
    
    This patch moves the processing for these to a block and adds a comment
    in place of whitespace and uses template directives to chomp newlines to improve readability
    
    To test:
     1 - Create a report like:
        SELECT biblionumber FROM biblio
     2 - Run it
     3 - Try the various options from the 'Batch operations' button
        (You will need to define a marc modification template)
     4 - The operations don't find the biblios
     5 - Create a report like:
        SELECT cardnumber FROM borrowers
     6 - Run it
     7 - Test the batch operations
     8 - They fail
     9 - Apply patch
    10 - Run each report again and test batch operations
    11 - They work!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Bug 25942: (follow-up) fix filters
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03f15d13c5bb931c03aa1487a3887bdaa034b06f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 20 19:11:10 2020 +0000

    Bug 27070: Add cross_fields type to our searches
    
    This patch adds the 'cross_fields' type to our searches:
    https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-dsl-query-string-query.html#query-string-syntax
    
    Without this patch the search terms seem to all require being in the same field when using Elasticsearch 6
    
    To test:
    0 - Set QueryAutoTruncate to 'only if * is added'
    1 - Find a record with a title and publisher
    2 - Search for a word form the title and confirm the record is returned
    3 - Search for a work from the title and the publisher's name
    4 - The record is not returned
    5 - Apply patch
    6 - Repeat #3
    7 - The record is returned
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bc36cd672ad7d4abf839bed2d48da43f09415e9
Author: Philippe Blouin <blou@inlibro.com>
Date:   Tue Nov 24 17:03:32 2020 -0500

    Bug 27082: uncertainprice.pl does not handle pagination
    
    To reproduce:
    1- create a basket
    2- add more of 20 orders with uncertain price
    3- click on uncertain price button
    4- on page 1 of list, uncheck uncertain box of an order
    5- click on save button
    6- orders who were on page 2 are not display anymore in page uncertainprice.pl
    7- return to basket view acqui/basket.pl
    8- orders who were on page 2 have "rvcd" label and quantity is null
    
    The data in page 2 and beyond is not transmitted, but the code doesn't
    handle that.  This patch makes sure that all that (empty) data is not (wrongly) processed.
    
    Sponsored by: CCSR
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b341dc0732e151b67daf2d20a80efa8d1c3b2297
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Nov 23 09:43:58 2020 -0500

    Bug 26819: (QA follow-up) Fix branchtransfers.tt
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3abd32ff9a90112e6cd1008c5b9c02b1da40ba9b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Nov 23 09:42:06 2020 -0500

    Bug 26819: (QA follow-up) authorized_value should be authorised_value
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ec7884834489c834a31aab23a281bc3646c599a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Nov 2 10:34:35 2020 -0500

    Bug 26819: Fix calls to AuthorisedValues.GetDescriptionByKohaField in course-details.tt
    
    Test Plan:
    1) In the staff interface go to course reserves.
    2) Add a new course.
    3) Add a reserve (Add reserves > add a valid barcode > submit).
    4) Go to the list of courses and select the course you added the item to.
    5) An error trace log is generated
    6) Apply this patch
    7) Reload the page
    8) No errors!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a10caccf80c2097305031325a4ee5de889adeec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 23 14:15:14 2020 +0000

    Bug 27072: Don't process staff interface CSS with rtlcss
    
    This patch changes Koha's gulpfile to add a check for the "OPAC" context
    before using rtlcss to automatically build right-to-left versions of
    CSS.
    
    To test, apply the patch and test the process of building CSS for both
    the OPAC and staff client:
    
    - "yarn css --view opac" : This should build unminified CSS for the
        OPAC, including map files in bootstrap/css/maps
    
    - "yarn build --view opac" : This should build minified CSS for the
      OPAC and generate the RTL versions.
    
    - "yarn css" : This should build unminified CSS for the staff
      interface, including map files in prog/css/maps.
    
    - "yarn build" : This should build minified CSS for the
       staff interface, with no creation of RTL versions.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a59fe6505407ed1704cc7b162a19adfe2ae6261c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 17 14:48:39 2020 -0300

    Bug 27044: Mark the PayPal integration as deprecated on the user interface
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3acf7e226041f00a5743a9be30d998e6b73db2c5
Author: Victor Grousset <victor@tuxayo.net>
Date:   Fri Nov 20 16:44:04 2020 +0100

    Bug 18267: (QA follow-up) fix typo: overriden => overridden
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d8523ed2b88c8fbf18fc61835967ff555a5dc55
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 20 11:04:04 2020 -0300

    Bug 26922: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9e3db201e1863b30ac0e2654d82a15f0f8e44c0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 19 13:09:47 2020 -0300

    Bug 26922: Better error handling in SendAlerts
    
    This patch makes SendAlerts display a better error message when sending
    fails.
    
    To test:
    1. Set KohaAdminEmailAddress to admin@example.org
    2. Edit a vendor, set a valid email address
    3. Create a new basket, a new order. Send the basket
    => FAIL: As you did not configure a valid SMTP server, the email is not sent and logs displayed "unable to establish SMTP connection to (localhost) port 25", with the stracktrace.
    4. Apply this patch and reload all
    5. Repeat 3
    => SUCCESS: A simpler message is displayed, the stacktrace remains in
    the logs
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 279ce72e4ced3ca191a8ee4e109c28df169dfc20
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 19 15:16:36 2020 +0100

    Bug 26557: (bug 23463 follow-up) Fix Batch import when incoming records contain itemnumber
    
    Prior to ug 23463 AddItemFromMarc where calling AddItem, that did not
    take into account the itemnumber field.
    Now that we are using Koha::Item, we need to remove the items.itemnumber
    field from the MARC record
    
    Test plan:
    1 - find an existing bib in your system with just one item
    2 - export that bib with the item attached
    3 - delete the barcode from your item in Koha
    4 - stage your exported marc file for reimport, match on biblionumber, set it to Always Add Items
    5 - confirm that the bib matches and the incoming 952 is parsed
    6 - click "Import this batch into the catalog"
    
    => Without this patch you get (in the logs, or hidden)
    manage-marc-import.pl: DBD::mysql::st execute failed: Duplicate entry '23' for key 'PRIMARY' [for Statement "INSERT INTO `items` ( `barcode`, `biblioitemnumber`, `biblionumber`, `ccode`, `cn_sort`, `cn_source`, `damaged_on`, `dateaccessioned`, `datelastborrowed`, `datelastseen`, `holdingbranch`, `homebranch`, `itemcallnumber`, `itemlost_on`, `itemnumber`, `itype`, `location`, `more_subfields_xml`, `onloan`, `permanent_location`, `replacementpricedate`, `timestamp`, `withdrawn_on`) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, current_timestamp, ? )" with ParamValues: 0="BC_23", 1=8, 2=8, 3="REF", 4='CN__23', 5=undef, 6=undef, 7="2014-09-04", 8=undef, 9="2014-09-04", 10="FPL", 11="FPL", 12="CN_23", 13=undef, 14="23", 15="BK", 16="GEN", 17=undef, 18=undef, 19="GEN", 20="2014-09-04", 21=undef] at /usr/share/perl5/DBIx/Class/Storage/DBI.pm line 1836.
    manage-marc-import.pl: DBIx::Class::Storage::DBI::_dbh_execute(): Duplicate entry '23' for key 'PRIMARY' at /kohadevbox/koha/Koha/Object.pm line 169
    manage-marc-import.pl: {UNKNOWN}: Transaction aborted: Duplicate ID. Rollback failed: DBIx::Class::Storage::txn_rollback(): Refusing to roll back without a started transaction at /kohadevbox/koha/tools/manage-marc-import.pl line 253 at /kohadevbox/koha/tools/manage-marc-import.pl line 253
    
    => With this patch applied, the new item must be added to the existing bibliographic record
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6267eb7cba91ad8177cc60c4c7cba0b26b473cee
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Sep 30 14:54:57 2020 +0200

    Bug 25548: (follow-up) Remove those rewrite redirects in koha-httpd.conf
    
    In etc/koha-httpd.conf for dev install, those rewrite redirects are already commented.
    Just remove them.
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 181125242c33d439fb6bdbddccb6a86a03fa8c15
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed May 20 15:08:05 2020 +1000

    Bug 25548: Remove Apache rewrite directives that trigger redirects
    
    Historically, we have used Apache rewrite directives to strip
    query parameters with no arguments from the query
    string (e.g. PARAM=&), and then redirect to the new URL.
    
    However, this slows down user activity, and depending on your
    HTTPS and proxy setup can cause suboptimal HTTP downgrades and
    upgrades.
    
    Test Plan:
    0) Apply patch
    1) Build Debian package
    2) Install Debian package and reload Apache
    3) Open developer tools on your favourite browser
    4) Go to Network tab in developer tools
    5) Go to /cgi-bin/koha/opac-main.pl
    6) Search for "test"
    7) Note a 200 status for "opac-search.pl?idx=&q=test"
    
    If you got a 302 status for "opac-search.pl?idx=&q=test"
    followed by a 200 status for "opac-search.pl?q=test", you
    will know that your Apache configuration wasn't updated.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36a6ce301f961b0cefdca70ed9a903a1216e071f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 18 13:15:04 2020 +0000

    Bug 7607: (follow-up) Address OPAC and limits
    
    This patch adds the same function to the OPAC and adds support for limits
    
    I adjust the class on staff side to match the one already existing on OPAC
    
    On the OPAC when you click the back button the fields are not enabled - on the staff side they are,
    I leave this problem for someone else to solve
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a508d3fcbec2c1d64b94fe66b288b28cc6998e37
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 5 19:00:32 2020 +0000

    Bug 7607: (follow-up) Disable rather than remove inputs
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc970464ec7c881aaa9d8a33931a29a5951e6103
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Nov 3 11:19:23 2020 +0000

    Bug 7607: Remove empty inputs when submitting search form
    
    This patch surrounds the operator, index, and query fields on the advanced search
    page wtih a 'search_set' class.
    
    This allows us to process them as a group and confirm the query is populated before submitting
    the other parts to the form
    
    TO test:
    1 - Go to advanced search
    2 - Use search boxes to search like:
        Title: (leave blank)
        Author: clinton
        keyword: shuffle
    3 - Perform search
    4 - Note no results as you searched for title:clinton etc.
    5 - apply patch
    6 - refresh and repeat
    7 - search is now correct
    8 - Try vaeious searches with 'more options' and selecting different operators
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 926ad3c1a69074b2905d9ef03e639db6ba8d6865
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 11:56:31 2020 +0100

    Bug 25514: Try to fix random failure from REST/Plugin/Objects.t
    
    It's causing a "Premature connection close" error
    
    https://docs.mojolicious.org/Mojolicious/Guides/FAQ#What-does-Premature-connection-close-mean
    
    This is just a guess but maybe it would help to have the Test::Mojo
    object initiated just before the get?
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05085ddc61332bfb82401a7d5b8d5b0fa24cdea6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 20 10:31:33 2020 +0100

    Bug 27062: Fix pickup_location tests when existing libraries exist
    
    If there are existing libraries in the DB, the tests will fail.
    
    There were several changes related to those tests recently, this bug report is a follow-up for them.
    
    bug 26984, bug 27002 and bug 26963.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3376a9440050d795ce0738e20b0616b782143f4b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 13 09:32:50 2020 +0100

    Bug 27007: Don't call GetMarcSubfieldStructure with unsafe in tests
    
    It does not feel correct to call GetMarcSubfieldStructure with the unsafe flag set in tests:
       my $mss = C4::Biblio::GetMarcSubfieldStructure( '', { unsafe => 1 } );
    
    Some tests are failing is run twice
    
    Use of uninitialized value $code_wanted in string eq at /usr/share/perl5/MARC/Field.pm line 314.
    [x~10]
    Use of uninitialized value $code_wanted in string eq at /usr/share/perl5/MARC/Field.pm line 314.
    
        #   Failed test 'Value is mapped correctly for column biblionumber'
        #   at t/db_dependent/Koha/Item.t line 115.
        #          got: undef
        #     expected: '483'
    [etc.]
    
    Test plan:
    Run the tests twice, without the patch it fails, with the patch it
    passes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1aeeaf4c2b6f4c8f79e2472b7c66a832d0daf802
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 19 17:15:32 2020 +0100

    Bug 22343: (follow-up) Correctly handle password on editing
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43b66ccfae07d8a72e7fe5433dafa69f4c870602
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 19 17:25:14 2020 +0100

    Bug 26938: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59e4b03d73cb4a103acdf25f858af4efaf6c491f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Nov 17 12:11:21 2020 +0000

    Bug 26984: (follow-up) Don't delete patrons and checkouts in Objects.t
    
    Rather than counting all and assuriing we get 10, we can count all, add 10, and ensure the numbers still match
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a25b651cf257f41fd0a8c601e70acad74b479724
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 12 13:11:13 2020 +0100

    Bug 26984: Make tests pass if AnonymousPatron is set
    
    There is only 1 place where it can be tricky to not remove them as we
    want exactly 10 patrons to be present in the DB
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dff16710ae53ebfab8596f27b35a7c8e35f81edf
Author: Frédéric Demians <f.demians@tamil.fr>
Date:   Tue Nov 10 17:00:09 2020 +0100

    Bug 26992: Fix serial issue and related items deletion on serial collection page
    
    serial-collection.pl uses C4::Items::DelItemCheck() function which is obsolete.
    
    Test plan:
    
    1. Create a subscription with items created when receiving.
    2. Receive several issues, and create corresponding items.
    3. On Serial collection page (serial-collection.pl), select several issues.
    4. Click on button Delete selected issues
    5. A confirmation page is displayed. Enable "Delete associated items?".
       Then click on "Yes, delete" button.
    
       You get this error: Undefined subroutine &C4::Items::DelItemCheck
    
    6. Apply the patch an repeat steps 3-5.
       Check that issues and related items are deleted.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c056385669cefa02e2a94f96d8edea570f3c887e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 19 11:13:34 2020 +0100

    Bug 26854: Remove log of STDERR
    
    See discussion on comments 12-20
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3cacc62cda58798e8f2de6cfdd636772d2158f0
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Oct 29 04:24:31 2020 +0000

    Bug 26854: Close STDERR when forking stage-marc-import.pl
    
    We need to close STDERR when forking stage-marc-import.pl,
    or else the CGI session with Apache httpd does not properly
    finish. This leads to unexpected behaviour across different httpd
    versions, operating systems, etc.
    
    This patch closes the STDERR file handle when forking a child
    process to do MARC imports, and it re-opens STDERR to a log file
    in the logdir directory to catch any import errors.
    
    Test plan:
    1. Apply the patch
    2. Go to http://localhost:8081/cgi-bin/koha/tools/stage-marc-import.pl
    3. Upload a MARC file with a large number of records (e.g. 30,000 records)
    4. Open F12 dev tools
    5. Click on "Network" tab
    6. Clear all existing network logs
    7. Click "Stage for import"
    8. After ~30 seconds, the request to stage-marc-import.pl should return a 200 code
    9. Immediately, calls to background-job-progress.pl should start, and the "Job progress"
    bar should update at a maximum rate of every .5 seconds
    (or more realistically 1-2 seconds)
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba04deb9c36feedd1e0659d2d78b9327ce54ff4c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 19 14:24:59 2020 +0100

    Bug 26031: Remove the failing tests and the diag
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4ffaeaec1fdc9ee7c33ee419139def9d62c586e
Author: Mason James <mtj@kohaaloha.com>
Date:   Fri Nov 20 02:10:28 2020 +1300

    Bug 26031: Remove 4 failing tests from t/db_dependent/www/search_utf8.t
    
    to test...
    1/ apply patch
    2/ run test
    3/ observe PASS
    
    root@kohadevbox:/kohadevbox/koha# export KOHA_INTRANET_URL="http://kohadev-intra.myDNSname.org:8081"
    root@kohadevbox:/kohadevbox/koha# export KOHA_OPAC_URL="http://kohadev.myDNSname.org:8080"
    root@kohadevbox:/kohadevbox/koha# prove -v  ./t/db_dependent/www/search_utf8.t
    1..87
    ok 1 - connect to intranet
    ok 2 - login to staff interface
    ok 3 - load main page
    ok 4 - open tools module
    ok 5 - go to stage MARC
    ok 6 - uploaded file
    ok 7 - upload succeeded
    ok 8 - reopen stage MARC page
    ok 9 - stage MARC
    ok 10 - have job ID
    ok 11 - job was completed
    ok 12 - reopen stage MARC page at end of upload
    ok 13 - stage MARC
    ok 14 - view batch
    ok 15 - imported records into catalog
    ok 16 - got search on intranet
    ok 17 - got search on intranet
    ok 18 - Base is like "(?^u:search.pl\?advsearch=1&idx=kw&q=%CE%91%CE%B8%CE%AE%CE%BD%CE%B1)"
    ok 19 - UTF-8 are multi-byte. Good
    ok 20 - UTF-8 chars are correctly present. Good
    ok 21 - got opac
    ok 22 - got opac
    ok 23 - Base is like "(?^u:opac-search.pl\?(idx=&)?q=%CE%91%CE%B8%CE%AE%CE%BD%CE%B1)"
    ok 24 - Base does not contain an idx
    ok 25 - UTF-8 are multi-byte. Good
    ok 26 - UTF-8 chars are correctly present. Good
    ok 27 - view and clean batch
    ok 28 - biblio on intranet
    ok 29 - biblio deleted
    ok 30 - connect to intranet
    ok 31 - login to staff interface
    ok 32 - load main page
    ok 33 - open tools module
    ok 34 - go to stage MARC
    ok 35 - uploaded file
    ok 36 - upload succeeded
    ok 37 - reopen stage MARC page
    ok 38 - stage MARC
    ok 39 - have job ID
    ok 40 - job was completed
    ok 41 - reopen stage MARC page at end of upload
    ok 42 - stage MARC
    ok 43 - view batch
    ok 44 - imported records into catalog
    ok 45 - got search on intranet
    ok 46 - got search on intranet
    ok 47 - Base is like "(?^u:search.pl\?advsearch=1&idx=kw&q=Ram%C3%B2n)"
    ok 48 - UTF-8 are multi-byte. Good
    ok 49 - UTF-8 chars are correctly present. Good
    ok 50 - got opac
    ok 51 - got opac
    ok 52 - Base is like "(?^u:opac-search.pl\?(idx=&)?q=Ram%C3%B2n)"
    ok 53 - Base does not contain an idx
    ok 54 - UTF-8 are multi-byte. Good
    ok 55 - UTF-8 chars are correctly present. Good
    ok 56 - view and clean batch
    ok 57 - biblio on intranet
    ok 58 - biblio deleted
    ok 59 - connect to intranet
    ok 60 - login to staff interface
    ok 61 - load main page
    ok 62 - open tools module
    ok 63 - go to stage MARC
    ok 64 - uploaded file
    ok 65 - upload succeeded
    ok 66 - reopen stage MARC page
    ok 67 - stage MARC
    ok 68 - have job ID
    ok 69 - job was completed
    ok 70 - reopen stage MARC page at end of upload
    ok 71 - stage MARC
    ok 72 - view batch
    ok 73 - imported records into catalog
    ok 74 - got search on intranet
    ok 75 - got search on intranet
    ok 76 - Base is like "(?^u:search.pl\?advsearch=1&idx=kw&q=%F0%A0%BB%BAtomasito%F0%A0%BB%BA)"
    ok 77 - UTF-8 are multi-byte. Good
    ok 78 - UTF-8 chars are correctly present. Good
    ok 79 - got opac
    ok 80 - got opac
    ok 81 - Base is like "(?^u:opac-search.pl\?(idx=&)?q=%F0%A0%BB%BAtomasito%F0%A0%BB%BA)"
    ok 82 - Base does not contain an idx
    ok 83 - UTF-8 are multi-byte. Good
    ok 84 - UTF-8 chars are correctly present. Good
    ok 85 - view and clean batch
    ok 86 - biblio on intranet
    ok 87 - biblio deleted
    ok
    All tests successful.
    Files=1, Tests=87, 127 wallclock secs ( 0.06 usr  0.02 sys +  3.00 cusr  0.99 csys =  4.07 CPU)
    Result: PASS
    
    real    2m6.709s
    user    0m3.124s
    sys     0m1.032s
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9dcb51a8387f65fa2d9ff47afa9c7bb91be95e90
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 19 13:58:07 2020 +0000

    Bug 24083: (follow-up) Assign renewals remaining string to content
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f8ae9498d45b248189c804a7c3626803abbacf3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 18 15:09:14 2020 +0100

    Bug 26939: Add missing filters
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4a15b27b8359a13fa80952ed7e920b7388527fb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 11 09:32:10 2020 -0300

    Bug 25313: (QA follow-up) DelAuthority tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 517dcabdf73acfaf01cde461beb8bac84f86c82e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Apr 29 16:19:00 2020 +0200

    Bug 25313: Add skip_merge to ModAuthority
    
    Sometimes you know that the merge is useless, since the reporting
    tag did not change.
    Might be handy in batch processing of authority records.
    
    Test plan:
    Pick an authority with a few linked biblio recs (so that it will
    immediately merge; lower than MergeLimit).
    Open authority record and save it.
    Verify that a linked biblio record was merged. Check time in 005.
    You proved that this patch does not break the regular process.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7abee7fd6913c178baffafe2ea8cfc33f38c87f6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 11 09:26:50 2020 -0300

    Bug 25313: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8f39a001c979fb0ef7ac342dd07062285d0264d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 1 13:32:46 2020 +0000

    Bug 26337: Pass skip_merge to DelAuthority when removing unsused authorities
    
    This script checks that an authority is not being used before deleting it.
    We do not need to check biblios for the authority id as we have already verified it is unused.
    
    TO test:
     1 - Reset db to koha test database
     2 - perl misc/migration_tools/remove_unused_authorities.pl -t
     3 - Note a number of unsued authorities
     4 - perl misc/migration_tools/remove_unused_authorities.pl -c
     5 - Note authorities are removed
     6 - Reset db
     7 - Apply patch
     8 - perl misc/migration_tools/remove_unused_authorities.pl -t
     9 - Note results are the same
    10 - perl misc/migration_tools/remove_unused_authorities.pl -c
    11 - Note results are the same
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 308b03a31b95a8808751b98d3b285adcb370f47f
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Thu Nov 5 20:28:11 2020 +0000

    Bug 26944: Point help link to automatic item mod in manual
    
    To test:
    1 - go to automatic item mod, click help, end up at manual homepage
    2 - apply patch, restart, reload page
    3 - click link again, go to auto item mod in manual
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf8ab094705163f50f46451b0dffa00cdd1d4ab9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 12:32:04 2020 +0100

    Bug 26846: Fix regressions - Preselect expected and late serials
    
    This is a follow-up for bug 17674. Expected and late serials must be
    checked by default.
    
    Test plan:
    Have some serial collection and notice that the checkboxes are checked
    for expected and late serials
    /serials/serials-collection.pl?subscriptionid=42
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49658d43c3e3bb4064afdad824153325d2216083
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Nov 3 09:57:32 2020 +0000

    Bug 26939: Use AV description in sales table display
    
    Content should use the description rather than the code
    
    Test plan
    1/ Enable 'UseCashRegisters'
    2/ Make some payments against a cash register
    3/ Navigate to the cash register summary page via tools > cashup
    registers > register name
    4/ Note that the payment type you selected at payment time appears as
    the code of the authorized value as aposed to the description.
    5/ Apply patch
    6/ Refresh page
    7/ The payment type should now contain the description
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 258d475d5f4bb306496dc90b9c602fd776a6c545
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Nov 3 09:47:12 2020 +0000

    Bug 26938: Prevent flash of unstyled sales table
    
    On the registers page the table has come complex data structures
    embedded to allow for all the functionality we bring into the datatable.
    
    We should hide the table on page load and only display it at DataTables
    init time once the weird content has been beautified by DataTables.
    
    Test plan
    1/ Enable 'UseCashRegisters' and 'EnablePointOfSale'
    2/ Add a cash register and make some transactions against it.
    3/ Navigate to the 'Register details' page
    4/ Note that some 'funky' JSON strings appear in the table briefly
    before it is restyled when DataTables loads.
    5/ Apply the patch
    6/ Rebuild the CSS from the SCSS files
    7/ Reload the page (hard reload to get the CSS changes)
    8/ Note that the table now only appears once the nice formatting that
    DataTables adds is applied.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 836d9a38727859f06902a7be6790592431fe812e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 11:37:55 2020 +0100

    Bug 26986: Prevent Selenium's StaleElementReferenceException
    
    This is a follow-up bug for bug 26162
    
    By finding the element before the click I hope to get the good element,
    even if the page changed in the meanwhile.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c70587c088241e30e6fe0e5f9bb858a0a165293
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 12:55:17 2020 +0100

    Bug 26973: (bug 26119 follow-up) Restore patron's attributes during self-registration
    
    The assumption on bug 26119 was wrong. We actually store patron's
    attributes during self-registration if
    PatronSelfRegistrationVerifyByEmail is not enabled.
    
    Test plan:
    Test the different combinations of PatronSelfRegistration and PatronSelfRegistrationVerifyByEmail
    Confirm that the patron's attributes appears during self-registration if
    PatronSelfRegistrationVerifyByEmail is not set.
    Confirm that the patron's attributes are stored when they are displayed
    on the self-registration form
    Confirm that you can edit the patron's attributes in any cases (if they
    are marked as editable at the OPAC)
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 853a56cc7ae6c089f0f113943b77530d8c3a15c8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 13 16:33:40 2020 +0000

    Bug 26903: Pass record ids and records through to update_index when passed to index_records
    
    When both a record and record_id are passed to index_records the data should be passed through
    to update_index. We missed copying over the record ids to the variable we use as a check.
    
    To test:
    1 - Set searchEngine system preference to Elasticsearch
    2 - Reindex your db
    3 - Search authorities
    4 - Edit a record and add 'testwaffle' to the main heading
    5 - Search authorities for 'testwaffle' - no results
    6 - Apply patch
    7 - Edit the record again, change 'testwaffle' to 'testpancake'
    8 - Search authorities for 'testpancake' - result!
    9 - Confirm imported authorities and authorities added via Z39 are correctly indexed
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a955f9a0ac65866541111e6242f2b57e4465ce5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 13 16:33:12 2020 +0000

    Bug 26903: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6bbd13ba031cf4ba592b989e869cba3a95405d4b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 16 12:54:13 2020 -0300

    Bug 26988: (QA follow-up) Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9935c0bdbfc22096640b79e998cf39118deb969e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 13 13:53:15 2020 +0000

    Bug 27002: Update callers for changed return
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7db88b60441e69d3d2478276d13977bbf21a8ae5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 12 08:09:56 2020 +0000

    Bug 27002: Update Koha::Biblio->pickup_locations to return a resultset
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1400890ec8040ced8e3550eddbfd0d4e8af2347
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 23 14:42:40 2020 +0000

    Bug 26516: Don't accept incorrect values for copyrightdate/publicationyear
    
    The previous patch rejects incorrect values when saving to the db specifically for copyrightdate
    An error is thrown for the int conversion when it fails
    
    Rather than catching things when saving we can fix the value when generated, simply returning null when parsing
    the record
    
    To test:
    1 - Add a new record to Koha making sure data is valid except 260$c:
        198-
    2 - Save the record
    3 - It fails
    4 - Apply this patch
    5 - Restart all the thigns
    6 - Repeat
    7 - Success!
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55835ccfaffef48b924857e18bfd964aebda3a0a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 13 15:54:32 2020 -0300

    Bug 27021: Make chaining ->empty always return an empty resultset
    
    This patch borrows the implementation Martin did on bug 27002, to
    woraround this issue, and implements it properly on the
    Koha::Objects->empty method.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Objects.t
    => FAIL: Tests fail! The resultset should be empty and it isn't!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a386954b8b17925ed213a56878e1d453ba8c7635
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 13 15:47:39 2020 -0300

    Bug 27021: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36d46c6510ee93ffc52f6b914389c66351b16f33
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Thu Nov 12 11:42:05 2020 +0000

    Bug 18267: Refactored Edifact Price Calculations
    
    Refactored the price calculations for Quotes and Invoices
    This takes in to account various combinations used by different
    vendors. Makes the extraction of basic price, quantity and tax
    information more reliable. Tests are in Edifact.t and EdiInvoice.t
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea725f472426caab9bcdbef128fd5693f795fe17
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 13 12:12:20 2020 +0000

    Bug 25761: (QA follow-up) Consistent flag names
    
    This follow-up updates the config flag to be consistent with bug 24449
    and updates the debian template file to match too.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6323ee5351a6801321c0938690344f04aef6c54
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jun 15 12:26:14 2020 -0400

    Bug 25761: Implementation of too_many_overdue has unintended consequences
    
    Bug 24449 implemented the too_many_overdue SIP flag ( position 6 of the
    patron status flags ). This has had unintended consequences as
    many library use SIP2 for validation to eresource vendors ( Overdrive,
    Hoopla, etc ), but do not want overdue checkouts to block the
    use of these resources.
    
    Test Plan:
    1) Apply this patch
    2) Restart all the things!
    3) Find a patron with overdue items
    4) Run a SIP2 patron information request
    5) Note the "too many overdue" flag is set
    6) Set the new SIP config option "disable_too_many_overdue" for the
    account you used for testing
    7) Restart the SIP server
    8) Run the same patron information request
    9) Notice the "too many overdue" flag is no longer set!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b21682c332b63afd3be74073e5eeaf531dadeac
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Nov 13 12:07:22 2020 +0200

    Bug 27012: Fix incorrect SQL syntax in hold merging
    
    If you merge two records with holds in them following error happens
    without this patch:
    
    [WARN] DBD::mysql::st execute failed: called with 4 bind variables when 3 are needed [for Statement "SELECT * FROM reserves WHERE biblionumber = ? AND (found <> ? AND found <> ? OR found is NULL) ORDER BY reservedate ASC" with ParamValues: 0=Null!, 1=Null!, 2=Null!] at /kohadevbox/koha/C4/Reserves.pm line 2002.
    
    To test:
       1) Notice prove t/db_dependent/Reserves.t fails with above error
       2) Apply patch
       3) Notice prove t/db_dependent/Reserves.t passes
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a408fcc0b662c31a8911728ab3d6816ada4c3491
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Nov 13 13:41:16 2020 +0200

    Bug 27012: Add test for C4::Reserves::MergeHolds
    
    This does a basic check whether a hold gets moved to another biblio
    when MergeHolds() is called.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91e21d3a95520f19fa3632d87f2c8f32b11ea1eb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 13 13:15:29 2020 +0000

    Bug 26988: Adjust for bug 26963
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f83e703abd69383cb80ca36cd8219959f1ab205
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 13 11:07:53 2020 +0100

    Bug 26988: No need to check if hold is linked to a patron
    
    Holds are deleted along with patrons.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7edb1a55bc54fd5c68700e703be9deff3d6a0199
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Nov 11 12:22:20 2020 -0300

    Bug 26988: (follow-up) Change event to focus
    
    Click event on select element if Firefox does not work as expected, so
    this patch changes the event to focus for it to work seamlessly in both
    browsers.
    
    https://bugs.koha-community.org/show_bug.cgi?id=26899
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19a30acaece904aeedcc6a3728e3815895d10c56
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 11 03:11:56 2020 +0000

    Bug 26988: (follow-up) Fix filter and encode api values and escape rendered values
    
    This patch makes the QA tools happy and follows correct procedures for passing data to
    and rendering data from the api
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4388d20fb12f77aa733498baa4a287e4fb7c6998
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 11 02:53:46 2020 +0000

    Bug 26988: (follow-up) Adjust code to use api field names
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14506040292201a78733a9c1746bf7f590205fe3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 10 17:38:26 2020 -0300

    Bug 26988: (QA follow-up) Make the API return proper library objects
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75456ba973f87d3c46d045811ad32dfe2a153e3f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 10 17:37:21 2020 -0300

    Bug 26988: Make ->patron prefetchable
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83d471394562b8137fce9b3a538d19efc41fa1e1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Nov 10 13:35:14 2020 +0000

    Bug 26988: Add API route to fetch hold pickup locations and use it in the holds table
    
    To test:
    1 - Place a number of holds on a record
    2 - Have different pickup locations for the holds
    3 - Have some libraries that are not pickup locations
    4 - Load the holds tab for the record and note libraries not pickup locations are not in dropdowns
    5 - Apply patch and restart all things
    6 - Reload the holds table
    7 - Click on a dropdown, note the spinner, should load successfully
    8 - Confirm the dropdown matches the options before the patch
    9 - Confirm updating the hold location works
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6deb941dc95f8642ef8d20da7f2fcabbc0a15d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 13 09:23:51 2020 +0100

    Bug 26963: Ignore existing libraries
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e61bcc270e8bc9a13939af60df45a1db53e51530
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 11 13:26:58 2020 +0000

    Bug 26963: (QA follow-up) Fix up tests and cover case of undefined ccode
    
    While this technically shouldn't happen, if a library creates itemtype limits, then flips the pref, those rules are still in the db until a ccode rule is saved.
    
    To be extra safe, when checking for rules of one type, we should make sure the other type is undef - i.e. if looking for ccode rules, we should confirm the itype is undef for those rules
    
    Additionally, we shouldn't set the barcode now that we are not deleting all items, so we use copynumber for our item identification field as it doesn't need to be unique in the DB
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a42c85889bf779bbcaf82a31793438ebcffc076
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 11 14:09:24 2020 +0000

    Bug 26963: (QA follow-up) Fix cases where we expected a list
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04a4a34d6e9b7a235ae238b82b991795ca5abb8a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 11 15:43:57 2020 +0000

    Bug 26963: (QA follow-up) Update mocked return of pickup_locations
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b09e86a8d3609e03988be4ad387f018a91d0fd7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 11 12:49:00 2020 +0000

    Bug 26963: (QA follow-up) Don't delete existing data before tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6a7a3c8a8fa040409f4c42d10149b72a427cf54
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 11 16:06:21 2020 +0000

    Bug 26963: (QA follow-up) Migrate unit tests into pickup_location
    
    We wrote unit tests for _can_pickup_locations as part of this patchset,
    but then I inlined the method whilst golfing. This patch moves those
    tests into the existing pickup_locations test so we more thoroughly
    cover the case where branch transfer limits are in play.
    
    NOTE: The tests all assume that all items have an effective_itemtype and
    ccode. I'm pretty sure items all have a type at this point, but I'm less
    sure we enforce collection codes?
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7179a29feaf994f35de871d06084f71dfc9eebcc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 11 08:57:21 2020 +0000

    Bug 26963: (QA follow-up) Convert to ResultSets
    
    This patch removes the previously introduced private method by
    converting the arrayref returns to ResultSets appropriately and inlining
    the filter search queries.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b06c361d6c9a45fb07c853f07fb9aa5d4d77c37
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 11 02:37:55 2020 +0000

    Bug 26963: (follow-up) Change subroutine name for QA tools
    
    It didn't like the ending _at
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 780ced27f5ac90d227c88e6fcab2fa43c0b3ffb5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 9 13:53:51 2020 +0000

    Bug 26963: Don't call 'can_be_transferred' for each possible library for each item
    
    Currently When calling Koha::Template::Plugin::Branches::pickup_locations
    we call pickup_location for each item of the bib, and for each item we get a list of possible
    branches, we then check those branches against the transfer limits, this is inefficent
    
    Given a system with 100 branches, and each branch having an item attached to one bib (100 items)
    we will call can_be_transferred ~10000 times - and that will happen for each hold placed on the bib
    
    For me this patch reduced load time from 77 seconds to 18 seconds
    
    To test:
    1 - Find a bib
    2 - Place 4 title level holds
    3 - Add some branches and items for this bib to your system:
      INSERT INTO branches (branchcode,branchname,pickup_location) SELECT CONCAT(branchcode,"D"),CONCAT(branchname,"A"),pickup_location FROM branches;
      INSERT INTO branches (branchcode,branchname,pickup_location) SELECT CONCAT(branchcode,"D"),CONCAT(branchname,"B"),pickup_location FROM branches;
      INSERT INTO branches (branchcode,branchname,pickup_location) SELECT CONCAT(branchcode,"D"),CONCAT(branchname,"C"),pickup_location FROM branches;
      INSERT INTO branches (branchcode,branchname,pickup_location) SELECT CONCAT(branchcode,"D"),CONCAT(branchname,"D"),pickup_location FROM branches;
      INSERT INTO items (biblionumber,biblioitemnumber,barcode,itype,homebranch,holdingbranch) SELECT 1,1,CONCAT("test-",branchcode),'BKS',branchcode,branchcode FROM branches;
    4 - Set systempreferences:
        UseBranchTransferLimits = 'enforce'
         BranchTransferLimitsType = 'item type'
    5 - Find the bib and click the holds tab
    6 - Wait for a long time, it shoudl eventually load
    7 - Apply patch and restart al the things
    8 - Load the page again, it should be much faster
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db1865ba346704d47be28cf8afdcc6052f55d61a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 11 01:24:15 2020 +0000

    Bug 26963: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcc1b96ea9cba850b1d5cfb84a171685b1b2a5ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 13 08:14:40 2020 +0100

    Bug 22818: Fix the last_insert_id call
    
    DBI last_insert_id: invalid number of arguments: got handle + 3, expected handle + between 4 and 5
    Usage: $h->last_insert_id($catalog, $schema, $table_name, $field_name [, \%attr ]) at /kohadevbox/koha/installer/data/mysql/updatedatabase.pl line 23326.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64ee6f0b2bbcc9b23520c689146f1c5cf905e997
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 12 13:36:00 2020 +0000

    Bug 26948: Regression tests
    
    We already mock the send_or_die method from Email::Stuffer; This patch
    updates that mock to extract the internal representation of the email
    encoded message and looks for a known double encoded representation of a
    character in the sample body.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4415fdb0f4785dff24c9773f85a9b32885c385ac
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Nov 6 13:35:39 2020 +0200

    Bug 26948: Remove double encoding from sent emails
    
    The sent emails from Koha were garbled / double encoded because
    Koha::Email now after the refactoring and moving to use Email::Stuffer
    handles the encoding itself. Previously the Koha::Email callee had to
    handle the encoding. This patch removes the double encoding in the
    email subject and content.
    
    To test:
     1) Put some UTF-8 characters like ä in the HOLD template subject and body
     2) Create hold and check-in an item to make it Waiting and cause the
     email to be send
     3) Notice the email comes garbled / double encoded
     4) Apply patch
     5) Repeat step 2) and notice the email comes without any issues in
        encoding and look OK.
     6) Make sure "prove t/Koha/Email.t" and "prove
        t/db_dependent/Letters.t" and passes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbd0bbf98f574a7eb804673978a198eea6fdd798
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 14:55:27 2020 +0100

    Bug 26990: (bug 22284 follow-up) Prevent hold to be placed if cannot be transferred
    
    There is a missing parameter to CanItemBeReserved, we need to know if
    the hold can be placed at a given pickup library.
    
    Test plan:
    1 - Set preferences:
         UseBranchTransferLimits: enforce
         BranchTransferLimitsType: itype
         AllowHoldPolicyOverride: Don't allow
    2 - Set Centerville 'Book' items to not be allowed to transfer to any other library
    3 - Make sure Hold policy is set to 'any library'
    4 - Find a record with a Centerville item and other items
    5 - Attempt to place an item level hold on the Centerville item (with a
    pickup library different than Centerville)
    => Without this patch you are taken to the holds list, but your hold is not placed
    Nothing indicates why hold has failed
    => With this patch you cannot select the item from Centerville
    "Cannot be transferred to pickup library"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1dadf8823357573b740b0c259f16cf18ab4e8904
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Nov 12 11:30:33 2020 +0000

    Bug 22818: (QA follow-up) Respond to feedback
    
    This commit addresses the requests from Jonathan in comment #188
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0423d09e57f6a64656dc0f82a10c82962960e049
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Nov 12 13:38:49 2020 +0000

    Bug 24083: (QA follow-up) Fix DB upgrade
    
    This commit makes the addition of the 'unseen_renewals_allowed'
    circulation rule idempotent, as highlighted by Jonathan in comment #140
    
    Bug 24083: (QA follow-up) Fix for previous
    
    It helps if you don't commit commented out code...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 552ea4e9d27a1d075e009e13bde63b2c91962644
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Nov 12 10:36:08 2020 +0000

    Bug 24083: (QA follow-up) Fix failing tests
    
    This commit fixes the failing tests mentioned by Jonathan in comment
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cdbc04f69d751d2b08dc256d61972330512c3a0d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 18:03:08 2020 +0100

    Bug 22818: Fix TestBuilder.t
    
    t/db_dependent/TestBuilder.t .. 12/13
     #   Failed test 'build_object() tests'
     #   at t/db_dependent/TestBuilder.t line 429.
    Can't locate object method "_new_from_dbic" via package "Koha::MessageAttribute" (perhaps you forgot to load "Koha::MessageAttribute"?) at /kohadevbox/koha/Koha/Objects.pm line 98.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f11484ae7f43092352f7b9376e86328e9fd7f66d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 14:38:12 2020 +0000

    Bug 24083: DBRev 20.06.00.069
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 031ce225455decf24dbff53670136fdae49cf7c1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 15:36:26 2020 +0100

    Bug 24083: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb28f35021247fbfdee428253ee2a557cac90d23
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 15:34:51 2020 +0100

    Bug 24083: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 887022e0d23050d586970ef306df0d5630e1dd65
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed Nov 11 13:19:18 2020 +0000

    Bug 24083: (follow-up) Make requested changes
    
    This commit makes the changes requested in comment #120
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98f0e5047d8538f31ef9854395b5979e815f1bfb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 9 16:11:02 2020 +0100

    Bug 24083: Swap the column for "Unlimited" handling
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2093e41620f92987c5f1a17d8b22597837f66a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 9 16:10:39 2020 +0100

    Bug 24083: Delete the new rule when needed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e311a1be124cc93756183aefea7768be74849ad
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Oct 5 12:39:48 2020 +0100

    Bug 24083: (follow-up) Squashed follow ups
    
    This squashed commit fixes:
    -  a small error in the checkouts related JS
    
    - GetRenewCount now returns 6 values when a call to it succeeds, a
    failed call should also return the same number of values. This commit
    adds these additional values.
    
    - Some changes in issue.t had broken the tests for unseen renewals (the
    unseen tests were using variables that had been moved out of the tests'
    scope).
    
    - Also now using Koha::CirculationRules::set_rules to set circ rules
    rather than using SQL queries.
    
    - Fixed expected number of return values from GetRenewCount
    
    - Moved unseen tests in issue.t to the bottom of the file to remove the
    risk of interference with other test circ rules.
    
    - There was a real mess in C4/Circulation.pm due to a bad rebase back in
    February. Frankly it's a wonder anything worked at all. This commit
    fixes that problem and reinstates the correct patch for
    C4/Circulation.pm
    
    - Somehow I'd never noticed this before but the columns in smart-rules.tt
    were misaligned when UnseenRenewals was turned off. This was due to the
    display of a <td> not being conditional when it should have been. This
    is now fixed.
    
    - This commit also fixes items 1 & 2 descibed by Katrin in comment #74 ->
    comment #76.
    
    - Fixed missing check for too_unseen in opac-user.tt, this test did used
    to exist but got lost during sizeable rebase a few weeks ago :-(
    - Added test for too_unseen to all AUTO_RENEWAL notice templates apart
    from de-DE (as previously requested by Katrin)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e429d90fb3065a7c7c4bd6951ffb9d47135aa5ce
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Oct 5 12:37:01 2020 +0100

    Bug 24083: (follow-up) Include SelfCheckInModule
    
    As highlighted by Katrin, the selfcheckin module was not aware of this
    work. This commits gives it awareness of the too_unseen renew error and
    the "seen" argument that can be passed to AddRenewal
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbfdc72303a2ebd5130c39c743a2d0040b2c0e2c
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Nov 5 10:41:56 2020 +0000

    Bug 24083: (follow-up) Respond to QA feedback
    
    This patch implements changes requested by Katrin in QA feedback
    (comment #38):
    
    - Fix QA script failures
    - Fix alter table column order mismatch
    - Use new convention for JS strings
    - Fix terminology
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b80d3ba6532dd0ae911ff4a7ce5f266f30dc6f8
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Mar 9 16:04:46 2020 +0000

    Bug 24083: (follow-up) Fix params to AddRenewal
    
    The merging of Bug 23051 has added a paramter that can be passed to
    C4::AddRenewal. This bug does also, so the offset of this bug's new
    paramter was wrong. This patch fixes it.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2110746d44861c55714e8bb68ab665247b6cbd8
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Nov 28 09:04:38 2019 +0000

    Bug 24083: Add unit tests
    
    This patch adds unit tests for unseen renewals
    
    Signed-off-by: Sally Healey <sally.Healey@cheshirewestandchester.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8595e80b7858c7eeb7b11a1dd33f338fce12791c
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Nov 22 11:08:53 2019 +0000

    Bug 24083: Add support for unseen_renewals
    
    This patch adds support for unseen renewals.
    
    Here we retrofit knowledge of unseen renewals and add the display of unseen
    renewal counts and warnings, in addition to adding the ability to
    specify a renewal as being "unseen".
    
    The functionality added here is goverened by the UnseenRenewals syspref.
    
    Signed-off-by: Sally Healey <sally.Healey@cheshirewestandchester.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d67b2b5d46cef3dc221c05431a5ce5f7d2563cf1
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Nov 21 14:37:05 2019 +0000

    Bug 24083: Add circ rules management
    
    This patch adds the ability to set the "Unseen renewals allowed" value
    in the circulation rules
    
    Signed-off-by: Sally Healey <sally.Healey@cheshirewestandchester.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07bc35615649f466674ce2e6f2534d47926b02e8
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Nov 21 14:35:41 2019 +0000

    Bug 24083: Required atomic updates & DB update
    
    This patch adds:
    
    - An "UnseenRenewals" circulation syspref that enables/disables the
      functionality added in this bug
    
    - Add unseen_renewals_allowed to circulation_rules
    
    - A change to the issues & old_issues table schemas and corresponding
      database upgrades to add issues.unseen_renewals &
      old_issues.unseen_renewals
    
    Signed-off-by: Sally Healey <sally.Healey@cheshirewestandchester.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc465736cd14a860ffbda1571012fe94fb1e65fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 14:11:10 2020 +0100

    Bug 26987: (bug 23463 follow-up) Fix serial receipt if makePreviousSerialAvailable
    
    $serialitem is not a Koha::Item there, we need to fetch the item before.
    
    Test plan:
    Turn makePreviousSerialAvailable on
    Create a subscription
    Receive an serial item, mark it "arrived"
    Without this patch Koha explodes with
    No property notforloan for Koha::Serial::Item at /usr/share/perl5/Exception/Class/Base.pm line 88
    Koha::Object::set('Koha::Serial::Item=HASH(0x55dd67c75700)', 'HASH(0x55dd672cec30)') called at /kohadevbox/koha/serials/serials-edit.pl line 273
    
    With this patch applied the notforloan and itype values are correctly
    set for the new serial item.
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6adc4514c69a5fa95ff54caf73d2542e97769863
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 14:38:12 2020 +0000

    Bug 23019: DBRev 20.06.00.068
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6853a2d7f6bf8795b204beeeaa65a8eb61f09308
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Nov 10 13:59:01 2020 -0300

    Bug 23019: (follow-up) Fix test permissions and API definition bugs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa36a4c22f81d2d20fb862baf09cd4121f82afb2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 9 14:46:49 2020 +0100

    Bug 23019: (follow-up 2) set table name to import_batch_profiles
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f5596afd66b1757092f252a7e9496d125e45315
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Nov 6 14:50:29 2020 -0300

    Bug 23019: (follow-up) Fix other things
    
    This patch:
    * Fixes table name change
    * Adds schema file
    * Changes api parameter name
    * Fixes string escaping
    * Fixes error handling
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d53ae88b617638215c0e2fafd6e3db1d3b8eb40
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Nov 6 14:49:20 2020 -0300

    Bug 23019: (follow-up) set table name to import_batch_profiles
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9721e6775185f956e7c7808cadb81c60a61f8902
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 30 15:34:24 2020 +0000

    Bug 23019: (QA follow-up) fix test fiule permissions
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0001155429a7c163d697d8950a139f14644ef940
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Aug 27 19:09:05 2020 -0300

    Bug 23019: (follow-up) Fix usability issues
    
    This patch place profile buttons in the bottom of the page, next to "Stage for import"
    
    It removes the "Update profile" button, and changes "Add profile" to "Save profile". Save profile can be used to add and to update a profile.
    
    It also adds feedback when a profile was saved or deleted.
    
    Last, it also replaces input-batch-profile endpoint name for input_batch_profile, which is more aligned with other endpoint names.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2bf1d0f1d21e7228904c0bb00f2c1388fb1a3df2
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Jul 1 07:25:14 2020 +0000

    Bug 23019: (QA follow-up) Fix typo Pre fill
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b3a1085587d3275a95a5a1a4a84591e6f3ed034
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri May 15 11:09:49 2020 -0300

    Bug 23019: Add profiles to stage-import-batch and magnage-import-batch pages
    
    This patch adds the logic and the needed UI elements to be able to pre-load an import profile. It also displays which profile was used to stage an import in staged import manager.
    
    To test:
    1. Apply all patches
    2. Updatedatabase
    3. Go to Stage MARC records for Import tool in admin, and upload a file with MARC records.
    CHECK => after uploading, there is a fieldset with the legend “Profile settings”
                  => inside the fieldset there is a select labeled “Pre fill values with profile”. The only value it has is “Do not use profile”.
    
    4. Change some settings, and set “profile 1” as profile name and click on “Add profile”
    SUCCESS => The select now has the new profile selected
    
    5. Change profile select to “Do not use profile”
    SUCCESS => Default values are now displayed in the form
    
    6. Reload the page and upload the file again
    SUCCESS => the select still has the profile recently added
    
    7. Select the profile, change some parameter in the form and set the profile name to “profile 2”, and click add profile
    SUCCESS => there are two profiles now, and if you toggle between them, the parameter changes
    
    8. Select profile 1, change one parameter and click on update profile
    SUCCESS => if you toggle that profile with the other, the new parameter of the value is shown when you select profile 1
    
    9. Select profile 2, change some parameter and click Add profile (leaving the name as profile 2)
    SUCCESS => the page complains there is another profile with the same name, and asks if you want to replace it.
    
    10. Click on accept
    SUCCESS => profile 2 now has the new value in the parameter
    
    11. Select profile 2 and change the name to profile 1
    SUCCESS => the page complains there is another profile with that name, and asks if you want to replace it
    
    12. Click on accept
    SUCCESS => in profile select there is only one profile called profile 1 that has the values of profile 2
    
    13. Select profile 1 and click remove profile
    SUCCESS => there is no profile in profile select.
    
    14. Create a profile and click on “Stage for import”
    15. Go to Staged MARC management page
    SUCCESS => Improt should have the name of the profile in profile column, and when you click on the file name, there should be the name of the profile in the details.
    
    16. prove t/db_dependent/ImportBatch.t t/db_dependent/api/v1/import_batch_profiles.t
    17. Sign off
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4685b3de0b7433f338a617713fac66562fb3a53c
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri May 15 11:09:56 2020 -0300

    Bug 23019: Add tests
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bff3fb91eb6af3d964936640c08e2ff2d4add94a
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri May 15 11:09:51 2020 -0300

    Bug 23019: Add ImportBatchesProfile schema and set is_boolean to parse_items column
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cbf32886499c26f5da650aea16de5e30a0d0390
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri May 15 11:09:51 2020 -0300

    Bug 23019: Add koha_object_class and koha_objects_class methods to ImportBatch.pm schema
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7d834d2e57144807d43b3fdb7e8a4a42151cc3a
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri May 15 11:09:53 2020 -0300

    Bug 23019: Update database structure and add atomic update
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47f4ae3fe7958c708bf3af887721b829ca8a8182
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 14:38:12 2020 +0000

    Bug 20936: DBRev 20.06.00.067
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d812bf9d276b47d048b81bbe8fab3f4c913e8330
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Nov 10 19:23:49 2020 -0300

    Bug 20936: (follow-up) add biblio and item relation to old holds and set a limit on search holds
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d36793174cf6f9a42f46b1109497bc0bd9bbc57
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 30 17:28:52 2020 +0000

    Bug 20936: (QA follow-up) Use Branches template plugin
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10e23507f5b4c6faf202122e81175ebc033bdee6
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed May 6 19:38:19 2020 -0300

    Bug 20936: Add patron's hold history menu in OPAC
    
    This patch adds patron's hold history in OPAC.
    
    To test:
    1. apply this patch
    2. Find a patron, place several holds and cancel or fulfill them
    3. Go to patron's opac
    CHECK => There is no 'your holds history' option in menu
    4. In admin preferences enable OPACHoldsHistory
    5. Go back to patron's opac
    SUCCESS => There is a 'your holds history' menu option
            => Holds history displays all holds
    6. Change order, and list limit
    SUCCESS => All controls work as expected
    7. Sign off.
    
    Signed-off-by: Todd <tgoatley@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bab8b0fec65e5b12da3545dd021509669fce5c3
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Sun Feb 9 17:53:55 2020 -0300

    Bug 20936: Add OPACHoldsHistory syspref
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff0be50cded5cc2fac175a305dd3554c8463bbe8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 14:38:12 2020 +0000

    Bug 22818: DBRev 20.06.00.066
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 657a1a18b0657a54a9318d374b530e439c0bfbb5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 11 15:35:33 2020 +0100

    Bug 22818: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 046e32bccc8bca83ff558126b2288e5a13c64df3
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Oct 16 17:13:48 2020 +0200

    Bug 22818: (QA follow-up) Add hint to new library ILL email setting
    
    Copies the hints on the other email fields highlighting the existing
    global pref.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 080ef802e2da9ed0fecf6136b1ed8b57f3ad57e8
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Oct 16 17:07:26 2020 +0200

    Bug 22818: (QA follow-up) Add some punctuation and terminology fixes to pref descriptions
    
    Just branch => library and some ending punctuation.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adce91dc250ac711cdeae03d84b07a8e790355f3
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Oct 16 16:51:09 2020 +0200

    Bug 22818: (QA follow-up) Add sample ILL notices to it-IT installer
    
    Run: prove xt/sample_notices.t
    
    de-DE are missing on purpose because of bug 24972.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d193883868b3b223c7167b870a55b85bc1ecfa2e
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Oct 16 15:08:59 2020 +0100

    Bug 22818: (follow-up) Respond to feedback
    
    This commit implements the feedback from Katrin in comment #103 ->
    comment #108:
    
    - Fixed rebase issue mentioned in comment #103
    - Fixed ILL notice display mentioned in comment #106
    - Fixed bug with metadata display, though not the issue that was
    mentioned in comment #107
    - Fixed buttons display mentioned in comment #107, in addition to some
    more buttons suffering the same issue
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit afd13b6a9b2b980872a0dc18d3fcc207f2f2cd3e
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Oct 15 14:57:19 2020 +0100

    Bug 22818: (follow-up) Respond to feedback
    
    This commit fixes this bug, it was broken in a number of ways.
    
    Fixes include:
    
    - Added necessary config block in C4::Letters to enable the TT notice
    syntax introduced in an earlier commit to work
    - Changed template variables to refer to singular objects rather than
    multiple e.g. borrowers -> borrower
    - Fixed missing / misnamed variables
    
    This commit also implements the additional syspref checks suggested by
    Katrin in comment #87
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30af45ccf126979c0bddcc69992b7e33516dfea0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 16 14:57:36 2020 +0100

    Bug 22818: (QA follow-up) Add mandatory data at install time
    
    This patch adds the data from the update script into the mandatory sql
    files such that it is also populated at install time.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccdba691ff9685a252e44a4f6e9371b97e51b518
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 9 11:18:26 2020 +0100

    Bug 22818: (QA follow-up) Sample Notices
    
    Convert the update notices to TT syntax and add them into the
    sample_notices file.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14986fce53b8bfa6fe3d597f6c255ca742ef17c5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 9 10:25:26 2020 +0100

    Bug 22818: (QA follow-up) Translation fix + Branch notices
    
    This patch removes the hard coded 'N/A' being passed to
    GetPreparedLetter and passes in the branchcode of the ILLRequest so
    notices can be branch specific.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51d73f839381144aac32f11d10d2971e3d558918
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 9 09:42:20 2020 +0100

    Bug 22818: (QA follow-up) Template CASE correction
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c87ed242098a60881ef1b3777bd0d4e3307e0771
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 9 09:14:57 2020 +0100

    Bug 22818: (QA follow-up) Licence and POD fixes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78d2b65313ad188756983ea46a8f57cf4e7804db
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 9 08:40:22 2020 +0100

    Bug 22818: (QA follow-up) Email addressing corrections
    
    This patch updates the patchset to use recnetly introduced methods for
    obtaining the correct inbound and reply email addresses for branches.
    
    We also move get_staff_to_address into Koha::Library alongside
    inbound_email_address and rename it to inbound_ill_address.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed7e74307edaa767ce283b59467a982fa420bf4a
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu May 9 15:35:07 2019 +0100

    Bug 22818: Unit tests
    
    This patch adds unit tests for the new methods in Illrequest.pm
    
    Sponsored-by: PTFS Europe
    Signed-off-by: Niamh Walker-Headon <Niamh.Walker-Headon@it-tallaght.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2baa9a1b5a844cc3f45df2cce273d3ddb92c0bc9
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu May 9 12:21:27 2019 +0100

    Bug 22818: Add MessageAttribut{e,es}.pm
    
    We need to be able to access individual message attributes in tests, so
    adding accessors for them
    
    Sponsored-by: PTFS Europe
    Signed-off-by: Niamh Walker-Headon <Niamh.Walker-Headon@it-tallaght.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a7f09709abc1d89f9ff0b6ccd160c55eb139449
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed May 8 10:42:22 2019 +0100

    Bug 22818: Add generation and sending of notices
    
    This patch adds the ability for ILL to send notices, both triggered by
    staff and triggered by events.
    
    Staff can trigger notices to patrons from the "Manage ILL request" screen:
    - ILL request ready for pickup
    - ILL request unavailable
    - Place request with partners
    
    The following notices to staff are triggered automatically:
    - Request has been modified by patron
    - Request has been cancelled by patron
    
    Branches can now specify an "ILL email" address to which notices
    intended to inform staff of changes to requests by patrons can be sent.
    
    The sending of notices is controlled by a few new sysprefs:
    - "ILLDefaultStaffEmail" - Fallback email address for staff ILL notices
    to be sent to in the absence of a branch address
    - "ILLSendStaffNotices" - To specify which staff notices should be sent
    automatically when requests are manipulated by patrons
    
    Patron notices are also controlled by the patron's messaging
    preferences
    
    Sponsored-by: PTFS Europe
    Signed-off-by: Niamh Walker-Headon <Niamh.Walker-Headon@it-tallaght.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef07ad1044e172e3b0079025ad9ea04fb074f9e0
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue May 7 17:37:02 2019 +0100

    Bug 22818: Add support for ILL notices
    
    Here we're just adding ILL notices to the existing "letters"
    infrastructure so notices can be displayed and edited
    
    Sponsored-by: PTFS Europe
    Signed-off-by: Niamh Walker-Headon <Niamh.Walker-Headon@it-tallaght.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51895cd7fb5ac56d8e4a2ffb78ba2efccec3d83f
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue May 7 11:09:58 2019 +0100

    Bug 22818: Add notices sysprefs and DB column
    
    This patch adds two new sysprefs. 'ILLDefaultEmail', 'ILLSendStaffNotices' and a new column to the
    branches table called 'branchillemail'. It also adds five ILL related
    notices.
    
    Here we are providing the ability for a branch to have a dedicated email
    address for it's ILL staff, the idea being that any notices sent by ILL
    to staff need to go to specific staff, rather than the general branch
    email address. If no branch specific address is defined, the address
    specified in the ILLDefaultEmail syspref is used.
    
    We're also providing a syspref 'ILLSendStaffNotices' to allow the user to specify which
    notices should be sent to staff upon certain events.
    
    We are also providing patron messaging preferences for the two patron
    bound notices
    
    We are also providing five notices for various ILL related events.
    
    Sponsored-by: PTFS Europe
    Signed-off-by: Niamh Walker-Headon <Niamh.Walker-Headon@it-tallaght.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8206ca60cb1bbd32a90b7898a6877166026b8bb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Nov 5 06:48:04 2020 -0500

    Bug 26594: (QA follow-up) Make _UpdateBorrowerDebarmentFlags a public method
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd66a2e175e062b662652f81efcafb48b6d230d7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Oct 1 14:19:05 2020 +0200

    Bug 26594: Fix patrons merge problem with restrictions
    
    When merging a patron A with restriction(s) into an other patron B,
    the entries of borrower_debarments are OK but the value of borrowers.debarred for patron B need to be updated.
    An effect of this strange storage of restrictions in both places.
    
    Test plan :
    1) Create a patron A with a manual restriction with some date and
       comment
    2) Create a patron B with no restriction
    3) Merge patron A and B, keeping patron B
    4) Look at patron B details page
    => Without patch you see no restriction
    => With patch you see the restriction from patron A
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5ba5f406899c554ccc71212cbee5531b91c3f41
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Oct 2 09:22:36 2020 +0200

    Bug 26594: add Unit Test
    
    Run prove t/db_dependent/Patron/Borrower_Debarments.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df9b697cd4a24dce2a385ba34e8c98ff4135d527
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 13:32:09 2020 +0000

    Bug 23916: DBRev 20.06.00.065
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e00d07fe793e3bdc383c5a9963427a39a735b1f3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 10 08:53:16 2020 -0300

    Bug 23916: Allow embedding the issuer object
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8dd313fc4ab40843210eaa32454e306cbbc20bba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 14:45:57 2020 +0100

    Bug 23916: (follow-up) Adapt all the things to the new column and accessor names
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61a39b0dd52df4f6d743671823449e265d6add26
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 10 08:47:29 2020 -0300

    Bug 23916: (QA follow-up) Adapt all the things to the new column and accessor names
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b854e285f1b77b62bb8b9e28c5b532e1c4dead94
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 10 08:46:43 2020 -0300

    Bug 23916: Add new attribute to API
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aebf7f2756c585512576ea5dc3ff03f17ba1610a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 10 08:46:18 2020 -0300

    Bug 23916: (QA follow-up) Rename issuer => issuer_id [DB]
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2de7a4c04e4924ee316623f8ab89be8e16461ee4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 9 14:24:22 2020 +0100

    Bug 23916: (follow-up) Add unit tests
    
    Fix perlcritic error
    Subroutine "new" called using indirect syntax at line 128, column 14.  See page 349 of PBP.  (Severity: 4)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c388b88c4e6638d545dd0c99574107f9af7477a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 24 02:56:15 2020 +0000

    Bug 23916: (QA follow-up) Remove stray changes and fix typo
    
    There were a couple changes that had no effect, so cleaned those up
    
    Typo 'is' for 'if'
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27d64e1720f79d95013de80278fcd71fbf765c04
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Oct 23 11:55:44 2020 +0100

    Bug 23916: (follow-up) Fix unit test
    
    This commit responds to the comment made by Katrin in comment #73. I
    have removed the lines cited as causing the contraint violation. The
    were added in the original iteration of the bug patches and, despite
    spending time trying to get to the bottom of it, I cannot figure out
    why. There are no changes in the patchset relating to Koha/Patron.pm and
    removing the lines does not cause any of the tests in files that *are*
    affected by this patchset to fail. I do not know why these lines were
    ever added in the first place, unfortunately I did not add comments
    explaining (lesson learned)!
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4defe532df94d515c850423c2f9b0a18c9dfdbae
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Oct 19 12:55:18 2020 +0100

    Bug 23916: (follow-up) Rebase unit tests
    
    This commit is a response to Katrin's comments in comment #62:
    
    - Fixed merge conflict
    
    It also fixes a test which now fails due to an upstream change in
    C4::Circulation
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55ac67d95b6b4cd2459385a7aae2e24de410925a
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Oct 12 10:28:33 2020 +0100

    Bug 23916: (follow-up) Fix terminology, use patron-title and make column consistent in issues and old_issues
    
    This commit makes the changes suggested by Katrin in comment #50:
    
    - Changed syspref from RecordIssuer to RecordStaffUserOnCheckout
    - Changed terminology from "issue" to "check out" and variations
    - Fixed name display to use patron-title.inc
    - Made issuer column DEFAULT NULL consistently between issues and
    old_issues and between the DB update and kohastructure.sql
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 838be5e5168e96f1c0f212019af4909abb42f5c2
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Sep 24 13:55:55 2020 +0100

    Bug 23916: (follow-up) Don't anonymise issuer and don't update action_logs on upgrade
    
    This commit implements the two suggestions made by Nick in comment #41:
    
    - Removes the attempted retrospective addition of issuers to old issues.
    It was not particularly reliable, it also is not appropriate if the user
    does not wish to make use of this functionality
    
    - Removes the conversion of a NULL issuer to the anonymous borrowernumber when
    anonymising checkouts
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87e305a401d778f1d28bc74086d050ea8f42f7a2
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Nov 18 12:30:27 2019 +0000

    Bug 23916: (follow-up) Fix column name collision
    
    Seems that joining 'borrowers' into the query run in
    C4::Members::GetAllIssues caused a column name collision, which blatted
    the retrieval of issues.branchcode. So we now are being a bit more
    specific in what is coming from where in the query.
    
    Signed-off-by: Ben Veasey <B.T.Veasey@lboro.ac.uk>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b676dd376bd3695db1581d0ad4a883b5ac286f1a
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Oct 31 14:26:18 2019 +0000

    Bug 23916: Add unit tests
    
    This patch adds unit tests for the new functions
    
    Signed-off-by: Ben Veasey <B.T.Veasey@lboro.ac.uk>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7587f6c8bfa4e992408cfa16bb835e9edfdc1a3
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Oct 31 10:45:41 2019 +0000

    Bug 23916: Anonymise 'issuer' when required
    
    This patch adds the anonymisation of 'old_issues.issuer' alongside the
    existing anonymisation of 'old_issues.borrowernumber'
    
    Signed-off-by: Ben Veasey <B.T.Veasey@lboro.ac.uk>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb283d13fab70d8a32216a5bee8fb4a71e6d875e
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Mar 2 11:04:59 2020 +0000

    Bug 23916: Record and display item issuer
    
    This patch adds the recording and display of the item issuer. This
    behaviour is governed by the RecordIssuer syspref, if disabled (the
    default), no recording or display of issuer will take place.
    
    Signed-off-by: Ben Veasey <B.T.Veasey@lboro.ac.uk>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d01f78e2d573076df71e0505548193da736b05bd
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Oct 31 10:22:24 2019 +0000

    Bug 23916: Add "RecordIssuer" syspref
    
    This patch adds the "RecordIssuer" syspref, which is disabled by default
    
    Signed-off-by: Ben Veasey <B.T.Veasey@lboro.ac.uk>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b46c1a037809a92c6ee0667dd5e559dc2f743f6a
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu Oct 31 10:08:42 2019 +0000

    Bug 23916: Add issues.issuer column and FK
    
    This patch adds the issues.issuer column which is a foreign key to
    borrowers.borrowernumber
    
    Signed-off-by: Ben Veasey <B.T.Veasey@lboro.ac.uk>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dfa570936db87dfe79fcb0a8830054065efa077
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 16 15:57:30 2020 +0100

    Bug 26697: Make account.inc consistent between staff and opac
    
    Test plan - Regression
    1/ Login to the OPAC as a user with various account charges and payments.
    2/ Navigate to the 'Your charges' page.
    3/ Compare the display of the table before and after applying the
    patchset. They should match.
    
    Test plan - Sync
    1/ Compare koha-tmpl/intranet-tmpl/prog/en/includes/accounts.inc with
    koha-tmpl/opac-tmpl/bootstrap/en/includes/accounts.inc.
    2/ They files should match after the patch is applied.
    
    Test plan - Translation
    1) ./translate update fr-CA
    2) Open fr-CA-opac-bootstrap.po and translated this part
    
    msgid ""
    "%s %s %sPayment %sWriteoff %sForgiven %sCredit %sLost item fee refund "
    "%sRefund %s%s %s %s %s %sAccount creation fee %sAccount renewal fee
    %sLost "
    "item %sManual fee %sNew card %sFine %sLost item processing fee %sRental
    fee "
    "%sDaily rental fee %sRenewal of rental item %sRenewal of daily rental
    item "
    "%sHold fee %sHold waiting too long %s%s %s %s %s "
    
    3) ./translate install fr-CA
    4) Login to the OPAC as a patron with various charges
    5) Check 'My charges' (in fr-CA) to confirm the translations have been
       picked up.
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ad4e7c7c3904ad9e2feec9f6fb0ffb274998491
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 10 13:32:09 2020 +0000

    Bug 24603: DBRev 20.06.00.064
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f1aa37cc5bfd7ec0e3f29ce74657ba62867c45c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 14:40:29 2020 +0100

    Bug 24603: Simplify tests using TestBuilder
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 381d46341c7061f649400975a3c5b7a008feba64
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 14:39:53 2020 +0100

    Bug 24603: Adjust permissions for cancel-charge.pl
    
    members/cancel-charge.pl should have the same permissions check than boraccount
    (borrowers => edit_borrowers was missing)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 960d282e3b99ae5f4e7a6522824e0fa1edb394ed
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 16 16:23:10 2020 +0100

    Bug 24603: (QA follow-up) Add translation to OPAC
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9bf00d32489edf78db92139d2d87841b6e970882
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 5 13:24:40 2020 +0000

    Bug 24603: (QA follow-up) Make the new credit type translatable and shorten description a bit
    
    Adding the new offset type and credit type to the include so it can be translated.
    
    Also suggest shortening the db description a bit.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=24063
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c709b871f5f5c2887eefb81a3f93a8ad76fb8d0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 10 14:49:35 2020 +0100

    Bug 24603: (follow-up) Update to double entry accounting
    
    This patch updates the logic to create a cancellation accountline and
    apply it to the charge line so we correction record the transaction in
    terms of double entry accounting standards.
    
    Test plan:
    1. Go to a patron's accounting section
    2. Create a manual invoice
    3. In Transactions tab, you should see a 'Cancel charge' button. Click
       on it. It should now be marked as cancelled
    4. A cancellation line should be associated with the original charge.
    5. Create another manual invoice
    6. Pay it (partially or fully)
    7. Notice that the 'Cancel charge' button is not available
    8. Void the payment
    9. 'Cancel charge' button is available again. Click on it and verify
       that it still works
    10. prove t/db_dependent/Koha/Account/Lines.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=24063
    
    Bug 24603: Fix number of unit tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=24063
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d2259b67443f75675733d41773d153d889dffd7
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Feb 6 14:13:44 2020 +0100

    Bug 24603: Allow to cancel charges in patron accounting
    
    There is already a button to void a payment. It should be possible to
    cancel a charge too.
    
    This patch adds a button in patron's accounting section (Transactions
    tab) that allow to cancel charges.
    Charges that have been fully or partially paid cannot be cancelled.
    
    It also fixes Koha::Account::Line::is_credit by looking at
    credit_type_code instead of amount (amount can be 0 for voided payments)
    
    It also fixes the tests for Koha::Account::Line::void when database does
    not contain the borrowernumber 51 (the default in
    t::lib::Mocks::mock_userenv)
    
    Test plan:
    1. Go to a patron's accounting section
    2. Create a manual invoice
    3. In Transactions tab, you should see a 'Cancel charge' button. Click
       on it. It should now be marked as cancelled
    4. Create another manual invoice
    5. Pay it (partially or fully)
    6. Notice that the 'Cancel charge' button is not available
    7. Void the payment
    8. 'Cancel charge' button is available again. Click on it and verify
       that it still works
    9. prove t/db_dependent/Koha/Account/Lines.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 904e926ba0f407b24aa3d94be5afe37b5e3ec075
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Nov 3 09:19:34 2020 +0100

    Bug 26904: OPAC password recovery allows regexp in email
    
    When using OPAC password recovery form, opac/opac-password-recovery.pl :
    if one provides correct login and an email, there is a check that this email is one of patron's.
    
    This check uses RegExp with case insensitive :
      if ( $email && !( any { /^$email$/i } @emails ) )
    
    This is a security issue since one can simply enter '.*'.
    Severity is normal because the login must be a correct.
    
    I propose to use simple string compare with lowercase to be case insensitive.
    
    Test plan :
    1) Don't apply patch
    2) Enable system preference 'OpacResetPassword'
    3) Go to 'OPAC > Log in to your account > Forgot your password?'
    4) Enter an existing userid or cardnumber and '.*' in 'Email'
    5) The password recovery is created ! (check table 'borrower_password_recovery')
    6) Apply patch
    7) Enter an existing userid or cardnumber and '.*' in 'Email'
    8) You get the message 'No account was found with the provided information.'
    9) Enter an existing userid or cardnumber and in 'Email' the corresponding email but with different case
    10) The password recovery is created (check table 'borrower_password_recovery')
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ad424704fc2ec7c6978fb24c1a292c52d188659
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 9 11:20:43 2020 +0100

    Bug 26971: Remove obsolete test file translatable-templates.t
    
    After bug 25067 we found that this test file is failing with
    
     #   Failed test 'opac_bootstrap templates are translatable'
     #   at xt/author/translatable-templates.t line 91.
     # Unknown action specified.
    
    The original patches forgot to update this file.
    However when we tried to adjust it, we found that those tests are never working.
    
    Tried on 18.11.00 with a very ugly modified intranet-main.tt, the test was still passing.
    
    No idea how we can make it display warnings and so hard to fix the expected behaviour.
    
    I decided to remove it for now and see later if we need an updated test for the translate script.
    
    See also 25067 comment 84
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 629c77b1af4dde6f0dceae1ce7a2d29fa2cf0eee
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 16:27:47 2020 +0000

    Bug 24665: (QA follow-up) Add tests for 'selected'
    
    Add a unit test to prove the 'selected' param passed to
    Koha::Template::Plugin::Registers is adhered to.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee1c4ab7bf0bee9f8244fb3e03de438a56f0a1ba
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 16:19:15 2020 +0000

    Bug 24786: (QA follow-up) Mock UseCashRegister in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5017e4ed6c96b28780126e62b95d60210fd9eec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 17:06:44 2020 +0100

    Bug 25067: Fix perlcritic errors
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47047348baa32646102258cfc92a9f1f77bf3153
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 17:03:33 2020 +0100

    Bug 24786: Fix Script_cron.t and t/Koha/Script.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbbd1695043c221f88b9f718f17b3297a94b1d66
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 16:59:40 2020 +0100

    Bug 25067: Adjust paths in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebb437349ebbadf90599c23a46126e5d8eda72da
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Nov 5 06:40:42 2020 -0500

    Bug 26627: (QA follow-up) Remove barcode input by id
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76c95e585d7470905701ee469b1042474fce0604
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 12:03:17 2020 +0000

    Bug 14866: DBRev 20.06.00.063
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 234768752fd7448fcafe69d54772507c3492a6c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 3 16:57:52 2020 +0100

    Bug 14866: Trivial code simplification
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1bc1015d9b61b4e9b67fd751e05275548d59f46
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Oct 22 12:15:51 2020 +0000

    Bug 14866: (QA follow-up) Add hint to system preferences
    
    Adds a hint about the new configuration option to the existing
    system preference sectoin.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1deb47e793b6b3c146839e9d5fc29ff535fd13a2
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Apr 20 14:31:27 2020 +0000

    Bug 14866: Make high holds work with different item types
    
    To test:
    1) Apply patch, update database, restart services
    2) Enable decreaseLoanHighHolds sysprefs if not already active
    3) Go to circulation rules and set a value under 'Decrease loan holds
    (day)' that is DIFFERENT from decreaseLoanHighHoldsDuration
    4) Check out an item with holds and confirm that the value from the rule
    is used instead of the system preference
    5) Confirm tests pass before and after the patch
    t/db_dependent/DecreaseLoanHighHolds.t
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bd02f991942e307a8603304ffd29d8eb42343c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 12:03:17 2020 +0000

    Bug 23091: DBRev 20.06.00.062
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 671b013961037ab535693c2edce2eabb0fe0f128
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Oct 19 08:47:50 2020 -0300

    Bug 23091: (QA follow-up) POD fixes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1527fbd4ae3131611957a8d320f0890396b3d27f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 16 16:51:07 2020 -0300

    Bug 23091: Simplify tests by turning off AccountAutoReconcile
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d93405e599a4840f75a9a0fde8884f4f14ff4d9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 16 16:30:49 2020 -0300

    Bug 23091: Add tests for \->credits and \->debits
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c6faea274318fd96311d91db28421f3886cb2db
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jul 15 11:23:38 2020 +0100

    Bug 23091: Unit Tests
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d643bf75a032fddc4d7cefb8489182ae13b899a5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 3 17:12:47 2020 +0100

    Bug 23091: Move _Restore to Koha::Item store trigger
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1008e21d430177ebf41f6a22ba29299228dba949
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 5 09:19:48 2020 +0100

    Bug 23091: Add template handling for new messages
    
    This patch adds handling for the display of the two new messages added
    by this patchset in the returns screen.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b59799f298aab7b04547bcd7c29a2777e015a106
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 14 13:59:06 2020 +0100

    Bug 23091: Make relations more explicit
    
    This patch simply makes the queries built for the ->debits and ->credits
    relations in Koha::Account::Line more explicit.
    
    Test plan
    1/ Ensure tests continue to pass
    2/ Run tests with DBIC_TRACE=1 DBIC_TRACE_PROFILE=console and note that
    the related queries not include 'credit.' and 'debit.' as appropriate.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7d4bacfc67af5eaae7c477b2ac71753c76778ce
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 13 15:51:24 2020 +0100

    Bug 23091: Add tests for _RestoreOverdueForLostAndFound
    
    This patch adds unit tests for the newly introduced
    _RestoreOverdueForLostAndFound method in C4::Circulation.
    
    Test plan
    1/ Read the new tests added to t/db_dependent/Circuation.t to ensure
    they make sense
    2/ Run the tests and verify they pass
    3/ Signoff
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a07e111288de820e535dd35c024917d141129ad
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 23 11:32:28 2019 +0100

    Bug 23091: Add handling for new lostreturn rules
    
    This patch adds handing for the new values available for the lostreturn
    policy settings.
    
    * undef - Do nothing, leave fees and fines as they were at the point of
      lose.
    * refund - Refund the lost item fee only
    * charge - Refund the lost item fee and charge a fresh overdue fine
      dated for a return on the date the item is 'found'
    * restore - Refund the lost item fee and restore the original overdue
      fine (dated for a 'return' on the date the item was 'lost'
    
    Test plan
    1/ apply patch
    2/ updatedatabase, restart_all
    3/ verify finesmode and CalculateFinesOnReturn and WhenLostChargeReplacementFee are on
    4/ verify WhenLostForgiveFine is set to "Forgive"
    5/ verify circ rules include fines
    6/ set Default lost item fee refund on return policy to "Refund lost item charge"
    7/ create 4 overdue checkouts that will incur fines
    8/ run fines.pl
    9/ confirm 4 items checked out with accruing fines
    10/ confirm all 4 items have a replacement price
    
    Item 1
    11/ mark the first item lost
    12/ verify that fine is gone and lost fee has been charged
    13/ check item in
    14/ verify that lost fee is gone and overdue charge has not returned
    
    Item 2
    15/ set Default lost item fee refund on return policy to "Refund lost item charge and charge new overdue fine"
    16/ mark second item lost
    17/ verify that fine is gone and lost fee has been charged
    18/ check item in
    19/ verify that lost fee is gone and a new overdue charge has been made
    
    Item 3
    20/ set Default lost item fee refund on return policy to "Refund lost item charge and restore overdue fine"
    21/ mark third item lost
    22/ verify that fine is gone and lost fee has been charged
    23/ check item in
    24/ verify that lost fee is gone and the old overdue charge has been restored
    
    Item 4
    25/ set Default lost item fee refund on return policy to "Leave lost item charge"
    26/ mark fourth item lost
    27/ verify that fine is gone and lost fee has been charged
    28/ check item in
    29/ verify that lost fee remains and the overdue charge is still gone
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed0df15f5094c5cf5462488fd0aac48ddd613b35
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 3 16:25:31 2020 +0100

    Bug 23091: Update unit test
    
    This patch updates the unit test for get_lostreturn_policy to reflect
    the rule_name and return code changes.
    
    Test plan:
    1/ Read the code changes in t/db_dependant/Koha/CirculationRules and
    t/db_dependant/Koha/IssuingRules and confirm they make sense.
    2/ Run the updated tests and ensure they pass.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f7d2e327cb8631e2f1099a2169f439acc42da94
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 3 16:01:39 2020 +0100

    Bug 23091: Database update
    
    This patch updates the 'refund' circulation rule to be called
    'lostreturn' and populates the value with 'refund' where appropriate.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0830466c120ba9e0551cc40995b94e3c16ac7a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 12:03:17 2020 +0000

    Bug 24412: DBRev 20.06.00.061
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a008ad788c9a551c689ea616ac6191e409098284
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 12:01:11 2020 +0100

    Bug 24412: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f806ae6277e95048851b32ecc70772e1793a5d43
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Thu Nov 5 14:52:02 2020 +0100

    Bug 24412: (follow-up) prevent js injection
    
    Some js variables are not properly escaped and can be executed if
    containing javascript.
    
    1. have some waiting reserve attached to a desk
    2. change this desk name to : <script>alert("❤");</script>
    3. go to user's checkout page (circulation.pl) and click on the
    Hold(s) tab
    4. you should see some popup with a ❤ in it.
    5. apply patch and refresh page
    6. now you should see the desk name printed properly in the page:
    <script>alert("❤");</script>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3de906ac139852793ea06a41d7af284d6059e7bf
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Thu Nov 5 14:10:09 2020 +0100

    Bug 24412: (follow-up) prevent request.pl from failing
    
    When no desk is defined request.pl returns an internal server
    error. Check a desk is defined before asking for reservation deskname.
    
    Plan test:
    
    1. log in with a library with no desk
    2. check in a reserved book so it'll be switch to “waiting reserve”
    3. go to the book notice and click the Holds tab (request.pl page)
    4. boum
    5. apply patch, restart plack
    6. refresh page
    7. now loading properly
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 351eb6c26d68342d8dc20fb8f68b7e28ba007820
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 23 15:46:03 2020 +0100

    Bug 24412: (QA follow-up) Change CASCADE DELETE to SET NULL
    
    I don't believe waiting reserves should be removed if a desk is deleted,
    we should instead simply unset the desk.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66205054352cde0f597ff4236e0d95c34ebc8519
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Thu Oct 22 18:17:47 2020 +0200

    Bug 24412: (follow-up) prevent error in svc/holds
    
    don't fail if a hold has no desk attached.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef8357437423e2b830af955b477be22ddb208d1c
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Thu Oct 22 13:31:15 2020 +0200

    Bug 24412: (follow-up) bad desk printing
    
    forgot to update two pages when I wrote Hold->desk to replace
    Desks.GetName.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22029a296bb6f2581fead171cf98f4410ef4acb2
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Wed Oct 21 13:29:00 2020 +0200

    Bug 24412: (follow-up) qa-tools
    
    fix obvious problems:
    
        1. qa -c 8 -v 2
        2. should be green
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37f410a436ffc11a147f18e65911e9e2b17298aa
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Wed Oct 21 12:10:19 2020 +0200

    Bug 24412: (follow-up) tests
    
    Add some test for Koha::Hold->desk and Koha::Hold->set_waiting.
    
    Test plan:
    
        1. prove t/db_dependent/Koha/Holds.t
        2. should be green!
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47b32572d4d9c3195cf52ba02f1b6f845173c173
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Mon Jan 13 17:56:41 2020 +0100

    Bug 24412: Attach waiting reserve to desk
    
    When an item is checked in and marked 'Waiting' or already 'Waiting'
    and there is a desk attached to the session, the item is marked
    waiting at the current desk of the current library.
    
    The information is displayed on the OPAC and on the intranet. The
    patron can then know at which desk he can retrieve his document.
    
    Desk Management (Bug 13881) is now useful.
    
    Test plan :
    
    1. apply Bug 24201
    2. $KOHA_PATH/installer/data/mysql/updatedatabase.pl
    3. Check out some document to someone
    4. make another one reserve this document
    5. check in the document
    6. you can see the document is attach to the current library
    7. create some desks and attach one to your session (see Bug 13881 and
    Bug 24201)
    8. cancel the preceding reserve and redo steps 3 to 5
    9. you should see the document is waiting at the current library and
    current desk on:
      a. the intranet document request page
      b. the intranet borrower holds tab
      c. the item list where the document is listed on the bibliographic
        details
      d. the borrower's OPAC holds tab.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 24412: (follow-up) QA
    
    Following Josef Moravec QA comments :
    
    - rewrite Koha::Hold->desk according to Object Oriented Koha
    Guidelines and use it to fetch desk name in various templates
    - remove unused Desks.GetName
    - Check for columns existence in db update
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 24412: (follow-up) QA: useless change
    
    Maybe it was a relic of something usefull... anyway
    not anymore.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 24412: (follow-up) Fix POD
    
    Koha::Desk and not Koha::Library...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d87090f3bb6d8761a485e35bbf4488339b84f6c1
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Mon Jan 13 17:55:46 2020 +0100

    Bug 24412: kohastructure and atomic update
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 017036f695df46df1fe3c2106b96b6285b0b9e83
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 20 14:36:22 2020 -0300

    Bug 24633: (follow-up) Tweak sample plugin targets
    
    Sponsored-by: Theke Solutions
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df2a7e4aa200ea9648d993241e75ef27e12fa103
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 20 14:29:38 2020 -0300

    Bug 24633: Add support for gitlab searching of plugins
    
    This patch adds the option to add Gitlab repositories to look for
    Koha plugins. As with Github, plugin projects need to be named
    koha-plugin-* and the release file needs to be named with the .kpz
    extension.
    
    To test:
    1. Apply this patchset
    2. Check either koha-conf.xml or koha-conf.site.xml.in for sample
       configurations of gitlab targets.
    3. Tweak your koha-conf.xml accordingly. You could have:
    
     <plugin_repos>
         <repo>
             <name>ByWater Solutions</name>
             <org_name>bywatersolutions</org_name>
             <service>github</service>
         </repo-
         <repo>
             <name>Theke Solutions</name>
             <org_name>thekesolutions</org_name>
             <service>gitlab</service>
         </repo>
         <repo>
             <name>PTFS Europe</name>
             <org_name>ptfs-europe</org_name>
             <service>github</service>
         </repo>
      </plugin_repos>
    
    4. Flush memcached and restart plack:
       $ flush_memcached
       $ koha-plack --restart kohadev
    5. Open the plugins page, search for anything, like 'gobi' or 'a'
    => SUCCESS: You get Theke results!
    6. Pick a gitlab plugin for install
    => SUCCESS: It is installed!
    7. Sign off :-D
    
    Sponsored-by: Theke Solutions
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7dd0d62ddf324a6f54dd3c6f7cb6babcd61ad2d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 12:48:28 2020 +0000

    Bug 24665: (QA follow-up) Fix selection default
    
    This patch updates the html_helper for the cash register selection block
    to remove the 'empty option' such that it can be correclty set for each
    select case and updates all existing cases where we used the process
    block previously to include the relevant blank option '-- Select an
    option --', '-- None --', 'Library default' and finally the new '-- All
    --' options introduced with this bug.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5162d9135876227745f7e91fbd6fd9a61879a64
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 14:54:09 2020 +0100

    Bug 24665: Add support for filtering by cash register
    
    This patch makes it possible to filter on cash register
    on the cash register statistics page.
    
    To test:
    - Activate UseCashRegisters
    - Create a cash register or more to use
    - Create some manual fees and fines
    - Pay some of them off
    - Go to Tools > Cash register statistics
    - Test if the new filter for cash registers works as it should
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89b0a0563ca77f82e2915390b55d9f94fed71e68
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 14:42:42 2020 +0000

    Bug 24786: (QA follow-up) Ensure tests pass with existing data
    
    The tests for Koha::Template::Plugin::Registers assumed that no
    registers were pre-set in the database. This patch updates the test to
    ignore pre-existing data or take it into account in totals.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47731f187f32d889ea45a2c2d567d67189d4753a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 14:04:49 2020 +0000

    Bug 24786: (QA follow-up) Reset beenSubmitted on validation failure
    
    When the form submision fails due to validation errors we need to also
    reset the preventFormDoubleSubmit state to allow for a second submission
    with corrected form fields.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7030fc0e1eea06f783fc98bfa95fb5c655143ae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 11:51:30 2020 +0000

    Bug 24786: (QA follow-up) Do not use 'hidden' attribute
    
    The hidden attribute for loading an element hidden is known to have
    issues and inconsistencies accross browsers.
    
    This patch instead updates the relevent input options to use an inline
    style of 'display: none' to hide the elements on page load and then
    .show, .hide for subsquent changes linked to the library branch picker
    change.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 349591b3a4ee9620f4f4f337173efd84ab3227cf
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 10:55:13 2020 +0000

    Bug 24786: (QA follow-up) Hide archived registers
    
    This patch hides archived registers from the list when useing the
    Registers template plugin.  It also includes a check for
    UseCashRegisters so that if the preference is disabled after some
    registers have been defined then the plugin will no longer return the
    list regardless.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3865e38ebbb945ae8b7943d301a119da0e28b5c9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 6 10:53:56 2020 +0000

    Bug 24786: (QA follow-up) Handle no defined registers
    
    This patch hides the register selection option from the login page if no
    registers have yet been defined on the system.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 858c8943b7c3760fa7677077668c7d104dd5f9bc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 4 12:53:59 2020 +0000

    Bug 24786: (QA follow-up) Remove trailing space in classes
    
    The trailing space after branch in the class attribute for the register
    select options cause issues in the 'hasClass' javascript selector
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27c6399fb0fd3bd394cc010d31dc44f57dff79ee
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 4 11:52:06 2020 +0000

    Bug 24786: (QA follow-up) String fix
    
    This patch updates 'Branch default' to 'Library default' on the login
    page to match the coding terminology guidelines.
    
    We also update the table heading on the cash registers management page
    to match the terminology above for clarity.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c551b0719d40159fc145f56308eb368dea6f2acf
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 15 17:03:04 2020 +0100

    Bug 24786: (QA follow-up) Unit tests for Registers plugin
    
    To test:
    1. Run the new unit test: t/db_dependent/Koha/Template/Plugin/Registers.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5e3f431e77be4d80405aedd2ca36c23a4e4c413
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 15 13:41:16 2020 +0100

    Bug 24786: (QA follow-up) Add validation to paycollect
    
    This patch adds conditional validation to the cash register field on
    paycollect such that if 'CASH' is selected as the payment type and cash
    registers are enabled, then a cash register will be required.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 085e5739db71e782fe5a848e0e2585c0f3c52f56
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 13:42:32 2020 +0100

    Bug 24786: (QA follow-up) Fix Registers Plugin
    
    For the QA script we do not set a userenv, so we result in a failure due
    to a lack of checking for userenv prior to using it.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66444caeebfe1939edb1e886373fd38b360b9335
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 13:08:45 2020 +0100

    Bug 24786: (QA follow-up) Make QA script happy with html_helpers
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e9b6e0e2aab88da4930e7cc35d0bec9c0c59f77
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 13:01:38 2020 +0100

    Bug 24786: (QA follow-up) POD Fixes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c153adac098096ce3fa491a4d7b7a419ffc9f960
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 2 10:19:14 2020 +0100

    Bug 24786: Add validation to point of sale
    
    The Point of Sale page relied upon serverside validation prior to this
    patch; As such with the introduction of the ability to select '--None--'
    at the session register level (to require the librarian to pick their
    register for every transaction) we could result in a server error page.
    
    This patch introduced clientside validation to add checks for both the
    'collected' and 'registerid' form fields.
    
    Test plan:
    1/ Select a branch with cash registers available
    2/ Select the '--None--' option for the session cash register
    3/ Navigate to the point of sale page
    4/ Attempt to make a sale without having picked your cash register
    5/ Note that the submission was prevented and the fiedl is highlighted
    as required in red.
    6/ Signoff
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ece86e769e4876f19df8e8a22c2d0774c55aed2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 11 14:24:19 2020 +0100

    Bug 24786: Default to 'branch default' on auth.
    
    If no branch is selected (i.e. 'My library') then we should default to
    'branch default' if one is defined for the users library at login.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bc723b33c1b3cb6baa67c277fe3ce64779fede1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 4 13:27:06 2020 +0100

    Bug 24786: (follow-up) Cache the register_name in the session
    
    This leads to one DB hit less per page load in the staff client when
    cash registers are enabled.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 114e851f8f3b3dd7c7d0fca627d3c0a4ff655302
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 10:52:49 2020 +0100

    Bug 24786: Update borroaccount to use session register
    
    This patch adds handling to allow for the use of the session cash
    register by default if it has been set, otherwise it defaults to '--
    None --' and requires the end user to select the register to proceed
    with the refund or payout action.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24804aa4c61de8044e3666d7c3d010f65ecaf493
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 10:30:09 2020 +0100

    Bug 24786: Update paycollect to use session register
    
    This patch adds handling to allow for the use of the session cash
    register by default if it has been set, otherwise it defaults to '--
    None --' and requires the end user to select the register to proceed
    with the payment.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 086927c9766faedce0dd73a5cd5a180000da2056
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 13:08:18 2020 +0100

    Bug 24786: Update point of sale to use session register
    
    This patch adds handling to allow for the use of the session cash
    register by default if it has been set, otherwise it defaults to '--
    None --' and requires the end user to select the register to proceed
    with the sale.
    
    Test plan
    1/ Enable cash registers via the 'UseCashRegisters' system preference
    2/ Enable point of sale via the 'EnablePointOfSale' system preference
    3/ Navigate to the point of sale page
    4/ Note that if you are logged in at a branch with no cash registers yet
    defined, then an alert should appear
    5/ Note that when you are logged in at a branch with cash regsiters
    defined, but without a cash register associated with your session then
    the cash 'Cash register' select box is populated with '-- None --' and
    you are required to select a register prior to submission
    6/ Note that upon selection, the '-- None --' option is disabled
    7/ Note that when you have a register associated with your session then
    the 'Cash register' select box is pre-populated with that register.
    8/ Signoff
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30b23c5f1df45ab2ffadc94494021b1189e75e13
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 13:37:16 2020 +0100

    Bug 24786: Allow selection of cash register at login
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b1934312b87f8458de84d96421106774dbd95a8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 20 16:14:17 2020 +0100

    Bug 24786: Allow setting a register for the session
    
    This patch adds the ability to set a register for the current session
    from the 'set library' page.
    
    Upon entering the page, the current selection will be displayed.
    Changing the branch will trigger the register select list to update to
    display only those registers associated with the updated branch and will
    automatically select either 'no register' or the 'branch default'
    register.  The user can then override that selection to choose a
    different register for the session.
    
    Test plan
    1/ Enable cash registers with the 'UseCashRegisters' system preference
    2/ Select the 'Set library' option from the top right menu
    3/ Note that you can now select a cash register from the subsequent page
    4/ Change the branch and note that the cash register selection is
    updated to reflect the change
    5/ Note that the 'branch default' register is auto-selected upon branch
    selection if one has been defined, otherwise '-- None --' is selected
    6/ You can then alter the selection before submitting the form
    7/ Once submitted note that you are returned to the page you were on
    prior to attempting to change the library and register
    8/ Note the present of the register name next to the library name at the
    top of the screen.
    9/ Signoff
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e1e9ddfcb7063e02ec0384d35ddb485ac3292de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 6 15:30:39 2020 +0100

    Bug 25067: Move the tests to db_dependent
    
    To not break the package workflow
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f446debd6ea6410f57f26f4ccf63a65239710a09
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 4 18:07:08 2020 +0000

    Bug 25067: (QA follow-up) Add +x on test files
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3cfc2ec7bd1becef4386404fe7fc9f12740e8c97
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Sun Mar 29 14:56:20 2020 +0200

    Bug 25067: Move PO file manipulation code into gulp tasks
    
    misc/translator/translate was doing three different things:
    - extract translatable strings
    - create or update PO files
    - install translated templates
    
    This patch separates responsibilities by moving the string extraction
    code into several 'xgettext-like' scripts and adds gulp tasks to
    automate string extraction and PO files update
    
    This has several benefits:
    
    - gulp runs tasks in parallel, so it's a lot faster (updating all PO
      files is at least 10 times faster with my 4-cores CPU)
    
    - there is no need for $KOHA_CONF to be defined
      LangInstaller.pm relied on $KOHA_CONF to get the different paths
      needed. I'm not sure why, since string extraction and PO update should
      work on source files, not installed files
    
    - string extraction code can be more easily tested
    
    This patch also brings a couple of fixes and improvements:
    
    - TT string extraction (strings wrapped in [% t(...) %]) was done with
      Template::Parser and PPI, which was extremely slow, and had some
      problems (see bug 24797).
      This is now done with Locale::XGettext::TT2 (new dependency) which is
      a lot faster, and fixes bug 24797
    
    - Fix header in 4 PO files
    
    For backward compatibility, 'create' and 'update' commands of
    misc/translator/translate can still be used and will execute the
    corresponding gulp task
    
    Test plan:
    1. Run `yarn install` and install Locale::XGettext::TT2
    2. Run `gulp po:update`
    3. Verify the contents of updated PO files
    4. Run `cd misc/translator && ./translate install <lang>`
    5. Verify that all (templates, sysprefs, xslt, installer files) is
       correctly translated
    6. Run `gulp po:create --lang <lang>` and verify that it created all PO
       files for that language
    7. Run `prove t/misc/translator`
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Need to install yarn & gulp, no errors
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5d736909ccd24b38e90e89b1484da73972d8645
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 3 18:00:57 2020 +0000

    Bug 26727: (follow-up) More markup corrections
    
    This patch makes more markup changes to the templates previously
    modified in order to try to arrive at some agreeable solutions.
    
    - In the value_builder EXAMPLE template, the <p> is unnecessary and is
      removed. Also removed is the script "type" attribute and obsolete
      CDATA markers.
    - In the article request template an unnecessary <p> is removed.
    - In the merge patrons template the submit button is now in a <fieldset
      class="action"> as is consistent with other forms.
    - In the MARC modifications template I've added <div>s around each
      "line" in the form to add the line break, along with some CSS to add
      margins.
    - The submit button is now inside a <fieldset class="action"> and the
      "Cancel" link now has the "cancel" class.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbf0d21284924d6b7529017fc78178b98242aaee
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 18 16:30:24 2020 +0000

    Bug 26727: Fix <p/> appearing in the templates
    
    The self-closing p is not valid in HTML5:
    
    Error: Self-closing syntax (/>) used on a non-void HTML element.
    Ignoring the slash and treating as a start tag.
    
    To test:
    
    1)
    - Activate Article requests
    - Search for a record to place an article request on in staff
    - Look up the patron
    - Verify the article request form looks ok
    2)
    - Search for a list of patrons
    - Check 2 patrons and merge them using the button above the list
    - Verify the distance between the button and the table looks ok
    3)
    - Create a new MARC modification template
    - Create a new action
    - Verify the distances between the first and second line of form
      elements looks ok
    4)
    - Place a hold in staff
    - Click on the Suspend link in the holds table (not below)
    - Verify the modal looks ok
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b092bdd20d94a516db0b7c4533149ac52f96aac5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 5 11:53:43 2020 -0300

    Bug 14708: (QA follow-up) Add tests
    
    This patch adds tests for the change. It also simplifies the delete()
    method structure a bit. It fixes the error 500 the tests were raising.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Tests fail!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass! The new behaviour (code 403) is tested!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e37d9c5f7af0f7e0efb226c171da52f03bc80eb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Nov 3 08:55:04 2020 -0500

    Bug 14708: (QA follow-up) Use try/catch blocks when calling delete() on a patron
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 709f307af7b51f42d79a68a09b31249daef32ec1
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Nov 2 08:11:58 2020 -0500

    Bug 14708: (QA follow-up) Throw exception when deleting anonymous borrower
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2032ccfd3102247ed2fe639ed0117ba7ac602d8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Apr 29 07:22:26 2020 -0400

    Bug 14708: Don't allow merging of other patron records into Anonymous Patron
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9a54e0d3387c3ad057a67c7e2b5c668154f65f6
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Apr 15 13:48:09 2020 -0400

    Bug 14708: Don't allow merging of Anonymous Patron into other patron records
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f18118f18f8930d4765abecafe43776ef42877d4
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Apr 15 13:31:59 2020 -0400

    Bug 14708: Skip AnonymousPatron in GetBorrowersToExpunge
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63960cbb89ec22c0f984c8d02d140e76af03c18a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Apr 15 12:48:02 2020 -0400

    Bug 14708: Prevent deletion of Anonymous Patron at Koha::Patron::delete
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0ce0d646323de43739c454d0b8e665370768df1
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Feb 27 12:00:03 2019 -0500

    Bug 14708: Enforce restriction in delete_patrons.pl
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1af56eb54043909f7e32b4597baa4f2d4d3e7dd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Feb 27 06:59:08 2019 -0500

    Bug 14708: The patron set as the anonymous patron should not be deletable.
    
    Right now it's possible to delete the anonymous patron at any time. When this happens the system will break just as if anonymouspatron was unset but patrons still have an "always anonymize" privacy setting.
    
    This issue occurs more frequently than one would expect.
    
    We should make it so that the patron set in AnonymousPatron is not deletable.
    
    Test Plan:
    1) Apply this patch
    2) Set a patron to by AnonymousPatron
    3) Attempt to delete that patron from the members toolbar
    4) Note the error message!
    
    Signed-off-by: Devinim <kohadevinim@devinim.com.tr>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 880c9242a976e1b824af2ab5f048b1a0aa7b5496
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 16:27:29 2020 +0100

    Bug 16696: Fix search_utf8.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6dd1dbc3a117e8aa4a320b4d3c87458b4e74333d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 11:07:01 2020 +0000

    Bug 25334: DBRev 20.06.00.060
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0efa25c86afad07cfcb4cd8a0ffe23e0e0c50dc7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 14:12:56 2020 +0100

    Bug 25334: MTT is itiva not talkingtech
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d31403133d7c54d5ceb0c095859f3d01d3c39d3a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Nov 3 13:21:24 2020 -0500

    Bug 25334: (QA follow-up) Update overduerules.tt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6dad46e0ec84a71e34fe8b7c557512b8da1ded97
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Nov 3 18:13:28 2020 +0000

    Bug 25334: (QA follow-up) Update opac messaging
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 946edb595b96c4e53a996461757770b6aa53d6e9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Apr 30 13:35:48 2020 -0400

    Bug 25334: Add generic 'phone' message transport type
    
    As bug 25333 changed the 'phone' transport type to 'talkingtech', we can
    now re-add 'phone' as a transport type again, and allow it to behave and
    support the same notices as the email transport type.
    
    Test Plan;
    1) Apply this patch
    2) Run updatedatabase
    3) Restart all the things!
    4) Disable TalkingTechItivaPhoneNotificationi if enabled
    5) Enable new PhoneNotification system preference
    6) Go to a patron's messaging preferences, not you can select the
       'phone' option for all the same notices as the 'email' option
    7) Enable the phone option for all the message types
    8) Browser to the Notices and slips editor
    9) Add a phone notice version for each notice you wish to test
    10) Test some notices ( CHECKIN, CHECKOUT, etc )
    11) Notices should show in the patron's messages as 'phone' notices
    
    Signed-off-by: Christopher Zorn <Christofer.Zorn@ajaxlibrary.ca>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08ef42582fea11a4283a386ce6744939ee574e22
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Jun 2 11:27:02 2020 +0400

    Bug 25650: Add location and itype descriptions in ILS-DI GetRecords
    
    Test plan:
    1. Create a record with an item, and set the item's shelving location
    and itemtype.
    2. Go to
    http://<OPAC>/cgi-bin/koha/ilsdi.pl?service=GetRecords&id=<biblionumber>
    3. Check that there is <itype_description> and <location_description>
    and that their value is correct.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f11659c48b55eefe02bd1e829b396cd68d8a105d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 2 18:13:04 2020 +0000

    Bug 26148: OpenLibrary "Preview" link target is unclear to patrons
    
    This patch makes changes to the display of the Open Library "read" links
    in the OPAC search results and detail page. The link is now grouped with
    other details about the record ("Publisher," "Location(s)," etc. On the
    detail page, the "Preview" link will no longer appear under the cover
    image.
    
    The label is changed to "Found in Open Library," and the link now opens
    the Open Library reader in a new window.
    
    The patch also changes the Open Library button image links so that they
    use https and makes it so that the "Found in Open Library" information
    is hidden until the availability information has loaded.
    
    To test, apply the patch and enable the OpenLibrarySearch system
    preference.
    
     - Perform a search in the OPAC which will return results found in Open
       Library, e.g. "poetry" in the sample data.
     - Confirm that the "Read now" images from Open Library appear on some
       search results.
     - View the detail page for one of these titles.
     - Confirm that the "Read now" button appears in the same format on the
       detail page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b298ece04d7d055acc38e56904b1c9e7bf7949e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 12:06:33 2020 +0100

    Bug 26172: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff87a03f94d352b55271ae2355498f71a8cd938a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 3 11:40:57 2020 +0100

    Bug 26172: Replace _result[set] calls
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6b9032073f6ed95a09417cc5e02841184df0dbb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 15 14:05:45 2020 +0100

    Bug 26172: (QA follow-up) Add tests for previous cashups
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 932e2d05bca743d1862efd123f485d8c352fa778
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 11:45:26 2020 +0200

    Bug 26172: Fix return value for ->register
    
    There is a ON DELETE CASCADE clause on this FK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57f58f29b158e0910c5c33d66619c07f88e7157c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 17:15:30 2020 +0100

    Bug 26172: (QA follow-up) Add Unit Test
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0351013fdf7bec4df828962d16716135ceae1a9a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 17:14:47 2020 +0100

    Bug 26172: (QA follow-up) Fix order of summary
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff5c4f151fa32d43858cef7619e7b6a34d30bc97
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 4 15:54:31 2020 +0000

    Bug 26172: (QA follow-up) Add missing filter
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eaabed085f9b7afcab53d793c5a8c796ad3b75f3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 21 14:45:28 2020 +0100

    Bug 26172: (follow-up) Add print option
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d12c1f6a25ad74a11d2b57447791e5fba78e921a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 21 14:09:46 2020 +0100

    Bug 26172: (follow-up) Summary by payment_type
    
    This patch alters the modal so that the totals are broken down by
    payment type's available on the system.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88b5b5d00ac04c5286dfeb5c05c674e82b3f2728
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 7 10:15:20 2020 +0100

    Bug 26172: Add cashup summary view modal
    
    This patch adds a cashup summary modal to the register details page.
    
    Test plan
    1/ Enable Cash Registers and Point of Sale
    2/ Enable some debit_types as 'Sale items'
    3/ Perform a series of transactions
    4/ Perform a 'Cashup' on the register
    5/ Note the new '(Summary)' link next to the last cashup on the register
    page.
    6/ Click the link and confirm the modal contains the pertinent
    information
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a851aaeebf60e2da4ea9381151521e5f03a994c8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 15:39:05 2020 -0300

    Bug 26584: Remove unused C4::Acquisition::CloseBasket function
    
    This patch makes code use the new Koha::Acquisition::Basket->close
    method and makes CloseBasket obsolete.
    
    It then removes it, and adapts the few places in which it was used.
    
    1. Apply this patch
    2. Run:
       $ kshell
      k$ git diff origin/master --name-only | grep -e '\.t$' | xargs prove
    => SUCCESS: Tests pass!
    3. Try playing with baskets, closing them
    => SUCCESS: All works as expected!
    4. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83bb93ccc96b69739900af559c5112602bc13490
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 15 11:33:33 2020 -0300

    Bug 26582: (QA follow-up) Rename closed => is_closed
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddf8dfcad06f4ecc99495754299cea65e3be0ea2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 14:40:54 2020 -0300

    Bug 26582: Add Koha::Acquisition::Basket->close
    
    This patch adds two methods to Koha::Acquisition::Basket:
    - 'closed': that tells if the basket is closed
    - 'close': that closes the basket
    
    It inherits the behaviour from CloseBasket (as it actually makes sense).
    It improves CloseBasket by wrapping the action inside a transaction. It
    uses the $orders->update call with no_trigger as there's no trigger to
    trigger and the update can be done on a single DB call.
    
    A new exceptions file is added for basket-related exceptions. The only
    specific exception that gets added is
    Koha::Exceptions::Acquisition::Basket::AlreadyClosed
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Acquisition/Basket.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bea89005ca2e59dc3c082e872f2ba3c1872a2dd3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 14:40:36 2020 -0300

    Bug 26582: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb3753d29254cb2f17661a36ddece56919ba980d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 5 09:12:12 2020 +0100

    Bug 26935: Don't use basket for claimacquisition and claimissues
    
    Incorrect basketid is sent for claimacquisition and claimissues.
    
    The basket info are not used in the default template of these notices, but if it
    is used, a wrong basket may be passed to generate the notice.
    
    This has been caught by a test failure after bug 26745.
    
     #   Failed test 'SendAlerts - claimissue'
     #   at t/db_dependent/Letters.t line 642.
     C4::Letters::_substitute_tables(): DBI Exception: DBD::mysql::st execute failed: called with 2 bind variables when 1 are needed [for Statement "SELECT * FROM aqbasket WHERE       basketno = ?" with ParamValues: 0=53] at /kohadevbox/koha/C4/Letters.pm line 679
    
    This is a quick patch to fix the failing test, but more work would needed.
    
    We are removing the basket info from those 2 notices and keeping it only
    for orderacquisition.
    
    Technically: the $externalid is coming from the parameter list of
    SendAlerts, but it is a basketno only for orderacquisition. We must not
    pass it for other notices.
    
    Test plan:
    Confirm that the failing test is now passing and that the changes make
    sense.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a10db1347dfbe5a444e669e363aab9b635d74069
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 5 12:42:47 2020 +0000

    Bug 26908: (follow-up) Alter template check
    
    This alters the template check to use the presence of the plugins
    arrayref rather than requiring a second call to check for
    plugins_enabled.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d438de0186fb08d2a1f8eb82b0df0204efff5ef
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Nov 3 08:31:39 2020 -0500

    Bug 26908: Restore ability to view and select EDI plugins for a vendor account
    
    Test Plan:
    1) Install an EDI plugin
    2) Browse to edi_accounts.pl, create or edit an account
    3) Note the plugins pulldown is missing
    4) Apply this patch
    5) Restart all the things!
    6) Reload the page
    7) Note the pulldown is back!
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31e38bc371943d1e76f49aacd1dd159a254f71e7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 3 16:45:33 2020 +0100

    Bug 26911: (bug 18936 follow-up) Remove invalid data before copying the circ rules
    
    UPDATE: changed queries to not touch * values
    
    To test:
     1 - Checkout 19.11.x and reset_all
     2 - Add a new patron category, itemtype, and branch to your system
     3 - Create issuing rules using thise 3 values, and others
     4 - Delete the new category, itemtype and branch
     5 - Checkout master
     6 - Restart_all
     7 - updatedatabase
     8 - you get errors
     9 - repeat 1-5
    10 - apply patch
    11 - restart_all
    12 - updatedatabase
    13 - no errors!
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42c0475a948577442e44b11dbb12b45b25171418
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 4 09:04:19 2020 +0100

    Bug 26915: Fix FinePaymentAutoPopup behaviour
    
    The behaviour of the syspref FinePaymentAutoPopup is broken, the popup
    explodes with
        Can't call method "unblessed" on an undefined value at /home/vagrant/kohaclone/members/printfeercpt.pl line 64
    
    It has been broken by
      commit a2449a81be55aa5b3710ca2c6df7884513f89540
      Bug 23051: (follow-up) Add renewal feedback and move code to subroutines and test
    which modified the return value of Koha::Account->pay (from $payment_id
    to a hashref)
    
    Test plan:
    - To test activate FinePaymentAutoPopup
    - Create a manual fee
    - Write it off using the write off button on the account line (not below table)
    => Without the patch you get the error
    => With the patch applied the popup is correctly displayed
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3f8624315dc1c9327c0c7eaa23e9ff21d15032e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 4 17:36:06 2020 +0100

    Bug 7143: Update about page for new dev - Ivan Masár
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31e9ac9a2c6e54e458a7f5bc49b83a2d05a83d2c
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Nov 4 17:05:28 2020 +0200

    Bug 26132: (follow-up) Fix broken code in TooMany function
    
    The $checkouts variable was not defined in the PatronLibrary case at
    all and in the else case the SQL join was totally missing.
    
    To test:
    1) Without this patch notice prove
       t/db_dependent/Circulation/TooMany.t fails
    2) With this patch notice prove
       t/db_dependent/Circulation/TooMany.t succeeds
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe7abf020c6c13978ce84393b4877688b6f3ebce
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Nov 4 17:00:02 2020 +0200

    Bug 26132: (follow-up) Add test to show errors in max issues amount calculation
    
    If you set default branch limits for issue quantity circulation
    rules you will get errors when calling TooMany function.
    
    To reproduce the error:
    1) Apply this patch
    2) Run prove t/db_dependent/Circulation/TooMany.t and notice the
       following error:
    
    No method count found for Koha::Checkouts DBIx::Class::Storage::DBI::_dbh_execute(): DBI Exception: DBD::mysql::st execute failed: Unknown column 'item.homebranch' in 'where clause' [...]
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e700fb8f4ec323102d4cd6967bc4fb589ddc4032
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 16 11:47:24 2020 +0000

    Bug 23823: (QA follow-up) Fix filter in link
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbeb3d547f1bacccfa585ec02e72494decc0e1a0
Author: Ivan Masár <helix84@centrum.sk>
Date:   Thu Oct 17 13:49:16 2019 +0200

    Bug 23823: (follow-up) minor visual fix
    
    Do not allow a line break between the bookmark icon and syspref name.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6884665d55a304cb07c2e385a22e4a2868a66486
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Oct 11 02:18:41 2019 +0000

    Bug 23823: (follow-up) Get rid of some tabs in favor of spaces
    
    In the paragraph touched by this patch, there were some
    whitespace issues. This patch does some tab to space
    replacement and reindentation to make the code more readable.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Ivan Masár <helix84@centrum.sk>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43e6557a2ae1082f684fd073b476511730d05f66
Author: Ivan Masár <helix84@centrum.sk>
Date:   Wed Oct 16 13:17:37 2019 +0200

    Bug 23823: Allow system preferences to be bookmarked
    
    Test plan:
    1) Log in to Staff UI with superlibrarian permissions
    2) Go to System Preferences /cgi-bin/koha/admin/preferences.pl
    3) Next to each preference, there should now be a bookmark icon
    4) The bookmark icon links to a search for the exact preference name
    5) The link can be bookmarked for quick reference to the specific
    preference
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62bf6ed986c26bf2802757a829546642206b9987
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 14:36:34 2020 +0000

    Bug 26729: Add focus class to vendor name field in vendor add form
    
    This patch adds the "focus" class to the vendor name field in the form
    for adding or editing a vendor in acquisitions.
    
    To test, apply the patch and go to Acquisitions -> New vendor.
    
    On page load the cursor focus should automatically be on the vendor name
    field. The same should true when editing an existing vendor.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8066a1a6eb6260724d42d4416ee762a13bcc1629
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 4 11:08:30 2020 +0000

    Bug 26745: (QA follow-up) Add Unit Tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c9e44b24ec7f6cbe203ae5832924316a7601193
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Oct 20 09:43:22 2020 +0100

    Bug 26745: Add TT support to 'title' in notices
    
    This patch adds support for using TT syntax in the title element of the
    notices system.
    
    Test plan
    1/ Edit an easily triggerable email notice such that the title contains
       some template toolkit markup.
       Example: Edit the 'CHECKOUT' notice to include [% today %] in the
       title field.
    2/ Trigger the notice (For 'CHECKOUT' that means checking an item out to
       a user (Preferably with 'email' selected in their advanced messaging
       preferences for the notice)
    3/ Either, navigate to the 'Notices' tab for the user, or run the
       message queue and inspect the subject line of the recieved email.
    4/ Prior to the patch the TT syntax would remain 'as is'.. i.e
       '[% today %]'.
    5/ After the patch, the TT syntax should have been properly replaced.
    6/ Signoff
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b1da2aa0ced03f8afe56c4624ec77d49e5000a2
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Nov 2 23:39:21 2020 +0000

    Bug 26804: (QA follow-up) add modal-lg class and intent markup correctly
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ce23ea0e9a8820ff3a298e7f553e1bbf54d4bed
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Oct 28 04:22:54 2020 +0000

    Bug 26804: Add modal content preview
    
    This patch turns the 'News' column into a preview button. That preview button displays a modal with content of that rows news item.
    
    To test:
    1. Apply patch
    2. Add some HTML to a News Item. I am using a bunch of lorem ipsum HTML and this image set to 1000px. '<img src="https://koha-community.org/files/2013/09/cropped-kohabanner3.jpg" width="1000" />'.
    3. Make sure and have some content with a lot of width and some content with a lot of height.
    4. Test the Preview content button
    5. Make sure you can scroll through long modals and across modals that are wide
    6. Try at different screen sizes and with different combonations of News items
    
    Signed-off-by: Kelly  <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ece8a0c35c5843f0a0cd4ef94ff405e306aedef1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 4 17:32:20 2020 +0100

    Bug 26886: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48880284867a96d8767e7d15f6bfe1a035b2ee6e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 2 13:43:27 2020 +0000

    Bug 26886: Correct style of alert-error class in the OPAC
    
    This patch makes a minor change to the OPAC SCSS so that instances of
    "alert-error" classes are styled the same as messages with the Bootstrap
    4 "alert-warning" class. This change is simpler than making multiple
    changes to scripts and templates.
    
    To test, apply the patch and try to view a single news item in the OPAC
    which doesn't exist:
    
    /cgi-bin/koha/opac-main.pl?news_id=XXX
    
    - You should see a warning message with a pale yellow background, "This
      news item does not exist."
    - Submit a suggestion, and then submit another suggestion with the
      same title.
      - You should see a warning message, "The suggestion has not been
      added. A suggestion with this title already exists."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea7e83b2712c48a0c9a157b2fb36eb782b26f34b
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Nov 3 12:27:14 2020 +0200

    Bug 24567: (QA follow-up) Remove warning in regex
    
    Without this patch we get
    
    Use of uninitialized value $3 in concatenation (.) or string at /kohadevbox/koha/Koha/SearchEngine/Elasticsearch/QueryBuilder.pm line 943.
    
    This converts the | OR operator to two different regexes so that the
    capture group variables will be defined in every case.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ce56f1134d99280af30e128f57189b285966180
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 27 11:26:53 2020 +0000

    Bug 24567: Don't strip spaces along with dangling colons
    
    This updates the regex used for removing colons to capture those with space on either side, and remove the colon
    while preserving the space
    
    To test:
     1 - Have Koha using ES
     2 - Search for:
        ti:chess AND chess
     3 - You should get a result in sample data, otherwise replace 'chess' with a title in your catalogue
     4 - Search for:
        ti:chess AND kw:chess
     5 - No result
     6 - Enable  DumpTemplateVarsIntranet  and  DumpSearchQueryTemplate
     7 - Repeate search and check page source
     8 - search_query has:
        title:chess ANDchess
     9 - Apply patch
    10 - Repeat
    11 - Seaerch works!
    12 - query is now:
         title:chess AND chess
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Bug 24567: (follow-up) Use dollar sign to refer to captures
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b565d1c7a46291bae89c5cc33fca246202c6988
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 13:36:04 2020 +0000

    Bug 26736: Compare values of reports log entries
    
    This patch adds the ability to compare the log entries for reports
    in the system log. The user can select two entries in the log search
    results and view a diff of the two versions.
    
    To test, apply the patch and check that the  ReportsLog system
    preference is enabled. If it isn't, enable it and make some changes to
    saved SQL reports so that you have log entries to test with.
    
    This is a trivial patch that simply adds "REPORTS" type log entries to
    the list of modules which can be selected for comparison. The full test
    plan is basically the same as that for Bug 26207:
    
    - Perform a search for log entries in the "Reports" module.
    - In the results, each entry for a report update should have a
      "Compare" checkbox."
    - Check one of the checkboxes.
    - The table should now be filtered by the report title. This
      facilitates meaningful selections for comparison.
    - You should see a message displayed onscreen, "Showing results
      for...[report name]"
    - The "Check none" link in the toolbar above the table should now be
      enabled.
    - If youy click the "Compare selected" link in the toolbar at this
      stage you should get a message, "You must select two entries to
      compare."
    - If you uncheck the checkbox the table should return to an unfiltered
      state.
    - Check two checkboxes.
    - The "Compare selected" link in the toolbar should now be enabled.
    - Next to each of the checkboxes you checked should be a "View
      comparison" link.
    - Clicking either of the "View comparison" links or the "Compare
      selected" link should trigger a modal with the diff view of the two
      reports log entries.
    - Try to select a third checkbox. You should get a message, "You can
      select a maximum of two checkboxes." The box should remain unchecked.
    - Test that unchecking both checkboxes manually clears the table filter.
    - Test that the "Check none" link works to uncheck checked boxes and
      clear the table filter.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ba108f4eb18eb27a1b8be55b33b4e28df4b806f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 15 13:01:50 2020 +0000

    Bug 26439: (QA follow-up) Correct MSG instances in cart.js
    
    To test, add some items to the cart in the staff interface and open the
    cart window. Test the "Selected items" links (Remove, add to list,
    etc.) without checking any checkboxes. You should get an alert, "No item
    was selected."
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ceee890899c54e113a0a787016ae52e40f3817bb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 11 19:17:10 2020 +0000

    Bug 26439: Move cart-related strings out of js_includes.inc and into basket.js
    
    This patch moves strings defined for translation in js_includes.inc
    into basket.js for translation using the new double-underscore
    i81n function.
    
    To test, apply the patch and perform a catalog search in the staff
    client.
    
    - Click the Cart link in the header menu. A pop-up should appear saying
      "Your cart is currently empty."
    - On the search results page, click the "Add to cart" link next to any
      search result. The text should change to "In your cart."
    - Click the "Remove" link. The text should change to "Add to cart."
    - Check the box next to a title in the search results and click the "Add
      to cart" button in the search results toolbar. A message should
      appear, "1 item(s) added to your cart."
    - Click the "Add to cart" button again. You should see the message "No
      item was added to your cart (already in your cart)!"
    - Uncheck all check boxes on the search results page and click "Add to
      cart." You should see "No item was selected."
    - Add more items to your cart so that it contains more than one item.
    - Click the "Cart" link to open it.
    - Click the "Empty and close" button. You should be asked to confirm,
      "Are you sure you want to empty your cart?"
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/basket.js for
      translation, e.g.:
    
      msgid "Your cart is currently empty"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for
      testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8e5d9ab9f3dc690f007bb6893af71edf26a473f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Sep 25 00:24:29 2020 +0200

    Bug 19351: Add items.copynumber to the checkouts table
    
    This adds the items.copynumber to the checkouts table in the
    patron account in the staff interface.
    
    To test:
    - Apply patch
    - Check out some items with and without copy number in the item
      to any patron
    - In the checkouts table on the Checkouts and Details tabs:
    - Verify that a new column shows 'copy no' shows after 'call no'
    - Verify the information displays correctly
    - Verify that the column configuration settings for the new column works
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 973e1b1d5d3d381e90bd405d220e7d418ca1c818
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 17 11:52:10 2020 +0000

    Bug 15780: Add inventory number to checkout list on summary print
    
    This will add the inventory number to the list of checkouts that
    can be printed using the 'Print summary' feature from the patron
    account in staff.
    
    To test:
    - Apply patch
    - Make sure you have some items with and without inventory number set
    - Check them out to any patron
    - Go to Print > Print summary
    - Verify the inventory number column is showing up and the numbers
      show with their items.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1f412bd76adb4ec54db3b5991b03e9fb2bdecd2
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Sep 21 12:21:23 2020 +0000

    Bug 21882: Show price information in acqusitions tab on staff detail page
    
    This adds a new 'Price' column to the acqusition details tab.
    
    To test:
    - Apply patch
    - Add one or more orders for a record.
    - Before closing the basket: go to the detail page in the catalog
    - Verify that the price estimated/budgetet price now shows in a new column
    - Add actual cost to the basket or close the basket and receive the item
    - Verify the column now shows the updated actual cost
    - Verfy the tooltip on the table heading works
    - Verify the column configuration for the new column works as well
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ef31a0b77133e4c3eacc1c7d46d917746e438d7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 15 13:33:29 2020 +0000

    Bug 26572: (QA follow-up) Escape strings in autocomplete
    
    This patch updates the construction of the autocomplete dropdown so that
    values are escaped.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38507b041ba3a448315d91294f032267679810bd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 29 11:12:31 2020 +0000

    Bug 26572: Add autocomplete to librarian field in log viewer
    
    This patch adds patron autocomplete to the librarian field in the log
    viewer search form.
    
    Also changed: Some HTML markup errors in the template have been
    corrected: Labels with invalid corresponding ids or with no valid id.
    
    To test, apply the patch and go to Tools -> Log Viewer.
    
    Type a name or cardnumber into the "Librarian" form field. This should
    trigger an autocomplete dropdown.
    
    Select a patron and confirm that the field is populated with the correct
    borrowernumber.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2293d5c602b27b8f88d64d15eaa4de94e6bc16c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 13 10:25:02 2020 -0300

    Bug 21111: Add --exclude-indexes to koha-run-backups
    
    This patch adds a trivial switch so koha-run-backups can pass the
    --exclude-indexes option switch to koha-dump. This way if the sysadmin
    doesn't want to backup the Zebra indexes, it can be controlled by
    tweaking the cron definition.
    
    To test:
    1. Apply this patch
    2. Run:
       $ debian/scripts/koha-run-backups --days 2 --output /var/spool/koha
    3. Notice the size of the backups:
       $ ls -lh /var/spool/koha/kohadev
    4. Try the new option switch:
       $ debian/scripts/koha-run-backups \
           --exclude-indexes \
           --days 2 --output /var/spool/koha
    5. Repeat 3
    => SUCCESS: Backups are smaller!
    6. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: fix --exclude_indexes vs --exclude-indexes in koha-run-backups.xml
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee028855c246b1496003fbfccfd20042594ac4bf
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 21:45:25 2020 +0000

    Bug 15329: Add new column for budget to the late orders table
    
    The table currently displays the fund, but as late orders can be
    from a past budget with the same fund names, this can be confusing.
    So adding the budget in addition to the fund will be helpful.
    
    To test:
    - Add a basket and an order, close the basket
    - Go to the late oder page
    - Make sure your order shows up there
    - Apply the patch
    - Reload the late orders page
    - Verify a new column budget shows in the table
    - Verify the table configuration settings work for the new column
    - Run t/db_dependent/Koha/Acquisition/Fund.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42ab7b80d4f1d13e15f991d3c4fa161ffca0726f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 16:07:44 2020 +0000

    Bug 15141: Add MARC21 770/772 Supplement (parent) to OPAC and staff detail pages
    
    Adds the 2 corresponding linking fields to the staff and OPAC detail pages:
    
    770 - Supplement/Special Issue Entry (R)
    https://www.loc.gov/marc/bibliographic/bd770.html
    
    772 - Supplement Parent Entry (R)
    https://www.loc.gov/marc/bibliographic/bd772.html
    
    To test:
    - Catalog records with 770/772 in Koha, examples can be found in the LOC
      documentation.
      - When UseControlNumber is set to Use and $w is added, a link will be built using $w
      - If there is no $w or UseControlNumber is Don't use, a link will be build using the title
    - Verify that they display nicely in the OPAC and staff detail pages
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 043f3f0fd022b70323e2e681b3560bf0915fe845
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 12:45:01 2020 +0100

    Bug 24834: (follow-up) Improve breadcrumb
    
    This patch updates the breadcrumb navigation to be consistent for View,
    Edit and Run with the report name (and id in brackets) appropraitely
    placed in the breadcrumb with a link back to the view and the 'Action'
    clearly listed as the final part of the breadcrumb path.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2876ef4d481cd037b2b08a3240f14e44f0882f5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 14 08:49:50 2020 +0100

    Bug 24834: (QA follow-up) Add missing filter
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0b3bbb3276741961d5e8e8da88aa3076b255eeb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 24 23:35:19 2020 +0200

    Bug 24834: (follow-up) Add report id to page titles
    
    See test plan of previous patch!
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f2e2a4dbdaf066cf6002ad1d6f1241273ce5705
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Sep 21 12:46:48 2020 +0000

    Bug 24834: Display report number on editing or running a report
    
    The only place the report ID was shown when editing or running a
    report was in the URL. With this patch, we also show it in the
    heading, the breadcrumbs and the page title.
    
    To test:
    - Create a new SQL report.
    - Save the report.
    - Edit the report.
    - Verify that the report id now shows in the breadcrumbs and page title.
    - Run your report.
    - Verify the report id shows in the page heading, title and breadcrumbs.
    
    Signed-off-by: Michael A <madamyk@ckls.org>
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dd798302a84acf5d4474affeaa61fc9c97ed68a
Author: David Cook <dcook@prosentient.com.au>
Date:   Sun Oct 11 23:47:45 2020 +0000

    Bug 26641: Optimize CatalogModuleRelink lookup
    
    This patch moves the CatalogModuleRelink lookup outside the loop to
    improve performance (especially for large databases), and includes a
    tester friendly test plan.
    
    Test plan:
    0. Using koha-testing-docker
    1. koha-shell -c "./misc/link_bibs_to_authorities.pl -l --test" kohadev
    2. Note 436 bibs checked, 1315 headings linked, 676 headings unlinked
    3. koha-shell -c "./misc/link_bibs_to_authorities.pl -l --test -g 700" kohadev
    4. Note 436 bibs checked, 248 headings linked, 111 headings unlinked
    5. Note output appear to all be names (rather than subjects or other authorities)
    6. Note also that the 2nd run with -g 700 is almost 2x faster than without
    
    Signed-off-by: Andreas Roussos <a.roussos@dataly.gr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab2e3b0e890a45202a9c360f444917a0ff336d50
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Fri Oct 9 13:39:52 2020 +0200

    Bug 26641: pass the MARC field as an argument to link_bibs_to_authorities.pl
    
    When running link_bibs_to_authorities.pl, it could be useful to have
    the ability to specify which MARC field the script should operate on.
    
    For example, when you have a catalog where most links are in place,
    and you don't want the script to process every MARC field but rather
    limit it to a specific MARC field (e.g. 700) because you've observed
    that there are many missing links for that particular MARC field.
    
    This patch provides that enhancement.
    
    Test plan:
    1) Run the script as follows (preferably in a test DB):
    
       time link_bibs_to_authorities.pl -v -l --test
    
       ... and notice how long it takes to complete.
    
    2) Apply the patch.
    
    3) Run the script again, this time providing the MARC field to work on:
    
       time link_bibs_to_authorities.pl -v -l --test -g=700
    
       ... and, again, notice how long it takes to complete.
    
       The 2nd run should run faster than the 1st one.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96be711d0333a531051cdbd6f194a2eb05071c60
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 4 10:57:45 2020 +0100

    Bug 21898: Add basket for TT syntax
    
    Without this patch the basket's info won't be available for the TT
    syntax.
    
    With this patch you can now use [% basket.basketname %]
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98ab9863929799a8e42f7b8ce23ba5d70c822b14
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 1 09:04:43 2020 +0100

    Bug 21898: Add aqbasket to available tables for ACQORDER
    
    This patch should allow <<aqbasket.$field>> replacements to work in both
    email subject and email content fields for notices.
    
    Test plan
    1/ Add <<aqbasket.basketname>> into the ACQORDER notice (In the subject
    line and content box)
    2/ Trigger said notice to send (before applying the patch)
    3/ Note that the replacements have not taken place..
    <<aqbasket.basketname>> is present as is.
    4/ Apply patch
    5/ Trigger the notice again
    6/ Note that the replacements are now made.
    7/ Signoff
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: fix alignment in hashref, edit commit message to fix
    letter code "AQORDER" vs "ACQORDER"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bfc54d44a53a4235e171858f75a6fc4bdc3eb9c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Oct 17 14:14:00 2020 +0200

    Bug 26680: Acq - Wrap (rcvd) in a span and change text to received
    
    The new span with the class order-received will allow to have
    individual styling on the term to make it stand out more in the
    list of order lines of a basket. The text change will ease translation.
    
    To test:
    - In acquisitions:
    - Create a new basket
    - Add at least 2 order lines
    - Close the basket
    - Receive a new shipment and one of your order lines
    - Go back to your basket
    - One line should now show "(rcvd)"
    - Apply patch
    - Reload the basket page
    - Verify the text has changed and element now has a class in the
      HTML source
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d6595a1bf0e04611c2a1d5c18489c6ee799a9aa
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Oct 17 22:47:49 2020 +0000

    Bug 26190: Allow to close a basket with only cancelled order lines
    
    At the moment there are several cases, when closing a basket is not
    possible:
    - when there are no order lines in it
    - when there are order lines with uncertain prices
    - when the basket is marked as a standing order
    
    The first case wasn't checked correctly as only pending/received
    orders would be counted, but not cancelled orders.
    
    To test:
    - Create a basket
    - Create an order line
    - Verify the "close this basket" button shows
    - Cancel the order line - the button disappears
    - Apply the patch
    - Verify the button appears and works now
    - Create another basket - make sure you cannot close it
      without order lines
    - Create an order line with uncertain price checked
      - you cannot close it
    - Resolve the uncertain price - you can now close the basket.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a27c22bffc2fbd48951192dbff846b35766d4123
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Oct 17 14:04:33 2020 +0200

    Bug 26718: Rename "reading history" to "checkout history"
    
    This changes all occurences of reading history to the more
    accurate term 'checokut history' as it was correctly pointed out
    that 'reading' doesn't apply to all kind of items available
    at the library (audio books, games, etc.)
    
    To test:
    - Verify that the term reding history has been replaced by checkout
      history in:
      - System preferences
      - OPAC tab "your checkout history"
      - OPAC tab "your privacy" (switch OpacPrivacy pref first)
      - Staff permission for patron batch anonymization
    
    Signed-off-by: Barbara Johnson  <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e42b4088ed83eb093389f3f5a841095ecc8f036f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 7 13:15:36 2020 +0000

    Bug 26180: Add descending option to rebuild_elasticsearch.pl
    
    While the ES index is incremental and provides results as it commits, we currently index from the oldest records to the newest.
    
    This patch provides the option to go the other direction
    
    To test:
     1 - Have ES setup and running for Koha
     2 - perl misc/search_tools/rebuild_elasticsearch.pl -v -v -b
     3 - Note the biblios index from number 1 the end
     4 - perl misc/search_tools/rebuild_elasticsearch.pl -v -v -a
     5 - Notice the same
     6 - Apply patch
     7 - perl misc/search_tools/rebuild_elasticsearch.pl -v -v -b
     8 - Still in ascending order
     9 - perl misc/search_tools/rebuild_elasticsearch.pl -v -v -b --desc
    10 - Now records index in descending order
    11 - perl misc/search_tools/rebuild_elasticsearch.pl -v -v -a
    12 - Still ascending
    13 - perl misc/search_tools/rebuild_elasticsearch.pl -v -v -a --desc
    14 - Now descending
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch: fix typo "inde" vs "index" and add commit body
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 018720aa5e0c82ad52821789f8878905f1d9affb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 22 12:27:17 2020 +0000

    Bug 12533: (follow-up) Add CSS to preview display of authority MARC
    
    This patch adds the same CSS used by authorities/detail.tt to the
    modal preview of the authority record shown in the authorities search
    result popup.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66289610fa34574e09bd25a95c104a5c03a9cc7f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 13:04:42 2020 +0000

    Bug 12533: Improve authority search result display
    
    This patch implements a few changes in the way authority records are
    displayed in search results.
    
    - In most cases heading type is now displayed as a separate column in
      the table of search results.
    - The heading itself is now linked rather than a separate "details"
      link.
    
    In the authority search results for MARC editor plugins the heading link
    triggers a modal with the authority details instead of linking to a
    separate page.
    
    To test, apply the patch and go to Authorities.
    
    - Perform an authority search which will return results.
    - In the search results headings should be linked to the
      corresponding detail page.
    - There should be a separate column for heading type.
    - Go to Cataloging and create a new record using a framework which has
      a field linked to an authority type (e.g. 100a -> PERSO_NAME ).
    - Perform a search which will return results.
    - In the search results, clicking a heading link should trigger a
      modal window with the authority details.
    - Test multiple entries in the results and confirm that each
      time the correct data is loaded into the modal window.
    - Test the same process for a field which is linked to the
      unimarc_field_210c.pl plugin.
    - Go to Tools -> Batch record modification and submit multiple
      authority record numbers.
    - In the results list the heading should be linked correctly to the
      corresponding detail page. Heading type is not present in this
      view.
    - Perform the same test with batch record deletion.
    
    Signed-off-by: Claire Gravely <claire.gravely@bsz-bw.de>
    
    Signed-off-by: Marjorie Barry-Vila <marjorie.barry-vila@collecto.ca>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ddb841d22a41fafee5164967ef8ec449cae06dc
Author: Tal Rogoff <tal.rogoff@cass.govt.nz>
Date:   Fri Oct 23 23:39:06 2020 +0000

    Bug 26783: set OpacRenewalAllowed to "Allow" for new Koha installations
    
    test plan:
    1.Drop and recreate database
    2.Go through web installer
    3.Observe that "OpacRenewalAllowed" is set to "Don't Allow"
    4.Apply patch
    5.Repeat steps 1 and 2
    6.Observe that "OpacRenewalAllowed" is now set to "Allow"
    
    sponsored-by: Catalyst
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c65e7ba177e37125de208d9612b74cc9ad3d2b52
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 19 12:32:08 2020 +0100

    Bug 22394: Remove C4::Accounts::manualinvoice
    
    This patch removes C4::Accounts::manualinvoice and it's corresponding
    test.  We have been warning deprecation of this method for 18 months (by
    the time of 20.11 release).
    
    Test plan
    1/ Apply patch
    2/ Ensure no mention of manualinvoice accross the codebase
    3/ Run t/db_dependant/Accounts.t and ensure it still passes
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a113663820634d2d718c8a979e8e70f64b8744a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 22 16:26:03 2020 +0100

    Bug 12656: Allow --reason to be passed to cancel_expired_holds
    
    This patch adds the --reason option to cancel_expired_holds which allows
    the library to optionally set a reason for cancellation when running the
    cronjob. This will prompt the HOLD_CANCELLED notice to be sent to the
    patron.
    
    To test:
    1/ Ensure the unit tests continue to pass after the patch
       (t/db_dependent/Reserves/CancelExpiredReserves.t)
    
    Also:
    1 - Add an expired hold for a patron:
        INSERT INTO RESERVES (borrowernumber, biblionumber, expirationdate, found,branchcode,itemnumber) VALUES (5,5,'2020-01-01','W','CPL',983);
    2 - Set ExpireReservesMaxPickUpDelay to Allow
    3 - Run the cronjob:
        perl misc/cronjobs/hold/cancel_expired_holds.pl --reason EXPIRED
    4 - Visit the patron's notices tab
    5 - Confirm they have been sent a cancellation notice
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5dc71be2ee6d49335d9b4ee79edcf68882c555d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 10:35:20 2020 +0000

    Bug 25941: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f010b8fd168a10cd380131fc2bb5360538524655
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 16 19:03:13 2020 +0000

    Bug 25941: Reindent Upload local cover image page
    
    This patch reindents the "Upload local cover image" template to make
    indentation consistent. Some lines have been split up. Some markup
    inconsistencies have been corrected.
    
    To test, apply the patch and enable the LocalCoverImages system
    preference.
    
    - Go to Tools -> Upload local cover image.
    - Test uploading single images or ZIP files of images.
    - Confirm that everything works as expected.
    
    Use your preferred method for checking the differences between files
    while ignoring whitespace. I use diff with the  "-w" flag, but I'm not
    some kind of diff deity. The only changes you see should be split lines.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 579608808c4ec81f469e4c48627525d17a16194d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jul 14 18:46:19 2020 +0000

    Bug 22399: Improve responsive behavior of the basic marc editor
    
    This patch makes markup and style changes to the basic MARC editor in
    order to improve the page's handling of smaller browser widths. It adds
    flexbox styling to elements of the form to help accomplish this.
    
    To test, apply the patch and load a record for editing in the basic MARC
    editor.
    
    - Adjust your browser width and confirm that the form adjusts well
      to various widths.
    - Test that the markup changes haven't broken the JavaScript-driven
      features in the editor:
      - Clone tags
      - Delete tags
      - Expand and collapse tags
      - Clone subfields
      - Delete subfields
      - Re-order subfields
      - Cataloging plugins:
        - Focus-driven plugins like on tag 000
        - Popup plugins like 008 or authority-linked tags
        - Select2-styled dropdowns (e.g. 942$c Item type).
    - Test the add/edit items form to confirm that it is still styled as it
      was before.
    
    Edit: The Select2 plugin JavaScript file now accepts a variable to set
    the "width" configuration option. It still defaults to "element."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1e2693ce529a7af2646ba770269cf32e991ff7d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 12:07:19 2020 +0000

    Bug 26763: Use standard information style for multi-hold message
    
    This patch modifies the markup of the message which is displayed when
    the patron tries to place a hold on a title they already have a hold on.
    Now the message is styled consistently with other similar messages.
    
    To test, apply the patch and follow the steps used to test Bug 19718:
    
    - In Administration -> Circulation and fine rules, set a rule to allow
      multiple holds on a title.
    - Log in to the OPAC as a user covered by the above rule and locate
      a bibliographic record on which multiple holds can be placed.
    - Place a hold on the record.
    - Return to the record details for that title and place another hold.
    - You should see a correctly-styled message about having at least one
      other hold on the record.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 657df01fec106e9a0e2afee7518c8b95537c93d4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 4 11:53:04 2020 +0000

    Bug 19482: DBRev 20.06.00.059
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcbc856b60436aa1341beb7da75ac3665d4e5f92
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sun Oct 25 02:16:42 2020 +0000

    Bug 19482: (follow-up) Fix update, add tests, restore closing </td>
    
    To test:
    1 - View the mappings page, confirm table is correctly structured
    2 - prove -v t/db_dependent/Koha/SearchEngine/Elasticsearch/ExportConfig.t t/db_dependent/Koha/SearchEngine/Elasticsearch/Reset.t t/db_dependent/Koha/SearchField.t
    3 - Confirm update statement works and table is ordered correctly
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dbe8c14bbf3ff8a3bc2daa07ab52e02e2a28ef77
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 16 16:13:32 2020 +0000

    Bug 19482: (follow-up) Don't set readonly as a variable, use conditionals
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f498d250cdbe50bede11a1e550f385de6ae3d06
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 16 14:37:24 2020 +0000

    Bug 19482: DBIC schema changes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37a7a1bb5042e839151185aa40449cad9c6260b6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 16 14:30:00 2020 +0000

    Bug 19482: (follow-up) Add missing filters and boolean switch to schema
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52be44f406e108544f21e6d45055a9ea9e86c075
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 18 11:32:51 2020 +0000

    Bug 19482: (follow-up) Fix select and adjust export of new field
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 975e06bd7c3e198048c60d4a0f9968ba89079de7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 18 13:06:22 2017 +0000

    Bug 19482: Add support for defining 'mandatory' mappings
    
    To test:
    1 - Apply patch
    2 - ./installer/data/mysql/updatedatabase.pl
    3 - Reset ES mapping: Administration->Search engine configuration , button at bottom of page
    4 - 'issues' and 'title' mapping under 'search fields' should be mandatory and not editable
    5 - On 'Bibliographic records' tab you should not be able to delete the single entry for issues
    6 - You should be able to delete 'title' mappings, however, at the final one you should be stopped by javascript
    7 - Bonus: force remove the last mapping from the page using developer tools - attempt to save and should be warned of missing mandatory mapping
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14f99da17c38ca352939be48eae0a11523e787e0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 18 13:05:40 2017 +0000

    Bug 19482: DB changes
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e3bcc9a2578b3821ff8f39554976fb7b76456db
Author: Lisette Scheer <lisettes@latahlibrary.org>
Date:   Sat Oct 24 19:45:28 2020 +0000

    Bug 25834: Relabel "Search to add" to "Add guarantor" on patron form.
    
    The "search to add" label on the button for adding guarantors is a bit
    hard to translate and is inaccessable. This patch updated the button
    label to "Add guarantor" to fix these issues.
    
    To test:
    1. Go to patrons
    2. Add a new child patron
    3. Observe the button with "search to add"
    4. Save the patron
    5. Edit the patron and observe the "search to add" button.
    6. Apply patch.
    7. Add a new patron
    8. Observe new text on button.
    9. Edit a child patron
    10. Observe new text on button
    11. Sign off
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f272a16b2eb6d200402489b26435eea282ec622
Author: Frédéric Demians <f.demians@tamil.fr>
Date:   Fri Oct 23 18:17:49 2020 +0200

    Bug 26803: Fix PLUGIN_DIR when plugin_dirs is multivalued
    
    When plugin_dir koha-conf.xml parameter contains more than one
    directory, PLUGIN_DIR parameter sent to templates doesn't contain the
    proper value, ie the base directory of the current plugin.
    
    See bug 23237
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 617a012a4cbe1e8ada09c0db3d8e464c36b97255
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 3 15:28:56 2020 +0100

    Bug 23979: Remove final dot
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 291df4e09206399f4de26ef0214db2b8784c9e20
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 6 16:00:30 2020 +0000

    Bug 23979: Move locked message to patron info section
    
    To test:
    1 - Set failed login attempts to some number
    2 - Attempt enough logins with a patront o lock them, or:
        UPDATE borrowers SET login_attempts = 500 WHERE borrowernumber=5;
    3 - Attempt to checkout to borrower, no notice of lock
    4 - View patron details tab, see the locked message
    5 - Apply patch
    6 - Note the message is now in patron info and visible on all tabs for the member
    
    Signed-off-by: George Williams <george@nekls.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93c66100733db0aea73a3e59841981e4ee85e717
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Mon Jan 20 15:44:44 2020 +0100

    Bug 20888: (follow-up) revert unecessary change on jquery selector
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb4df3b29a57b62b82cf7652b40d30aea4a92d9b
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Mon Jan 20 15:36:21 2020 +0100

    Bug 20888: (follow-up) 'is not' operator behaves as 'not like'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 781b5a41188c958213f409310f38ba49dcd13159
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Thu Jan 10 10:48:38 2019 +0100

    Bug 20888: Allow use of boolean operator 'not' in item search
    
    Test plan:
    
     - Apply the patch
     - Check that you have a 'is not' option in the third box in item search
     - Check that you can exclude items from the search results with this 'is not' option
     - Check that you can still combine parameters with 'and' and 'or'
     - Check that the exclusion works for custom fields (see Administration > Item search fields)
     - Check that the exclusion works for custom fields linked to authorised values
    
    Signed-off-by: Amandine Zocca <azocca@ville-montauban.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d80763c3714457bf14fd585513ab07d02b82c819
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 27 15:02:43 2020 +0000

    Bug 26825: Add span for publication date in OPAC
    
    This patch modifies the XSL templates for OPAC results and OPAC details
    so that the parts of the publisher details are wrapped separate <span>s:
    Publisher place, name, and date.
    
    To test, apply the patch "restart_all" if necessary.
    
    You can add this to the OPACUserCSS system preference to better see the
    change:
    
    .publisher_place { color: red; }
    .publisher_name { color: green; }
    .publisher_date { color: orange; }
    
    - Peform a search in the OPAC
    - In the search results, confirm that the publisher plac, name, and date
      are wrapped in separate <span>s, either by confirming the custom
      colors or by inspecting the source.
    - View the details for one of the results. Confirm that the same change
      has been made to the detail page.
    
    Signed-off-by: B Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d23c58e9084176fac3e64b8edbbaa64ddcc164d4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 26 23:12:11 2020 +0000

    Bug 16696: Rename 'Publisher' to 'Publication details' on detail and result lists
    
    To test:
    1) Do a catalog search in staff client
    2) Confirm 'Publisher' says 'Publication details' for each result in search
    3) Click on a record to go to the detail page
    4) Confirm 'Publisher' says 'Publication details'
    5) Click the Items tab on the left
    6) Confirm 'Publisher' says 'Publication details'
    7) Do a search in the OPAC
    8) Confirm 'Publisher' says 'Published' for each result in search
    9) Click on a record to go to the detail page and switch to the items tab
    10) Confirm 'Publisher' says 'Publication details' on top of the page
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd0674ac1009420ba94fb005560e11c883003d73
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 28 12:34:01 2020 +0000

    Bug 26844: Add warning to disabled logs on log viewer
    
    To test:
    1 - Go to Admin->System preferences->Logs tab
    2 - Make sure some logs are disabled
    3 - Go to Tools->Log viewer
    4 - Note you can select logs that are disabled
    5 - Apply patch
    6 - Reload page
    7 - Note disabled logs have a warning icon and hover text
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cbbd6b2ca436990f51b8d1b1985074c2620259c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 30 12:10:03 2020 -0300

    Bug 26310: (QA follow-up) koha-conf-site.xml.in tweaks
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55f2279314edf390e6257942a84f9f9b058c84cf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 27 15:24:58 2020 +0000

    Bug 26310: Allow setting trace_to parameter in Elaasticsearch config
    
    For debugging purposes we may wish to see the requests and responses made to
    Elasticsearch
    
    To test:
    1 - prove -v t/Koha/SearchEngine/Elasticsearch.t
    2 - Set <trace_to>Stderr</trace_to> in koha-conf
    3 - Restart all
    4 - perl misc/search_tools/rebuild_elasticsearch.pl
    5 - Note requests are shown
    6 - Set
        <trace_to>File</trace_to>
        <trace_to>/var/log/koha/kohadev/plack-error.log</trace_to>
        in koha-conf
    7 - Restart all
    8 - perl misc/search_tools/rebuild_elasticsearch.pl
    9 - Check the plack log and see the ES requests
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7c134e27e044ad4ebe9a0e4aa220f4a05208215
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Oct 15 10:48:52 2020 +0200

    Bug 26687: Add a Font Awesome icon for superlibrarian patrons
    
    Bug 26534 adds a shield Font Awesome icon to help identify staff
    patrons. I propose to add an icon when patron is a superlibrarian.
    
    Patch adds 'is-superlibrarian' class that may be used for more CSS
    tuning.
    
    Test plan:
    1) Compare display between a patron A beeing superlibarian and a patron
       B having only staff interface access
    2) Patron B has only shield icon
    3) Patron A has shield icon and bolt icon
    4) Check a patron without permissions has no shield icon
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e91b565055892e6c79cd842a975efd83bd566f52
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 26 12:31:16 2020 +0000

    Bug 26817: Change checkouts table footer colspan based on ExportCircHistory
    
    This patch makes a minor change to the include file which generates the
    checkouts table footer. It now includes some logic checking for the
    ExportCircHistory system preference, adjusting the colspan accordingly.
    
    To test, apply the patch and enable the ExportCircHistory system
    preference.
    
    - Check out to a patron who has checkouts. In the table of checkouts
      there should be an "Export" column. The footer at the bottom of the
      table should span the width of the table.
    - Disable the ExportCircHistory preference.
    - View the checkout page again and confirm that table footer still looks
      correct.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0833724afe7cb0d2f2db32c7e87f3df064e6a016
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Oct 26 10:49:49 2020 +0100

    Bug 26032: (follow-up) show 'is new' filter only if items.new_status is used
    
    Also adds a class 'item-new-status' to this filter to be able to hidde
    even if items.new_status used.
    
    Addition to test plan:
    1) Apply on a database without Koha to MARC mapping on items.new_status
    2) Check you dont see the 'is new' filter in items search form
    3) Apply on a database with Koha to MARC mapping on items.new_status
    4) Check you see class 'form-field item-new-status'
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07cab93d5d9bd292368e097305f309419e746e2f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Oct 16 10:45:41 2020 +0200

    Bug 26032: (follow-up) Replace IFNULL() mysqlism with COALESCE()
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@outlook.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a874de3f42ef02d0eb9e7e8512f952da5a7152a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jul 21 11:43:55 2020 +0200

    Bug 26032: Add 'is new' filter in items search
    
    In items search, add a filter on value of items.new_status with a Ignore/Yes/No.
    Yes meaning != 0, No meaning = 0, with considering that NULL value is like 0.
    
    This patch adds 'isnull' option to filter, this may be reused on other
    fields.
    
    Test plan :
    1) Define an item subfield on items.new_status with authorised values YES_NO (0 or 1)
    2) Edit an item A to set new_status=1
    3) Edit an item B to set new_status=0
    4) Perform an item search with 'is new' = 'ignore' => you get all items
    5) Perform an item search with 'is new' = 'yes' => you get item A
    6) Perform an item search with 'is new' = 'no' => you get all items but A
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@outlook.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5da551a6a219436b001ebb0dd35b98414de1d378
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jul 21 12:26:55 2020 +0200

    Bug 26032: Add unit test
    
    Run prove t/db_dependent/Items.t
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@outlook.com>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77365090f57fe83eff37402f6dcc725fdee00c92
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 4 11:53:04 2020 +0000

    Bug 25333: DBRev 20.06.00.058
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80bf7abb5cd309ae28cd588df9037231e11683e5
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Nov 1 03:45:56 2020 +0000

    Bug 25333: (QA follow-up) Change phone to itiva on overduerules.tt
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0b41a7c5a9634c3229b25424dd449e0bebcf6f6
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 29 14:17:55 2020 -0400

    Bug 25333: (QA follow-up) Update opac messaging for new transport name
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebbee18822f73c8e8f2236b13a66ba653bebe03f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Apr 30 14:09:02 2020 -0400

    Bug 25333: Change message transport type for Talking Tech from "phone" to "itiva"
    
    From its inception, phone notices via Talking Tech have not behaved like
    other notices. Instead of reading notices generated by Koha, the Talking
    Tech scripts largely generate their own notices.
    
    We would like to pave the way to having "generic" phone notices that can
    be processed by plugins to support arbitrary telephony vendors ( we will
    be targeting Twilio initially ).
    
    To that end, it seems sensible to begin by changing the messaage
    transport type for Talking Tech from 'phone' to 'itiva' to
    highlight its specificity and difference from standard message
    transports.
    
    Test Plan:
    1) Apply this patch
    2) Run updatedatabase.pl
    3) Restart all the things!
    4) Test Talking Tech outbound script
    5) Note no changes in functionality
    
    Signed-off-by: Christopher Zorn <Christofer.Zorn@ajaxlibrary.ca>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: remove uneeded indentation change in sample_notices_message_transports.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 301528d6df117f9183d09189d7a596cdf431f77e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 2 15:16:40 2020 +0000

    Bug 25469: Typo: Item does not belongs to your library
    
    This patch makes corrections to two strings in the batch delete template
    to correct a typo. Before:
    
    t("Item does not belongs to your library")
    
    ...after,
    
    t("Item does not belong to your library")
    
    To test, apply the patch and inspect the template to confirm that the
    string is correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4cf9a59b400a97b51ab25720eaf40c60d81e2d42
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Nov 1 02:02:04 2020 +0000

    Bug 24012: (QA follow-up) Use standard patterns
    
    - Removes the scss change in favor of adding the space to the
      HTML as is the usual pattern when using Font Awesome icons
    - Removes the span with the inline style to make things appear as
      black by default (no danger here in it being locked?)
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1c5c5b060115f9e025fce17d602509738319b90
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sat Oct 24 18:02:59 2020 +0000

    Bug 24012: Budget 'Locked" text colour changed and lock icon added
    
    Test plan:
    1. Go to Administration
    2. Click on Budgets
    3. Add a new bdget and check the 'Lock budget' box
    4. Click on the 'Inactive budgets' tab
    5. Note that 'Locked' is displayed in green
    6. Apply patch
    7. Compile the sass files (setup detailed here:https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_interface ) by running:
    yarn build
    
    8. Refresh the page and notice the 'Locked' text is now red, and there
    is a lock icon to the left of the text. There is a space between the
    lock icon and the 'Locked' text.
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ccc73353c651659c7e0816bfa57fe2d7b8d82b5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Nov 3 08:09:22 2020 +0000

    Bug 25897: (QA follow-up) Add filters
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b72de018132acaae77ebc3852ed369cf45edc8fb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 19 00:38:31 2020 +0000

    Bug 25897: Use cn_sort for sorting callnumbers in inventory table
    
    Instead of using the machine sortable form of the callnumber from
    cn_sort the table was only sorting on the callnumber. This tries
    to fix it using the same technique as for sorting the differently
    formatted dates.
    
    To test:
    - If your database has items with suitably cataloged items, use
      these. Otherwise you could use the examples from the bug report:
    
    - Catalog items with the following barcodes:
       B 29 V55 1998
       B29 .C55 2008
       B29 .L24 1983
       B29 .L264 1998
       B29 .P666 2004
      Make sure the LOC is selected in $2 as source of classification
      This makes sure the sortable form of the callnumber is calculated
      correctly.
    - Go to inventory
    - Search for your items
    - Before patch, they should sort on callnumber as above, after the
      patch the correct sort order should be:
       B29 .C55 2008
       B29 .L24 1983
       B29 .L264 1998
       B29 .P666 2004
       B 29 V55 1998
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ba1d7a22b2fccb093fcdb9f20b6bf2dfec04e91
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Nov 3 08:09:35 2020 +0000

    Bug 26664: (QA follow-up) Add filters
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9adafd6404cfdc3f1fc52445e32d8f8b121ccc4e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 5 17:48:45 2020 +0000

    Bug 26664: Fix sorting for date last seen in inventory tool
    
    This adds the standard datatable sorting for dates to the inventory
    table as described here:
    https://wiki.koha-community.org/wiki/DataTables_HowTo#Sorting_dates_regardless_of_date_format_preference
    
    To test:
    - Go to the inventory tool
    - Search for a big sample list of items with different date last seen
    - Sort the table now by "date last seen" by clicking on the table header cell
    - Try different settings of the DateFormat system preferences
    - Verify sorting is incorrect (alphabetic, not by date)
    - Apply patch
    - Repeat testing and very all is sorting correctly now
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7938f5f86ca4d54e230af415ecae87eda38a324
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 4 11:53:04 2020 +0000

    Bug 26638: DBRev 20.06.00.057
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76da06b6a30a8df29353fa5fabc825e609b2a0d7
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Oct 17 16:02:55 2020 +0000

    Bug 26638: Remove unused system preference ArticleRequestsMandatoryFieldsItemsOnly
    
    The preference was probably added because of a typo, as there is a
    used system preference ArticleRequestsMandatoryFieldsItemOnly
    (Item vs Items).
    
    This patch fixes the situation:
    
    - syspref.sql had the pref name with the typo, this is fixed.
    - A database update removes the unused variable and makes sure
      the used one is added.
    
    To test:
    - Look at the local use system preferences, verify the false pref is there
    - Look at the other ArticleRequests* preferences, verify the other without "s"
      is there
    - Apply patch and run database update
    - Verify the local use tab one is gone now
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d80421ce855fd9069dbe1e7cd6b1ea42a665899b
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 26 22:40:50 2020 +0000

    Bug 11460: Remove MARC21 default mapping from itemcallnumber system preference
    
    The mapping in the itemcallnumber system preference is only valid
    for MARC21 libraries using DDC classification, but not for libraries
    using UNIMARC or other classification.
    
    This patch suggests to remove the default mapping and start new installations
    with an empty value.
    
    To test:
    - On an emtpy database
    - Apply patch
    - Run the web installer, selecting either MARC21 or UNIMARC
    - Verify that the itemcallnumber system preference is empty
    - Verify the description now also include examples for UNIMARC
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9441537e5436b43805d578108ebee0c8394eb5aa
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Oct 27 09:03:16 2020 +0100

    Bug 26832: Make Elasticsearch mappings export use UTF-8
    
    Script misc/search_tools/export_elasticsearch_mappings.pl allows to export current search engine configuration into a YAML file.
    This export should use UTF-8 encoding, like other exports.
    
    Test plan :
    1) Go to Administration > Search engine configuration (Elasticsearch)
    2) Edit a field label to use a diacrtic, for example local-number => Numéro
    3) Save
    4) Edit file etc/koha-conf.xml to enable 'elasticsearch_index_mappings'
    5) Export mappings to file via misc/search_tools/export_elasticsearch_mappings.pl -t $MARCFLAVOUR
    6) Reset memcached and plack
    7) Back to Administration > Search engine configuration (Elasticsearch)
    8) Click on 'Reset Mappings' and accept
    9) Look at field 'local-number'
    => Without patch diacritic 'é' is broken
    10) You may try with an emoji B-)
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d34b54ab6954d4c162d0f83a3cad96e4a61bab2d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 3 10:35:17 2020 -0300

    Bug 26738: (QA follow-up) Add missing filter
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd742a15dd0a889b158f4e841918175763ae83f9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 2 15:01:32 2020 +0100

    Bug 26738: (bug 24819 follow-up) Fix manager selection
    
    Bug 23590 added a new feature to select the manager of a suggestion.
    One month later bug 24819 added the ability to pick the suggester.
    
    This second patchset broke the manager selection.
    
    This patch simplifies the way the suggester is selected, using the
    generic way and mimicking what is done for the manager.
    
    Test plan:
    - create a new purchase suggestion from within acquisitions (suggestion.pl?op=add)
    - click "select manager," search for user, click Select
    - see that the user you just selected shows under "Created by,"
    - see that "Managed by" still says "You"
    - modify the suggester
    - save your suggestion
    => Everything is saved correctly
    
    QA will test the permission alert:
    Edit suggestion.tt and remove "&permissions=suggestions.suggestions_manage"
    Edit the suggestion, select a manager, pick a patron in the list who
    does not have sufficient permissions, save
    => you get the alert
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20431a03360583b705d3e2b2e3a60b2ff1f29474
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Nov 2 09:50:42 2020 -0500

    Bug 26896: Enable SIP option holds_block_checkin to actually block checkin of items with holds
    
    It appears that at some point, the actual blocking of checkins on items
    with holds got lost from the patch set. This slipped by because the sip
    server still outputs everything correctly, but the unit tests don't
    actually test to see if the checkout still exists afterward!
    
    Test plan:
    1) Apply this patch
    2) Prove t/db_dependent/SIP/Message.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Matthias Meusburger <matthias.meusburger@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa3829b120c1909dd1a1408392c3f27479779b03
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 3 10:46:10 2020 +0100

    Bug 26806: Remove 1 remaining occurrence of jquery.checkboxes.min.js
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3b87dc7d909997f0af47e02462e87eae2aee308
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 23 18:45:37 2020 +0000

    Bug 26806: Remove the jquery.checkboxes plugin from the staff client
    
    This patch removes the jquery.checkboxes plugin from the staff client.
    
    It also removes some leftover instances of the "checkboxed" class which
    was used in some cases to enable the checkbox plugin on selected
    elements.
    
    To test, apply the patch and check that the jquery.checkboxes plugin no
    longer exists in /intranet-tmpl/lib/jquery/plugins.
    
    To test changes to the templates, confirm that "Check all" and "Check
    none" links still work on these pages:
    
    - The tags review page. See the test plan for Bug 26120.
    - The inventory page. See the test plan for Bug 26150.
    - The list contents page. See the test plan for Bug 26204.
    
    The other modified templates contained the "checkboxed" class but it
    served no purpose:
    
    - Serials -> Serials collection
    - Labels -> Edit label batch
    - Patron cards -> Edit card batch
    
    If you search the Koha codebase for instances of "checkboxed" the only
    results should be from the OPAC (if Bug 26805 hasn't been applied) and
    in Z39.50 templates where the class is still used by JavaScript.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93176f9e613175244504afeae6c1a902c6d52e33
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 23 14:42:35 2020 +0000

    Bug 26800: Remove the use of jquery.checkboxes plugin from checkout page
    
    This patch removes inclusion of the jquery.checkboxes plugin from the
    patron checkout page (circulation.tt). The plugin is unused.
    
    To test, apply the patch and check out to a patron with checkouts.
    
    - Open the checkouts tab and click "Show checkouts" if necessary.
    - In the table of checkouts, confirm that the "select all" and "none"
      links in the "Renew" and "Check in" column headers work correctly.
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 689f1f9b1f5f53c18c2a351f0fb2195631749de6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 23 13:54:01 2020 +0000

    Bug 26799: Remove the use of jquery.checkboxes plugin from patron payment page
    
    This patch removes the use of the jquery.checkboxes plugin from the
    patron payment screen (members/pay.tt).
    
    To test, apply the patch and locate a patron with unpaid fines.
    
    - View the "Accounting" page for that patron.
    - In the table of outstanding fines, test the "Select all" and "Clear
      all" links work correctly to check the checkboxes corresponding to
      each fine.
    - Confirm that the "Select all" action enables the "Pay selected" and
      "Write off selected" buttons.
    - Confirm that the "Clear all" action disables the "Pay selected" and
      "Write off selected" buttons.
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 296189dc6c92aa691c96ee3012834cd83990aca5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 23 13:34:36 2020 +0000

    Bug 26798: Remove the use of jquery.checkboxes plugin from patron detail page
    
    This patch removes inclusion of the jquery.checkboxes plugin from the
    patron detail page (moremember.tt). The plugin is unused.
    
    To test, apply the patch and locate a patron with checkouts.
    
    - View the details for that patron.
    - Open the checkouts tab and click "Show checkouts" if necessary.
    - In the table of checkouts, confirm that the "select all" and "none"
      links in the "Renew" and "Check in" column headers work correctly.
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 919ea33639714dd6a0d5e0550af2dda6ad6e687e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 23 12:41:50 2020 +0000

    Bug 26795: Remove the use of jquery.checkboxes plugin from ILL pages
    
    This patch removes the inclusion of the jquery.checkboxes plugin from
    two staff interface ILL pages where the plugin is unused.
    
    To test you need at least one patron with some ILL requests.
    
    - Apply the patch and locate a patron with ILL requests.
    - Click the "ILL requests history" tab.
    - Confirm that the table of requests has no checkboxes.
    - Choose "Ill requests" from the "More" menu in the header.
    - Confirm that the table of requests has no checkboxes.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc1152bf3c6fefdbfa72dab8dbbd5c1307183920
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 22 10:33:41 2020 +0000

    Bug 26769: Remove the use of jquery.checkboxes plugin from staff interface search history
    
    This patch modifies the staff interface search history page to eliminate
    theuse of the jquery.checkboxes plugin.
    
    To test you should have some search history items for bibliographic and
    authority records, both from today and from days previous.
    
    Apply the patch and click the logged-in-user link in the staff client
    header. Choose "Search history."
    
    On the search history page, test the "Select all" and "Clear selection"
    links corresponding to all four tables:
    
    - Catalog: Current session
    - Catalog: Previous sessions
    - Authority: Current session
    - Authority: Previous sessions
    
    In all cases the links should work correctly, affecting only the
    corresponding tables. Confirm that the "Select all" action enables the
    corresponding "Delete" link for each table.
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72842e85dd60d216c9b929e819ff360079a54383
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 17:25:47 2020 +0000

    Bug 26768: Remove the use of jquery.checkboxes plugin from library transfer limits page
    
    This patch modifies the library transfer limits page to eliminate the
    use of the jquery.checkboxes plugin.
    
    To test, apply the patch and go to Administration -> Library transfer
    limits.
    
    - Test the "For all collection codes" links, "Select all" and "Clear
      all." Each should affect all checkboxes on all tabs.
    - Click various tabs and confirm that the "select all" and "clear all"
      links within that tab work correctly, affecting only the checkboxes in
      that tab.
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 231f99e3e1d892864aebab229d0c312a2f31182c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 17:26:56 2020 +0000

    Bug 26767: Remove the use of jquery.checkboxes plugin from duplicate orders template
    
    This patch removes the use of the jquery.checkboxes plugin from the
    duplicate orders template in acquisitions.
    
    To test, apply the patch and go to Acquisitions -> Vendor -> Basket.
    
    - Click "Add to basket."
    - Click "From existing orders (copy)."
    - Perform a search which will return some orders.
    - Test the "Select all" and "Clear all" links. Confirm that they work
      correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8220aa14f92ecae8f55138e7570fcb41a1ad1872
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 23 18:14:34 2020 +0000

    Bug 26805: Remove remaining instances of jquery.checkboxes plugin from the OPAC
    
    This patch removes the use of the jquery.checkboxes plugin from the 5
    templates in the OPAC which still use it. The plugin itself is removed.
    
    To test, apply the patch and test the "Select all" and "Clear all" links
    work to select and deselect checkboxes on the following pages:
    
    - The catalog search results page: The controls should also enable
      and disable the "Select titles to..." menu.
    - The list contents page:  The controls should also enable
      and disable the "Select titles to..." links.
    - The suggestions page: The controls should also enable
      and disable the "Select suggestions to..." link.
    - The search history page: The controls should affect only the
      corresponding table ("Current" or "Previous") and should enable and
      disable the "Select searches to..." link.
    
    This patch also modifies the template for grouped search results, as
    enabled by the OpacGroupResults system preference, but I don't know how
    to test it.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff52478d09b522974c436904b0145bab83d88127
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 17:55:26 2020 +0000

    Bug 26694: Set focus for cursor to search input box on guarantor_search.pl
    
    This patch adds the "focus" class to the patron search field so that
    cursor focus is set when the page loads.
    
    To test, apply the patch and view an adult patron record in the staff
    client.
    
    - Click the "Add guaratee" button in the patron toolbar.
    - On the following "Add patron" page, click the "Search to add" button
      in the "Patron guarantor" section.
    - A popup window should appear, and the focus should automatically be on
      the first form field.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ea60c0bd94cbbcd22e88e59d95131078aa2bc50
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 15:15:13 2020 +0000

    Bug 26695: Add modal "shown" event to set cursor focus
    
    This patch attaches a focus() call to the login modal's "shown.bs.modal"
    event so that the cursor focus is set to the username field when the
    login modal is displayed.
    
    To test, apply the patch and confirm that your OPAC uses the regular
    login process--not casAuthentication or GoogleOpenIDConnect.
    
    Click the "Log in to your account" link in the header. A the login form
    should appear in a modal dialog, and the focus should be on the username
    field.
    
    The same should be true if you trigger the modal from other
    locations, for instance: "Log in to add tags" on the bibliographic
    detail page or the tag cloud page.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74aba6abb57421a8c333974d3e5a48a9c46381ea
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 14:16:41 2020 +0000

    Bug 26712: Set focus for cursor to basket name input box on basketheader.pl
    
    This patch adds the "focus" class to the basket name field in the form
    for creating a new basket in acquisitions.
    
    To test, apply the patch and go to Acquisitions -> Vendor -> New basket.
    
     - Upon page load the cursor should be focused on the basket name field.
     - The same should be true if you edit an existing basket.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b08444d31c663345d04011c061585c53d99076c5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 20 15:38:21 2020 +0000

    Bug 26753: Set focus for cursor to password field on Overdrive login popup on OPAC
    
    This patch modifies the OverDrive login process so that clicking the
    "Log in to your OverDrive account" link automatically puts the focus on
    the password field when the modal displays.
    
    Unrelated change: A redundant "document.ready" function has been
    removed.
    
    To test you must have OverDrive credentials set in system preferences.
    
     - Log in to the OPAC.
     - On the "Your summary" page, open the "OverDrive account" tab.
     - Click the "Log in to your OverDrive account" link.
     - A modal dialog should appear, and the cursor focus should
       automatically be on the password field.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7815e37258498bf4034c738af17c64bf5941eff5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 26 20:59:52 2020 +0000

    Bug 26826: Set focus for cursor to name input box when creating a new list
    
    This patch adds the "focus" class to the list name input field so that
    it automatically has focus when the page loads.
    
    To test, apply the patch and open the lists page in the staff client.
    
    - Click "New list."
    - When the list creation page loads the "Name" field should have focus.
    
    Signed-off-by: B Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27735ed40deaf438e622acee0d41147bdbe2d5e1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 27 10:45:18 2020 +0000

    Bug 26828: Set focus for cursor to current password field when updating in the OPAC
    
    This patch adds the "focus" class to the first field in the
    OPAC's password update form so that the field automatically receives
    focus upon page load.
    
    To test, apply the patch and make sure the OpacPasswordChange system
    preference is enabled.
    
    - Log in to the OPAC
    - Open the "Change your password" page
    - The cursor should automatically be in the "Current password" field
      when the page loads.
    
    Signed-off-by: B Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b127f862ee991aefba80f9d7238615a93953370b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 26 19:46:30 2020 +0000

    Bug 26830: Set focus for cursor to name input box when creating a new list in the OPAC
    
    This patch adds the "focus" class to the list name input box in order to
    automatically set focus on the field.
    
    To test, apply the patch and log in to the OPAC.
    
    - Go to Lists -> New list.
    - The cursor focus should automatically be on the "list name" field.
    
    Signed-off-by: B Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42060794fc48dfe649a1a8aba1d7db2e7ff1c09d
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Oct 30 19:03:18 2020 +0000

    Bug 26880: Add explanatory text to add course reserve pages
    
    To test:
    - go to course reserve add item and batch add items pages
    - batch add has a little bit of explanation, add has none
    - apply patch, restart, reload pages
    - both pages have more text explaining how they work!
    
    "Checking the box next to the field label will enable changes to that field. Leave boxes unchecked to make no change.<br>
    Any items with existing course reserves will have their on reserve values updated."
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9be2c3639b28b8820e67911f88d642992cd1f7d9
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Oct 30 20:58:30 2020 +0000

    Bug 26881: Remove period on limit to available items on opac
    
    To test:
    1- do a search on the opac
    2- on the results page, it says "Limit to currently available items."
    3- apply patch, restart, reload
    4- period is gone
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Barbara Johnson  <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0a42b7ed53fd043c9a96817f91416d1cfe7a6c9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 2 12:28:09 2020 +0000

    Bug 26889: Remove extra space from "Damaged :" in item search
    
    This patch adds the chomp shorthand [%- -%] to the BLOCK for showing
    labels in the item search template. This collapses the whitespace around
    the label, eliminating the unwanted space around the ":"
    
    To test, apply the patch and go to the item search page in the staff
    interface. There should be no space before the colon in the "Damaged"
    label.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adfed0a945eb00ff0fe501ff1c90e25076777a34
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Oct 16 01:23:41 2020 +0200

    Bug 26696: Fix colspan in payment table when credit exists
    
    The colspan was adjusted for the total due when a new column
    was added to the table, but the 2 lines for credits were missed.
    
    To test:
    - Go to any patron account
    - Create a manual invoice
    - Create a credit
    - Go to the 'Make a payment' tab
    - Veriy that the total lines at the bottom of the table are
      slightly off
    - Apply the patch
    - Verify that the total lines in the table now display correctly
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba865cc532e5150882398f5958968bd4bd549a12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 2 11:26:44 2020 +0100

    Bug 26892: Remove warnings from Koha/Patrons.t
    
    Test plan:
    Confirm that the warnings "item-level_itypes set but no itemtype set for item"
    disappear after applying this patch
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a87cc310b5836b6808c8836ee9e38b3dd725160
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 24 01:51:55 2020 +0000

    Bug 25167: (QA follow-up) Don't add a new variable
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1181402eee9392fddf0e3a64de5941880485c074
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Wed Apr 8 09:33:44 2020 +0200

    Bug 25167: Fix to a fix wrong inventory results
    
    Test plan :
    - Check you have in default framework an item subfield mapped with items.notforloan and with an authorized value catergory,
      for example 'NOTFORLOAN'
    - Create a new value in this category, for example '9'
    - Create a biblio with default framework
    - Create an item with barcode='000AAA1', callnumber='A-1' and notforloan=0
    - Create an item with barcode='000AAA2', callnumber='A-2' and notforloan=9
    - Create a file 'barecodes.txt' containing 2 lines '000AAA1' and '000AAA2'
    - Go to inventory tool : /cgi-bin/koha/tools/inventory.pl
    - Choose file in 'Barcode file'
    - Enter item callnumber between 'A-0' and 'A-9'
    - Check 'Compare barcodes list to results'
    - Submit=> without patch, you get no warnings
    - Redo the same inventory but with checking items.notforloan 'For loan'
      (using the browser back page is ok)
    - submit => still no warning, Bug 000AAA2 must be listed it's not 'For loan'
    - Apply patch, repeat, with tems.notforloan 'For loan' checked you get the
      right warning
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd83a9b6bc1eaf27d6522b824da76f5e9e5f0be4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Sep 7 13:08:46 2020 +0100

    Bug 26398: Restore translations for credit/debit type dropdown
    
    1) run ./translate update xx-XX
    2) Translate this big chunk in your xx-XX-staff-prog.po or make sure it's translated
    
    msgid ""
    "%s %s %sPayment %sWriteoff %sForgiven %sCredit %sLost item fee refund "
    "%sRefund %s%s %s %s %s %sAccount creation fee %sAccount renewal fee %sLost "
    "item %sManual fee %sNew card %sFine %sLost item processing fee %sRental fee "
    "%sDaily rental fee %sRenewal of rental item %sRenewal of daily rental item "
    "%sHold fee %sHold waiting too long %sPayout %s%s %s %s %s "
    
    (tip: I search the po file for "Forgiven", there are only two occurrences)
    
    3) run ./translate install xx-XX
    4) In your staff interface in your other language, go to a patron's account > Accounting > Create manual Credit
    5) Check that the values in the credit drop down are in English
    6) Apply patch
    7) redo steps 1-4 (careful, the string to be translated changes)
    8) Do a hard refresh (Ctrl+F5) (I guess you'd have to restart plack if you have it)
    9) Values in the credit drop down are translated
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 915b4431e5d8cb45c644bb383adbccc41813e4fc
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 18 15:14:48 2020 +0000

    Bug 26721: Fix permission check on debit and credit type admin pages
    
    At the moment the pages falsely check for parameters_remaining_permissions,
    but they should check the specific manage_accounts permission.
    
    To test:
    - Create a new staff user with only catalog and manage_acccounts
      permissions
    - Log in with this staff user and go to the admin page
    - You will see the debit and credit type sections, but won't be
      able to access them
    - Apply the patch
    - Veriy the links still show, but pages are now accessible
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dee550e346d8a998335eb7ce77b4a064a1d129a
Author: Philippe Blouin <blou@inlibro.com>
Date:   Mon Nov 2 14:24:50 2020 -0500

    Bug 26900: Fixes Koka::Libraries typo in C4/Reserves.pm
    
    Plain simple:
    
    my $home_library = Koka::Libraries->find( {branchcode => $item->homebranch} );
    
    This patch replaces 'Koka' by 'Koha'.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80d3f7f910e11c36b5dc20535bc18faf9fbfa8a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 3 10:57:13 2020 +0100

    Bug 26853: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 507c9a64479ace842558e04b1f565ab38086954c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 3 09:50:14 2020 +0000

    Bug 26853: DBRev 20.06.00.056
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b70bd03f7371deb8dd7ef25e2036c0bbc9b1698
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Oct 29 05:23:10 2020 +0000

    Bug 26853: Throw a fatal error if import_biblios insert fails
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e39b9684d5cd0ce15a3d1f07d7691b832309287b
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Oct 29 05:20:53 2020 +0000

    Bug 26853: Harmonize import_biblios with biblio and biblioitems
    
    This patch harmonizes the column datatypes of import_biblios
    with biblio and biblioitems to prevent database errors which cause
    staged MARC uploads to sometimes fail to update 100% correctly.
    
    To test:
    1. Go to http://localhost:8081/cgi-bin/koha/tools/stage-marc-import.pl
    2. Upload a file with MARC records with titles longer than 128
    characters long
    3. Click "Stage for import"
    4. Monitor /var/log/koha/kohadev/intranet-error.log for
    database errors
    5. Note that there are no database errors
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd63fb2bb941294371a072fea9fc2f930ff5bf3f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 26 11:17:40 2018 -0300

    Bug 26639: Add auto_savepoint to DBIC connection
    
    See comment 0.
    
    https://metacpan.org/pod/distribution/DBIx-Class/lib/DBIx/Class/Manual/Cookbook.pod#Nested-transactions-and-auto-savepoints
    
    Otherwise:
    DBIx::Class::Storage::txn_rollback(): A txn_rollback in nested transaction is ineffective! (depth 1) at t/db_dependent/Koha/Objects.t line 274
    
    Possible side-effects? Slowness?
    
    We need to push it to master ASAP and see how our test suite behave.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 165a1bcef8fe59e7bfd5571de5fd76e3b5560e93
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 15:42:09 2020 +0200

    Bug 26592: (follow-up) fix typo
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c2f9a021ad619a426b395c7e540f7ede70382b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 1 11:22:46 2020 +0200

    Bug 26592: Prevent XSS vulnerabilities when circ/ysearch.pl is used
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80c3e543163053836a171bde03c9afd70e5b838a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 2 12:46:59 2020 +0000

    Bug 26581: (follow-up) Skip merge when deleting authority
    
    Tests failing, seems to be because the indexes haven't been created yet.
    When deleting authority we perform a 'merge' where we search for biblios
    containing the authority.
    
    Since these are simply tets we can skip this step, avoid the search, and avoid
    a crash
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03742a1e246e68fa62c2f2fff963beba28f35c80
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 2 11:24:02 2020 +0000

    Bug 26781: (follow-up) Adjust tests as fields are no longer completely removed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46c29c8e46670d8ae663a41487b4be37978a6d20
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 2 11:30:04 2020 +0100

    Bug 22806: Remove perlcritic errors
    
    Subroutine "new" called using indirect syntax at line 415, column 18.  See page 349 of PBP.  (Severity: 4)
    Subroutine "new" called using indirect syntax at line 420, column 14.  See page 349 of PBP.  (Severity: 4)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48b1e28015ba9928b558a3507c0e1887242d7ef8
Author: Lisette Scheer <lisettes@latahlibrary.org>
Date:   Tue Oct 27 15:39:38 2020 +0000

    Bug 26724: Improve link text for downloading the CSV file on patron import page.
    
    On tools > Patron Import there is a a link labelled "here" on the right
    side that should be more descriptive. This patch updates the link.
    
    To test:
    1. Go to tools
    2. Under patrons select "Import Patrons"
    3. On the right side of the screen, observe the "here" link in the
    second list item.
    4. Apply patch.
    5. Reload page
    6. Observe the updated link text.
    7. Sign off
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a23d322811daf79825c01cc1ccb76d6cd10abff
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sat Oct 24 17:13:14 2020 +0000

    Bug 13701: Remove hardcoded "two weeks" text from list share confirmation
    
    Test plan:
    1. Enable the OpacAllowSharingPrivateLists system preference
    2. Create a private list and add items to it
    3. In the OPAC click on the private list name and select 'Share list'
    4. Input an email address and observe the text: "You will receive an
    email notification if someone accepts your share within two weeks."
    5. Apply patch
    6. Restart services
    7. Repeat step 3 & 4 and observe the text now displays: "You will receive
    an email notification if someone accepts your share before it expires."
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f1b5318589e5951f0dbf57fc7f3374c38bb26de
Author: Séverine Queune <severine.queune@bulac.fr>
Date:   Fri Oct 30 18:12:56 2020 +0100

    Bug 25700: (follow-up) 2 minor corrections for KohaCon
    
    This patch corrects :
    - the wrong link for KohaCon11
    - a typo on 'workshops' for KohaCon19
    - replace 'hackfest' for 'workshops' for KohaCon20
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7aeb13461d4d618dc698c5ff3d32757394e87b5e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 22 08:58:15 2020 +0100

    Bug 25700: (follow-up) Minor corrections to epoch dates
    
    It looks like we forgot to account for the year change when grabbing
    epoch dates for some of the later KohaCon's. This patch fixes those
    minor mistakes.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95f4014f045d00c9372f04fb3b8cbb52647802e2
Author: Séverine Queune <severine.queune@bulac.fr>
Date:   Wed Oct 21 18:13:30 2020 +0200

    Bug 25700: Complete KohaCons informations in timeline
    
    Last entry for KohaCons on Koha timeline was for 2013.
    This patch :
    - adds KohaCons from 2014 to 2020
    - adds missing link to KohaCons websites for events from 2006 to 2013
    - suppresses dead links for old KohaCons
    - standardizes the display of informations
    
    To test, apply patch and check :
    - there is no typo (especially for October > Octobre)
    - order of dates is correct
    - links to Koha website ou wiki are correct
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c52a9e4cf362949192d3d58adab287cd82effbf1
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Fri Oct 2 14:52:57 2020 -0700

    Bug 26605: Correctly URI-encode query string in call number browse plugin
    
    If you search for a call number like "M KRUEGER CO #11" in the
    cn_browser.pl plugin, your query is cut off at "M KRUEGER CO " because
    the hash isn't escaped, so the browser thinks you are opening a
    window and trying to navigate to the element with the id 11 rather
    than passing the #11 to the server.
    
    To test:
    1) Find the record you will use to test, determing the MARC
    framework it uses by going to Edit > Edit record > Settings
    2) In Administration > MARC bibliographic framework, click MARC
    structure in the Actions menu for that framework
    3) Navigate to the 952 tag, in the Actions menu click Edit subfields
    4) In the tab for o, choose the Plugin cn_browser.pl and click
    Save Changes
    5) Click the Edit button next to one of the items on your record
    6) In the Full call number field, add " CO #11" to the call number
    7) Click the ... next to the field to open the Tag editor
    8) In the popup window, verify that the search field includes the
    " CO #11" you added to the call number
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8dd8f3e5a3fcae140ec58af6c59d831512ae4ae1
Author: David Cook <dcook@prosentient.com.au>
Date:   Fri Oct 16 00:59:58 2020 +0000

    Bug 26702: Remove explicit libnet-stomp-perl from debian/control.in
    
    libnet-stomp-perl is added to debian/control via __AUTODEPENDS__,
    so we don't need to add it manually into debian/control.in
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit daca3478f48ece4f92957eb4b4638d5aa18844a5
Author: Lisette Scheer <lisettes@latahlibrary.org>
Date:   Sat Oct 24 18:18:54 2020 +0000

    Bug 26723: Improve link text on OverDriveAuthName system preference
    
    The OverDriveAuthName system preference contains a link labeled "here"
    to a seperate administration page that should be labeled better. This
    patch renames the link.
    
    To test:
    1. Go to administration
    2. Search the system preferences for OverDriveAuthName
    3. Obeserve the "here" link in the preference.
    4. Apply the patch.
    5. Repeat steps 1-2.
    6. Observe the new link text.
    7. Sign off.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 190f7155f1e9b3100a0dfb91279228033fc28546
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 26 11:55:57 2020 +0000

    Bug 26816: Chomp whitespace around i18n strings
    
    This patch adds the chomp shorthand [%- -%] to the output of i18n.inc to
    prevent extra spaces from being inserted.
    
    To test, apply the patch and perform a catalog search in the staff
    interface which will return results with multiple items.
    
    In the items column, the availability information should not have
    unwanted spaces:
    
    3 items, 3 available:
    
    ...instead of
    
    3 items , 3 available:
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2af19dd31d0846ee0c852304b01f1d060e0ba48
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 27 13:50:12 2020 +0000

    Bug 26833: Logged in library doesn't show with suggestions count
    
    This patch corrects the template variables used by the suggestions
    counts shown on the staff interface home page and the acquisitions home
    page. They should use [% Branches.GetLoggedInBranchname %]
    
    To test you should have some suggestions from multiple libraries.
    
    - Log in to the staff interface.
    - On the home page you should see "Suggestions pending approval,"
      followed by the name of your logged-in library and the count of
      suggestions for your library.
    - Go to the acquisitions page.
    - In the "Pending suggestions" section you should see the same
      information: Your logged-in library name, suggestion count, and the
      count of suggestions at all libraries.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bbf4f7b5fe54a46d2c54a4dc445a0400dfbef23
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 27 15:59:46 2020 +0000

    Bug 17515: Order Z3950 server by rank and preserve ordering
    
    Previously we put all the servers into an object with keys of the server id
    
    This patch converts it to an array of objects to preserve order, and adjusts code to use the array index
    where necessary and store the server id within the array
    
    To test:
    1 - Add some new Z3950 servers, they don't need to be valid
        FIRST
        SECOND
        THIRD
        FOURTH
    2 - Adjust the ranking so FOURTH:1 THIRD:2 SECOND:3 FIRST:4
    3 - Enable and launch the advanced editor
    4 - Click 'Advanced' under search on the left
    5 - Note the list displays in the order you entered the servers
    6 - Apply patch
    7 - Reload
    8 - Order is correct
    9 - With valid servers, confirm that searching still works and servers can be checked or unchecked to include/remove from results
    
    https://bugs.koha-community.org/show_bug.cgi?id=17515
    
    Signed-off-by: B Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1a5fc85a6b829f93d8cc84cc7fb474016e8df61
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Wed Sep 30 10:33:12 2020 +0200

    Bug 22806: (QA follow-up)
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc4639b3f72c84cea3aa950f8350bdfb1f534a80
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Wed Jan 8 14:20:38 2020 +0100

    Bug 22806: Unit Tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc0c687ca5e20447ff72917cf1c2734f580ac7a2
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed Jul 24 11:33:48 2019 +0000

    Bug 22806: (follow-up) CanBookBeReserved and CanItemBeReserved must check AllowHoldsOnPatronsPossessions
    
    As CanBookBeReserved() was failing as $patron and and $biblio were not
    instantiated I fixed that up.
    
    Test plan :
    1 - set AllowHoldsOnPatronsPossessions to "Don't Allow"
    2 - Checkout an item to a borrower
    3 - Try to reserve an item using ILS-DI WebService -> Will work without complaining.
    4 - Cancel the hold and apply patch
    5 - Repeat 3 -> Should not place hold and show error "NotHoldable"
    
    Sponsored-By: Catalyst IT
    Signed-off-by: Laurence Rault <laurence.rault@biblibre.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fd7d5974a0952ea4cf677ca83c18db46e637b5a
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Tue May 14 02:30:26 2019 +0200

    Bug 22806: CanBookBeReserved and CanItemBeReserved must check AllowHoldsOnPatronsPossessions
    
    Test plan :
    1 - set AllowHoldsOnPatronsPossessions to "Don't Allow"
    2 - Checkout an item to a borrower
    3 - Try to reserve an item using ILS-DI WebService -> Will work without complaining.
    4 - Cancel the hold and apply patch
    5 - Repeat 3 -> Should not place hold and show error "NotHoldable"
    
    Signed-off-by: Laurence Rault <laurence.rault@biblibre.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ee41b53168c3a5275533a731160b643909cd110
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 18 15:09:10 2020 +0200

    Bug 26487: Add all MARC flavours for not-onloan-count search field
    
    In admin/searchengine/elasticsearch/mappings.yaml the search field not-onloan-count is defined for MARC21 on 999x.
    This should be for all the MARC flavours, like in Zebra config.
    
    Test plan:
    1) On a UNIMARC database
    2) Reset Elasticsearch mappings
    3) Check search engine config to see field 'not-onloan-count' on 999$x
    4) Same on a NORMARC database
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e37dcafee872cdea378ba845ef49d702a3fbfc5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 1 10:50:17 2020 +0000

    Bug 26583: Remove unneccessary code in AddIssue
    
    The lines to calc due date are doubled
    
    ModDateLastSeen is not needed as we set the item not lost and we can set
    the date as we do for date last borrowed and save a DB store
    
    Largely this is reading the code and confirming the changes make sense
    
    To test:
    1 - Apply patch
    2 - Check out items, confirm it works as before
    3 - prove -v t/db_dependent/Circulation.t
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc71c1ee48194574493d1b6b4488a09c649692d8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 01:49:08 2020 +0000

    Bug 26758: Correct OPAC ILL requests page markup
    
    This patch makes some corrections to the OPAC ILL page which should have
    been included in the upgrade to Bootstrap 4.
    
    To test you must have Interlibrary loan configured and enabled in the
    OPAC. Enter some text in the ILLModuleCopyrightClearance system
    preference.
    
    - Log in to the OPAC and go to the "your interlibrary loan requests"
      page.
    - If you have only one ILL backend set up you should see a "Create a new
      request" button which is styled correctly.
      - This patch makes corrections to the menu which displays if you have
        more than one ILL backend set up, so it would be ideal to be able to
        test it.
    - Upon clickng the "new request" button (or selecting a backend from the
      new request menu) you should be prompted to choose Yes or No in
      response to the ILLModuleCopyrightClearance text. The buttons should
      be styled green and red, respectively.
    - On the new request entry page the "Add new field" and "Create" buttons
      should be styled in the "secondary" grey style.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36342731edd05df2f7ff64964e439c3e38aa82ae
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 2 11:02:24 2020 +0100

    Bug 26706: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d361af6423cfd605519c4e9302c43f34c352d08
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 01:48:12 2020 +0000

    Bug 26706: Fix btn-default styling for better contrast
    
    This patch makes some updates to the OPAC's CSS in order to make
    Bootstrap button styles more consistent. Some CSS has been simplified
    and some has been made more specific.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    View a variety of pages in the OPAC to confirm that button styles look
    good. For example:
    
     - Advanced search.
     - Catalog search results.
     - Bibligraphic details (including sidebar menu links and menus).
       - Subscription details, brief and full
     - "Your summary" page, various tabs.
     - Lists
    
    The more pages tested the better! Be sure to test the hover and active
    states of buttons as well.
    
    Signed off: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddc3459ba5e72f0619a42dacd0f027998f6d3f81
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Oct 24 01:39:56 2020 +0000

    Bug 26808: Improve tab key access to circulation confirmation dialog
    
    This patch modifies the checkout template so that the checkout
    confirmation message can receive focus, improving tab access to the form
    buttons in the dialog.
    
    A "-1" value "tabindex" attribute makes the dialog focusable, and a
    "focus" class automatically triggers focus. The focus and tabindex are
    only set when the template logic says that the alert will require
    confirmation.
    
    To test, apply the patch and open a patron's account for checkout.
    
    - Submit a barcode for checkout which will trigger a confirmation
      dialog. For instance:
      - A barcode they already have checked out
      - A barcode which is checked out to another patron
    - When the page reloads you should see an alert-style dialog, "Please
      confirm checkout." The browser should show a focus outline around the
      dialog.
    - Hitting the tab key should move the focus to the first focusable
      element inside the dialog. If there is a link in the text, this may be
      the first element. If not the confirmation button should be the next
      tabbable element.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d92e3d284e392ad681b095c02965fe57a85a5a1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 29 12:18:56 2020 +0000

    Bug 18051: Set UTF8 Flag for record searches/imports from rancor
    
    The advanced cataloging editor uses Koha::MetaSearcher to find and import records
    from Z3950.
    
    The records are correctly converted to UTF8, however, we need to set the flag in the
    record to ensure they are parsed correctly later
    
    To test:
     1 - Add OHIOLINK as a z39 source as described in earlier comments
     2 - Browse to Cataloging->Advanced editor
     3 - Click Search->Advanced
     4 - Select OHIOLINK
     5 - Search for author 'capek karel'
     6 - Note records look bad
     7 - Apply patch
     8 - Restart all the things
     9 - Repeat
    10 - Success!
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59588c3a3e3390c2796ac417696829fd26fcb4f0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 2 08:42:20 2020 +0100

    Bug 26673: Fix perlcritic complains
    
    This patch fixes the following perlcritic complain:
    Package declaration must match filename at line 19, column 1.  Correct the filename or package statement.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74605e72aa74524984f0411f8db6fd55f2f12148
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 27 14:36:24 2020 +0000

    Bug 26581: (follow-up) Restore unsetting of doreturn
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c46ebbb2e9728ff9f466eaba48af53840ff4a27
Author: Mason James <mtj@kohaaloha.com>
Date:   Tue Oct 27 06:21:50 2020 +1300

    Bug 25898: Fix indirect object notation in debian/list-deps
    
    There's a Parallel::ForkManager call in debian/list-deps that doesn't
    follow the guidelines regarding indirect object notation.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 3df7a02d8198e7a0a0af5459c4c3d2192177b27f
Author: Mason James <mtj@kohaaloha.com>
Date:   Tue Oct 27 07:41:03 2020 +1300

    Bug 18050: move aqbudgetperiods table before aqbudgets, to fix sql error
    
    00:02:16.310 koha_1       | DBD::mysql::st execute failed: Can't create table `koha_kohadev`.`aqbudgets` (errno: 150 "Foreign key constraint is incorrectly formed") at /usr/share/perl5/DBIx/RunSQL.pm line 278, <$args{...}> line 1.
    00:02:16.310 koha_1       | Something went wrong loading file /kohadevbox/koha/installer/data/mysql/kohastructure.sql ([SQL ERROR]: CREATE TABLE `aqbudgets` ( -- information related to Funds
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit dfbc2c9a80bb9af4069d73dab60e8007fa95856c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 26 00:07:32 2020 +0100

    Bug 7143: Update about page for new devs
    
    John Fawcett
    Mark Hofstetter
    Tal Rogoff
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6da94551f122373e9ec418d3c80035c599c18fb5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 24 00:21:55 2020 +0000

    Bug 26726: (QA follow-up) Add line break and 'the' for readability
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c85b3ee07f551644891c86a74d6d2f87bfc9bdeb
Author: Tal Rogoff <tal.rogoff@cass.govt.nz>
Date:   Fri Oct 23 23:02:29 2020 +0000

    Bug 26726: changed the text of the "here" link on the transport cost matrix administration page
    
    test plan:
    1.Set the UseTransportCostMatrix system to disabled
    2.Go to Administration>Transport cost matrix
    3.Blue box at top of the page contains link labelled "here"
    4.Apply patch
    5.Refresh page
    6.Link should now be labelled "UseTransportCostMatrix"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed789b0b57c7cde39d3bde3b3eaf46d81bf96bf6
Author: Hayley Pelham <hayleymapley@catalyst.net.nz>
Date:   Fri Oct 23 23:13:20 2020 +0000

    Bug 26809: Removes full stops from admin-home.tt
    
    To be consistent with the formatting of the Tools module this patch removes
    full stops from administration descriptions.
    
    To test:
    1) Go to Administration module and note inconsistent use of full stops
    2) Apply the patch
    3) Go to Administration module and note absence of full stops on
    descriptions
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf12049ca1b71a5c5ef12092499fb39aea8f36e9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 24 02:07:51 2020 +0000

    Bug 26450: (QA follow-up) Replace tabs with spaces
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17f307285f5d877806ac95fe64ce154be03948b6
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Sep 14 09:59:34 2020 +0200

    Bug 26450: fix typo in plugin template
    
    The UNIMARC field 105 plugin template contains some dropdown menu
    options with unnecessary capitalisation: "w - Religious text".
    
    This patch fixes that.
    
    Test plan: apply the patch, and confirm that the dropdown menu
    options appear in all lowercase.
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17723b5423fcf644026130d8cc75e58986c55efb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 24 00:42:31 2020 +0000

    Bug 26725: (QA follow-up) Add line break and 'the' for readability
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46b371a057e619264ad1c8d39abbcce7745ae734
Author: Tal Rogoff <tal.rogoff@cass.govt.nz>
Date:   Fri Oct 23 22:45:58 2020 +0000

    Bug 26725: link text changed to just system preference name. "system preference" put in sentence case.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3a51fbc552ad89d7ee4604ac502cd2e7a7a8667
Author: Tal Rogoff <tal.rogoff@cass.govt.nz>
Date:   Fri Oct 23 22:10:59 2020 +0000

    Bug 26725: changed the text of the "here" link on the patron attributes administration page
    
    test plan:
    1. set ExtendedPatronAttributes system preferences to "Don't enable"
    2. go to Administration > Patron attribute types
    3. the link text of "here" is displayed in the blue box at the top of
    the page
    4. apply the patch
    5. refresh the page
    6. notice the link text has changed to "ExtendedPatronAttributes System
    Preference"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16e5a9d8dcf7ab332a455ff74e23115fde27a10f
Author: Phil Ringnalda <phil@chetcolibrary.org>
Date:   Fri Oct 2 15:35:04 2020 -0700

    Bug 26606: Correctly URI-encode query string in URL loaded after deleting an authority record
    
    If you search for "this & that" and delete one of the results, after
    it is deleted the search in the reloaded page is for "this " rather
    than for "this & that". The template uses the url filter, which is
    for filtering an entire URI where :, &, #, etc. should be left alone,
    rather than the uri filter which is for filtering a URI component
    where they should be encoded.
    
    To test:
    1) Go to Authorities > New authority > New from Z39.50/SRU
    2) Search for the Author (corporate) this & that collective
    3) Actions > Import, Save
    4) From the detail for that authority, Edit > Edit as new (duplicate)
    5) Edit the 110 field, add 2 at the end and Save
    6) Search authorities for this & that
    7) For one of the ones you created, Actions > Delete, confirm
    8) The page that reloads should have a search for this & that, not
    just for this
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5deb11623e52a531bd1c3a4cff80678800d973d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 26 00:15:59 2020 +0100

    Bug 26782: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 240fdfdb63631ba6b2d84500ecbf93bf309d916e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 22 18:08:08 2020 +0000

    Bug 26782: Add new class for indicating default sort without sortability
    
    This patch adds to the globally-included CSS a class which can be added
    to tables when they are configured using DataTables options that set a
    default sort but don't allow the user to reorder columns.
    
    The new class shows a grey rather than blue sorting indicator and sets
    the cursort to the default pointer rather than the link "hand."
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Go to Administration -> Circulation and fine rules
    
    In the table of circulation rules, confirm that the first two columns,
    "Patron category" and "Item type" have a grey sorting icon in the
    header cell indicating ascencing sort. Hovering the cursor over these
    cells should show a default arrow cursor rather than the link cursor.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54dcce14139bf5c60e98603a667629141296580e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 17:15:30 2020 +0000

    Bug 26766: Correct selection of title during OPAC note confirmation
    
    This patch modifies the JavaScript in opac-user.tt which executes when
    the user submits a checkout note. The script tries to grab the
    checkout's title from an earlier cell in the table row so that it can
    display it in the confirmation message.
    
    Before start ratings were enabled on this page, the title of each
    checked-out item was the only HTML inside this table cell, so it was
    necessary only to grab the HTML contents of the <td>. Now that star
    ratings might be displayed as well we must make the selection more
    specific.
    
    To test, apply the patch and enable both the  OpacStarRatings and
    AllowCheckoutNotes preferences.
    
     - Log in to the OPAC as a user with checkouts.
     - On the "Your summary" page, fill out and submit the "Note" field for
       one of your checkouts.
     - In the confirmation message, confirm that the correct title
       information is displayed as a link to the bibliographic detail page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d10d24e42aaaf4b2e23b52b94aa14ab8745b396f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 11:57:26 2020 +0000

    Bug 26762: Modify template logic in opac-reserves.tt to avoid error
    
    This patch makes a change to the OPAC hold template to prevent certain
    cases where the output is invalid.
    
    To reproduce, perform a search in the OPAC which will return some titles
    which can be placed on hold and some which cannot.
    
     - Select all results (some holdable, some not)
     - Click the "Place hold" link
     - On the "Confirm holds" page the layout will be broken after the
       first instance of the message "There are no items that can be placed
       on hold."
    
    To test, apply the patch and repeat the process above. After the patch
    has been applied the "confirm holds" page should look correct.
    Validating the HTML source should return no errors.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2dab6ab31626970e3c9be841b610575060f8f344
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 20 16:04:11 2020 +0000

    Bug 26756: Fix quotes showing behind some system preference descriptions
    
    This patch adds matching quotes to two OPAC preference descriptions
    which were missing them.
    
    To test, apply the patch and go to Administration -> System preferences.
    
    - Open the "OPAC" tab.
    - Check the descriptions of these preferences:
      - AllowPatronToSetCheckoutsVisibilityForGuarantor
      - AllowPatronToSetFinesVisibilityForGuarantor
    
    There should be no trailing quotation mark.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 599a6cb92e26e37857b344484d6c8b233555f0dc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 20 11:22:07 2020 +0000

    Bug 26619: Cart - The "Print" button is only translated when you are in "More details" mode
    
    This patch adds the "Print" string to datatables.js so that it can be
    picked up for translation.
    
    To test, apply the patch and add some items to the cart in the OPAC.
    
    - Open the cart. You should see a button labeled "Print."
    - The print button should work correctly.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings,
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/opac-tmpl/bootstrap/js/datatables.js for translation:
    
      msgid "Print"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
       > perl translate install fr-FR
    
    - Switch to your newly translated language in the OPAC and
      repeat the test plan above. The translated strings should appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebe08fb745b04899404bed5ceb00c891a518e89c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 18:32:18 2020 +0000

    Bug 25353: Correct eslint errors in additems.js
    
    This patch makes minor changes to additem.js to correct errors
    highlighted by eslint:
    
    - Consistent indentation
    - Notation of global and exported variables and functions
    - Consistent use of the "var" declaration for all new variables
    - Remove variables from function calls which aren't used
    
    To test, apply the patch and use your preferred eslint-enabled tool to
    check for errors. There should be none.
    
    If you don't have eslint integrated in your development environment you
    could use the online ESLint demo at https://eslint.org/demo.
    
    The demo isn't configured to assume a browser environment with jQuery
    present, so you'll have to modify the top line after pasting the
    contents of additem.js:
    
    /* global $ alert window __ */
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70c64fad46a91f910a00d59149000b982705fd24
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Oct 17 15:08:59 2020 +0000

    Bug 26526: Relabel checkout note column in OPAC
    
    When checkout notes are active, there is currently a new
    column labelled 'Note' in the checkouts table in OPAC.
    When a note is added, this is sent to the library. For
    the user it's not clear from the label, that these notes
    are not personal, but for reporting to the library.
    The new label "Report a problem" aims to make this clearer.
    
    To test:
    - Turn on AllowCheckoutNotes system preference
    - Check out some items to your account
    - Go to the OPAC
    - Look at the list of checkouts
    - Apply patch
    - Reload the page and check the checkouts table again
    - Verify the heading has changed from "Notes" to "Report a problem"
    - Hover over the heading with your cursor to see some more info
    
    Bonus: Patch adds an id "checkout-notes" to the header cell, that
    will make it easier for libraries to change text or style if needed.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b8bcd9dc3b19534c52a7cdbb91bbac5a5cf5db3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Oct 25 23:12:15 2020 +0000

    Bug 18050: DBRev 20.06.00.055
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c8bef50a223e70fe3023222f5f940a2b1771b5d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 5 06:17:34 2020 +0000

    Bug 18050: (QA follow-up) Adjust conditions and make use of message text
    
    - When we run into invalid data, we use Augustin's suggested solution
      and copy the data into a separate table, setting the budget_period_id to
      NULL.
    - We amend the output using the new $message.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1193dddd8beb4a10a78e385b221c0f908d92dcf6
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri Oct 9 15:14:26 2020 -0300

    Bug 18050: (follow-up) Force adding FK constraint
    
    When there are inconsistent budget_period_id in aqbudgets this patch
    creates the table _bug_18050_aqbudgets with the original data, then sets
    the column to null and warns the user that there is inconsistent data.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2800b53bdd6df1e87f72673bc79ed4896f4e4e35
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 23:31:52 2020 +0000

    Bug 18050: Add relation alias to schema
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ee81885b809a95fa12bf39dd0ce1bd839218aef
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 23:30:22 2020 +0000

    Bug 18050: DBIC schema changes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ce62b29bf5ebe30125eb4c631de11391134f109
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 22:42:27 2020 +0000

    Bug 18050: Add FK constraint on aqbudgets.budget_period_id
    
    This adds a FK constraint on aqbudgets.budget_period_id so that
    a fund cannot be added with an invalid aqbudget.budget_period_id.
    
    We should not have funds that belong to no budget. In case we have, the
    update will be skipped and a note displayed.
    
    Part1:
    - Before applying the patch
    - Make sure you have a budget with some funds linked to it
    - You will have to change one of the funds to link to an invalid
      budget with SQL:
      UPDATE aqbudgets SET budget_period_id = 999 WHERE budget_id = max(budget_id);
    - Apply patch
    - Run updatedatabase - verify that you see the hint about 1 existing fund with invalid budget.
    - Repair your fund with SQL
      UPDATE aqbudgets SET budget_period_id = ... WHERE budget_id = max(budget_id);
      (... needs to be your existing budget_period_id)
    - Run updatedatabase again - verify it runs successfully now.
    - If you try to change the budget_period_id to a non-existing now with SQL, you will
      get a database error. The new FK doesn't permit it.
    Part 2:
    - Start fresh with the web installer, verify there are no errors on
      creating the database tables
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22be7246e534db158afbf38e1171d05148397088
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 11:48:12 2020 +0200

    Bug 24972: Remove de-DE installer data
    
    With installer data in YAML format and it's translations,
    there are no need for localized installer files.
    
    This patch removes de-DE installer files.
    
    1) Apply the patch
    2) Translate to de-DE
       cd misc/translator
       ./translate update de-DE
       ./translate install de-DE
    3) Do a clean install using de-DE,
       check no problems during install
    4) Verify MARC21 frameworks, they must
       be translated
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e692b40523839bda45a20e4cf1cac7cdfbf53a13
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Oct 14 22:53:24 2020 +0000

    Bug 26673: Remove #!/usr/bin/env perl from .pm modules too
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f47b4ffd72211a216df67ef912b5eddb2b954db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 11:24:33 2020 +0200

    Bug 26673: Remove shebangs from Perl modules
    
    It's not needed.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 032166767869e36e8e0cec1cf4d54ea284a74105
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 20 11:58:49 2020 +0000

    Bug 26749: Correct dropdown markup in OPAC cart
    
    This patch corrects the markup of the "Download" dropdown menu in the
    OPAc cart. It was not updated during the upgrade to Bootstrap 4.
    
    To test, apply the patch and perform a catalog search in the OPAC.
    
    - Add some titles to the cart.
    - Open the cart and test the "Download" menu button.
    - The menu should display correctly, and the menu items should work to
      download the correct files.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c99099e8c453be2e18d42ed1c0464fe9ff4824c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 16 18:08:44 2020 +0000

    Bug 26719: Replace MSG_NO_RECORD_SELECTED with translatable string
    
    This patch cleans up some loose ends left by Bug 25351, replacing
    instances where the undefined variable MSG_NO_RECORD_SELECTED is used.
    
    To test, apply the patch and perform a catalog search in the OPAC.
    
    - On the search results page, without checking any checkboxes, use the
      "Select titles to..." menu to try to add to cart and add to a list. In
      each case you should get a "No item was selected" message.
    - View a list which contains one or more titles. Click the "Remove
      from list" link. You should get a "No item was selected" link.
    
    Other instances have been corrected even though they will only be
    triggered if something has broken. For instance, toolbar items in the
    cart window which are disabled shouldn't register the click that might
    trigger the error. And selecting an item for an item-level hold
    shouldn't ever give a warning because at least one radio button should
    always be selected.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a2cb71c79ae630bcfe6f4bcfe63bfbfeaf4f550
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 03:34:17 2020 +0000

    Bug 26678: Remove incorrect include file from table of transfers
    
    This patch removes a mistakenly-added include file from the transfer
    template which was resulting in a menu being shown in the wrong place.
    
    To test, apply the patch and go to Circulation -> Transfer.
    
    - Submit an item for transfer.
    - In the table of transferred items you should see the title of the
      item linked to the bibliographic details page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60af6edbb15df1a6c667eb0cf547268b408eeb18
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 24 00:33:32 2020 +0000

    Bug 26810: Restore OpacCustomSearch news display
    
    To test:
    1 - Define a new opac news entry for OpacCustomSearch
    2 - Browse opac, notice the standard search bar is displayed
    3 - Apply patch
    4 - Note new search bar displays on refresh
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2dd19840449beadd1f1752bd8cc18f0163f7f8a4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 22 12:36:13 2020 +0000

    Bug 26784: Silence warns about comparing undefined values for MARC modification templates
    
    This patch simply checks if conditionals are defined before comparing
    
    We don't need to check actions because you cannot save an action without an action :-)
    
    To test:
    1 - Define several actions for a MARC modification template
    2 - Ensure you have actions with no conditionals
    3 - Tail the intranet logs
    4 - Browse to Tools->MARC modification templates
    5 - Click 'Edit actions' for the template you setup above
    6 - Note warns like:
        [2020/10/22 12:30:18] [WARN] Use of uninitialized value in string eq at /kohadevbox/koha/tools/marc_modification_templates.pl line 127.
    7 - Apply patch
    8 - Restart all the things
    9 - Edit actions again and note no more warns
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be4f0c7639a679b1ec808e6e9cf9af0fc9576e79
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 22 10:59:17 2020 +0000

    Bug 26781: Check for subfield defined rather than truth
    
    To recreate:
     1 - Have a record with 100$0 defined
     2 - Define a Marc Modification template:
        Delete field 100$0
     3 - Perform Batch record modification, enter the record above in the list of records
     4 - Preview the MARC
     5 - Note the entire 100 field has been deleted, don't modify the record
     6 - Apply patch
     7 - Restart all the things
     8 - Test the modification again
     9 - This time the preview confirms only the subfield 0 deleted
    10 - Modify the record
    11 - Confirm the record is correctly updated
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: Fix typo ony vs only
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a96de8283ba41ebff0d8e1a7c491fc5bcff5dc18
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 20 10:23:25 2020 +0000

    Bug 26747: Show 'Always available' if title always available in overdrive
    
    To test:
    1 - Have a developer account for overdrive, or library credentials
        https://developer.overdrive.com/
    2 - Enter info into 'Overdrive' sysprefs and enable overdrive
    3 - Search for 'house' in the opac
    4 - Click the overdrive link
    5 - Note some titles in the collection show 999999 copies available
    6 - Apply patch
    7 - Note they now say 'Always available'
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a5d5367f10fa1101e99748aadf0c076ebd9dea7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Oct 25 23:12:15 2020 +0000

    Bug 25596: DBRev 20.06.00.054
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3183de77b4bd3ffb164c19b7933aef31039e723
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 9 14:34:34 2020 +0100

    Bug 25596: Identify overpayment refunds for translation
    
    This patch ensures we can uniquely identify automatic overpayment refund
    credits from the accountlines by introducing a new account credit type
    and adding appropriate translations for the new code.
    
    Test plan
    1/ You'll need an overpayment refund to start...
    1a/ Issue yourself and item and set the date due early enough
    to create an overdue fine for at least 2 days worth of overdue fines
    1b/ Run the fines.pl script to add the fines
    1c/ As a patron, pay off the accruing fine
    1d/ Return the item ensuring you backdate it at least a day
    1e/ Check that there is an 'Overpayment refund' credit on the patrons
    account.
    2/ Check that the overpayment string is translatable (i.e. it appears in
    the accounts include file)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a71596fb395d449a62f5a6417780ed23948755c4
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Oct 7 11:01:02 2020 -0400

    Bug 26627: Print and confirming a hold can cause an infinite loop
    
    Test plan:
    1) Place a hold for pickup at library A
    2) Confirm the hold and print slip
    3) Checkin the item again
    4) Confirm the hold and print slip
    5) The modal returns, do it again
    6) Apply this patch
    7) Reload the page
    8) Repeat steps 1-3
    9) No loop!
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28d20b92be91ae509a7f71586ada2535d3c2007d
Author: Mark Hofstetter <mark@hofstetter.at>
Date:   Mon Oct 19 17:28:19 2020 +0000

    Bug 26601: Add utf8 encoding to text output of overdue_notices.pl
    
    This patch sets the UTF8 encoding for output of overdue_notices.pl when
    outputting to txt.
    
    To test:
    0/ Check out an item with due date yesterday (use specify due date)
    1/ Create ODUE text with utf8 encoded characters, chinese characters, umlauts etc
       <url>/cgi-bin/koha/tools/letter.pl?op=add_form&module=circulation&code=ODUE
    2/ Run
       perl overdue_notices.pl -text ./
    3/ Verify encoding in the generated text file is incorrect
    4/ Apply patch and repeat 2/
    3/ Confirm text now inludes properly encoded characters
    
    Sponsored-by: Styrian State Library
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    With German umlauts on my system the editor still showed the
    characters correctly (probably guessing the right encoding).
    Using Chinese made the problem visible.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3be51d4ef2145b7db7b48c9ee32f86ddd34a964
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Oct 20 16:55:37 2020 +0000

    Bug 26686: Fix sorting of "updated on" and "time created" on notices tab
    
    In the patron's account in the staff interface there is a tab
    'Notices' that shows all notices sent out to a patron. The
    updated on column would not sort at all, but there was also some
    markup missing for the time created column.
    
    To test:
    - Make sure you have a patron account with some notices, ideally
      with different times and dates
    - Verify that the updated on column doesn't sort at all
    - Apply patch
    - Verify both date columns now sort correctly for different
      DateFormat settings
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5753d3cff9d763be420733ba4dbcd0ecf6baa23
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Oct 16 09:56:07 2020 +0200

    Bug 26666: (QA follow-up) Add 'USE raw' in template
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9d6b92ac108fd4753fb76346f5d236d8c59f874
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Oct 16 02:00:16 2020 +0200

    Bug 26666: Fix line breaks in addresses displayed with AddressFormat French or German
    
    When Addressformat is set to French or German the addresses on the Details
    tab will display <br /> in plain text. This is because a TT variable is used
    for adding line breaks that is either set to <br /> or "". Then this variable is
    escaped with the html filter... so we see the HTML tag uninterpreted.
    Switching to $raw for this specific case.
    
    To test:
    - Go to any patron account,
    - Fill in the various address fields
    - Switch the AddressFormat system preference to different settings
    - Verify the false display for French and German on the Details tab and
      in the brief info on the left side in the patron account
    - Apply patch
    - Repeat testing
    - All AddressFormats should now display correctly
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 974c93f908179ff16a162d8010ddbd9710fbff46
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 18 22:53:53 2020 +0000

    Bug 6819: Hide individual cancel order links when order line has been received
    
    This is to prevent mistakes - a received order should not be
    cancelled, but 'undo receive' needs to be done first for things
    to turn out correctly.
    
    To test:
    - Create a basket with at least 2 orders
    - Close basket
    - Receive one of your orders at least
    - Go back to the basket
    - Reopen basket
    - The cancel links should only show on the "not received" orders
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3edbe7d7dc9358e55b4ecc9da5b292a32cadcce9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 10:47:55 2020 +0200

    Bug 26445: Fix "back to result" link of the search result browser
    
    Not sure what was the expected behaviour, I am suggesting the following
    one:
    If you are browsing and you click "back to result", you will be
    redirected to the page where the record appear on the search result
    list.
    
    Say you search for "something" that returns 10 page (20 results per
    page)
    Click on first result first page
    Click back to result
    => You see the first page with the first result at the top
    
    Click on second page, 3rd result
    Click back to result
    => You see the second page with the biblio you clicked at the 3rd
    position
    
    Click on second page, 3rd result
    Click next/previous
    Click back to result
    => You see the page where you last result were.
    
    I think the existing expected behaviour was to have the result you
    clicked at the first position of the result page, but I am not sure it
    really makes sense.
    
    Hope this makes sense however!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 615d97d345429417843a2dd32e838075b3e27495
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 31 10:21:27 2020 +0200

    Bug 21811: Add JS confirmation when receiving - at least 1 item to receive
    
    When receiving, the "receive items" form should not be submitted if no
    items are going to be received
    
    Test plan:
    Create an order, close the basket, receive some items
    On the "receive items" form, do not select item (if items are created
    when placing the order) and submit the form
    => You must get a JS alert that prevent the form to be submitted
    Select at least one item, submit again
    => Now it's submitted
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bd23a3287345167de50d994d737351174c04936
Author: John Fawcett <john@voipsupport.it>
Date:   Mon Oct 12 11:18:30 2020 +0200

    Bug 26613: Fix it-IT unimarc_framework.sql installer file
    
    This is really an installation issue, though at the
    time of installation it did not result in any error.
    
    During cataloguing in the items menu the "Type of item or material"
    is not constrained by the itemtypes authorised_values (as it is for 942c records).
    
    I have added the itemtypes to the installer sql in unimarc_framework.sql
    as well as adding the description of this field for OPAC, which had been left empty.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c74c6636f779bbbaceee74f8704df9ec625815d
Author: John Fawcett <john@voipsupport.it>
Date:   Mon Oct 12 13:06:40 2020 +0200

    Bug 26612: Error during web install for it-IT translation
    
    Patch changes some of the values in the sql statement that inserts 307a
    unimarc row into the marc_subfield_structure which created an SQL error
    on installation.
    
    The fields changed are:
    - isurl now 0 instead of NULL,
    - hidden now -5 instead of NULL,
    - seealso empty string instead of NULL,
    - link empty string instead of NULL.
    
    These field values are now similar to the ones inserted for 306a or 308a.
    The value that caused the SQL error was using NULL for hidden (due to
    the NOT NULL constraint in the table definition).
    
    I have tested the install with this change and found no issues.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e865d9e72c8828f28aa133940a561981db740d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Oct 25 23:12:14 2020 +0000

    Bug 26569: DBRev 20.06.00.053
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a96f5deef04bb74fbd826449b4d82f651a67512c
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Wed Sep 30 13:14:12 2020 +0000

    Bug 26569: Use gender neutral pronouns in system prefernece explanations
    
    To test:
    1 - perform query "select variable,explanation from systempreferences where explanation like '% his %';"
    2 - find 6 sysprefs with gendered pronouns used in explanations
    3 - apply patch, reset_all
    4 - repeat query
    5 - no more gendered pronouns!
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 564ade93cce9231b01db1c4ebfc8f4e5b31e1acd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 3 16:23:04 2020 +0000

    Bug 8437: Exclude export.pl from plack
    
    When attempting to download large files from Koha plack can timeout
    
    Excluding the script from plack is a simple fix until we have a more permanent fix for this
    issue.
    
    To test:
    1 - Try to export your entire DB from Tools->Export
    2 - If big enough, it fails
    3 - Apply patch, copy changes to /etc/koha/apache-shared-intranet-plack.conf
    4 - Restart all the things
    5 - Repeat export, it succeeds
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70570debf3128f035d5eaf3d175c61c0ee1bbba3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 20 13:40:04 2020 +0000

    Bug 26752: Convert OPAC list download modal to dropdown
    
    This patch modifies the OPAC list page so that download options are
    shown in a dropdown menu instead of a modal dialog. This solves a bug
    introduced by the Bootstrap 4 upgrade and makes it consistent with the
    cart interface.
    
    To test, apply the patch and view the contents of a list in the OPAC
    which has multiple items on it.
    
     - In the toolbar at the top of the list contents table the "Download"
       button should now be a dropdown menu.
     - Selecting any of the download options should trigger a download
       prompt.
     - Test with and without some CSV profiles which have been
       configured for use in the OPAC
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23292b53a8bc672f66ae95b1cfb7db5994d1eea5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Oct 24 23:53:21 2020 +0000

    Bug 23432: (QA follow-up) Add a unit test
    
    prove -v t/db_dependent/StockRotationItems.t
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6adb1891d2bf602b0434eb87508568e73faa763e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 23 12:28:22 2020 +0100

    Bug 23432: Replace 'die' with 'warn'
    
    This patch simply replaced the die statement with a warn such that the
    cron script may continue to rotate other items even if this item cannot
    be properly rotated due to corrupt data.
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e66d6d190af4bd27739bdfe88049899f927c123
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Tue Aug 18 07:40:50 2020 +0200

    Bug 26232: Empty smart rule fine grace period
    
    Staff can create smart rules with empty (undefined) fine grace period.
    In Overdues.pm undefined firstremind means 0, do the same in Circulation.pm.
    
    To test:
    1. Apply these patches
    2. Run:
       kshell
       prove t/db_dependent/Circulation.t
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6d614d4596728a3a2808eac2539754023e42262
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Tue Aug 18 07:39:53 2020 +0200

    Bug 26232: Test for empty smart rule fine grace period
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 395bb760394e6947303de7e342882148944e9026
Author: Björn Nylén <bjorn.nylen@ub.lu.se>
Date:   Tue Oct 20 14:11:16 2020 +0200

    Bug 26750: Deleted items not indexed
    
    After deleting an item it is still searchable in the index. Similar to bug 26507 where record is reindexed before the database is changed.
    
    To test:
    1. Delete an item
    2. Search the barcode in the main search box. You'll find the original record but wiht hte deleted item missing.
    3. Apply patch.
    4. Repeat steps 1-2 (with another item). No record should be found.
    
    Note to test you have to have the indexer running, not the cron job, and it
    needs to be running fast so that the index is updated before the delete
    takes place
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e5ea4f5ab81cb500f112a5858130f82a6b4fd65
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 20 14:40:50 2020 -0300

    Bug 26751: Fix fatal exception if only one repo defined
    
    This patch fixes this nasty problem with how XML is parsed: if more than
    one entry is found, repo => [] is generated. If only one, repo => {}.
    
    To test:
    1. Have more than one entries in the plugins_repo entry:
    
    <plugin_repos>
        <repo>
            <name>ByWater Solutions</name>
            <org_name>bywatersolutions</org_name>
            <service>github</service>
        </repo>
        <repo>
            <name>Theke Solutions</name>
            <org_name>thekesolutions</org_name>
            <service>github</service>
        </repo>
        <repo>
            <name>PTFS Europe</name>
            <org_name>ptfs-europe</org_name>
            <service>github</service>
        </repo>
     </plugin_repos>
    
    2. Search for plugins
    => SUCCESS: Searching works!
    3. Leave only one entry
    4. Restart all to refresh things
    5. Try searching for plugins
    => FAIL: Fatal error
    6. Apply this patch
    7. Repeat 5
    => SUCCESS: It doesn't explode anymore!
    8. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a60c96930ae4f702cd7bb1807188394e29aea44
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 19 10:57:25 2020 +0000

    Bug 26735: Overdrive login modal broken in the OPAC
    
    This patch makes corrections to the markup for the Overdrive login modal
    in the OPAC. It hadn't been updated during the upgrade to Bootstrap 4.
    
    To test, apply the patch and enable the system
    preferences required for Overdrive integration.
    
    - Log in to the OPAC.
    - On the "Your summary" page open the "OverDrive Account" tab.
    - Click the "Log in to your OverDrive account" link.
    - The modal should appear and look correct.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a5cda8b7ad9af8fcbaa9d5a850946000066a281
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 16 15:04:31 2020 +0100

    Bug 26581: Only reindex records once per checkin
    
    This patch simply passes skip_record_index calls to Koha:Item:store
    for all the changes done in AddReturn.
    
    Testing is really verifiying that items are still correctly indexed at the end
    
    For both search engines
    To test:
    1 - Find or create a record with multipel items
    2 - Populate both:
         UpdateItemLocationOnCheckin
         UpdateNotForLoanStatusOnCheckin
    3 - Confirm that checking in an item correctly updates the item status in search results
    4 - Test with items issued, and items not issued
    5 - Test when generating a transfer (checkin at different branch)
    6 - Test when item was marked lost
    7 - Test when filling transfer
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6dddaec1b9e735feb9ad666d49485d44a5d63b5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 30 16:51:28 2020 +0000

    Bug 26581: Unit tests
    
    These tests cover the changes to ensure the AddReturn calls index_records once
    per call and that other calls pass the skip_record_index parameter correctly
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 759ff4519961d0c256eb05a4797fb21c3b2c22d9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 7 16:37:06 2020 +0100

    Bug 25549: Add error reporting to plugins-home
    
    This patch adds handling for the newly introduced 'errors' option in
    GetPlugins and reports erroroneos plugins to the user.
    
    To test:
    1 - Enable plugins in the koha-conf
    2 - Install the kitchen sink plugin
    3 - Your staff client should be orange now :-)
    4 - The plugin should display as installed in the table at
        tools/plugins.
    5 - edit the plugin module
        /var/lib/koha/kohadev/plugins/Koha/Plugin/Com/ByWaterSolutions/KitchenSink.pm
    6 - Add a line to break compilation, like:
        this won't compile
    7 - Restart all
    8 - Your Koha is not broken, but is no longer orange (The plugin is not
        loading).
    9 - The plugin should display as unable to load in the table at
        tools/plugins.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0eae966d257fa2ecc6a6506e2515691e092a701c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 20 11:12:12 2020 +0000

    Bug 25549: Remove plugin methods for broken plugins
    
    To test:
     1 - Enable plugins in the koha-conf
     2 - Install the kitchen sink plugin
     3 - Your staff client should be orange now :-)
     4 - edit the plugin module
         /var/lib/koha/kohadev/plugins/Koha/Plugin/Com/ByWaterSolutions/KitchenSink.pm
     5 - Add a line to break compilation, like:
         this won't compile
     6 - Restart all
     7 - Your koha is now broken
     8 - kshell
     9 - perl misc/devel/install_plugins.pl
    10 - Restart all
    11 - Koha remains broken
    12 - Apply patch
    13 - kshell
    14 - perl misc/devel/install_plugins.pl
    15 - Koha now works!
    16 - Koha is not orange because the plugin methods are removed
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 890fd6ff068f58da4c72194ebc14be2cf479040b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 16 11:31:54 2020 +0000

    Bug 23828: Elasticsearch - Preserve record order when combining subfield in mappings
    
    Currently if you combine subfields in the marc mappings the subfields are indexed in the order
    listed in the mapping.
    
    i.e. 650(avxyz) in mapping
    
    and in record:
    650 $aHeading $zGeosubdiv $vFormsubdiv
    
    is indexed as:
    Heading Formsubdiv Geosubdiv
    
    We should preserve the order and index as:
    Heading Geosubdiv Formsubdiv
    
    We can use built in function in Marc::Field to achieve this
    
    To test:
     1 - It is easy to find examples of this using authorities
     2 - Find or create a record with subfields order azv
         e.g. 150$aActresses$zUnited states$vBiography
     3 - Add or have a second authority
         e.g. 150$aActresses$vPortraits
     4 - Set an authorities mapping for 'Heading' to 150(abgvxyz)
         find at:
         Administration->Search engine configuration (Elasticsearch)->Authorities tab
     5 - Index the records in Elasticsearch
         perl misc/search_tools/rebuild_elaticsearch.pl -a -ai 1691 -ai 1692
     6 - View the first record in the ES index
         curl es:9200/koha_kohadev_authorities/data/1692?pretty
     7 - Note 'Heading' field is ordered as in the mapping
     8 - Search authorities for 'contains' "act"
     9 - Note the records sort incorrectly
    10 - Apply patches
    11 - perl misc/search_tools/rebuild_elaticsearch.pl -a -ai 1692
    12 - curl es:9200/koha_kohadev_authorities/data/1692?pretty
    13 - Note the order is now preserved
    14 - Search authorities for 'contains' "act"
    15 - Note the records sort correctly
    
    Signed-off-by: Heather Hernandez <heather_hernandez@nps.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: Fix
       FAIL   spelling
         combind ==> combined
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0cb4300675405d37230ee427137daff2d6bdb4d9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 16 11:31:48 2020 +0000

    Bug 23828: Unit tests
    
    Signed-off-by: Heather Hernandez <heather_hernandez@nps.gov>
    
    Bug 23828: (follow-up) fix unit test merge
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 23828: (QA follow-up) Fix number of tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd35df346f73a00b643e675853ba2c8ef321cf66
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon Sep 21 02:02:27 2020 +0000

    Bug 26496: Add op field to Budget Planning
    
    Without this patch, it's impossible to save a budget plan.
    
    With this patch, it is possible to save a budget plan.
    
    Test:
    1. Apply patch
    2. Modify a budget (e.g. http://localhost:8081/cgi-bin/koha/admin/aqbudgetperiods.pl?op=add_form&budget_period_id=1)
    3. Unlock the budget if necessary by unticking "Lock budget" and click "Save"
    4. Go to a budget (e.g. http://localhost:8081/cgi-bin/koha/admin/aqbudgets.pl?budget_period_id=1)
    5. Click "Planning" and "Plan by libraries"
    6. Click "Auto-fill row" on the first line
    7. Click "Save"
    8. Note that results are saved and shown on the newly loaded page
    
    To verify this patch is necessary, do the test plan without applying the patch.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9b02000eb2602374ca0bfeade53c519b463d148
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 15 14:45:00 2020 +0000

    Bug 23376: If a single item is returned we cannot count
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d20cafc4f8472fb07ba9ffa8f2a9432bf5847f4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 15:17:46 2020 +0200

    Bug 26515: Don't need to call safe_to_delete
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e70a863dd22e3a48c115b43852adda608efd3f7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 12:03:41 2020 -0300

    Bug 26580: Remove unused C4::Acquisition::DelBasket function
    
    Bug 26577 removed the only use of it.
    
    To test:
    1. Apply this patch
    2. Run:
       $ git grep DelBasket
    => SUCCESS: Only finds references to DelBasketGroup
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23fd3de316bbd94c691dd3941d31aff84177c389
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 11:47:03 2020 -0300

    Bug 26579: Remove unused C4::Acquisition::DelOrder function
    
    This patch removes an unused function, its tests, and adjusts other test
    files that relied on it by replacing it with $order->cancel calls.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Acquisition.t \
               t/db_dependent/Acquisition/GetBasketsInfosByBookseller.t \
               t/db_dependent/Acquisition/close_reopen_basket.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat (1)
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 870ef9e2d9046914e198d7c03fa64b4b89de3b41
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 11:14:37 2020 -0300

    Bug 26577: Make basket.pl and cancelorder.pl use ->cancel
    
    This patch makes the mentioned controller scripts use the new
    $order->cancel method instead of DelOrder.
    
    To test:
    1. Apply this patches
    2. Have a basket with some orders
    3. Play with cancelling orders and removing baskets
    => SUCCESS: No behaviour change!
    => SUCCESS: No errors!
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14820607c43b6e760ba2edadfb14436f2685a1fe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 15 09:37:56 2020 -0300

    Bug 26515: (QA follow-up) Preserve original behaviour
    
    This patch removes the use of $self->items->safe_delete, as we don't
    want to change the current behaviour (i.e. delete what can be deleted)
    As safe_delete would rollback entirely, there was a behaviour change.
    
    Now items are deleted in a loop that catches any problem and reports it
    using the new ->add_message mechanism. The $item object is added to the
    message payload so it doesn't need to be queried by the caller for
    providing UI feedback.
    
    Tests are augmented accordingly,
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Acquisition/Order.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f940b5fe90518112db612d7e19aa1419a6ef84e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 9 17:01:29 2020 -0300

    Bug 26515: Better feedback on errors
    
    This patch makes the possible causes of biblio removal failure to be
    specified on the passed error message. This way the UI could render
    better reports on the situation.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7941b4b039b3a31a56f9a4bf9d709c546534434e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 8 12:16:49 2020 +0200

    Bug 26515: Remove branchcode from mock_userenv
    
    It's the default behaviour of mock_userenv
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be95bc913740d97562f954a8744fc670483db7ec
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 11:06:34 2020 -0300

    Bug 26515: (follow-up) Do not count self when checking orders
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9de5bd0eef958291a9a51cca2de9aa49a248b77
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 23 11:36:21 2020 -0300

    Bug 26515: Add Koha::Acquisition::Order->cancel
    
    This patch introduces an OO replacement for DelOrder. It does the same
    thing. It doesn't die when trying to delete items or biblio. It sets an
    error message on the order object so the caller knows what happened.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Acquisition/Order.t
    => SUCCESS: Tests pass!
    3. Read the tests carefully to understand how they cover all use cases.
    4- Sign off :-D
    
    Sponsored-by: ByWater Solutions
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d4d50ab290878a5aafef90470f5a5d977d689d7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 23 11:35:53 2020 -0300

    Bug 26515: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f815e748feba1c44ccf8733b6a01642c56f4eec
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 15 09:35:43 2020 -0300

    Bug 26555: (QA follow-up) Add a 'payload' attribute for carrying useful things
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1557bf0100f4bf67cf0d98a181a04a2e49b906cd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 30 09:42:18 2020 -0300

    Bug 26555: Make sure _messages is always initialized
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d576f887c1a0451d45eb0cda055f974916f011c7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 28 10:49:24 2020 -0300

    Bug 26555: Add ->messages and ->add_message to Koha::Object
    
    This patch adds a way to make Koha::Object-derived classes to carry
    messages around. This targets non-fatal errors, or around action flags
    for the caller, to avoid complex exception handling on the controllers when
    it is not expected to be fatal.
    
    To test:
    1. Apply this patchset
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Object.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa69ef69722af8c9a2b9afd780b8f1ff68c32a9b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 28 10:23:50 2020 -0300

    Bug 26555: Add Koha::Object::Message
    
    This patch introduces a tiny class for encapsulating execution messages in
    Koha::Object derived classes.
    
    To test:
    1. Apply this patch
    2. Run;
       $ kshell
      k$ prove t/Koha/Object/Message.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35a3b9e6b9288558a708f97ae190f96e8bbac8d1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 14:00:20 2020 +0200

    Bug 25460: Remove swp file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8b80abbd0890de3da2a570422b240f24cbb9c30
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 13:56:41 2020 +0200

    Bug 25898: Fix new occurrences
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d22c12a925f5f1e1fefa74b49edb1b6a5ce880a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 12:53:06 2020 +0200

    Bug 26534: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 819a33a7a417706c4a570f7b10c5b65156920df1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 1 14:14:13 2020 +0100

    Bug 18170: Use GetDescriptionByKohaField
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c1218af6445c384483f543c3291e0dc508665b6
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 24 21:29:10 2020 +0000

    Bug 18170: Show damaged status in table of checkins
    
    This copies the display of the damaged status from the holds and
    checkouts pages in staff.
    
    To test:
    - Apply patch
    - Check out some items, some damaged, others not
    - Verify the damaged status is displayed below the due date
      in the table of checkouts
    - Check the items in from the checkin page
    - Verify the damaged status displays in the table of checkins
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd05abf911b89d7adbc44c7b9299dd22be1ef35b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 15 10:53:25 2020 +0000

    Bug 25460: DBRev 20.06.00.052
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5bcc51170ad8f5f8311e5223d3634db78ba0303
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 5 00:38:47 2020 +0000

    Bug 25460: (QA follow-up) Remove stray quote from system preference description
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebbdfe3c11d3fdca3950720e4b50edc2fe6f9ca6
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 5 00:28:57 2020 +0000

    Bug 25460: (QA follow-up) Readd ending punctuation to sys pref description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7230327130205825cea2cb64c322c3754b1948a
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Thu Sep 24 10:54:17 2020 +0000

    Bug 25460: Add unit test for change to C4::OAI::Sets->UpdateOAISetsBiblio()
    
    Test plan:
    
    1. Run unit test:
    sudo koha-shell <instancename>
    prove t/db_dependent/OAI/Sets.t
    
    2. All tests should pass
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: Put tests inside a subtest, and perltidy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac1a8adba2bc91b7475b958c75daea98187c422b
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Tue May 12 02:57:20 2020 +0000

    Bug 25460: Update OAI sets when adding/editing/deleting item records
    
    Also adds syspref to optionally choose to embed item information in record when adding/editing bibliographic and item records.
    
    Test plan:
    1. Enable OAI-PMH and OAI-PMH:AutoUpdateSets sysprefs
    2. Create a biblio record with 1 item with CCODE of NFIC
    3. In Administration > OAI Sets configuration create a set and define
    the mapping:
    Field: 952, Subfield: 8, Operator: is equal to,  Value: FIC
    
    4. Run the build_oai_sets.pl script:
     cd misc/migration_tools
     sudo koha-shell <instancename>
     ./build_oai_sets.pl -i
    
    5. Check what items are in the OAI set:
    sudo koha-mysql <instancename>
    select * from oai_sets_biblios;
    
    6. Observe your bib from step 2 is not in the set
    7. [ITEM EDIT] Edit the item to have CCODE of FIC repeat step 5 and observe biblio is still not in OAI set
    8. [ITEM ADD] Add a new item with CCODE of FIC and repeat step 5 and observe biblio
    still not in OAI set
    9. [ITEM DELETE] Delete one of your 2 items and repeat step 5 and observe biblio still
    not in OAI set
    
    10. Apply patch, update database and restart plack (instruction below on
    the latter 2 actions):
    
    cd installer/data/mysql
    sudo koha-shell <instancename>
    ./updatedatabase.pl
    sudo koha-plack --restart <instancename>
    
    11. Enable new syspref OAI-PMH:AutoUpdateSetsEmbedItemData
    12. [ITEM ADD] Repeat step 8 and observe biblio is now in the OAI set
    13. [ITEM EDIT] Edit both items to have a CCODE of NFIC and repeat step 5 and
    observe bib now not in set
    14. [ITEM EDIT] Edit one of the items to have CCODE of FIC and repeat step 5
    and observe bib now in set
    15. [ITEM DELETE] Delete all items off bib and repeat step 5 and observe bib
    no longer in set
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37540532b18f84fc33a7831bc3a350d811adc1a9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 7 14:33:19 2020 -0300

    Bug 25898: (follow-up) POD
    
    Our docs shouldn't suggest indirect object notation is accepted or
    encouraged.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96cc447045f3f1d3702a3c69b36f596d88f38eda
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 29 21:07:54 2020 +0400

    Bug 25898: Prohibit indirect object notation
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e2b6b929923e5e616d2520bb34f0f0838cd82d3
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Sep 30 11:00:58 2020 +0200

    Bug 26534: Use IF ELSE directly on h5 opening tag
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1f0aa1e59948ba7c7bedf657e8b798d1fd95ed2
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Sep 30 10:07:26 2020 +0200

    Bug 26534: Replace 'grade' by 'is-patron' and 'patron-type'
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eea2699fd297172bd7f2975015a035a9d23cfcfa
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 25 12:48:30 2020 +0100

    Bug 26534: (follow-up) Only center when using patronimages
    
    I felt the change to always center the user title worked well when
    patronimages was enabled, but not so well when it was not (it looked
    strange without a background for non-staff users).
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5307bb6cbd9320f31d538dee27a12604c8344b3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 25 12:31:57 2020 +0100

    Bug 26534: (QA follow-up) Fix CSS declaration
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26c717fcd4b2031a8ddb0a06209bd29c18dbd3fe
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 25 09:43:54 2020 +0200

    Bug 26534: Add Font Awesome icon only for staff patrons
    
    In patron pages it would help to see an icon indicating that this is a staff patron (having permission to access staff interface).
    This may avoid wrong patron deletion or permission mistakes.
    I propose the shield Font Awesome icon and a grey background
    
    Patch also shows patron name and cardnumber aligned center instead of right.
    Patch adds to 'patroninfo' div a class 'staffgrade' or 'normalgrade' to
    allow more styling depending on patron beeing staff or not.
    
    Test plan:
    Compare display between a patron having staff interface access and one without permissions.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7972be4b97536f1c8540baa2554da111ca6b0efd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 7 14:20:32 2020 +0200

    Bug 26621: Adjust docs/contributors.yaml accordingly
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 122a2c58ff61c831b9de633ed01a6986fabaa7b0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 6 17:56:16 2020 +0200

    Bug 26621: Adjust .mailmap to reduce the number of invalid authors
    
    This file is a nightmare, really. We should simplify it and order it correctly.
    Letting it here for now, I'd like to run the gitstats command on it to double check the output.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD: Amended patch: remove dup occurrences for Brendan
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46197752aad9909cc8f851b60ad44aec3a1ba71a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 4 16:54:37 2020 +0000

    Bug 26643: (QA follow-up) Fix typo in message
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbd86d7a3043c6b39faba8c4cd1eaf91635d22b7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 9 13:08:45 2020 +0100

    Bug 26643: Notify librarian of completed transfers
    
    It came to light that it's not clear to all users that a checkin results
    in the completion of a transfer if one exists for the item being checked
    in.  This patch adds such a notification to the error messages loop to
    highlight that the item has been recieved from it's sending brnach.
    
    To test
    1/ Setup a transfer from branch A to branch B
    2/ Check the item in at branch B
    3/ Note that a new message appears in the 'Check in message' alert box
    saying "Item recieved from branch A"
    4/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1825a1fd8bad6c5aab77596301a0e08cef7d48f
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Oct 6 06:43:11 2020 +0000

    Bug 26617: Update INSTALL file to include koha-testing-docker and Gitlab links
    
    Test plan:
    1. View the INSTALL file in a text editor
    2. The INSTALL file should reference koha-testing-docker and KohaDevBox
    using Gitlab links
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 308f52d76490d16045944442127939daccdbcc51
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 2 16:17:39 2020 +0100

    Bug 26536: Assignment fix
    
    Whilst working on this bug I found a weird inconsistent variable assignment line
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD: Amended commit message: fix bug number
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f87f64c41f000860c72de74807c0f3c3f96a4366
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 2 16:09:54 2020 +0100

    Bug 26536: WRITEOFF not writeoff
    
    There is inconsistency in variable case between the controller script
    and the template. This patch corrects those inconsistencies.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4a54196f5c4fae6935df657a26bb14f4956f5d8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Oct 5 09:08:24 2020 +0100

    Bug 26536: Fix incorrectly scoped variable
    
    During work on bug 26076 a variable scope mistake was made when
    reverting the logic to use distinct queries for selected accountlines.
    
    This patch restores the script scope of the varaible by removing the
    superflous 'my' declaration.
    
    Test plan
    1/ Add a set of manual invoices
    2/ Select a subset of those manual invoices to 'Writeoff selected'
    3/ Confirm that only those selected invoices have been written off.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit baabaceb32b3138829d9a9bfc20e8f8a6c8abd36
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 14 10:04:24 2020 -0300

    Bug 26595: Remove password from the smtp_server API object
    
    This patch makes the SMTP server objects do not include the password for
    API representation. If we need the password itself, we can add a route
    to retrieve it with specific permissions.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8eb68c082a664d6aee10fd87ed6009a9a40bdbe3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 14:12:44 2020 +0200

    Bug 26595: Embed the whole smtp_server object
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b62cb37db777ceba089e77bf65b2ac8095f7b741
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 1 12:13:48 2020 -0300

    Bug 26595: Add the option to hide the SMTP server column
    
    This patch adds
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a62e3e030b75d5e3b0aaf30b8f6a80d39fc343b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 1 12:10:39 2020 -0300

    Bug 26595: Add SMTP server column to libraries table
    
    This patch makes the libraries datatable render the assigned SMTP server
    on each row. 'Default' will be rendered when the system default is
    detected. A link to the SMTP server config will be rendered when a real
    SMTP server is assigned.
    
    To test:
    1. Apply this patches, reload al the things
    2. Visit the libraries table
    => SUCCESS: There's an SMTP server column displaying the right thing
    3. Assign an SMTP server to a library
    => SUCCESS: The table displays the server name as a link
    => SUCCESS: The link correctly points to the SMTP server config page
    4. Sign off
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c59b0227836faff9af5218625af1fb7f25268ea7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 1 12:07:38 2020 -0300

    Bug 26595: Add smtp_server_info embed option to /libraries
    
    This patch simply adds the option to embed the return value from
    Koha::Library->smtp_server_info on the libraries GET actions.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c4c9764db9c1946df0781227df6d3147c744301
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 1 12:06:13 2020 -0300

    Bug 26595: Add Koha::Library->smtp_server_info
    
    This patch adds a method for retrieving brief information about the
    linked (or not) SMTP server for embedding on API requests.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Library.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98b584d97f919b610be501faa23730da1d87b303
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Oct 14 18:51:29 2020 +1300

    Bug 17084: Automatic debian/control updates (master)
    
    built from c12ede4 on debian 9
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef0f0d7e0b135f9fd1260a575bb90c0a96faae75
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 15:52:29 2020 +0200

    Bug 23895: Fix check_sysprefs.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 096327cfcd27d7abf484c3653b13e059bb9152e5
Author: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
Date:   Fri Oct 9 14:54:01 2020 +0000

    Bug 26647: Add translation context to cancel hold button in OPAC
    
    0) Apply the patch and add a hold on an item.
    1) Install Swedish language, sv-SE and change interface language to
       Swedish
    2) Modify sv-SE-opac-bootstrap.po and add this:
       msgctxt "Cancel hold button"
       msgid "Cancel"
       msgstr "Ta bort"
    3) Go to the Holds table at /cgi-bin/koha/opac-user.pl#opac-user-holds
    4) Confirm that the button is translated as "Ta bort"
    5) Sign off
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76eb46f25f5f9b816776b2bf5fe6e11fcedfbad4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 12:37:24 2020 +0000

    Bug 12556: DBRev 20.06.00.051
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 062fce8ef2fdd90b4036454ba151ef58bead91b3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 14:32:48 2020 +0200

    Bug 12556: Add missig POD for ->set_processing
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ca38d538b0c472416af33a2e6c105b14505b556
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Oct 12 10:55:33 2020 +0000

    Bug 12556: (follow-up) Fix failing test
    
    The method call set_waiting(1) was renamed to be set_transfer()
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bea17b4975b9a8d667290b33d86e80e12eb003ce
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Oct 12 11:06:51 2020 +0100

    Bug 12556: (QA follow-up) Fix QA Script failures
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch, fix:
     FAIL   C4/RotatingCollections.pm
       FAIL   pod
            *** WARNING: line containing nothing but whitespace in paragraph  in file C4/RotatingCollections.pm
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e1d291b14d4ea85ff101296e6c633fce22eb120
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 22 18:45:36 2020 +0300

    Bug 12556: Add new "in processing" state to holds
    
    This adds new syspref, HoldsNeedProcessingSIP, which controls whether
    a hold that is related to item will be filled automatically or not. If
    the user has enabled the syspref then instead of fulfilling the hold
    automatically the hold will go to "in processing" state.
    
    To test:
     1. Checkout a book to patron A
     2. Place a bib level hold to the book for B
     3. Patron A returns the book via SIP, to simulate this use:
            ./misc/sip_cli_emulator.pl -su koha -sp koha -l CPL -a 127.0.0.1 -p 6001 --item <ItemBarcode> -m checkin
     4. Notice that no notification is generated for Patron B about hold
        and that the hold status in intranet and opac is "In Processing".
     5. Notice that patron A (or other patrons) cannot checkout a book
        that is in processing, because it is considered to be attached to
        the holdee (similarly to the waiting state):
            ./misc/sip_cli_emulator.pl -su koha -sp koha -l CPL -a 127.0.0.1 -p 6001 --patron <PatronABarcode> --item <ItemBarcode> -m checkout
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d76149118b3340ced055bf1b436f458589598f8
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 22 15:44:31 2020 +0000

    Bug 12556: Simplify and correct logic in holds-table.inc template
    
    The states is_waiting and is_found are already implied by
    is_at_destination. Also we would never get the 'transfered' html class
    since transfer's status is T (this might not have been true in the
    past but now is).
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88f7d9f89cb07e8d253571199435e3600f1eb768
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 22 15:44:31 2020 +0000

    Bug 12556: reserves/request.pl: Reuse code from Koha::Hold
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01eebf333d09b13a3a575f1eaa7a8704aeddd691
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 22 15:44:31 2020 +0000

    Bug 12556: Reuse code from Koha::Hold instead of duplicating it
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb3e76f7f9e7f65fa0de2ee0fe51d09c81368480
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 22 15:44:31 2020 +0000

    Bug 12556: Remove unused HTML
    
    Koha::Hold::is_at_destination() already checks for found = 'W' so the ELSE
    code path which would print "Item waiting to be pulled from [...]"
    never gets executed.
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3db0ee00012e975fb18937e36015178a73d30ff0
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 22 15:44:31 2020 +0000

    Bug 12556: Refactor hold transfer status setting to its own method
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c760a8d381f185d504477db90b85fc8168a9f769
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Sep 21 05:08:32 2020 +0000

    Bug 13625: Change messaging preferences descriptions according to RenewalSendNotice
    
    Sending out renewal notices depends on the RenewalSendNotice and the
    patron having the checkout notice checked in their messaging
    preferences.
    
    To test:
    - Apply patch
    - Take a look at the messaging preferences table on the following pages:
      - OPAC > patron account > your messaging tab
      - Staff interface > patron account > details tab
      - Staff interface > patron account > edit patron
    - Toggle the RenewalSendNotice preferences
      - The label on the last notice should switch between "Item checkout"
        and "Item checkout and renewal" depending on the pref setting
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71c15cf502b57ad8d149097915cded46a7042326
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Sep 30 18:09:19 2020 +0000

    Bug 19353: Fix tests on UNIMARC
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3bea26aae222f34eb123469e558196e2daf5de5
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Sep 30 17:40:01 2020 +0000

    Bug 19353: Use xslt from distribution, not packaged installed one
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7cd6fa6c6fd6fde0a981bcaa23d94af5f1532ffb
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Nov 7 11:51:20 2017 +0000

    Bug 19353: Ability to use xsl template on marc21 and marcxml metadataprefixes in OAI provider
    
    Test plan:
    0) apply the patchset
    1) setup oai server with oaiconf file defining xsl_file for metadata
    format marcxml or marc21
    2) play with your oai and confirm that records are transformed as
    expected
    3) prove t/db_dependent/OAI/Server.t
    
    Signed-off-by: Martin Šťastný <martin.stastny@teamlibrary.cz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25e8b56b3601a01a71eb2627a39b100bd0d9c52d
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Dec 4 02:10:31 2017 +0000

    Bug 19353: Add test
    
    Signed-off-by: Martin Šťastný <martin.stastny@teamlibrary.cz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 119ddb6f12174a0a489fd45ed19e9a50d0a1ffd2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 12:37:24 2020 +0000

    Bug 19382: DBRev 20.06.00.050
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e60444b1cdf7b966d9440c2b2fbd5c41ed37e7c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 14:19:27 2020 +0200

    Bug 19382: Adjust comment in test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f61ca7f47b2962b7ffb3813815d029781ee1ebe
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Oct 13 13:42:58 2020 -0400

    Bug 19382: (QA follow-up) Fix typos
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c28e7ac5a444859594e013ee95ac8ebaf2652f8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 10 11:04:18 2020 +0100

    Bug 19382: (follow-up) Alternate tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea9549ea4e213654c3954a2d247dc2ab18fe8dd1
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Sep 3 14:25:05 2020 -0400

    Bug 19382: (QA follow-up) Throw exception if only_this_guarantor is set for a non-guarantor
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 899bd08e0c272c8726e045f511a113b2b982dcd9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 24 09:00:12 2020 -0400

    Bug 19382: Add blocking of ability to checkout on circulation.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a7a0a2474c958e85b96db55bba04e8d90fbed31
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jan 10 11:59:56 2020 -0500

    Bug 19382: Add ability to block guarantees based on fees owed by guarantor and other guarantees
    
    Some libraries would like to not only block the circulation of a guarantor based on fines owed by guarantees, but would also like to block circulation for all guarantees as well. Basically, if a family as a whole reaches a certain threshold of fines, the entire family will be blocked from checking out items.
    
    Test Plan:
    1) Apply this patch
    2) Set NoIssuesChargeGuarantorsWithGuarantees to $14
    3) Create a family of four ( 2 guarantors, 2 guarantees ) where the parents guarantee both children
    4) Give 3 of the 4 a $5 fine
    5) None of them should be able to check out items
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a15a7f5d81bde1a728b77f9ce69d3ff6382782e0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 16 12:56:56 2020 +0200

    Bug 23895: Move installer file into the mandatory directory
    
    Prior to this patch we had a confusing situation, mandatory files were
    in both installer/data/mysql and installer/data/mysql/mandatory
    To make things clearer this patch move them all into the mandatory
    subdir.
    However kohastructure.sql stay in the "root" directory.
    
    Test plan:
    1. Drop and recreate your DB and use the installer to populate the DB
    2. Use the merge request code from misc4dev to test the reset_all alias
    3. Still with the merge request from misc4dev checkout master (you can
    also try 19.11 and/or 19.05) and reset_all again
    => All the data from the SQL mandatory files must have been correctly
    inserted into the DB
    
    https://gitlab.com/koha-community/koha-misc4dev/-/issues/46
    
    Note that this patch also remove the x flag for subtag_registry.sql
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b845c5601a8306704be3c00c33b95da454182359
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 25 11:34:25 2020 +0000

    Bug 24899: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the interface or functionality.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f04d2accf8a99ffa390ef38cdf2101d04acbe73f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 18 19:14:40 2020 +0000

    Bug 24899: Reindent record matching rules template
    
    This patch reindents the template the record matching rules template.
    The only non-whitespace changes where lines were combined or split.
    
    The diff using the '-w' flag to ignore whitespace should
    highlight only moved lines.
    
    Test that functionality is unaffected: Administration -> Record matching
    rules.
    
    Test adding, editing, and deleting record matching rules. Test adding,
    editing, and deleting match points and match checks. Confirm that
    changes are saved correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31eb8196ed88850cf56ec84d3bb55354023438c1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sun May 3 01:04:41 2020 +0000

    Bug 25354: Clean up JavaScript markup in cataloging plugin scripts
    
    This patch makes some minor changes to the JavaScript generated by the
    cataloging plugins: <script> "type" attribute removed; single-line
    comments converted to multi-line style; obsolete //<![CDATA[ marks
    removed.
    
    These changes help the JavaScript conform to current coding guidelines.
    The comment style change allows for whitespace in the scripts to be
    collapsed by the Template::Toolkit "collapse" filter.
    
    Since the patch makes small cosmetic changes to many files it may be
    easiest to test this patch by visually inspecting the changes.
    
    It's also simple to test some plugins which are enabled by default (at
    least in MARC21): In the basic MARC editor, the leader, 007, and 008. In
    the item editor, subfield d - Date acquired.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cf01e6ca06eef4a3377505bae051170fae7a118
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 11:49:29 2020 +0200

    Bug 26327: Add exec flag on .t file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55d7d511b525a8159be3b05d4f52df18c7079ca6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 18 16:40:01 2020 -0300

    Bug 26327: (QA follow-up) Fix colspan in boraccount.tt
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91ab070e2030e64e3e8615daa8b7dd4e9df54ad1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 2 10:06:46 2020 -0300

    Bug 26327: (follow-up) Add transacting library to the transactions tab
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac834254ad93c16af45f3c6bc17a7519018b9e03
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 31 17:10:50 2020 -0300

    Bug 26327: Add to columns settings
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40cd70c581a6d68ce8e49f835681b0cf9b648af2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 31 16:35:10 2020 -0300

    Bug 26327: Include transacting library in fines
    
    This patch introduces a new column on the fines table to display the
    checkout library when the fine is tied to a checkout.
    
    To test:
    1. Have an overdue item that generated a fee
    2. Look at the 'Accounting' tab, 'Make a payment'
    => FAIL: There's no information about the library
    3. Apply this patch
    4. Restart all
    5. Reload and repeat 2
    => SUCCESS: There's a column with the library name!
    6. Identify the issue_id for the mentioned checkout and:
       $ koha-mysql kohadev
       > UPDATE old_issues SET branchcode='TOM' WHERE issue_id=11;
      (i.e. set the branchcode to an invalid value, to emulate a deleted
       branch).
    7. Reload
    => SUCCESS: It doesn't explode, it doesn't display a library name.
    8. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ac340e483923af88426b5061597eca80c5c4363
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 31 15:25:05 2020 -0300

    Bug 26327: Add ->library method to Koha::*Checkout
    
    This patch adds a 'library' relationship to the Issue and OldIssue
    resultsets, to be used in the Koha::*Checkout classes corresponding
    accessors. This way we will be able to eventually embed and filter on
    library fields on the API.
    
    The ->library method is then added to the classes-
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Old.t t/db_dependent/Koha/Checkout.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 210c62ad8c75a35fe63d1a564f4bb02f6f4b35d1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 14 15:21:55 2020 +0000

    Bug 26456: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    Also changed: Some form hints have been wrapped in <div class="hint"> to
    make it consistent with other pages.
    
    This patch should have no effect on functionality.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d09108919f8430f6d42b448e7da07a749091864b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 14 15:09:26 2020 +0000

    Bug 26456: Reindent MARC subfield structure template
    
    This patch reindents the MARC subfield structure template.
    The only non-whitespace changes where lines were combined or split.
    
    The diff using the '-w' flag to ignore whitespace should
    highlight only moved lines.
    
    Test that functionality is unaffected: Administration -> MARC
    bibliographic framework -> MARC structure -> Edit subfields..
    
    Test adding, editing, and deleting subfields. Confirm that changes are
    saved correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dab160d599ccc127d2b4bd7e50a93a2639abc9a2
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Sat Oct 10 00:24:36 2020 +0000

    Bug 26655: Add ARIA Labels to OPAC Lists
    
    This patch adds ARIA labels to opac-shelves.tt
    so that checkboxes for list items are meaningful
    to users of screenreaders and other assistive
    technology.
    
    Test Plan:
    1/ Open an OPAC list
    2/ Inspect the checkbox for a list item
    3/ Confirm the aria-label is missing
    4/ Apply the patch
    5/ Refresh the Opac list page
    6/ Inspect the checkbox for a list item
    7/ Note that there is now an aria-label with a
    meaningful description
    8/Sign off
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97b9eab178f0b45b38662747a4e009e71d8b73ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 15:15:46 2020 +0200

    Bug 20804: Add support for "days" to the timeout syspref
    
    If the timeout syspref did not contain an integer, or was not matching
    integer.'d|D', then it "fallback" to 0
    
    We can easily add support for hours and fallback to 600 if the value is
    not correct.
    It will prevent the session to timeout immediately
    
    Test plan:
    0. Do not apply the patches
    1. Fill the timeout syspref with "5h"
    2. Login
    3. Click somewhere
    => Notice that the session timed out
    4. Apply the patches, restart_all
    5. Login
    6. Click somewhere
    => You have 5 hours to enjoy Koha
    7. Fill the pref with an incorrect value ("5x" for instance)
    8. Logout, login
    9. There is a warning in the log, and you have 10 minutes (600 secondes) to enjoy Koha
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c9c7f4543a06553c6cbf04ff58a82eb6a40fc9c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 15:15:36 2020 +0200

    Bug 20804: Add tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cd22331732f6ffef3478ebbc034aa0fba154dba
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jul 18 14:52:06 2020 +0200

    Bug 26018: Fix frameworks errors with subfields in wrong tab
    
    All subfields for a MARC21 field should always be in the same tab.
    There were some mistakes found by the "MARC bibliographic framework
    test" this fixes.
    
    Before you apply the patch:
    - Check the "MARC bibliographic framework test" page
    - Ideally you should see the "wrong tab" mistakes
    - Reset your db (reset_all) or drop your db and run the web installer
    - Verify the page no longer points out any issues
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57182d6a043a25bda74de0e9e1320adfe930016c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 4 03:23:24 2020 +0000

    Bug 9118: (QA follow-up) Fix spelling on "To Date :"
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 683d6ced64a92cc391ac81b4a046bcdf2110bb83
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Mon Oct 5 11:19:44 2020 +0300

    Bug 9118: Do not show option to create exception on range for unique holiday
    
    When an unique holiday is edited one can choose
    option 'Generate exceptions on a range of dates.'
    Exceptions are meant to be used with repeating
    holidays and it makes no sense to have option to
    be able to create one for an unique holiday.
    
    This patch hides exception on range option when
    editing an unique holiday. Also fixes a minor
    spelling error.
    
    To test:
    1. Create unique holiday and edit it.
    2. Note that option to create exception on range is shown.
    3. Apply patch.
    => Option is now hidden.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ace5b632a6ed965931e1332cacb1419c16286d65
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Sat Sep 5 05:26:47 2020 +0000

    Bug 26389: Add auto renewal error to opac-user.tt
    
    Test plan:
    1 Check out an auto-renewing item to a patron
    2 confirm in circ rules that the rule allows at least one renewal
    3 log into OPAC, confirm your summary shows item is scheduled for auto-renewal
    4 click Renew All
    5 Get note "Please note: Your loan renewal failed because of the following reason(s):" with no following reasons
    6 Apply patch
    7 Repeat 3-5
    8 See appropriate error
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b40ee8d18b7fee42193cfb2bac5e44146a1afd9
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Fri Sep 25 13:52:06 2020 +0300

    Bug 26429: Show correct expiration date at the request.pl
    
    Bug 25789 changed holds tables expriration input class as "datepickerto".
    This results to past expiration date to be displayed as tomorrows date.
    Class "futuredate" should have been used instead.
    
    To test:
    
    1. Have waiting hold with expiration date in past (e.g 24.9)
    2. Observe that waiting reserves table displays correct expiration date
    3. At the request.pl page expiration date is however displayed as 26.9
    => Apply patch
    4. Confirm that expiration date at the request.pl is now 24.9
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a669249148d3f874ebc9977be9d4be6a6d92f8d
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 25 17:08:38 2020 +0200

    Bug 26538: Display cities list before input text
    
    In patron creation or edition actually the city field is displayed with input text then cities list.
    I propose to display cities list first since it is more likely used.
    
    Test plan :
    1) Create some cities
    2) Open patron creation form
    3) Check you see for each city field : cities list, text "or enter", text input
    4) Delete all cities
    5) Open patron creation form
    6) Check you see for each city field : only text input
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5545cf2860ef3f2d58b2a0c9dccccf5f21c1ed1f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 30 15:46:45 2020 +0000

    Bug 26576: Subfield descriptions on authority detail view are cut off
    
    This patch corrects the authority detail view on the staff interface so
    that subfield descriptions are not longer output as truncated strings.
    
    For instance, before this patch the subfield description for 035$a would
    be "System control numbe"
    
    After the patch it should be "System control number."
    
    Based on the assumption that the subfield descriptions were truncated at
    some point for readability reasons I've also made some style changes
    intended to improve the readability of the page.
    
    To test, apply the patch and go to Authorities.
    
    - Search for and view the details for an authority.
    - On the authority detail page, confirm that subfield descriptions are
      shown in full.
    - Confirm that the style changes look good and make the data more
      readable.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 913897f3a484ea31a2373de7aac2cc8298319575
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Tue Sep 29 05:53:34 2020 +0000

    Bug 26589: Fix t/db_dependent/OAI/Sets.t failing when OAI-PMH:AutoUpdateSets is enabled
    
    Test plan:
    1. Check the OAI-PMH:AutoUpdateSets syspref is disabled
    2. Run t/db_dependent/OAI/Sets.t tests and confirm tests pass
    successfully
    3. Enabled the OAI-PMH:AutoUpdateSets syspref
    4. Repeat step 2 and confirm the tests fail
    
    5. Apply this patch and restart plack: sudo koha-plack --restart
    <instance>
    6. Repeat step 2 and confirm the tests now pass
    7. Disable the OAI-PMH:AutoUpdateSets syspref and repeat step 2 and
    confirm tests still pass
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c32503fcb685e3bba209ba7baba1abe560fda94c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 14 11:17:46 2020 +0200

    Bug 26675: (bug 23463 follow-up) Fix typo onloadn vs onloan
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c12ede482f5aad8111a21127e9f42c62f2e3348b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 14:48:40 2020 +0200

    Bug 26529: (follow-up) Remove warning
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 909a3df890452f0f96ebd29ab571b1b8afaca475
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 14:47:30 2020 +0200

    Bug 26145: (follow-up 2) DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b174113cf88042a0c950a9529e38504125715cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 12:36:21 2020 +0200

    Bug 26145: Add exec flag on .t file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3b7e07062cf910f293ccfe0dfc8dc56ee5ee4d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 12:34:43 2020 +0200

    Bug 26145: (follow-up) DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2c59eda8553432df3fae8b001d287eb9210f594
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 11:28:16 2020 +0200

    Bug 26145: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ee3b6bbb2f8611b869494e0723918f6bf0bead8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 11:26:51 2020 +0200

    Bug 26145: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3611a2cd6819fee960aacffd5f5f3dcc09d8a7ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 09:13:18 2020 +0000

    Bug 26145: DBRev 20.06.00.049
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26eadaa7de02e7371323f06c03bfbc1c0f2aac1b
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Sep 25 19:05:02 2020 +0000

    Bug 26145: (QA follow-up) Add missing filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4f03c04e8a1e6afc2160bc24116b6f2a8ed72a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 28 17:00:17 2020 +0200

    Bug 26145: Add the new column to the column settings yml file
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7478b9430661de4310862f1d29fb2f593d08879d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 18:14:50 2020 +0200

    Bug 26145: Correctly preserve itemnumber value
    
    In order to know we are dealing with the cover images of a specific item
    we need to pass it though the different forms.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cc1f02a9481682a8230f2cf57cad6193effa460
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 16:16:50 2020 +0200

    Bug 26145: Add the "Cover image" column to the table settings
    
    The new column can now be hidden by the table settings
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 176a678fbe7ee1a8484c0123358e97a5d73487c5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 15:56:02 2020 +0200

    Bug 26145: Hide 'Upload image' if no CoverImage pref is set
    
    If LocalCoverImages AND OPACLocalCoverImages are disabled, we should not
    let the ability to upload an image for the items.
    
    We should also hide the column "cover image" in the tables
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4ca6c144142115dc3e184ae078d306c104d446d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 15:55:20 2020 +0200

    Bug 26145: Fix image tag
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a06223a20d8ce9c0dff6c706a73d13f3169d9ab4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 11 18:26:01 2020 +0200

    Bug 26145: Allow multi covers per item
    
    In this patch we remove the limitation of 1 cover image per item
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bc87ce75ec857292e433c0f6123b2ea02ef6d60
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 5 16:27:14 2020 +0200

    Bug 26145: Refactoring - Move C4::Images to Koha::CoverImages
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6f5768145bf21085ecd5024d6e021e4d3c64e15
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 5 16:27:06 2020 +0200

    Bug 26145: Refactoring - Rename table biblioimages to cover_images
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2aa6afd50ac9d806f11d78266a7527c7fd5b17a2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 18:29:03 2020 +0200

    Bug 26145: Refactoring - Add tests
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 549d033cb119687c8eb75e6d2a2bfa178dbd9be6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 18:18:15 2020 +0200

    Bug 26145: Display the cover image at the OPAC
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3f2993bdbbd8453c3b604c5d2cf43dc9ee27c88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 28 21:18:20 2020 +0200

    Bug 26145: Add the ability to upload a cover image per item
    
    This patchset adds the ability to attach cover images at item level.
    This commit message will explain the different patches that are
    following.
    
    The main idea is to have cover images for a given item. This is useful
    for a bibliographic record linked with a subscription. Each item could
    have the cover image for the serial numbers.
    
    In this first patch there is a limitation to allow only 1 cover per
    item, but a later patch will remove it. That way we will take advantage
    of the recent work done to display nicely cover images (bug 25031), and
    reuse it in this development (staff interface only).
    
    In order to use a flexible and robust code, the legacy C4 code
    (C4::Images) has been moved to Koha::CoverImages. Also the DB table
    biblioimages has been renamed cover_images.
    
    Test plan (for the whole patch set):
    0. Turn off AllowMultipleCovers
    1. Create a new bibliographic record and items
    2. Attach a cover image to the bibliographic record
    3. In the item list of the bibliographic detail page, you will notice a
    new "Upload image" action. Select it
    4. Select an image
    => Notice the new column in the item table
    5. Upload another image
    => You cannot upload 2 images, you are going to replace the existing one
    6. Turn on AllowMultipleCovers
    7. Attach another image to the image
    => Notice the 2 images are displayed nicely, with navigation controls
    8. Confirm you can view an image if you click on it and you can delete it
    9. Test the OPAC view now
    => Cover image for items are displayed in the table, there is no
    navigation controls here however.
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff17013a65036200fb0cb208107dc9f70778c49c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 28 21:13:01 2020 +0200

    Bug 26145: DB changes - Add biblioimages.imagenumber
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62a569ea732cf656073e6cbb38ab7ac96df32945
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 5 17:50:39 2020 +0000

    Bug 26152: Remove the use of jquery.checkboxes plugin from serial collection page
    
    This patch removes the use of the jquery.checkboxes plugin from the
    serial collection page and replaces it with custom JS.
    
    To test, apply the patch and go to Serials.
    
    - Locate a subscription which has multiple issues.
    - View the details for that subscription.
    - In the sidebar menu click the "Serial collection" link.
    - On the serial collection page test the "Select all" and "Clear all"
      links at the top of each table of issues. The controls should work
      correctly and only affect the table on  that tab.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30fcb92d62e574dbc1ff16c048cb1b12f653f7cf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 5 18:53:46 2020 +0000

    Bug 26154: Remove the use of jquery.checkboxes plugin from batch item deletion and modification
    
    This patch removes the use of the jquery.checkboxes plugin from the
    batch item modification and batch item deletion pages.
    
    To test, apply the patch and go to Tools -> Batch item
    modification.
    
     - Submit a batch of barcodes.
     - On the results page, test the "Select all" and "Clear all" controls
       at the top of the page. These should work correctly on the checkboxes
       in the table of results.
     - Test that the "Clear on loan" control still works to uncheck
       checkboxes corresponding to items which are checked out.
     - Test the "Show all columns" and "Hide all columns" checkboxes in the
       "Show/hide columns" section. These should work correctly on the
       checkboxes for showing and hiding columns in the table.
     - Go to Tools -> Batch item deletion.
     - Submit a batch of barcodes.
     - Repeat the same testing steps above (except the "Clear on loan"
       step).
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd2087e1cdbeeb8a207fc6881fc2472e8fdb323c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Sep 21 05:52:27 2020 +0000

    Bug 26503: Add unit tests
    
    Run
      prove t/db_dependent/Acquisition.t
    
    Verify all tests pass.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    JD Amended patch: perltidy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 352e8d23068caa248415a3081b50978d88e94762
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Sep 22 00:32:51 2020 +0200

    Bug 26503: Add limit for standing orders to acq advanced search
    
    This allows to filter on standing orders on the acq advanced search
    checkbox. For this purpose a new checkbox is shown behind the order
    status search option.
    
    As both not yet ordered and standing orders have the status
    'new' or partially received internally, this seems like a good
    placement as it will help distinguish these cases clearly.
    
    new + standing order = standing order, but nothing received yet
    partially received + standing order = active standing order
    all status + standing order = all standing orders
    
    To test:
    - Create some baskets with at least one order, some 'standing' and
      others not
    - In the top toolbar choose tab Orders search > Advanced search
    - Make some searches with and without the new 'Standing order' option
    - Verify the right orders are found
    - In the search results standing orders will now show with the
      status + (standing order).
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d50332c1e57bfe623ce2f7c6ce427dbd12990062
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 11:27:58 2020 +0200

    Bug 26519: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 707612508311d104a0850aafbd7c678ec05ab389
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 23 16:14:55 2020 +0000

    Bug 26519: Clean up OPAC buttons with incorrect classes
    
    This patch makes some corrections to the OPAC templates to add the
    correct classes to a few buttons which were missed during the
    Bootstrap 4 upgrade, especially in cases where the buttons only appear
    when JavaScript is disabled.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Locate the bibliographic record for a serial record and view the
      details. The subscription should have patron notification set.
    - Under the Subscriptions tab, the "Subscribe to email notifications"
      button should look correct.
    - Click to subscribe and confirm that the buttons during and after the
      process look correct.
    
    - Perform a catalog search in the OPAC. On the search results page,
      disable JavaScript. This can be done in the browser's developer tools
      under "Settings."
    - At the top of the table of search results there should be a
      correctly-styled "Go" button next to the sorting dropdown menu. It
      should work correctly.
    
    - View the contents of a list with JavaScript disabled.
    - The "Resort list" button should be correctly-styled and should work to
      submit the form.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab480d811740fb3b2b160fd752b57508f1c108d5
Author: Mason James <mtj@kohaaloha.com>
Date:   Sat Oct 10 14:06:28 2020 +1300

    Bug 22343: Make the tests pass on U16
    
    fix SSL tests for u16, using older Email-Sender-1.300021
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3599e0001db2b405655c348d2b8c94bd15769fd2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 12 09:32:16 2020 +0200

    Bug 26529: Remove warning
    
    Use of uninitialized value $rule_value in string eq
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f4b54a6d74b9635195bb9ea0b9c11fe5570cf6e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Oct 2 12:11:48 2020 -0400

    Bug 26604: "Generate next" button gives error on serials-collection.pl
    
    In serials-collection.pl, the line
    
    $frequency = C4::Serials::Frequency::GetSubscriptionFrequency($subscription->{periodicity});
    
    causes the error
    
    Can't use string ("13") as a HASH ref while "strict refs" in use at /usr/share/koha/lib/C4/Serials.pm line 2198.
    
    This function call makes no sense, that subroutine always returns a list and doesn't take any parameters. I think it was meant to be GetSubscriptionFrequency which is in fact already called a few lines down.
    
    Signed-off-by: kelly mcelligott <kelly@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD
    
    Test plan:
    1. Create a new subscription
      * When there is an irregular issue: Skip issue number
      * Select a frequency (not irregular)
      * Test prediction pattern and mark some "not published" (to fill the subscription.irregular DB field
    2. Receive a first serial (mark it arrived, an "expected" one is created)
    3. Claim the expected one
    => You have 1 arrived and 1 claimed.
    It's the only way to not have an expected one and hit the else block in serials/serials-collection.pl
    4. Generate next => boom
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ddb312749c34fc4d1c19d48570725978c813bbd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 9 11:28:12 2020 +0100

    Bug 23695: (QA follow-up) Revert 'Orginating library' option
    
    At my request, we added an 'Originating library' option to the manual
    transfers form.
    
    However, we did not properly pass this through in the controller and I
    have since discovered that my request was ill conceived/a
    misunderstanding of requirements.
    
    This patch removes the option from the template and drops the references
    to it in the controller.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9f2fc1eb90bc622daf902b83b7b3c55597710ef
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 9 10:42:31 2020 +0000

    Bug 23852: (QA follow-up) Fix remaining call to biblio-default-view
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b541714a177fc141c77967c8fc528c5c5453139
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 8 11:33:23 2020 +0200

    Bug 26137: Remove warnings from viewlog.pl
    
    The warnings are
    Use of uninitialized value $val in concatenation (.) or string at /kohadevbox/koha/C4/Templates.pm line 138.
    Problem = a value of  has been passed to param without key at /kohadevbox/koha/C4/Templates.pm line 138.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8093f18d4c04fc75af43add253c973c7bb700f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 9 11:04:20 2020 +0000

    Bug 26529: DBRev 20.06.00.048
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00d2b1aae634f7093c614274bc8fe0b7f2163595
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 8 17:48:22 2020 +0000

    Bug 26529: (follow-up) Remove other instance of blanking holdallowed from script
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da218a0d6ffad028792a3f1833679149478dd443
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 28 13:57:01 2020 +0000

    Bug 26529: Remove existing blank rules
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c361e1f4dd0049c036167e9a998a8ec6123fcf3d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 28 13:39:48 2020 +0000

    Bug 26529: Unit tests
    
    This tests tries to set some rules to blank, and then fetch the effective rule - nothing should be
    returned as these values are 'Not set'
    
    To test:
    1 - Apply just this patch
    2 - Tests fail
    3 - Apply second patch
    4 - Tests pass
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 039adae9aa4fa3be76e16633cb64a45ca7d7ed46
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 24 18:21:45 2020 +0000

    Bug 26529: Define some rules as not able to be blank
    
    Currently, the 'Default checkout, hold, and return policy' have a conditional to blank
    'holdallowed' when not set, but other rules don't get the same treatment
    
    This patch uses the existing hash that controls the scope of rules and adds a
    new parameter 'can_be_blank' Default is assumed to be true, can_be_blank, but if set to '0' then
    blank rule values will not be save to the database
    
    To test:
     0 - Set CircControl to 'the library the item is from'
     1 - Goto to Admin -> Circulation and fines rules and select a library
     2 - Under "Default checkout, hold, and return policy" set:
        Total current checkouts allowed: 1
        Hold policy: Not set
        Hold pickup library match: Not set
        Return policy: Not set
     3 - Save the rule
     4 - Check the DB
        SELECT * FROM circulation_rules WHERE branchcode = 'BRANCHCODE'
        using the branchcode for the library you chode
     5 - Note returnbranch, and hold_fulfillment_policy rules exist with blank value
     6 - Set 'All libraries'->'Default checkout, hold and return policy'->'Item floats'
     7 - Checkin an item from the library with blank rules at another library
     8 - It returns home rather than floating
     9 - Apply patch and restart all the things
    10 - Reload the page and save the rules as before
    11 - Check the DB and note the rules no longer exist
    12 - Check in the item, it floats!
    13 - prove -v t/db_dependent/Koha/CirculationRules.t
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab6494fc3de5fc4f325941baf1c65f67634b1c1b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 9 11:04:19 2020 +0000

    Bug 23420: DBRev 20.06.00.047
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc022ab894d863dc660ca57b2d45543a3b4445ec
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Oct 5 17:42:29 2020 +0000

    Bug 23420: (QA follow-up) Remove more AllowPurchaseSuggestionBranchChoice code
    
    Test plan:
    1. git grep -i AllowPurchaseSuggestionBranchChoice **/*.pm **/*.pl **/*.t
    2. There should no longer be any code related to the old sys pref AllowPurchaseSuggestionBranchChoice
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12253d53821b6764e2084db85eb0b56a72a3694c
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Sep 23 23:00:07 2020 +0000

    Bug 23420: (QA follow-up) Remove AllowPurchaseSuggestionBranchChoice syspref
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7d31ef16dd25e025a72397b8eaf2a218f21e2f7
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Sep 18 22:17:58 2020 +0000

    Bug 23420: Add OPACSuggestionUnwantedFields system pref
    
    To test:
    -Apply patch
    -Check OPACSuggestionUnwantedFields
    -Check some fields as unwanted
    -Go to the OPAC suggestion page and make sure these correct fields are hidden
    -Turn on the system preference AllowPurchaseSuggestionBranchChoice to see the branch choice on the form
    -Make sure you can correctly hide this one and still submit the purchase suggestion for without error.
    -Go through each option and make sure it hides properly.
    
    Note: You will only see the patron reason field when there are authorised values in the OPAC_SUG category
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9c799e94239f1e533eb075bc0a347138b32ae75
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Oct 8 11:35:14 2020 -0300

    Bug 23376: (follow-up) Fix subscription bug in orderreceive.tt
    
    When order has subscription, general order variable gets replaced by other order variable in FOR loop
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f686ff9d427a84358a369a4555fbda84bc5254fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 8 16:17:42 2020 +0200

    Bug 13535: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48f9692edd4e6f6095df6471d41cc8bd8c1a1785
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 8 14:14:33 2020 +0000

    Bug 13535: DBRev 20.06.00.046
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffd10c34e252745356c3bef5d3b588fd35d3e5b5
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Apr 12 20:52:11 2020 +0000

    Bug 13535: Add FK constraint on borrowernumber to alert table
    
    When a patron is deleted, we should clean up the data connected
    to the patron. This includes subscriptions to 'new issue arrived'
    arrive messages from the serials module.
    
    To test:
    
    Part1:
    - Before applying the patch
    - Add a subscription and select a notice template for patron notification
    - Go to the OPAC and subscribe to the email alert
    - Log in as any other patron (not yourself) and subscribe with that patron too
    - Verfiy on the subscription detail page, that the patrons are subscribed
    - Note the borrowernumber of your patrons
    - Delete the second patron
    - Note borrowernumber and delete patron
    - Run: SELECT * from alert; in a report
    - Despite the patron being deleted, you will see entries for both
    - Apply patch
    - Run updatedatabase - verify no error message
    - Run updatedatabase again - verify still no error message
    - There should no longer be an entry with the deleted borrowernumber,
      but only the entry for your own patron account
    Part 2:
    - Start fresh with the web installer, verify there are no errors on
      creating the database tables
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42761560c4f3d6014fac920b8a5a295c2ccb5801
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 20 21:48:32 2020 +0000

    Bug 15436: (follow-up) Fix separator for a single 440 in staff
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81f71d45fe4fee92596ea8d8edb57c602490e9b1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 17 11:25:15 2020 +0000

    Bug 15436: Use semicolon between series name and volume
    
    MARC21 dictates that we should be using a ; before $v in 440, 490,
    810, 811 and 830.
    
    This patch also introduces some additional changes to unify formatting
    between the various options for cataloguing series:
    
    - The separator between multiple series is switched form ; to the
      now commonly used | with a class for easy change of formatting.
    - There was some missing logic that prevented the separator to show
      up correctly between traced and untraced series.
    - For some series $v was included in the link for others not. Now
      $v always appears as text and only $a is linked, as this is what
      we actually search for.
    
    To test this:
    - You should be cataloguing multiple series in different ways, using
      - deprecated 440 (still present in old data)
      - 490, Ind. 1 = empty or 0 = not traced
      - 490, Ind. 1 = 1 = traced in combination with an 8xx field
    
    Example (you should try a different combination!)
    440 _ _ $aFirst series
    490 _ _ $aSecond series ;$v1
    490 1 _ $aThird series ;$v1 (this won't show, it will use 830 for display)
    830 _ _ $aThird series ;$v1
    
    Without patch:
    Series: First Series; Second series ; 1Third series: 1
    
    With patch:
    Series: First series | Second series ; 1 | Third series ; 1
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3afd21f71fe18b80bf6d5c5fdd192926874731e1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Sep 12 23:18:33 2020 +0200

    Bug 5927: (QA follow-up) Move part template below show-series to make both *Utils.xsl match
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4e04e2cbaff0a9af124dc5a28ddbdc7058405d0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 11 18:44:13 2020 +0000

    Bug 5927: [Alternate] Show series information in staff and opac results pages
    
    This moves the series info to a template in the XSLT utils files and adds a
    few variables to make it work right.
    
    To test:
    1 - Create a catalog records with:
        440 series fields
        490 traced series fields
        490 untraced series fields
    2 - View the details pages for these records and note the display and the links formed
    3 - Apply patch
    4 - Confirm the details pages look the same
    5 - Search on staff and opac to return the records
    6 - Confirm the results pages form the same series as on details
    7 - Confirm the links work the same
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fee5886432f5189c0a035b48757fff0829f08844
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 17 12:13:36 2020 +0000

    Bug 16728: Add MARC21 777 - Issued with entry to staff and OPAC detail pages
    
    This adds the 777 - Issued with entry to the staff and OPAC detail pages.
    It's built using the template for 773 with minor adjustments.
    
    To test:
    - Apply patch
    - Catalog several 777 fields in one or more of your records
      - When using 1st indicator = 1, the note won't display
      - When using 2nd indicator empty, label will be "Issued with:"
      - When using 2nd indicator 8, the label will be drawn from $i if present
      - When $w and UseControlNumber pref is used, the link will be built using $w
      - In all other cases the title form $t will be used for the link
    - Verify the display is correct
    
    Examples for 777 can be found in the LOC MARC21 documentation:
    http://www.loc.gov/marc/bibliographic/bd777.html
    
    Note: Because the label depends on the 2nd indicator, the label is repeated for every
    777 on a record.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5aab43462a3692bdb1bf051d06ea03ba09362835
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 8 16:17:13 2020 +0200

    Bug 19616: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa2ec4c74c4065ffbc1e16717a8824b8cbf4a041
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 17:16:22 2020 +0000

    Bug 19616: (follow-up) Breaking items according to punctuation
    
    Previously the code assumed that $t indicates a new line in the
    listing. But this is not true. The standard tells us that -- or
    .-- will indicate a new item.
    
    "In records formulated according to AACR 2, a space-hyphen-hyphen-space
    ( -- ) is recorded between each item in the contents note unless a
    delimiter/subfield code follows in which case there is no ending space.
    In pre-AACR 2 records, items are separated by a period-hyphen-hyphen (.--)."
    
    The previous logic did no longer work with $g added. From the LOC
    examples:
    
    This would work:
    505 2 0 $tBaptisms, 1816-1872 --$tChurch members, 1816-1831 --$tHistory of the Second Presbyterian Church of West Durham /$rby L. H. Fellows.
    505 0 0 $tQuatrain II$g(16:35) --$tWater ways$g(1:57) --$tWaves$g(10:49).
    
    This wouldn't:
    505 1 0 $gNr. 1.$tRegion Neusiedlersee --$gNr. 2.$tRegion Rosalia/Lithagebirge --$gNr. 3.$tRegion Mettelburgenland --$gNr. 4.$tRegion südliches Burgenland --$gNr. 5.$tRegion Südburgland
    
    With the patches applied, all examples should display nicely now.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e6b401932151bc8e5b9d444c4317ee7e8e5e1ca
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 16:31:13 2020 +0000

    Bug 19616: (follow-up) Reindent XSLT code used for 505 display
    
    Also adds a note at the beginning of the code block.
    This causes no functional change, just code clean-up.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acc84d428b6c99e4ebadb186f8bf3ae3c7330125
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 16:26:31 2020 +0000

    Bug 19616: Add MARC21 505$g - Formatted Contents Note / Miscellaneous informatoin
    
    This adds the subfield $g to the display of the 505 field in
    staff and OPAC detail pages.
    
    To test:
    - Catalog some records using variations of 505
      Examples can be found in the LOC documentation:
      https://www.loc.gov/marc/bibliographic/bd505.html
    - Verify that the display in staff and OPAC is still nice
      and now includes $g
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81e94d71102bc80881539ac122f94ac8fb7de8c4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Oct 5 16:47:00 2020 +0100

    Bug 23376: (QA follow-up) Remove authnotrequired
    
    The rebased patchset subsequnetly re-introduced the now deprecated use
    of authnotrequired on staff client controllers.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87a6f5fa9ac4ed97226b1b04e0e7e23bb0a705f5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jul 29 20:11:10 2019 +0000

    Bug 23376: Remove unneeded 'count' parameter
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15e35f77fb29137a5421ff79a1186087508aa68f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jul 29 20:05:42 2019 +0000

    Bug 23376: Move AcqCreateItem logic to template
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d4740dfb02bbf4305f66045fc0a01182c717873
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 25 19:52:25 2019 +0000

    Bug 23376: Clean up order receipt page code
    
    This patchset switches from using DB lookups to using an order object for most things on orderreceive.pl
    
    It simplifies the script and makes minimal changes to the template
    
    To test:
    1 - Place some orders and receive them
    2 - Have orders with or without subscriptions attached
    3 - Try with different AcqCreateItems settings
    4 - Apply patch
    5 - No behaviour should change
    6 - Read code to ensure things make sense
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d7c58c10f100a80393c42a62c7c1ecce713c817c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 14 13:09:24 2020 +0000

    Bug 23852: (QA follow-up) Correct scope of breadcrumb title style
    
    This patch corrects the scope of the ".title" style intended for titles
    displayed in the breadcrumbs bar.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 157d329083195d694349fd8aa81b0234c5866b3d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 21 14:13:01 2019 +0000

    Bug 23852: Merge biblio-title.inc and biblio-default-view.inc
    
    This patch moves the functionality contained in biblio-default-view.inc
    into biblio-title.inc. biblio-title.inc can now be called with a "link =
    1" parameter in order for the title to be displayed as a link which is
    controlled by the IntranetBiblioDefaultView preference.
    
    To test, apply the patch and test the affected pages, especially titles
    linked to in breadcrumbs menus
    
    Acquisitions:
     - Add to basket -> From existing record -> Search
       - Title in search results
    
    Catalog:
     - Search for a record
       - Add record to cart
         - Open cart
           - Title in brief display
             - Check that link opens the correct page in the main window
       - View bibliographic record
         - ISBD view
         - MARC view
         - Normal view
          - Local cover image detail page
          - Checkout history
          - Request article
         - Item details
         - From the "Edit" menu -> Attach item
         - Stock rotation rota
         - Place hold
    
    Cataloging:
     - Cataloging search -> Search results
    
    Circulation:
     - Article requests
     - Overdues with fines
     - Overdues
     - Holds queue
     - Holds to pull
     - Hold ratios
     - Holds awaiting pickup
     - Transfers to recevie
     - Renew
     - Batch checkout
    
    Lists:
     - View list contents
    
    Patrons:
     - View patron details
       - Holds history
       - Checkout history
    
    Tools:
     - Rotating collections
       - View collection
         - Add item
     - Tags
       - Click term to see titles tagged with that term
    
     - Batch record deletion
       - Submit batch
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa329bcc4a810c236c461797f078d21a95f18a50
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Sep 18 21:06:03 2020 +0000

    Bug 26280: Add unique class for each problem in returns.tt
    
    1. Checkin an item with a bad barcode and see the prolem class also has
       a class called 'ret_badbarcode'
    2. Checkin an item that triggers a lotforloan updated via
       UpdateNotForLoanStatusOnCheckin, notice the class 'ret_nflupdate'.
    3. You should also see an updated_from and updated_to class. This
       should make it easier to target those for audio alerts
    4. Checkin an item that triggers an location update and see the class
       'ret_locationupdate'
    5. Checkin an item that is not at its permenat location and you should
       see the class 'ret_ispermenant'.
    6. Checkin an item that is not checkout and you should see the class
       'ret_notissued'
    7. Checkin lost items with BlockReturnOfLostItems set to 'Dont block'
       and see the class 'ret_checkedin'
    8. Checkin lost items with BlockReturnOfLostItems set to 'block' and
       see the class 'ret_blocked'
    9. Checkin lost items with a fee on the patron's account for that lost
       item and see the class 'ret_feeremains'
    10. Checkin item that is withdrawn and see the class 'ret_withdrawn'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2524a1a740891b5c229bdd977d9f7ec9ec258407
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 18 11:00:20 2020 +0200

    Bug 26485: Simplify itemnumber handling in returns.pl
    
    This is a follow-up for bug 25969. The way we handle itemnumber is too complicated and error prone.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae475eb15a4b1c8b5c49c1c4f79388c9e1d7686a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 1 14:33:46 2020 +0100

    Bug 26506: (QA follow-up) Add Unit Test
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63c93d3c114c6720100cd2b843e8989a1a0eecb7
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Tue Sep 22 15:16:23 2020 +0200

    Bug 26506: Fix Koha::Account::pay if called when no user is logged-in
    
    Currently, Koha::Account::pay will fail if no user is logged-in when it is
    called.
    
    In this case, this patch will use undef instead of 0 for $manager_id in order
    to comply with the foreign key constraint on manager_id.
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Biblibre and Libriotech have created a OPAC payment plugin that was
    having problems because of this bug. Applying the fix in this patch
    to a live server solved the problem.
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0113df1a7a9495423533b3fe75b8a90c04d056be
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 2 06:20:38 2020 +0000

    Bug 26599: Unused parameter name in POD of ModZebra
    
    This patch removes the $record reference in POD.
    Nothing else ;)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6deb177576f8cb6d1fc02da6555f023f6c27e1d5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 2 06:28:06 2020 +0000

    Bug 26600: Missing module in Elasticsearch/Indexer.pm
    
    Just formally needed. It is already loaded somewhere.
    That is: Koha::SearchEngine::Elasticsearch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea5bb26ee19f29fdb8103df8063c9455f7cc0f5c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 8 12:03:48 2020 +0200

    Bug 24598: Remove warning from test
    
    t/db_dependent/Koha/Items.t .. 6/12 Use of uninitialized value in string eq at /kohadevbox/koha/C4/Circulation.pm line 1460.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a20d3a01c78f05c91818943c713e3192c48c5a5c
Author: Mason James <mtj@kohaaloha.com>
Date:   Fri Oct 9 00:31:33 2020 +1300

    Bug 20582: Turn Koha into a Mojolicious application
    
    fix package builds, by ignoring the following example files...
    
      etc/koha/apache.conf
      etc/koha/nginx.conf
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc61f27b2203d8f7f0dadbf7a13bb4c66e346244
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Aug 7 18:17:49 2020 +0000

    Bug 26184: Add div element to 'items available' note in OPAC reserve template
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f5e6c85d9d86196da802b2d9155b0d7cafad2da
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Sep 14 09:39:44 2020 +0200

    Bug 26449: fix web installer typo
    
    The onboarding segment of the web installer contains a small typo
    in Step 4: "Importantl:" (should be "Important:").
    
    This patch fixes that.
    
    Test plan: apply the patch and access the web installer, Step 4 of
    the onboarding tool should no longer display the typo.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c21de86ab2d1bf5c147dfd453b195a441603e118
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 28 11:46:17 2020 +0000

    Bug 26551: Correct modal markup to prevent long heading from overflowing
    
    This patch modifies the markup of the MARC framework import and export
    modals so that CSS intended only for Bootstrap buttons isn't applied to
    content in the modal.
    
    The modal dialog markup was nested inside a ".btn-group" <div>, which
    carries with it CSS that prevents text wrapping. Moving the modal markup
    out of the button group while keeping it inside the <td> corrects the
    problem. Lines have only been shifted and reindented.
    
    To test, apply the patch and go to Administration -> MARC bibliographic
    framework.
    
    - In the table of frameworks, from the "Actions" menu, test both
      the "Import" and "Export" links. Both should work as expected.
    - Confirm that the text of the heading on the "Import" modal wraps
      correctly.
    - Test the same operations for a framework other than the default one.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b827acf53ffde71d787123095b8524ea6bd08fd6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Aug 11 11:22:22 2020 +0000

    Bug 26191: Relocate track_login call in Auth.pm
    
    This is a leftover from bug 22543.
    Trivial move.
    
    Test plan:
    Do not apply this patch.
    Pick a user that has not yet logged in today.
    Only login via the opac and immediately check if borrowers.datelastseen did not change.
    Apply this patch, restart, flush etc.
    Only login via the opac and verify again rightaway (no further opac actions).
    Now datelastseen should have been changed already.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08386fabcbfbc29f23091f6fd7838fcb362abed3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 8 10:58:48 2020 +0200

    Bug 25913: Get the correct return of AddBiblio
    
    We need the parenthesis to get the biblionumber and not the
    biblioitemnumber, in case there is a discrepancy.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64c939ca80a306af2560c99da0f58b1aeaed13c6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 10:41:45 2020 +0200

    Bug 25913: Prevent get_coins to crash if record does not have title
    
    If a bibliographic record does not have a title, get_coins will crash
    with
    Can't call method "as_string" on an undefined value at /kohadevbox/koha/Koha/Biblio.pm line 645
    Koha::Biblio::get_coins('Koha::Biblio=HASH(0x5558f91bb740)') called at /kohadevbox/koha/catalogue/ISBDdetail.pl line 144
    
    We can handle that situation easily by checking the existence of the
    title field.
    
    Test plan:
    1. Create a record without 245
    2. Enable COinSinOpac
    4. Go to the ISBD detail view
    => It must not fail with this patch applied
    
    Signed-off-by: Heather Hernandez <heather_hernandez@nps.gov>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb3d0982ae8f22fe5354fae93dc4ea13c4f07ce3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 28 15:29:51 2020 +0000

    Bug 25957: Don't push blank field values to ES document
    
    To test:
     1 - Load the sample DB or edit a record (using advanced cataloging editor) to have a blank subfield in a field that is indexed as suggestible
     2 - For example 'author' / 100a
         100 _ _ ‡a
     3 - Index that record into Elasticsearch 5.X:
         perl misc/search_tools/rebuild_elasticsearch.pl  -v -bn 115 -b -d
     4 - Note error 'value must have length > 0'
     5 - Edit mappings to set author 100a not suggestible
     6 - perl misc/search_tools/rebuild_elasticsearch.pl  -v -bn 115 -b -d
     7 - Success
     8 - Set field to suggestible again
     9 - Apply patch
    10 - perl misc/search_tools/rebuild_elasticsearch.pl  -v -bn 115 -b -d
    11 - Success!
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cfdd793549d86f9d607c63fceafb64290981204
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 8 17:29:45 2020 +0000

    Bug 25957: Unit test
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33ab3c690076bf78d62105502b6de54e45e766b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 20 10:10:44 2020 +0200

    Bug 26260: Add missing elastic>cnx_pool to koha-conf-site.xml.in
    
    Added by bug 22705, but only in etc/koha-conf.xml
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f253c61c652cbad99280d38127bbbdc7a9af4091
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 15:51:17 2020 +0200

    Bug 24598: Complete transfer for hold if checked out
    
    When an item that has triggered a hold is in transit to a library,
    if the item is accidently shelved instead of scanned at the pickup library,
    and then checked out to another patron, the holds shows the item still in transit
    in the status, but says that it is waiting at the library, and the since date has vanished!
    
    Test plan:
    1) Place an item at Library A on hold for Patron 1 of Library B with pickup library at Library B
    2) Check in the item at Library A to trigger the hold transfer
    3) At Library B, check out the item to Patron 2 (click Yes)
    => The hold is not marked as in transit and is back to priority 1
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c46f7626d4266ff0ae1bff56e5bbfea5897ec97e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 15:51:13 2020 +0200

    Bug 24598: Add tests
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] 49 to 50 tests.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 880be262da8375edb0e27278dcab0661822f9682
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Oct 6 17:54:09 2020 +0200

    Bug 20582: Map app.psgi file and bin directory in Makefile.PL
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f492e3049a23dfb0e35bba4d60a21f7cc848aae
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Oct 6 13:21:29 2020 +0200

    Bug 20582: Reset CGI::PARAM_UTF8 to 1 before each CGI request
    
    CGI::Compile calls CGI::initialize_globals before each request, which
    resets PARAM_UTF8 to 0
    We need to set it back to the correct value
    
    This is the same trick used in debian/templates/plack.psgi
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f26c7c3d76af06f5a29f00a1c1bbf5fa85fd7b1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 11 11:29:37 2020 +0100

    Bug 20582: (QA follow-up) Add POD to satisfy coding guidelines
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae0c2b52a21f9b6a2705bc745ad0013bf50d3264
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Aug 28 17:39:00 2020 +0400

    Bug 20582: Fix a cache issue in Koha::App::{Opac,Intranet}
    
    This was a workaround I wrote when Koha::Caches->flush_L1_caches was not
    flushing all caches correctly. Now it's not needed and it causes
    problems, so it must be removed.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6a76aae0c66e4103627e55ebff68b58a06a9b32
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Aug 28 17:37:53 2020 +0400

    Bug 20582: Add very simple configuration file for Apache
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit efc9a7d320f896115bee1a9ce4031bf32c46d86a
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Aug 28 17:35:14 2020 +0400

    Bug 20582: Fix PSGI file when behind a reverse proxy
    
    ReverseProxy middleware can modify SERVER_PORT which is used to
    determines which app (opac or intranet) to run, so the choice should be
    made before ReverseProxy middleware
    
    Signed-off-by: Jerome Charaoui <jcharaoui@cmaisonneuve.qc.ca>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92340d03afdee37504afdb792d41b2cad425481a
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 24 10:25:04 2020 +0200

    Bug 20582: Suppress warning in CGIBinKoha.pm
    
    Signed-off-by: Jerome Charaoui <jcharaoui@cmaisonneuve.qc.ca>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57ff9af3bbc79eff4be21ff3745f190266eccc66
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Apr 12 20:42:13 2018 +0200

    Bug 20582: Turn Koha into a Mojolicious application
    
    This patch is a proof-of-concept of Koha as a Mojolicious application
    
    This has several benefits:
    - Development setup is easier. No need for apache or nginx. Just run
      `morbo bin/intranet` or `morbo bin/opac` and go to
      http://localhost:3000 (URL rewrites and static files are handled by
      the app)
    - apache2/nginx configuration is simpler too (an example of nginx
      configuration is included in the patch)
    - starman and plack middlewares can still be used for debug or gzip
      compression for instance (see app.psgi)
    - Using Test::Mojo we can test the whole application, as we do with the
      REST API (which is a Mojolicious application too)
    - It opens a way for converting CGI scripts into Mojolicious
      controllers and actions (even if that's not possible at the moment
      because of the authentication code)
    
    It uses the same mechanism as Plack::App::CGIBin to deal with CGI
    scripts, so it should be equivalent in terms of performance
    
    How to test ?
    - Run `morbo bin/intranet`, then go to http://localhost:3000/ and try to
      find bugs. Check the REST API at http://localhost:3000/api/v1
    - Run `morbo bin/opac`, then go to http://localhost:3000/ and try to
      find bugs. Check the REST API at http://localhost:3000/api/v1
    - Run `starman -l :5000 -l :5001` and verify that intranet
      (http://localhost:5000) and opac (http://localhost:5001) work normally
    - Read the code (and the comments), it's not very long
    
    Signed-off-by: Jerome Charaoui <jcharaoui@cmaisonneuve.qc.ca>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aaec87c80c212c4df8274adca58f5fb232363437
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 5 17:21:04 2020 +0200

    Bug 22417: Remove batch_record_modification from the non-plack list
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20022fa72191b0b4a9ff979cdc3539080cb9d502
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 5 16:36:03 2020 +0200

    Bug 22417: Add exec flag on .t file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5403747de983c6f5f1667257162f23223b436f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 5 16:20:49 2020 +0200

    Bug 22417: Add koha-worker to koha-common.install
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 718fedcde894a37598e77c8bcdc2e92200e6d000
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 5 15:32:21 2020 +0200

    Bug 22417: Correct DBRev bug number
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e08fa0b1877a2c0d68ff98f7713cac697e99c41
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 5 13:27:52 2020 +0000

    Bug 15032: DBRev 20.06.00.045
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13380607137e1e7d2b17e1eee448698208dbf831
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Sep 16 16:59:34 2020 +1200

    Bug 22417: Update packaging files
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b5083bc7be8cfc52d14bc50193a1121a44ccc41
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 2 11:59:10 2020 +0200

    Bug 22417: Process the jobs even if the message broker is not reachable
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98503334cc0ef8504d00561758cbcfe3ed8b926b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 2 11:56:09 2020 +0200

    Bug 22417: Remove list of pending jobs
    
    This was not accurate as it was only retrieving jobs for batch_biblio_record_modification
    
    We will need to improve that later if needed
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c6e6b12a531aaff2546d9c804fb719cb36c718f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 2 11:17:15 2020 +0200

    Bug 22417: Add rabbitmq status indicator on the about page
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b39f69a5a3b0b0c1ac95dcb1858b76f3ab0b2ebb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 1 11:01:25 2020 +0200

    Bug 22417: Add tests
    
    Finally!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5acc93bc80b7f5788ec7744cb5601549f028a36
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 1 10:22:26 2020 +0200

    Bug 22417: Remove $dbh in Koha::BackgroundJob::*
    
    Also remove unused $job_type var
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d33f74fa7e0df8ff7b2b6ff04481f9e897e0e758
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 14:23:18 2020 +0200

    Bug 22417: Fix spelling resizeable vs resizable
    
    For the record, codespell does not raise the problem within ktd with
    1.17.1 but appears with 1.14
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb2aab47444d15e16ace20652c4495f9a1946c92
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 13:10:51 2020 +0200

    Bug 22417: Add new Net::Stomp dependency
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 504e0a2e6a1d0db4d97d2d43992fa304d3564541
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 13:08:53 2020 +0200

    Bug 22417: Add missing POD and html filters
    
    Also remove "authnotrequired => 0,"
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 991456b092e48bcf579fddebd4849f143c25a1b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 28 10:17:47 2020 +0200

    Bug 22417: Remove FIXME in the template
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f774d08be6dc5aff368d5453415c52e0e470ac9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 3 10:12:40 2020 +0200

    Bug 22417: Let owner of a job see the progress
    
    A owner of a job should be able to see the progress of this job.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 716f5458b6b1c6b8396c10b69ff2aa806900e64a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 10:34:50 2020 +0200

    Bug 22417: Remove record_type from BatchUpdate*
    
    We don't need to pass it to the job, they each know which record type
    they are dealing with
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee4b07f18b5258193cb8b3576d9498c936a4134e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 12 11:50:37 2020 +0200

    Bug 22417: Send message to /queue
    
    This cannot be:
      /queue/$namespace/$job_type
    
    I got: '/koha_kohadev/batch_biblio_record_modification' is not a valid queue destination
    
    So keeping the dash in $namespace-$job_type
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53ba2f3ffb7a06511a1fe91a10627008c7a70ed6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 11 12:48:00 2020 +0200

    Bug 22417: Add the new permission manage_background_jobs
    
    QA: Please answer the question in admin/background_jobs.pl
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c79aee3e7f7a5527b04dd97a47b4e35b73d9425c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 11 12:40:03 2020 +0200

    Bug 22417: Restore the 'add to list' feature
    
    This feature has been added recently by bug 18127.
    
    It highlights the need of a post processing hook.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd385809cd34f5c2645eb54b6ffb567cfee00508
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 20 16:39:13 2020 +0100

    Bug 22417: Restore the concept of namespace
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42b35294244c68b9e5413333972360ec93c98c7d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 20 16:03:15 2020 +0100

    Bug 22417: Fix the batch authority tool
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 22417: Add a note about the existence of the DB row
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 22417: (follow-up) Fix the batch authority tool
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2122fd8ee56594486c6136346c92d985d4db8412
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 20 13:26:53 2020 +0100

    Bug 22417: Try to display pending jobs - only work if worker not started
    
    ie. no subscription yet
    
    This needs to be fixed (if possible), or removed from the patchset
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 735e9016ba552d74abda225701eacea1ad5015fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 20 12:23:07 2020 +0100

    Bug 22417: Handle errors
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9251623b8d99b6ae4cb41d38ccf5d511e9ada791
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 19 14:00:03 2020 +0100

    Bug 22417: Switch to STOMP
    
    apt install rabbitmq-server
    service rabbitmq-server start
    rabbitmq-plugins enable rabbitmq_stomp
    apt install libnet-stomp-perl
    cp debian/scripts/koha-functions.sh /usr/share/koha/bin/koha-functions.sh
    cp debian/scripts/koha-worker /usr/bin/
    koha-worker --start kohadev
    tail -f /var/log/rabbitmq/*
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 22417: Remove useless use statement
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a6c56f949044780a639ccc30e5ebadc72b758fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 19 12:03:20 2020 +0100

    Bug 22417: Add debian script koha-worker
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9eb971ca6b74506da6cd28ae44c490c97add0779
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 19 11:14:53 2020 +0100

    Bug 22417: Fix borrowernumber values
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc20949f6598b6f2404cb5d66bc9dbf134170e0a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 27 10:34:42 2019 -0300

    Bug 22417: Add the ability to cancel a job
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63cf7a0307be91d30766a2cf971737077f75cfb9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 25 21:46:01 2019 -0300

    Bug 22417: Adapt the batch_record_modification tool
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c47e0c2a62667648c5e7223bcdf6bb35dc19840
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 25 21:45:35 2019 -0300

    Bug 22417: Add GUI to watch the progress of jobs
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15beff8f1cd3ba54ede7a37525aa22692e0bbbb9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 25 21:43:55 2019 -0300

    Bug 22417: Add Koha::BackgroundJob::BatchUpdateAuthority
    
    This is not ready yet!
    
    Note that this is too close to Koha::BackgroundJob::BatchUpdateBiblio,
    we will want to refactor bit of code.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0848d46ce60b780a9530e46de0bddd2b7ed21ea1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 25 21:43:45 2019 -0300

    Bug 22417: Add Koha::BackgroundJob::BatchUpdateBiblio
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dae4edccc04ce0f8e9646b21dd959a9a64e5fac5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 25 21:42:43 2019 -0300

    Bug 22417: Add Koha::BackgroundJob[s]
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89a2f5f2b0e3009fe507929e6d56d079099ad32d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 25 13:31:48 2019 -0300

    Bug 22417: DBIX Schema changes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df1b8db174cbb1413d034705e1c9a2e8ac5c860d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 25 13:31:15 2019 -0300

    Bug 22417: UpdateDB entry
    
    TODO:
    - Add the FK on borrowernumber
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab2760e7e4dadf0dccd5ad612c15ad69b129bdda
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 5 11:20:20 2020 +0200

    Bug 22343: Remove traces of libmail-sendmail-perl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3a2c4cfffca9c06fbaf274825fbeeecf6bd1c84
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 5 11:19:16 2020 +0200

    Bug 22343: (follow-up) Remove traces of Mail::Sendmail - update POD
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 704a05379133fa56802bb5d406777322dd0ff79f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 2 16:19:06 2020 -0300

    Bug 22343: (follow-up) Remove traces of Mail::Sendmail
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04f2ecb56c1aa91ca2292c375fcd7cdb22a168d5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 2 16:17:40 2020 -0300

    Bug 22343: (follow-up) Make sure no invalid address is used in tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c54da79431bc2e72acd4b23e1c1eabf23170fc64
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 18:05:08 2020 +0200

    Bug 22343: Add exec flag on .t files
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9a63feb730b6b9801d37324aa62ff7d20654f1c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 15:27:52 2020 +0200

    Bug 22343: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80fa9a998f00710d53c70c700285a93767d85f00
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 12:07:15 2020 +0200

    Bug 26290: Display the correct default values on the admin page
    
    The "Default configuration" section at the top of the SMTP servers admin page
    contains the hardcoded values in Koha::SMTP::Servers->default_setting.
    
    It should be the values from the config (and default to hardcoded values unless defined)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e562a0da3fca591e8facc8ca6381bcb17811553
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 11 11:27:17 2020 -0300

    Bug 26290: Make Makefile.PL aware of SMTP configs
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d1dcc3f41f098616d7ca95176d8b815e281535d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 24 16:47:58 2020 -0300

    Bug 26290: Make Koha::SMTP::Servers->get_default use koha-conf.xml
    
    This patch makes the mentioned method use the configured entry in
    koha-conf.xml if present, instead of the hardcoded one, which is kept
    for people that carries an old koha-conf.xml
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59c1151618befae9977b0ed97253584bb44e6d04
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 24 16:19:44 2020 -0300

    Bug 26290: Add option forsetting default SMTP parameters in koha-conf.xml
    
    This patch adds an entry to koha-conf.xml for setting a default SMTP
    server config. 'koha-create' gets option switches for all options.
    
    To test:
    1. Use the tweaked script to crete a new instance
    2. Notice it contains entries for smtp_server and they respect your
       options.
    3. If you don't choose any option, it sets the current default.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1cd243d9d652769f51674dec6879b3b25f0619e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 13:26:41 2020 +0000

    Bug 22343: DBRev 20.06.00.044
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4ebc20aa9c5bcdec0f037ccdc94deb5bb651d66
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 15:22:33 2020 +0200

    Bug 22343: Fix runreport encoding issues
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fbf6f3df961c2137779b94eb848a8c0e556b6b9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 12:16:55 2020 +0200

    Bug 22343: Add the 'required' class when needed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ef67a1119cecb517e8512c9c591fee51cfd2a4e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 11:55:01 2020 +0200

    Bug 22343: Correctly handle password on editing
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8850b7cf68dada380b8d7e5a8f6c83b1da76ebff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 2 11:21:44 2020 +0200

    Bug 22343: Add warning to the about page if KohaAdminEmailAddress is invalid
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3f41caa6dd07d18db4e73216e3f58a92d826c3e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 1 11:28:59 2020 -0300

    Bug 22343: (QA follow-up) Wrap email creation inside the try/catch block
    
    At a later development stage, exceptions where added for bad addresses.
    This wasn't addressed in the controllers.
    
    This patch makes the basket and list sending controller scripts move
    email creation inside the try/catch block to handle those situations. It
    also UTF-8 encodes the attached marc.
    
    On broadly testing this I found that if the TT templates that are used
    to build the email contains non-latin characters, those get
    double-encoded. So this patch also removes an explicit encoding that is
    done, which colides with Email::MIME implicit encoding.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5def63c34af6fff84a561862eacc7189b6f6d4c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 9 11:20:56 2020 +0100

    Bug 22343: (follow-up) Add a hint to the debug form option
    
    This patch appends a small note to the debug form field in the edit/add
    smtp server form to hint that debug mode results in additional output in
    the logs.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b785ae79cceb7406f34e240204137506aa61dc1e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 9 11:16:20 2020 +0100

    Bug 22343: (follow-up) Highlight debug mode enabled
    
    This patch adds a debug class to a row if debug mode is enabled for the
    smtp server and adds css rules to highlight the row by setting the test
    to bold, red and italic.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd7b54ab71f97f9d81967689a7cefdd4b7cbc3ee
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Sep 8 09:38:45 2020 +0100

    Bug 22343: (QA follow-up) Fix some comments
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9c1458df198b6e9008daf5f41a6bc756725bd89
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Sep 8 09:09:49 2020 +0100

    Bug 22343: (QA follow-up) Ensure FK names don't conflict
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69be1f384881f031d2dde9a0288ab161c1086a9b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 24 10:48:56 2020 -0300

    Bug 22343: Allow choosing an SMTP server in branches.pl
    
    The missing piece on this patchset is choosing the desired SMTP server
    for each library. This patch adds the option on editing the library.
    
    The default one is picked for existing libraries, and you can pick the
    one you want.
    
    To test:
    1. Apply the patchset
    2. Run:
       $ updatedatabase
    => SUCCESS: Things go smooth
    3. Notice the new permission for managing SMTP servers
    4. Notice the entry in the admin page
    5. Add/have a few SMTP servers defined.
    6. Edit a library
    => SUCCESS: The 'Default' SMTP server is picked
    7. Choose any server and save
    => SUCCESS: Saving doesn't explode
    8. Edit the server
    => SUCCESS: Your selection is kept (this can also be checked on the DB,
            the library_smtp_server table)
    9. Try (7) with many different options
    => SUCCESS: It works
    10. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26cab84bd5cf33fdcb49924e108302e53d20a0c8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 10 12:57:45 2020 -0300

    Bug 22343: Prevent passing password to the UI
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2577f1f68324604727e84a507ff80e28d949c5df
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 10 09:48:57 2020 -0300

    Bug 22343: Adapt runreport.pl
    
    This script gets adapted to use the new Koha::Email syntax and SMTP
    transport.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59ef597f6ebd96d4f933f7bf91814e810fc3f814
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 6 15:07:10 2020 -0300

    Bug 22343: Adapt controller scripts
    
    This patch adapts controller scripts that used sendmail. Also the syntax
    for Koha::Email has changed and this patch adapts it.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9889eb32c5e141fcff423b46f1b5122945e738be
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 6 15:06:48 2020 -0300

    Bug 22343: Adapt Koha::Illrequest
    
    This patch makes Koha::Illrequest use the new syntax for Koha::Email and
    sending the email.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a80954aa3538785af4064f5aa0961c28a9b0685
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 6 12:43:17 2020 -0300

    Bug 22343: Make C4::Letters use the new SMTP server config
    
    This patch makes the different methods in C4::Letters use:
    - Koha::SMTP::Servers: to get the effective SMTP server for the library
      or the fallback default if no library in context.
    - New Koha::Email->create method for crafting the email envelope for
      sending.
    
    The tests are adapted so they behave the same way, but the trapped (in
    the mock) $email object has the right type and its attributes are
    accessed correctly.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Letters.t
    => SUCCESS: Tests pass. YAY!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 178592887bf9fe24d681a6c1d5f64ab1b8b5766e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 6 12:38:45 2020 -0300

    Bug 22343: Revamped Koha::Email class
    
    This patch completely rewrites the Koha::Email class, inheriting from
    Email::Stuffer. The latter suits well the use by Email::Sender, which is
    to replace Mail::Sendmail on this patchset.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/Koha/Email.t
    => SUCCESS: Tests pass!
    3. Verify all conditional codepaths are covered
    4. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0de6a7edff50c30b2b5580d12472813aaf0711d3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jul 29 17:35:50 2020 -0300

    Bug 22343: Add CRUD page for SMTP servers
    
    This patch introduces a way to define SMTP servers either globally or
    per-library.
    
    To test:
    1. Apply this patch
    2. Find the SMTP servers entry in the admin page
    3. Play with adding/removing SMTP servers
    => SUCCESS: All works as expected
    4. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95aa8fc64b242f35f68b58140874b31e8f41d21a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jul 29 16:10:47 2020 -0300

    Bug 22343: API routes for SMTP servers CRUD
    
    This patch introduces API routes for handling SMTP servers.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da16f8165da01f4ae92badee71daffdc4087e32c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sun Aug 23 17:53:35 2020 -0300

    Bug 22343: Update cpanfile
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e51e39b72fa0ebaa7dfb0f67e5552568b2db1aec
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sun Aug 23 17:39:23 2020 -0300

    Bug 22343: Add Koha::Library->smtp_server
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfe216bd19fe3e6ad20b5189962d235fa5c8d573
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jul 28 12:35:26 2020 -0300

    Bug 22343: Add classes for handling SMTP servers
    
    This patch introduces classes to handle SMTP servers. It is done in a
    way that a default server can be set, and then per-library ones can be
    set. All should be done with Koha::SMTP::Servers methods, that take care
    of overwriting library-specific configs, and handle the defaults
    retrieval and setting correctly.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
       $ perl installer/data/mysql/updatedatabase.pl
    => SUCCESS: Atomic update is ok, smtp_servers table created
    3. Run:
      k$ prove t/db_dependent/Koha/SMTP/
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44b3e64431ddaa99ce24b63acba3c0b81cb58f78
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jul 28 09:53:02 2020 -0300

    Bug 22343: DBIx::Class schema updates [DO NOT PUSH]
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f6f56f7260474c1ddf4d27ea0e7aeef974d8ca3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jul 28 09:52:32 2020 -0300

    Bug 22343: Add new tables schema file
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1854d20b4694407c48a3891d8c364649ab34b7b3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 21 10:59:48 2020 -0300

    Bug 22343: Add parameters => manage_smtp_servers subpermission
    
    This patch introduces a new subpermission for managing SMTP servers, for
    granularity.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c94e2b2e327e96e144c325e7216a1b9a2bca165f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jul 28 09:46:08 2020 -0300

    Bug 22343: Add a new table to store SMTP servers configs
    
    This patch adds a new table to store SMTP servers configs.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eafdab5a055f32c76d4f5113bdd13f82223a9cff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 1 15:04:59 2020 +0200

    Bug 24155: Fix parameter order to fix search_utf8.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4fa2eafda0575c39ca6deb7e00dc887921f77b3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 14:16:53 2020 +0000

    Bug 25261: DBRev 20.06.00.043
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 189baf8f49cb853e955849dd9a7ad61f6868ac32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 1 11:35:00 2020 +0200

    Bug 25261: Prevent tests to fail if CircConfirmItemParts is on
    
    Setting items.materials to NULL at TestBuilder level will (certainly) prevent some
    tests to fail if the pref is on
    
    In t/db_dependent/selenium/basic_workflow.t we set 952$3 to an empty
    string. The tests will pass even if the pref is turned on.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ab62474357e031c6509abbe0a97e4c0fe079cb6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 17 15:01:32 2020 +0100

    Bug 25261: (QA follow-up) Prevent server error on bad barcode
    
    Prior to this patch if you had CircConfirmParts enabled and you
    attempted to checkin a deleted item then you would be met with a server
    error.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc02192eb73486c6f0491dbccc18041db674a90b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 17 12:59:11 2020 +0100

    Bug 25261: (QA follow-up) Catch attepts to return via SCO
    
    This patch adds a block to capture attempts to return items with
    attached materials when checking in via the self checkout when the
    relevant system preference is set.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a47b5812a939aaff02871b96411ea17e8d33598
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 17 12:21:10 2020 +0100

    Bug 25261: (QA follow-up) Make issue and returns messages consistent
    
    This patch makes the confirmation dialogue handing and visuality
    consistent between issues and returns.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8988941dbc428b9f197df954f05673f5ab874657
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 16 13:18:09 2020 +0100

    Bug 25261: (QA follow-up) Prevent double dialogue
    
    This patch removes the blue information message box if we are using
    multi-part confirmations.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3a4d74b2f63181c43b0224ca72e868fe8e76b5f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Sep 14 07:40:10 2020 +0000

    Bug 25261: (QA follow-up) Terminology: checkin/checkout
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d845febfd57288262b2ccf1aec08f8f5f2442fb4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 2 12:17:56 2020 +0100

    Bug 25261: (QA follow-up) Restore previously returned list
    
    Test plan
    0 - Enable ShowAllCheckins
    1 - Check in several regular items
    2 - Check in an item with parts
    3 - Confirm the checkin in
    4 - The list of checkins contains all the previous checkins and the
      multi-part checkin too.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be379b664c1cd2c997dc0af742cf00781f2faea9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 2 12:00:07 2020 +0100

    Bug 25261: (QA follow-up) Capitalize return of needsconfirm
    
    This patch capitalizes the 'ADDITIONAL_MATERIALS' key in the
    needsconfirm hash return value for CanBookBeIssued to restore
    consistency with previous code and ensure SIP Checkout works as
    expected.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 978daf841293cd7fa7dae7163b672d130c006362
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 13 17:52:18 2020 +0100

    Bug 25261: (QA follow-up) Add handling to SCI
    
    Test plan
    1/ Enable the feature as per previous patches
    2/ Attempt to return an item with materials attached via the SCI
    3/ Note that the return is blocked with the message '(The item
    cannot be returned at a self service terminal, please see library
    staff for assistance)'
    4/ Signoff
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e51038687903eb92af4e327333aec027f5fb0247
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 13 16:44:28 2020 +0100

    Bug 25261: (QA follow-up) Catch check in SIP Checkin
    
    Test plan
    1/ Enable the feature as per previous patches
    2/ Attempt to return an item with materials attached via a SIP unit
    3/ Note that the return is blocked with an alert type of '99'
    4/ Signoff
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 334c8e94c11554aaf810db4b4e0b5ad0043c19f7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 13 16:27:50 2020 +0100

    Bug 25261: (QA follow-up) Add handling to SCO
    
    Test plan
    1/ Enable the feature as per previous patches
    2/ Attempt to checkout an item with materials attached via the SCO
    3/ Note that the checkut is blocked with the message 'Item must be
    issued at a circulation desk'
    4/ Signoff
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d9fc7331a873835aa7e1fd2f1a112becccfad85
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 13 16:23:25 2020 +0100

    Bug 25261: (QA follow-up) Catch check in SIP Checkout
    
    Test plan
    1/ Enable the feature as per previous patches
    2/ Attempt to checkout an item with materials attached via a SIP unit
    3/ Note that the checkut is blocked with the message 'Item must be
    issued at a circulation desk'
    4/ Signoff
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e346db48a741d4a8639e9e463cca8a6b13e9109
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 5 10:52:48 2020 +0100

    Bug 25261: (QA follow-up) Add confirmation to issues table
    
    The issues table allows for checkins and was not appropriately
    requireing confirmation for the multi-part confirmation added in this
    bug.
    
    Test plan
    1/ Enable the feature as per previous patches
    2/ Checkot an item with attached materials
    3/ Navigate to a page that display your users issues table (the checkout
    page is a reasonable example)
    4/ You should have the option to select items for return in the table
    (If not, use the column settings to enable the feature)
    5/ Select at least the item with attached materials to return
    6/ Upon clicking the return buttton you should find that items without
    additional materials are returned as expected, but rows with additional
    materials turn yellow and contain a message and additional checkbox for
    confirmation in the table.
    7/ Ensure the checkbox is selected and click the return button again
    8/ This item should have been returned.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acf11bacfdf72c5eb08be46a4a814914970a43ae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 24 12:05:29 2020 +0100

    Bug 25261: (QA follow-up) Non-confirm on return
    
    This patch updates the confirmation from an alert to a dismissable modal
    which allows for optionally not checking the item in
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41589686e8b9aba7123540ff8ad9f186f5726c89
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 24 10:33:26 2020 +0200

    Bug 25261: (QA follow-up) Simplify tests and conditions
    
    Use build_sample_item in tests
    Simplify tests for the confirmation
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2146523b2865497fe904d1e182a5193a80752b86
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 6 10:33:35 2020 +0100

    Bug 25261: (QA follow-up) Add unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e83978614125437078ba7fed93d79c8843e6f069
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 6 09:25:37 2020 +0100

    Bug 25261: (follow-up) item.material may contain non-numerics
    
    Whilst QAing bug 13547 it was highlighted to me the at the 952$3 field,
    and thus the item.materials field, may contain arbitrary notes about the
    material rather than just numeric values. As such we need to check for
    the field being defined as aposed to greater than '0'.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54454554e9d80e6369e3726826abf08a8356c2ea
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 6 09:20:32 2020 +0100

    Bug 25261: (follow-up) Rename CircConfirmParts to CircConfirmItemParts
    
    This clarifies the preference name to make it clear we are talking about
    the 'parts' that make up an 'item'. 'Part' is a well known term in
    british english libraries and I think perhaps 'Materials' may be
    confused with other terms?
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e8b9a652b86726f7154c1dac6adb2cc24c5b44f
Author: Frédéric Demians <f.demians@tamil.fr>
Date:   Thu Apr 30 12:03:19 2020 +0200

    Bug 25261: Checkout confirmation depending on syspref
    
    With this follow-up patch, the intended confirmation of checkin based on
    CircConfirmParts value is effective.
    
    Sponsored-by: Royal College of Music [https://www.rcm.ac.uk/]
    Sponsored-by: PTFS Europe [https://ptfs-europe.com/]
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdfb8a556f02761a7e987659f36e237749e8f23e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 5 13:52:09 2015 +0100

    Bug 25261: Require confirmation of multiple parts items
    
    Test plan
    1/ Catalogue an item to contain multiple parts by populating 'Materials
    specified (bound volume or other part)'
    2/ Enable the new system preference 'CircConfirmParts'
    3/ Attempt to checkout the item created in step 1 to a user and note
    that confirmation is now required.
    4/ Checkout the item
    5/ Attempt to checkin the item you have just checked out and note that
    confirmation is required.
    6/ Signoff
    
    Sponsored-by: Royal College of Music [https://www.rcm.ac.uk/]
    Sponsored-by: PTFS Europe [https://ptfs-europe.com/]
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6ca5a6e12f0d3023716a06be9e98cbd9fb0d15a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Apr 28 13:13:00 2020 +0100

    Bug 25261: Add system preference
    
    Sponsored-by: Royal College of Music [https://www.rcm.ac.uk/]
    Sponsored-by: PTFS Europe [https://ptfs-europe.com/]
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28ecd4cb7e6281260cfc36af6f411cc734201691
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 15:16:25 2020 +0200

    Bug 14648: Take advantage of I18N to deal with plural
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04c499b11dfdebc7efb976952d135a1b1af1a140
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 17 09:34:57 2020 +0000

    Bug 14648: (QA follow-up) Terminology items-reserves delete-remove
    
    - As we have batch add reserves, we should also have batch remove reserves
    - Delete items sounds a bit scary, removed items I think is a little better here
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02f65c89255cb93a08b7b3ac3918c04fe085ac1f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 17 09:22:39 2020 +0000

    Bug 14648: (QA follow-up) Add missing filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bf7430d1c41bf9acb363f4fff9476f6ee653fdd
Author: Joe Sikowitz <joe@flo.org>
Date:   Fri Jul 17 11:34:30 2020 -0400

    Bug 14648: Batch remove reserve items
    
    Adds "Batch remove items" button to course-reserves.tt. Creates batch_rm_items.pl and batch_rm_items.tt. Allows user to enter a list of
    barcode numbers so that they will be removed from all course reserves to which they are attached. A dialog box will provide a warning
    before the final deletion is made.
    
    This patch also now moves barcodes that are invalid or not attached to a course reserve to the invalid barcodes output. It also provides
    a count of the courses that the deleted items were attached to.
    
    Test Plan
    1. Log in as a user with permissions to add and delete course reserves
    2. Add the same items to multiple course reserves
    3. Go to the main course reserves page (i.e. /cgi-bin/koha/course_reserves/course-reserves.pl)
    4. Click the "- Batch remove items" button
    5. Enter the barcodes that you added to multiple reserves in step 1
    6. Click submit
    7. Click Ok if you are ready to delete all of these items
    8. Check each course reserve that you added the items to in step 1 to make sure the items you entered were deleted but nothing else
    9. Repeat 2-5
    10. Add an invalid barcode and a valid barcode that is not attached to a course reserve
    11. Repeat 6-7
    12. You should see that the items attached to course reserves were removed while the invalid and unattached barcodes were rejected
    13. Log out
    14. Log in as a user without permission to delete course reserves
    15. Go to the main course reserves page (i.e. /cgi-bin/koha/course_reserves/course-reserves.pl)
    16. You should not longer see the "- Batch remove items" button
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c72f01d9072a35753d235db26983560a4c984522
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 14 13:33:01 2020 +0000

    Bug 19322: Typo in UNIMARC field 140 plugin
    
    This patch corrects some incorrect information in the UNIMARC plugin for
    tag 140. Literature code "li" should be "mystic literature."
    
    To test you do not need a UNIMARC installation. Apply the patch and go
    to Administration -> MARC frameworks and Actions -> MARC structure for
    one of your frameworks.
    
    - Edit subfields for a tag, e.g. 245. This is only for testing purposes
      so it doesn't have to be any particular tag.
    - Change the options for one of the subfields, e.g. $a. Under "Other
      options (choose one), set "Plugin" to "unimarc_field_140.pl"
    - Save changes.
    - Open a bibliographic record for editing using the framework you
      modified.
    - Click the plugin link next to the subfield you modified, e.c. 245$a.
    - This should trigger the "UNIMARC field 140 builder" popup window.
    - Find "Literature" and select "Mystic literature." Save.
    - In the MARC editor, the field you modified should contain the value
      "li" at position 17-18.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fce5887e16c7869eeeea49c4bab6620eaa2f26e3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 14 13:49:14 2020 +0000

    Bug 19327: Typo in UNIMARC field 128a plugin
    
    This patch corrects some incorrect information in the UNIMARC plugin for
    tag 128$a. The value for "partsong" should be "pt#"
    
    To test you do not need a UNIMARC installation. Apply the patch and go
    to Administration -> MARC frameworks and Actions -> MARC structure for
    one of your frameworks.
    
    - Edit subfields for a tag, e.g. 245. This is only for testing purposes
      so it doesn't have to be any particular tag.
    - Change the options for one of the subfields, e.g. $a. Under "Other
      options (choose one), set "Plugin" to "unimarc_field_128a.pl"
    - Save changes.
    - Open a bibliographic record for editing using the framework you
      modified.
    - Click the plugin link next to the subfield you modified, e.c.
      245$a.
    - This should trigger the "UNIMARC field 128a builder" popup window.
    - Select "partsong" in the dropdown. Save.
    - In the MARC editor, the field you modified should contain the
      value "pt#"
    - Trigger the popup window again and click "Save" without making
      changes.
    - The value in the MARC editor should be the same.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 817a84001e3a14c0b54b0b36dfef2f7f496aad27
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Sep 25 09:35:49 2020 -0400

    Bug 21979: Add unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e58689a9b9421ca23bcd29d86403670a39412c3f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Dec 7 14:32:00 2018 -0500

    Bug 21979: Add option to SIP2 config to send arbitrary item field in CR instead of collection code
    
    Some libraries need to send a different field as the collection code,
    depending on how the library catalogs items. We should allow any arbitrary
    item field to be used as the value for the CR field.
    
    Test Plan:
    1) Apply this patch
    2) Set the new option cr_item_field to 'shelving_location'
    3) Restart the SIP server
    3) Perform a checkin via SIP
    4) Note the CR field contains the shelving location code in the response
    5) Perform an item information request
    6) Note the CR field contains the shelving location code in the response
    
    Signed-off-by: Jesse Maseto <jesse@bywatersolutions.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87ca07f4231b72c62ad8e9ba895a3e7575b8c114
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Sep 26 20:36:12 2020 +0200

    Bug 23114: (QA follow-up) Slightly rephrase message when both barcode options are used
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b5a37fa198bacfa6434c235aecf9af2c54e95f4
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Wed Jun 26 14:58:44 2019 +0200

    Bug 23114: Inventory: allow to scan barcodes
    
    This patch allows the user to scan barcodes in the inventory tool
    (in addition to upload a barcode file, like in other tools)
    
    Test plan:
     1) Apply the patch.
     2) Check that you can still upload a barcode file.
     3) Check that you can scan/enter barcodes in the new textarea.
     4) Check that if you both upload a barcode file and enter barcodes,
        you will be prompted to choose only one method.
     5) Check that you can then proceed to the next step by either resetting the
        upload file input or emptying the textarea.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e2aba2c02b0a838a6dd83019e7a64269bc8747b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 18 15:28:17 2020 +0000

    Bug 24155: (follow-up) Template fixes and updates
    
    This patch makes a few minor changes to the OPAC and staff interface
    templates:
    
    - In both, the "Apply field weights" checkbox will only appear after the
      "More options" button has been clicked. Otherwise a hidden input sets
      the value to 1.
    - In both, the checkbox now appears below the search fields.
    - Checkboxes are now wrapped in the <label> tag to ensure the label is
      clickable.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e302abf49d8d4dd6e099b387d2b63fc4c20a14ae
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 31 12:38:02 2020 +0000

    Bug 24155: (follow-up) Add span with id to weighted search option
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fec3cf23f1fe8b71e225fffbc6cd361637b3729e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon May 18 17:32:43 2020 +0000

    Bug 24155: Apply weights if not advanced search
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e474df640294abfe852fc8231a4cb7ef7206aa92
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Feb 26 14:30:17 2020 +0000

    Bug 24155: Make weighting an option on advanced search
    
    Currently we apply weighting to all searches except advanced search. The theory
    being that when selecting indexes we don't want to apply weights. When searching
    in ES weights are only applied to relevant results so it doesn't matter.
    
    i.e. if weighting author*100 but searching subject, a term matching the subject search in author
    is not boosted.
    
    Given this, we should always apply weights, unless the user wishes not to
    
    To test:
    1 - Set some weighting
    2 - Do some searches
    3 - Note your terms and results, try advanced and regular searches specifying indexes or not
    4 - Apply patch
    5 - Note that opac and staff advanced search have option to apply weights
    6 - Compare searches after the patch to see how weighting affects, it should be beneficial or not at all
    
    Signed-off-by: Myka Kennedy Stephens <mkstephens@lancasterseminary.edu>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88f34a355443f8cc530315e6117265f0540e3b8c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 14:33:47 2020 +0200

    Bug 24322: Simplify condition to separate elements
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6824b93b0270a2b2a99b85c36f7a535ec9e4530e
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@hypernova.fi>
Date:   Sun Sep 13 23:57:41 2020 +0200

    Bug 24322: National Library of Medicine (NLM) call number to XSLT Detail
    
    This adds MARC21 060 - National Library of Medicine Call Number
    https://www.loc.gov/marc/bibliographic/bd060.html
    
    To test:
    - Catalog records using the 060, examples can be found in the
      LOC documentation.
    - Verify that the field displays on the detail pages in staff
      and OPAC
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    RRescued this patch by redoing the changes. Only change made
    was moving the section up before "Other classification".
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0efa9a917b1333409c7e8e664b95fb1f1afac051
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 1 10:33:08 2020 +0200

    Bug 25242: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e5142e61be8604c5144077d15e3782e6853677b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Sep 1 17:11:24 2020 +0100

    Bug 25242: Improve column wrapping for holdingst
    
    This patch attempts to improve the column wrapping for the holdingst
    datatable and sets the tabel to fixed width to prevent overlapping
    with other content on high zoom levels/low width screen sizes.
    
    Test plan
    1/ Build the OPAC CSS from the updated SCSS
    2/ Navigate to an item with holdings visible in the OPAC
    3/ 'Play' with various window sizes and zoom levels.
    4/ The table should not overlap with right navigation content
    5/ Signoff
    
    NOTE: This is an alternative patch to those pushed and reverted that
    attempted to provide a global fix to overlap issues. This patch
    specifically targets just the holdings table in the opac detail view.
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Alexis Ripetti <alexis.ripetti@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9aa84cb348731f3429e586ace93d5e54cceb572a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 16 13:16:30 2020 +0000

    Bug 25771: Allow the user to sort checkouts by the renew column in the OPAC
    
    This patch makes it possible for the logged-in OPAC user to sort their
    checkouts by the number of renewals they have remaining on their
    checkouts.
    
    To test, apply the patch and log in to the OPAC as a user with multiple
    checkouts. To fully test the patch's functionality the user's checkouts
    should have a varying number of renewals available.
    
    On the "your summary" page, confirm that the "Renew" column is now
    sortable and that it sorts correctly by the number of renewals left on
    each checked-out item.
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e55d445e5a814e32efa0313f9147061aa71278a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 17:33:33 2020 +0200

    Bug 25776: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a51e4425571c0923750b99ed58575e2b9494a5cd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 14:16:31 2020 +0000

    Bug 25776: DBRev 20.06.00.042
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a1c5c13962d01e3c181d2c20fed7efeeed4aecf
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 17 09:02:32 2020 +0100

    Bug 25776: (QA follow-up) Add missing filter
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2cd12ac4d4cafac7fa48393ad61fa6a3b8995194
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Aug 31 21:53:29 2020 +0000

    Bug 25776: (follow-up) Fix sorting by change date in notices table
    
    Some markup was missing to sort the date correctly.
    
    To test:
    - Verify date sorting in the notices table works as expected
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50877291b26b316eacdf0fdca759d9e8c3004a77
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Aug 27 10:38:25 2020 +0000

    Bug 25776: Add a 'last updated' column for notices
    
    This add an 'udated_on' column to the letter table and displays
    the information in 'slips and notices'.
    
    To test:
    - Apply patch
    - Run updatedatabase
      Note: the existing letters will all be set to the
      currnet date).
    - Go to Tools > Notices and slips
    - Verify there is a new column "Last updated" in the table
      Note: The table will always display the newest change date
      of the different message transport types.
    - Edit any notice
    - Verify the "Last updated" is shown for any transport type
      with an existing notice definition
    - Edit and add a notice
    - Verify the dates are correctly stored
    - Test the column configuration for the new column works
      correctly
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80465d502f2d9d54e65c3f30abfb07134c1fe2ca
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 18 13:14:33 2020 +0000

    Bug 26484: Add serials-related reports to serials sidebar menu
    
    This patch adds a section to the serials sidebar menu for showing
    serials reports.
    
    To test, apply the patch and go to Serials.
    
    - If you are logged in as a user with permission to access reports you
      should see a new "Reports" heading in the sidebar menu and a link to
      the serials statistics wizard.
    - Confirm that the link works correctly.
    - Log in as a user without reports permission and confirm that the
      section doesn't appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf5b8c2be79a9dfd6eee61ccda6f0852bca9f39c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 29 15:18:12 2020 +0000

    Bug 26089: Add acquisitions-related reports to acquisitions sidebar menu
    
    This patch adds links to two acquisitions-related reports in the sidebar
    menu shown on acquisitions pages: Acquisitions statistics wizard and
    orders by fund.
    
    To test, apply the patch and go to the Acquisitions page.
    
    - If you are logged in as a user with permission to access reports you
      should see a new "Reports" heading in the sidebar menu and links to
      two reports.
    - Confirm that the links work correctly.
    - Log in as a user without reports permission and confirm that the
      section doesn't appear.
    
    Signed-off-by: Brandon J <brandon.jimenez@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3619c88cdaa093e53e1d9f9b15dad0db0c39ba4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 28 11:09:01 2020 +0000

    Bug 26207: (follow-up) Hide comparison toolbar if there are no comparisons
    
    This patch adds a check to the JavaScript so that the comparisons
    toolbar will be hidden if there are no system preferences in the results
    to compare.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 574e2e80eb0f57838a548f42a0689aa2979b5745
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 20 12:47:01 2020 +0000

    Bug 26207: (follow-up) Remove whitespace from markup
    
    Markup indentation around log entries in the template cause extra
    whitespace in the diff view. Removing the markup whitespace corrects it.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3d89e629eb984511c71b2844899c08036bfa6fb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 14 12:08:10 2020 +0000

    Bug 26207: Compare values of system preference log entries
    
    This patch adds the ability to compare the values of system preferences
    in the system log. The user can select two entries in the log search
    results and view a diff of the two versions.
    
    The feature is designed specifically for CSS and JS preferences like
    OpacUserCSS or OpacUserJS where code changes are difficult to track.
    
    To test, apply the patch and go to Tools -> Log viewer. You may need to
    add values and make changes to preferences like OpacUserCSS if you don't
    already have a history in your logs.
    
    - Perform a search for log entries in the "System prefs" module.
    - In the results, each entry for a system preference should have a
      "Compare" checkbox."
    - Check one of the checkboxes.
      - The table should now be filtered by the system preference name. This
        facilitates meaningful selections for comparison.
      - You should see a message displayed onscreen, "Showing results
        for...[ preference name]"
      - The "Check none" link in the toolbar above the table should now be
        enabled.
      - If youy click the "Compare selected" link in the toolbar at this
        stage you should get a message, "You must select two entries to
        compare."
      - If you uncheck the checkbox the table should return to an unfiltered
        state.
    - Check two checkboxes.
      - The "Compare selected" link in the toolbar should now be enabled.
      - Next to each of the checkboxes you checked should be a "View
        comparison" link.
      - Clicking either of the "View comparison" links or the "Compare
        selected" link should trigger a modal with the diff view of the two
        preferences.
    - Try to select a third checkbox. You should get a message, "You can
      select a maximum of two checkboxes." The box should remain unchecked.
    - Test that unchecking both checkboxes manually clears the table filter.
    - Test that the "Check none" link works to uncheck checked boxes and
      clear the table filter.
    
    Signed-off-by: Brandon J <brandon.jimenez@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33c89690390de2e637dc22855afaf01e12412685
Author: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
Date:   Fri Sep 18 05:55:22 2020 +0000

    Bug 26266: Add jQuery validator to opac-password-recovery.tt
    
    To test:
    0) Activate password reset in system preferences.
    1) Initiate a password recovery.
    2) Try to submit with an invalid password.
    3) Confirm that validation occurs.
    4) Try to submit with mismatching passwords.
    5) Confirm that validation occurs.
    6) Sign off.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e327f696f7ffbdf6346f71b6c0df4d77363d457
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 17:32:01 2020 +0200

    Bug 26268: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90756266e6766ad4530a561559ddf47de1794a85
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 14:16:31 2020 +0000

    Bug 26268: DBRev 20.06.00.041
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80da74f8d3cc11ee949ea1c36457987c6b0f9176
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 17:05:54 2020 +0200

    Bug 26268: Fix deleteditems query in DB rev
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9625c409b46cd503a06aab896900926e2b3eb27c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Sep 25 20:09:33 2020 +0000

    Bug 26268: Remove invalid mappings from MARC frameworks when items.paidfor is removed
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d93cbf75a4fbb4fb7b2f81ac82d19e08d2571894
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Sep 26 23:44:02 2020 +0200

    Bug 26268: Correct mapping for internal note to items.itemnotes_nonpublic
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 175838804559e79f365a47aca827a8abb1123d6d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 11 12:51:47 2020 +0100

    Bug 26268: (QA follow-up) Conditionally remove
    
    This patch adds conditions to prevent the removal of items.paidfor if it
    is populated and also adds the removal fo the marc_subfield_structure
    row if it exists.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d2b6a3f3506102dc7cd8ccc729f96579f753fae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 4 17:04:53 2020 +0100

    Bug 26268: (QA follow-up) Split DB update checks
    
    This patch splits the DB update such that the 'paidfor' field is checked
    for distinctly in the deleteditems table rather than assuming if it
    exists in the items table it will also exist in deleteditems.
    
    We also correct the check as highlights by Julian.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff64264092f663cf32ba44f2e46367c237f97ddd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 21 11:29:10 2020 +0100

    Bug 26268: Remove final references to paidfor db field
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f45b3b3f3a6c0ed8cc946b6f65573f041e0e1e72
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 21 11:25:12 2020 +0100

    Bug 26268: Remove items.paidfor from the database
    
    In bug 19919 we removed all references to setting, unsettling and
    referring to the paidfor field but we neglected to actually drop the
    field from the database (I think I intended to do this, but was asking
    for feedback on the approach before adding the actual db change.. then
    completely forgot when it went through SO/QA quickly).
    
    In bug 23463 we inadvertently re-introduced some of the setting code
    during a rebase.
    
    In bug 18501 we then moved that inadvertently re-introduced setter into
    Koha::Item->store.
    
    We should kill it off once and for all!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5dcca80dc5080dea098938767b1587a42f2ed65b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 3 13:25:45 2020 +0000

    Bug 26299: Use same SMS number help text in OPAC as staff interface
    
    The SMS number help text in the OPAC follows a North American phone
    number style. It should be more generic. To that end, this patch
    makes the OPAC use the same help text for SMS numbers as
    the staff interface
    
    To test:
    1) Apply the patch
    2) Set "SMSSendDriver" to "Anything" in global system preferences
    3) Go to the following link and note the help text by SMS number
    http://localhost:8081/cgi-bin/koha/members/memberentry.pl?op=modify&destination=circ&borrowernumber=51
    4) Go to http://localhost:8080/cgi-bin/koha/opac-messaging.pl
    5) Note that the help text in both interfaces uses the same wording
    
    Signed-off-by: Alexis Ripetti <alexis.ripetti@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4013f660c47ad697747e9860e159aa23bc4e409
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 31 16:43:53 2020 +0000

    Bug 26325: Add primary_key_exists check to C4::Installer
    
    To test:
    1 - prove -v t/db_dependent/Installer.t
    
    Signed-off-by: Brandon J <brandon.jimenez@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebfbefdeb1a0b4db9f7fd7ca003d75c2038c234e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 1 10:32:10 2020 +0200

    Bug 26338: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb59f3f0f046c7b08fa509e76c416b2c4db3fa5a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Sep 1 15:43:19 2020 +0200

    Bug 26338: Show tool plugins run in tools home
    
    In tools home there is a link to the table showing tool plugins.
    Would be great to be able to run a tool plugin directly from tools home.
    
    Also adds the behavior than if there is no tool plugin, "Tool plugins"
    section is not displayed in tools home.
    No need of a link that goes to an empty table ;)
    
    Test plan :
    1) Enable plugins, dont install any
    2) Go to "Tools" module : /cgi-bin/koha/tools/tools-home.pl
    3) Check you dont see "Tool plugins"
    4) Install a tool plugin like Carrousel https://inlibro.com/instructions-carrousel/
    5) Refresh /cgi-bin/koha/tools/tools-home.pl
    6) Check you see "Tool plugins" and a link to Carrousel
    7) Click on link to Carrousel => You see plugin run
    8) Disable Carrousel plugin
    9) Refresh /cgi-bin/koha/tools/tools-home.pl
    10) Check you dont see "Tool plugins"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d7e9388e4d847ab95b560df98eb78a2ff7ab5f74
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 11 09:36:21 2020 +0200

    Bug 26425: Update history.txt
    
    With the modifications brought by
    https://gitlab.com/koha-community/release-tools/-/issues/18
    
    After the manual changes we can run the script with the 3 commits from
    the issue #18 of release-tools.
    
    * Add missing whitespace to align the dates
    * Add all the releases (from the tag list) after 3.00.00
    
    There is no change in the developers  numbering, neither in the wording.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7606cd73e22e64d9464cfca37bc04c8a305eed5a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 11 09:33:27 2020 +0200

    Bug 26425: Manual changes
    
    Patches will be squashed when pushed.
    Here the changes are done manually, we add the missing 0 for the
    releases after 3.00.00 (with alpha, beta, etc)
    And we remove all the laters, that will added automatically by the
    release script
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17c68d11bb76a4134c7f952325d2ec770b873d8b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 11 08:55:28 2020 +0000

    Bug 26432: Remove unused ModZebrations
    
    Test plan:
    Git grep on ModZebrations
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a6427e9e28ec927748533e8e7b67e73ed36c9b6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 30 14:16:31 2020 +0000

    Bug 26454: DBRev 20.06.00.040
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit debf8f804c6bc47777f1a239e6b20f78c847e0b2
Author: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
Date:   Wed Sep 16 08:35:15 2020 +0200

    Bug 26454: Add system preference to set meta description for the OPAC
    
    Websites should have a meta description tag that shows in search engine results.
    The content should also be available to set as a system preference.
    
    To test:
    1) Look at opac-main source (in the browser) and see that meta name="description" is missing.
    2) Apply patch.
    3) Run: perl installer/data/mysql/updatedatabase.pl
    4) Go to system preferences > OPAC and add a description to OpacMetaDescription.
    5) Look at opac-main source and confirm that meta name="description" now has content equal to the text set in the OpacMetaDescription system preference.
    6) Sign off.
    
    Sponsored by: Lunds University Libraries
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Works as advertised. Newlines are preserved. Double quote is rendered
    as &quot;. Nice enhancement!
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2652135f74c6929bedb2452c41b50dc03b7954c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 15 10:11:33 2020 +0000

    Bug 26462: Don't delete existing data for tests
    
    These tests generate their own items, patrons, and circ rules. Existing
    system data will not affect the results of the tests. We do not need
    to delete information.
    
    You may be able to notice the difference in speed of tests depending on your system. It should
    be faster after applying
    
    To test:
    1 - Before applying patch:
        prove -v t/db_dependent/Holds.t
    2 - It passes
    3 - Apply patch
    4 - prove -v t/db_dependent/Holds.t
    5 - It passes
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d37f6f08c5e649ec037ba8bba0fa5adcc814b9e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 14 16:56:21 2020 +0000

    Bug 26458: Get item details using only itemnumber
    
    This patch modifies moredetail.pl so that it can accept an itemnumber as
    a single parameter.
    
    To test, apply the patch and view a bibliographic record in the
    catalog which has one or more items.
    
     - In the table showing holdings, click the barcode to view the item
       detail page for that item.
     - In the location bar, modify the URL so that it uses only the
       itemnumber parameter, e.g.
    
       /cgi-bin/koha/catalogue/moredetail.pl?itemnumber=1234
    
       The page should load correctly, showing information about just that
       item.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8de7332a35bba62f55f406727ae8a87b6e270984
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 16 15:19:41 2020 +0000

    Bug 26473: Get items for editing using only itemnumber
    
    This patch modifies additem.pl so that it can accept an itemnumber as
    a single parameter.
    
    To test, apply the patch edit items on a bibliographic record which has
    one or more items.
    
    - In the location bar, modify the URL so that it uses only the
      itemnumber parameter, e.g.
    
      /cgi-bin/koha/cataloguing/additem.pl?itemnumber=12345
    
      The page should load the correct record's items.
    
    - If you add the "op" parameter it should load the item for editing in
      the form:
    
      /cgi-bin/koha/cataloguing/additem.pl?itemnumber=12345&op=edititem
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6ddf53ab69cf5f6e0e506b8a39ef782ec47869e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Sep 21 11:29:18 2020 +0000

    Bug 26501: Add datatables to article-requests form
    
    Actually two tables: one for pending and processing.
    Variable active_table has been renamed to active_tab.
    To prevent a flickering form we hide stuff until ready.
    
    Test plan:
    [1] Submit a few article requests.
    [2] Verify that Process, Complete and Cancel still work via Actions.
    [3] Test again with multiselect and top Actions menu.
    [4] Test Search and Sort on the datatable.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 268dfb5455b2663f1cdad886e0bcb7d9b768327c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 16:06:19 2020 +0200

    Bug 26524: Save some processor cycles
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2900cee991511862501c3902c901f5f9e9289f9b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 23 15:56:41 2020 -0300

    Bug 26524: Add Koha::Acquisition::Basket->orders
    
    This patch adds a handy accessor for a basket's orders. It can be used
    to embed orders on an API call or be used in controller scripts to
    replace C4::* methods.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Acquisition/Basket.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00e01c5555ff73b00a1dca17e5fc32c93676034a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 23 15:56:32 2020 -0300

    Bug 26524: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41f0f22cb2f13d04ad9422b73bddc453591e4732
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 11 16:32:29 2020 +0000

    Bug 26530: Use patron card number as checkbox label during patron merge
    
    This patch makes a minor change the the merge patrons template so that
    on the patron selection stage the user can click the card number to
    select the radio button.
    
    To test, apply the patch and perform a patron search in the patrons
    module.
    
    - In patron search results, select two patrons to merge.
    - Click the "Merge selected patrons" button.
    - On the page showing the two patrons to merge, click each of the card
      numbers to confirm that it selects the correct radio button.
    
    Signed-off-by: Jennifer <jennifer.marlatt@coronaca.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ac0850a336d2bb3e5d0bd3ad990e61a34b3dd65
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 29 11:17:34 2020 +0000

    Bug 25320: (follow-up) Remove obsolete include file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc393dc6bee00170b0b5789691de6b24b06a73a7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 18 14:28:38 2020 +0000

    Bug 25320: Move translatable strings out of merge-record-strings.inc into merge-record.js
    
    This patch eliminates the use of a separate include file containing
    translatable strings in favor of embedding translatable strings in the
    JavaScript itself.
    
    To test, apply the patch and clear your browser cache if necessary.
    
     - Perform a catalog search in the staff interface.
     - Select two results to merge. Click Edit -> Merge records.
     - Click "Next" on the "Merging records" page.
     - On the "Source records" page click the second tab where all the
       checkboxes are unchecked.
       - Check the box for a tag which is non-repeatable, e.g. 245.
         - You should see a message, "The field is non-repeatable and
           already exists in the destination record. Therefore, you cannot add it."
       - Check the box for a subfield which is non-repeatable, e.g. 245$a.
         - You should see a message, "The subfield is non-repeatable and
           already exists in the destination record. Therefore, you cannot
           add it."
    
    TESTING TRANSLATABILITY
    
     - Update a translation, e.g. fr-FR:
    
       > cd misc/translator
       > perl translate update fr-FR
    
     - Open the corresponding .po file for JavaScript strings, e.g.
       misc/translator/po/fr-FR-messages-js.po
     - Locate strings pulled from prog/js/merge-record.js for
       translation, e.g.:
    
       #: koha-tmpl/intranet-tmpl/prog/js/merge-record.js:72
       msgctxt "Bibliographic record"
       msgid ""
       "The field is non-repeatable and already exists in the destination
       record. "
       "Therefore, you cannot add it."
       msgstr ""
    
     - Edit the "msgstr" string however you want (it's just for testing).
     - Install the updated translation:
    
       > perl translate install fr-FR
    
     - Switch to your newly translated language in the staff client and
       repeat the test plan above. The translated string should appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 654eda8edc6fb82a13553b3e9b55ea1264177aca
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 29 11:29:29 2020 +0000

    Bug 26291: (follow-up) Correct stray MSG instances
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45558c35e3a425f749029088424f1eedd898c938
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 24 18:25:35 2020 +0000

    Bug 26291: Move translatable strings out of z3950_search.inc into z3950_search.js
    
    This patch moves translatable strings out of z3950_search.inc into
    z3950_search.js, wrapped in the double-underscore function for
    translation.
    
    To test, apply the patch and go to Cataloging.
    
     - Click "New from Z39.50/SRU"
     - In the search form, uncheck all search targets and submit the form.
       You should get an error: "Please choose at least one external target"
     - Peform a search which will return multiple pages of results.
     - Test  that you can enter a number in the "Go to page" form to
       navigate to a specific page.
     - Enter a non-number in the field and submit. You should get an error,
       "The page entered is not a number."
     - Enter a number in the field which is greater than the number of pages
       of results. Submitting the form should trigger an error, "The page
       should be a number between 1 and 10."
    
     - Perform the same tests from the other Z39.50 search results
       interfaces:
       - Acquisitions -> Add to basket -> From an external source.
       - Authorities -> New authority -> New from Z39.50/SRU.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/z3950_search.js for translation,
      e.g.:
    
      msgid "The page entered is not a number."
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 404767da8f45e4886aafbfa0142de8d9b9c5a0ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 11:47:41 2020 +0200

    Bug 26164: (and bug 26419) Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b7bd6ee28a2a62b32aa8ef1c99abcf4fdb76f7d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 11:43:00 2020 +0200

    Bug 26562: Removes 'searches' from localStorage on logout
    
    A user recently logged in will inherit the "searches" item stored in localStorage.
    
    To recreate:
    Log in with user A, do some searches
    Note that the "searches" item is filled in with the search queries
    Logout and log in with user B
    Note that the "searches" item is still there
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88c40e50975957b1de4b5e6b097555ee61ff062b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 10:48:04 2020 +0200

    Bug 26242: Remove one unused occurrences of MSG_NON_RESERVES_SELECTED
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99506632a7f7ddbe9d5ba4164d0d40351a9eb914
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 1 11:51:25 2020 +0000

    Bug 26330: Change encoding of text used as tab triggers in MARC subfield constraints
    
    This patch changes the encoding of the data being used to define
    jQueryUI tabs on the MARC subfield constraints page. A jQueryUI bug
    prevents non-Latin-1 characters from being used when defining tab
    controls. Using Template:Toolkit's "uri" filter converts the data to
    usable characters.
    
    To test, apply the patch and go to Administration -> MARC frameworks ->
    MARC structure -> tag 952 -> Edit subfields.
    
    - Under the "New" tab, add a subfield code which is outside the basic
      Latin character set, e.g. £, §, æ.
    - Save changes.
    - Edit any subfield code to load the subfield constraints page again.
    - Test that the subfield code tabs work correctly: Clicking each tab
      should load only the corresponding panel.
    - Test a variety of tabs including the one you created with the
      non-Latin character.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05537bcd8ea5bceb38805709eb29c2660edd0fa8
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Sep 12 17:24:36 2020 +0000

    Bug 26431: Update NewsToolEditor system preference description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72485629565dd76022e4202549defafec1dd2998
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jul 30 12:38:22 2020 +0000

    Bug 26431: Use split button to offer choice of WYSIWYG or code editor for news
    
    This patch modifies the news interface so that the user is offered a
    choice of editing news items using the default editor as defined by the
    NewsToolEditor system preference or the non-default one.
    
    To test, apply the patch and go to Tools -> News.
    
    - In the list of news items you should see an "Edit" split button in
      each row.
    - Clicking the "Edit" part of the button should open the edit view with
      the correct editor as defined by the NewsToolEditor preference.
    - Clicking the menu arrow on the button should offer the other editing
      method:
     - If NewsToolEditor is set to "WYSIWYG," the menu should offer "text
       editor."
     - If NewsToolEditor is set to "text editor," the menu should offer
       "WYSIWYG editor."
    - Test the button with the NewsToolEditor preference set to both options
      and confirm that the button and menu work correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 701fde53ed703c751e37fd184de342838e8a9f2f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 20 20:10:40 2020 +0000

    Bug 26261: Split calendar.inc into include file and JavaScript file
    
    This patch moves most of the JavaScript out of calendar.inc and into a
    new file, calendar.js. English strings in calendar.js are now wrapped in
    the double-underscore function to allow for translation.
    
    The patch shouldn't affect datepicker functionality in any way.
    
    To test, apply the patch and test the datepicker in various contexts:
    
    - Reports -> Statistics wizards -> Patrons
    - Date of birth "from" and "to" should be linked so that the former
      must come before the latter.
    - Patrons -> Add or edit patron
    - The date of birth field datepicker shouldn't allow you to pick a
      future year from the dropdown.
    - Tools -> Calendar.
    - Test that the calendar tool works correctly.
    - Test with various settings of the dateformat system preference.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/en/js/calendar.js for translation,
      e.g.:
    
      msgid "August"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and test the datepicker again. Translated strings like days of
      the week and months should be correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 171e7bfc5103c63675766b504fb4cef530cb815f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Aug 8 13:15:43 2020 +0000

    Bug 26164: Replace OPAC table sort icons with SVG
    
    This patch modifies the OAPC CSS to convert table sorting icons from PNG
    to SVG. These icons are added via background-image data-urls, so only
    the SCSS file is modified.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_interface).
    
    - Clear your browser cache if necessary
    - View any DataTable in the OPAC, for instance the table of
      checkouts under the logged-in user's "your summary" tab.
    - Confirm that the sorting icons in the table headers look
      correct in each state: Sorted ascending, sorted descending, and
      unsorted.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8722bce9041c7108f27b26e8602aaf0b3564c855
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 9 19:37:19 2020 +0000

    Bug 26419: Replace OPAC Koha logo with SVG
    
    This patch replaces the OPAC Koha logo PNG file with an SVG version.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Clear your browser cache if necessary.
     - View any page in the OPAC. The Koha logo in the upper-left corner of
       the screen should look good.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 558e64eec0fa9d4e3b31e284038cbd223df8b0d8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 19 00:33:45 2020 +0000

    Bug 26245: Remove unused functions from members.js
    
    This patch removes some code from members.js which was unused.
    
    To test, apply the patch and test that the process of adding or editing
    a patron is unaffected. Check the Koha codebase for references to these
    functions in JavaScript:
    
    CheckDate
    unique (note: Not the jQuery function)
    check_manip_date
    check_password
    
    There should be none.
    
    Signed-off-by: Brandon J <brandon.jimenez@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99befa42c80eddec6e49aa1a86b77e74f529f0bd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Aug 1 00:37:32 2020 +0000

    Bug 26120: Remove the use of jquery.checkboxes plugin from tags review template
    
    This patch removes the use of the jquery.checkboxes plugin and improves
    the handling of tag status markup so that the "Select all pending"
    selection link works correctly.
    
    To test, apply the patch and go to Tools -> Tags. To test properly you
    should have multiple tags awaiting moderation.
    
     - The initial view of tags moderation shows only tags awaiting
        moderation. Test that the "select all," "clear all," and "Select all
        pending" links work correctly.
     - Click the "Approve" button for a tag, and the "Reject" button for
       another tag.
     - Test the "Select all pending" link again. Only the tags awaiting
       moderation should be selected.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0275e6677891be3467dbfa34340665ed97605ec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 5 17:27:58 2020 +0000

    Bug 26151: Remove the use of jquery.checkboxes plugin from suggestions management page
    
    This patch removes the use of the jquery.checkboxes plugin from the
    suggestions management page and replaces it with custom JS.
    
    To test, apply the patch and go to Acquisitions -> Suggestions
    
    Under each tab ("Accepted," "Pending," etc.), test that the "Check all"
    and "Uncheck all" controls work correctly and only affect the table on
    that tab.
    
    Signed-off-by: Brandon J <brandon.jimenez@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8620d1ec4b99a6182d59ebe889504b4b87e991a8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 21 19:16:14 2020 +0000

    Bug 26504: Remove the use of jquery.checkboxes plugin from checkout notes page
    
    This patch removes the inclusion of the jquery.checkboxes plugin from
    the checkout notes page. It is unused.
    
    To test, apply the patch and confirm that the AllowCheckoutNotes system
    preference is enabled.
    
    - Go to Circulation -> Checkout notes.
    - Confirm that the "Select all" and "Clear all" links work correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fb705696f9f5d40d4a8463548fb950aaf7b9b20
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 14 18:49:35 2020 +0000

    Bug 24958: Remember last selected tab in SQL reports
    
    This patch modifies the saved reports page so that it remembers, for the
    duration of the browser session, the last active tab.
    
    To test you should have multiple reports in multiple report groups.
    Apply the patch and go to Reports -> Saved reports.
    
    - Select a tab to filter the table of saved reports to a particular
      report group.
    - Navigate away from the page
    - Return to the save reports page. The tab you previously selected
      should be selected again.
    - Restart your browser and return to the saved reports page. The tab
      should no longer be preselected.
    
    Update: The tabs filtering JavaScript has been moved to a separate
    function so that the function can be triggered by both the "create"
    event (when the tabs are initialized) and the "activate" event (when a
    tab is selected).
    
    Update II: Persistence is now enable through localStorage instead of
    Cookies. The localStorage item is now cleared during the logOut
    function.
    
    Update III: The logOut() function in staff-global.js is now called by
    auth.tt to ensure that tabs are not remembered across sessions.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 912d911db2eff822b3a964cc84f7d2653d696815
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 14 18:12:09 2020 +0000

    Bug 26217: Move translatable strings out of templates into acq.js
    
    This patch removes the definition of translatable strings out of
    templates and into the JavaScript file, using the new JS i81n function.
    
    To test:
    
    - Apply the patch, go to acquisitions, and view a vendor.
    - Click "Uncertain prices" in the sidebar menu.
    - In the table of orders, enter something in the "price" form field
      which isn't a valid price. You should get an error message.
    
    - Test the validation of fund amounts: Go to Administration -> Budgets
      and create an active budget if necessary.
    - Add a fund to that budget. Try to save the fund with a fund amount
      which exceed the amount in the budget.
    - You should get an error message: "Fund amount exceeds period
      allocation"
    - Add a fund with valid data and then go to Administration -> Funds and
      locate the fun you just created.
    - Use the "Actions" menu to add a sub fund to that fund.
    - Try to save this new fund with an amount which exceeds the amount in
      the parent fund.
    - You should get an error message, "Fund amount exceeds parent
      allocation."
    
    Note: I was unable to properly test the error message "New budget-parent
    is beneath budget." I couldn't figure out how to trigger it.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
    > cd misc/translator
    > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/acq.js for translation, e.g.:
    
      msgid "Fund amount exceeds period allocation"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea72b15480c7230c03e7620e9900dc32ae0691c5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 19 18:33:28 2020 +0000

    Bug 26256: Move translatable strings out of templates and into serials-toolbar.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch and go to Serials and search for a subscription.
    - Open the detail page for an open subscription.
    - Click the "Close" button. You should get a confirmation, "Are you
      sure you want to close this subscription?"
    - Confirm that you want to close it.
    - When the page reloads, click the "Reopen" button. You should get a
      confirmation, "Are you sure you want to reopen this subscription?"
    - Cancel.
    - Choose Edit -> Delete subscription. You should get a confirmation,
      "Are you sure you want to delete this subscription?"
    - Perform the same tests from the "Serial collection" page.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/serials-toolbar.js for translation,
      e.g.:
    
      msgid "Are you sure you want to delete this subscription?"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: Alexis Ripetti <alexis.ripetti@inLibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 124560556efea775ceb04c77a0ef77cbc130f894
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Sep 25 20:24:20 2020 +0000

    Bug 26243: (QA follow-up) Switch quotes to avoid translation issues
    
    The QA script warned about text in single quotes which can be
    a problem for languages like French that need to be able to use
    these quotes in their translations.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 111b14dc965d51561add33d94eaf18616a815e88
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 18 18:45:56 2020 +0000

    Bug 26243: Move translatable strings out of templates and into circulation.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch and check out to a patron.
    - If there are none on the account, add a new message using the "Add a
      new message" link.
    - Click "Delete" for that message.
    - You should get a confirmation message, "Are you sure you want to
      delete this message? This cannot be undone."
    - If necessary, enable the ExportCircHistory system preference.
    - Check out to a patron who has one or more items checked out.
    - Wihtout checking any checkboxes, click the "Export" button at the
      bottom of the page.
    - You should get an error message, "You must select checkout(s) to
      export."
    - Add a restriction the patron's account.
    - Delete the restriction. You should get a confirmation message, "Remove
      restriction?"
    - Perform the same tests from the patron detail page.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/pages/circulation.js for translation,
      e.g.:
    
      msgid "You must select checkout(s) to export"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1a3aeb0624700627a2cb4e1069190e596d50d12
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 31 17:19:00 2020 +0000

    Bug 26118: Move translatable strings out of tags/review.tt and into tags-review.js
    
    This patch removes the section of the tags review template which defined
    strings for translation. They can now be embedded in the JavaScript
    file, wrapped in the __() function.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Go to Tools -> Tags and perform some actions which will trigger the
      use of translated strings in the interface. For instance:
      - Approving and rejecting tags
      - Testing tags which are approved, rejected, or unclassified.
        - Status messages for these operations should work correctly.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
    > cd misc/translator
    > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/pages/tags-review.js for
      translation, e.g.:
    
      msgid "Both subfield values should be filled or empty."
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
    > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client and
      repeat the test plan above. The translated strings should appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2afd19bc34b4cbd3d9c7d7b38a1d50cd79678e6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 14:26:58 2020 +0200

    Bug 25321: Remove 2 remaining occurrences of strings.inc
    
    They were used for browser.js
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee5914b9b9531a97c24b0acce230aeb315334557
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 29 11:12:23 2020 +0200

    Bug 25321: Remove PLACE_HOLD from results.js
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fa99d7d59ffe65a3533c79a637b50f04e904736
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 21 12:11:11 2020 +0000

    Bug 25321: Move translatable strings out of strings.inc into the corresponding JavaScript
    
    This patch moves string definitions out of strings.inc and into the
    corresponding JavaScript files.
    
    To test, apply the patch and test various pages in the staff interface:
    
    A few suggestions:
    
    - Perform a catalog search and view the detail page for a bibliographic record.
      - Confirm that the search results browser in the left-hand sidebar
        work correctly and that the title attributes of the controls are
        correct.
    - Locate a patron with multiple checkouts. View the checkout page and
      test the various controls in the table of checkouts: Renew, check in,
      return claims, etc.
    - View the list of holds on a patron's account. Test suspending and
      resuming holds.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/checkouts.js for
      translation, e.g.:
    
      msgid "Checked in"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for
      testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e06e62a7fa59228d5aa8b4dcf16205dc33e8897
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 18 17:09:31 2020 +0000

    Bug 26240: Move translatable strings out of sms_providers.tt and into sms_providers.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test you must have the SMSSendDriver preference populated ("Email" is
    fine).
    
    - Apply the patch and go to Administration -> SMS cellular providers.
    - Click "New SMS provider."
    - The legend on the form's fieldset should read "Add an SMS cellular
      provider."
    - Add an SMS provider.
    - Edit an SMS provider.
    - The legend on the form's fieldset should read "Edit provider <provider
      name>"
    - If necessary, edit a patron's SMS settings to use one of your existing
      SMS providers.
    - From the list of SMS providers, click to delete the provider which is
      in use.
    - The error message should read "Are you sure you want to delete
      <provider name>? <number> patron(s) are using it!"
    - Click to delete a provider which isn't in use. The error message
      should read "Are you sure you want to delete <provider>?"
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/sms_providers.js for translation,
      e.g.:
    
      msgid "Add an SMS cellular provider"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2b14f6a1e1f4b80e2aab5ce111e67841b8b90a6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 18 17:43:22 2020 +0000

    Bug 26242: Move translatable strings out of results.tt and into results.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch and perform a catalog search which will return
      multiple results.
    - Without checking any checkboxes, click the "Add to Cart" button. You
      should see a message, "No item was selected."
    - The same should happen if you select an item from the "Add to list"
      menu or click the "Place hold" button.
    - Click the "Select all" link to check all checkboxes.
    - Click the "Place hold" button.
    - You will inevitably get a "One or more selected items cannot be placed
      on hold." message. If you were to want to complete this process you
      would have to painstakingly sift through each search result to find
      which item couldn't be placed on hold so that you could uncheck the
      corresponding checkbox. Luckily this test plan doesn't require you to
      do that.
    - If you don't get an error message you're living in a catalog utopia
      unlike any I have ever seen.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/pages/results.js for translation,
      e.g.:
    
      msgid "Nothing is selected"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: Alexis Ripetti <alexis.ripetti@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22ff2118a703d6a2c03ffa02dbfb6b0c12765e69
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 18 15:11:10 2020 +0000

    Bug 26237: Move translatable strings out of preferences.tt and into JavaScript files
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test (a non-comprehensive list):
    
    - Apply the patch, go to Administration -> System preference
    - Modify any system preference. "modified" should appear next to the
      preference name.
    - Click the "Save" button. You should get a message, "Saved preference
      <pref name>"
    - Hover your mouse over a section heading (e.g. "Features" under
      Accounting). You should see a tooltip, "Click to collapse this
      section."
    - Click to collapse the section. The tooltip should change to "Click to
      expand the section."
    - Open a new tab for the staff interface and log out.
    - In the original tab, modify and try to save a system preference. You
      should get a message, "Error; your data might not have been saved."
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/pages/preferences.js for
      translation, e.g.:
    
      msgid "Saved preference %s"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for
      testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff
      client and repeat the test plan above. The translated strings
      should appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f04ea65fa35a1f906a177b4a14e672ba4a4c3790
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 1 12:24:57 2020 +0000

    Bug 26334: Move translatable strings out of members-menu.inc into members-menu.js
    
    This patch moves translatable strings out of members-menu.inc into
    members-menu.js where they can be translated using the double-underscore
    i18n function.
    
    To test, apply the patch and go to Patrons.
    
    - Expand the search options in the search header by clicking the [+]
      link.
    - Select "Date of birth" from the "Search fields" dropdown.
      - A tooltip should appear above the search form, "Dates of birth
        should be entered in the format..." with your current date format.
    - Remove all "Adult" type patron categories but one.
      - Check out to a child patron.
      - From the "More" menu choose "Update child to adult patron."
      - You should see a confirmation.
    - From the checkout screen, from the "More" menu, choose "Renew patron"
      - You should get a confirmation.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/members-menu.js for translation,
      e.g.:
    
      msgid "Are you sure you want to renew this patron's registration?"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bf7c342bfaf7425f17427f6e82167f26c2311f8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 4 19:10:50 2020 +0000

    Bug 26395: Move translatable strings out of letter.tt into letter.js
    
    This patch moves strings defined for translation in letter.tt
    into letter.js for translation using the new double-underscore
    i81n function.
    
    Note, the "MSG_NO_NOTICE_FOUND" usage has been removed because it didn't
    work.
    
    To test, apply the patch and go to Tools -> Notices & Slips.
    
    - Use the "Copy" dropdown to copy an existing notice to a specific
      library.
    - Save the copied notice.
    - Return to the "All libraries" view on the Notices & Slips page.
    - Repeat the same process above: Copy the same notice to the same
      library.
    - When you click save on the "Add notice" page you should get an error
      message, "A letter with the code 'ACCTDETAILS' already exists for
      <library>"
    
    - From the "All libraries" view on the Notices & Slips page, copy the
      text in the "Code" column of an existing notice.
    - Click "New notice" and choose the module of the notice you copied
      from.
    - On the "Add notice" page, paste the code into the "Code" field and
      enter a name in the "Name" field.
    - Click "Save" without making any other changes. You should get an error
      message, "Please fill at least one template."
    - Enter some data into one of the message body fields but not message
      subject, and click "Save" again.
    - You should get an error, "Please specify title and content for
      <notice>"
    - Enter data in the message subject field and click "Save" again.
    - You should get an error, "A default letter with the code <CODE>
      already exists."
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/letter.js for translation,
      e.g.:
    
      msgid "Please fill at least one template."
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
    > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c98f4849ddad3494e936a0b4ea39eca247dd9f2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 17 18:40:10 2020 +0000

    Bug 26230: Move translatable strings out of item_search_fields.tt and into item_search_fields.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch, go to Administration -> Item search fields.
    - If necessary, add a new search field.
    - From the table of search fields, click the "Delete" button for one of
      the fields.
    - You should get a confirmation: "Are you sure you want to delete this
      field?"
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
    > cd misc/translator
    > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate the string pulled from
      koha-tmpl/intranet-tmpl/prog/js/item_search_fields.js for translation:
    
      #: koha-tmpl/intranet-tmpl/prog/js/item_search_fields.js:18
      msgid "Are you sure you want to delete this field?"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: Alexis Ripetti <alexis.ripetti@inLibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38566a861af1c1daf8fdf1a2b6137ae0c6391a7a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 17 14:50:46 2020 +0000

    Bug 26229: Move translatable strings out of categories.tt and into categories.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch, go to Administration -> Patron categories
    - Click "New category"
    - Enter some special characters in the "Category code" field, e.g.
      "%^&*"
    - Try to submit the form without filling in any other details.
    - The category code field should have a validation message, "Category
      code can only contain the following characters: letters, numbers, -
      and _."
    - The enrollment period fields should have a validation message, "Please
      choose an enrollment period in months OR by date."
    - Enter valid data and confirm that the form can be submitted.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/categories.js for translation, e.g.:
    
      msgid "Please choose an enrollment period in months OR by date."
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94f7ad3e6072e5138d80ff0b964425b109a22778
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 11 19:39:08 2020 +0000

    Bug 26441: Move translatable strings out of catalog-strings.inc into catalog.js
    
    This patch moves translatable strings out of catalog-strings.inc into
    catalog.js, wrapped in the double-underscore function for
    translation.
    
    To test that each affected string correctly appears in the interface:
    
    - View the details for a bibliographic record which has items attached.
    - From the Edit menu, choose "Delete record." You should get an alert,
      "X item(s) are attached to this record. You must delete all items
       before deleting this record."
    - From the Edit menu, choose "Delete all items." You should get an
      alert, "Are you sure you want to delete the X attached items?"
    
    - When logged in as a user with acquisitions and cataloging privileges,
      view the details for a bibliographic record which is used in an order
      in Acquisitions. Delete any items attached.
    - Choose "Delete record" from the Edit menu. You should get an alert,
      "Warning: This record is used in X order(s). Deleting it could cause
      serious issues on acquisition module. Are you sure you want to delete
      this record?"
    - In Acquisitions, view a basket containing orders. Cancel the
      order for a title in the basket. Open the detail page for the title in
      the cancelled order. Try to delete it. You should get an confirmation,
      "X deleted order(s) are using this record. Are you sure you want to
      delete this record?"
      - Perform the same test as a user with cataloging but not acquisitions
        privileges. The alert should say "X deleted order(s) are using this
        record. You need order managing permissions to delete this record."
    
    - When logged in as a user with cataloging but not acquisitions
      privileges, view the details for a bibliographic record which is used
      in an order in Acquisitions. Delete any items attached.
    - Choose "Delete record" from the Edit menu. You should get an alert, "X
      order(s) are using this record. You need order managing permissions to
      delete this record."
    
    - View the details for a bibliographic record which has a hold.
    - Choose "Delete all items" from the Edit menu. You should get an alert,
      "X hold(s) on this record. You must delete all holds before deleting
      all items."
    - View the details for a bibliographic record which has no items.
    - Choose "Delete record" from the Edit menu. You should get an alert,
      "Are you sure you want to delete this record?"
    - Choose "Edit items in a batch" from the Edit menu. You should get an
      alert, "This record has no items."
    
    I could not find any instance of the PopupZ3950Confirmed function in
    catalog.js being triggered so I don't think the associated string can be
    tested.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/catalog.js for
      translation, e.g.:
    
      msgid "This record has no items."
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for
      testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1eb0fe4e5ea87423d4c3c936ad7320634a42c54e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 17 13:04:27 2020 +0000

    Bug 26225: Move translatable strings out of biblio_framework.tt and into biblio_framework.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch, go to Administration -> MARC bibliographic framework.
    - Click Actions -> Export and save the file.
    - Click Actions -> Import.
    - Select a file which isn't CSV or ODS. You should get an error message,
      "Please select a CSV (.csv) or ODS (.ods) spreadsheet file."
    - Select the file you exported previously and click "Import." You should
      see an error message, "Are you sure you want to replace the fields and
      subfields for the default framework structure? ..."
    - Click "OK." You should see a message in the modal window, "Importing
      to framework:..."
    - Edit your exported framework file in such a way that it isn't a valid
      framework export.
    - Repeat the process of importing the file. You should get an error
      message, "Error importing the framework..."
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/biblio_framework.js for translation,
      e.g.:
    
      msgid "Please select a CSV (.csv) or ODS (.ods) spreadsheet file"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    https://bugs.koha-community.org/show_bug.cgi?id=26226
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac12b9c6485332f6ca34bb3d4a98c0c341bfe943
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 17 12:26:39 2020 +0000

    Bug 26225: Move translatable strings out of audio_alerts.tt and into audio_alerts.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch, go to Administration -> Audio alerts.
    - Click the "Delete selected alerts" button without checking any
      checkboxes. You should see an error: "Check the box next to the alert
      you want to delete."
    - Check the checkbox for an existing sound and click "Delete selected
      alerts." You should get a confirmation message, "Are you sure you want
      to delete the selected audio alerts?"
    - Click "New alert."
    - Without filling any details, click the "Play sound" button. You should
      see an error message, "Please select or enter a sound."
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
    > cd misc/translator
    > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/audio_alerts.js for translation, e.g.:
    
      msgid "Are you sure you want to delete the selected audio alerts?"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ac76aee66c5114a944bc0b00d952b3df5dad85a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 1 13:46:35 2020 +0000

    Bug 26339: Move translatable strings out of addorderiso2709.tt into addorderiso2709.js
    
    This patch moves strings defined for translation in addorderiso2709.tt
    into addorderiso2709.js for translation using the new double-underscore
    i81n function.
    
    To test, apply the patch and go to Acquisitions -> Vendor -> Basket ->
    Add orders from MARC file.
    
     - Click "Add orders" next to a staged file.
     - Without making any selections, click "Save." You should get an error,
       "There is no record selected."
     - Select a record and click "Save." You should get an error, "Some
       budgets are not defined in item records."
     - Enter a non-numeric value in the "Quantity" field and click "Save."
       You should get an error, "1 quantity values are not filled in or are
        not numbers."
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/addorderiso2709.js for translation,
      e.g.:
    
      msgid "Some budgets are not defined in item records"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d056d0364cfdc96e5c8fc6a84f933db970ffbd0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 20 15:53:28 2020 +0000

    Bug 25317: Move translatable strings out of additem.js.inc
    
    This patch moves the definition of translatable strings out of
    additem.js.inc and into additem.js using the new JS i81n function.
    additem.js.inc is removed, being obsolete.
    
    To test:
    
    When creating an order:
    
    - Go to Administration -> System preferences and set "AcqCreateItem" to
      "when placing an order."
    - Apply the patch and go to Acquisitions -> Vendor -> Add to basket ->
      From a new (empty) record.
    - In the "Item" section, confirm that the buttons at the bottom of the
      form are correct: "Add item," "Clear," and "Add multiple items."
    - Click "Add multiple items." The placeholder in the revealed form field
      should read "Number of items to add." The corresponding button should
      be labeled "Add."
    - You should see a note, "NOTE: Fields listed in the 'UniqueItemsFields'
      system preference will not be copied."
    - Fill out the item entry form and add a number to the "multiple items"
      field. Click "Add."
    - A table of items should be displayed with "Edit" and "Delete" buttons
      for each new item.
    - Click one of the "Edit" buttons. The item form should be populated
      with the item's data, with an "Update item" button at the bottom.
    
    When receiving an order:
    
    - Go to Administration -> System preferences and set "AcqCreateItem" to
      "when receiving an order."
    - Go to Acquisitions -> Vendor -> Receive shipments.
    - Select or create an invoice.
    - Click "Receive" on an order which has a quantity greater than 1.
    - Add two items, duplicating in each at least one value which is marked
      as unique by the "UniqueItemFields" system preference (e.g. fill in
      the same barcode number for each item).
    - Click "Save." You should get an alert about duplicated values, and
      there should be an alert message on the page, "barcode 'XXX' is
      duplicated."
    - Edit one of the two items and change the barcode to one which already
      exists in your database.
    - Click "Save." An alert message should be shown on the page, "barcode
      'XXX' already exists in the database."
    - Note: I was unable to find out how to trigger this error, "You can't
      receive any more items." It may be obsolete.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/additem.js for translation,
      e.g.:
    
      msgid "Add multiple items"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85b087718be83d32f2bf8a313971a2c4d46c2366
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 28 16:18:51 2020 +0200

    Bug 7143: Update about page for new dev - Alexis Ripetti
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c2def7573d8b74763daebb1024bc2ad2016cb55
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 31 09:43:09 2020 -0300

    Bug 26322: Permissions not checked correctly for plugins
    
    This patch fixes the logic in a condition to address the fact that
    permissions are not checked for plugins. This was due to bad parenthesis
    pairing and the lack of good tests for this.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/PluginRoutes.t
    => FAIL: Tests fail because of bad logic
    3. Apply this patch
    4. Repeat (2)
    => SUCCESS: Tests pass!
    5. Verify the tests cover the use cases that are needed:
       - Anonymous access
       - Real user with wrong permissions (parameters => 1)
       - Real user with right permissions (borrowers => 1)
    => SUCCESS: Needed use cases so we catch any regression are found
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1012bc97d402f5e00e54ee3984df28f5ad17325d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 31 09:36:56 2020 -0300

    Bug 26322: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0e4e3b5f87fc4fa2af78ec1749429921e5e5ae9
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Sep 28 15:47:34 2020 +0200

    Bug 26556: (bug 25070 follow-up) Fix typo data_addressfield in address includes
    
    Selecting "main address" city or "alternate address" city does not trigger the automatic population of values to the city, state, and zip fields anymore.
    It woks for "alternate contact".
    
    Test plan :
    1) Create some cities with all datas : city, state, zip code and country
    2) Open patron creation form
    3) On "main address", select a city in combobox
    4) Check city, state, zip code and country are filled
    5) Same with "alternate address"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8dca36661d7cca5a60aaacc44d2e6a774f78da7a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Sep 24 14:21:43 2020 +0200

    Bug 11176: Add active switch on budgets select in suggestions
    
    When creating a new purchase suggestion, all funds display and are available for selection.
    The behaviour of this drop-down menu should mirror that of those drop-down menus elsewhere in acquisitions,
    where only funds that are linked to active budgets display to the user.
    
    This patch add the active switch based on what exists in acqui/invoice.tt and acqui/invoice.pl.
    
    Looks like actually in suggestion.pl budgets list was fetches with GetBudgets().
    But this is for the filter in 'Acquisition information'.
    Budgets selection on suggestion creation/edition must use GetBudgetHierarchy(), like in acqui/invoice.pl,
    in order to have the actif status.
    
    Test plan :
    1) Create a budget periods active B1 with a fund F1
    2) Create a budget periods inactive B2 with a fund F2
    3) Go to suggestions module
    4) Create a new suggestion
    5) Check you see only active fund F1
    6) Click on 'Show inactive'
    7) Check you see also 'F2 (inactive)'
    8) Choose fund F1 and save
    9) Select the suggestion and edit
    10) Check fund F1 is selected
    11) Come back to suggestion table
    12) Check filter 'Book fund' under 'Acquisition information' contains all funds
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80993795ddf7c7b3c37262dc5f10a9771e5eaa37
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Sep 21 04:49:48 2020 +0000

    Bug 11223: Fix the ind1 semantics for 785 in the staff interface
    
    For 780 and 785 the field should not display when the first indicator
    is 1. After checking the code, I found that 785 in staff was missing.
    This patches fixes that one.
    
    To test:
    - Catalog a record with 785 and 780 fields with one 1st indicator set to
      0 and another to 1.
    - Verify in staff and OPAC detail pages that only the fields with 0 display.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed6d0d42a79a6b553f6945b8b0f041bf7177e925
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 13 15:06:46 2020 +0000

    Bug 15437: (follow-up) Move $i subfield display to the beginning and add OPAC
    
    This patch builds on Caitlin's to finish the work but keeping as
    much from her code as possible.
    
    - Finishes reindenting started in first patch
    - Readds a space after the label
    - Moves $i to the beginning of the field as suggested by MARC21
      documentation:
      http://www.loc.gov/marc/bibliographic/bd76x78x.html
      The data in subfield $i can be displayed preceding the other
      data contained in the field.
    - Adds a span with a class around the $i so people can control
      the formatting
    
    To test:
      - Catalog a record with 780/785 with and without $i.
      - Verify that they display nicely in staff and OPAC, $i should show.
        Also $a and $t will show (unchanged by this patch)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a03e4f485a351f73015a39346ee0738217016f0a
Author: Caitlin Goodger <caitlingoodger.student@wegc.school.nz>
Date:   Wed Jan 18 20:54:33 2017 +0000

    Bug 15437: MARC21: Show $i for 780/785
    
    Test Plan
    1: Inside Administration go to MARC bibliographic framework and on the
    default framework under Actions click on MARC structure
    2: Search for 780 under search tag and under actions click subfields
    3: Find i and click on edit.
    4: Under Advanced Constraints select editor and save the changes.
    5: Repeat for 785.
    6: Find a Bibliograpical record and under Edit select edit record.
    7: Under the 7 put values into 780 and 785. For this to work it is
    dependant on the patch 17929 so that you can type into the indicators
    8: When you save the changes you won't be able to see 780 or 785 on the
    Bibliographical details
    8: Apply the patch
    9: Refresh and 780 and 785 should be there at the bottom under the
    content
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81b14467af36424183fbf2d3a281262e63d441fa
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Aug 19 15:44:57 2020 +1000

    Bug 26249: Set keep_text class correctly in cat-search.inc
    
    This patch sets the keep_text class correctly in cat-search.inc
    for the "Search the catalog" tab
    
    To test:
    1) Apply the patch
    2) Go to /cgi-bin/koha/catalogue/search.pl
    3) Type "A" into the search box for "Search the catalog"
    4) Click on the "Check out" tab
    5) Note that "A" appears in search box
    6) Change "A" to "B" in search box
    7) Click on the "Search the catalog" box
    8) Note that "B" appears in the search box
    9) Note no Javascript errors in the console
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8522d8231ad096f4cc25b2a7aee8466d03c5bc2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 17 10:53:20 2020 +0000

    Bug 26478: Display issue with buttons on the self checkout screens
    
    This patch adds missing Bootstrap classes to a few buttons on the self
    checkout page. Without the classes the buttons are not styled correctly.
    
    To test, apply the patch and open the self checkout page for a patron
    with multiple checkouts, some renewable and some non-renewable.
    
    In the table of the user's checkouts the "Renew item" button should be
    styled as a green button. The "Check in item" button should be styled as
    a blue button.
    
    Try to check out an item which cannot be circulated. On the page warning
    you "Item cannot be checked out," the "Return to account summary" button
    should be styled as a blue button.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5baffbee313c8d70d9abe9517fd9d4fda6efe9cd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 23 11:48:00 2020 +0000

    Bug 26512: Display issue with buttons for OPAC checkout note
    
    This patch adds the correct Bootstrap 4 class to the buttons for
    submitting checkout notes in the OPAC.
    
    The markup has been updated to use <button> instead of <a> because of a
    style conflict with jQueryUI's CSS.
    
    To test, apply the patch and enable the AllowCheckoutNotes system
    preference.
    
    - Log in to the OPAC as a patron with checkouts.
    - On the "Your summary" page, enter some text into a field in the
      "Notes" column of the checkouts table.
    - Upon typing in the field a button should appear, "Submit note."
    - The button should be styled as a green button.
    - Submit the note.
    - Make a change to the text in the field. A button should appear,
      "Submit changes." It should also be styled correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68ec27562fbb89c68058505b35c14aab7accc7fb
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Aug 26 00:58:36 2020 +0000

    Bug 16357: Only use Log4perl middleware if appenders defined
    
    This patch checks that the loggers used by the middleware
    actually have appenders defined.
    
    Without this patch, if the loggers don't have appenders
    defined in the log4perl file, the logs will just be lost.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5651facf0574f028250aeb8f30d6d8e2a5ebaabe
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Aug 25 12:22:29 2020 +0000

    Bug 16357: (QA follow-up) Add log4perl configs during package upgrade
    
    If plack.psgi is updated to the newer version and the log4perl.conf file
    is not then the warnings will not be logged anywhere. This adds the
    log4perl configurations that are needed for logging for pre-existing Koha
    installation which are upgraded.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bc0aa708c5903c8ae2b7c45643600d0fc59ae03
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Aug 25 12:10:20 2020 +0000

    Bug 16357: (QA follow-up) Only initialize Log4perl module
    
    Koha::Logger->get was setting up some extra variables
    which are not used nor needed for the Plack::Middleware::Log4perl
    middleware to work. According to documentation at
    https://metacpan.org/pod/Plack::Middleware::Log4perl#SYNOPSIS
    only running Log::Log4perl::init, enabling Log4Perl middleware and
    setting up the logging category is enough. Koha::Logger->_init runs the
    Log::Log4perl::init and enabling and setting category is handled
    directly in plack.psgi.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79b2b85f82875664e47cfff1cf1922605f94b03c
Author: Mason James <mtj@kohaaloha.com>
Date:   Tue Aug 25 18:08:28 2020 +1200

    Bug 16357: Plack error logs are not time stamped
    
    add libplack-middleware-logwarn-perl dependency to cpanfile
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef021268bbe9519ac3eb070450591c2b761ac1c3
Author: David Cook <dcook@prosentient.com.au>
Date:   Fri Jun 26 02:25:10 2020 +0000

    Bug 16357: Use separate Log4Perl logger for each Plack app
    
    This patch creates separate timestamped Log4Perl loggers
    for each Plack app, so that the Intranet, OPAC, and API are logged
    to separate files.
    
    To Test:
    0) apt-get install libplack-middleware-logwarn-perl
    1) Apply "Alternative" patches
    2) Copy PLACK block from etc/log4perl.conf to
    /etc/koha/sites/kohadev/log4perl.conf and replace __LOG_DIR__ appropriately
    3) Copy debian/templates/plack.psgi to /etc/koha/sites/kohadev/plack.psgi
    4) Temporarily add 'warn "TEST"' to opac-main.pl and mainpage.pl
    5) koha-plack --restart kohadev
    6) Go to /cgi-bin/koha/mainpage.pl and /cgi-bin/koha/opac-main.pl
    7) Open /var/log/koha/kohadev/plack-opac-error.log and
    /var/log/koha/kohadev/plack-intranet-error.log
    7) Observe a log line like the following:
    [2020/06/22 03:51:23] [WARN] TEST at <SCRIPT and line #>.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57c62a612d7a8c590a2b5ef0ce75d9915471e19a
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon Jun 22 03:53:16 2020 +0000

    Bug 16357: Override __WARN__ in Plack to use Log4Perl
    
    This patch overrides __WARN__ in Plack to use Log4Perl to add
    timestamps to error output. The Log4Perl config uses a screen
    appender so the output still goes to STDERR so that it is still
    managed by Starman.
    
    This patch adds a Plack::Middleware::LogWarn package dependency.
    (The dependency is very simplistic, so we could always do out own
     version if we would prefer to skip the external dependency.)
    
    To Test:
    0) apt-get install libplack-middleware-logwarn-perl
    1) Apply patch
    2) Copy PLACK block from etc/log4perl.conf to
    /etc/koha/sites/kohadev/log4perl.conf
    3) Copy debian/templates/plack.psgi to /etc/koha/sites/kohadev/plack.psgi
    4) Create some output on STDERR (it might be necessary to add
    a 'warn "TEST";' line to the intranet or OPAC)
    5) koha-plack --restart kohadev
    6) Open /var/log/koha/kohadev/plack-error.log
    7) Observe a log line like the following:
    [2020/06/22 03:51:23] [WARN] TEST at /kohadevbox/koha/opac/opac-user.pl line 59.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d924e892a897b723664aa950938f1fbc06e7e3a4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Apr 14 11:42:22 2020 +0000

    Bug 17458: Remove use of datereceived from order receive page
    
    Before this patch the order receive page (parcel.pl) would show
    ... Received by: <current user> On: <current date>
    
    This is not really helpful. Whenever you viewed an invoice, it
    would tell you it was _you_ who received that _today_.
    
    As we don't store a creator of an invoice and the order lines
    in an invoice could have been received by different people (which
    we also don't know about), the "Received by" is removed by this patch.
    
    Instead of today's date, we can show the shipment date entered for
    the invoice. Again: different order lines could have been received
    on different dates for this shipment. So only the shipment date makes
    sense as it's on invoice level.
    
    This also makes changes to the page title, breadcrumby and page heading:
    When the invoice is closed, they will read:
      Receipt summary for [vendor] ...
    When the invoice is not closed, they wil read:
      Receive orders from [vendor] ...
    
    To test:
    - Create a basket with some orders in acq
    - Close the basket
    - Receive shipment and create an invoice
      - Make sure shipment date is not set to today
    - Verify the information shown on top of parcel.pl is you and today
    - Change staff users
    - Go to your invoice, it's now this user and today
    - Apply patch
    - Received by: should be gone and the On: replaced by Shipment date:
      with the date you selected
    - Check the page title, breadcrumbs and headings read all the same 'Receive orders...'
    - Finish receiving and close the invoice
    - "Go to receipt page"
    - Verify they now read "Receipt summary.."
    
    If you have older invoices in your system, it would work
    even better with these as you'd see that always today's date
    is displaying without the patch.
    
    Signed-off-by: Marjorie <marjorie.barry-vila@collecto.ca>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe84c3acba33af7a2fb27643f6b5f9129c329b36
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Wed Sep 16 11:18:49 2020 +0000

    Bug 23485: Show barcode in holds to pull
    
    Updated to only show one barcode number, with either an "only" or an "or any available" depending on whether it's an item or bib hold.
    Also incorporating feedback to simplify the TT logic and remove list formatting.
    
    To test:
    1 - Place an item level hold on a bib with several items with the same callnumber
    2 - View the holds to pull report
    3 - Try to guess which one on the shelf is right?
    4 - Apply patch
    5 - See the barcode in holds to pull report
    6 - You can now grab the correct item (but don't yet)
    7 - Place a next available hold on the same title
    8 - See the report now shows one possible valid barcode with the text "or any available."
    9 - Check in a different item that fills the next available hold
    10 - Now the report shows the single item for the borrower
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0afcf3936a6ceeb865fdf0159cf54618400847d7
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Sep 24 23:52:33 2020 +0200

    Bug 24780: Make items.stocknumber show up in batch item modification
    
    It looks like the field was intentionally removed from the list
    of batch editable fields in the past. This makes sense as we
    used to have a unique index on it at some point - but we do have
    no more.
    
    This removes the exception so that the invendory number behaves
    like the other fields on the batch item edit form.
    
    To test:
    - Create some items with and without stocknumber
    - Go to tools > batch item modification
    - Enter the barcodes of your selected items in the list or
      upload a file with them
    - Verify that the stocknumber/inventory number is not showing
      in the item edit form below
    - Apply patch
    - Reload the page - inventory number is there now
    - Batch edit the inventory number and verify it works as expected
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa8ee99fb77f3de1904efe52d0bbd847cc4e63aa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 1 15:07:49 2020 +0200

    Bug 25624: Add --where option to update_patrons_category.pl
    
    The script did not allow to find empty fields or use wildcards
    
    With this new option we will now have the ability to filter patrons by
    some of their attributes.
    
    Test plan:
    1 - Run the script with no parameters and verify the help explains the parameters
    2 - Try the script with one or more --where parameters, like:
      --where "firstname='koha'"
    3 - Test null values
      --where "firstname IS NULL"
    4 - Test like values with wildcards
      --where "firstname LIKE '%a%'
    5 - Test like with the word null to find fields containing the word rather than being unset
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d5a49a7ef165b7b47dda6357aaf2953dacfa362
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 17 10:16:14 2020 +0000

    Bug 26224: Prevent double submit of header check in form
    
    To test:
     1 - Browse to Home
     1 - In the header bar select the 'Check in' tab
     2 - Type a barcode into the box
     3 - Hit Enter as many as times as you can
     4 - Check the statistics table:
        SELECT * FROM statistics WHERE itemnumber={itemnumber} AND DATE(datetime)=CURDATE();
     5 - Note you have multiple lines for the same item at the same time
     6 - Apply patch
     7 - Reload the page
     8 - Type the barcode
     9 - Press Enter even more fast and more furiously
    10 - Check the statistics table
    11 - Only one entry, huzzah!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd6598d018d0a27b0704aed95e299f6fe0f1c2c1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Sep 25 16:28:17 2020 +0000

    Bug 26323: (QA follow-up) Fix syntax errors
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9bbf90969304943210e24dcd69422c9fe7d28303
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 25 16:53:52 2020 +0100

    Bug 26323: (follow-up) Add new cases introduced
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e502efa0aef9ca865ff0af6c6ecefee73cc4ee1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 3 15:59:22 2020 +0200

    Bug 26323: Retrieve the correct values for LOST, DAMAGED, LOC and CCODE
    
    Same as previously
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5da1e809b7b5476a2d8a740b1441415ce529fc3c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 3 15:37:15 2020 +0200

    Bug 26323: Retrieve the correct NOT_LOAN value
    
    From the template we are assuming that items.notforloan is mapped with
    the NOT_LOAN authorised value category, but that is not necessarily the
    case.
    
    We must retrieve the correct AV category
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3cd40f7bafe99c72b804dc1d6ff993fbc71f2d85
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 28 15:32:52 2020 +0200

    Bug 26414: Tidy the tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b048d155bf18d794d2ac97eaafc6f0fc00996018
Author: Alexis Ripetti <alexis.ripetti@inLibro.com>
Date:   Fri Sep 11 16:11:55 2020 -0400

    Bug 26414: Unable to export Withdrawn status using CSV profile
    
    When using CSV profiles to export MARC records, it is impossible to export the withdrawn status. I suspect it is because withdrawn is in 952$0 and 0 is considered null rather than an actual 0.
    
    Test Plan :
    1) Go to Tools > CSV profiles
    2) Click on New CSV profile
    3) Enter a profile name (ex. Simple record)
    4) In the Profile MARC fields field enter the following (for MARC21)
    245a|100a|952o|9520
    5) Save your profile
    6) Go to Search and search for something
    7) Add a couple of things in your cart
    8) Go to your cart
    9) Click on Download and choose your CSV profile
    10) Open the file and notice the 9520 column contains the whole of the 952 field and not just the withdrawn status
    11) Apply patch
    12) Redo steps 9) and 10)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34b9c061f347da750f4565a57012c9caab93f925
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 9 15:34:13 2020 +0100

    Bug 26418: Fix translatability of REFUND credit type
    
    The description of REFUND type accountline credits introduced with the "issue refund" feature is not translatable.
    
    To test:
    - Make sure a language with a complete translation is installed
    - Switch to the language
    - Go to any user account
    - Add a manual invoice
    - Pay it off fully or partially
    - Click on "issue refund"
    - Confirm the refund
    - Check the description of the line in the patron account is not translated.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 340c8019d2630cc2442b51ae6dfbed5526813699
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Sep 10 15:12:39 2020 +0200

    Bug 26424: Better performance of svc/checkouts
    
    Ajax script svc/checkouts display checkouts of a patron.
    For each item, it fetches a Koha::ItemType object and a Koha::AuthorisedValues object for location,ccode,lost and damaged.
    
    For performance on huge number of checkouts :
    Item types should be fetch once before the loop.
    authorised values should call Koha::AuthorisedValues->get_description_by_koha_field because it uses a cache.
    
    I've tested with Plack :
    Without patch :
    100 checkouts = 6 seconds
    1000 checkouts = 60 seconds
    With patch :
    100 checkouts = 5 seconds
    1000 checkouts = 44 seconds
    
    Patch also changes the fact that authorised value categories are no longer hardcoded LOC,CCODE,LOST and DAMAGED, they depend on default framework.
    Like is doing Bug 26323.
    
    Test plan :
    1) Dont apply patch
    2) Use sql to define some items lost and damaged
    3) Look at checkouts table on a patron with a lot of checkouts
    4) Apply patch
    5) Look at checkouts table again
    6) Check infos are the same : record level item type, item type, location, collection, lost, damaged
    7) Check infos are the same in "Number of checkouts by item type"
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc7f187743b614cda367a032d89f4e55a35d311b
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Sep 20 22:06:32 2020 +0000

    Bug 26490: Fix column configuration for fines trasactions
    
    Hiding the last columns on the fines transactions in the
    patron account in staff didn't work correctly as we had missed
    adding Home library to the configuration options when it was
    added.
    
    This adds the missing definition and now all columns can be
    toggled correctly.
    
    To test:
    - Go to any patron account in staff
    - Go to Accounting > tab transactions (maybe add some fines)
    - Toggle the columns on the table using the menu, especially
      - notes, home library and checkout date
    - Go to Administration > Table configuration
    - Verify the settings for the table work well from there too -
      with the patch, home_library will show as new option
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be7c705d3bfba2044d4656e86b9e94c537c26945
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 21 10:59:56 2020 +0000

    Bug 26497: "Hide all columns" throws Javascript error on aqplan.pl
    
    This patch updates the JavaScript for checking and unchecking checkboxes
    on the Acquisitions planning page so that it doesn't require the
    checkboxes plugin.
    
    To test, apply the patch and go to Administration -> Budgets -> Budget
    details -> Planning.
    
    On the planning page, test the "Show all columns" and "Hide all columns"
    checkboxes. They should work correctly to show and hide the correct
    columns.
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8d9a7a42706b3f38c373b3d0fe7baeae8a3101e
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Sep 25 21:09:03 2020 +0000

    Bug 26541: Remove percent sign from discount button
    
    Realized I'd left a stray tag, fixed.
    
    To test:
    1 - go to borrower account, apply manual fee
    2 - go to Transactions tab and see that fee has "% Apply discount" button
    3 - apply patch, restart, reload page
    4 - button just says "Apply discount"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9815855bd6e442857fdae0c48335f9fe5d17507
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 28 11:09:30 2020 +0200

    Bug 16314: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d716f2a18a7863f7b7f2e42fd8286b9982a52775
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 28 10:36:40 2020 +0200

    Bug 15933: Add +x to the script
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36895fee3a5aaea9096f5edfba29b408eb6975db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 28 10:35:01 2020 +0200

    Bug 26384: Add .t extension to make the script executed by CI
    
    The test file is not run as it does not have the .t extension
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae21c3adb16c0604c995a08a4082c3d1d60ab822
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 22 11:01:30 2020 +0000

    Bug 26505: Suspend hold modal broken in the OPAC
    
    This patch makes corrections to the markup for the suspend hold modal in
    the OPAC. It hadn't been updated during the upgrade to Bootstrap 4.
    
    The JavaScript controlling the "suspend until" datepicker has been
    modified because the datepicker pop-up was not positioned correctly in
    this new version.
    
    Unrelated: The markup for confirmation modals has been updated to
    replace Bootstrap 3's "btn-default" with Bootstrap 4's "btn-secondary."
    
    To test, apply the patch and make sure the SuspendHoldsOpac and
    AutoResumeSuspendedHolds system preferences are enabled.
    
    - Log in to the OPAC as a user who has holds.
    - On the "Your summary" page open the "Holds" tab.
    - In the list of holds, click the "Suspend" button.
    - The modal should appear and look correct.
    - Test the "Suspend until" field: Clicking in the form field should
      trigger the datepicker. It should be positioned correctly under the
      form field.
    - Confirm that the datepicker populates the field.
    - Submit the suspension and confirm that the hold is suspended.
    - Click the "Cancel" button for a hold. Confirm that the confirmation
      dialog appears correctly.
    
    Edit: Updated class of hidden submit button. Test the page with JS
    disabled to test that the "Suspend until" form works correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff08e99965ccb60092b5bdd5181fd517e1fab161
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 4 12:47:58 2020 +0000

    Bug 25758: Return on_reserve over too_soon when not calling from automatic_renewals cron
    
    Bug 19014 altered CanBookBeRenewed to return (auto_)too_soon over on_reserve
    
    For cron purposes this is the correct behaviour.
    
    For display purposes we wish to see on_reserve over too_soon
    
    This patchset adds a switch to 'CanBookBeRenewed' to alter the priority of these statuses
    
    To test:
     1 - set NoRenewalBeforePrecision to date only
     2 - set a circ rule to auto-renewal=yes, no renewal before=0, checkout period to 7 days
     3 - check item out
     4 - confirm item shows Scheduled For Automatic Renewal in issues table
     5 - place a hold on the item for another patron
     6 - reload issues table for patron 1, confirm checkout still shows "scheduled for automatic renewal" rather than "on hold"
     7 - change No Renewal Before value to 7
     8 - reload issues table for patron 1, confirm checkout now shows "on hold"
     9 - Apply patch
    10 - restart_all
    11 - Reload the issues table - confirm 'on_hold' still shows
    12 - Change No Renewal Before to 0
    13 - Refresh issues table, still shows 'On hold'
    14 - perl misc/cronjobs/automatic_renewals.pl -v
    15 - Result shows 'auto_too_soon'
    16 - prove -v t/db_dependent/Circulation.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d19572ea765dbf6c13ba1343433ed07729413248
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 25 07:42:44 2020 +0000

    Bug 25265: (QA follow-up) Check server type in Elasticsearch::index_records
    
    Doing the same change as previously (renaming biblionumber), but fixing
    at the same the record fetch. If (theoretically) an authority is passed
    without a record, it would have fetched a biblio record.
    
    Test plan:
    You need Elasticsearch here.
    Replaced this line in AddAuthority:
        $indexer->index_records( $authid, "specialUpdate", "authorityserver", $record );
    by
        $indexer->index_records( $authid, "specialUpdate", "authorityserver", undef );
    And updated an authority record. Check if you can search for the change.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD amended patch: remove trailing whitespace
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 501b9ea33667c7fdd87fe356b9fab364c10ab383
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 25 07:02:56 2020 +0000

    Bug 25265: (QA follow-up) Rename biblionumber in ModZebra, index_records
    
    ModZebra:
    The name is very misleading: we can index authid's too here.
    And yes, it should not be in C4/Biblio too ;) A first step..
    
    Adding the same change here in Koha/SearchEngine/Zebra/Indexer.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47b594a3dcd59f13073716daf38696967d1faa77
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 25 06:29:14 2020 +0000

    Bug 25265: (QA follow-up) Add shebang to Indexer.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7dde763dcb4e6f4d9d8a61e754f48758cbd03a4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 23 18:57:26 2020 +0000

    Bug 25265: (follow-up) Don't index malformed records
    
    This is analogous to 26522, we shoudl skip record that cannot be retrieved for indexing
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a690ba2b26ef6247cdf336077311e4afb0e94473
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 22 17:38:03 2020 +0000

    Bug 25265: Fix copy paste error for parameter
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 205d909a56f0170e1abf60bf880315e52f66fd21
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 17 12:55:53 2020 +0000

    Bug 25265: Rename skip_modzebra_update to skip_record_index
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88cb7f223d31716c20e8f9341c64594b28ada33f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Aug 5 14:20:47 2020 +0200

    Bug 25265: Prevent double reindex of the same item in batchmod
    
    When batch editing, 2 reindex calls are sent to ES/Zebra.
    We can easily avoid that reusing the skip_modzebra_update (renamed skip_record_index)
    
    Additionally we should only send one request for biblio, and we should
    only do it if we succeed
    
    As the whole batch mod is in a transaction it is possible to fail in which case
    Zebra queue is reset, but ES indexes have already been set
    
    In addition to the skip param this patchset moves Zebra and Elasticsearch calls to
    Indexer modules and introduces a generic Koha::SearchEngine::Indexer so that we don't
    need to check the engine when calling for index
    
    The new index_records routine takes an array so that we can reduce the calls to
    the ES server.
    
    The index_records routine for Zebra loops over ModZebra to avoid affecting current behaviour
    
    Test plan:
    
    General tests, under both search engines:
      1 - Add a biblio and confirm it is searchable
      2 - Edit the biblio and confirm changes are searchable
      3 - Add an item, confirm it is searchable
      4 - Delete an item, confirm it is not searchable
      5 - Delete a biblio, confirm it is not searchable
      6 - Add an authority and confirm it is searchable
      7 - Delete an authority and confirm it is not searchable
    
    Batch mod tests, under both search engines
      1 - Have a bib with several items, none marked 'not for loan'
      2 - Do a staff search that returns this biblio
      3 - Items show as available
      4 - Click on title to go to details page
      5 - Edit->Item in a batch
      6 - Set the not for loan status for all items
      7 - Repeat your search
      8 - Items show as not for loan
      9 - Test batch deleting items
        a - Test with a list of items, not deleting bibs
        b - Test with a list of items, deleting bibs if no items remain where all items are only item on a biblio:
         SELECT MAX(barcode) FROM items GROUP BY biblionumber HAVING COUNT(barcode) IN (1)
        c - Test with a list of items, deleting bibs if no items remain where some items are the only item on a biblio:
         SELECT MAX(barcode) FROM items GROUP BY biblionumber HAVING COUNT(barcode) IN (1,2)
     10 - Confirm records are update/deleted as appropriate
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f989338899a3a4fe0cf131f0c63ef79f69a7bf2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 17 11:43:44 2020 +0000

    Bug 25265: Unit tests
    
    These cover Koha::SearchEngine::Indexer and ensure that all calls in the code
    are routed correctly to the expected search engine
    
    Bug 25265: (follow-up) Skip tests if elastic not configured
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26ab04a3b383f5a9c88124625f8edc1c4cf1d816
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Sep 22 14:10:10 2020 -0400

    Bug 26510: Transport Cost Matrix editor doesn't show all data when HoldsQueueSkipClosed is enabled
    
    If HoldsQueueSkipClosed is enabled, and a library happens to be closed
    on the day you edit the transport cost matrix, all the values for that
    library will not show. Instead they will appear disabled, and if you
    were to edit the cell and save a new value in it, it will also
    'disappear' when the page is reloaded.
    
    Test Plan:
    1) Set today as a holiday for a library
    2) Set HoldsQueueSkipClosed to 'open'
    3) Go to the transport cost matrix editor
    4) Edit a cell where the 'from' is for the closed library
    5) Note the value doesn't 'save', it is still in the database though
    6) Apply this patch
    7) Restart all the things!
    8) Reload the transport cost matrix editor
    9) The value now appears correctly!
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcdc72aee7d835c08ca3565a83a3dae7389a4f87
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 11 16:03:28 2020 +0200

    Bug 26434: Fix plugin dirs addition to @INC
    
    Plugin dirs defined in koha-conf.xml are added to @INC in order to compile perl code.
    Looks like with plack those dirs are added several times.
    This may lead to an error "INCLUDE_PATH exceeds 64 directories".
    
    This bug was identified with Carrousel plugin : https://inlibro.com/instructions-carrousel/
    
    Test plan :
    1) Enable plack and plugins
    2) Look at page about.pl : @INC contains one plugin dir 'var/lib/plugins'
    3) Install plugin KitchenSink : https://github.com/bywatersolutions/koha-plugin-kitchen-sink
    4) Dont apply patch
    5) Use configure on KitchenSink
    6) Look at page about.pl : @INC contains server plugin dir 'var/lib/plugins'
    7) Apply patch and restart plack
    8) Use configure on KitchenSink
    9) Look at page about.pl : @INC contains one plugin dir 'var/lib/plugins'
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 647e05d8265831a09f6c624928990cfd62896b39
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Fri Sep 11 18:16:28 2020 +0100

    Bug 26438: Rename temporary Koha::Item variables to avoid conflict
    
    Returns from Koha::Item calls were stored in temporary variables
    called $item. Unfortunately they occur in routines already with
    an $item variable holding a lineitem and hide that variable although
    only required for two lines of code. An error occurs if girfield
    is called on the wrong variable. Renamed all three occurences
    of $item to $kitem to avoid the error
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9622561636387ced932cc31e285d13cdba607c47
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Aug 18 12:20:32 2020 +1000

    Bug 26231: Remove incorrect use of AddAuthority() when 001 present
    
    This patch removes the use of AddAuthority with a non-empty
    authid argument, since that triggers an update rather than an insert.
    
    In practice, the update also fails, but the error isn't raised,
    as the database connection doesn't have RaiseError set.
    
    Test plan:
    1) Do not apply patch
    2) Try to bulkmarcimport an authority file with a 001
    3) Observe that the script reports success but no authority is added
    4) Apply the path
    5) Try to bulkmarcimport an authority file with a 001
    6) Observe that the script reports success and the authority is added
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e708566e729239ed7857c357ee53419c44742ddd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Sep 1 10:42:47 2020 -0400

    Bug 26341: Database update for bug 21443 is not idempotent and will destroy settings
    
    If the database update for bug 21443 is run, and the library changes any
    of the hourly or daily rental fees following the calendar, a second run
    of the database update will overwrite those changes.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af9938c43feaa76bf1b1bb0a0e4b21ff7fbbe449
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 22 14:14:55 2020 +0000

    Bug 26507: Elasticsearch - Index records after storing new item
    
    Currently Item->store indexes the record before the DB update - that is wrong
    
    To test:
     1 - Find/create a bib with no items
     2 - add an item with barcode "abc123"
     3 - do a general keyword search for "abc123," see your bib is not in the results
     4 - perform a search that includes your bib in the results, confirm it shows as having no items
     5 - click through to bib details, confirm it shows your item here
     6 - edit and save your item
     7 - confirm barcode is now searchable
     8 - apply patches
     9 - Add a new item "cde456"
    10 - Confirm it returns in searches
    11 - Edit 'cde456' and change barcode to 'fgh789'
    12 - Confirm the new abrcode is searchable
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffc156f84e970da9bcbd74872028fe96f2b30179
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 18 10:35:43 2020 +0000

    Bug 24807: (QA follow-up) Remove uneccessary tests
    
    These tests fail now, the code expects a real response from ES in Indexer.pm
    but these tests mock 'bulk' and so don't have the necessary fields.
    
    We are testing the same code above and can just add the _id == biblionumber test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d45a699975b9857990e19bb9ddc12267ebd05334
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 23 21:59:02 2020 +0200

    Bug 19889: (follow-up 2) update DB adjustments
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d06cbb55aedc8296b82169a649c7c5dab831101
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 18 11:38:57 2020 +0200

    Bug 19889: (follow-up) update DB adjustments
    
    Fix fields order
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7d1ffbad3d517dcf509eec107a54510cca45b64
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 18 09:46:10 2020 +0000

    Bug 18958: DBRev 20.06.00.039
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b255ca7c6eec7be3027e6ade00d8477102062281
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 25 10:35:02 2020 +0000

    Bug 18958: (follow-up) Ensure hold fill target reserve_id is set for all hold types
    
    MapItemsToHoldRequests has three sections: Local holds, item level holds, bib level holds
    
    Only one of them was setting the reserve_id. This patch makes al three set it and adds tests
    
    To test:
    1 - Repeat test plan on bug
    2 - sudo koha-mysql kohadev
        SELECT * FROM hold_fill_targets
    3 - Ensure reserve_id is set at appropriate times
    4 - prove -v  t/db_dependent/HoldsQueue.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 18958: (QA follow-up) Fix number of tests
    
    In HoldsQueue.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01b65975988e9ec1830499460b078ed1f108656f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 25 09:55:42 2020 +0000

    Bug 18958: DBIC schema changes
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cfbe318d84dbaf1af8699f3e499f2c3e312a7af
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 22 03:12:36 2020 +0000

    Bug 18958: (QA follow-up) Add missing comma to kohastructure.sql
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bfe336c7b0a8993411bd45b9e7c66228730f86d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 14 11:06:40 2020 +0000

    Bug 18958: Make hold_fill_targets specific to reserves
    
    After looking at Marcel's comments, the problem is in our matching
    to hold_fill_targets - rather than adjusting to find filled/waiting holds we
    could ensure that hold_fill_targets only refers to the specific hold it
    is intended to
    
    This patch is clearer, if slightly less performant than last (we now return all
    the reserves and have to find the 'highest')
    
    Test Plan:
     1 - Create and use a patron that can place multiple record level holds per record
     2 - Create a record with X items, each at a different library
     3 - Place X 'Next available' holds on the record for the patron using the 'Holds to place' box
     4 - perl misc/cronjobs/holds/build_holdsqueue.pl
     5 - Check in LibraryA's copy as LibraryA and confirm the hold
     6 - Revisit request.pl for the record, notice the next hold in line is now item-specific
     7 - Checkout the item to the patron, notice the remaining hold is marked waiting
     8 - Attempt to place another hold for your patron, notice that it requires an item-specific hold
     8 - Apply this patch
     9 - Repeat steps 1-5
    10 - Revisit request.pl for the record, notice the next hold in line has *not* become item-specific
    11 - Checkout the item to the patron, ensure the first hold is filled and the second remains record level
    12 - Repeat whole test plan without building holds queue to confirm holds are still treated correctly
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ee2495f321198548b3ffbf983aa1d13f6c6c2cc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 12 18:41:24 2019 +0000

    Bug 18958: Unit tests
    
    Signed-off-by: Bonnie Gardner <bgardner@cityoflewiston.org>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD amended patch: perltidy and simplify item/biblio creation
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ede5cd3f93cb96e09f460e1ba965032e804077e
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Sep 14 10:27:24 2020 +0300

    Bug 26448: Don't overwrite commit parameter passed to koha-elasticsearch
    
    The "--commit" or "-c" parameter was incorrectly not used if it was
    passed to the koha-elasticsearch program.
    
    To test:
    1) Before patch notice koha-elasticsearch --rebuild --commit 1 -v <instance>
       only commits every 5000 records
    2) Apply patch and notice the above command commits every 1 record
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 642c29dc230239d4ae1eb718f423c77072aa1e81
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Sep 14 10:08:23 2020 +0200

    Bug 26451: fix typo in bulkmarcimport.pl
    
    bulkmarcimport.pl displays a small typo when a MARC modification
    template is being used: "modofication".
    
    This patch fixes that.
    
    Test plan: apply the patch, and confirm the script no longer
    displays the typo.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f3cb59a97df5fc954e9e807896e14af960237a9
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Aug 27 07:30:54 2020 +0000

    Bug 26283: Add dateexpiry and dateenrolled to new borrower fields modal
    
    While these may not make sense for all patron field preferences, I think
    it's better to have them in general than to have them missing.
    
    To test:
    - Check the modal for BorrowerMandatoryField system preference
    - Verify dateenrolled and dateexpiry fields are missing
    - Apply patch
    - Verify the dates are listed now
    - Set both to mandatory
    - Verify that they are indeed mandatory when adding a new patron now
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ece5d7c7f739cbf2d4b81be767ff89a8c1204f5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 9 15:58:04 2020 +0000

    Bug 26421: Use Bootstrap screen reader text class for shelf browser messages
    
    This patch udpates the markup added by Bug 26039, replacing the "hidden"
    class, which is no longer functional with Bootstrap 4, with "sr-only," a
    class designed specifically for screen reader text.
    
    The patch also corrects a typo, "shelfbrowers" -> "shelf browser"
    
    To test, apply the patch and make sure the OPACShelfBrowser system
    preference is enabled.
    
    View the detail page for a bibliographic record with items. In the
    holdings table, you should see links labeled "Browse shelf."
    
    When you open the shelf browser there should be a link at the top that
    reads "Close shelf browser."
    
    If you have access to a screen reader, test that the hidden text is
    announced by the reader. "Browse shelf (Opens below)" and "Close shelf
    browser (Hides shelf browser)."
    
    Signed-off-by: Stina Hallin <stina.hallin@ub.lu.se>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22f14a7b6d45f3bf5ad57bd52203d4cdef724ce7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 15 12:09:56 2020 +0000

    Bug 26464: Code correction in opac-main when news_id passed
    
    Theoretical change. If somehow the search would return more than one result, the code is wrong.
    
    The if test can be simplified: remove scalar and >0.
    We should not pass @array to one param. It would theoretically add wrong items or
    trigger an odd number warning. If it is only one, it is no problem. But it is buggy.
    
    Test plan:
    Pass an existing news_id to opac-main. Item visible?
    And pass a not-existing. Error message?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0310e973a4c28a7e02baad03799eb40869ce4506
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 31 11:15:57 2020 +0200

    Bug 10921: Prevent an order from a closed basket to be edited
    
    We don't allow editing of orders that are part of a closed basket, but
    we don't enforce the rule in the controller file.
    
    This patch use output_and_exit to stop the script and display an error
    to the end user.
    
    Test plan:
    Create a basket, add an order
    On the basket view you see the "Modify" link, open it in a separate tab
    => You can edit the basket
    Keep this tab open, get back to the other one and close the basket
    Reload the tab with the order edition form
    => You cannot longer edit the basket
    
    QA: Do we need a check in addorder.pl as well?
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f90afe5c22445fb47430f629491d09762beeb3f8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 13 17:42:36 2020 +0000

    Bug 15933: Add cataloguing plugin to search for existing publishers in other records
    
    This patch adds a new cataloging plugin for MARC21 installations,
    marc21_field-260b.pl. When enabled it provides autocomplete for
    publisher name, pulling existing data from biblioitems.publishercode.
    
    To test, apply the patch and enable the plugin:
    
    - Go to Administration -> MARC bibliographic framework -> MARC structure
      -> 260 -> Edit subfields -> Subfield b -> Other options.
    - Set "Plugin" to marc21_field_260b.pl.
    - Go to Cataloging and edit or create a record.
    - Under tab 2 click the field for 260$b. Start typing a publisher name.
      A dropdown should appear with matching publishers.
    - Selecting one of the results should populate the form field with that
      information.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Also works with 264$b.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76cff7e528a673369a0ee1b88207a2dbe4fbf8ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 18 09:46:10 2020 +0000

    Bug 24807: DBRev 20.06.00.038
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c53909567a31e2eae337ee029d1c9d7348f3874a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 10 13:15:58 2020 +0000

    Bug 24807: (follow-up) Add support for spaces as unknown characters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 55e18646db855a8cf14b1f7f9adae2729525a2ce
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu May 7 16:26:38 2020 +0000

    Bug 24807: (follow-up) Fix spelling
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad1aab0e4242f4ea774951703796892fb858e6df
Author: David Gustafsson <glasklas@gmail.com>
Date:   Mon Apr 20 13:03:24 2020 +0200

    Bug 24807: Simplify with new and imporved value_callbacks
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 342b51629d29db5e9309dc599c67b413e19ebbb8
Author: David Gustafsson <glasklas@gmail.com>
Date:   Thu Apr 16 17:26:41 2020 +0200

    Bug 24807: Refactor using tokenize_callbacks
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4cae9b49f3036c8500db702d031c8475f5fb673b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 8 09:55:20 2020 +0000

    Bug 24807: Add suppport for uncertain fields and ranges
    
    To test:
    1 - Have some records with uncertain dates in the 008
        19uu, 195u, etc.
    2 - Index them in Elasticsearch
    3 - Do a search that will return them
    4 - Sort results by publication/copyright date
    5 - Note odd results
    6 - Apply patch
    7 - Reindex
    8 - Sorting should be improved
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19c5db66377fc6e30a56f365874387e682e6c4c7
Author: David Gustafsson <glasklas@gmail.com>
Date:   Thu Apr 16 14:51:13 2020 +0200

    Bug 24807: Update tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22abdd8af669dde60211f38f6c27a73367afe910
Author: David Gustafsson <david.gustafsson@ub.gu.se>
Date:   Thu Mar 5 11:35:32 2020 +0100

    Bug 24807: Add database update script
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1c8d7eccee6e75473bf7c780617d683f64e5229
Author: David Gustafsson <david.gustafsson@ub.gu.se>
Date:   Wed Mar 4 17:07:11 2020 +0100

    Bug 24807: Add "year" type to improve sorting behaviour
    
    Add a "year" search field type. Fields with this type will only
    retain values that looks like years, so invalid values such as
    whitespace or word characters will not be indexed.
    This for instance improves the behaviour when sorting by
    "date-of-publication". If all values are indexed, records with
    junk data instead of valid years will appear first among the search
    results, drowning out more relevant hits. If assigning this field
    the "year" type these records will instead always appear last,
    regarless of sort order.
    
    To test:
    
    1) Have at least two biblios, one with a valid year in 008 (pos 7-10)
    and another with an invalid one ("uuuu" for example)
    2) Perform a wildcard search (*) and sort results by publication date.
    3) The record with invalid year of pulication in 008 should appear first
    4) Apply patch and run database updates
    5) Reindex ElasticSearch
    6) Perform the same search as in 2)
    7) The record with the invalid year should now appear last
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b273de5777ac7dd5bebac629dc8c88e6bdc962a
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Aug 6 18:21:52 2020 +0000

    Bug 25744: replace <b> with <strong> in the staff interface
    
    This patch set attempts to replace all the <i> tags with <em> and all
    the <b> tags with <strong> in the staff interface.
    I attempted to get all the templates, includes, and xslt files.
    
    To test:
    
    1. Review the changes as best as possible, looking for mistakes.
    2. grep for <i> and <b> in the modules, includes, and xslt folders. You should get nothing/
    3. If you grep '<\/i>' you should only see instances of Font Awesome.
    4. If you grep '<\/b>' you should only see instances where caret is used.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a02bd4f71c25207b38908887bae50bdf1c450a3b
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Aug 6 17:29:54 2020 +0000

    Bug 25744: Replace <i> with <em> in staff interface
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9db369fb58c1f2795f748e972397f1ecb882ce92
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jul 23 10:21:36 2020 +0200

    Bug 26049: Replace li with span class results_summary in UNIMARC intranet XSLT
    
    In all XSLT for record display, fields are created with <span class="results_summary> except in UNIMARC intranet where there is just <li>.
    
    This allows a better CSS customisation and closer code in files for OPAC and intranet.
    
    Actually li gets diplayed with a dot at each line, we don't want this.
    
    Test plan :
    1) For each modified file run 'xsltproc file.xsl' and see there is no
       error
    2) Use default XSLT in all system preferences
    3) Perform a search and check display with and without patch
    4) Click on a record to see details and check display with and without patch
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d78cae2841ee4f60325cb7f31cecce27cab01e4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 31 12:33:19 2020 +0000

    Bug 26262: (follow-up) Fix course details page, default configuration
    
    Bug 25287 changed the default DataTable configuration in the OPAC so
    that tables are paginated by default. This is inconsistent with the way
    we currently use DataTables in the OPAC, and the change was probably
    unintentional. This patch returns the default pagination configuration
    to what it was before: Off.
    
    The patch also updates opac-course-details.tt with the same DOM
    configuration as opac-course-reserves.tt.
    
    To test, apply the patch and view the list of course reserves and the
    list of titles attached to a course. In both cases there should be no
    pagination controls, and the tables should show all results.
    
    Signed-off-by: Alexis Ripetti <alexis.ripetti@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bc7e5a645381ffc30f320624a705869a202c029
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 26 12:41:47 2020 -0300

    Bug 26262: Remove wrong dom setting in course reserves (OPAC)
    
    The current setting required pagination to be displayed. This was hidden
    probably as a side effect of styling settings. But the docs are clear on
    the fact that p and l are intended for displaying pagination controls
    and table rows lenght information [1]
    
    As the course reserves datatable is not paginated, this needs to be
    fixed properly by removing those controls in the configuration. This
    patch does so.
    
    To test:
    1. Have some course reserves
    2. See them in the OPAC
    => FAIL: Some funky, misaligned pagination artifacts are displayed
    3. Apply this patch and reload
    => SUCCESS: Things are back to normal!
    4. Sign off :-D
    
    [1] https://datatables.net/examples/basic_init/dom.html
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24556e73d279dd5f09e96bc674fcc61fd3cc8fbc
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Aug 26 07:35:36 2020 +0000

    Bug 26301: Use CanBookBeRenewed when renewing via self-checkout
    
    Currently, if you have OverduesBlockCirc set to "Ask for confirmation"
    and OverduesBlockRenewing set to "allow renewing", you get caught
    in a loop where you can never renew an overdue material.
    
    This patch uses CanBookBeRenewed for renewals, rather than CanBookBeIssued,
    which means the correct rules are applied to the correct scenario.
    
    To test:
    
    a. Set OverduesBlockCirc to "Ask for confirmation"
    b. Ensure "OverduesBlockRenewing" set to "allow renewing"
    0. Apply the patch
    1. Checkin item barcode 3999900000001
    2. Go to http://localhost:8081/cgi-bin/koha/circ/circulation.pl?borrowernumber=51
    3. Checkout item barcode 3999900000001 to 1 year ago
    4. Go to http://localhost:8080/cgi-bin/koha/sco/sco-main.pl
    5. Login as the "koha" user
    6. Click on "Renew item"
    7. Note that the item is renewed
    
    8. Checkin item barcode 3999900000001
    9. Go to http://localhost:8081/cgi-bin/koha/circ/circulation.pl?borrowernumber=51
    10. Checkout item barcode 3999900000001 to 1 year ago
    11. Go to http://localhost:8080/cgi-bin/koha/sco/sco-main.pl
    12. Login as the "koha" user
    13. Type "3999900000001" into the box under "Scan a new item or enter its barcode"
    14. Click "Submit"
    15. Note the system says the item is already checked out and it prompts
    you to click "Renew item" in this screen
    16. Click "Renew item"
    17. Note the system says "Item renewed" near the top of the screen, and the "Due"
    date near the bottom of the screen is more recent than the original due date
    
    18. Checkin item barcode 3999900000001
    19. Go to http://localhost:8080/cgi-bin/koha/sco/sco-main.pl
    20. Login as the "koha" user
    21. Type "3999900000001" into the box under "Scan a new item or enter its barcode"
    22. Click "Submit"
    23. Note the system says "Item checked out" and the item appears in the checkouts
    at the bottom of the screen
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5a959486f1ba8014b2020623cc304711bb856b7
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Sep 12 17:53:26 2020 +0000

    Bug 26435: (QA follow-up) Terminology: Fix some more borrowers in other preferences
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2baad1a39d72f4cce4f4242753e6c041df410681
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Sep 12 17:51:52 2020 +0000

    Bug 26435: (QA follow-up) Fix terminology: borrower to patron in new hint
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38be70b55d0c01d0d9b54af0ef386d3de90161d7
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Sep 11 15:39:53 2020 +0000

    Bug 26435: Add warning to AutoSelfCheck sysprefs
    
    To test:
    1- apply patch, restart
    2- look up AutoSelfCheck sysprefs
    3- confirm new note in description
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 692b0958414474b48ef7242b65e697913dc99deb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 14 17:44:36 2020 +0000

    Bug 26460: Fix line ending in JSON
    
    Wrong line ending in JSON causes error:
    Uncaught SyntaxError: missing } after property list
    note: { opened at line 29579, column 15
    
    To test:
    1 - Have a title with some items not for hold in staff interface
    2 - Set AllowHoldPolicyOverride to 'Allow'
    3 - Attempt to place hold on the title
    4 - Note JS error in the console and datatable does not load for items
    5 - Apply patch
    6 - Reload
    7 - Error is cleared, table loads correctly
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1c2974d7b3a20d03d7be4df45dde8e8c2d86ff0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 4 16:16:27 2020 +0000

    Bug 25969: Don't set itemnumber as reserve->itemnumber
    
    When a hold is checked in at the wrong destination we revert the found status
    For a title level hold this means we return it to a title level hold, with no itemnumber
    
    When we checkin the item we find the hold, but won't set the itemnumber in the hold until it is confirmed
    
    In the script we were setting the itemnumber param, but then setting it again using the reserve itemnumber.
    In all conditions before the itemnumber has been set, we don't need to set it again, especially when we do
    so incorrectly
    
    To test:
    - Log in at Library A
    - Place hold on item at Library A, for pickup at Library A
    - Check item in at Library A
    - Click "Confirm hold"
    - Set library to Library B
    - Check item in again (try with both the box on reutrns.pl and the box in the header)
    - Click "Confirm hold and transfer"
    - get error: Can't call method "biblio" on an undefined value at /kohadevbox/koha/circ/returns.pl line 147
    - apply patch
    - repeat
    - success!
    - confirm trappings of holds works as normally otherwise too
    
    Signed-off-by: Daniel Gaghan <daniel.gaghan@pueblolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40c5d06a502071f6e9ca3828d37c820855f0c039
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 9 14:36:31 2020 -0400

    Bug 25969: Checking in a found hold at a different branch then confirming the hold causes internal server error
    
    If a record level hold is filled and waiting at Library A, and the item
    is checked in at Library B, and an attempt is made to re-fill the hold
    with the item, Koha will return an ISE.
    
    Test Plan:
    1) Place a hold for Library A, at Library A, for pickup at Library A
    2) Check in the item at Library A and fill the hold so it is waiting at Library A
    3) Log in as Library B, check in the same barcode
    4) Note the request to fill the hold with the item
    5) Choose to fill the hold
    6) Note you get an internal server error
    7) Apply this patch
    8) Restart all the things!
    9) Repeat steps 1-5
    10) No ISE!
    
    Signed-off-by: Daniel Gaghan <daniel.gaghan@pueblolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e397330f687bd0e9e39387e32a8a8acbbb3b31a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 10 09:42:58 2020 +0200

    Bug 26420: Use translated notices for overdue_notices.pl
    
    This script does not pass the patron's preferred lang for notices.
    
    Test plan:
    Enable TranslateNotices
    Create a patron with a preferred lang for notices != default
    Translate ODUE for this language
    Setup the overdue notices for this patron's category
    Check an item out for this patron (select the correct due date to
    trigger the notice)
    Run the script overdue_notices.pl
    Check the message_queue table and confirm that the notice enqueued is
    translated
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89716a78e9a7ed4c80dddba916d52737c7f2b468
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 16 11:02:22 2020 +0100

    Bug 26269: Fix variable name mismatch for cash_register in paycollect
    
    It appears that through various rebases the variable names in the form
    and the controller script have become mismatched.  This patch corrects
    the situation and clarifies their intended use.
    
    Test plan:
    1/ Turn on cash registers in sysprefs
    2/ Define at least 2 cash registers in Admin
    3/ Create a manual invoice on a patron
    4/ Pay off half of your fee, selecting the first register
    5/ Pay off the remaining fee, selecting the second register
    6/ Query accountlines.register_id for your two payments
    8/ Confirm the two accountlines.register_id's do not match (thus the
    passed variable was used)
    
    https://bugs.koha-community.org/show_bug.cgi?id=26469
    
    Signed-off-by: Jessie Zairo <jzairo@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b3657b3d6762d148b57324c7211ede743c15c5b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 15 16:23:05 2020 -0300

    Bug 26470: Store the item before calling the after action hook
    
    This patch makes Koha::Item->store call $self->SUPER::store before
    calling the hook, so things like the itemnumber (AUTO_INCREMENT field)
    are available to the plugin hook.
    
    It does so by storing the output on a temporary variable, to keep the
    current behaviour of just returning the output from SUPER::store.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Biblio_and_Items_plugin_hooks.t \
               t/db_dependent/Koha/Item.t \
               t/db_dependent/Koha/Items.t
    => FAIL: the hooks tests fail. Item.t hasn't been altered so should pass
    3. Apply this patch
    4. Repeat 2.
    => SUCCESS: Tests pass! Item.t as well! (i.e. no behaviour change)
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 99a640fd75118475f5443093a3b815e3ce148b8f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 15 16:21:33 2020 -0300

    Bug 26470: Regression tests
    
    This patch tweaks the test plugin so it composes an exception based on
    the fact that the hook was called with the item and item_id parameters
    defined.
    
    It then makes the tests expect a specific exception message with
    information about this.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Biblio_and_Items_plugin_hooks.t
    => FAIL: Tests fail!
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15174e7bd3f03555ff0120385443157f3da39fe2
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Sep 8 16:54:19 2020 +0200

    Bug 26407: fix query in 'title exists' in `search_for_data_inconsistencies.pl`
    
    Bug 23871 added check for 'title exists' to `search_for_data_inconsistencies.pl`.
    There is a typo in DBIx query to create or : hashref instead of arrayref.
    
    Test plan :
    1) Change title of biblio record XXX in SQL :
       UPDATE biblio SET title = '' WHERE biblionumber=XXX
    2) Change title of biblio record YYY in SQL :
       UPDATE biblio SET title = NULL WHERE biblionumber=YYY
    3) Run misc/maintenance/search_for_data_inconsistencies.pl
    4) Check you see both records
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c8b0b9eb65bbdc7ed67c815c2750949de7409cb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 18 10:32:15 2020 +0200

    Bug 20168: Compiled CSS - RTL files
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51fd1db1cf8ee39d74be436d4bab83955a3c8a18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 4 18:25:45 2020 +0200

    Bug 26394: Update .mailmap
    
    The .mailmap file used to generate the stats is different from the one we have in our repo. It's much more complete and should be integrated into Koha.
    
    Test plan:
    Confirm that the different mappings are correct
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fb268cd4bb6723daa72ce46c08cefc02e788acc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 3 11:58:14 2020 +0200

    Bug 26365: Remove comparison with 0000-00-00 for datecancellationprinted
    
    Using MySQL 8:
    t/db_dependent/Koha/Acquisition/Order.t .. 10/11 No method count found for Koha::Acquisition::Orders DBIx::Class::Storage::DBI::_dbh_execute(): DBI Exception: DBD::mysql::st execute failed: Incorrect DATE value: '0000-00-00' [for Statement "SELECT COUNT( * ) FROM `aqorders` `me` WHERE ( ( ( `datecancellationprinted` IS NULL OR `datecancellationprinted` = ? ) AND `ordernumber` IN ( ?, ?, ? ) ) )" with ParamValues: 0='0000-00-00', 1=23, 2=24, 3=25] at /kohadevbox/koha/Koha/Objects.pm line 597
    
    We must remove the comparison with 0000-00-00
    
    Highlighted by bug 23166.
    
    I wanted to provide a DB rev but we (obviously) cannot:
    MySQL [koha_kohadev]> UPDATE aqorders SET datecancellationprinted=NULL WHERE datecancellationprinted="0000-00-00";
    ERROR 1292 (22007): Incorrect date value: '0000-00-00' for column 'datecancellationprinted' at row 1
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1644cbf298d2178b57b7f4d5163f13e2d4c39ee
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 11 07:11:22 2020 +0000

    Bug 26384: (QA follow-up) Fix two exceptions
    
    AuthUtils.t went back to 644, but should be 755
    Adding an exception in the xt test for fix-old-fsf-address.exclude
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ebe27c982c4bbc2fd51112f381d2ca3be28e1e8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 7 11:31:52 2020 +0200

    Bug 26384: Add test to catch for missing or extra execution flags
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1f9c6dc746db9c58ce4eaca10ee9a4a7137c6f4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 7 11:33:08 2020 +0200

    Bug 26384: Fix executable flags
    
    .pm must not have -x
    .t must have -x
    .pl must have -x
    
    Test plan:
    Apply only the first patch, run the tests and confirm that the failures
    make sense
    Apply this patch and confirm that the test now returns green
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac304e93d89e1af2247b68aaad25b1b7e1fd2a51
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 7 11:25:38 2020 +0200

    Bug 26401: Remove xt/fix-old-fsf-address*
    
    On bug 24545 we fixed all the license statements and added a QA check + a test in our test suite.
    We do not longer need this script.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67b30bc20163599332e587e0222ad0af6057a7f0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 11 06:31:04 2020 +0000

    Bug 26007: (QA follow-up) Fix English yml file
    
    git grep -l -E "link:\s*\"?[0-9]" | xargs sed -i -e "/link:/ s/130/\"Title-uniform\"/"
    Only one occurrence without quotes around 130.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a259f6f53d28ad30b7c943a2a50e6e3217c0ccad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 10 10:41:32 2020 +0200

    Bug 26250: Fix regressions.t when SearchEngine=ES
    
    Prior to this patch it failed with:
    t/db_dependent/selenium/regressions.t .. 5/5 Can't call method "leader" on an undefined value at /kohadevbox/koha/Koha/SearchEngine/Elasticsearch.pm line 548.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74dd083f8e6b6cc8c962a42d91132c825dc2713c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 10 10:07:05 2020 +0200

    Bug 23816: Fix selenium tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59b79b6045f0a085b63abf25247f09fe1b7063f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 10 09:57:51 2020 +0200

    Bug 23816: Fix patron edition
    
    The patron edition was broken, we always got the pattern alert
    Password:
    Password must contain at least 8 characters, including UPPERCASE, lowercase and numbers
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de096ab20076b185e414dc6c0330f3370e171c49
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 16:31:07 2020 +0200

    Bug 26157: Correct two occurrences
    
    We don't want to hide the warnings for all tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3c199ac140a29fa10c16cbba7507a1c2e34dc34
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 13:13:45 2020 +0000

    Bug 23816: DBRev 20.06.00.037
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a1402d06638811c5f893dc8c238b5b814bac625
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Aug 27 20:07:16 2020 +0200

    Bug 23816: (QA follow-up) Use existing form validation to validate min password length
    
    The pattern check didn't work for me, but I figured we might
    want to use the same validation as for the other numeric fields
    on the form instead (upper age limit, etc.)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52deed335e08c3f8f52c834eead6ab462350cf54
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Aug 27 12:58:56 2020 -0300

    Bug 23816: (follow-up) Fix many things
    
    This patch:
     * reverts changes on misc/admin/set_password.pl
     * makes category param mandatory for AuthUtils::is_valid_password and AuthUtils::generate_password
     * changes onboarding.pl to set category param in AuthUtils::is_valid_password
     * Completes t/db_dependent/AuthUtils.t and drops t/AuthUtils.t
     * Removes offending <input type="number"/> and replaces it by <input type="text" inputmode="numeric" pattern="[0-9]*"/>
    
    https://bugs.koha-community.org/show_bug.cgi?id=23826
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e85b200783c1c56b19c515669a149e6b9920393c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 19 09:00:12 2020 +0200

    Bug 23816: trivial code simplification
    
    Ease readability
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    https://bugs.koha-community.org/show_bug.cgi?id=23826
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15d83d44812307f0d37abcf040a357ffab3f27e6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 19 08:48:19 2020 +0200

    Bug 23816: Set default value in tests
    
    We tell TestBuilder to generate the categories with NULL (and rely on
    the sysprefs)
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    https://bugs.koha-community.org/show_bug.cgi?id=23826
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5848da810e412a69932da6935285df4e91058b6f
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Apr 15 17:13:02 2020 -0300

    Bug 23816: Add minimum password length and require strong password overrides by category
    
    This patch adds the capability to override minPasswordLenth and RequireStrongPassword settings by category
    
    To test:
    1. koha-shell kohadev
    2. koha-mysql kohadev
    
    3. drop database koha_kohadev;
    4. create database koha_kohadev;
    
    5. go to admin page and start webinstaller. There continue the steps until onboarding.
    6. reach step 3 of onboarding and create a new administrator patron
    CHECH => Password control woks as normal (Minimum length 3 and strong required)
    
    7. finish Koha installation and enter admin with your new administrator
    8. set minPasswordLength to 3 and RequireStrongPassword to “Don’t require”
    9. Create a new category (CAT2 from now on.. CAT1 is the category you made in onboarding process) and set minimum password length to 8 and require strong password
    10. Create two new patrons, one with CAT1(patron1) and one with CAT2 (patron2)
    CHECK => In both cases, try different combinations of length and strength. For patron1 the only requirement is to have 3 letters, but for patron2 the minimum length will be 8 and will require strong password.
    CHECK => Try changing patron category before saving. Password requirements will change with category change.
    
    11. Edit CAT1 and set minimum password length to 5
    12. Go to patron1 details page, and change password.
    CHECH => Now password minimum length is 5, but still it doesn’t require strong password
    
    13. Edit CAT1, leave blank minimum password length and set require strong password to yes.
    14. Go to patron1 details page, and change password.
    CHECH => Password minimum length is back to 3, but now strong password is required
    
    15. Set minimum password length in CAT2 to 12.
    16. Go to patron2 details page, and click to fill a random generated password
    CHECK => generated password should be 12 characters length
    
    17. Set PatronSelfRegistration to Allow in admin settings
    18. Go to OPAC and fill self registration from.
    CHECK => Play with patron category. For each change in category, password requirements are modified.
    CHECK => Set CAT1 as patron category, set ‘aA1’ as password (or another valid password for CAT1) and before hitting submit button, change to CAT2. Form should enter invalid state, and CAT2 password requirements should be displayed as error in password input.
    
    19. Create a patron for CAT1 and another for CAT2, leaving password blank
    CHECK => For CAT1’s patron, generated password length is 8 (minimum length for generated passwords), but for CAT2’s patron should be 12
    
    20. In admin set PatronSelfRegistrationVerifyByEmail to require
    21. Fill self registration form again with CAT2 as category
    CHECK => Password requirements works as previous case.
    22. Leave password blank and click submit
    
    23. select * from message_queue;
    24. Copy the link in the message and paste it in OPAC
    CHECH => Generated password is 12 characters long. (Copy user id for next steps)
    
    25. In admin set OpacResetPassword to Allow
    26. Go back to OPAC, reload and click on “Forgot password?” link
    27. Paste user id and click submit
    28. Repeat steps 23 and 24
    CHECK => Info message says “Your password must contain at least 12 characters, including UPPERCASE, lowercase and numbers.”
    CHECK => enter an invalid password and you’ll get the same message in warning.
    
    29. Login OPAC with the last user and your newly created password
    30. Go to “Change your password” option
    CHECK => Info message says “Your password must contain at least 12 characters, including UPPERCASE, lowercase and numbers.”
    CHECK => enter an invalid password and you’ll get the same message in below “New password” input.
    
    31. prove t/db_dependent/AuthUtils.t t/db_dependent/Koha/Patron/Category.t
    
    32. Sign off
    
    Sponsored-by: Northeast Kansas Library - NEKLS
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e14b779f38f164585f4cce543b6df06b6903b31d
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Apr 15 17:13:16 2020 -0300

    Bug 23816: Add tests
    
    Sponsored-by: Northeast Kansas Library - NEKLS
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84004d0b3ef3af12915897dfe764fb325e5fe75d
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Apr 16 17:59:17 2020 -0300

    Bug 23816: (follow-up) Define boolean column in shcema
    
    Sponsored-by: Northeast Kansas Library - NEKLS
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1be25ee4397916dc929a6838c636caa541c3c1e1
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Apr 15 16:12:16 2020 -0300

    Bug 23816: [DO NOT PUSH] Update category schema
    
    Sponsored-by: Northeast Kansas Library - NEKLS
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f7142a89098535674366052812c1ea07f81dd8e
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Apr 15 16:12:16 2020 -0300

    Bug 23816: Update kohastructure and atomic update
    
    Sponsored-by: Northeast Kansas Library - NEKLS
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ae7a6f421b6f313e466392722efdf67afe1b51b
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Aug 26 04:05:21 2020 +0000

    Bug 26285: Follow E.164 pattern for OPAC too
    
    This patch uses the E.164 pattern for phone numbers
    for the OPAC (and not just the staff interface).
    
    To test:
    0) Follow the same plan as the staff interface, but
    go to /cgi-bin/koha/opac-messaging.pl after logging
    into the OPAC
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4d8180d822fc9b51250d4575ada99088e9a8506
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon Aug 24 06:42:27 2020 +0000

    Bug 26285: Follow E.164 pattern for validating SMS numbers
    
    Currently, Koha is not correctly validating SMS numbers using
    E.164. This causes Australian phone numbers without a country code
    to fail validation.
    
    This patch uses the E.164 pattern of 1-3 digits for country code,
    prefixed by a + symbol, and followed by up to 12 digits for
    the remainder of the phone number.
    
    To test:
    
    0. Don't apply patch yet
    1. Set "SMSSendDriver" to "Anything"
    2. Go to http://localhost:8081/cgi-bin/koha/members/memberentry.pl?op=modify&destination=circ&borrowernumber=51
    3. Type in 0455555555 and note "Please enter a valid phone number." message in browser
    
    6. Apply the patch
    
    7. Go to http://localhost:8081/cgi-bin/koha/members/memberentry.pl?op=modify&destination=circ&borrowernumber=51
    8. Type in 0455555555 and note no validation error
    9. Type in +61455555555 and note no validation error
    10. Type in 123456789012 and note no validation error
    11. Type in 1234567890123 and note "Please enter a valid phone number." error
    12. Type in +900123456789012 and note no validation error
    13. Type in 900123456789012 and note "Please enter a valid phone number." error
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c95bb26327d11ecf8bf86dcd3996a94b2716da7c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 4 09:33:13 2020 +0000

    Bug 26007: (QA follow-up) Remove message on marc_subfields_structure
    
    Why? Since the combo has been disabled since a few releases. If you
    want to change this mapping, you should do it on Koha to MARC mappings.
    This change is no longer per framework, but over all frameworks.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a937895fdadc9a90c53d31975ca7082516e5cdb9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 4 09:09:00 2020 +0000

    Bug 26007: (QA follow-up) Replace wrong link values from sql installer files
    
    Field 943$a has link value "130". This does not work; 130 is not a search
    index. It should be Title-uniform.
    Note: Only used on a search link in the intranet MARC detail page.
    
    In some cases "130" should be replaced by "Title-uniform", but sometimes
    130 without quotes had to be replaced. Performed by two sed statements
    on git grep results.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10d8f8ba93571f590fc424b927b94035dfa0b9d2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 4 08:38:24 2020 +0000

    Bug 26007: (QA follow-up) Add index name to the q parameter
    
    The link constructed in MARC-detail is not consistent. It adds
    an index name but does not show in the query in the search box.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54941f8dc558911e4222f7325609839b7c6bae81
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Aug 30 22:31:32 2020 +0200

    Bug 26007: Add/fix warning for changes to the Koha to MARC mappings
    
    There are 2 pages where one can change the Koha to MARC mappings in Koha:
    
    - When editing the configuration for a MARC subfield
    - On administration > Koha 2 MARC mappings
    
    This patch adds a warning that the batchRebuildBiblioTables script
    must be run if the mapping is changed.
    
    To test:
    - Go to Administration > MARC bibliographic frameworks >
      Any framework > MARC structure > Any field > Edit subfield
    - ÃThe hint about the batchRebuildBiblioTables will be on "Link"
      instead of "Koha Link". This is wrong as the link doesn't care
      about the mappings.
    - Go to Administration > Koha to MARC mappings
    - Verify there is no hint
    - Apply patch
    - Verify both pages now show an appropriate message
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    This commit message is not completely accurate. See the follow-ups.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 763cc4eb2e53f7a44a138d6162bfa4470a484bac
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 4 13:18:53 2020 +0000

    Bug 26388: Do not show 'Renew all' or 'Renew selected' if no renewable items
    
    Additionally, only include renewable items in 'Renew all'
    
    To test:
    1 - Check out some items to a patron, ideally:
        Some not renewable because set for auto renewal
        Some not renewable because of holds
        Some renewable
     2 - Confirm 'Renew selected' and 'Renew all' show on the opac
     3 - Click 'Renew all'
     4 - You get errors about the non-renewable items?
     5 - Check in all renewable items
     6 - Confirm you still see renew buttons
     7 - Apply patch
     8 - Refresh and you shoudl not see renew buttons
     9 - Check out a renewable item
    10 - Click 'Renew all'
    11 - Renewable item is renewed with no error
    12 - Try again with 'Renew selected'
    13 - Confirm it works as expected
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bdb64657f9c69387f264a333a7d040c9f1dba574
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Jul 11 13:25:11 2020 +0000

    Bug 16314: Show upload link for upload plugin in basic MARC editor
    
    This patch updates the basic MARC editor to provide a plugin name
    variable to the template, allowing us to make a check on the name and
    conditionally show an upload link if the "upload.pl" cataloging plugin
    is selected.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Go do Administration -> MARC bibliographic framework -> MARC
       structure -> 856 -> Edit subfields.
     - Edit the "u" subfield and select "upload.pl" as the plugin under
       "Other options."
     - Go to Cataloging and create or edit a MARC record.
     - Under tab 8 look for the 856 tag, subfield u. There should be an
       "Upload" link corresponding to the form field.
     - Click the upload link to confirm that it triggers a popup window with
       the upload form.
     - Confirm that other similar plugin links (for instance 100$a, 600$a)
       display the old "tag editor" icon.
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 11da7051c2c967e7d9dd10f8511a4a452964341e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 14:46:54 2020 +0200

    Bug 24663: Fix one missing occurrence
    
    pushed in the meanwhile
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f99976028c51b21458b6aa5eff9fe33a0d1774c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 15:37:39 2020 +0200

    Bug 20168: Fix selenium tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 886d570e2686355b917bf3ca92c2dad029160352
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 12:28:13 2020 +0000

    Bug 20168: DBRev 20.06.00.036
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb7a8db2c085290e5a5af968909964fe230b23ba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 14:25:13 2020 +0200

    Bug 20168: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94c68681181fee606a3c182c234511131dff641d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 14:33:23 2020 +0200

    Bug 20168: Remove li tags from OPACSearchForTitleIn for new installs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 221a40282c9fdd2d14488121d47e1529ec19cfc2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 9 14:23:41 2020 +0200

    Bug 20168: Consider opaclayoutstylesheet empty if 'opac.css'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00b1bf3c2cce46878cb12957a8af999e02ec7b40
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 4 14:32:04 2020 +0000

    Bug 20168: (follow-up) Add automatic creation of RTL CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cb89b46397efc5e288723829613c33e7eea0d69
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 14 15:54:00 2020 +0000

    Bug 20168: Update of the OPAC bootstrap template to bootstrap v4
    
    This patch updates the version of Bootstrap in the OPAC from 2.3.1 to
    4.5.0. The Bootstrap JavaScript files have been replaced with custom
    builds of the 4.5.0 JavaScript source files. The Bootstrap CSS is now
    built into the OPAC CSS by loading the required Bootstrap 4.5.0 SCSS
    files in node_modules.
    
    OPAC SCSS now starts with Bootstrap customizations:
    
    /* Bootstrap variable customizations */
    $headings-color: #727272;
    ...
    
    Followed by loading the necessary Bootstrap SCSS files:
    
    /* Bootstrap imports */
    @import "../../../../../node_modules/bootstrap/scss/functions";
    @import "../../../../../node_modules/bootstrap/scss/variables";
    ...
    
    Followed by our CSS. The build process for generating compiled CSS now
    creates a file which bundles Bootstrap CSS and ours. Removed from the
    Koha source: Bootstrap CSS files, Bootstrap "glyphicons" images.
    
    The upgrade to Bootstrap 4 involved a lot of markup changes to conform
    with new Bootstrap classes, especially in classes related to the grid.
    Besides duplicating the grid we used before, this upgrade adds some new
    features made possible by Bootstrap 4.5's use of flexbox as a layout
    tool. This includes custom ordering of columns based on class names:
    https://getbootstrap.com/docs/4.5/layout/grid/#order-classes.
    
    Other areas where the most changes have been made: Navigation menus,
    breadcrumb menus, buttons, dropdowns.
    
    Bootstrap's JavaScript file is now "bootstrap.bundle.min.js" to reflect
    the fact that a required JavaScript asset is now distributed separately
    in Bootstrap 4. The "bundle" version includes Popper.js.
    
    Unrelated changes: Indentation corrections, removal of invalid
    "//<![CDATA[" markers, removal of invalid script type attributes.
    
    To test, apply the patch and run 'yarn install' to install Bootstrap as
    an npm module. Run 'yarn build --view opac' to regenerate the OPAC CSS.
    
    Test as many aspect of the OPAC as possible, viewing pages at various
    browser widths to confirm that everything adjusts well. Test with
    various OPAC interface system preferences enabled and disabled.
    
    Test self checkout and self checkin.
    
    Known issues: RTL support has not been updated.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83ebab049d8d3827226ef1700591ee63702ded17
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 3 12:20:57 2020 +0000

    Bug 23682: DBRev 20.06.00.035
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8a08cdfa7089f2b8147b3d75ce33c9521fd2cd6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 3 14:11:46 2020 +0200

    Bug 23682: Fix use Koha::Plugins::Handler statements
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85405a2143c4dda5fb5c078a6ee78c5ab6d1b6d8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Aug 31 13:02:05 2020 -0400

    Bug 23682: Dedup plugin calls my moving to a single call in process_invoice()
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2804d786c4e47dc0a3949d79f9ba944e8fb1d455
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Aug 25 14:18:32 2020 +0000

    Bug 23682: INSERT IGORE systen preference in database update
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d05feac31edd214ff47facc8a6d9c78d074da65
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Aug 24 13:21:26 2020 -0400

    Bug 23682: (QA follow-up) Fix typo in syspref description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8696702cedb46e7667f9398165ee89627219809
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Sep 26 10:39:36 2019 -0400

    Bug 23682: Add ability to manually import EDI invoices as an alternative to automatic importing on download
    
    Some library would like to delay the importing of invoices until
    a time of their choosing. The invoices should be imported into
    the database as they do now, but the invoice processing should
    be skipped. Instead, any invoice file with a status of 'new'
    should have an 'Import' button to process the invoice.
    
    Test Plan:
    1) Apply this patch
    2) Run updatedatabase.pl
    3) Enable the new syspref EdifactInvoiceImport
    4) Run the edi cronjob to import a new invoice file
    5) View EDI messages table at /acqui/edifactmsgs.pl
    6) Note the invoice files is not processes, and retains the status of 'new'
    7) Use the 'import' button to process the invoice
    8) Note the invoice is now marked 'received' and the 'import' button is gone
    9) Verify the invoice was actually processes
    
    Signed-off-by: Debi Stears <DDStears@washoecounty.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cbf2841ad45dbbddda915873a85fb4569b3bb68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 3 12:20:57 2020 +0000

    Bug 24197: DBRev 20.06.00.034
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72deefe8cf4f2d1cc24e7577ef2d2b8a44945f18
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 2 17:32:42 2020 +0000

    Bug 24197: (QA follow-up) Shorten syspref name to AddressForFailedEmailNotices
    
    If you define the address we use it, if not we fallback,
    it's not really a redirect, and that just makes the name longer.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb272f01f4191b681e25ca5528d87e1c67fb679f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 2 16:33:06 2020 +0100

    Bug 24197: (QA follow-up) Embelished syspref description
    
    As requested, I have embelished the syspref description to more
    accurately depict the fallback sequence for email delivery.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bed91ac8f73ca83235bf4dceee7123fbb4e14340
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed Apr 22 00:01:58 2020 +0000

    Bug 24197: Changed use of 'branch' terminology to 'library'
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b48cdd227f12bb43decc9f7108e84ea562d8ebc9
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Tue Apr 21 23:21:20 2020 +0000

    Bug 24197: Added new local use syspref which sets the email address that failed overdue notices are set to.
    
    Test plan:
    1. Set no email addresses in patron record then checkout
    items to the patron making the due date in the past
    
    2. Visit patron's home library page: Administration > Libraries
    Set a branch email and in global system preferences observe there is no syspref
    named RedirectAddressForFailedOverdueNotices
    
    3. Manually run overdue_notices.pl
    
    4. Check the message_queue database table and observe there is a
    print overdue notice and a email notice with to_address of the
    branch email address
    
    5. Apply patch
    
    6. Run database update:
    cd installer/data/mysql
    sudo koha-shell <instance_name>
    ./updatedb.pl
    
    7. Confirm there is a new system preference named:
    RedirectAddressForFailedOverdueNotices
    
    Give it a different email address to that in the branch email.
    
    7. Repeat steps 1,3,4 and observe that the failed overdue notices have been
    sent to the email defined in RedirectAddressForFailedOverdueNotices
    
    Sponsored-By: Catalyst IT
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 029bdb1fedf73f892f2807a675c0fd19fab06285
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 2 14:40:08 2020 +0100

    Bug 25541: (QA follow-up) Default to disabled + Correct message
    
    This patch defaults the 'holds_block_checkin' configuration to disabled
    (to maintain current behaviour on upgrades). It also updates a
    copy/paste for siplog logging to make the message triggered by this
    action unique as expected.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 002ae7504a856c65bdd9124c80499c008d98a960
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Sep 2 08:54:08 2020 -0400

    Bug 25541: (QA follow-up) Rename no_holds_checkin to holds_block_checkin
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4f66a8514e6fada3c54baa1f1ea16f52cfdbd6e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Aug 19 09:10:42 2020 -0400

    Bug 25541: Add new param to debian sip config
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5377bfc6240587b113f2b8ee26a8006f65e756a7
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 19 08:35:06 2020 -0400

    Bug 25541: Add ability to prevent checkin via SIP of items with holds
    
    Some libraries would like patrons to be unable to return items with
    holds via SIP. Instead, the screen message should indicate that the
    patron should return that item at the circ desk so a librarian can use
    it to fill the next hold right away and place it on the hold shelf.
    
    Test Plan:
    1) Apply this patch.
    2) Place a hold for an item.
    3) Enable the new SIP option no_holds_checkin for a SIP account.
    4) Restart the SIP server.
    5) Check in the item using the SIP CLI tool using the SIP account
       for which you set the new option.
    6) Note the checkin fails with a screen message indicating you should
       return the item to the circulation desk.
    
    Signed-off-by: Peter Lau <peter.lau@yccece.edu.hk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be92f7e79ce093e251c2489408dce3077f782c0d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jul 22 13:28:44 2020 +0100

    Bug 26041: Enable keyboard navigation without 'ctrl'
    
    This patch enables keyboard navigation using the arrow keys without the
    need to hold the control key for the jQuery UI datepicker.
    
    Test plan
    1/ Navigate to an item in the opac and attempt to place a hold
    2/ On the resultant screen, use keyboard navigation to trigger the 'Show
    more options' dropdown.
    3/ Focus on one of the date inputs using keyboard navigation.
    4/ Use 'ctrl + arrow' keys to navigate the datepicker.
    5/ Note that prior to the patch using 'bare' arrow keys does not trigger
    anything
    6/ Apply the patch and confirm that the datepicker can now be naviated
    using the arrow keys without holding the ctrl key.
    7/ Confirm that using the ctrl key combinations continue to work as
    expected too.
    8/ Signoff
    
    Signed-off-by: Brandon J <brandon.jimenez@inLibro.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89cc457ca25e0fbaccba28b249ceedeef6573abf
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Thu Aug 27 18:03:14 2020 +0000

    Bug 17801: Use issuedate for limits in Most Circulated Items
    
    To test:
    1 - Have two checkouts in old_issues
        issue 1: timestamp 2020-08-01 00:00:00, issuedate 2019-08-01 00:00:00
        issue 2: timestamp 2020-07-01 00:00:00, issuedate 2019-07-01 00:00:00
    2 - Perform a Most Circulated Items search for checkout dates 2020-06-01 to 2020-09-01. Both checkouts appear in search
    3 - Repeat search with checkout dates 2019-06-01 to 2019-09-01. Neither checkout appears in search
    4 - apply patch, restart all
    5 - Repeat search with checkout dates 2020-06-01 to 2020-09-01. Neither checkout appears in search
    6 - Repeat search with checkout dates 2019-06-01 to 2019-09-01. Both checkouts appears in search
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1733944b34499c145c2ae4c68c70efc87a5bec27
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 18 13:33:33 2020 +0000

    Bug 26236: Fix translating interface from DB term to readable term
    
    When viewing the logs we try to swith the db values like 'cron' to friendly terms like
    'Cron job'
    
    The values we use for building the selectors on the page ar eupper case, but DB values are lower case
    
    If we simply force upper case in the comparison we can ensure we always match correctly
    
    To test:
    1 - Enable some 'Logs' setting in System preferences
    2 - Perform some action in koha that will log
        Run a cronjob
        Change a syspref
        etc.
    3 - Browse to Tools-> Log viewer
    4 - Click 'Submit' to see all logs
    5 - Note the 'Interface' column contains lower case DB values
    6 - Apply patch
    7 - Reload the page
    8 - Values in interface are now Camel cased and more friendly
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 089b85758614260b70f43509ccdbc6285629a883
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Aug 21 16:23:38 2020 +0300

    Bug 26271: Add null to the list of accepted account_line data types
    
    The database schema for accountlines table allows the
    manager_id/user_id column to be NULL. If request to
    /api/v1/patrons/<patron_id>/account returns such an accountline where
    it is NULL we get 500 error as response. Adding NULL to allowed data
    types fixes this issue.
    
    To test:
     1) Run prove t/db_dependent/api/v1/patrons_accounts.t and notice it
        doesn't fail
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 898cd3b82ee84682bdfad1c177e2eb6ae0881428
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Aug 21 16:21:42 2020 +0300

    Bug 26271: Add failing test to reveal issue with patrons API endpoint
    
    When manager_id is null/undef the API returns error code 500.
    
    To test:
     1) Notice failure when running
        prove t/db_dependent/api/v1/patrons_accounts.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb73c5343c072bf7e2ff9cc00f840554ce848be8
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Sep 1 03:37:22 2020 +0000

    Bug 15851: (QA follow-up) Fix booleans to uppercase to make this work for Elasticsearch and UseControlNumber
    
    Same test plan as before, but with UseControlNumber = Use and
    Elasticsearch.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8da73fe4283198ac93e2f15695f44e0cea7c490f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 17 09:44:46 2020 -0300

    Bug 15851: (follow-up) Only display the analytics link when required (staff)
    
    This patch replicates the introduced behaviour, for the admin interface.
    To test, follow the test plan from the OPAC, but on the intranet.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0291c1e7e7a8d24d608830d31a6fdd9d2273f1a7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jun 24 14:50:37 2020 -0300

    Bug 15851: Only display the analytics link when required
    
    This patch makes opac-detail.pl query for analytics the same way it
    would do with the generated link (i.e. based on UseControlNumber) and
    passes a flag to the XSLT so it displays (or not) the 'Analytics' link.
    
    To test:
    1. Apply the first patch
    2. Have a known record without analytics
    3. Open the record in the OPAC
    => FAIL: It shows the 'Analytics' link
    4. Have a record known to have analytics and open in OPAC, on a separate
       tab
    => SUCCESS: It shows the 'Analytics' link
    5. Apply this patch and restart_all
    6. Reload the tabs
    => SUCCESS: It shows the link where it has to, and hides it where it
    shouldn't be displayed
    7. Sign off :-D
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f70df9b19479dc51ddaf76f29aaadafb7907a184
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jun 24 13:08:25 2020 -0300

    Bug 15851: Display analytics links for more cases
    
    The current XSLT displays the link to linked analytics only for serials.
    This patch makes it show for all the relevant position 7 on the leader
    values. I left out a and b as recommended by expert librarians on my
    team, but I can revert that if required.
    
    The current implementation adds a new CSS class for each case, so
    libraries willing to keep the current behaviour or just have more
    granular control on the cases they want the link to display, just can.
    
    This patch makes sense with the follow-up one, which will display the
    link only if there are really related records.
    
    To test:
    1. Open a non-serial record, notice there's no link to analytics
    2. Apply this patch and reload
    => SUCCESS: There's an 'Analytics' link
    3. Inspect the produced HTML
    => SUCCESS: A special class with analytic_* value has been added, and
    thus we now can control its display through CSS
    4. Sign off :-D
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a37842e1af3fdc9e5e4eb2eb6ec9190ed31915e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Sep 1 21:22:31 2020 +0200

    Bug 26313: (follow-up) Fix OPAC and "Show volumes" links
    
    Elasticsearch requires the booleans in search requests to
    be uppercase. This fixes the "Show analytics" link in
    OPAC (same as first patch for intranet) and the "Show volume"
    link.
    
    To test both patches:
    
    Set UseControlNumber = Use
    
    1) "Show analytics"
    - Turn SearchEngine to Elasticsearch and make sure it works
    - Pick any serial record in your database, make sure 001 is set
    - Go to new > new child record
    - Fill in 245 and save
    - For both staff and OPAC:
      - Click on the "In" link, it should bring you to the parent record
      - Click on "Show analytics", it should show your analytical record
    - Switch to "Zebra" - verify links still work.
    
    2) "Show volumes"
    - Turn SearchEngine to Elasticsearch again
    - Pick any serial record in your database, make sure 001 is set
    - Set LDR, pos. 19 = a - Set
    - Note 001 value
    - Find another record and edit it
    - Set LDR, pos. 19 = a or b, LDR 7 not a or b (m will work)
    - Set 773$ title of set record $w 001 of set record
    - For both staff and OPAC:
      - Click on the "In: link, it should bring up your set record
      - Click on the "Show volumes" link, it should bring up the volume
    
    - Switch to "Zebra" - verify all links still work.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fde7bf5495dedf681acb3193891de44eec4d2bfa
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 1 12:32:56 2020 +0000

    Bug 26313: "Show analytics" link must use uppercase for booleans
    
    In elasticsearch we only treat AND and OR as boolean operators if
    they are capitalized
    
    To test:
    - Turn SearchEngine to Elasticsearch and make sure it works
    - Pick any serial record in your database, make sure 001 is set
    - Go to new > new child record
    - Fill in 245 and save
    - Click on the "In" link, it should bring you to the parent record
    - Click on "Show analytics" => there will be no result
    - Apply patch
    - restart and reload
    - Try again
    - It works!
    - Switch SearchEngine syspref to 'Zebra'
    - Test again
    - It still works!
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c53dfb5562a12c1a8d8b9d3d0c28cb17d001edb5
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Sep 1 15:19:14 2020 +1000

    Bug 26331: Make svc/letters/preview executable
    
    Without this patch, you can't preview letters when running Koha in CGI mode.
    
    To test:
    1. Run Koha as CGI (and not Plack)
    2. Go to /cgi-bin/koha/tools/letter.pl?op=add_form&branchcode=&module=circulation&code=CHECKIN
    3. Try to preview the notice (using a valid barcode)
    4. Note in the browser console that svc/letters/preview is generating a 500 error
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b729886216560fdf50d88dc8214c0dbb58720b5c
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Sep 3 05:40:57 2020 +0000

    Bug 26362: Show correct libraries in overdues report
    
    Currently the overdues report does the following display:
    Patron library = home branch
    Home library = holding branch
    Holding library = patron branch
    
    This patch corrects the display of libraries in the overdues report.
    
    To test:
    
    0) Do not apply patch
    1) Go to http://localhost:8081/cgi-bin/koha/circ/circulation.pl?borrowernumber=51
    2) Go to http://localhost:8081/cgi-bin/koha/circ/set-library.pl
    3) Choose "Troy"
    4) http://localhost:8081/cgi-bin/koha/circ/circulation.pl?borrowernumber=51
    5) Checkout "39999000004571" with due date of "09/01/2019 23:59"
    
    Note the facts:
    Patron library = Centerville
    Home library = Fairview
    Holding library = Troy
    
    6) Go to http://localhost:8081/cgi-bin/koha/circ/overdue.pl
    7) Change "Columns" visibility to show Holding and Home libraries
    8) Note that the libraries are incorrect:
    
    Patron library appears to be: Fairview
    Home library appears to be: Troy
    Holding library appears to be: Centerville
    
    9) Apply the patch
    10) koha-plack --restart kohadev
    11) Go to http://localhost:8081/cgi-bin/koha/circ/overdue.pl
    12) Change "Columns" visibility to show Holding and Home libraries
    13) Note that the libraries are correct:
    
    Patron library appears to be: Centerville
    Home library appears to be: Fairview
    Holding library appears to be: Troy
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@outlook.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b87dc492fe4ea009ad3c72aca43add0515d6da1c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 27 15:03:17 2020 +0000

    Bug 26309: Make cxn_pool configurable
    
    In get_elasticsearch_params we set the conf to static if undefined,
    but we never defined it
    
    To test:
    1 - Apply unit test patch
    2 - prove -v t/Koha/SearchEngine/Elasticsearch.t
    3 - It fails
    4 - Apply this patch
    5 - It succeeds
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e421ed7a4e9bd3336b8e2b1eb9200c8c6342462
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 27 15:03:07 2020 +0000

    Bug 26309: Unit tests
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 017e19567af49a5e53f2d2fdf8713cbdd11666da
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 2 10:08:12 2020 +0100

    Bug 24663: (follow-up) Remove authnotrequired if set to 0
    
    2 newly added scripts
    
    Signed-off-by: Tomás Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5efc27ea53b0bb8e75a8bb876f064edfdade1b5b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 17 16:44:37 2020 +0100

    Bug 24663: Handle special cases for recovery password and selfreg
    
    The password recovery and self-registration features need to be
    accessible at the OPAC even if not public.
    
    Test plan:
    Self register a new account, then ask for a new password with OpacPublic
    turned off
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Tomás Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f40973f0f24fa6ac8c87cabc0754d8cd13dc40e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 17 13:31:38 2020 +0100

    Bug 24663: Force authentication in svc/records/preview (?)
    
    Was this wrong?
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Tomás Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37c5a88157375760f20546cfc8cbbc91e558d383
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 17 13:31:17 2020 +0100

    Bug 24663: Force auth in adveditorshortcuts.pl
    
    This was wrong!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 638786e719fb297ae976061b09a71f3d788416f4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 17 13:20:48 2020 +0100

    Bug 24663: Remove authnotrequired if set to 0
    
    It defaults to 0 in get_template_and_user
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b9475346e8c3d76923b1ef770af2db5d80ef438
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 17 13:16:48 2020 +0100

    Bug 24663: Test OpacPublic for all OPAC scripts
    
    Prior to this patchset there were 3 different calls to
    get_template_and_user (or checkauth) with the authnotrequired param:
     * authnotrequired => 0
     * authnotrequired => 1
     * authnotrequired => ( C4::Context->preference("OpacPublic") ? 1 : 0 )
    
    The first one says that an unauthenticated user can access the page, the
    second that the user has to be authenticated, and the last one that it
    depends on the OpacPublic syspref.
    Actually we must replace the first one with the third one, if the OPAC
    is not public, the authentication must be forced.
    
    To do so we are going to remove the "authnotrequired => 0" occurrences,
    and check the OpacPublic syspref's value in C4::Auth
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db55279886c7ecd13987780b6922d29e8916b267
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 5 13:48:59 2020 +0000

    Bug 25360: (follow-up) Remove the https FIXME in Auth.pm
    
    The FIXME is no longer valid since we fixed the X-Forwarded headers
    for Plack. And since we do not even use using_https anymore in
    the templates (see bug 21094).
    
    Test plan:
    Run Auth.t
    Git grep for using_https
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b42d57984bda809f2d8904781b9e7b70120ddf77
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon May 4 11:12:26 2020 +1000

    Bug 25360: Use secure flag for CGISESSID cookie when using HTTPS
    
    This patch adds the secure flag to the CGISESSID cookie when using HTTPS.
    This prevents the cookie being used again over a normal HTTP
    request.
    
    Bug 25360: [Follow-up] Test for "on" or "ON" value for HTTPS env var
    
    This patch tests for HTTPS "on" or "ON" before setting the secure
    cookie.
    
    Bug 25360: [Follow-up] Fix typo in C4/InstallAuth.pm
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] Amended number of tests in Context.t
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72f4765e6f6eb5076d4c05563ad28e05314e2ef4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 3 10:20:32 2020 +0200

    Bug 23634: Make is_superlibrarian return 1 or 0
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc97867dfc9a9553be700403746ec09864234366
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 13 12:25:13 2020 -0300

    Bug 23634: (QA follow-up) Our PUT is really a PATCH
    
    This patch makes the controller not expect that there will always be all
    the email fields. So it now checks if an email field was passed, and
    changed, and renders the error if that stands.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Tests written by Nick highlight a problem
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Problems solved
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a5cf89eb5d72679b693dea1928760e5dc27816a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jul 13 10:33:11 2020 +0000

    Bug 23634: (QA follow-up) Adjust tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8366baaad5feaae98979312029e13332001a46b7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 10 09:38:31 2020 +0100

    Bug 23634: (QA follow-up) Catch all email cases in API
    
    The API was only catching the primary email change case, but we need to
    catch email, emailpro and B_email.
    
    We were also not accounting for any of the emails (on PUT or from the
    DB) being undefined.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9524c1d76169e213403e36673fe9542c9dd4943a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Nov 19 16:59:06 2019 +0000

    Bug 23634: (follow-up) Prevent updates on POST
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aada130fe995c46bae8af26e223b307983c3e6b8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 19 13:16:16 2019 -0300

    Bug 23634: Secure the email on the API
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 087af360cca661ecb2522451eeb1bbf2b4d54296
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Nov 19 14:51:50 2019 +0000

    Bug 23634: Prevent non-superlibrarians from editing superlibarian emails
    
    This patchset prevents a non-superlibrarian user from editing a
    superlibrarians email address via memberentry.  This is to prevent a
    privilege escalation vulnerability whereby a user could update a
    superlibrarians contact details to match their own and then request a
    password reset via the OPAC.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 312cd6dfd2bfc9818c676ea2dc3658ad71cddb04
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 19 13:22:18 2019 -0300

    Bug 23634: Add tests for is_superlibrarian
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2056ab52bb6ad37b7bd1bf81a6e0dffbb8756537
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Nov 19 14:11:34 2019 +0000

    Bug 23634: Add is_superlibrarian method to Koha::Patron
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b845b9e8ab25001b0682920cea45662165f60f0
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 15 15:50:43 2020 +0000

    Bug 25101: (follow-up) Tick preview checkbox on by default
    
    This would prevent any unintended batch renewals as it is easy
    to miss the option in the screen.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c41597add3e5cd47109215f30bff889b9ae49176
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Apr 9 13:22:01 2020 -0400

    Bug 25101: Add ability to skip previewing results when batch extending due dates
    
    For sites with very large amounts of due dates to extend ( tens of thousands ), it can take a very long time of the results to load ( if at all ). It would be good to have a way to bypass the confirmation screen, instead directly updating the due dates before displaying the results.
    
    Test Plan:
    1) Apply this patch
    2) Browse to tools/batch_extend_due_dates.pl
    3) Note the new "Preview results" checkbox
    4) Submit form with the checkbox unchecked, due dates should be updated
       without previewing the checkouts
    5) Submit form with the checkbox checked, tool should function as
       it did previously
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 25101: (QA follow-up) Add hint to new option
    
    Adds a hint about the large numbers behind the new
    checkbox option.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 25101: (QA follow-up) Fix hint for new option
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c087b1e594fa6a8fa5309baea29a67159c7c229
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 2 15:05:26 2020 +0200

    Bug 21066: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1658744c6597d3ea8a02e4e9419f133aad830a2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 2 14:36:32 2020 +0200

    Bug 21066: Rename publicationdate with published_on
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bec601db345258bc35ee613943cbf98828ae3541
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 2 14:05:13 2020 +0200

    Bug 21066: DBRev 20.06.00.033
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62acc69c719049ddf36e39b1b29b1fa061b6ab54
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 31 08:21:34 2020 +0000

    Bug 21066: (QA follow-up) Check for field existence in db rev
    
    Test plan:
    Run the upgrade twice.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ec59f19302654244f18aa5942aef13acbf24fc9
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 26 21:14:50 2020 +0200

    Bug 21066: (QA follow-up) Fix publication date display in OPAC
    
    The date would no longer show, changed the variable name and
    removed the hours, as the field in the database is a date
    and not a datetime.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit abf63eb93b271a5957bc040c153ea10b9afa867e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Aug 4 11:33:44 2020 +0000

    Bug 21066: Update translated news and notices
    
    Replace timestamp by publicationdate in translations.
    Applies to sample notices and sample news.
    
    Test plan:
    Run a new install or pick a sql file and run it on cmdline.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 883d404a1a68031aef60e867434cf513dcc013d7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Aug 4 11:30:46 2020 +0000

    Bug 21066: Update English sample notices
    
    Applies to sample notices and sample news.
    Replace timestamp by publicationdate.
    
    Also adjust notice in TemplateToolkit.t.
    
    Test plan:
    Run dbrev and verify if ISSUESLIP refers to opac_news.publicationdate.
    Run t/db_dependent/Letters/TemplateToolkit.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a168e647bbb1da5a338fc4cda618adcde1ac7324
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 3 14:27:24 2020 +0000

    Bug 21066: Update NewsChannels.t
    
    Removing the weird '' => 1 from the hash too.
    NOTE: The following line in the module seems to be useless:
        $data->{$data->{'lang'}} = 1 if defined $data->{lang};
    
    Test plan:
    Run t/db_dependent/NewsChannels.t
    Run t/db_dependent/Koha/News.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ede8546e2b03199832637e7e79b3ab980edc47db
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 3 13:41:11 2020 +0000

    Bug 21066: Resolve SQL errors in strict mode
    
    DBD::mysql::st execute failed: Incorrect integer value: '' for column `koha_master`.`opac_news`.`number` at row 1 [for Statement "INSERT INTO opac_news ( content,number,lang,title,branchcode,borrowernumber,expirationdate,publicationdate ) VALUES ( ?,?,?,?,?,?,?,? )" with ParamValues: 0="test", 1="", 2="", 3="test", 4=undef, 5="51", 6='2020-08-11', 7='2020-08-04'] at /usr/share/koha/C4/NewsChannels.pm line 68.
    DBD::mysql::st execute failed: Incorrect integer value: 'a' for column `koha_master`.`opac_news`.`number` at row 1 [for Statement "UPDATE opac_news SET lang = ?,publicationdate = ?,expirationdate = ?,number = ?,content = ?,branchcode = ?,title = ? WHERE idnew = ?;" with ParamValues: 0="", 1='2020-08-03', 2=undef, 3="a", 4="test", 5=undef, 6="test", 7="9"] at /usr/share/koha/C4/NewsChannels.pm line 107.
    
    Test plan:
    Do not apply this patch.
    Enable strict mode in koha-conf.
    Add new record in tools/news leaving 'Appear in position' blank.
    The record is not added; you have a warn in your plack-error log.
    Apply patch and try again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75bb7b5b2e27060f1ca25313eac5a003df4f334b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jul 17 16:11:01 2018 +0200

    Bug 21066: Code changes needed for replacing opac_news.timestamp
    
    Test plan:
    Perform some CRUD operations on the news page in staff.
    Verify that news on opac and staff respect publicationdate.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9205bc1ec34e71995540d532d22ba4c63a593eaf
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jul 17 15:47:57 2018 +0200

    Bug 21066: Database revision
    
    Change timestamp to publicationdate, add updated_on as 'real' timestamp.
    
    Test plan:
    Run install or upgrade. Check table opac_news.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e10dc503289e8d7e8c742af0111acb79d4d53111
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 20 14:32:43 2020 +0200

    Bug 24147: Don't assume search_related will return ordered values
    
    This test is failing randomly because it assume the order is always the
    same. But it's not.
    
    Note: Koha::Objects->search_related is never used , last use removed from
      commit 9aa724cdf29a57bc91e42b240b5bcd19e3814ada
      Bug 19599: Speed anonymise_issue_history up
    We should keep it however IMO
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a0ccf7af26236db9a3e40968cf8f43bc308f142
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 27 15:10:08 2020 -0300

    Bug 25584: Fix minor styling issue
    
    This patch makes the button present some space between the icon and the
    text.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fc7427dd41ce10070a6a3d3070fb660850be511
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 27 14:57:45 2020 -0300

    Bug 25584: Refresh checkouts table when a return claim is added
    
    This patch triggers a checkouts table refresh when a return claim is
    added. I also noticed the same when a return claim is deleted so it is
    now also refreshed.
    
    To test:
    1. Set the ClaimReturnedLostValue to some valid value (2)
    2. Check something out for a patron, and choose to display all checkouts
    => SUCCES: There's the checkouts table, showing the checkout
    3. Click on the 'Claim returned' button and confirm
    => SUCCESS: There's no 'Claim returned' button anymore
    => ERROR: The checkout row doesn't display anything about the claim
    4. Go to the 'Claims' tab, delete resolve and delete the claim
    5. Go to the Checkouts tab
    => ERROR: It doesn't reflect the changes either
    6. Apply this patch and start over
    => SUCCESS: Once the claim returned is added, the checkouts table is
    refreshed and the information updated
    => SUCCESS: On the Claims tab, if you delete the claim and go to the
    Checkouts tab, you are presented the button again.
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce7f4d16d6acdc6a56d40e6ebd96d722f1c77387
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 14:26:26 2020 +0200

    Bug 26324: Fix spelling resizable vs resizeable in Dopop
    
    The correct spelling of the parameter is resizable
    https://developer.mozilla.org/fr/docs/Web/API/Window/open
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 024bb186e683f8da9b862ca70a65599325dd4737
Author: David Nind <david@davidnind.com>
Date:   Fri Aug 14 14:23:10 2020 +0200

    Bug 25630: (follow-up) Fix capitalization and terminology for system preferences
    
    Additional capitalization, punctuation, terminolgy and improvements to
    text for system preferences:
    
    - Punctuation (such as full stops at the end of sentences)
    - Capitalization
    - Terminology (staff interface, use of "Don't" instead of "Do not")
    - Rearranged/rephrased for better readability
    
    To test:
    - Verify that the changes listed are consistent and make sense.
    - Check that on the staff interface home page that the window title says
    "Koha staff interface".
    - Verify that in system preferences the name of the tab for Staff
    interface displays correctly, and that clicking on it brings up the
    staff interface preferences.
    - For Patrons > CollapseFieldsPatronAddForm check that the edit and add
    patron form works correctly (edit a patron, add a new patron, check that
    labels display correctly).
    
    Staff interface home page
    -------------------------
    
    - Change the page title in browser from "Koha staff client" to "Koha
    staff interface".
    
    Administration
    --------------
    
    Google OpenID Connect:
    . GoogleOpenIDConnectAutoRegister: change "Don't Allow" to "Don't allow"
    and change "users" to "patrons".
    . GoogleOpenIDConnectDefaultBranch: move the input field to the end of
    the sentence.
    . GoogleOpenIDConnectDefaultCategory: move the input field to the end of
    the sentence.
    . GoogleOpenIDConnectDomain: reword to "Restrict Google OpenID Connect
    to domain (or subdomain of this domain): ____. Leave blank for all
    Google domains.".
    
    Interface options:
    . SendAllEmailsTo: add a full stop.
    
    Share anonymous usage statistics:
    . UsageStatsLibrariesInfo: change "Do not share" to "Don't share"; add a
    full stop; for note "Don't share" should be "No".
    . most preferences: for note "Don't share" should be "No" (don't share)
    (for preferences UsageStatsCountry, UsageStatsGeolocation,
    UsageStatsLibrariesInfo, UsageStatsLibraryName, UsageStatsLibraryType,
    and UsageStatsLibraryUrl), various edits to make more readable and
    consistent.
    
    Authorities
    -----------
    
    General
    . AuthorityControlledIndicators: change "biblio field" to "bibliographic
    field".
    . AutoCreateAuthorities: change "do not generate" to "don't generate".
    
    Linker:
    . CatalogModuleRelink: change "Do not" to "Don't".
    . LinkerKeepStale: change "Do not" to "Don't".
    . LinkerModule: change "Default" to "default".
    . LinkerOptions: add a full stop.
    . LinkerRelink: change "Do not" to "Don't".
    
    Cataloguing
    -----------
    
    Display:
    . MergeReportFields: change "example:" to "Example:"
    
    Exporting:
    . BibtexExportAdditionalFields and RisExportAdditionalFields: change
    "Include following" to "Include the following"; add ":" at end of
    sentence, change "specificy" to "specify", and add full stops at end of
    complete sentences.
    
    Interface:
    . EnableAdvancedCatalogingEditor: format NOTE in bold.
    
    Record structure:
    . AlternateHoldingsField: change "(This" to "(this", change "; for
    instance" to ", for example", remove full stop.
    , MarcFieldForCreatorId: format NOTE in bold.
    . SubfieldsToAllowForRestrictedBatchmod: change "pref" to "system
    preference".
    
    Circulation
    -----------
    
    Batch checkout:
    . BatchCheckoutsValidCategories: add a full stop.
    
    Checkin policy:
    . CalculateFinesOnReturn: only bold "NOTE", not the whole sentence (x2).
    . StoreLastBorrower: change "opacreadinghistory/AnonymousPatron" to "the
    opacreadinghistory and AnonymousPatron".
    . UpdateItemLocationOnCheckin: change note "for these locations only can
    location and permanent_location differ," to "for these locations the
    location and permanent_location can differ,"
    . UpdateNotForLoanStatusOnCheckin: change "E.g.," to "For example,"
    
    Checkout policy:
    . AgeRestrictionMarker: change "E.g.," to ". For example,"
    . AllFinesNeedOverride: change "system preference noissuescharge" to
    "the noissuescharge system preference".
    . AllowFineOverride: add "the" before "noissuescharge".
    . AllowRenewalLimitOverride: change "with respect to" to "for".
    . AutoRemoveOverduesRestrictions: change "Do not" to "Don't".
    . DefaultLongOverdueChargeValue: change "user" to "patron".
    . ItemsDeniedRenewal: change . "e.g.," to "For example:", format the
    note the same as other notes with NOTE in bold.
    . OnSiteCheckoutsForce: change "on-site" to "on-site checkout", "(Even"
    to "(even", and "user" to "patron".
    . RentalFeesCheckoutConfirmation: change "do not ask" to "don't ask".
    . RestrictionBlockRenewing: change "If patron" to "If a patron", change
    "Allow" and "Block" to "allow" and "block".
    . UseTransportCostMatrix: "Transport" to "the transport".
    
    Interface:
    . AllowOfflineCirculation: change "Do not enable" to "Don't enable".
    . ExportRemoveFields: add a full stop.
    . ShowAllCheckins: change "Do not show" to "Don't show".
    . UpdateTotalIssuesOnCirc: change "Do not" to "Don't".
    
    Interlibrary loans:
    . CirculateILL: add a full stop.
    . ILLCheckAvailability: add a full stop.
    
    Self check-in module (sci-main.pl):
    . SelfCheckInModule: change "module. (available" to "module (available",
    add a full stop.
    
    Self check-out module (sco-main.pl):
    . AutoSelfCheckAllowed: change "automatically login" to "automatically
    log in".
    . WebBasedSelfCheck: change "system. (available" to "system (available",
    add a full stop.
    
    Enhanced content
    ----------------
    
    Novelist Select:
    . NovelistSelectStaffView: change "staff" to "staff interface".
    
    Babelthèque:
    . Babeltheque_url_js: rewitten
       . from "______ Defined the URL for the Babeltheque javascript file
    (eg. http://www.babeltheque.com/bw_XX.js)"
       . to "Use this URL for the Babelthèque javascript file: ________
    (e.g. http://www.babeltheque.com/bw_XX.js)."
    . Babeltheque_url_update: rewritten
       . from "______ Defined the URL for the Babeltheque update
    periodically (eq. http://www.babeltheque.com/.../file.csv.bz2)."
       . to "Use this URL for the Babelthèque periodic update: _______ (e.g.
    http://www.babeltheque.com/.../file.csv.bz2)."
    
    I18N/L10N
    ---------
    
    . dateformat and TimeFormat: Change "Note" to "NOTE" to be consistent
    with other notes, change <b> tag to <strong> as it is more semantically
    correct.
    
    Logs
    ----
    
    Debugging:
    . DumpTemplateVarsIntranet: change "variable" to "variables" and "staff
    intranet" to "staff interface".
    . DumpTemplateVarsOpac: change "variable" to "variables".
    
    Logging:
    . AuthFailureLog: add full stop.
    . AuthSuccessLog: add full stop.
    
    OPAC
    ----
    
    Appearance:
    . BiblioDefaultView: change "bib" to "bibliographic".
    . HighlightOwnItemsOnOPAC: change ". (Non-XSLT Only)" to " (non-XSLT
    only).".
    . OpacAdditionalStylesheet: change "specified" to "specific".
    . OPACDisplay856uAsImage: change all options in the drop down list so
    they start in lowercase.
    . OpacHighlightedWords: change ";" to a full stop, add a full stop at
    the end.
    . OPACHoldingsDefaultSortField: add a full stop.
    . OpacMaxItemsToDisplay: change "user" to "patron".
    . OPACMySummaryHTML: change "user" to "patron".
    . OpacSeparateHoldings: change "user's to "patron's".
    . OpacStarRatings: change "user" to "patron" for the drop down option.
    . OPACShowUnusedAuthorities: change "Do not show" to "Don't show".
    . OPACUserSummary: change "user's to "patron's", change "fines" to
    "charges".
    . OPACXSLT*: change "Leave" to "leave".
    . Remove empty row at bottom of appearance options.
    
    Features:
    . OpacBrowser: change "OPAC" to "the OPAC".
    . OpacBrowseSearch: reword as "[Enable/Disable] interface for browsing
    all holdings (Elasticsearch only)."
    . OpacCloud: change "OPAC" to "the OPAC".
    . OPACDetailQRCode: change "Don't enable" to "Disable".
    . OPACFinesTab: change "Fines" to "charges", change "the My Accouunt" to
    "their account". (Should now show as "..patrons to access the charges
    tab on their account page on the OPAC."
    . OpacHoldNotes: change "Do not allow" to "Don't allow", change "users"
    to "patrons".
    . OpacResetPassword: change "users" to "patrons", add full stop.
    . SocialNetworks: change "in opac" to "on the OPAC".
    
    Note: Also deleted lines with # in front of them for the OpacBrowser and
    OpacCloud system preferences in the Policy section - these look like
    duplicated entries to me (previously lines 600-611).
    
    Policy:
    . OPACFineNoRenewalsIncludeCredits: change "users" to "patrons".
    
    Self registration and modification:
    . PatronSelfRegistrationConfirmEmail: change "Do not require" to "Don't
    require", change "users" to "patrons".
    . PatronSelfRegistrationEmailMustBeUnique: change "Do not consider" to
    "Don't consider".
    . PatronSelfRegistrationPrefillForm: change "Do not display and prefill"
    to "Don't display and prefill".
    
    Patrons
    -------
    
    General:
    . AllowPatronToControlAutorenewal: add full stop.
    
    Notices and notifications:
    . EnhancedMessagingPreferences: change "Staff" to "staff".
    - FallbackToSMSIfNoEmail: change "Send" to "sending".
    
    Patron forms:
    . BorrowerUnwantedField: add full stop.
    . CollapseFieldsPatronAddForm:
      . Dropdown list changes:
         .. "Organization/Patron identity" => "Patron identity".
         .. "OPAC/Staff login" to "OPAC/Staff interface login".
      . Requires changes to the memberentrygen.tt - check that the add and
    edit form for a patron dispaly correctly:
         .. change "Contact" to "Contact information".
         .. change "Library set-up" to "Library setup".
         .. change "OPAC/Staff login" to "OPAC/Staff interface login".
    
    Patron relationships:
    . PrefillGuaranteeField: change drop down list option "Main address -
    street number" to "Main address - Street number" to match with format of
    other entries.
    
    Security:
    . RequireStrongPassword: change "More" to "more".
    
    Searching
    ---------
    
    Search form:
    . AdvancedSearchTypes: change "staff-side" to "staff interface".
    . expandedSearchOption: change "staff" to "staff interface".
    
    Serials
    -------
    
    . makePreviousSerialAvailable: change "Do not make" to Don't make";
    "syspref" to "system preference".
    . PreserveSerialNotes: change "Do not" to "Don't".
    . RoutingListNote: change "Include following" to "Include the following"
    
    Staff interface
    ---------------
    
    Tab label and link:
    . This tab was previously labelled "Staff client".
    . Change tab label on the left hand side from "Staff client" to "Staff
    interface".
    . Change URL when selected from "preferences.pl?tab=staff_client" to
    "preferences.pl?tab=staff_interface".
    . Check that the link works as expected.
    
    Appearance:
    . IntranetFavicon: change "Staff" to "staff".
    
    Tools
    -----
    
    Reports:
    . NumSavedReports: change "Saved reports page" to "saved reports page".
    
    Web services
    ------------
    
    IdRef:
    . IdRef: change "allows to request" to "allows requests for".
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17a2d577944e016d597ccc5198793e5b48917e69
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun May 31 19:10:37 2020 +0200

    Bug 25630: Fix capitalization and terminology for Accounting, Administration and Serials system preferences
    
    - Punctuation (p)
    - Terminology
    - Capitalization (c)
    
    To test:
    - Verify:
      - AccountAutoReconcile (Do not to Don't for consistency with other prefs)
      - IndependentBranchesPatronModifications (p)
      - IndependentBranchesTransfers (p)
      - GoogleOpenIDConnect (google to Google)
      - UsageStatsLibrariesInfo (c)
      - opacSerialDefaultTab (c)
      - StaffSerialIssueDisplayCount (staff interface)
      - SubscriptionDuplicateDroppedInput (c)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3033ae17c2c4c9f846a0c405a682469303c614f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 30 04:14:58 2020 +0000

    Bug 25630: Fix capitalization and terminology for Authorities and Cataloging system preferences
    
    - Punctuation (p)
    - Terminology
    - Capitalization (c)
    
    To test:
    - Verify:
      - AuthDisplayHierarchy (biblio to bibliographic)
      - MARCAuthorityControlField008 (p)
      - UNIMARCAuthorityField100 (p)
      - LinkerModule (c)
      - LinkerOptions (p)
      - SpineLabelShowPrintOnBibDetails (bib to bibliographic)
      - DefaultLanguageField008 (p)
      - DefaultCountryField008 (p)
      - SubfieldsToAllowForRestricted* (p, rephrase)
      - URLLinkText (added 'and items' - new with 20.05)
      - IntranetBiblioDefaultView (c)
      - MergeReportFields (rephrase)
      - BibtexExportAdditionalFields (marc to MARC)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60f215b3b8e13d6a41822a83968cf6a5d6f3ee06
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 30 03:31:51 2020 +0000

    Bug 25630: Fix capitalization and terminology for Circulation system preferences
    
    - (Ending) punctuation (p)
    - Terminology
    - Capitalization (c)
    
    To test:
    - Verify:
      - CircSidebar (c)
      - itemBarcodeInputFilter (from to form)
      - HoldsToPullStartDate (preference to system preference)
      - NoticeCSS (c)
      - UpdateTotalIssuesOnCirc (issues to checkouts)
      - ExportRemovefields (p)
      - AllowItemsOnHoldCheckoutSIP (c)
      - OnSiteCheckoutAutoCheck (onsite to on-site)
      - AllowOfflineCirculation (plugin to add-on)
      - AllowFineOverride (add 'system preference')
      - AutomaticItemReturn (returned to checked in)
      - UseTransportCostMatrix (branches to libraries)
      - AllowReturnToBranch (materials to items, return to checkin)
      - RenewalSendNotice (clarify 'messaging preference for 'Item checkout')
      - TransfersMaxDaysWarning (c)
      - noissuescharge (books to items)
      - *NoissuesCharge (add 'system preference')
      - ReturnBeforeExpiry (books to items)
      - NoticeBcc (p)
      - OverdueNoticeCalendar (c, p)
      - OverduesBlockCirc (p)
      - DefaultLongOverdueChargeValue (whitespace after :)
      - OPACFineNoRenewalsBlockAutoRenew (c)
      - RenewAccruingItemWhenPaid (p, c, syspref to system preference)
      - RenewAccruingItemInOpac (p, c, syspref to system preference)
      - HoldsSplitQueue (staff interface)
      - StaffSearchResultsDisplayBranch (staff interface, rephrase)
      - HidePersonalPatronDetailOnCirculation (rephrase)
      - StoreLastBorrower (add 'system preferences')
      - HoldsSplitQueue (& to and, staff interface)
      - HouseboundModule (p)
      - StockRotation (p)
      - ArticleRequests* (p)
      - ClaimReturnedLostValue (rephrase)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e6f889063f524555fb078927af40b1408a1616a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 30 02:52:56 2020 +0000

    Bug 25630: Fix capitalization and terminology for Logs and I18N system preferences
    
    - (Ending) punctuation (p)
    - Capitalization (p)
    - Terminology
    
    To test:
    - Verify:
      - alphabet (p)
      - TranslateNotics (c)
      - IllLog (p)
      - ReturnLog (returned to checked in)
      - DumpTemplateVars* (HTML)
    - read correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd4d7322962c155f3fd6653feed73cf2e405d3eb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 30 02:34:59 2020 +0000

    Bug 25630: Fix capitalization and terminology for OPAC system preferences
    
    - Ending punctuation (p)
    - Capitalization (c)
    - Terminology: library instead of branch, patron instead of borrower,
      system preferences instead of syspref
    
    To test:
    - Verify:
      - OPACUserSummary (p, rephrase: mainpage)
      - HighlightOwnItemsOnOPACWhich (library)
      - OPACXSLTListsDisplay (p)
      - OPACXSLTResultsDisplay (p)
      - OPACXSLTDetailsDisplay (p)
      - OpacNoItemTypeImages (p)
      - NotHighlightedWords (p)
      - opaclayoutstylesheet (CSS)
      - OPACReportProblem (c)
      - OpacBrowser (p)
      - OpacCloud (p)
      - SocialNetworks (p)
      - QuoteOfTheDay (c,p)
      - OpacNewsLibrarySelect (library)
      - OPACFineNoRenewalsIncludeCredits (p)
      - AllowPurchaseSuggestionBranchChoice (p)
      - OpacHiddenItemsExceptions (p, patron)
      - OpacAllowPublicListCreation (p)
      - OpacAllowSharingPrivateLists (p)
      - BlockExpiredPatronOpacActions (whitespace)
      - MaxOpenSuggestions (p)
      - AnonSuggestions (p)
      - OPACPrivacy (p, whitespace)
      - AnonymousPatron (c,p)
      - TrackClicks (p)
      - RestrictedPageLocalIPs (p)
      - RestrictedPageTitle (p)
      - OpacAdvSearchOptions (p)
      - OpacAdvSearchMoreOptions (p)
      - PayPal* (p)
      - OPACUserSummary (mainpage to OPAC start page)
    - read correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c30554759ccabaa01bb5f566b77dbc63fdda924
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 30 02:04:27 2020 +0000

    Bug 25630: Fix capitalization and terminology for Patrons system preferences
    
    - Consistent use of 'staff interface'
    - Ending punctuation
    - Rearranged/rephrased for better readability
    
    To test:
    - Verify:
      - patronimages
      - PatronsPerPage (rearranged)
      - PatronQuickAddFields (rearranged)
      - PrefillGuaranteeField (punctuation)
      - borrowerRelationship (punctuation)
      - GDPR_Policy
      - CollapseFieldsPatronAddForm
    - read correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10c2eb01c977eeef6c55dc1999c0af8b60055252
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun May 31 16:21:48 2020 +0200

    Bug 25630: Fix capitalization and terminology for Enhanced content and Web services system preferences
    
    - Fixes capitalization, including URL and OPAC
    - Consistent use of "staff interface"
    - Ending punctuation
    - Spelling: web service
    
    To test:
    - Verify:
      - Enhanced content page heading
      - Babeltheque_url_js
      - Babeltheque_url_update
      - FRBRizeEditions
      - BakerTaylorEnabled
      - NovelistSelectStaffProfile
      - NovelistSelectStaffEnabled
      - CustomCoverImages
      - LocalCoverImages
      - IntranetCoce
      - AutoShareWithMana
      - OAI-PMH:AutoUpdateSets
      - IdRef
    - read correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9475a7db68c6237d3328c1c978b2ae678bb907f1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun May 31 16:10:23 2020 +0200

    Bug 25630: Fix capitalization and terminology for Acquisitions and Tools system preferences
    
    - Adds some ending punctuation
    - Fixes capitalization
    - Consistent use of "staff interface"
    
    To test:
    - Verify:
      - NewsAuthorDisplay
      - EmailPurchaseSuggestions
      - UseACQFrameworkForBiblioRecords
      - AcqItemSetSubfieldsWhenReceived
      - AcqItemSetSubfieldsWhenReceiptIsCancelled
      - OrderPriceRounding
    - read correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db47dbe56a2e7930b08c4036afc441a18c74af45
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun May 31 15:58:42 2020 +0200

    Bug 25630: Fix capitalization and terminology fixes for Searching system preferences
    
    - Rephrases LoadSearchHistoryToTheFirstLoggedUser system preference
    - Consistently use "staff interface"
    - Add ending punctuation to some preferences
    
    To test:
    - Read through the Searching system preferences
    - Verify consistent use of staff interface
    - Verify LoadSearchHistoryToTheFirstLoggedUser description is
      improved
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b56ad54f49ec50ad5b0df8d7887982a34249b56d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun May 31 15:54:08 2020 +0200

    Bug 25630: Fix capitalization and terminology for Staff interface system preferences
    
    This changes "staff client" to "staff interface" and fixes capitalization
    in a couple of cases.
    
    For terminology changes see:
    https://wiki.koha-community.org/wiki/Terminology#S
    
    To test:
    - Read through the preferences of the "staff interface" tab.
    - Staff interface should be used consistently.
    - Firefox "PlugIn" was changed to "add-on" reflecting Mozilla's
      own terminology.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0adeab58feaa7fb0b5c97e55b8356bb916aa163
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 23 15:19:37 2020 +0000

    Bug 25448: Update German (de-DE) framework files
    
    The updated files have been auto-generated based on the
    po files and downloaded from
    https://translate.koha-community.org/files/
    
    To test:
    - Make sure German language is installed, see:
      https://wiki.koha-community.org/wiki/Installation_of_additional_languages_for_OPAC_and_INTRANET_staff_client
    - Run the web installer and choose de-DE
    - Select all sample files
    - Make sure they all install without any errors
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4009bb04ad857ef042bba9a4d690dd21d84ac3dd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 1 16:01:49 2020 +0200

    Revert "Bug 25242: Improve column wrapping and overflow for tables"
    
    This reverts commit a3a09d09e3b32c0a0f2e9b7acf652abeab694353.
    
    And also reverts the 3 other commits from bug 25242.
    
    Revert "Bug 25242: Compiled CSS"
    
    This reverts commit 198bbfa4094da1bfe143eb046d0c36bf68a93ab9.
    
    Revert "Bug 25242: (QA follow-up) Remove deprecated break-word"
    
    This reverts commit c3680149be734959d8b59223b083efdfb271580d.
    
    Revert "Bug 25242: (QA follow-up) Colwidth on results table"
    
    This reverts commit 84cbf0b9379d025d68f381e6dc7ca3772cc7d093.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76bd9322962ca42e612bf7a7015a3cd0f28922c2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 1 12:22:06 2020 +0200

    Bug 19889: Add new attribute to the REST API definition
    
    It fixes t/db_dependent/api/v1/items.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9be6b76a7bd702177bc0e1c32fd321e58f39efae
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 1 12:11:54 2020 +0200

    Bug 25504: Fix failing tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 092276f53c0b82c1311afe9425d13d83a528ca12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 14:05:05 2020 +0000

    Bug 19889: DBRev 20.06.00.032
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6e72c0de288ade8a2d69f101754d51db6162811
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 14:44:10 2020 +0200

    Bug 19889: Add select2 class to the new dropdown list
    
    This is needed since bug 25727.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2793e4558082e4ff50315b433d50490036014e28
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Aug 25 17:10:28 2020 -0300

    Bug 19889: (follow-up) Fix text in moredetail.tt
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0de40dd877defd4190c2ec45676c4f5261fc13f9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 20 10:36:23 2020 +0000

    Bug 19889: (QA follow-up) Check that exclude from local holds priority is set and not a blank string
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fee0b9310e5b58835c7bfabdcee75f956a381a81
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Aug 19 12:21:27 2020 +0000

    Bug 19889: (QA follow-up) use em over i and update field if unset
    
    em is better for accessibility
    
    We should set the field to 0 when it was previously unset
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1be2b8817c27c767f9f2ca2939f6b8f3013d7e2
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Aug 13 10:04:32 2020 -0300

    Bug 19889: (follow-up) Fix few minor things
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: remove unecessary indentation changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 785265aea0ffed9612bd53b25f36642ed03276a4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 7 11:17:59 2020 +0200

    Bug 19889: (follow-up) Add tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18d42db176d5fd29ddd07b4fc8b93a378087ffc5
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Aug 6 15:54:49 2020 -0300

    Bug 19889: (follow-up) Fix overlapping blue box and message in batch item modification
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb9c48a6f6ae52d8ba5ec4475758d0faf529ec80
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jul 22 11:21:39 2020 -0400

    Bug 19889: Add feedback when exclusion is updated on moredetail.pl
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcf9b259c5fcc1a52772efc82d4c8eec24fcf3c9
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Jun 10 16:18:01 2020 -0300

    Bug 19889: Make it possible to exclude items and categories from local holds priority
    
    This patch adds the ability to exclude patrons (by category) from local
    holds, and items, by editing the item itself or by batch item
    modification tool.
    
    To test:
    1. apply patches
    2. updatedatabase
    3. Enable LocalHoldsPriority preference, and leave
       LocalHoldsPriorityPatronControl in pickup library, and
    LocalHoldsPriorityItemControl in holding library.
    4. Search for a biblio with one item.
    5. Place a hold with a patron (patron1) and set pickup location to a different
       library of the item's home library
    6. Place another hold with another patron (patron2) and set pickup location to be
       the same as the item's home library
    7. ./misc/cronjobs/holds/build_holds_queue.pl
    8. Go to circulation -> holds queue
    9. Search by the item's home library
    CHECK => only the hold for patron2 (with the pickup location the same as the
    item's home library) appears in the table
    10. Go back to the biblio details page and click on "Items" tab
    CHECK => There is a new section in the item's details between "Statuses"
    and "History" called "Priority"
    11. Set exclude to "Yes" and update
    12. repeat steps 7 to 9
    SUCCESS => only the hold for patron1 now appears, even the other hold had local
    hold priority
    13. Repeat step 10 and 11 but this time set exclude to "No"
    14. repeat steps 7 to 9
    CHECK => the hold for patron2 is back
    15. Edit patron2's category and set exclude from local holds priority to
        "Yes"
    16. Repeat steps 7 to 9
    SUCCESS => the hold for patron1 is back
    17. Go to tools -> Batch item modification and in barcode list place
        several (existing) barcodes and press continue
    CHECK => There is a new section in the bottom called "Priority"
    18. Set exclude to "Yes" and save
    SUCCESS => all items in the list now have exclude setted to "Yes"
    19. Try to checkout the first item to a patron3
    SUCCESS => Alert message appears saying that patron1 has a hold on that
    item
    20. Click on Yes and then checkin that item
    SUCCESS => There is a modal window saying that a hold was found for
    patron1
    21. prove t/db_dependent/HoldsQueue.t t/db_dependent/Holds/LocalHoldsPriority.t
    22. Sign off
    
    Sponsored-by: Cooperative Information Network (CIN)
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93fdca520943874143c783f68025c7a9d2d0fca3
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Jun 10 16:15:55 2020 -0300

    Bug 19889: Add tests
    
    Sponsored-by: Cooperative Information Network (CIN)
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34a42570dcf52087b15aeb3605dbb27da9a18a82
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Jun 10 16:14:41 2020 -0300

    Bug 19889: set exclude_from_local_holds_priority columns as boolean in schema
    
    Sponsored-by: Cooperative Information Network (CIN)
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD Amended patch: fix md5sum
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05e5210194c87a2f5378ce314250b8f488391528
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Jun 10 16:13:35 2020 -0300

    Bug 19889: Add exclude_from_local_holds_priority columns to item, deleteditems and categories tables
    
    Sponsored-by: Cooperative Information Network (CIN)
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28d826263b16b6df7ff1bccc0e06211c2de7cfaf
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 19 13:56:08 2020 +0100

    Bug 26250: StockRotationItems.t and StockRotationStages.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c9dddeaa46bc605dd319db0538e3e6d2e151ff1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 19 14:03:29 2020 +0200

    Bug 26250: Fix tests when SearchEngine=Elastic
    
    Most of the time the tests are failing because the item is not created
    correctly (missing biblio and/or biblioitem).
    The usual error is:
     t/db_dependent/selenium/regressions.t ..... 5/5 Can't call method "leader" on an undefined value at /kohadevbox/koha/Koha/SearchEngine/Elasticsearch.pm line 534.
    
    In this patch we are making sure $builder->build({ source => 'Item' })
    is replace with $builder->build_sample_item
    
    Test plan:
    Turn on Elastic and confirm that all the tests pass!
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fd8774c687c6aaf6716485ab9bd72a69a0e2f76
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 16:07:46 2020 +0200

    Bug 26069: Pass correct URL to twitter
    
    We don't provide the url of the detail page so the twitter JS code
    retrieve the current location, with the search terms.
    
    Test plan:
    Do a search
    Click on a result
    Click on the twitter button and confirm that the link only contain
    biblionumber=x in the parameter
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit faa4b2aa62a02aca7f986cfc411402b1ce7ae076
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 27 11:35:16 2020 -0300

    Bug 25504: (QA follow-up) Remove unused include
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9ab4f0aac8ac3085257dd73d4fc842edbf459f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 27 15:26:05 2020 +0200

    Bug 25504: Use Koha::Logger and display the full stacktrace
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d01f5f6e8f1e643ada9801bceab6250e2f3a6aab
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Thu Jun 18 16:43:42 2020 +0300

    Bug 25504: Improve REST API spec loading errors
    
    Test plan:
    1. Introduce a typo in swagger.json or another spec json file.
    2. Restart plack if used or try to access the REST APIs
    3. Without the patch, verify that  an incomplete error message and potentially lots of stack trace are logged.
    4. With the patch, verify that much more meaningful error messages are logged and stack trace is omitted.
    5. Fix the problem introduced in step 1 and verify that no messages are logged, or only warning about bundle is logged with Debian Stretch.
    6. Repeat with a REST API plugin.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a87514b2e44d64807422b29f719b29b0c9d1ba4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 24 14:24:39 2020 +0000

    Bug 25273: (follow-up) Don't die on unknown authtype
    
    We are guessing authtype code and inserting the heading built accorindg to C4::Heading
    
    If we can't identify the auth type, we can format the heading. There is a record in the koha test
    data that is missing the heading field so type cannot be idenfitied
    
    This prevents us from dying n a record where we cannot identify the type.
    
    Note: This code will also be triggered for custom authority types, higlighting
    that they won't link because of hardcoded mappings in C4::Heading. We must tackle this
    on a new bug
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce161fda9b7d47e3cfcbc73ddb877eed627d6313
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 28 12:19:56 2020 +0000

    Bug 25273: Make match-heading rely on authority type configuration
    
    The match-heading field is a special field used only by the linker, not accessible
    to staff or patrons via the interface. This field is used to store the constructed
    'search form' used for matching bib headings to authority fields.
    
    In bug 24269 I attempted to use the mappings defined in the inferface and also inject the search term.
    This did not work as too many subfields were indexed on their own and leading to false matches.
    In this bug we remove the mappings for this field, and create it ourselves during
    the indexing process. The C4::Headings module is still used to generate the correct form,
    however, the mappings are set based on the authority types in the system. This gives the user
    the ability to add new typoes, but prevents mapping changes from breaking linker functionality
    
    To test:
     1 - Start form a sample database with ElasticSearch working
     2 - Download via Z39.50 2 authorities, one of which is a narrower heading of the other, e.g.:
        Waterworks
        Waterworks - Costs
     3 - Place a heading for the broader term in a record. e.g. Waterworks
           In 650$a, without the cataloguing authority plugin. We don't want
           the link created now.
           You need syspref BiblioAddsAuthorities => allow
     4 - Make sure linker is set to default
     5 - Attempt to link the records
           misc/link_bibs_to_authorities.pl
     6 - Linking fails
     7 - Apply patch
     8 - refresh index settings (if using a custom file, remove 'match-heading')
           You can reset mappings in the UI or run this:
           misc/search_tools/rebuild_elasticsearch.pl -v -d -r
     9 - Reindex ES
    10 - Try to link again
    11 - It succeeds!
    12 - Run the tests
         prove t/db_dependent/Koha/SearchEngine/Elasticsearch.t
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 25273: (follow-up)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c96fabb8c47320dba55372e4b955fb171310adec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 15:25:05 2020 +0200

    Bug 17661: Trivial simplification using += operator
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 224ac84aeca3b8dba87366925d83b01e0f5c1110
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 27 16:27:09 2020 +0000

    Bug 17661: (follow-up) Update regex to support Unicode characters
    
    Rather than limiting initials to [A-Z] we should test for a broad
    range of uppercase letters.
    
    The ES/Zebra changes are slightly different because of Perl vs Java regex
    conventions. POerl may support either, but I found 'Uppercase' to be a bit more explicit
    
    More info here:
    https://perldoc.perl.org/perlunicode.html
    
    TO test:
    Same plan as before but use Ж. as the ending initial
    Confirm the period is preserved and other punctuation removed
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e34f95a1f5eb0fce238ab442553bec5233263a9c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 2 16:52:53 2017 +0000

    Bug 17661: Ending punctuation causes duplicate facets
    
    The current code for facets doesn't pull strip ending punctuation from facets
    This causes duplicate facets for terms that should be combined
    
    Sometimes series can have different punctuation depending on the field they are in
    Author initials punctuation should be preserved
    
    To test:
    1 - Do search and pull up some records
    2 - Edit some of the records to have authors like:
        Date, C.J.
        Date, C.j.
        Date, C.J .
    3 - Edit the records to have some series statments like:
        830 $aDate, C.J. ;$v5
        830 $aDate, C.J. ; $v5
        830 $aDate, C.J.; $v5
    4 - Add some 490s to the record with first indicator 1 and series like:
        You wouldn't want to--
        You wouldn't want to
        You wouldn't want to..
    5 - Search again and note you have 3 facets each for author and series
    6 - Apply patch
    7 - Repeat
    8 - Now you get 2 facets for author, period not removed when following Upper case immediately, is otherwise
    9 - Now you should have a single series facet
    10 - Switch search engine to ES (index before applying patch)
    11 - Note facets are separate again
    12 - Reset mappings and reindex
       perl misc/search_tools/rebuild_elasticsearch -v -r
    13 - Repeat search, facets combined as above
    
    Signed-off-by: Sarah Cornell <sbcornell@cityofportsmouth.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4e922ffe8a5ea760f2401aca44b1dd9be97c7ec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 25 19:30:00 2020 +0000

    Bug 26289: Add missing variable definition to templates
    
    This patch puts definition of the missing "searchid" variable into an
    include file to be used by various bibliographic detail pages. The
    variable is required by several JavaScript functions.
    
    To test, apply the patch and locate or create a record with no items.
    Open the labeled MARC view and choose Edit -> Delete record. Confirm the
    deletion. The deletion should complete correctly.
    
    Perform the same test with the detail view, ISBD view,  MARC view, and
    items view.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ea7907618a144d03d9e337f79d3dbc26603a919
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Aug 25 12:45:58 2020 +0000

    Bug 26281: (QA follow-up) Fix missing filter
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c161c145b7fa2dc2ccf62124cffe1da26b6339e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Aug 24 09:22:24 2020 -0400

    Bug 26281: Add cancellation reason to holds history
    
    Bug 25534 adds the ability to store the cancellation reason when a hold
    is cancelled and communicate it to the user. It would be great if the
    cancellation reason could also be shown on the holds history.
    
    Test Plan:
    1) Apply this patch
    2) Cancel a hold with a reason
    4) Browse to holds history for the holds' patron
    5) Note the reason shows in the status column if one was provided
    
    Working ok.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40393adc0fd80bc5dc129931efce390dea4b42a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 26 12:58:44 2020 +0200

    Bug 26015: Replace 2 missing occurrences
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed066caf580630c476fe4918a00e5d88e8784441
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Aug 14 17:09:58 2020 +0000

    Bug 26015: Terminology: Fix tons more staff clients to staff interfaces
    
    This takes care of more occurences of staff client and changes it to
    staff interface, including in code comments.
    
    To test:
    - I think in this case careful code review is what we look for.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d39d5b20d6dfe22b3a5ed80eb4e2c717ddcc7f5a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jul 18 01:17:45 2020 +0200

    Bug 26015: Terminology: Use staff interface instead of staff client
    
    We have agreed to use 'staff interface' instead of 'staff client'
    and similar terms. This fixes the template files where staff client
    appears:
    
    To test:
    - Check Administration > Patron categories
    - Check the title of the staff interface start page in your
      browser tab
    - Check the description of hte catalogue permission
    - One more: this changes the message shown when someone managed
      to log in as the database user - as we no longer allow that, I am
      not sure if it can be triggered.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf93255428125241745faaaec0a0b1f8455c7526
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 29 10:56:37 2020 +0000

    Bug 25639: Add search query strings as global javascript variables
    
    To test:
    1 - Search on OPAC for "qwertyuiop"
    2 - View the HTML source
    3 - Find 'qwertyuiop' in the source, it is not easily accessible via JS
    4 - Apply patch
    5 - Repeat
    6 - Note that now there are global variables with the query strings
    7 - Add to OpacUserJs:
        console.log( query_desc );
        console.log( querystring );
        console.log( query_cgi );
    8 - Reload page and confirm variables are warned in the JS console (Press F12)
    9 - Sign off
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c92eda71933421ceac596bda7c1601314c72841
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 14:05:05 2020 +0000

    Bug 22789: DBRev 20.06.00.031
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 671f2b86a9aa5861cd0f7d605afc15118695866f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 26 22:36:09 2020 +0200

    Bug 22789: (QA follow-up) Some minor formatting changes
    
    - Remove the unordered list added to the holds list Details column
    - Switch div to span to have the hint appear behind the checkbox
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b43c886a0ce030e50c894f941665b7c92d50f00
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Aug 25 14:53:55 2020 -0300

    Bug 22789: (follow-up) Fix atomic update, GUI and more than one hold
    
    This patch
    * sets one check for reserves and another for old_reserves in
    atomic update
    * Adds a message below the checkbox and adds detail when a hold is non
      priority
    * Fixes issue when there are more than one hold, but the first is non
      priority
    * Adds test case for this last scenario
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d390b2f7cfe947011a80c9441ca0a8a00e2f38f0
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Aug 19 18:12:32 2020 -0300

    Bug 22789: Add non priority feature to C4 classes and staff interface
    
    This patch implements necesary code to implement non priority feature
    
    To test:
    1) Apply all patches.
    2) Run updatedatabase.
    3) Checkout a specific item for patron1.
    4) Place a hold on the same item for patron2 (do not check non priority
       hold checkbox).
    5) Try to renew the item for patron1.
    CHECK => in checkouts table, there is a message that the item could not
    be renewed because there was a hold.
    6) Cleanup all checkouts and holds.
    7) repeat steps 3 to 5, but this time check the non priority checkbox.
    SUCCESS => item was renewed
    8) prove t/db_dependent/Holds.t
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64340cfa520b0d5ff9289afb628e3b7e7c31df3d
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Aug 19 17:57:55 2020 -0300

    Bug 22789: Set non_priority column as boolean in schema
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c143ca4609837932643e6d1564896fe8c6ab229
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Aug 19 16:11:01 2020 -0300

    Bug 22789: Add non_priority column to reserves and old_reserves
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee50e8678400696d69f87e8117487efb29256e3b
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed Aug 19 15:50:22 2020 -0300

    Bug 22789: Add tests
    
    Signed-off-by: Lisette Scheer <lisettes@latahlibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7910c67403f73ffc247c466d2336a446c4ca092
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 14:05:05 2020 +0000

    Bug 20057: DBRev 20.06.00.030
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cb1d95b02dcd6f9a38f3cbfd3f2effa14a96f3c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 23 06:23:37 2020 +0000

    Bug 20057: Fix capitalization and rephrase system preference as a sentence
    
    This makes changes to strings involved in this feature:
    - Rephrases the system preference description into a sentence
    - Rephrases message shown in OPAC on submitting (library has not actively
      approved, so just say that the record has been modified)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33265c07f49cfaa07a086d45cae4e5d385994f01
Author: Liz Rea <liz@catalyst.net.nz>
Date:   Tue May 19 12:50:04 2020 +0200

    Bug 20057: (follow-up) Add text for auto accepted changes
    
    1. Apply patch.
    2. Make sure syspref "AutoApprovePatronProfileSettings" is set to "Disable".
    3. Edit patron personal details via opac interface.
    4. Expect modifications to require manual approval by staff via link on main page.
    -> 4a. Text for patron says that changes are pending acceptance by the library
    5. Set syspref "AutoApprovePatronProfileSettings" to "Enable".
    6. Edit patron personal details via opac interface again.
    7. Expect modifications to have been approved automatically.
    -> 7a. Text for patron says that changes have been submitted and accepted by the library.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b12198a53feff9aad0f08160505477b50d0421b0
Author: David Gustafsson <glasklas@gmail.com>
Date:   Tue May 19 12:44:31 2020 +0200

    Bug 20057: System preference for auto approval of patron profile changes
    
    Testplan for this patch:
    
    1. Apply patch.
    2. Make sure syspref "AutoApprovePatronProfileSettings" is set to "Disable".
    3. Edit patron personal details via opac interface.
    4. Expect modifications to require manual approval by staff via link on main page.
    5. Set syspref "AutoApprovePatronProfileSettings" to "Enable".
    6. Edit patron personal details via OPAC interface again.
    7. Expect modifications to have been approved automatically.
    
    Signed-off-by: Liz Rea <liz@catalyst.net.nz>
    This works, we may want some different text for this situation in the OPAC, it still says the librarian has to approve the change.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f1665151f719eaab9c9546facaaaad7882de297
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 31 14:37:27 2020 +0200

    Bug 25727: (follow-up) Do not open options on clear
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef3b7eedc0efc726329f2f608c0f676e93fd5566
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun May 24 01:27:49 2020 +0200

    Bug 25129: Update German (de-DE) web installer sample files for 20.05
    
    This translates the new notices and CSV profie for late orders,
    makes some minor changes to the patron category descriptions
    and numbering patterin labelling.
    
    To test:
    - Make sure German language is installed, see:
      https://wiki.koha-community.org/wiki/Installation_of_additional_languages_for_OPAC_and_INTRANET_staff_client
    - Run the web installer and choose de-DE
    - Select all sample files
    - Make sure they all install without any errors
    
    Bonus:
    - If you can speak German, you can check the translations as well :)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e97dbca2983163e1ffc19fc435ac8bea6550c82
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Jul 17 22:03:28 2020 +0000

    Bug 26013: Fix formatting for dates on "Manage stage MARC records" page
    
    The "staged" dates were not formatted according to system
    preferences DateFormat and TimeFormat as the appropriate TT
    filters were missing.
    
    To test:
    - Stage a record in MARC format
    - Go to Staged MARC management
    - Check the date in the list of imports
    - Click on the import and check the "Staged:" date
    - Apply patch
    - Repeat and verify formatting is now correct
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d51b74ff22384fb302ba2796b08465defa59aff
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Jul 17 23:07:07 2020 +0000

    Bug 26014: Add publication year and edition to Z39.50 results in acquisition
    
    The publication year and edition columns were present in
    the Z39.50 results in cataloguing, but were missing in
    acquisitions.
    
    To test:
    - Go to acquisitions
    - Create a new basket
    - Create an order within it from 'external source'
    - Search for a title, for example with LOC
    - In a separate tab, go to cataloguing
    - Search the same record with Z39.50
    - Compare result lists, date and edition are missing from acq
    - Apply the patch
    - Repeat search in acquisitions
    - Verify result lists now match up
    - Bonus: Date was changed to Year which is more fitting and
      will translate better.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d9ab04a9391a4960a6155d983fdf839467bfdf4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Aug 7 10:58:51 2020 +0200

    Bug 26175: Remove warn if undefined barcode in misc/export_records.pl
    
    When using misc/export_records.pl --deleted_barcodes if barcode is NULL you get warn :
    Use of uninitialized value in say at /home/koha/src/misc/export_records.pl
    
    Also exporting barcode if empty string makes no sense.
    
    Test plan :
    1) Delete an item with barcode = NULL
    2) Run : misc/export_records.pl --date=`date +%d/%m/%Y` --deleted_barcodes --filename=/tmp/deleted_barcodes
    3) Check you se no warn "Use of uninitialized value in say ..."
    4) Delete an item with barcode = ''
    5) Run 2)
    6) Check there is no empty line in /tmp/deleted_barcodes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e4eb6cbd19342cb1b64c00175d646b29558fe71
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 25 12:00:28 2020 -0300

    Bug 23653: Add license information in about.pl
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    JD Amended patch
                <p>The included <a href="https://github.com/OAI/OpenAPI-Specification/blob/master/schemas/v2.0/schema.json">api/swagger-v2-schema.json</a> file is licensed under the[-the-] <a href="https://github.com/OAI/OpenAPI-Specification/tree/master/schemas/v2.0">Apache License, Version 2.0</a>, by the <a href="https://www.openapis.org/about">OpenAPI Initiative [-(OAI)</a></p>-]{+(OAI)</a>.</p>+}
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58a30f1b44c700f461a9f5028dfab2d7f7048375
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 10:59:46 2020 +0200

    Bug 23653: Remove uneeded cond test
    
    rel_file returns the path anyway
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0a4bad3fccb67b9459b0e245d4f9647c2b3b428
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Jul 1 02:26:01 2020 +0000

    Bug 23653: use local copy of swagger v2 schema
    
    By default, JSON::Validator::OpenAPI tries to fetch the
    swagger v2 schema from http://swagger.io/v2/schema.json.
    
    If you've installed from CPAN, JSON::Validator::OpenAPI will
    come with a cached copy, so it won't try to fetch it over HTTP.
    
    However, if you've installed from libjson-validator-perl
    from Debian/Ubuntu, the Debian package excludes the cached copy,
    so JSON::Validator::OpenAPI tries to fetch it over HTTP.
    
    Unfortunately, today and other days in the past, the file at
    http://swagger.io/v2/schema.json has been unavailable, and this causes
    Koha to crash in a perpetual loop.
    
    This patch includes a copy of the swagger v2 schema, and it loads
    it locally rather than fetching over HTTP.
    
    The changes to Koha/REST/Plugin/PluginRoutes.pm are not required,
    since the validator isn't currently called there, but I've added
    a patch to future proof it.
    
    To Test:
    0a) Remove /usr/share/perl5/JSON/Validator/cache/36d1bd12eeed51e86c8695bd8876a9df
    if it exists
    0b) Block external access to http://swagger.io/v2/schema.json or
    test during an outage when it's unavailable
    0c) Do not apply patch
    1) koha-plack --restart kohadev
    2) Note that it crashes in a loop and is unavailable in web browser
    3) Apply patch
    4) koha-plack --restart kohadev
    5) Note that Koha comes up and there are no errors in the Plack logs
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88f64019536887c094b0178007d3583a048917f2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 25 15:14:27 2020 +0200

    Bug 26265: add a plan for tests
    
    Tests were run but no plan was declared and done_testing() was not seen.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 352bc794d4bda2d39bdc0c9718f9cf3b31c5b070
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 25 15:09:57 2020 +0200

    Bug 25534: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d64db87d7764855dcb1227eeed46002a02220fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 25 09:57:27 2020 +0000

    Bug 25534: DBRev 20.06.00.029
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d19dccbb22b64690a7212708ef9e122276c6049
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Aug 24 10:52:28 2020 -0400

    Bug 25534: (QA follow-up) Use modal for cancel links, hide reason unless priority is set to 'del'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94df210c415dfac39cb778b6b400449461e04b41
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Aug 24 09:13:00 2020 -0400

    Bug 25534: (QA follow-up) Update Koha::Hold::cancel POD
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d574597473180006cf7e71679bd2f827245e2de2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 24 11:31:20 2020 +0200

    Bug 25534: Use build_sample_item in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a7e3a264e0b3d73cbec51e34bbd9d7b8354c315
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Aug 21 07:24:03 2020 -0400

    Bug 25534: (QA follow-up) Add sample notices for translators
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab1d71c53daafb7bd35f84101cdad5402872e0ac
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Aug 21 06:58:04 2020 -0400

    Bug 25534: (QA follow-up) Add default values for new AV category
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 25534: (QA follow-up) Removed doubled insert statements in de-DE/optional/auth_val.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57bbb2861f0c0e2c8eca67d40ec07f46b5a476c8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 20 12:35:27 2020 -0400

    Bug 25534: (QA follow-up) Add AV category
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 563328d3cc37eb64d0eae9c268aa8312f7680e3d
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 20 12:30:21 2020 -0400

    Bug 25534: (QA follow-up) Add label to reason pulldown
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6042768ac87794b58b858dab5b52c3252b70cdf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 20 12:26:46 2020 -0400

    Bug 25534: (QA follow-up) Add sample notice
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8afa136aee4a07a99d5ef0b46472391c0589f82a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 20 12:26:14 2020 -0400

    Bug 25534: (QA follow-up) Unit tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61e00246803821dc2680ff740d7702fbef17bb60
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 20 08:16:12 2020 -0400

    Bug 25534: (QA follow-up) Add missing TT filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b3f22710a45ccfcde8668494e2073ec8d51cdd8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 19 13:43:24 2020 -0400

    Bug 25534: Add reason to pendingreserves.pl
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 25534: (QA follow-up) Fix typo
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 25534: (QA follow-up) Add colon to label on pendingreserves.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27c80187ba55e801787a591d0d867921617d8339
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 19 13:25:00 2020 -0400

    Bug 25534: Use the cancelation reasion for the 'X' hold cancelation links
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af0d71b7479432aeaf65dd61225b0d20c84cd360
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon May 18 13:32:45 2020 -0400

    Bug 25534: Add ability to send an email specifying a reason when canceling a hold
    
    Some libraries would like to be able to cancel a hold with the option to
    specify a reason. Providing a reason would generate an email to that
    patron.
    
    Test Plan:
    1) Apply this patch
    2) Run updatedatabase.pl
    3) Restart all the things!
    4) Create new AV category "HOLD_CANCELLATION", add some cancelation reasons
    5) Add new Holds module notice "HOLD_CANCELLATION", add an email version.
       A quick test version would be "Reason: <<reserves.cancellation_reason>>"
    --
    [% USE AuthorisedValues %]
    Reason: [% AuthorisedValues.GetByCode( 'CANCELLATION_REASON', hold.cancellation_reason, 'IS_OPAC' ) %]
    
    [% IF hold.cancellation_reason == "MY_AV_VALUE" %]
    IF perhaps you'd like to have a much longer explanation than just the
    one sentence in the AV description, you can use IF blocks using Template
    Toolkit markup!
    [% END %]
    --
    6) Place a hold for a patron
    7) On request.pl, select the 'del' option for the hold
    8) Select a cancellation reason and choose "Update hold(s)"
    9) Note a new message has been queue for the patron with the cancelation reason
    11) Test again from circulation.pl
    12) Test again from moremember.pl
    10) Cancel a hold with no reason, note no email is generated
    11) Delete your authorised values, not the feature is disabled
    12) Reinstate the authorised values, but delete the notice,
        you should now be able to cancel a hold with a reason,
        but no email will be generated
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f840342c0a5eb39dfe7aa045a85fa55cb660a213
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon May 18 13:32:21 2020 -0400

    Bug 25534: Update database
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit deee485a24df0734cace673dc519f15d41a5b575
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 23 10:35:54 2020 -0300

    Bug 25662: (follow-up) Add tests for the wrong patron_id added behaviour
    
    This patch adds trivial tests for the new error (400) raised when the
    passed patron_id doesn't exist.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => SUCCESS: Tests pass!
    2. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69bdc94cd4f420094c5706fb2bfc472ba24a5054
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 23 10:33:14 2020 -0300

    Bug 25662: Make the route for holds restpect maxreserves
    
    This patch fixes the behaviour for the POST /holds route. It assumed
    maxreserves was checked in CanItemBeReserved which is not the case.
    
    Tests are added to check for this behaviour.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => FAIL: Tests fail!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a63cf6dec55c67491e5a2807fe74f9083167ccc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 23 10:11:58 2020 -0300

    Bug 25662: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 385a4cba44c5ac56d334d5ac4f8acd69d17375e9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 25 09:57:27 2020 +0000

    Bug 25958: DBRev 20.06.00.028
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66382458dc46356818473935e8d5546f13f05645
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Aug 24 13:13:17 2020 -0400

    Bug 25958: (QA follow-up) Implement filter in database query instead of in loop
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d99651efd0a9a827b91f4575ab6f1d4344c7cfb0
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 22 02:41:20 2020 +0000

    Bug 25958: (QA follow-up) Add some punctuation to new DefaultLongOverdueSkipLostStatuses
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48edb2947163c1e9a70b11de40a71ebed747952f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jul 28 07:55:18 2020 -0400

    Bug 25958: Allow LongOverdue cron to exclude specified lost values
    
    When lost items are not marked as returned, they are still subject to
    the long overdue cron, so an item that has already been marked Lost may
    automatically roll to Long Overdue. In some cases, a library may not
    want that lost value to change. This becomes especially important with
    the introduction of Claims Returned, which uses a variety of lost.
    
    Test Plan:
    1) Set up a long overdue item that would be moved to lost by longoverdue.pl
    2) Run the cronjob with the new --skip-lost-value option
    3) Note the item is not altered
    4) Include that value in the new system preference DefaultLongOverdueSkipLostStatuses
    5) Run the cronjob *without* the new option
    6) Note the item is not altered
    7) Run the cronjob again with the new command line option, but set it to
    a different value so the item will be affected
    8) Note the item is altered as it would have been before this patch was
    applied
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 992edc43b0c956c5f61259abfa36f0a256ad40d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 25 11:38:32 2020 +0200

    Bug 23166: Early return if no set
    
    It prevents valid_template check to raise
    Can't call method "filter_by_current" without a package or object reference at /kohadevbox/koha/Koha/Template/Plugin/Context.pm line 49.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit add2f752b9717c07cc950d315fe093dc3c6e9536
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 7 12:01:10 2020 +0200

    Bug 26139: Centralize code for "Place hold" button (detail)
    
    There is a "norequest" boolean passed to the include cat-toolbar.inc, to
    display or not the "Pace hold" button.
    This flag was not calculated in some place (ISBDdetail and moredetail
    for instance)
    
    Here we centralize the code to make it more robust and less regression
    prone.
    
    Note that the same problem appears at the OPAC (opac-MARCdetail is
    always display the button). That will have to be fixed separately
    
    Test plan:
    Create biblio A with 0 item, B and C with 1 item and D with 2 items
    item for B is not for loan, C is for loan and D has 1 of each
    Go to the bibliographic detail page of each record and confirm that the
    "Place hold" button appears appropriately.
    Test the different tabs of the catalogue module
    
    QA note: This patch is only centralizing the existing code, but it is
    still too naive. To manage the visibility of this button we certainly
    want to copy what is done in C4::Search::searchResults:
      # can place a hold on a item if
      # not lost nor withdrawn
      # not damaged unless AllowHoldsOnDamagedItems is true
      # item is either for loan or on order (notforloan < 0)
      $can_place_holds = 1
        if (
             !$item->{itemlost}
          && !$item->{withdrawn}
          && ( !$item->{damaged} || C4::Context->preference('AllowHoldsOnDamagedItems') )
          && ( !$item->{notforloan} || $item->{notforloan} < 0 )
        );
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dd22f27bb7ddcc6eac729cdd938fef0a2df42e6
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Aug 24 18:34:10 2020 +0300

    Bug 23166: (QA follow-up) Add POD text
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50f3d267c15d1c0ea18fad092d61c157689d7403
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 5 15:51:25 2020 +0200

    Bug 23166: Call the methods from the .inc
    
    We do not longer need the order variables to be passed from the
    controllers, we can call the methods on the biblio object instead.
    
    There is something wrong with our ->search method and TT behaviours, it
    is hard to retrieve object list in a scalar context.
    If [% objects.method.count %] is called, objects.method will get the
    first object of the list and count will explode (Koha::Object->count
    does not exist)
    
    We need to force the call in a scalar context to retrieve an iterator
    and prevent to fetch all the objects (we could have called all then
    size, but it's not efficient)
    
    If adopted I will move the plugin on a separate bug report to ease
    backport
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3bab9f414819f31f37f1f12943126a7e8abd030
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 5 15:50:17 2020 +0200

    Bug 23166: Add filter_by_current and _cancelled Koha::Acq::Orders methods
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbd727869f54897d923c6278b8e841c623029fae
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 5 15:27:28 2020 +0200

    Bug 23166: Remove filtering from controllers
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f563c5a8e9eccad9514d758660090fef97f34805
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 19 21:35:20 2019 -0500

    Bug 23166: Replace the count of orders with Koha::Acq::Orders
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03bcf662730d46b1003b6222b61892142c6f310f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 19 21:11:20 2019 -0500

    Bug 23166: Remove baskets_deletedorders code
    
    This is never used.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d073755a6688aec796922c747ccb3e930ee9546c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 19 21:10:15 2019 -0500

    Bug 23166: Remove baskets_orders code
    
    This is never used.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adbf2b7ba94b8f455cfb70ecbc1d4775b1cd964c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 24 12:26:04 2020 +0000

    Bug 25033: (follow-up) Don't limit suggestions to branches if displaying by branch
    
    In the case of organizing by branches we should not filter by branch
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 258f461cfe7021e7423ad3889c8d41a503f8e4a9
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 22 13:24:06 2020 +0000

    Bug 25033: Fix number of tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 182db38e22ebd366a9f05734ea3751ca15fd71dd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Aug 5 11:50:39 2020 +0000

    Bug 25033: (follow-up) Don't delete branchcode key from suggestion_ref
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d01e9da98bb3a166ebf102d95dfcc1b1e4c1609
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 15 12:25:05 2020 +0000

    Bug 25033: (follow-up) Deal with 'Any' branch and don't show dropdown if organized by library
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b893504ec9faefdb48073c52b633251764b3602d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 5 12:33:37 2020 +0200

    Bug 25033: Improve JS code a bit
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c31989bb1f4758f0231a214f9961c82de50e5bc3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 1 13:39:13 2020 +0000

    Bug 25033: Move branchfilter to top of page
    
    There is confusion becase it is not obvious when the suggestions page is being limited to a branch
    
    Moving the branch filter to the top of the page makes it easier to see
    
    To test:
    1 - Apply patch
    2 - From mainpage or acqui-home note the link to suggestions takes you to suggestions limited to current branch
    3 - Change the dropdown
    4 - Note the page refreshes and loads the correct suggestions
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cae9035cf7f056dc91c89af0af6689a25339b8e2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 1 12:46:17 2020 +0000

    Bug 25033: Remove CountSuggestion
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b73bf7374ceed33d217498042c240a35097f37f1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 1 12:38:02 2020 +0000

    Bug 25033: Display both local and all pending suggestions counts if the numbers differ
    
    To test:
     0 - Be in staff client as a superlibrarian
     1 - Place some suggestions
      1 for any branch
      1 for signed in branch
      1 for another branch
     2 - Go to Koha main page, 3 suggestions pending
     3 - Click 'Suggestions pending approval' - you see one suggestion
     4 - Click on 'Acquisitions' in breadcrumbs , 3 suggestions pending
     5 - Click manage suggestions - you see one suggestion
     6 - Apply patch
     7 - On mainpage and acqui-home you now see "Centerville: 1 / All libraries: 3" suggestions
     8 - Confirm that the links take you to suggestions view of your branch or all libraries respectively
     9 - Turn on IndependentBranches
    10 - Create a user with acquisition and suggestions permissions but not superlibrarian in one of the branches used above
    11 - Sign in as that user
    11 - See "Centerville: 1" suggestion on mainpage and on acqui home
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01bee142e6e0b997ddfb000a9623082b74bbe9ab
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 24 08:03:48 2020 +0000

    Bug 26265: (QA follow-up) Remove g option from regex, add few dirs
    
    Adding .git. Using a regex.
    If we make it a bit smarter, we do not need most dirs listed.
    
    Test plan:
    Run the test again
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9598240c5d94fa5bd20aac1c25e32ea2b5e57dd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 15:10:18 2020 +0200

    Bug 26265: Add missing xt dir
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 035ed3cee5f391fc90df53e537589dd702e056a8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 15:09:44 2020 +0200

    Bug 26265: Add test for missing directory in Makefile.PL
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acbd6b72052381151f69a3b8aa70ab39cf4fda1c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 21 09:24:29 2020 +0100

    Bug 26265: Add pos directory to the Makefile
    
    This patch adds the /pos directory to the Makefile so that pos gets
    properly mapped at make and install time.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bac48e776aa0983e9ed90f292f8cac40307c67c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 24 10:29:50 2020 +0000

    Bug 8732: DBRev 20.06.00.027
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7697a693f19e5a599f8afa8af7b03a9d1e5788e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Aug 20 22:46:39 2020 +0000

    Bug 8732: (QA follow-up) Terminology - staff client to staff interface
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 215718da4e505c524a0fd799c0390979eb10bbaa
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 18 10:23:23 2020 +0000

    Bug 8732: (follow-up) Make icon show on opac details and correct pref
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84b63b6befd5842b7d70efd8f8cd5b8c4f7edb9d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 15 03:05:31 2020 +0000

    Bug 8732: (QA follow-up) Fix capitalization and terminology on BiblioItemtypeInfo description
    
    - opac = OPAC
    - add "system preference" to make context easier to understand
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 827388a8d0fb6839e994feed25031325e3db1c32
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 3 13:05:12 2020 +0000

    Bug 8732: undo XSLT changes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 329582b7f77bf003f442030c5752a8a00d2828d8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 16 11:47:04 2020 +0000

    Bug 8732: Update statement
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 782688a7cd36ef5597570cd62e6e89275d7ffa47
Author: Chris Cormack <chrisc@catalyst.net.nz>
Date:   Mon Oct 1 10:58:06 2012 +1300

    Bug 8732: Allowing biblio level itemtypes to display instead of MARC ones
    
    This patchset adds a new syspref: BiblioItemtypeInfo
    
    If you set BiblioItemtypeInfo to Koha, you will see the Koha
    record level itemtype info. This info is also shown if item-level_itypes
    is set to biblio
    
    Display of icons are controlled by
    noItemTypeImages/OpacnoItemTypeImages
    
    Material type display is controlled by DisplayIconsXSLT/DisplayOPACIconsXSLT
    
    To test:
     1 - Apply patch
     2 - Update database
     3 - Do an opac search and view results
     4 - Switch pref to 'Koha' and refresh
     5 - Note itemtypes appear
     6 - Click in to a record details
     7 - Note you see itemtype and icon
     8 - Switch the pref
     9 - Note you don't see record level itemtype and icon
    10 - Repeat in staff interface
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d76558875bc5795acfcb7b1622341ebbbf0daf6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 09:06:41 2020 +0200

    Bug 16112: Do not depend on SpecifyDueDate
    
    It's possible to specify a renewal due date in the checkouts table
    even if SpecifyDueDate is off.
    
    Also change the label from "Specify due date:" to "Renewal due date:"
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41fe5b41f90c177836f81083f15d1c7e1e87767a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 6 12:41:23 2020 +0000

    Bug 16112: (follow-up) Form style improvements, clear date
    
    This follow-up makes some markup and style improvements in order to make
    the renew form more consistent with similar forms like checkout and
    check-in.
    
    It also adds a "Clear" button for the datepicker field, matching similar
    date inputs.
    
    To test, apply the patch and go to Circulation -> Renew.
    
     - With or without the  SpecifyDueDate system preference enabled the
       form should look correct.
     - With the SpecifyDueDate preference enabled you should see the date
       form below the barcode input field.
     - Select a date and test that the "Clear" button works to clear it.
     - Compare to the check-in page to confirm that they look consistent
       with each other.
    
    Signed-off-by: Marco Abi-Ramia <marco.abi-ramia@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9189dd4f71d2d68d467e35f694b09e98dbce1f0e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 16:55:56 2020 +0200

    Bug 16112: Add the ability to define due date for batch renew
    
    Same as bug 16748, for batch renew.
    
    Test plan:
    Check an item in
    Renew it using the circ/renew.pl page
    => You can pick a due date!
    => The date is kept from one renew to another
    Renew it until you reach the maximum number of renewals
    => You get a warning with "continue without renewing"
    => The date is still kept
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34cefcd46bcc1433ea27846671fc13abbfed936f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 1 15:11:36 2018 +0000

    Bug 21750: Move collection code to its own column on checkins table
    
    To test:
     1 - Set 'ShowAllCheckins' to show
     2 - Set a collcection code for an item
     3 - Check it in
     4 - Note it displays in the the 'Item type' column
     5 - Apply patch
     6 - Check it in again
     7 - Note the new 'Collection' column
     8 - Hide/show the column using column visibility on the checkins page
     9 - Go to Admin->Configure columns
    10 - Test the various settings for this column and check in the item to
    make sure they work as expected
    
    Signed-off-by: Devinim <kohadevinim@devinim.com.tr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74a13ab801a4004ae485bc1909461ebd7b32f0e5
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Fri May 15 18:11:16 2020 -0300

    Bug 24973: Load custom localization file
    
    It adds a new localization directory that could
    host a custom SQL file for each language,
    xx-YY/custom.sql
    
    This will be the last file to be loaded at
    install time, it can be used to set any difference
    from default values.
    
    It can't be deselected at install time.
    
    Moved corresponding files for de-DE, it-IT,
    nb-NO and completed es-ES
    
    To test:
    1) Apply the patch
    2) Install es-ES/de-DE/it-IT/nb-NO translation (any lang)
       ( cd misc/translation; ./translate install es-ES )
    3) Do a clean install using es-ES
    4) After all files have been loaded check:
        * A new section labeled "Localization data added"
          with one file, custom.sql
        * Inspect the value of FrameworksLoaded syspref,
          last entry must be custom.sql
    5) Remove/rename the file or localization dir and
       repeat 3/4, install must proceed normally
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b61408eb736d8a795eaeb9f7b44583d79e8b66a
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Sat Apr 4 15:01:02 2020 +0000

    Bug 25113: Refactor CirculationRules.t when testing scope combinations
    
    We used to test rule scopes by explicitly defining each combination.
    
    When adding new scopes, it is much easier if these tests are auto-
    generated for you so that you don't have to repeat similar code.
    
    This patch removes those "duplicates" and adds a method that returns
    test cases for each scope as follows:
    
    branchcode categorycode itemtype
    __________ ____________ ________
    branchcode categorycode itemtype
    branchcode categorycode *
    branchcode *            itemtype
    branchcode *            *
    *          categorycode itemtype
    *          categorycode *
    *          *            itemtype
    *          *            *
    
    And automatically extends the test when new scopes are added.
    
    This also obsoletes the "Get effective issuing rule in correct order"
    test in t/db_dependent/Koha/IssuingRules.t
    
    To test:
    1. prove t/db_dependent/Koha/CirculationRules.t
    
    Sponsored-by: The National Library of Finland
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: perl tidy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbf209133e0503df28ab1ae004e560f42425918b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Aug 22 14:11:45 2020 +0200

    Bug 25728: Don't prefill av's code
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6ad2eba4d1ef931f1ef2e71544fd4d52742c2cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Aug 22 11:15:28 2020 +0200

    Bug 25728: fix rebase issues
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e2966839ef1f279f2e76f3a7ad91dab33a2a3df
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jun 13 12:36:01 2020 +0200

    Bug 25728: Use a svc script instead of the REST API endpoint
    
    The try to implement correctly the REST API endpoint for authorised
    values failed.
    This patch uses an easy to implement svc script for the POST route.
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e118b4b28a45a825cfff0d84dd26cc4f7c19c52a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 9 18:02:14 2020 +0200

    Bug 25728: Don't explode if no CAN_* var defined
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d838a4a715959a32e0cc097c95d08498d3335812
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 9 17:57:19 2020 +0200

    Bug 25728: Fix the clone field feature
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8b69a61075d155e860f1852e94c0363dfb26160
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 9 17:34:30 2020 +0200

    Bug 25728: Don't explode in the advanced editor
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b6ffabf85495113194787e19503fffb122caa90
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 9 17:34:34 2020 +0200

    Bug 25728: Create AV when cataloguing an authority record
    
    Test plan:
    Same as the first patch but when cataloguing an authority record
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c181f7a5e303c833d48f5d5ede23ceedb979b21c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 8 16:00:48 2020 +0200

    Bug 25728: Create AV when adding a new item
    
    We do a bit of refactoring to make the code reusable.
    
    Test plan:
    Same as the first patch but when adding/editing an item
    
    QA note: There is a warning from the QA tools
     FAIL   koha-tmpl/intranet-tmpl/prog/en/modules/cataloguing/additem.tt
       FAIL   js_in_body
                    A <script> tag found inside head, must be moved to the body (see bug 17858)
    I don't think how we could avoid it.
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f131ba1efe865288303c914ba683c77b430cb202
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 12 15:22:54 2020 +0200

    Bug 25728: Create AV when cataloguing a bibliographic record
    
    This whole patch set adds the ability to create a new authorised value
    directly from the cataloguing module.
    It will prevent the cataloger to leave and reload the page if they need
    a new one.
    
    Test plan:
    If you are logged in with a patron with the manage_authorised_values
    subpermission you will be able to:
    * Edit a bibliographic record
    * Search for a subfield linked to an authorised values (not the "fake"
    AV like itemtypes, branches, cn)
    * Click the dropdown list and start searching for a value that does not
    exist
    * Click enter
    * Fill the fields in the popup
    * Save
    => Your dropdown list has the new AV :)
    
    Note: This does not work for the advanced editor. It does not have
    select2 applied to the selects. I have hardly tried but failed.
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Hugo Agud <hagud@orex.es>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1d8bb181affe72a082ee53102d96aabd28c40e3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 21 13:19:26 2020 +0000

    Bug 25727: (follow-up) Some style updates, JS i18n
    
    This patch makes to general changes. First, it makes some minor style
    changes to the appearance of the dropdowns. Second, it moves the JS
    content in select2.inc into a separate JS file. This is made possible by
    Bug 21156.
    
    To test, apply the patch and view a page which uses the Select2 library,
    e.g. the add item screen. Confirm that the Select2-styled dropdowns look
    good and work correctly.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/select2.js for translation,
      e.g.:
    
      msgid "No results found"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for
      testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client and
      test a Select2-styled dropdown. Test that translated strings appear.
      For example:
      - Use the filter form to search for a string which isn't found. You
        should see a translated version.
      - Make a selection in one of the dropdowns. Hover your mouse over the
        "X" icon which now appears. The tooltip should be a translated
        version.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b00a25ab7fb53e04e3ddf2032c191d984c1134a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 17 14:39:43 2020 +0000

    Bug 25727: Default to dropdownAutoWidth
    
    This will set a correct width by default.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46e6df4d2240c1695d0f58de01d4e4d1b5962f9c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 17 12:58:10 2020 +0000

    Bug 25727: Do not open options on clear
    
    We want to restore the previous behaviour and keep the options closed when
    clear is clicked
    
    https://github.com/select2/select2/issues/3320#issuecomment-621662039
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18139a8d4a215c55b3f4031434c20adc4074ef78
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 17 16:34:50 2020 +0000

    Bug 25727: (follow-up) Use CSS specificity rather than !important
    
    This patch adds specificty to the CSS which controls the "invalid"
    appearance of a Select2 dropdown so that the use of "!important" can be
    avoided. The patch also puts this style into our custom select2 CSS file
    so that it is located with other Select2 style changes.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 424187b18ab094c87dd122c2bfa1b57ad64b93d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jun 13 15:03:50 2020 +0200

    Bug 25727: Fix highlight of a missing field
    
    In the previous version of Select2 we had only 1 'a' tag that was
    visible, next to the invisible select.
    
    Now we have a 3 nested span elt, the last one (with a role=combobox
    attribute) is the one we want to style.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 529182aaf3d5992f79d8deac0971001129078bf9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jun 13 14:08:11 2020 +0200

    Bug 25727: Fix default values
    
    The way we defined the default values does not longer work (?)
    Using
      $.fn.select2.defaults.set
    instead of
      jQuery.extend($.fn.select2.defaults, {
    fixes the problem.
    
    It restores the allowClear setting.
    
    There is a change in the behavior here, the selection opens when the
    clear button is clicked. That is coming from a change in Select2
    apparently. We may want to hack something to restore the precedent
    behaviour.
    
    This patch also removes the redefinition of the width. It seems that the
    issue that this code was trying to correct is now fixed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8683025c3c2ed4c78afb051f443d4ce0ea889489
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jun 13 13:32:56 2020 +0200

    Bug 25727: Adjust translations
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2aec22b77a3deb4171e811f3024ddc966dff268
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun Jun 7 12:23:04 2020 +0200

    Bug 25727: Upgrade the Select2 JS lib to version 4
    
    In order to benefit from the last feature of Select we should upgrade to the version 4.
    For instance it adds the ability to dynamically create new entries
    
    https://select2.org/tagging
    
    Test plan:
    Confirm that there is no visible regression on dropdown list with select2
    Like edit a bibliographic records, and the items.
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9655029bca97ab5f159f03acadf6601b5edbc421
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 5 17:00:26 2020 +0000

    Bug 26150: Remove the use of jquery.checkboxes plugin from inventory page
    
    This patch removes the use of the jquery.checkboxes plugin from the
    inventory page and replaces it with custom JS.
    
    To test, apply the patch and go to Tools -> Inventory.
    
     - Submit the form with some selections which will return results on the
       following page. I filtered by library.
     - On the page showing results, test that the "Select all" and "Clear
       all" links work correctly.
    
    Signed-off-by: Brandon J <brandon.jimenez@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82776d5a1202dec0a1eb13a93dceb9f01d79df7e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 6 13:11:50 2020 +0200

    Bug 26157: Hide expected DBI warnings from tests
    
    We must redirect them to /dev/null if we know they will appear.
    
    Test plan:
    prove the different test files and confirm that the output is clean when
    this patch is applied
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c79b7d93b96434ddf91c6ddabb1570836736a15
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Oct 10 11:13:37 2018 -0400

    Bug 21539: addorderiso2709.pl forces librarian to select a ccode and notforloan code when using MarcItemFieldsToOrder
    
    There is no reason that MarcItemFieldsToOrder should force librarians
    to select a ccode and notforloan value for each item.
    They are both optional fields.
    As with location, the first value should be an empty 'none' option.
    
    Test Plan:
    1) Set up MarcItemFieldsToOrder, do *not* set mappings for ccode and notforloan
    2) Add an order record to a basket that uses MarcItemFieldsToOrder
    3) Note you must choose a ccode and nfl value
    4) Apply this patch
    5) Reload the page
    6) Note you no longer have to select values for ccode and notforloan
    
    Signed-off-by: Daniel Gaghan <daniel.gaghan@pueblolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c588707845a7ac40e2bb8813065db7ea3c02866
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 24 11:06:39 2020 +0200

    Bug 26189: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b65efd3f224342be8e751e54f7ada8fc482755bb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 12 13:58:58 2020 +0100

    Bug 26189: Improve styling of datatables within fieldsets
    
    Unset label width restriction: The label width restriction within
    fieldsets causes issues for the datatables header. Unsetting it
    explicitly here resolves the line wrapping issues :)
    
    Reset margins for datatables found inside fieldsets such that the
    datatable properly utilises the available space and restore the
    default datatable label font weights.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6797f07bbdfb90c556f52bfe2f83cefdf91495f3
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Jul 15 22:28:07 2020 +0000

    Bug 25791: Remove win.print()
    
    Test plan:
    1) Turn on system preference SelfCheckReceiptPrompt
    2) Check out item via /cgi-bin/koha/sco/sco-main.pl
    3) Click "Finish"
    4) Click 'Print receipt and end session'
    5) Notice two print dialog boxes right on top of each other
    6) Apply patch
    7) Repeat steps 1 - 4
    8) Should only get a single print dialog.
    9) Test in FF/Chrome and make sure behavior is consistent
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 49f5200374e9a381ab7398730e42c0beefc0f2a4
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 20 07:56:12 2020 -0400

    Bug 25903: Add unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd4dbba7fb25bb73bcee152c84e704f9796664fd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jun 30 14:37:21 2020 -0400

    Bug 25903: Sending a SIP patron information request with a summary field flag in indexes 6-9 will crash server
    
    The 'summary' field in the patron information request specifies if detail information should be send for holds,
    overdues, fines, etc. The field is 10 characters in length (0-9). However, the SIP2 spec only defines indexes 0
    though 5, leave 6 though 9 undefined. Some ILSs specify behavior for these undefined indexes. Apparently the
    7th field is often used to request 'Fees', as opposed to 'Fines' in some ILS. Some software that integrate via
    SIP try both the 5th and 7th indexes to ensure they get all fines and fees.
    
    The problem is that Koha's SIP server crashes if any 'summary' index beyond 5 is flagged. We should simply
    ignore flags beyond 5 and act as if no flags were sent.
    
    Test Plan:
    1) Enable SIP for your instance
    2) Send a patron information request with a summary flag in any index beyond 5.
       i.e.: 6300120200617    124846      Y   AOMIDAY|AA21030050054321
    3) Note the SIP server just closes the connection without a response
    4) Apply this patch
    5) Restart the SIP server
    6) Send the same request
    7) Note you get back the patron information response!
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Jeff Gaines <jgaine@arlingtonva.us>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9887a87538b2113c48db8cd2751a4bcf2bd2168
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 30 09:35:38 2020 -0400

    Bug 26076: (QA Follow up) Prevent error by using a fresh resultset
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64412969037ac9a9f81f05c69c3dd43bd3cab90b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jul 28 12:49:35 2020 -0400

    Bug 26076: Sum the amount due in the database query instead of a loop in Perl
    
    This appears to be a bug due to inaccuracies in floating point math. I've been unable to reproduce it on demand. Sometimes when using the "Write off selected" button, Koha will give the error that the payment is more than the amount owed, even though they are the same. The solution I've implemented is to move the summation from Perl code to the database query. This video demonstrates the issue and afterward, shows the error goes away after the patch is applied: https://monosnap.com/file/pG69HC7iI9mU9kkuoCtbkVzVTffKlE
    
    Test Plan:
    1) Apply this patch
    2) Restart all the things!
    3) Verify that "Write off selected" functions as usual
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe529e3324405b30329054b9e8125babc357e1fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 14:00:51 2020 +0200

    Bug 26270: Fix ThingISBN after a change in behaviour
    
    This is just a guess! One of our tests is failing since today and we
    don't modify anything in this area.
    My guess is that the service is now returning the normalized version of
    the ISBN
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d19e76000f02533302d8093e051cf3a0034d1e27
Author: Andrew Nugged <nugged@gmail.com>
Date:   Mon Jul 20 00:16:51 2020 +0300

    Bug 24683: IsAvailableForItemLevelRequest sub description expanded
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c4f475d1a4e64e8e437e9b4906af9cba6c0756f
Author: Andrew Nugged <nugged@gmail.com>
Date:   Mon Jul 20 00:15:37 2020 +0300

    Bug 24683: whole test formatted by 'perltidy'
    
    This is complementary patch using styling from
    bundled /xt/perltidyrc file
    
    Almost no code change except a few long constant strings
    broken to parts by concatenation.
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4599fcc59d4036cb5e3d776b9f162062968e8d98
Author: Andrew Nugged <nugged@gmail.com>
Date:   Mon Jul 20 00:20:56 2020 +0300

    Bug 24683: Fix for take smart rules into account in "if all unavailable"
    
    Inside of ItemsAnyAvailableAndNotRestricted was no effect from main set
    of smart rules (per record and other limits): i.e. call to
    "CanItemBeReserved" was absent totally.
    
    Because of this there was a bug: for example none of two items were
    allowed to be held when first was allowed by one smart rule, BUT on loan,
    and second was disallowed by another smart rule (for example,
    0 "Holds per record"),
    
    i.e. in this case both items unavailable: so on-shelf holds setting
    "allow hold if all unavailable" should allow to hold first one, and not
    the second one. But it was that both wasn't allowed to be held.
    
    Solution: call to sub "CanItemBeReserved" added so it checked for
    "...->{status} ne 'OK'" so now if item restricted by smart rule it also
    accounted as "unavailable" and "AnyAvailavble" not counts it.
    
    How to reproduce:
    
    1. Add 2 smart rules (/cgi-bin/koha/admin/smart-rules.pl) with "on shelf
       holds": "if all unavailable" for all rules, no "item level holds", and
       set "holds per record" to 2 for "books" and "0" for "computer files".
    
    2. Create only 2 items for one biblio, but different types, "book"
       and "computer file". For example in misc4dev env:
       /cgi-bin/koha/cataloguing/additem.pl?biblionumber=1#additem
    
    3. Check out that item of type "book" to some person, for example,
       in misc4dev:
       /cgi-bin/koha/circ/circulation.pl?borrowernumber=2&barcode=3999900000001
    
    4. Open reserve/request, for example, for item 1 and patron 1 in misc4dev
       env (/cgi-bin/koha/reserve/request.pl?biblionumber=1&borrowernumber=1)
    
    5. It does not allow to hold, both red crossed, but computer file says
       "Exceeded max holds per record" because of "0" limit set on step 1.
    
    6. Apply the patch.
    
    7. Reload page on step 5 and see that "book" will be available for hold,
       but "computer file" still will be red-crossed "Exceeded max holds
       per record", now that's correct because both items unavailable:
       one because on load, another because of "0" limit for computer files.
    
    8. Check-in book from step 3 so it will be returned to the library,
    
    9. Reload page on step 5 and see that again no any holds available,
       but it's now also correct: "book" now returned but "on shelf holds"
       set to "if all unavailable".
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 720b69780c1f62c61f4b36df02d46d8c85c0d30a
Author: Andrew Nugged <nugged@gmail.com>
Date:   Fri Jul 17 14:59:19 2020 +0300

    Bug 24683: Optimize loop in ItemsAnyAvailableAndNotRestricted
    
    Add cut-off shortcut (return from inside the loop) when first
    "Any Available And Not Restricted" item found, because one is
    enough for "Any".
    
    Testing: no change visible for code behavior/results,
    it is just faster because won't loop over the whole set.
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 618cf80df9b0b668174b28ff61cad8a938704ec3
Author: Andrew Nugged <nugged@gmail.com>
Date:   Fri Jun 5 09:59:48 2020 +0300

    Bug 24683: Subroutine name changed (fix), no code logic changed This is the intermediate refactor: renamed subroutine only.
    
    Naming mistake came because this sub is used to detect if anything
    available for hold, but it used in "if ANY UNAVAILABLE rule", so actually
    results of this sub negated (see below "return" in the code).
    
    In details:
    
    when previous refactor was done, name for subroutine was chosen
    wrongly in "opposite" direction from what it actually does:
    
    it was named "ItemsAnyAvailableForHold", but this subroutine gave
    truth (1) if at least one of the items available on shelf, not lost,
    not on loan, not held, and not restricted by smart rules and damaged
    status. So, if this sub says that item is still "available", this
    actually PREVENTS item from hold in parent sub (see negated return):
    
        sub IsAvailableForItemLevelRequest {
            ...
            my $any_available = ItemsAnyAvailableAndNotRestricted...
            return $any_available ? 0 : 1;
                 # ^^^ if any available and not restricted - we don't allow
                 #     on-shelf holds
            ...
    
    I.e. like it named now: "ItemsAnyAvailableAndNotRestricted".
    
    Small aside fix: white space for '&&' inside brackets added to join
    operation by priority visually.
    
    Testing plan not needed: all places where sub used it just renamed.
    More: all this places/code was introduced in one older commit so there
    is also no overlaps or other calls/uses for this subroutine.
    
    Signed-off-by: Agustin Moyano <agustinmoyano@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0420165694c790f2346fb598862e4aacfdf0fcc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 4 15:02:03 2020 +0100

    Bug 26023: Properly secure the cashup and refund actions
    
    The cash register summary page for cash management is available for users
    with the 'anonymous_refund' or 'cashup' permission and the actions available
    are appropriately displayed.
    
    However, the actions are not yet correctly tested for at the server and
    so a user may force submit to accomplish the action.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4356e678f2254707c48a6f89658ed089a6b9e662
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 20 09:44:05 2020 +0100

    Bug 26023: Properly secure the cashup action for libraries
    
    The libraries summary page for cash management is available for users
    wit the 'anonymous_refund' permission to allow them to navigate to
    alternate cash registers and search for the prior transaction to refund.
    
    However, currently the cashup option appears, and is not blocked at the
    server, for all user who may access the page. It should be blocked for
    those users without the 'cashup' permission.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4998b7d5758b0bee682fa7485d66390a3657a20
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 20 10:10:14 2020 +0200

    Bug 26253: (bug 22857 follow-up) Remove duplicated mana_config in etc/koha-conf.xml
    
    It was there already but not at the same place!
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9365d61b3c82ed0a63b18f7f450d0226a8a71f2c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 10:06:57 2020 +0200

    Bug 26031: Add diagnostic to search_utf8.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2a79ede5a4f4c81a5672ee485c40c19151fc47b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 10:49:42 2020 +0200

    Bug 25811: Add debug info to authentication.t
    
    Trying to know if the logged in patron is the one we are expecting to
    (well, we are not expecting anybody to be logged in at this point!)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d64d08c41d2bb8c52757936b265748fa1123085
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 20 12:52:09 2020 +0100

    Bug 19036: (follow-up) Test credits should be credits
    
    A series of accountlines added to mock credits were being added with a
    debit_type_code instead of a valid credit_type_code and so were being
    mis-identified by the new credit numbering code trigger in the store
    routine.
    
    This patch updates the test to correctly identify the credits as credits
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 139e0a86ae415a47c645ed66bc491cfb33c353ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 21 12:02:07 2020 +0200

    Bug 18501: Don't use paidfor for DB fields not mapped with a MARC field
    
    On "Bug 25964: Prevent data loss when editing items from a MARC record"
    we picked paidfor as an example, but it has a specific behaviour and is
    now handled in Koha::Item->store.
    Let's pick another one, new_status
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88ed05d07e02f0e7569b35a121b9cde06f6712ca
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 21 10:21:35 2020 +0100

    Bug 18501: (follow-up) Use t::lib::Dates::compare in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fe66325f0aa54aa3084941f8ed79af304b4acc3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 20 14:02:35 2020 +0100

    Bug 18501: (follow-up) Add fallback to ItemHomeBranch
    
    When 'RefundLostOnReturnControl' is set to 'CheckinLibrary' but
    return_branch is passed as undefined we should fallback to
    'ItemHomeBranch' before falling back to the default rule.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80bef548750c3ae0ba9dee70f4d5833ef7cdd133
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 20 13:28:41 2020 +0100

    Bug 18501: (follow-up) Do not rely on userenv->{branchcode}
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a8866cae6df162e14ec521f1ccb9ce72cd25c12
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 20 14:28:46 2020 +0100

    Bug 18501: (follow-up) Test undefined userenv behaviour
    
    This patch adds a test to ensure that the 'Koha::Item->store' method
    will function when the userenv is not set
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00ec4ed478b116f10fa5ea95d565460f439a8320
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 20 12:38:23 2020 +0100

    Bug 18501: (follow-up) Remove duplicate test
    
    The ModItem test found in t/db_dependent/Items.t was a duplciate (but
    slightly less functional) for the test we introduced for the *_on
    trigger functionality in t/db_dependent/Koha/Items.t::store
    
    The failure was a missing C4::Context mock, but the logical fix is to
    simply remove the duplicate test.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 112e2788c52e8d805735ae9eee7c606755994815
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 20 11:49:08 2020 +0200

    Bug 18501: Fix QA issues
    
     FAIL   Koha/Item.pm
       FAIL   critic
                    # Variables::ProhibitConditionalDeclarations: Got 1 violation(s).
       FAIL   spelling
                     Retreive ==> Retrieve
                     appropriatly ==> appropriately
                     somehwere ==> somewhere
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e2514ac36e14aceef48d60e57aa97239fcd61b5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 14 17:18:12 2020 +0100

    Bug 18501: (QA follow-up) Fix regressions highlighted by unit tests
    
    The migration of unit tests in the preceeding patch highlighted a few
    regressions which are dealt with here.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51e70ef88556e1cffff54d6c58d5d529c75d17cf
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 14 17:16:04 2020 +0100

    Bug 18501: (QA follow-up) Migrate and update unit tests
    
    This patch moves the _FixAccountForLostAndFound tests from Circulation.t
    to Koha/Items.t and updates then to call an item store as aposed to the
    now removed _FixAccountForLostAndFound method.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb0cd3d229dec57bdef0016118417a4e326b12f5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 14 11:53:59 2020 +0100

    Bug 18501: (QA follow-up) Remove FIXME + Track issue_id
    
    We correct some compilation errors here by updating the transfered
    _FixAccountForLostAndFound method to use $self references.  We add
    issue_id tracking so that future reports can clearly see how a refund
    relates to the original charge and finally we remove a FIXME as I agree
    that the 'discard_changes' call is not required.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a651f9ee7770a24282c51cc8d4073dc01d99cab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 14 10:51:39 2020 +0200

    Bug 18501: Adjust condition for flagging an item found
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9aa5eb713d77b8363eb214e59fbc2c7d6b42ee6e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 14 10:48:00 2020 +0200

    Bug 18501: set the is_refunded flag as internal var
    
    After discussion with Martin we decided that it could be the correct way
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1971babc6cf1e5b61145905ab392b9f53bcdecd7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 14 09:56:41 2020 +0200

    Bug 18501: wip - need to know it has been refunded
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d807113dc082255ded81279544b53ee3e15168e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 18:42:56 2020 +0200

    Bug 18501: but.. what was the meaning of holdingbranch here?
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd1eec2715b465c74339c9282f97a3be3102cc2b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 18:42:01 2020 +0200

    Bug 18501: Add _set_found_trigger
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79da9442463e655016e1c9c8b12083c72e4b93ba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 16:51:11 2020 +0200

    Bug 18501: Auto refund if mark as found from cataloguing
    
    If an item is marked as found (ie. not itemlost) we need to refund the
    patron.
    
    Test plan:
    Mark an item as lost to create a fee for the patron
    Mark it as found from the cataloguing module and confirm that the patron
    is refunded
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32c26620725ddcb05d0a9f0b742def7bd33d34ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 12 15:45:24 2020 +0200

    Bug 18501: Remove the borrowernumber parameter
    
    It was not used
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05a156fe08fb35d9c9076f47b8047c8834af2a2b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 16:39:08 2020 +0200

    Bug 18501: Prepare the ground
    
    This code was duplicated and we are going to need it.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6aba6f0dfb333449d974685135eba526b9d5c44f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 18 13:26:29 2020 +0100

    Bug 18501: (QA follow-up) Add test of *_on functionality
    
    This patch adds a test for the *_on trigger functionality to ensure
    matching behaviour before and after the triggers change.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37d13fb07deda53fddc69368f538f49c01645143
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 20 10:27:33 2020 +0000

    Bug 19036: DBRev 20.06.00.026
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79848a276ec496d564c8037bee4832d59c9045c4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 19 12:17:32 2020 +0100

    Bug 19036: (follow-up) Improve test output
    
    This patch adds proper detail to the test output for the newly
    introduced AutoCreditNumber feature and fixes the final test by adding
    the 'interface' and 'amount' parameters to the Koha::Account::Line being
    created so that we reach the Exception we are trying to catch and don't
    die early.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87576a0568d9793b0c6f5231b35c0e2864f9bd8a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 17:37:45 2020 +0200

    Bug 19036: Add missing test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bfe4f50aab4f86e5dc39ebe43105f426e345ed7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 6 12:28:48 2020 +0100

    Bug 19036: (QA follow-up) Add credit_number handling to POS
    
    This patch adds the display of 'credit_number' as a replacement for the
    internal 'accountlines_id' as the transaction identifier on the
    register summary page when using cash registers.
    
    Test plan
    1/ Enable 'UseCashRegisters'
    2/ Enable 'EnablePointOfSale'
    3/ Enable at least one 'Debit type' to allow 'sale'
    4/ Add at least one 'Cash register'
    5/ Enable 'AutoCreditNumber'
    6/ 'Enable automatic generation of credit number' for the 'Purchase'
    credit type
    7/ Pay for an item via the Point of Sale page
    8/ Navigate to the 'register' page to display the purchase details
    9/ Confirm that the 'Transaction' is listed with a number of the form
    specified in the 'AutoCreditNumber' preference
    10/ Refund an item from this screen
    11/ Note that the 'accountlines_id' is used for this refund as we did
    not specify the 'Refund' credit type to use the 'AutoCreditNumber'
    system
    12/ Signoff
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 480aca366de6e5c9c07570fa41773cd44ec5beeb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 6 11:34:35 2020 +0100

    Bug 19036: (QA follow-up) Fix 'out-by-one' error on table
    
    This patch fixes the total row where the column count was out by one.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7f0bdc97c27b5449fd07bfb00d6200812dd92848
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 10 11:31:33 2020 +0100

    Bug 19036: (QA follow-up) Fix test plan
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d1efa4a04659f303fc7830bcfe7d79ea8325c87
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 25 10:43:03 2020 +0100

    Bug 19036: DBIC Schema Updates
    
    Dumped schema updates + manual addition of boolean flags
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d46fa45dbfda455d76acc8dbda65d6f4b94d28e7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 25 10:16:45 2020 +0100

    Bug 19036: (QA follow-up) Use Koha::DateUtils
    
    This patch replaced raw DateTime->now calls with dt_from_string from
    Koha::DateUtils
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58edcef03d257da9d4e6f95a4b081a68071bbf82
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Mar 24 10:14:03 2020 +0100

    Bug 19036: Add ability to enable credit number for only some credit types
    
    This feature is disabled by default for all credit types. To enable it
    you have to set the syspref AutoCreditNumber to the value of your choice
    and then enable the feature for each credit type you want.
    System credit types can be modified too (but only this particular field
    can be modified)
    
    Also, throw an exception when the feature is enabled and a value for
    credit_number has already been set
    
    Updated test plan:
    Test plan:
    0. Apply patch, run updatedatabase and update_dbix_class_files
    1. Go to Admin » Column settings, and uncheck the 'hidden' box for
       column credit_number in table account-fines. It will be easier for
       testing
    2. Create a manual credit for a borrower. Verify in Transactions tab
       that this credit has no number generated
    3. In Admin » Credit types:
      a. edit the FORGIVEN type and enable credit number generation
      b. create a new type A, check "can be manually added" and "enable
         credit number"
      c. create a new type B, check "can be manually added". Do NOT enable
         credit number
    4. Change syspref 'AutoCreditNumber' to 'incremental'
    5. Create more manual credits with types CREDIT and B, and verify that
       the numbers are not generated
    6. Create more manual credits with types FORGIVEN and A, and verify that
       the numbers generated are 1, 2, 3, ...
    7. Change syspref 'AutoCreditNumber' to 'annual'
    8. Create more manual credits with types CREDIT and B, and verify that
       the numbers are not generated
    9. Create more manual credits with types FORGIVEN and A, and verify that
       the numbers generated are '2020-0001', '2020-0002', ...
    10. Change syspref to 'AutoCreditNumber' to 'branchyyyymmincr'
    11. Create more manual credits with types CREDIT and B, and verify that
        the numbers are not generated
    12. Create more manual credits with types FORGIVEN and A, and verify
        that the numbers generated are 'BRANCHA2020020001',
        'BRANCHA2020020002', ... (assuming you are connected to library
        BRANCHA, and it's February 2020)
    13. Set library to another one, say BRANCHB
    14. Create more manual credits with types FORGIVEN and A, and verify
        that the numbers generated are 'BRANCHB2020020001',
        'BRANCHB2020020002', ...
    15. Edit the letter ACCOUNT_CREDIT, and add [% account.credit_number %]
        somewhere. Go back to Transactions tab and click on 'Print' for one
        line that has a credit number. Make sure the number is there.
    16. prove t/db_dependent/Koha/Account.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9205d4ef450327fb6a9b235747c55b82a8a6ca37
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Feb 20 10:02:38 2020 +0100

    Bug 19036: Add ability to auto generate a number for account credits
    
    In some areas it's required to sequentially number payment slips /
    receipts.
    
    This patch adds a database column accountlines.credit_number and a
    system preference AutoCreditNumber to control how this number will be
    generated.  The following options are available:
    
    - Do not automatically generate credit numbers.
      This is the current behaviour and the default syspref value.
    
    - Automatically generate credit numbers in the form <year>-0001 (annual)
    
    - Automatically generate credit numbers in the form
      <branchcode>yyyymm0001 (branchyyyymmincr)
      where <branchcode> is the branch where the user (staff member) is
      logged in
    
    - Automatically generate credit numbers in the form 1, 2, 3
      (incremental)
    
    It also adds a column (hidden by default) in the table under
    Transactions tab to display this number.
    
    Test plan:
    0. Apply patch, run updatedatabase and update_dbix_class_files
    1. Go to Admin » Column settings, and uncheck the 'hidden' box for
       column credit_number in table account-fines. It will be easier for
       testing
    2. Create a manual credit for a borrower. Verify in Transactions tab
       that this credit has no number generated
    3. Change syspref 'AutoCreditNumber' to 'incremental'
    4. Create more manual credits, and verify that the numbers generated are
       1, 2, 3, ...
    5. Change syspref 'AutoCreditNumber' to 'annual'
    6. Create more manual credits, and verify that the numbers generated are
       '2020-0001', '2020-0002', ...
    7. Change syspref to 'AutoCreditNumber' to 'branchyyyymmincr'
    8. Create more manual credits, and verify that the numbers generated are
       'BRANCHA2020020001', 'BRANCHA2020020002', ... (assuming you are
       connected to library BRANCHA, and it's February 2020)
    9. Set library to another one, say BRANCHB
    10. Create more manual credits, and verify that the numbers generated are
        'BRANCHB2020020001', 'BRANCHB2020020002', ...
    11. Edit the letter ACCOUNT_CREDIT, and add [% account.credit_number %]
        somewhere. Go back to Transactions tab and click on 'Print' for one
        line that has a credit number. Make sure the number is there.
    12. prove t/db_dependent/Koha/Account.t
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 198bbfa4094da1bfe143eb046d0c36bf68a93ab9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 20 12:27:05 2020 +0200

    Bug 25242: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3680149be734959d8b59223b083efdfb271580d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 19 08:36:03 2020 +0100

    Bug 25242: (QA follow-up) Remove deprecated break-word
    
    It appears break-word is now deprecated in Firefox and instead all
    browsers now support break-all as the definitive.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84cbf0b9379d025d68f381e6dc7ca3772cc7d093
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 18 10:35:59 2020 +0100

    Bug 25242: (QA follow-up) Colwidth on results table
    
    Prior to this patch, the column width on the opac-results table were not
    fixed or calculated by a datatable; As such when we introduced the
    'table-layout: fixed' property all columns were given equal share of the
    table, which resulted in most cases in a three way split between a
    checkbox, an empty cell and the actual content.
    
    This patch sets the width for the selectcol to '1ch' for the single
    character checkbox and updates the second columns class to 'numcol' as
    it is not used for selection but rather result numbering and sets a
    fixed width of '4ch' allowing for results upto 3 digits (plus the
    period) to display correctly without wrapping.
    
    Test plan
    1/ Apply the patches and run the yarn build process to update the .css
    2/ Perform a search and varify that the results table looks reasonable
    3/ Disable OPACHiddenItems and perform a search again.
    4/ Confirm the table looks reasonable still
    5/ Signoff
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3a09d09e3b32c0a0f2e9b7acf652abeab694353
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 6 13:29:54 2020 +0100

    Bug 25242: Improve column wrapping and overflow for tables
    
    This patch attempts to improve the column wrapping and prevent
    datatabels from overlapping with other content on high zoom levels/low
    width screen sizes.
    
    Test plan
    1/ Build the OPAC CSS from the updated SCSS
    2/ Navigate to various tables in the OPAC (Holds table is a good one)
    and 'play' with various window sizes and zoom levels.
    3/ The table should not overlap with right navigation content
    4/ Signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b05448311fd6db94410ffaae1de62b76757544f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 16:44:34 2020 +0200

    Bug 25430: Use label-default for 0
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52f91af5bcd3ca4ec82463764dcaace6dcc0b2ae
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri May 8 13:15:40 2020 -0400

    Bug 25430: Improve the styling of the claims returned tab
    
    It has been suggested that it would be useful to add title attributes to the different numbers on the return claims tab in the checkouts and patron details pages. In addition, color coding them ( and removing the slash ) will make the numbers easier to read.
    
    Test Plan:
    1) Set up return claims for your system
    2) Apply this patch
    3) View the claims tab for someone with not claims, and someone with claims
    4) Note the resolved claims are green and have a "tooltip" when hovered over
    5) Note the unresolved claims are green if 0, and yellow if not 0, and
       also have a "tooltip"
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af0929abbb72c9c2469b1f2ccba338f51801ad98
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 1 10:19:05 2020 +0200

    Bug 25626: Fix untranslatable strings on the 'OPAC problem reports' admin
    
    The 'Sent to' and 'Status' column values were not translatable.
    
    Test plan:
    Translate the interface
    Report some problems at the OPAC
    Go to the admin page and notice that all the columns are now translated
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5a36c20a20721e82820ccaaf139285beadbaaf0
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Wed Jul 29 13:23:14 2020 +0100

    Bug 26082: Call store on new items to update itemnumber
    
    Need to add call to store to Koha::Item->new so that itemnumber
    is returned - otherwise is not defined and causes an error
    Bug is a side-effect of Bug 23463 as this was implicitly
    done in AddItem
    
    Also set biblioitemnumber explicitly for item adds this also
    used to be done explicitly but can now cause an FK error
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 909755e5f66adea521a5b516c86bfdb5a83f6b0d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Aug 19 11:46:16 2020 +0000

    Bug 26251: Remove unused routines from svc/split_callnumbers
    
    This is just a copy and paste from svc/localization
    
    Test plan:
    Read the code.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9708bbe276082ddc2fa4402c2e84e195e4a3a68d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 13 13:17:59 2020 +0100

    Bug 26039: Focus and Scroll to ShelfBrowser on load
    
    When the shelf browser link is clicked we perform a full page reload
    which results in a reset in the context. We should immediately focus the
    shelf browser and scroll to that region to highlight the change of
    content.
    
    Test plan
    1/ Enable shelf browser
    2/ Search for an item in the open and navigate to the detail page
    3/ Click the 'Browse shelf' link
    4/ Note that upon page reload the screen scrolls to the 'Browsing...'
    location of the screen.
    5/ Note that the 'Browsing...' title is  'focused'
    6/ Signoff.
    
    Signed-off-by: Stina Hallin <stina.hallin@ub.lu.se>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: correctly align JS code
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 392a7e1a1ffb327986a5c0cb6863bbb87e43deaf
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Tue May 26 13:31:31 2020 +0200

    Bug 25605: Replace NULL values with '' when downloading a report as a tab separated text
    
    Test plan :
        1- Create a new report : select * from items;
        2- Run it
        3- Download the report as a tab separated text
        4- There's a lot of 'use of uninitialized value in join or string at ...koha/reports/guided_reports.pl line xxx.'
        in plack-error.log
        5- Apply patch
        6- Restart all
        7- Redo 2 and 3
        8- No more warning.
        9- diff both downloaded files, they must be the same.
    
    Signed-off-by: Marco Abi-Ramia <marco.abi-ramia@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12e1b2faccf6396d3c4b5327c881e78f177f135b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 6 12:50:36 2020 +0200

    Bug 26134: (bug 23463 follow-up) Fix add to basket from staged file
    
    There is a ->store call missing when we attempt to create a new item.
    
    Test plan:
    - set at least one value in MARCItemFieldsToOrder
    - add to a basket via staged file with at least one value matching your MARCItemFields mappings
    - set required fields for your order and click Save
    => Without this patch you got:
    receive error: "DBIx::Class::Storage::DBI::_dbh_execute(): Column 'itemnumber' cannot be null at /kohadevbox/koha/Koha/Acquisition/Order.pm line 113
     at /usr/share/perl5/DBIx/Class/Exception.pm line 77"
    => With this patch applied the order has been created successfully
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e24a294f393defeea12fd0bbfba73839c29d14f0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 5 18:24:08 2020 +0000

    Bug 26153: Remove the use of jquery.checkboxes plugin from items lost report
    
    This patch removes the use of the jquery.checkboxes plugin from the
    lost items report page and replaces it with custom JS.
    
    To test, apply the patch and go to Reports -> Lost items.
    
    - Run the report with parameters which will return multiple results.
    - On the results page Create a CSV export profile if there's none.
    - On the results page test the "Select all" and "Clear all"
      links at the top of the results. The controls should work correctly.
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3f3a55e0b1544ebcd3166d141e126a4324baab1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 09:59:24 2020 +0000

    Bug 26234: Teach our KohaTable constructor the specific th classes
    
    We have different classes we can use to set specific behaviours on
    table columns: title-string, string-sort, anti-the and NoSort.
    We should not need to pass them to the DataTable constructor, we could
    teach it that we always want to apply them.
    
    It will avoid bug like bug 26233
    
    The goal is to define them in a centralised place
    (columns_settings.inc) then only use the class on the th
    
    Test plan:
    Different behaviour and tables must be tested to confirm it works
    correctly. Focus must be put on table when aoColumnsDefs is passed from
    the template and confirm that this will add more info to aoColumnsDefs
    and not remove the existing ones.
    
    Note that this only work when KohaTable is used.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94a445d4138eaa0aaa89c49053b6ced8ca1ee0d1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 18 16:41:09 2020 +0000

    Bug 26239: Do not format large negative numbers
    
    At several places we got the following error if we use numbers too big
    for Number::Format
    Template process failed: undef error - round() overflow. Try smaller
    precision or use Math::BigFloat at /home/koha/src/Koha/Number/Price.pm line 44
    
    It make the app explodes.
    The goal here is to handle these errors gracefully and easily.
    
    We fixed it for positive numbers in bug 15770, but we neglected the case of negative numbers
    
    Test plan:
    - Add a manual credit to a patron of 100000000000000
    - ISE!
    - Apply patch
    - Restart all the things
    
    Works perfectly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0b5cefdc88a3671a0310a90490be275bab46860
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 19 07:19:09 2020 +0200

    Bug 26162: Don't fall into an infinite loop
    
    If something went wrong we do want to stop the script!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 331d7c0e50b1b4fa8eed9b27517fe98cb3d2c8e4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 18:29:04 2020 +0200

    Bug 6725: (follow-up) Make patron duplicate matching flexible
    
    oops...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97eef397a439fa416773a67d0ed767859adb01fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 17:43:29 2020 +0200

    Bug 25906: Compiled CSS (late)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7941d8d3c00086c7990cdfa4c72791ee96addfae
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Tue Jul 7 16:01:58 2020 -0400

    Bug 25945: Description of AuthoritySeparator is misleading
    
    This patch changes the description of the AuthoritySeparator system preference
    
    To test:
    1. Apply patch
    2. Go to Administration > Global system preferences > Cataloging and locate the
    AuthoritySeparator preference
    3. Read the description and make sure it makes sense and that there are no typos
    or grammatical errors
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3501a0920c644d03e910e86f639009c9a2c7bcb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 29 13:49:03 2020 +0000

    Bug 26086: Add 'cron' to log viewer interface options
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26086: (follow-up) Be consistent with space in cron job
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c528f235bc01fd45363cf7ce05e4a47df4768026
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 15:40:44 2020 +0000

    Bug 6725: DBRev 20.06.00.025
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6d633f0d42ae0361f64a3c0a169371dd17f4cab
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 15 02:48:20 2020 +0000

    Bug 6725: (QA follow-up) Slightly rephrase PatronDuplicateMatchingAddFields
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 883e86a571e4b3f957c463350584932c5cb0b906
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 5 12:20:08 2020 +0200

    Bug 6725: Make patron duplicate matching flexible
    
    This patch adds a new system preference PatronDuplicateMatchingAddFields
    to list the patron's attributes to use for deduplication.
    The default value is surname, firstname and dateofbirth to keep existing
    behaviour.
    
    Test plan:
    0. Apply the patch and execute the update DB entry
    1. Create a new patron with surname, firstname
    2. Create another patron with the same surname, firstname values
    => Confirm you get the duplicate warning
    3. Modify the syspref to edit the list of attributes used to dedup
    4. Repeat 1 and 2 with different values and confirm that you get the
    behaviours you expect
    
    Note: This is only impacting the add patron form from the UI, not the
    import patrons tool.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb8400d9fe5f1246076fec3b527b73647baa8421
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 16:55:56 2020 +0200

    Bug 16748: Add the ability to define due date in batch checkout
    
    This patch allows the librarian to pick the due date when batch checkout
    
    Test plan:
    Batch checkout using a hard due date
    => Notice that the due date is taken into account
    Batch checkout the same barcodes with a different due date, to trigger the confirmation step
    => Notice that the due date is taken into account for the renewals
    
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38619de9db76ee9b6c9b888129a52d7416406a4c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 26 13:20:53 2018 +0200

    Bug 20469: Add item status to staff article request form
    
    The template checks if an item is checked out, on hold (waiting or
    transit), not for loan. (Note: This can be extended in the future
    in a general include as we have at opac side.)
    
    Test plan:
    [1] Place an article request on an item on loan. Verify status on form.
    [2] Place an article request on a waiting item. Check status again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    [EDIT] Simplified on 2020-07-27
    Removed Koha::Item->is_waiting_or_transit.
    Use Koha::Item->itemtype to check notforloan on itemtype level.
    Adjusted commit message accordingly.
    
    Additional test:
    [3] Place an article request on a not for loan item. Check status.
    
    NOTE: Not for loan is informational too. It does not say that this item
    is not available for an article request. Depends on local situation.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a474e50e00be3cf0a20832fb294fdaa4e23f00f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jul 27 13:34:21 2020 +0000

    Bug 20469: Remove effective parameter
    
    Test plan:
    Run test Koha/Item.t again
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1235746d9e0c3ebebbc51441b73224d11598982
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jul 27 12:31:14 2020 +0000

    Bug 20469: Add Koha::Item->itemtype
    
    Also needed to add a missing rollback to preceding subtest.
    
    Test plan:
    Run t/db_dependent/Koha/Item.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b036710feaedfd96810fdb19dfee13217bfa6b58
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 10 17:39:53 2020 +0100

    Bug 22393: (QA follow-up) Typos and Filters
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 484061a44e068a5a130941ac28d8a187cb238ad3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Apr 21 15:54:45 2020 +0100

    Bug 22393: (follow-up) Corrections for QA feedback
    
    We correct the behviour of 'amount' being passed back to the template
    and add a work around for the existance of deleted_items alongside a FK
    to items in the accountlines table.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d19d9fa44dfddcaef06ea6e59feab5ed8dbb01e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 10 14:55:13 2020 +0000

    Bug 22393: Remove last remaining use of C4::Accounts::manualinvoice
    
    This patch re-arranges the manualinvoice controller script to clarify
    code flow, replaces the last call to C4::Accounts::manualinvoice with a
    call to Koha::Accounts->add_debit wrapped in a try catch block and also
    adds a check on passed barcodes when the invoice type is 'LOST' so it
    can link the subsequently created accountline to the item and issue.
    
    Test plan
    1/ Add a manual invoice (without entering a barcode)
    2/ Add a manual invoice with a valid barcode (Not a LOST type)
    3/ Add a manual invoice with a valid, but old, barcode (Not a LOST type)
    4/ Add a manual invoice with an invalid barcode, note that an error is
    displayed
    5/ Add a manual invoice with type 'LOST' and a valid barcode for a
    checkout your user has had checked out
    6/ Add a manual invoice with type 'LOST' and a valid barcode, but not
    one that will match a checkout for your user. Note an error is displayed
    7/ When errors are displayed, note the form contains data from the
    previous submission so you can just correct the error rather than
    re-enter all data.
    8/ Signoff
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 168c8f2e31733f78e62e9b9401e95b2419f60921
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 17 16:57:54 2020 +0000

    Bug 24884: Remove 'New list' button in 'Public lists' tab if OpacAllowPublicListCreation is disabled
    
    This patch adds a check on the OpacAllowPublicListCreation system
    preference to the OPAC lists template so that if public list creation is
    disabled the "New list" button doesn't appear under the "Public lists"
    tab.
    
    To test, apply the patch and confirm that the virtualshelves preference
    is enabled.
    
    - With the OpacAllowPublicListCreation system preference enabled, go to
      the OPAC and view the lists page.
      - If you are logged in you should see a "New list" link under both the
        "Your lists" tab and the "Public lists" tab.
      - If you are not logged in you should see "Log in to create a new
        list" on both pages.
    - View the page with OpacAllowPublicListCreation disabled.
      - If you are logged in you should see a "New list" link under only the
        "Your lists" tab.
      - If you are not logged in you should see the "Log in" link only under
        the "Your lists" tab.
    
    Works perfectly!
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14d3a7dfe3744680f1efe387fc88bb3e79609b4c
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Sat Apr 11 19:48:48 2020 +0000

    Bug 25114: Remove duplicated logic from GetLoanLength()
    
    Remove duplicated logic for searching circulation rules.
    
    This can be replaced with get_effective_rules().
    
    To test:
    1. prove t/db_dependent/Circulation/GetHardDueDate.t
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 274075a63f438110b0dcbb8f5a0b6f0fae53eb3f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 15 18:53:25 2020 +0000

    Bug 25364: Undo change to 'None specified'
    
    As this has been a little controversial, this patch undoes
    the change to "None specified / Prefer not to say" to be
    "None specified" again as before this patch set.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66e70c9201162f1188f3289ddfa53d195e58f672
Author: David Roberts <david@koha-ptfs.co.uk>
Date:   Mon May 4 02:29:14 2020 +0000

    Bug 25364: Add "Other" to the gender options in a patron record
    
    This patch adds "Other" as an option, and also changes the wording of
    "None specified" slightly.
    
    To test:
    
    1) Apply the patch
    2) Check that there is an "Other" radio button in the patron record, and
    that the wording of "None specified" has changed to "None specified /
    Prefer not to say".
    3) Check that you can save changes to the gender of this patron record,
    both on create and modify.
    4) Check that these changes also work in the Opac Self-Registration
    functionality.
    
    Correct typos in previous commit
    
    Signed-off-by: Devinim <kohadevinim@devinim.com.tr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f661ecd50f4346bd55200bf71ddc1ded8c395768
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jun 26 20:12:58 2020 +0000

    Bug 25654: Make the contact and non-patron guarantor sections separate on patron entry form
    
    This patch reverses what I think was an unintended change made by Bug
    14570 in which the non-patron guarantor fields are shown for all patron
    types (not just child patrons) and  grouped with the patron contact fields.
    
    This patch creates a new "Non-patron guarantor" fieldset to show along
    with "Patron guarantor" when adding or editing child patrons.
    
    To test, apply the patch check that the  BorrowerUnwantedField system
    preference does not contain contactname, contactfirstname,
    or relationship.
    
     - Open an adult patron for editing. You should see no guarantor-related
       fields.
     - Open a child patron for editing. There should be two guarantor
       sections: "Patron guarantor" and "Non-patron guarantor."
       - Test that adding patron guarantors and non-patron guarantors works
         correctly.
       - Add "contactname|contactfirstname|relationship" to the
         BorrowerUnwantedField system preference.
       - Reload the child patron entry form. The non-patron guarantor
         section should now be hidden.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf2ec138ff788206be0e27d0882aaa3bb7da6cb8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 27 14:39:22 2020 +0000

    Bug 25694: Add ability to delete a Marc Modification Template when viewing
    
    This patch adds a "delete template" button to the MARC modification
    templates "Edit actions" view.
    
    To test, apply the patch and go to Tools -> MARC modification templates.
    
     - On the main MARC modification templates page the toolbar should have
       only one button: "New template."
     - Click the "Edit actions" button for an existing template.
     - On the "Actions for..." view there should be three buttons, "New
       template," "New action," and "Delete template."
       - Test that the "Delete template" button works correctly.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cbc3a37f8ed5e80560f6f93b258335e70a20fbf7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 23 11:52:20 2020 +0000

    Bug 25832: Add DataTables to MARC subfield structure admin page for authorities
    
    This patch adds DataTables sorting and filtering to the table of
    subfields shown on the Authority MARC subfield structure administration
    page.
    
    To test, apply the patch and go to Administration -> Authority types.
    
     - From the 'Actions' menu, select 'MARC structure.'
     - From the 'Actions' menu, select the 'Subfields' link for a tag
       with multiple subfields.
       - On the page showing all the subfields for the tag, confirm that
         the table is sorted by default by subfield and that sorting works
         correctly.
       - Confirm that the search form at the top of the table works.
    
    Signed-off-by: Katrin <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ded8b7f63f260e1725a27430291f242fdad02400
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 18 13:50:32 2020 +0000

    Bug 25867: DBRev 20.06.00.024
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c0cf2c73edb504f20931a3012a40aaf06c5d1e1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Aug 14 13:17:01 2020 +0000

    Bug 25867: Database update for changing existing frameworks
    
    This updates the descriptions for 952$a und $b in all existing
    frameworks, if the English description hasn't been changed since
    installing Koha.
    
    To test:
    - Look at your item edit form or on the MARC tab
      for the descriptions shown for $a and $b for any framework
    - Note the descriptons say '... location'
    - Change one or more using the frameworks.
    - Run the database update
    - Verify only the unchanged ones have been updated
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cad0cbee6d2fb71e85f0622798b9db43ce18b497
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jul 18 01:43:02 2020 +0000

    Bug 25867: Label "Current location" as "Current library" and "Permanent location" as "Home library"
    
    There is some confusion between the different locations and
    libraries appearing in the GUI.
    
    holdingbranch is sometimes labeled as current location
    homebranch is sometimes labeled as permanent location
    
    The patch fixes these occurences in various files:
    - Item search form, results and export options
    - MARC frameworks for en, fr-Fr, nb-NO, and pl-PL
    - Holds awaiting pickup report
    - Item display on order receive screen (create items on receive)
    - OPAC system preference: OPACResultsLibrary
    - Staff and OPAC detail pages
    - Lost items report
    - Rotating collections
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c67613f7b7b844d32a037cc90986aed3ccfc6ab
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Jul 25 15:10:24 2020 +0000

    Bug 26065: Move translatable strings out of marc_modification_templates.tt and into marc_modification_templates.js
    
    This patch removes the <script> block in the MARC modification
    templates template in which strings are defined for translation
    purposes.
    
    Strings are now in place in the JavaScript file and wrapped in the new
    __() function.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Perform some actions which will trigger translated strings, for
      example:
      - Create a new template
      - Add an action to the template and then delete it.
        - The confirmation should appear correctly
      - Add an action. Select "Copy" as the operation and click "Add action"
        without filling in any fields.
        - You should see a message, "Both subfield values should be filled
          or empty"
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
    > cd misc/translator
    > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/marc_modification_templates.js for
      translation, e.g.:
    
      msgid "Both subfield values should be filled or empty."
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
    > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client and
      repeat the test plan above. The translated string should appear.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89721cb42b3928c745677c70fd9061273d1848dd
Author: David Cook <dcook@prosentient.com.au>
Date:   Fri Aug 14 01:49:40 2020 +0000

    Bug 25778: Fix var scope in koha-plack for PERL5LIB and KOHA_HOME
    
    Currently, if a koha-plack is given multiple instances, it will create
    duplicate $KOHA_HOME/installer and $KOHA_HOME/installer/lib entries
    in PERL5LIB as these changes are done at the global rather than local level.
    
    This issue can only be seen in non-dev Koha, since dev Koha installs
    rewrite PERL5LIB.
    
    This patch localizes PERL5LIB to each instance.
    
    To test dev installs:
    0. cp debian/scripts/koha-plack /usr/sbin/koha-plack
    1. koha-plack --restart kohadev
    2. Note that nothing breaks
    
    To test non-dev installs:
    0. Don't replace /usr/sbin/koha-plack yet
    1. Create multiple non-dev installs with plack enabled and running
    2. Set up one of these non-dev installs so you can use the web
    UI (that is beyong the scope of this test plan)
    3. koha-plack --restart test1 test2 test3
    4. For test3, go to /cgi-bin/koha/about.pl
    5. Note that there are duplicate /usr/share/koha/installer
    and /usr/share/koha/lib/installer entries in PERL5LIB
    6. cp debian/scripts/koha-plack /usr/sbin/koha-plack
    7. koha-plack --restart test1 test2 test3
    8. For test3, go to /cgi-bin/koha/about.pl
    9. Note that there are no duplicates entries in PERL5LIB
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c5c55c0e66c0aec416a5e0c957343eeb0ea0aa8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 12 16:07:05 2020 +0100

    Bug 26194: (follow-up) Default to current branch
    
    When adding a new register, it would be helpful to default to the
    current logged in branch.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95551b569fa0f00095ffae69ac4b3f832f7554ee
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 19:33:41 2020 +0000

    Bug 26194: Add link to cash register management from message about missing registers
    
    In places where the interface warns the user about missing cash
    registers we should provide users with permission a direct link to the
    cash register management page.
    
    To test, apply the patch and enable the UseCashRegisters and
    EnablePointOfSale preferences.
    
    If necessary, go to Administration -> Cash registers and remove any cash
    registers for your library.
    
     - Log in to the staff interface as a user with "manage_cash_registers"
       permission.
     - Locate a patron who has outstanding fines.
     - Under Accounting -> Make a payment, click the "Pay" button next to a
       fine.
     - The page should show the message about missing cash registers with a
       button which take you directly to the "Add new cash register" form.
     - Perform the same check by selecting the checkbox next to a fine and
       clicking the "Pay amount" button and the "Pay selected" button.
     - Test the message shown at:
       - Tools -> Cashup registers.
       - Point of sale -> Register details
       - Point of sale -> Library details
     - Perform the same tests when logged in as a user without permission to
       manage cash registers. The messages shown in the previous steps
       should omit the button linking to cash register management.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 393ecb4a9cc4c906b4bfcecf6357874e300fa3bd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 5 16:35:37 2020 +0000

    Bug 26149: Remove jquery.checkboxes plugin from problem reports page
    
    This patch removes the inclusion of the jquery.checkboxes plugin from
    the problem reports template in the staff interface.
    
    To test, apply the patch and make sure the OPACReportProblem system
    preference is enabled.
    
     - Submit a few OPAC problem reports if necessary
     - Go to Tools -> OPAC problem reports
     - Test that the "Select all" and "Clear all" controls at the top of the
       table work correctly.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fadb7ac1931b48a4be8160409d35ca97ab6b322
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 6 11:42:33 2020 +0000

    Bug 26159: Remove the use of jquery.checkboxes plugin from batch record delete page
    
    This patch removes the use of the jquery.checkboxes plugin from the
    batch delete records page.
    
    To test, apply the patch and go to Tools ->  Batch record deletion.
    
     - Submit a batch of biblionumbers which includes one or more
       checked-out items, one or more on-hold items, and one or more records
       with no items.
     - On the confirmation page, test the selection links at the top of the
       results table. Each one should work correctly.
     - Submit a batch of authority record ids which includes some records
       which are in use and some which aren't.
     - On the confirmation page, test the selection links at the top of the
       results table. Each one should work correctly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 467e491a25652bf8ee85651ab91e3780c66e3aa1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 13 12:34:19 2020 +0000

    Bug 26201: Remove the use of jquery.checkboxes plugin from batch extend due dates page
    
    This patch removes the use of the jquery.checkboxes plugin from the
    batch extend due dates page.
    
    Unrelated change: Removed 'enctype="multipart/form-data"' from the form
    because there is no file upload.
    
    To test, apply the patch and go to Tools -> Batch extend due dates.
    
     - Submit the form with parameters which will return a set of multiple
       checkouts.
     - On the results page, test the "Select all" and "Clear all" links to
       confirm that they work correctly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9371685b973a287b7642fb907721f4964d92e65a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 13 13:19:19 2020 +0000

    Bug 26202: Remove the use of jquery.checkboxes plugin from batch record modification page
    
    This patch removes the use of the jquery.checkboxes plugin from the
    batch record modification page.
    
    To test, apply the patch and go to Tools -> Batch record modification
    
     - Submit a batch of biblionumbers for modification.
     - On the results page, test the "Select all" and "Clear all" links to
       confirm that they work correctly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2de2b1330f540ef9482c1ed547b111757f0a551a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 13 13:54:54 2020 +0000

    Bug 26204: Remove the use of jquery.checkboxes plugin from staff interface lists
    
    This patch removes the use of the jquery.checkboxes plugin from the
    staff interface lists page.
    
    To test, apply the patch, go to Lists, and view the contents of a
    list with multiple titles on it.
    
    Check that the "Select all" and "Clear all" links work correctly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7174b204a324ee2431012e7f9a3cc09738d57de
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 14 13:39:17 2020 +0000

    Bug 26212: Remove the use of jquery.checkboxes plugin from pending offline circulations
    
    This patch removes the use of the jquery.checkboxes plugin from the
    pending offline circulations page, replacing it with in-page JS.
    
    Unrelated: The JS-based creation of the "select all" and "clear all"
    controls has been replaced with HTML links. Labels are added to the
    results table to make checkbox selection easier.
    
    To test, apply the patch and go to Circulation.
    
    - Upload an offline circulation file (.koc) with multiple transactions.
      If you don't want to generate this file using the desktop application
      or Firefox add-on you can create a text file like this (tab
      separated):
    
      Version=1.0    Generator=koct-firefox    GeneratorVersion=0.1
      2020-08-14 13:24:21    issue    0109132    33000000093476
    
    - Go to Pending offline circulation actions. You should see the list of
      transactions you uploaded.
    - Test that the "Check all" and "Uncheck all" controls work correctly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41205adf34a4cde773fb399728ca74d9dada0e81
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 14 14:47:40 2020 +0000

    Bug 26214: Remove the use of jquery.checkboxes plugin on late orders page
    
    This patch replaces the use of the jquery.checkboxes plugin on late
    orders page in acquisitions.
    
    Unrelated changes: The "Check all" and "Uncheck all" links are moved out
    of the table header so that it matches similar interfaces. Sorting is
    now disabled on the checkboxes column and the table is sorted by default
    on the "Order line" column.
    
    To test, apply the patch and go to Acquisitions -> Late orders.
    
     - On the initial view, there should be no "Check all" or "Uncheck all"
       links.
     - Select a vendor in the left-hand sidebar form.
     - When the filtered table is redisplayed the "Check all" and "Uncheck
       all" links should now be visible.
     - Test that the links work correctly.
     - Confirm that the checkboxes column cannot be sorted and that the
       table is sorted by default by order line number.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff5f7c787482fff5611b3fdeaed89598dfa29d64
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 14 15:18:37 2020 +0000

    Bug 26215: Remove the use of jquery.checkboxes plugin from Z39.50 search pages
    
    This patch removes the use of the jquery.checkboxes plugin from three
    Z39.50 search templates: Acquisitions, Authorities, and Cataloging.
    
    To test, apply the patch and test the controls for selecting and
    deselecting Z39.50 search targets on the following pages:
    
     - In Acquisitions: Locate a vendor and add to basket -> From an
       external source.
     - In Authorities: Click "New authority" -> "New from Z39.50/SRU."
     - In Cataloging: Click "New from Z39.50/SRU."
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af8aa1ad7eb4857a86d395b3833b8040630306b6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 14 17:28:22 2020 +0000

    Bug 26216: Remove the use of jquery.checkboxes plugin from catalog search results
    
    This patch removes the use of jquery.checkboxes plugin from the
    staff interface catalog search results page.
    
    To test, apply the patch and perform a catalog search in the staff
    interface which will return results.
    
    On the search results page test the "Select all" and "Clear all" links
    at the top of the results. They should work correctly.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8344ee7b4ced266ac7bd48254f4695175fd8f19b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 14 14:18:00 2020 +0000

    Bug 26213: Remove the use of jquery.checkboxes plugin when adding orders from MARC file
    
    This patch removes the use of the jquery.checkboxes plugin from the page
    for adding orders to a basket from a staged MARC file.
    
    This patch fixes an unreported bug wherein the "select all" and "clear
    all" controls affected not only MARC record checkboxes but also the
    "show inactive funds" checkboxes.
    
    To test, apply the patch and go to Acquisitions.
    
    - Go to Vendor -> Add to basket -> From a staged file.
    - Select a staged file with multiple records.
    - Test the "Select all" and "Clear all" links at the top of the "Select
      to import" tab. They should work correctly to select and deselect
      checkboxes corresponding to staged MARC records.
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 807147fb7b20c837f9afc3e2d6ba589d86d86cbe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 6 11:28:53 2020 +0200

    Bug 23632: Remove C4::Logs::GetLogs
    
    Koha::ActionLogs->search must be used instead.
    There is no call to this subroutine in our code, it should be removed.
    
    Test plan:
    Make sure the 3 test files still return green and that there is no more
    occurrences of GetLogs in the codebase.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c933e25b6f226eb2536761f04b5fc6608c7f80c4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 14 12:57:25 2020 +0000

    Bug 23695: (follow-up) Add exceptions for missing branch parameters
    
    JD: amended patch
    Remove QA issues:
     FAIL   t/db_dependent/Circulation.t
       FAIL   valid
                    "my" variable $doreturn masks earlier declaration in same scope
                    "my" variable $messages masks earlier declaration in same scope
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3cf6f7f29fbb8d2798bd8089d98691855b8231d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 13 14:40:52 2020 +0100

    Bug 23695: (QA follow-up) Fix Copy/Paste
    
    The value remained as 'tobranchcd' and needed to be updated to
    'frombranchcd' to allow reservered transfers to be correctly set.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d0e22f97aa0c9d6313b35780a2a6ca50d03222c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Mar 23 12:46:26 2020 +0000

    Bug 23695: (follow-up) Adjust for addition of transfer trigger
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3c66c6d945a5f67bc42a1fbad01d47d28f1f23e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 30 10:37:03 2019 +0000

    Bug 23695: Alter transferbook to take a hash of params and specify from_branch
    
    To test:
     1 - Go to Circulation->Transfer
     2 - Find an item from your branch and create a transfer to branch B
     3 - Note you can specify the origin and default is 'Item's holding library'
     4 - Confirm the item is marked as held at your current branch and is being transferred to B
     5 - Find an item from a third branch, branch C
     6 - Transfer that item to branch B from branch D
     7 - Confirm the item is held at branch D and is being transferred to B
     8 - prove -v t/db_dependent/Circulation.t
     9 - prove -v t/db_dependent/Koha/Items.t
    10 - prove -v t/db_dependent/RotatingCollections.t
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b1640e0ef16c694f8ac58d17ee736f8fe87ed6a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 30 10:37:03 2019 +0000

    Bug 23695: Set holding branch to transferring branch when manually initiating a transfer
    
    To test:
     1 - Go to Circulation->Transfer
     2 - Note your signed in branch
     3 - Find an item from your branch and create a transfer to branch B
     4 - Confirm the item is marked as held at your current branch and is being transferred to B
     5 - Find an item from a third branch, branch C
     6 - Transfer that item to brnach B
     7 - Confirm the item is held at your current branch and is being transferred to B
     8 - prove -v t/db_dependent/Circulation.t
     9 - prove -v t/db_dependent/Koha/Items.t
    10 - prove -v t/db_dependent/RotatingCollections.t
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eeb7ac6fc0d14c9e731b7759c78f37cadcfa575f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 16 15:44:40 2020 +0200

    Bug 25751: Add ORDERED in dropdown list of suggestion's statuses
    
    The status "ORDERED" is missing from the pull down list of
    status values when editing a suggestion, so the first
    option is selected "No status".
    
    This leads to data loss when editing a suggestion in the
    status "ORDERED". Worse: the status can't be reset to
    "ORDERED" and so no AVAILABLE notice can be sent to the patron.
    
    Test plan:
    - Create a suggestion, accept it, create a new order from this suggestion.
    - Verify status is "ORDERED"
    - Edit the suggestion
    => Without this patch the dropdown list does not have
       "Ordered", and if you save you lost the status
    => With this patch applied the dropdown list has "Ordered"
       preselected. You can save and preserve the status.
    
    Signed-off-by: Holly Cooper <hc@interleaf.ie>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43dc505a52a2679e40a22ff610c91552cd8f2fd1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 13 12:56:33 2020 +0000

    Bug 25872: Fix scoping of $limits
    
    The code in build_query_compat contained a 'my' in the assigning of limits for the search in a conditional
    
    This meant the limits were being set correctly during the conditional, but we blanked when passed to the rest
    of the code. The effect was that the searches worked, however, the template params to repeat the search were
    incomplete.
    
    Removing the my ensures the same limits are applied during search and on re-sorting
    
    To test:
    1 - Enable Elasticsearch
    2 - On OPAC perform advanced search, selecting only an itype, ccode, or LOC limit
    3 - Attempt to sort results
    4 - You are returned to Advanced search
    5 - Apply patch
    6 - Repeat
    7 - It sorts!
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f3a886f7b23f37f04a687cb0c1755c3195c2ce6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 13 12:55:21 2020 +0000

    Bug 25872: Unit tests
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc22fb308bdbfc6d1bda3448e966542f2828ad76
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 3 13:09:54 2020 +0200

    Bug 26119: Enable patron's attribute edition when PatronSelfRegistrationVerifyByEmail
    
    There is no good reason remove the ability to edit patron's attributes
    if PatronSelfRegistrationVerifyByEmail is set.
    
    We cannot have them in the self-registration form (because we don't
    store patron's attributes during self-ref), but we can have them when
    a patron show/edit their information.
    
    Test plan:
    0. Enable PatronSelfRegistrationVerifyByEmail and create patron's
    attributes that can be edited at the OPAC
    1. Create a new patron using the self-reg feature
    => You don't have the ability to fill in the patron's attribute
    2. Edit your personal details (OPAC)
    => Without this patch you still don't see the patron's attribute that
    can be edited at the OPAC
    => With this patch applied you can!
    3. Notice the wording change on the "Modify patron attribute type" form
    and confirm it makes sense
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a53c5f04cf2bb03734c82e9f964f108f9198d28
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 3 15:07:24 2020 +0200

    Bug 26127: local_referer should not compare with OPACBaseURL case insensitive
    
    In our test data we have OPACBaseURL that is filled with http://kohadev.myDNSname.org:8080,
    but the CGI referer in local_referer is lowercase
    We should compare it without case sensitivity
    
    Test plan:
    - Use koha-testing-docker
    - Notice the value of OPACBaseURL
    => http://kohadev.myDNSname.org:8080
    - Use the "reports a problem" feature at the OPAC
    - Notice that the "Problem found on page" is correctly filled with the
    referer
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9509e834de14b3fd88296143032100f2b1c907fe
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Thu Aug 13 13:13:55 2020 +0000

    Bug 26182: Clarify wording on CanMarkHoldsToPullAsLost and UpdateItemWhenLostFromHoldList
    
    To test:
    - apply patch, restart
    - search sysprefs for CanMarkHoldsToPullAsLost
    - confirm both sysprefs come up in search and syspref descriptions refer to each other
    
    Signed-off-by: Holly Cooper <holly.teresa.cooper@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7e3c12e6175e19299e7bdbe60d1bc7d41d45ce8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 17 12:12:55 2020 -0300

    Bug 26228: Update gulpfile to work with Node.js v12
    
    This patch makes the gulpfile work with gulp v4 on Node v12. To test it,
    make sure your dev env has Node.js v12.
    
    It also replaces the use of 'gulp-util' (deprecated) by 'minimist' as
    recommended on their site.
    
    On both KTD and KohaDevBox edit your sources.list so the node line
    points to 'node_12.x' instead of 'node_8.x'.
    
    Once that's done:
    1. On your clone run:
       $ yarn install
       $ npm install -E
    2. Build the CSS:
       $ yarn build
       $ yarn build --view opac
    => SUCCESS: Things build correctly
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8f3e0ec0dbaf73075299a88a254334cfaf1d29e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 14 11:30:12 2020 +0000

    Bug 26078: (follow-up) Use a boolean rather than changing returnbranch
    
    Bug 26078: (follow-up) used validTransfer instead of checking WrongTransfer message
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47671123206a475f86de9316d8b256e14aa54bc1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 30 16:59:14 2020 +0000

    Bug 26078: Prevent generating a new transfer from return policy when resolving a transfer
    
    To test:
    - Have 2+ branches
    - Set your default return policy to Item returns to issuing library
    - Find an item with holding branch of Branch A
    - Set your library to Branch B
    - Check item in
    - Koha generates a transfer to Branch A. In doing so, it sets the item holding branch to Branch B
    - Set your library to Branch A
    - Check item in
    - Koha generate a transfer to Branch B. In doing so, it sets the item holding branch to Branch A
    - Set you library to Branch A
    - Check the item in
     . . . Repeat indefinitely.
     Apply patch
     Repeat
     No more loop
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bca73080f89bb2f4ca83ce6ceb9fa8e3c4a7d92
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 14:16:09 2020 +0200

    Bug 26090: Fix "item types" report
    
    This report was broken with SQL strict mode, but also without.
    
    DBD::mysql::st execute failed: 'koha_kohadev.itemtypes.itemtype' isn't
    in GROUP BY [for Statement "
    
    and, if no library was selected:
    
    DBD::mysql::st execute failed: Unknown column 'biblioitems.itemtype' in
    'field list' [for Statement "
    
    This patch does the minimum to make it usable, but it would need more
    love.
    
    Test plan:
    To test you will need to try the 4 combinaisons:
     item-level_itypes = item or biblio
     With or without a library selected in the dropdown list
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d7ff0d5040ca9759fee0609a6b7108773b81357
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 10:28:24 2020 +0200

    Bug 16371: (follow-up) DB changes
    
    We need to keep "opac" is the pref was set before the upgrade
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3b43d31565d464bae664a9167b374baf191c834
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 08:00:23 2020 +0000

    Bug 16371: DBRev 20.06.00.023
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 504228950f6c2167856289d0a39de0a92fb8a97b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 09:57:27 2020 +0200

    Bug 16371: Fix inconsistencies with timestamp
    
    The timestamp value needs to be updated for each quote returned by
    get_daily_quote (even when there is a match)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 831296be7a1947fd8aeed64862dbad6358c9875f
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Fri Jul 31 09:47:56 2020 +0300

    Bug 16371: Combine get_daily_quote and get_daily_quote_for_interface
    
    This patch combines get_daily_quote and get_daily_quote_for_interface
    methods and moves them from Koha::Quote to Koha::Quotes. Also removes
    some unused code and adjusts datetime parsing.
    
    To test apply this patch and confirm 'QuoteOfTheDay' syspref still
    works as expected (quote is shown in correct mainpage(s)).
    
    Also prove t/db_dependent/Koha/Quotes.t
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 103e182a50d56858bbbfb159b8eba4f7d21954d4
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Wed Aug 12 09:16:43 2020 +0300

    Bug 16371: Remove GetDailyQuote tests from Koha.t
    
    Tests in Koha.t failed due GetDailyQuote tests. This patch
    removes these tests since we test quotes in Quotes.t instead.
    
    To test prove t/db_dependent/Koha.t
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0acc0f4b40254e445fde782f37ef31b39e44449
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Tue Jul 7 15:45:17 2020 +0300

    Bug 16371: Rewrite get_daily_quote
    
    An updated test plan:
    1. Apply the patch(es).
    2. Run the database update (updatedatabase on koha-testing-docker).
    3. Check that the 'QuoteOfTheDay' system preference options
       work as expected:
       - OPAC: QOTD only appears in the OAPC
       - Staff interface: QOTD only appears in the staff interface
       - Both (Select all): QOTD appears in the staff interface and OPAC
    4. Run the tests and make sure they pass:
       prove t/db_dependent/Koha/Quotes.t
    5. Sign off!
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d573e4c40cec94eaf0aa175cc8da74c94cf6c9ce
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Fri Jul 10 10:20:56 2020 +0300

    Bug 16371: Add database updates
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e818915bec60fd579ed17c45d19b1f32a18e743
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Thu Jul 9 11:55:03 2020 +0300

    Bug 16371: Fix QA issues, change terminology
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27fb149673bf30eea38f1888159c866960aa0b54
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Mon Apr 27 08:55:38 2020 +0300

    Bug 16371: Fix tests
    
    Tests failed due ids already existing in 'quotes' table.
    This patch removes hardcoded ids from tests.
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38b05bcd2721d9e65d2b2f4a12a64b4fa7ead593
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Tue Apr 14 12:51:50 2020 +0300

    Bug 16371: Use multi-select on syspref
    
    This patch replaces textbox with multi-select dropdown on
    syspref 'QuoteOfTheDay' and changes tests to match this change.
    
    To test:
    1. Check 'OPAC', 'staff client' or both on 'QuoteOfTheDay'.
    2. Make sure that quote is displayed on (both) mainpage(s).
    
    Prove t/db_dependent/Koha/Quotes.t
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13d9bdc74417f337106070f85332a7ef24331878
Author: Olli-Antti Kivilahti <olli-antti.kivilahti@jns.fi>
Date:   Mon Apr 25 11:22:04 2016 +0300

    Bug 16371: Quote of the Day (QOTD) - Display in different interfaces
    
    Set 'QuoteOfTheDay'-syspref to 'opac intranet' to allow displaying news in the
    opac and the staff client.
    
    Add 'commandline' to allow news in the commandline (where applicable)
    
    Accepts all values accepted by the C4::Context->interface()
    
    Test plan:
    1. Set 'QuoteOfTheDay' syspref as 'intranet' or 'opac' or both
    2. Check that quote is visible on both mainpages
    
    Prove t/db_dependent/Koha/Quotes.t
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a923dccab30c2a87cd1f14b60280cf31f8c4f62e
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Tue Apr 7 11:53:17 2020 +0300

    Bug 16371: Add needed Koha::Exception
    
    Add Koha::Exception needed in this bug.
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77d97dc60ef6663937207af5c9e237ef70de4229
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Mon Apr 20 15:20:18 2020 +0300

    Bug 16371: Rename test file
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f32f92cb577e01d638b1adbc3f065b511eb77d4a
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Fri Apr 17 11:28:55 2020 +0300

    Bug 16371: Move GetDailyQuote to get_daily_quote
    
    This patch moves subroutine 'GetDailyQuote' to new
    Koha::Quote object and adjusts tests.
    
    To test:
    1. Set 'QuoteOfTheDay' as 'enable'
    2. Check that quote is displayed on OPAC mainpage
    
    Prove t/db_dependent/Koha/GetDailyQuote.t
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c01343a360419752f6c5e198ee22e6857b5d670
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Fri Apr 17 10:57:27 2020 +0300

    Bug 16371: Add Koha::Quote[s] classes
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d7e7fc066c93b3893527ec3de0e34b2fc4fe58f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 11 12:41:57 2020 -0300

    Bug 25348: (QA follow-up) Silence irrelevant warnings
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed6a65c1ddacaa80fe825056cc77c3a3170af683
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri May 1 12:24:44 2020 -0400

    Bug 25348: Add support for circulation status 12 ( lost )
    
    We should support the SIP2 "circulation status" value 12, "lost".
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/SIP/Transaction.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca44a3f2ca82371bd6a2d731b7b4fd185d9fd93a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri May 1 12:16:48 2020 -0400

    Bug 25347: Add support for circulation status 11 ( claimed returned )
    
    Now that we have return claims in Koha, we should support the SIP2
    "circulation status" value 11, "claimed returned".
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/SIP/Transaction.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be719f30e4142e92d23f3a0566eca93f75224fc3
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri May 1 12:04:37 2020 -0400

    Bug 25344: Add support for circulation status 10 ( item in transit )
    
    We should support the SIP2 "circulation status" value 10, "in transit
    between library locations"
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/SIP/Transaction.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f916269465df99818fb15c108820d3b666968d39
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 31 11:14:20 2020 -0300

    Bug 26114: ILL should mark status=RET only if a return happened
    
    The original code assumed every codepath should be trated as a
    successful check-in. Such is not the case and the regression tests
    verify that the code acknowledges this.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Illrequests.t
    => FAIL: Tests fail
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b106ed9c4b0588502c6dd485de2aec6a80b32c6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 31 11:14:09 2020 -0300

    Bug 26114: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba8eeca3865bfcd77717e7a225279d5fb77c9989
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 12 14:44:52 2020 -0300

    Bug 26132: (QA follow-up) Make tests more robust
    
    Tests fail is SearchEngine is set to Elasticsearch. This patch makes
    tests build 'real' biblios.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0dd05fc90a735b9e22359fcb461bdc9291e7a85f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 4 19:01:30 2020 +0000

    Bug 26132: (follow-up) Count all checkouts if no limits needed
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53bd7b4075bef3f9ddbf6aeec561d99579fdd6e7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 12:22:06 2020 +0200

    Bug 26132: Tidy _check_max_qty
    
    This is only a perltidy of _check_max_qty to remove some space
    inconsistencies, like:
      if( $max_checkouts_allowed eq '' ){ return;}
      if ( $checkout_count - $onsite_checkout_count >= $max_checkouts_allowed ) {
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6f819840a891e493582026c307797ef7d31c5f0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 12:21:26 2020 +0200

    Bug 26132: Don't prefetch if not needed
    
    We only need to prefetch items if CircControl is set to ItemHomeLibrary
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7fcd69a11d4914dc6f3212192d90a06ecab12c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 12:12:56 2020 +0200

    Bug 26132: Remove raw SQL query for patron_maxissueqty
    
    Same as before but for patron_maxissueqty
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1af5b8a7d72c8e49f857907c85809a38ee5b1a07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 12:05:53 2020 +0200

    Bug 26132: Remove raw sql query
    
    Making use of Koha::Checkouts make the code much more readable here.
    It fixes 2 flaws:
     * $type was not quote escaped
     * the effective itemtype was not used which could lead to wrong
     calculation (for instance item-level_itypes is set but the item does
     not have the itype defined)
    
    However there is something to note, we are going to make things a bit
    less effective as we are now fetching the items to get their effective
    itemtype (vs a SUM done at DB level)
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3239993fb1f3eafb2eca4004d5bd9a74e9995c1e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 3 18:25:10 2020 +0200

    Bug 26132: TooMany refactoring
    
    The different calls to _check_max_qty can be improved to highlight what
    is really changing between each of them.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee8fe4d35127904e59038b6a5dd77a8096d98624
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 10:14:49 2020 +0200

    Bug 21946: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed3e4540d73c1c3009375ad339e09a2e676fa1bd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 08:00:23 2020 +0000

    Bug 21946: DBRev 20.06.00.022
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0dad7ba511c5e387277ea5cbd6056c66f9fe4b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 10:39:24 2020 +0200

    Bug 21946: Restore defined vs ""
    
    The tests still pass. Was the original change really useful?
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6dfd6801f20b0faa5e2b6ea4f783a4e3233f2de
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 3 12:27:15 2020 +0000

    Bug 21946: (follow-up) Restore join to biblioitems
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a86a1a74b98ed92e27e9f16d4336555dd763bce4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 29 12:08:22 2020 +0000

    Bug 21946: (follow-up) Add a hint
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccc7b3c8947c190b511ce5535382e50793f24c26
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jul 28 13:17:54 2020 +0000

    Bug 21946: (follow-up) Add optgroup label in circ rules
    
    This patch adds a label to the optgroup showing child itemtypes in the
    circulation and fine rules interface.
    
    The parent itemtype description is the optgroup label, and then the
    parent itemtype is repeated as an <option> with the additional label
    "All"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6655961517b36c16b92ca5880f4dcf260ce4052f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 17 15:18:09 2020 +0000

    Bug 21946: Add test for parent method
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6f2c4ac2d714edc1e35e3eb7749f9bb512c1a62
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 8 12:30:41 2020 +0000

    Bug 21946: Update unit tests to pass under ES
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ebc85da16f5cbc48bf4041ef8b0cc9b1d794f9f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 9 20:00:16 2019 +0000

    Bug 21946: Display parent-child relationship on smart-rules.pl
    
    To test:
     1 - Set some itemtypes to have a parent
     2 - Browse to Administration -> Circulation and fines rules
     3 - Note new description of parent/child relationships at top of page
     4 - Note that itemtype dropdown for circ rules shows child types under parents
     5 - Set a rule for a child type
     6 - Note it displays as Parent->Child
     7 - Have three child types under a parent
     8 - Set the parent 'Current checkouts allowed' to 3
     9 - Set the children 'Current checkouts allowed' to:
         type1 = 2
         type2 = 1
         type3 = 1
    10 - Create some items of the type above
    11 - Note you can checkout 2 of type 1, and not 3
    12 - Note you can checkout 1 of type 2, but not 2
    13 - Note that you now cannot checkout any of type3
    14 - Note you cannot checkout any of the parent type
    15 - Return one of the other items and note you can now checkout an item of type3
    16 - Return another item and note you can checkout an item of the parent type
    17 - Return all
    18 - Set the parent type to 1
    19 - Now note you can only checkout 1 of any of the children
    20 - Set the parent to 0
    21 - Note you cannot checkout any of the child types
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 453fd5ce9012e247d552e7f93c367e4810de0939
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 2 14:47:16 2019 +0000

    Bug 21946: Update Administration->Item types to allow for defining parent types
    
    To test:
    1 - Browse to Administration -> Item types
    2 - Not a new colum for prent type
    3 - Edit an existing type and not you can select any type (except the current) as a parent
    4 - Select one
    5 - Edit the type you selected as parent
    6 - Note it cannot have a parent defined
    7 - Edit a new type, note you can select a parent
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f3a0a4b89c78c9fff1673787893067f66970cf4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 1 09:57:50 2019 +0000

    Bug 21946: Update C4::Circulation->TooMany to check parent itemtypes
    
    To test:
    1 - prove -v t/db_dependent/Circulation/TooMany.t
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    JD amended patch: tidy the subtest
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0545feb876f3bc673ee7a5f4de2fc66644cb35c6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 13 00:36:48 2019 +0000

    Bug 21946: Database updates
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0570d1fd24fff4e23adc2f0de4e4f9bdc0a98d8f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 13 08:09:10 2020 +0200

    Bug 26179: Add Timothy Alexis Vass to contributors
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b342c81a044baeb8220e8a80ad8349adf8ff5b0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 12 14:03:00 2020 +0200

    Bug 5428: Add searchid to the "Return to the record" button (batch del)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf6d7d18bc68c47fc02038a21e33d7cf816f25ab
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 7 00:43:29 2020 +0000

    Bug 5428: (QA follow-up) Add searchid for deleting items in a batch and editing in batch
    
    To test:
    0 - Perform a search in the staff client
    1 - Click a title to go to the details page for a record
    2 - Click the 'Edit' button and select 'Edit items in a batch'
    3 - Note the searchid is in the url
    4 - Make a change and hit 'Save'
    5 - Note the 'Return the the record' link at the top, and the button on the bottom include searchid in URL
    6 - Click one and note the brwoser is stil there
    7 - Click 'Edit' and select 'Delete items in a batch'
    8 - Delete one item
    9 - Click return to record
    10 - Browser is there
    11 - Click 'Delete items in a batch again
    12 - Select all and check 'Delete records if no items remain'
    13 - Delete them
    14 - Note you have a link to 'Go back to the results'
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2bb09975bc5efc336e77b04e5f5f791aad3d6f76
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 14:36:38 2020 +0200

    Bug 5428: Jump back to the search result after deleting a record
    
    This patch adds the ability to jump back to the search result after a
    record has been deleted.
    Also it keeps the "browser" when all items are deleted from a
    bibliographic record
    
    Test plan:
    - Start a new search
    - Select a record with items
    - Delete all the items
    => You still see the browser
    - Delete the record
    => You are back to the adv search form but we new link "Go back to the
    results" is present at the top of the page
    
    Limitation: As we delete the record we do not longer know the offset,
    we are back to the first page of the result list
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 488e76ea3a6e0591bc6134947011d990c81190eb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 13 20:09:17 2020 +0000

    Bug 20154: Stay in the open tab when editing authority record
    
    This patch adds some JavaScript to the authority record detail page in
    the staff interface so that clicking "Edit" will take you to the
    authority edit page while keeping the same tab open.
    
    To test, apply the patch and locate an authority record in your catalog.
    
     - Click any of the numbered tabs besides tab 0.
     - Choose "Edit record" from the "Edit" dropdown menu.
     - When the authorities edit page loads the same tab should be
       preselected.
    
    Signed-off-by: Marjorie <marjorie.barry-vila@collecto.ca>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75e25c9d38edc86f7cd545e55b919624f92e2716
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 27 15:57:40 2020 +0000

    Bug 21345: Patron records with attached files not obvious from patron details view
    
    This patch adds a section to the patron details page for listing files
    which have been attached to the patron record.
    
    To test, apply the patch and enable the EnableBorrowerFiles system
    preference.
    
    - If necessary, attach some files to a patron record by viewing a patron
      record and choosing "Files" from the sidebar menu.
    - View the detail page (moremember.pl) for a patron who has files
      attached.
    - You should see a new section under "Alternative contact" with the
      heading "Files."
      - Test the "Manage" button to make sure it takes you to that patron's
        files.
      - Confirm that all the attached files are listed.
      - Confirm that the links to each file work correctly.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: replace a html filter with uri
    
    Bug 21345: (follow-up) Hide files information if EnableBorrowerFiles is disabled
    
    This patch wraps the new patron file information in a check for the
    EnableBorrowerFiles system preference.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0629d4082fec2474a25c18fca4f134d4b75c3ad3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Dec 2 16:42:59 2019 +0000

    Bug 24134: Add placeholder for 2 digit years to allow autogeneration of dates in 008
    
    This patch modifies the code for parsing MARC framework configurations
    so that the placeholder "<<YY>>" translates to a two-year date.
    
    To test, apply the patch and modify a framework to include placeholders.
    For example, in MARC21:
    
     - Administration -> MARC structure -> 952 -> Edit subfields -> d
     - Expand "Advanced constraints" and add a default value:
       <<YYYY>> <<YY>> <<MM>> <<DD>> <<USER>>
     - Save your configuration and go to Cataloging.
     - Go to the add/edit items page for a record which uses the framework
       you edited.
     - In the "Add item" form, in the "Date aquired" field, you should see
       the correct values. For example: '2019 19 12 03 Leonard'
    
    Perform the same test when adding an item during the Acquisitions
    process (depending on your AcqCreateItem setting).
    
    Note that acqui/neworderempty.pl has been modified because the
    placeholder-replacement code is repeated there, but I couldn't discover
    how to test it (if it is used at all?)
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca3f7ceb2a5e1dc6d62b4500392ec9ca834c0b48
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Sun Aug 2 16:49:59 2020 +0000

    Bug 24176: Add datalastseen column to holdings table
    
    This patch adds the datelastseen column to the holdings table and also makes it column configurable.
    To Test:
    -Apply patch and have a look at some item records.
    -Notice the datalastseen column
    -Make sure it wroks and its displaying the datelastseen correctly
    -Go to the column configuration tools and make sure you can properly hide this column.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d519c897743d000e445ea97ddf4045e296ea9b6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 11 11:45:14 2020 -0300

    Bug 24306: (QA follow-up) Fix the XML
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 948a7c5f74b461b0d7a6438a49d2ea64dcb2428b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jul 28 12:01:05 2020 +0000

    Bug 24306: (follow-up) Add documentation for debug option
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 510ee8a1a38ee18fc38ff33c6351798aa656d814
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Dec 24 13:59:02 2019 +0000

    Bug 24306: Add debug switch to koha-indexer
    
    This raises the debug level a lot, it it a bit overwhelming, but may be useful in debugging indexing issues
    
    To test:
    1 - Apply patches
    2 - sudo koha-indexer --stop instance
    3 - sudo debian/scripts/koha-indexer --start --debug instance
    4 - tail -f /var/log/koha/instance/indexer-output.log
    5 - Note you get a listing that nothign in the queue
    6 - Go to staff client and make a change to a record
    7 - Note the logs have tons of info
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d09fbb284b50d12783f76fd58400d093f84ce159
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 3 14:51:42 2020 +0100

    Bug 25663: Remove Koha::RefundLostItemFeeRule and uses
    
    This patch replaces all calls to RefundLostItemFeeRules with
    Koha::CirculationRules->get_lostreturn_policy and removes the module it
    makes redundant.
    
    Test plan
    1/ Confirm that there are no longer any uses of RefundLostItemFeeRules
    in the codebase
    2/ Confirm circulation tests still all pass
    3/ Confirm you can still set and unset the lost return rules
    4/ Signoff
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc882fcb13569a2ef8858bfa41856e7df4992388
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 3 12:59:21 2020 +0100

    Bug 25663: Add get_lostreturn_policy method to CirculationRules
    
    This patch adds a new get_lostreturn_policy method to
    Koha::CirculationRules which returns a boolean to the caller which
    denotes whether a refund should be applied or not on the return of
    a lost item.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e234eb84e103ae8fb29d81bf4702342a0faf5c91
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 3 14:13:22 2020 +0100

    Bug 25663: Add unit tests
    
    This patch adds unit tests for a new get_lostretun_policy method which
    is getting added to Koha::CirculationRules.
    
    Test plan:
    1/ Read the additions to t/db_dependent/CirculationRules.t code
       and compare to the t/db_dependent/RefundLostItemFeeRule.t.
    2/ Run the test after applying the patch that adds the new method
    3/ If the tests all pass, signoff
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4de06b1711a3838adb79b6c33f6a5dd8a59e5bae
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Aug 8 13:30:35 2020 +0000

    Bug 25879: (follow-up) Update overlooked guarantor markup
    
    This patch updates another section of guarantor markup which should have
    been updated with the others.
    
    To test, apply the patch and locate an adult patron.
    
     - Click "Add guarantee"
     - Confirm that the part of the form for adding a guarantee looks
       correct.
     - Confirm that the new patron information is saved correctly.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec630b4b6c9949a51e8491c0c8b3e30d3a43df50
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jun 26 18:51:15 2020 +0000

    Bug 25879: Improve display of guarantor information in the patron entry form
    
    This patch makes some changes to the patron entry template to improve
    the display of guarantor information.
    
    To test, apply the patch and locate a patron with a "Child" type
    category.
    
     - Edit the patron's record
     - Under "Guarantor information," click the "Search to add" button.
     - Search for and select a patron.
     - The guarantor information should be added to the patron edit
       form. The information should be correct and well formatted.
     - Click the "Remove" link. The guarantor information should be
       removed.
     - Search for an select a guarantor again and save the record.
     - Edit the patron record again. The saved guarantor information should
       look correct.
    
    Looks great!
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd29f99a8627d08a6e5c2fdcf3d312dfd7260020
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat Jul 11 12:09:49 2020 +0000

    Bug 25906: Style corrections for OPAC serial pages
    
    This patch makes some CSS changes to the OPAC SCSS and to the OPAC
    "full serial issues" page to improve the style.
    
    I've expanded the in-page CSS on the full serial issues page for
    readability and added Template Toolkit's "collapse" filter to remove the
    whitespace on rendering.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    
    - Locate a serial record in the OPAC.
    - Click "More details" to view the issues page.
    - Confirm that the "view" tabs look correct, with consistent padding.
    - Click the "Full history" tab.
    - In the sidebar, the filter should have full-width dropdowns and clear
      button.
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db1587520778bd940da389fab8f46a12c1c11f73
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 17 14:43:39 2020 +0000

    Bug 26008: Remove the use of jquery.checkboxes plugin from OPAC cart
    
    This patch removes the use of the jquery.checkboxes plugin from the OPAC
    cart and replaces its functionality with "plain" jQuery.
    
    To test, apply the patch and add some items to the Cart in the OPAC.
    
     - Open the Cart window in the OPAC by clicking the "Cart" link in the
       header.
     - Test that the "Select all" and "Clear all" links work correctly to
       check and uncheck all checkboxes.
       - Controls like "Remove" and "Place hold" should be enabled or
         disabled according to whether there are any checked checkboxes.
     - Test that manually checking a checkbox correctly enables or disables
       the link options too.
     - Test that the "Remove" or "Place hold" controls work correctly,
       applying to only the checked checkboxes.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26008: (follow-up) Removed checkboxed class
    
    This patch removes the "checkboxed" class which was previously
    associated with the jquery.checkboxes plugin and is now obsolete.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4cf5ef239f1e1a05c277a91f73b6fcd245eb5ec0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 17 17:29:15 2020 +0000

    Bug 26010: Remove the use of jquery.checkboxes plugin from staff interface cart
    
    This patch removes the use of the jquery.checkboxes plugin from the
    staff interface cart and replaces its functionality with "plain" jQuery.
    
    To test, apply the patch and add some items to the Cart in the staff
    interface.
    
    - Open the Cart window in the staff interface by clicking the "Cart"
      link in the header.
    - Test that the "Select all" and "Clear all" links work correctly to
      check and uncheck all checkboxes.
    - Test that the "Remove" or "Place hold" controls work correctly,
      applying to only the checked checkboxes whether they were checked
      using "Select all" or by manually checking them.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b332e0912d8883928061b10e87d0b8f3e7c9c30d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 29 13:49:16 2020 +0000

    Bug 26087: Add table configuration and export options to orders by fund report
    
    This patch adds column configuration to the orders by funds report
    results table. The "Basket" column is excluded from being togglable.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Go to Reports -> Orders by fund
    - Submit parameters which will return multiple results.
    - Test that the "Column visibility" button works to show and hide
      columns. The "Basket" column should be excluded.
    - Test the export options (Excel, CSV, etc)
    - Go to Administration -> Columns settings and edit the default
      configuration of the orders by fund report. Confirm that these changes
      are reflected in the report results.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dc25f3192e4d32a07b2cbaec653b98dca9618c5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 29 16:21:10 2020 +0000

    Bug 26091: Add column configuration and export options to catalog statistics report
    
    This patch makes the catalog statistics report output a DataTable with
    on-the-fly column configuration and export options.
    
    Because the report can generate results with an arbitrary set of table
    headers, the columns set to be passed to DataTables is built on the fly
    along with the table. There is no global table setting.
    
    Since the "grand total" cell might reflect a total which includes hidden
    columns, the table footer label now indicates "all results."
    
    To test, apply the patch and go to Reports.
    
    - Submit a query to the "catalog" statistics wizard which will return
      multiple results.
    - On the results page, confirm that the DataTable displays correctly and
      that all controls work as expected, including column configuration and
      export options.
    - Submit other queries which will return a different set of columns in
      the result. Confirm that everything continues to work as expected.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26091: (follow-up) Remove unused TablesSettings usage
    
    Since the table column information is built in the template rather than
    in the columns_settings YML file we don't need "USE TablesSettings" in
    this template.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ceb44ba2d9ae40d0c0230b009dcd6850bc27d46
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 6 14:33:32 2020 +0100

    Bug 26160: Make POS items table configurable
    
    1)  System preference:  EnablePointOfSale - set to Enable
    2)  System preference:  UseCashRegisters - set to Use
    3)  Administration > Accounting > Cash registers - create a new cash register for the library you're logged in as
    4)  Administration > Accounting > Debit types - create at least one debit type
    5)  Home > Point of sale - verify that all four columns exist in the Items for purchase table:  Code, Description, Cost, Action
    6)  Administration > Additional parameters > Table settings > Point of sale - change which columns can be hidden and/or toggled
    7)  Home > Point of sale - verify that your choices have been implemented (columns are hidden, columns can be toggled, columns can't be toggled)
    8) Repeat steps 6 and 7 for different combinations, checking that they all work.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Added Sally's test plan.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3138c48f69ff19493c7433145144c06a077825be
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 6 15:22:07 2020 +0100

    Bug 26161: Move actions under rhs fieldsets
    
    This patch moves the action buttons div to within the column div that
    contains the 'This sale' and 'Collect payment' fieldsets.
    
    Test plan
    1/ Apply patch
    2/ Navigate to the 'Point of sale' page (having enabled UseCashRegisters
    and EnablePointOfSale)
    3/ Confirm the 'Confirm' and 'Cancel' button/link now appear on the
    correct side.
    4/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d2a988809eddc4cdd3469aa5dc2a8f25252306b
Author: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
Date:   Fri Aug 7 14:59:16 2020 +0200

    Bug 26179: Remove redundant import of Google font
    
    Removed redundant @import of google font
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed4fc5889467bde858cfd4ac573cd40a5b4279c5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 16:49:14 2020 +0200

    Bug 26012: Correctly format "paid for" info on the item details view
    
    The string is built controller side, which does not let the template
    format the info nicely.
    We want to display patron's info using patron-title.inc and the date
    with the KohaDates plugin
    
    Test plan:
    - Make sure there is a replacement cost in the item
    - check it out
    - Mark it lost
    - Pay the lost item fee
    - Go to the detail page and look on the items tab for the item
    - It will show an entry with "Paid for?" label
    The patron's info and date must be correctly formatted
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81f06881a45d7647481aa8a21354a772f3daff88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 7 12:44:28 2020 +0200

    Bug 26165: Fix duplication of large saved reports
    
    If the combined character length of a saved report's
    title, notes and SQL is too long then pressing the
    'duplicate' button will lead to an error:
    
    "Request-URI Too Long
    The requested URL's length exceeds the capacity limit
    for this server."
    
    Test plan:
    1. Create a simple SQL report and add a lot of text
       into the notes field (the combined URL lenth must be
       >8225 characters)
    2. Save the report
    3. Press the duplicate the report from the saved reports page
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19d9ba176dea6b7816a33b014a5f9e309af53dc0
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Jun 29 15:07:10 2020 +0200

    Bug 23542: Fix SRU import encoding
    
    When importing records from a SRU server, the diacritics have bad encoding.
    I reproduce with BNF server so it may be a UNIMARC issue.
    
    Tests show that difference between Z39.50 server and SRU is that leader contains 'a' at postion 9.
    Looking at MARC::Record->encoding() shows that encoding depends on leader even for UNIMARC.
    So this patch adds a call to MARC::Record->encoding('UTF-8') in case of a SRU server in C4::Breeding.
    
    Same use exists in Koha::MetadataRecord::Authority::get_from_breeding().
    
    In case of import via Z3950, MarcToUTF8Record() is called,
     which calls SetMarcUnicodeFlag(),
     which calls MARC::Record->encoding('UTF-8')
    
    Test plan :
    1) Use a UNIMARC database
    2) Configure a connexion to a UNIMARC SRU, for example BNF,
       see https://doc.biblibre.com/koha/autour_de_koha/serveurs_z3950_sru#serveur_de_la_bnf
    3) Go to cataloguing module
    4) Click on 'New from Z39.50/SRU'
    5) Choose only the SRU target
    6) Search for ISBN 2266072889
    7) Confirm you see good encoding : diacritic on 'a' of title 'Strate-a-gemmes'
    8) Click on 'Marc preview'
    9) Confirm you see good encoding
    10) Click import
    11) Confirm you see good encoding
    12) Check also Authorities import via SRU
    13) Check also SRU imports on a MARC21 database
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Removed change to new_from_xml call. We should respect syntax.
    But the added MARC::Record encoding does the tric! Which is implicit
    for Z3950 targets where MarcToUTF8Record does the same.
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2b2426de842ac86048cbf71e3760b6483fc0b3c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 26 13:19:47 2020 +0000

    Bug 25882: Remove phr indicator from limits when processing
    
    We assume all limits from advanced search to be a phrase and quote them
    when doing this we should remove the phrase marker to avoid doulbe quoting
    
    To test:
     1 - Have koha using ES
     2 - Go to advanced search
     3 - Limit by a single itemtype that exists
     4 - Get some results
     5 - Limit by a different itemtype that exists
     6 - Get some results
     7 - Limit by both itemtypes
     8 - Get only the results for the second itemtype
     9 - Enable DumpTemplateVarsIntranet and DumpSearchQueryTemplate
    10 - Repeat search
    11 - View page source and find 'search_query'
    12 - See limit looks like itype:("("BK")" OR "("CR")")
    13 - Apply patches
    14 - Restart all the things
    15 - Repeat search for both itemtypes
    16 - Note results now include both types
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a2d7f1eacc0722ea0723577823ee6a477a46b0a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 26 13:19:32 2020 +0000

    Bug 25882: Unit test
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70ff3bafa05a30944962747953c70bb8dc3c1ab8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 11:59:58 2020 +0200

    Bug 26162: Wait for the table to be refreshed
    
    The previous patch did not work as expected. We still got a
    StaleElementReference exception.
    But this time on
    10:43:47 selenium_1   | Caused by: org.openqa.selenium.NoSuchElementException: Unable to locate element: {"method":"xpath","selector":"//*[@id=\"branchname\"]"}
    Because we found the one that existed on the page, not the one sent back
    in AJAX.
    
    The idea of this patch is to search for the "Showing 1 to X of Y entries" info and wait for X == Y
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b8664b5590cdffc2579bebc1fd6435fe236d879
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 10:00:34 2020 +0200

    Bug 25826: fix failing test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 233e3efba308fe63e7e40caa7830ec83e4770d13
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 10 09:57:23 2020 +0200

    Bug 24201: fix failing tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 692191692429661e5b6a35a5e8198976c4f73cdc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 7 15:38:54 2020 +0100

    Bug 24201: (QA follow-up) Replace library select
    
    Removing the library select entirely results in a JS failure for desk
    selection when independant branches is enabled and the user does not
    have permission to select a library.
    
    This patch adds a hidden select element so we can still grab the current
    branch from the selection.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e440c07bd5d574e3202cb94846fe5d898fe0a0d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 7 15:20:55 2020 +0100

    Bug 24201: (QA follow-up) Make logic consistent
    
    The display logic for the desk details in the header bar was
    inconsistent between the narrow display view and the full width display
    view.  This patch updates the former to match the latter.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d2b53c1b84cedbf264c9edf82b51f808396e1ac
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 7 13:37:30 2020 +0100

    Bug 24201: (QA follow-up) IndependentBranches
    
    This patch updates the IndependentBranches template display logic such
    that the 'Select desk' and 'Select library and desk' options appear
    correctly when IndependentBranches is enabled.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a525c1cf702c6b90a0d7ab06eb50156d5e1d2ed
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 7 11:47:39 2020 +0100

    Bug 24201: (QA follow-up) Add 'and desk' to menus and title
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82817e808fcc06aad887430548af2071a4848796
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Aug 5 05:04:18 2020 +0000

    Bug 24201: (QA follow-up) Another capitalization fix
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9b051baf7b92ab7482b74f8308298f2a151c198
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 4 12:49:54 2020 +0100

    Bug 24201: (QA follow-up) Correct call to set_userenv
    
    One call to set_userenv had been implimented incorrectly with the
    parameters out of order.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16979c2afc45377bd2a4dcc3c50b3d2fa6771026
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 4 12:30:03 2020 +0100

    Bug 24201: (QA follow-up) Capitalisation fix
    
    'Set desk' vs 'Set Desk'.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2572c0e0233927d56c1cf29ecac1eff75a025cb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 4 12:28:44 2020 +0100

    Bug 24201: (QA follow-up) Only display desks picker if enabled
    
    I missed a case on the authentication page with the prior patch of the
    same name.
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f726d334085636146ae7bad56242e6129dcc493
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Aug 3 07:41:47 2020 +0000

    Bug 24201: (QA follow-up) Make desk and branch selects on login page consistant
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d1ba3487d167bda878069c9f0269ebba64ab30d
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Aug 3 07:37:10 2020 +0000

    Bug 24201: (QA follow-up) Remove setdesk variable and add desk selection script only on pages in need
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d79a19d3a0c32bd40279f138c3ca367042c290f9
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Aug 3 07:29:15 2020 +0000

    Bug 24201: (QA follow-up) Fix desks select box selected attribute
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45e1f325d590aaf8c46513d5eef0bd17e31d804c
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Aug 3 07:14:51 2020 +0000

    Bug 24201: (QA follow-up) Remove unneeded use
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad9fdd792a4433d2ea5ea58a081f036d4230fdb8
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Aug 3 07:11:49 2020 +0000

    Bug 24201: (QA follow-up) Do not unbless a list from search in Desks template plugin
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f96bea8bab9d2c259ef354bca5c554c351c5403
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 20 13:38:34 2020 +0100

    Bug 24201: (QA follow-up) Re-indent helpers
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50e1f1abc1e1e9bb7294194aeba480f0441bd4b2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 20 13:37:59 2020 +0100

    Bug 24201: (QA follow-up) Hide header if desks disabled
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a02e9e3d9107e4ae4b2a03128d53c786766d2582
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 20 13:20:39 2020 +0100

    Bug 24201: (QA follow-up) Remove deprecated template file
    
    The controller associated to this template was deprecated earlier in
    this patchset, but the template was left behind.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4163f24014addb4cc5fddbb854f84617ffffb988
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Tue Apr 28 12:02:15 2020 +0200

    Bug 24201: (follow-up) add desk choice with library choice
    
    You should be able to add desk choice when you are logging in or
    changing library.
    
    Test plan:
    
    1. apply patch
    2. have at least three libraries, one without desk, one with one and
    one with a few.
    3. At login, when choosing a library, it should enable all desks it
    has. Pick one.
    4. the desk id and name should be set in your session and appear in
    the top right, next to the library name.
    5. change library and desks from intranet (at the set-library.pl page)
    6. you should have the same behaviours
    7. if you have a library without a desk, it should prompt you a '---'
    option and no desks will be attached to the session.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d7fd8c09265880bf7ec548877569d698d14cdbb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 26 14:49:27 2020 +0000

    Bug 24201: (follow-up) Rework Desks Plugin
    
    This patch removes unused plugin methods (they can be re-introduced in
    subsequent bugs where they are used) and merges the 'all' and 'defined'
    methods into a ListForBranch method that returns a list of desks
    associated with the logged in branch.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 876d95285ef06224b0d50249b7096b55abff400d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 26 13:49:57 2020 +0000

    Bug 24201: (follow-up) Use GetLoggedInDeskName
    
    This patch updates the templates to use the new TT plugin instead of
    adding additional variables to the already crouded get_template_and_user.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cee6b7025e42c4e69d7dca0f4c852c66c939e36
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 25 12:13:10 2020 +0000

    Bug 24201: (follow-up) Show desk information at lower screen widths
    
    The staff client header menu adjusts responsively to narrower viewport
    widths, but for the logged-in-user menu this requires showing and hiding
    part of the template which duplicates information. This patch adds a
    copy of the current desk information to the part of the template shown
    at narrower widths.
    
    To test, apply the patch and view any page in the staff client.
    
     - Narrow your browser so that the viewport is less than 800px wide.
     - The logged-in-user menu should change from text to a single "user"
       icon.
     - Clicking the icon should display a menu which includes labeled
       information about the current desk.
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fc961b7c263a74da4759c70a3acff00eee71ec1
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Tue Dec 10 15:02:31 2019 +0100

    Bug 24201: Attach desk to intranet session
    
    When Desks are defined, a librarian can attach a desk to its session.
    
    Test plan:
    
    1. apply 13881 and create some desks
    2. you should see “NO DESK SET” in the intranet header
    3. go to circulation > Set desk
    4. you should see your desk name in the header, whatever the page
    5. you can also set desk with the header menu
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df0ef02de5e4efe23aafab77e25d0e19f658151c
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 10 11:19:47 2020 +0200

    Bug 24591: Add --help option to misc/devel/get-prepared-letter.pl
    
    Also fix code style with perltidy
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f74ab4e9de75b53dc7040814b1f25ae282a81106
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Feb 5 12:20:37 2020 +0100

    Bug 24591: Add developer script to preview a letter
    
    The script is very simple, it just calls GetPreparedLetter with
    arguments given on command line and print the resulting letter content
    
    Usage example:
    
    misc/devel/get-prepared-letter.pl --module circulation \
        --letter_code ODUE --tables '{"borrowers":1,"branches":"CPL"}' \
        --repeat '{"item":[{"biblio":1,"items":1}]}' \
        --loops '{"overdues":[1]}'
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Works for the example and other cases.
    Correct option is 'letter-code', with dash, not underscore.
    An usage message would be nice.
    No errors
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: tidy the new file and rename it matching the other
    scripts' names in this directory
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3abc4fb8584e0df2b71dd9d38f033e34b205e829
Author: David Roberts <david@koha-ptfs.co.uk>
Date:   Sun May 3 23:48:09 2020 +0000

    Bug 25336: Show checkouts/fines to guarantor is in the wrong section of the patron file
    
    This patch moves the "Show checkouts to guarantor" and "Show fines to
    guarantor" data to display under the Contact information block
    
    To test:
    
    1) Enable the AllowStaffToSetCheckoutsVisibilityForGuarantor and AllowStaffToSetFinesVisibilityForGuarantor system preferences to Allow
    2) View a patron record.
    3) The "Show checkouts to guarantor" and "Show fines to guarantor" field
    will be on the right hand side of the screen under the Library use
    block.
    4) Apply patch
    5) Check that this data has now moved to the Contact information block
    on the left hand side of the patron record.
    
    Works for me!
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a40f71075c7dff1d9a99ab66b4210849c506648
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 6 18:19:58 2020 +0000

    Bug 25606: (QA follow-up) Don't show remove all button if no reserves
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cf05ff53d7284500a2653f7b0988d6a46a7ea13
Author: Joe Sikowitz <joe@flo.org>
Date:   Sat May 23 17:45:51 2020 -0400

    Bug 25606: Remove all reserve items button
    
    Adds button to course records to remove all attached reserve items. A warning dialog box will appear before executed.
    
    Test plan
    1. Install patch
    2. Log in as user with permission to delete reserves
    3. View a course reserve record with multiple items attached
    4. There should now be a button that says "- Batch remove reserves"
    5. When you click the button a dialog box should appear with a warning
    6. Click "Ok"
    7. All course reserves should be removed from the record
    8. Add an item to more than course record
    9. Redo 3-7
    10. Items should have been removed from that course but remain on all other courses
    11. Log in as a user without delete reserves permission
    12. You should not see the batch remove option
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27ff36825dd6ac8f87dc7d380c60f21e8170dea6
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jul 18 10:24:23 2020 +0000

    Bug 25919: Only show Desks in admin navigation when UseCirculationDesks is used
    
    We were missing a check for the UseCirculationDesks in the
    template so the "Desks" link would only appear in the admin navigation
    when the pref feature is activated.
    
    To test:
    - Turn off UseCirculationDesks
    - Go to any administration page that shows the navigation on the left
    - Verify Desks shows
    - Apply patch
    - Reload the admin page - Desks should be gone
    - Turn on UseCirculationDesks
    - Verify the Desks reappear
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7661a37e657141b994d74398dd8e1b96d1da117
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jul 18 01:53:34 2020 +0000

    Bug 25853: Fix file permissions for update_patrons_category script
    
    The permissions for this were -rw-r--r-- and need to be -rwxr-xr-x.
    
    To test:
    - Verify the file permissions before and after applying the patch.
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d08ce1d9406feca7bc7e5ab0be58efea94c7a2e5
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Aug 6 19:15:44 2020 +0000

    Bug 26009: (QA follow-up) It does not harm to test more
    
    Test plan:
    prove t/db_dependent/Koha/SearchEngine/Elasticsearch/QueryBuilder.t
    --> should return green
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dd1672c1b2f15e0b6be6071b6915c927c3a2ecc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 17 16:23:42 2020 +0000

    Bug 26009: Add facet size to home/holdingbranch
    
    To test:
    0 - Set DisplayLibraryFacets to 'both' and FacetMaxCount to 20
    1 - Have more than 10 branches
    2 - Have items in each of those branches
    3 - Enable ES, set system preference SearchEngine to Elasticsearch
    4 - Search for '*'
    5 - Expand homebranch/holdingbranch facets
    6 - Note you only get 10
    7 - Apply patch
    8 - Repeat search
    9 - Now you get all your facets
    
    Signed-off-by: Michael Springer <mspringer@mylakelibrary.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44f54aac602ae99d83d954a2f102d77ff93ecfa7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 4 13:13:43 2020 +0000

    Bug 26136: Prevent double submit on checkin-form
    
    To test:
     1 - Browse to Circulation->Check-in
     2 - Type a barcode into the Check in box
     3 - Hit Enter as many as times as you can
     4 - Check the statistics table:
        SELECT * FROM statistics WHERE itemnumber={itemnumber} AND DATE(datetime)=CURDATE();
     5 - Note you have multiple lines for the same item at the same time
     6 - Apply patch
     7 - Reload the page
     8 - Type the barcode
     9 - Press Enter even more fast and more furiously
    10 - Check the statistics table
    11 - Only one entry, huzzah!
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85005b719876071047e4f6b99321549b665bcc05
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 6 13:29:44 2020 +0200

    Bug 26158: Fix Z3950 search button broken for translations
    
    This is similar to bug 23713
    
    var SEARCH_RESULTS = [% IF (SEARCH_RESULTS) %]1[% ELSE %]0[% END %];
    
    become, once translated:
    
    var SEARCH_RESULTS = [% IF (SEARCH_RESULTS) %]1[% ELSE %][% END %];
    
    and a JS error appears in the console
     Uncaught SyntaxError: expected expression, got ';' search.pl:636:29
    
    Caused by
      commit ef4306cc02e2f15aa2466ae65d0b4f9a1fd70ad9
      Bug 23885: Move staff client search results JavaScript into separate file
    
    Test plan:
    Use the staff interface in a translated language
    Search for a term that won't return any results
    Click the Z3950 button
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a96433446e87c03ac6e253a54eb067ac93a33575
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 6 15:08:48 2020 +0200

    Bug 26162: Make Selenium click action more robust
    
    See
    https://stackoverflow.com/questions/12967541/how-to-avoid-staleelementreferenceexception-in-selenium
    https://www.selenium.dev/exceptions/
    https://developer.mozilla.org/en-US/docs/Web/WebDriver/Errors/StaleElementReference
    
    This patch will fix the following failure we get under D11:
    18:47:07 selenium_1   | 09:47:07.478 WARN - Exception: Element not found in the cache - perhaps the page has changed since it was looked up
    18:47:07 selenium_1   | For documentation on this error, please visit: http://seleniumhq.org/exceptions/stale_element_reference.html
    18:47:07 selenium_1   | Build info: version: '2.53.1', revision: 'a36b8b1', time: '2016-06-30 17:37:03'
    18:47:07 selenium_1   | System info: host: '78b9a07f51f2', ip: '192.168.16.2', os.name: 'Linux', os.arch: 'amd64', os.version: '4.19.0-9-amd64', java.version: '1.8.0_91'
    18:47:07 selenium_1   | Driver info: driver.version: unknown
    18:47:07 koha_1       |
    18:47:07 koha_1       | STRACE: /usr/share/perl5/Try/Tiny.pm:123 in Selenium::Remote::Driver::catch {...}
    18:47:07 koha_1       |         /usr/local/share/perl/5.26.1/Selenium/Remote/Driver.pm:353 in Try::Tiny::try
    18:47:07 koha_1       |         (eval 1571):1 in Selenium::Remote::Driver::__ANON__
    18:47:07 koha_1       |         (eval 1573):2 in Selenium::Remote::Driver::__ANON__
    18:47:07 koha_1       |         (eval 1546):17 in Selenium::Remote::Driver::_execute_command
    18:47:07 koha_1       |         /usr/local/share/perl/5.26.1/Selenium/Remote/WebElement.pm:63 in Selenium::Remote::WebElement::_execute_command
    18:47:07 koha_1       |         /kohadevbox/koha/t/lib/Selenium.pm:184 in Selenium::Remote::WebElement::click
    18:47:07 koha_1       |         /kohadevbox/koha/t/lib/Selenium.pm:172 in t::lib::Selenium::click_when_visible
    18:47:07 koha_1       |         t/db_dependent/selenium/administration_tasks.t:131 in t::lib::Selenium::click
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd94f11afb5af5fc051ac75f3804cb9ea38fc677
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 6 12:40:20 2020 +0000

    Bug 25826: (QA follow-up) Add filters
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0c47ad824e5bbfeb119558b7221df50b36a8ae4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 27 12:18:36 2020 -0300

    Bug 25826: Forbid changing the hidden attributes for biblionumber
    
    This patch tweaks the UI so it forbids changing the hidden values when
    they are correct (i.e. when they are not hidden in OPAC and intranet).
    
    To test:
    1. Apply the first patch
    2. Play with the hidden values of the subfield you have mapped to
       biblio.biblionumber in your picked framework. This is usually 999$c
       in MARC21, and 001 in UNIMARC.
    => SUCCESS: When you verify the about.pl, it mentions issues when you
    hide in some of the interfaces
    3. Apply this patch and reload everything
    4. Repeat 2
    => SUCCESS: If your framework is 'ok', it prevents you from editing this
    values, otherwise you can change them.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a1406c4766e43460dd3bf8c99c0636b51e9c7c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 22 16:43:38 2020 +0200

    Bug 25826: Add a warning to the about page
    
    This patch adds a warning to the about page if the biblionumber field is
    hidden at the OPAC or staff interface.
    
    Test plan:
    Hide the biblionumber to some framework
    Confirm that there is a warning on the about page
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bad8da970b299588b49ca061555e1633f95a6fe
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 27 12:26:41 2020 +0000

    Bug 26037: openlibrary.org is hit on every Koha requests
    
    This patch moves the inclusion of Open Library JavaScript from
    opac-bottom.inc to the three templates where it might be used.
    
    In addition, the Open Library JS has been modified to check for the
    existence of the relevant markup on the page before executing a query.
    
    Unrelated: The Open Library label is now hidden when the status returned
    is "Not found." Previously this information was displayed.
    
    To test, apply the patch and enable the OpenLibrarySearch system
    preference.
    
     - Perform a search in the OPAC which will return results from Open
       Library. Some ISBNs: 0140423826, 0395082552, 0679436405.
       - On the search result page there should be an Open Library "Read
         now" button for each result that can be opened for reading in Open
         Library.
     - Add these titles to a list and view the list.
       - The "Read now" button should appear on the list page.
     - View the details for one of these titles.
       - The "Read now" button should appear on the page below the holdings.
     - Watch the browser's developer tools on these and other pages in the
       OPAC. There should be no errors in the console and no 404 errors in
       the network tab.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1509855d3aa2729127ac352525be62505d752f9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 4 18:28:42 2020 +0000

    Bug 25683: (follow-up) Use COALESCE instead of IFNULL
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7ae33f60c18d2874370e7c2d2f3042fe1331e0e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 10 12:26:06 2020 +0000

    Bug 25683: Fix grouping of results
    
    DBIX doesn't seem to work as I expected - if trying to group by we can only
    get the columns we grouped by, otherwise the queries are much more complicated
    and come out wrong
    
    This patch removes the 'amountoutstanding' from the query. Note that we do return patron
    object, however, to access all the columns we must discard_changes (or refetch)
    
    Also fixes a typo 'verbosse'
    
    To test:
    1 - charge a $1 fine to a patron
    2 - pay off the fine
    3 - perl misc/cronjobs/update_patrons_category.pl -f J -t J -fu=5 -v
    4 - Note the patron is returned twice
    5 - export DBIC_TRACE=1
    6 - repeat 3 - view the SQL query and see how odd it is
    7 - Apply this patch
    8 - repeat 3 - simpler query
    9 - patron returned only once
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09146f4a995d50206c7f1c2d80e797b3cb1175c5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jun 9 10:52:26 2020 +0000

    Bug 25683: Patron with no accountlines should have 0 outstanding (not NULL)
    
    Test plan:
    - Have a patron with nothing in accountlines
    - run update_patron_categories to find patrons with fines under $5 (-fu=5)
      - Your patron is not found
      - Give your patron a manual charge of $1
      - rerun the cron, your patron is found
      - pay off your patron's fine, putting their balance at $0
      - rerun the cron, your patron is found
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 759e52ac944d25cf019b83a68ea0329842e4d3e2
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Aug 3 21:56:48 2020 +0000

    Bug 26131: Remove parentheses in circulation.pref
    
    To test:
    1. Search for a SCO system preference like SCOUserJS.
    2. Note that there is a console error on that screen and you cannot open editor.
    3. Apply patch
    4. Reload the page.
    5. No more console error and you can now edit the system pref!
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8855908fdf8839878a233012f4d63b33949554c0
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Mon Aug 3 08:40:06 2020 +0200

    Bug 26125: (bug 23697 follow-up) open patron's details in autocompletion search
    
    Test plan:
    
    1 - Enable PatronAutoComplete syspref
    2 - Go to "Patrons" (members/members-home.pl)
    3 - Enter a patron first letters in "Search Patron" tab
    4 - Select a patron
    5 - You're wrongly redirected in koha/circ/circulation.pl
    6 - Apply patch
    7 - Repeat 3, 4
    8 - You're correctly redirected in koha/members/moremember.pl
    9 - double check "Check out" redirect hasn't changed
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6cb3c2ba54c0e10c27f37a0d2dec4f2875f2ddd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 10:51:26 2020 +0200

    Bug 26098: Fix JS error on the fund list view when no fund displayed
    
    TypeError: this.data(...) is undefined
    in jquery.treetable.js
    
    Test plan:
    Go to the fund list view
    Select a filter that will return no result
    => With this patch applied there is no JS error in the console
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ae7efa3bb7806ac5a7e3f2882a7139e627b22c6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 4 15:06:02 2020 +0100

    Bug 26017: (follow-up) Serverside permission check on registers page
    
    This patch adds a serverside permissions check for the display of the
    registers summary page.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff4917197deaa6250d30c5729b2758db2b1f755e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 20 09:40:00 2020 +0100

    Bug 26017: Correct permission check on tools page
    
    The 'Cashup registers' link from the tools page retained an previous
    verions of the permission name. This patch corrects it to use the final
    name we sebtled on and thus now correctly displays the link when
    appropriate.
    
    Test plan
    1/ Enable cash registers via the 'UseCashRegisters' system preference
    2/ Ensure you are logged in as a user who has the cash management
       cashup permission.
    3/ Verify that the 'Cashup registers' option appears on the tools page.
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0624f0e03e8d265cd3f2ab8434671700bf6984d
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Jul 31 22:47:21 2020 +0000

    Bug 26121: Add z-index for CodeMirror
    
    To test:
    1. Make sure the system preference 'NewsToolEditor' is set to CodeMirror
    2. Go add or edit some News content.
    3. Add some content to the News section
    4. Use the datepicker to pick a Publication date/Expiration date
    5. Notice its very hard to see your dates overlapping with CodeMirror.
    6. Apply patch
    7. Much easier to see the dates!
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb0abf99c451113e8649c494d3a8b99f3916f942
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jun 29 18:15:39 2020 +0000

    Bug 25893: Use wildcards when searching logs
    
    The restores the wildcards that were used in the past
    
    To test:
     0 - Ensure cataloguing logs and issues logs are enabled
     1 - Edit an item
     2 - Circulate that same item
     3 - Browse to tools-> log viewer
     4 - Put the itemnumber in the 'info' box
     5 - You see only the circulation
     6 - Put the itemnumber in the object box
     7 - You see only the cataloging modification
     8 - Apply patch
     9 - Put itemnumber in info box
    10 - you see both actions
    11 - Put the itemnumber in the object box
    12 - You see only the catalogiong modification
    
    Signed-off-by: Jason Robb <jrobb@sekls.org>
    
    Bug 25893: Don't wildcard object
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 25893: (follow-up) Undo unrelated changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d1c3af91bec4e5f93f6531be3aa8de4c4608efe
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Aug 4 02:59:32 2020 +0000

    Bug 26124: Load TinyMCE assets in correct order
    
    1. Make sure NewsToolEditor is set to TinyMCE
    2. Go to Home › Tools › News › Add news item
    3. Observe console error
    4. Apply patch
    5. No console error
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 550cb7eb431fe90c9cd1d7f9f711f617d0befe6e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 31 10:17:01 2020 -0300

    Bug 26115: Remove leftover Carp::Always
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a55ca6a82a662966e47921e13029a91152fbefd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 6 11:36:33 2020 +0200

    Bug 25871: DBRev 20.06.00.021
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b5f66ddbb9b556933baedd6f471b97eca713d8d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 4 00:49:35 2020 +0000

    Bug 25871: (QA follow-up) Update syspref
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19d8aea4e04d64426493c16681dfa662313e4cee
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 16 21:34:52 2020 +0000

    Bug 25871: Add "only library" to OpacItemLocation options
    
    This patch adds a new option to the OpacItemLocation system preference,
    "only library." It also rewords the descriptions of the existing options
    in order to make their use more clear.
    
    To test, apply the patch and make sure your OPACXSLTResultsDisplay
    system preference is set to "default."
    
    Test the OPAC search results using each of the OpacItemLocation
    preference options:
    
    - location: "library, location, and call number," e.g.
    
      "Availability: Items available for loan: Athens (1).
       Location(s): Athens new book shelf Call number: JNF 952.025 Bl."
    
    - ccode: "library, collection code, and call number," e.g.
    
      "Availability: Items available for loan: Athens (1).
       Collection(s): Juvenile non-fiction Call number: JNF 952.025 Bl."
    
    - callnum: "library and call number," e.g.
    
      "Availability: Items available for loan: AthensCall number: JNF
       952.025 Bl (1)."
    
    - library: "only library," e.g."
    
      "Availability: Items available for loan: Athens (1)."
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4cae99f7ec76e40a57e4066e088b9b01caed744
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 5 12:09:40 2020 -0300

    Bug 26143: Make the API handle per_page=-1
    
    This patch introduces handling for per_page=-1 and actually adds a
    missing feature to the API: being able to request all resources on a
    route.
    
    To test this:
    1. Visit the libraries admin page
    2. On the table, choose to display 'All' rows
    => FAIL: it doesn't refresh, the browser console displays a 500 error
    code and so the logs
    3. Apply the tests patches
    4. Run:
       $ kshell
      k$ prove t/Koha/REST/Plugin/Pagination.t \
               t/db_dependent/Koha/REST/Plugin/Objects.t
    => FAIL: Tests fail loudly
    5. Apply this patch
    6. Restart plack
    7. Repeat 2
    => SUCCESS: choosing to display all, works
    8. Repeat 4
    => SUCCESS: Tests pass now!
    9. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d20bc39d759bc9321b1b7accb952f90351a14caa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 5 12:04:47 2020 -0300

    Bug 26143: Regression tests
    
    This patch introduces tests for the per_page=-1 handling use case. From
    now on per_page=-1 means 'all resources'.
    
    On writing this I noticed that we always paginate results no matter
    what, but there was a weird condition under which on pagination headers
    were sent back to the API consumer. This is highlighted in the precedent
    patch, which is not the -1 situation this one tries to tackle.
    
    Both pagination and searching are broken with per_page=-1, which is a
    standard, and we actually didn't explicitly set a way to request all
    resources.
    
    To verify this:
    1. Apply the previous tests patch and this one
    2. Run:
       $ kshell
      k$ prove t/Koha/REST/Plugin/Pagination.t \
               t/db_dependent/Koha/REST/Plugin/Objects.t
    => FAIL: Things are damn broken
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61e8dc8c7d489329c27aca3b6b10137c289161cb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 5 11:55:28 2020 -0300

    Bug 26143: The API is always paginated
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88ecaa54cdfec5d35091237821097877b0edb4eb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 13:55:13 2020 +0200

    Bug 26133: Remove GetMarcHosts
    
    We removed the single occurrence of this subroutine in the previous
    patch
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c190388ae1b69889e28c2dae80e0d9ea9baff1a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 4 13:54:28 2020 +0200

    Bug 26133: Remove GetMarc* calls in detail.pl
    
    There are several calls in catalogue/detail.pl that can be removed:
    GetMarcISBN, GetMarcAuthors, GetMarcSubjects, GetMarcSeries, GetMarcUrls and GetMarcHosts
    They pass a variable to the template that is never used.
    
    Test plan:
    Confirm that this TT variable is never used.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a51a4f117d13739687f7be47d56cae0352914901
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 5 09:57:56 2020 +0200

    Bug 26141: Remove duplicated code from search.pl
    
    commit 417553a9e47bf31f4cb785162e3dced856a2ac2a
      Bug 12478: starting to add search to staff client
    
    This commit added code related to the itemtypes to the advanced search, but this code already existed.
    
    The weird bit is:
    $template->param(advancedsearchesloop => \@advancedsearchesloop);
    my $types = C4::Context->preference("AdvancedSearchTypes") || "itemtypes";
    my $advancedsearchesloop = prepare_adv_search_types($types);
    $template->param(advancedsearchesloop => $advancedsearchesloop);
    
    We are passing twice advancedsearchesloop to the template.
    
    Test plan (for QA):
    Review the changes and confirm that we can safely remove this code
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80a611797bf67b263b6b84a6e931833ea336b6a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 22 14:11:03 2020 +0200

    Bug 26043: Fix random failure from Holds.t
    
     #   Failed test 'Test ModReserveMinusPriority()'
     #   at t/db_dependent/Holds.t line 202.
     #          got: undef
     #     expected: '1605'
     # Looks like you failed 1 test of 66.
    
    It is coming from Koha::Patron->holds that is ordering by reservedate,
    so "sometimes" they are ordered in reverse (at least it's my
    understanding of the problem).
    
    Test plan:
    Run the test file several times (from 20 to 60x), it must never fail
    with this patch
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88506d7bb6958a49969f737a8bc41afa8536c554
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 5 09:30:31 2020 +0200

    Bug 26138: Make Koha::Plugins->call return consistent value
    
    It must return an empty array in case the enable_plugins config flag is
    disabled
    
    Test plan:
    Turn the config off in koha-conf
    Start a search at the OPAC
    Without this patch you got:
      Can't use string ("0") as a HASH ref while "strict refs" in use at /home/vagrant/kohaclone/opac/opac-search.pl line 661
    With this patch applied you see the search result
    
    Followed test plan - works as described.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c34d222d57c61c60dcfb9babc16be8827bb7e242
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 3 17:57:02 2020 +0200

    Bug 25811: Try to fix the random failure caused by not finding id=login
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b24ca4ebb10bee1212d2c133c1d0259bec56d44
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 3 11:57:55 2020 +0200

    Bug 24610: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8bc0014961c4675b0e0e478330b307d8825d355
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Feb 7 11:21:43 2020 +0100

    Bug 24610: Let user switch between 'Pay' and 'Write off' mode
    
    In patron's accounting section, under 'Make a payment' tab, you have the
    choice between 'Pay' and 'Write off'. It takes you to another form, but
    once there you cannot change mode. You have to click on Cancel,
    re-select the lines you had selected (if you made a selection) and click
    on the right button.
    
    This patch adds link above the form to easily switch between the two
    modes.
    
    Also fixes a CSS bug to be able to use Bootstrap's nav pills inside
    .statictabs
    
    Test plan:
    1. Create some manual invoices
    2. Go to 'Make a payment' tab
    3. Click on the 'Pay' button in a table row
    4. Above the form you should see two links ('Pay' and 'Write off').
       Click on 'Write off', confirm the write off and verify that it did
       make a 'write off'.
    5. Go to 'Make a payment' tab
    6. Click on the 'Write off' button in a table row
    7. Click 'Pay', confirm the pay and verify that it did make a 'pay'
    8. Go to 'Make a payment' tab
    9. Select some lines and click on 'Pay selected'
    10. Click on 'Write off', confirm the 'write off' and verify that it did
        make a 'write off'
    11. Go to 'Make a payment' tab
    12. Select some lines and click on 'Write off selected'
    13. Click on 'Pay', confirm the pay and verify that it did make a 'pay'
    
    Signed-off-by: Christofer <christofer.zorn@ajaxlibrary.ca>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19f9bc0528ec0f5cdf000b5120138652b3ece57c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 29 12:21:29 2020 +0000

    Bug 25762: Typo in linkitem.tt
    
    This patch corrects the same typo in two different templates:
    
    &rsquo; -> &rsaquo;
    
    If you want to test beyond examining the patch, apply the patch
    and go to Tools -> Rotating collections.
    
    - Add an item to a rotating collection.
    - In the browser's title bar (or the tab title if the title bar isn't
      shown) the separator between the rotating collection name and "Add or
      remove items" should be ">" instead of "`"
    - Enable the EasyAnalyticalRecords system preference.
    - View the detail page for a bibliographic record.
    - From the "Edit" menu, choose "Link to host record"
    - Check the title bar as you did previously.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7c85ad16303bb1a041663a13336f8446c26ee64
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 29 12:58:22 2020 +0000

    Bug 26085: Add the copy, print and export DataTables buttons to lost items report
    
    This patch removes the in-page DataTables DOM configuration option so
    that the default option is used. This will allow all the standard
    controls to appear, including copy/print/export.
    
    Since the default DataTables information includes the number of results
    in the table, the template markup showing this information is removed.
    
    To test, apply the patch and go to Reports.
    
    - Run the "Items lost" report using parameters which will return
      multiple results.
    - On the results page confirm that the standard controls are present:
      Result count, search form, columns filter, export buttons.
    - Confirm that the "Activate filters" feature works, and that selecting
      results activates the option to download a CSV using a CSV export
      profile.
    
      Note that the "Activate filters" feature doesn't play well with hidden
      columns. However this issue predates the patch.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f11ba114e13aee10e05ccb83096c7f02908085b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 14:39:17 2020 +0200

    Bug 26094: Add class to the "Suggest for purchase" button
    
    Bug 14963 added a new "Suggest for purchase" button on the detail page
    of bibliographic records at the OPAC.
    This patch adds a specific CSS class to make it reachable easily
    
    Like others button in this action list
    
    Test plan:
    Go to the detail page of a bibliographic record at the OPAc
    Notice the new CSS class
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d69ae18b5727d122575eb12a34f1712cb96b5b3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 17 13:20:45 2020 +0000

    Bug 26004: Remove unused jQuery plugin jquery.hoverIntent.minified.js from the OPAC
    
    The jQuery plugin jquery.hoverIntent.minified.js hasn't been used in
    Koha in long time. This patch removes it from the OPAC.
    
    To test, apply the patch and search for instances of "hoverIntent."
    There should be none.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c100a7fd21bd4497be87df4b8cc94674a19c5f5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 17 18:09:30 2020 +0000

    Bug 26011: Remove unused jQuery plugin jquery.metadata.min.js from the OPAC
    
    The jQuery plugin jquery.metadata.min.js hasn't been used in
    Koha in long time. This patch removes it from the OPAC.
    
    To test, apply the patch and search for instances of "jquery.metadata."
    There should be none.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb5acdc6702cef4668921ccf2537797358981fff
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Jun 25 11:25:41 2020 +0400

    Bug 25873: Ignore malformed data for Elasticsearch integer fields
    
    If we try to put malformed data into an integer field, Elasticsearch
    rejects the whole document.
    Setting 'ignore_malformed' to true allows to ignore malformed data and
    process the other fields of the document normally
    
    https://www.elastic.co/guide/en/elasticsearch/reference/7.8/ignore-malformed.html
    
    Test plan:
    * Without the patch
      1. In search engine configuration, change the type of a text field to
      'Number' (for instance 'title')
      2. misc/search_tools/rebuild_elasticsearch.pl -d -b
      3. See that the index is empty (unless you have titles consisting only
      of digits)
    * With the patch
      1. misc/search_tools/rebuild_elasticsearch.pl -d -b
      2. Now records are correctly indexed
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 622ea4627ae50c49f7547ee3a3a8b4bde18e17a3
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Wed Jul 29 15:58:42 2020 +0000

    Bug 26084: Clarify language on ConsiderOnSiteCheckoutsAsNormalCheckouts
    
    To test:
    - apply patch
    - confirm explanation reads as suggested
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0eee4d2e1359050cee3dd23a121e75195b0ce11
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 31 11:53:53 2020 +0200

    Bug 26111: Add "Serials" (SER) to the reports dictionnary
    
    It's missing in the template
    
    Test plan:
    Go go Home › Reports › Guided reports wizard › Dictionary
    At step 2, notice that with this patch you have "Serials" in the
    dropdown list (instead of an empty entry)
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce441708906fa282e000f523243ded20541970cc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 31 09:52:10 2020 -0300

    Bug 26108: Only call the plugin hook if a return took place
    
    This patch makes the hooks be called only if the checkin is effective
    (i.e. if it is not rejected for some reason.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Circulation_hooks.t
    => FAIL: Tests fail
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a51b06001f2f8e42efc48d1898060f1d8d23ae62
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 31 09:47:56 2020 -0300

    Bug 26108: Regression tests
    
    The current implementation makes the assumption that if $issue is
    defined, then it is the 'return' use case. This is correct, but
    incomplete: after verifying that there's actually an issue, the return
    can be rejected for various reasons.
    
    This patch introduces a regression test for one of those situations
    (which I consider enough for testing purposes) . It highlights that the
    hook shouldn't be called if there hasn't been an actual checkin.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Circulation_hooks.t
    => FAIL: Tests fail because there's an unexpected warining printed by
    the erroneous plugin call (i.e. there's been no return but the plugin is
    called anyway).
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67f6ceecd314fadd96e3dbc5fc543dd0528b050a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 31 12:55:40 2020 +0200

    Bug 25811: (follow-up) Debug - Paste the source of the page
    
    Wide character in syswrite at /usr/share/perl5/File/Slurp.pm line 506.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09ed4c0dd7277931c1e631c5b1329463fc9751e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 10:57:53 2020 +0200

    Bug 25887: Keep library filter on the fund list view
    
    The problem:
    When filtering funds by library, the pull down for libraries resets to "empty" when the page is reloaded,
    although the filter criteria is visible in the URL.
    
    Test plan:
    Create a fund for library A
    Create a fund for library B
    Go to the fund list view
    => All funds are listed
    Select library A in the library filter, click "Go"
    => Funds for library A are listed
    => Library filter has "library A" selected
    Edit fund for library B
    => The edit form has "library B" selected
    
    Signed-off-by: Holly Cooper <hc@interleaf.ie>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4921ad8ae42c04415347d2d0bce4a5ed7af395a3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 29 20:01:24 2020 +0000

    Bug 26093: Markup error after Bug 24279 creates formatting problem
    
    This patch makes a few minor changes to the markup of the item detail
    page in order for everything to be valid and styled correctly:
    
    - Remove unnecessary and invalid <br clear="both"/>
    - Move heading inside container so that floats clear correctly
    - Change <span> tag back to <div> to enable the correct style.
    
    To test, apply the patch and view the item details page for a title with
    multiple items.
    
     - Each section starting with "Barcode" should be bordered above by a
       two-pixel gray line
     - The "statuses" section should be styled like the areas above and
       below, not as an ordered list.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e330e4ec222f8ac3a04339a020509e30aa0bf3ab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 11:59:44 2020 +0200

    Bug 25852: Add tests
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a9d3f17d9e44b5326a42d14420d30243031629d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 12:00:03 2020 +0200

    Bug 25852: Improve C4::Creators::Lib reliability under plack
    
    This is certainly a major issue that leads to many side-effects.
    Under plack, the structure of the default values are not handled
    correctly.
    Package variables are used to store stuff like the "layout type". They
    are complex structures (arrays of hashes) and returned without being
    copied.
    When the caller (the controller script) retrieve them then modify the
    returned structures, it actually modifies the package's variables.
    
    One of the issue is:
    Create a new layout
    The script retrieve a structure with all "selected" flags are set to 0
    It select the first one as default (BAR as selected => 1)
    The user creates the new layout and will selected BIBBAR (for instance)
    If you then edit this new layout, the script will retrieve the
    "label_types" and set "selected" for BIBBAR. However BAR is still
    selected!
    The UI receives 2 selected and display the first selected one that has
    the selected option.
    
    Test plan:
    1. Create a layout type for Barcode/Biblio
    2. Choose fields to print and size of font
    3. Save
    4. Edit existing Layout
    => Withtout this patch "Barcode" is the preselected option
    => With this patch applied, the correct "Barcode/Biblio" option is
    selected
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5d221160184120140950112ef8edfb0ea476949
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 31 09:49:06 2020 +0200

    Bug 26108: (bug 25855 follow-up) Call after_circ_action hook only if issue exists
    
    AddReturn can be called on an item even if it's not checked out (to
    trigger holds for instance).
    The hook should (?) not be called in that situation
    
    Test plan:
    Confirm the above and that the following tests are now passing:
     t/db_dependent/SIP/Message.t
     t/db_dependent/Reserves.t
     t/db_dependent/Circulation/issue.t
     t/db_dependent/SIP/Transaction.t
     t/db_dependent/Circulation.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ae472ba5d9b7bfe6c6e44320ca020c9cf111b01
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jul 29 13:03:57 2020 -0400

    Bug 26083: Item editor defaults to lost
    
    When editing an item via additem.pl, koha defaults to the first
    available lost status, rather than defaulting to not-lost.
    
    Test Plan:
    1) Ensure you do not have a value ClaimReturnedLostValue
    2) Edit an existing item that is not lost
    3) Note the lost value is set even though it is not lost
    4) Apply this patch
    5) Edit a different item that is not lost
    6) Note the lost value is not set!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc621836b26010986c85bd2cc986ff71b77bb28d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 17:40:28 2020 +0200

    Bug 26061: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cd1c1e03290ae7be214dd92083e1377eadd3c1f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 24 15:59:42 2020 +0000

    Bug 26061: Improve style of sidebar datepickers
    
    This patch makes a small change to the staff interface CSS so that
    datepicker form fields in sidebar forms don't force the datepicker icon
    onto a second line.
    
    The change uses the CSS calc() function to specify that form fields with
    a .hasDatepicker class (dynamically added by jqueryUI) have a width of
    100% minus 20 pixels, leaving room for the datepicker icon.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_interface).
    
    - View a page in the staff interface which has a datepicker field in a
      sidebar form and confirm that the icon stays on the same line as the
      firm field at varying browser widths. Examples:
    
      - Reports -> Saved SQL reports
      - Circulation -> Overdues
      - Acquisitions -> Late orders
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2111c1ce6532b73af3a4847500be8f305db570a
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Jul 8 12:36:46 2020 +0000

    Bug 25953: Add ID to installed plugins table on plugins-home.pl
    
    This patch adds a "installed_plugins" ID to the table
    of installed plugins.
    
    The idea is that it will ease styling and DOM mods through Javascript.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 773b88e9c20c17ea70aa285d12c8e4e03923d15d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 15:21:50 2020 +0000

    Bug 26070: DBRev 20.06.00.020
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b9e8fd32852acceb10cfc54d4a5a3acc0f6e232
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 27 19:16:07 2020 +0000

    Bug 26070: Remove GoogleIndicTransliteration system preference
    
    The Google Transliterate API was deprecated on May 26, 2011. This patch
    removes the feature and associated system preference.
    
    To test, apply the patch and run the database update process.
    
     - Go to Administration -> System preferences and search for
       'GoogleIndicTransliteration.' There should be no results.
     - Search the Koha codebase for references to
       'GoogleIndicTransliteration.' There should be no current references..
    
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9deaf86754c9d6aa0b4a2cb688b497bd6b03b67f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 15:21:50 2020 +0000

    Bug 22660: DBRev 20.06.00.019
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e0d097a5692af07db020e6f806eeaa97d43ae1e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Jul 29 22:51:34 2020 +0000

    Bug 22660: (QA follow-up) Fix capitalization in system preference
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23846781751d7fb808b3fa4b857da72706653575
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jul 23 18:20:51 2020 +0000

    Bug 22660: (follow-up) Re-word system preference description
    
    This patch rewords the system preference description to focus on the
    generic description of the editor rather than the name of the plugin:
    
        tinymce: "a WYSIWYG editor (TinyMCE)"
        codemirror: "a text editor (CodeMirror)"
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bec404420c6dd9251b511d12e2425e5a6039a95
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jul 23 17:58:22 2020 +0000

    Bug 22660: (follow-up) Improve asset handling, add linting
    
    This patch makes some changes to the way assets are included based on
    the value of the system preferece in order to minimize unnecessary
    JavaScript includes.
    
    The patch also adds HTML syntax-highlighting and linting like we have in
    the system preferences editor.
    
    Removed are two JS files which were not required.
    
    To test, apply the patch and set the NewsToolEditor preference to
    "CodeMirror."
    
     - Edit a news item and confirm that the contents of the
       editor show HTML syntax highlighting.
     - Test HTML linting by adding some malformed HTML (missing closing tag,
       for instance). The error should be highlighted.
     - Set the NewsToolEditor to "TinyMCE" and confirm that WYSIWYG editing
       still works correctly.
    
    https://bugs.koha-community.org/show_bug.cgi?id=22600
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 980dd605031e616f1d481852dffe9cc6779eb3e3
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri May 8 22:57:40 2020 +0000

    Bug 22660: Add system pref to allow switching of editors in News Tool
    
    This patch adds a system preference called 'NewsToolEditor' which allows for the choice between TinyMCE and CodeMirror in the News Feature.
    
    TEST PLAN:
    1. Apply patch and run updatedatabase
    2. Go to Tools > News and make a new entry or edit an existing News item.
    3. When you initially load you should gte the TinyMCE editor (WYSIWYG)
    4. Search for the NewsToolEditor system preference and switch to CodeMirror.
    5. Reload your News item and now you should see the CodeMirror editor.
    6. Try saving content with both and maki sure it works.
    7. Try adding some different HTML tags in CodeMirror mode, saving, and making sure it looks right when you switch back to TinyMCE
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e68fe2a928bec05b9602fa28dfbc86e04657ce81
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 10 13:19:14 2020 +0000

    Bug 25968: Make logs sort by date descending as a default
    
    This patch adds DataTables with columns configuration to the log viewer.
    The table of log entries is now sorted by default by date descending.
    
    To test, apply the patch and go to Administration -> Table settings.
    
     - Expand the "Tools" section and confirm that there is a section for
       "logviewer."
     - Go to Tools -> Log viewer.
     - Perform a search which will return multiple results.
     - Confirm that the results are sorted by date descending.
     - Test that the table controls work correctly: Paging, columns, export.
     - Return to the Table settings administration page and test that
       changes to those settings are correctly reflected in the log viewer
       table.
    
    Signed-off-by: barbara <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: Fix indentation in .yml to match other entries
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a37a026e3eaa4da57b467d506147849e137781e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 17:40:18 2020 +0200

    Bug 22087: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80077c44f9eeea537f0085e33329fc40eabb5f9d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 27 15:37:21 2020 +0200

    Bug 22087: Add missing filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07d00ee029dfddd1aed1b4e45ac04ed92e73f708
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 7 12:40:26 2020 +0200

    Bug 22087: Move the email into the list
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a351d056c597e3a925500527e2d8ecd49d02c430
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 7 12:40:24 2020 +0200

    Bug 22087: Remove padding on li's
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89551241dbf3712fa9e582627855f1a859edeeb6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 7 12:01:05 2020 +0200

    Bug 22087: Prevent variable names colision
    
    We should not use PROCESS:
    http://www.template-toolkit.org/docs/manual/Directives.html
    
    " The PROCESS directive is slightly faster than INCLUDE because it
    avoids the need to localise (i.e. copy) the variable stash before
    processing the template. "
    
    The 'patron' variable is reused by patron-title.inc
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77058c7d6ba4f13c64b5f48a7028692bcfa5b968
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 16:25:34 2020 +0200

    Bug 22087: Add a no_line_break parameter to prevent new lines
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fac4017b78d5da9b20b7e73a9f75ecad7f94a67
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 16:14:04 2020 +0200

    Bug 22087: Add space between zipcode and country
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33f4bc949e22cca9eb6ee590e044ac708f80966a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 16:00:13 2020 +0200

    Bug 22087: Use include file to display patrons address in search result
    
    In order to display the city and country in the patron search result, we
    need to use the member-display-address-style include file, to satisfy
    AddressFormat.
    
    Test plan:
    Modify some patrons and fill the different address info
    Search for them and notice that the city, zipcode and country are now
    displayed.
    Modify the value of AddressFormat and confirm that the display is
    modified according to its value
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8b95985847d38296abd1961ca8e05115b563dc7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 17:40:02 2020 +0200

    Bug 26060: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e86c994110c8b43e67b1bf152bb44f9e1468df6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 24 14:07:29 2020 +0000

    Bug 26060: Replace staff interface table sort icons with SVG
    
    This patch modifies the staff interface CSS to convert table sorting
    icons from PNG to SVG. These icons are added via background-image
    data-urls, so only the SCSS file is modified.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_interface).
    
     - Clear your browser cache if necessary
     - View any DataTable in the staff interface, for instance when checking
       out to a patron with existing checkouts, the catalog detail page for
       a title with holdings, the table of saved reports.
     - Confirm that the sorting icons in the table headers look correct in
       each state: Sorted ascending, sorted descending, and unsorted.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d0da68d5ada37b40099fbc11b63202ccf7a48b2
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Sun Jul 12 14:09:15 2020 +0200

    Bug 25982: OPAC shelves RSS link output is xml
    
    Output rss feed as text/xml
    
    Test plan:
    1) have books entered
    2) log in create a list
    3) add books to list
    4) display list in OPAC
    5) click the RSS link button.
       -- output is displayed as html text
    6) apply patch
    7) repeat steps 4&5
       -- output is displayed as xml tree
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Amit Gupta <amit.gupta@informaticsglobal.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c8276bf0e64a2dc90af4aab0d6e78893edc12b1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 18 13:10:35 2020 +0000

    Bug 25351: Move cart-related strings out of opac-bottom.inc and into basket.js
    
    This patch adds the necessary JavaScript includes to the OPAC to
    enable translation of strings in JavaScript. It also updates the
    translation of cart-related strings by removing the strings from
    opac-bottom.inc and putting them in basket.js where they are used.
    
    To test, apply the patch and test that the correct strings are
    translatable. In this example I'm testing fr-FR:
    
     - Update a translation:
    
       > cd misc/translator
       > perl translate update fr-FR
    
     - Open the corresponding .po file for the strings pulled from
       JavaScript  e.g.  misc/translator/po/fr-FR-messages-js.po
     - Locate strings pulled from bootstrap/js/basket.js for
       translation, e.g.:
    
       #: koha-tmpl/opac-tmpl/bootstrap/js/basket.js:89
       msgid "Your cart is currently empty"
       msgstr ""
    
     - Edit the "msgstr" string however you want (it's just for testing)
     - Install the updated translation:
    
       > perl translate install fr-FR
    
    In the OPAC, switch to the language you're testing. Confirm that your
    translated string appears. In the above example, by clicking the "Cart"
    icon in the header when there are no items in the cart.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ecaedc22db5a25db6ffa98e6a7fc2e7039656c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 28 09:23:35 2020 +0200

    Bug 21268: Don't remove 0 allocated funds from fund list
    
    If a fund is created with a amount of 0, it will not appear in the fund
    list (when a new order is created for instance).
    0 allocated funds can be used to track donations and other situations
    where there is not an expected amount for the year.
    
    Test plan:
    0. Do not apply the patch
    1. Create 1 active and 1 inactive budgets
    2. Create some funds for each budgets, with amount > 0 and amount == 0
    3. Add orders to basket
    => Note that the funds with amount == 0 are not displayed
    4. Apply the patch
    5. Add orders to basket (using the different possible ways we have)
    => Note that the funds with amount == 0 are displayed
    
    This change is applied to the different views of the acquisition module.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab015f04dcd4956ca1ccd610d085e8b0c17ca733
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 23 01:12:22 2020 +0200

    Bug 25499: Fix fund code column when closing a budget
    
    When closing a budget the fund code column in the table is
    always empty. This is due to a TT variable not being correct.
    
    To test:
    - Create a budget and fund
    - Order anything, leave basket open or not, but don't receive
    - Duplicate your existing budget
    - Close the first budget in order to move the pending orders
    - Verify the fund code is not showing in the table
    - Apply patch and reload the patch
    - Verify fund codes are now showing correctly
    
    Bonus: Changes the column heading Fund id to Fund ID.
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58be086a18e39068fd12dfeef677f982ae735a73
Author: Mason James <mtj@kohaaloha.com>
Date:   Fri Jul 3 23:42:02 2020 +1200

    Bug 25920: Add liblocale-codes-perl package to fix ubuntu-stable (focal)
    
    to test on ubuntu-20...
    
    1/ install koha-common pkg
     $ sudo apt install koha-common
    
    2/ confirm liblocale-codes-perl pkg is not installed :(
     $ apt-cache policy  liblocale-codes-perl | grep Installed
     Installed: (none)
    
    3/ apply patch
    
    4/ build and install new koha-common pkg
    
    5/ confirm liblocale-codes-perl pkg is now installed :)
     $ apt-cache policy  liblocale-codes-perl | grep Installed
     Installed: 3.62-1
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50302c714ed287b06574b8e18f4b33e4df42ee91
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 15:11:24 2020 +0200

    Bug 26063: Use Koha::Plugins->call for some other hooks
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db74e67bc52b2f3af8efd2243f6ab02fd6568de2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 24 16:00:52 2020 -0300

    Bug 26063: Use Koha::Plugins->call for circulation hooks
    
    This patch gets rid of a helper method used for calling the plugin
    hooks.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Circulation_hooks.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67c54c2c23be60df3efd1c7428ba870c0d5192f8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jul 23 11:52:57 2020 -0300

    Bug 21468: (QA follow-up) Simplify payload
    
    This patch simplifies the payload as suggested on bug 25855. It also
    keeps some specific params that cannot be deduced from the passed
    checkout object, (e.g. if it is an onsite checkout).
    
    Tests are cleared and added for this special exceptions.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a658db8f7e8d94b463bc6f064753f4ad2aaa48e9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jul 15 02:26:20 2020 -0300

    Bug 21468: (QA follow-up) Enhance tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 614b64ed170163ac618ea4bec16ea8c92b28c680
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 6 13:46:47 2020 +0100

    Bug 21468: Add 'checkin' action for _after_circ_actions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 536471ec0775d32939d7ef3044df891702827f3a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 6 13:46:15 2020 +0100

    Bug 21468: Unit tests for AddReturn
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2751defa7ca09cc5040021012dd503464ecf1b32
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 6 09:44:11 2020 +0100

    Bug 21468: Add 'checkout' action for _after_circ_actions
    
    This patch adds a call to _after_circ_actions into AddIssue and passes
    an appropriate payload for plugins to utilise after issuing items.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d7392cad470f5809475ccb731e6a229a0bc9504d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 6 11:43:25 2020 +0100

    Bug 21468: Unit tests for AddIssue
    
    This patch adds a unit test for the addition of a call to the
    _after_circ_action hook in AddIssue.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 625ba7a2aa01ef6efbaceb686bcdbcebe98e012f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 24 15:42:17 2020 -0300

    Bug 24031: (QA follow-up) Add tests for the AddReserve intervention
    
    This patch adds tests for AddReserve
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f54ace6711c9035b267474c2f1ab69570f977b8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 17 11:32:57 2020 -0400

    Bug 24031: Add hook to test plugin with unit test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9319c8879fdd796d7293beca8f5017a4024bdbd9
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri May 22 12:29:11 2020 +0200

    Bug 24031: Add safety checks in Koha::Plugins::call
    
    - Check that the plugin has the method before calling it
    - Call the method in an eval block to prevent fatal errors
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5e058e39fa97e5732f514ded46128b666bfba99
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri May 22 12:28:17 2020 +0200

    Bug 24031: Remove check for syspref UseKohaPlugins
    
    UseKohaPlugins has been removed by bug 20415
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 04afc1678a4e2b642de4c07402329248c7fc2137
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Nov 21 08:08:38 2019 -0500

    Bug 24031: Fix warnings
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8c137a718cdb344b2910f449e3a8a73e4362263
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Nov 13 11:11:54 2019 +0100

    Bug 24031: Add plugin hook after_hold_create
    
    It is called after a hold has been placed
    
    Test plan:
    1. Write a plugin that implements only after_hold_create (see
       `perldoc Koha::Plugins` for implementation details). Install it and
       enable it
    2. Place a hold and verify that your plugin method has been called with
       the right parameters
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9932ce33156305d7ebe3c8192bda8f1450f20b2a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jul 23 11:00:11 2020 -0300

    Bug 25855: (QA follow-up) Simplify payload
    
    This patch makes the hook be passed the Koha::Checkout object instead
    of a hand-crafted list of attributes.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ac260ca6c0716c47d7138aeeeabb80a50599f75
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 3 10:26:06 2020 -0300

    Bug 25855: (QA follow-up) Generalize hook and simplify tests
    
    This patch generalizes the hook so it can be used by other circulation
    actions.
    
    Tests are also simplified by mocking some of the (extensive) plugin
    hooks.
    
    To test:
    1. Repeat the test plan on the original patch
    => SUCCESS: All good
    2. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b78356cafd066cfe37366ca19e2556f69da200be
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 23 16:23:06 2020 -0300

    Bug 25855: Add a post_renewal_action plugin hook
    
    This patch adds a new hook to notify plugins about renewal actions. To
    test it:
    
    1. Apply the unit tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Circulation_hooks.t
    => FAIL: The tests expect some warnings to show, and they don't (i.e.
            the sample plugin hook is not being called).
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! The hook is being called on renewal!
    5. Sign off :-D
    
    Sponsored-by: ByWater Solutions
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e9d01d0fa75017698e6558f19105b7446821267
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 23 16:18:54 2020 -0300

    Bug 25855: Unit tests
    
    This patch adds tests fr a new circulation hook for plugins.
    In this case the post_renewal_action hook,
    
    The tests add the hook to the Test plugin, and verify that all the
    required parameters are passed for the plugin hook to use them.
    It relies on throwing an exception that is to be caught.
    
    Sponsored-by: ByWater Solutions
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9676f537a448d50770c90d9d5a8b420a1f302444
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jul 8 16:54:51 2020 -0300

    Bug 25961: Add hooks for plugins to inject variables to OPAC XSLT
    
    This patch adds the following plugin hooks:
    - opac_results_xslt_variables
    - opac_detail_xslt_variables
    
    This hooks will inject variables returned by the plugin in the form of a
    hashref, into the ones that are passed to the XSLT processing code.
    
    To test:
    1. Apply the 'DO NOT PUSH' commit
    2. Install the Kitchensink plugin
    3. Restart all
    4. Search biblios in the OPAC
    => SUCCESS: A text is injected in front of the biblio title
    5. Enter the detail page of any of the results
    => SUCCESS: A text is injected in front of the biblio title
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50ebed51ee160992e22cde55dcd657beb7429f8f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 15:21:50 2020 +0000

    Bug 24157: DBRev 20.06.00.018
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5aba38fdaec2958a23f0ccaa57b4c951af1244ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 24 13:03:31 2020 +0200

    Bug 24157: Handle the case where logged in user does not have edit_invoices
    
    This patch make possible the reopening and merging of invoices even if
    the logged in user does not have the edit_invoices permission
    
    I don't think it really makes sense but at least it's now possible.
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 110e0acb5c33f96b9cb61286fc45d480b088f565
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 21 11:09:50 2020 +0200

    Bug 24157: (follow-up) New permission - delete_invoices
    
    Hide the "Delete" invoice link if necessary on
    /cgi-bin/koha/acqui/invoice.pl?invoiceid=X
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b6d8bb0b6e0fc1e78ffa063740ca605e0efc367
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 21 11:03:07 2020 +0200

    Bug 24157: New permission - merge_invoices
    
    Add a new permission to merge invoices
    
    Test plan:
    - Remove the new permission "merge_invoices" for a given patron,
    use it to log in into Koha
    - Create 2 invoices, try to merge them
    => There is no way to merge it
    - Add the permission
    => Now you can merge the invoices
    
    Sponsored-by: Galway-Mayo Institute of Technology
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6638e9de8c405e119a3816516a3340e84f5d8793
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 6 19:13:35 2020 +0000

    Bug 24157: (follow-up) Conditionally show controls to reopen and close invoice
    
    This follow-up makes minor changes to the template so that the checkbox
    for reopening or closing an invoice are not displayed when the user
    doens't have the correct permissions.
    
    To test, apply the patch and try the process of viewing or editing an
    invoice as a user with these various permissions:
    
     - edit_invoices ON
     - edit_invoices OFF
     - reopen_closed_invoices ON
     - reopen_closed_invoices OFF
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b984a0feb29aede7a569dddd6aae35b13eed5cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 11 16:39:36 2019 +0100

    Bug 24157: New permission - delete_baskets
    
    Add a new permission to delete acquisition baskets
    
    Test plan:
    - Remove the new permission "delete_basket" for a given patron,
    use it to log in into Koha
    - Create basket, try to delete it
    => There is no way to delete it
    - Add the permission
    => Now you can delete the basket
    
    Sponsored-by: Galway-Mayo Institute of Technology
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fb8f3638859b1e27c2954363b175030fadbee17
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 11 16:37:46 2019 +0100

    Bug 24157: New permission - delete_invoices
    
    Add a new permission to delete invoices
    
    Test plan:
    - Remove the new permission "delete_invoices" for a given patron,
    use it to log in into Koha
    - Create an invoice, try to delete it
    => There is no way to delete it
    - Add the permission
    => Now you can delete the invoice
    
    Sponsored-by: Galway-Mayo Institute of Technology
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41c6940fcdb6522efef68430dcf88683e1831e63
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 13 17:37:36 2019 +0100

    Bug 24157: Add new method Acq::Invoice::Adjustement->fund
    
    Moving to its own commit in case we want to cherry-pick or move it to
    its own bug report.
    
    Sponsored-by: Galway-Mayo Institute of Technology
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3c8b8fe54b999a6d7f10ab6f6cc49db96edfd53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 10 21:05:40 2019 +0100

    Bug 24157: New permission - edit_invoices
    
    Add a new permission to edit invoices
    
    Test plan:
    - Remove the new permission "edit_invoices" for a given patron,
    use it to log in into Koha
    - Create an invoice, edit it (click "detail")
    => You can see the detail of the invoice, but cannot edit it. It's a read-only view.
    - Add the permission
    => The form is back and you can modify the invoices and save the changes.
    Also, you are able to create adjustments.
    
    Sponsored-by: Galway-Mayo Institute of Technology
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f10acb07e68f10a69e087012e47ae210cd609783
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 10 20:03:28 2019 +0100

    Bug 24157: New permission - reopen_closed_invoices
    
    New permission to reopen a closed invoice.
    
    Test plan:
    - Remove the new permission "reopen_closed_invoices" for a given patron,
    use it to log in into Koha
    - Create an invoice, close it
    => You are not able to reopen the invoice
    - Add the permission
    => You are able to reopen the invoice
    
    Sponsored-by: Galway-Mayo Institute of Technology
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f7bf2a6b4ab8d4d0be3b522753a8fd17d9fc54f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 30 15:21:50 2020 +0000

    Bug 25709: DBRev 20.06.00.017
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e45076c00b2f72537ba9c81c4535253f1aaadfb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jul 6 17:56:35 2020 +0000

    Bug 25709: Rename systempreference to NotesToHide
    
    In an effort to use more inclusive language we have added a new coding guideline:
    https://wiki.koha-community.org/wiki/Coding_Guidelines#TERM3:_Inclusive_Language
    
    This patchset renames a syspref to be clearer and follow the guideline
    
    To test:
    1 - Apply patch and updatedatabase
    2 - git grep NotesBlacklist
    3 - Note all remaining occurrences are translations, db updates, and release notes
    4 - Add a field (e.g. '520' ) to the NotesToHide systempreference
    5 - View a record with a 520 field on the opac
    6 - Confirm the field does not show in the 'Title notes' tab
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00a3aa21e86719dd702215150a4571219c434ddd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 27 14:59:59 2020 +0200

    Bug 25811: Debug - Paste the source of the page
    
    I am really struggling finding the problem here.
    Posting the source of the page may help.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc1b76be4a35403239fbce6f349ee343435cc8a0
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Sep 18 10:28:33 2019 -0400

    Bug 23086: Search for collection is broken
    
    It appears that we are quoting the ccode values deep in the search code.
    Under ICU chains this breaks searching by limits
    
    To recreate
     1 - Setup Koha using Zebra and icuchains
     2 - Add ccode to AdvancedSearchTypes
     3 - In koha-conf.xml set zebra debug level to include request
      <zebra_loglevels>none,fatal,warn,request,info</zebra_loglevels>
     4 - Set some items into different ccodes
     5 - On opac perform a search for:
        ccode:NFIC
     6 - It works
     7 - tail -n 50 /var/log/koha/kohadev/zebra-output.log
     8 - Note search request like:
        Search biblios OK 26 1 1+0 RPN @attrset Bib-1 @attr 1=8009 NFIC
     9 - On opac go to advanced search, select Collection, and limit to smae code a s above
    10 - No results
    11 - Check the zebra-output.log:
        Search biblios OK 0 1 1+0 RPN @attrset Bib-1 @attr 1=8009 'NFIC'
    12 - Apply patch
    13 - Restart all
    14 - Repeat search by collection limit
    15 - Success!
    16 - Check the zebra-output.log:
        Search biblios OK 0 1 1+0 RPN @attrset Bib-1 @attr 1=8009 NFIC
    17 - Add a new ccode value: N)N
    18 - Set some items to that ccode
    19 - Confirm searching by that ccode works
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40b6e1b8a1a6e74cb4e9a1c422ffa4faa0bdefc0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 15 15:33:18 2020 +0000

    Bug 23086: Unit test
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ec7ba72861f21c2ce83d3a98446af7db7a3e321
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Jul 6 20:38:42 2020 +0000

    Bug 25940: Check for reserve_id before Dopop
    
    TEST PLAN:
    1. Have an item belonging to a different branch and check it in.
    2. When the modal pops up hit 'Yes, print slip' or 'Print slip' if  AutomaticItemReturn is set to 'don't'
    3. The first print dialog should appear with a URL like '/cgi-bin/koha/circ/transfer-slip.pl?transferitem=18&&branchcode=CPL&op=slip'
    4. Close that print dialog and you will immediately see another one that says 'No slip template found'.
    5. Notice the URL of the second pop-up is:  /cgi-bin/koha/circ/hold-transfer-slip.pl?reserve_id=
    6. There is no reserve id so the template is not found.
    7. Apply patch
    8. Repeat 1-6
    9. You should no longer have two print dialogs
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e025cd76437b212746717ad54b5da22e410bbe8f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 12 10:51:36 2020 +0000

    Bug 25724: Do not call ModReserveStatus when completing transfer
    
    I can not see how this code is useful here. It checks for a reserve with priority 0 and found = NULL
    That is not a status that should occur when filling a transfer. Either the found is 'T' if we are transferring due
    to the hold, or the hold was placed after the transfer was initiated, and so the priority is not 0
    
    Additional, AddReturn checks for reserves later and asks the staff to confirm waiting status.
    
    ModReserveStatus also calls CartToShelf regardless of what happens here.
    
    To test:
    1 - Set  UpdateItemLocationOnCheckin  to:
        _ALL_: CART
    2 - SetAutomaticItemReturn = Do
    3 - Check an item in at a different branch than it's homebranch to create a transfer
    4 - Check the item in at it's homebranch
    5 - View the item details page
    6 - Item is not in CART location
    7 - Apply patch
    8 - Repeat
    9 - Item is in CART location after completion of transfer
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jason Robb <jrobb@sekls.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 028e9a07db625845482eff1b550a9bbe86ec6fbc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 12 11:11:26 2020 +0000

    Bug 25724: Unit tests
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jason Robb <jrobb@sekls.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 330c51c272d38831d1ba27ee39bd5ec2344b767a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 24 07:26:14 2020 -0400

    Bug 24279: Disable editing lost status in items editor if item is a return claim
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fa926be88294bf8e14588dac0134eab506fdecb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 26 07:27:28 2020 -0400

    Bug 24279: Disable lost status select if item has a return claim
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8e73978a246780296a304164e551f66430a2d8a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 7 12:33:17 2020 +0200

    Bug 24279: Display the tip in the title of the option
    
    This patch tells select2 to retrieve the title attribute from the
    original option node.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a57e3d3db5cf7680a7e199b3c9b26d2e6bb3abc
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Apr 23 09:04:25 2020 -0400

    Bug 24279: (QA follow-up) Show values disabled with tooltips
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b38546f1d150edaf85180d4be2aa68df42674f27
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Dec 30 08:04:29 2019 -0500

    Bug 24279: Claims Returned does not work when set from additem.pl
    
    Test Plan:
    1) Configure Claimes Returned
    2) Apply this patch
    3) Go to additem.pl for that item
    4) Note the claims returned lost status does not show in the lost status pulldown
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 757510c84c4427fb6a68c7d9bc1825c0a26a82cd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Dec 30 07:51:23 2019 -0500

    Bug 24279: Claims Returned does not work when set from moredetail.pl
    
    Test Plan:
    1) Configure Claimes Returned
    2) Apply this patch
    3) Go to moredetail.pl for that item
    4) Note the claims returned lost status does not show in the lost status pulldown
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcd659b2d4cf62df48113567c59392e8dff9696f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 27 15:15:44 2020 +0200

    Bug 25729: Prevent Charges/Fees.t to fail on slow server
    
    We must use t::lib::Dates::compare to compare dates
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4f3a0f0a6e813716b7f3995e69998f3abf5cc1d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 27 10:12:35 2020 +0200

    Compiled CSS (OPAC)
    
    This RM task has not been done when it was needed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d56af377c158823497df17b2ef18637bbc11a1c
Author: Mason James <mtj@kohaaloha.com>
Date:   Mon Jun 29 13:40:36 2020 +1200

    Bug 25889: Increase performance of debian/list-deps script
    
    to test... (on a i7-2600 vm with 8 cores)
    
    1/ run script, note execution time
        $ time ./debian/update-control
        real    8m5.000s
    
    2/ copy old file
        $ cp ./debian/control control.old
    
    3/ apply patch
    
    4/ run updated script, note execution time is smaller
        $ time ./debian/update-control
        real    2m14.000s
    
    5/ copy new file
        $ cp ./debian/control control.new
    
    6/ confirm old and new control files are identical
        $ diff control.old control.new | wc -l
        0
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8aa907379eb54d360746c3e15051327a1e6cc1fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 21 12:36:17 2020 +0200

    Bug 26033: Use pic.infini.fr instead of framapic
    
    https://framapic.org/ is closing
    """
    Framapic will be closing its doors on Tuesday, January 12, 2021. You will find a similar service on this page.
    Uploading images is now disabled, but you can still retrieve your images on the My images page.
    """
    
    https://framablog.org/2019/09/26/lets-de-frama-tify-the-internet/
    https://framablog.org/2020/03/03/10-bonnes-raisons-de-fermer-certains-services-framasoft-la-5e-est-un-peu-bizarre/
    (French)
    
    We can still use another service. However we may think about hosting the
    service ourself!
    
    Test plan:
    Modify a selenium script to make it fail (for instance modify the path
    for a find_element call)
    Run it
    Confirm that the screenshot has been uploaded correctly and that the
    link works
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a505632b8d1300a02512cfe300056f7b3797bfb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Jul 17 23:36:24 2020 +0000

    Bug 26016: Fix capitalization for "MARC Preview"
    
    To test:
    - Go to any record in the staff catalog
    - Check the display for the 'MARC Preview' link
    - Apply patch
    - It should have changed to 'MARC preview'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b9c0f338bdacb579ef4d68d1e3dc85515419929
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jul 22 10:09:29 2020 +0100

    Bug 20799: (QA follow-up) Move syspref check
    
    This patch moves the syspref check into the controller to save a DB
    query if the module is not enabled.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD - amended patch: removing trailing parenthesis in the IF statement
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4cf04214d381dd9a9eed28a2ee24e0c01eaaf36f
Author: Katrin Fischer <katrin.fischer@bsz-bw.de>
Date:   Mon Jun 29 17:56:31 2020 +0200

    Bug 20799: (follow-up) Add ILLModule system preference check and fix display for no requests
    
    When there were no requests the label would still display, using .count fixes this.
    Also adds a check on the ILLModule system preference to prevent the information from
    showing when the ILL module is deactivated.
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a6b28a914269356e27054811e0d87fc10c12a7d
Author: Magnus Enger <magnus@libriotech.no>
Date:   Mon Dec 9 17:48:35 2019 +0100

    Bug 20799: Add link from biblio to ILL detail view
    
    Some ILL systems (e.g. Libris in Sweden) require a link between
    a biblio and an ILL request. When such a link exists it is nice
    to display an actual link from the biblio detail view to the
    ILL request detail view. This patch adds such a link. For users
    without ILL privileges, the requests should still show, but not
    be clickable links.
    
    To test:
    - Make sure you have a couple of ILL requests created with the
      FreeForm backend. (FreeForm does not let you tie a request to
      a biblio through the UI, but we will add connections directly
      in the database.) Lets assume these have illrequest_id's a and b.
    - Make sure you have a record, let's call the biblionumber x.
    - Apply the patch and make sure there are no changes in the biblio
      detail view of biblionumber x.
    - Log into the database and connect the biblio to the first request:
      UPDATE illrequests SET biblio_id = x where illrequest_id = a;
    - Check that the biblio detail view now says this:
      "ILL requests: Request a"
    - Verify that the "Request a" part is a working link to the detail
      view of ILL request a.
    - Do this in the database:
      UPDATE illrequests SET biblio_id = x where illrequest_id = b;
    - Check that the biblio detail view now says this:
      "ILL requests: Request a, Request b"
    - Verify the links work as expected.
    - Log in as a staff user and check that the requests are still
      listed, but not displayed as clickable links.
    - Sign off
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58075331a9e68db0539d59abb4f1a4f215a12120
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 24 14:10:52 2020 +0200

    Bug 23092: DBRev 20.06.00.016
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b902c7b7512851027c92cf629fd7796d1c8035d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jun 16 13:51:00 2020 +0100

    Bug 23092: Add unit tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4eac2298592ef7d75bd6575cb2e823aeeace8f9d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jan 17 12:04:07 2020 +0000

    Bug 23092: Add 'daterequested' to branchtransfers table
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e14c1702b446111f98ce6736aa7544df14b03d1d
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Sep 30 09:28:40 2019 +0000

    Bug 23696: take deleted biblios into account when building oai sets
    
    Test plan:
    0) do not apply the patch
    1) set up OAI and create at least one set
    2) run build_oai_sets.pl
    3) remember/write down number of records added
    4) delete a biblio, the is included in set
    5) run buid_oai_sets.pl again
    6) the set is 1 record smaller
    7) apply the patch
    8) run build_oai_sets.pl
    9) the number of record should be the same as in 3)
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 664c0de114be2c47786e570b316f941ade337d1f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 24 14:09:03 2020 +0200

    Bug 25031: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a64368e1fd16d73a87fdda37fc0851743e4ad6db
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 24 11:19:24 2020 +0000

    Bug 25031: (follow-up) Fix markup error and restore cover class
    
    This patch corrects a markup error that appears when no cover image
    services are enabled. An unclosed <div> caused links on the page to
    break.
    
    This patch also restores a part of the cover-handling script which adds
    a bordered style to the cover image "tiles"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 784e4685de0934c939f7047bcea191088169d824
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jul 23 19:49:33 2020 +0000

    Bug 25031: (QA follow-up) Avoid displaying extra navigation
    
    This patch reworks the construction of the navigation links in such a
    way that they are built during a loop over an updated jQuery object.
    Previously the stored variable might not reflect that some elements
    had been removed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa8c57e55d3f3cc027bc6e9d0fdf8dad81555453
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 17 21:45:00 2020 +0000

    Bug 25031: (QA follow-up) Improve handling of one or fewer images
    
    This patch addresses a few issues raised during QA:
    
    1. If there are no images, avoid the momentary appearance of an empty
       borered box. The class controlling the appearance of the box is now
       added after initialization.
    2. If there is only one image, remove the control for switching
       between covers.
    3. Add "preventDefault" to cover naviation click handler.
    4. Correct translation function in localcovers.js.
    
    This patch modifies SCSS, so rebuilding the staff client CSS is
    necessary for testing.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b6cea9d64f255cce481012a30a0ae3298e160b2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 31 21:37:18 2020 +0000

    Bug 25031: Improve handling of multiple covers on the biblio detail page in the staff client
    
    This patch modifies the template, JS, and CSS for the bibliographic
    detail page in order to gracefully handle multiple cover images.
    
    The changed version loops through any cover images which might be
    embedded and checks that they are successfully loaded. Only
    successfully-loaded images are shown. Only the first image is shown, and
    the others can be "paged through" using generated navigation controls.
    
    To test, apply the page and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Enable multiple cover image services. The patch was developed with these
    services available:
    
     - Amazon
     - Local cover images (including multiple local cover images)
     - Coce (serving up Amazon, Google, and OpenLibrary images)
     - Images from the CustomCoverImages preference
    
    View a variety of titles and confirm that the cover images are
    displaying correctly, whether there be 0, 1, 2, or more covers
    available.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2e191c3fff9ef68bf7104b72922ded77e9d5217
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 12:14:56 2020 +0200

    Bug 24151: (follow-up) Rename the config key with 'bcrypt_settings'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 452015c054a988ad2016dcad896be516dc318743
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:51:32 2020 +0200

    Bug 23797: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0edaab49afec96c793477e9e790b4a9d7b6044fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:50:27 2020 +0200

    Bug 23797: Apply DB changes to kohastructure.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfb89695aa90bcb6d8c26c0a59ee68f92dd54df9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:41:23 2020 +0200

    Bug 23797: DBRev 20.06.00.015
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81e83d250c60b9b571c15d59b1867ebdbd8d6a7f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:40:18 2020 +0200

    Bug 23797: DBRev 20.06.00.014
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bc9765d043169dfeb569e25659f553f39dc466b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jul 7 18:36:32 2020 +0000

    Bug 23797: (follow-up) Enable OpacLoginInstructions in header
    
    The OpacLoginInstructions information should be available in the login
    modal which is displayed when the login link in the header menu is
    clicked.
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8c5b54acfa94f2c5e04f3376223e883deef9937
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 29 13:07:42 2020 +0000

    Bug 23797: (follow-up) Increase the size of opac_news.lang
    
    This patch adds a database update to increase the size of the
    opac_news.lang column in order to accommodate longer values.
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be1d25ba16014c5fb3c788f8a93c5ecf3f5d9dbf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 24 15:06:30 2020 +0000

    Bug 23797: Convert OpacLoginInstructions system preference to news block
    
    This patch builds on Bug 22318 to move the OpacLoginInstructions system
    preference into the Koha news system, making it possible to have
    language- and library-specific content.
    
    To test you should have some content in the OpacLoginInstructions system
    preference. Apply the patch and run the database update process.
    
     - Go to the OPAC and click the login link.
     - In the login modal, confirm that the content which was previously in
       the OpacLoginInstructions system preference displays correctly
       below the login form.
     - While not logged in to the OPAC, navigate directly to
       /cgi-bin/koha/opac-user.pl. The OpacLoginInstructions content should
       display correctly here as well.
     - In the staff client, go to Tools -> News and verify that the content
       from OpacLoginInstructions is now stored in news items. There
       should be one entry for each of the enabled translations in your
       system, for instance 'OpacLoginInstructions_en',
       'OpacLoginInstructions_fr-FR', 'OpacLoginInstructions_cs-CZ'
     - Go to Administration -> System preferences and confirm that the
       OpacLoginInstructions preference has been removed.
     - To test the correct selection of language-specific content you must
       run the translation update/install process for the languages you're
       updating.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0a0f630bb523cfcda6efa82049608474e09fb15
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:36:54 2020 +0200

    Bug 23796: DBRev 20.06.00.013
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16053574a5bff66d86ebcc906ccbabe31c45d1c7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 11 18:20:46 2019 +0000

    Bug 23796: Convert OpacCustomSearch system preference to news block
    
    This patch moves the OpacCustomSearch system preference into the Koha
    news system, making it possible to have language- and library-specific
    content.
    
    To test you should have some content in the OpacCustomSearch system
    preference. Apply the patch and run the database update process.
    
     - Go to the OPAC and confirm that the content which was previously in
       the OpacCustomSearch system preference now displays correctly where
       it was before.
     - In the staff client, go to Tools -> News and verify that the content
       from OpacCustomSearch is now stored in news items. There should be
       one entry for each of the enabled translations in your system, for
       instance 'OpacCustomSearch_en', 'OpacCustomSearch_fr-FR',
       'OpacCustomSearch_cs-CZ'
     - Go to Administration -> System preferences and confirm that the
       OpacCustomSearch preference has been removed.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f819ac9b97bd6c9872259f2b614543724fefbbf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:35:13 2020 +0200

    Bug 23795: DBRev 20.06.00.012
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9eb2be381bf9b6848b14bd374ba004f41198ed0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 11 17:03:01 2019 +0000

    Bug 23795: Convert opaccredits system preference to news block
    
    This patch builds on Bug 22318 to move the opaccredits system
    preference into the Koha news system, making it possible to have
    language- and library-specific content.
    
    To test you should have some content in the opaccredits system
    preference. Apply the patch and run the database update process.
    
     - Go to the OPAC and confirm that the content which was previously in
       the opaccredits system preference now displays correctly where
       it was before.
     - In the staff client, go to Tools -> News and verify that the content
       from opaccredits is now stored in news items. There should be
       one entry for each of the enabled translations in your system, for
       instance 'opaccredits_en', 'opaccredits_fr-FR',
       'opaccredits_cs-CZ'
     - Go to Administration -> System preferences and confirm that the
       opaccredits preference has been removed.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd9ece8c194ffc960b5709b884620bf24e29068b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 16:03:54 2020 +0100

    Bug 25765: (QA follow-up) Use method directly in cleanborrowers
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83d63d2302ee77c68dbae8be80fc6a038fa5ce51
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 15:58:02 2020 +0100

    Bug 25765: (QA follow-up) Save a DB hit
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cbd86551571260ca6daade57920e0fb3f290dfb4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jun 16 14:01:39 2020 +0200

    Bug 25765: Replace LoginBranchname and LoginBranchcode with use of Branches template plugin
    
    The template plugin Branches contains a method GetLoggedInBranchcode that returns current branch code.
    This patch adds GetLoggedInBranchname to get current branch name.
    It is used to replace vars LoginBranchname and LoginBranchcode sent to all templates in C4/Auth.pm.
    
    In labels and patrons cards modules, I choose to remove a unseless display of
    current branch in a hint.
    
    In acqui/acqui-home.tt, I choose to remove a useless display of current
    branch and also because table of founds contains a filter on library.
    
    Test plan:
    Check pages source code to see branch code or name is correct.
    list of the pages:
    /cgi-bin/koha/acqui/acqui-home.pl
    /cgi-bin/koha/catalogue/detail.pl?biblionumber=XXX
    /cgi-bin/koha/circ/branchoverdues.pl
    /cgi-bin/koha/circ/set-library.pl
    /cgi-bin/koha/circ/offline.pl
    /cgi-bin/koha/labels/label-edit-batch.pl?op=new
    /cgi-bin/koha/labels/label-manage.pl
    /cgi-bin/koha/patroncards/edit-batch.pl
    /cgi-bin/koha/patroncards/manage.pl
    OPAC:
    /cgi-bin/koha/opac-detail.pl?biblionumber=XXX
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0fcd0fd2707188368fa5b370b808e875c6ea5814
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jun 16 13:59:29 2020 +0200

    Bug 25765: Add GetLoggedInBranchname method
    
    Add GetLoggedInBranchname method to Branches templates plugin.
    
    Also changes GetName method to use Koha::Library instead of direct SQL.
    
    Test plan :
    Run prove t/db_dependent/Template/Plugin/Branches.t
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12e83a64ececa12e691d855e2454a30a9b5e0e04
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:32:09 2020 +0200

    Bug 5087: DBRev 20.06.00.011
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2d45ac0f4687fc4dcf84e9de663f8d3f3a354be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 11:15:24 2020 +0200

    Bug 5087: Add server-side check
    
    If a user to access a CSV profile that is not available at the OPAC we
    should redirect to 404.
    
    It will also handle undefined csv_profiles
    
    For instance:
    kohadev.mydnsname.org:8080/cgi-bin/koha/opac-downloadshelf.pl?shelfnumber=1&format=3
    kohadev.mydnsname.org:8080/cgi-bin/koha/opac-downloadcart.pl?bib_list=1/2/&format=3
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db15f4af8dc021c0ac06c3447cb87c5e51952cd2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 20 12:02:14 2020 -0300

    Bug 5087: (QA follow-up) Fix leakage in opac-downloadshelf.pl
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92d0472d631817395ad71f89f962fa5166f15770
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 20 11:27:27 2020 -0300

    Bug 5087: (QA follow-up) used_for deserves an index
    
    This patch introduces an index for the used_for column
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 478093072000d01b2b5c20f05044e4bd3bbfeecd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 20 11:09:01 2020 -0300

    Bug 5087: (QA follow-up) Rename the attribute to fit later API usage
    
    This patch renames the introduced attribute for later usage on the API,
    and changes the logic to use it the other way around.
    
    It also adds a KEY for the flag, as it will be used in WHERE statements.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae3644a5947ea410fc3e8ac8b64307df7d1cbb18
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Dec 20 22:52:59 2018 +0000

    Bug 5087: Ability to define whether CSV profile shows in OPAC
    
    To test:
    1) Update database
    2) Update schema
    3) In staff side, go to Tools -> CSV profiles
    4) Make a CSV profile with profile type = MARC and usage = Export
    records
    5) Leave 'Show option in OPAC' unchecked and save
    6) Go to OPAC and add an item to your cart
    7) Click Cart, click Download, confirm that your newly created CSV
    profile does not show as an option
    8) Go back and edit CSV profile on staff side
    9) Check the 'Show option in OPAC' checkbox and save
    10) Go back to download cart in OPAC
    11) Confirm the CSV profile now shows in the dropdown
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Maryse Simard <maryse.simard@inlibro.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07a7dbbcf427dfcff9aa386832e9f9cf1c4b4828
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 23 10:30:31 2020 +0200

    Bug 20815: DBRev 20.06.00.010
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa1571cc0a0b2def305a500b5bd344b2ff2fcbea
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jul 22 08:54:26 2020 -0400

    Bug 20815: Add unit tests for changes to AddIssue
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfb70ce9f1edf54d9aad3755f1fb840b5ed4b6d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 21 18:45:37 2020 +0200

    Bug 20815: Tests refactoring
    
    Some code were duplicated.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83d9a6e60289912736b0181d4e9cee090b4d0ffe
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Jul 6 20:53:55 2020 +0000

    Bug 20815: (QA follow-up) Add message to database update / rephrase pref
    
    - Make pref use "checked in" instead of "returned".
    - Add message to database update
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b8b542f9e49ab3f7c45aaa7eda33df1607028ef
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Jul 6 07:03:21 2020 -0400

    Bug 20815: Do not use compare float with precision
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e453f74cfd2358ea795f2f0677946fba75ad7841
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Feb 12 12:55:51 2020 -0500

    Bug 20815: Add ability to choose if lost fee is refunded based on length of time item has been lost
    
    This adds the ability to not refund lost item fees on return if the item
    has been lost for more than a given number of days.
    
    Test Plan:
    1) Set the new system preference NoRefundOnLostReturnedItemsAge to a number of days
    2) Find a lost item that has been lost longer than that NoRefundOnLostReturnedItemsAge days which would have otherwise been refunded
    3) Return the item
    4) Note no refund on the lost item fee was processed, the fee remains unchanged
    5) prove t/db_dependent/Circulation.t
    
    Signed-off-by: Deb Stephenson <DStephen@dubuque.lib.ia.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 005219ea6fc53a52a41169e96024244abb394ee1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 8 14:24:37 2020 +0000

    Bug 25955: Fix getting index_name
    
    To test:
    1 - Have a site running ES
    2 - perl misc/maintenance/compare_es_to_db.pl
    3 - Lots of output, all bad
    4 - Apply patch
    5 - Repeate
    6 - Whew, looks correct
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 015ed932114ff48e944739afa9123d2501d65e14
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jul 20 09:50:58 2020 -0300

    Bug 25845: (QA follow-up) Call it REST API instead of just API
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b526483c65550c0f36eabad70055bed79a8197c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 23 11:06:55 2020 -0300

    Bug 25845: Add 'api' to the log viewer interface options
    
    This patch simply adds the API option to the log viewer.
    
    To test:
    1. Have BorrowersLog set
    2. Update some patron using the API. For example
       curl --location --request PUT 'http://koha:koha@kohadev-intra.mydnsname.org:8081/api/v1/patrons/1' \
    --header 'Content-Type: application/json' \
    --data-raw '{
    "firstname": "Tomasito",
    "surname": "None",
    "address": "Address",
    "category_id": "ST",
    "city": "Córdoba",
    "library_id": "MPL"
    }'
    3. Open the log viewer
    => FAIL: There's no way to filter on interface, choosing API
    4. Apply this patch
    5. Reload the log viewer
    => SUCCESS: There are options to filter by 'API' interface
    => SUCCESS: Filtering by 'API' works
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b31fdc8f55007217f95980692114a5b0a9a85bc0
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jul 1 06:53:18 2020 -0400

    Bug 25907: When cancelling a waiting hold on returns.pl, looks for new hold to fill without rescanning barcode
    
    Right now, after canceling a hold on the checkin screen, a librarian
    needs to rescan the item barcode to check and trap the next hold. This
    is an extra unnecessary step.
    
    Test Plan:
    1) Place two or more holds on a record
    2) Check in the item
    3) Confirm the hold
    4) Check in the item again
    5) Cancel the hold
    6) Koha should now display the modal asking to confirm the next hold
       without the need to rescan the barcode!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc2c19bd515a4ce4057b41b2ae2bb668d345c461
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 30 00:46:46 2020 +0000

    Bug 25629: Fix capitalization in sample notices
    
    This fixes the capitalization in sample notices files to
    follow coding-guidelines. Only applies to English, translations
    remain unchanged.
    
    Additional fixes:
    - Overdues slip added the letter code as subject instead of the description
    - Opac changed to OPAC for self-registration verification emails
    
    German (de-DE) file was not changed, as there is a pending translation
    bug that will take care of these (bug 25129).
    
    To test:
    - Verify changes by running the web installer for the changed
      files and verify sample notices install without error
    - Verify subjects and notice descriptions are correct
    - Run tests in t/db_dependent/Letters*
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 997094cc38a46372777f39f0bfa249b87fe76d58
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 17 07:44:45 2020 +0100

    Bug 25998: (QA follow-up) Add DBIC level relation
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16413beea6a2f5667a3a68971158ad1d7ea4b48a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 16 09:40:23 2020 +0100

    Bug 25998: Add 'library' relation to Koha::Account::Line
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9927e729066be42a039b7e3f1abb5143820d1cb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 17 08:01:06 2020 +0100

    Bug 25998: Add Unit Tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14932ae7d3bf864f64bffc9b1b015a07e11c8e2e
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Jun 18 13:26:20 2020 +1200

    Bug 25792: Rename 'ttf-dejavu' package to 'fonts-dejavu' for Debian 11
    
    to test...
     1/ attempt to install koha 20.05 package on deb11, fail :'(
     2/ apply patch and build new koha package
     3/ attempt to install new koha package on deb11, succeed!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56ee42082f0382d2b5e5a8cef081bef886664d7d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 21 11:18:16 2020 +0100

    Bug 8338: (QA follow-up) Fix test for backdated return
    
    A test for CalculateFinesOnBackdate was introduced since this bug was
    written and needed updateing.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f5f5d88b98c2d1f6cc20bc6be6f5b41fb7d3c48
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 21 10:08:02 2020 +0200

    Bug 23820: Fix Koha/Club/Hold.t
    
    kohadev-koha@kohadevbox:/kohadevbox/koha$ prove t/db_dependent/Koha/Club/Hold.t
    t/db_dependent/Koha/Club/Hold.t .. Patron(238) Hold cannot be placed. Reason: libraryNotPickupLocation at /kohadevbox/koha/Koha/Club/Hold.pm line 98.
        # Looks like you planned 5 tests but ran 4.
    t/db_dependent/Koha/Club/Hold.t .. 1/1
     #   Failed test 'add'
     #   at t/db_dependent/Koha/Club/Hold.t line 86.
    Can't call method "borrowernumber" on an undefined value at t/db_dependent/Koha/Club/Hold.t line 83.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4aa93f04f406b010cd26ea121332133f2599f800
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 21 09:57:08 2020 +0200

    Bug 24151: Use fully qualified names for UpdateStats
    
    t/db_dependent/Koha/Account/Line.t .. 8/12     # Looks like you planned 16 tests but ran 3.
     #   Failed test 'void() tests'
     #   at t/db_dependent/Koha/Account/Line.t line 723.
    Undefined subroutine &Koha::Account::UpdateStats called at /kohadevbox/koha/Koha/Account.pm line 289.
    
    It's certainly caused by a circ dep from
      commit 5ce968e0e571f555261c02a9e1d27447611cdb89
      Bug 24151: Copy info to the pseudonymized table when a transaction is done
    
    See also bug 17600 for more context.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1326fa076b2311ffd9a1df4b995309670bf55cdd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 21 09:47:11 2020 +0200

    Bug 22844: Fix yaml_valid.t - don't pick .json files
    
    Only .pref are considered yaml files.
    
    kohadev-koha@kohadevbox:/kohadevbox/koha$ time prove xt/yaml_valid.t
    xt/yaml_valid.t .. 1/19
     #   Failed test 'borrowers.json is YAML'
     #   at xt/yaml_valid.t line 39.
    
     #   Failed test 'items.json is YAML'
     #   at xt/yaml_valid.t line 39.
     # Looks like you failed 2 tests of 19.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01ab775440ee8418e21872c309acee7b1739fad8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 29 15:08:47 2020 +0000

    Bug 25827: Add floating toolbar to the holds summary page in staff interface
    
    This patch adds a floating toolbar to the holds summary page in the staff
    interface.
    
    To test, apply the patch and view the holds page for a title with
    multiple holds on it. Test that when you scroll down past the position
    of the "Update hold(s)" button, the toolbar "sticks" to the top of the
    screen.
    
    Test that holds are updated correctly after clicking the "Update
    hold(s)" button.
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@outlook.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 581bd91319703aaf8c972fbf4226d25d87e556a2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 29 14:31:24 2020 +0000

    Bug 25892: Clarify the visual hierarchy of holds by branch and itemtype
    
    This patch makes minor changes to the markup of the holds list to make
    the page hierarchy clearer when holds are grouped by branch and
    itemtype.
    
    Test plan:
    
     - Enable the  AllowHoldItemTypeSelection system preference.
     - Locate a record in the catalog and place multiple holds:
       - Holds at different branches
       - Holds with different itemtypes selected
     - View the holds page with various values of the HoldsSplitQueue
       preference enabled:
       - nothing
       - pickup library
       - hold itemtype
       - pickup library & itemtype
    
       In each case verify that the interface works well.
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@outlook.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a6d0802e89cfc6634896d9ab9385fac16c87c5e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 26 08:31:38 2020 +0000

    Bug 25801: (follow-up) Fix indentation level of else block
    
    Just fixing the indentation here with a substitution cmd.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fdbfcf6163af5ce475488eaf897541bfd14e97c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 26 08:30:44 2020 +0000

    Bug 25801: (follow-up) Add Show all items-link on opac-detail
    
    As requested by Katrin in QA, it might be helpful to provide a
    link to return to the regular view with all items.
    
    The information about acquisition and holds refers to all items,
    so I moved it inside the else branch of this block.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dbaf146266a5d25d2c3843cde977cfa027854134
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 18 11:34:27 2020 +0000

    Bug 25801: Add itemnumber parameter to opac-detail
    
    Note: The GetItemsInfo call is now suboptimal. Leaving it as-is
    for now in the hope that item refactoring picks it up ;)
    
    Test plan:
    Test opac-detail via biblionumber (regular use).
    Test opac-detail by passing an itemnumber in the URL:
        /cgi-bin/koha/opac-detail?itemnumber=999
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4cff589ba80984a8029c4b4675afb55d09030a9
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jun 29 22:04:56 2020 +0300

    Bug 25799: Add edition information to "Holds queue" report
    
    Added a feature that displays edition information of the book
    together with title in "Holds queue" report.
    
    Edition information is fetched from "biblioitem" table
    as "editionstatement" and transferred to template.
    
    1. Place a hold on a book with edition information.
    2. Run build_holds_queue.pl cron job.
    3. Go to /cgi-bin/koha/circ/view_holdsqueue.pl and check the "title"
    table of that book that you placed hold on.
    4. Observe that there's no information about edition of that book.
    5. Apply patch.
    6. Repeat step 3.
    7. Observe that cinformation about edition of that book appeared
    in the title table after book's title and author.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58abd5b39b248eb08065e3a0d7f5f811175cecca
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Sat Jun 27 00:06:47 2020 +0300

    Bug 25798: Add copyright year to "Holds to pull" report
    
    Display copyright year (publication year) of book
    together with title in "Holds to pull" report.
    
    Copyright year is fetched from biblio -table as "copyrightyear"
    and displayed when the preferred marc is set to MARC21.
    Publication year is fetched from biblioitems -table as "publicationyear"
    and displayed when the preferred marc is set to UNIMARC.
    
    1. Place a hold on book with known copyright year.
    2. Go to /cgi-bin/koha/circ/pendingreserves.pl and check the "title"
    table of that book that you placed hold on.
    3. Observe that there's no information about publication year in that
    field.
    4. Apply patch.
    5. Repeat step 2.
    6. Observe that copyright year (publication year) of book appeared
    in the title table after book's title and author.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8fe7de5be946735b59fdc5cd8e8c6b166ed2475
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Jul 17 14:26:15 2020 +0000

    Bug 25723: (QA follow-up) Remove unused module import
    
    The last usage of this module was removed in the commit
    "Bug 25723: Update cache flushing calls" but the import was
    not removed along with it.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 223b603f08267f801860bf5deaaa1884e58eab1e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 17 12:34:18 2020 +0000

    Bug 25723: (QA follow-up) Handle holiday and exception on same day
    
    When a holiday is entered, then exceptions generated on a range, there exists both a holiday and exception in
    the special holidays table. We should cache the exception over the holiday instead of both
    
    Also, !1 in perl returns '' rather than 0, so we should explicitly set the value
    
    Add blank line to clear pod error from qa tools
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Re-introduce the blank line mentioned in the commit message, it was accidentally removed by automatic formatting
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5851539424d04eda0da52ef8744925227dd6ce0f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 17 14:04:14 2020 +0100

    Bug 25723: (QA follow-up) Silent POD warning
    
    I didn't introduce the method that is warned about, but adding POD for
    it seemed reasonable and will silence the QA Script warning.
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25f0d425eaa7c66953d02c5a5717b1b2abcb89a6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 17 13:46:34 2020 +0100

    Bug 25723: Remove tests for removed method
    
    We removed the exception_holidays (and single_holidays) methods as part
    of this patchset. As such, we should no longer test them ;)
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61141c28b0fcbbb021371bb4c2dd8e818aec0691
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 17 13:18:24 2020 +0100

    Bug 25723: Update cache flushing calls
    
    This patch updates the previous single_holidays and exeption_holidays
    cache flushing calls to match the new cache key structure of the updated
    routines.
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae0b2befe8c9086df24469cb546c7c5f8d98de95
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 17 11:14:30 2020 +0100

    Bug 25723: Use the same code for single and exception holidays
    
    This patch refactors is_exception_holiday and is_single_holiday to
    utilise a single _holidays method which combines the logic of the
    previous single_holidays and exception_holidays methods.
    
    As Koha::Calendar is instantiated at a branch level, we also move split
    the cache into branches too.
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1dfe50522a01a7640fcca6e2a015206939579c9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 12 16:30:28 2020 +0100

    Bug 25723: Use a hasref for lookup
    
    Rather than using an array of dates and iterating them, use a hashref
    and do a direct lookup
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd862763c9654ded15c1a7d79fafb2ec73e4f20e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 12 16:02:26 2020 +0100

    Bug 25723: Drop DateTime::Set from cpanfile
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b2990d270fdde9fd7f69f6402db9ee171b6473e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 12 15:11:52 2020 +0100

    Bug 25723: (follow-up) Fix Unit Test
    
    The unit test previously relied on the internals of exception_holidays.
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f0553da225052ff5b8b9bca7a386e04472f32da
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 12 11:53:49 2020 +0100

    Bug 25723: Drop DateTime::Set dependancy
    
    This patch removes our use of DateTime::Set and replaces it with a quick
    hashref implimentation
    
    Signed-off-by: Emma Perks <Emma.Perks2@uhb.nhs.uk>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2440d480ca24bd1d15731fbd32aec0ea3aa71086
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed Jul 8 17:24:46 2020 -0400

    Bug 25718: Correct typo in additem.tt
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 379fd6d838d9909ea5784011486f3d184766a833
Author: David Nind <david@davidnind.com>
Date:   Sat Jun 27 00:38:46 2020 +0000

    Bug 25717: Improve automatic renewal error messages
    
    Improve wording and grammar for automatic renewal error messages.
    
    Test plan:
    1. Review the error message changes and make sure they make sense.
    
    The new message make sense to me.
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c0666c531133a4c743a50ee01a0aada84c2e3cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 16:57:42 2020 +0200

    Bug 25511: Add POD for --force
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34666e26902facdc3bc7e46a7ecd539f69f813e5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 15 10:51:46 2020 +0100

    Bug 25511: Add --force option to update_dbix_class_files.pl
    
    This adds a --force option to the aforementioned script allowing those
    in the know to overwrite the schema when changes above the found are
    detected.
    
    Signed-off-by: Ere Maijala <ere.maijala@helsinki.fi>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1f3117583a41d02f2ad794622f9becd469720f0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 8 15:11:19 2020 +0000

    Bug 25427: Make authority subfield management interface consistent MARC view
    
    This patch makes a couple of minor changes to the authority MARC
    subfield structure administration interface to make it more consistent
    with the corresponding MARC subfield interface.
    
    To test, apply the patch and go to Administration -> Authority types.
    
    - Pick an authority type to edit, for instance PERSO_NAME, and choose
      'MARC structure' from the Actions menu.
    - Pick a tag to edit and select "Subfields" from the Actions menu.
    - In the table of subfields for that tag, each subfield in the first
      column should link to the edit interface for that subfield (its tab
      pre-selected).
    - The "Edit" button in that table should do the same.
    
    Signed-off-by: Heather Hernandez <heather_hernandez@nps.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e722dd1725e113acd79dcb9e8eed2cd4da35aa33
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 13 15:18:23 2020 +0000

    Bug 25984: Add minimum height and width to shelf browser covers
    
    This patch adds a class to the shelf browser cover image links and a
    style for these links defining a minimum height and width. This allows
    the browser's default tab focus outline to be visible.
    
    This patch also adds a check for an enabled cover image service before
    displaying the cover image links.
    
    This patch introduces whitespace changes so diff accordingly.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Enable the OPACShelfBrowser system preference.
    - Enable at least one cover image service (Amazon, Google, Coce, etc).
    - Locate a title in the OPAC which has items attached.
    - On the bibliographic detail page, click the "Browse shelf" link in the
      table of holdings to display the shelf browser.
    - Use the tab key to move the focus to cover images in the shelf
      browser.
    - Confirm that the focus outline moves through each cover link whether
      or not there is a cover image available.
    - Diable all cover image services.
    - Test the shelf browser again and confirm that it's not necessary to
      tap through an empty row.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1a7112a9054305ead325daedd6bb106a31b346f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 29 15:55:17 2020 +0100

    Bug 25244: Add specific aria-label to search results
    
    This patch adds an arai-lebel to the select checkboxes on the search
    results page of the OPAC.
    
    Test plan
    1/ Perform a search that will yield some results
    2/ Inspect the 'checkbox' on the left side of the results table
    3/ Note that there is no arai-label
    4/ Apply patch
    5/ Refresh the search results page
    6/ Inspect the 'checkbox' on the left side of the results table
    7/ Note that the aria-label now appears and contains relavant
    information
    8/ Signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Bug 25244: (follow-up) QA corrections
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73ff914d5d537947b5fdc4cd602e79f41af5179a
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Jul 3 17:36:04 2020 +0400

    Bug 25922: Fix typo 'arial-label' -> 'aria-label'
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 280f1bdeb3cbec9f57d71e980490e32af61eecfb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 3 14:07:25 2020 +0100

    Bug 25922: Add aria-label to the allowlist for translation
    
    This patch adds aria-label to the allowlist for translations.
    
    To test:
    - Apply patches from here and bug 25244
    - kshell
    - cd misc/translator
    - perl translate update de-DE
    - Check for the aria-label in the diff
    - Verify the strings appear in the po files now
    - Translate them
    - perl translate install de-DE
    - Verify the translated strings appear in the template
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b49a70b94d6b5e0e2e1cde3025ade1278814925
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 12:45:57 2020 +0100

    Bug 25237: Fix semantic heading for opac-details
    
    Prior to this patch the opac-details view contained semantically incorrect h3
    headings for the author information.
    
    Test plan
    1/ Perform a search in the OPAC that will yield results
    2/ Navigate to any results detailed view
    3/ Inspect the page and note that there are semantically incorrect headings
       H1 (Page title) > H2 (Item title) > H5 (Author)
    4/ Apply the patch
    5/ Reload the page
    6/ Inspect the page and note that the semantically incorrect author block has
       been converted to a span with an 'h3' class for styling
    7/ Note the page still appears nicely
    8/ Signoff
    
    Bonus points: Check with XSLT views enabled and disabled.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9a0243f3abf407e1a89d7bfc125911cc153b3cc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 10:14:03 2020 +0100

    Bug 25155: (follow-up) Increase headings levels by 1
    
    In the previous patch we reduced the headings levels by 2, but this was
    one level too many as we already have an H1 in the navbar and so all
    other heading sets should start at level 2 to semantically follow the
    title heading.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 513b226873759ba3df6765dce635fe96cf5a51f3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 09:32:45 2020 +0100

    Bug 25155: Fixing semantic headings login modal
    
    The login modal headings were semantically incorrect prior to this
    patch.
    
    Test plan:
    1) Click the 'Log in to your account' option to expose the modal
    2) Use a headings inspector and note we jump from H1 (Page Title) -> H3
       (Modal Title)
    3) Apply the patch and reload the page.
    4) Click the 'Log in to your account' option to expose the modal
    5) The modal should still appear well formed
    6) Use a headings inspector and note we jump from H1 (Page Title) -> H2
       (Modal Title) -> H3 (Shibboleth title if enabled)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bc47b5302fba91c1315acee5533ec5917df5761
Author: Hayley Pelham <hayleymapley@catalyst.net.nz>
Date:   Thu Jun 11 13:13:30 2020 +1200

    Bug 25155: Fixing semantic headings in opac-auth.tt
    
    Test plan:
    1) Follow test plan from comment #1
    2) Apply the patch
    3) Reload the page, and note that is still displays fine
    4) Check that the main heading is now an h1, and that the other headings
    on the page make sense
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a512ae01fc7e17385e2d2dd42f53f79ae1f55d3a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 1 16:06:33 2020 +0000

    Bug 24625: Store showLastPatron information using localStorage
    
    This patch removes the use of jquery.cookie to store "last patron"
    information, using localStorage instead. jquery.cookie.js is obsolete.
    See Bug 24624.
    
    localStorage has been chosen as an alternative in this situation because
    it does not require transmission between the client and the server. See
    Bug 12410.
    
    Because there is no "session only" option with localStorage, additional
    handling of the showLastPatron data is added to the login page. That
    takes care of "stale" last patron information if user didn't log out but
    the session expired for some reason.
    
    To test apply the patch and enable the showLastPatron system preference.
    
     1. Load a patron's account for checkout
     2. Navigate away from patron-related pages: Perform a catalog search
        from the search header form and open the detail page from the search
        results. Confirm that the correct last patron information still
        shows.
     3. Load another patron's account for checkout
        - There should now be a "Last patron" link in the breadcrumbs bar
          which links to the patron in step 1. Hovering your mouse over the
          link should display a tooltip containing the patron's name and
          card number.
        - Click the "X" to clear the last patron information. The last
          patron link should go away.
     4. Log out and log back in. The last patron information should be gone.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee838b171644e362cceae13ceb732d46a9a8e53b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Dec 3 15:16:57 2019 -0500

    Bug 24165: Add ability to send any item field in a library chosen SIP field
    
    Some SIP devices need access to item fields that are not sent as item information in the checkin, checkout and item information responses.
    It makes sense to allow these fields to be sent in an arbitrary and configurable way, rather than hard code in each special case.
    
    Test Plan:
    1) Apply this patch
    2) Edit your SIP2 config file, add the following within the login stanza:
       <item_field field="XX" code="<item field 1>" />
       <item_field field="XZ" code="<item fied 2>" />
       where <item field 1> and <item field 2> are item table columns of your choosing
    3) Using the sip cli emulator, run checkout, checkin and item information
       messages using that item.
    4) Note the values you set for the item columns are sent in the
       corrosponding fields!
    
    Signed-off-by: Jill Kleven <jill.kleven@pueblolibrary.org>
    Fixed merge conflict with number of tests (was 5, changed to 7 which is correct)
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f776354e33a1f2fc24cc0b1fb17132bc3d1c3813
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Jul 1 11:30:18 2020 +0000

    Bug 23820: (QA follow-up) Make label clickable for checkbox
    
    By adding an id the checkbox is selected when the label is clicked
    enhancing usability.
    
    Also adds a colon : to the label.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20395eefda56541e6cac8cd51dd6134b7a61486a
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Fri May 29 13:16:29 2020 -0300

    Bug 23820: Add test for new behaviour
    
    To test:
    1. prove t/db_dependent/api/v1/clubs_holds.t
    2. Sign off
    
    Sponsored-by: Southeast Kansas Library - SEKLS
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ed09ff7de47e7752d2fcb0a5aff183e07f4e5f3
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Mon Mar 30 18:56:18 2020 +0000

    Bug 23820: Add checkout to default to patron's home branch on club hold
    
    This patch adds a checkbox to make holds created by club hold to default to patron's home branch if possible.
    
    To test:
    1. Apply this patch
    2. Create a club, and add two patrons (from now on called patron A and patron B) to it, each one form a different library..
    3. Create a hold for the club, and in the details set pickup location different from any of the patrons.
    4. Check "Pickup at patron's home library when possible" checkbox
    SUCCESS => when submitted, pickup location of holds defaults to patron's home branch
    5. Modify patron A's library and set pickup location to no.
    6. Repeat steps 3 and 4.
    SUCCESS => when submitted, patron A's hold now points to pickup location setted on step 3, and patron B's hold still points to his home branch.
    7. Sign off
    
    Sponsored-by: Southeast Kansas Library - SEKLS
    
    Signed-off-by: Jason Robb <jrobb@sekls.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f623494598550a1cec734b6f0f0dd3d72a5b9da8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 16:15:20 2020 +0200

    Bug 23391: DBRev 20.06.00.009
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 730df3b1a53c7301ca5e072596618a284c405bb5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 17:44:40 2020 +0200

    Bug 23391: Remove warnings
    
    t/db_dependent/api/v1/illrequests.t .. Use of uninitialized value $hidden_statuses_string in split at /kohadevbox/koha/Koha/REST/V1/Illrequests.pm line 61.
    Use of uninitialized value $hidden_statuses_string in split at /kohadevbox/koha/Koha/REST/V1/Illrequests.pm line 61.
    Use of uninitialized value $hidden_statuses_string in split at /kohadevbox/koha/Koha/REST/V1/Illrequests.pm line 61.
    Use of uninitialized value $hidden_statuses_string in split at /kohadevbox/koha/Koha/REST/V1/Illrequests.pm line 61.
    Use of uninitialized value $hidden_statuses_string in split at /kohadevbox/koha/Koha/REST/V1/Illrequests.pm line 61.
    t/db_dependent/api/v1/illrequests.t .. ok
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 884b3e71d8380d7ef2b4fad65f3d8b8c09d4f1f9
Author: Magnus Enger <magnus@libriotech.no>
Date:   Thu Dec 12 15:07:03 2019 +0100

    Bug 23391: Hide finished ILL requests
    
    Currently, the main table of ILL requests will display all ILL
    requests in the database, regardless of their status. For libraries
    with active ILL this quickly leads to a lot of requests being displayed,
    and the main page of the ILL module taking a long time to load. This
    patch proposes to fix this by introducing the ILLHiddenRequestStatuses
    syspref, which can take a pipe-separated list of ILL statuses that
    will be hidden from view in the ILL module. This means that the
    only way to find a hidden request will be through a report.
    
    To test:
    - Apply the patch and make sure the atomic database update is run
    - Make sure you have a few ILL requests, with at least two different
      statuses
    - Check that all requests are still displayed in the main table of
      ILL requests
    - Add one of the statuses* you have in your database to the
      ILLHiddenRequestStatuses syspref, reload the ILL module frontpage
      and verify that requests with the given status are not displayed
    - Change the syspref to another status and verify requests with
      that status are now hidden
    - Change the syspref to hold both statuses, separated by the pipe
      symbol (e.g.: A|B). Verify that no requests with the given
      statuses are now displayed
    - Run the ILL REST API tests, e.g.:
      $ sudo koha-shell -c "prove t/db_dependent/api/v1/illrequests.t" kohadev
    
    * = The ILLHiddenRequestStatuses syspref should hold status codes, like
    "REQ" and "NEW", not their human readable counterparts.
    
    Signed-off-by: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92040cf563198e544ed9df99f8274ef975db12a7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 16:46:19 2020 +0200

    Bug 23148: DBRev 20.06.00.008
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4975885b07db43777afb20dc19ef0e4851adc95
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Jul 3 10:58:50 2020 +0400

    Bug 23148: Fix bridge image paths in de-DE installer files
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46372b4bbd6aafae9cb524717f17135cd236bffe
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 29 11:57:52 2020 +0000

    Bug 23148: (follow-up) Correct image paths in sample data and tests
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d3b207fe8bc2d398289bc81090e8d4e92152278
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jun 26 16:37:28 2020 +0000

    Bug 23148: (follow-up) Replace gif files in the OPAC with pngs
    
    This patch removes the old gif files from the OPAC bridge set and
    replaces them with png files.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1625519b9e572e7c2dbe6af8ad813be5ff0a1458
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 11 16:14:33 2019 -0400

    Bug 23148: Replace Bridge icons with transparent PNG files
    
    This patch adds SVG versions of the Bridge item type icon set to
    misc/interface_customization/itemtypeimg/bridge. It adds some
    new icons, and updates some existing icons. All GIF versions of the
    icons are replaced with transparent PNG files.
    
    Icon changes:
    
    - English text has been removed from all icons
    - New icon for "Periodical," to differentiate from "Journal"
    - New icon, "Controller" for video games
    - New icon for "Laserdisk" to differentiate from "DVD"
    - New icon for "Kit" to differentiate from "Archive"
    - New icon, "Reference books."
    - Updated "badges" on "Juvenile book" and "Reserve book" to try to
      express the information without English-specific letters.
    
    Before applying the patch, update some item types or collection codes
    with Bridge icons. Apply the patch and run the database update process.
    
     - Open the advanced search page in the staff client and confirm that
       your item type or collection code icons were updated correctly.
     - Go to Administration -> Item types and edit an item type.
       - Check the "bridge" tab and confirm that the icon options look
         correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b299f54aaed64f3ad4ff3a59eae743ed4f17c49
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 29 12:19:46 2020 +0200

    Bug 23070: Pass no_triggers => 1 to Koha::Objects->update
    
    To make sure we will update all the objects in one go (and no trigger
    the ->set->store from Koha::Object->update)
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f6f88105db069fb365307f2e2ffaae11c863421
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 27 14:55:54 2020 +0100

    Bug 23070: Increment all priorities in 1 query
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c77f4496b2a9dbc26f59d467032eb74f0d27f328
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 27 14:53:23 2020 +0100

    Bug 23070: Add tests
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 563a25d952ee571eb1d626f97eef001c5f646b1f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 6 15:14:28 2019 -0500

    Bug 23070: Use Koha::Hold in C4::Reserves::RevertWaitingStatus
    
    We are using raw SQL statements, we should use Koha::Hold instead.
    
    This patch does not seem optimal, we would like to increment priority in
    only 1 statement and without the need to fetch and loop all holds.
    
    == Test plan ==
    - apply patch
    - place some holds on the same record
    - check that the priorities look good
    - mark one hold as waiting by doing a check-in
    - revert the waiting status
    - confirm that the priorities are recalculated correctly
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fb5f3624ee87ab8179909a4ad80b1aba76becc0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 16:05:38 2020 +0200

    Bug 22844: DBRev 20.06.00.007
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d23d9f931a777c243da6d72c179fa2b28cf4adbb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 14:42:46 2020 +0200

    Bug 22844: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fdd0c6e5ab14ba2ddf62c4f5a3748f05d85451c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 29 10:37:23 2020 +0200

    Bug 22844: Remove 'separate columns with |' from prefs description
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc0077b3a1af6181af176acb05fa328c4b92cd78
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 28 13:09:49 2020 +0200

    Bug 22844: Make the patron's attribute mandatory at the OPAC
    
    Test plan:
    - Set 1+ patron's attribute(s) mandatory
    - Use the self-registration feature and confirm that you cannot selfreg
    if the attribute has no value (or empty string)
    - Same with the modification form (logged in)
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f23a4cdda92ebb6dc7ef9721f50cc1dcbd5ca79e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 3 14:50:28 2020 +0100

    Bug 22844: Add is_boolean flag for new 'mandatory' column
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06a7f48678b44acbfa1c5d249f2a2966f58ba511
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 10 08:49:26 2019 +0000

    Bug 22844: (QA follow-up) Build items.json for UniqueItemFields
    
    Adding items.json, built from latest kohastructure.sql.
    Control UniqueItemFields with this source file.
    And add StatisticsFields.
    
    Test plan:
    Go to Preferences, play with UniqueItemFields.
    Adjust StatisticsFields and look at patron record, statistics tab.
    
    Moved-from: Bug 22867
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 810972db7a87fa65d11c5d870c3f8d93fca40b32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 17 09:30:02 2019 -0500

    Bug 22844: Make the attribute mandatory when editing a patron
    
    Note: I am not confident with this patch, I think it's not polished. I
    will not have time to improve it to make it ready for 19.05.00
    1. Conflict with bug 20443 (which would have make this change way much
    easier!)
    2. It does not work :) You will be able to submit the memberentry form
    even if the patron attribute is marked as mandatory (??)
    3. What about the OPAC?
    4. What about repeatable fields? We certainly will need JS code here
    5. What about the "Quick add" feature? (I had trouble in the past to not
    introduce regression when we played with this template...)
    
    Do not forget to run updatedatabase.pl and regenerate DBIC schema if you
    want to play with this patchset.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Bug 22844: (follow-up) Make the attribute mandatory when editing a patron
    
    Previous patch forgot the most important, adding the required attribute
    to the select/textarea
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6e5e3012d04beed263d50a0f31a60c3556075f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 17 09:14:00 2019 -0500

    Bug 22844: Add the new entry to the patron attr types form
    
    Will conflict with bug 20443 \o/
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4469b4e52d632f2661cc9472ef651887c91b8e36
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 17 09:06:04 2019 -0500

    Bug 22844: Add the new DB column borrower_attribute_types.mandatory
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=23391
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2dd788924defb84d08a13159ed88cca35859aa4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 10 08:54:44 2019 +0000

    Bug 22844: (QA follow-up) Add pref PatronQuickAddFields too
    
    Description slightly adjusted.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0117c6da8eef06b54ca4621b1e515a48db640d86
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 3 13:56:02 2019 +0000

    Bug 22844: Simplify the process of selecting database columns for system preferences
    
    This patch introduces a new way for users to select database columns for
    system preferences like BorrowerMandatoryField, which currently
    require hand-typing of database names.
    
    This new system uses a JSON file containing label:column pairs for
    database columns which are relevant to preferences which reference
    borrower table columns. My intention was to have user-friendly values as
    the labels, but embedding English strings in JSON would make them
    untranslatable.
    
    The following preferences are affected:
    
     - BorrowerMandatoryField
     - BorrowerUnwantedField
     - PatronSelfModificationBorrowerUnwantedField
     - PatronSelfRegistrationBorrowerMandatoryField
     - PatronSelfRegistrationBorrowerUnwantedField
    
    == Test plan ==
     - apply the patches
     - regenerate the staff client CSS (yarn build)
     - updatedatabase
     - dbic
     - flush_memcached
     - restart_all to make sure the updated .pref file is used
    
     - Go to Administration -> System preferences, and search for
       "PatronSelf"
     - The input fields for PatronSelfModificationBorrowerUnwantedField,
       PatronSelfRegistrationBorrowerMandatoryField, and
       PatronSelfRegistrationBorrowerUnwantedField should appear as "locked"
       (read-only) inputs.
     - Clicking the input field should trigger a modal window with
       checkboxes for each available column from the borrowers table.
     - Test that the "select all" and "clear all" links work correctly.
     - Test that the "cancel" link closes the modal without saving your
       selections.
     - Test that the "Save" button closes the modal, copies your selections
       to the form field, and triggers the preference-saving function (this
       eliminates the need to click a save button again after closing the
       modal).
       - Test this process by making modifications to all three different
         preferences, confirming that the right data is preselected each
         time the modal is shown and the right data is saved to the right
         field each time.
    
    Signed-off-by: Hayley Mapley <hayleymapley@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dae82b191abb87b88e6f455179f5776ce04dc2b8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jun 23 15:10:50 2020 +0100

    Bug 8338: (QA follow-up) Clean up warning
    
    This patch moves the accountline->store call below the FinesLog code
    such that we return the same 'thing' from _FixOverduesOnReturn as the
    other clauses of the routine.
    
    We also take the oportunity to clean up the warning thrown by an errant
    call to the routine such that we output the actual itemnumber rather
    than a HASH reference marker.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 312b1c68870aec89eb81b31e7d168421548d2586
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 22 08:49:15 2020 +0100

    Bug 8338: (QA follow-up) Fix perlcritic error
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64bb70d579ffe3a6967103239ba683fd1c0cbd25
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jun 2 17:37:38 2020 +0100

    Bug 8338: (follow-up) Fix test
    
    This patch moves the previous test introduced with bug 24075 into the
    same block as the rest of the AddReturn tests and updates it to test for
    the new 'remove accountline' behaviour as well as the reduce and refund
    behaviour.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f3534a8eeed87869fd6a858866455c10087d7e1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 13 14:11:38 2020 +0100

    Bug 8338: Remove zero amount overdues on backdated returns where appropriate
    
    This patch removes any overdues which would be reversed on a backdated
    return if CalcFineOnBackdate is enabled and the user has not already
    attempted to pay off the accruing fine.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a25b95c2e63a1705f406388f4419aa7972abc3b8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 13 14:11:16 2020 +0100

    Bug 8338: Unit Tests
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b715de657dd61159b6eccb21cf706aad8383e940
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jul 2 08:35:07 2020 +0000

    Bug 24153: (QA follow-up) Removing one redundant initialization line
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60038291e1295b7e7a2cbf986a587373c9243a2d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 16:14:29 2020 +0200

    Bug 24153: Add the confirm flag to the crontab calls
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d24d4de4482fc5bd631457a8339d20b0f30164b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 16:11:21 2020 +0200

    Bug 24153: Make sure $count will not be reused for another purpose
    
    The $count variable should be defined per block and set to 0 to avoid
    confusion.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a1e6d2163023c800e6ab5a2e337f700c48f7962
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 16:09:05 2020 +0200

    Bug 24153: Improve verbose messages in dry-run mode
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e66fe17f6f71ee4e94560f71ff14eab651dae055
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 23 12:19:09 2020 +0200

    Bug 24153: Remove warning for message queue
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dbc0575eee5a8cb33d4e78f34568f54a4fe0e0c0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Nov 30 14:16:54 2019 +0100

    Bug 24153: Add a confirm flag to cleanup_database
    
    How handy this will be, right?
    
    This patch will change the behavior of this script as the --confirm flag
    will now be required for effective changes.
    Without --confirm and with --verbose you will see what could have done
    the script in non dry-run mode.
    
    Test plan:
    Use different options of the script without the --confirm flag and have
    a look at the output. It now tells you what would have been deleted if
    the flag was passed.
    Now use the --confirm flag and confirm that the changes are now
    effective.
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c136ad1d289a0a3e3d0c4106527261cdd6d09e7a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 23 12:02:35 2020 +0200

    Bug 24152: Allow purge with 0 day
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c85d6f257fb916b8e725062897397768d5b6cd14
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 19 07:59:50 2020 +0000

    Bug 24152: (QA follow-up) Add tests for alternative from and to pars
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f59475a36056eacbebcac526c9bf7eaf591ea5de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 29 16:08:16 2019 +0100

    Bug 24152: Add the ability to purge pseudonymized tables
    
    anonymized_* tables have been added by bug 24151, this patch adds the
    usual way to purge data from them.
    
    The cleanup_database.pl script has been adjusted to take new parameters
    that will help to delete pseudonymized data.
    
    Test plan:
    Call the scrip with the new parameter to remove pseudonymized data
    * --pseudo-transactions DAYS will remove entries from pseudonymized_transactions older
    than DAYS day
    * --pseudo-transactions can be used without the parameter DAYS but with
    -- pseudo-transactions-from and/or --pseudo-transactions-to instead, to provide a
    range of date
    
    You can use the patch from bug 24153 to make the tests easier, data will
    not be deleted if the new --confirm flag is not passed.
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98fde332d8f1aa78e37ad2f401c21bd3b272e907
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 24 18:09:10 2019 -0300

    Bug 24152: Add a warning about the delete of statistics's table entries
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e35954c9c37ecb300103107f0a7132f90400ae7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 24 18:05:38 2019 -0300

    Bug 24152: Add method Koha::Objects->filter_by_last_update
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccaf8853976da8a7d2577f50dc9e4e719e249037
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 16:03:39 2020 +0200

    Bug 24151: DBRev 20.06.00.006
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2b6a2de2383db222c841f00aa1c0118fbe06258
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 16:45:12 2020 +0200

    Bug 24151: Rename the config key with 'bcrypt_settings'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6998e54b5e7f2b52dde154b91d9d2d285c683b87
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 23 11:49:15 2020 +0200

    Bug 24151: Add description for tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7175627cb6765343abf0dfc111d63c5b1e93bfc6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 19 07:27:35 2020 +0000

    Bug 24151: (QA follow-up) Fix POD warnings from QA tools
    
                    POD is missing for get_hash
                    POD is missing for new_from_statistic
                    POD is missing for 'object_class'
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 716e5203555617877f3622ba251e57e168c5eb77
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 19 06:10:43 2020 +0000

    Bug 24151: (QA follow-up) Correct license in two modules
    
    Still listing the address..
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8a309009c66a6f88eb2df80efb8bf602e88b4fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 17 17:36:14 2020 +0100

    Bug 24151: DBIC changes
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa0b8cb96ae60037dcde6fd48ead0e14cc4205de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 17 17:36:05 2020 +0100

    Bug 24151: Add items.homebranch to the list
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2731c1576f7e85a64fe771c33fe32d9ad6db23e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 9 10:17:10 2020 +0100

    Bug 24151: Fix location on return
    
    The item's location where not passed to UpdateStat
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03334a5a901c4942ac2516c3148710206be38497
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Nov 30 13:35:06 2019 +0100

    Bug 24151: Add boolean flag for has_cardnumber
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f6ed2f45a5e0aa7deec28ed9f74d375307c8d53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jan 11 18:14:55 2020 +0100

    Bug 24151: DBIC changes
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 310a3ed2c60d72699410daf09452472a4e37a918
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jan 11 16:43:40 2020 +0100

    Bug 24151: Sync patron's attributes
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46a0571e9a33ac60a8bbba0aa7571f8334f8d07b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 27 16:43:00 2019 +0100

    Bug 24151: Adding keep_for_anonymized to the UI
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25930f79dcd814c923d5c6948720ed7b75579062
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 27 14:55:04 2019 +0100

    Bug 24151: Add new column borrower_attribute_types.keep_for_pseudonymization
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 563f9faa4f5bb926c99731b8b126ac529bf40958
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 27 14:49:17 2019 +0100

    Bug 24151: DB changes - pseudonymized_borrower_attributes
    
    Add a new DB table pseudonymized_borrower_attributes
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 428216bf77348af898df4772304b5aab1876a64d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 26 21:07:04 2019 +0100

    Bug 24151: Add key to the config
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71a30de965c8fef2966da7e7262567f11bf53e1b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 26 20:31:14 2019 +0100

    Bug 24151: Add warning to the about page if key is missing in the config
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e70ed910caf75d772a51c1239fd4ed12eccf55d2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Nov 30 12:48:04 2019 +0100

    Bug 24151: Add tests - if config does not exist
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb1de130279e6f652d6d0c0bc825441c1d8139b1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 26 17:40:15 2019 +0100

    Bug 24151: Add tests
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ce968e0e571f555261c02a9e1d27447611cdb89
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 22 17:37:42 2019 +0100

    Bug 24151: Copy info to the pseudonymized table when a transaction is done
    
    This is the commit where you will find useful information about this development.
    
    The goal of this new feature is to add a way to pseudonymize patron's
    data, in a way they could not be personally identifiable.
    https://en.wikipedia.org/wiki/Pseudonymization
    
    There are different existing way to anonymize patron's information in
    Koha, but we loose the ability to make useful report.
    This development proposes to have 2 different tables:
      * 1 for transactions and patrons data (pseudonymized_transactions)
      * 1 for patrons' attributes (pseudonymized_borrower_attributes)
    Entries to pseudonymized_transactions are added when a new transaction
    (checkout, checkin, renew, on-site checkout) is done.
    Also, anonymized_borrower_attributes is populated if patron's attributes are
    marked as "keep for pseudonymization".
    
    To make those informations not identifiable to a patron, we are having a
    hashed_borrowernumber column in pseudonymized_transactions. This hash will be
    generated (Blowfish-based crypt) using a key stored in the Koha
    configuration.
    
    To make things configurable, we are adding 3 sysprefs and 1 new DB
    column:
      * syspref Pseudonymization to turn on/off the whole feature
      * syspref PseudonymizationPatronFields to list the informations of the
      patrons to sync
      * syspref PseudonymizationTransactionFields to list the informations
      of the transactions to copy
      * DB column borrower_attribute_types.keep_for_pseudonymization that is a
      boolean to enable/disable the copy of a given patron's attribute type.
    
    Test plan:
    1/ Turn on Pseudonymization
    2/ Define in PseudonymizationPatronFields and
    PseudonymizationTransactionFields the different fields you want to copy
    3/ Go to the about page
    => You will see a warning about a missing config entry
    4/ You need to generate a key and put it in the koha-conf.xml file. The
    following command will generate one:
      % htpasswd -bnBC 10 "" password | tr -d ':\n' | sed 's/$2y/$2a/'
    Then edit $KOHA_CONF and add it before of the end of the config section (</config)
      it should be something like:
        <key>$2a$10$PfdrEBdRcL2MZlEtKueyLegxI6zg735jD07GRnc1bt.N/ZYMvBAB2</key>
    5/ Restart memcached then plack (alias restart_all)
    => Everything is setup!
    6/ Create a new transaction (checkin for instance)
    => Confirm that a new entry has been added to pseudonymized_transaction with the data
    you expect to be copied
    7/ Edit some patron attribute types and tick "Keep for pseudonymization"
    8/ Create a new transaction
    => Confirm that new entries have been added to pseudonymized_borrower_attributes
    11/ Delete the patrons
    => Confirm that the entries still exist in the pseudonymized_* tables
    12/ Purge the patrons (ie. use cleanup_database.pl to remove them from
    the deleted_borrowers table)
    => Confirm that the entries still exist in the pseudonymized_* tables
    
    See bug 24152 to remove data from the anonymized_* tables
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c9bcd522d9ce7ea4b6071866e2cb1a55c1158b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jan 11 16:56:10 2020 +0100

    Bug 24151: DBIC changes
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4dbb6ec80a01f5534ac942d9684fa2f480c91ec3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 22 15:38:34 2019 +0100

    Bug 24151: DB changes
    
    1 new table:
     * pseudonymized_transactions
    
    3 new sysprefs:
     * Pseudonymization
     * PseudonymizationPatronFields
     * PseudonymizationTransactionFields
    
    Sponsored-by: Association KohaLa - https://koha-fr.org/
    
    Signed-off-by: Signed-off-by: Sonia Bouis <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 619d7dde80f16cbcae40582b1fa4f5bd9238eac8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 17 13:57:34 2020 +0000

    Bug 26005: OPAC cart display fails with error
    
    This patch removes the "opac_option" parameter from opac-basket.pl. It
    was included in Bug 25402 because the bug was dependent on 5087.
    
    To test, apply the patch and add some items to the Cart in the OPAC.
    Click the Cart button to show the cart. The pop-up window should load
    correctly without errors.
    
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 545e03c173c789241eb21773a939b4ab7dcc6da4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 15:16:29 2020 +0200

    Bug 24379: Fix failing tests
    
    kohadev-koha@kohadevbox:/kohadevbox/koha$ prove t/db_dependent/Koha/Patrons/Import.t
    t/db_dependent/Koha/Patrons/Import.t .. 2/159
     #   Failed test 'No warning raised by import_patrons'
     #   at t/db_dependent/Koha/Patrons/Import.t line 171.
     # found warning: Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_3a> line 2.
     # found warning: Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_3a> line 2.
     # didn't expect to find a warning
    Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_2> line 2.
    Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_2> line 2.
    Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_3> line 2.
    Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_3> line 2.
    Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_4> line 2.
    Argument "" isn't numeric in numeric eq (==) at /usr/share/perl5/DBIx/Class/Row.pm line 1018, <$handle_4> line 2.
    t/db_dependent/Koha/Patrons/Import.t .. 152/159 # Looks like you failed 1 test of 159.
    t/db_dependent/Koha/Patrons/Import.t .. Dubious, test returned 1 (wstat 256, 0x100)
    Failed 1/159 subtests
    
    Test Summary Report
    -------------------
    t/db_dependent/Koha/Patrons/Import.t (Wstat: 256 Tests: 159 Failed: 1)
      Failed test:  39
      Non-zero exit status: 1
    Files=1, Tests=159,  3 wallclock secs ( 0.04 usr  0.01 sys +  2.11 cusr  0.24 csys =  2.40 CPU)
    Result: FAIL
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b56ae1d4a231a83f52420ec9efc4829226fa86a
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Tue Apr 28 07:43:46 2020 +0200

    Bug 25293: Don't call escapeHtml on null
    
     Test Plan:
    
        1) Create two Checkouts
        2) view patron's checkout list
           cgi-bin/koha/members/moremember.pl?borrowernumber=pp <show
           checkout>
        3) in mysql shell delete a checkout home branch: update items set
           homebranch = null where itemnumber = xx;
        4) view patron's checkout list, again
    
        Without this patch the list is empty.
    
        Same if biblio title is null (update biblio set title = null where
        biblionumber = yy;).
        Javascript error:
        TypeError: oObj.title is null
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a21a3bba6b23beed7aef9852f7c82efbfc1c3c1e
Author: Slava Shishkin <slavashishkin@gmail.com>
Date:   Mon Jun 29 22:26:42 2020 +0300

    Bug 25896: Add missing closing </td> tag
    
    File koha-tmpl/intranet-tmpl/prog/en/modules/admin/smart-rules.tt had
    one lost closing </td> tag in "daysmode" block. Added.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00a12f548b4336f6c6eae8ce30e7c6cfaf7ed05c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jul 10 14:30:09 2020 +0000

    Bug 25974: Remove inline style from table settings administration page
    
    This patch removes an inline style attribute from the table settings
    administration template. A different style is added to the page's
    <style> block to try to accomplish a similar effect of expressing the
    hierarchy of the page.
    
    To test, apply the patch and go to Administration -> Table settings.
    
    The individual tables of settings should be offset from the headings
    above them.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00f04146e915b2b1a9881439ac34088e6486921f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jul 14 21:30:39 2020 +0000

    Bug 25987: Fix alignment of fields in label batch creation form
    
    This patch makes minor markup changes to the template for the label
    batch creation process so that form fields line up correctly.
    
    Unrelated change: A hint has been moved out of the label area to below
    the textarea in order to conform with established patterns.
    
    To test, apply the patch and go to Tools > Label creator > New > Label
    batch.
    
     - In the batch creation form the "Enter by itemnumber" and "Enter by
       barcode" should be aligned correctly with each other.
     - The "One number per line..." hint should appear below the textarea.
     - Test that the form fields are still correctly aligned after adding
       some items to the batch and the "description" field is shown in the
       form.
    
    Works for me!
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b9572e0c8fb9f1ad1e60ed5db50e69c60ac1a00
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Jan 21 17:53:09 2020 +0000

    Bug 24473: Add $raw filter for Syndetics content
    
    Syndetics offers enhanced content in the OPAC under the tabs 'Title Notes',
    'Excerpt', 'About the author', 'Editions'. They provide this info as HTML
    therefore we should filter it as $raw so the content shows up without the markup.
    
    Signed-off-by: Stina Hallin <stina.hallin@ub.lu.se>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fbe775070637ebdddcc9ea0b455e80dbb85a83d
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Wed Jun 24 16:03:16 2020 +0200

    Bug 25862: Prevent TinyMCE to mangle local url links
    
    To test:
    1 create a report 1 if it doesn't exist
    2 open /cgi-bin/koha/tools/koha-news.pl
    3 create a news
    4 add a HTML link with Insert/Edit link tinyMCE dialog box to
      /cgi-bin/koha/reports/guided_reports.pl?reports=1&phase=Run%20this%20report "report 1"
    5 save
    6 on the main page "report 1" link returns a 404 error
    
    Apply patch
    7 Modify news' URL
    8 Test it works in: tools/koha-new.pl admin/branches.pl and admin/preferences.pl
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f058e63b5ae573469ea21777b76b822afd8a3442
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 12:57:00 2020 +0200

    Bug 24379: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 312dd03223fbce83c77315250af9f1fc9ee0d4a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 20 12:53:43 2020 +0200

    Bug 24379: DBRev 20.06.00.005
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bb31cffae27dc398a7b4a4decf3623ec65478ac
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 8 20:59:38 2020 +0000

    Bug 24379: Make login_attempts not nullable
    
    While the column defaults to 0 in Koha::Object->store we set to NULL if NULLABLE
    
    When trying to reset a patrons password we check that the account is not administratively locked:
    login_attempts != -1
    
    This query does not return rows where login_attempts IS NULL. It will return accounts where login_attempts = 0
    
    Let's default to 0 like we intend
    
    To test:
    1 - Create a new patron
    2 - Note their login_attempts is NULL
        SELECT login_attempts FROM borrowers ORDER BY borrowernumber DESC LIMIT 1
    3 - Enable  OpacResetPassword
    4 - Attempt to reset password before logging in, you cannot
    5 - Apply patch, updatedatabase, restart_all, update schema
    6 - Create another patron
    7 - Their login attempts should be 0
    8 - Attempt to reset password, it works!
    
    Bug 24379: Fix the test
    
    First we create a patron using TestBuilder to get a hashref of valid
    info. Then we delete it and create a new patron using Koha::Patron->new
    Once stored, we should call discard_changes to make the calculated
    values available in the currenct object.
    
    Bug 24379: Don't drop default of 0 for login attempts
    
    When moving the column we drop the default, this means that DBs upgraded form earlier versions
    get the wrong values set
    
    To test:
    1 - Checkout 16.11.x
    2 - Reset all
    3 - Checkout master
    4 - updatedatabase
    5 - SHOW CREATE TABLE borrowers;
    6 - Note the column login_attempts defaults to NULL
    7 - Apply patch(es)
    8 - Repeat
    9 - Now it defaults ot 0 (and has NOT NULL if applied all)
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e441cb35fb13670e65b9437706561c17d1311945
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jun 24 17:05:30 2020 +0200

    Bug 25868: Fix transfers page to show effective itemtype
    
    In transfers page /cgi-bin/koha/circ/branchtransfers.pl :
    Itemtype is always from biblioitems.itemtype, regardless of system preference item-level_itypes.
    
    Patch also changes template to use the object Koha::Item.
    
    Patch also fixes a small typo : closed <form> tag.
    
    Test plan :
    1) Test with both values of system preference 'item-level_itypes'
    2) Go to Circulation > Transfert
    3) Enter a barcode
    4) Enter another barcode
    5) Check you see in table all datas and that 'Item type' is correct
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f77a377c939080eed36401746b5d722c91ee964b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 24 16:17:19 2020 +0000

    Bug 25869: Fix Coce display for lists
    
    To test:
    1 - Enable Coce for Opac
        CoceHost: https://coce.bywatersolutions.com
        CoceProviders: Select all
        OpacCoce: Enable
    2 - Do a search on the Opac, confirm you see some covers
    3 - Add some of the items with covers to a public list
    4 - View the public list
    5 - Note no covers display
    6 - Apply patch
    7 - Success!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b84fda33b23347846ae50016f1e4b38b0fd95f4
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Jul 8 07:10:50 2020 +0000

    Bug 25950: Remove <client> in X-Forwarded-For from proxy tests
    
    This patch removes the <client> ip address in the X-Forwarded-For
    header from being tested against koha_trusted_proxies.
    
    Without this patch, REMOTE_ADDR will be set to null, if the <client>
    ip address matches against koha_trusted_proxies.
    
    To Test:
    1. Run the unit test t/Koha/Middleware/RealIP.t
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56220d211d7b5c4e2622787f9ea38ab12c8868f5
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Jun 12 13:51:16 2020 +0000

    Bug 25726: make holds to pull ignore holds where found is not null and itemnumber is null
    
    To test:
    1- place 2 bib-level holds on available items
    2- confirm they both show on Holds to Pull
    3- edit one hold from the database to set found='T'
    4- reload Holds to Pull, confirm it is now empty
    5- apply patch
    6- Reload Holds to Pull
    7- confirm it now shows the hold you did not edit
    
    Signed-off-by: donnab <donna@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] Using capitals for SQL reserved words; added a FIXME
    Tested with:
        update reserves set found='T', itemnumber=NULL where reserve_id=...
    This should be a workaround while we fix the underlying problem.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 981b601c39e97e23d309fe342c00a819a9ee8ad6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jul 2 12:50:17 2020 +0000

    Bug 25909: Recent change to datatables JS in the OPAC causes errors
    
    This patch reverts some changes made by Bug 25287 which prematurely
    introduced the double-underscore i18n function. The i18n features
    haven't been fully implemented in the OPAC.
    
    Some lines are reverts to the previous version, and some are additions,
    for instance where Bug 25287 introduced new DataTables features and a
    new string translation is required.
    
    In addition to i18n changes, the patch also reverts the default
    configuration of DataTables in the OPAC so that the "dom" configuration
    option is set back to "t." This turns off features like pagination
    buttons, filters, etc. which were previously disabled by default.
    
    Enabling these features requires revision to the OPAC CSS in order for
    them to display well.
    
    To test, apply the patch and view a page in the OPAC which includes a
    DataTable. For instance: checkouts on the "your summary" page, serial
    issues on the "full subscription history" page.
    
    Tables should display correctly and sorting should work correctly. There
    should be no other DataTables controls visible.
    
    To test translatability:
    
    To test, apply the patch and test that the correct strings are
    translatable. In this example I'm testing fr-FR:
    
        - Update a translation:
    
          > cd misc/translator
          > perl translate update fr-FR
    
        - Open the corresponding .po file for the strings pulled from
          the templates  e.g.  misc/translator/po/fr-FR-opac-bootstrap.po
        - Locate strings pulled from bootstrap/en/includes/datatables.inc
          for translation, e.g.:
    
          #. SCRIPT
          #: opac-tmpl/bootstrap/en/includes/datatables.inc:4
          msgid "Copy to clipboard"
          msgstr ""
    
        - Edit the "msgstr" string however you want (it's just for testing)
        - Install the updated translation:
    
          > perl translate install fr-FR
    
    Open the translated copy of datatables.inc and confirm that the
    translated string appears.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 40ab030060d6cbacb0be9df981fb28a6ade705ea
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jul 7 09:27:48 2020 +0100

    Bug 25944: Schema fix for illrequests route
    
    The illrequests path was missing the `comments` and `status_alias`
    embedable relations in the path specification.
    
    Test plan:
    1/ Ensure you have the latest Mojolicious + OpenAPI modules installed.
    2/ Navigate to the ill requests page and note that the table is empty.
    3/ Note that under the networking tab in your browsers developer tools
    that the api call fails with a 400 error.
    4/ Apply the patch
    5/ Refresh the page
    6/ The table should now load and the api route should return a proper
    200 response.
    7/ Signoff
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Applied the patch to a production server that was having the 400
    error on the main ILL page, and the error was gone.
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 96a871035043c7ffd93c61e756ee1ff89e3da0f0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu May 21 13:41:23 2020 +0000

    Bug 25566: Add option to ignore found holds and use it when checking high holds
    
    To test:
     1 - Find or create a record with 10 items
     2 - Set sysprefs:
         decreaseLoanHighHolds - enable
         decreaseLoanHighHoldsDuration - 2
         decreaseLoanHighHoldsValue - 2
         decreaseLoanHighHoldsControl  - 'over the number of holdable items'/dynamic
     3 - Set circ rules to allow 1 hold per record on the relevant record
     4 - Place 3 holds on the record
     5 - Check one item in and confirm hold to set to waiting
     6 - Issue to the patron with the waiting hold
     7 - Get a notice that loan period is decreased
     8 - Don't confirm the checkout
     9 - Apply patch
    10 - Restart all the things
    11 - Repeat checkout, no decrease this time!
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 92970a9abad312a07d9efba46cc57b27469a0509
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jul 7 12:05:42 2020 +0000

    Bug 25850: (QA follow-up) use dt_from_string
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit afd88e1d21a5cb5f2198c058144065b64098c124
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 29 09:54:58 2020 +0100

    Bug 25850: (QA follow-up) Match logic in is_holiday
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 25127f422821756b030b8f377b3e112b907be5eb
Author: Andreas Jonsson <andreas.jonsson@kreablo.se>
Date:   Tue Jun 23 15:57:29 2020 +0200

    Bug 25850: Adapt day of week in Koha::Calendar::get_push_amt to 0..6 with 0 being Sunday.
    
    1. Go to tools -> calendar and make sure Sundays are holidays by adding
       a holiday on a Sunday and selecting "Holiday repeated every same day
       of the week" and "Copy to all libraries" and save.
    2. Go to administration -> system preferences and select "Use the
       calendar to push the due date to the next open matching weekday
       for weekly loan periods, or the next open day otherwise" for the
       system preference "useDaysMode" and save the system preferences.
    3. Put the below code in a file name test.pl and execute it using
       the command "sudo koha-shell -c 'perl test.pl' kohadev"
    
       use Koha::Calendar;
    
       my $calendar = Koha::Calendar->new( branchcode => 'CPL' );
       $dt = DateTime->new(
           year       => 2020,
           month      => 06,
           day        => 21
       );
    
       print "This is a sunday: " .
       $dt->day_of_week . "\n";
    
       my $ndt = $calendar->next_open_days($dt, 0);
    
       print "This is a monday: " .
       $ndt->day_of_week . "\n";
    
    4. Without the patch applied, this script
       will freeze after printing "This is a
       sunday ...".  Abort using ctrl-c.
    5. Apply patch and run the script again.
       The test script will now complete.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 95c8d19530e8bef20e02be0b74d7927764bf7ed1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 26 16:52:50 2020 +0100

    Bug 25850: Regression Test
    
    This patch adds a unit test to test for an infinite loop as highlighted
    by the bug.
    
    Test plan
    1/ Run the test before applying the fix
    2/ The test should fail for 'Sundays'
    3/ Apply the subsquent patch
    4/ Re-run the test
    5/ It should now pass
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 4ed4e468d2ceaf4502b817feb791656d5a159fa5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 26 16:24:00 2020 +0100

    Bug 25850: Add tests for weekday holidays
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 082da615e649146197fbc9e0a20da672a82d4816
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jul 15 11:08:32 2020 +0000

    Bug 25992: Make SIP2 logger subroutines exportable to prevent crash
    
    If the subroutines are not exportable we get the following crash:
    
    > Undefined subroutine &C4::SIP::SIPServer::set_logger
    
    To test:
     In kohadevbox run for example:
     $ ps -aux # check that no existing sip server is running, kill the process if exists
     $ perl /kohadevbox/koha/C4/SIP/SIPServer.pm /etc/koha/sites/kohadev/SIPconfig.xml
     $ koha/misc/sip_cli_emulator.pl -su koha -sp koha -l CPL -a 127.0.0.1 -p 6001 --item 3999900000001 -m item_information
    
     After applying this patch the Undefined subroutine error should be gone.
     Note: when using the sip_cli_emulator.pl the credentials can be anything.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 4b0c2e56e43ddacbd3983a8669026b95cd08d660
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 16 15:16:41 2020 +0100

    Bug 25851: DBRev 20.06.00.004
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 189851fb9bbc831bb2875c2c440877c2562583d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 9 10:52:11 2020 +0200

    Bug 25964: Prevent data loss when editing items from a MARC record
    
    Coming from:
      Bug 23463: Use new method Koha::Object->set_or_blank
    
    We have DB fields that are not mapped with MARC fields, for instance paidfor. They are not handled correctly.
    
    In ModItemFromMarc, we get a MARC record in parameter and update the item in DB. But we are loosing the fields that are not in the MARC record
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 46d3ec264c4e46cc73ee1713b5c39e6c564e5a1a
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sun May 24 08:51:27 2020 -0300

    Bug 25443: (follow-up) surround strings with <span>
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d53b58cab858f06be7f9762b16b89c8bfbce5625
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun May 24 02:04:03 2020 +0200

    Bug 25443: Improve translation of 'Select the record to link%s to'
    
    Before this patch the title was set in italic, which caused the
    translation string to be cut off. Removing the italic formatting in
    favor of quotes and splitting the string into 2 sentences (dealing
    with title existing and not existing:
    
    Select the host record to link to '[% bibliotitle | html %]'
    Select the host record to link
    
    To test:
    - Activate EasyAnalyticalRecords system preference
    - Search for a record in staff
    - Use Edit > Link to host record
    - Verify the text is shown as above with the reord's title
    - The second case is a bit theoretical:
    - Delete 245$a from the record or empty out biblio.title using SQL
    - Verify the string still shows but without the 'to...' part.
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6250c2dc1556dbf0ef87f2bb36f13534cb2e2368
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jun 29 11:04:59 2020 +0000

    Bug 25890: Update sorting column for checkouts table
    
    Test plan:
    - Check some items out, all from different libraries
    - Modify the checkout and due dates, like:
        2018-10-22
        2018-01-23
        2018-05-27
    - Sort by checkout date, verify it is actually sorting on homebranch
    - Apply patch
    - Reload page
    - Note you can now sort items correctly
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c581265abff940350df83a52228085aa0792fe0
Author: Slava Shishkin <slavashishkin@gmail.com>
Date:   Thu Jun 18 12:11:29 2020 +0300

    Bug 25695: merge of similar code blocks after circulation_rules update
    
    In onboarding.pl we have second block with adding just one more
    rule parameter (maxissueqty) which can be merged to first one
    after all parameters now stored in circulation_rules table.
    
    Also this eliminates the need of adding forgotten "warn $@" after
    the second eval block.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b69ff1ed7a775b6fdca8513d1ec5a692e30bbe9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 2 08:32:51 2020 -0400

    Bug 25914: Fix incorrect variable name causing relative's checkouts column to be empty in OPAC
    
    In the OPAC, the title column in the relatives checkouts table is always empty.
    
    Test Plan:
    1) Enable viewing of relative's checkouts in OPAC
    2) Check some items out to a patron
    3) Log into the OPAC as a relative of that patron that should be able to
       view them
    4) Note the title column is empty in the relative's checkouts tab
    5) Apply this patch
    6) Reload the page
    7) Titles should appear in the title column!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b66b90fe707e8ac650a1c85d87560fc2f4a223d
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Sun Jun 14 22:41:03 2020 +0000

    Bug 25750: fix fallback to ecost_tax_included/ecost_tax_excluded
    
    If 'Actual cost' has not been set then it has the value of 0.00 which
    Perl evaluates to true so this patchset resets it to 0, so the fallback
    to ecost_tax_included/ecost_tax_excluded happens.
    
    Test plan:
    1. Add item to acquisition basket (make sure the vendor has: tax rate: 15%, 'List prices: Include tax', 'Invoice prices: Include tax')
    2. Set 'Vendor price' = 10 and do not set 'Actual cost'
    3. Save order
    4. Observe basket.pl shows 'Total tax exc.' has a value of 0.00 and GST
    column has value of -8.70
    
    5. Jump into the database:
    select tax_value_on_ordering from aqorders where
    ordernumber=<ordernumber>;
    [You can get the ordernumber from clicking on the 'Modify' line the item
    is listed in]
    6. Observe a negative value: -8.70
    
    7. Apply patch and restart plack
    8. Add a second item to the basket
    9. Set 'Vendor price' = 10 and don't set 'Actual cost'
    10. Save order
    11. Observe basket.pl shows 'Total tax exc' has value of 8.70 and GST
    has value of 1.30
    12. Repeat step 5 and observe tax_value_on_ordering = 1.30
    13. Run t/Prices.t unit test:
    sudo koha-shell <instancename>
    prove t/Prices.t
    
    Sponsored-by: Horowhenua District Council, NZ
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7555ecaafa3bd8bbf0514f3c2672cb41ff7e0aa7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 15 16:11:49 2020 +0200

    Bug 25752: Stay in cwd after koha-shell
    
    After bug 25538, after a koha-shell we are not longer in the current directory:
    
    root@cec7bffd8100:koha(master)$ pwd
    /kohadevbox/koha
    root@cec7bffd8100:koha(master)$ sudo koha-shell kohadev
    kohadev-koha@cec7bffd8100:~$ pwd
    /var/lib/koha/kohadev
    
    Test plan:
    Repeat the commands above and confirm that with this version of the
    script you get /kohadevbox/koha inside the koha-shell
    
    Search for possible regressions
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ab6018b6e14ae2153093db148f04f71405f4493
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 24 12:20:03 2020 +0000

    Bug 25864: Lower case fields for searching
    
    To recreate:
     1 - Have Koha using ES5 and Elasticsearch as search engine
     2 - Enable DumpTemplateVarsIntranet and DumpSearchQueryTemplate
     3 - Do a search in authorities using 'Search entire record' (abduction if using sample db)
     4 - Note no results
     5 - View the page source and find 'search_query'
     6 - Note the uppercased fields
     7 - curl 'es:9200/koha_kohadev_authorities/data/417?pretty'
     8 - Note all fields lower-cased
     9 - Apply patch
    10 - Repeat search
    11 - It works!
    
    Signed-off-by: Heather Hernandez <heather_hernandez@nps.gov>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 579a3c11edf77d36488f352d88ae373cc4cbfa21
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 24 12:22:48 2020 +0000

    Bug 25864: Unit test adjustment
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1e1c233ca69fe9f73efb1c939148f8c7afcf11e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 08:37:18 2020 +0200

    Bug 25851: (bug 18928 follow-up) Remove holdallowed rule is value is an empty string
    
    On the interface, if "Hold policy" is "Not set", the rule does not exist
    in the table. We should reflect that during the update DB process.
    
    Test plan:
    1. Set "Hold policy" to "Not set"
    2. Confirm that you can place holds
    3. Confirm that the rule does not exist in the DB table
    4. Set the value to an empty string (manually)
    5. Confirm that you cannot longer place holds
    6. Go to the circulation rules page and confirm that the value of "Hold
    policy" is "Not set"
    7. Execute the update DB entry
    8. Confirm that you can place holds
    9. Confirm that the rule does not exist in the DB table
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3f0fc135b0b73b7dcf7fee09ca30a42e2e514a3
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 29 17:23:35 2020 +0400

    Bug 21395: Fix misc/admin/koha-preferences
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b06780fb29467fd4276dd25d92fca375a382471
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 29 17:13:10 2020 +0400

    Bug 21395: Fix C4/Barcodes/ValueBuilder.pm
    
    $DEBUG variable was always set to 0, so it was useless
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 343a866b6fd6850edde89a79b0c534ee2f494f4b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 29 17:01:25 2020 +0400

    Bug 21395: Ignore .perlcriticrc in t/Makefile.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 133a3ef168af12897ba4c670db25d674fc876864
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 29 16:57:11 2020 +0400

    Bug 21395: Fix creation of PO file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d11e16aec74ad694bd56ce3810954091b0bf1259
Author: Andrew Nugged <nugged@gmail.com>
Date:   Wed Jun 17 23:18:01 2020 +0300

    Bug 25440: Fixed list of 'show_rule' forming variables in the template
    
    In smart-rules.tt we have `SET show_rule = ...` section which filled
    with 'all used in the loop' variables. Because if historical reasons it
    seems that there are some missing, few old, and even doubled ones.
    This list is fixed now by:
    
      - variable names 'article_requests' and 'renewalsallowed' repeated
        so duplicates are removed;
    
      - 'hardduedatebefore' and 'hardduedateexact' not present in the whole
        site code anywhere anymore;
        IMPORTANT NOTE: these 'hardduedatebefore/hardduedateexact' also
                        exists as remnants in .po-translation files, a lot.
    
      - 'note', 'hardduedatecompare', 'renewalperiod', 'rentaldiscount'
        template variables were missing from this 'show_rule =' checking
        code so they are added.
    
    Order of fields updated to match with above "SET field = ..." pack.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 25440: (QA follow-up) Correction for typo
    
    'engthunit -> lengthunit
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb09303e11b11de2b25852a707211a054fb2b8e1
Author: Andrew Nugged <nugged@gmail.com>
Date:   Tue May 19 11:20:41 2020 +0300

    Bug 25440: Fix for "uninitialized $maxsuspensiondays" in smart-rules.pl
    
    This warning emitted:
    
    Use of uninitialized value $maxsuspensiondays in string eq
    at /admin/smart-rules.pl line 257.
    
    But that not just undef-warning, there is broken logic,
    these two lines are mutually contradictory and goes one-by-one:
    
        $maxsuspensiondays = undef if $maxsuspensiondays eq q||;
        $maxsuspensiondays = '' if $maxsuspensiondays eq q||;
    
    Fix is simple: to make it '' if it comes undef.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5eebfcf68747b4886b23a9d4c8df37ea7d103edb
Author: Andrew Nugged <nugged@gmail.com>
Date:   Tue May 19 11:03:13 2020 +0300

    Bug 25440: Fix for "uninitialized value in string eq" in smart-rules.pl
    
    This warning emitted:
    
    Use of uninitialized value in string eq at /admin/smart-rules.pl line 289.
    
    It is solved by one line added to exclude comparison with 'on' string
    when variable is 'undef'.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b48162f1be1853a89e0ffc898bc0927edef93f95
Author: Andrew Nugged <nugged@gmail.com>
Date:   Sun May 10 18:18:35 2020 +0300

    Bug 25440: Fix for "uninitialized value in hash" warning in smart-rules.pl
    
    This warning emitted:
    
    Use of uninitialized value in hash element
    at /admin/smart-rules.pl line 569.
    
    that happened because we have NULLs in SQL results for 'categorycode'
    and 'itemtype' which later used as 'any' kind of category/item in the
    template, so for the template it passed this way:
    
        $rules->{ $r->{categorycode} }->{ $r->{itemtype} }->...
    
    but undef will stringify as "" to become a hash key ("Hashes are
    unordered collections of scalar values indexed by their associated
    string key" https://perldoc.perl.org/perldata.html),
    
    that's why "undef warning". To prevent warning here is the simple fix:
    
        $rules->{ $r->{categorycode} // '' }->{ $r->{itemtype} // '' }->...
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb8a0ffcc1bb4d751daa4221bd37faa815904db8
Author: Andrew Nugged <nugged@gmail.com>
Date:   Sun May 10 13:28:40 2020 +0300

    Bug 25440: Fix for "CGI::param called in list context" in smart-rules.pl
    
    This warning emitted:
    
    CGI::param called in list context from /admin/smart-rules.pl line 262,
    this can lead to vulnerabilities. See the warning in "Fetching the value
    or values of a single named parameter" at CGI.pm line 412.
    
    Explained here: https://metacpan.org/pod/CGI#Fetching-the-value-or-values-of-a-single-named-parameter
    
    And because all these params are not multi-params, so simple "scalar .."
    forcing for CGI->param is the fix. Changes are transparent and same
    values should be assigned as before, just no more warnings.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9ba7151667bc6481bc97335b94e44487c9701bd
Author: Andrew Nugged <nugged@gmail.com>
Date:   Sun May 10 13:54:29 2020 +0300

    Bug 25440: Extra duplicated call to CGI->param method removed
    
    In code CGI param 'no_auto_renewal_after_hard_limit' assigned to
    "$no_auto_renewal_after_hard_limit" var, and then just in the next line
    again variable "$no_auto_renewal_after_hard_limit" reassigned with
    call to same "$input->param('no_auto_renewal_after_hard_limit')".
    
    Fixed. No logic or results should be changed.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61aa3f794240443f5c2c99adc016f0d80c7251d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 29 13:42:55 2020 +0200

    Bug 21395: Remove 'variable $DEBUG masks earlier declaration in same scope' warning
    
    % prove t/db_dependent/Serials.t
    t/db_dependent/Serials.t .. 8/49 "my" variable $DEBUG masks earlier declaration in same scope at /kohadevbox/koha/C4/Barcodes/ValueBuilder.pm line 45.
    "my" variable $DEBUG masks earlier declaration in same scope at /kohadevbox/koha/C4/Barcodes/ValueBuilder.pm line 87.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9e526a12fb338736e149934526e38da782f048f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 25 13:48:36 2020 +0100

    Bug 21395: (QA follow-up) POD fixes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e968af43777d47c9134ea1875270af9661ef2f5a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 25 11:31:49 2020 +0100

    Bug 21395: (QA follow-up) Remove some introduced issues
    
    This patch removes some new error cases introduced during rebase
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1682341b5849c34e59597cda780d4c877d6f3278
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Apr 27 10:31:19 2020 +0200

    Bug 21395: Fix QA errors
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b168f4a2e9a03ed56ce857353d4dde940980caba
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Sep 21 18:05:42 2018 +0200

    Bug 21395: Make perlcritic happy
    
    This patch adds a .perlcriticrc (copied from qa-test-tools) and fixes
    almost all perlcrictic violations according to this .perlcriticrc
    The remaining violations are silenced out by appending a '## no critic'
    to the offending lines. They can still be seen by using the --force
    option of perlcritic
    This patch also modify t/00-testcritic.t to check all Perl files using
    the new .perlcriticrc.
    I'm not sure if this test script is still useful as it is now equivalent
    to `perlcritic --quiet .` and it looks like it is much slower
    (approximatively 5 times slower on my machine)
    
    Test plan:
    1. Run `perlcritic --quiet .` from the root directory. It should output
       nothing
    2. Run `perlcritic --quiet --force .`. It should output 7 errors (6
       StringyEval, 1 BarewordFileHandles)
    3. Run `TEST_QA=1 prove t/00-testcritic.t`
    4. Read the patch. Check that all changes make sense and do not
       introduce undesired behaviour
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d890c7636ef1d6ec0a1de2161906fd9f4375e97
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 1 11:49:59 2019 +0000

    Bug 23410: Add submenus to system preferences sidebar menu
    
    This patch adds a submenu to the sidebar menu in the system preferences
    interface. Submenu links let you jump to the sub-sections in each
    preference category.
    
    In the search results view, a link is added to allow the user to jump
    directly to the section from which those results came. For instance, if
    your search returns the "SuspendHoldsOpac" preference, the link will
    take you to to the Circulation preferences page and jump the page to the
    "Holds policy" section.
    
    This patch also converts the expand/collapse arrows to Font Awesome
    icons. The obsolete image files are removed.
    
    If you click a submenu link for a section on the current page which has
    been collapsed, the section will expand.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Go to Administration -> System preferences.
     - Test the various preference categories and confirm that the submenus
       appear correctly and jump you to the right section.
       - Test that if you click a section heading to collapse it that
         clicking the corresponding submenu link in the sidebar causes it to
         expand again.
     - Do a search for system preferences and confirm that the sidebar menu
       displays correctly.
     - Confirm that the "View all..." links take you to the correct page and
       section.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cab6e03b35ef96ebd520e4b3b314381b85c5eda
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Jun 25 15:08:27 2020 +0000

    Bug 15400: (follow-up) Remove unnecessary class
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 281c93ed03ceede3914a7bbdd28ef4e8bfc339be
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jun 21 16:41:04 2020 +0000

    Bug 15400: Add class on patron brief info to allow hiding date of birth
    
    This just makes a small addition by adding a class to the new
    "Born:" entry in the patron brief information area to allow for hiding
    it easily with css.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9391d3b263c324f096bbc75a62aa584753351a46
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Apr 21 13:20:57 2020 +0000

    Bug 15400: (follow-up) Remove line break
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2207a080beaa6606e598ae9ee9e1f772e1784ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 4 14:51:40 2020 +0100

    Bug 15400: Clarify usage of patron-age.inc
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd7490c8080e3b90c28c088568a2c4183e7deed3
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Apr 18 09:27:30 2019 +0000

    Bug 15400: (follow-up) Add class to years span
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30e5985aa1babc2f5c9ab2bc7c00e99c12a0d815
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 11 14:25:46 2019 +0000

    Bug 15400: (follow-up) Restore 'years' string, remove untranslatable string
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 507f48a438ad2e5bb9000027f2a6081e76108adb
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Feb 21 20:44:20 2019 +0000

    Bug 15400: (follow-up) Adding age to check out search dropdown
    
    Confirm age shows in the suggestions dropdown when using the checkout
    search in header (if user set DOB).
    Confirm 'Age unknown' shows if no DOB set.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62a6ed54bbb77f5512293255fe9be7548724c556
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Feb 21 19:45:49 2019 +0000

    Bug 15400: (follow-up) Updating text display
    
    Now shows as 'Born: [date of birth] (age)' in circ sidebar menu and
    search results
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2cc3d05d267bae41ba30473f23fe59950da6aeb3
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Fri Nov 2 08:13:35 2018 +0000

    Bug 15400: Display date of birth and age more consistantly
    
    Test plan:
    0) Apply the patch
    1) Go to all of these pages
        Patron detail
        Other patron pages - look on the left side (circ-menu)
        Patron search
        Guarantor search ( go to child patron -> edit -> in guarantor
            section click "Set to patron"
        Search through "Check out" (in the header)
    
    2) Confirm that does show date of birth and date consistantly,
        try it on patrons with and without date of birth set to find
        possible reggressions
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 029f41a667da8f054633432997bc818c1b26a27f
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Wed Jun 17 16:44:42 2020 +0300

    Bug 25322: fix for not selected "relationship" defaults to father
    
    When a user creates a patron's guarantor on /cgi-bin/koha/members/memberentry.pl but doesn't select the relationship from a dropdown, the relationship defaults to first value, which in default sysprefs is "father". This may or may not be correct as this is not a conscious choice from the user.
    
    The solution is to make the "Relationship" field mandatory when there is no empty entry in the system preferences, always starting with an empty option but not allowing the user to save an empty entry.
    And if there is an empty option in sysprefs, it allows to save empty, as well as makes it default choice.
    
    To reproduce with default system preferences:
        1) Create a new patron who is assumed to have a guarantor or modify the existing one.
        2) Under "Guarantor Information" click on "Search to add" button. After performing the search, select a user to act as guarantor. Don't use the dropdown menu to select a relationship. Save your changes.
        3) Observe that relationship is set as "father".
        4) Apply the patch.
        5) Repeat steps 1 and 2.
        6) Observe that it doesn't allow you to save the form until you pick a relationship type.
    
    To reproduce with empty entry added to system preferences:
        1) Add an empty entry to borrowerRelationship at /cgi-bin/koha/admin/preferences.pl?tab=patrons in Patron relationships section (example: "|father|mother").
        2) Create a new patron who is assumed to have a guarantor or modify the existing one.
        3) Under "Guarantor Information" click on "Search to add" button. After performing the search, select a user to act as guarantor. Don't use the dropdown menu to select a relationship. Save your changes.
        4) Observe that relationship is set as "father".
        5) Apply the patch.
        6) Repeat steps 1, 2 and 3.
        7) Observe when you save the empty entry it does set the relationship as empty.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3036d46ba4b26df040a25f960c3bc3081734c26
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed May 27 21:35:16 2020 +0000

    Bug 22672: Change <i> to <em> and <b> to <strong> in templates, includes, xslt
    
    This patch attempts to replace <i> with <em> AND <b> with <strong> in
    order to more accessible to screen readers. This patch makes no attempt
    to change Font Awesome icons which typically use <i>. I found templates,
    includes and XSLT by using 'git grep ‘<b>’
    koha-tmpl/opac-tmpl/bootstrap/en/' and git grep ‘<i>’
    koha-tmpl/opac-tmpl/bootstrap/en/
    
    TEST PLAN:
    There should be no visible difference on the changed pages. The files
    changed are:
    koha-tmpl/opac-tmpl/bootstrap/en/includes/holds-table.inc
    koha-tmpl/opac-tmpl/bootstrap/en/includes/opac-note.inc
    koha-tmpl/opac-tmpl/bootstrap/en/modules/clubs/enroll.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-auth-MARCdetail.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-authoritiessearchresultlist.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-browser.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-course-details.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-detail.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-downloadshelf.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-messaging.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-opensearch.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-overdrive-search.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-privacy.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-results-grouped.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-results.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-review.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-shareshelf.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-shelves.tt
    koha-tmpl/opac-tmpl/bootstrap/en/modules/opac-user.tt
    koha-tmpl/opac-tmpl/bootstrap/en/xslt/MARC21slim2OPACResults.xsl
    koha-tmpl/opac-tmpl/bootstrap/en/xslt/NORMARCslim2OPACResults.xsl
    koha-tmpl/opac-tmpl/bootstrap/en/xslt/UNIMARCslim2OPACResults.xsl
    koha-tmpl/opac-tmpl/xslt/OAI.xslt
    
    Read the changes and make sure everything looks correct, try to visit as
    many pages as possible and confirm that everything looks as it should.
    grep around for cases of <b> or <i> that I could have missed.
    
    Signed-off-by: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a804d4be437a5df3641f854a506642afe3501046
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jun 25 10:38:16 2020 +0000

    Bug 25875: Unit test
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 721876785142fea84f02c7dbe4f325e2a605bd0f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jun 25 10:38:26 2020 +0000

    Bug 25875: Move check for module_bit and code to the JOIN
    
    If we limit the JOIN to rows with the correct subpermission we won't
    duplicate the returned patrons
    
    To test:
     1 - Give a patron full acquisitions permissions
     2 - Also give them several subpermissions on other areas
     3 - Go to Acquisitions
     4 - Edit a fund
     5 - Add a user to the fund
     6 - Search for user above
     7 - They return multiple times in results
     8 - Apply patch
     9 - Restart all the things
    10 - Repeat search
    11 - Patron appears once
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23ed2e110e16f04a34c01ac866b470ec725b7522
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 22 23:57:29 2020 +0000

    Bug 25793: OAI 'Set' and 'Metadata' dropdowns broken by OPAC jQuery upgrade
    
    This patch modifies the OAI XSLT file, correcting the path to jQuery
    assets and adds a link to jquery-migrate.
    
    To test, apply the patch and make sure the "OAI-PMH" system preference
    is enabled.
    
    1. Go to: <OPACBaseURL>/cgi-bin/koha/oai.pl?verb=ListRecords&metadataPrefix=marc21
       e.g.
       localhost:8080/cgi-bin/koha/oai.pl?verb=ListRecords&metadataPrefix=marc21
    2. Click on the 'Sets' and 'Metadata' links. The corresponding
       panels with set and metatdata information should be shown.
    
    Tested against master, works as described.
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb8d23f47d5fd204b48749ac03faca8244e84264
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 24 11:34:32 2020 +0100

    Bug 25807: Add Template 3.008 to the exclude list
    
    This patch adds version 3.008 of Template to the excludes list in our
    cpanfile. It also adds support for displaying this version on the about
    page.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d81438e143273a538c09cd16e7f92a83beed4027
Author: Slava Shishkin <slavashishkin@gmail.com>
Date:   Wed May 13 20:20:27 2020 +0300

    Bug 25491: Fix for "Use of uninitialized value" in InstallAuth.pm
    
    This warning was thrown:
        Use of uninitialized value $info{"invalid_username_or_password"}
        in numeric eq (==) at /home/vagrant/kohaclone/C4/InstallAuth.pm
        line 387.
    
    There is the case when hash key can be undefined in numeric comparison.
    
    Fixed by adding additional precheck for
    $info{"invalid_username_or_password"} being Perl's "true".
    
    To test:
        1) Go to the first page of the web-installer where it asks to login.
        2) Observe the warning in the log file.
        3) Apply patch.
        4) Repeat step 1.
        7) Check that previous warning suppressed.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6886cf93eca9b05dc2ccfa1d681d86e9d95385b4
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Jun 26 10:55:44 2020 +0400

    Bug 25858: Use bitwise OR for setting a bit in borrowers.flag
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    Thanks-to: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e38634ceb8ae5d30d43055711b97395f580f0310
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 24 10:06:57 2020 +0000

    Bug 25858: (bug 25858 follow-up) Don't attempt to set flag if already set
    
    Signed-off-by: Didier Gautheron <didier.gautheron@biblibre.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8098e0eed6594f9d792fc17cd9b940ea586e659
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 25 10:53:51 2020 +0200

    Bug 24156: DBRev 20.06.00.003
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6493f7d33655411dd8e8368c04d962d5d94c4c6e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 14:21:37 2020 +0200

    Bug 24156: (follow-up) UI - Use "Table settings"
    
    After a discussion with Owen we ended up with this decision.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63e7c389f78d462c013d6b53909c4917c60ee7ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 23 11:32:36 2020 +0200

    Bug 24156: Rename 'Columns settings' with 'Tables settings' on the UI
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2201edfe6ee630cdca086abcd84525d7b4d2bb56
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 23 11:29:05 2020 +0200

    Bug 24156: Fix some QA failures
    
    * Add POD to get_table_settings
    * Remove USE Dumper debug statement
    * Add missing "10" entry
    * Fix newly created test file (and renamed)
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bda9ce467e187fb7c04343b336cbd68828027d8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 5 13:00:38 2020 +0100

    Bug 24156: Fix set sort order to the first column
    
    In that case it's equal to 0 and we need to adjust the test condition.
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c04b397a43612c41796cd653d3f447f10e8a48c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 5 17:55:00 2019 +0100

    Bug 24156: Make sort order and number of items to display configurable (basket page)
    
    This patch is the main patch of this patchset, you will find the
    description and the test plan.
    
    The idea of this new enhancement is to add the ability to define the
    default sort order and the default number of rows displayed on the
    acquisition basket page.
    The existing "columns settings" feature was replaced by a
    "tables settings" feature. To prepare the ground, there were some
    works that were needed:
      * rename variables and files
      * Modify the structure of the yml files
      * Create a new DB table to store the tables settings
    
    Test plan:
    0)
      a. Execute the update DB entry to create the new table
      b. Restart all (to get a new version of the yml file, that is cached by
       memcached)
      c. Create several orders for a given basket
    1) Go to the basket view page
    => The default values are the same than without this patchset, the
    number of entries to display is set to "20" and the table is sorted by
    basket number (first column)
    2) Go to the "Columns settings" page
    3) Unfold the "Acquisition" tab
    => Notice the 2 dropdown lists at the bottom of the basket table
    4) Select different values for "Default display length" and "Default
    sort order"
    5) Refresh the basket view page
    => Notice that the default settings are now effective on the table
    
    QA note: We can decide to replace the different occurrences of "Columns settings"
    by "Tables settings" if needed.
    
    Sponsored-by: Institute of Technology Tallaght
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba9ebbc6f16b45f0321d23712b23868f82776b8c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 10 18:00:37 2019 +0100

    Bug 24156: Adjust other tables in the yml file
    
    To match the new structure, we adjust the other tables.
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f751401ef4d200624ba3836f9a4d1193451deac5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 12 16:18:09 2019 +0100

    Bug 24156: Add columns_settings.yml changes
    
    Modification of the structure of the yml file.
    It was
      table:
        - column list
    It now becomes
        table:
          default_display_length: X
          default_sort_order: Y
          columns:
            - column list
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de54267510a31d332144c6e8e718334a6bd7e141
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 5 17:40:08 2019 +0100

    Bug 24156: move ColumnsSettings to TablesSettings
    
    We are preparing the ground with this patch. As the "Columns settings"
    page will now add the ability to modify settings for the whole table, it
    makes sense to rename the file and the variables.
    
    Note that the controller script (admin/columns_settings.pl) and the yml
    (admin/columns_settings.yml) files have not been moved to not break
    shortcuts and abits people could have. But if QA decides, it could be
    easy to do.
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bee30340b8b7cbc492a07581009662d2dddeb060
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 5 17:13:50 2019 +0100

    Bug 24156: DBIC changes
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 259e7d300307180f260eed38311e03df05f9e8f2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 5 17:13:30 2019 +0100

    Bug 24156: DB changes
    
    Add a new table tables_settings to store default_display_length and
    default_sort_order.
    
    Signed-off-by: Liz Rea <wizzyrea@gmail.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 692fb7e134396c85a4ddf7bdfc49fb52e9c5015c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 18 12:16:45 2020 +0100

    Bug 24159: (QA follow-up) Make terminology consistent
    
    This patch changes the new circulation rule that's introduced from
    useDaysMode to daysmode to improve consistency with other rule names.
    
    We also update the accessors and code using them to reflect the new
    term.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1573d9e213632eafae888ac9f45002209fc17146
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 24 18:13:38 2020 +0100

    Bug 24159: Fix shift in the header
    
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d5dafb7a36bd7cee3a9adca9964b5b451dcc6af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 12 09:00:15 2020 +0100

    Bug 24159: Fix one occurrence in updatedatabase.pl
    
    Here we just want to get the value from the syspref, the circ rule does
    not exist yet.
    
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6bf011e37c1c35b84374c458cbcc3be5da63f47
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 12 08:46:59 2020 +0100

    Bug 24159: Use days_mode circ rule to calculate the dropbox date
    
    Calculate the drop box date depending on the circ rule. Note that only
    the branchcode is taken into account here. Is that correct?
    
    Test plan:
    Use the drop box date feature and confirm that it takes into account the
    calendar, depending on the circ rule.
    
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71e235751f609ada9f2fcb78eeda5c3b417bf83f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 12 08:29:27 2020 +0100

    Bug 24159: Set days_mode according to circ rules in 3 other places
    
    There are 3 other occurrences where the new circ rule can be used:
     * C4::Circulation::checkHighHolds
     * Koha::Hold->set_waiting
     * misc/cronjobs/thirdparty/TalkingTech_itiva_outbound.pl
    
    Test plan:
    * checkHighHolds
    Enable decreaseLoanHighHolds and fill decreaseLoanHighHoldsDuration
    Setup things to hit a "high demand" alert with a shortened due date
    Check an item out
    => The due date must be recalculated depending on the circ rule useDaysMode.
    
    * set_waiting
    Set ExcludeHolidaysFromMaxPickUpDelay to "1" (note that there is currently
    a bug in the description of the syspref, see bug 22381 comment 19)
    Mark a hold waiting
    The expiration date should have been set depending on the value of the
    circ rule.
    
    * TalkingTech cronjob
    Cannot test this
    
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aea24e6e9e5279ae062f384ce966ab458dade248
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 28 14:49:50 2020 +0100

    Bug 24159: Add new tests for get_useDaysMode_effective_value
    
    Sponsored-by: Institute of Technology Carlow
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e9b31f2964d7289ba0c230677d8583e42d1e803
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 28 14:28:33 2020 +0100

    Bug 24159: Adjust tests
    
    Sponsored-by: Institute of Technology Carlow
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad0f89f9e521e6cc580ac17da683f7627e64e00e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 28 14:28:21 2020 +0100

    Bug 24159: Add UI changes
    
    Sponsored-by: Institute of Technology Carlow
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b623a4f3066f2764489df42cfbd01a262220aef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 28 13:33:13 2020 +0100

    Bug 24159: Throw an exception if days_mode option is not given when needed
    
    Sponsored-by: Institute of Technology Carlow
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1e248fad8032c2a3365348c463db5f0b692a07e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 28 13:29:09 2020 +0100

    Bug 24159: Move useDaysMode pref to circulation rules
    
    Moving the useDaysMode system preference to a circulation rule will add
    much more flexibility in the calculation of the due date.
    
    The initial request was to make hourly loan returned on closed when
    (when checked out on the same close day).
    To do so we do not want to take into account the calendar.
    However the calendar need to be taken into account for other loan item types.
    
    Other scenarios are possible, for instance depending on the branch.
    
    This patchset will add a new "Days mode" column (next to "Loan period")
    to the circulation rules page, with the different values of the
    "useDaysMode" system preference + a "default" value, to default to the
    system preference value.
    
    Test plan:
    - Define a long loan item type (like 10 days) that will use the calendar
    (or default to the pref value, if the pref is not set to "ignore the
    calendar")
    - and a hourly loan (like 2 hours) that will ignore the calendar
    - Create items with those item types
    - Mark today as a closed day
    - Check the items out
    => The hourly loan is due the same day
    => The other loan is due on an open day
    
    QA note:
    There is the need to force the "days_mode" option when Koha::Calendar is
    initiated for the due date calculation. To make sure devs will not
    forget it, the methods that need have it defined will throw an
    exception.
    
    Sponsored-by: Institute of Technology Carlow
    Signed-off-by: Simon Perry <simon.perry@itcarlow.ie>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 905553f304538758cb5511b4796b9fc5b8a57af0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 25 10:51:35 2020 +0200

    Bug 25232: DBRev 20.06.00.002
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 326c0159a016c25394acde03c379bfea5bb3b820
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu May 7 09:16:37 2020 -0400

    Bug 25232: Add ability to specify multiple notforloan values to skip
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 465e5562fc2f852282f7dcc4683dd0e87b0633eb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 21 13:52:40 2020 -0400

    Bug 25232: Add ability to skip trapping items with a given notforloan value
    
    This is a companion/alternative to bug 25184, in that it allows an
    explicit workflow for placing returned books into temporary storage for
    a few days for decontamination purposes.
    
    The idea here is to create a specific notforloan value for "In
    Decontamination" or something along along those lines. This notforloan
    value would never be trappable. At the end of decon,
    UpdateNotForLoanStatusOnCheckin  could be used to remove the
    notforloan status and allow checkins to be trapped to fill holds.
    
    Test Plan:
    1) Apply this patch
    2) Restart all the things!
    3) Give an item a negative notforloan value
    4) Place a hold on the item
    5) Check the item in
    6) Note the item is trapped for hold
    7) Set SkipHoldTrapOnNotForLoanValue to the same notforloan value
       you used in step 3
    8) Check the item in again
    9) Note Koha did not ask you to trap the item for hold!
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66084e4f2f67d3db8ee7ec2e1cc60bbd2f93a1be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 25 10:49:42 2020 +0200

    Bug 24986: DBIC Schema files
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1763cd1f8a54c323e9983083df39bfbabf53333c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 25 10:49:08 2020 +0200

    Bug 24986: DBRev 20.06.00.001
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16a5197aa9f96ee8a7fb6c63e15a6c7f9342f773
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 4 12:12:23 2020 +0200

    Bug 24986: Modify some borrowers DB fields to (TINY|MEDIUM)TEXT
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 017b67e6c52ab7b79a0187b1ca9fea220117f7ef
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 18 09:01:36 2020 -0400

    Bug 25805: Return empty strings instead of undef in C4::SIP::ILS::Item::hold_patron_name
    
    This bug is basically the same as bug 24966, but for hold_patron_name instead of hold_patron_bcode.
    The subroutine hold_patron_bcode should always return an empty string, not undef.
    
    Test Plan:
    1) Using the SIP cli emulator, checkin an item that is not checked out
    2) Note the DA field contains someting like "C4::SIP::SIPServer=HASH(0x88175c8)"
       The hex number will almost certainly be different from this example
    3) Apply this patch
    4) Restart the SIP server
    5) Run the SIP checkin again
    6) Note the DA field is no longer present!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 115eeada2b6f959997d21d0e0dd73606f1ca7324
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jun 18 16:54:42 2020 -0300

    Bug 25805: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee3f5d5a85d93dc36d6bdeab5f092c0098d604e1
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Thu Mar 19 09:12:19 2020 +0200

    Bug 4985: Fix Plack scope errors
    
    This patch 'ours' several variables to fix Plack scope errors
    in exceptionHolidays.pl.
    
    This also adds '@holidays_list' as parameter to 'edit_holidays'.
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce2219425d9b97952f5904024fb7575a0809487b
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Fri Feb 7 12:43:54 2020 +0200

    Bug 4985: Edit a calendar entry for all branches
    
    This patch adds functionality to calendar tool to
    make edits or deletes to all branches at once.
    
    To test:
    -Apply patch
    -Add holiday for a library and copy it to all or some
    libraries
    -Edit previosly made holiday (edit, delete etc.) and
    check out "Copy changes to all libraries." checkbox
    => Changes are made to all libraries sharing changed
    holiday
    
    Sponsored by: Koha-Suomi Oy
    
    Signed-off-by: Christofer <christofer.zorn@ajaxlibrary.ca>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef947ff42fb5959d421038ac2a413e9cc6488474
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jun 17 11:50:26 2020 +0000

    Bug 18911: (follow-up) We should save changes with a POST
    
    Test plan:
    Verify if changes to messaging table and language are still saved.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ab27fe6da01095ec3303e35b5736f9ed9bbc07e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 17 12:20:36 2020 +0200

    Bug 18911: Add the ability to set the preferred lang for notice at the OPAC
    
    Patron should be allowed to modify this setting without asking a staff
    member.
    
    The setting is not configurable and cannot be hidden via a syspref.
    
    Test plan:
    - Turn the pref TranslateNotices on
    - Install some languages
    - Edit your messaging settings at the OPAC
    => Notice the "Preferred language for notices" dropdown list
    - Select one
    => Confirm that the value is saved in DB
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b48869f1b865ae1f172557274062e932318427db
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Apr 9 11:23:04 2020 -0400

    Bug 25097: Add option to message_queue to allow for only specific sending notices
    
    The message_queue.pl currently will send all the messages queued up.  It would be nice to have some control over which messages are to be sent.
    
    Example: We have libraries who only wanted to send 'hold notices' but not overdue, advance notice, etc during the covid-19 quarantine.  And some that were the opposite - turn off hold notices, but send other generated notices.
    
    Test Plan:
    1) Apply this patch
    2) Enqueue some messages with different letter codes
    3) Run process_message_queue.pl with the new -c parameter using one of the letter codes enqueued
    4) Note that only the messages with the selected code were processed!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f102e26da688de83c2ad46e52029d84f305a91da
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 7 11:00:19 2020 -0300

    Bug 25288: (follow-up) Use .escapeHtml()
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1a8c3fcfed61061ad8876b97851b92b0ea14fe3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 6 18:50:29 2020 -0300

    Bug 25288: (QA follow-up) Escape data and restore empty list behaviour
    
    After the QA round on bug 25279, some things needed to get fixed:
    - Data needs to be escaped
    - When no library is defined, we should keep the original behaviour and
      message.
    - aria-hidden="true" for FontAwesome coding guideline enforced
    - Added role="button" as well.
    
    This patch does that.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd0c207f533a4c65b17b59b40c31ac44633e09a8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 27 02:36:13 2020 -0300

    Bug 25288: Use the API to list libraries
    
    This patch makes the general libraries datatable use the API for rendering.
    To test:
    1. Test the datatable behaviour
    2. Apply this patch
    3. Repeat your tests
    => SUCCESS: Things work! Filtering and sorting specially
    
    Bonus: Use the browser inspector to notice each interaction with thex
    datatable triggers an API call with the right query parameters
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 032e11c7f4ef5d0eba6b1b49c0c62b8828e9d133
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 27 02:35:00 2020 -0300

    Bug 25288: Add general query parameters to the /libraries route
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b82d1416687434c61fe49b4230c15ad8b795b6e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 16 16:12:50 2020 +0200

    Bug 25287: Make the strings from .js translatable
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f5dc3dc0dd9fa02d6d11e92a6e466e545b8eccc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 27 02:28:59 2020 -0300

    Bug 25287: Add columns_settings capabilities to API datatables wrapper
    
    This patch adds the code that is used for handling columns settings on
    datatables and allows passing the columns_settings information to the
    API-centric datatable. To test, you need bug 25288, which uses this features.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Frédéric Demians <f.demians@tamil.fr>
    Works with bug 24561. Make working bug 25288
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76ac7ae0a0cbf5141230e58be4a36fcfe28f54c1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 15:15:36 2020 +0200

    Bug 22807: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e94cb26a8267df72f657fb7c1097d08318e8a21
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 10 18:30:50 2020 +0000

    Bug 22807: (follow-up) Update style of skip button
    
    This patch updates the markup and style of the skip button, adapting
    (i.e. stealing) the style of the skip link at https://webaim.org.
    
    To test, apply the patch and rebuild the OPAC CSS:
    https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client
    
    Go to any page in the OPAC and hit the tab key. The "Skip to main
    content" link should appear. Tabbing away from it should cause the link
    to hide. Hitting the ENTER key when the link is highlighted should cause
    the page to scroll to the main content.
    
    Signed-off-by: Hayley Mapley <hayleymapley@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78cfac8dd5d089960e7d34068415b8c7f0bd7775
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 10 18:42:06 2020 +0000

    Bug 22807: (follow-up) Add .maincontent class to libraries page
    
    This patch adds a missing "maincontent" class to the "all libraries"
    view. Previously it was only present on the single library view.
    
    To test, apply the patch and go to the "Libraries" page in the OPAC.
    
     - Hit the "tab" key to highlight the "Skip to main content" link.
     - Hit "Enter."
     - The page should scroll to the top of the list of libraries.
     - Open one of the library detail pages and confirm that the "Skip to
       main content" link works on that page too.
    
    Signed-off-by: Hayley Mapley <hayleymapley@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5b173f7dec5d94c29249dfa00e61861d5645998
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 10 16:56:40 2020 +0100

    Bug 22807: Ensure .maincontent appears on all pages
    
    Signed-off-by: Hayley Mapley <hayleymapley@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b0887f76e2f561187f6eae78f932987520a9cb6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 10 13:57:42 2020 +0100

    Bug 22807: Ensure only one maincontent on searcresults
    
    Prior to this patch, if you entered a search that returned zero results,
    you would end up with two 'maincontent' classes on the page
    
    Signed-off-by: Hayley Mapley <hayleymapley@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c36560a1ad731af955c005306c2c2800057cd890
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jun 9 14:10:53 2020 +0100

    Bug 22807: Add 'Skip to content' option
    
    This patch adds a 'Skip to content' link to the header bar which will
    only appear upon the first use of 'tab' to navigate after any fresh page
    load in the OPAC.
    
    Test plan
    1/ Load any page in the OPAC
    2/ Hit the `tab` key
    3/ Note the new 'Skip to main content' link appears at the top left of
    the screen.
    4/ Hit `Enter` or Click the button
    5/ Note the page scrolls to the area of the page that has the first block
       containing a .maincontent class.
    6/ Note that the next available focusable element after the first .maincontent
       block has been given focus.
    7/ Note that the link has been hidden
    
    Signed-off-by: Hayley Mapley <hayleymapley@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f002bd17105bab2d16aee8db8ed4f6d688192fc3
Author: Hayley Pelham <hayleymapley@catalyst.net.nz>
Date:   Thu Jun 11 11:48:54 2020 +1200

    Bug 25151: Fixing semantic headings in opac-basket.tt
    
    Test plan:
    1) Apply the patch
    2) Add items to your cart/folder/basket
    3) Open up the basket and check that the main heading is now an h1
    4) Check that the page looks fine
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 972aeaa0143dcdedc7ae23314a72991d5e4a6490
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 13:23:32 2020 +0100

    Bug 25154: Add heading where content is introduced in opac-results.tt
    
    Prior to this patch, the search results page did not contain a
    semantically accurate heading to introduce he main content of the page.
    
    Test plan
    1/ Perform a search in the OPAC that yields results
    2/ Inspect the page and note that the 'title' stating how many results
       are found is not semantically marked up as a heading to introduce the
       content.
    3/ Apply the patch
    4/ Reload the page
    5/ Inspect the page and note that the 'title' stating how many results
       are found is now properly marked up as a second level heading and
       appropriately designated as the start of the 'maincontent' block with an
       associated '.maincontent' class.
    6/ Perform a search which yields zero results
    7/ Note that the 'No results found' title is properly marked up as a
       second level heading.
    8/ Signoff
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ae6ffe59c18557566d74a00d4ac16ca19b85150
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 15:11:01 2020 +0200

    Bug 25236: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0550e0b7f788b65b50ed4689d677600be3f9c7c2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 11:54:22 2020 +0100

    Bug 25236: Fix semantic heading for opac-full-serial-issues.tt
    
    Prior to this patch, the opac-full-serial-issues side navigation box contained
    semantically incorrect headings.
    
    Test plan
    1/ Search for a serial with many linked issues
    2/ Navigate to the detailed view of that serial
    3/ Click on the 'More details' link after all the listed issues
    4/ Inspect the 'Refine your search' elements on the left side of the screen.
       Note that the headings are H1 (Koha page title) > H4 (Refine your search)
    3/ Apply this patch
    4/ Reload the page
    5/ Re-inspect the 'Refine your search' elements and note the heading
       semantics are now H1 (Title of page) > H2 (Refine your search)
    6/ Note the appearance of the box is improved and consistent with elsewhere
    7/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62795521eedc02e11bef520c8b980d480b7e02ae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 11:44:53 2020 +0100

    Bug 25236: Fix semantic heading for opac-topissues.inc
    
    Prior to this patch, the opac-topissues side navigation box contained
    semantically incorrect headings.
    
    Test plan
    0/ Enable 'OpacTopIssues'
    1/ Navigate to the top issues page via the 'Most popular' link
    2/ Inspect the 'Refine your search' elements on the left side of the screen.
       Note that the headings are H1 (Koha page title) > H4 (Refine your search)
    3/ Apply this patch
    4/ Reload the page
    5/ Re-inspect the 'Refine your search' elements and note the heading
       semantics are now H1 (Title of page) > H2 (Refine your search)
    6/ Note the appearance of the box is still reasonable
    7/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f88d56f689e514b47930d617049358fdf9b68608
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 11:37:26 2020 +0100

    Bug 25236: Fix semantic heading for opac-facets.inc
    
    Prior to this patch, the opac-facets side navigation box contained
    semantically incorrect headings.
    
    Test plan
    1/ Perform a search which yields some results in the OPAC
    2/ Inspect the 'Refine your search' elements on the left side of the
    screen. Note that the headings are H1 (Koha page title) > H4 (Refine
    your search) > H5 (Headings within 'Refine your search' box)
    3/ Apply this patch and follow
    https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client
    4/ Reload the page (Flushing the cache to ensure the CSS change load)
    5/ Re-inspect the 'Refine your search' elements and note the heading
    semantics are now H1 (Title of page) > H2 (Refine your search) > H3
    (Headings within 'Refine your search')
    6/ Note the appearance of the box is still reasonable
    7/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e18402c240814d7f00a62c3f2359bd9b9d0a098
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 12:15:21 2020 +0100

    Bug 25238: Fix semantic heading for opac-details
    
    Prior to this patch the opac-details view contained multiple h1 level
    headings.
    
    Test plan
    1/ Perform a search in the OPAC that will yield results
    2/ Navigate to any results detailed view
    3/ Inspect the page and note that two H1 level headings are present
    (Page title + Item title)
    4/ Apply the patch
    5/ Reload the page
    6/ Inspect the page and ntoe that the 'Item title' is now a level 2
    heading
    7/ Note the page still appears nicely
    8/ Signoff
    
    Bonus points: Check with XSLT views enabled and disabled, MARC21,
    UNIMARC and NORMARC variations.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a96ede5f114bd90fe1735702ca4bab77dfed9d4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 11 13:05:31 2020 +0100

    Bug 25239: Fix semantic heading for opac-reserve.tt
    
    Prior to this patch, the opac-reserve contained semantically incorrect headings.
    
    Test plan
    1/ Perform a search which yields some results in the OPAC
    2/ Attempt to place a hold on an item.
    3/ On the resulting screen, note that the headings are:
       H1 (Koha page title) > H3 (Confirm holds for) > H5 (Hold levels)
    4/ Apply this patch and reload the page
    5/ Re-inspect the elements in question note the heading semantics are now:
       H1 (Title of page) > H2 (Confirm holds for) > H3 (Hold levels)
    6/ Note the appearance of the box is still reasonable
    7/ Signoff
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d73c08e7351a772a388b1e1c6157b307fcbc1a8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 18 11:31:40 2020 +0000

    Bug 25402: (QA follow-up) Remove unused downloadBasket function
    
    This patch removes the now-unused downloadBasket function from
    basket.js. The patch should have no effect on the functionality of the
    download process.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 174ea44dccd8f0a151a82ba5f8c70e3194065539
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 6 20:30:32 2020 +0000

    Bug 25402: Put OPAC cart download options into dropdown menu
    
    This patch modifies the process of downloading a cart so that it doesn't
    involve a separate popup window.
    
    To test, apply the patch and add some titles to the cart in the OPAC.
    
     - Open the cart
     - The "Download" button should now be a dropdown menu.
     - Selecting any of the download options should trigger a download
       prompt.
     - Test with and without some CSV profiles which have been configured
       for use in the OPAC
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ff774509d8c3fc4747857dcfeee7a2cf7557921
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue May 12 21:27:05 2020 +0000

    Bug 25471: Add DataTables to MARC subfield structure admin page
    
    This patch adds DataTables sorting and filtering to the table of
    subfields shown on the MARC subfield structure administration page.
    
    To test, apply the patch and go to Administration -> MARC bibliographic
    framework.
    
     - From the 'Actions' menu, select 'MARC structure.'
     - From the 'Actions' menu, select the 'View subfields' link for a tag
       with multiple subfields.
     - On the page showing all the subfields for the tag, confirm that the
       table is sorted by default by subfield and that sorting works
       correctly.
     - Confirm that the search form at the top of the table works.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e14a0a3fa317191bf0ee735988a83b8f59d4ed5
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Wed Jun 10 15:36:01 2020 +0300

    Bug 25699: Add edition information to "Holds to pull" report
    
    Added a feature that displays edition information of the book
    together with title in "Holds to pull" report.
    
    Edition information is fetched from "biblioitem" table
    as "editionstatement" and transferred to template.
    
    Those changes don't have performance impact as all tables
    including "biblioitem" were already used and joined in this request.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2f136713e814d4e33e18d1cdad88f3675a9ec3a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 15 11:14:22 2020 +0000

    Bug 25747: Don't display a comma when patron has no firstname
    
    This patch adds a check for the existence of "firstname" to
    patron-title.inc so that if the patron has no firstname the "invert
    name" setting doesn't cause an unnecessary comma to appear.
    
    To test, apply the patch and locate or create a patron with no first
    name.
    
    - When checking out to the patron, examine the page title. It should say
      "Checking out to <lastname> (<cardnumber>).
    - When checking out to a patron with first and last name it should show
      as before, "Checking out to <lastname>, <firstname> (<cardnumber)
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3365a35963742b294a4c8631b22aa34dac228d9
Author: Emmi Takkinen <emmi.takkinen@outlook.com>
Date:   Thu Jun 18 09:36:55 2020 +0300

    Bug 25789: Don't allow past date as holds expiration date
    
    When editing existing holds expiration date it's possible to select
    past date from datepicker. This patch changes expiration inputs class
    as "datepickerto" to make past dates unselectable.
    
    To test:
    1.  Find item with holds
    2.  Edit holds expiration date
    => Note that past dates are selectable
    3. Apply patch
    4. Edit again
    => Past dates are no longer selectable
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 251197ad73ba2be88ac2154db46748b58a0597f8
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Jun 15 16:58:38 2020 +0200

    Bug 25756: remove erroneous hyphen
    
    In the Staff Client, the OPAC "Appearance" preferences table has an
    extra, empty HTML table row at the end.
    
    Test plan:
    0) Observe the empty HTML table row at the end of the table that lists
       OPAC "Appearance" system preferences.
    1) Apply this patch.
    2) Observe that the empty table row is now gone.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd716269a7b2b1b6165154ea7e85844201402a8d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 5 11:15:33 2020 +0200

    Bug 25611: Use selected vendor when creating a basket
    
    We did not take into account the vendor selected.
    
    Test plan:
    1. Choose Vendor
    2. Create Basket
    3. Assign a new vendor
    Without the patch this new vendor is not changed
    With the patch applied the vendor is changed
    
    4. Edit the basket, change the vendor
    
    Reported-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Rhonda Kuiper <rkuiper@roundrocktexas.gov>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e0dd6d0783a66514fc92cc0a34ca0882a5ce62f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri May 1 20:11:29 2020 +0000

    Bug 11994: (follow-up) Make things work when LibraryName is empty
    
    When LibraryName system preference was not set, the installation
    of the plugin would fail with:
    
    Firefox could not download the search plugin from: ...
    
    Now if the pref is empty, the description 'Library catalog'
    will be used instead.
    
    To test:
    - Empty your LibraryName pref
    - Verify the search plugin can still be installed
      (see first patch for further instructions)
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f090c1d2cb9253d77c5bac3b8fa03c775af2f0f6
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri May 1 17:20:43 2020 +0000

    Bug 11994: OpenSearch plugins needs to be delivered with Content-Type application/opensearchdescription+xml
    
    https://developer.mozilla.org/en-US/docs/Web/OpenSearch
    Your server should serve OpenSearch plugins using
    Content-Type: application/opensearchdescription+xml.
    
    To test:
    - Verify the Content-Type the file is delivered with
      is correct, for example using wget
      http://127.0.0.1:8080/cgi-bin/koha/opac-search.pl?format=opensearchdescription
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ef7b3db4cab73797ba3386b4951c0d86addf871
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 28 14:41:47 2020 +0000

    Bug 11994: Fix OpenSearch discovery in the OPAC
    
    This patch corrects the markup for the OpenSearchDescription XML
    document and adds (back) the link in the OPAC header which points to it.
    This will enable compatible browsers to offer the addition of the OPAC's
    keyword search as a search engine option.
    
    I've found documentation suggesting this feature is available (or at
    least was at one time) in Chrome and Safari, but in my test it only
    works in Firefox.
    
    To test, apply the patch and make sure the OPACBaseURL preference is
    set correctly.
    
     - Open the OPAC in Firefox (these instructions assume the latest
       version, currently v.75).
     - On the right side of the address bar you should see ". . ." Click it
       to trigger the menu.
     - You should see an "Add search engine" entry with your OPAC's icon.
     - Click to add the search engine.
    
     - Type a keyword to search in the address bar
     - A box should pop up below the address bar showing icons at the bottom
       for performing a search in various search engines. One of these icons
       should be the icon for your Koha OPAC.
     - Click the Koha OPAC icon and confirm that it triggers a keyword
       search in your OPAC.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 897948cff5812a67144355829cf8915af17465d0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 16 19:48:48 2020 +0000

    Bug 24352: Correct location and collection labels in OPAC search results
    
    This patch modifies the OPAC's MARC21 search results XSLT so that
    OPAC search result information is correctly labeled
    based on the OpacItemLocation preference.
    
    Previously, search results showed the label "Location(s)" whether the
    setting was "collection code" or "location."
    
    To test, apply the patch and set the OPACXSLTResultsDisplay system
    preference to 'default.'
    
    On the OPAC search results page, each result with items should show
    information in this format:
    
       With the OpacItemLocation preference set to 'call number only,'
        - "Availability: Items available for loan: {library} [Call number:
          {call number} ]
    
       With the OpacItemLocation preference set to 'collection code,'
         - "Availability: Items available for loan: {library}
            Collection(s): {collection description} [{ call number }]"
    
       With the OpacItemLocation preference set to 'location,'
         - "Availability: Items available for loan: {library}
            Location(s): {shelving location} [{ call number }]"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 980419ed15cd4e5ae8be552218f939f5faea18c4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 28 15:34:20 2020 +0000

    Bug 25189: Don't create authority if results found
    
    Automatic authority creation assumes that if we don't match we need a new authority.
    
    Using the Default linker, however, we don't match if there exists more than one match.
    This leads to repeatedly generating authorities once there is a duplicate in the system
    
    We shoudl instead only create a new authority if there are no results
    
    To test:
    1 - Set Linker Module to 'Default'
    2 - Enable  AutoCreateAuthorities  and  BiblioAddsAuthorities and  CatalogModuleRelink and LinkerRelink
    3 - Add two copies of a single authority via Z39
    4 - Add a heading for that authority to a bib record
    5 - Save the record and note a new authority is generated
    6 - Repeat and see another is generated
    7 - Apply patch
    8 - Restart all the things
    9 - Save the record again, no new authority created
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 258d0b0ecd6450fea09677f0607efdedb33cc16c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Apr 28 13:29:52 2020 +0000

    Bug 25189: Unit tests
    
    Adds new test for not adding authority if some already exist
    
    Also replaces use of 'SearchAuthorities' as it is Zebra specific
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e923e57ed18a104c33cc10a4704450ec4c71c28
Author: David Cook <dcook@prosentient.com.au>
Date:   Fri May 15 14:55:49 2020 +1000

    Bug 25509: Remove useless libjs-jquery dependency
    
    We don't use the libjs-jquery package, so we should remove
    the dependency.
    
    To Test:
    1) Build package (out of scope of test plan)
    2) Install package
    3) Note that libjs-jquery is marked by apt as no longer required
    4) Remove libjs-jquery package from system and note how it
    doesn't take koha-common with it
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b115dfeca649f2f35e0290ead85f2626eabd0829
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 21 18:25:46 2020 -0300

    Bug 25570: (follow-up) Fix tests
    
    This patch fixes the libraries tests, that expected the old behaviour
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/libraries.t
    => FAIL: Tests fail
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 451ae76431d3d580494f917ed397f259cd96a876
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 21 18:23:01 2020 -0300

    Bug 25570: Paginate results by default in objects->search
    
    This patch makes the helper paginate the resultsif no pagination
    parameters are passed.
    
    Page number defaults to 1, and the page size to the RESTdefaultPageSize
    syspref value.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/Objects.t
    => FAIL: Pagination is not enforced by default
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Results are paginated
    5. Sign off :-D
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2220ce4d50998bef1dcea787d212a287a802b0aa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 21 17:48:21 2020 -0300

    Bug 25570: Regression tests
    
    This tests verify that the default behaviour is to paginate the results.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/Objects.t
    => FAIL: $c->objects->search doesn't paginate results by default
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0f6f3c635170b6183bfa34244ffebad537e1e0b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 18 11:56:38 2020 +0000

    Bug 25804: Remove HTML from title tag of bibliographic detail page
    
    This patch removes <span> tags from the bibliographic detail page's
    <title> tag.
    
    To test, apply the patch and view the bibliographic detail page for
    any title in the staff interface. In the page title shown in the browser
    tab you should see no <span> tags.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73c421a5164a3af4b2b8e1001b49f29213a94e3a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jun 16 08:00:45 2020 -0400

    Bug 25769: Patron self modification triggers change request for date of birth to null
    
    If PatronSelfModificationBorrowerUnwantedField contains dateofbirth, all
    patron self modification requests will attempt to set dateofbirth to
    null instead of ignoring the field.
    
    Test Plan:
    1) Add dateofbirth to PatronSelfModificationBorrowerUnwantedField
    2) Run a patron self modification
    3) Note the request sets dateofbirth to null on the staff side
    4) Apply this patch
    5) Restart all the things!
    6) Run another self-modification
    7) Note of the staff side that dateofbirth is unaffected
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@outlook.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31800ba46b2ed03cc2e4431c4d3c56fce678a0ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 22 11:02:39 2020 +0200

    Bug 25553: Make date columns sortable on the edit items table
    
    When editing items, the table at the top contain several columns that
    have date values, but they cannot be sorted by dates correctly.
    
    Test plan:
    Have several items with different dates in columns that contain dates,
    like items.dateaccessioned, items.datelastseen)
    Sort the column and confirm that with this patch the lines are sorted
    correctly
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 477ae01ebd9d6fbe35f299378e352248cb34213d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 24 11:36:23 2020 +0200

    Revert "Bug 25828: Update cpanfile for 20.05 release cycle"
    
    This reverts commit ac8249ac67dcac6fd55b0d2bcc13ccd495722ca5.

commit ac8249ac67dcac6fd55b0d2bcc13ccd495722ca5
Author: Mason James <mtj@kohaaloha.com>
Date:   Sat Jun 20 15:03:25 2020 +1200

    Bug 25828: Update cpanfile for 20.05 release cycle
    
    to test...
     1/ check about.pl, see old module versions
    
     2/ apply patch
    
     3/ check about.pl, see updated module versions
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ebfc94a5724a0dd63f565f9744800c98d70f9cf
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jun 23 09:25:33 2020 +0200

    Bug 25842: Fix typo streetype in member-main-address-style.inc
    
    There are several more instances of the incorrect variable "streetype" in member-main-address-style.inc. Must be corrected with DB column name "streettype" in order to be able to set this field as mandatory.
    
    See also :
    Bug 25839 - Typo patron.streetype in member-main-address-style.inc
    
    Test plan :
    1) Add "streettype" in system preference "BorrowerMandatoryField"
    2) Create a new patron
    3) Without patch "Street type" field is not mandatory/required, with
       patch it is
    4) Remove "streettype" from system preference "BorrowerMandatoryField"
    5) Create a new patron
    6) Check "Street type" field is not mandatory/required
    7) Select a value and save
    8) Edit again patron
    9) Check value is selected
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0de7b6093e86410c022e252b554a5e6305c86480
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Jun 22 11:58:56 2020 +0200

    Bug 25839: Fix typo patron.streetype in member-main-address-style.inc
    
    Typo in member-main-address-style.inc : patron.streetype > patron.streettype
    
    Generates error :
    Template process failed: undef error - The method Koha::Patron->streetype is not covered by tests!
    
    Test plan : try create a new patron
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1af5a62cb74aa7dd000ae41c4be07dd6d3aa330
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 17 09:43:40 2020 +0200

    Bug 25774: Handle utf8 chars in REST API queries
    
    We must utf8 encode the string before json decoding it.
    
    Test plan:
    Use "❤" and play with the library search (bug 25288) and Postman to
    generate queries using it.
    
    This patch prevents 500:
    [2020/06/16 14:11:37] [ERROR] GET /api/v1/libraries: unhandled exception (Mojo::Exception)<<Wide character in subroutine entry at /kohadevbox/koha/Koha/REST/Plugin/Objects.pm line 107.>> Koha::REST::Plugin::Exceptions::__ANON__ /kohadevbox/koha/Koha/REST/Plugin/Exceptions.pm (73)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84230fcd798805c38c9ff16312121011cd0dc782
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jun 12 19:46:00 2020 +0000

    Bug 25702: Actions button on Search results from Z39.50 is displayed incorrectly
    
    This patch modifies, again, the way the actions popup is implemented in
    Z39.50 search results, whether it be in cataloging, authorities, or
    acquisitions. The solution for Bug 25282 changed some markup which was
    being referred to in JavaScript. This patch makes the markup more
    consistent and unifies handling of the menu in one JavaScript file.
    
    The solution changes the way a menu is generated when the user clicks
    within the row of Z39.50 search results (not on the "Actions" button).
    The script now creates a clone of the actions menu in that row and
    appends it to the <td> the user clicked on.
    
    To test, apply the patch and clear your browser cache if necessary. Test
    these three areas in the same way:
    
    1. Cataloging -> New from Z39.50 -> Search
    2. Authorities -> New from Z39.50 -> Search
    3. Acquisitions -> Vendor -> Add to Basket -> From an external source ->
    Search.
    
    In each case, test the functionality of the "Actions" menu button in the
    last column ("Preview" in Acquisitions search results). The menu
    should be positioned correctly and menu choice works correctly
    
    Click anywhere else in the search results table. The same actions menu
    should be triggered in that table cell. Confirm that these menu items
    work correctly according to the row which was clicked.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b54b529078756556252530bb72903caa88e94e7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 18 15:13:25 2020 +0200

    Bug 25786: AddReserve now takes a hashref
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b17a04dd077bb118086ad9e4bb58eee81ade2cdd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jun 17 12:53:36 2020 -0400

    Bug 25786: Holds Queue building may target the wrong item for item level requests that match holds queue priority
    
    Bug 23934 removed the limitation that prevented item level holds from
    getting local holds priority. The problem is the code has never checked
    if the item level hold matches the given item! This means the wrong item
    may be requested to fill an item level hold.
    
    Test Plan:
    1) Create 3 items on a record
    2) Place a hold for the 2nd item you created
    4) Ensure that hold would be picked up by local holds priority
    5) Build the holds queue
    6) Note the holds queue is asking for the wrong item!
    7) Apply this patch
    8) Rebuild the holds queue
    9) Holds queue should now be asking for the correct item!
    
    Signed-off-by: Kim Peine <kim@williston.lib.vt.us>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 679dcd1574de88cb8b7002c5020e0b4488233943
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 11 19:17:57 2020 +0000

    Bug 25447: Terminology: Fix button text "Edit biblio"
    
    This patch changes the cataloging main page so that in the menu for
    reach search result the "Edit biblio" link is now "Edit record."
    
    To test, apply the patch and do a search in cataloging. In the list of
    search results verify that the "Actions" menu contains a link labeled
    "Edit record."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db235d33a4caf64387b86ebab7b658bd7759ff21
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Jun 17 11:41:21 2020 -0400

    Bug 25783: Holds Queue treating item-level holds as bib-level
    
    The holds queue builder does not honor
    the new item_level_hold flag. Instead, it only item_level_request if
    in the loop dealing with item level holds. This is incorrect. Item level
    holds may be trapped in the local holds priority loop as well. It's
    trivial to just pass though the correct item/biblio level hold flag.
    
    I do not know how to write a reproducable test plan for these issues.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kim Peine <kim@williston.lib.vt.us>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd4970860d4299c89ce4a698644c08f990bc1468
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jun 17 17:18:12 2020 -0300

    Bug 25783: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kim Peine <kim@williston.lib.vt.us>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21cde7bd2f6380129c4a7fb7e4d3aecf4dcb6de0
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri May 1 16:28:25 2020 +0000

    Bug 10910: (follow-up) Move the suggestions note with the other non-blocking notes
    
    To test:
    - Add a credit to the patron's account
    - Make sure they got a pending suggestion
    - Try to delete
    - Verify you notes for both as list items
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85c1537bd7e4002a59c3c3eba6d2180911d8b7c3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sun May 5 09:42:45 2019 -0500

    Bug 10910: Add a warning when deleting a patron with pending suggestions
    
    Test plan:
    From the OPAC, add a suggestion
    From the staff interface, try to delete the patron who created the
    suggestion
    => You get a warning message
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9681b8a1ca4cf4a92642ca262778a28af05b93d1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jun 14 14:02:49 2020 +0200

    Bug 12093: (QA follow-up) Fix typo 'noteforloan'
    
    Just changes one character in the noteforloan class to notforloan.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee657b6e5aa0dc9a292260b01dc810fe3d5e2f50
Author: David Roberts <david@koha-ptfs.co.uk>
Date:   Sat May 9 22:14:10 2020 +0000

    Bug 12093: Add CSS classes to item statuses in detail view
    
    This patch adds classes where necessary to detail.pl
    
    To test:
    
    1) Apply patch
    2) View source of /cgi-bin/koha/catalogue/detail.pl to check that there
    are no orphaned statuses without classes.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6beda5cf1d1bb76ac692f5443e4b75f727c9c4ba
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 17 19:56:12 2018 +0000

    Bug 21591: Check for record level item type issues too
    
    To test:
    1 - sudo koha-mysql kohadev
    2 - UPDATE biblioitems SET itemtype = NULL where biblionumber = 1
    3 - UPDATE items SET itype = NULL where biblionumber = 1
    4 - perl misc/maintenance/search_for_data_inconsistencies.pl
    5 - Notice warnings
    6 - Apply patch
    7 - Undefined itemtype on bibliolevel is now warned
    7 - Test also with itype=""
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 488a9fc8ed956a6c516e2fa79caf189dce9d63a2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 15 11:45:31 2020 +0200

    Bug 24405: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 941989827b12fb54ceefc72dbc26f2727acf2a44
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 8 13:42:55 2020 +0000

    Bug 24405: Make OPAC link underlining consistent
    
    This patch makes a minor modification to the OPAC CSS so that links are
    consistently displayed without underlines in their inactive state. This
    corrects two cases: Links in the facets sidebar and "Check all/none"
    links shown on search results.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - In the OPAC, perform a search.
    - In the search results facets sidebar, confirm that links are not underlined.
    - At the top of the search results table, confirm that the "Select all"
      and "Clear all" links are not underlined.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 758b60f711ff97629d5f9cebabd64cec4edb1aca
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Jun 4 01:07:24 2020 +0000

    Bug 25070: (QA follow-up) Fix capitalization: Street Number
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a4d3ef0d8a759a485cc5f16e363bfb1f1177ab3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 14:42:40 2020 +0200

    Bug 25070: Centralize member-main-address-style
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac973d2d440f90ec2d9f55dd4e2c6c13a45faaec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 14:25:48 2020 +0200

    Bug 25070: Centralize member-display-alt-address-style
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c32d71978c47cc810d5de8c20df89866b2ce417b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 14:20:34 2020 +0200

    Bug 25070: Centralize member-display-address-style
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfd97049a335d50d633d4c47164d223fcc03cad2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 14:09:06 2020 +0200

    Bug 25070: Centralize member-alt-contact-style
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fdca61a7455bb5bdca32a718a43a7e2688bcea46
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 6 13:53:17 2020 +0200

    Bug 25070: Centralize member-alt-address-style
    
    There are 5 includes files per value of AddressFormat (us, de, fr).
    The code is duplicated for each language, the only thing that changes is the order.
    
    Wwith this patchset we are going to refactore them to avoid further regressions.
    
    The idea is to remove all code that is duplicated and remove the need of
    having 5*3 files. We are going to limit them to 5 files, 1 per use.
    
    Note that we could go even further, for instance
    member-display-alt-address-style and member-display-address-style are
    quite identical.
    
    Test plan (for the whole patchset):
    - Create a patron with all the address, contact and alternate info filled
    - Edit them and save
    - Look at the patron's info (top left) in the patron module, and the
    patron detail view.
    - Play with the different values of AddressFormat
    The order and the info must be displayed identically before and after
    this patchset. No change is expected.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 814a7ecf47b087a60b35bca6a4d23deeb596a0e8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 4 12:36:57 2020 +0000

    Bug 25363: Merge common.js with staff-global.js
    
    This patch merges the contents of common.js with staff-global.js. Both
    are included globally in the staff interface, and there doesn't seem to
    be any reason to require that the user downloads two different
    JavaScript files.
    
    To test, apply the patch and perform a catalog search in the staff
    client.
    
    View the detail page for a title in the search results. On the detail
    page you should see navigation controls in the sidebar for browsing
    through search results. Confirm they work correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 953a53d9d6bffbad9303532c113f50864a03a0ae
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 4 12:33:47 2020 +0000

    Bug 25593: Terminology: Fix "There is no order for this biblio." on catalog detail page
    
    This patch changes the phrase "There is no order for this biblio" to
    "There is no order for this bibliographic record." on the catalog
    detail page.
    
    To test, apply the patch and view the bibliographic detail page for a
    record which has no order associated with it. The text in the
    "Acquisitions details" tab should be correct.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e1d0068e8d3a8f94cc5153c3cff9781ed9e142d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Jun 4 00:09:48 2020 +0000

    Bug 25627: Fix class and id in body tag
    
    This will also help if you want to use different colors
    for different modules.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2127901da52e0c35124b97ff4626d3ea943e655
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 4 11:51:38 2020 +0000

    Bug 25627: Move OPAC problem reports from administration to tools
    
    This patch moves the OPAC problem report management page from the
    Administration section to the Tools section.
    
    I think this makes sense because management of reports is an ongoing
    task, not a configuration.
    
    To test, apply the patch and enable the OPACReportProblem system
    preference.
    
     - Go to Administration. There should be no link to OPAC problem
       reports.
       - Open an administration page which shows the Administration menu in
         the left-hand sidebar, e.g. Libraries. There should be no link to
         OPAC problem reports in the menu.
     - Go to Tools. There should be a link to OPAC problem reports in the
       "Addional tools" section.
       - Open the OPAC problem reports page and confirm that it works
         correctly.
       - The breadcrumbs menu should show "Tools > OPAC problem reports."
       - Confirm that the link in the sidebar menu works correctly.
     - If necessary, submit an OPAC problem report via the OPAC so that
       there is a pending report. Go to the staff interface home page and
       check that the "OPAC problem reports pending" link works correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40aaf25409921b1414396bb1aa2146b63d432339
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 9 20:05:48 2020 +0000

    Bug 25687: Switch Y/N in EDI accounts table for Yes and No for better translatability
    
    This patch changes the list of EDI accounts shown in EDI administration
    so that columns which previously used "Y" or "N" now show "Yes" or "No."
    
    To test, apply the patch and go to Administration -> EDI accounts.
    
    If necessary, add an EDI account. In the table of information about the
    EDI account, the columns with information about quotes, orders,
    invoices, responses, and auto-ordering should show "Yes" or "No" based
    on the account's settings.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7eb471fcdb113e158d819932116c546a53ee5845
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Tue May 19 13:21:44 2020 -0300

    Bug 25346: Supress warning message when install dir exists
    
    To see it enable verbose mode
    
    To test:
    1) Install lang with install dir
       (cd misc/translator; ./tranlste install de-DE)
       check message: "de-DE installer dir /...mysql/de-DE already exists."
    2) Apply patch
    3) Repeat 1, now message is gone
    4) Repeat 1 in verbose mode (./translate install de-DE -v)
       check the message now appears at the bottom.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a17c0475d8fff517eaf3a0da6dfaa65d43bde9f3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 2 11:08:23 2020 +0000

    Bug 25582: Don't show OPAC problems entry on dashboard when there are no reports
    
    This patch makes a minor correction to the template to correct the check
    on outstanding OPAC problem reports. An error was preventing the check
    from working correctly.
    
    To test, apply the patch and enable the OPACReportProblem system
    preference.
    
     - On the staff interface home page, check the area showing pending
       operations (suggestions, tags, etc.).
     - If you have no pending OPAC problem reports there should be no line
       for OPAC problem reports.
       - If necessary, mark all pending OPAC problem reports closed and
         confirm that when there are no outstanding reports the link is
         hidden.
       - Also test when there are no other outstanding reports in that
         section (suggestions, tags, patron modifications), nothing appears
         at all, not even the surrounding border.
      - If necessary, test that the link appears when you have one or more
        OPAC problem reports.
        - Go to the OPAC and use the "Report a problem" to submit a test
          report.
        - Check that the staff interface home page reflects that there is
          now a pending report.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 051b0b8d2fb3dc3593147e5ac80bc394dcf48e58
Author: David Roberts <david@koha-ptfs.co.uk>
Date:   Sat May 9 16:07:03 2020 +0000

    Bug 22470: Missing the table name on misc/migration_tools/switch_marc21_series_info.pl
    
    This patch adds the table name to the SQL update statements.
    
    To test:
    
    1) Apply the patch
    2) Run the script. Check that there are no errors, and that the script
    behaves as expected.
    
    Signed-off-by: Andreas Roussos <a.roussos@dataly.gr>
    Created a test record with values in field 440. Applied the patch, ran the
    script with the -c -f flags and observed that the values were moved to field
    490. Also, the relevant Koha to MARC mappings were changed accordingly.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 772205bab5c7d6720ca6d25244c04cdf7649a96f
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed May 6 16:22:57 2020 -0400

    Bug 25394: Cronjob path in the AuthorityMergeLimit syspref description is wrong
    
    Test plan:
    1- Apply patch
    2- Go to Administration > Global system preferences > Authorities
    3- The path to merge_authorities.pl in the AuthorityMergeLimit
    description should now read misc/cronjobs/merge_authorities.pl
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ab8df3866352568509ed34f02a5566e750dee21
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu May 21 13:52:32 2020 -0400

    Bug 25537: Page reload at branchtransfers.pl loses destination branch
    
    At branchtransfers.pl, one selects a destination branch and scans in any
    number of items to generate transfers to that branch. However, anything
    that makes the page reload causes your branch selection to be lost,
    reverting you back to whichever branch comes first alphabetically.
    
    This is an invitation to error when one has a stack of books to
    send all to the same branch. Could that error handling get moved
    into a modal or something that won't reload the page?
    
    Test Plan:
    1) Place a hold on an item and set it to waiting
    2) Initiate a branch transfer from branchtransfers.pl for any branch but
       the first in the pulldown branch selector
    3) Choose to cancel the hold and transfer
    4) Note the pulldown reverts to the first option
    5) Apply this patch
    6) Repeat steps 1-3
    7) Note the pulldown retains your preveiously selected branch!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50b6e447735ee31a2fbba5b116959cdb6d451c19
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 22 10:23:55 2020 +0200

    Bug 25576: Add link to the manual for the ILL module
    
    Test plan:
    Enable ILLModule system preference.
    Go to ILL requests
    Click Help
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58c389bf279ca6ffdea199ada8d65ce92baaf952
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Fri May 22 18:11:28 2020 +0300

    Bug 25587: fix for "clear" button to reset all selects
    
    Button "clear" on cgi-bin/koha/admin/smart-rules.pl did not reset fields
    with a dropdown selector except the first one.
    
    This happens because jQuery selector .find("select option:first")
    in koha-tmpl/intranet-tmpl/prog/en/modules/admin/smart-rules.tt
    selects only single first element in the whole group, as from jquery
    doc:
    > The :first pseudo-class is equivalent to :eq( 0 ). It could also be
    > written as :lt( 1 ). While this matches only a single element,
    > :first-child can match more than one: One for each parent.
    > (https://api.jquery.com/first-selector/)
    
    And it works if replaced by: .find("select option:first-child")
    
    To reproduce:
        1) Go to /cgi-bin/koha/admin/smart-rules.pl
        2) Start editing one of existing rules or filling a new one, change
           all selects to have non-first option selected. Fill text input
           fields with sample data.
        3) Reset all fields with the "clear" button.
        4) Observe that only the first dropdown field was reset to the first
           option while all others still contain previously given values,
           meanwhile all text input fields are cleared as expected.
        5) Apply the patch.
        6) Repeat steps 1, 2 and 3.
        7) Check that all dropdown fields were reset to first option, as
           expected.
    
    Mentored-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f70682c56dddd42f24c62d7634f5cd3b7119702
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 28 12:11:37 2020 +0200

    Bug 25615: Remove empty entries in the filter dropdowns of "holds to pull"
    
    On the "Holds to pull" view there are filters that are built on the
    value of the cells.
    Bug 22536 improved the ergonomic by adding a ul list, but the filters
    are now broken, the ul and li tags are retrieved and put in the filter
    list.
    
    The idea of this patch is to remove the HTML tags and skip if the value
    is then empty.
    
    Test plan:
    Place a hold on an item
    Go to Home › Circulation › Holds to pull
    Open the "libraries" filter
    => Without this patch you see empty entries
    => With this patch the filter contain only the libraries
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f898cef4f4b5a9f424f968a58b96898f26f80035
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 29 14:41:25 2020 -0300

    Bug 25623: Make sure oauth.t rolls back the db
    
    This patch adds a missing transaction wrapping one of the subtests. This
    is probably an oversight when refactoring this file.
    
    To test:
    1. Open the patron categories page
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/oauth.t
    => SUCCESS: Tests pass
    3. Reload the patron categories page
    => FAIL: There's random data in there
    4. Apply this patch and repeat 2
    5. Reload the patron categories page
    => SUCCESS: The random data from the previous tests is still there, but
    no new random data
    => SUCCESS: Tests still pass
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 257e75093258cda2687eddff9e57e0c498457fe2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 15 11:22:52 2020 +0200

    Bug 25658: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ada13a39825d666ad75a7510530abe5542803ee6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jun 4 15:22:43 2020 +0000

    Bug 25658: Print icon sometimes obscures patron barcode
    
    This patch alters the style of the patron name/cardnumber label on the
    checkout screen so that it has a maximum width. This will help avoid the
    label being obscured by the print/close buttons displayed when
    DisplayClearScreenButton is enabled.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Enable the DisplayClearScreenButton system preference.
     - Check out to a patron. Resize the browser to confirm that at narrower
       browser widths the patron name in the checkout form isn't obscured by
       the print and clear screen buttons.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e4b92d84c50bee27b2f331e5fbbc04813e469bb
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Thu Jun 4 16:21:27 2020 +0000

    Bug 25675: Reword and reorganize sysprefs related to patron self modification
    
    To Test:
    1: apply patch
    2: restart all
    3: go to System Preferences > OPAC
    4: confirm "Self registration" section is now labeled "Self registration and modification"
    5: confirm OPACPatronDetails is now in the "Self registration and modification" section
    6: confirm PatronSelfRegistration now reads "(Allow / Don't allow)  library patrons to register for an account via the OPAC."
    7: set OPACPatronDetails to Don't allow
    8: set PatronSelfRegistration to Allow
    9: log into the opac and verify you're not able to edit your patron details on an existing account
    
    Signed-off-by: DonnaB <donna@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4116ca4097732977d7b954a881f191174c28d651
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Jun 9 15:38:27 2020 +1000

    Bug 25696: Correct "Test prediction pattern" HTML button
    
    This patch corrects the closing tag for the "Test prediction pattern"
    button from "</a>" to "</button>"
    
    Test plan:
    1. Apply the patch
    2. Create a serial subscription from a new or existing bib record
    3. Choose any frequency, numbering pattern, and subscription start
    date you choose (ie fill out all mandatory subscription fields)
    4. Click "Test prediction pattern"
    5. Note that the prediction pattern appears on the right of the screen
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f1000638f156c27a82ad9d2c2e25714e6f1ec83
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 21 15:46:53 2020 +0200

    Bug 20783: Add missing url filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 953d0d89d0597b23527c9d57d35885a86f93d6b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 12 15:13:44 2020 +0200

    Bug 20783: Similar changes for OPAC
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Jessica Zairo <jzairo@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9f4d3bd76fc9764d58e4cb3ac8fb3eda6a939ca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 12 12:57:32 2020 +0200

    Bug 20783: Remove WWW::YouTube::Download dependency
    
    No longer used.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d7e08bc0e8c1ab6f21cce06932bb7dd6660cfcd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 12 12:54:50 2020 +0200

    Bug 20783: Use iframe to embed Youtube videos
    
    WWW::YouTube::Download is broken and not reliable.
    Other alternative was to use HTML::Video::Embed but not updated since
    years.
    
    The best alternative seems to follow youtube advise and use an iframe
    https://developers.google.com/youtube/iframe_api_reference
    
    Test plan:
    Put youtube video in 856$u (using different url formats, youtu.be,
    youtube.com/embed, etc.)
    Enable HTML5MediaEnabled and HTML5MediaYouTube and confirm that the
    youtube videos are correctly embeded.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fc316d2eef5945b20a14bec81e2daa57696dd81
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 20 15:40:10 2019 +0100

    Bug 23276: Do not display tag if pref TagsEnabled is off
    
    If the pref TagsEnabled is off we should not display the tags at the
    OPAC.
    There is a message to tell that tags system is disabled, but the tags
    are displayed.
    
    We should redirect to 404 like we do in opac-topissues.pl and
    opac-suggestions.pl.
    
    Test plan:
    - Turn TagsEnabled on
    - Add some tags
    - Turn TagsEnabled off
    - Hit /cgi-bin/koha/opac-tags.pl
    => Without this patch you see a warning messaging saying that the tag
    system is disabled, but the tags are displayed
    => With this patch you get a 404 redirect
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14c5512306c2e0c6fc21bbd378cc5bff0169ec68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 5 16:59:10 2020 +0200

    Bug 25266: Remove uneeded var
    
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7531f66a921089b8b4bae60cf607820b4c483af0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 25 09:33:10 2020 +0200

    Bug 25266: Fix error when no later order
    
    If no late order we got:
    "Argument passed to the 'IN' operator can not be undefined"
    
    It highlights a context error
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ce4024fcb9cc581ab0f5f6acb504d8e4bf904e9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 4 13:17:34 2020 +0200

    Bug 25266: Remove C4::Bookseller
    
    This was the only occurrence of GetBooksellersWithLateOrders and it was
    the only subroutine of C4::Bookseller
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e1d4c978d5954c27cd016f636a03942ede6c406
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 4 13:13:56 2020 +0200

    Bug 25266: Build the vendor list from the order list
    
    This patch is removing the use of GetBooksellersWithLateOrders and use
    the late order list to generate the vendors.
    
    Test plan:
    Create several vendors, several orders, close the baskets
    Also create vendors that do not have orders (or basket not closed)
    Go to the late orders page and confirm that the list of vendors is
    correctly filled, select one, you can see the "select all" link in the
    header of the table
    
    QA: that would be good to test this with production data and compare
    execution time.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 941b5aaecc0c528a30abf47b433c3805338ff09a
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue May 5 18:04:11 2020 +0000

    Bug 25349: Add checkEnter function and apply it to SCO page
    
    This patch adds the checkEnter function to the OPAC global.js and then applies it to the SCO login page.
    TO TEST:
    1. Go to SCO login and try entering something in the "Login:" input amd "Password:" input.
    2. Pressing enter while in either will automatically submit the form.
    3. Apply patch.
    4. Type something into the Login: field and press enter, the form should NOT submit.
    5. Type something into the Password: field and pess enter, this SHOULD submit the form.
    6. Change the syspref SelfCheckoutByLogin to 'Cardnumber'
    7. Type something into the Please enter your card number: field, the form should submit.
    
    Signed-off-by: Donnab <donna@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d9ca6b13d29acc088777e9df414aaa54be4e389
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 26 12:28:13 2020 +0200

    Bug 25434: Display selections-toolbar on small screens
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7de78ab092f7355a15de60e9a2842d9577777581
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 23 01:22:53 2020 +0200

    Bug 25507: Fix table in basket group PDF German 2-pages
    
    A variable was doubled up which made the columns in the
    table of orders no longer line up (different number of headers
    to columns).
    
    To test:
    - Create at least one basket with one or more orders
    - Close the basket
    - Add the basket to a basket group manually or let Koha do it
      on closing
    - Change the OrderPdfFormat system preference to 'German 2-page'
    - Go to the basket group page and print the PDF of the basket
    - Verify the table of orders doesn't look right and runs outside
      the page
    - Apply patch
    - Repeat the PDF print - now table should look right
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d21ad9fe11bdbd8c49eb3d64bb24c414bea8a1f7
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri May 15 20:20:05 2020 +0000

    Bug 25521: Remove cart_to_shelf note from NewItemsDefaultLocation syspref
    
    To test:
    1- find the NewItemsDefaultLocation syspref
    2- confirm it says "NOTE: This system preference requires the misc/cronjobs/cart_to_shelf.pl cronjob. Ask your system administrator to schedule it."
    3- apply patch
    4- restart all
    5- reload syspref, it doesn't say that anymore!
    
    Signed-off-by: Holly Cooper <hc@interleaf.ie>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f98f2edf0a1515ce727e670ecaecd4f9295f34cb
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat May 30 00:56:04 2020 +0000

    Bug 25545: (follow-up) Fix capitalization
    
    Total + Adjustments + Shipment cost ($)
    
    changed to:
    Total + adjustments + shipment cost ($)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 286a739b5cd906a55b2dc97e6ab1ef9ffb00a6f7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 27 10:38:03 2020 +0000

    Bug 25545: Add adjustments to total tax included
    
    Adjustments are not affected by tax, they are meant as a way to alter invoice
    values after receiving (damaged items, refuneds, extra charges, etc)
    
    When adjustments were added the tax included column was missed
    
    To test:
    - Add a basket with at least one order
    - Close it
    - Receive shipment
    - Receive the order
    - Finish receiving
    - Add an adjustment of any amount
    - Verify in the invoice details table:
      - Total tax exc. is showing including the adjustmnt
      - Total tax inc. is missing the adjustment
    - Apply patch
    - Reload
      - Total tax exc. is showing including the adjustmnt
      - Total tax inc. is showing including the adjustment
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73e5032c4bf52ee72972a6fe8182d3fd5737716c
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed May 20 17:59:16 2020 +0000

    Bug 25555: Invert patron name in holdsqueue.tt
    
    TEST PLAN:
    1. Have multiple holds from multiple patrons and run the holds queue cron to populate the holds queue list.
    2. Try sorting by patron and see that is sorts based on first name.
    3. Apply patch
    4. Try sorting again and now it should sort by surname.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e00a96cf17f9c429050ce2ce5e3095fe566121a
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon May 25 16:25:06 2020 +1000

    Bug 25597: Add missing Javascript libraries to sco printslip
    
    This patch adds missing Javascript libraries to the self-checkout
    print slip. These missing libraries were preventing the auto print
    prompt and close. There was also a font error.
    
    To Test:
    0) Apply patch
    1) Turn on system preference SelfCheckReceiptPrompt
    2) Check out item via /cgi-bin/koha/sco/sco-main.pl
    3) Click "Finish"
    4) Press F12 on keyboard and choose Console
    5) Note no Javascript errors
    6) Note that print dialog appears and closes after
    a print option is chosen
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Alex Arnaud <alex.arnaud@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b16e463173e8125396eaef3159d08df5d0d2cfb6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 26 10:50:31 2020 +0200

    Bug 25599: Fix default value placeholders for UseACQFrameworkForBiblioRecords
    
    The feature was there but a condition disabled it.
    
    Test plan:
    - modify the default value for 008@ or another subfield in the ACQ framework using one or more of the placeholders above
    - activate UseACQFrameworkForBiblioRecords
    - create a basket
    - create an order from a new record
    - verify the values have been replaced
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b05647b6361b1a805ae856e81a3e7db0cb3394b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Jun 5 16:38:52 2020 +0400

    Bug 25642: Fix description of new feature in update_dbix_class_files.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77c945d380975bb18b292e5bb28dd6942dc1288f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 1 13:31:21 2020 +0100

    Bug 25642: Add technical notes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35bb41dfc14603d85a6ddb85fec9b4de8d1a4001
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 10 10:58:25 2020 +0000

    Bug 25701: Remove sort on removed field
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6696944267ca1afd7682193ddf3680a905a773d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 10 12:03:20 2020 +0200

    Bug 25701: (bug 14419 follow-up) Always display facet groups in the same order
    
    It seems that this regression comes from bug 14419, but I have not found
    a logic reason behind that.
    This patch restores the behaviour we always had: facet groups must be
    displayed in a given order: the Zebra index (au, ccode, holdingbranch,
    etc.)
    
    Test plan:
    Apply this patch, restart all and confirm that the facets are not moving
    up and down when you refresh your search result page.
    
    QA note:
    I think the following line must be removed
    @facets_loop = sort {defined $a->{expand} && defined $b->{expand} && $a->{expand} cmp $b->{expand}} @facets_loop;
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca7eb99eef2d1ae0258318310e402069194e999b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 9 12:40:32 2020 -0300

    Bug 24003: (follow-up) Add all userenv parameters
    
    This patch makes the API set more userenv params than just the
    borrowernumber. To test:
    
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/auth_*
    => SUCCESS: All tests pass
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b2d8b6779df37fa6be58f0313f4c128b183e4f6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 5 09:47:47 2020 -0300

    Bug 24003: (follow-up) Move interface setting to a more readable place
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 682d7896dd8e91fe846221d9605f79ca44d16360
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 5 09:16:16 2020 -0300

    Bug 24003: Make the API set userenv on authentication
    
    This patch makes the authentication step stash the user that got
    authenticated so code outside the Mojo part of Koha can use it (i.e.
    through the use of C4::Context->userenv).
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/auth_authenticate_api_request.t \
               t/db_dependent/api/v1/auth_basic.t
    => FAIL: Tests fail!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1a3fad1fc5c3949fbc14df42af49acc88a633ff
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 5 09:15:19 2020 -0300

    Bug 24003: Regression tests
    
    This patch adds regression tests for the different authentication
    mechanisms Koha supports. It highlights the fact that Koha expects
    userenv to be set on authentication.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbac95d9fbbcc0b586a7bc094f421c35a7d71011
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 8 10:23:53 2020 +0100

    Bug 25526: Equality matching is case sensative
    
    TEST PLAN:
    1. Have a fine on a Patron's account.
    2. Choose the "Write off Selected" button
    3. Enter an amount less than the amount owed by the patron.
    4. Koha will give a yellow box with a note "You must collect a value
       greater than or equal to 2.00." The $2.00 is the amount that is
       attempted to write off (the amount less than the amount owed).
    5. Apply patch
    6. Again try to writeoff an amount less than the amount owed.
    7. You should be able to write it off.
    8. Try paying an amount more than owed, you should still get an
       error. You shouldn't be able to write off more than the amount.
    9. Follow the above steps via 'Pay selected' as aposed to 'Writeoff
       selected'.
    10. You should not be able to 'Tender' less than the amount you have
        'Paid'.
    11. Disable Javascript and run through all the above steps. You should
        still be blocked where relevant.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ac43fd97b58120560a33e26509d5acc712c97fb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Sat May 23 14:35:45 2020 +0000

    Bug 25492: Your Account Menu button does nothing on mobile devices
    
    This patch removes some redundant code from the OPAC JavaScript which
    was causing problems with the show/hide action on two controls which are
    shown only at narrower browser widths: The "Your account" menu shown
    when the user is on a user-related page, and the "Refine your search"
    menu shown on the search results page.
    
    To test, apply the patch and go to the OPAC. Narrow your browser width
    to below 768 pixels.
    
     - Perform a search.
     - On the search results page you should see a "Refine your search"
       link at the top of the results. Clicking it should expand and
       collapse the facets menu.
     - Log in to the OPAC.
     - On the "Your summary" page there should be a "Your account menu" link
       at the top of the main part of the page. Clicking it should expand
       and collapse the account menu.
     - Verify that these menus display correctly when you widen and narrow
       the browser window.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74c7530e3dacd7a1df9ed72d031bc1a5b7063142
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 2 11:05:12 2020 +0200

    Bug 17842: Simplify the code
    
    There is no need for all the conditions.
    From Encode::encode POD:
      "If the $string is undef, then undef is returned."
    
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13ec430eccd52413e756c88f90a370787842cbc2
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue May 26 12:30:53 2020 +1000

    Bug 17842: UTF-8 encode ISO2709 MARC download from cart
    
    The cart was outputing ISO2709 MARC records with Latin-1
    encoding. Records containing non-latin1 characters were
    automatically re-encoded as UTF-8 by browsers, which led to
    inconsistent character encodings for downloaded MARC files.
    
    This patch explicitly encodes ISO2709 MARC characters from
    the cart download as UTF-8 encoded bytes, which resolves the problem.
    
    Test Plan:
    0) Don't apply patch
    1) Create bib record with only ASCII characters
    2) Add a ü character to the title
    3) Save bib record
    4) Download bib record from cart (opac and staff client)
    5) Using xxd or some other program, note that the ü is
    represented by a FC byte (latin-1 encoded)
    6) Apply the patch
    7) Download bib record from cart (opac and staff client)
    8) Using xxd or some other program, note that the ü is
    represented by C3 BC bytes (utf-8 encoded)
    9) Success
    
    (Note that you could potentially use Notepad++ or some other
    program to open the downloaded file and just note the encoding
    that it finds. You could also try "chardetect" instead. Lots
    of options for figuring out the encoding.)
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4365b64403ba9492650e2e1733ccad8772dcdfc2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jun 2 14:00:25 2020 +0000

    Bug 25653: Update tab selector to use 'active' and include all options
    
    It looks like the functionality was broken when ui tabs were upgraded
    and mainmainentry was added
    
    To test:
    1 - Browse to Authorities
    2 - Search in each tab
    3 - Note all search results revert to 'Search main heading a only'
    4 - Apply patch
    5 - Note selection is retained after search
    
    Signed-off-by: Claire Gravely <claire_gravely@hotmail.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 369a4e39b48456be4376292f724a787ef0b6667e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 8 11:12:07 2020 +0100

    Bug 14543: (QA follow-up) Add missing filter
    
    This patch adds a missing `| html` filter to the tax_rate value option
    that the patchset adds
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ae7554667a209962a169f3a3b1d4b5b4beb398c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 16 12:14:42 2015 -0400

    Bug 14543: Order lines updated that have a tax rate not in gist will have tax rate set to 0!
    
    If the tax rate for a given order line has been removed from the system
    preference gist, that tax rate will show in the pulldown as 0. If a
    librarian then saves the order line the original tax rate will be
    overwritten with 0%!
    
    Test Plan:
    1) Find an order line
    2) Remove the tax rate set for that order line from the syspref gist
    3) Edit the order line
    4) Note the tax rate is 0
    5) Apply this patch
    6) Edit the order line
    7) Note the tax rate now displays with a warning
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c548cb08f3f3013778da71d47745f48b6adffd8
Author: David Cook <dcook@prosentient.com.au>
Date:   Tue Jun 2 09:53:06 2020 +1000

    Bug 25634: Warn if koha-shell returns non-zero in koha-foreach
    
    By putting koha-shell in an if statement, "set -e" will no longer
    cause the entire koha-foreach program to exit, if koha-shell
    returns a non-zero status.
    
    If a non-zero status is returned, we warn on it, and the caller
    of koha-foreach can interpret that command visually.
    
    To Test:
    1) Write a shell script that says "Hello" and then exits with a 1
    status
    2) Run koha-foreach against that shell script with multiple instances
    available to koha-foreach
    3) Before the patch, koha-foreach will die after the first "Hello"
    4) After the patch, koha-foreach will continue, through all the
    instances, and report which instances returned non-zero statuses
    by which command.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88cd45b0903ae7cfd8939045e60ffc7b0361e16c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 8 14:14:22 2020 +0200

    Bug 25693: Set correct permissions on logdir after an upgrade
    
    Since bug 25172 we are failing loudly if the permissions are not correct
    and that the logger cannot init successfully.
    
    We must set the correct permission on upgrading.
    koha-create deals with new installs
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4714b08f7270b86c62d9e32ce8f14d3afb08f37e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 4 14:43:58 2020 -0400

    Bug 25677: Checkbox options for EDI accounts cannot be enabled
    
    Checking any of the checkboxes in the EDI Account editor does nothing.
    They always remain set to "off".
    
    Test Plan:
    1) Browse to edi_accounts.pl
    2) Create a new EDI account, check all the checkboxes
    3) Edit the account, note none of the checkboxes are checked
    4) Apply this patch
    5) Repeat steps 1-2
    6) Note the checkboxes remain checked
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79f7879303724aa1ae69db8c3f2ea5aa34148dc5
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu May 21 23:42:01 2020 +0000

    Bug 25557: Correct basket.pl column config
    
    This patch corrects the column configuration tool for basket.pl
    TO TEST:
    1. Go to Acquisitions and look at basket.pl
    2. Open another tab and go to column configuration and try to hide some columns like Quantity.
    3. See that the wrong columns are being hidden.
    4. Apply patch
    5. Trying hiding each column in the table and make sure the correct one is being hidden.
    6. Rejoice!
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d003ad9cd5a0967f3235d687340a8b75d36acd3
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Jun 2 15:32:10 2020 +0400

    Bug 25651: Fix modification of authorised value
    
    When modifying an existing authorised value, the category is not
    correctly passed to the template and so it is not passed to the
    POST request, which results in the authorised value switching to
    category '', which effectively make it disappear from the interface.
    This patch fixes that.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f32825ae26aa443a1fde2c8884852e4298d96916
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jun 11 15:42:22 2020 -0300

    Bug 25707: (QA follow-up) Clearer message about what's going on
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e239e13bc9663dc3d4a43f125761165875b08876
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jun 9 12:49:54 2020 -0400

    Bug 25707: (bug 11529 follow-up) Do not update marc mappings, print old mappings to upgrade log
    
    This patch removes the update of marc frameworks from the updatedatabase script and warns the
    "MARC to Keyword" (fieldmappings ) to the upgrade log so they can be replaced manually
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9be26ad5ac7615f2f723900dfd16d83d71b66fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 10 13:21:42 2020 +0200

    Bug 25538: Default to --login|-i if no command passed
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5ffbb4dd4c3b616f715b74a9091e73e48ff0715
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 10 11:17:34 2020 +0200

    Bug 25538: Use sudo -i in koha-shell
    
    See man sudo, -i parameter.
    Should we expect regressions?
    
    Test plan:
    0. Use D11 or U18.
    Don't apply this patch
    1.
    $ echo $KOHA_INTRANET_URL
    $ sudo koha-shell kohadev
    $ echo $KOHA_INTRANET_URL
    2. Apply this patch
    $ cp debian/scripts/koha-shell /usr/sbin/koha-shell
    3. Repeat 1.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c4d2444057dd2f8ae613ad73328f880258810c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 10 10:50:05 2020 +0200

    Bug 25538: Don't run search_utf8.t if KOHA_*_URL empty
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d6c12e2471942f2cd9c4c2d2af891507018009ac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 9 16:15:04 2020 +0200

    Bug 25638: Make the tests pass - ignoring the actual issue
    
    The API related tests still don't pass with the previous modifications.
    They pass on D10 but fail on U18 and I did not manage to find where the
    problems come from.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9555ca1c73d6a6a7074a9cee721e2d2ff7888c1f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 5 15:55:28 2020 -0300

    Bug 25638: Update TODO
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4f3c8f18b5587ad8629b77b457e9593d781dac6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 5 16:09:46 2020 +0200

    Bug 25638: Fix regression
    
    Now that float/decimal columns are not treated similar to integer ones,
    the default value handling we had set for numeric values is not trapping
    the float/decimal cases as it should.
    
    We love tests!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8dfbc46aa4bebffb5e7bd262612ef9d08d24e5d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 2 14:40:04 2020 +0200

    Bug 25638: Fix float/decimal comparison in API related tests
    
    The previous fix from bug 25513 does not work in all versions we are
    supporting.
    
    Let's hack the float/decimal columns in the same way we did for integer.
    
    prove t/db_dependent/api/v1/acquisitions_vendors.t \
          t/db_dependent/api/v1/patrons_accounts.t \
          t/db_dependent/api/v1/acquisitions_orders.t
    
    Note that there is another error on U20 for acquisitions_orders.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59ae6ced7fa7ffbcc0a061d884a3bb4cbb233b15
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 2 14:36:43 2020 +0200

    Bug 25638: Revert "Bug 25513: Remove unneeded integer casting in Koha::Object->TO_JSON"
    
    This reverts commit a79cf4150e8a08e743acc7d7147af91757d7a9b8.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0569072fc1db2f4af731d5377c654ae7ef76e15a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 5 15:44:39 2020 -0300

    Bug 25638: Add tests for JSON conversion vs DBD::mysql
    
    We have the situation of needing to cast numbers so they are not
    confused in JSON with strings by DBD::mysql returning them with the
    wrong internal flags.
    
    We have also recently removed the cast, and adding it back now.
    This test could help us detect this situation in case we make changes in
    the area, and even on specific libraries versions.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f828d433da9c32e865669079db9f367db79aeab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 1 12:54:03 2020 +0200

    Bug 25641: Fix Koha/XSLT/Base.t failures on U20
    
    There is a change in the version number.
    On U20 we get
      Opening and ending tag mismatch: a line 0 and b
    On others (D9, D10, U18) we get:
      Opening and ending tag mismatch: a line 1 and b
    
    I did not find where it did come from, so assuming it's just a minor
    change and won't have side-effects.
    
    Test plan:
    Make sure the tests pass on U20 and another OS
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7df314f0b27bdc70e02280aa12d0fac26f096411
Author: Mason James <mtj@kohaaloha.com>
Date:   Mon Jun 1 15:58:54 2020 +1200

    Bug 25633: Update debian/control.ini file for 20.05 release cycle
    
    update maintainer details
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34fba17f82e7d2893ac3e45ad6fdcb9addc5b9ef
Author: Mason James <mtj@kohaaloha.com>
Date:   Mon Jun 1 14:56:15 2020 +1200

    Bug 25591: Update list-deps for Debian 10 and Ubuntu 20.04
    
    update list-deps for libcpan-meta-perl package
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d9a51332d0cc932a4f23d757bbd6f5c38282df6
Author: Mason James <mtj@kohaaloha.com>
Date:   Sun May 24 15:16:20 2020 +1200

    Bug 25591: Update list-deps for Debian 10 and Ubuntu 20.04
    
    This patch removes version-specific packages from the debian/control file,
    which fixes a bug where koha-common can only be installed on the debian
    version that the package was built on
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e49829779aa6483b3d927adae86129aed69ace4
Author: Mason James <mtj@kohaaloha.com>
Date:   Mon Jun 1 17:20:17 2020 +1200

    Bug 17084: Automatic debian/control updates (master)
    
    update for 20.05 release cycle
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14606d515acdb3c5483382f83a3e354171f56a57
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 2 11:14:35 2020 +0200

    Koha 20.06 - start of a new dev cycle
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d148412c1dae1465fb310958ec2b3afae4eccea5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Sun May 31 22:01:13 2020 +0100

    Update release notes for 20.05.00 release
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit bcea97744b7c753368ff78829441e1b8df752246
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Sun May 31 21:37:41 2020 +0100

    Update contributors
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit aef33d840c78e82013940cf74b597e2ba8c526d0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Sun May 31 21:33:04 2020 +0100

    Translation fixes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 50d619d15625a3fecff9e0383798fa0e19ba0586
Author: Koha translators <>
Date:   Sun May 31 16:54:51 2020 -0300

    Translation updates for Koha 20.05.00
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
