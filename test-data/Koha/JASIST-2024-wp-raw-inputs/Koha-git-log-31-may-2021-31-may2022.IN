commit 4f4bfc808100a37245419a5e5810275b480a2f90
Author: Magnus Enger <magnus@libriotech.no>
Date:   Tue May 24 12:12:35 2022 +0000

    Bug 30837 - Fix table width on 'Print summary'
    
    To reproduce:
    - Make sure you have a patron with at least one checkout,
      one hold and one fine
    - On the detail page for that patron, go to Print > Print
      summary
    - Observe the tables are too wide to fit on a printed page
    
    To test:
    - Apply this patch
    - Repeat the steps above
    - Observe the table now fits on the page
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit f08951f044e2cdac7a9bdf4cdfb6897b9de9e1f2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon May 23 12:18:11 2022 +0000

    Bug 30831: Unit test
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Edit: minor typo fix

commit 6cd0249725f211f0df77ba367c379f0e5c5e1d4e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon May 23 12:25:53 2022 +0000

    Bug 30830: Add Koha Objects for Koha Import Items
    
    To test:
    prove -v t/db_dependent/Koha/Import/Record/Items.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 3c0c375d8e073c9eb765179fa7b3c3d0136b5174
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 11:22:54 2022 +0100

    Bug 28152: Log the "duplicate item barcode" error
    
    Looking at the code this 'import_error' column is empty for the last 9 years. Not sure it makes much sense to have this single error now.
    
    commit 1dba9c6409d78cb1f90de6c1300cb5b63fb1b851
    Date:   Wed Oct 10 14:21:22 2012 -0500
        Bug 7131: teach MARC import how to overlay items
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit c7a8a456c7dcc0bc2a015968f7a2c0e9ac2370f0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 15 12:12:23 2021 +0200

    Bug 28152: Fix import_items row creation if duplicate barcode
    
    We are trying to insert "duplicate item barcode" into import_items.itemnumber (integer),
    it fails with "Incorrect integer value: 'duplicate item barcode' for column 'itemnumber' at row 1"
    
    To reproduce:
    Export a biblio with an item
    Import it
    => The item is not added, and there is no new row in import_items.
    
    The error only appears in the log if you comment the close STDERR and
    close STDOUT lines
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 05934b89b1b43ceb88928b48a4e1fd69708ac61b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 10:15:35 2022 +0100

    Bug 29828: Prevent additional content to be created without default
    
    When creating or editing an additional content, the form is submitted if
    only the title of the 'default' tab is filled in.
    We should submit the form only if both title and content exist.
    
    Test plan:
    Create a new content using text editor (codemirror)
    Confirm that the form is submitted only if title and content from the
    default tab are not empty
    Try again with wysiwyg (tinymce)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 554c9cb7d9c562960b24474687e7472a9257ab18
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 31 08:42:29 2022 -0300

    Koha 22.06 - start of a new dev cycle
    
        The road of excess
        leads to the palace of wisdom;
        for we never know what is enough
        until we know what is more than enough.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 78f89459f461a36cbe523b95a2eb157646288ef9
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 23:47:49 2022 -1000

    Koha 22.05.00 is here!
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 54f34ae74f026be4363fc32c0be26e19acb585b3
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 23:42:40 2022 -1000

    22.05.00: Fix translations (bis)
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4ff7a3d29f72bfd291e0c4aab7bd635c245ff6ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 26 11:01:09 2021 +0100

    22.05.00: Fix translations
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b490eb129f91bbc72e4f82954ea0c368345d0d88
Author: Koha translators <>
Date:   Thu May 26 05:11:24 2022 -0300

    Translation updates for Koha 22.05.00
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3a2587bebd8cf38431b1fb72db31db461452b2c0
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 21:37:13 2022 -1000

    Add release notes for Koha 22.05.00
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a0f14c6ab69c3104447c1957b21ba6c121a66cec
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 19 13:40:56 2022 +0100

    Bug 30808: Add the 22.05 release team.
    
    Test plan
    1/ Check against
       https://wiki.koha-community.org/wiki/Release_Teams
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ac9d4dd71011ea0ad3202e2f4143bcd6c6ca60b6
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 17:00:48 2022 -1000

    22.05.00: Update kohastructure.sql
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bb7ebf8c15b535e38fad4fbeb854406e50ec6e93
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 16:13:29 2022 -1000

    22.05.00: Update mailmap
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f8185e1b66327c7be3be49824640d37c42e8f5ca
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 16:03:32 2022 -1000

    22.05.00: Update history.txt
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a033e63dfc0e17aa084af32a1bd8e2aaf29dd300
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 16:01:56 2022 -1000

    22.05.00: Update contributors.yaml
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7edcfcb70f72b7eaf8e5f575d54760da926e6a74
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 15:53:46 2022 -1000

    Add Jeremy Breuillard to mailmap
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ff93b6c5bf666ad7c9b8cf03539841ec4d5305b5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 15:48:09 2022 -1000

    Add Thibaud Guillot to mailmap
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0ffd2ee8dac3e1c4a524eed5728731ef3ac749ad
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 20:35:04 2022 -1000

    Bug 30852: DBRev 21.12.00.057
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 242f0917fecbdff12b9d4bb3480e3bda8acc3135
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 25 20:32:35 2022 -1000

    Bug 30852: Add index on article_requests.debit_id
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6f4017f4c63049342fe3f96cdc2e25aa0c374acd
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 23 08:40:51 2022 -1000

    Bug 30747: (follup-up) Add missing otherholdings_datelastborrowed column in settings
    
    See Bug 24176
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7120059745158af08890ba5881090d7337a41fea
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed May 18 14:12:11 2022 +0000

    Bug 30747: Make column settings work for otherholdings table using forEach loop
    
    To test:
    
    1. Turn on SeparateHoldings and find a record that has some items at
       different home libraries.
    2. Look at the Other holdings(x) tab. Notice there is no Columns tool
       (gear icon).
    3. Go to Table Settings, try hiding columns from the otherholdings
       table. You cannot.
    4. Apply patch.
    5. Now under the Other holdings(x) tab you should see the Columns
       button, it should work.
    6. Go back to Table settings and try hiding columns, it should work.
    7. Now try uploading an item level cover image, make sure all columns
       are still properly hidden and the Columns tool works
    8. Try steps 6 & 7 but with the regular holdings table. Confirm that all
       colums can properly hide.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Included a rename to table_name(s).
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c3f285220917847bc06cf998c7760ffd11903b69
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 19 15:52:21 2022 +0100

    Bug 30730: (follow-up) Simplify query
    
    This patch drops the 'fetch all non-loanable items' query used in the
    subsequent query as part of the 'not_in' and instead replaces it with a
    simple filter on 'notforloan => 0'
    
    Test plan
    Run the included unit tests before and apply applying the followup.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fdfb75eaf644ed920cf0d4086502a4139b492e4c
Author: Shi Yao Wang <shi-yao.wang@inlibro.com>
Date:   Tue May 17 11:37:21 2022 -0400

    Bug 30730: Unit tests
    
    Added an entry in holds for an item with negative notforloan value to
    test if get_items_that_can_fill returns the right items.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5679d5df5f238851431492a4225ebb675b0ca09d
Author: Shi Yao Wang <shi-yao.wang@inlibro.com>
Date:   Tue May 17 11:08:06 2022 -0400

    Bug 30730: Holds to Pull should not list items with a notforloan status
    
    Remove items with a notforloan value other than 0 because items that are
    potentially holdable (with negative notforloan status) are not wanted in holds to pull.
    
    Test plan:
    1- Have a bib with 2 items, both holdable. Give one of these items a notforloan status with a negative value (like Ordered in the testing docker data).
    2- Place a title-level hold on your bib
    3- Confirm your bib is showing on Holds to Pull as expected, prompting staff to pull the item that does not have a not for loan status (correct!)
    4- Take the item that does not have a not for loan status and check it out to a different patron, make sure not to fill or cancel your hold
    5- Reload Holds to Pull, see your title is still listed and now Koha is directing staff to the item with a notforloan status
    6- Apply the patch
    7- Reload Holds to Pull, see your title with a notforloan status is gone
    8- Run `prove t/db_dependent/Koha/Holds.t` and all tests should pass
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 889ba1c381132e49c149c0d40a141364ea3470c5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 11 10:51:20 2022 -1000

    Bug 30735: Fix filtering by patron attribute with AV in overdues report
    
    In Circulation > Overdues, if there are seachable patron attributes
    they can be used in left filters. Search does not work if this attribute
    is linked to an authorized values category.
    
    The problem is that AV code is compared to the AV desciption in :
      if (grep { $attrval eq lc($_->[1]) } @{ $pattrs->{$code} }) {
    
    Looking at a Data::Dumper of the var $pattrs you see for example :
    $VAR1 = {
              'ATT1' => [
                          [
                            'afr',
                            'Afrikaans'
                          ]
                        ]
            };
    First row is attribute code and second row is desciption.
    It works for an attribute without AV because in this case
    'avdescription' is undefined so code is stored as description :
              push @{ $pattrs->{$row->{attrcode}} }, [
                $row->{attrval},
                defined $row->{avdescription} ? $row->{avdescription} : $row->{attrval},
            ];
    
    This patch fixes the code and removes commented line.
    Also reviews the SQL query :
      - avcategory is useless
      - use alias attrcode for borrower_attributes.code to be more explicit
    
    Test plan :
    1) Create a patron A with overdues
    2) Go to Circulation > Overdues
    3) Check you see the patron A
    4) Create a patron attribute, searchable, with an authorized value
       category, ie LANG
    5) Edit patron A to set a value in this attribute
    6) Go to Circulation > Overdues
    7) Select attribute value and apply filter
    8) Check you see the patron A
    9) Redo test plan with a patron attribute, searchable, without an
       authorized value category
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7ccb32747b02e34337991661d9a765764db8678e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 18 12:27:02 2022 +0000

    Bug 30797: (follow-up) Hide default Flatpickr clear-field button
    
    The basic MARC editor has its own button associated with each subfield
    for emptying the contents of the input. Since the Flatpickr "X" icon
    causes a layout problem and would be redundant, we can hide it on this page.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 72176f95134b41f859ae781c90aff658c20b88e5
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed May 18 04:07:06 2022 +0000

    Bug 30797: Add the calendar.inc include to addbiblio.tt
    
    addbiblio.tt throws the '$(...).flatpickr is not a function' because it
    is missing includes to flatpickr.min.js and shortcut-buttons-flatpickr.min.js
    
    To fix this the addbiblio.tt should include the calendar.inc file (like
    additem.tt does) which includes to those aforementioned JS files.
    
    Test plan:
    1. Edit a MARC bibliographic framework
    2. Make the 902$d subfield visible in the Editor
    3. Also set the 902$d subfield plugin='dateaccessioned.pl'
    4. Catalogue a new biblio record
    5. Notice the 902$d subfield has not been pre-populated with todays date
    6. Right click, choose 'Inspect', observe this JS error in the console: "Uncaught
    TypeError: $(...).flatpickr is not a function"
    7. Apply patch, and restart services
    8. Repeat steps 4-6 and this time observe the 902$d is pre-populated,
    and there is no flatpickr JS error in the console
    
    Sponsored-by: Chartered Accountants Australia and New Zealand
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 54e951e72d28925c0795bea5b5cf21d3cc03aecf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 18 15:03:30 2022 +0000

    Bug 30009: Do not set MARCNOTES to empty list in list context
    
    AMENDED:
    We should not pass an empty list here, but just undef in order to
    prevent creating a shift of elements in the hash.
    
    To test:
    1 - Find or create an invalid marc record
    2 - View in staff client
    3 - Note tab Descriptions(1) has no content
    4 - Apply patch, reload
    5 - No empty tab
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 96622e8c3f313566c5a8febe0f7d9facc94c4118
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 6 20:32:32 2022 +0000

    Bug 30714: Do no log update to holdingbranch
    
    When an item from another branch is checked in, the holdingbranch is
    updated, and this change is logged.  We record the checkin in
    statistics, we do not need the cataloguing update logged
    
    To recreate:
    1 - Enable cataloguing log
    2 - Check in an item with a different holding branch
    3 - Check the action logs
    4 - There is a cataloguing log for the holdingbranch update
    5 - Apply patch
    6 - Repeate with another item
    7 - No log added!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c4a32b5ce6f4af608315c6e0b30187160061dadd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 6 20:32:12 2022 +0000

    Bug 30714: Unit test
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit be9aead2b14b81adc844360e1283e6eb523afc05
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Mon May 16 18:56:05 2022 +0000

    Bug 30776: import missing subroutine to fix import_webservice_batch.pl
    
    Test plan:
     1) Apply patch and notice the following error is gone:
        $ perl misc/cronjobs/import_webservice_batch.pl
        Undefined subroutine &main::GetStagedWebserviceBatches called at misc/cronjobs/import_webservice_batch.pl line 46.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de4434bd4a73b06de1c06a24306368f5531bf39f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 28 11:37:31 2022 +0000

    Bug 30640: Focus does not always move to correct search header form field
    
    This patch updates the staff interface's global JavaScript to
    accommodate changes in the way focus is being handled after the jQuery
    upgrade (see: https://github.com/jquery/jquery/issues/4950).
    
    The "focus" class is removed from search header include files so that
    there isn't a contradiction between which form field has the focus class
    and which form field is displayed in the active tab.
    
    To test, apply the patch and view various pages in the staff interface.
    
    - On pages where focus is not being directed to a form field within the
      main content of the page, the form field in the active search header
      tab should have focus on page load:
    
      - Patron details
      - System preferences
      - Cities and towns
    
      Also test pages where a tab other than the first one is preselected:
    
      - Bibliographic details page
      - Patron lists
    
      On these pages, focus should move to the active tab's form field when
      you switch tabs.
    
    - On pages where focus is being sent to another form field, it should
      work correctly:
    
      - Patrons home page
      - Check in
      - Acquisitions home page
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b9a755d795a2738ae9cff913de2faa3758b5c4cc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 17 08:22:37 2022 +0100

    Bug 30695: (follow-up) Fix selenium test
    
    The tab title words were re-ordered and we forgot to update the
    corresponding selenium test.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 7660861d40f68e0c60b9a144a6ddb490763d4c15
Author: Katrin Fischer <katrin.fischer@bsz-bw.de>
Date:   Fri May 13 10:25:27 2022 +0000

    Bug 30720: Batch action links in result list missing permission checks
    
    In the staff interface you can select records for merging, batch editing,
    and batch deleting from the result list. This fixes the code to check for
    the specific batch edit records and batch delete records permissions, so
    those actions are only shown if the user has the right permissions.
    As there is no merge record permission yet, it's assumed that edit_cataloge is
    needed as before (no change in behavior).
    
    To test:
    - Create a staff user with only catalogue and editcatalogue permissions.
    - Do a search in the catalog of the staff interface
    - Select a few records from result list to unlock the Edit button on top
    - Verify it shows all three options: edit, delete and merge
    - Apply patch
    - Verfiy now only merging is shown
    - Add the records_batchdel and records_batchmod permissions from the tools
      area one after another and verify the display changes accordingly.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ef0798162888fd1d2d2be92addccf249040d103c
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri May 6 03:33:59 2022 +0000

    Bug 30701: Make Upload Tool buttons work on mobile-size screen
    
    When the Upload tool is accessed on a smaller (mobile) screen (less than
    768 pixels wide), the Upload and Browse buttons cannot be clicked. This
    patch fixes that.
    
    To test:
    1) Go to Tools -> Upload
    2) Make the screen narrower, either by opening your browser's Inspector
    tool and using Responsive Design Mode, or by dragging in the edge of the
    window to make it narrower.
    3) Notice that when the screen becomes narrower than 768px, the sections
    squash together and the padding between them is lost. Try to click on
    the Browse and Upload buttons, notice you cannot.
    4) Apply patch and refresh the Upload Tool
    5) Ensure the screen is narrower than 768px. Confirm there is now
    padding between the sections, and the buttons are clickable again.
    
    Sponsored-by: Chartered Accountants Australia and New Zealand
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1eb3dcbc06450381a336228adda2d90f615f0241
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 11 21:23:58 2022 -1000

    Bug 30740: Link to authorities 'used in' should not use equal
    
    When showing an authority, there is a link to search biblio records it is used in.
    Actually this link uses 'q=an=$auth_id', this is wrong for an URL, and other places use 'idx:value'.
    It does not break search with Zebra nor Elasticsearch but it is better to use ':'
    
    Test plan :
    Check changed links return same results with and without patch
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 55cc21278798b6b5706050eaf377b5eb3f569bcb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 14 19:59:30 2022 +0000

    Bug 29719: Do not clear onloan value when not passed in MARC
    
    We blank the field to prevent users from setting it during import, but this has the
    affect of blanking it in the DB.
    This patch replaces the onloan field when not passed in to 'ModItemFromMARC' to preserve
    the value
    
    To test:
     1 - Check an item out to a paron
     2 - Export the item using Tools->Export data
     3 - Stage the record for import
     4 - Match on 999c and replace items
     5 - Import the batch
     6 - View the record and note item is checked out and Available
     7 - In the DB note the onloan value is now null
     8 - Check in the item
     9 - Apply patch
    10 - Repeat 1-5
    11 - View the record and note item is checked out
    12 - In the DB note the onloan value matches the due date
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b79608edd3f8818c9de4e407703343b787f812d8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 14 19:59:07 2022 +0000

    Bug 29719: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2d56fb7e84a81fb084db7bd301550e28fd7bb6e7
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 10 06:56:15 2022 -0400

    Bug 30207: Allow any reserveforothers subpermission to access the page
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3a13667ad32c56577db6a8e075a4cea5512eed8a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Mar 1 11:49:49 2022 -0500

    Bug 30207: Librarians with only "place_holds" permission can no longer update hold pickup locations
    
    Bug 29540 increased the flags required to for modreserve.pl, but in doing so created a situation where a library can select a different pickup location for a hold, but upon clicking the "Update hold(s)" button, will be logged out due to having insufficient permissions for modreserve.pl.
    
    Test Plan:
    1) Create a librarian with "place_holds" permissions, but not "modify_holds_priority".
    2) Place a hold for a patron
    3) Attempt to change the pickup location from request.pl
    4) Note you get logged out with a permissions error
    5) Apply this patch
    6) Restart all the things!
    7) Attempt to change the pickup location from request.pl
    8) This time it should succeed!
    
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 84f7b7a7a38dff121f5f8b7d891632108edb218d
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 3 06:29:49 2022 -0400

    Bug 30666: Holds reminder cronjob (holds_reminder.pl) uses DataTime::subtract wrong
    
    In holds_reminder.pl, the script loops over all available branchcodes. For each iteration of the loop, if not using the calendar, the script subtracts the days parameter from the current date to get the waiting date threshold. The problem is that this method alters the DateTime object in $date_to_run, so for each iteration of the loop, the waiting date becomes farther and farther in the past, when it should always be the same!
    
    The solution is to either clone the "date to run" for each call to subtract, or to move it out of the loop since it doesn't need to be recalculated each time.
    
    Test Plan:
    1) Become the koha user using koha-shell
    2) Run DBIC_TRACE=1 misc/cronjobs/holds/holds_reminder.pl --days 7
    3) Note in the queries that for each loop, the waiting date is different
    4) Apply this patch
    5) Run the command in step 2 again
    6) Note the queries all now have the same waiting date threshold!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a7e7939748ef9c3f8df8aefb20f5ca9169d4575d
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 3 06:53:43 2022 -0400

    Bug 30667: Holds reminder cronjob (holds_reminder.pl) never uses default letter template
    
    Bug 28514 changed the way holds_reminder.pl searches for templates, using a direct search for letters,
    but should be using find_effective_template instead. Now, if a branch specific template does not exist,
    it will skip that branch.
    
    Test Plan:
    1) Ensure you only have the default HOLD_REMINDER template
    2) Become the koha user using koha-shell
    3) Run misc/cronjobs/holds/holds_reminder.pl --days 7 -v
    4) Note that the script skips every branch
    5) Apply this patch
    6) Run the command in step 3 again
    7) Note the script doesn't skip over any branches
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 49fec1549bd7d344dc794fab4a550a8fe732d578
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 31 15:51:14 2022 +0000

    Bug 30422: Authorities editor update broke the feature added by Bug 20154
    
    This patch corrects JavaScript in authorities templates so that
    clicking "Edit" on the authority detail page will take you to the
    authority edit page while keeping the same tab open.
    
    This patch also corrects the JavaScript which should have been
    automatically moving the cursor focus to the first form field when
    switching tabs in the editor.
    
    This patch also adds the "Section" headings which are present in the
    basic cataloging editor but were not added here at the time of the
    page's tabs revision.
    
    To test, apply the patch and locate an authority record in your catalog.
    
    - Without changing tabs, choose "Edit record" from the "Edit" dropdown
      menu."
    - The authorities editor should load and display the "Section 0" tab.
    - Return to the authority detail page and select a tab besides tab 0.
    - Click back to tab 0. Editing the record at this point should open the
      editor to Section 0.
    - Return to the authority detail page.
    - Click any of the numbered tabs besides tab 0.
    - Choose "Edit record" from the "Edit" dropdown menu.
    - When the authorities edit page loads the same tab should be
      preselected.
    - Test that when you switch tabs in the authority editor the cursor
      focus is automatically moved to the first visible input.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c1a485bf1c15c83fc0b09f3b2d143bf7498ea040
Author: Shi Yao Wang <shi-yao.wang@inlibro.com>
Date:   Fri May 13 10:18:22 2022 -0400

    Bug 30139: Same fix for the other javascript moneyFormat function
    
    This patch makes javascript moneyFormat function in paycollect.tt consistent
    with the one in pay.tt
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b69e743ee3545e74a6b07defb5e1571d820d4ad1
Author: Shi Yao Wang <shi-yao.wang@inlibro.com>
Date:   Tue May 10 13:34:15 2022 -0400

    Bug 30139: Fix javascript moneyFormat to be compatible with FR format
    
    New way of formatting money amount to make it work with FR format
    
    Test plan:
    1- Set CurrencyFormat pref to FR
    2- Activate Point of sale and cash register features
    3- Add cash register
    4- Add debit type that 'can be sold' with a price of 10.00
    5- Go to point of sale, click on the item to purchase
    6- Verify the Amount to be paid shows the wrong amount and can't be fixed on the interface
    7- Apply the patch
    8- Refresh the page and do step 5 again
    9- Notice it now shows the right amount
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e0814f2cc051d52a128a2f23f76169cd2e2716a3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 13 07:29:04 2022 +0000

    Bug 30717: (QA follow-up) Move to module
    
    We will probably use this a bit more :)
    Let's put it in a module (with a trivial test).
    
    Test plan:
    Repeat item edit.
    Run  t/DateUtils.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3870cc25b40379e0f538c3b3c08fb8fe3540a8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 9 10:28:51 2022 +0200

    Bug 30717: Format dates when editing items
    
    This is a result of bug 29369 and bug 27526.
    Bug 29369 removed the format of the dates, and bug 27526 assumed that it
    was the correct behaviour.
    
    Here we don't want to let the controller know which fields is a date, or
    we will have to access the subfield structure to know which subfields
    have the "date cataloguing plugin".
    
    This patch suggests to use the altFormat options from flatpickr that
    will "Show the user a readable date (as per altFormat), but return
    something totally different to the server."
    
    It's actually an option we want to use for all our dates, that will
    reduce a lot the overhead in our controllers.
    
    Test plan:
    Edit items (additem.pl and in batch) and confirm that the subfields
    using the dateaccessioned plugin are displayed according to the
    dateformat syspref. Make sure the date is stored correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 656e864e6b3234a5d493bd2b44bc3b831bd458f1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 9 15:22:16 2022 +0000

    Bug 30721: Markup error in detail page's component parts tab
    
    This patch adds a missing </div> to the bibliographic detail
    page template in the section for showing component parts.
    Some comments are added to clarify the markup structure.
    
    To test you should have a record in your catalog with component
    parts. Bug 11175 provides one you can import if necessary:
    https://bugs.koha-community.org/bugzilla3/attachment.cgi?id=78023
    
    To see the error, go to the staff interface, locate the record
    in question and view the detail page. Under the Components tag,
    scroll to the bottom. You will see content from "later" tabs at
    the bottom, e.g. "There is no order for this bibliographic record"
    or "No images have been uploaded for this bibliograhpic record yet."
    
    Apply the patch and reload the page. The tabs should still look
    correct, and now the tab content should be correctly isolated.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0dff67d0df23b0cab4678d848106571ef2a0e1ae
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 13 11:48:00 2022 +0000

    Bug 30728: (QA follow-up) Fix missing comma
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit a45154e34a9c840f31c2fc2d5d264590c279c077
Author: Andreas Jonsson <andreas.jonsson@kreablo.se>
Date:   Wed Apr 13 09:20:42 2022 +0200

    Bug 30520: Allow BatchImport to be used by command line tools.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4078720198bf26295d375d6b9dec992278323e07
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 5 11:13:08 2022 +0000

    Bug 30689: Incorrect Babeltheque setting can cause console warning
    
    This patch adds an additional system preference check to the part of the
    OPAC bibliographic detail template which conditionally loads Babelthèque
    JavaScript. The script tag should not be output if there is no
    Babeltheque_url_js setting to use.
    
    To test, apply the patch and search for "Babeltheque" in system
    preferences.
    
     - Set "Babeltheque" to "Do" include information.
     - Enter a path in the "Babeltheque_url_js" preference, e.g.
       "https://www.example.com/example.js" It doesn't have to be a valid
       Babeltheque URL.
     - In the OPAC, view the bibliographic detail page for any title. If you
       used a dummy URL for the js preference you should see an error in the
       console about the file not being found. This confirms that the
       template logic is working. If you used a working Babeltheque URL then
       the corresponding content should load.
     - Return to system preferences and remove the URL from the
       "Babeltheque_url_js" preference.
     - Return to the bibliographic detail page in the OPAC and confirm that
       there is no warning in the console about "'src' attribute of <script>
       element is empty."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 92e37d5630003bdaf9422bdf6b9f3f65c5c4aced
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu May 12 22:07:56 2022 -1000

    Bug 30728: Fix typo 'in real time'
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ac95c0a8b74b446ecb7f89e40322314e98140af5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu May 12 21:58:25 2022 -1000

    Bug 30728: BDRev 21.12.00.056
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 056000e431bd39d1755e3181c3376e9b27d7103f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 14:26:30 2022 -0300

    Bug 30728: Make RealTimeHoldsQueue disabled by default
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit af1f8d34db42a94232fa445f99ae9b437a12a72f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 14:18:55 2022 -0300

    Bug 30728: Only trigger real-time holds queue update if enabled
    
    This patch makes the places in which Koha enqueues holds queue for
    real time updates verify the feature is enabled.
    
    To test:
    1. Apply this patches up to the unit tests
    2. Run:
       $ updatedatabase
       $ kshell
      k$ git diff origin/master --name-only | grep -e '\.t$' | xargs prove
    => FAIL: tests fail, the code doesn't care about the syspref
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Be happy!
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b952519c26f159ad53c0c3d3642bdb6ffcd5e9c1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 14:17:37 2022 -0300

    Bug 30728: Add unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 75768ad124cf031130846ad3127f0ba58466f47f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 14:17:17 2022 -0300

    Bug 30728: Add RealTimeHoldsQueue syspref
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3ac2a20ddf882802639013b6cef38f1786df880
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 12:27:02 2022 -0300

    Bug 30727: Avoid holds queue updates multiple times on BatchDeleteBiblio
    
    This patch makes the background job only enqueue holds queue updates
    once per biblio, when appropriate.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/BackgroundJobs/BatchDeleteBiblio.t
    => FAIL: It enqueues 3 times for a bib!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: It only enqueues once!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c4df2457ded7b2f903085c23e09fe87969730444
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 12:26:32 2022 -0300

    Bug 30727: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d7c8de7e7fe917d5718fdce9a250814952b5221c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu May 12 08:38:15 2022 +0000

    Bug 30734: Fix BackgroundJob.t
    
    Added test for empty string or undefined. We could still consider
    evaling the json operations.
    
    Test plan:
    Run t/db_dependent/Koha/BackgroundJob.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b5462a72aea93745d2ba53645775a58136fff66b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 11 11:27:41 2022 +0100

    Bug 27619: (QA follow-up) Remove xt/sample_notices.t
    
    Now that we've remove the last of the translated .sql files, we can just
    drop this test entirely.. translation is now handled on pootle for all
    languages.   Woopie! :)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 4a2d659b7d4421b3fbf7e3b394426638a7b9567e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 6 12:19:36 2022 +0100

    Bug 30695: (QA follow-up) Catch moremember.tt too
    
    This patch does the same treatment for moremember.tt where the same
    summary block is includes. We also correct the tab order to be a little
    more consistent too.
    
    We should really move this to an include and refer to it from both
    templates instead of this copy/paste code..
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ac461ec797612a2426c36d041f59fb08efd83674
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 5 12:03:35 2022 -0300

    Bug 30695: Display tabs more consistently in patron details
    
    This patch makes tab texts display 'Thing (count)' as opossed to the
    current mix we have.
    
    To test, check before after the patch how it looks.
    
    You need to:
    - Enable ArticleRequests
    - Set ClaimReturnedLostValue to 1 (for example)
    - Have some clubs set
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3b6fd415b450e66058cd97923d9ea68a37223479
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 29 16:46:24 2022 -1000

    Bug 30127: By default show pending suggestions tab
    
    Pending suggestions are the most important ones in links pointing to suggestions.
    This tab should be the default one, like did Bug 7875
    
    Changing order in perl code seems really difficult because it is a
    generic code using GetDistinctValues()
    
    Test plan :
    1) Create some suggetions, accept some of them
    2) In staff interface, click on 'More > Suggestions'
    => You see pending tab selected
    3) In left menu, click on 'Suggestions' under 'Late orders'
    => You see pending tab selected
    4) In left menu, use a filter, then click on '[clear]'
    => You see pending tab selected
    5) Create a suggestion, click on 'cancel'
    => You see pending tab selected
    6) Create a suggestion, click on 'Suggestions' in breadcrumbs
    => You see pending tab selected
    7) Edit an existing suggestion, click on '<< Back to suggestions'
    => You see pending tab selected
    8) Create a suggestion, click on 'Submit your suggestion'
    => You see pending tab selected
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1473575317423b01e03d5eb09ab03625f0ad0a49
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 9 09:42:30 2022 +0200

    Bug 30603: Fix other occurrences
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bc235e72ce7d545c8c44dae294f542e378c7e231
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 9 09:28:04 2022 +0200

    Bug 30603: Display Sort1 and Sort2 as free text if no AV exists
    
    Test plan:
    Don't define AV for Sort1 and Sort2, edit a patron
    => Should be editable via an input box
    
    Define AVs for Sort1 and Sort2, edit a patron
    => Should see the dropdown
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 63002fa58914bf90db9b5ca1802a96f120762a69
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 11:16:59 2022 -0300

    Bug 30710: (QA follow-up) Add POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3649905dfc7117bf566b234e06eaedc23e824c3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 6 14:45:13 2022 +0000

    Bug 30710: Build holds queue once per biblio when batch deleting items
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a10f88bd3e727ee4655ac830748de0f3feb13cb6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 10 11:43:46 2022 -0300

    Bug 30710: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fb0eecfc6e633a9153ef63d18b09dca36d5aeddb
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 10 20:39:42 2022 -1000

    Bug 13142: DBRev 21.12.00.055
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 38db9932d2df0895b0f542525e539f95c4dc7903
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Apr 28 14:01:52 2022 +0000

    Bug 13142: (QA follow-up) Convert database update to current format
    
    https://bugs.koha-community.org/show_bug.cgi?id=13412
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 32ea1742f80a671004e7c84e390d638b51d3d295
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Apr 28 15:28:13 2022 +0200

    Bug 13412: (QA follow-up) Rephrase and link system preference descriptions
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 985fcf970c6be0bdb248b64cc3442000b6121387
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Apr 28 15:09:09 2022 +0200

    Bug 13412: (QA follow-up) Fix alphabetic order in sysprefs.sql
    
    TaxRates was not moved when renamed from gist, just moving it down
    so things are tidy again.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 55d1e68024aabbbb36855e23718df0857f2af185
Author: Roch D'Amour <roch.damour@inlibro.com>
Date:   Wed Feb 21 10:55:35 2018 -0500

    Bug 13412: Allow configuration of auto-created authorities
    
    This patch add 2 new system preferences:
    - GenerateAuthorityField667
    - GenerateAuthorityField670
    
    When Koha creates authority records from biblios, use these preferences instead of the hard-coded "Machine generated authority record." and "Work cat." values.
    
    Test plan:
        1. Make sure AutoCreateAuthorities and BiblioAddsAuthorities are enabled in the system preferences
        2. Go to Home › Cataloging › Add MARC record and add a new record
        3. Fill in the required fields and add a name in the 100$a field. Note the name, and add the new record.
        4. run rebuild_zebra.pl -a
        5. Go to Home › Authorities and search for the name you entered in 100$a
        6. Select details and look at the 667 and 670 fields. They should default to the hard-coded values.
        7. Apply patch, run update database
        8. Edit the new GenerateAuthorityField667 and GenerateAuthorityField670 system preferences
        9. Do 2-6 . Now the 667 and 670 fields should be what you entered in the system preferences.
    
    Thanks for testing
    
    Signed-off-by: Bernardo Gonzalez Kriegel <bgkriegel@gmail.com>
    Works well, no errors
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit da93be46ff26bb05a20160fd992d583a76308827
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Fri Apr 8 08:10:04 2022 +0000

    Bug 30511: Don't lock up entire database while running koha-dump
    
    Test plan:
    1. Apply the patch
    2. Restart services
    3. Run koha-dump
    4. Confirm the .sql.gz and .tar.gz files are generated successfully
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cdb6f28139b01b98397107f9f919b818f775763e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 28 12:04:11 2022 +0200

    Bug 27619: Remove fr-FR installer data
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit dc498997057156d4dd1eb6028809a7309ca0447e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 4 11:56:18 2021 +0200

    Bug 27619: Add custom for fr-FR
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 594adf2190ebfab2efe504ae1e8e43df7f204b79
Author: George Veranis <gveranis@dataly.gr>
Date:   Thu Feb 24 16:16:19 2022 +0100

    Bug 20615: Add the link of number of times the authority are used in edit mode
    
    Currently when show an authority record you can see the count of records linked
    with that authority, but when edit that authority record the that detail is
    dissapeared.
    Applying this patch will have that information also on edit mode of authority.
    
    Test plan:
    1) Search for an authority that is already connected with at least one record
    2) On detail view of an authority you can check that authority is linked with
       x records.
    3) Edit that authority and the information about in how many records that
       authority is linked is missing.
    4) Apply this patch
    5) Edit again that authrity and you can find now the count in how many records
       is used that authority
    
    Signed-off-by: Marjorie Barry-Vila <marjorie.barry-vila@collecto.ca>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fa13ec2e9360ce08728644a48165d0eadda9752c
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Apr 11 21:36:16 2022 +0000

    Bug 30510: Add Patron reason column to suggestion tables
    
    To test:
    1. Make some patron reasons for suggestion via Home > Administration > Authorized values > OPAC_SUG
    2. Give those reasons a description.
    3. Make several suggestions via staff client and/or OPAC and apply some of the reasons you just made
    4. Apply patch
    5. Go to Home > Acquistions > Suggestions management
    6. Give some of the suggestions some different status (PENDING/REJECTED/ACCEPTED/ect)
    7. Make sure on each of the tables you can see the column 'Patron reason'
    8. Go to Administration > Table settings and attempt to hide the column.
    9. Confirm that the column is properly hidden on the Suggestions management page
    
    Signed-off-by: Rhonda Kuiper <rkuiper@roundrocktexas.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 350cf44770b6b38e00aa2aed1d9eaf0fcdf45ff4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 10 15:02:12 2022 -1000

    Bug 23352: DBRev 21.12.00.054
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d6b898fd039ff8bd11c8ff55ef921487d64259b4
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Dec 13 16:02:12 2021 +0000

    Bug 23352: Update DBIC schema
    
    Sponsored-By: Brimbank Library, Australia
    
    Signed-off-by: Samu Heiskanen <samu.heiskanen@hypernova.fi>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 68c697f7a2ce5ee942a3a514c5db250582e4d732
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Apr 4 04:22:39 2022 +0000

    Bug 23352: (follow-up) Fix QA test failure
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit add825664dbb5e37da7eb2762868e17966046d48
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Mar 7 04:37:12 2022 +0000

    Bug 23352: (follow-up) Fixes for QA review
    
    Test plan:
    1. Confirm that
    installer/data/mysql/atomicupdate/bug_23352-add_ccode_column_to_subscriptions_table.pl
    has the exec flag
    
    2. Create a subscription. Notice the 'Collection' dropdown defaults to
    the 'None' option - same as Location
    
    3. Save the subscription without changing the 'None' collection
    
    4. Receive the serial and confirm the 'Collection' field is empty
    
    5. Create a second subscription. Change the 'Collection' dropdown to
    'Fiction', then save the subscription
    
    6. Receive the serial and confirm the 'Collection' dropdown is set to
    'Fiction'
    
    7. Confirm that the 'Collection code' terminology in the template is replaced with
    'Collection'
    
    Sponsored-By: Brimbank Library, Australia
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ad6d1265e03cd1dc057e363f40c044d924382230
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Dec 13 15:28:36 2021 +0000

    Bug 23352: Set default collection code when creating subscription
    
    The default collection code set in the subscription will be applied if
    item records are created when receiving the serial.
    
    Test plan:
    1. Apply 3 patches
    2. Run updatedatabase.pl and restart services
    3. Create a subscription:
    - Tick the 'Create an item record when receiving this serial' radio
    button
    - Select values in the Location, Collection code and Item type dropdowns
    - Save the subscription
    4. Confirm the Location, and Collection code default values
    you choose in #3 are displaying in the 'Information' tab of page that's
    loaded
    5. Receive the serial:
    - Click 'Receive'
    - Change the status dropdown from 'Expected' to 'Arrived'
    - Confirm the 'Collection Code', 'Shelving location' and 'Koha item
    type' dropdowns are pre-filled with the values you defined in #3
    6. Run unit test t/db_dependent/Serials.t
    
    Sponsored-By: Brimbank Library, Australia
    
    Signed-off-by: Samu Heiskanen <samu.heiskanen@hypernova.fi>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c196a3437f1a7c5e9d016d0984206ecd4829ecfd
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Dec 13 13:56:38 2021 +0000

    Bug 23352: Database changes
    
    Sponsored-By: Brimbank Library, Australia
    
    Signed-off-by: Samu Heiskanen <samu.heiskanen@hypernova.fi>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ee36d174b8dd3ecd0fbae6402fb34778cec8e6c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 10 14:54:51 2022 -1000

    Bug 28082: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 56aa775602add25b81ba251bb4fb120cbeaddb10
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 21 16:00:47 2022 +0000

    Bug 28082: Add acquisitions toolbar to vendors on vendor search page
    
    This patch makes a number of changes to the vendor search/view template
    in order to make it work better in different contexts:
    
    - Add a vendor-specific toolbar under each vendor search result. This
      gives instant access to the options for a new basket, new contract,
      vendor edit, or to receive shipments. A delete button will appear if
      available.
    - Add a summary of the number of baskets and subscriptions. This helps
      the user know if there are closed baskets and whether an outstanding
      subscription might be blocking the option to delete. Each number is
      linked to the view of those entries.
    - Indicate whether a vendor is inactive. The vendor name appears in a
      different color when it is inactve and is labeled as such.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - To test you should have multiple vendors in your system, some active
      and some inactive. Add some baskets and subscriptions to one or more
      if necessary.
    - Go to Acquisitions and submit an empty vendor search to show all
      vendors.
    - Verify that the page looks correct and that all controls work as
      expected.
    - Open the basket view for a single vendor and compare the two views.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b40d4750290079604cd2a014391e2d81a2e523ee
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Apr 15 14:00:01 2022 +0000

    Bug 30438: Add select all/clear all buttons to invoices.tt
    
    To test:
    1. Apply patch
    2. Have a bunch of invoices, some open and some closed.
    3. Go to Home > Acquisitions > Invoices and do a search that will
       return you many of those invoices, some open and some closed.
    4. Notice the 'Select all' and 'Clear all' buttons.
    5. Try clicking 'Select all' on the Open invoices tab. All Open invoices
       should become checked.
    6. Try clicking 'Clear all' on the Open invoices tab. All open invoices
       should become unchecked.
    7. Try 5 - 6 again but on the Closed invoices tab.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 81ed12df8c1f0f4592ac2f835b83937224ed5699
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 10 14:49:27 2022 -1000

    Bug 30611: DBRev 21.12.00.053
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5f81b5e29e572b78069bbd542c8c51797b00792f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 6 11:45:22 2022 +0100

    Bug 30611: (follow-up) Use constants
    
    Update ternary for token timeout to use perl constants
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b5b3919c04527bb8e2d693fa6d274fcb912b8a6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 6 11:36:15 2022 +0100

    Bug 30611: (QA follow-up) Only show reset option for allowed categories
    
    This patch adds a check that the patron can reach the password reset
    page using category.effective_reset_password which handles fallback to
    OpacResetPassword system preference transparently.
    
    Test plan
    1) Set at least one patron category to dissallow patron password resets
    2) Search for a patron of that category
    3) Confirm the 'Send password reset' option no longer appears
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b5a93edea574ecae1e30d6e7b7969be66b8b3619
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 29 10:42:57 2022 +0100

    Bug 30611: Add ability for staff to send password reset emails
    
    This patch adds the ability for staff with the edit_borrowers permission
    to send password reset emails to users.
    
    The staff initiated password reset has it's own notice,
    STAFF_PASSWORD_RESET, and the reset link produced has an extended
    timeout of 5 days, as apposed to the usual 2 day limit.
    
    Test plan
    1) Apply patch and run the database update
    2) Login to the staff client with a user who has the 'edit_borrowers'
       permission.
    3) Note that a new, 'Send password reset' option appears under the
       'More' menu on the patron details page.
    4) Clicking the button will queue the STAFF_PASSWORD_RESET notice and
       redirect the user to the Notices tab.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e86c1e67362270e365c537b7d93844c94bf27420
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 29 12:14:38 2022 +0100

    Bug 30611: Add STAFF_PASSWORD_RESET notice
    
    This patch adds a new STAFF_PASSWORD_RESET notice template for password
    recoveries initiated via the staff client as aposed for those initiated
    by the end user.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Chmod 755 on atomic update file.
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 032deac223693f449bdf50c411532a5400e91b4f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 10 14:46:04 2022 -1000

    Bug 30290: DBRev 21.12.00.052
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de350e0bf225ebcdf35ec73b1906a2cc4f8cfa24
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Apr 25 10:30:36 2022 +0000

    Bug 30290: (QA follow-up) Sample notices/database update: Change phrasing to Yes/No
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9f37d3bc2d3990fcec96374b1d23e2ee7f4bb27a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 14 13:01:22 2022 +0000

    Bug 30290: (follow-up) Add warning for translated notices
    
    Note: Problem is that we cannot know if default was translated
    or en contains the original notice. Actually this holds for
    the other languages too. So this is an educated guess without
    using the lang field.
    
    Test plan:
    Run db rev.
    Trigger the warning by replacing Pages by PPages in an AR notice.
    Run db rev again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5d96207f2d7996745e34bb5b44980993259b603c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 14 11:54:33 2022 +0000

    Bug 30290: Database revision for existing notices
    
    Note: It will be hard to update translated notices. If we cannot find
    the part 'Pages:' then the replace does not do anything.
    
    Test plan:
    Run db rev.
    Check an existing AR notice (English).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bd0277e7eaf365354e93c5f8aedd8e7bce1e65ec
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 14 11:37:11 2022 +0000

    Bug 30290: Adjust sample_notices.yml
    
    Test plan:
    Run a new install. Check the AR notices.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 68990b9b9a1cc976126009220517ba7da0a2a926
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 9 15:42:44 2022 +0000

    Bug 30722: Typo in overdue recalls template
    
    This patch corrects a typo in the <title> tag of the
    overdue recalls template:
    
    "Circulaion" corrected to "Circulation."
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 50fb8ce0f5f7241a2a4dc4271256776886d18345
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 6 13:31:31 2022 +0000

    Bug 30706: Fix space in check for dateformat preference
    
    This patch fixes the calendar.inc includes in both staff and OPAC in
    order to remove a typo: An extra space in the check for the "dateformat"
    system preference.
    
    The result of this error is that changes to the dateformat system
    preference will not be correctly applied to Koha without a restart.
    
    To reproduce the problem start the process of creating a new patron.
    
     - In the date of birth field, select a date. The format of the date
       inserted should match your current dateformat system preference.
     - Go to Administration -> System preferences and update dateformat to
       something different.
     - Go back to the patron creation form (refresh it if necessary).
     - The hint under the Date of birth field will match your updated system
       preference, but when you pick a date using the calendar widget it
       will still be formatted according to the old value of dateformat.
    
    To test the fix, apply the patch and run through the same steps above.
    A change the dateformat preference should be immediately reflected in
    the functionality of the calendar widget.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 213abbe8193960efeca9348025c8cdc572686daf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 6 20:10:54 2022 +0000

    Bug 30668: Do not record itme location updates in cataloguing log
    
    To test:
    1 - Set a rule in UpdateItemLocationOnCheckin
    2 - Enable cataloguing log
    3 - Check in an item that will trigger a change
    4 - Check the modification log for item - there is a cataloguing entry
    5 - Apply patch
    6 - Repeat
    7 - No log!
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4b9be0e134884cc9e00120d5e1b425b08892d34b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 6 20:09:27 2022 +0000

    Bug 30668: Unit tests
    
    Simple test to cover UpdateNOtForLoanStatusOnCheckin and UpdateItemLocationOnCheckin
    to confirm the cataloguing log does not record these
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 874afc0e53bb345e406286aea6bc00c95c13ccf3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 28 11:07:17 2022 +0000

    Bug 29755: (follow-up) Mock NoIssuesChargeGuarantorsWithGuarantees in test
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f747d38aead414e77e5c367742c9e39a8042f689
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 10 14:30:02 2022 +0000

    Bug 29755: Check each NoIssuesCharge separately
    
    This patch updates SIP patron code to use account methods to calculate balances
    over the patronflags returns. It also checks if patron should be blocked for each
    'No Issues charge' preference
    
    Tests are added for NoIssuesChargeGuarantees
    
    To test:
     1 - Set noissuescharge preference to 5
     2 - Add a $10 charge to a patron
     3 - perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 -l CPL -m patron_information --patron BARCODE
     4 - Note the 64 message starts with Y's that mean patron is blocked
     5 - Set noissuescharge to 11
     6 - Repeat 3, patron is no longer blocked
     7 - Set NoIssuesChargeGuarantees to 8
     8 - Repeat 3, patron is blocked
     9 - Pay $3 on patron so they owe 7
    10 - Repeat 3, patron is not blocked
    11 - Add a child account with patron as guarantor
    12 - Repeat 3, patron is not blocked
    13 - Add a $4 charge to child
    14 - Repeat 3, patron is blocked
    15 - Repeat 3, but with child barcode, child is not blocked
    16 - Set NoIssuesChargeGuarantorsWithGuarantees to 10
    17 - Repeat 3, patron is blocked
    18 - Repeat 3 with child barcode, child is blocked
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a36145eb8db0f1322fa87b8fef676971551932af
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Jan 18 14:36:34 2022 +0100

    Bug 30604: Add value builders for UNIMARC 146 ($a, $h and $i)
    
    Test plan:
    1. Configure the default MARC framework to use those value builders:
       - unimarc_field_146a for 146$a
       - unimarc_field_146h for 146$h
       - unimarc_field_146i for 146$i
    2. Verify that they all work correctly according to
    https://www.ifla.org/files/assets/uca/unimarc_updates/BIBLIOGRAPHIC/u-b_146.pdf
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 541929ea290ac451c15a22766307be77e1cfd01f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 6 07:24:07 2022 +0000

    Bug 30703: Remove a few CookieManager warnings
    
    Running Auth.t produces several warnings like:
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 103.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 104.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 112.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 103.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 104.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 112.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 103.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 104.
    Use of uninitialized value $name in hash element at /usr/share/koha/Koha/CookieManager.pm line 112.
    
    Test plan:
    prove  t/CookieManager.t t/db_dependent/Auth.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 08933d3e0a290e3492891165def858034ffe5577
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 6 07:09:34 2022 +0000

    Bug 30702: Fix Context.pm L785 warning on sessionID
    
    Trivial fix. Before working on bug 29954.
    
    Test plan:
    Run a few tests like t/Context.t, t/db_dependent/Auth.t and
    t/db_dependent/Circulation.t.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7c438c324eb7f420f45c9e140b354ab2d849c6fc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 28 10:04:02 2022 +0000

    Bug 30638: Resolve odd number in hash warn in Letters
    
    Odd number of elements in anonymous hash at C4/Letters.pm line 827.
    
    Trivial fix. Adding undefined check on result to prevent warns
    on that one.
    
    No test plan. Read the patch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 43299fe5cc1c8110112a76ba88e9ab03aaeda43c
Author: Shi Yao Wang <shiyao@inlibro.com>
Date:   Fri Apr 15 12:37:34 2022 -0400

    Bug 30551: Make cash register report take branchcode from cash register
    
    This patch makes it so cash register reports puts branchcode from the
    cash register where the payment was made into "Transaction library"
    column instead of taking the branchcode of the manager.
    
    Test plan:
    1- Use cash registers (administration > system preferences > UseCashRegisters)
    2- Create another library if you only have one (administration > libraries > new library)
    3- Create a cash register in each library if they don't already have one (administration > cash registers > new cash register)
    4- Create a fee on your own account and pay it right after in both libraries.
    5- Go to reports > cash register and generate the statistics.
    6- Notice "transaction library" in both rows are the same even though the fees were paid in two different libraries and two different cash registers.
    7- Apply the patch and click submit to re-generate statistics
    8- Notice it now shows the correct library where the transactions were done
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 21e03340c62f5ed4101e2077600a98af30dd1a01
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Dec 15 11:19:21 2021 -1000

    Bug 29705: In test suite merge IssuingRules with CirculationRules
    
    After Bug 18936, in test suite, there is still t/db_dependent/Koha/IssuingRules.t and t/db_dependent/Koha/IssuingRules/
    This patch moves IssuingRules.t inside CirculationRules.t and renames dir t/db_dependent/Koha/IssuingRules.
    And adds DB transation in each first-level subtest.
    
    Also renames in :
      use constant GUESSED_ITEMTYPES_KEY => 'Koha_IssuingRules_last_guess';
    
    Test plan :
    Run prove t/db_dependent/Koha/CirculationRules.t
    prove t/db_dependent/Koha/CirculationRules/*
    prove t/db_dependent/Circulation/maxsuspensiondays.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1501ff325971a30b516e28b6fe14c2ced58fa2be
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 6 10:22:24 2022 -1000

    Bug 30688: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ee2feeafd6e7beb0a15c32af6bea493aaaa0e0a5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 5 10:47:04 2022 +0000

    Bug 30688: Error in path to CSS background image
    
    This patch corrects the path of an image specified as the background to
    a couple of elements in the OPAC. The incorrect path was causing 404
    errors.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - If necessary, activate one or more cover image services in
      Administration, e.g. OPACAmazonCoverImages, OPACLocalCoverImages,
      and/or OpenLibraryCovers.
    - In the OPAC, locate a bibliographic record which has a cover image
      from one or more of the services you activated.
    - On the detail page for that record, the cover should load correctly.
    - In the browser console you should see no errors related to a file not
      found: /opac-tmpl/bootstrap/img/spinner-small.gif
    - In the browser console, submit this JavaScript snippet:
    
      $(".cover-image").remove();
    
      The cover image should disappear, revealing the "spinner" icon behind
      it.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5e1a1171cbf4996c648a11b88c95dacc2d9eeb83
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 5 14:02:26 2022 +0000

    Bug 30613: Hide RSS feed link when viewing private list in the OPAC
    
    This patch wraps the List RSS icon in a check on whether the list is
    public. Private lists RSS can only be accessed by a logged-in patron.
    
    To test apply the patch and view a public list in the OPAC. You should
    see an RSS link icon next to the list title.
    
    Now log in to the OPAC and view a private list. There should be no RSS
    link.
    
    Note the QA tool warning about the aria-hidden attribute is a false
    positive. The parent element has a label.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b63f6d95f7eadba6aa7cbf44b130755c5b2ea7af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 28 14:42:04 2022 +0200

    Bug 30639: Split search terms for patron search
    
    If several terms are passed we should split them.
    
    Test plan:
    Search for "edna acosta" (without quotes) in the filters from the left
    side of the main patron search
    Do some regression tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8fa77733366d2b956608f5459076a668f8c38654
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 27 13:52:55 2022 +0200

    Bug 30607: Don't overload our default initComplete
    
    We want to keep the default initComplete call to add/remove the
    'disabled' class on the 'Clear filters' link.
    
    Test plan:
    Search for patrons, add something to the general DT search and confirm
    that the 'Clear filters' link can be clicked (ie. is not disabled) when
    the input field is not empty.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Agree that it does not look very elegant.
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bda0b1fd03e235bce70759010f6115862900e409
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 12 14:23:42 2022 +0000

    Bug 30514: Error in date format check following datepicker removal
    
    This patch corrects the is_valid_date function in the OPAC and staff
    interface so that it work correctly with Flatpickr.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - In the staff client, locate a bibliographic record and edit its items.
    - Test that the "Date acquired" date picker works correctly and that
      there are no errors in the browser console.
    - Test other date input fields to check that they still work, e.g.
      specify due date during checkout; Catalog statistics wizard; Patron
      entry/modification, etc.
    - Perform similar tests in the OPAC: Hold suspension; Update your
      personal details.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cbc3b19cdb8d993b555fe831faf5b039b44160e8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 6 12:05:12 2022 +0000

    Bug 30709: 'Insert' button in notices editor not adding selected placeholders to notice
    
    This patch updates letter.js so that it uses .prop("selected") to look
    for selected <option>s instead of .attr("selected"). This is necessary
    because of the jQuery upgrade.
    
    To test, apply the patch and edit any notice. Test that you can select
    one or more database columns and insert them into the body of a notice
    by clicking "Insert." Confirm that your selections are inserted where
    you left the cursor in the message textarea.
    
    Test with multiple message transports and with multiple languages
    installed (with TranslateNotices enabled).
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0d196ae7fb0f2b977e9986eb58c8081f61808178
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 27 16:44:53 2022 +0200

    Bug 30622: Patron search when placing hold should redirect if cardnumber is entered
    
    When search a patron for placing a hold, if a cardnumber is entered we
    should pick the patron and use it, instead of display the table result.
    
    This was a regression caused by bug 30063.
    
    Test plan:
    - Place a hold on anything in staff
    - Search for 42 or any other existing cardnumber in your database
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3aaf10e59ff44c8c8dbef6dcd5f28aba2fb8d2d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 26 10:09:04 2022 -0300

    Bug 29926: (QA follow-up) Date format missing in spec
    
    On fixing the spec to have `format: date` I noticed the tests were
    expecting explosions because of date handling not being done. The
    OpenAPI plugin does this correctly when you set the format right.
    
    So, I adapted the tests so they expect 400 and return the type error.
    
    We don't usually add such tests (i.e. test the plugin does its job
    correctly) but it doesn't hurt to keep them just in case something
    really changes badly there (plugin bug?).
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b97bf747e9bfbc590bfa43abb921d8cb4b29225a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 26 09:52:21 2022 -0300

    Bug 29926: (QA follow-up) API design fixes
    
    This patch makes the following changes to the spec:
    
    * Password being the resource and expiration_date an attribute for it,
      so reorganizing things and also renaming the route.
    * Be it undefined or defined, expiration date is only one and thus
      should use the PUT verb (as in overwrite).
    * Minor bug 30194-related fixes.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 60c8534b8d84772b42f8b366df57aed72fc7ffc4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Feb 14 16:34:23 2022 +0000

    Bug 29926: Add ability for superlibrarians to batch edit password expiration dates
    
    To test:
    1 - Sign in as a superlibrarian
    2 - Tools->Batch patron modification
    3 - Add patrons with and without pasword expiration set
    4 - Confirm dates display correctly on modification page, or show never
    5 - Check the box to delete all dates
    6 - Confirm patrons now show 'Never'
    7 - Edit patrons again, set a date
    8 - Confirm date is set correctly
    9 - Sign in as a user with catalogue/tools/borrowers permissions, but not superlibrarian
    10 - Confirm y9ou do not see, and cannnot edit password expiration dates
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6ae0b3c76c418a3b8ca90d7ff7b87e839a25a2af
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Feb 14 16:01:07 2022 +0000

    Bug 29926: Add ability for superlibrarian to view/edit password expiration
    
    To  test:
     1 - Sign in as a superlibrarian
     2 - Find a patron account with no password expiration set
     3 - View member detials
     4 - note expiration says 'Never'
     5 - Edit patron
     6 - Set patron expiration
     7- Save
     8 - View details, confirm password expiration shows correctly
     9 - Sign in as non-superlibrarian
    10 - Confirm you don't see expirationdate on details page
    11 - Edit patron and confirm password expiration does not show
    12 - Edit HTML and confirm you epxiration date not saved
         <input type="text" name="password_expiration_date" value="2052-05-02">
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e18e1d9e9db451534fe877e2109b0fd136611274
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Feb 14 16:00:23 2022 +0000

    Bug 29926: Add pasword expiration route for API
    
    To test:
    1 - prove -v t/db_dependent/api/v1/patrons_password_expiration.t
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c423c9159d0b4d16d884d78fd3ed4dca1e04ef86
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 6 09:50:14 2022 -1000

    Bug 29925: (follow-up) Add new pref in sysprefs.sql
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 36e60f52acefe2768f7237ba7ca49b59180f10b9
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 6 09:49:42 2022 -1000

    Bug 29925: DBRev 21.12.00.051
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c7d37248a62e269c5a539cecae48c45b14d5bc49
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 10 12:20:20 2022 +0000

    Bug 29925: (follow-up) Allow password reset when OpacPublic not set
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e941dfdc9974bc6d1eb44134d0e00f5e6f120105
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 26 12:10:49 2022 +0000

    Bug 29925: Add a password reset page for expired passwords
    
    This patch adds a new page opac-reset-password where a user cna enter their login
    (userid or carndumber), current password, and new password.
    
    If the user has a password expiration date and the current password is correct and
    the new passwords match and meet requirements their password will be updated and the
    expiration date reset
    
    A patron whose password does not expire will be reidrected to login to change their password
    
    To test:
     1 - Apply patch, updatedatabase, enable new syspref EnableExpiredPasswordReset
     2 - Set 'Password expiration' for a patron category
         Home->Administration->Patron categories->Edit
     3 - Create a new patron in this category with a userid/password set, and an email
     4 - Update the patron with an expiration to be expired
         UPDATE borrowers SET password_expiration='2022-01-01' WHERE borrowernumber=51;
     5 - Give the borrower catalogue permission
     6 - Attempt to log in to Straff interface
     7 - Confirm you are signed out and notified that password must be reset
     8 - Click 'Reset your password' link
     9 - You should see the reset password page with fields for: login, current password, new password, conmfirm password
    10 - enter invalid/incomplete credentials
    11 - Confirm you are notified of invlaid credentials
    12 - Fill in all fields, but enter current password as new password
    13 - Confirm you are notified of no change
    14 - Set minimum password length / strong password requirement for category
    15 - Confirm you receive error if new password too short or not secure
    16 - Enter a valid new password and submit and confirm update is successful
    17 - Confirm you have buttons to go to OPAC or Staff and that both work
    18 - Confirm you cna log in (i.e. expiration has been reset)
    19 - Expire the users password
    20 - Remove catalogue permission
    21 - Reset password again and confirm only OPAC link
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9c55003cc31e2b8205c38d23bcc512570f63aa0e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 6 09:41:52 2022 -1000

    Bug 29924: (follow-up) Fix t/db_dependent/Koha/Patron.t number of tests
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e45aef832a8d2685028b140d8e768a551745e352
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 6 09:36:48 2022 -1000

    Bug 29924: DBRev 21.12.00.050
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b50a88dfcc2e5cf4f1e727480a4ca6990ff1a34b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 6 09:34:26 2022 -1000

    Bug 29924: Update DBIC schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6fba85d23bf419516111ff959bb5ab7c67ee6414
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 26 15:03:05 2022 -0300

    Bug 29924: Avoid leaking information on wrong credentials
    
    If the passed credentials are wrong, we shouldn't expose things like the
    password is expired.
    
    This patch takes care of that.
    
    To test:
    1. Have a known patron with password_expiration_date set so its
       password is expired. Can be done like:
       $ koha-mysql kohadev
       > UPDATE borrowers \
         SET password_expiration_date='2022-04-25' \
         WHERE borrowernumber=132;
       Note: change the borrowernumber
    2. Attempt to login to the OPAC with wrong credentials
    => SUCCESS: You are rejected, with a message telling credentials are
                wrong
    => FAIL: You are told the password is expired.
    3. Apply this patch and restart Plack
    4. Repeat 2
    => SUCCESS: You are rejected, credentials are wrong and no mention to
                password being expired.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4e2cfbe75ec350e1985c0af51a40bf152a69e44e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 25 11:05:15 2022 -0300

    Bug 29924: Add tests for API Basic auth behavior
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5ca99ca59413d99745dee5ef1044b9af7373d351
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 25 10:43:00 2022 -0300

    Bug 29924: (QA follow-up) Remove password_expiration_date from API
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9047dfce55c325b495ae883d7a41721706f22ef3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 23 15:58:30 2022 +0000

    Bug 29924: Update ILSDI to be aware of expired passwords
    
    To test:
    1 - Enable ILSDI
    2 - Set a patron password with expired password
    3 - http://localhost:8080/cgi-bin/koha/ilsdi.pl?service=AuthenticatePatron&username=usernam&password=password
    4 - Confirm 'PasswordExpired' returned
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7709b2cddf1540bf5a6053a07dec012ad8dc2512
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 25 18:45:17 2022 +0000

    Bug 29924: (follow-up) Add default value undef for TestBuilder
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ef58458ad4aee3eb59bd9bd2028ba1af6f794b63
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 11 13:34:37 2022 +0000

    Bug 29924: (follow-up) Add password_expiration_date to API
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9b35c642e2a60fe7d20da5beac357885b726ddfb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 25 15:08:39 2022 +0000

    Bug 29924: (follow-up) Add bug number to atomicupdate; Style OPAC message
    
    - The atomicupdate didn't have "bug_number" defined.
    - The "Your password has expired" message is now styled with the same
      class as other OPAC login messages.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f1d703193b7971688591b5f5037c0652e61af27e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 21 17:11:39 2022 +0000

    Bug 29924: Unit tests
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a732138d9d41438c430f0231d001b4d1087286e8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 21 17:01:10 2022 +0000

    Bug 29924: Add password expiration feature
    
    This patch adds the ability to define password_expiry_days for a patron
    category.
    
    When defined a patron's password will expire after X days and they will
    be required to reset their password. If OPAC resets are enabled for the
    catgeory they may do so on their own, otherwise they will need to
    contact the library
    
    To test:
     1 - Apply patch, updatedatabase
     2 - Set 'Password expiration' for a patron category
         Home-> Administration-> Patron categories-> Edit
     3 - Create a new patron in this category with a userid/password set,
         and an email
     4 - Confirm their password_expiration_date field is set
         SELECT password_expiration_date FROM borrowers WHERE borrowernumber=51;
     5 - Create a new patron, do not set a password
     6 - Confirm their password_expiration_date field is NULL
     7 - Update the patron with an expiration to be expired
         UPDATE borrowers SET password_expiration_date='2022-01-01' WHERE borrowernumber=51;
     8 - Give the borrower catalogue permission
     9 - Attempt to log in to Straff interface
    10 - Confirm you are signed out and notified that password must be
         reset
    11 - Attempt to sign in to OPAC
    12 - Confirm you are signed out and notified password must be reset
    13 - Enable password reset for the patron's category and perform a
         password reset
         Note: you will have to find the link in the message_queue unless
         you have emails setup on your test environment
         SELECT * FROM message_queue WHERE borrowernumber=51;
    14 - Confirm that you can now sign in and password_expiration_date field
         is set 10 days in the future
    15 - Expire the patron's password again
    16 - Change the patron's password via the staff interface
    17 - Confirm they can sign in and the expiration is updated
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 49a39307e0b156ca3681aa382bbf28f5082b3157
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 21 16:59:41 2022 +0000

    Bug 29924: Database updates
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Bob Bennhoff <bbennhoff@clicweb.org>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 578da5f21f6a3f396dfb7cabbd301f114b034170
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 6 09:20:07 2022 -1000

    Bug 30563: DBRev 21.12.00.049
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a526289c7c5d4da9b1de89858d1967f176503437
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Apr 26 12:06:59 2022 +0000

    Bug 30563: (QA follow-up) Fix system preference values and add link to description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d6da5d6197ffb9b102f8f9d6b72bc3939ba5e67e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Apr 25 16:37:08 2022 +0000

    Bug 30563: (QA follow-up) Fix permission on atomicupdate file
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d8163c0fc5f2ad3045e49ec6f4289296ce5aec8a
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 15 10:01:00 2022 +0200

    Bug 30563: Add syspref to make the "cash register" field mandatory
    
    Test plan:
    1. Apply patch and run updatedatabase
    2. Enable 'UseCashRegisters' syspref and create at least one cash
       register for your library
    3. Verify that you have several authorized values in the 'PAYMENT_TYPE'
       category. One of them should be 'CASH'
    4. Go to a patron accounting tab, create a manual invoice and go to the
       payment form. Select payment type 'CASH' and verify that you cannot
       submit the form if no cash register is selected.
       Select another payment type and verify that you can submit the form
       even if no cash register is selected
    5. Set syspref 'RequireCashRegister' to 'always require a cash register'
    6. Repeat step 4 but this time you should not be able to submit the form
       if no cash register is selected, no matter which payment type is
       selected.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5d50e736528c11a35a9270e8946f8a7442483198
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 6 14:36:07 2022 +0000

    Bug 30467: (QA follow-up) Fix copy paste error to update updated_biblionumbers
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 62277d70966c8669b7c8e77ee1890f274b5c6517
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 6 08:10:04 2022 +0100

    Bug 30467: (QA follow-up) Restore indexing for item only deletion
    
    This patch restores indexing for item only bulk deletions.
    
    JD amended patch:
    * remove trailing whitespaces
    * Move if inside first condition
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1c7fd5a58897f51f2559dfe22fd2a0e8a13186de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 14:11:03 2022 +0200

    Bug 30467: Don't send the delete request for each item
    
    We are sending the request when all the items have been deleted.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 97e70e726b0868a09e0dd2cda9c6881ef8ec974b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 6 09:37:23 2022 +0200

    Bug 30465: Fix Koha/Items/BatchUpdate.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 56d690d67d471b9bea8386b3e2f228fb3745ffc5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri May 6 06:32:51 2022 +0000

    Bug 28998: (follow-up) Adjust the Auth.t fix
    
    Move the encode_secret call where we need it (when pref is enabled
    and patron switches to 2FA).
    Mock the koha-conf encryption_key.
    Disable 2FA when exiting subtest.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 145b7bf4b32c6898e656070187791346bb742c37
Author: Ava Li <rubyli208@gmail.com>
Date:   Wed Jan 20 02:11:40 2021 +0000

    Bug 27470: Improved link text for shibboleth login
    
    TEST PLAN:
    1) Enable shibboleth by adding shibboleth to koha-conf.xml, you can do
       this by following
    
       https://wiki.koha-community.org/wiki/Shibboleth_Configuration#Using_AD_FS_Metadata
    
    2) If you are logged in Koha, log out, on the login screen the text
       at the top should say the following, "Log in using a Shibboleth
       account"
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d1a590dd5b15fdd46b3f051ab5e74f3a22dde7f3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 25 09:19:06 2022 -0300

    Bug 29936: (follow-up) Remove useless warining
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e614c68d727a0d2bcabac80ffa0586dff8e364d0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 10 13:53:17 2022 +0000

    Bug 29936: Add holds_get_captured option to sip config
    
    This patch adds a new option to the SIP config, allowing for hold
    capture to be disabled on difference devices. We still notice the hold
    and alert the user, but we do not trigger the update in the system to
    mark the hold as found (waiting, processing or in transit).
    
    Sponsored-by: Cheshire Libraries Shared Services
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9032c41575597ef7870f0af7a7afd1f40f4e2bfb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 10 13:51:58 2022 +0000

    Bug 29936: Add unit tests
    
    This patch adds a unit test for the new functionality introduced with
    holds_get_captured allowing for holds to still be highlighted to patrons
    at checkin but not mark them as found/transfered in the system.
    
    Sponsored-by: Cheshire Libraries Shared Services
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c3116b27297308fead2658b1811a0d44b121a789
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 24 15:31:05 2022 +0000

    Bug 30354: Don't assign warn as letter
    
    TO test:
    1 - Check out an item marked for autop renewal to a patron and make it overdue
    2 - Set system preference AutoRenewalNotices to follow messaging prefs
    3 - set that borrower to receive both email and SMS AUTO_RENEWALS_DGST
    4 - confirm your AUTO_RENEWALS_DGST does not have SMS content but does have email
    5 - run the auto_renew cron
    6 - item is renewed, but error from cron, and cron dies:
    
    No circulation AUTO_RENEWALS_DGST letter transported by sms at /kohadevbox/koha/C4/Letters.pm line 583.
    no letter of type 'AUTO_RENEWALS_DGST' found for borrowernumber 5. Please see sample_notices.sql at misc/cronjobs/automatic_renewals.pl line 305.
    Can't use string ("1") as a HASH ref while "strict refs" in use at /kohadevbox/koha/C4/Letters.pm line 898.
    
    7 - Apply patch
    8 - Make item eligible for auto renewal agian (or checkin/checkout)
    9 - Run the cron
    10 - There is still 2 warn, but cron does not die:
    
    No circulation AUTO_RENEWALS_DGST letter transported by sms at /kohadevbox/koha/C4/Letters.pm line 583.
    no letter of type 'AUTO_RENEWALS_DGST' found for borrowernumber 5. Please see sample_notices.sql at misc/cronjobs/    automatic_renewals.pl line 305.
    
    11 - Patron receives email and item is renewed
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 734a02cf823d55a1f14ae6da2f8e371e66cd810d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 11:38:27 2022 +0200

    Bug 30465: Make BatchUpdateBiblio update the index in one request
    
    When using the batch record modification tool to modify several
    bibliographic records, we don't want to send one index request per
    biblio, we want to index them all on the fly after the records have been
    modified.
    Otherwise we will end up with one task per record, and records will be
    indexed in background.
    
    Test plan:
    Use the batch mod tool to modify bibliographic records and confirm the
    behaviour is correct.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c04782e1cc9c2083d67c9cbcfe47a74e4a9b57af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 13:45:21 2022 +0200

    Bug 30464: Make BatchUpdateAuthority update the index in one request
    
    Same as bug 30465 for authorities
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 471850e4951d17448c1ae370de30b831b4763b25
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 13:20:12 2022 +0200

    Bug 30460: Make BatchDeleteBiblio update the index in one request
    
    No need to send 1 indexation request per item + 1 per biblio.
    
    Test plan:
    Confirm that the batch biblio deletion tool still works correctly
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9dc00051c72d8caa60e2acfd415a57940649f306
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 13:52:40 2022 +0200

    Bug 30459: Make BatchDeleteAuthority update the index in one request
    
    Same as bug 30460 for authorities
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c1d036e8f972dddfbea3e594b2744bf844fd84f0
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu May 5 09:56:39 2022 -1000

    Bug 30291: DBRev 21.12.00.048
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d821750b7cceb962801563cb3b3b073301f19326
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Mar 28 22:10:40 2022 +1300

    Bug 30291: Update DBIC schema
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c8805b3b5bc7454cdad048897177fb48785fe98c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 5 11:14:44 2022 +0100

    Bug 30291: (QA follow-up) Fix for revert to recall_id
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0abbab6e4b32dee231c366d900c391b9cb846958
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 29 08:13:17 2022 -0300

    Bug 30291: (QA follow-up) Keep recall_id column name
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 56f85dc5a2c89e0e7098a28e3d937a94893dab1c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 29 08:02:17 2022 -0300

    Bug 30291: Fix permissions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 39c010a87a4a969bede8cfd950552a0a606ac110
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Mar 29 01:00:55 2022 +1300

    Bug 30291: Changes to OPAC files
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 674e385bf10903e6242bafe20a4af3d659111ee1
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Mar 29 01:00:27 2022 +1300

    Bug 30291: Changes to staff client files
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 50d917dbfcfaf113e4bc479c33ea18de97414bfa
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Mar 29 00:59:18 2022 +1300

    Bug 30291: Changes to controller scripts
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d352c8e619fc0ff43b762353609701a7ac432165
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Mar 29 00:57:59 2022 +1300

    Bug 30291: Changes to tests
    
    t/db_dependent/Circulation.t
    t/db_dependent/Circulation/CalcFine.t
    t/db_dependent/Circulation/transferbook.t
    t/db_dependent/Holds.t
    t/db_dependent/Koha/Biblio.t
    t/db_dependent/Koha/Item.t
    t/db_dependent/Koha/Patron.t
    t/db_dependent/Koha/Recall.t
    t/db_dependent/Koha/Recalls.t
    t/db_dependent/XSLT.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f0d1fd45a332d5ed446f5e021fa010f093ca0cf0
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Mar 28 22:12:09 2022 +1300

    Bug 30291: Update boolean flags in Recall schema file
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9adbef062486a6c141e3da426eb1f9a54b50c9d5
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Mar 28 22:10:14 2022 +1300

    Bug 30291: Database changes to recalls table
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c0f3f2141648d72ae49b5f407d82b9220cc06acc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 29 00:56:25 2022 +0000

    Bug 29346: (follow-up) Build holds queue when AlterPriority or RevertWaitingStatus is called
    
    To test:
    1 - Place 3 holds on a bib with a single item
    2 - Confirm bib shows in holds queue
    3 - Check in item and cnofirm hold
    4 - Bib is no longer in queue
    5 - Revert the waiting status
    6 - The hold is in the queue again
    7 - Move top hold to bottom
    8 - Confirm queue selects hold for new top priorty patron
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 56602217ff5c4ad603e57e5b29d4fefe4922447a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 29 00:28:33 2022 +0000

    Bug 29346: Use fully qualified names for C4:Circulation routines in C4::HoldsQueue
    
    I suppose this is similar to circular dependency on other patch
    
    HoldsQueue uses Circulation uses BatchUpdateBiblioHoldsQueueuse HoldsQueue
    
    Without this the background job builds the queue, but reports failure:
    Holds queue for biblio The Jacobite clans of the Great Glen, 1650-1784 /. An error occurred (Undefined subroutine &C4::HoldsQueue::GetTransfers called at /kohadevbox/koha/C4/HoldsQueue.pm line 351. )
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d655d41e5848d02aab6f0f1174399f3fd3d183a8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 28 10:59:22 2022 -0300

    Bug 29346: Remove unused circular dependency on C4::Search
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4708933800fde69a853b59cf57f4f171ac2eef4a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 28 10:57:04 2022 -0300

    Bug 29346: Add better reporting
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit db49180e1d4b2d0c4c3f06291b0a432ae7706b11
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 28 12:12:34 2022 +0000

    Bug 29346: (follow-up) Fix typo 'availabe'
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4a6cec6d0f3fe41be3205934a84f059ea061ae44
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 28 12:04:40 2022 +0000

    Bug 29346: (QA follow-up) Rebuild queue when adjusting priorities of holds
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 763d73fbf0a774da3dfece55304a973b988c2089
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 26 16:28:22 2022 -0300

    Bug 29346: Add more fine-grained control of holds queue updates
    
    This patch deals with the fact that high-level circualtion methods like
    `AddIssue`, `AddReturn` and `ModDateLastSeen` all eventually call
    lower-level methods like ModBiblio, Koha::Item->store of
    UpdateTotalIssues which are expected to trigger holds queue updates (for
    the object CRUD operations use cases). As the circulation methods need
    to trigger holds queue update as well, duplicate updates were being
    requested which is suboptimal, of course.
    
    In order to prevent this, and because circulation methdos could trigger
    holds queue updates several times, actually, I added a new parameter
    *skip_holds_queue* to the low-level methods, so when they are called
    from circulation, the trigger is skipped and we have greater control on
    when and how holds queue updates are scheduled.
    
    This patch introduces the `skip_holds_queue` parameter to the following
    methods:
    
    * C4::Biblio::ModBiblio
    * C4::Biblio::UpdateTotalIssues
    * Koha::Item->store
    
    Calls to those methods from the following methods will include the new
    parameter, and thus duplicated holds queue updates avoided:
    
    * C4::Circulation::AddIssue
    * C4::Circulation::AddReturn
    * C4::Items::ModDateLastSeen
    
    Tests are added, to verify that the (mocked) BatchUpdateBiblioHoldsQueue
    task is only scheduled once when they are called.
    
    To test:
    1. Apply up to the previous patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Biblio.t \
               t/db_dependent/Biblio_holdsqueue.t \
               t/db_dependent/Circulation_holdsqueue.t
    => FAIL: Tests fail!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 48a1381554a878421512d10217ed534f71479fe1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 26 16:28:14 2022 -0300

    Bug 29346: Avoid duplicate actions tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ad66e214bdbe26c4aad45509808eeb164546cbea
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 17:20:11 2022 +0100

    Bug 29346: Highlight double enqueue
    
    This patch highlights a possible issue with the triggers.. though it may
    not actually matter in reality.
    
    I appear to already see test failures before this patch with a double
    enqueue of the rebuild for both AddIssue and AddReturn.. I couldn't spot
    what was causing that but whilst digging I did find another case where
    it could happen as highlighted here...
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9a7fdade8bc3443e8e7779815878dbe235babaf3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 16:49:42 2022 +0100

    Bug 29346: (follow-up) Fix typo
    
    We set biblio_ids in enqueue then referred to biblio_id in process ;)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1646d8be3eec18c970e65e6c66faee237d38eeaa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 23 12:36:32 2022 -0300

    Bug 29346: Item action trigger
    
    This patch makes the following actions trigger a holds queue rebuild for
    the related biblio:
    
    - Adding an item
    - Updating an item
    - Deleting an item
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Item.t
    => SUCCESS: Tests pass! Background job scheduled
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a6d501ad8a9e7f58f7a1d782715f1e8bacab291d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 23 11:22:52 2022 -0300

    Bug 29346: Biblio actions triggers
    
    This patch adds the trigger for the holds queue update on teh following
    methods:
    
    - C4::Biblio::DelBiblio
    - C4::Biblio::ModBiblio
    
    The ModBiblio use case could be improved by checking if itemtype is one
    of the updated attributes... but it felt there was no way to do it
    without some overhead. So I leave it as-is.
    
    It also mocks the ->enqueue method in the tests that call DelBiblio and
    ModBiblio to avoid breakages [1]
    
    Tests are added to check the trigger is called.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Biblio.t
    => SUCCESS: Tests pass! It means the trigger is triggered :-D
    3. Sign off :-D
    
    [1] This breakages could be avoided if we solve Koha/BackgrounJob.pm:101
    FIXME.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 90b76521bf211d2986680c4e0dc35091b5ca6f87
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 16 18:05:55 2022 -0300

    Bug 29346: Circulation actions triggers
    
    This patch introduces triggers for real-time updating the holds queue at
    check out and check in.
    
    The following high-level methods are involved:
    
    - C4::Circulation::AddIssue
    - C4::Circulation::AddReturn
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Circulation_holdsqueue.t
    => SUCCESS: Tests pass! Triggers are triggered
    3. Sign off :-D
    
    Note: I put the tests on a separate file because the other one was too
    big already.
    
    Sponsored-by: Montgomery County Public Libraries
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b09d93b4e9bf2a3f44080c25d34431f4ca2ed8bf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 16 17:22:28 2022 -0300

    Bug 29346: Hold actions triggers
    
    This patch makes several holds related actions schedule the background
    job for real-time update of the holds queue.
    
    This actions are:
    
    - place (C4::Reserves::AddReserve)
    - fill (Koha::Hold->fill)
    - cancel (Koha::Hold->cancel)
    - suspend (Koha::Hold->suspend)
    - resume (Koha::Hold->resume)
    
    The cancel() action is added a *skip_holds_queue* parameter to skip
    triggering the background job entirely. It targets cases like
    C4::Biblio::DelBiblio in which all biblio holds are cancelled in a loop.
    In that case, we just want to cancel them and let a single backgroung
    job take care of the holds queue, once the biblio is deleted.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t \
               t/db_dependent/Reserves.t
    => SUCCESS: Tests pass! Triggers are triggered
    3. Sign off :-D
    
    Sponsored-by: Montgomery County Public Libraries
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 830dfab5487e97dec94fdb6591245d31e54a15ee
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 24 08:46:20 2022 -0300

    Bug 29346: Add holds queue update background job
    
    This patch adds a background job that takes care of updating the holds
    queue rows for a given list of biblios.
    
    It is designed to be used for real-time batch updating the holds queue
    when required. Tasks would be added by the relevant methods under the
    right use cases.
    
    Sponsored-by: Montgomery County Public Libraries
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 210c686f7bfc2fd4dc11bdd5fcd582eb9f8f4500
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 24 08:01:53 2022 -0300

    Bug 29346: Refactor loop code into a subroutine
    
    The CreateQueue() method deletes the holds queue data, fetches some
    configuration (branches to use, transport cost matrix) and then loops
    through a list of biblionumbers, generating the tmp_holdsqueue and
    hold_fill_targets rows for the specified biblio.
    
    This patch simply moves that last bit that is run inside the biblios
    loop into a separate sub.
    
    The update_queue_for_biblio sub is designed so it does the exact same
    thing it did inside the loop, but also gets added the capability of
    querying those parameters if not passed, and it also gets a 'delete'
    parameter so it deletes the biblio-specific holds queue rows before
    starting to work.
    
    This way, it can be reused to write a background job for real-time holds
    queue update :-D
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/HoldsQueue.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass! Behavior is kept!
    4. Sign off :-D
    
    Sponsored-by: Montgomery County Public Libraries
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1b230335e7560250072f4880f745636f62fefe74
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 4 14:31:37 2022 -1000

    Bug 30600: Update DBIC schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4e9d8bb29702544d08c217501484f1d796442065
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 5 17:12:29 2022 +0100

    Bug 30572: (QA follow-up) Fix failing unit test
    
    We changed from 'null' being meainingful to using a tinyint and
    explicitly requiring '0'.  This patch simply updates the unit test to
    reflect that change.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit bb74a50fbd1f3c7db272026a72d27a67d611806a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 5 11:07:11 2022 -0300

    Bug 30692: Fix progress for ES indexing tasks
    
    This patch makes the ES indexing task record progress properly.
    
    To test:
    1. Have ES setup
    2. Edit a record making any change that would trigger indexing
    3. Go to Administration > Background jobs
    => FAIL: The task status is 'Finished' but progress shows '0/1'.
    4. Apply this patch
    5. Restart the default worker:
       $ koha-worker --restart kohadev
    6. Repeat 2 and 3
    => SUCCESS: Things work the same, but progress is '1/1'
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 815ed51621ea380dce4bf8322c8734b9997ebbe5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 5 10:53:12 2022 +0200

    Bug 30360: Make UpdateElasticIndex use the helper methods
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit b13b4aaa4fd418c8bd708e513e6daa42d7187825
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Apr 5 00:30:59 2022 +0200

    Bug 30360: Add methods for dealing with the JSON payload
    
    This patch adds high-level methods to handle the JSON payload
    (de)serialization as needed. This allows devs implementing background
    jobs to abstract themselves from the internals of the jobs handling.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/BackgroundJob.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 38fdd82d27f80d8265f97292b3e397f097281b04
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 25 11:52:39 2022 -0300

    Bug 30360: Add helper methods to Koha::BackgroundJobs
    
    This patch adds some helper methods to ease writing background jobs, and
    also making it more consistent/solid.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/BackgroundJob.t
    => SUCCESS: Tests pass. The methods have the expected behaviour.
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit f6a0eb3a2a201c9ddb07b626653563faebe4434d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 5 14:21:19 2022 +0000

    Bug 30693: Javascript broken on request.pl
    
    The holds page in the staff interface has some JavaScript relating to
    Bootstrap tabs, but the tabs are not always present on the page. This
    leads to a JS error after you have selected the patron for the hold.
    
    This patch adds a check for the tabs container element before executing
    the code.
    
    To test, apply the patch and locate a bibliographic record on which to
    place a hold.
    
    - On the initial holds screen should see tabs for "Patrons" and "Clubs."
      Both should work correctly.
    - Select a patron to place the hold for.
    - On the page where you enter hold details (pickup library, hold
      expiration, etc.) there should be no JavaScript error in the console.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 63d324db28f0cdcbacddb21a2e1ff1aada1f939e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 3 15:04:54 2022 -0300

    Bug 30674: x-koha-override should use collectionFormat: csv
    
    This patch makes this header parameter rely on the OpenAPI spec to
    validate and document the available options.
    
    Right now the only place is in POST and PUT /holds.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t \
               t/db_dependent/api/v1/auth_authenticate_api_request.t
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit c9f6ea43747f7914e1abe96c22e0f68de60e50a0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 3 11:23:23 2022 -0300

    Bug 30663: Implement overrides handling in POST /suggestions
    
    This patch implements the override checks in the controller as expected
    by the previous patch.
    
    To test:
    1. Apply this bug patches up to 'Add x-koha-override options...'
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/suggestions.t
    => FAIL: Tests fail! The controller doesn't care about overrides or
             sysprefs about suggestions limits.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Things work!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 9374824bc5d33109753931401c269e51fe21acf8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 3 11:20:46 2022 -0300

    Bug 30663: Add x-koha-override options to /suggestions
    
    This patch adds the x-koha-override header parameter to the route that
    is used to create suggestions, POST /suggestions.
    
    The idea is that adding suggestions will be rejected under certain
    conditions unless x-koha-override is passed with appropriate values. The
    added overrides are:
    
    * any
    * max_total
    * max_pending
    
    Tests are added for the expected behavior.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit cec899902e9543913e229c9c6773c234814d9ccf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 3 11:18:10 2022 -0300

    Bug 30663: Add Koha::Suggestions helper methods
    
    This patch adds the following helper methods:
    
    * filter_by_pending
    * filter_by_suggested_days_range
    
    This methods follow basically what's done in opac-suggestions.pl
    I chose 'pending' as opposed to 'open' to follow what we use in the UI
    which might be the case because of being more accurate for end users.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Suggestions.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 10138c1a10efa5eda39af00a9ded1f1b95d23225
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 5 13:11:32 2022 +0100

    Bug 29616: (QA follow-up) Use /public endpoints on OPAC
    
    This patch updates the new modal to use the /public version of the
    libraries endpoint for fetching library data. This ensure the feature
    works as expected prior to patron login.

commit 79f57cf303924ef96b8b55169e0290ef15dd3835
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 5 08:39:50 2022 -0300

    Bug 28998: (QA follow-up) Silence some useless warnings
    
    This patch fixes the tests and also silences some useless warnings about
    REMOTE_ADDRESS not being defined.
    
    A test is added for a legit warning that is thrown.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 8160b794c25361da1abcd74de816699633b92521
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu May 5 13:28:19 2022 +0200

    Bug 28998: Fix Auth.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit cd1c32fc1609de4d53edc738c4235e9a06ce712d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 21 11:12:58 2022 +0000

    Bug 30577: Fix a missing closing tag
    
    This didn't affect table display, but when there was a biblioloo.warn
    we were not closing the first <td> tag
    
    Confirm multi-holds table loads correctly when one (or more) records cannot be held
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e61c8356954d231a322c82dba0cfbca5c9ce8a56
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 21 11:02:54 2022 +0000

    Bug 30577: Move item specific pickup locations to the left
    
    When placing holds, staff will set the pickup location at the top,
    choose an item, then place the hold.
    It is easy not to notice the item specific locations dropdown.
    
    This patch moves it in line with the other selction areas on the request screen.
    
    To test:
     1 - Find a record on staff client, place hold
     2 - Select a patron to load the request screen
     3 - Note the location dropdown for next available hold
     4 - Note the item specific locations on the far right
     5 - Apply patch
     6 - Reload the page
     7 - Note the item specific location dropdowns are now moved to the left
     8 - Place the hold, verify it works with the dropdowns
     9 - Verify title levelholds still work as expected
    10 - Verify multi-holds still work
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0f7949de1ce3268d727f78b393fad74419e9c21e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 6 18:00:14 2022 +0000

    Bug 30475: Convert tools pages tabs to Bootstrap (part 2)
    
    This patch converts jQueryUI tabs on three tools templates to Bootstrap
    tabs. The patch contains indentation changes, so diff accordingly.
    
    To test, apply the patch and go to Tools -> Export.
    
    - You should see at least two tabs, "Export bibliographic records" and
      "Export authority records."
    - Confirm that they look correct and work correctly.
    
    Go to Tools -> Batch patron modification.
    
    - Check the "By card number," "By borrowernumber," and "By patron list"
      tabs.
    
    Go to Tools -> Overdue notice/status triggers.
    
     - Check the "First," "Second," and "Third" tabs.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dc8a9657b1a259a18e0084ff8dbb3fef30cc72fd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 12 17:26:03 2022 +0000

    Bug 30474: (follow-up) Tie editor initialization to tab activation
    
    The way Bootstrap tabs manipulate the DOM, CodeMirror has problems
    initializing correctly, I think because of redraws and CodeMirror's
    attemps to position things absolutely.
    
    The solution seems to be to wait until after a Bootstrap tab has
    activated before initializing the CodeMirror instance. This patch
    implements that, along with a check to prevent double-initializing the
    same textarea.
    
    I've also made a similar change to the way TinyMCE is initialized, which
    I hope will help with the issue of the editor not always loading
    correctly.
    
    To test, apply the patch and go to Tools -> HTML customizations.
    
    - Test creation and editing of HTML customization entries using both
      the default editor and the text editor (Edit -> Edit with text
      editor).
    - Verify that the editor (CodeMirror or TinyMCE) loads correctly and
      looks correct, both upon page load and upon switching tabs between
      "Default" and other language tabs
    - Verify that your edits are saved correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f1d77a64bb840e31fa4f0311dd5ee76233575ad9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 6 16:52:39 2022 +0000

    Bug 30474: Convert tools pages tabs to Bootstrap (part 1)
    
    This patch converts jQueryUI tabs on three tools templates to Bootstrap
    tabs.
    
    To test, apply the patch and go to Tools -> HTML customizations.
    
    - Click "New entry."
    - On the entry form you should see two tabs, "Default" and "English
      (en)"
    - The tabs should look correct and work correctly.
    
    Go to Tools -> Batch record deletion.
    
     - Test the three tabs: "Upload a file", "Select a list of records", and
       "Enter a list of record numbers."
    
    Go to Tools -> Batch record modification.
    
     -  Test the same three tabs on this page.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 939e1e9c9ed378e9ff5b0bf211f0e6c194b09edc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 6 15:35:47 2022 +0000

    Bug 30473: Convert suggestions page tabs to Bootstrap
    
    This patch updates the suggestions page to use Bootstrap tabs
    instead of jQueryUI.
    
    To test you should have multiple suggestions from different libraries,
    different item types, and different statuses.
    
    Apply the patch and go to Suggestions.
    
    - Suggestions should initially be displayed in tabs by status.
    - Confirm that the tabs look correct and work correctly.
    - Test that tabs work correctly for each option in the "Organize by"
      dropdown in the left-hand sidebar.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3b6238af139b8bae8f90769ca1db02bf35c0e401
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 25 05:54:11 2022 -0300

    Bug 30180: (follow-up) Add temporary deprecation warning
    
    This patch adds a temporary deprecation warning to let users know the
    plugin needs to get updated before the next release.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Holds_hooks.t
    => SUCCESS: Tests pass, warning is displayed
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e7a2705c5dd044a4f94888ec19f769649c281cb5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 25 05:50:20 2022 -0300

    Bug 30180: Add 'placed' after_hold_hook
    
    This patch adds a new 'after_hold_action' hook, that is called with the
    'placed' action parameter.
    
    To test:
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Holds_hooks.t
    => FAIL: Boo, the hook is not called
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 141b817b935ad23a2c36278e62a5e0ed08191057
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 25 05:49:56 2022 -0300

    Bug 30180: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f19201a12ce1a0a611bc1fdee9ead5f3ba25a419
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 15 10:09:22 2021 +0100

    Bug 29698: Make items available for PREDUEDGST
    
    With this patch you can access items using:
    Number of items [% items.count %]
    [% FOR i IN items %]
        [% SET checkout = i.checkout %]
        Item [% i.itemnumber %] is due on [% checkout.date_due | $KohaDates %]
    [% END %]
    
    == test plan ==
    1. Add the following to PREDUEDGST and DUEDST:
    Number of items [% items.count %]
    [% FOR i IN items %]
        [% SET checkout = i.checkout %]
        Item [% i.itemnumber %] is due on [% checkout.date_due | $KohaDates %]
    [% END %]
    
    2. Find a patron and set there messaging prefs 'Item due' and 'Advanced
      notices' so they get an email and 'digest only'.
      On 'Advanced notices' set Days in advance to 1.
    3. Check some things out to a patron and make them due tomorrow.
    4. perl /kohadevbox/koha/misc/cronjobs/advance_notices.pl -v -c
    5. Check the patrons notices and make sure the PREDUEDGST looks right.
    6. Check some things out to a patron and make them due today.
    7. Repeat 4.
    8. Check the patrons notices and make sure the DUEDGST looks right.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 023e5eb0cad8a88116f51d0a5e90c42093cd4113
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 14 18:02:22 2022 +0000

    Bug 30549: Replace the use of jQueryUI Accordion on pending patron updates page
    
    This patch updates the pending patron updates page to use Bootstrap
    collapse instead of jQueryUI.
    
    This patch contains whitespace changes, so view the diff with this in
    mind.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - If necessary, log into the OPAC and submit an update via the "Your
      personal details" page. Ideally do this for two or more patrons.
    - In the staff client, follow the "Patrons requesting modifications"
      link.
    - On the "Update patron records" page you should see the headings
      representing each of the patrons with pending updates. The first panel
      should be expanded.
    - Confirm that the panels expand and collapse correctly.
    - Follow the "Patron details" link for one of these patrons.
    - Click the "Review pending modifications" link on the patron detail
      page.
    - When the update page opens that patron's panel should be expanded.
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b2c7bc84a29fe9dbfecedda8b5bc56330267a1ef
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed May 4 10:15:14 2022 -1000

    Bug 28138: DBRev 21.12.00.047
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit af1cc3f6e2ba9f6a038432eeef6f14780a94b8a1
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Apr 25 16:39:37 2022 +0000

    Bug 28138: (QA follow-up) Link system preference in new system preference description
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7b12e3f42d306ab2ae7c456d447a2ec0cc6d9828
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Apr 25 16:03:37 2022 +0000

    Bug 28138: (QA follow-up) Slight rephrase of system preference text
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 365bde387743acbaa09f0d3f0cb93235f5845159
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 21 18:17:41 2022 +0000

    Bug 28138: (follow-up) Add empty option to payment type selection
    
    This patch adds an empty <option> to the "Payment type" selection when
    paying fine. This forces the user to actively make a selection. I've
    also added the text "None selected" to the other empty <option> on the
    page for consistency.
    
    To test, apply the patch and test the pay fine interface with and
    without the RequirePaymentType preference enabled. When enabled the
    payment type should be required and it should default to "None
    selected."
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit effefacf302271128b36337ba11c5c416189683e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Mar 11 13:06:45 2022 -1000

    Bug 28138: (follow-up) New atomic update
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a7139af17a35e7051504f055a4a324438da723ef
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Apr 13 10:06:24 2021 +0200

    Bug 28138: Add syspref to make the payment type required
    
    The payment type is already required when using the cash register
    feature, but some users want to force selecting a payment type even
    when cash registers are not used
    
    The new system preference name is RequirePaymentType
    
    Test plan:
    1. Apply patch and run updatedatabase.pl
    2. Disable UseCashRegisters and RequirePaymentType sysprefs
    3. Create some authorised values in PAYMENT_TYPE category if needed
    4. Create a manual invoice and pay it. Notice that the payment type is
       optional.
    5. Enable RequirePaymentType
    6. Create a manual invoice and pay it. Notice that the payment type is
       now required.
    7. Enable UseCashRegisters and verify that the payment type is always
       required, even if RequirePaymentType is disabled
    
    Rebased by Thibaud Guillot <thibaud.guillot@biblibre.com> on 21-12-02
    
    Signed-off-by: shiyao <shiyao@inlibro.com>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bbcc781ba456a342af72a58bc12dbeda0a46a23c
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Apr 27 02:41:12 2022 +0000

    Bug 30600: Fix recall reasons for branch transfers
    
    When a recall triggers a branch transfer, the reason for the transfer is
    'Recall'.
    
    When a transfer is cancelled that was triggered by a recall, depending
    on where it is cancelled, will use the 'Manual' or 'CancelRecall'
    cancellation reasons.
    
    This patch ensures branchtransfers.cancellation_reason adds 'CancelRecall',
    and branchtransfers.reason adds 'Recall' as options.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 08b046f69a54f1b72aa8a19b41f35484cef83e6c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 4 11:38:08 2022 +0000

    Bug 30167: (follow-up) Compare dt objects
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8de0a02bd236e7fba0edf02cefa0a51f3835805f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 29 12:58:44 2022 +0000

    Bug 30167: (follow-up) Return a hash with soonest_renew_date
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 175182f064ffb51ee3504a528db1f7f06a443a77
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Feb 23 16:09:07 2022 +0000

    Bug 30167: Use returned renewal date rather than fetching
    
    This patch updates the three scripts that fetched the soonest renewal date
    to use the return from CanBookBeRenewed
    
    To test:
    1 - Set a circulation rule with a 'no renewal before' set to 3, loan length set to 5
    2 - Check out an item to a patron that uses this rule
    3 - Verify the checkouts for the patron show the correct 'No renewal before' date
    4 - Sign in to the patron's opac account
    5 - Verify the item shows it cannot be renewed, and shows the correct date
    6 - Go to Circulation->Renew
    7 - Attempt to renew using barcode
    8 - Confirm error shows the soonest renewal date
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4cf759259ffbf5bf74af43e06b3be780c90161b2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Feb 23 16:01:22 2022 +0000

    Bug 30167: Return soonest renewal date when renewal is to soon
    
    This patch adds an 'info' return param to CanBookBeRenewed and passes
    the soonest renewal date when returning too_soon errors
    
    To test:
    1 - prove -v t/db_dependent/Circulation.t
    
    Fix whitespace
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e225ee3b1597070677f4cd010c3da4aaac7d3ab8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 22 10:46:06 2022 +0100

    Bug 28998: (QA follow-up) Improve output on error
    
    This patch updates the output_and_exit call to instead pass an error
    parameter in the template and use it to display the warning instead of
    the rest of the page content in the 'Manage two-factor authentication'
    page.
    
    This allows for translation and makes the page adhere to normal
    practices.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f300a7d3631c07618dd8a46b366288cc6680cd45
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 22 08:04:51 2022 +0000

    Bug 28998: (follow-up) Check missing encryption key in script and module
    
    Script prints a warning.
    Module raises an exception.
    Unit test added.
    
    Test plan:
    Run t/db_dependent/Koha/Encryption.t
    Run t/db_dependent/Koha/Auth/TwoFactorAuth.t
    Remove entry and check script.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 54765867b27d2d15f49033ecf1e0c5b36a0176ef
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 22 07:33:28 2022 +0000

    Bug 28998: (follow-up) Add warning on about for missing key
    
    Test plan:
    Make sure that you have no encryption_key in koha-conf.
    Check about page, system information tab.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fae45d29910fc31c396e92f524240c0d2327295b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 21 17:11:33 2022 +0100

    Bug 28998: (QA follow-up) POD Fix
    
    This POD fix keeps the QA script happy
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit da66ab34225af3d86e9a1eb9988c4652eaa175b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 17:18:51 2021 +0200

    Bug 28998: Add Crypt::CBC dependency
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f62c485bb715591712a338d8bb6677280e39c47d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 17:16:37 2021 +0200

    Bug 28998: Add encryption_key to the config file
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ff980555f39da7a033dc26f3910e6a323b7352dd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 11:27:33 2021 +0200

    Bug 28998: Adjust Selenium test
    
    Test plan:
    Run t/db_dependent/selenium/authentication_2fa.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b515208fa20ba4a9c80229639dcf770783ac88d4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 14 13:24:39 2022 +0000

    Bug 28998: (follow-up) Apply changes to TwoFactorAuth module and script
    
    Test plan:
    Run t/db_dependent/Koha/Auth/TwoFactorAuth.t
    Walk thru cycle register - logout/login - deregister - logout/login.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 642d0daa7c299404888fab30ae2cdf9c17b94885
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 14 12:35:30 2022 +0000

    Bug 28998: (follow-up) Add Patron->encode_secret and ->decoded_secret
    
    Test plan:
    Run t/db_dependent/Koha/Patron.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 27c2100fe97dac58a5665c7c7199c44e50fa0e97
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 11:27:33 2021 +0200

    Bug 28998: Introduce Koha::Encryption
    
    Test plan:
    Run t/db_dependent/Koha/Encryption.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [AMENDED] Added copyright line to module.
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 22c8d6ecc3522938bf820636d64a9ce67c5d8cc8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 4 11:17:22 2022 +0000

    Bug 22785: (follow-up) no additionalProperties
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit cefb82be2cd36e1e1d094f058000ecfdb855a50a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 3 08:06:41 2022 +0100

    Bug 30536: Fix Query.t Unit Test
    
    The stash_embed method no longer validates the query so this patch drops
    the validation tests and instead just focuses on varifying the correct
    output structure of the stash after the method call.
    
    We have not lost validation however, it now happens only once at the
    OpenAPI level and tests are present in t/db_dependent/api/v1/query.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 19a2c53ddd6700b6e4d0e28654276dfe017d0b7f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 29 16:43:36 2022 +0100

    Bug 30536: (QA follow-up) POD + Spec Consistency
    
    Well spotted, this patch fixes the specs to be consistent and adds a
    little detail to the POD as requested.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d0ec2460a6143917a2fa1ed42d518a4709150ae9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 14 16:06:24 2022 +0100

    Bug 30536: Update spec files
    
    This patch removes superflous x-koha-embed defintions at the top level
    of the endpoint specifications. It also replaces a few x-koha-embeds at
    the top level with parameter lists where this had been missed in
    preceeding patches.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8e1265c45ddfc53d4bcbfc51e25b297e3592daf4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 14 13:47:06 2022 +0100

    Bug 30536: Remove validation overhead
    
    With the introduction of proper validation of collection headers in
    OpenAPI we no longer need to do our own validation here.
    
    This patch removes the early validation of x-koha-embed headers in
    preference to letting OpenAPI do it once and only once instead.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1c84009908e4b4abb89c6b8934ce7502a6e2933c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 14 12:22:27 2022 +0100

    Bug 30536: Refer to parameters enum
    
    This patch updates the stash_embed method to use the parameters hash
    enum instead of the top level x-koha-embed custom definition. This way
    we can remove the requirement for defining this list twice.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 384c9396f42383cea16f594bf4237198f0b7b7ff
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 14 12:07:49 2022 -0300

    Bug 30536: Unit tests
    
    This patch adds tests to make sure there's no behavior change regarding
    error conditions. When requests include wrong x-koha-embed values, a 400
    error should be returned, both in our original implementation or relying
    on the Mojolicious::Plugin::OpenAPI features.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/query.t
    => SUCCESS: Tests pass
    3. Apply the rest of the patches
    4. Repeat 2
    => SUCCESS: Tests still pass
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 76e06ab7c875b5a1b3b64809fbd15c4bfb519f53
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 28 15:17:35 2022 +0000

    Bug 30632: Fix report author display in list of saved reports
    
    This patch removes whitespace in the template around the markup of
    report author first name and surname. This prevents unwanted spaces in
    the output.
    
    To test, apply the patch and go to Reports -> Use saved.
    
    The display of report author should be like this:
    
    Leonard, Owen (123456)
    
    Instead of Leonard , Owen (20375)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 86990f3edef0d1b7b04eb81642cce5c51f100470
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 29 09:18:24 2022 +0000

    Bug 10517: (QA follow-up) No need to remove second true
    
    This is just theoretical, but by removing the second true you
    could end the script on another error.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e6a40fc9ed4e82370ae92b394823a3d07b1bb130
Author: Rudolf Byker <rudolfbyker@gmail.com>
Date:   Wed Jan 8 11:20:02 2020 +0200

    Bug 10517: Use `DROP USER IF EXISTS` and remove ` || true`.
    
    When restoring a Koha instance, and the database user does not exist, an error is shown,
    although it is prevented from stopping the script by ` || true`. This patch removes the
    ` || true` guard, and rather uses `DROP USER IF EXISTS` which does exactly what one
    would expect, without confusing error messages, whether the user existed or not.
    
    To test:
    1) Assume your Koha instance is called `asdf`.
    1) Export the Koha instance using `koha-dump`.
    2) Remove the instance completely using `koha-remove`.
    3) Import it again using `koha-restore`.
    4) No error should be shown, and the import should work. There was NO user to drop, therefore `DROP USER IF EXISTS` did nothing.
    5) A database user called `koha_asdf` should exist, and have all privileges on the database of the same name.
    6) Remove the instance again using `koha-remove`.
    7) Now create a database user in MySQL called `koha_instance` where instance is the name of your dumped koha instance.
    8) Import your koha instance again using `koha-restore`.
    9) Again, no error should be shown, and the import should work. There WAS a user to drop, therefore `DROP USER IF EXISTS` dropped the user before creating a new one.
    10) Again, a database user called `koha_asdf` should exist, and have all privileges on the database of the same name.
    
    Sponsored-by: Reformational Study Centre
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bf1ebfc0929085930bda8bbb0c16b8ea51b9e32f
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Mon Feb 21 16:07:00 2022 +0200

    Bug 30143: OAI-PMH: Fix SQL query used to fetch deleted records
    
    The query was missing the "ORDER BY" and "LIMIT" clauses, which could make retrieve a wrong set of records.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 00a73846c054c6814250adfa4181e613192abfc4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 24 11:42:55 2022 +0000

    Bug 29537: Remove unnecessary if-else checks for soonest renew date
    
    GetSoonestRenewDate() calculates the renewal due date now also
    correctly for auto-renewals after the fixes from bug 29476 so we don't
    have to add any if-else checks because of it being buggy anymore.
    
    To test:
     1) prove t/db_dependent/Circulation.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a64e20b39c160f9b688f385d3920582d63422019
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 3 10:38:04 2022 -1000

    Bug 22785: DBRev 21.12.00.046
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0d1c5bb18c94e8f2a26de8395bcfdb8a4b6b3726
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 3 10:37:04 2022 -1000

    Bug 22785: Update DBIC schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0257d068b12b4fd289bc0d449c4ae31c9a84f6ea
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 28 10:28:58 2022 +0000

    Bug 22785: (follow-up) Update contentType in request
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 68a5bcc6930d5231963a47e0f66371e0cc35b97b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 27 17:31:03 2022 +0100

    Bug 22785: (QA follow-up) Remove superflous spec files
    
    We don't need these any more.. I think they crept back in during
    rebases
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 593c189a13367a293b60b08b096c499cfa42bd6e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 20 14:54:59 2021 +0000

    Bug 22785: (follow-up) Fix translatability
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4d12caecea5f0a0c8192b4f68d5fa3c4218aaa8a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 19 10:54:49 2021 +0000

    Bug 22785: (follow-up) Don't sort by chosen and fix selection of matches
    
    Previously the sorting took 'chosen' into account and would move a selected match to the
    top on next load - it is better to preserve the same sorting every time
    
    When loading matches the 'cehcked' variable was not being cleared, so multiple matches were
    being marked 'checked="checked"'. Fixing this ensures the correct record displays as chosen
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Ben Daeuber <bdaeuber@cityoffargo.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4af59f575154ed27c41e09721c1420ef98044344
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 4 14:23:52 2021 +0000

    Bug 22785: Update Schema for boolean
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Ben Daeuber <bdaeuber@cityoffargo.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 48ae97e361672431c743ba5a64097da6db87229e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 31 17:01:24 2020 +0000

    Bug 22785: Allow option to choose which record match is applied during import
    
    This patchset adds the display of all matches found during import to the import management screen
    
    A staff member with the permission to manage batches will be able to select for any individual record which match, or none, should be used during import
    
    To test:
    1 - Import a batch of records or export existing records from your catalog
    2 - Import the file (again) and select a matching rule that will find matches
    3 - Note that you now have radio buttons allowing you to select a record, or none
    4 - Test scenarios:
        I - When 'Action if matching record found' is 'Ignore'
            a - Imported record ignored if match is selected
            b - 'Action if no match found' followed if no match is selected (Ignore matches)
        II - When 'Action if matching record found' is 'Replace'
            a - The chosen record is the one overlayed (you can edit the chosen record before importing to confirm)
            b - 'Action if no match found' followed if no match is selected (Ignore matches)
        III - When 'Action if matching record found' is 'Add incoming record'
            a - Record is added regardless of matches
    5 - Confirm 'Diff' 'View' links work as expected
    6 - Confirm that after records are imported the radio buttons to choose are disabled
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Bug 22785: API files
    
    Signed-off-by: Ben Daeuber <bdaeuber@cityoffargo.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2aeedd42d40a29a99fad520531c8717e3fa61ee5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 3 10:17:52 2022 -1000

    Bug 30466: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8dddf0a60dc17c4d76e71af31aace6079868dfdc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 1 15:50:32 2022 +0000

    Bug 30436: Convert article requests tabs to Bootstrap
    
    This patch converts the jQuery tabs on the article requests page to
    Bootstrap.
    
    To test you should have the "ArticleRequests" system preference
    enabled. If necessary, create some article requests and mark some
    "Pending," some "Processing," and leave some new.
    
    - Apply the patch and go to Circulation -> Article requests.
    - The page should show three tabs: New, Pending, and Processing.
    - The tabs should look correct and work correctly.
    - The DataTables under each tab should work correctly.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4055f7e377535f1d7952da7aeafa8da1b83720c2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 20 12:53:27 2022 +0000

    Bug 30466: Convert serials pages tabs to Bootstrap
    
    This patch modifies three serials templates in order to replace jQueryUI
    tabs with Bootstrap tabs.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Serials.
    - Perform a serials search which will return one or more results.
    - On the search results page you should see an Open and Closed tab.
    - The tabs should look correct and work correctly.
    - Confirm that "Select all" and "Clear all" controls work correctly in
      each tab.
    
    - Click one of the search results to view the details for that
      subscription.
    - You should see tabs for Information, Planning, Issues, and Summary.
      You may also see an Acquisition details tab depending on your data.
    
    - In the sidebar menu click "Serial collection."
    - On this page you should see tabs corresponding to each year the serial
      has been received.
    - Under each tab the "Select all" and "Clear all" controls should work
      correctly in the context of that tab. Other controls should apply to
      all tabs.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b0c98b13cc1a3e13a29dc2e3cf968306b0e4610a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue May 3 10:10:39 2022 -1000

    Bug 14242: DBRev 21.12.00.045
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a93640257a31f984e5d5b3d27343861753092ca5
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Apr 28 14:45:21 2022 +0000

    Bug 14242: (QA follow-up) Update hint on suggestion form: 2016 > 2022
    
    First patches were written in 2015 - so I think we can safely
    move the hint closer to the present.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0844c8d05a10845f958a7aaf7d5b4b902189a4fd
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Apr 28 14:37:01 2022 +0000

    Bug 14242: (QA follow-up) Fix alphatic order of sysprefs.sql
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ed84d7d50ae550e9089cd9f7af7a6cb964c50eb0
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Mar 2 15:21:01 2022 +1300

    Bug 14242: (follow-up) Clear all text input fields
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bc89b1d6fddb33c862c52c99f98565815ca142da
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Sep 28 15:24:48 2021 +1300

    Bug 14242: (follow-up) Hide autofil when syspref disabled, clear ISBN
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9660b61158444ed52899cac3aefac5995ec455a0
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Feb 18 13:50:38 2021 +1300

    Bug 14242: (follow-up) Format copyright date before plugged into form
    
    This patch formats the copyright date so that only the year shows before
    plugging the formatted version into the form.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bdcf9a8a3fbc1a0dd9db8ef4213b21cea8f036dc
Author: Martin Stenberg <martin@xinxidi.net>
Date:   Wed Aug 26 20:22:30 2015 +0200

    Bug 14242: Use ISBN-field to automatically fill out purchase suggestions
    
    Add new jQuery plugin "autofill" which transforms selected element(s)
    into search fields for Google Books API and automatically fills
    requested fields with search result.
    
    Use in OPAC purchase suggestions to automatically fill out fields when
    entering ISBN-number.
    
    Test plan:
    1. Run updatedatabase.pl
    2. Enable system precference "OPACSuggestionAutoFill"
    3. Log into OPAC and go to purchase suggestions page
    4. Write a valid ISBN (such as 0-9690745-2-2 or 978-1-78416-110-1) into
       the ISBN field and click the 'search google books' button, or unfocus
       the field.
    5. Title, Author, Publisher, publication year and Item Type fields should now be filled
       automatically.
    6. Press "clear form" to undo - should restore all fields that the API pull
       filled to empty
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7e85abde99ce008f8eec79baef63020fd8a0dd38
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue May 3 12:25:50 2022 +0000

    Bug 30550: (QA follow-up) Clear cleartext remainders
    
    Clear enough?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bae9119a4c104c309fa5a3c853ad73aa25788346
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 14 18:27:47 2022 +0000

    Bug 30550: OPAC recalls page tries to use jQueryUI datepicker
    
    This patch updates the recalls page in the OPAC so that it uses
    Flatpickr for the "Recall not needed after" field.
    
    To test apply the patch and enable the UseRecalls preference if
    necessary. You made need to update your circulation rules as well,
    defining some default values for recalls.
    
    - Log in to the OPAC.
    - Locate a bibliographic record which has one item and that item is
      checked out.
    - Click "Place recall."
    - The "Recall not needed after" field should be styled correctly, and
      clicking it should trigger the calendar popup.
    - You should be limited to selections after today's date.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6795391ba4a72e58adc8b1c82e43dab7b339f559
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 16:11:29 2022 +0200

    Bug 27344: Add error detail if something wrong happened
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 04c0413352ad1be9b49919d73c288130eec4b06c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 14:38:04 2022 +0200

    Bug 27344: Fix call to update_index with invalid ids
    
    Can't use an undefined value as an ARRAY reference at /kohadevbox/koha/Koha/SearchEngine/Elasticsearch/Indexer.pm line 121.
    
    Caught that when working on follow-up bug reports.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6266474f87653449dd410e7685a83eb1305b38cc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 14:33:05 2022 +0200

    Bug 27344: Fix tests
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4fe1d8dfc9de4a314cd0836829efad7877121172
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 5 14:52:17 2022 +0200

    Bug 27344: Warn the error in the log
    
    Otherwise info about the failure is hidden in DB
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dba7ee394b27106a5eaaa156d2df44bd45e572e2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 5 14:51:09 2022 +0200

    Bug 27344: Add missing imports
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 12fa8dc6e5b7c2c4197253e2e37f85d01c581d5d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 1 12:25:56 2022 +0200

    Bug 27344: Adapt to bug 30181 changes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 486b5e4e0fb75259c51f7f60616a427ccc9d9024
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 30 15:20:20 2022 +0200

    Bug 27344: Add missing include file
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4d1566d3244c765e2d7c13e941e0714f63bcd0ef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 5 14:42:20 2021 +0100

    Bug 27344: Implement Elastic's update_index_background using Koha::BackgroundJob
    
    This patch adds a background job submodule, UpdateElasticIndex, to deal
    with async ES index update (not the deletion).
    
    Using NYTProf (on a checkin):
    Without
    618ms, executing 35676 statements and 26355 subroutine calls in 266 source files and 83 string evals.
    
    With
    521ms, executing 13282 statements and 7979 subroutine calls in 195 source files and 26 string evals.
    
    However there are some problems with this patch:
    1. We don't want *all* the index update to be in the background_jobs
    tabtle (we could add a filter on the list view)
    2. We don't track the "progress" of the job as we are sending all the
    records to Elastic. It is okish in my opinion but it must be noted.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4c9db3856aff65123864a56088f89b9121c90ef9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 2 15:15:58 2022 +0000

    Bug 27750: Remove jquery.cookie.js plugin
    
    This patch removes references to the jquery.cookie.js plugin which is
    now unused, replaced by js-cookie.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 93b40294385ba3467f84e19dc4a906ca8447299c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 2 11:11:52 2022 -1000

    Bug 29894: DBRev 21.12.00.044
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 31450d8f2f07738e349c8c600f49275966f61fa5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 22 12:24:17 2022 +0200

    Bug 29894: Add Selenium tests for disable 2FA
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0988807436bb31cdbc56f3143cabdcf839908c2f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 22 06:39:32 2022 +0000

    Bug 29894: (QA follow-up) Get rid of send_confirm_notice
    
    Chose here to fall back to $patron->queue_notice. Which is tested
    already, so removing the additional test code.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6dff71a5c239ae588ba76e72ddd2d80d5f177ae5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 21 14:53:18 2022 +0100

    Bug 29894: (follow-up) Update notice terms
    
    Register and Derigister didn't sound right, in reality we we enabling
    and disabling 2FA for the user so I think those terms are more
    understandable.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 279d9d62a3a22ce1a2a33901a3e359c9605bfda2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 21 07:58:45 2022 +0000

    Bug 29894: Send a confirmation notice
    
    When registering or deregistering, send a confirmation.
    
    Test plan:
    Register or deregister with patron having email address.
    Verify that you got a confirmation mail.
    Run t/db_dependent/Koha/Auth/TwoFactorAuth.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0a1fc0f94689f5d232897e8c0aef27c6855347a8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 21 08:42:08 2022 +0000

    Bug 29894: Db rev for adding notices
    
    This dbrev adds two notices:
    2FA_REGISTER and 2FA_DEREGISTER
    
    Test plan:
    Run the dbrev.
    Check if you see them on Tools/Notices.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2e4345cc77d0b457d9d7f1bf42d1cbddf125d393
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jan 20 15:07:30 2022 +0000

    Bug 29894: Clear secret when disabling 2FA
    
    Test plan:
    Deregister 2FA for patron.
    Check if secret is empty in borrowers.secret.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d42cd2b6298bf2765b6a609909526f774450c250
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jan 20 14:43:42 2022 +0000

    Bug 29894: Add some exceptions to TwoFactorAuth module
    
    Test updated accordingly.
    Adding utf8 flag to CGI in staff script.
    
    Test plan:
    Run t/db_dependent/Koha/Auth/TwoFactorAuth.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7619b1662fab73c6dac21cbf99a4fbebc839e7a5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jan 13 15:33:42 2022 +0000

    Bug 29873: Add unit test
    
    Test plan:
    Run t/db_dependent/Koha/Auth/TwoFactorAuth.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended to reflect requested changes.
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8bd314fe0b76343d9c96e9c6cd725bc583d488d2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jan 13 14:27:36 2022 +0000

    Bug 29873: Create QR code
    
    Instead of using deprecated Google Charts API, and exposing our
    secret in a GET parameter, we generate QR data ourselves.
    
    Test plan:
    [1] Enable two factor authentication in the prefs.
    [2] Login in staff. Go to account. Select Manage 2FA.
    [3] Verify that QR code is displayed.
    [4] Register the QR in your authenticator app and test 2FA
        by logging in again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested with Google Authenticator and FreeOTP.
    
    Bug 29873: (follow-up) Rename qr_dataurl
    
    As requested by a QA team member.
    We're moving to qr_code as method name. This is the same name as
    the method in the underlying base class.
    Apart from one sed statement, changing to self->SUPER on one line.
    
    Test plan:
    Can you still register, logout and login?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 29873: (follow-up) Switch to GD
    
    We do not need a new module, we could use GD instead.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 37acf46b7e82e9e30d2926d7e7f6953c804a88ff
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 2 11:03:00 2022 -1000

    Bug 30108: (follow-up) Make require label translatable
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 305b526909067f7f9a486d6fa289e415243921e4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 2 10:50:35 2022 -1000

    Bug 30108: DBRev 21.12.00.043
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b02589481de7f88a6dad83d77d74116046cba3d7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 4 10:47:19 2022 +0000

    Bug 30108: (follow-up) Add required indication, differentiate alert
    
    As asked on comment4:
    [1] Add a required div as a visible hint when applicable.
    [2] Differentiate alert for hold start and end date.
    
    Test plan:
    See former patch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 305cd0036dd5a669f82f3c88a0402778f8e26f43
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Feb 15 16:25:59 2022 +0100

    Bug 30108: Allow making hold dates required
    
    Side note: Template still referred to class holddateto while not
    being used any longer. Replaced this occurrence by futuredate.
    
    Test plan:
    [1] Disable OPACAllowHoldDateInFuture.
    [2] Set pref OPACMandatoryHoldDates to "end date".
    [3] Verify that the end date is mandatory on opac-reserve.
    [4] Set pref OPACMandatoryHoldDates to "start date".
    [5] Verify that no dates are required.
    [6] Enable OPACAllowHoldDateInFuture.
    [7] Verify that start dates are required.
    [8] Set pref OPACMandatoryHoldDates to "no dates".
    [9] Verify that no dates are required again.
    
    Bonus:
    Check that more options box is opened when a date still is required.
    In case of item level being forced, verify that more options is opened
    regardless of pref setting.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 85a67cb6d2c233b37bca18351cce4c4d52467c85
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Feb 17 13:22:35 2022 +0000

    Bug 30108: Preference description
    
    Test plan:
    Check the preferences form, tab Circulation, tab Hold policy.
    Look for OPACMandatoryHoldDates.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de9e68fdc2993caf1728e05cd08c08d9ae006c22
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Feb 17 12:55:20 2022 +0000

    Bug 30108: Database revision, adding new preference
    
    Test plan:
    Run upgrade or new install.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f5d2147670000109ba83e9750b48f81eb17cadb4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 1 13:10:49 2022 +0000

    Bug 30433: Convert advanced search tabs to Bootstrap
    
    This patch updates the advanced search page in the staff interface to
    use Bootstrap tabs instead of jQueryUI.
    
    To test, apply the patch and test the advanced search interface. The
    tabs should look correct and work correctly.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3d0b1938af750bd9c25f530651cf793b6f78b032
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 31 18:46:16 2022 +0000

    Bug 30424: (follow-up) Markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9666a03b2688efdb1f12ac78934323ddc05e3450
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 31 18:23:53 2022 +0000

    Bug 30424: Reindent advanced search template in the staff interface
    
    This patch reindents the advanced search template. Some lines have been
    split to make the markup more readable.
    
    To test, apply the patch and test the advanced search page in the staff
    interface. Everything should work as normal. Be sure to test both the
    "More options" and "Fewer options" views.
    
    When viewing the diff for this change, ignore whitespace. The only
    visible changes should be split lines.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7f87001bde374b87c9063acfdedd1b6fc7139b88
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 8 12:20:00 2022 +0000

    Bug 30545: Replace the use of jQueryUI Accordion on the notices page
    
    This patch updates the notices edit interface in order to replace
    jQueryUI accordion and tabs widgets with Bootstrap collapse and tabs.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Set the TranslateNotices system preference to "Don't allow."
    - Go to Tools -> Notices and edit any notice.
    - On the "Modify notice" page you should see three collapsed sections:
      Email, Print, and SMS.
    - Clicking the section headings should expand and collapse the panels.
    - With one of the panels open, click Save -> Save and continue editing.
      - When the page reloads the same panel should be expanded.
    
    - Enable the TranslateNotices system preference.
    - Return to the edit interface for one of your notices.
    - You should now see at least two tabs: Default and English.
    - The sections under each tab should continue to work correctly.
    - Test the "Save and continue" functionality again. When redirected you
      should return to both the correct tab and the correct panel, e.g. the
      "Print" section under the "English (en)" tab.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 518fce01c96c5546f5448a63e614eb05d237356f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 2 10:34:01 2022 -1000

    Bug 30494: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b2d877b07c2a2bf963c76fe6f022d5b7537b8b3d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 7 16:02:37 2022 +0000

    Bug 30494: Replace the use of jQueryUI Accordion on the table settings page
    
    This page updates the table settings page so that it uses Bootstrap's
    "Collapse" feature instead of jQueryUI's Accordion.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Administration -> Table settings.
    - You should see a list of table settings which looks much the same as
      it did before, with arrow icons prefixing each section header. All
      panels should be collapsed.
    - Test expanding and collapsing panels to confirm it's working
      correctly.
    - When you expand a section the heading arrow should change from
      right-pointing to down.
    - Make a change to one of the table configurations. After clicking
      "Save" the page should reload with the same panel expanded.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1015fb1192fd9a309f7aee398d077b84ffe54119
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 7 14:39:55 2022 +0000

    Bug 30491: Convert saved reports tabs to Bootstrap
    
    This patch updates the saved reports page so that it uses Bootstrap tabs
    instead of jQueryUI.
    
    To test, apply the patch and go to Reports -> Use saved.
    
     - On the Saved Reports page you should see multiple tabs.
     - Each should look correct and work correctly.
     - Clicking each tab should result in the table of reports filtering
       correctly for that tab (Patrons tab showing only patrons reports).
     - If necessary, edit one or more reports so that they have a subgroup.
     - Confirm that each subgroup selector is correct for each tab, i.e. a
       subgroup created under "Catalog" should only be available under the
       Catalog tab.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e5b206b3dd24275cc02e09623216b16331ed04b2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 11 12:00:38 2022 +0000

    Bug 30489: Convert MARC and authority subfield edit tabs to Bootstrap
    
    This patch updates the MARC and authority subfield edit interface to
    replace jQueryUI tabs with Bootstrap. The code for handling
    drag-to-reorder tabs is updated to accommodate the new markup.
    
    To test, apply the patch and restart_all.
    
    - Go to Administration -> MARC bibliographic framework -> Default
      framework and choose "MARC structure" from the Actions menu.
    - In the row for 000 LEADER, click Actions -> View subfields.
    - Click "Edit." On the edit page the tabs should look correct and work
      correctly.
    - Return to the list of tags and click "View subfields" for the 245 tag.
    - Click one of the "Edit" buttons for any but the first subfield, e.g.
      "a".
    - On the "Tag 245 Subfield constraints" page the "a" tab should be
      pre-selected.
    - Click any of the subfield tabs and drag it to re-order it in the
      sequence of tags.
    - It should stay in the correct slot when you release it.
    - Save and confirm that the new sequence of subfields has been saved.
    
    Perform all the same tests under Administration -> Authority types.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 59546c9924249b2f4b7acb1fd48c5bf03713ffed
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 20 15:48:36 2022 +0000

    Bug 30457: (follow-up) Tweak markup around search form
    
    This patch makes a change to the markup around the patron/clubs search
    form on the holds page. This change prevents the Bootstrap tabs from
    inheriting an unwanted margin from the fieldset.brief definition.
    
    The change also replaces a <label> tag with an <h2>. I think a heading
    makes more sense than a free-floating <label>.
    
    To test, apply the patch and confirm that the holds page
    (/cgi-bin/koha/reserve/request.pl?biblionumber=XXX) looks correct.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 756d71f68722d845d36efb8ae923c85004b0dca8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 5 13:49:53 2022 +0000

    Bug 30457: Convert holds page tabs to Bootstrap
    
    This patch updates the holds page to replace jQueryUI tabs with
    Bootstrap.
    
    To test, apply the patch and begin the process of placing a hold on a
    title in the catalog.
    
    If you have one or more patron clubs configured:
     - You should see two tabs, Patrons and Clubs.
     - Both should look correct and work correctly.
     - The Patrons tab should be selected initially, with cursor focus in
       the form field.
     - Switch to the Clubs tab. The cursor focus should move to the form
       field under this tab.
     - Submit a club search which will return results.
     - The page should refresh and the clubs tab should be preselected,
       showing the search results.
    
    If you have no patron clubs configured, the page should show only the
    Patrons tab.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0e22f34106b307c0e831e018bd9455b14e60ea73
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 4 18:23:00 2022 +0000

    Bug 30454: Convert holds awaiting pickup tabs to Bootstrap
    
    This patch updates the holds awaiting pickup page to replace jQueryUI
    tabs with Bootstrap tabs. A minor JavaScript change is required to work
    with the new HTML structure.
    
    To test you should have multiple holds for one library: Some which are
    waiting for less than the number of days specified in
    ReservesMaxPickUpDelay, some which are waiting longer.
    
    - Apply the patch and go to Circulation -> Holds awaiting pickup.
    - You should see two tabs: "Holds waiting" and "Holds waiting over..."
    - Confirm that the tabs look correct and work correctly.
    - Confirm that the "Cancel selected" buttons work correctly under each
      tab.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 475d663c36e824bc357360c85f0cb80bf55f2058
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 4 16:40:20 2022 +0000

    Bug 30453: Convert offline circulation tabs to Bootstrap
    
    This patch updates the offline circulation page in the staff interface
    to use Bootstrap tabs instead of jQueryUI.
    
    To test, apply the patch and make sure the AllowOfflineCirculation
    system preference is enabled.
    
    - Go to Circulation -> Built-in offline circulation interface
    - Submit a patron barcode in the "Check out" field.
    - Under the barcode input field you should see two tabs: Checkouts and
      Fines. Confirm that they look correct and work correctly.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 72732fad0e51fda64b33b24b1e187e1cb8f00448
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 1 14:30:49 2022 +0000

    Bug 30434: Convert catalog merge page tabs to Bootstrap
    
    This patch updates the catalog merge template so that it uses Bootstrap
    tabs instead of jQueryUI. Some JavaScript is modified to accommodate the
    new DOM structure.
    
    The patch also makes a minor HTML correction, adding a missing "</ol>".
    
    To test, apply the patch and search the catalog in the staff client.
    
    - In the search results, check the checkbox for two records.
    - Choose Edit -> Merge records.
    - Click next to accept the merge reference selection.
    - On the next page you should see two tabs under "Source records."
      Confirm that they work correctly.
    - All checkboxes in the first tab should be checked by default.
    - Confirm that tag and subfield selection still works correctly.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 043221cbc25f4bf45ecefd2711d3c86e2757d567
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 28 10:32:28 2022 +0200

    Bug 30628: Fix patron selection in batch patron modification tool
    
    bug 28014 added Datatables to this view, but the form is submitted with
    only the checkboxes from the first page.
    
    Solution adapted from https://stackoverflow.com/questions/33240409/how-to-submit-checkboxes-from-all-pages-with-jquery-datatables
    
    Test plan:
    Have more than 20 cardnumbers, use the batch patron modification tool
    Select (not all) patrons from the first page and second page
    Submit the form
    Notice that the patrons you have selected appear on the confirmation
    page.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 56c4ab4ee1082c7ade606a79d3a98719c4a98fd7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 22 19:15:43 2022 +0000

    Bug 30599: Add an 'Archive selected' button
    
    This patch simply adds a new button on the suggestions interface to allow
    for archiving multiple suggestions.
    
    To test:
    1 - Apply patch
    2 - Create some purchase suggestions
    3 - Select several suggestions
    4 - Click 'Archive selected'
    5 - Suggestions are archived
    6 - You can view archived suggestions by selecting 'Suggestion information'->'Include archived'
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Felicity Brown <felicity.brown@montgomerycountymd.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6ec8c3ec89580d0d318b97bf47ae38dad5fc4fdb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Apr 26 11:45:52 2022 +0000

    Bug 30620: Add a warning about /*!VERSION lines in kohastructure
    
    Also adding a similar comment in C4::Installer.
    
    No test plan, just documentation.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4352f855f8cdb489070bef77695e971e5d7f6ee9
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Mon Jan 27 05:41:05 2020 +0100

    Bug 22379: Unit tests for CancelHold service
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c29eeea1099bc155a10a9228a708a7cd9770b8df
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Wed Feb 20 21:15:44 2019 +0100

    Bug 22379: Fix checks not made by ILS-DI method CancelHold
    
    Disable the possibility for a borrower to cancel a reservation
    which is either in a Transit or Waiting state.
    This reproduce the behaviour seen on the OPAC.
    Also replaces previous checks on the borrowernumber
    since CanReserveBeCanceledFromOpac already checks this.
    
    --------------------------------
    
    Test plan (before patch) :
    -Put a reserve for a borrower
    -Try to cancel the reserve providing another borrowernumber as argument
            -> Should fail and reply "RecordNotFound"
            -> Reserve still appears in the list of holds.
    
    -Try to cancel the reserve providing the borrowernumber the reserve is
    for.
            -> Should succeed, reply with "Canceled"
            -> Reserve do not show up in the list of holds for the borrower
    
    -Put a new reserve with a pickup branch != from the homebranch
    -Transfer the item to the pickup branch (reserve status = Transit)
    -Try to cancel the reserve (with proper borrowernumber)
            -> Should succeed, reply with "Canceled"
            -> Reserve do not show up in the list of holds for the borrower
    
    -Checkout the reserved item in the pickup branch (reserve status =
    Waiting)
    -Try to cancel the reserve (with proper borrowernumber)
            -> Should succeed, reply with "Canceled"
            -> Reserve do not show up in the list of holds for the borrower
    
    --------------------------------
    
    Test plan (after patch) :
    -Put a reserve for a borrower
    -Try to cancel the reserve providing another borrowernumber as argument
            -> Should fail and reply "BorrowerCannotCancelHold"
            -> Reserve still appears in the list of holds.
    
    -Try to cancel the reserve providing the borrowernumber the reserve is
    for.
            -> Should succeed, reply with "Canceled"
            -> Reserve do not show up in the list of holds for the borrower
    
    -Put a new reserve with a pickup branch != from the homebranch
    -Transfer the item to the pickup branch (reserve status = Transit)
    -Try to cancel the reserve (with proper borrowernumber)
            -> Should fail and reply "BorrowerCannotCancelHold"
            -> Reserve still appears in the list of holds.
    
    -Checkout the reserved item in the pickup branch (reserve status =
    Waiting)
    -Try to cancel the reserve (with proper borrowernumber)
            -> Should fail and reply "BorrowerCannotCancelHold"
            -> Reserve still appears in the list of holds.
    
    Signed-off-by: Laurence Rault <laurence.rault@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8df782ddba06f1781116e25e2ef6563fa374291a
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Apr 22 16:12:50 2022 +0000

    Bug 30597: Update RestrictionBlockRenewing description to include auto renew
    
    To test:
    - apply the patch, find the syspref, see the new wording
    
    To confirm the behavior:
    - set the syspref to Block
    - give a patron an auto-renewing checkout and a restriction
    - run automatic_renewal.pl, see item does not renew
    - switch syspref to allow, repeat, see renewal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 025d612f37be90ada391cabdb2cfe11ac823ad0b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Apr 25 10:27:54 2022 -1000

    Bug 30366: Remove warn when running automatic_item_modification_by_age.pl
    
    When using the ./misc/cronjobs/automatic_item_modification_by_age.pl -v
    after setting up rules under Tools > Automatic item modifications by
    age the script outputs several lines of warnings:
    
    Use of uninitialized value in string eq at /kohadevbox/koha/C4/Items.pm
    line 1864.
    
    This is because even when there is no condition defined, modification
    rule is stored with empty hash, like :
    [{"substitutions":[{"field":"items.new_status","value":"0"}],"conditions":[{}],"age":"60","agefield":"items.dateaccessioned"}]
    
    Test plan :
    1) Go to Tools > Automatic item modifications by age
    2) Create a rule with no conditions, just a substitution
    3) Run misc/cronjobs/automatic_item_modification_by_age.pl -v
    4) Check there is no warning
    5) Edit the rule to add a condition
    6) Run misc/cronjobs/automatic_item_modification_by_age.pl -v
    7) Check the condition is applied
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 119a6f3cca0bd83dee5787ebae2b4cc59e714a58
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 2 09:37:42 2022 -1000

    Bug 30572: DBRev 21.12.00.042
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f1af78fc63d79046c4d735724fb954d419c778c9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 21 12:41:08 2022 +0000

    Bug 30572: DBIx schema change for SearchMarcToField
    
    No test plan.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit db10dd522dbea76438f00744012518aa2afa78ee
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 21 12:42:53 2022 +0000

    Bug 30572: Dbrev for search_marc_to_field.sort
    
    Test plan:
    Run updatedatabase.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cf2583986001ece16f21bd141e6611ba1aed03b6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 21 12:29:48 2022 +0000

    Bug 30572: Adjust search_marc_to_field.sort in kohastructure
    
    Test plan:
    New install or run kohastructure on empty database.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cdac4f17c3af3ede4524fbd4a88c4e324efc21b4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 2 09:31:51 2022 -1000

    Bug 30449: DBRev 21.12.00.041
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fc4598149e792f25140f01aa85cfd9c2251fcc73
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 25 10:09:41 2022 -0300

    Bug 30449: (QA follow-up) Report back on problematic situations
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6d5bc52f841a213dea06db9d9f8cc344dd91dce4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 25 09:51:24 2022 -0300

    Bug 30449: DBIC updates
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b1bf07f49ce8bcd7a3d7b05a9f0a97966f9e0295
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Apr 4 13:20:37 2022 +0000

    Bug 30449: Add missing FK constraint on borrower_attribute_types
    
    Old Koha databases probably have it, newer ones might not.
    See also BZ description.
    
    Test plan:
    [1} Check SHOW CREATE TABLE borrower_attribute_types to see if you
        have any index and FK constraint on category_code.
    [2] Run updatedatabase.
    [3] If you had category_code_fk, it should be replaced.
    [4] Remove index and constraint again using things like:
        alter table borrower_attribute_types drop constraint `borrower_attribute_types_ibfk_1`;
        alter table borrower_attribute_types drop index category_code;
    [5] Run updatedatabase.
    [6] You should have KEY category_code and FK borrower_attribute_types_ibfk_1.
    [7] Run updatedatabase. Idempotent, no changes.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7989e661f70a22377348692a9b67e190dab0efc2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 25 15:37:33 2022 +0100

    Bug 30610: Update on click binding for print receipt
    
    This patch updates the binding for the on click even of the print
    receipt button so that subsequent pages in the datatable work with the
    reciept printing button.
    
    Test plan
    1) Enable cash management and process enough transactions to display
       more than one page of transactions in the register details page.
    2) Confirm the 'Print receipt' button works on the first page of
       transactions
    3) Confirm the 'Print receipt' button works on subsequent transactions
       pages in the datatable.
    4) Confirm the same for the past transactions table.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a8a32f11242738dc2356d5ec9023641f0afaea52
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 2 09:25:58 2022 -1000

    Bug 30565: DBRev 21.12.00.040
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 748036ef679b867a929beec77d9d3144c075677a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Apr 20 11:37:31 2022 +0000

    Bug 30565: DBIx schema change for stockrotationrotas
    
    No test plan.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 880a994a785aa289d487156ef79557b8c1b563a1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Apr 20 11:29:58 2022 +0000

    Bug 30565: Database revision for stockrotationrotas
    
    Add unique key if needed.
    Adjust description column to make it NOT NULL.
    
    Test plan:
    (Optionally:) Drop unique key, make description nullable.
    Run dbrev.
    Check if unique key present, and description not-nullable.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2c250ef312215c527c4b21f63ba3df4ea60eb357
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Apr 20 11:22:15 2022 +0000

    Bug 30565: Correct kohastructure
    
    The unique key was added in a dbrev and is referred to in code.
    But forgotten in kohastructure.
    
    Test plan:
    Run new install or kohastructure.sql on empty db.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bbc0dbeb21130107e881668ab4e01304a9d338cf
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Apr 28 20:24:45 2022 -1000

    Bug 24001: (follow-up) Fix t_Profile.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 83bd88e04085330b6596901f13b8ef3e6553bc7e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Apr 22 15:19:29 2022 +0100

    Bug 30576: (follow-up) Corrections to behaviour to reflect unit tests
    
    The unit tests highlighted my original patch didn't cover the full
    preference description.
    
    We now replace the 'standard' option with the fields from the preference
    and we also add those fields as options to the field selection in
    advanced searches.
    
    This patch also adjusts the tests to test for that and reflects the
    expected changes to the number of options displayed in the select boxes.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a54646ff69a8ce954c12e5b9608117357501a4fb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 21 12:52:32 2022 +0100

    Bug 30576: Use DefaultPatronSearchFields in patron search
    
    This patch corrects the handling of the 'Standard' search field in
    patron searches such that it accurately reflects the contents of the
    DefaultPatronSearchFields system preference and falls back to a hard
    coded list instead of always using the hard coded list.
    
    To test:
    1) Empty the contents of DefaultPatronSearchFields systempreference
    2) Perform a patron search from the header search
    3) Inspect the patrons API request and note that we search on the
       default fallback fields of firstname, surname, othernames,
       cardnumber and userid (and some extended attributes which are
       historically hard coded).
    4) Navigate to the memebers-home by clicking the 'Patrons' button from
       the main page
    5) Perform another search using the filters on the left with 'Standard'
       selected.
    6) Note the same list of search fields used as above in the patrons API
       request.
    7) Update the DefaultPatronSearchFields systempreference adding one or
       more borrower fields in a comma delimited list.
    8) Repeat steps 2 -> 6 but this time upon inspecting the API request you
       should find that only the fields in your DefaultPatronSearchFields
       list are searched (along with the hard coded extended attributes
       list).
    9) Signoff
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 976f893c06a299788b7cc936b06060412fce832b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 28 15:00:29 2022 +0200

    Bug 30626: Don't generate the query if no term passed
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e02e1cba5f790a76f8e8d54b0b956e50e8af1ff6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 27 11:52:21 2022 +0100

    Bug 30626: (QA follow-up) Fix test plan
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7148e222d5834073414aa7c015c72e374b35bb1b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 27 12:34:11 2022 +0200

    Bug 30626: Fix test
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cf630a5169d2e29c3731436dc63d7d32d342e656
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 27 12:33:03 2022 +0200

    Bug 30626: DT REST API wrapper - Fix general search
    
    The general search query is not built correctly.
    
    Say you have a table with column filters, like the main patron search:
    General filter: henry
    Specific filter on the 'Name' column: h
    
    The generated query will be (= are actually LIKE):
    { Column1="henry" AND Column3="henry", ...} AND { Column2="h" }
    
    The first term does not contain the Column2 attribute.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f2d2ab18106ec9db29a66d4ce4781dae47d6792b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 28 09:43:06 2022 +0200

    Bug 30630: Prevent crash on check-in if HoldsAutoFill is ON
    
    RevertWaitingStatus has already removed the itemnumber from the hold, passing $itemnumber (from scanned item) should work, as it will reattach the hold to the item
    
    Test plan:
    1 - Enable HoldsAutoFill
    2 - Place a title level hold
    3 - Check in an item and confirm hold
    4 - Switch to another branch
    5 - Checkin the item
    Without this patch you got
    Can't call method "biblionumber" on an undefined value at /kohadevbox/koha/C4/Reserves.pm line 1577.
     at /kohadevbox/koha/C4/Reserves.pm line 1576
    With this patch applied the operation succeeds
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dedc0ae83f945546cbd52d5345f59bc3ecc9f101
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 4 16:19:35 2022 +0000

    Bug 24001: Fix Card template/rpinter profile creation and edit
    
    This patch adjusts the template/profiles to use the default of '0'
    This should probably be NULL, and the columns foreign keys, this code
    could use a further rewrite, but this should fix a long standing bug
    
    To test:
     1 - Using the fresh install, with all the sample data.
     2 - Go to Home › Tools › Patron card creator › Templates
     3 - New > Card template
     4 - Save
     5 - Error: DBD::mysql::st execute failed: Incorrect integer value: '' for column 'profile_id' at row 1
     6 - Edit an existing template
     7 - Save
     8 - Error: Can't bless non-reference value at /kohadevbox/koha/C4/Creators/Profile.pm line 89
     9 - Create a new 'Printer profile'
    10 - Save
    11 - Error: DBD::mysql::st execute failed: Incorrect integer value: '' for column 'template_id' at row 1
    12 - Apply the attached patch.
    13 - Verify you can create a new 'Card template' and 'Printer profile' with no errors
    14 - Verify you can edit and save both of the newly created objects above
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b3142cfe4363ee163f56076ec9275442f962b077
Author: Philippe Blouin <blou@inlibro.com>
Date:   Tue Jun 30 12:50:09 2020 -0400

    Bug 24001: Fix patron card template edition
    
    Error when saving Patron card Template:
    Can't bless non-reference value at
    /home/vagrant/kohaclone/C4/Creators/Profile.pm line 89
    
    This is caused by the profile dropdown offering invalid choices and is
    fixed by adding a filter to limit options to creator = 'Patroncards'.
    The UI already handles the case where no valid profile is avaiable.
    
    Signed-off-by: Alexis Ripetti <alexis.ripetti@inLibro.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 593a258238aa86155160e94c5800e6c9fa05eab5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 28 15:44:16 2022 +0200

    Bug 30644: (bug 29788 follow-up) Make Koha::Item->safe_to_delete use Koha::Result::Boolean
    
    Fix item deletion
    
    Wrong if/else!
    
    Test plan:
    Delete an item
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c48aac0ffc41ad8f2c7208df419b5f70a39213b8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 27 11:16:21 2022 -1000

    Bug 29092: DBRev 21.12.00.039
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 57dab88f0335cf03121117b52d953c3108d11bda
Author: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
Date:   Thu Apr 21 09:27:17 2022 +0300

    Bug 29092: Add timestamp to account-fines table column settings
    
    Table settings for the account_fines table (in the Patrons section, the
    "Transactions" table in a patron account) are missing a checkbox for the
    "Updated On" column. Because of this, one cannot hide the Updated On
    column and any other values one sets here get applied to the wrong
    columns.
    
    This patch adds timestamp to account-fines column settings.
    To test:
    
    1) Navigate to columns settings page and modify account-fines tables
       column.
       => Note that if you hide e.g. account_type column, column
       credit_number is hidden on patrons account page
    2) Apply patch and update database.
       => Account-fines column settings has now a option to hide timestamp.
       => Correct columns should now be hidden.
    
    Sponsored-by: Koha-Suomi Oy
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b607ea691ead15583d4462d9ffe57b1040a0e2b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 27 10:56:39 2022 -1000

    Bug 30136: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 84d1f3ce9476000dc88f11da8b6bf3a9bae9c923
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 25 11:03:40 2022 +0000

    Bug 30136: (follow-up) CSS and accessibility update
    
    This patch adds the new CSS to the global CSS file. Rebuild the OPAC CSS
    to test.
    
    The patch also moves the JavaScript for the button from opac-bottom.inc
    into global.js and adds accessibility labels to the generated markup.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 09d3b36c0865a2612d750b4190513d6e8d42cf28
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Feb 18 10:44:14 2022 -1000

    Bug 30136: Add back to top button to OPAC
    
    Like in many websites, when scrolling down the page make a button appear to go back to top.
    This can be very useful specially in search results page.
    
    This patch adds to OPAC using Javascript a button with id "backtotop".
    Button appears when 300 pixels from top are hidden.
    This value may be adapted.
    
    Test plan
    1) Go to OPAC
    2) Perform a search with many results
    3) Scroll down
    => Back to top button appears
    4) Manually scroll back to top
    => Button disappears
    5) Scroll down and click on Back to top button
    => You get to top
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit af206b78bc4ebcb619ffa78822bf3819e3557dc6
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 27 10:46:14 2022 -1000

    Bug 29648: DBRev 21.12.00.038
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 33a2610b5b557b7e012f7cc54d44a6fe53b79806
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 27 10:34:04 2022 -1000

    Bug 29648: (follow-up) Add missing raw filter
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 287f30b0a024a710ba6071590a20397a02e2781f
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Apr 27 16:19:21 2022 +0000

    Bug 29648: (QA follow-up) Remove NumSavedReports from .pref file
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e8f150978c1afa271522706386200ca741b48d7f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 27 17:04:28 2022 +0100

    Bug 29648: (QA follow-up) Minor POD fix
    
    This just adds a top level set of POD headings to make the QA script
    happy
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6f222544c4aca3f71dc0f731f609ed6c78b2bf09
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 6 15:11:40 2022 +0100

    Bug 29648: Fix occurrences of GetColumns
    
    We could add the configuration to these tables as well, but let go first
    but the others (read: feeling lazy right now).
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cc161ce239aabd029d012a571865dc873f57015a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:04:17 2021 +0100

    Bug 29648: Returns - no change
    
    No change expected here, there is no sort and no paginate possible.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ee5cca27dd567210a1ce93f91ea2898ec17602d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:12:39 2021 +0100

    Bug 29648: Upload tool - no sort
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1f2b4a3275d6b63f526904a9fb6480673c85ef7f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 12 15:47:59 2022 +0100

    Bug 29648: Remove default sort order for detail
    
    On the detail view the number of columns changed, we cannot use the
    default sort order here.
    It certainly can be done on a different way but I prefer to postpone it
    for now and see later.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 93f1c20cb492e477f3f496eca4b5ffbc59e63c67
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:09:28 2021 +0100

    Bug 29648: Notice template - only sort
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a66b6cda96fe38a051c2274356015cb3eae0028b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:16:15 2021 +0100

    Bug 29648: Holds history - no sort
    
    because of desc
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7b42eace96ac050bff80eed6bc8a4bc2fcb7b695
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:15:34 2021 +0100

    Bug 29648: Log viewer - no sort
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 997972e5747b1957f8efefb2a85b57a27b65bd54
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:08:20 2021 +0100

    Bug 29648: Subscription detail - no change
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 05f9380c0a9c9576ee3b196ac118ece08acf3e31
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:07:05 2021 +0100

    Bug 29648: Item lost report - no change
    
    hum, there is no sort on this table, so it's displayed like it's coming
    from the controller, but perl code does not sort either.
    This could be improved and we could make it configurable easily
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3fd513eaef1eade947c6b1e8a67f74b6a70d9088
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:02:50 2021 +0100

    Bug 29648: patron list table - normal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 769ecadcce92e0991cad9b3604bf9d2fcede5746
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:01:48 2021 +0100

    Bug 29648: Checkout history - no sort
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fb963367399670ddd51e4a5800a6432e1b678fee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 14:00:59 2021 +0100

    Bug 29648: Payments - normal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e936655b88ae46d8ead90b34d6b075d760af2a44
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:59:15 2021 +0100

    Bug 29648: Patron page (PatronsPerPage) - no change
    
    PatronsPerPage should be done on a separate bug report, not trivial
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ccb08d5bc2e536e63c74da2b7106adc2311b7da2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:15:09 2021 +0100

    Bug 29648: Patron accounting page - no sort
    
    because of desc
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 698ce8adc635cf6e7420d21eb529efe1c51cd4d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:13:27 2021 +0100

    Bug 29648: ILL - no change
    
    No change expected here for ILL
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2d6466d1c0739c1e397edf1eed82132778e7f4d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:10:26 2021 +0100

    Bug 29648: Course reserve list - normal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3fb4d84a802b6b09095703bef94de5524dfbc3fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:09:38 2021 +0100

    Bug 29648: Course reserve detail - normal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9e8cadcd4d1bf476f95d514e3cc6ede8ac5bf114
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:05:40 2021 +0100

    Bug 29648: Holds queue - only sort
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e38ad9c61abf24a959db61e3fda5991f48a200ef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:03:01 2021 +0100

    Bug 29648: Holds ratios - normal but no sort
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3304e760ab8150d5fcb2c2850565ae54aa5f50c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:01:58 2021 +0100

    Bug 29648: Holds to pull - normal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 32dd0e143dd96c0f93be5f6f595c564ef3dbb8f7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 13:00:30 2021 +0100

    Bug 29648: Overdue list - normal
    
    'stateSave' so need to test on the first try or delete the relevant local storage
    entry
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 59fbc0d400f15df7d8b1f0896b100baf5c1a4627
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:56:00 2021 +0100

    Bug 29648: Cataloguing Z3950 search - no pagination
    
    Pagination is done server-side
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42def27b57d2c7bf2a0078995a4d3d59c7e01b0a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:54:01 2021 +0100

    Bug 29648: Checkout history - normal no sort
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 04db082e71496a802c9a3f7df5c0ae8eec5d204e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:48:57 2021 +0100

    Bug 29648: Catalogue detail - no default_display_length
    
    On the acquisition table the sort option is not available as we don't
    offer the ability to selection asc/desc and default to asc.
    We cannot offer default_display_length for those tables.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7374d29525e4b1347c0bc5c6b687101f315aecce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:45:24 2021 +0100

    Bug 29648: DBIC Schema changes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 25621d7c26319a881ffe16f90ab89c487627a84a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:41:06 2021 +0100

    Bug 29648: Allow tables_settings.default_display_length to be NULL
    
    We actually want this value to be NULL. If set to NULL and
    default_display_length is not in the yml, then the option will not be
    displayed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dde3c5bdeb63f436510c70f52571e1bb93486480
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:26:21 2021 +0100

    Bug 29648: Item types administration view
    
    Set noItemTypeImages and OpacNoItemTypeImages to "No" and confirm
    that the first column (the image) is not displayed. Otherwise test as
    "normal"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 60f41d624b3790210e176a9f23f57ac849e30f49
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:24:20 2021 +0100

    Bug 29648: Cities administration view - REST API
    
    Here we need to deal with the other DT config (in datatables.js, not
    columns_settings.inc).
    
    Test plan:
    Same as "normal"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4683827ce825bc57922dcb3800fde979b4a91a10
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:17:30 2021 +0100

    Bug 29648: Patron categories administration view - normal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f1dfa181d2164cc0e69a569a0894a08d7e0b9ba9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:16:10 2021 +0100

    Bug 29648: Libraries administration view - normale
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 70f25d5873ec8133bcef10ffa4b8d88f7904a51b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:15:10 2021 +0100

    Bug 29648: Authorised values view
    
    No change is expected on this view as the table is not part of the table
    settings.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f3fa68d7d9e953192851ef0c7a2e28b5a0e81ab9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:13:14 2021 +0100

    Bug 29648: Late orders view - normal
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dabf936f35c091c90c8d105169f1cd66d7748af2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:11:57 2021 +0100

    Bug 29648: Order search view - normal
    
    "normal" means that we are expecting the table to have the 2 options
    implemented and working.
    You can select "Default display length" and "Default sort order"
    in the "table settings" administration view, then go the the view
    and confirm that the table has the configured values pre-selected.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 45291c5f054c7b7d8683c48c03e0bc9165ad6bd8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 12:05:46 2021 +0100

    Bug 29648: Duplicate orders view - no change
    
    No change expected here, only removing commented-out code.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 861eeae1a9ac846ad4bc6244f8d5722ae0f5c16d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 11:57:12 2021 +0100

    Bug 29648: Add item - broken FIXME
    
    Why don't we have the columns visibility button?
    
    It looks like there is something broken here, why don't we have the
    show/hide columns buttons? The code expects it to be displayed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2be3e079708e5beb0453e3534a9098af710cb3e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 11:50:58 2021 +0100

    Bug 29648: Move NumSavedReports to the table settings
    
    The syspref NumSavedReports can be moved to the table settings config
    Test plan:
    1. Set the syspref to a given value
    2. updatedatabase # execute the atomic update
    3. Go to the table settings page and confirm that the syspref's value
    has been retrieved
    4. Select a specific colonne for the default sort
    5. Go to the report list view and confirm that the "Show X entries" has
    the correct selected value and that the table is sorted as you expect.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0f83b0fe20a80b52060106dd2882fbf2f711fc62
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 11:34:02 2021 +0100

    Bug 29648: Improve existing code
    
    We already have 2 tables that are configurable, on acqui/basket and
    reports/orders_by_budget.
    This patch is modifying a bit the existing code to transfer the
    responsability/logic to the KohaTable constructor instead of the
    template that is creating the object.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 36dbe774511330bd9f672b0ec0750babab87053a
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sun Apr 24 22:55:05 2022 -0300

    Bug 30373: (follow-up) Add BNF z3950 server
    
    This is not strictly necessary, but is useful to do the testing
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a211106cd4a0743aeb2fb12c95a242fed4328719
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sun Apr 24 22:05:05 2022 -0300

    Bug 30373: (follow-up) Enable 'qualif' authorised_value
    
    This patch reinstates the authorised value 'qualif'
    to it's corresponding place
    
    This authorized value is used in UNIMARC default bibliographic
    framework.
    
    To test:
    1) Do a clean install or load the YAML file
    2) Verify 'qualif' authorised_value is present in subfield $4 of
       fields 700/1/2/3, 710/1/2/3, 720/1/2/3 and 730
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6bfcf4ea526222d263dd6f2ae50ba55f30edcc9f
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sat Apr 23 20:47:55 2022 -0300

    Bug 30373: (follow-up) Optional SUGGEST auth values
    
    This patch adds 3 SUGGEST optional auth_val.yml
    
    This authorized value is used in UNIMARC default bibliographic
    framework.
    
    To test:
    1) Do a clean install with optional files or load the YAML file
    2) Verify new SUGGEST values are in the database
        SELECT * FROM authorised_values WHERE category = 'SUGGEST';
    
        Check new values Budget, Expensive and Poldoc
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b217ca6027176ce631626dfc646642b166c0e6e
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sat Apr 23 19:11:40 2022 -0300

    Bug 30373: (follow-up) UNIMARC relator codes auth values
    
    This patch adds UNIMARC relator codes into
    mandatory auth_values.yml
    
    This authorized value is used in UNIMARC default bibliographic
    framework.
    
    To test:
    1) Do a clean install or load the YAML file
    2) Verify new language codes are in the database
        SELECT * FROM authorised_values WHERE category = 'qualif';
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3b01eb450de3b826e23f3a583f0a66e7dc501fe9
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sat Apr 23 18:28:53 2022 -0300

    Bug 30373: (follow-up) Language codes auth values
    
    This patch adds language codes (ISO 639-2) into
    mandatory auth_values.yml
    
    This authorized value is used in UNIMARC default bibliographic
    framework.
    
    To test:
    1) Do a clean install or load the YAML file
    2) Verify new language codes are in the database
        SELECT * FROM authorised_values WHERE category = 'LANG';
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d8bb68e40f3c9ef9c344c4c0b0d2d4e1981a83fd
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Sat Apr 23 18:14:32 2022 -0300

    Bug 30373: (follow-up) Country codes auth values
    
    This patch adds COUNTRY codes (ISO 3166-1) into
    mandatory auth_values.yml
    
    This authorized value is used in UNIMARC default bibliographic
    framework.
    
    To test:
    1) Do a clean install or load the YAML file
    2) Verify new country codes are in the database
        SELECT * FROM authorised_values WHERE category = 'COUNTRY';
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 05fd2369f01a4d787af25dc41a8c00e6a0597345
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Apr 26 14:59:59 2022 -1000

    Bug 29077: (follow-up) Use another syntax
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8bb51dccb09722bde33b34ca5fa24f3181799454
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 22 12:55:19 2021 +0000

    Bug 29077: Remove blank indexes before convert
    
    To test:
    1 - Be using Elasticsearch
    2 - Search on OPAC with dropdown set to 'Library catalog'
    3 - Warns in plack-opac-error.log
    4 - Apply patch
    5 - Repeat
    6 - No warns
    7 - Search returns correct results
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0ba9d950988522d9242b2c7ef251780c02bb1fd0
Author: Adam Styles <adam.styles@esa.edu.au>
Date:   Fri Mar 4 11:22:38 2022 +1100

    Bug 30224: Show correct important field in cataloguing validation
    
    This patch fxes the cataloguing validation messages to show the correct tag, when the whole field is important (not just a subfield).
    
    Note: Look at Bug 30159 to fix the formatting of the validation popup.
    
    1. Go to Administration -> MARC bibliographic frameworks
    2. Click Actions next to a framework, view MARC structure
    3. Edit multiple tags (at least 2) and check the Important checkbox.
    4. Go to cataloguing and create a new record using the framework you just edited
    5. Don't fill any of the important fields. Click Save to force the validation for the important tags
    6. Notice that the error message shows that an important field isn't filled, but the tag number shown is repeated for each message. The 'Go to field' link goes to the right tag, but the tag number shown is incorrect.
    7. Apply patch and refresh page
    8. Click Save to force validation again.
    9. Confirm the correct tag number is now showing for each error message.
    
    Sponsored-by: Education Services Australia SCIS
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 545922e4cbde833494155a25382e23ff8f59e7e3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 7 09:36:00 2022 +0000

    Bug 30482: Potential for bad string concatenation in cataloging validation error message
    
    In validating the basic MARC editor form before submission, we run
    AreFieldsNotOk() twice (once with the parameter "false") and concatenate
    the result for output. This creates the potential for the error string
    to be appended with "0" if AreFieldsNotOk() returns false.
    
    This patch improves the logic around building the error string.
    
    To test, apply the patch and make sure one of your MARC frameworks
    contains at least one mandatory field and at least one important field.
    
    - Edit or create a MARC record in the basic MARC editor.
    - Submit the form in various states of completion:
      - If a mandatory and an important field are empty, you should see two
        error messages at the top. "The following mandatory subfields aren't
        filled" and "The following important subfields aren’t filled."
      - If a mandatory OR an important field is empty, you should see a
        single message.
        - If it's the important field which is empty, a confirmation will
          ask if you want to save the record anyway. Test that both answers
          to this confirmation work correctly.
      - If no mandatory or important fields are empty the form should
        submit.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 763bfaa55b3391c1927b6e81482d7bc32f3a4351
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Apr 26 14:17:00 2022 -1000

    Bug 30072: (followup) Fix random failure of Holds_hooks.t
    
    When building Koha::Holds object,
    do not let 'found' random otherwise it may take a valid value indicating
    hold is found.
    
    See other holds unit tests.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cf8f7aafff074a1863be38c3f196152742fd027b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Apr 25 20:52:19 2022 -1000

    Revert "Bug 28371: Unit tests"
    
    This reverts commit 7e98a8a686ccf112f7aeaa181c4e5e19ec750277.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0e880cf2336a9bac72519b41e8d4aca6bc5ed493
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Apr 25 20:52:17 2022 -1000

    Revert "Bug 28371: Passpreviously fetched branches and itemtypes through and fetch all needed AV at once"
    
    This reverts commit 8e1d5d4b8fa416992abd072a0453d280ea34348e.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 832510bdab50cea7daafc9fbb6c99d9052980cec
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 21 13:48:47 2022 -0300

    Bug 30587: Fix acqui/supplier.tt translate issues
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d64727bccc1856a0dc3433e41b0dabe43538e349
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 21 13:24:06 2022 -0300

    Bug 30587: Fix opac-tags.tt translate issues
    
    This patch addresses one specific case.
    
    To test:
    1. Run:
       $ kshell
      k$ cd misc/translator
      k$ perl translate update es-ES
    2. On your git checkout run:
       $ git diff | grep '\[% limit or'
    => FAIL: That shouldn't be translated
    3. Run:
       $ git reset --hard HEAD
    4. Apply this patch
    5. Repeat 1 and 2
    => SUCCESS: No attempt to translate that tag
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6d4ed3b70c7e1f3c71fdb6a2e418bfb02dd58e3b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 22 13:25:00 2022 +0200

    Bug 30596: Prevent api/v1/acquisitions_baskets.t and api/v1/acquisitions_funds.t to fail randomly
    
    because of updated_on
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 01e72549ff25238349d96546a93cc74d3429ce19
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 2 16:21:41 2022 +0000

    Bug 30191: Authority search result list in the OPAC should use 'record' instead of 'biblios'
    
    This patch updates the OPAC authority search results page so that it
    uses the term "record" instead of "biblio."
    
    The patch also changes how the template outputs the count of records so
    that it is correctly pluralized, e.g. "1 record" vs. "2 records."
    
    To test, apply the patch and perform an authority search in the OPAC.
    
    In the search results, confirm that the last table header reads
    "Records." The information in that column should be correct, using the
    word record or records.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2bbc684f8a3d03aa7a47f670f557a378ab13f247
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 13 17:07:55 2022 -0300

    Bug 30534: Remove guarantor_id attribute from the patron object
    
    This patch removes an attribute that was actually removed 3 years ago
    and causes an exception when trying to search for it. The API responses
    don't include it anyways.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ec6743b1e1a8e369442743c72708507f9252d2e5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Apr 25 09:50:16 2022 -1000

    Bug 30405: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1bd33c93f97489a8a23ddac5ebb252d653fc51a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 8 10:22:05 2022 +0200

    Bug 30405: Reduce font-size for address in patron search result
    
    The address has a font-size: 110%, it's not needed here, 100% is enough.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 24cb4f71f4f268c119208d502d9c340d27b59574
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 15 11:45:08 2022 +0000

    Bug 29155: (follow-up) Work around change to jQueryUI tab API
    
    For some reason, with the combination of jQuery 3.6.0 and jQueryUI
    1.13.1, the way to access the current active tab's link has changed.
    Previously the tab activate event would provide information about the
    link as "ui.newTab.context." It appears that "context" is no longer
    available.
    
    This patch updates the two instances in Koha where this process is
    broken.
    
    To test, apply the patch and check out to a patron with holds on their
    account.
    
    - When the checkout page loads, confirm that each tab loads its contents
      correctly when clicked.
    - Check that the correct tab is activated when you append the tab link
      to the page url, e.g.
    
      /cgi-bin/koha/circ/circulation.pl?borrowernumber=XXX#reldebarments
    
      ...which should select the "Restrictions" tab for you. You may need to
      try this in a new tab or shift-reload to get the browser to look for
      the hash.
    
    - Perform the same tests on the patron details page.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1977cadf96c29645a9b8286e4ef0572321d44d34
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 3 17:38:44 2022 +0000

    Bug 29155: Update links to jQuery and jQuery Migrate files
    
    With these patches, jQuery versions in the OPAC and staff interface are
    both updated to 3.6.0. The latest version of jQuery Migrate is installed
    to allow us to take a slower approach to updating out-of-date syntax.
    
    To test, apply the patch and try as many pages as you can, paying
    attention to the browser console to watch for errors.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a71954f5da4d9d862252372fc32fe080c476e337
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 3 17:33:17 2022 +0000

    Bug 29155: Upgrade jQuery and jQuery Migrate to latest versions
    
    jQuery is upgraded from 2.2.3 to 3.6.0.
    jQuery Migrate is upgraded from 1.3.0 to 3.3.2.
    
    The next patch will update links to point to the new assets.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d3101bb5dca8d212670e83fcfcece583eab77573
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 21 19:23:14 2022 +0200

    Bug 30584: Fix ES mapping creation
    
    We need to tell DT that we are adding/removing row, not only deal
    manually with the DOM.
    
    This patch also fixes the following bug: if you add or remove a row from
    the "biblio" tab, then go to another tab and back to "biblio", all
    changes were gone (bug existed prior to bug 29893).
    
    Test plan:
    Add, edit and remove mappings, switch from tabs and save.
    Use the filters, save (29893 regression test)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 83da2adc7283408bb0e4a9c57b5f52ff3f4cee34
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 11:35:41 2022 +0200

    Bug 30461: Fix BatchUpdateAuthority
    
    Use of inherited AUTOLOAD for non-method Koha::BackgroundJob::BatchUpdateAuthority::ModAuthority() is
    no longer allowed
    
    Test plan:
    Use the batch authority tools to edit authority record and confirm that
    the task processes correctly
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f25031693246ec1a2992a1712be0caf7e17ed515
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Apr 21 02:09:23 2022 +0000

    Bug 30288: (follow-up) Use CSS for separator pipes
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d924aa4d39e19e52923d138cc5f237cd4ca70eb2
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Apr 24 14:29:26 2022 +0200

    Bug 28840: (QA follow-up) Update id to ID
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2df4336fcc6b5032238473391276178530814f80
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Aug 10 12:03:58 2021 -1000

    Bug 28840: Better texts in batch record modification/deletion
    
    Tools batch record modification/deletion form contains texts in legends, labels, hints.
    
    I feel like :
    Labels are sometimes too long, showing them on multi-lines, like "Modify record using the following template". Long texts should be in legend or hint.
    Legend are sometimes contains redundant text, like in tabs.
    Also I propose to use "record id" instead of "record number".
    
    Test plan :
    Compare texts in page without and with patch
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8e1d5d4b8fa416992abd072a0453d280ea34348e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Aug 25 15:26:23 2021 +0000

    Bug 28371: Passpreviously fetched branches and itemtypes through and fetch all needed AV at once
    
    This patch updates the searchResuls code to pass through the pre-constructed branches and itemtype lookups
    to XSLTParse4Display to avoid repeating this
    
    It also updates getAuthorisedValues4MARCSubfields to fetch the values for mapped subfields and pass
    then through to transforMarc4XSLT
    
    Note that we currently blank invalid branches and itemtypes - I presrve this, we should open another bug
    if we want to change this behaviour
    
    Changes are covered by tests
    
    To test:
    1 - Perform searches in OPAC and staff client that return many records
    2 - Use the 'Network' tab on the browser console (opened with F12 usually) to see the time taken
    3 - Note the speed before the patch
    4 - Apply patch
    5 - restart all the things
    6 - Note improvement in speed
    
    **Note: The improvement is more drastic the more items per record, try adding large numbers of items to your search results to test**
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7e98a8a686ccf112f7aeaa181c4e5e19ec750277
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Aug 25 15:25:56 2021 +0000

    Bug 28371: Unit tests
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fb41768d9fac8d4eb4bff171019ce43acab4a400
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Apr 25 10:29:05 2022 +0000

    Bug 27253: (follow-up) Fix UNIXTIME(0) in db_revs/211200037.pl
    
    MariaDB [koha_myclone]> update borrowers set updated_on=COALESCE( NULL, FROM_UNIXTIME(0) ) where borrowernumber=51;
    ERROR 1292 (22007): Incorrect datetime value: '1970-01-01 00:00:00' for column `koha_myclone`.`borrowers`.`updated_on` at row 1
    
    MariaDB [koha_myclone]> update borrowers set updated_on=COALESCE( NULL, FROM_UNIXTIME(1) ) where borrowernumber=51;
    Query OK, 1 row affected (0.008 sec)
    Rows matched: 1  Changed: 1  Warnings: 0
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested by switching updated_on to datetime. Remove NOT NULL, etc.
    Copied dbrev to atomicupdate folder.
    Resulted in:
        Updated all NULL values of borrowers.updated_on to GREATEST(date_renewed, dateenrolled, lastseen): 51 rows updated
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7d71fb052a56037086fdae2704fafe75673c1019
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 22 12:02:40 2022 +0200

    Bug 30373: Fix xt/find-license-problems.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8066f46db066a4fd6b8f7a7fa198f1369cbce779
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 22 10:18:08 2022 +0200

    Bug 30373: Fix unimarc authorised values
    
    1. Replace
      authorised_value: ""
    with
      authorised_value:
    to match what is done for marc21
    
    2. Fix some wrong category names
    -          authorised_value: 146a
    +          authorised_value: unimarc_146a
    
    -          authorised_value: 182a
    +          authorised_value: unimarc_182a
    
    -          authorised_value: 182c
    +          authorised_value: unimarc_182c
    
    3. Remove some category that have not been inserted (should we insert
    them then?)
    -          authorised_value: 183a
    +          authorised_value:
    
    -          authorised_value: qualif
    +          authorised_value:
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6844d613d9ca4173b7695909caf9b0893f0dad15
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 22 08:46:48 2022 -1000

    Revert "Bug 30373: (follow-up) Fix license"
    
    This reverts commit 15405829bffec99e82a23f221fa4a75ada2f0ac5.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c8199147b1054a1c4fe713668ee83a9654e5cfaa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 22 11:42:09 2022 +0200

    Bug 30595: Prevent update_child_to_adult.t to fail randomly
    
    t/db_dependent/selenium/update_child_to_adult.t ..         # Looks like you planned 3 tests but ran 2.
    
        #   Failed test 'Update child to adult'
        #   at t/db_dependent/selenium/update_child_to_adult.t line 132.
        # Looks like you planned 3 tests but ran 2.
        # Looks like you failed 1 test of 2 run.
    t/db_dependent/selenium/update_child_to_adult.t .. 1/1
     #   Failed test 'Update child to patron'
     #   at t/db_dependent/selenium/update_child_to_adult.t line 153.
    Cannot wait more for element '//input[@type="submit"]' to be visible at /kohadevbox/koha/t/lib/Selenium.pm line 189.
    
    It happens when there are too many patron's categories and the submit
    button is not in the viewport.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 74792b35a83a863fa5e68c37f0c0f552f0c21a7b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 22 10:54:42 2022 +0200

    Bug 28786: Fix 2FA selenium tests
    
    Looks like there was a bad rebase at some point.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 4c8987b64e4cee44c2bf3387052563a7816dc77c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 20 09:17:03 2022 -0300

    Bug 30446: (follow-up) Remove warning
    
    This patch removes a trivial warning caused by a parameter being
    compared to a literal but not being defined. Doing a
    
    $ git grep GetTagsLabels
    
    shows the change is safe as the function is always called with a value
    of either 0 or 1.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 24db0479e6b7db03821d2a302c2e621b017fef28
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Apr 4 11:50:01 2022 +0000

    Bug 30446: Add a test for GetTagsLabels
    
    Moved from obsoleted bug 2222 on its own.
    
    Test plan:
    Run t/db_dependent/AuthoritiesMarc_GetTagsLabels.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 31c4d213e3539e522071154ed0895268ac5e4a59
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Apr 21 20:07:39 2022 -1000

    Bug 27253: DBRev 21.12.00.037
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit eb2ca283d6da74191521b729256db9c910341ab6
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Mar 31 15:38:07 2022 +0200

    Bug 27253: Fix definition of updated_on in borrowers and deletedborrowers
    
    Test plan:
    1. First you have to be in a state where updated_on is NULL-able. You
       can do that by either:
       a) do a fresh install of Koha 16.05 and update to master, or
       b) execute the following SQL queries:
    
         ALTER TABLE borrowers MODIFY updated_on timestamp NULL
         DEFAULT current_timestamp() ON UPDATE current_timestamp()
         COMMENT 'time of last change could be useful for synchronization
         with external systems (among others)'
    
         ALTER TABLE deletedborrowers MODIFY updated_on timestamp NULL
         DEFAULT current_timestamp() ON UPDATE current_timestamp()
         COMMENT 'time of last change could be useful for synchronization
         with external systems (among others)'
    2. Create two borrowers (let's name them X and Y)
    3. Delete borrower Y
    4. Set the column updated_on to NULL for both borrowers by executing the
       following SQL query:
       UPDATE borrowers SET updated_on = NULL WHERE borrowernumber =
       <borrowernumber of X>
       UPDATE deletedborrowers SET updated_on = NULL WHERE borrowernumber =
       <borrowernumber of Y>
    5. Apply patch and run updatedatabase
    6. Verify that borrowers.updated_on and deletedborrowers.updated_on are
       not NULL-able.
       Verify that updated_on for X and Y have taken the value of
       dateenrolled.
    7. Repeat step 2 to 6 but this time renew the patron and/or log in with
       its account in order to set the columns borrowers.date_renewed and
       borrowers.lastseen before executing updatedatabase
       borrowers.updated_on should take the greatest value among
       dateenrolled, date_renewed, and lastseen
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d5e0bf50a1511e4cb98edd2c241d492e830c0a62
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 14 11:24:48 2022 +0000

    Bug 30531: Add mock of UseRecalls to Search.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit eda11a029397aef5fea4d3e821c6c87dd2519ede
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 12 11:56:43 2022 +0000

    Bug 30512: Staff interface search results template error
    
    This patch removes some markup from the search results template which
    was causing markup to be output on the screen. Rather than correct the
    markup so that the "p1" class is correctly added to the relevant links
    I'm removing it. The "p1" class isn't used anywhere.
    
    The patch also corrects two incorrect template filters on one of the
    page's links.
    
    To test, apply the patch and enable the following system preferences:
    
    - AmazonCoverImages
    - IntranetCoce (if available)
    - LocalCoverImages
    
    - Perform a catalog search in the staff interface which will return
      results with cover images from each of the enabled services.
    - The covers should show correctly in the search results with no markup
      being output on screen.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 15405829bffec99e82a23f221fa4a75ada2f0ac5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Apr 21 19:58:57 2022 -1000

    Bug 30373: (follow-up) Fix license
    
    Copy from MARC21 files
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ae38dbcb47f7651b90a8e49c5de043a4ac5abada
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 21 16:30:24 2022 +0200

    Bug 30583: Fix hold system for translated templates
    
    There are missing quotes, and the translate script is messing up with
    the generated template.
    
    Error is:
    Template process failed: file error - parse error - holds_table.inc line 216-217: unexpected token (hold)
    
    The generated line, without this patch is:
    216 <td><input %]="%]" class="printholdslip" data-reserve_id="[%" hold.reserve_id="hold.reserve_id" html="html" name="printholdslip" type="button" value="Recibo" |="|"></td>
    With this patch applied:
    216  <td><input class="printholdslip" data-reserve_id="[% hold.reserve_id | html %]" name="printholdslip" type="button" value="Recibo"></td>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2ee5b5b1247b392a1dfbe695315db32f76775b0a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 21 15:05:24 2022 +0200

    Bug 30532: (bug 29957 follow-up) Fix '$cookie->value'
    
    We got
     Can't call method "value" on unblessed reference at /kohadevbox/koha/opac/opac-messaging.pl line 86
    
    $cookie can be an arrayref, we should retrieve the session id using
    CGI->cookie('CGISESSID')
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 159a1a76c303d9a984b4d026640dd99348f88c28
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 13 14:07:53 2022 +0000

    Bug 30525: Items batch modification broken
    
    This patch modifies instances in the code which try to get cookies
    using:
    
    my %cookies = parse CGI::Cookie($cookie);
    
    In some cases the relevant lines can be removed because they are unused.
    In others it can be replaced with:
    
    my %cookies = CGI::Cookie->fetch();
    
    To test, apply the patch and restart_all. Test the following pages to
    confirm they load without errors:
    
    - Circulation -> Offline circulation file upload
    - Circulation -> Offline circulation -> Add to queue
    
    - Tools -> Batch item modification
    - Tools -> Stage MARC for import
    - Tools -> Staged MARC management
    - Tools -> Batch patron modification
    - Tools -> Upload local cover image
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 674ad809f391cddc83338b7ae787b86e6dd490f2
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Fri Apr 8 17:51:02 2022 -0300

    Bug 30373: Fix visibility, authorised values and descriptions
    
    This patch fixes certain values of default bibliographic
    framework.
    
    It fixes hidden values using as reference default framework
    from biblibre demo site.
    
    Also adds some missing subfields, authorised values and
    fixes capitalization on some descriptions.
    
    To test:
    1) On biblibre demo site, run a report
       SELECT tagfield,tagsubfield,hidden
       FROM marc_subfield_structure
       WHERE frameworkcode = ''
       ORDER BY tagfield,tagsubfield;
    2) Download as tab separated values, ej. biblibre-hidden.txt
    3) Apply the patch, remove bib frameworks, load YAML file
    4) Run something like this to check correct hidden values
    
       while read -r -a l; do
        t="${l[0]}";
        s="${l[1]}";
        h="${l[2]}";
        b=$( mysql koha -N -B -e "select hidden from marc_subfield_structure where frameworkcode = '' and tagfield = '$t' and tagsubfield = '$s'");
        [ -n "$b" -a "$b" != "$h" ] && echo "$t:$s: -> change $b to $h";
       done < <( cat biblibre-hidden.txt )
    
       there must be no output
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c7b4d311d43921c0744df680660c8a51247f0d22
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Fri Apr 8 18:18:00 2022 -0300

    Bug 30373: Add TYPEDOC authorised_values_category
    
    TYPEDOC authorised value category is needed to permit
    correct loading of default UNIMARC bibliographic framework.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 52b61767b331523a4d3c853aca35a263d861252a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 7 10:48:48 2022 +0200

    Bug 30373: Show 325$a
    
    It was not hidden in unimarc_complet/Obligatoire/framework_DEFAULT.sql
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit da975c95818c3e6e1e900254bca6cc6f2f057247
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 7 10:46:35 2022 +0200

    Bug 30373: Hide items.dateaccessioned from the editor
    
    -6 was used in unimarc_complet/Obligatoire/framework_DEFAULT.sql
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bf27a9f4283157336ac3b31db1a97dc170d62390
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Wed Apr 6 16:46:21 2022 -0300

    Bug 30477: Add new UNIMARC installer translation files
    
    Depends on Bug 30373
    
    This patch adds *-installer-UNIMARC.po translation files.
    
    For fr, it, uk and ru languages matching strings have been
    extracted from master (fr-FR) or 21.05 (it,ru,uk) UNIMARC SQL
    files. The mentioned languages shows some level of completion:
    
        fr-FR 76%
        ru-RU 61%
        it-IT 55%
        uk-UA 54%
    
    To test:
    1) Apply the patch
    2) Verify new files are present
       misc/translator/po/*-installer-UNIMARC.po
    3) Verify fr-FR, it-IT, ru-RU and uk-UA files
       have translated strings (inspect the files or use poedit)
    4) Install any of those languages, ej.
    
         misc/translator/translate install fr-FR
    
       then do a clean UNIMARC install and verify that
       authority and bibliographic frameworks shows translated
       strings.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a5c422daa6f54086767f2ee2f1b1d09fea73656b
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Mon Mar 28 00:50:01 2022 -0300

    Bug 30373: Enable translation of UNIMARC frameworks
    
    This patch adds a new translation file, *-installer-UNIMARC.po
    
    To test:
    1. On top of all previous patches
    2. Apply this patch
    3. Create (or update) some language
    Ej.
        misc/translation/translate create xx-YY
    
        verify new file misc/translation/po/xx-YY-installer-UNIMARC.po
    4. Install new language
        misc/translation/translate install xx-YY
    
        verify new dirs:
            installer/data/mysql/xx-YY/marcflavour/unimarc/{mandatory,optional}
    
    5. Repeat install procedure selecting xx-YY language and UNIMARC
       verify all frameworks are present
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4951822d5dd6a3e59bdf5819105f5e197f13c984
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Mon Mar 28 01:36:38 2022 -0300

    Bug 30373: Rewrite authorities_normal_unimarc to YAML
    
    YAML version of authorities_normal_unimarc + sample auth types
    Includes
    
    This files works like it's marc21 counterpart:
    * Defines an authority default framework
    * Creates sample auth types by copy
    
    Auth type codes and select fields/subfields are based on
    french files in fr-FR install directory.
    
    To test:
    1. Apply this patch
    2. Repeat UNIMARC install procedure as previous patches
    3. Verify authorities_normal_unimarc.yml is loaded without problem
    4. In the staff interface verify all auth types are present
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 69f17cf4c3a6b87cd8bba3347f1c27913b5d130b
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Mon Mar 28 01:27:11 2022 -0300

    Bug 30373: Add UNIMARC FA (fast add) framework
    
    This parch creates optional folder and a sample
    fast add framework
    
    To test:
    0. On top of first patch, repeat procedure to do an UNIMARC install
    1. Verify existence of FA framework
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b61dc91c2e4c3330c1ab8f0089e15d36211c2332
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Mon Mar 28 01:07:34 2022 -0300

    Bug 30373: Rewrite unimarc_framework_DEFAULT to YAML
    
    YAML version of unimarc_framework_DEFAULT + ACQ framework
    
    To test:
    0. Apply this patch, recreate database and restart_all
    1. Follow web installer, selecting UNIMARC, finish
    2. Default UNIMARC framework must load without problem
    3. In staff interface check existence of Default and ACQ frameworks
    
    ACQ is buit in the thame way as marc21, by copome fields/subfields.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 91b2adfbc895f332ee6533c517ea0ae34ce68c54
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 21 13:51:11 2022 +0200

    Bug 28786: Fix Patrons/Import.t
    
    DBI Exception: DBD::mysql::st execute failed: Data truncated for column 'auth_method' at row 1 at /kohadevbox/koha/Koha/Object.pm line 170
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4023704463dbcee4e7cf202e0ea9297e58082da7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 21 11:41:55 2022 +0200

    Bug 28786: Don't set auth_method to NULL in ->anonymize
    
    DBI Exception: DBD::mysql::st execute failed: Column 'auth_method' cannot be null
    
    caught by t/db_dependent/Koha/Patrons.t
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 11a485c54412103cc7bf61f7dd56b7c6c6b48b13
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Apr 21 19:21:27 2022 +1200

    Bug 28786: decrease Auth::GoogleAuth version to 1.02
    
    https://bugs.koha-community.org/show_bug.cgi?id=28786
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 17d04a93230233eeb99a8695171d100e7b9d2cc9
Author: Mason James <mtj@kohaaloha.com>
Date:   Thu Apr 21 16:20:26 2022 +1200

    Bug 28786: add Auth::GoogleAuth module to cpanfile
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8e48d69d9e4e7d359b27c6e689f41291e05e5bc9
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 09:14:40 2022 -1000

    Bug 28786: DBRev 21.12.00.036
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 267101a79211b221f4e095de742840a5609aca86
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 12 16:32:20 2022 +0000

    Bug 28786: (follow-up) Improve style of 2FA code input
    
    This patch cleans up login.css a little bit so that the same style rules
    which apply to the login screen apply to the 2FA input form as well.
    
    The patch also changes the "Log out" link on the 2FA form to a "Cancel"
    link alongside the "Verify" button.
    
    To test, apply the patch and start the process of logging in to the
    staff client using an account with 2FA enabled.
    
    On both the login form and 2FA code views, confirm that everything is
    styled consistently.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c09e312913180ae02e2b79eb2eb3bd7dd7f9bad2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 24 14:25:43 2022 +0100

    Bug 28786: DBIC schema changes
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e96f95edf1d74db32dd74dd0a4336adab516004d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 20 15:47:11 2022 +0100

    Bug 28786: Don't expose secret and auth_method to the REST API
    
    This can be done later if needed.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 75e11d85d0c8f39d920af5610a86e7c8f243a3a5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 18 12:45:17 2022 +0000

    Bug 28786: (QA follow-up) Check the returned CSRF token
    
    We're doing this in the registering stage and at disabling.
    
    Test plan:
    Ënable two-factor auth but logout/login on another tab. You should
    get the Wrong CSRF token when submitting.
    Do similar thing while disabling.
    Verify that you can register / disable when in the same session.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9ea5a8268dd53c3439ed5ad520916d436ad7ed2c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 17 12:53:46 2022 +0000

    Bug 28786: (QA follow-up) Do not call generate_secret32
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a47833c24b9286fe0be117f31e6799258311f687
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jan 13 07:52:33 2022 +0000

    Bug 28786: (QA follow-up) Fix qa warnings
    
     FAIL   members/two_factor_auth.pl
       FAIL   file permissions
                    File must have the exec flag
     FAIL   koha-tmpl/intranet-tmpl/prog/en/modules/members/two_factor_auth.tt
       FAIL   filters
                    missing_filter at line 42 (                        <p>Account: [% issuer %]</p>)
                    missing_filter at line 43 (                        <p>Key: [% key_id %]</p>)
                    missing_filter at line 54 (                            <input type="hidden" name="secret32" value="[% secret32 %]" />)
                    missing_filter at line 58 (                                    <img id="qr_code" src="[% qr_code_url %]" />)
     FAIL   Koha/Auth/TwoFactorAuth.pm
       FAIL   pod coverage
                    POD is missing for 'new'
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f03e2689d6a31d93240a95ab9bc4c0f3d3769008
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Dec 21 15:07:56 2021 +0000

    Bug 28786: (QA follow-up) Upgrade atomicupdate to new style
    
    Test plan:
    Run dbrev again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 90971d01ed82e57e323a2e8d3f81cfb6151aa859
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 13 23:19:24 2021 +0200

    Bug 28786: Add tests for checkauth
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d827ee310a7a9ff97cf46b1bca08b1afb546df62
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 13 23:13:44 2021 +0200

    Bug 28786: Correctly inherit from Auth::GoogleAuth
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2c2c3662349446acefb7f850088cfd58500d0e67
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 30 12:36:46 2021 +0200

    Bug 28786: Improve readability in C4::Auth::checkauth
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6eeb9bc1b30b437febd19e5a60f5ae2a0283e761
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 16:08:25 2021 +0200

    Bug 28786: Two-factor authentication for staff client - TOTP
    
    This patchset introduces the Two-factor authentication (2FA) idea in
    Koha.
    
    It is far for complete, and only implement one way of doing it, but at
    least it's a first step.
    The idea here is to offer the librarian user the ability to
    enable/disable 2FA when logging in to Koha.
    
    It will use time-based, one-time passwords (TOTP) as the second factor,
    an application to handle that will be required.
    
    https://en.wikipedia.org/wiki/Time-based_One-Time_Password
    
    More developements are possible on top of this:
    * Send a notice (sms or email) with the code
    * Force 2FA for librarians
    * Implementation for OPAC
    * WebAuthn, FIDO2, etc. - https://fidoalliance.org/category/intro-fido/
    
    Test plan:
     0.
      a. % apt install -y libauth-googleauth-perl && updatedatabase && restart_all
      b. To test this you will need an app to generate the TOTP token, you can
     use FreeOTP that is open source and easy to use.
     1. Turn on TwoFactorAuthentication
     2. Go to your account, click 'More' > 'Manage Two-Factor authentication'
     3. Click Enable, scan the QR code with the app, insert the pin code and
     register
     4. Your account now requires 2FA to login!
     5. Notice that you can browse until you logout
     6. Logout
     7. Enter the credential and the pincode provided by the app
     8. Logout
     9. Enter the credential, no pincode
    10. Confirm that you are stuck on the second auth form (ie. you cannot
    access other Koha pages)
    11. Click logout => First login form
    12. Enter the credential and the pincode provided by the app
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 639f96376a15ab1a867fe12048f5c7763d5b32ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 15:25:18 2021 +0200

    Bug 28786: Add controller script and template
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cbf12e601c9fd04f68715cee1d5c4b7e194b1702
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 15:40:07 2021 +0200

    Bug 28786: Add new DB column borrowers.auth_method
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 76ec37e8f495cd518b3e50c89998c94268077cc1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 15:12:49 2021 +0200

    Bug 28786: Add new DB column borrowers.secret
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 451e4b007d2597840c92abd9a5ec41c155b0daa0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 28 20:49:55 2021 +0200

    Bug 28786: Add new syspref TwoFactorAuthentication
    
    Sponsored-by: Orex Digital
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 313b85246efe4d81f75f38da3c0a9b76f9ac25b1
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Mar 1 16:11:40 2022 +0000

    Bug 30204: Add subtitle to serial search results
    
    To test:
    1. Make some new serial subscriptions and connect them to biblios that contain subtitles.
    2. Do a serial search that will return your newly created subscription.
    3. Notice the subtitle doesn't appear.
    4. Apply patch and restart_all
    5. Again try step 2.
    6. Notice the subtitle appears alongside the title now.
    7. Make sure it still sorts that column correctly.
    
    Signed-off-by: shiyao <shiyao@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e95dd5dc650890402a4624d50135c0de07c201f9
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 5 12:54:37 2022 -0400

    Bug 30204: Add unit test
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4ec5a186a29f7381abe314cb2f317dd04203ebbc
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Mar 1 16:30:04 2022 +0000

    Bug 30205: Add subtitle to subscription detail page
    
    To test:
    1. Make some new serial subscriptions and connect them to biblios that contain subtitles.
    2. Do a serial search that will return your newly created subscription.
    3. Click on one of those subscription to be taken to the subscription detail page.
    4. Look at the main heading (h1) and the "Biblio:" line. Notice there is no subtitle in either place
    5. Apply patch, restart_all, and reload the subscription detail page.
    6. You should now see the subtitle on both the main heading (h1) and on the 'Biblio:' line.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 17a14b3c1fc3372548c7b661ce2d68d824b987f0
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Apr 11 19:35:14 2022 +0000

    Bug 30346: Correctly transfer values when editing rules
    
    To test:
    --Create a circulation rule with a value in "Overdue fines cap (amount), or edit an existing rule to add it
    -Save the new (or edited) rule.
    -Edit the same rule again to change any other field. Note that "Overdue fines cap (amount)" is now blank
    -Save your edited rule - "Overdue fines cap (amount)" will save as blank.
    
    Apply patch
    
    --Create a circ rule with a value in Overdue fines cap (amount) and check "Cap fine at replacement price" for that same rule.
    -Save the rule
    -Try ediding the rule and make sure both of those values now save correctly.
    -Add several more rules and try playing with both "Cap fine at replacement price" and "Overdue fines cap (amount)". Make sure everything saves right.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c08d32feed55ef3d4c9e469b95b65088373dadf7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 13 19:42:06 2022 +0000

    Bug 18392: Add noExport of rows and don't export 'edit' row
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7f636b36fc74f2617c301b2c975111b82901fdc9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 13 19:10:43 2022 +0000

    Bug 18392: use KohaTable for circ rules to allow export of matrix
    
    To test:
    1 - Define some circ rules
    2 - View them, note the appearance
    3 - Apply patch
    4 - Reload and note change of header
    5 - Use the new button to export, try various formats
    6 - Test the filter and export
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aa1def3180f8bc2b0d08b0ac2e57bed29e47d27a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 15 10:41:57 2022 +0000

    Bug 30288: Provide links to OPACUserJS and OPACUserCSS in tools
    
    This patch provides easy access to the OPACUserJS and OPACUserCSS
    system  preferences in the Additional Contents (News and HTML
    customisations) sections.
    
    To test:
    
    1. In the staff client, go to Tools -> News. Notice there is a button to
       add a New entry. Confirm this button is also there when you go to
       Tools -> HTML customisations.
    2. Apply the patch and refresh the page.
    3. Confirm there are now two new buttons to take you to OPACUserJS and
       OPACUserCSS. Confirm these buttons take you to the correct system
       preference.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Bug 30288: (follow-up) Add permissions check
    
    This follow-up wraps the system preference links in a check for
    "parameters_manage_sysprefs" permission so that the links don't display
    to those without permission to access system preferences.
    
    Signed-off-by: Aleisha Amohia <aleishaamohia@hotmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0f9e82f6551e32e9de4024b7487da4af0ea0829a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 14:58:42 2022 -1000

    Bug 30226: DBRev 21.12.00.035
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 45e8a00ee98840f4c88520a025dc2da472ba1587
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 14:56:16 2022 -1000

    Bug 30226: (follow-up) Remove text from database update
    
    The text displayed by database update is not really helpful.
    And it will be incorrect if update is run several times.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 77cd5d301dc03dde41ceef5161df29e79d25461a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 15 09:43:26 2022 +0000

    Bug 30226: (QA follow-up) Sync atomicupdate with sysprefs.sql
    
    Description and remove choices.
    Set items => flag items (as in circulation.pref)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 47d5e07dfc9158507503415929aa297ec8ac220d
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Mar 4 21:06:17 2022 +0000

    Bug 30226: Add system preference AllowSetAutomaticRenewal
    
    To test:
    1. Apply patch, restart the things, and run updatedatabase
    2. Look for the system preference 'AllowSetAutomaticRenewal'.
    3. To preserve current behavior the system preference should be set to allow by default.
    4. Go to the circulation page and see that under 'Checkout settings' there is the option to set a particular item for auto renewal.
    5. Set 'AllowSetAutomaticRenewal' to 'don't allow'.
    6. Go back to the circulation page and under checkout settings you should no longer see the option to set an item for auto renewal.
    
    Signed-off-by: Kelly mcElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bd197c64567fba6899f12e4897d786adf52384d8
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Jan 10 04:27:27 2022 +0000

    Bug 29815: Pre-populate 'Date acquired' field when adding/editing items
    
    This patch pre-fills the 952$d (Date acquired) item subfield on page
    load. Users can still click on the field to fill this subfield.
    
    Test plan:
    1. Visit a biblio. Add an item, observe on page load the 'Date acquired' subfield is
    empty
    2. Visit a subscription. Receive a serial, observe after setting the serial status to 'Arrived' the item form loads with an empty 'Date acquired' subfield
    3. Apply patch and restart services
    4. Repeat step 1 and confirm now on page load the 'Date acquired'
    subfield populates with today's date
    5. Delete the populated 'Date acquired' subfield value. Click in the
    field and confirm the field is populated and the calendar input displays
    6. Delete the 'Date acquired' subfield value again. Confirm that tabbing
    from a different field into the date acquired field behaves the same as
    click
    7. Repeat step 2. This time confirm on page load the 'Date acquired' subfield
    contains the current date
    8. Delete the populated 'Date acquired' subfield value. Click in the
    field and confirm it is populated
    9. Delete the populated 'Date acquired' subfield value. Tab to the field
    from another field and confirm it behaves the same as click
    10. Visit a biblio. Edit an item with a date acquired value in
    the past. Confirm the date acquired value is unchanged after saving.
    
    Sponsored-By: Brimbank Library, Australia
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f55b16145c96167afc63784447cdb8420d49dbae
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 14:37:23 2022 -1000

    Bug 29602: (follow-up) fix TemplateToolkit.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8f84a3e8cfc04f793c9067af2582ae50e78d799b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 09:40:40 2022 -1000

    Bug 29602: (follow-up) Fix missing filters
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 833c9efee0c0e01a0223318b578efa77272ed958
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 14 13:26:59 2022 +0000

    Bug 30544: Add font awesome version to licenses page
    
    This patch simply adds the version number we are using
    and updates the link to point to our version
    
    To test:
    1 - Confirm the About->Licenses page points to the correct Font Awesome
        version
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7170874a9b7b3165461daa9d81fcfaf70bcc6485
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 10:51:26 2022 +0100

    Bug 26370: (QA follow-up) Add new option to templates
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 017bce3d7708c86bbf57057345eb60164926398c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Apr 11 06:37:58 2022 -0400

    Bug 26370: (QA follow-up) Rename option never_demagnitize to inhouse_patron_categories
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1cead727b4fe00d1982ae16689606fcbf3569348
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 11 07:51:45 2021 -0400

    Bug 26370: Add ability to disable demagnetizing items via SIP2 for arbitrary patron categories
    
    Some libraries have certain patron categories that can only do in house checkouts via SIP self check machines.
    In these cases, the items should not be demagnetized since the items cannot leave the library.
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/SIP/Message.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3fdcc4cde3c34875e95ff069a8e61aae33e293d2
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 05:06:12 2022 -1000

    Bug 30237: DBRev 21.12.00.034
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 30f598cebef0f37b58b2daf592a608ff717391d0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 8 16:43:01 2022 +0000

    Bug 9097: Add option to manually send welcome email
    
    This patch adds a new 'Send welcome email' option to the 'More' dropdown
    menu in the patrons toolbar.
    
    Clicking the button will queue the welcome email again for the patron and
    redirect the user to the Notices tab to view it's contents.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Jessie Zairo <jzairo@bywatersolutions.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 33fb5d70a5da4470522eda00c685de11150a7671
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 15 09:26:53 2022 +0000

    Bug 30237: (QA follow-up) Spelling
    
    Thankyou => Thank you
    No thanks ;)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6ab1dcef952b8cb0501b00096e13961dcb4eee7f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 15:13:49 2022 +0100

    Bug 30237: (follow-up) Make LibraryName conditional
    
    It's easy to forget to set the LibraryName preference.. as such we can
    make this a conditional and fall back to a default of 'the library'.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 40b9d9e668bfc77ddcd7d022f949eb2957ada083
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 15:00:39 2022 +0100

    Bug 30237: Add a note about WELCOME notice to system preference
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 830f43d6c2f25b6acd108b4ce1757f7f42f68fab
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 14:55:48 2022 +0100

    Bug 30237: (follow-up) Add french sample notice
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 71b1caccb96ccbbf1c1df69ccf94562295077771
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 14:52:51 2022 +0100

    Bug 30237: (follow-up) Update Notice
    
    This patch updates the sample notice as suggested by Katrin.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3d5e974f8fe5a72abc0cb59f6b954a431f9541f9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 8 16:15:52 2022 +0000

    Bug 30237: Replace AutoEmailOpacUser with AutoEmailNewUser
    
    This patch replaces the AutoEmailOpacUser system preference with a new
    AutoEmailNewUser preference. This makes the functionof the preference
    clearer.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a4da023bae60098aa518203b0d79a2d8420e215d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 8 13:42:38 2022 +0000

    Bug 30237: Reference new WELCOME notice
    
    This patch updates all references to the former ACCTDETAILS notice to
    use the new WELCOME email notice instead.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2609adc1bd13a3e4a39da1d639c55b2c1bffa4ac
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 8 16:01:44 2022 +0000

    Bug 30237: Replace ACCDETAILS notice with WELCOME notice
    
    This patch drops the ACCDETAILS notice in preference to a new WELCOME
    notice.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8eb24ccf102779d01671f09988a02065ac117d0d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 2 14:18:55 2022 +0000

    Bug 29005: Unit tests
    
    Add a unit test for the additional functionality of sending welcome
    emails from Koha::Patrons::Import.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1bf5adf83714e03dc635a9317726b5f77a60fea5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 2 13:41:16 2022 +0000

    Bug 29005: Add support for the command line script
    
    This patch adds welcome email for new users support to the command line
    patron import tool.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c6e2c6fb6002538204a9f1f39d07a2257f74fef4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 1 10:40:50 2021 +0100

    Bug 29005: Add option to send welcome email from patron imports
    
    This patch adds the ability to send the ACCTDETAILS notice for new users
    added using the patron import tool.
    
    Test plan
    1. Create a valid csv for patron import that includes some new users,
       ensuring you add a valid email address for which you have access.
    2. Import the users using the patron import tool and select the new
       'Send email to new patrons' checkbox.
    3. Check that the notice appears in the new patrons notices
    4. Check that you received a welcome email for the user.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 437e5844077cfd7d315f6ef2f6657d5da619925d
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Dec 1 01:31:27 2021 +0000

    Bug 29420: HTTP status code incorrect when calling error pages directly under Plack/PSGI
    
    The error pages wrote a HTTP status code of 200 for all PSGI requests, even
    though it should have only done it for PSGI requests from the ErrorDocument
    middleware. This patch fixes that.
    
    0) Do not apply patch
    1) Open F12 dev tools and go to Network tab
    2) Go to http://localhost:8081/files/blah
    3) Note that the webpage is a 404 error but HTTP status code is 200
    4) Go to http://localhost:8081/cgi-bin/koha/circ/blah
    5) Note that the webpage is a 404 error and HTTP status code is 404
    
    6) Apply patch
    7) Go to http://localhost:8081/files/blah
    8) Note that the webpage is a 404 error and HTTP status code is 404
    9) Go to http://localhost:8081/cgi-bin/koha/circ/blah
    10) Note that the webpage is a 404 error and HTTP status code is 404
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 05ba079814facb569feb9327992a1dc441753754
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 04:47:34 2022 -1000

    Bug 27631: (RM follow-up) Fix missing h1 to div
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 53d785c7e6bfda50761b632f9647193f46d6b7df
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 20 04:36:00 2022 -1000

    Bug 27631: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9a8653f29bbb37261de1d800880944708edd1f67
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 1 15:22:55 2022 +0000

    Bug 27631: (follow-up) Various corrections
    
    This patch addresses issues found during QA:
    
    - Double headings (patron details page)
    - Inconsistent heading position (check out, patron accounting)
    - Missing headings when there is no data (Library EANs, Item search
      fields, MARC modification templates).
    - Typo: Z19.50 => Z39.50
    - Reword "Classification sources" heading: "Classification
      configuration"
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e118479562184de1d8721aa169e756c0301e8f94
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 8 12:57:41 2021 +0000

    Bug 27631: (follow-up) Modify logo CSS to give better alignment
    
    This patch modifies the CSS of the Koha logo and its container so that
    it more closely matches the previous version and so that alignment is
    handled better at various browser widths.
    
    To test, apply the patch and build the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Check various pages in the staff interface to confirm that the position
    of the Koha logo is correct. Adjust your browser width to confirm that
    the alignment adapts at narrow widths.
    
    Test also on pages where the header search form can be expanded, e.g.
    Patrons -> [+] to expand search options. Or Acquisitions -> Orders
    search -> [+]. Confirm that logo alignment is correct on these pages
    too.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d91bf6d613062c5a688c0296ac31341197474535
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 30 15:57:32 2021 +0000

    Bug 27631: (follow-up) Some minor corrections
    
    This patch makes some corrections to issues found during testing:
    
    Some duplicate headings, a markup error in labeledMARCdetail.tt, a
    change of the transfers heading from "Branch transfers" to "Item
    transfers."
    
    This patch also undoes the changes to the position of the toolbar on
    several pages. I think those changes don't belong in this bug.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 63fa2dd0c3602d7654ea0ae48254931dd1ddb3b0
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Wed Jun 2 08:44:35 2021 +0000

    Bug 27631: (follow-up) circ/branchtransfers.tt
    
    Changed file to have one <h1> tag showing that describes the page,
    rather than the <h1> around the logo.
    
    The hierarchy of other heading tags may be wrong, but this will be
    dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to circ/branchtransfers and check that it has an obvious and
       descriptive heading
    4) Ensure that the heading is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ce0ff54c26accdde9bd8f46f66d30d9bdfde116
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Jun 1 04:40:40 2021 +0000

    Bug 27631: (follow-up) reports/guided_reports_start.tt
    
    Changed file to have one <h1> tag showing that describes the page,
    rather than the <h1> around the logo.
    
    The hierarchy of other heading tags may be wrong, but this wil be dealt
    with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to reports/guided_reports_start and check that it has an obvious
       and descriptive heading
    4) Ensure that the heading is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0ff4531b88898e922f5f26b89e46a227578cef94
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Fri May 28 03:33:22 2021 +0000

    Bug 27631: (follow-up) tools/marc_modification_templates.tt
    
    Changed file to have one <h1> tag showing that describes the page,
    rather than the <h1> around the logo.
    
    The hierarchy of other heading tags may be wrong, but this will be
    dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to tools/marc_modification_templates and check that it has an
       obvious and descriptive heading
    4) Ensure that the heading is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0c97d5a0a46003fb5a99ea5fdea9459c47498c5a
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon May 24 15:08:11 2021 +0000

    Bug 27631: (follow-up) course_reserves/course-details.tt
    
    Changed file to have one <h1> tag showing that describes the page,
    rather than the <h1> around the logo.
    
    The hierarchy of other heading tags may be wrong, but this will be
    dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to course_reserves/course-details and check that it has an obvious
       and descriptive heading
    4) Ensure that the heading is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9174029a8e057182bd1d5922026e5c643942d01f
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 19 05:31:07 2021 +0000

    Bug 27631: admin folder
    
    Changed each of the pages in the admin folder to have one <h1> tag
    showing that describes the page, rather than the <h1> describing the
    logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the admin folder and check that they have
       an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b0c53fed3607a174417393d5fbe168ee3f158ca3
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Wed Apr 14 02:58:19 2021 +0000

    Bug 27631: Hidden <h1> on intranet-main.tt
    
    This patch visually hides a <h1> on intranet-main.tt so that the
    heading is available to be read out by screenreaders in the summary of
    headings on the page.
    
    Test plan:
    
    1) Ensure the <h1> "Koha home" heading on the staff client main/home
       page is hidden visually, but in the source code you can see it
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aba4ce142b10fc2a8314c2c31887ed57b6049b53
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 5 21:50:20 2021 +0000

    Bug 27631: acqui folder
    
    Changed each of the pages in the acqui folder to have one <h1> tag
    showing that describes the page, rather than the <h1> describing the
    logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the acqui folder and check that they have
       an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b034e0e41e05710a862e78d4947f0c71eba45e6a
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Tue Apr 13 22:41:11 2021 +0000

    Bug 27631: cataloguing folder
    
    Changed each of the pages in the cataloguing folder to have one <h1>
    tag showing that describes the page, rather than the <h1> describing the
    logo.
    
    The hierarchy of heading tags may be broken in many pages, but this will
    be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the cataloguing folder and check that they
       have an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 44a8e0bd6ec1260fdf286b67003907e00017fbef
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 5 09:34:34 2021 +0000

    Bug 27631: reports and serials folders
    
    Changed each of the pages in the reports and serials folders to
    have one <h1> tag showing that describes the page, rather than the <h1>
    describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the reports and serials folders and
       check that they have an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 275875c3b9cfd16a00ce24f334d155551306287e
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 5 09:46:17 2021 +0000

    Bug 27631: tools and virtualshelves folders
    
    Changed each of the pages in the tools and virtualshelves folders to
    have one <h1> tag showing that describes the page, rather than the <h1>
    describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the tools and virtualshelves folders and
       check that they have an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9944756dfaffa740ad787d93b9724892147ba4c9
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Wed Apr 7 01:23:49 2021 +0000

    Bug 27631: catalogue and tags folders
    
    Changed each of the pages in the catalogue and tags folders to have one
    <h1> tag showing that describes the page, rather than the <h1>
    describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the catalogue and tags folders and check
       that they have an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 925fb810fe794f5b203cc0b4f9b6d163c326dfc4
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 5 09:30:06 2021 +0000

    Bug 27631: offline_circ, patroncards, plugins, pos, reserve, rotating_collections folders
    
    Changed each of the pages in the offline_circ, patroncards, plugins,
    pos, reserve, rotating_collections folders to have one <h1> tag showing
    that describes the page, rather than the <h1> describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the offline_circ, patroncards, plugins,
       pos, reserve, rotating_collections folders and check that they have
       an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 96501a941b765b5275aa97976cdc4ffd0092ee53
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Wed Apr 7 01:24:13 2021 +0000

    Bug 27631: installer and onboarding folders
    
    Changed each of the pages in the installer and onboarding folders to
    have one <h1> tag showing that describes the page, rather than the <h1>
    describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Ensure that the page source shows logo inside <div> and not inside
       <h1>
    4) Go to each of the pages in the installer and onboarding folders and
       check that they have an obvious and descriptive heading
    5) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cc2e34468aad91e754ea5590fc4abc9c25ba8525
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 5 08:52:33 2021 +0000

    Bug 27631: authorities, clubs, common, course_reserves folders
    
    Changed each of the pages in the authorities, clubs, common,
    course_reserves folders to have one <h1> tag showing that describes
    the page, rather than the <h1> describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the authorities, clubs, common,
       course_reserves folders and check that they have an obvious and
       descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 26e38d4990a96f0fb6398f3a732b75a1b9f56ee0
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 19 05:51:05 2021 +0000

    Bug 27631: labels and members folders
    
    Changed each of the pages in the labels and members folders to have one
    <h1> tag showing that describes the page, rather than the <h1>
    describing the logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the labels and members folders and check
       that they have an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2ed6902783fb984f6f051357f9480fc92df8d3f8
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 19 05:35:46 2021 +0000

    Bug 27631: circ folder
    
    Changed each of the pages in the circ folder to have one <h1> tag
    showing that describes the page, rather than the <h1> describing the
    logo.
    
    The hierarchy of heading tags may be broken in many pages, but this
    will be dealt with in an additional bug.
    
    To test:
    1) Go to the Staff Client
    2) Apply patch
    3) Go to each of the pages in the circ folder and check that they have
       an obvious and descriptive heading
    4) Ensure that the heading in the page is <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ca602f75c8965d3a36b0148e21824395f39aeeb3
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 19 05:22:08 2021 +0000

    Bug 27631: Changed <h1> around logo to <div>
    
    To test:
    1) Look at Staff Client and the logo
    2) Apply patch
    3) Check Koha logo moves to the middle of the page when zooming in
    4) Ensure page source shows logo inside <div> and not <h1>
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d21157b35c3cee9c74f9abdd436a17e7b4ca3c58
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Thu Oct 17 10:32:18 2019 +0200

    Bug 25815: SIP Checkout: add more information on why the patron is blocked.
    
    Currently, on SIP checkout, Koha only returns "Patron Blocked" when there is
    a problem with the patron.
    
    This patch adds more specific informations, with the following messages:
    
     - "Patron expired"
     - "Patron debarred"
     - "Patron has fines" (see system preference "noissuescharge")
     - "Patron blocked" (see system preference "OverduesBlockCirc")
    
    Test plan:
    
     - Try to do a SIP checkout with a patron that is in one of the above situations.
     - Check that the displayed message matches the patron's situation.
    
    Signed-off-by: Sonia <sonia.bouis@univ-lyon3.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5e90c0cbb3abc4656139cfdbdefbbc159f67c470
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 2 16:12:05 2022 +0000

    Bug 30223: Move book cover image upload JS to a separate file
    
    This patch moves most of the JavaScript from upload-images.tt into a
    separate file, upload-images.js. Functionality should be unchanged.
    
    To test, apply the patch and go to Tools  -> Upload local cover image.
    
    Test all the things:
     - Drag-and-drop upload
     - Click-to-browse upload;
     - Deleting existing images
     - Uploading a zip file
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42612370cca95ece959ab7cbdba5275010a6b521
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 11 17:04:34 2022 +0000

    Bug 30509: Fix configuration of Notices accordion widget
    
    The jQueryUI upgrade broke the Accordion on the notices edit page. I'm
    not sure why, but defining a "header" option in the accordion
    configuration fixes it.
    
    To test, apply the patch and test the notices edit page both with and
    without TranslateNotices and multiple languages installed. In both cases
    the different sections (Email, Print, SMS) should open and close
    correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 844ed1d534f9a42eba298df3e44ff4b0375641e1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 14 10:51:18 2022 +0000

    Bug 30540: Fix perl critic complaint of leading zeros
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2562727648cbde443a3fac7c475492c6976b5dab
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 14 09:14:47 2022 +0100

    Bug 30540: eval on set_time_zone
    
    This patch adds an eval around the call to set_time_zone so that we
    don't crash on invalid local dates and instead just keep the passed
    floating timezone.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5bf08e4d490ff2f970e9c0cece294cdbb198be46
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 14 10:19:47 2022 +0100

    Bug 30540: Unit test
    
    This patch adds tests for checking the output_pref method against
    a timezone and datetime that would cause an Invalid local time failure
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
       k$ prove t/DateUtils.t
    => FAIL: The feature is not implemented, tests fail to complete
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aa8e9fe5c5ba7a9d1e7f688e894d460ef5adc94d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 19 16:13:49 2021 +0000

    Bug 29483: Further improve performance of script
    
    This patch adds a few tests to cover more cases, and to highlight current functionality.
    
    The script only allows renewal if all outstanding holds can be filled by available items.
    This means we can return as soon as we have determined that not all holds can be filled.
    
    I add FIXME and some explanatory comments - I will file a follow-up bug for those, but
    I feel we can accept these improvements to the performance and deal with the issues
    of how it 'should' work versus how it does work on another report.
    
    To test:
    1 - prove -v t/db_dependent/Circulation.t
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 68c92b49d12f4e16fb6679835cc04eeda8c51633
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 15 13:54:00 2021 +0000

    Bug 29483: Check ItemsAnyAvailableAndNotRestricted once per patron
    
    ItemsAnyAvailableAndNotRestricted can take a long time and create nested loops.
    We can check it once per patron, however, this requires us to flip the loops.
    Since an item can only be used once, we now add a check to see if this item has already
    been assigned to a borrower.
    
    To test:
    1 - Find or create a biblio with 100 items
    2 - Place ten 'Next available' holds on a biblio
    3 - Set preference 'AllowRenewalIfOtherItemsAvailable' to 'Allow'
        Set circ rules 'On shelf holds allowed' to 'If any unavailable'
    4 - Checkout one of the items to a patron, backdated to be overdue
    5 - Note a long loading time for the patron's checkouts
    6 - Apply patch, restart_all
    7 - Patron loads much faster
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4113f765b6fd4d62d8aa3ae86de5e0f4987b227e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 18 16:11:24 2021 +0000

    Bug 29483: Unit tests
    
    This patch updates the AllowRenewalIfOtherItemsAvailable tests to
    remove deletion of all data, and create specific circ rules for this
    test. It adjust several other tests that were relying on the rules from
    this test, so thy too create their opwn specific rules.
    
    Additionally, we add tests to cover the case of mutliple items on the record,
    and some items cannot fill some reserves.
    
    What is uncovered here is that the same patron is checked twice, so two holds can
    be filled, but they only satisfy a single patron
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9dcfa320f50466ddd75eb90697e9ff3bb12722de
Author: Victor Grousset <victor@tuxayo.net>
Date:   Sat Feb 5 21:43:04 2022 +0100

    Bug 29602: (follow-up) fix duplicate, missing or mismatching <span>
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e7a51588854f27bb908d2eb66cb54314bd5c8bfc
Author: Victor Grousset <victor@tuxayo.net>
Date:   Sat Feb 5 00:21:26 2022 +0100

    Bug 29602: (follow-up) fix crash: SET KohaSpan => USE KohaSpan
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9b919ed124239805c296377d42e8da9fb45ad68c
Author: Victor Grousset <victor@tuxayo.net>
Date:   Fri Feb 4 23:38:13 2022 +0100

    Bug 29602: (follow-up) Fix TT tags broken due to missing %
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6e7153a5722d9d260861db082fcbf9205822f8ec
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 14 21:46:43 2021 -1000

    Bug 29602: (follow-up) Surround strings with span tag
    
    To be nicer with translators.
    
    Update the PO files for whichever languages will show how this is useful.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Rebased-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e08629b68b40ee142968a4b589da15653c7c8e8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 30 14:54:15 2021 +0100

    Bug 29602: Surround strings with span tag
    
    To be nicer with translators.
    
    Update the PO files for whichever languages will show how this is
    useful.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Rebased-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cddcba9edb4f5defa559ab59ea2d6ba6ac3d65bc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 1 15:20:47 2022 +0000

    Bug 30435: Remove unused MACLES cataloging plugin
    
    This patch removes the files associated with the MACLES cataloging
    plugin. The feature is unmaintained.
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c48ec95cbfc717a460a723e1a0f8274a2c4aace9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 13 08:24:22 2022 +0100

    Bug 30518: Correct DateTime maths for needs_advancing
    
    The needs_advancing method prior to this patch used basic DateTime
    arithmatic, adding a DateTime::Duration in Days to the Arrival date of
    the item and then comparing that to today. This, however, can cause bugs
    when the arrival + duration date coincides with a DST boundary and as
    such may result in an invalid local date.  See
    https://metacpan.org/pod/DateTime#Making-Things-Simple for further
    details.
    
    This patch updates the code to use the DST safe delta_days method to
    count the days between arrival and now instead and then compares this
    integer to the defined duration of the stage.
    
    To test:
    1. Re-run the unit tests, they should now pass.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ae557cfa91655b6bb8316b1a4632876f08a54640
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Apr 13 08:52:02 2022 +0100

    Bug 30518: Unit test
    
    This patch adds tests for checking the needs_advancing method against
    a timezone and datetime that would cause an Invalid local time failure
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
       k$ prove t/db_dependent/StockRotationItems.t
    => FAIL: The feature is not implemented, tests fail to complete
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c3642d51a12bab8ae63ce026325aca5c936c533f
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Apr 7 22:17:18 2022 +0000

    Bug 30488: Fix error when placing recall via OPAC
    
    This error occurs due to how UpdateStats is called in Koha/Recalls.pm
    
    To test:
    1) Enable the UseRecalls system preference and set some random values in
    the recalls circulation and fines rules.
    2) Find or create an item. Check this item out to Patron A.
    3) Log in to the OPAC as Patron B.
    4) Find the item you checked out to Patron A. Click the button to place
    a recall.
    5) Fill out whatever details you like. Click the Submit button. This
    should trigger the error.
    6) Apply the patch and refresh the page.
    7) Confirm the recall has now been requested successfully.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5a637617e497cbf30b7c33a3a93d52117773e997
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Apr 19 08:30:56 2022 +0100

    Bug 30410: (follow-up) Instantiate object in unit test
    
    This patch updates the unit test for the BackgroundJob->_derived_class()
    private method to instantiate a proper object to work on instead of
    calling the type_to_class_mapping method directly as non-object method.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit c2f215378022c4c433de02e7b25aee37b0b551e6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Apr 14 10:44:36 2022 +0100

    Bug 30135: (follow-up) Rename accessor in failing test
    
    We renamed the LSQ seqment accessor from 'collection_code' to
    'sequenece_code' to more clearly reflect the EDI segment name instead of
    the Koha field we had mapped it to. (Especially as that mapping is not
    optionally to ccode or location).
    
    However, I forgot to update the corresponding test. This patch does that
    update.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit dd91077f91c6d33aac95a375afbb889751252797
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Apr 13 17:11:27 2022 -0300

    Bug 29810: Fix patron embed definitions
    
    Due to a race and a bad rebase, the patrons embeds added on bug 30063
    didn't get copied to the parameters secition, thus breaking embedding.
    
    To test:
    1. In master, open the patron search page and the inspector
    2. Perform a search
    => FAIL: No results
    => FAIL: There's an error 500 in the API response, mentioning embedding
    is not allowed
    3. Apply this patch
    4. Restart all
    6. Repeat 2
    => SUCCESS: Results are back!
    => SUCCESS: No more API errors
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>

commit 412d4f4864558eceb22325074dccd05a3deaa979
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Apr 11 13:02:26 2022 -0400

    Bug 30410: (QA follow-up) Only fetch plugins mapping once
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 826a2d4e70c70c45cb08e42cf352455798fa52cf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Apr 11 10:33:24 2022 -0400

    Bug 30410: (QA follow-up) Pluralise new methods, fix minor issues with language
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ebae23153dd06ccd2b37d7b206e4573aac656a7d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 31 17:33:21 2022 +0200

    Bug 30410: Add a way for plugins to expose tasks they implement
    
    This patch implements a mechanism for plugins to tell Koha they
    implement background jobs, by returning a mapping
    
    ```
        task => class
    ```
    
    * _task_ is a string that will be used when queueing new tasks, to let
      the workers know which class to instantiate to launch the job (a.k.a.
      process).
    
    * _class_ is a string for a class name.
    
    For this to  work, plugins need to include the 'namespace' attribute in
    their metadata. If they don't, they will be skipped when listing the
    valid _background jobs_.
    
    After this, high-level methods for letting plugins (easily) enqueue
    their tasks will be provided.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/BackgroundJob.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 211044ad1a91d7c9bd83289fb928b34797b74756
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 31 17:32:40 2022 +0200

    Bug 30410: Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 51192f98953b275bc28bf1cb8c79691b199f0d43
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 15:01:13 2022 +0200

    Bug 27783: DBRev 21.12.00.033
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 015c114a6aefbb60d8b360d4b17610d2939f6d22
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 4 19:50:57 2022 +0200

    Bug 27783: DBIC update
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 631d3500867f0cb59c8b9aed7bb4b78f068fc1fd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Apr 11 16:10:49 2022 +0100

    Bug 27783: (follow-up) Rename options
    
    Why require `job_`.. it's easiery to just use 'queue' and we have 'job'
    from the context of the script we're calling.  This also inproves
    consistency between the debian commands and the script params.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c859066ee5f384c175d398684efa625263962954
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Apr 11 14:09:24 2022 +0000

    Bug 27783: (QA follow-up) Make dbrev executable
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f1fef6527c778977bd0d48e2cb42b5c9dc153a8f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Apr 4 20:23:09 2022 +0200

    Bug 27783: Add queue handling in packaging tools
    
    This patch adds queue name handling in is_worker_running and a handy
    method to centralize process name handling for queue-specific workers.
    
    To test:
    1. Apply this patch
    2. Run:
       $ source debian/scripts/koha-functions.sh
       $ get_worker_name kohadev
       kohadev-koha-worker
    => SUCCESS: Default queue means no queue name included
       $ get_worker_name kohadev default
       kohadev-koha-worker
    => SUCCESS: Default queue means no queue name included
       $ get_worker_name kohadev long_tasks
       kohadev-koha-worker-long_tasks
    => SUCCESS: Queue name appended to the name
    4. Run:
       $ perl misc4dev/cp_debian_files.pl \
                  --koha_dir /kohadevbox/koha \
                  --gitify /kohadevbox/gitify \
                  --instance kohadev
    5. Run:
       $ koha-worker --start --queue oleonard kohadev
    => SUCCESS: Starts!
    6. Check:
       $ ps waux | grep oleonard
    => SUCCESS: It is running
    7. Play with --stop, --restart, --status and different queue names,
       including 'default' and without the --queue param as well.
    => SUCCESS: All as expected!
    8. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit db4baee498f3eab9d44efd00dd82b45e32ed8b29
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Apr 2 12:58:25 2022 +0200

    Bug 27783: (QA follow-up) Make dbrev idempotent
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9c4a89a7c815515f51e36119db899f9274f31ea8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 1 13:56:09 2022 +0200

    Bug 27783: Rename queues and adjust currently defined jobs
    
    This patch renames the queues so the default is the **real-time** one, and
    the other (*long_tasks*) is kept for **long running** tasks.
    
    All current *batch* tasks are explicitly assigned to the **long_tasks**
    queue as well.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dc886e1b133a99d238f81be6ad5ec145528c353d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 30 16:29:17 2022 +0100

    Bug 27783: (follow-up) Add DB change to installer
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit faf2a0723188c0b5d9a8cabe6a251d7ffb548784
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Mar 30 16:42:55 2022 +0200

    Bug 27783: Add missing atomicupdate file
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9acb599d16764a813f5481164cdaeec3b3d01f27
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Mar 30 14:21:50 2022 +0200

    Bug 27783: Replace --job-type by --queue
    
    This patch adds a new column background_jobs.queue, which default to
    'default'
    By default, new jobs are enqueued into this default queue, and the
    background job worker will subscribe to the default queue unless told
    otherwise by the --job-queue option
    
    The new job UpdateElasticIndex is automatically enqueued in another
    queue named 'index'
    So you can have 'default' worker with
        misc/background_jobs_worker.pl
    and a dedicated indexing worker with
        misc/background_jobs_worker.pl --queue index
    
    This is to address bug 27344 comment #15
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a42717ad15bbbb772b7477ab374c75d1039350f9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 1 12:10:05 2022 +0200

    Bug 27783: Add --job-type to background_jobs_worker.pl
    
    This will let sysop adjust the number of workers and how they want to
    manage them.
    For instance one could want to have one worker for ES indexation and
    another worker for other jobs, to prevent ES index to be stuck behind
    bigger batch process.
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1269a074fc3948c1e61a27d8b00a18dc78acbf52
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Jan 25 18:46:44 2022 +0000

    Bug 29946: Sort Marc profiles alphabetically
    
    To test:
    1- Go to Tools > Stage MARC records for import
    2- You'll need a MARC file, choose one and hit 'Upload file'
    3- Create many Profiles with different names. Add some that include accents/diacritics.
    4- Notice that the profiles sort in the order in which you create them
    5- Apply patch
    6- Try steps 1-2 again
    7- Now the dropdown should be sorted alphabetically
    8- Make a few more profiles and make sure they are being inserted in the right order alphabetically, including the profiles containing accents/diacritics.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2876e8762224b6be18b572db123b8292ed9d4fe1
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 14:47:40 2022 +0200

    Bug 30498: DBRev 21.12.00.032
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2fe5eb465291b1b6778787482d702ae287ef63d7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 8 09:37:59 2022 +0000

    Bug 30498: Corresponding DBIx change for SearchField
    
    No test plan.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 045b4678582d86da5c98888cfaf444b3773d6005
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 8 09:19:31 2022 +0000

    Bug 30498: Fix enum search_field.type
    
    Resolves sync issue with upgrades.
    
    Test plan:
    Run dbrev.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 80f735557179884003f659f454278ba5fc7523de
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 14:43:07 2022 +0200

    Bug 30481: DBRev 21.12.00.031
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b647518de03239c6cbe65c42133be467e1efda8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 7 11:59:53 2022 +0000

    Bug 30481: Drop unique constraint deleteditemsstocknumberidx
    
    Resolves a sync issue between database and schema caused by
    differences between structure and upgrades. Note: newer
    databases do not contain this index any longer.
    
    Test plan:
    Run dbrev.
    Check SHOW CREATE TABLE deleteditems.
    Verify that unique index has been dropped, regular index added.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 35595922dd5280d4860a3cb3ee08a9f37d1df703
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 17:00:36 2022 +0200

    Bug 30376: Fix missing mandatory date acquired error on item save
    
    Signed-off-by: Johanna Raisa <johanna.raisa@gmail.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8a8c5b86e2a04b31c9ec31446761b91c2093a4d5
Author: Thomas Klausner <domm@plix.at>
Date:   Mon Feb 21 12:35:15 2022 +0100

    Bug 30142: Remove spaces from ElasticSearch mapping MARC fields
    
    A first step to "validate" the MARC mappings: Remove all whitespace, so
    if a user enters "245a " (with a trailing whitespace, which can easily
    happen when copy/pasting) we only store "245a" in the DB. This is
    neccessary, because the ES indexer will throw an exception in an invalid
    MARC mapping.
    
    Test Plan:
    * Go to /cgi-bin/koha/admin/searchengine/elasticsearch/mappings.pl
    * Go to the Bibliographic Records Tab
    * Enter "100 a b c " (notice the whitespaces!) in the first "mapping"
      field
    * Scroll down and save
    * Go back to the Bibliographic Records Tab
    * The spaces are still there
    
    Now apply the patch
    
    * Repeat the above steps
    * After saving you should see "100abc" without any spaces in the
      "mapping" field
    
    Sponsored-by: Steiermärkische Landesbibliothek
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0aeb4708140d8031e76bbf149f0a09f015fd5eef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Apr 7 14:25:08 2022 +0200

    Bug 30485: (bug 30063 follow-up) Display all patrons if not term passed
    
    Regression from bug 30063. If you are searching all patrons (not search term passed) from the header, the patron search result is not displayed.
    
    Test plan:
    Go to the Koha homepage, search patrons, don't enter a search term and
    click "submit"
    All patrons must be returned.
    Regression test: on the other patron search forms, confirm that there is
    no regression, ie. no patron displayed until you search for something
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c76fe7264769723642d79c4bb7159534d8bda4b0
Author: Bernardo González Kriegel <gonzalez@di.unc.edu.ar>
Date:   Wed Apr 6 14:53:54 2022 -0300

    Bug 30476: Remove NORMARC translation files
    
    This patch just deletes translation files left behind when removing
    support for NORMARC.
    
    To test:
    1) Apply the patch
    2) Verify there are no more *-marc-NORMARC.po files
       on misc/translator/po/ dir
    
    No consequences are expected.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d12e2645e61ad7bb9a416d9cb180583ceeb9b485
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 13:48:16 2022 +0200

    Bug 30135: DBRev 21.12.00.030
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2c82d0e335bb4285c0d63e3f844a459ddbe80a0b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 15:11:16 2022 +0200

    Bug 30135: (QA follow-up) Fix typo in sysprefs.sql
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3ca182e1a4c365e26170cf651cafd0a6655ce484
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 31 11:17:11 2022 +0000

    Bug 30135: (QA follow-up) Fix typo in update
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ba96e67117674d679762a65abe058baec98fa188
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Feb 26 19:24:55 2022 +0000

    Bug 30135: (follow-up) Rephrase system preference description to use collection
    
    Avoids ccode in favor of collection in the system preference
    description. Also makes it a tiny bit easier to translate.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dae21ecf0f30ce9f87dd7e623abbff98d48756b7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 21 17:02:42 2022 +0000

    Bug 30135: Unit tests
    
    Add a unit test for EdifactLSQ preference.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 509aebd60eb4b3f4a3e7d0be42873fab9dbbb0ad
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 18 17:15:11 2022 +0000

    Bug 30135: Add EdifactLSQ mapping preference
    
    This patch adds a new system preference, EdifactLSQ, to allow
    configuration of the ambiguous LSQ, sequence code, field included in the
    EDIFACT specifications.
    
    Originally the field was hard coded to map to 'location', but as per the
    specification it could have been mapped to 'ccode'.
    
    From the specification:
    
    A code or other designation which identifies stock which is to be
    shelved in a specified sequence or collection.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ce51b4daef41ba013288212639dbde883afe5bd2
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 13:40:32 2022 +0200

    Bug 30130: Add DBRev 21.12.00.029
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cd13c87d41d6b7bba7caa91162ffb3e2260b6935
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 29 11:48:11 2022 +0000

    Bug 30130: (QA follow-up) Fix tests
    
    Result was copied and pasted, needed to update check
    
    Was passing objetc instead of standard field
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5c3ab82e2fda11089fdb9b0637bf3363541b6288
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Feb 21 21:54:31 2022 +0000

    Bug 30130: (QA follow-up) Fix permission on atomic update file
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 41e956775a32895df1002c051bb7de8af6b31761
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 21 16:21:48 2022 +0000

    Bug 30130: Unit tests
    
    This patch adds a unit test for the internal 'beginning_of_message'
    method in Koha::Edifact::Order to check that the vendor standard
    parameter is being interpreted coorectly.
    
    Test plan
    1. Run the tests, they should pass
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fee274b4df0f9e9cf1ad18b60df599a6e2fdb0bb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 18 14:38:40 2022 +0000

    Bug 30130: (follow-up) Set BiC for 'Ulverscroft'
    
    The 'Ulverscroft' supplier is also a BiC follower, this patch adds their
    SAN, 5013546031839, to the DB update.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dc770ff1fe8e01100af94bbffb8cad3f6cb9ede0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 21 16:25:24 2022 +0000

    Bug 30130: Use new standard field in account definition
    
    This patch uses the new 'standard' field to in the edifact account
    configuration area to allow setting the message standard as either
    'EDItEUR' or 'BiC'.
    
    This just replaces the currently hard coded hash of SAN's in
    Koha::Edifact::Order to distinguish between the two standards instead of
    requireing a bug submission per vender san we identify to be a BiC type
    vendor.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 60c1f7682a31ed053f09c47bec404810c6f106ca
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 21 16:25:53 2022 +0000

    Bug 30130: DBIC Update
    
    This patch updates the DBIC schema's with the new 'standard' field.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit be7b4dffb9dd9cb2d0d81833c7ea51227b323a70
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 21 16:25:44 2022 +0000

    Bug 30130: Add standard field to edi_account
    
    This patch add a 'standard' field to the edifact account configuration
    table to allow setting the message standard as either 'EDItEUR' or 'BiC'.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6f101d68b6d1178ff5a00103f45157b5115651f5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 13:28:46 2022 +0200

    Bug 16258: Add DBRev 21.12.00.028
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c27acc44b80c37872910b5fa48302aafb96df9ff
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 29 11:35:42 2022 +0000

    Bug 16258: (QA follow-up) Add note of disbaled EDIFACT to EDI accounts page
    
    One shouldn't end up here, but nice to have a note if you do
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5f6fe745d2574fdbde5914166eb59be308c987c2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 21 11:49:11 2022 +0000

    Bug 16258: (QA follow-up) Fix columns_settings
    
    Splice out the relevant field from the columns_settings when EDIFACT is
    disabled
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2049b7f952e09486fdc0da61a09910c1b7b7ef22
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 18 13:09:59 2022 +0000

    Bug 16258: (QA follow-up) Capitalise EDIFACT
    
    EDIFACT is an abreviation, so it should be ALLCAPS.
    
    * Electronic Data Interchange for Administration, Commerce and Transport
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2287c98ad3315e747432c925d2cc17b4dd3b0c25
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 18 12:58:42 2022 +0000

    Bug 16258: (QA follow-up) Move 'Edifact' preference
    
    This patch moves the global 'Edifact' switch into the 'EDIFACT' section
    of the sysprefs.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fcfd3a9a0d55c4ed852ce07e5ba31e9b8e5191da
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 18 12:57:48 2022 +0000

    Bug 16258: (QA follow-up) Remove superflous comment from sysprefs
    
    This patch removes the errant comment from default syspref SQL.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 119087103c79e34e20b37d1adb92c7f38beb3fc4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 18 12:56:44 2022 +0000

    Bug 16258: (QA follow-up) Hide "Suppliers report" column
    
    As noted by Katrin, this column is only used for Edifact message data
    and so can be hidden when Edifact is disabled.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 075931adda697190451a331a7717372091b8815a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Feb 10 14:28:17 2022 -0500

    Bug 16258: (QA follow-up) Include Koha plugin for basket.tt
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 912f82cb485c284798fab05b863697cdc40ae54e
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Feb 10 14:21:33 2022 -0500

    Bug 16258: (QA follow-up) Don't set to off for existing install, they may be using EDI
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 21223c7c5e25c44b3dca641e5aea304def06dcab
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Feb 10 14:18:23 2022 -0500

    Bug 16258: (QA follow-up) Add a guard to the cron script
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 53a632431fe32d732fc7af33df26d5798ab90cf7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 10 16:23:12 2022 +0000

    Bug 16258: (follow-up) Handle 'Create EDIFACT order' button
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2dbd8aab96536ee7f1530fdc14d816349fcdf5bb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 10 15:52:59 2022 +0000

    Bug 16258: (follow-up) Handle admin-menu.inc
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 491c8708c4777f2f2cfc3170582473f76644e7fb
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Wed May 4 13:31:01 2016 +0100

    Bug 16258: Add a syspref to govern EDIFACT functionality
    
    Adds an "Edifact" systempreference to govern whether edifact processing
    is enabled. In most places this is hidden if the current
    vendor does not appear in the edi vendors table. This preference
    hides the admin screens which define this and a couple of links.
    
    Also fixes an anomaly whereby the basketgroup screen was not
    making the same check on whether edi ordering should be enabled as
    the basket screen. Both now use the same logic.
    
    Rebased-by: Mark Tompsett <mtompset@hotmail.com>
    Rebased-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ff45fdf85102f7dde749d6b81b5b6905f0fd68c
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Apr 1 10:16:09 2022 +0200

    Bug 30406: Add column filters before hiding columns
    
    The code that adds column filters works only on visible columns, so we
    should hide columns after filters are created
    
    Test plan:
    1. Apply patch
    2. Go to Tables settings. Hide city_state for the cities table.
    3. Create some cities and go to the cities page
    4. Verify that filtering works as expected.
    5. Make the city_state column appear. Verify that filtering on this
       column works too
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0200a65d4faef805f7b8dde074f304e4a4177db1
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Mar 31 23:02:35 2022 +0000

    Bug 30426: Add missing C4::Auth and C4::Output imports
    
    This patch adds missing function imports for C4::Auth and C4::Output
    in the opac/svc/suggestion script.
    
    Test plan:
    
    1. Go to http://localhost:8081/cgi-bin/koha/admin/didyoumean.pl
    2. Turn on some plugins
    3. Go to http://localhost:8080/cgi-bin/koha/opac-search.pl?idx=&q=test&weight_search=1
    4. Note in your browser's Network tab that the call to
       http://localhost:8080/cgi-bin/koha/svc/suggestion?render=stub&q=test
       generates a 200 response instead of a 500 error
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3738ee04bf3da67ed30f8406947b7601fb787981
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 12 11:36:46 2022 +0000

    Bug 26019: (follow-up) Set SameSite attribute on Cart cookies
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cc5333cb955af526dae42cc400496bf2e5561f51
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 17 12:45:34 2022 +0000

    Bug 26019: Add two other js cookies
    
    Test plan:
    Same as former patch. Use OPAC adv search here.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 59ff962caaa28c10ab1a57655ca588359dad367b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 11 15:51:49 2022 +0000

    Bug 26019: Koha should set SameSite attribute on cookies
    
    This patch modifies the way Koha sets cookies so that the "sameSite"
    attribute is explicitly set to "Lax." This option is chosen because it
    is the value which is currently assumed by browsers when the sameSite
    attribute is not set.
    
    To test, apply the patch and restart services.
    
    - Log in to the staff interface and open your browser's developer tools.
      - In Firefox, look for a "Storage" tab.
      - In Chrome, look for an "Application" tab.
    - Under "Cookies," click the URL of the staff interface.
    - You should see all the cookies which are set for that domain.
    - The CGISESSID cookie should have sameSite set to "Lax."
    
    - Go to Cataloging -> New record.
      - Check the "marcdocs" and "marctags" cookies.
    - Switch to the Advanced MARC editor (you may need to enable
      theEnableAdvancedCatalogingEditor preference).
      - Check the "catalogue_editor" cookie.
    - Add a new item to an existing bibliographic record.
      - Check the "LastCreatedItem" cookie which is set after you save the
        new item.
    - Go to Authorities -> Authority search.
      - In authority search results, click "Merge" from the "Actions" menu
        next to one of the results..
        - Check the "auth_to_merge" cookie.
    - Go to Administration -> MARC bibliographic framework
      - Choose "MARC structure" from the menu corresponding to one of the
        frameworks.
      - Check the "Display only used tags/subfields" checkbox.
        - Check the "marctagstructure_selectdisplay" cookie.
    - Go to Circulation -> Check out to a patron with checkouts.
      - Check the "Always show checkouts immediately" checkbox.
        - Check the "issues-table-load-immediately-circulation" cookie.
    - Go to Tools -> Patron clubs. You will need at least one active club
      with one or more patrons enrolled.
      - From the list of clubs, click Actions -> Search to hold.
        - Check the "holdforclub" cookie.
    - Go to Tools -> Batch item modification and submit a batch of items.
      - Uncheck one or more checkboxes in the "Show/hide columns" area.
        - Check the "showColumns" cookie.
    - View a patron -> Search to hold.
      - Check the 'holdfor' cookie.
    - With WebBasedSelfCheck enabled, log in to the self-checkout page.
      - Check the "JWT" cookie.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9156e0d1865fb9421462ef9efc68ec3a5a6ffbb7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Apr 13 11:01:54 2022 +0200

    Bug 29066: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ad3d2817d017a723d55e460cab8d4c764d2e53b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 29 14:37:30 2022 +0000

    Bug 29066: (follow-up) Use tooltip when SearchMyLibraryFirst in effect
    
    This patch proposes to add a Bootstrap tooltip to the OPAC masthead's
    search field to indicate to the user when SearchMyLibraryFirst is in
    effect. I think this lets the form layout stay clean-looking and is more
    informative to the user because they don't have to look for the HTML
    title tag tooltip.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Administration -> Global system preferences.
    - Set the OpacAddMastheadLibraryPulldown preference to "Don't add."
    - Set the SearchMyLibraryFirst preference to "Limit."
    - Go to the OPAC and confirm that the main search field in the masthead
      has a filter icon in the background, indicating that searches will be
      limited.
    - Hover your mouse over the search field and a tooltip should pop up,
      "Searching in <library> only"
    - The message should also be triggered when you click inside the form
      field.
    - Change the OpacAddMastheadLibraryPulldown and SearchMyLibraryFirst
      preferences again and the form should return to its normal behavior.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3fe43f4c863b6459e3f04005a0d674691e75ec37
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 14 20:53:54 2022 -1000

    Bug 29066: (follow-up) add aria-label and aria-hidden on icons
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 03d49e6d63039da0aa827c2da118d24376439a9f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Sep 20 12:33:05 2021 -1000

    Bug 29066: Remove text in OPAC search form and use Font Awesome icons
    
    In modern front-end websites, first think you see in header region is an large input text with a search icon.
    No need to say it is a search form.
    We still tell it in 'title' attribut for accessibility.
    
    This patch removes 'Search' text.
    If 'my library first' feature is enabled, shows a text in title of a
    question mark icon.
    In submit button, replaces 'Go' with a seach icon and add title
    'Search'.
    
    Test plan :
    1)
    1.1) Set system preferences :
      OpacAddMastheadLibraryPulldown to 'Add'
      SearchMyLibraryFirst to 'Don't limit'
    1.2) Go to OPAC main page
    1.3) You don't see 'Search' anymore
    1.4) You see in submit button an icon
    1.5) Move mouse over submit button to see tooltip text 'Search'
    2)
    2.1) Set system preferences :
      OpacAddMastheadLibraryPulldown to 'Don't add'
      SearchMyLibraryFirst to 'Limit'
    2.2) Go to OPAC main page
    2.3) Log in
    2.4) You don't see text 'Search (in <library name>) only'
    2.5) You see a question mark icon
    2.6) Move mouse over submit button to see tooltip text 'Search (in <library name>) only'
    
    Signed-off-by: Samu Heiskanen <samu.heiskanen@hypernova.fi>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42feb1849ad54f042aee1d51f44f4d30138d89b8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Apr 12 17:23:22 2022 +0200

    Revert "Bug 29859: Fix BatchUpdateAuthority"
    
    This reverts commit a46f8a097412b28df268dc6e043cf39464a5678d.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6d7aa694a92781e7df61d9dd60d0ff14f891a52b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Apr 12 12:09:05 2022 +0200

    Bug 26346: DBRev 21.12.00.027
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a48ab4ba3b715a92470ea66e19f4fb94d3fb7f85
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 31 12:57:49 2022 +0000

    Bug 26346: (QA follow-up) Clarify permission
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 445e458cf3fb7f03aa56f61d33c5197365f14c62
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Mar 28 22:07:07 2022 +0000

    Bug 26346: (follow-up) Fixing for QA tool
    
    Adding is_boolean to virtualshelves.public and
    virtualshelves.allow_change_from_staff in Virtualshelve.pm DBIC schema file.
    
    Fixing typo in Virtualshelves.t
    
    Sponsored-by: Catalyst IT, New Zealand
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b933a44441e4d84238fb5448cf0d3512a03a2ed1
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Wed Apr 14 14:06:48 2021 +1200

    Bug 26346: Add option to make public lists editable by all staff
    
    If a staff member has access to the staff client (either because
    'catalogue' permission is enabled or they're a superlibrarian
    then that user can add items (from OPAC or staff client) to a list
    marked 'Staff only'
    
    Test plan:
    1. In the staff client go to: Lists > 'New list'. Notice under 'Allow changes to contents
    from' there are three options: Nobody, Owner only, Anyone seeing this
    list
    
    2. Apply first 3 patches and run updatedatabase.pl
    cd installer/data/mysql
    sudo koha-shell <instance>
    ./updatedatabase.pl
    
    3. Restart memcached and plack
    
    4. Create 4 patron accounts:
    - User A : Superlibrarian permissions
    - User B : 'Staff access, allows viewing of catalogue in staff interface
    (catalogue)'
    - User C : No permissions
    - User D : 'Staff access, allows viewing of catalogue in staff
    interface' and 'Lists' > Edit public lists (edit_public_lists)' sub-permission
    
    5. Login to staff client as User A.
    Create a public list and select the new 'Staff only' option under 'Allow changes to contents from'
    
    6. Log into the staff client as User B.
    Confirm you can add items to the list from the following staff client pages:
    - Individual list page using the 'Add items' button
    - Staff client search result page
    - Staff client biblio detail page
    
    7. Confirm you can remove items from the list
    
    8. Confirm you can perform an OPAC search when not logged in
    
    9. Log into the OPAC as User B. Confirm you can add items to the list
    from the following OPAC pages:
    - OPAC search result page
    - OPAC biblio detail page
    
    10. Log into the OPAC as User C. Do an OPAC search and confirm you
    can view the list, but not add items to it
    
    11. Login to the staff client as User B. Create a new list with the
    following settings:
    - 'Category'='Private',
    - 'Allow changes to contents from'='Staff only'
    
    Notice a red hint message is displayed.
    Change 'Category'='Public' and notice the hint is removed
    
    12. Log into the OPAC as User C. Notice the 'Staff only' option is not
    available when creating a list
    
    13. Log into the OPAC as User B. Repeat step 11. Confirm the same
    outcome
    
    14. Log into the staff client as User A. Create a list with the
    following settings:
    
    - Public = 'Public'
    - Allow changes to contents from = 'owner only'
    
    15. Log into the staff client as User D. Edit the list from step 14
    confirm you can edit the list to have 'Allow changes to contents from' =
    'Staff only'
    
    16. Run Patron.t and Virtualshelves.t unit tests:
    sudo koha-shell <instance>
    prove t/db_dependent/Koha/Patron.t
    prove t/db_dependent/Virtualshelves.t
    
    Sponsored-by: Horowhenua District Council, New Zealand
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 332176beaa0dc92a92271acc136ce03fa0e51f2a
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Fri Jul 2 06:51:37 2021 +0000

    Bug 26346: Updated schema file
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 46a19e5011aa544a0db8d49dbaec140ce01817dd
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Fri Jul 2 06:46:12 2021 +0000

    Bug 26346: Database changes
    
    - Adds allow_change_from_staff to virtualshelves table
    - Add edit_public_lists sub-permission
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2aaa0b87cfc59e45660d2ff7e73c8f8d82fbf2e8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Apr 12 11:51:22 2022 +0200

    Bug 17018: DBRev 21.12.00.026
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c73967d87c0114ead5e3f15bd23bb6a2e27553e0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 14 19:18:15 2022 +0000

    Bug 17018: Split AdvancedSearchTypes for staff and OPAC
    
    This patch adds a new system preference, OpacAdvancedSearchTypes, as an
    OPAC-specific version of the AdvancedSearchTypes preference. Values from
    AdvancedSearchTypes are copied to OpacAdvancedSearchTypes so that
    behavior is consistent.
    
    The patch also alters the output of the "Most popular" page so that:
    1. The page heading is correct ("Most popular titles" instead of "Top
    issues").
    2. The table show both item type and collection whether or not the user
    has submitted query with one of those fields as a filter.
    
    To test, apply the patch and run the database update process.
    
    - Go to Administration -> System preferences.
    - Search for AdvancedSearchTypes. You should get two results, one for
      the OPAC preference and one for the staff interface.
    - Check that the OpacAdvancedSearchTypes settings match the
      AdvancedSearchTypes settings.
    - View the advanced search pages in the staff interface and OPAC to
      confirm that the tabs look correct.
    - Change the OpacAdvancedSearchTypes and AdvancedSearchTypes settings to
      be different and confirm that each is applied separately to each
      interface.
    - Enable the OpacTopissue system preference.
    - View the "Most popular" page in the OPAC.
      - The page heading should be correct.
      - The OpacAdvancedSearchTypes settings should be reflected in the
        "Refine your search" sidebar: If "Collection" is checked, a filter
        for collection should appear. If "Item types" is checked, a filter
        for item types should appear.
      - The output of your search should include collection and item type
        regardless of what filters you've submitted.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 69b9e1ddf4a86195cf7b5ae99813ddde6b42dc1e
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Wed Sep 29 10:04:23 2021 +0200

    Bug 22347: Translatability of ILSDI GetAvailability
    
    Some discovery tools can't translate ISL-DI results, it would be useful
    if we can get ISL-DI output already translate.
    
    This patch add an optional parameter language to GetAvailability, and
    make GetAvailability results translatable.
    If no parameter is given the output language is the language of the
    cookies is present or the first language in the opac language list.
    
    Test plan:
    1. Enable the ILS-DI system preference
    2. Locate a record
    3. Test these URLs:
       [OPACBASEURL]/cgi-bin/koha/ilsdi.pl?service=GetAvailability&id=[BIBLIONUMBER]&id_type=biblio
       and
       [OPACBASEURL]/cgi-bin/koha/ilsdi.pl?service=GetAvailability&id=[ITEMNUMBER]&id_type=item
       (Where the [OPACBASEURL] is the OPAC URL of your test instance,
       [BIBLIONUMBER] and [ITEMNUMBER] are a record number and item number of
       your choice.)
    4. Apply the patch
    5. Test these URLs:
       [OPACBASEURL]/cgi-bin/koha/ilsdi.pl?service=GetAvailability&id=[BIBLIONUMBER]&id_type=biblio&language=[LANGUAGE]
       and
       [OPACBASEURL]/cgi-bin/koha/ilsdi.pl?service=GetAvailability&id=[ITEMNUMBER]&id_type=item&language=[LANGUAGE]
       (Where the [OPACBASEURL] is the OPAC URL of your test instance,
       [BIBLIONUMBER] and [ITEMNUMBER] are a record number and item number of
       your choice, [LANGUAGE] is a language code ex: 'en' or 'fr-FR')
    6. The results should now be in the requested langugage
    
    Sponsored-by: University Lyon 3
    
    Signed-off-by: Sonia <sonia.bouis@univ-lyon3.fr>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 014d4234133eaf34fa044a718bbd950c7a57acc7
Author: Shi Yao Wang <shiyao@inlibro.com>
Date:   Wed Mar 23 15:31:40 2022 -0400

    Bug 27035: Shows the number of results in a facets after facet selection
    
    System preferences:
    displayFacetCount - Show;
    
    1. Let's search
    2. Near to each of the facets, we see the number of results (n)
    3. Click on any of the facets and filter the result
    4. Opposite the selected facets, the number of results is not displayed
    Ex.
    Marriage Fiction [x]
    
    Apply the patch
    1. Let's search
    2. Near to each of the facets, we see the number of results (n)
    3. Click on any of the facets and filter the result
    4. Now, opposite the selected facets, the number of results is displayed
    Ex.
    Marriage Fiction (2) [x]
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ea8151da5638429e7c3c3779392388c53e4a6800
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 19 00:48:54 2020 +0000

    Bug 26244: Move translatable strings out of memberentrygen.tt and into JavaScript
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    Note: I was unable to trigger the confirmation message in the
    check_form_borrowers function. I think the form is now structured in a
    way that it is never triggered, thus a candidate for removal.
    
    To test:
    
    - Apply the patch and go to Patrons.
    - Add or edit a patron.
    - Select a date of birth at least one month in the past and confirm that
      the patron's age is displayed in the hint below.
    - Test multiple variations to confirm that the singular and plural of
      'year' and 'month' display correctly. (e.g. 1 year 9 months, 2 years,
      etc).
    - Set some patron messaging preferences for the patron.
    - Change the patron category.
    - You should get a confirmation: "Change messaging preferences to
      default for this category?"
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/members.js for translation, e.g.:
    
      msgid "%s years"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 711139190cb6767ce6fb336d17355c330919aeb1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 31 13:16:46 2022 +0000

    Bug 30417: Switch to Bootstrap tabs on the basic library transfer limit page
    
    This patch updates the basic library transfer limits  page to use
    Bootstrap tabs instead of jQueryUI.
    
    To test, apply the patch and go to Administraion -> Library transfer
    limits.
    
    Test that the tabs look correct and work correctly. The functionality of
    the page should be unchanged.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 87e5601d5358f39e36faf5d30287c0238b71b17e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 16:34:51 2022 +0200

    Bug 30432: Fix random failure
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4531fa5fc9a8f18dcaae6b1347853e5adbc4c349
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 1 12:48:54 2022 +0000

    Bug 30432: Specify 'me' for biblionumber when limiting items
    
    To test:
    1 - Apply only unit tests
    2 - prove t/db_dependent/Koha/Holds.t
    3 - It fails
    4 - Apply this patch
    5 - prove t/db_dependent/Koha/Holds.t
    6 - It passes!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5d53081cb8855af52b12b7ad1f820b91ac8819c5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Apr 1 12:48:27 2022 +0000

    Bug 30432: Unit test
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a41117032c76cd5b1a290b237e732ab1aabd8ee1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 5 12:02:20 2022 +0000

    Bug 30456: Convert checkout history tabs to Bootstrap
    
    This patch updates the circulation history page to replace jQueryUI tabs
    with Bootstrap tabs. A minor JavaScript change is required to work
    with the new HTML structure.
    
    To test you'll view the staff interface circulation history page with
    the OnSiteCheckouts system preference on and off.
    
    - With OnSiteCheckouts off, locate a patron who has current and/or
      past checkouts.
    - View the "Circulation history" page for that patron.
    - The table of checkouts should display with no tabbed interface.
    
    - With OnSiteCheckouts on, the page should show three tabs: All,
      Checkouts, and On-site checkouts.
    - Confirm that clicking on each tab correctly filters the table, e.g.
      the On-site checkouts tab should show only on-site checkouts.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 408de34eaa6dca9624542ff44bb6ff736e2b07b5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 31 17:34:35 2022 +0000

    Bug 30423: Convert authority merge page tabs to Bootstrap
    
    This patch updates the authority merge page to use Bootstrap tabs
    instead of jQueryUI.
    
    To test, apply the patch go to Authorities in the staff interface.
    
    - Perform an authority search which will return more than one
      authority record.
    - On the results page, click Actions -> Merge for two authority
      records.
    - Click "Next" after selecting a merge reference.
    - On the next page you should see two tabs under "Source records."
      Confirm that they work correctly.
    - Confirm that tag and subfield selection still works correctly.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8340956a9b0a99cfed1812490e2e78fbb76d280e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 31 13:43:41 2022 +0000

    Bug 30419: Convert authority detail page tabs to Bootstrap
    
    This patch updates the authority detail page to use Bootstrap tabs
    instead of jQueryUI.
    
    The patch also removes some broken JavaScript. It will be re-implemented
    in Bug 30422.
    
    To test, apply the patch search for an authority record in the
    authorities module.
    
    View the detail page for the authority and test that the tabs look
    correct and work correctly.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 084168d1b8409b9d1ae23f78d0c968cc53beea05
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 29 17:17:36 2022 +0000

    Bug 30401: Convert budgets administration page tabs to Bootstrap
    
    This patch updates the budgets administration page to use Bootstrap tabs
    instead of jQueryUI.
    
    This patch contains indentation changes, so ignore whitespace when you
    use your preferred diff tool.
    
    To test, apply the patch and go to Administration -> Budgets. Check that
    the "Active budgets" and "Inactive budgets" work correctly.
    
    Append "?tab=2" to the page URL to confirm that the second tab is
    preselected.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1a2deae54e87332daaee6b888a9f273b1fc84bbf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 29 16:59:47 2022 +0000

    Bug 30400: Convert invoices page tabs to Bootstrap
    
    This patch updates the invoices page to use Bootstrap tabs instead of
    jQueryUI.
    
    To test, apply the patch and go to Acquisitions.
    
    - Locate a vendor which has multiple invoices associated with it.
    - View the vendor details, and click the "Invoices" link in the sidebar.
    - Check that the "Open invoices" and "Closed invoices" tabs work
      correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4fed033c9d999396337660927235c915e07c07b3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 29 16:37:22 2022 +0000

    Bug 30398: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 49953fcada27f41e2a37fad13b04608973eea6c5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 29 16:14:35 2022 +0000

    Bug 30398: Reindent invoices template
    
    This patch updates the invoices template so that the indentation is
    consistent.
    
    To test, apply the patch and go to Acquisitions.
    
    - Locate a vendor which has multiple invoices associated with it.
    - View the vendor details, and click the "Invoices" link in the sidebar.
    - The display of invoices should look correct. The DataTable should work
      correctly.
    - Test the search filters in the sidebar to confirm that they work too.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 54a1d110932fc019bbd30726373c028a4abf3d4f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 29 11:48:42 2022 +0000

    Bug 30396: Convert basket groups page tabs to Bootstrap
    
    This patch replaces the use of jQueryUI tabs on the basket groups page,
    in the view where open and closed basket groups are displayed in
    separate tabs.
    
    This patch includes indentation changes, so please ignore whitespace
    when using your preferred diff tool.
    
    To test you should have at least two basket groups set up in
    Acquisitions, one open and one closed.
    
    Go to Acquisitions -> Vendor -> Basket groups and confirm that the
    "Open" and "Closed" tabs look correct and work correctly.
    
    Under the "Closed" tab, try clicking the "Reopen" button. The page will
    refresh but you should still see the "Closed" tab active.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 942dad81e7fba64a81176d2096af688495e7f200
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Mar 28 12:04:34 2022 +0000

    Bug 30378: Convert about page tabs to Bootstrap
    
    This patch updates the about page to use Bootstrap tabs instead of
    jQueryUI.
    
    The patch also makes a minor HTML correction for validity.
    
    To test, apply the patch and go to the about page in the staff
    interface.
    
    Test that the tabs look correct and work correctly.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1c081bcdb185b9a3686055114edc23b46eb81b88
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 25 12:20:52 2022 +0000

    Bug 29957: (follow-up) correct spelling QA complaint
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1e32b6bc44d4a97854f89b38d7bbb5c40ea70f6a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 25 08:20:46 2022 +0000

    Bug 29957: Add --keep-cookie option to koha-create
    
    As requested on comment99. Personally I do not feel that it
    should be a requirement for adding a koha-conf entry though.
    Note that koha-create does/did not even support adding multiple
    line entries to koha-conf like we do here now.
    But it might be a start for adding them?
    
    Test plan:
    The following tweak might help you to test without running the
    complete koha-create, while still convincing you:
    
    [1] cp debian/templates/koha-conf-site.xml.in /etc/koha/test.conf
    [2] Add the following line in debian/scripts/koha-create. Append
        if after the BCRYPT_SETTINGS= line on L652:
        generate_config_file test.conf test.xml; exit
    [3] Run debian/scripts/koha-create --keep-cookie A
    [4] Check if you see <do_not_remove_cookie>A<..> in test.xml.
    [5] Run debian/scripts/koha-create --keep-cookie A --keep-cookie B
    [6] Check for two lines in test.xml
    [7] Run debian/scripts/koha-create clone_name
    [8] Check that the __KEEP_COOKIE__ line is gone in test.xml.
    [9] Undo the tweak by removing test.xml and /etc/koha/test.conf,
        and removing the added line from koha-create.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bc75c5acf2947aa1e9d45b77aa9fd213164c9173
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 18 07:17:39 2022 +0000

    Bug 29957: Add example lines in koha-conf.xml
    
    Test plan:
    Just comments. Nothing to test.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: using new name for deny list.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 62f87022067efc6929ff9dd6cc40c685098455ec
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 17 09:21:46 2022 +0000

    Bug 29957: Let check_api_auth return created cookie
    
    The cookie created on L1496 is useless, since it is not returned.
    We could either remove the cookie creation (unchanged behavior).
    But since check_api_auth is expected to return a cookie when it is ok,
    I opt for returning the cookie here (corrected behavior).
    
    Test plan:
    Logout in staff.
    Check on staff: /cgi-bin/koha/svc/localization?id=1
    You should have a 400 response.
    Login with staff credentials (incl. manage_itemtypes)
    Revisit same URL.
    You should see a JSON response.
    Check if you can hit other staff pages.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 832756a184dd8a73b0de8bd28af98d7a6a088c52
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 16 12:43:07 2022 +0000

    Bug 29957: Adjust push @$cookie statements in Auth
    
    We can now use $cookie_mgr->replace_in_list instead. This
    effectively removes duplicates and keeps the newest cookie.
    
    Note: In the test plan below we are just verifying if
    this patch did not change behavior. The replace_in_list
    routine has been tested already in a unit test.
    
    Test plan:
    Run t/db_dependent/Auth.t
    Login at OPAC.
    Hit some opac and staff pages.
    Perform an Advanced search on OPAC.
    Check cookies in browser.
    Logout.
    Check cookies again. Verify with your do_not_remove_cookie lines
    in koha-conf.xml.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a13b004db810af0bbda3b9c759584a591618708d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 14 11:30:57 2022 +0000

    Bug 29957: Replace clear_all_cookies in Auth.pm
    
    Test plan:
    Enable language selection and have two languages.
    Change language.
    Check cookie value in browser for KohaOpacLanguage.
    Logout.
    Verify that cookie has been cleared in browser.
    
    Add do_not_remove_cookie line for KohaOpacLanguage in koha-conf.
    Restart, flush.
    Login again.
    Change language.
    Check cookie value in browser for KohaOpacLanguage.
    Logout.
    Verify that cookie still contains the language.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ac291c229a924e91c86f8e80c3cd5f40f4fdfa76
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 23 07:41:54 2022 +0000

    Bug 29957: (follow-up) Turn allow list into deny list
    
    See the discussion on the Bugzilla report.
    It might be easier to work with a deny list.
    
    Test plan:
    Run t/CookieManager.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2e181750cd2d646f3b6bf325dc8a2c9a7d3240a1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Mar 11 10:15:30 2022 +0000

    Bug 29957: Introduce Koha::CookieManager
    
    Test plan:
    Run t/CookieManager.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ed8a9cff24bdd2d76c925e0db4cab6b920d0be13
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 27 12:33:57 2022 +0100

    Bug 29957: Clear cookies on logout
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Reverted the change to $cookies to minimize changes.
    Fixed Auth.t where checkauth is being mocked.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1684821b616ad91fb5668c30ed68d25299d3892c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 18 11:41:24 2022 -0300

    Bug 29695: Add missing POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 035b68c7416f65a34ad371a40cedda10fa730d9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 17:07:22 2021 +0100

    Bug 29695: Remove columns.def
    
    No longer in use
    
    Test plan:
     % git grep 'columns.def'
    does not return relevant occurrences
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 46ca2cef020d3bfac6f0cc92ed89c573f61bb41a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 17:00:59 2021 +0100

    Bug 29695: Remove json files
    
    We do no longer need them.
    
    Test plan:
    Confirm that their content are in Koha::Database::Columns
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 09671c4e35c1bc8e3e5dc9ed841553999540293d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 17:00:50 2021 +0100

    Bug 29695: Make "modalselect" syspref's values translatable
    
    We are using json files to retrieve the list of the DB columns. We can
    reuse what we have done in the previous patch and display translated
    strings.
    
    Test plan:
    Search for "unwanted" in the sysprefs
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 167037b2ff08c30ca446a1214cc8dff62991a88f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 15:57:13 2021 +0100

    Bug 29695: (follow-up) Remove C4::Reports::Guided::_get_column_defs
    
    Same as the previous patch but for the inventory.
    
    Test plan:
    Same as before but test the inventory tool
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dca75318ed3a98a59e5cdca232be678d308e5c7b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 15:52:22 2021 +0100

    Bug 29695: Remove C4::Reports::Guided::_get_column_defs
    
    This subroutine was mostly the same as GetColumnDefs, we replace it
    identically as in the previous patch.
    
    Test plan:
    Translate some strings in another language
     % gulp po:update --lang es-ES
     % cd misc/translate
     # Translate the relevant strings in po/es-ES-messages.po
     # For instance "Alternate contact: Surname"
     % perl translate install es-ES
    
    Select the language for the interface (enable it in the 'language' syspref
    first)
    
    Create a new guided report and confirm that the columns for the borrowers
    table are translated
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1a14a0539affc98b0a0a9a50abc25b9279dac376
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 15:35:25 2021 +0100

    Bug 29695: Remove GetColumnDefs
    
    C4::Templates::GetColumnDefs can easily be replaced using the new
    Koha::Database::Columns module.
    
    Test plan:
    Go to the import patron tool and confirm that you see the same list of
    patron's attribute on the import patron form.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aae7c26aaba30caa7fe8e2f2374862ec1c97b709
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 17:27:37 2021 +0100

    Bug 29695: Add new module Koha::Database::Columns
    
    This module will contain new strings and make them translatable using
    Koha::I18N.
    
    We will need to improve this module to prevent the dozens of __ calls
    each time we retrieve the column list. We could either use memcached or
    add a method to only retrieve columns for a given table.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6a3f1027ea33b38258088d1f651898facc6beb6c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 24 14:19:35 2022 +0000

    Bug 29810: Add 'x-koha-embed' to reserved words
    
    The maintainers of Mojolicious::Plugin::OpenAPI and friends fixed the
    problem with using collectionFormat for Headers in the upstream library.
    
    However, this highlighted an outstanding issue in our code when I ran
    the unit tests. We have not been stripping x-koha-embed at the query
    level as it did not exist in the reserved_words list.  This patch
    resolves that and gets the acquisitions_orders test passing again.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de14e5c37a5aad5ce31418c3ae883afef758915c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:27:15 2022 +0000

    Bug 29810: Document x-koha-embed header on orders endpoints
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3ac7bcbec0c6681232e1b10c47af7c3d84e6cb06
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:25:03 2022 +0000

    Bug 29810: Document x-koha-embed header on libraries endpoints
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ccfb7cc240c2b75cfe7285d84489c283ae528ba1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:23:27 2022 +0000

    Bug 29810: Document x-koha-embed header on cash registers endpoints
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c90daefb638125e1ee8661876a3f5656a6900872
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:21:13 2022 +0000

    Bug 29810: Document x-koha-embed header on biblios endpoints
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9558535de47a74ecd1dddce1487e086c2cc55eb5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:18:41 2022 +0000

    Bug 29810: Document x-koha-embed header on checkouts endpoints
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ea8e51f77601629c06794bef69e1f6bfec1d9dde
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:12:11 2022 +0000

    Bug 29810: Document x-koha-embed header on patrons endpoints
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c22fb1237fe8e49eb4a4a21f472fe285f6113c14
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 12:59:42 2022 +0000

    Bug 29810: Add summary of x-koha-embed header to api spec
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1445012f5f5002c60c9b9cab33264c5bcad99f57
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Apr 8 21:08:51 2022 +0000

    Bug 30501: Fix typo in sysprefs.sql
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d348ea2c60bfa4d46017ab3563c8b781819e0947
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Mar 31 11:32:11 2022 -0400

    Bug 14393: (QA follow-up) Add template filters
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 621b1c3b7f18ff8de84dbafc5aeecb6167abffd0
Author: David Cook <dcook@prosentient.com.au>
Date:   Wed Jun 17 14:50:14 2015 +1000

    Bug 14393: Add collection code filter to inventory
    
    This patch adds the ability to do inventory by collection.
    
    _TEST PLAN_
    
    Before applying:
    1) Go to "Tools > Inventory/stocktaking"
    2) Note that there is no "Collection code:" option
    
    Optionally:
    2b) You can create a Barcode file with a single barcode
    2c) Don't select anything from "Select items you want to check" (or filter if you know
    how to filter to make it faster... doesn't matter)
    2d) Click "Submit" at the bottom of the screen
    2e) Note that there is no "Collection code" column in the screen output or CSV output
    (ie with/without the "Export to CSV file" box ticked before submitting)
    
    Apply the patch.
    
    After applying:
    3) Note that there is a "Collection code" filter on the main inventory screen
    4) Create a Barcode file with a single barcode for an item with a collection
    and upload it using the "Choose file" button.
    5) Select that item's collection code from the "Collection code" filter
    6) Click "Submit"
    7) Note that the screen output and the CSV output contains a "Collection code" column
    (ie with/without the "Export to CSV file" box ticked before submitting)
    
    Signed-off-by: kelly mcelligott <kpmcelligott@gmail.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4982ac40c53e53e04ced9d7c4396ac748c0f37f5
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 30 16:34:55 2022 +0000

    Bug 30118: (QA follow-up) Fix Perl Critic issues
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6a76843d58bfc1db983fb08588c0db9be8534d6f
Author: Matthias Meusburger <matthias.meusburger@biblibre.com>
Date:   Wed Mar 17 14:14:25 2021 +0100

    Bug 30118: Make holds_block_checkin in SIP behave like in Koha interface.
    
    In koha interface, a warning is displayed when an item on hold is returned
    only if the return is for this specific item.
    
    This patch does the same in SIP: the return is blocked when holds_block_checkin
    is enabled and there is a hold on a specific item and this is the very item
    being returned.
    
    Test plan:
    
    The following behavior is expected in SIP:
    
     - An item is returned, and there is a reservation on record-level: block
     - An item is returned, and there is a reservation on this very item: block
     - An item is returned, and there is a reservation on another item: allow
    
    Signed-off-by: Sonia <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aae06747018bcfcd313fb5af77a456060f5d8814
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Mar 9 14:55:21 2022 +0000

    Bug 30243: When branccode is required on OPAC suggestion page default to empty value
    
    To test:
    1. Apply patch
    2. Go the purchase suggestion page and see that branchcode defaults to the first option in the list.
    3. Go to OPACSuggestionMandatoryFields and mark branchcode as required
    4. BAck on the OPAC suggestion page notice that the branchcode defaults to an empty value
    5. Try to submit the form without changing it, you cannot. You must choose a branch
    
    Signed-off-by: shiyao <shiyao@inlibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9cad82b3c613d2ae1524ad385791f81c57331480
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 8 15:22:47 2022 +0200

    Bug 29990: DBRev 21.12.00.025
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0fc88464948a5e506c42a7127185d9e39196daf0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 30 13:00:56 2022 +0000

    Bug 29990: (QA follow-up) Change class name and apply to heading, add -x to update
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 62d96cffe149063a3f25eb6dba93015bd6ce4691
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Sep 23 17:33:29 2020 +1200

    Bug 29990: Show authority appropriate heading use on search results
    
    Authority heading use is based on authority MARC 008/14-16. This could
    be useful to show on authority search results, if new system preference
    ShowHeadingUse is enabled.
    
    To test:
    
    1. Apply patches, update database, restart services
    2. Go to Koha Administration -> system preferences -> searching tab.
    Notice new ShowHeadingUse system preference is disabled. Leave it
    disabled for now.
    3. Do an authority search. Confirm it works as expected and no new
    information is shown since ShowHeadingUse is disabled.
    4. Do a biblio search and edit a record. Go to one of the authority
    fields (1xx, 6xx or 7xx) and launch the authority finder plugin. Do an
    authority search and confirm it works as expected and no new information
    is shown since ShowHeadingUse is disabled.
    5. Go back to system preferences and enable ShowHeadingUse syspref.
    6. Repeat steps 3 and 4 but confirm the 'Heading use' column now shows, and
    correctly displays what the heading can be used for based on 008/14-16.
    
    Sponsored-by: Education Services Australia SCIS
    
    Signed-off-by: Jessica <jzairo@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f6138634f5b53b4121a7731cc518fd4313ceceaa
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Feb 1 00:11:11 2022 +1300

    Bug 29990: Add ShowHeadingUse system preference
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1f618ebd77396243429137c06f1c7f165911f68e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 8 15:16:31 2022 +0200

    Bug 29821: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cb195553d34bd40f04a9adbf50d433bfb3fb8e4e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 7 15:55:29 2022 +0000

    Bug 29821: Add interface for generating barcodes using svc/barcode
    
    This patch adds a new page providing an interface for generating
    barcodes using svc/barcode. A form allows the user to choose various
    parameters and see the resulting barcode image.
    
    To test, apply the patch and rebuild the staff interface SCSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to the "Tools" home page. Follow the link to "Barcode image
      generator."
    - On the barcode image generator page, confirm that there is a "Barcode
      image generator" link in the sidebar and that it is displayed with
      bold text.
    - Test the features of the form:
      - Enter a numeric value in the "Barcode" field and tab out of the
        field or click "Show barcode" button. A barcode of type "Code39"
        should be shown with the text of the barcode included in the
        image below the barcode.
      - A text area below the barcode image should show the HTML used to
        generate the preview image.
        - Clicking in this textarea should automatically add the contents to
        the clipboard. You should be shown a message, "HTML copied to the
        clipboard."
      - Check the "hide text" checkbox. The barcode should be redisplayed
        without the text.
      - Check that changing the "barcode height" value is reflected
        correctly in the barcode image.
      - Try adding non-numeric data in the "Barcode" field. You should be
        shown an error message, "Barcodes of type [type]  must be numeric."
      - Test these other numeric barcode types: Code39, COOP2of5, EAN13,
        EAN8, IATA2of5, Industrial2of5, ITF, Matrix2of5, NW7, UPCA, and
        UPCE.
    
        Note that EAN13, EAN8, UPCA, and UPCE expect specific patterns. Test
        values (found here: https://barcode.tec-it.com/en/UPCE):
    
        EAN13: 978020137962
        EAN8: 9031101
        UPCA: 72527273070
        UPCE: 0123456
    
      - Change the barcode type to "QRcode."
        - The form should change, hiding the "Hide text" checkbox and
          showing a new ranger slider for "QR Code module size."
        - The barcode field should now be labeled "Text, URL, or barcode,
          etc"
        - The barcode field hint should change to a hint about QRcode
          dimensions.
        - Changing the "module size" slider should change the size of the
          generated QR code. As you change the slider the selected value
          should be reflected in the box.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 18939987f553c1325d86dfb9602c35b8c2e543f2
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 8 15:10:36 2022 +0200

    Bug 20398: DBRev 21.12.00.024
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 322cad08be2b5af6f77e24cc902dd7c43feb1003
Author: Thibaud Guillot <thibaud.guillot@biblibre.com>
Date:   Tue Mar 29 15:37:01 2022 +0200

    Bug 20398: (QA follow-up) Fix position of 'if' statement
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d58e5fc7a0050f912920f68d48083f2043ff5039
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Feb 13 12:45:33 2022 +0000

    Bug 20398: (QA follow-up) Fix alphabetical order in sysprefs.sql
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 437a3e1de58e0555c0c9a7f1891ffe351d2ce94e
Author: Thibaud Guillot <thibaud.guillot@biblibre.com>
Date:   Wed Dec 8 09:16:38 2021 +0000

    Bug 20398: Added a syspref to highlight or not highlight search terms in results on the staff interface
    
    There is a possibility on OPAC but not yet on the staff interface, so I added this syspref which has the same behaviour as the OPAC highlighting syspref.
    When you choose to disable highlighting on the syspref, the toggle anchor in the result page does not appear at all.
    But if you keep the default state (highlighting on), you still have the option to switch between "Unhighlight" and "Highlight" modes.
    
    Test plan :
    1. Go to the syspref named "StaffHighlightedWords" and see that the default state is "Highlight".
    2. Look for something in the catalogue for example and see that the words are highlighted and that it is also possible to change between "Unhighlight" and "Highlight".
    3. Go back to syspref and choose to disable highlighting by choosing "Don't Highlight".
    4. Refresh your results page if you have not closed it or reload a new search.
    5. There is no highlighting at all and anchors do not exist (same behaviour as the OPAC interface).
    
    Signed-off-by: ManuB <e.betemps@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 075cd4b9378facce1d3919fb5ed0c44c29ee4d46
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 8 15:06:03 2022 +0200

    Bug 20517: DBRev 21.12.00.023
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 373d1a7ed38ce2b19391011c13c1f89ff52a7f87
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 30 08:27:59 2022 -0400

    Bug 20517: (QA follow-up) Add ability to override syspref with account level settings in SIP config file
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 78e3a297e3a5a3d680da49ddc50563c9c2b5cc45
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 30 11:09:04 2022 +0000

    Bug 20517: (follow-up) Add explanation to syspref and fix QA issues
    
    I added explanatory text to staff interface on the preference to explain how it works
    
    Removed a debug warn in the _get_sort_bin routine
    
    changed comparitor => comparator
    
    fixed a missing call in the tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3356cb6b8e7d5a5fe1557bd29db364790a66d752
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 27 09:58:34 2022 +0000

    Bug 20517: (QA follow-up) Fix return undef.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 25c60481e72fa2962ce96f5c71abfea5367dc73d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 27 09:50:33 2022 +0000

    Bug 20517: Add support for specifying comparitor
    
    This patch adds support for specifying the comparison operator used in
    the sort bin method. It allows for more complex cases where one may wish
    to sort on groups of callnumbers for example.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de52dcd974c12e9a5d09bd640a5179cbff2d9a78
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 27 09:49:23 2022 +0000

    Bug 20517: Add unit tests
    
    This patch adds some unit tests for the new _get_sort_bin function.
    
    We're testing that rules are applied in order and that the different
    comparison operators work as expected.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit afbe5deddc7a4c6bba7c6e27749795a6be564c2c
Author: Magnus Enger <magnus@libriotech.no>
Date:   Fri Apr 24 12:02:02 2020 +0200

    Bug 20517: Use the "sort bin" field in SIP2 Checkin Response
    
    This bug adds the SIP2SortBinMapping to make it possible to tell
    the Koha SIP2 server to include a sort_bin/CL field in the
    Checkin Response, if appropriate.
    
    To test:
    - Check out an item and return it via SIP2:
      $ telnet localhost 8023
      9300CNterm1|COterm1|CPCPL|
      09N20200422    12430020200422    124300APCPL|AOCPL|AB001|AC|
      (Where 001 in |AB001| is the barcode of the item in question)
    - Check there is no CL field in the last response
    - Apply the patch, fill in SIP2SortBinMapping with e.g.:
           CPL:itype:BK:3
    - Repeat the first step
    - Check the respons contains a CL field with a value of 3 (or what
      you put in the config). The field should look like |CL3|
    - Signe ye offe
    
    2020-06-25: Pass an item to _get_sort_bin, not a checkout. Rebase.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 67fcaae5b1a66afa647c35354cf582a2d7f9b243
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 16:59:37 2021 +0200

    Bug 29059: Keep non-repeatable attribute from patron to preserve when merging
    
    See bug 21648 comment 17.
    
    Suggestion is to keep the non-repeatable patron's attribute from the patron we selected instead of raising a blocking error.
    
    A side-effect will be that when several patrons are merged, the
    non-repeatable attribute from the first one will be kept, which can
    result in unexpected result if the original patron does not have the
    attribute defined.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f507b685be89fdfaff2dc7048ab7e024f80abe64
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Feb 10 12:19:22 2022 -0500

    Bug 30076: Add ability to check patron messaging preferences from a notice
    
    Some libraries want to be able to use a patron's messaging preferences to conditionally change the contents of a notice depending on the patron's other messaging preference. For example, a library has requested to have the note on the hold slip if the patron has requested phone messages for waiting holds. This really only entails adding a method to the Koha::Patron class to allow this type of looking.
    
    Test plan:
    1) Apply this patch
    2) Enable item checkout notices for a patron for email, but not sms
    3) Include the following in the notice:
       TEST1: [% borrower.has_messaging_preference({ message_name => 'Item_Checkout', message_transport_type => 'email' }) %]
       <br/>
       TEST2: [% borrower.has_messaging_preference({ message_name => 'Item_Checkout', message_transport_type => 'sms' }) %]
    4) Generate a checkout and notice for that patron
    5) Note the generated notice has a 1 for TEST1, but not for TEST2
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ac0f648b350f802585c69a9c4fde25b83098fabf
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Mar 28 23:21:31 2022 +0200

    Bug 21225: (QA follow-up) Update pref description of SyndeticsCoverImages
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 597bbae122642e26303f6ff17690b9c24d4620d6
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Mar 28 17:19:25 2022 +0000

    Bug 21225: (follow-up) correct filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2baeff3ca82721a24b5be9b8138a81b337623e60
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Feb 16 17:48:50 2022 +0000

    Bug 21225: (follow-up) Account for Syndetics lightbox
    
    To test:
    -Make sure when you apply all the patches that when you click on the Syndetics image in the detail page that it correctly displays the lightbox.
    -Turn on some other cover image services and make sure you can toggle through each of them.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f272a22d64d84d904a9ef0ada6915fb47595abec
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Feb 15 22:59:37 2022 +0000

    Bug 21225: (follow-up) Make SyndeticCovers work on catalog detail page
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cd71fad77b669c7aa365372cd3be714792e553e7
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Feb 15 18:55:59 2022 +0000

    Bug 21225: Add Syndetics cover images to staff client.
    
    To test:
    1 - Enable system preferences:
        SyndeticsEnabled
        SyndeticsCoverImages
        SyndeticsClientCode (you will need a valid code for testing)
    2 - Perform a search on the staff client
    3 - Check that results have images if upc,oclc number, or isbn existin record
    4 - Confirm that dtails paeg displays same image
    5 - Confirm size on details page follows syspref  SyndeticsCoverImageSize
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bed1646444a9933186ecdbf6a55d3f4c3ecc4b5f
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Tue Jan 11 15:11:37 2022 +0000

    Bug 22827: Add age dependency on other fields than dateaccessioned
    
    A new agefield has been added to the 'Automatic item modifications by
    age' tool. The options for the agefield are: replacementpricedate, datelastborrowed,
    datelastseen, damaged_on, itemlost_on, withdrawn_on
    
    If no option is selected then Koha will default to saving 'agefield' =
    items.dateaccessioned
    
    Similarly, if a Koha instance has an old item rule without 'agefield'
    defined then Koha will default to using 'items.dateaccessioned'.
    This is confirmed by the AutomaticItemModificationByAge.t unit test.
    
    Test plan:
    
    1. Go to: Tools > Catalog > Automatic item modifications by age
    2. Observe there is a new 'Age field' dropdown in the rule form.
    3. Create a rule, set the values:
    - 'Age in days' = 20
    - Leave 'Age field' = 'Choose an age field'
    - 'Substitutions': 'items.barcode' = 'test'
    - Save the rule
    4. Confirm the 'List of rules' page displays 'items.dateaccessioned in the 'Age field' column
    5. Add another rule:
    - 'Age in days' = 2
    - 'Age field' = 'items.datelastseen'
    - 'Substitutions': 'items.barcode' = 'test2'
    - Save the rule
    6. Confirm the 'List of rules' page displays 'items.datelastseen' in
    the 'Age field' column for that second rule
    7. Add some more rules and confirm you can delete them
    8. Edit a record:
    - Make the items.dateaccessioned = 3 day ago (so rule 1 is false)
    - Make the items.datelastseen = 3 days ago (so rule 2 is true)
    9. Run the automatic_items_modification_by_age.pl:
    - sudo koha-shell <instance>
    - cd misc/cronjobs
    - ./automatic_item_modification_by_age.pl -v -c
    10. Confirm the item has it's barcode set to 'test2'
    11. Run unit tests:
    - sudo koha-shell <instance>
    - prove t/db_dependent/Items/AutomaticItemModificationByAge.t -v
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 051dd6bf0b9a005bd0dc1679db7161fc85b3f50d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 1 15:12:17 2021 +0100

    Bug 29609: Centralized code to build the link to a biblio detail page
    
    There are 2 prefs that control the default view of biblio detail pages:
    IntranetBiblioDefaultView for staff and BiblioDefaultView for OPAC.
    There are as well viewISBD, viewLabeledMARC and viewMARC to allow/don't
    allow access to those page for staff members.
    
    This code need to be in a single place to avoid discrepancy.
    
    Test plan:
    Play with BiblioDefaultView and IntranetBiblioDefaultView and confirm
    that the links of biblio point to the correct view.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 482f9bdeb994143fafe7e4fb3a2aad0cbbf99e22
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Feb 2 23:36:58 2022 +0000

    Bug 27212: Add Table configuration to acqui-home.pl accounts table
    
    To test, apply the patch and clear your browser cache
    
    1. Go to acqui-home.pl
    2. Test that the "Columns" button works to show and hide columns.
    3. Go to Administration -> Table settings and look under the Acquisitions tab for the page 'acq_acqui-home' and the table 'accounts'.
    4. Hide each column and make sure it hides correctly on acqui-home.pl
    5. Test the export options (Excel, CSV, etc) and make sure hidden columns do not show up.
    6. Make sure the totals at the bottom of the screen can still be calculated
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bcfc1bea3eda23a6b952eaed0db4b6a8b7f96e65
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 17 14:02:35 2022 +0000

    Bug 30120: Save and apply extended attributes during self registration verification by email
    
    The self registration form stores a new borrower as a borrower modification when verifying by email.
    
    Borrower modifications can  handle extended attributes.
    
    This patch simply sotres the extended attributes in the modifications table, and approves a modification
    to the extended attributes only after patron is created
    
    To test:
    1 - Apply patch
    2 - Create a patron attribute and set it as viewable/editable in the OPAC
    3 - Set system preference PatronSelfRegistrationVerifyByEmail
    4 - Reigster a new patron on the OPAC, provide an email and populate the extended attribute
    5 - Retrieve the verification token, the last on in the messages table
        SELECT * FROM message_queue;
    6 - Go tot he url from above
    7 - Confirm successful patron creation
    8 - View patron record and confirm attribute was set
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b69afd96db72e2817e3831fce8a9bbec3b53bab4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Apr 7 10:42:28 2022 +0200

    Bug 30011: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de2d8ba3e4f611aadc29165a7748cc1797d87ce3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 3 15:58:38 2022 +0000

    Bug 30011: Update links to jQueryUI assets, remove datepicker references, etc.
    
    This patch updates templates to include the new version of jQueryUI. It
    removes some references to the now unused datepicker widget as well as
    the jQuery timepicker addon.
    
    Some minor JavaScript and style updates to fix issues resulting from the
    upgrade.
    
    To test, apply the patch and update the CSS in the staff interface AND
    in the OPAC
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    IN THE OPAC:
    
     - The OPAC only uses the tabs jQueryUI widget.
     - View pages where tabs are used: Bibliographic details, user summary,
       advanced search.
    
    IN THE STAFF INTERFACE:
    
     - The staff interface uses four jQueryUI widgets: accordion,
       autocomplete, sortable, and tabs
     - Test the accordion widget on two pages: Administration -> Table
       settings and Patrons -> Patrons requesting modifications.
     - Test autocomplete (requires PatronAutoComplete to be enabled) on
       various pages. For example:
       - From the "Check out" tab in the header search box.
       - From the "Search patrons" tab in the header search box, e.g. from
         the main Patrons page.
       - Place hold -> Search patrons.
       - Tools -> Patron lists -> Add patrons to list -> Patron search.
     - Test sortable:
       - Administration -> System preferences -> Language.
         - With more than one language installed you should be able to
           drag to re-order the enabled languages. Confirm that your change
           is saved successfully.
       - Administration -> MARC bibliographic framework -> MARC structure ->
         Edit subfields on a tag with multiple subfields. You should be able
         to drag to re-order the tabs at the top of the subfield constraints
         edit page. Confirm that your changes are saved successfully.
       - Cataloging -> New record. Test that you can re-order subfields
         under a tag with multiple subfields and that your changes are
         saved.
     - Tabs: View various pages with tabs: Check out, bibliographic details,
       basic MARC editor. They're everywhere.
    
    Also confirm that the removal of the leftover datepicker doesn't affect
    pages which use the calendar include: Test various pages which use
    Flatpickr, e.g. check out, renew, reports, etc.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ca6113decc9072b22d913bf3a266decbe048c950
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 3 15:45:09 2022 +0000

    Bug 30011: Upgrade jQueryUI to 1.13.1 in the OPAC and staff interface
    
    This patch updates jQueryUI in the OPAC and staff interface. Old assets
    are removed and new assets added.
    
    jQueryUI has been re-compiled in each interface to include only the
    required features. In the OPAC: tabs and tooltip. In the staff
    interface: accordion, autocomplete, sortable, and tabs.
    
    The next patch will make the required updates to templates.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f213ad6150f1f6e1aebcd4c335e1516e86fbeb6b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 29 13:09:41 2021 +0000

    Bug 29228: Use Flatpickr on offline circulation page
    
    This patch replaces the use of jQueryUI datepicker on the built-in
    offline circulation page, where it was used for the "Specify due date"
    date-time picker as well as for formatting datetime values for display.
    
    To test, apply the patch and go to Circulation -> Built-in offline
    circulation interface.
    
     - Click "Synchronize."
     - Click "Download records."
     - Submit a card number for a patron who has multiple items checked out.
     - In the table of previous checkouts, confirm that dates in the "Date
       due" and "Checked out on" columns are formatted according to your
       TimeFormat and DateFormat system preferences.
     - When checking out to a patron with fines, open the fines tab and
       submit an amount in payment. The table of payments should include a
       correctly-formatted datetime.
     - Test that the "Specify due date" date picker works correctly and that
       checkouts show the correct date.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 726c8605fcbe85cb0601fcad0f8146e1ea315821
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 09:03:26 2022 -0300

    Bug 29787: Add plugin version to plugin search results
    
    This patch adds a new column to plugins search results: 'Latest
    version'.
    
    It takes the tag_name in both GitHub and GitLab cases and passes it to
    the template.
    
    To test:
    1. Have this on your koha-conf.xml file:
    
     <plugin_repos>
        <repo>
            <name>ByWater Solutions</name>
            <org_name>bywatersolutions</org_name>
            <service>github</service>
        </repo>
        <repo>
            <name>Theke Solutions</name>
            <org_name>thekesolutions</org_name>
            <service>gitlab</service>
        </repo>
        <repo>
            <name>PTFS Europe</name>
            <org_name>ptfs-europe</org_name>
            <service>github</service>
        </repo>
     </plugin_repos>
    
    2. Restart all services:
       $ restart_all
    3. Search for the term 'barclaycard'
    => SUCCESS: You get results from PTFS Europe (Github)
    => FAIL: They don't include plugin version
    4. Search for the term 'innreach'
    => SUCCESS: You get results from Theke (Gitlab)
    => FAIL: They don't include plugin version
    5. Apply this patch
    6. Repeat 2-4
    => SUCCESS: Results show up
    => SUCCESS: Results include the plugin version
    7. Sign off :-D
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b025a7934557298a5b39428241f40329d6fab686
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Apr 7 10:34:40 2022 +0200

    Bug 11083: DBRev 21.12.00.022
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 39babc1645a27a3516b0a2822613104e2acfde65
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 24 09:38:24 2021 +0100

    Bug 11083: Add sample XSLT for UNIMARC authorities
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4978f3d562a6eae2c4aa032bca7089e0a4ac8770
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Jun 2 14:20:34 2021 +0200

    Bug 11083: Add ability to generate authority summary using XSLT
    
    This patch only affects authority search results in the staff interface.
    It adds a new system preference AuthorityXSLTResultsDisplay. If set,
    each authority search result MARCXML will be transformed using the XSLT
    at the given filename or URL. The output will be displayed in place of
    the default summary.
    If errors occur, the XSLT is ignored and the default summary is
    displayed.
    
    The syspref value can contain {langcode} and {authtypecode} which will
    be replaced by the appropriate value (resp. current language and
    authority type code)
    
    Test plan:
    1. Apply patch and run updatedatabase
    2. Verify that authority search results are not affected yet.
    3. Create an XSLT file (for instance in
    /home/koha/xslt/en/GEOGR_NAME.xsl)
    4. Set AuthorityXSLTResultsDisplay syspref value to
    /home/koha/xslt/{langcode}/{authtypecode}.xsl
    5. Do an authority search that returns GEOGR_NAME results. Verify that
    the summary matches what you expect from your XSLT
    6. Do an authority search that returns authorities of other types.
    Verify that the default summary is displayed.
    
    Example of a minimal XSLT:
    
    <?xml version='1.0' encoding="UTF-8"?>
    <xsl:stylesheet version="1.0"
     xmlns:marc="http://www.loc.gov/MARC21/slim"
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
      <xsl:output omit-xml-declaration="yes"/>
      <xsl:template match="marc:record">
        <xsl:element name="div">
          <xsl:attribute name="class">
            <xsl:text>authority-summary</xsl:text>
          </xsl:attribute>
          <xsl:value-of
            select="marc:datafield[@tag='151']/marc:subfield[@code='a']"/>
        </xsl:element>
      </xsl:template>
    </xsl:stylesheet>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cd762ddcd2a0518273cdbd706a3831f8b5634532
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Mar 29 05:37:30 2022 +1300

    Bug 30402: Import authorities subroutines to ImportBatch script
    
    The following authorities subroutines are used by the ImportBatch
    script but are not accessible, because they aren't imported. This
    caused MARC importing errors.
    - GetAuthorityXML
    - ModAuthority
    - DelAuthority
    
    These affected the BatchCommitRecords and BatchRevertRecords routines,
    and it wasn't caught because there are no tests written for them.
    
    To test:
    1. Find an existing authority record, or import one to use.
    2. Save this authority record (export/download).
    3. Go to Admin -> Record matching rules. Create a new record matching
       rule for authorities that matches on 001, Local-Number index.
    4. Go to Tools -> Stage MARC for import. Upload the authority file you
       just downloaded.
    5. Change record type to authority.
    6. Under 'Look for existing items in catalog?', set the record matching
       rule to the rule you just made which matches on 001. If matching
       record found, replace the existing one. If no match is found, ignore.
    7. Stage the record. Once complete, a match should've been found.
    8. Go to Staged MARC management.
    9. Import the batch into the catalog. Notice it hangs and never
       completes.
    
    10. Apply the patch and restart services.
    11. Repeat steps 4-9. This time importing should be successful.
    
    Sponsored-by: Educational Services Australia SCIS
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a46f8a097412b28df268dc6e043cf39464a5678d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 6 11:35:41 2022 +0200

    Bug 29859: Fix BatchUpdateAuthority
    
    Use of inherited AUTOLOAD for non-method Koha::BackgroundJob::BatchUpdateAuthority::ModAuthority() is
    no longer allowed
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3b2322ea1ffdc4138e865c72f358b6766a509ac3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 5 15:19:12 2022 +0200

    Bug 29859: Fix club/enroll
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 46d0d6aa69a6767a72629ec38b793e6ad5df0e80
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 5 13:25:53 2022 +0200

    Bug 30063: (follow-up) Fix missing TT filters
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c636b39a892722773d7f5e5b8a213af93e9fb38b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Apr 5 11:56:34 2022 +0200

    Bug 30063: Fix missing TT filters
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 33aa6953f19b039de9b3ce4981a7666cfd27ca39
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Apr 4 16:28:37 2022 +0200

    Bug 30063: DBRev 21.12.00.021
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8cd49951bf3513c6eaceaf4494375ad01636250b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Mar 29 13:27:10 2022 +0200

    Bug 30395: Fix TT filtering of publicationyear in reserve/request.tt
    
    biblioitems.publicationyear is not a date (it can be, but we cannot
    guarantee that) so the $KohaDates filter should not be used on this data
    
    Test plan:
    1. Verify that in the default MARC framework there is a field linked to
       biblioitems.publicationyear (typically it's 210$d for UNIMARC)
    2. Create a biblio with a non ISO-formatted date in this field. It
       can be a "YYYY" year for instance. Create an item for this biblio.
    3. Try to place a hold on this biblio. If it works, you can sign off
    
    Signed-off-by: Sonia <sonia.bouis@univ-lyon3.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 666a322acb3f8ab9365ac9c0cf00e1dcd1b4fed8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 23 15:47:38 2022 -0300

    Bug 30345: Make Koha::BackgroundJob->enqueue set borrowernumber=undef if no userenv
    
    This patch makes ->enqueue set undef if no userenv is provided. The CLI
    scripts will usually use Koha::Script and have this set to undef as
    well, but on the tests, there's usually no userenv set unless we need to
    test it. And as we are adding triggers everywhere, that will schedule
    background jobs, it means we would end up mocking userenv or the
    ->enqueue method everywhere and it will get messy.
    
    This patch just make it set undef.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/BackgroundJob.t
    => FAIL: Wow, it explodes badly. Same as any test that happens to
    trigger a background job enqueuing.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Great, tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8a7a11a1aec9ab30fe9b56f117dcf0f61dc79655
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 23 15:47:24 2022 -0300

    Bug 30345: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Arthur Suzuki <arthur.suzuki@biblibre.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 213ef1cd72b5e2bb4a8529b9d25c9fc55abf1a88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 24 16:24:06 2022 +0100

    Bug 30172: Enqueue the job even if rabbitmq is not reachable
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7585db29c08078d2b85faf27d110c4598e03881d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 24 10:41:16 2022 +0100

    Bug 30172: Prevent race condition when enqueuing a new task
    
    As we are sending the job to the rabbitmq before in the transaction, the
    worker can receive the job to process before the transaction committed.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 24d1b4edd9301220e101a5209df1f4956272230a
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Mar 9 18:41:56 2022 +0000

    Bug 30107: When editing desks default to the branch the desk belongs to
    
    TO test:
    1. Turn on UseCirculationDesks
    2. Add some desks via Administration > Circulation desks, make several and have them belong to different libraries.
    3. Go edit some of those desks and notice the Library: dropdown always defaults to the users logged in branch
    4. Apply patch
    5. Try editing desk again, now the dropdown should default the library that the desk belongs to.
    6. Try making a new desk and make sure it defaults to the logged in branch
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit be67a035be016c9ce6935895600896a2639546bc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 30 12:25:55 2022 +0000

    Bug 26669: (QA follow-up) Update last run when report run by name
    
    This alters the svc scripts to set the report id after fetchign the report object
    to ensure it is passed to exectue query
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d3fc45e20c0dbbd6c7aeca8c039880ededea435e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Mar 30 12:25:42 2022 +0000

    Bug 26669: Adjust POD
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit affd0caea5b466f62447bb5d1306877853d5d2fc
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 14 16:46:25 2021 +0100

    Bug 26669: Last Run if report not always updated
    
    The last run of a report is updated only if method execute_query() is
    called with report_id.
    This whas missing for :
    - when report is run publicly
    - when report is sent by email
    - when report is exported
    
    Patch changes the method signature to use a hash of params, in order to
    easily avoid some params.
    
    Test plan :
    
    1) Create a report.
    2) Run report.
    3) Check the report listing.  Confirm that the last run info on the report is updated.
    4) Make report public.
    5) Run report via public url.
    6) Check the report listing.  Confirm that the last run info on the report IS NOT updated.
    7) Schedule the report to run at a given time and e-mailed to an address.
    8) After the report runs at the scheduled time, check the report listing.  Confirm that the last run info on the report IS NOT updated.
    9) Run report.
    10) Export results.
    11) Check the report listing.  Confirm that the last run info on the report IS NOT updated AT THE TIME OF THE EXPORT.
    
    Questionable (I don't know if this is addressed):
    12) Run report on backend through a cron job and send results via e-mail.
    13) Check the report listing.  Confirm that the last run info on the report IS NOT updated.
    
    14) Apply patch.
    15) Rerun steps 2-13.  Confirm that steps 3, 6, 8, 11, and 13 DO UPDATE the last run info.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 28b478f8ab31359df1706e9039b9b4fea62725ca
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 14 16:41:07 2021 +0100

    Bug 26669: Avoid a warn in update_sql
    
    In C4/Reports/Guided.pm update_sql() called by test suite return warn :
    Use of uninitialized value $sql in substitution (s///)
    
    Test plan :
    Run prove t/db_dependent/Reports/Guided.t and see warning disapearing
    (whouchhhh)
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 410eb78a73a43cc235e98044a98dff76503b6ded
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 30 14:07:20 2022 +0200

    Bug 30408: Make API and OpenAPI versions strings in spec
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 91c248adec65e90b2eb5fe236f9aad63ec1186d5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 30 13:57:39 2022 +0200

    Bug 30394: Make datatables.js aware of x-koha-request-id
    
    This patch makes the wrapper handle the data.draw parameter (from
    DataTables) translating it into the x-koha-request-id header for making
    the Koha request, and then translates the received header into data.draw
    for proper use in DataTables.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b25f6f1c304dca83c1da95dcc6d75cfbd2c977a4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 30 13:54:24 2022 +0200

    Bug 30394: Add x-koha-request-id support on API routes
    
    This patch adds the x-koha-request-id to all GET routes that rely on
    objects.search, for immediate support for the header.
    
    The patch itself is trivial:
    - It adds the header parameter definition to the top level swagger.yaml
    - It adds a reference on each route that already implements q params,
      etc
    
    To test:
    1. Apply the patch
    2. Reload plack
    3. Notice the API still works
    4. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/query.t
    => SUCCESS: It now passes! The /cities route implements the
    x-koha-request-id header pass through.
    5. Run the rest of the API tests
    => SUCCESS: All good
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9aea9241f3a3fa084b3eaa25d007c69ed7ea40f8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 30 13:45:48 2022 +0200

    Bug 30394: Add x-koha-request-id handling in controllers
    
    This patch adds 'x-koha-request-id' to the reserved param names list,
    and makes the objects.search helper read it and send it back in the
    response headers.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9453fc6a9fd1289bf516fcb809c80b600c86ef98
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 30 13:43:50 2022 +0200

    Bug 30394: Unit tests
    
    This patch adds tests for checking the x-koha-request-id header is
    returned on GET routes that have it enabled, and then the request
    includes it.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/query.t
    => FAIL: The feature is not implemented, tests fail
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fe4101140ea5ec40e18233a1d9be61455092de07
Author: Kevin Carnes <kevin.carnes@ub.lu.se>
Date:   Tue Feb 8 14:48:19 2022 +0100

    Bug 28610: Elasticsearch 7 - hits.total is now an object
    
    In Elasticsearch 7 hits.total is now an object which is not always an exact
    value. You can always get an exact total by adding a track_total_hits
    parameter set to true when using the Elasticsearch search method
    
    To test:
    1) Run prove t/db_dependent/Koha/SearchEngine/Elasticsearch/Search.t
    2) If you observe an error about types, apply patch for bug 25669
    3) Run prove t/db_dependent/Koha/SearchEngine/Elasticsearch/Search.t
    4) Observe that tests with count fail
    5) Apply patch
    6) Observe that tests with count pass
    7) Sign off
    
    Sponsored-by: Lund University Library
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 56107babc72da9d99b9fd7a097f3c8ff741435b4
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 28 12:07:43 2022 +0000

    Bug 30377: Fix two CGI::param called in list context-warnings
    
    Trivial fix.
    
    Test plan:
    Delete two lines from opac search history.
    Verify results. Check plack-opac-error.log.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4a35fd536348c95811b58116262c5ba3c6ee7248
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Fri Dec 11 10:46:04 2020 +0100

    Bug 22038: Fix excel export if CurrencyFormat is FR
    
    DataTables excel export is broken if number decimal separator is a comma.
    
    Test plan:
    1 - Set syspref CurrencyFormat to US
    2 - Export as excel a table with decimal numbers, patrons list with fines
    for example.
    3 - Open in libreoffice or excel, numbers are ok.
    4 - Set syspref CurrencyFormat to FR
    5 - Export and open again, number are wrong 25,10 is imported as 2510
    6 - Apply patch
    7 - Redo 1 to 4
    8 - Excel export, number is 25,10
    
    Signed-off-by: hakam <hakam@inlibro.com>
    Signed-off-by: Florian Bontemps <florian.bontemps@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 31960e86dfb58dc2b2acc09af3c6f78573cd380b
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Feb 15 01:51:04 2022 +1300

    Bug 13952: (follow-up) JS translatability, clean warns, other
    
    Also addresses QA test tools, perldoc in ImportExportFramework.pm
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1566cbf66c678d2f5b1993045337d9c1599ca5c8
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Dec 4 14:43:14 2020 +1300

    Bug 13952: (follow-up) fixing indentation and rebasing
    
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 30a572c4d235382fc3c1544da354e8797775c100
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Apr 21 07:22:28 2020 +0000

    Bug 13952: (follow-up) Removing XML options
    
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 38801593601e9fbe5c927f8a84dda109974cb95c
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Feb 14 03:18:43 2019 +0000

    Bug 13952: (follow-up) Tests
    
    Run:
    prove -v t/db_dependent/ImportExportFramework.t and confirm all tests
    pass.
    
    I've also added a fix to remove the warns when exporting in ODS format.
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1b856c681e7c5d86c78f4443fb7aacc4a368ef65
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Dec 5 21:33:48 2018 +0000

    Bug 13952: (follow-up) template filters, moving js to separate file
    
    This patch adds filters to the template file and moves the JS into a
    separate file.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 89ddb78a0b83906bdb806890aa10008b0c9bbc07
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Oct 24 20:46:13 2017 +0000

    Bug 13952: (follow-up) Fixing export on default biblio framework
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cd678211ffd8b7435540368c0374bc2455323629
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Oct 19 23:57:13 2017 +0000

    Bug 13952: (follow-up) Fixing import for default auth type
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 49252cc7b48a7e1106745335d67c4219dfcdc291
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Jun 19 01:00:19 2017 +0000

    Bug 13952: (follow-up) Fixing authority type import
    
    This patch fixes the comments from Comment 29 and the import
    functionality. You should now be able to import an exported file without
    editing the file at all and the authority type code will be overwritten
    in the file (same behaviour as biblio frameworks).
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a1be9f26c2903d80300946c7be666cbf0bef6bf9
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Jan 26 23:39:26 2016 +0000

    Bug 13952: Import and export authority types
    
    This patch amends C4::ImportExportFramework to work for authority types as well as MARC frameworks.
    New file: admin/import_export_authtype.pl
    Update: Ensuring we are passing the right column to the right tables.
    Update2: Making the error messages the same to be consistent with patch on Bug 15665
    Update3: Fixing merge conflicts
    Update4: Fixing merge conflicts and removing tabs
    Update5: Getting rid of warns, making sure Import and Export of default
    authority will work
    Update6: Merge conflicts and making sure export of default auth type
    works
    Update7: Fixing merge conflicts and updating buttons to bootstrap3
    
    To test:
    1) Go to Admin -> Authority types
    2) Confirm there are two new columns 'Export' and 'Import' in the table
    3) Click 'Export' on an existing authority type and choose a file type, click 'Export'
    4) Confirm that the authority type is exported as your chosen file type. Save the file
    5) Create a new authority type
    6) Import into your new authority type using the file you just exported
    7) Confirm you are taken to auth_tag_structure.pl
    8) Go back to Authority types
    9) Export your new authority type. View the exported file and confirm
    the authtypecode has been updated to match the code you set for the new
    auth type
    10) Click 'Import' next to any existing authority type and attempt to import a file that is not XML, CSV or ODS. Confirm that this fails and you are asked to import a file of the correct file type
    11) Confirm Export and Import work for the Default authority type
    12) Go to Admin -> MARC bibliographic framework
    13) Confirm that the 'Export' and 'Import' functions still work here as well
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Signed-off-by: Mazen Khallaf <mazen.i.khallaf@gamil.com>
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d5c73038e4c35545c857fdff82a29fb2aa0a2a30
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 25 09:05:18 2022 +0100

    Bug 30222: Remove warning
    
    Use of uninitialized value in string ne at misc/cronjobs/automatic_renewals.pl line 193.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bb5827ba792535a99ab7935c5fee93f3ddd3b96f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 15 13:34:39 2022 +0000

    Bug 30222: Further simplify logic
    
    For any borrower, we are either:
    1 - following their preference, and that should set 'wants_email'
    OR
    2 - Never sending / following the cron, and can determine 'wants_email'
        from the 'send_notices' variable
    
    This patch adds an 'else' if not using preferences to accomplish this
    
    Follow test plan on previous patches
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3e4f9cd578f54a162c72137a4ad2bd4948b6b3d9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 11 13:24:33 2022 +0000

    Bug 30222: Simplify logic for reporting
    
    This patch adds two new variables:
    $wants_email and $wants digest
    
    These are used to simplify checks on whether notices should be sent
    
    To test:
    1 - Apply patch
    2 - Confirm notices are not sent of pref is 'cron' and send_notcies flag not set
    3 - Confirm notices are sent if pref is cron and send_notices flag is set and borrower
        does not have preference set for auto renewals
    4 - Confirm notices not sent if pref is set to follow messaging preference and borrower
        does not have preferences set for auto_renewals
    5 - Confirm regular notices sent if pref is set to follow messaging preferences and borrower
        does have the preference set but not digest
    6 - Confirm digest notices sent if pref is set to follow messaging preferences and borrower
        does have the preference set and wants digest
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 641011806df9b25881a4839334855c8d5c811fcd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 11 12:00:26 2022 +0000

    Bug 30222: Only send auto renewal digest wehn there is an update
    
    Currently, the code sends an email to the patron when there is any error that is not
    'too_soon' - we also don't include issues that are 'too_soon', so emials may be missing information
    
    This patch changes the code to:
    1 - push all issues that were checked to the report when a borrower wants a digest
    2 - adds a variable to track when any of the issues has been updated, and checkes this when
        sending digests
    3 - if nothing has been updated, no report is sent to the patron
    
    To test:
     1 - Checkout an item, marked for autorenewal, backdated to be overdue to a patron
     2 - Set preferences
        AutoRenewalNotices = 'according to patron messaging preferences'
        EnhancedMessagingPreferences = 'Allow'
     3 - Set the patrons preference for auto renewal to email+digest
     4 - Ensure the patron has an email
     5 - Place an item level hold for another patron on the issued item
     6 - perl misc/cronjobs/automatic_renewals.pl -v --confirm
     7 - Check patron record/notices tab
     8 - Note item not renewed, patron notified
     9 - perl misc/cronjobs/automatic_renewals.pl -v --confirm
    10 - Note item not renewed, status not changed, patron notified again
    11 - Apply patch
    12 - perl misc/cronjobs/automatic_renewals.pl -v --confirm
    13 - Item not renewed, patron no notified
    14 - Checkout another item marked for auto renewal to the patron, but due in the future
         ensure it is outside of 'no renewal before'
    15 - perl misc/cronjobs/automatic_renewals.pl -v --confirm
    16 - Patron not notified, items not renewd
         Change to status of 'auto_too_soon' is not notified
    17 - Checkout a third item, marked for auto renew, overdue
    18 - place an item level hold for another patorn on third item
    19 - perl misc/cronjobs/automatic_renewals.pl -v --confirm
    20 - patron is notified, nothing renewed, all statuses reported
    21 - cancel the item level hold on third item
    22 - perl misc/cronjobs/automatic_renewals.pl -v --confirm
    23 - item renewed, patron notified, all statuses reported
    24 - perl misc/cronjobs/automatic_renewals.pl -v --confirm
    25 - nothing renewed, patron not notified, only change is one issue 'auto_too_soon'
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8ca69ae53d46b29ce757a9e3face44fa2d8a6c7f
Author: Jake Deery <jake.deery@ptfs-europe.com>
Date:   Tue Feb 8 11:40:06 2022 +0000

    Bug 30003: Prevent double up of point-of-sale items
    
    This patch prevents the double submission of point-of-sale items when form validation fails at the first submission
    
    Test plan
     1.  Navigate to /cgi-bin/koha/pos/pay.pl
     2.  Add an item from 'items to purchase'
     3.  Under 'collect payment', click submit without altering the form
     4.  See 'This field is required.'
     5.  Now, fill a value in 'Amount tendered' that satisfies or exceeds 'Amount being paid'
     6.  The payment should succeed
     7.  Navigate to /cgi-bin/koha/pos/register.pl
     8.  See duplicate lines in Transactions
     9.  Apply patch
    10.  Repeat 2-6
    11.  Navigate to /cgi-bin/koha/pos/register.pl
    12.  Confirm only a single line was added
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bdf79ce8771a0b7a736480794b7ea313785afce4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Mar 27 00:05:02 2022 +0000

    Bug 29576: (QA follow-up) Rename road type to street type to match patron form
    
    This changes the pref description so the field name matches what
    we use in the patron form.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 48d9fdf23a24703f1e7590333dee45316e49d182
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Thu Nov 25 15:39:14 2021 +0100

    Bug 34874: Add streettype and B_streettype to PrefillGuaranteeField
    
    To test :
     1) modify PrefillGuaranteeField system preference
     2) road type for main and alternate addresses aren't in the list
     3) Apply patch
     4) Redo 1, now they are
    
    https://bugs.koha-community.org/show_bug.cgi?id=29576
    Signed-off-by: The Minh Luong <the-minh.luong@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 821897bbffd3db8a47a665ce548f97baf25140a0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 18 12:03:36 2021 +0000

    Bug 29517: Check if agerestriction field is mapped before fetching biblio
    
    This patch simply adds a check of cached values to see if agerestriction enabled before
    fetching the biblio object
    
    To test:
    1 - prove -v t/db_dependent/Holds.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4c52488bd9a76ed382e1f0cdf4d1bb73ddcb5748
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Feb 15 11:33:33 2022 -0500

    Bug 30114: Koha offline circulation will always cancel the next hold when issuing item to a patron
    
    If a record has holds on it, and, using offline circulation, an item on
    that is checked out to a patron that did not have a hold on the record,
    the next hold that would have trapped that item will be canceled.
    
    1) Place two bib level holds on an item for two patrons
    2) Find a third patron, note his or her cardnumber
    3) Create the file test.koc by copying and pasting the following into a
       text editor
    
    Version=1.0     Generator=kocTest       GeneratorVersion=0.7
    2008-06-11 12:24:11 547 issue   PATRONCARDNUMBER        ITEMBARCODE
    
    note the fields are tab delemited, ensure the tabs do not get lost
    when copying and pasting!
    
    4) Upload the offline circ action, and commit the action
    5) Note the item was checked out to the third patron
    6) Note one of the other patron's holds were canceled
    7) Reset your database
    8) Apply this patch
    9) Test again, no hold should be canceled!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aca5ac97692938bc88ec0593bd40d1863d7fcb64
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Mar 7 09:07:14 2022 -0500

    Bug 30114: Add Unit Tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2e6af702f547c24ab7515e136317c6e866c794a0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 21 13:45:16 2022 -0300

    Bug 29501: Use the default transport
    
    This patch makes the script pass the default SMTP transport to the
    ->send_or_die call.
    
    The default is picked as this is the current behavior. New enhancements
    could add the *library_id* to the message_queue table, and allow using
    different transports depending on that. But it is out of the scope of
    this bug.
    
    To test:
    1. Verify messages are being sent.
    2. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    JD amended patch: revert
    -        unless $format =~ m[^html$|^csv$|^ods$];
    +        unless $format =~ m/^html$|^csv$|^ods$/;
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8af1605df6ac0ef0b4e6f9ff72569373acfbc828
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 8 11:36:56 2022 +0000

    Bug 29501: (follow-up) Remove unused MIME::QuotedPrint dependency
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d66ea510b3167cce3a52f147e8cd487fa9676168
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 18 09:41:44 2021 -0300

    Bug 29501: Remove MIME::Lite dependency
    
    The library usage is discouraged by the current maintainer and we don't
    use it in the codebase anymore.
    
    To test:
    1. Apply this patch
    2. Run:
       $ git grep MIME::Lite
    => SUCCESS: No uses of the removed library
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 241cd7ff37fdb037e2bd662d282cfed745876809
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 18 09:40:22 2021 -0300

    Bug 29501: Make gather_print_notices.pl use Koha::Email
    
    This patch makes the cronjob script use Koha::Email and thus relying on
    configured SMTP settings instead of just trying localhost.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9dcdb73e47e4513257d38ffc06fa07a054862b67
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Apr 4 09:46:47 2022 +0200

    Revert "Bug 30425: April fools 🐟: Add ponies to staff homepage"
    
    This reverts commit 68b56685c74779a2859e13cbccf340c892544d2d.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d7f7fd7216cb9bcdee42f466ddbef901f7efd40a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Apr 1 10:18:22 2022 +0200

    Bug 30063: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3d18bafe5123614ecb13a2a5d194390caa92fb6f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 31 10:30:22 2022 +0200

    Bug 30404: Enlarge all patron search pop-ups
    
    Enlarging the pop-ups will hide the scrollbars (at least the horizontal
    one).
    
    Test plan:
    Search for patrons (when a new pop-up is opened) and confirm that the
    pop-up is bigger than without this patch.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 35572fb6d04c850184376d311a2efd254b12f2af
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 31 14:43:50 2022 +0200

    Bug 30063: Fix QA issues
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 31130a92fe7b90a1677c466ba80b56e58fbe53ab
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 30 17:31:38 2022 +0200

    Bug 30063: Sort by "Name" surname:firstname
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e79a66e6560fac14762396c0fe28b9355859bd17
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 30 13:37:40 2022 +0200

    Bug 30063: Fix permission for GET /patrons
    
    edit_borrowers should be enough, we don't need the whole borrowers
    module flag
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9650776ed7061e49c0f986dfde5417e0f28495d1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 30 13:34:01 2022 +0200

    Bug 30063: Fix start with
    
    It was doing "end with"...
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f6394501f2ae6468cef8279ba8e296427cb69188
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 30 13:02:07 2022 +0200

    Bug 30063: Restore back behaviour
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7d2d53793ba7b01991dda669696576cff42ab5fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 30 10:28:34 2022 +0200

    Bug 30063: Sort by "Name" firstname,surname
    
    As it's how it's displayed
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8faf97ee36c5b1e3876306c96bdb3f57b2ff3291
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 29 10:28:43 2022 +0200

    Bug 30063: Fix table settings
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8635a0060cb568e895ed817ecab62aae0217051b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 23 17:36:50 2022 +0100

    Bug 30063: Be more flexible for filters
    
    On later follow-ups (ERM) we need to filter columns that contain AVs,
    and so be more flexible. Here we are expecting a _id and _str keys we
    are gonna use to build the select's options
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 61f82da49aa7bc5fe24488b95a423b62de2f1581
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 17 12:38:29 2022 +0100

    Bug 30063: Add selenium tests
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 539fcf8ae0ba5916f2d40a96164fda7146b6f171
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 15 17:08:05 2022 +0100

    Bug 30063: Fix sticky
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 35fb56169a06f36077162372af82e4e9a60881fe
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 15 12:28:23 2022 +0100

    Bug 30063: Fix selenium tests
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e24172bbe998bcd76f1148b1ea210d8082169888
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 15 11:18:09 2022 +0100

    Bug 30063: Display search description for main search only
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1eeb6eafaa80dfbaf7584ba776b3c840dd697533
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 14 17:33:43 2022 +0100

    Bug 30063: Add kind of POD for the include file
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a853b0653f1096a5b1d8ec5aea2132487c65670c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 14 17:13:53 2022 +0100

    Bug 30063: Fix address format
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4369f41463bf7843a87fce83ebd3c9eff2dd11d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 14 15:15:30 2022 +0100

    Bug 30063: Remove occurrences of C4::Utils::DataTables::Members
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 146c619eaefac22d8c649cdafb2b57d5298ff837
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 14 11:16:26 2022 +0100

    Bug 30063: Remove svc/members/search
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 565bf8a0069e6882361e1a9353eb2cc0722318ac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 14:03:36 2022 +0100

    Bug 30063: Make the main patron search use the REST API
    
    To test:
    * Length menu (PatronsPerPage)
    * Query description
    * Highlight of the current library
    
    * sticky header - Does not work (?)
    
    If the table does not show when you submit the filter form, make sure
    you regenerated the compiled CSS.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fe7a63027353d143a448ad2e56b7d49a64037aa6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 10:58:14 2022 +0100

    Bug 30063: Overdues count
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f3834f7ebe7d537f7c13276f3437d841dc0465bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 09:39:12 2022 +0100

    Bug 30063: Number of checkouts
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 80538cc8d90607d8d47bca66d92abbddc3b3fb97
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 31 13:33:42 2022 +0100

    Bug 30094: (QA follow-up) Mke the QA script happy
    
    Remove newlines from a template block
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 04fd367b2a2257702c404b150791601cbf709f59
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 14 15:13:17 2022 +0100

    Bug 30094: Make the patron search from request-article.pl use the REST API
    
    Reuse what has been done before to implement the patron search using the
    REST API route, when requesting an article
    
    Test plan:
    Request an article for a patron and confirm that the search is working
    correctly.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8b6d7448156ca5b97d421876264f0a6cc8f116bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 31 13:44:16 2022 +0200

    Bug 30093: Fix QA failures
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 98ae9dfb6383d8d86af08ebc58b0cb5e9a062719
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 21 11:56:06 2022 +0100

    Bug 30093: Restore the autocomplete feature
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 89a54da63ea8da4951d9f3f02a10ca50e96c399f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 16:29:23 2022 +0100

    Bug 30093: Make patron search from request.pl use the REST API
    
    In this patch we want to reuse what has been done in the previous bug
    report to search patrons using the REST API route.
    The code is mainly in members/search.tt, for all the patron searches
    that "add" or "select" a patron (popup windows).
    The patron search for holds is a bit different, we don't want to open a
    popup window.
    We are moving to code to an include file (patron-search.tt) to make it
    reusable easily.
    
    Note that we are improving how the patron's addresses are displayed, and
    provide a JS equivalent to the TT includes files.
    
    Test plan:
    Search for patrons from the "Place a hold on" view.
    You should see the same view as behaviour, with more filters.
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ce1ab5a38692fb890b526dfc3ab2ea8605ac7cbd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 16:14:47 2022 +0100

    Bug 30093: Rename patron-search.inc to patron-search-header.inc
    
    We will use 'patron-search.inc' in the next patch
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c43634e207a58ddab18bd6496453ff30eb85337c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 30 10:14:50 2022 +0200

    Bug 30055: Add missing x-koha-embed for /acquisitions/baskets/managers
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 10d3fd9fd89b35db0ae78c33541cdf8d31789546
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 29 17:26:21 2022 +0200

    Bug 30055: (follow-up) Adapt spec for bug 30194
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9bbbed2a4024311cbbd9b828eba0512f63069735
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 29 15:37:59 2022 +0200

    Bug 30055: API unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 073536572ffa5daa2f67f896042097f326995929
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 29 12:59:54 2022 +0200

    Bug 30055: (QA follow-up) Minor QA fixes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 883e1b9d632e434fa76560f574d42a1a3c52c932
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 24 16:03:50 2022 +0100

    Bug 30055: clear the column filter if none selected
    
    ie. search for "", not "^$"
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ca27beb7525f6a81abc8d456dc42db5929b863e4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 17 09:26:02 2022 +0100

    Bug 30055: Force exact match for dropdown
    
    For libraries and categories we need to use an exact match.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a4366b0b4579c7535601ef78bb627f65c129b105
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 17 10:57:25 2022 +0100

    Bug 30055: Don't hardcode the default sort column
    
    At this point it does not change anything, all calls to
    members/search.pl has "name" in second column, but that will be helpful
    in follow-up bugs.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4a38660680fa39a5d521606133ea037adcae5845
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 17 08:30:03 2022 +0100

    Bug 30055: (follow-up) Add missing embeds
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e2474b1ee476ceda6efa8aa6e288de26769aef31
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Feb 15 11:22:02 2022 +0000

    Bug 30055: (follow-up) Increase popup window size
    
    With the required addition of fields to the displayed result table, we
    need to increase the size of the popover window to prevent horizontal
    scrolling.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8ed75333d4ddbb6ea8bc0c458af56f15168559d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 14:06:58 2022 +0100

    Bug 30055: Missing search on othernames
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 014c3a74686e92f4f48cfa0a1c7c65153ce5142b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 14:49:51 2022 +0100

    Bug 30055: Restore DefaultPatronSearchFields and fix extended attrs search
    
    We lost the DefaultPatronSearchFields behaviour, we don't want to search
    on all data but only DefaultPatronSearchFields
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8a21a9c8d89b56b8e8b8c4107d9f210f0d747d1e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 13:17:47 2022 +0100

    Bug 30055: Fix when there is no searchable attr type
    
    No idea why we need that.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de4908c02199606e596cfad12c20930065f59be7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 13:10:53 2022 +0100

    Bug 30055: Add missing spec file for baskets
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c07c6da52954b5732dcee72887884d211db936d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 10 18:00:22 2022 +0100

    Bug 30055: Put extended attributes search back
    
    Last patches remove the ability to search on extended attributes.
    C4::Utils::DataTables::Members::search is searching on all the
    attributes that are flagged as "searchable", we want to keep this
    behaviour.
    
    I have tried several things and this is the simplest I have found.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 27fed377a4444dc749152e04542c194e022b1d10
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 16:30:23 2022 +0100

    Bug 30055: Add missing include to format addresses
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit eeaac96e4e2ccc0ec02ea6f529c7629d73590883
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 15:48:15 2022 +0100

    Bug 30055: Restore patron's preview links
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42bbbb763b3d0d40d69f6fa44c893612718a565e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 15:35:00 2022 +0100

    Bug 30055: Prevent blink when page is loading
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6d21aa1ee16322f4dfdb49b4d0298f6ab3e34e4e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 13:02:41 2022 +0100

    Bug 30055: Adjust hint about permissions
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ec3e215a162a078e0c7dd5883c8bc639f7703d47
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 12:58:28 2022 +0100

    Bug 30055: /api/v1/acquisitions/funds/owners and users for funds
    
    Two new routes that do the same thing
    /api/v1/acquisitions/funds/owners
    /api/v1/acquisitions/funds/users
    To list the possible owners and users for a fund
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4ee46be97e69e0abf1475eec40efeff27413a483
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 12:38:18 2022 +0100

    Bug 30055: Use /acquisitions/baskets/managers for basket's manager
    
    Test plan:
    Add a manager to a basket
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 29eb48537d1b0b433cb52a63c9615c8acccc5a31
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 12:22:49 2022 +0100

    Bug 30055: Use /patrons for neworderempty
    
    Test plan:
    Create or edit an order, add users to notify on receiving
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3613df37dd52048257d2012ed582697c2b92bcbf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 12:15:33 2022 +0100

    Bug 30055: Use /patrons for routing list
    
    Test plan:
    Add new users to a serial routing list
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6537d4d23b843591d5d768e2e4eb442b4a23de5d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 12:03:47 2022 +0100

    Bug 30055: Use /patrons for patron's cards
    
    Test plan:
    Create a new card batch and add new borrowernumber using the "Add
    patron(s)" button.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ff093c992d171762bc859ef1ed9be7d5fac9ad20
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 10:24:35 2022 +0100

    Bug 30055: Use /api/v1/suggestions/managers to list managers or suggestions
    
    Test plan:
    Select a manager for a suggestion
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 551721f7028e4de3bb32a12465fb5c7796030174
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 2 18:00:58 2022 +0100

    Bug 30055: Make patron searches use the REST API
    
    This patch will rewrite some of our patron searches to make them use the
    REST API routes (and so the powerful the DataTables wrapper which will
    bring all the nice DT feature to filter, sort, etc.)
    
    The patron searches we will take into account here are those that we use
    to select a patron in a pop-up:
     * Guarantor
     * Suggestion's manager
     * Patron's card
     * Serial routing list
     * Users to notify when order is received
     * Manager of an acquisition basket
     * Owner and users of a fund
    
    Regarding permissions there are two main problematics:
     * Filter a patron set by patrons having a
    specific subpermissions (in case of adding a manager to a suggestion or
    when we deal with acquisition and funds). We added a new
    Koha::Patrons->filter_by_have_subpermission method that will take in
    parameter a subpermission. To make thing transparent for the callers we
    are adding new routes, like /suggestions/managers to list the possible
    managers of suggestions.
     * Restrict/allow access to the default patron searches /patrons
    We need to access it when a logged in patron does not have borrowers
    permission.
    Ideally we need a separate "search_borrowers" subpermissions but it's
    considered outside the scope of this change.
    
    For each patch you will take care of testing the different permissions
    that are into effect (either for the logged in patron or the patrons
    returned by the search).
    
    The tables should contain the same columns as prior to this patch,
    except for "categories" and "library". We have the filter on top of the
    page and so we need to add them to the table as new columns if they
    weren't there before.
    
    Test plan (for this patch):
    Search for guarantor and select
    
    Test plan (for all patches):
    Add/Select patrons from the correct place where you can search for
    patrons, play extensively with the filters/pagination/etc
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3c550c62ae4341a3846169d2c96ee9fd4f549459
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 30 12:10:26 2022 +0200

    Bug 30393: Make datatables wrapper handle searching for %, _, \
    
    This patch makes searching for '%','_' and '\' work by escaping those
    symbols in the query before sending them to the API.
    
    To test:
    1. Go to the cities page
    2. Add two cities:
       - 'Cordoba %'
       - 'Buenos Aires _'
       - 'London \'
    3. Use the column search on the name, alternating _, \ and % as the query
    => FAIL: Weird behavior
    4. Apply this patch and reload
    5. Repeat 3
    => SUCCESS: Filtering works correctly!
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Séverine Queune <severine.queune@bulac.fr>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 68b56685c74779a2859e13cbccf340c892544d2d
Author: Victor Grousset <victor@tuxayo.net>
Date:   Thu Mar 31 23:47:55 2022 +0200

    Bug 30425: April fools 🐟: Add ponies to staff homepage
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8e9fab60cae7991052b4e41f1ef2029d8beba0e7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 29 17:12:39 2022 +0200

    Bug 30194: (follow-up) Fix xt/api.t
    
    The query object can have an arbitrary structure, and thus it doesn't
    make sense to check for the additionalProperties presence. also, it is
    not allowed by OpenAPIv2 :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7b2460db2935bf066b2915a4c4e1dee2ef53063c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Mar 29 17:01:24 2022 +0200

    Revert "Bug 30194: Add missing additionalProperties to q_body"
    
    This reverts commit 6d33682c13a4b5c46be5ddb23894c4196b831f92.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6d33682c13a4b5c46be5ddb23894c4196b831f92
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 29 15:03:56 2022 +0100

    Bug 30194: Add missing additionalProperties to q_body
    
    This gets xt/api.t passing again.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 165a7d3e9f279251f2c76a41f8195788579dede3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 24 10:30:33 2022 +0000

    Bug 30194: (follow-up) Remove reference to swagger-v2-schema
    
    This file is now bundled directly an no longer needs to be refered to
    separately.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9e50bcc1b534ec12c6468f57caac5422a42ab6b0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 24 10:18:51 2022 +0000

    Bug 30194: (follow-up) Simply OpenAPI Specification
    
    This patch simplifies the specification directory further by doing the
    following:
    
    * Inlines paths.yml into swagger.yaml
    * Inlines definitions.yaml into swagger.yaml
    * Inlines parameters.yaml into swagger.yaml
    * Drops x-primitives.yaml
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e449791a17747e395a8a6d9bd2274b2413d093ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 24 08:54:59 2022 +0100

    Bug 30194: Auto generate swagger.yaml
    
    It was not sorted correct and had inconsistencies.
    
    use YAML;
    use File::Slurp qw( write_file );
    my $hash = YAML::LoadFile('api/v1/swagger/swagger.yaml');
    YAML::Bless($hash)->keys([qw(swagger basePath definitions parameters paths info tags)]);
    my $info = $hash->{info};
    YAML::Bless($info)->keys([qw(title version license contact description)]);
    my $yaml= YAML::Dump($hash);
    $yaml =~ s|'|"|xmsg;
    write_file('api/v1/swagger/swagger.yaml', $yaml);
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 658b292511483f39e24b66b05f2723a4bfac419e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 8 16:08:26 2022 -0300

    Bug 30194: (26351 follow-up) Silence useless warning
    
    Every place in which Koha::Plugin::Test is loaded, and a patron is
    updated, this hook needs to be silenced.
    
    To reproduce:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/PluginRoutes.t
    => FAIL: There's a warn about patron_barcode_transform
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 27698df8f859a8e526fdca9ffd8904364f2e120b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 8 15:43:28 2022 -0300

    Bug 30194: (follow-up) Remove invalid tests
    
    This patch removes tests for the wrong 'Accept' header situation. It is
    the only thing I found I could do.
    
    The situation is: the JSON::Validator + Mojolicious::Plugin::OpenAPI is
    trapping this case and returning its own error code (400) and it also
    builds its own message! So no point testing it, as it can change again.
    
    I post it as a separate patch just in case someone finds a better way to
    handle this and obsoletes the patch :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 973564f8ef4c0a8420e08f77836b5e1cebba39f9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 8 12:57:02 2022 -0300

    Bug 30194: Fix invalid spec
    
    This patch fixes a problem with the spec.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d6092daa54a079f560cc33f4726fd26afa1866ac
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 8 12:56:48 2022 -0300

    Bug 30194: Adapt Koha to the latest JSON::Validator version
    
    This patch makes V1.pm and PluginRoutes.pm work with the
    JSON::Validator breaking changes introduced after v4.
    
    JSON::Validator got stricter, and it seems there's some bug in how it
    resolves references, so I propose we bundle the YAML spec into a single
    file using a gulp task. This will save load time too, so has its
    advantages too.
    
    To test:
    1. Edit /etc/apt/sources.list.d/koha.list
    2. Duplicate the existing line below, replacing 'dev' for 'exp'
    3. Upgrade the packages
       $ apt update ; apt dist-upgrade -y
    4. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/PluginRoutes.t \
               t/db_dependent/api/v1
    => SUCCESS: Tests pass!
    5. Restart plack and check the logs:
       $ koha-plack --restart kohadev ; tail -f /var/log/koha/kohadev/*.log
    => SUCCESS: Nothing seems broken, things work
    6. Point your browser to http://localhost:8081/api/v1/
    => SUCCESS: The API is loaded
    7. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 619fc83cbe95543c69d9922f5b8b38b35ca9e60f
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Mon Mar 28 12:00:13 2022 +0200

    Bug 19532: (follow-up) Fix installer data for unimarc
    
    https://bugs.koha-community.org/show_bug.cgi?id=19532
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 563836cce11f616b3053ca75bf7820b166a6be45
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 28 14:01:26 2022 +0200

    Bug 30276: (bug 30060 follow-up) Fix 21.12.00.016
    
    ERROR 1832 (HY000): Cannot change column 'code': used in a foreign key constraint 'user_permissions_ibfk_2'
    
    Test plan:
    Checkout a commit prior to 30060 (c023f63abcce53d71c9492aea4bc7aa30fdc5d73)
    reset_all
    checkout master+this patch
    updatedatabase
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bc1c8b43384e457b3bee05a7414cc27425e43c09
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 11 14:24:27 2022 +0000

    Bug 30244: Include lost items in list of hidden items
    
    When building search results for XSLT we generate and pass a list of hidden
    itemnumbers.
    
    We do skip the lost items in our parsing, however, we neglect to add the itemnumber
    to the hidden list
    
    This patch simply adds the lost itemnumbers to the list
    
    There is more work to be done here to simpliofy this process, however, this patch resolves
    the issue and can be backported to stable branches
    
    To test:
    1 - Set systempreference hidelostitems to "Don't show"
    2 - Edit a record to set one item as lost and one as available
    3 - Perform an OPAC search that returns the record above
    4 - Note that the lost item shows in availability line
    5 - Click on the record - note the lost item does not show on details
    6 - Apply patch
    7 - Reload search results
    8 - Lost itme no longer displays
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4903d67f09c32d72c82a702c161914545f42504e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Feb 24 12:12:27 2022 +0000

    Bug 30175: Toggle digest boxes when loading messaging preferences
    
    To test:
    1 - Define default messaging preferences for a patron category, checking a transport and the digest only boxes
    2 - Create a new patron of a different category
    3 - Change the category to the one set above
    4 - Note that checkboxes are checked, but digest boxes are disabled
    5 - Save patron - the digest boxes are not saved
    6 - Apply patch
    7 - Repeat 2&3
    8 - Note checkboxes for digest are checked and enabled
    9 - Save patron and confirm options are saved
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9abd94b2516d979887e19b7dc7bfbbe1e8a7e533
Author: Janusz Kaczmarek <januszop@gmail.com>
Date:   Tue Mar 8 22:42:44 2022 +0100

    Bug 30251: (bug 10902 follow-up) With IndependentBranches non-superlibrarians do not get autocomplete list in circulation module
    
    Having IndependentBranches on, a librarian who is not superlibrarian
    does not get a autocomplete hint list when entering a part of the
    patron's name (while performing check out, etc.)  Koha registers
    an error:
    
    DBIx::Class::Storage::DBI::_dbh_execute(): DBI Exception: DBD::mysql::st
    execute failed: Column 'branchcode' in where clause is ambiguous at
    .../Koha/Objects.pm line 312
    
    This is due to fix to the bug 10902 -- addig "prefetch => 'branchcode'" to
    the attributes of the query in circ/ysearch.pl, while having branchcode
    in the search parameters.
    
    Test plan:
    ----------
    
    1. Have IndependentBranches on, PatronAutoComplete set to 'Try.
       Be a librarian without superlibrarian privileges.  Have some
       patrons defined.
    2. In the main input field on the top, with Check out active, try to
       put 3+ characters from the known user name/cardnumber etc. You
       will get no hint.
    3. Apply the patch.
    4. Repeat 2.  You should now see an autocomplete hint list.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ac9a41c7c9b393d5ec58ca6c4871131c3a934720
Author: Nicolas Legrand <nicolas.legrand@bulac.fr>
Date:   Tue Jan 18 10:45:50 2022 +0000

    Bug 29103: Change desk when checking in a waiting reserve
    
    A check in should relocate a waiting hold under the current desk. But
    the current behaviour when confirming the hold is to dismiss the
    modal, the item is still attached to the preceding desk.
    
    This patch mimicks the print and confirm behaviour to trigger the desk
    change.
    
    Plan test:
    
    1. Add some desks to you library (syspref UseCirculationDesks and
       Administration -> Patrons and circulation -> Circulation desks.
    
    2. Set a desk in your session (Circulation -> Set library and desk)
    
    3. Have some waiting hold attach to a desk (make a hold on a checked
       out item and return it).
    
    4. Change your current desk.
    
    5. Check in again the item, click on confirm.
    
    6. Go to the item notice detail, it appears as waiting at your first
       desk.
    
    7. Apply patch.
    
    8. Check in again the item.
    
    9. go to the item notice detail, it should appear at your current
       desk.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8e2a1d7927fb5da4719a2fb6f1554f8a68fbd0f7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 21 14:10:56 2021 +0200

    Bug 28416: Delay load of Email::Sender::Transport::SMTP
    
    As it's taking 10M of RAM
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 96fcc24aba6f5074bc8d90c7b7faabf047e4650c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Mar 25 10:39:28 2022 -1000

    Bug 24221: (follow-up) Remove id opac-my-summary-note
    
    Like in other conversions to news block, we do not need an HTML id in
    the template, one is created by PROCESS koha_news_block
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4aedda81970ac6b6a6ce6ad5a9558d4fda3c3152
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Mar 25 10:37:37 2022 -1000

    Bug 24221: DBRev 21.12.00.020
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7adebc4a81fbdd8c6c52186a31ad097b23eeef9b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Mar 22 13:19:24 2022 +0100

    Bug 24221: Improve atomic update
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bc135ba1e11341875610e24bd9e6e2fe23b3b328
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Mar 1 17:32:13 2022 +0000

    Bug 24221: Move OPACMySummaryNote to HTML customizations in additional-contents
    
    To test:
    1- Before applying the patch add some content to the system preference OPACMySummaryNote
    2- Apply patch
    3- restart_all and updatedatabase
    4. Go to additional-content.pl ( HTML customizations )
    5. You should now see your content from the system preference under OpacMySummaryNote in HTML customizations
    6. Try searching for the system preference, OPACMySummaryNote. It has been removed and you should not be able to find it.
    7. Try changing/removing/adding content from OpacMySummaryNote in HTML customizations
    8. Make sure your edits are reflected when you look at the user summary page
    
    Note: The system preference was named OPACMySummaryNote but in to be more consitent with how we have named other additional_contents I have renamed this OpacMySummaryNote.
    Signed-off-by: shiyao <shiyao@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2ed5de93d9658c151505afd470d0f58ec0803679
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Mar 25 10:14:27 2022 -1000

    Bug 22605: (RM follow-up) Fix test suite
    
    See https://jenkins.koha-community.org/view/master/job/Koha_Master_D10/560/
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 321e6e81ff37cc187827bbcccb5d0ec97ec35498
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 4 17:09:40 2022 +0000

    Bug 30227: Replace the use of jQueryUI tabs on bibliographic detail page
    
    This patch replaces jQueryUI tabs on the bibliographic detail page,
    replacing them with Bootstrap tabs.
    
    To test, apply the patch and locate a bibliographic record in the staff
    client. Check the tabs on the detail page. Try to test as many
    variations as possible:
    
    - With and without holdings
    - With and without descriptions (5** note fields)
    - With alternate holdings (AlternateHoldingsField preference)
    - With HTML5 media (see Preferences -> Enhanced content -> HTML5 media)
    - With an associated suggestion
    - With an associated subscription
    - With acquisition information
    - With local cover images
    - With SeparateHoldings enabled
    - With other editions available (FRBRizeEditions)
    - With component parts
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f5a89e743fac121380915c818d265fcc35131746
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 18 16:06:53 2022 +0000

    Bug 30317: Replace the use of jQueryUI tabs on search history page
    
    This patch replaces jQueryUI tabs on the staff interface's search
    history page, replacing them with Bootstrap tabs.
    
    To test, apply the patch and perform some bibliographic and
    authority searches in the staff client if necessary.
    
    Go to the search history page and test that the "Catalog" and
    "Authority" tabs work correctly.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 87b298f6634f531f93fdb38a59c4d21dc3ec699f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 18 15:24:49 2022 +0000

    Bug 30316: Replace the use of jQueryUI tabs on MARC detail page
    
    This patch replaces jQueryUI tabs on the MARC detail page, replacing
    them with Bootstrap tabs.
    
    To test, apply the patch and locate a bibliographic record in the staff
    client. View the MARC detail page for that record. Confirm that the
    numered tabs work correctly.
    
    JD amended patch: removed commented line
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit becd5bd8e8997804e15b946fbab78063e6ad4a75
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 17 18:21:56 2022 +0000

    Bug 29998: Replace the use of jQueryUI tabs on item types administration page
    
    This patch updates the item type edit interface so that it uses
    Bootstrap tabs instead of jQueryUI tabs for displaying icon sets.
    
    Unrelated: The patch removes an invalid "type" attribute from a <select>
    element.
    
    - Go to Administration -> Item types in the staff interface.
    - Edit an item type.
    - On the edit page you should see tabs under "Choose an icon."
    - Confirm that the tabs look correct and work correctly.
    - If you did not previously have any icon selected, the "None" tab
      should be active.
    - If you had an icon selected, that icon set's tab should be active.
    - Confirm that if you specify a remote image (e.g.
      https://via.placeholder.com/50/FF0000/FFFFFF.png ) the tab is
      correctly shown after you save and re-edit.
    - Confirm that changing icons works correctly and that the selected
      icon's tab is always active when you return to the edit view.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1b0f154cf8e9935d81009fd56333681828c127c8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 24 21:43:17 2022 -1000

    Bug 29999: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7d1e2bb45c0b4bed473dba5880563d912bc66959
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 17 18:17:44 2022 +0000

    Bug 29999: (follow-up) Show the remote image tab if selected
    
    This follow-up corrects the markup so that if a value is entered in the
    "Remote image" field, the correct tab will be selected upon page load.
    
    The patch also corrrects the input name on the "No image" field so that
    the option works correctly.
    
    To test, apply the patch and edit an authorized value.
    
    - Select an icon from an icon set. Save, and then re-edit.
      - The correct icon set tab should be activated.
    - Select "No image," save, and re-edit.
      - The "No image" tab should be selected.
    - On the "Remote image" tab, enter a remote image url, e.g.
      https://via.placeholder.com/50/FF0000/FFFFFF.png. Save and re-edit.
    - The "Remote image" should be selected.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2fc5c28fec456f11440224bba50e2a066dcf2c79
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 1 19:36:22 2022 +0000

    Bug 29999: Replace the use of jQueryUI tabs on authorized values administration page
    
    This patch updates the authorized values edit interface so that it uses
    Bootstrap tabs instead of jQueryUI tabs for displaying icon sets.
    
    Normally Bootstrap tabs don't have to be initiated via JavaScript, but
    this page requires some JS to select the first tab as active if no other
    tabs are active. Because of the way the template works it's not simple
    to do it via template logic, so in this case some JS helps.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Administration -> Authorized values in the staff interface.
    - Select a category and then add or edit an authorized value in that
      category.
      - On the edit page you should see tabs under "Choose an icon."
      - Confirm that the tabs look correct and work correctly.
      - If you did not previously have any icon selected, the "None" tab
        should be active.
      - If you had an icon selected, that icon set's tab should be
        active.
      - Confirm that changing icons works correctly and that the
        selected icon's tab is always active when you return to the edit
        page.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 398a4b4698c32a234fdc41ed96283881e7fd6cdc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 24 09:52:04 2022 -0300

    Bug 30165: (follow-up) Allow objects.search usage outside OpenAPI
    
    Our objects.search helper is written for being used in our API
    controllers, which get their query parameters processed by the OpenAPI
    plugin, using JSON::Validator.
    
    Particularly, the 'q' parameter is defined as 'multi' on our spec, which
    means objects.search always gets it as an arrayref.
    
    As the Objects.t tests are not using the OpenAPI plugin, a hashref is
    generated as only one q= is being passed. This patch adds an extra
    validation on objects.search, for the non-arrayref use case and does the
    right thing.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/Objects.t
    => FAIL: Tests fail!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6f8b94f49c6209ae0815fdbb6ec6aba78e41a22a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 21 10:50:55 2022 +0100

    Bug 30110: Fix concatenation during assignements
    
    There are several occurrences of `my $var += ` or .= in the code.
    It should not cause problems but it's confusing.
    
    Test plan:
    Read the patch and confirm that the changes make sense.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d753755590b8950519944a3c5d52e150655d1cd1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 18 10:26:48 2022 +0100

    Bug 30199: Do not generate jwt if patron does not exist
    
    This is a follow-up patch for bug 29543. If an invalid cardnumber has
    been used we should not generate a token.
    
    Test Plan:
    1. Set SelfCheckoutByLogin to 'cardnumber'.
    2. Go to http://localhost:8080/cgi-bin/koha/sco/sco-main.pl
    3. Enter an invalid carnumber like 'thisisabadcardnumber'
    4. See the appropriate message "Sorry The userid thisisabadcardnumber was not found in the database. Please try again."
    5. Try again with a different cardnumber and notice the same exact error message including the 'thisisabadcardnumber' cardnumber.
    6. Apply this patch
    7. Restart all the things!
    8. Repeat steps 2-4
    9. Try again with a different cardnumber, you should now see the correct
       cardnumber!
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 29e1681ff1e5e3b6d820d277c5a475ecdf846d21
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 24 14:11:57 2022 -1000

    Bug 17748: (follow-up) Stronger unit tests
    
    Before this patch, unit tests perform an item search assuming there is
    no checked-out items in database.
    This is correct for a fresh reseted database.
    But if you checkout any item then prove t/db_dependent/Items.t it will
    fail.
    We can see in this file that other tests use filter on generated
    branchcode.
    
    This patch adds filter to items.homebranch
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 216bb783e04b3a0b3cbd035140f9d5b9d1a5e7bd
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Feb 23 16:30:03 2022 -1000

    Bug 17748: (follow-up) Fix date due column filter
    
    After items search result when entering a term in date due colum filter
    table is not filtered.
    Its is because columns from 'Issue' must be added in _SearchItems_build_where_fragment()
    like it has been added in SearchItems().
    
    Test plan :
    1) Perform an item search with some results beeing checked-out
    2) In colum 'Date due' enter a number that is contained is some due
       dates, ie '2022'
    3) Table results are filtered with items having search term in due date
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2cad21e375a850f76913abb5418298f31bbf9417
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 18 15:07:57 2022 +0100

    Bug 17748: Remove unecessary html filter
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a13aae3ac31049607687d9d2e02733837f950ccc
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Feb 2 01:33:59 2022 +1300

    Bug 17748: Add tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ab3d2e4673ffc73201dcafd24fc46718c6f85cab
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Dec 16 15:13:20 2021 +1300

    Bug 17748: (follow-up) Remove availability column
    
    Items can now only be filtered by 'Checked out' or 'not' rather than
    looking at damaged/itemlost/withdrawn/notforloan status.
    
    Removed availability column as Checked out items are made clear by the
    due date column.
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 67ac38882203d0b045286431644b933e03a74092
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Dec 6 19:34:09 2021 +1300

    Bug 17748: (follow-up) Fix sorting on new columns
    
    Confirm tests in t/db_dependent/Items.t still pass.
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 353427a31ab07c4814843a7c7a27786042010148
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Feb 5 16:01:54 2021 +1300

    Bug 17748: Show due date and availability in item search results
    
    This enhancement adds the availability of an item to the item search
    results (i.e. shows if checked out or not). If checked out,
    shows due date in item search results. The due
    date column will also show when exporting results to a CSV file.
    
    To test:
    1) Apply patch and restart services
    2) Set up two items. Check out Item A to a borrower. Leave Item B as
    is not checked out, and not unavailable status.
    3) Go to Search -> Item search. Scroll down and notice the Availability
    radio options - Ignore, and Checked out.
    4) Leave the Ignore option selected and do a search so that both items show.
    5) Confirm the availability and due date columns are showing at the
    right end of the table. Confirm Item A says Checked out and has a due
    date. Confirm Item B says available.
    6) Export all result to CSV. Confirm the results show in the CSV file as
    expected.
    7) Go to edit your search. Select the 'Checked out' radio option for
    Availability and submit the search. Confirm only Item A shows in the
    results (not Item B).
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Württemberg (BSZ)
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 57a55528bc45ddd707f7a931ef0b57d4be889730
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 3 10:21:48 2022 +0100

    Bug 30059: Deal with timezones
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 81160bc1aea74d1d96a8ffd8b2a2b8b194bfd959
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 3 10:31:27 2022 +0100

    Bug 30059: Add JS equivalent for Koha::Patron->get_age
    
    On bug 30055 we are going to use the REST API to display the patron
    search result, we will then need to calculate patron's age client-side.
    This is moved to its own bug report in case we need to reuse it
    somewhere else.
    
    Test plan:
    Copy/paste the JS function in your browser's console then call it and
    confirm that the result is correct
    For instance:
      $get_age('2000-01-01')
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b752522a19b66767a041967d719504f318f7f913
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 22 11:40:07 2022 +0000

    Bug 25251: (follow-up) Remove alertNoItems
    
    We should not need this function any longer
    
    I left the else conditional just in case
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 41a5747b1679db160f5eb7540f621cbba0eaf579
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Mar 14 17:05:56 2022 +0000

    Bug 25251: Remove alert from disabled buttons
    
    This patch removes the alert, but adds a stopPropagation call
    in order to not close the menu when the disabled buttons are clicked
    
    To test:
    1 - Find a record with items in the staff interface
    2 - Click edit
    3 - Note 'Edit items in a batch, 'Delete items in a batch', and 'Delete
        all items' are grayed out
    4 - Note hovering displays a note that there are no items
    5 - Click on each anyway, an alert is generated, menu is closed
    6 - Apply patch
    7 - Reload page
    8 - Click on each disabled option and confirm
        - there is no more alert
        - the menu does not close
    9 - Confirm tooltip is displayed
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e8241182badb5f8788642d4f86d2dfa2b7d10082
Author: Philippe Blouin <blou@inlibro.com>
Date:   Fri Mar 11 15:54:51 2022 -0500

    Bug 30282: overdues report does not display subtitle, part_name, part_number
    
    In circ/overdue.pl, the Title column is the result of includes/biblio-title.inc display.  The code of biblio-title.inc means to display subtitle, part_number and part_name from biblio table, but nothing but commas show up because those fields are never retrieved by overdue.pl
    
    To reproduce:
    1) have an item whose biblio.subtitle, part_name and part_number and non-empty.
    2) issue it, then set it late (overdue).
    3) go to the report page (circ/overdue.pl) and make it appear.
    4) subtitle, part_number and part_name do not appear, although they are meant to by biblio-title.inc code
    5) apply the patch and try again.
    
    It's a simple fix of adding the fields in the database query.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3c28771ed6c89c803cf7d682e1cfbb8a1a33c8c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 10 16:21:11 2022 +0000

    Bug 24415: Authority enhancement - Improve access to tabs
    
    This patch makes style changes to the authority record editor in order
    to make it easier to navigate among tabs and tags. This change matches
    the one made to the basic MARC editor in Bug 22045.
    
    Tabs are now part of the page's toolbar, which floats as the page
    scrolls. In addition to the numbered tabs, there is also a section
    showing in-page links to the MARC tags which are available on that page.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    Open a blank or existing record in the authority record editor. Test
    the redesigned tabs, the floating toolbar, and the in-page tag links.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 011fc4c3852ce61f2bd98a7f912e35d63dbd77b7
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jan 8 23:25:11 2022 +0000

    Bug 29791: (follow-up) Add missing comma in previous line
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1f34ec1330ff15692e04ab47414bf6a652b705dd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jan 4 10:24:18 2022 -0500

    Bug 29791: KohaOpacLanguage cookie should set the secure flag if using https
    
    To test, the headers should have value set-cookie: secure;
    for the language cookie, when the site is using https.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3e484d6593310edc3a15454930358c9d3a979b0f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 24 13:43:41 2022 -1000

    Bug 6815: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 43b04cd3be4670ca2bc2bc81e6c6cfda39949014
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 21 17:26:12 2022 +0100

    Bug 6815: Don't make an AJAX request to generate the modal
    
    moremember-patronimage.pl|tt were not needed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e406dd16b52f8f08594b076c73d4caf12df76b6f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 21 17:04:22 2022 +0100

    Bug 6815: Display an error in if HTTPS not used and webcam unavailable
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 370a10c512cc42acfd6d4f37fa625643721804b3
Author: Mark Tompsett <mtompset@hotmail.com>
Date:   Wed Jul 15 04:55:06 2020 +0000

    Bug 6815: Capture member photo via webcam
    
    This patch builds on a patch by Mark Tompsett, adding the option to take
    a patron's picture using the computer's webcam. The photo can then be
    saved to the patron's account.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Administration -> System preferences and enable the
      'patronimages' preference.
    - View a patron record. In the sidebar, hover your mouse over the blank
      patron image. Click the "Edit" button which appears.
    - A modal window should appear with two sections, "Upload patron photo"
      and "Take patron photo."
      - If your computer has a webcam, your browser should ask permission to
        access it. Grant access.
      - You should see the view of your webcam shown under the "Take photo"
        button.
      - Click the "Take photo" button. The captured photo should be shown in
        place of the live video from the webcam.
      - You should now see three buttons: "Retake photo," "Download photo,"
        and "Upload photo."
        - Clicking "Retake photo" should hide those buttons and return you
          to a live video view.
        - Clicking "Download" should make your browser download the image.
        - Clicking "Upload" should cause the page to redirect back to the
          patron detail page where you should see the new patron image
          displayed in the sidebar.
        - Trigger the modal again and click the "cancel" button. The
          modal should disappear and camera access should stop.
    - If your computer has no webcam the modal should appear correctly but
      there should be a banner at the bottom indicating that a camera is not
      available.
    - Try the test again but this time deny your browser access to the
      webcam. You may need to reset the camera permissions in your browser's
      settings. When the modal appears you should see a message saying
      access to the camera is denied.
    - The patron image edit modal should be available on all pages which
      show the patron image in the sidebar: Check out, Batch check out,
      Details, Accounting, Routing lists, Circulation history, Holds
      history, Modification log, Notices, Statistics, Files, Purchase
      suggestions, Discharges, Housebound, and ILL requests history.
    - Test adding an image to a patron record using the "Upload photo"
      option. It should still work correctly.
    - If the patron has an image attached, the "Upload photo" section should
      have a "Delete" button. Test that it works correctly.
    
    Signed-off-by: Nicolas Legrand <nicolas.legrand@bulac.fr>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4616a7147ca4b8c639ad865683b0d7f0762b89b8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 24 16:43:14 2022 +0000

    Bug 29713: Make item table when placing an item level hold sortable
    
    This patch modifies the holds page in the OPAC so that users selecting a
    specific item to place a hold on can sort the table of items.
    
    This patch also removes some obsolete JavaScript left over from before
    Flatpickr.
    
    To test, apply the patch and go to Administration -> Circulation and
    fine rules to make sure at least one item type in your system has
    "OPAC item level holds" set to "allow."
    
    - Log in to the OPAC as a user who can place holds.
    - Search the catalog for items which will accept item-level holds.
    - Place a hold on one of the results, and click the "Show more options"
      link on the holds page.
      - Check the "specific item" radio button.
      - A table of items should be displayed. Confirm that the table is
        sortable.
      - The first entry in the table should be selected.
      - Perform the same test when placing a hold on multiple titles.
        Confirm that each table of items is sortable.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 558ec5b87370727e42b7000ea5058754e50fad11
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 24 16:40:38 2021 +0000

    Bug 22605: (QA follow-up) Make Braille search option stick
    
    To test:
    - Add to records, one with 007 fb and another with 007 tc
    - Search for Format: Braille from the advanced search
    - Verify both records are found
    - Return to advanced search
    - Verify that Braille is still selected
    - Rerun search - same results show
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f6adf4318dc8a53a827c4679ab21c1801088fd83
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 25 17:13:34 2021 +0000

    Bug 22605: (follow-up) Add selected to audience attributes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 926bbd058899e52b57056f17db48b2f1109455a0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 22 11:35:13 2021 +0000

    Bug 22605: Preselect subtype limits and don't allow multiple
    
    Dropdowns moved to an include, checked and preseleced
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5bd71b5b7dfd9f1eccfd2c12a78321406018ffeb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 21 18:44:50 2021 +0000

    Bug 22605: (follow-up) Fix operators
    
    - Don't add an operator on first loop
    - Only add plus option on last loop
    - Fix indentation of first search box
    - Remove spaces from operators in query_cgi and add to query and query_desc
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 90d658ae56fcd2ad0da8ed7ab2f37e48b038ef9a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 12 15:28:40 2021 +0000

    Bug 22605: Add ability to edit a search on staff interface
    
    This patch adds the ability to parse the current search and populate the advanced search page on the staff side accordingly.
    When searching you will now have an 'Edit this search' link underneath your current search terms
    
    A few notes:
    1 - Previous selected items appear with a checkbox, unchecking 'disables' them and removes from the search
    2 - Facets and unrecognized limits will appear at the end of the form under 'Other limits' - there could be future enhancement to parse there better, but I believe this is sufficient for now
    3 - Previously selected branch or group selections will populate the dropdowns, only one is allowed
    
    To test:
    1 - Perform a variety of search on the staff interface
    2 - Confirm the 'edit search' button appear below your search
    3 - Confirm that options are retained and correctly parsed
    4 - Test with library groups - you should be able to combine groups after initial search, or remove individual libraries when editing
    5 - Test that selecting a goup disables the individual libraries options
    
    QA note: Missing filters on deletion of keys form hash are false positives
    
    https://bugs.koha-community.org/show_bug.cgi?id=26605
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ab495c64bdeacf5d4e911b574d1d719c7d7f3424
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 18 14:37:54 2022 +0000

    Bug 30000: Replace the use of jQueryUI tabs on the search engine configuration page
    
    This patch replaces jQueryUI tabs on the search engine configuration
    page, replacing them with Bootstrap tabs.
    
    To test, apply the patch and go to Administration -> Search engine
    configuration.
    
    - The "Search fields" tab should be selected by default, and the table
      should be initialized as a DataTable with sorting and filtering.
    - When you switch to the "Bibliographic records" and "Authorities" tabs
      the tables on those tabs should also be initialized, each with
      filtering and drag-and-drop row re-ordering.
    - All tables should continue to work correctly after switching back and
      forth between tabs.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 772ffc726d75103d0feeb27486fb761f28a48a12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 17 17:39:52 2022 +0100

    Bug 29893: Redraw the tables from other tabs without paging
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 097e27f9cafc26725f76bc97d3530ee616daaa5e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 11:07:40 2022 +0100

    Bug 29893: Make sure the form will be submitted after the draw calls
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0fa0f486c5bf830cd6e41f8f9da8c6dcb2892b63
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 17 15:45:06 2022 +0100

    Bug 29893: Prevent ES mappings UI to remove hidden rows
    
    If you are editing ES mappings and you use the DataTable filtering option,
    the table won't contain all the mappings you have in the DB.
    If the form is submitted they will be removed and data will be lost!
    
    Test plan:
    Edit ES mappings, filter and submit the form.
    Confirm that the table are redrawn before the form submission which
    prevent data loss
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b71d861eb5e00006a48772789a8031c0fcd3425
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 24 07:31:12 2022 +0000

    Bug 29915: Prevent bad cookie from corrupted session
    
    If there is deleted session info but no session->id, a wrong cookie
    with empty name could be generated containing expired session id.
    
    Test plan:
    Run t/db_dependent/Auth.t
    Login. Check cookies in browser.
    Logout. Check cookies in browser.
    Without this patch, you should see an invalid cookie.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 51ac4513f26a59fa93729e9ee3a81e4ddfdcf424
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Mar 21 15:56:21 2022 +0100

    Bug 26328: Add test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3081128ec814fc004545a784ed60c7237e49642b
Author: David Cook <dcook@prosentient.com.au>
Date:   Fri Dec 4 05:36:04 2020 +0000

    Bug 26328: Cast barcode from varchar to integer for incremental barcode
    
    Without this patch, the incremental barcode generation will
    treat 978e0143019375 as having an exponent and interpret it as a very
    large number.
    
    With this patch, the incremental barcode generation will first cast
    barcode varchar strings to integers before finding a max() value.
    In this case 978e0143019375 becomes 978 instead of
    1.7976931348623157e308
    
    Test plan:
    
    0. Using koha-testing-docker
    
    Before applying patch:
    
    1. Go to http://localhost:8081/cgi-bin/koha/admin/preferences.pl?op=search&searchfield=autobarcode
    2. Set to "generated in the form 1, 2, 3"
    3. Go to http://localhost:8081/cgi-bin/koha/cataloguing/additem.pl?biblionumber=1#additema&searchid=scs_1607059974968
    4. Add item with barcode 978e0143019375
    5. Click "p - Barcode"
    6. Note the barcode is "Inf"
    
    After applying patch:
    1. Go to http://localhost:8081/cgi-bin/koha/cataloguing/additem.pl?biblionumber=1#additema&searchid=scs_1607059974968
    2. Click "p - Barcode"
    3. Note the barcode is "39999000019194"
    
    Signed-off-by: Marjorie <marjorie.barry-vila@collecto.ca>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bdb30b3b8e161558a460c7d7661b761ef2e7b504
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 18 14:25:14 2022 +0000

    Bug 29802: add 'me' to filter_by_visible_in_opac query
    
    This patch prefixes all of the fields in OpacHiddenItems with
    "me." before searching.
    
    Unit tests added to cover this case1
    
    To test:
    1 - Create a public list
    2 - Set OpacHiddenItems to:
        biblionumber: [1]
    3 - Attempt to view list in OPAC
    4 - Booom
    5 - Aply patch
    6 - Reload list
    7 - Success
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4ea553e03ebafa7286c1f237da24abace6abd59a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 6 16:03:56 2022 +0000

    Bug 29802: Unit tests
    
    prove -v t/db_dependent/Koha/Items.t
    prove -v t/db_dependent/XSLT.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 03ea475759eacb1918d8d3c69a23b4be4910dcc7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Mar 14 14:47:36 2022 -0300

    Bug 30294: Rename Koha::Recall->* used relationship names
    
    This patch renames the underlaying relationship names used in the
    'patron' and 'library' subs so they are more clearly prefetchable and
    also enabling them to be embeddable and searchable through an eventual
    API route for recalls.
    
    To test:
    1. Apply the patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Recall*
    => SUCCESS: Tests pass, nothing really changes
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 78ecdc84391ccfd7b8bdfba9464da5b46ff4f68a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Mar 23 12:30:42 2022 +0100

    Bug 29788: (follow-up) Make Koha::Item->safe_to_delete use Koha::Result::Boolean
    
    There were several wrong things in the previous patch!
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ed5250534ef1d55db3736c9480276e9110e933e0
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 23 09:58:58 2022 -1000

    Bug 19532: (RM follow-up) Fix DBIx schema on old
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2f39f426b5e748973dc8d8348f1304dde64ac909
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Mar 2 18:30:49 2022 +1300

    Bug 26685: Move Starman out of debian/control.in and into cpanfile (2)
    
    defining package as 'recommended', as suggested
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ed03af124dfbcbfe22f9a43104aaae3991491c6a
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Oct 15 02:06:44 2020 +0000

    Bug 26685: Move starman out of debian/control.in and into cpanfile
    
    to test...
     - apply patch
     - build and install new package
     - confirm starman package displays correctly in about.pl page
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 07a58a04b5751c8407ad44b6239f19c3019df9c3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Feb 23 13:14:03 2022 +0000

    Bug 30161: Remove duplicate z3950_search include
    
    Speaks for itself.
    
    Test plan:
    Check if the acqui z3950 search works as expected.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4305ce6f1dd63f497fa8a6899068cf7453b553aa
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 9 12:46:10 2022 +0000

    Bug 30253: Remove a double mana_success parameter
    
    Remove the line without the scalar.
    
    Test plan:
    Just look at the code.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 94063fb40e1bd5a4c452001d37acb29fff608e2c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 17 16:19:16 2022 +0100

    Bug 30008: (bug 29690 follow-up) Fix Invalid data, cannot decode metadata object
    
    Test plan:
    1 - Find a record in the staff catalog
    2 - Edit the record
    3 - In the 520 notes field, add an ASCII escape character (27 decimal, 1b hex)
        On ubuntu Ctrl+Shift+u, then 1b, enter
    4 - Save the record
    5 - Set syspref ShowComponentRecords to 'both...'
    6 - On record details: New->New child record
    7 - Save the record
    8 - Attempt to view the parent record in the staff client and opac
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d8a20d5edfd83e023471e35e49743d735bfba746
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 19 14:40:14 2022 +0100

    Bug 29486: Add check in search_for_data_inconsistencies.pl
    
    If the MARC record does not contain the correct biblionumber of
    biblioitemnumber, the script will display the following warning:
    
    == Bibliographic records have MARCXML without biblionumber or biblioitemnumber ==
            * Biblionumber 4242 has '1' in 999$c
            * Biblionumber 4242 has biblioitemnumber '4242' but should be '1' in 999$d
    => The bibliographic records must have the biblionumber and biblioitemnumber in MARCXML
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3b1246b76eaaad21bb5f21e0415f794905c09251
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 19 14:39:51 2022 +0100

    Bug 29486: Fix tests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3c2e92448a19d0c1be75cc2a3150408841b56b92
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 16 09:13:30 2021 +0100

    Bug 29486: _koha_marc_update_bib_ids no longer needed for GetMarcBiblio
    
    This subroutine is ensuring that the biblionumber and biblioitemnumber
    will be part of the MARC record.
    We should not need that, unless there is something broken somewhere
    else.
    
    This line has been added by the following commit:
      commit 4e95e94727b09b33d2f6c597bdd218a59dcc3681
      Bug 6789: biblios with many items can result in broken search results link
    
    """
    To this end, it also moves the fix_biblio_ids portion of get_corrected_marc_record out of rebuild_zebra.pl,
    and makes it a part of GetMarcBiblio (right before EmbedItemsInMarcBiblio, so the 952s still come last).  fix_biblio_ids
    is kept as a subroutine for the deletion portion of rebuild_zebra.pl, which still uses it.
    """
    
    But it does not explain why it's better to have it in GetMarcBiblio.
    If we need it for the reindexation process, we shouldn't impact
    GetMarcBiblio which is used from several different places.
    
    We might then consider adding the fix_biblio_ids call to
    rebuild_zebra.pl, but I am failing to understand in which cases it could
    be useful.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4ff027f99e957c734ed358927b384d69bbbd857e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 27 15:30:17 2022 +0100

    Bug 29940: Don't surround value by quote
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7abf8f8e5b13e72128f5cce6bee2c13c34af7033
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 25 12:32:28 2022 +0000

    Bug 29940: Phase out jquery.cookie.js in the OPAC
    
    This patch replaces the use of jquery.cookie.js in the OPAC with the
    newer js-cookie plugin. The patch adds the latest version of the
    js-cookie library and removes the old jquery.cookie plugin.
    
    To test, apply the patch and go to the advanced search page in the OPAC.
    
    - Perform a search using a number of different limits and settings, e.g.
      keyword, item type, and sort-by.
    - On the search results page you should see at the top of the results
      list a link to "Return to the last advanced search."
    - The link should take you back to the advanced search page with all the
      same settings filled into the form.
    - A search with the "More options" view enabled in the advanced search
      form should result in a link which returns to the "More options" view.
    - Searching via the "quick search" form at the top of the page should
      clear the cookies which were set in order to remember the advanced
      search. See
      https://developer.mozilla.org/en-US/docs/Tools/Storage_Inspector for
      information on viewing your browser's stored cookies.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 436291452f87c6410f2584032eb6db26abe428bf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 10 12:23:42 2022 +0000

    Bug 30266: Hide pickup location input on waiting hold
    
    This patch updates the holds table to always insert a hidden input when a hold is 'found'
    and covers the case where the hold is 'found' but doesn't match known statuses
    
    To test:
     1 - Place two holds on a record for two different patrons, with different pickup locations
     2 - Check in one item at expected branch to set waiting
     3 - Then either:
        - Use batch modification or item editor to change the holding branch for the item
        - Sign in to a different branch and manually transfer the item back to it's home location
     4 - View the holds for the record
     5 - Note the 'Pickup library' column is blank for that hold
     6 - Change pickup location for other hold and press 'Update holds'
     7 - Note the waiting hold is still blank, and now second hold has no pickup location
     8 - Check the DB and note the first hold has had the pickup location changed
     8 - Apply patch
     9 - Delete holds and repeat 1-4
    10 - Note the waiting hold now displays:
        Hold expected at {Branch}, please checkin to verify status
    11 - Change location for second hold and update holds
    12 - COnfirm location chanegd correctly and first hold unaffected
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b64f96830bbdd555eeed7137b4b473ac15218f0c
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Feb 2 13:53:48 2022 +0100

    Bug 30004: Prevent TooMany from executing too many SQL queries
    
    If a maximum number of checkouts allowed is defined in circulation
    rules, C4::Circulation::TooMany will loop over all patron's checkouts.
    When a patron has several hundreds of checkouts, it can really slow down
    the checkout process by several seconds (or even tens of seconds)
    
    This patch does two things:
    - Always prefetch item data so that `$c->item` does not execute an
      additional SQL query at every iteration of the loop. Item data is
      always needed at the first line of the loop, so there is really no
      downside for doing this.
    - Build the `@types` array only once, out of the checkouts loop. Since
      it does not depend at all on patron's checkouts data, it does not make
      sense to build it inside the loop.
    
    Test plan:
    1. Before applying the patch, create a patron with a lot of checkouts.
       I tested with 1000 checkouts, but the slowness should be noticeable
       with less.
    2. Make sure you have a circulation rule (one that apply to your patron
       and the item(s) you will check out for testing) with a maximum number
       of checkouts allowed
    3. Check out an item for the patron with a lot of checkouts. Measure the
       time it takes.
    4. Apply the patch
    5. Check out another item (or check in and then check out the same item
       used in step 3). Measure the time it takes and compare it to step 3.
       It should be faster now.
    6. Run `prove t/db_dependent/Circulation/TooMany.t`
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5a67364da5f5a456904a9c4a1acd440b89705ed5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 14 14:32:31 2022 +0000

    Bug 30183: Fetch flatPickr instance prior to custom search definition
    
    This patch updates teh search customisations in ill-list-table to
    properly fetch the existing flatpickr instances for date searches.
    
    To test:
    1. Have at least one ILL request on the ILL requests page
    2. Open the broser inspector
    3. Choose a date on the left hand form
    => FAIL: Errors in the console, search doesn't work
    4. Apply this patch
    5. Reload
    6. Repeat 2-3
    => SUCCESS: No more errors, filtering works!
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a8636478c269100b027ef00e5679e1e5c1173e99
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 16 14:07:23 2022 +0000

    Bug 29915: (QA follow-up) Spelling
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a5c6c7afab5f9074073df4773ac3f331701a43e8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 17:12:04 2022 +0100

    Bug 29915: Add selenium tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e92c536b204983f53fb173063ed243963018e7c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 27 15:12:40 2022 +0100

    Bug 29915: Add a note for tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3eb3739c6b20182a589b26857fd294accdf03eef
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 26 15:54:28 2022 +0000

    Bug 29915: (QA follow-up) Add a comment in checkauth on $flags
    
    This is quite a misleading call.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3301f6502524ba04d15ee5076e246104541815cc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jan 26 12:27:56 2022 +0000

    Bug 29915: Changes to Auth.t
    
    Test plan:
    Run Auth.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9c7a5b0988664a5c746b8ddd4287827a2d42fdc3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 26 11:58:33 2022 +0100

    Bug 29915: Add tests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 66a9eca5711bee9a3d812824e077b945b16de4a1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 25 14:52:31 2022 +0000

    Bug 29915: (QA follow-up) Fix POD typo
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5d1daf20ea123767e5ec1bf422c0c19ed06c8d97
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 25 13:55:00 2022 +0000

    Bug 29915: Tiny session adjustments
    
    It may be that we need a few additional flushes.
    And checking the returned session before clearing busc.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 89b9c441faf862aa1c5c7b8420c15fe8e9afcbd2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 24 13:08:01 2022 +0000

    Bug 29915: Changes for get_session and check_cookie_auth
    
    If we look for an existing session, do not create a new one.
    Found a bug in the unset_userenv calls. For this moment
    changing the calls in Auth here. Later fix goes to bug
    29954.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6300c6023f49dae4d76dd050d3aac167b7a0b7e4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 20 12:05:11 2022 +0100

    Bug 29915: Don't generate a new session ID for anonymous navigation
    
    When a user is not logged in, a new session ID is generated every time a
    new page is hit.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d1b2601b01c9c556555fc085948c19ba5f299c9e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 21 12:18:57 2022 -1000

    Bug 30325: (Bug 30098 follow-up) Fix broken patron search redirect when one result
    
    Bug 30098 fixed patron search behavior when a later page has only 1 result, but broke the redirect when there is only a single result from search.
    
    To test:
    1 - Perform a patron search that returns 41 results, on koha-testing-docker, 'a' works
    2 - Go to second page of results, works
    3 - On third page you remain in results and are not redirected
    4 - Perform a patron search that return only 1 result, name or cardnumber
    5 - You get redirected to this patron page
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8fdfa80609600b58f3022f0dfa5a742e8f41b896
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 3 10:24:11 2022 -0300

    Bug 30181: (QA follow-up) Update BatchTest
    
    This patch updates t::lib::Koha::BackgroundJob::BatchTest to the new
    style, and also removes a couple stray cases in which job_id was still
    passed as a parameter.
    
    Tests are rewritten a bit, so they actually test more of the behaviors.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/BackgroundJobs.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d6c5fd3625e02683dab724e7e13b4e04047d59ec
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 25 07:00:23 2022 -0300

    Bug 30181: (follow-up) Remove redundant queries and parameters
    
    Now $self is actually an instance of the job class, there's no need to
    have the job_id parameter passed, or the have the ->process method
    re-fetch the object from the database.
    
    This patch cleans things up.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b6bdae7e9d0eef1247907534f8c856014b53d6c1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 25 06:42:25 2022 -0300

    Bug 30181: Make Koha::BackgroundJob->_derived_class return the right thing
    
    This patch makes _derived_class rely on _new_from_dbic to generate a new
    object with the right class, but based on the same DB row. Not an empty
    one as it was before. This way we can remove some biolerplate that is
    required now when writing background job classes.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/BackgroundJob.t
    => FAIL: Boo, tests fail
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e13c7dbf51c7618e626300a88b48d6138112b1ea
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 25 06:40:17 2022 -0300

    Bug 30181: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 90a24b185c7e324cfadca1bdd77f387060b7cf03
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 9 10:45:15 2022 -0300

    Bug 30061: Make Koha::Patron->get_age use DateTime math
    
    This patch does what the title says. Instead of converting dates to
    strings and performing math manually, we can just use the DateTime
    objects we have and calculate the DateTime::Duration there's between
    them, to get the years count.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patrons.t
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 296e3e618dca33ddf09c36b43471eae5f7755ce4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 15 15:18:22 2022 -0300

    Bug 30165: (follow-up) Fix GET /acquisitions/orders
    
    This patch fixes the particular use case of the orders route, which has
    a slightly modified version of the objects.search helped, embeded in the
    controller itself. This controller gets adjusted to the fact q will now
    be an array.
    
    Because of the latter, we end up requiring more code duplication
    regarding the query fix, so I moved it to an internal sub that gets
    reused.
    
    To test:
    1. Apply the previous patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/*
    => FAIL: It t/db_dependent/api/v1/acquisitions_orders.t fails!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 233c35bdc02f44f5f616859ee97f9e746d78157f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Mar 15 09:42:19 2022 -0300

    Bug 30165: Make q parameter 'multi'
    
    This patch changes the q_param definition so the defined query parameter
    is repeatable. This way JSON::Validator will always generate an arrayref
    for it and won't skip occurences.
    
    The objects.search helper is updated to always consider the 'q'
    parameter as an array, as expected.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/query.t
    => FAIL: Tests fail!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 01264c3b9d6d010ffe28ed5e379e8cb54876fcba
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 25 08:45:26 2022 -0300

    Bug 30165: Regression tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c38017ff8cc976d45f9c8451a927add4c256b9e6
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 17 22:56:04 2022 -1000

    Bug 19532: (RM follow-up) Fix dates compare in recalls tests
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9c6741cbe3cb00c724a2b2cf4c0efcc723484e87
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 9 13:41:47 2022 +0100

    Bug 30058: Add Koha::Patrons->filter_by_have_subpermission
    
    This method will allow to filter a patron set by a given subpermission.
    It will be useful on bug 30055 where we want to display only patron
    with suggestion or acquisition subpermission.
    Note that it could be extended to allow several subpermissions, but we
    don't need it so far.
    
    Test plan:
      prove t/db_dependent/Koha/Patrons.t
    must return green
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 174adb2a3b43582388af93228b9acc81589baf2c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 9 08:23:38 2022 -0300

    Bug 25285: Fix wrong message about required Koha version in plugins
    
    When you install a plugin that requires a newer Koha version, it reports
    this:
    
    <<
    Warning: This report was written for a newer version of Koha. Run at your own risk.
    >>
    
    It is wrong in a couple ways:
    - It is not a report.
    - It feels like it dates back to when plugins were only run i.e.
      pre-hooks, etc.
    
    This patch proposes a change to reflect this.
    
    To test:
    1. Verify the string changes make sense to you
    2. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b9458f6c79229b2d434c822702b225d51226e351
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Mar 6 12:19:34 2022 +0000

    Bug 30214: (QA follow-up) Clarify code comment
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 12d5107369827a9aa8589a69b9d655b6264877c1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 2 16:14:18 2022 +0000

    Bug 30214: Add ACCTDETAILS notice to verified self registration
    
    This patch adds the ACCTDETAILS notice trigger to the opac self
    registration process. Allowing new users, with varification enabled,
    to receive the ACCTDETAILS notice immediately after their account is
    varified.
    
    Test plan
    1) Enable AutoEmailOpacUser system preference
    2) Ensure the ACCTDETAILS notice is configured
    3) Ensure `PatronSelfRegistrationVerifyByEmail` is enabled
    4) Register a new user via the opac self registration process using an
       email address you have access to
    5) Verify the user by following the link in the verification email you
       should have received.
    6) The new user should have been created and you should be able to see
       the account details notice in their associated notices
    7) Confirm that the email address used above has received the notice.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 59df6a114ec7e75198e115b14050d1b46228d598
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 2 16:03:55 2022 +0000

    Bug 30214: Add ACCTDETAILS notice to self registeration
    
    This patch adds the ACCTDETAILS notice trigger to the opac self
    registration process. Allowing new users, without varification enabled,
    to receive the ACCTDETAILS notice immediately after their account is
    created.
    
    Test plan
    1) Enable AutoEmailOpacUser system preference
    2) Ensure the ACCTDETAILS notice is configured
    3) Ensure `PatronSelfRegistrationVerifyByEmail` is disabled
    4) Register a new user via the opac self registration process using an
       email address you have access to
    5) The new user should have been created and you should be able to see
       the account details notice in their associated notices
    6) Confirm that the email address used above has received the notice.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8e4408c054fdfcaa1e32b24ff6b002f825e80b1d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 1 16:47:52 2022 +0000

    Bug 17648: (QA follow-up) Restore imediate sending of the notice
    
    The original notice was sent using SendAlerts, which triggers
    immediately on submission and doesn't wait for the cron task.
    
    This patch restores that immediacy and also fixes a bug in the imports
    on the original patch.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b71ec27b274f0d747d9d4ee741acf2fff27f4be8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 1 16:24:55 2022 +0000

    Bug 17648: (QA follow-up) Further code cleaning
    
    We actually have a Koha::Patron method to do all the work of finding the
    right patron primary email address for notices.. we can use that here
    instead of doing it long hand.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0a8af6d927695cba503cbf3d2492874598bf5a17
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Feb 28 09:03:29 2022 -0500

    Bug 17648: ACCTDETAILS notice does not show in notices.pl
    
    The ACCTDETAILS notice apparently bypasses message_queue; notices are sent directly to the linux mail queue.
    
    Test Plan:
    1) Apply this patch
    2) Create a new patron with an email address
    3) Note the patron's ACCTDETAILS notice shows in the patron's messages
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6625f8ed50e429308cb3a98a5bab08f350c11c3c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 17 11:06:51 2022 -1000

    Bug 27812: DBRev 21.12.00.019
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b3febb279ed2ed58422b41531dc41f82393c66c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 1 16:00:10 2022 +0000

    Bug 27812: (QA follow-up) Fix atomicupdate
    
    We removed a bit too much from the skeliton here ;)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c87525f6b6440a2251d9484472579e01e1f64a25
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Feb 28 08:30:07 2022 -0500

    Bug 27812: Add DBRev to warn of the change to the account details notice
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 53863246991c7663a74dda35cb5609ab628920b1
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Apr 5 08:33:38 2021 -0400

    Bug 27812: Email should send for all new patron as per the syspref description
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9d1abe06323b06542570ef45b65eb2c54b1a9976
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Feb 26 13:16:58 2021 -0500

    Bug 27812: Remove the ability to transmit a patron's plain text password over email
    
    We should not give libraries the ability to compromise patron accounts,
    it is considered a huge security issue and nobody in network security
    would never recommend allowing passwords to be transmitted in clear text
    over email.
    
    It should simply not be possible to send a patron's password in plain text
    via email. As such, we should remove this ability from Koha.
    
    Test Plan:
    1) Apply this patch
    2) Create a patron to generate the ACCTDETAILS email
    3) Note you can no longer transmit the patron's password in the email
    
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9b3bad3eeaba2620b64ae6aa7639b7cf6435522a
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Feb 24 16:17:11 2022 +0000

    Bug 30177: When editing an existing patron set message_prefs_dirty to true
    
    1 - Define default messaging preferences for a patron category
    2 - Go into an existing account and change the patron category to the
        one set in step 1.
    3 - Confirm that the messaging prefs have been reset to that of the
        default patron category
    4 - Apply patch
    5 - Repeat Step 2, this time you should see a warning asking if you want
        to set messaging prefs to the category default
    6 - Press OK and save. Confirm that the messaging prefs are now set to
        the default for that category
    7 - Try it again with an existing account and press Cancel this time.
        Notice that there should be no change to the patron messaging prefs.
    8 - Try making a new patron and switching the category, you should see
        no warning and the message prefs should be proberly set to the
        defaults of any category you choose.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6aea5d821291bf31e959cdd5aaa94986121b4c34
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 08:19:55 2022 -0300

    Bug 30212: Make Select2 available for ILL backends
    
    This patch makes select2 available for ILL backend developers to use on
    their templates.
    
    To test:
    1. Have a configured backed and an ILL request
    2. Open the inspector and load any action on the backend (intranet)
    => FAIL: no select2 asset is transfered from Koha to the browser
    3. Apply this patch
    4. Reload
    => SUCCESS: There's select2
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c6ffb44bf1d2cdc3b018dc263ded31d44bd0d404
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Feb 22 16:54:03 2022 +0000

    Bug 30155: Don't get items that can fillholds if there are no holds
    
    This makes two changes:
    1 - We no longer call get_items_that_can_fill if there are no holds
    2 - The subroutine will return an empty Koha::Items object if there are no holds passed
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4153eff65916b4bdb8e0b69603e30621297c2ede
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Mar 9 17:22:50 2022 +1300

    Bug 30252: lower version of 'Locale::XGettext::TT2' to 0.6
    
    this patch reduces the required version of 'Locale::XGettext::TT2' to 0.6
    
    version 0.7 of of Locale::XGettext::TT2 is incompatible with the current version of libintl-perl (1.26), so we use 0.6 instead
    
     https://packages.debian.org/stretch/libintl-perl
     https://metacpan.org/release/GUIDO/Template-Plugin-Gettext-0.6/view/lib/Locale/XGettext/TT2.pm
    
    we will move to 'Locale::XGettext::TT2' 0.7 when libintl-perl-1.32 arrives
     https://tracker.debian.org/pkg/libintl-perl
    
    small change, no test plan
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 61176113af99e11250ff06cc6711ae44f464ab9f
Author: Andrew Nugged <nugged@gmail.com>
Date:   Fri Feb 11 01:16:22 2022 +0200

    Bug 29684: (QA follow-up) add lost borrower_data. prefix in memberentrygen.tt for: - primary_contact_method - autorenew_checkouts - sort1 - sort2
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8b47236acd6e8427cb1bbdf88e69813a7421f6d3
Author: Andrew Nugged <nugged@gmail.com>
Date:   Thu Feb 10 01:16:23 2022 +0200

    Bug 29684: (QA follow-up) paycollect.pl don't needs borrower_data at all
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3e0f792f4f124f435ba167513cd6900245d8b382
Author: Andrew Nugged <nugged@gmail.com>
Date:   Thu Feb 10 00:46:47 2022 +0200

    Bug 29684: (QA follow-up) Remove 2 extra 'borrower_data.' prefixes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 959519e8c109b88e01d18a36384cab82f7a5d21e
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jan 17 16:38:53 2022 +0200

    Bug 29684: add honeypot to catch other warnings in the future
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit df664fb7136519483d5e69ac800a7b148fe99dcd
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jan 17 16:31:08 2022 +0200

    Bug 29684: Fix warn about js/locale_data.js (paycollect.pl)
    
    To reproduce (paycollect.pl):
    1) Prepare or use some existing patron with outstanding fines, go to
    the accounting section and open page where you make payment towards all
    fines.
    2) The error message should have appeared in your log file about
    "File not found : default/js/locale_data.js".
    3) Apply the patch.
    4) Open the edit page again, ensure that the new error massage like
    that didn't appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fc972915f9685b542e3dc305b390a691c2487260
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jan 17 16:17:51 2022 +0200

    Bug 29684: Fix warn about js/locale_data.js (memberentry.pl)
    
    To reproduce (memberentry.pl):
    1) Head over to the patron details page, press edit button to open the
    memberentry.pl page.
    2) The error message should have appeared in your log file about
    "File not found : default/js/locale_data.js".
    3) Apply the patch.
    4) Open the edit page again, ensure that the new error massage like
    that didn't appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d2073e8b46a05f9f8f0c3b3b4c6d6ef5a59ac9e7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Mar 3 16:45:43 2022 +0000

    Bug 30220: Purchase suggestion defaults to first library
    
    This patch updates the OPAC suggestions form to update the variable
    used to pre-select the logged-in user's library.
    
    To test, apply the patch and make sure the "suggestion" preference is
    set to "Allow."
    
    - Log in to the OPAC and click "your purchase suggestions" in the
      sidebar menu on your summary page.
    - Click "New purchase suggestion."
    - The selected library should match the logged-in user's home library.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 55381b6270275682e0420b3e7073f82109ed006b
Author: George Veranis <gveranis@dataly.gr>
Date:   Thu Feb 24 15:10:14 2022 +0100

    Bug 20362: (follow-up) Direct link to authority records missing in staff detail view (1xx , 7xx)
    
    I change the magnigying glass icon to FA icon in the staff detail view
    for 1xx and 7xx of the record that links to the authority records.
    
    The following test plan is for 100 tag only but the patch can be apply
    for all 1xx and 7xx tags that can be connect with an authority record.
    
    Test Plan:
    1) On the Koha staff page, create a new authority. The type of authority
       will be: e.g Personal Name
    2) When creating authority, in tab 1 under -HEADING--PERSONAL NAME enter
       the personal name term entry element and then save the
       new authority e.g. Twain, Mark.
    3) In circulation, search the catalog for a random book. Click the title
       of the book and you will be taken to the book details.
    4) Edit the record and in tab 1 , scroll down the - MAIN ENTRY--
       PERSONAL NAME and repeat this tag (the icon next to the title).
    5) Edit the Personal name term entry element by clicking
       the button on the right of the bar.
    6) In the Search main heading ($a only) enter your personal name term
       e.g. Twain, Mark.
    7) Press search, and then in the table that pops up, click 'choose'.
    8) Save your edits and the new personal name term will be in the 'By:'
       of the book details.
    9) Notice that there is no magnifying glass icon.
    10) Apply this patch
    11) Notice that there is now a magnifying glass icon next to the
        personal name term.
    12) Click on the magnifying glass and it will take you directly to the
        authorities records
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ecb1f2749926f50ffeb9436d9e90d294d680000c
Author: George Veranis <gveranis@dataly.gr>
Date:   Tue Jan 11 09:31:27 2022 +0100

    Bug 20362: Direct link to authority records missing in staff detail view (1xx , 7xx)
    
    I added a magnigying glass icon in the staff detail view for 1xx and 7xx
    of the record that links to the authority records.
    
    The following test plan is for 100 tag only but the patch can be apply
    for all 1xx and 7xx tags that can be connect with an authority record.
    
    Test Plan:
    1) On the Koha staff page, create a new authority. The type of authority
       will be: e.g Personal Name
    2) When creating authority, in tab 1 under -HEADING--PERSONAL NAME enter
       the personal name term entry element and then save the
       new authority e.g. Twain, Mark.
    3) In circulation, search the catalog for a random book. Click the title
       of the book and you will be taken to the book details.
    4) Edit the record and in tab 1 , scroll down the - MAIN ENTRY--
       PERSONAL NAME and repeat this tag (the icon next to the title).
    5) Edit the Personal name term entry element by clicking
       the button on the right of the bar.
    6) In the Search main heading ($a only) enter your personal name term
       e.g. Twain, Mark.
    7) Press search, and then in the table that pops up, click 'choose'.
    8) Save your edits and the new personal name term will be in the 'By:'
       of the book details.
    9) Notice that there is no magnifying glass icon.
    10) Apply this patch
    11) Notice that there is now a magnifying glass icon next to the
        personal name term.
    12) Click on the magnifying glass and it will take you directly to the
        authorities records
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a4cd8e9d650765dfe1be07701686448c3d422d00
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Mar 6 14:54:54 2022 +0100

    Bug 30159: (QA follow-up) Fix translatability of alert message
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 47e3a0f0be02a475e30335d3cba0eb467b5b7f39
Author: Adam Styles <adam.styles@esa.edu.au>
Date:   Thu Feb 24 10:20:51 2022 +1100

    Bug 30159: (follow-up) Make warning messages consistent
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0733ba2075badfca90477d0dbfa490f81e68f066
Author: Adam Styles <adam.styles@esa.edu.au>
Date:   Tue Feb 22 11:32:52 2022 +1100

    Bug 30159: Fix Check() to validate both mandatory and important fields
    
    This patch adds a check for both mandatory and important fields when
    validating bibliographic records during cataloguing.
    
    To test:
    
    1. Go to Admin -> Biblio frameworks. View the MARC structure of your
       default framework.
    2. Search for tag 082. Edit the subfields for this tag.
    3. Check the 'important' checkbox for subfield a and Save.
    4. Go to add or edit a new biblio record under Cataloguing.
    5. Ensure the 082$a field is empty and hit Save.
    6. Notice the confirmation pop-up is an unreadable display of HTML.
    7. Click Cancel on the pop-up box.
    8. Apply the patch and refresh the editor page.
    9. Ensure the 082$a field is empty and hit Save.
    10. Notice the confirmation pop-up is more helpful this time. Click
        Cancel on the pop-up box.
    11. Notice the 082$a field is displayed at the top of the page as an
        important field that is missing information. Use the 'go to field'
        link and confirm this works as expected.
    12. Leave 082$a empty and hit Save.
    13. This time click OK on the confirmation pop-up. Confirm you are able
        to save your record as normal.
    
    Sponsored-by: Education Services Australia SCIS
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0a6c8afd77b9d3204d949d3d2f0c95ede13f5990
Author: Mason James <mtj@kohaaloha.com>
Date:   Sat Mar 5 15:30:21 2022 +1300

    Bug 19169: Add a test to detect unneeded 'atomicupdate' files
    
    to test...
    
    1/ set git repo
        $ git reset --hard v21.11.03
    
    2/ run test
        $ prove ./t
        OK
    
    3/ apply patch
    
    4/ run test again, observe FAIL
    
        $ prove ./t/00-check-atomic-updates.pl
        ./t/00-check-atomic-updates.pl .. 1/?
        #   Failed test 'check for unhandled atomic updates: bug_29596.pl'
        #   at ./t/00-check-atomic-updates.pl line 34.
        #                   'bug_29596.pl'
        #           matches '(?^u:.*pl$)'
        # Looks like you failed 1 test of 3.
        ./t/00-check-atomic-updates.pl .. Dubious, test returned 1 (wstat 256, 0x100)
        Failed 1/3 subtests
    
    JD Amended patch: fix copyright year
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8b84f60de3c6340fe1bbeb861b46d8ac689d47ca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 27 14:14:27 2022 +0100

    Bug 29956: Prevent login form to be serialized into cookie
    
    To recrate:
    Logout
    Go to /cgi-bin/koha/opac-search.pl
    Click "Log in to your account"
    Fill in the login form
    Submit
    Check the 'form_serialized' cookie's value
    
    => Without this patch it contain login/password
    => With this patch applied the cookie is not created
    
    Confirm that the "Return to the last advanced search" feature still
    works as expected.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ba57d68519a66c4f3c09206e4ff382308cffb292
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 25 12:21:42 2022 +0000

    Bug 29931: (follow-up) Fix svc/checkouts and return_claims too
    
    Adding the same auth_status check here too.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 197425b450e54780afd95233195f9d0da56cf23a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 24 13:06:33 2022 +0000

    Bug 29931: (follow-up) Similar thing in opac-patron-image.pl
    
    Although less harmful indeed. No borrowernumber, no image.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested: logged in, logged out, prefs toggled. All fine.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 63f641daa6e382eac55c90dff89673dce6d69928
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jan 24 10:24:08 2022 +0000

    Bug 29931: Check cookie status before continuing
    
    Test plan:
    Logout from staff.
    Try to run plugins-enable (you should have some active plugin).
    Like: https://yourserver:staffport/cgi-bin/koha/plugins/plugins-enable.pl?class=Koha::Plugin::Test&method=enable
    Replace class and method as appropriate.
    Verify that with this patch, you will be redirected to 401 page.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 975f52a4cfe14ed1b198531827fb6eb2f2c23b2f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 14 23:54:15 2022 -1000

    Bug 19532: (RM follow-up) Fix recalls.old is default 0
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a0a72c9653e546155bca210605ac9cabb74de09c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 14 22:04:47 2022 -1000

    Bug 19532: (RM follow-up) More use of system preference
    
    When system preference is off, call no code related to Koha::Recalls.
    
    Also add some missing module import.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3838ac82f2a1088e70fe3e9c4bdc13d422726c91
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 14 22:04:12 2022 -1000

    Bug 19532: (RM follow-up) Adapt also UNIMARC XSLT
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b2dc45a47d85f3c239cb1c1407c6ddadb0dae168
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 14 22:01:10 2022 -1000

    Bug 19532: (RM follow-up) Fix status finished renamed fulfilled
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9cb2ff97d2cd340928224ff688cf1b9647ca61b7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 14 21:50:34 2022 -1000

    Bug 19532: DBRev 21.12.00.018
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0e35ab911c631dbac4be1018de57ebdec059b754
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Mar 14 20:54:20 2022 -1000

    Bug 19532: (RM follow-up) Update DBIC Schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9479db4d2dc74c5e2dd8941c754862db5fa3207a
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Mar 14 23:52:46 2022 +1300

    Bug 19532: (QA follow-up) Fixing typo
    
    Introduced by: Bug 19532: (QA follow-up) Simplify resultset accessors
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 16f19f13eb7ec8e3a7fed7b646277730af3c3fc4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 11 11:37:10 2022 -0300

    Bug 19532: (QA follow-up) POD and import fixes
    
    This fixes some library imports and POD.
    
    To test:
    1. Apply this patch
    2. Run the tests
    => SUCCESS: No change
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 514cbb809a18d210680b605439d2c0b07bef3271
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 11 16:46:45 2022 -0300

    Bug 19532: (QA follow-up) Simplify resultset accessors
    
    This patch makes the different ->recalls accessors implemented on this
    bug be more standard. This means:
    - They don't do special things like default sorting or stripping out
      special parameters. That's all left to the caller and the methods are
      clean: they just return the related objects
    - Useful filtering methods for Koha::Recalls resultsets are added. The
      only used one (in the end) was ->filter_by_current. It seems like a
      better approach, because it gives devs more control on how they want
      to chain things, and there's a single place in which to maintain the
      criteria of what is 'current' or 'finished'. This clearly makes the
      'old' column obsolete IMHO, at least in the use cases I found. This is
      covered by tests as well.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ea6eb301a6aa89b1749f71063ed21cc8c503a5e7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 11 12:20:18 2022 -0300

    Bug 19532: Make recalls.status an ENUM
    
    This patch makes the status attribute an ENUM, setting the default value
    as 'requested' as well. The chosen names are easier to read than single
    letters. Also, renamed F into fulfilled (this impacts methods names as
    well). This is because 'finished' or 'completed' is more a synonym for
    old => 1...
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e550f657f1fb9defef4b59668bfbe2cfdc44218c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 3 15:07:32 2022 +0000

    Bug 19532: (QA follow-up) Add the cron jobs to the cron files
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3e2b55f64ced64cab71065de8562b998209c3522
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 2 15:24:46 2022 +0000

    Bug 19532: (QA follow-up) Move as_list to iterator based loop
    
    Adjusting both new cron jobs.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3437fd9303dd57b1d5e0b2cad947b3523ec6b3f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 2 14:33:06 2022 +0000

    Bug 19532: (QA follow-up) Fix fine calculation by inserting biblionumber
    
    The fines cron job uses Getoverdues to pass issue info to CalcFine.
    It took me a while to realize that the overdue hash does not contain
    a biblionumber. When testing CalcFine, we pass an item hash that
    does include one.
    
    So what happened? $item->{biblionumber} is undefined when it comes from
    Getoverdues and no recall overdue fine is calculated, only a regular one.
    
    Simple fix (without any impact): Add a biblionumber to Getoverdues.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested with fines.pl: recall fine applied now.
    Ran some Circulation and Overdues unit tests.
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b9ba0e131aa974fba10af3b296de29d0d2e73f17
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Mar 1 14:00:27 2022 +0000

    Bug 19532: (QA follow-up) Fix few Koha::Recalls->search occurrences
    
    Due to the wantarray change, we should fix this call in list context.
    We should either use an iterator now or append as_list.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9e68bb7fbb7f249badaca947b8db1f34fd4a6daa
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Feb 28 12:17:04 2022 +1300

    Bug 19532: (follow-up) Fix for wantarray change and title-string
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 82f6b8725ae3cc52b82d794a6973518666ba924f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 25 08:53:11 2022 +0000

    Bug 19532: (QA follow-up) Fixing unit tests
    
    (Trivial:) Number of tests in Koha/Item.t
    Added a $patron object to resolve warnings like:
    * Global symbol "$patron" requires explicit package name (did you forget to declare "my $patron"?) at t/db_dependent/Koha/Patron.t line 1064.
    Fixed CanItemBeReserved call in Holds.t, number of tests adjusted
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ddde85181b937f3208f3a59c4aa1630db5cb9a8
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Tue Feb 15 07:55:36 2022 +1300

    Bug 19532: (follow-up) Fixes along recall workflow
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4446c979417ab42820dc2b731cffc95739fc5b79
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 22 08:32:03 2021 +0000

    Bug 19532: (QA follow-up) Enable XSLT statuses translation
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a8929cbcdb2d21c0bb12f807e7effe04ee11e093
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Oct 14 16:54:36 2021 +1300

    Bug 19532: (follow-up) Fix calls, tests, syspref settings, checks
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4d6c7cdb1af8474c2365831e94f0b5b6e0916f30
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Nov 9 10:19:11 2020 +1300

    Bug 19532: (follow-up) Fixing tests and QA tools
    
    And making reverted ajax message clearer
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b5d1736295f34661c4e1e788477045e954187d2e
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Nov 6 10:42:08 2020 +1300

    Bug 19532: (follow-up) Fix undef recall_id preventing fulfillment of recall
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1e24de67b4db99061e7895ea069a17fd06d6762e
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Oct 28 16:15:39 2020 +1300

    Bug 19532: (follow-up) Fixing OPAC display and staff client errors
    
    - fixes the displays of opac-recalls.pl and opac-recall.pl
    - fix the error on Recalls to pull page
    - fix JS error preventing Recalled link from showing in checkouts table
    - fix cancelling of recall when checking out item
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ffba7843d33de1e2cc16530074a0836bc1200d99
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sun Oct 25 17:35:26 2020 +1300

    Bug 19532: (follow-up) Fixing failing CalcFine.t test
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fa7d9815b3169ac377bc7ffb93b14f5091e05e27
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sat Oct 24 13:42:05 2020 +1300

    Bug 19532: (follow-up) aria-hidden attr on OPAC, and more
    
    - removing authnotrequired flag from scripts
    - fixing opac buttons
    - chmod +x for recalls test files
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit db095c3a7b2aa41142dbd4d9705ddaa21e139a6d
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon May 11 23:52:09 2020 +0000

    Bug 19532: Recalls on intranet
    
    See recalls on Intranet
    - old recalls (all inactive recalls)
    - recalls queue (all active recalls) - cancel, expire, revert waiting status, multiple cancel, mark overdue
    - recalls to pull (available but not yet waiting) - cancel
    - recalls awaiting pickup (awaiting pickup, awaiting pickup more than RecallMaxPickUpDelay days) - expire, revert waiting status
    - overdue recalls (overdue to be returned) - cancel, multiple cancel
    - biblio recalls tab (all active recalls relevant to this bib) - cancel, expire, revert waiting status, mark overdue
    - patron recalls tab (all active recalls relevant to this patron) - cancel, expire, revert waiting status, mark overdue
    - patron recalls history tab (all recalls relevant to this patron) - cancel, expire, revert waiting status, mark overdue
    - log viewer
    
    and the general circulation of recalls
    
    == TEST PLAN FOR RECALLS ==
    
    ADMINISTRATION
    
    1. Apply all patches
    2. Run database updates, update schema files and confirm everything applies cleanly
    3. Run tests and confirm everything passes:
    t/db_dependent/Koha/Recall.t
    t/db_dependent/Koha/Recalls.t
    t/db_dependent/Stats.t
    t/db_dependent/Circulation/CalcFine.t
    t/db_dependent/Koha/Item.t
    t/db_dependent/Koha/Biblio.t
    t/db_dependent/Koha/Patron.t
    t/db_dependent/XSLT.t
    t/db_dependent/Search.t
    t/db_dependent/Holds.t
    t/db_dependent/Circulation/transferbook.t
    t/db_dependent/Circulation.t
    
    4. Go to Administration -> system preferences. Find the UseRecalls system preference. It should be DISABLED. Confirm RecallsMaxPickUpDelay is set to 7 by default.
    5. Go to Administration -> circulation rules. Confirm there are no recalls circulation rules showing.
    6. Test a few circulation flows: checking out, placing a reserve, checking in, fulfilling a reserve, etc. Confirm everything works as normal.
    
    7. Go to Administration -> system preferences. Enable the UseRecalls system preference.
    8. Go to Administration -> circulation rules. Set the following rules:
    Recalls allowed (count) = 0
    Recalls per record (count) = 0
    On shelf recalls allowed ( If any unavailable / If all unavailable ) = If any unavailable
    Recall due date interval (days) = 3
    Recall overdue fine amount = (something different to your normal fine amount)
    Recall pickup period (days) = 1
    
    Throughout your testing, try with different combinations of these rules and itemtype / branchcode / categorycode. Also try with null values. Keep the circulation rules open in another tab so you can refer to and update these easily. You should also have at least one other tab open for the staff client, and a third tab open for the OPAC, for ease of testing.
    
    9. Go to your account -> More -> Set permissions. Confirm the recalls permission is checked.
    10. Set up a test user with OPAC login details (Borrower A). This could also be your own user, as long as you have OPAC login access.
    11. Set up a test record (Biblio A) with at least two items (Item A and Item B) of the same item type (or an item type with the same recall circ rules).
    
    PLACING A RECALL
    
    12. Log in to the OPAC as Borrower A. Do a catalogue search with a term that will return multiple results, including Biblio A.
    13. Click on Biblio A.
    14. Notice there is a 'Place recall' button on the sidebar menu. Click this button. There will be a message saying that there are no items to recall - this is because all items are available.
    
    15. Check out Item A to another borrower (Borrower B).
    16. Refresh the 'Place recall' page. You will still NOT be able to place a recall - this is because Recalls allowed = 0 and Recalls per record = 0.
    
    17. Edit the circulation rules to have the following values:
    Recalls allowed (count) = 1
    Recalls per record (count) = 1
    18. Refresh the 'Place recall' page. You will now see the form to place a recall.
    
    BIBLIO-LEVEL RECALL, NO TRANSFER
    
    19. Place a biblio-level recall.
    Pickup location: Branch A, the set branch when you are logged into the staff client
    Recall not needed after (expiration date): whatever you want
    Select 'recall next available item'
    Click confirm
    20. Confirm the recall is placed successfully. Confirm that the new due date displayed is correctly calculated to be today's date, plus 3 days (taken from the 'recall due date interval' circ rule)
    21. In the staff client, look at Borrower B's account, and go to their Notices tab. Confirm they have received a 'Notification to return recalled item' notice.
    22. Look at Borrower B's checkouts table. Notice the due date for their checkout has been adjusted, and there is now a note to say that the item was recalled and the due date adjusted.
    23. Log in to the OPAC as Borrower B and go to your summary tab. Notice there is a note under their checkout to say the item had been recalled.
    
    24. Log out of the OPAC and log back in as Borrower A.
    25. Go to your summary tab. Confirm there is a Recalls tab with a count of 1.
    26. Cancel the recall using the button. Confirm it cancels and the Recalls tab disappears.
    
    27. Do a catalogue search with a term that will return multiple results, including Biblio A.
    28. When the results load, notice there is a 'Place recall' button next to the 'Place hold' button. Click this 'Place recall' button.
    29. Notice you are redirected straight to the form to place a recall.
    30. Place a biblio-level recall again, following the steps in Step 19.
    
    31. Go to your recalls history tab. Notice your first cancelled recall shows here.
    32. Cancel the recall you just created, using the button. Confirm it cancels and you are redirected to your summary tab.
    
    33. In the staff client, enable the UseCourseReserves system preference.
    34. Go to the main menu, click Course Reserves.
    35. Add a new course. (You may also have to define an authorised value for DEPARTMENT.)
    36. Add Item A as a reserve to this course.
    
    37. View Course Reserves in the OPAC. Click the course you just created.
    38. Notice the reserve has a Recall button underneath it's 'Checked out' status. Click this button.
    39. Place a biblio-level recall again, following the steps in Step 19.
    
    40. Click the 'Place recall' link in the breadcrumbs.
    41. Notice there is a message saying that you have reached the max number of recalls on this record. This is because Recalls allowed = 1 and Recalls per record = 1.
    42. Edit the circulation rules to have the following values:
    Recalls allowed (count) = 10
    Recalls per record (count) = 5
    43. Refresh the 'Place recall' page. You will now see the form to place a recall.
    
    44. Create another test record (Biblio B) with at least one item (Item C).
    45. Find this record on the OPAC and place a biblio-level recall again, following the steps in Step 19.
    
    46. In the staff client, go to Circulation -> Old recalls. You should be able to see your two cancelled recalls.
    47. Go to Circulation -> Recalls queue. Your current recalls should show here.
    48. Use the 'Select all' checkbox to select all recalls.
    49. Cancel the recalls using the 'Cancel selected recalls' button.
    
    50. Go to the OPAC and place a biblio-level recall on Biblio A again, following the steps in Step 19.
    
    51. In the staff client, check in Item A, which should still be checked out to Borrower B.
    52. A box should pop-up asking you to confirm Borrower A's recall. Click ignore.
    53. Click the link to go view Biblio A's details in the catalogue.
    54. Click the recalls tab. Notice Borrower A's recall is displayed, and shows it is still Requested (has not been confirmed waiting).
    
    55. Check in Item A again. This time, confirm the recall as waiting using the "Confirm recall" button.
    56. Go to Borrower A's Notices tab. Confirm there is a notice "Recalled item awaiting pickup".
    57. Go to Borrower A's checkouts. Notice there is a recalls tab. Confirm the recall is showing as "Ready for pickup".
    58. Click the 'Actions' dropdown. Click the "Revert waiting" button. The page should show a message that the waiting status has been reverted, without reloading.
    
    59. This time, check in Item B. The recall confirmation box should show again, because this a biblio-level recall that any recallable item under Biblio A can fill. Click the "Print slip and confirm" button.
    60. Check the slip that is generated. Confirm it contains Borrower A's correct details, and the details of the recall are correct.
    61. Go to Circulation -> Recalls awaiting pickup. Confirm the recall is now waiting and shows in this list.
    (You could also try this with Item B having a different item type to Item A, and circ rules not allowing Item B's item type to have recalls. When checking in Item A, it should not trigger the recall box).
    
    62. Go to Borrower A's checkouts. Check out Item B.
    63. Confirm the checkout is successful and the recall is removed from the Recalls tab.
    64. Go to Circulation -> Old recalls. The fulfilled recall should show.
    
    65. Check in Item B.
    
    BIBLIO-LEVEL RECALL, TRANSFER REQUIRED
    
    66. Check out Item A to Borrower B.
    67. Log in to the OPAC as Borrower A.
    68. Find Biblio A and place a biblio-level recall.
    Pickup location: Branch B, a different branch from your logged in branch. This recall will require a transfer.
    Recall not needed after (expiration date): whatever you want
    Select 'recall next available item'
    Click confirm
    
    69. In the staff client, check in Item A at Branch A. Notice the box that pops up shows that a transfer is required.
    70. Click "confirm recall and transfer" and confirm the transfer.
    71. Go to your account and click the Recalls tab.
    72. Confirm the recall status now shows the item is in transit to Branch B.
    73. In the drop-down top-right of your window, select 'Set library'.
    74. Set your library to Branch B.
    
    75. Go to Circulation -> Transfers to receive. Notice that the recall is showing here.
    76. Click 'Cancel transfer'.
    77. Go to Circulation -> Recalls queue
    78. Confirm the recall status has been reverted to Requested.
    
    79. Set your library back to Branch A.
    80. Check in Item A and trigger the transfer.
    81. Set your library back to Branch B.
    
    82. Check in Item A at Branch B.
    83. When the 'Recall found' box pops up, click Ignore.
    84. Go to Circulation -> Recalls to pull. The recall should show here, with a button to "Cancel recall and return to: Branch A"
    85. Click the button to cancel the recall.
    
    86. Repeat Steps 66-70.
    87. Check in Item A at Branch B. Confirm the recall as waiting.
    88. Check out Item A to Borrower A to fulfill the recall.
    
    89. Set your library back to Branch A and check in Item A.
    
    ITEM-LEVEL RECALL, NO TRANSFER
    
    90. Go to Administration -> circulation rules. Set the following rules:
    On shelf recalls allowed ( If any unavailable / If all unavailable ) = If all unavailable
    
    91. Check out Item A to Borrower B.
    92. Log in to the OPAC as Borrower A and go to Biblio A.
    93. Click the 'Place recall' button. Confirm there is a message that there are no items to recall. This is because On shelf recalls allowed = If all unavailable, and there is still one item (Item B) available.
    94. In the staff client, edit Item B to have a withdrawn, item lost or not for loan status.
    95. Refresh the 'Place recall' page. Confirm you can now see the form to place a recall.
    
    96. Place an item-level recall.
    Pickup location: Branch A.
    Recall not needed after (expiration date): whatever you want
    Select 'recall a specific item'
    Item B will not be selectable, and Item A should be selected by default.
    Click confirm
    
    97. In the staff client, edit Item B and remove the lost or missing status.
    98. Check in Item B. Confirm the recall box does not pop up, because it cannot fill the item-level recall.
    99. Check in Item A. Confirm the recall as waiting.
    100. Go to Circulation -> Recalls awaiting pickup
    101. Expire the recall. Confirm it expires as expected.
    
    ITEM-LEVEL RECALL, TRANSFER REQUIRED
    
    102. Repeat steps 91 to 95.
    103. Place an item-level recall.
    Pickup location: Branch B, we will require a transfer.
    Recall not needed after (expiration date): whatever you want
    Select 'recall a specific item'
    Item B will not be selectable, and Item A should be selected by default.
    Click confirm
    104. In the staff client, check in Item A. Confirm the recall and trigger the transfer.
    105. Set your library to Branch B and check in Item A.
    106. Confirm the recall as waiting.
    107. Check out Item A to Borrower A and fulfill the recall.
    
    108. Set your library back to Branch A and check in Item A.
    
    CRONJOBS: EXPIRING RECALL
    
    109. Check out Item A to Borrower B.
    110. Log in to the OPAC as Borrower A. Place a recall (any level) on Biblio A.
    111. In your terminal, enter mysql and edit the expiration date of your recall to be before today
    UPDATE recalls SET expirationdate = NOW()-2 WHERE recall_id = X;
    112. Run the expiry cronjob from within your shell
    perl misc/cronjobs/recalls/expire_recalls.pl
    113. Go to Borrower A's account and go to the Recalls history tab
    114. Confirm the recall has been expired because the current date surpassed the specified expiration date
    
    115. Check out Item A to Borrower B.
    116. Log in to the OPAC as Borrower A. Place a recall (any level) on Biblio A.
    117. In the staff client, check in Item A and confirm the recall as waiting.
    118. In your terminal, enter mysql and edit the waiting date of your recall to be before today
    UPDATE recalls SET waitingdate = NOW() - interval 5 day WHERE recall_id = X;
    119. Run the expiry cronjob from within your shell
    perl misc/cronjobs/recalls/expire_recalls.pl
    120. Go to Borrower A's account and go to the Recalls history tab
    121. Confirm the recall has been expired because the recall had been waiting for more days than the Recall pickup period
    
    122. Go to Administration -> circulation rules. Set the following rules:
    Recall pickup period (days) = 0
    123. Set the RecallsMaxPickUpDelay system preference = 1.
    124. Check out Item A to Borrower B.
    125. Log in to the OPAC as Borrower A. Place a recall (any level) on Biblio A.
    126. In the staff client, check in Item A and confirm the recall as waiting.
    127. In your terminal, enter mysql and edit the waiting date of your recall to be before today
    UPDATE recalls SET waitingdate = NOW()-2 WHERE recall_id = X;
    128. Run the expiry cronjob from within your shell
    perl misc/cronjobs/recalls/expire_recalls.pl
    129. Go to Borrower A's account and go to the Recalls history tab
    130. Confirm the recall has been expired because the recall had been waiting for more days than the RecallsMaxPickUpDelay syspref
    
    CRONJOBS: OVERDUE RECALL
    
    131. Check out Item A to Borrower B
    132. Log in to the OPAC as Borrower A. Place a recall (any level) on Biblio A.
    133. In your terminal, enter mysql and edit the due date of the checkout to Borrower B to be before today
    UPDATE issues SET date_due = NOW()-2 WHERE issue_id = X;
    134. Run the overdue cronjob from within your shell
    perl misc/cronjobs/recall/overdue_recalls.pl
    135. Go to Circulation -> Overdue recalls
    136. Confirm your recall is showing here now as the recall has been marked Overdue
    
    CIRCULATION
    
    137. Check in Item A.
    138. When the recall box pops up, click Ignore.
    139. Check out Item A to Borrower B. You should see a yellow confirmation box, saying that another borrower has recalled the item you are trying to check out.
    140. Click "No don't check out" and confirm the item isn't checked out and the recall remains.
    141. Repeat Step 139.
    142. Click "Yes check out" and confirm the item is checked out and the recall remains.
    143. When Borrower B's checkout table loads, confirm that you cannot renew or check in the item from the Checkouts table because there is a 'Recalled' link which takes you to the recalls tab for that biblio.
    144. Repeat Steps 137-139.
    145. Select "Cancel recall" and click "Yes check out" and confirm the item is checked out and the recall has been cancelled.
    146. Log in to the OPAC as Borrower A. Place a recall (any level) on Biblio A.
    147. Check in Item A. Confirm the recall as waiting.
    148. Check out Item A to Borrower B. You should see a yellow confirmation box, saying that that another borrower has recalled the item that you are trying to check out.
    149. Select "Revert waiting status" and click "Yes check out" and confirm the item is checked out and the recall status has reverted to requested.
    
    OTHER
    150. In your terminal, enter mysql and edit the due date of the checkout to Borrower B to be before today
    UPDATE issues SET date_due = NOW()-2 WHERE issue_id = X;
    151. Go to Borrower A's recalls and click the Actions dropdown.
    152. Click "Mark as overdue" and confirm the recall is marked as overdue manually.
    
    153. Go to Tools -> Log Viewer. Check only the Recalls module, and leave all other parameters, and click Submit.
    154. Confirm all of the recalls actions that have been made are correctly logged.
    
    Note: recalls messaging preferences are introduced in Bug 23781.
    The recall feature is fully documented at: https://wiki.koha-community.org/wiki/Catalyst_IT_Recalls
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 52b5cdf79b53eb29173e92a7dfe0f76df135e7d9
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon May 11 23:52:52 2020 +0000

    Bug 19532: Recalls on OPAC
    
    - place a biblio-level or item-level recall via the biblio detail page, OPAC search results, or course reserves
    - view or cancel your active recalls from 'your summary' recalls tab
    - view all active and inactive (and cancel active) recalls from 'your recall history'
    - stopped from placing a reserve on an item that the patron has already recalled
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b800c2e68d993897c10e9eb80a03b37ddd310b44
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Apr 22 20:06:54 2020 +0000

    Bug 19532: Other objects used in recalls feature
    
    - biblio->recalls
    - biblio->can_be_recalled
    - item->recall
    - item->can_be_recalled
    - item->can_set_waiting_recall
    - item->check_recalls
    - patron->recalls
    - Biblio.RecallsCount
    
    and relevant tests
    - t/db_dependent/Stats.t
    - t/db_dependent/Koha/Item.t
    - t/db_dependent/Koha/Biblio.t
    - t/db_dependent/Koha/Patron.t
    - t/db_dependent/XSLT.t
    - t/db_dependent/Search.t
    - t/db_dependent/Holds.t
    - t/db_dependent/Circulation/transferbook.t
    - t/db_dependent/Circulation.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 01cc7621d54cc2834767ef2b8b717f8ed486ae01
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Apr 22 16:47:17 2020 +0000

    Bug 19532: Expiry and overdue cronjobs, and overdue fine calculation
    
    - misc/cronjobs/recalls/expire_recalls.pl
    - misc/cronjobs/recalls/overdue_recalls.pl
    - tests for overdue fines in t/db_dependent/Circulation/CalcFine.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 711411e74475ea26c5eaf6ca6d4e023562189930
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Apr 22 07:35:47 2020 +0000

    Bug 19532: Recalls objects and tests
    
    Koha/Recall.pm
    - biblio
    - item
    - patron
    - library
    - checkout
    - requested
    - waiting
    - overdue
    - in_transit
    - expired
    - cancelled
    - finished
    - calc_expirationdate
    - start_transfer
    - revert_transfer
    - set_waiting
    - revert_waiting
    - set_overdue
    - set_expired
    - set_cancelled
    - set_finished
    - should_be_overdue
    
    Koha/Recalls.pm
    - add_recall
    - move_recall
    
    and relevant tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 006b4c3bb48f2fd7a9415808a88f3efe067a4745
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Mar 2 13:23:35 2022 +0000

    Bug 19532: [DBIx] Schema change for Recalls
    
    Separated from the "Recalls-objects-and-tests" patch
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cfa85616237bbfdc8781cb3ab55a852582015be1
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Sat Oct 24 12:12:22 2020 +1300

    Bug 19532: [DBIx] Add boolean flags to recalls.old and recalls.item_level_recall
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e56a85d5ae06f0b52f7d6e50e6f781a9f6e305b1
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Oct 14 15:07:50 2021 +1300

    Bug 19532: [DBIx] Updated schema files
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 53aa7b523b27b6b18e8c7147d34ad5276072bcf0
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Apr 22 00:47:13 2020 +0000

    Bug 19532: Database and installer stuff
    
    - Add recalls table
    - Add recalls circulation rules - recalls allowed, recalls per record, on shelf recalls, recall due date interval, recall overdue fine, recall shelf time
    - Add system preferences - useRecalls, RecallsMaxPickUpDelay, RecallsLog
    - Add email notices (RETURN_RECALLED_ITEM, PICKUP_RECALLED_ITEM)
    - Add print notice (RECALL_REQUESTER_DET)
    - Add user permission - recalls, manage_recalls
    - Add Recall and CancelRecall enum options for branchtransfers reason
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2c5f49550bffde753b33fe605878ab689bf86697
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Mar 2 14:46:09 2022 +1300

    Bug 30209: Upgrade 'libdbd-sqlite2-perl' package to 'libdbd-sqlite3-perl'
    
    to test...
    
    1/ apply patch, build and install new package
    
    2/ check that libdbd-sqlite3-perl package is installed
    
         $ dpkg -l | grep libdbd-sqlite
         ii  libdbd-sqlite3-perl:amd64              1.62-3          amd64
    
        note: libdbd-sqlite3-perl package installs DBD::SQLite module, which uses sqlite3 :)
    
            https://packages.debian.org/stretch/libdbd-sqlite3-perl
            https://metacpan.org/pod/DBD::SQLite
    
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 52c4bd1de6949a27c4bc27b322f9960e0b318365
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 25 20:04:41 2022 +0000

    Bug 22993: Handle default messaging preferences during patron creation from API
    
    TO test:
    1 - Set default messaging preferences for a patron category
    2 - Create a patron in that category using the API
    3 - Verify messaging preferences are not set
    4 - Apply patch, restart all
    5 - Create another patron
    6 - Verify messaging preferences are correctly set
    7 - prove -v t/db_dependent/api/v1/patrons.t
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 27b8c55dfa2a6037e527e9565da7ef3761f00280
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 25 20:04:14 2022 +0000

    Bug 22993: Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 681d33aa2fbc6ea4d8b18906cca93a3524f72df0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 4 16:48:19 2022 +0000

    Bug 15594: (QA follow-up) Move span to publisher name, fix whitespace, only add spaces once per loop
    
    This patch updates the whitespace for readbility
    Moves the Ogranization span to the subfield b, publisher name only
    Moves check for last/whitespace to the loop
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6c189d155ecec694a7831cfcb37c44f54fe1983c
Author: The Minh Luong <theminh@inlibro.com>
Date:   Thu Mar 3 15:03:57 2022 -0500

    Bug 15594: Class in now unchanged after the patch
    
    I'm not sure if this is the actual issue, but I found that the patch puts the span with
    the class "publisher_name" inside a new span with typeOf="Organization".
    
    In this patch, I removed that new span, to keep it coherent with the previous code.
    Also, the MARC 260 subfields are displayed correctly !
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 93c1d533c6cdf81d4a5f61824cd884b179a26605
Author: Philippe Blouin <blou@inlibro.com>
Date:   Wed Dec 8 16:45:29 2021 -0500

    Bug 15594: preserve sequence of 260 subfields in (staff) detail page
    
    When ordered $a$b$a$b$c in the MARC object, 260 subfields are displayed
    $a$a$b$b$c.  This goes against the standard.
    
    This patch preserves the order.
    
    0) create a notice with $a$b$a subfields.  In that (mixed) order.
    1) Go to staff detail page and see the fields displayed as "aab"
    2) apply the patch
    3) validate the aba display.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a94ddd25e72ea0447c7509875f0a5f2051ef8e79
Author: Philippe Blouin <blou@inlibro.com>
Date:   Mon Dec 6 13:48:30 2021 -0500

    Bug 15594: preserve sequence of 260 subfields in detail page
    
    When ordered $a$b$a$b$c in the MARC object, 260 subfields are displayed
    $a$a$b$b$c.  This goes against the standard.
    
    This patch preserves the order.
    
    0) create a notice with $a$b$a subfields.  In that (mixed) order.
    1) Go to detail page and see the fields displayed as "aab"
    2) apply the patch
    3) validate the aba display.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 739ce52ff8aa5ca69bc7525de6b67a049a56a22b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Mar 8 22:19:01 2022 -1000

    Bug 30190: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7ffd3e4015c1fb9d670c64458a6cb72ebb4dee64
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Mar 2 14:23:36 2022 +0000

    Bug 30190: Green buttons turn blue for a second when clicking them
    
    This patch adds additional CSS to better cover various states of buttons
    in the OPAC.
    
    To test, apply the patch and rebuild the OPAC CSS:
    https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client
    
    - In the OPAC, test various green buttons in varous states: default,
      hover, and active (the appearance when the button is clicked but
      before the mouse button is released).
    - The button should be styled in various shades of green in all cases.
    - Test a disabled button by performing a catalog search.
    - On the results page, before any checkboxes are checked, the "Save"
      button should look correct.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 849561896f71536439a56496a205ed3cb02fb983
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 18 16:36:56 2022 +0000

    Bug 29136: (QA follow-up) missing filters
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e2306f85e79f76ca8e5165d4b78afdb69b452aeb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 7 17:27:37 2022 +0100

    Bug 29136: Don't redirect if the whole set is > 1
    
    To prevent a redirect when we click on a page with only 1 result
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9e6f00b142936e548294998ad03750f558b5e223
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 1 11:06:49 2022 +0100

    Bug 29136: Ajaxify the patron search when placing a hold
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9c7a7f7c86a5b401f035c2fd51ee745580ec34f4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 23 16:58:57 2021 -0300

    Bug 29771: Scalar context for split
    
    This patch tackles a very specific scenario. Calling split(...,
    CGI::param) makes it be called in list context. The split docs say:
    
    split /PATTERN/,EXPR,LIMIT
    
    this means the first CGI param will be used as EXPR and the second one
    as LIMIT, which is wrong anyway. So the fix is to just force scalar
    context.
    
    To test:
    1. Not sure, just make sure nothing breaks when using the scripts in the
       browser.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1570af154fe791d6dcac53f27ff8d7175b7a6095
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 23 16:16:58 2021 -0300

    Bug 29771: Remove trivial cases
    
    I squashed the patches because they are too trivial to have a test plan.
    Or it is too much work to write the test plan for such trivial cases. I
    leave the original commit messages just in case.
    
    Generally, this are all cases in which CGI::param is being called in a
    trivially identifiable _list context_. i.e. they are assigned to a
    @variable.
    
    I left one case out on purpose: admin/auth_subfields_structure.pl
    
    Paul introduced this:
    
    my @kohafield = ''.$input->param('kohafield');
    and then:
    my $kohafield = $kohafield[$i];
    
    My intuition says it is forcing scalar context on the first assignment
    so the list contains a single element and then inside the loop some
    $kohafield assignments should lead to undef, and even warnings. I leave
    it for a separate patch because it is not that easy testable and is a
    sensible area.
    
    Bug 29771: Remove warning from  acqui/finishreceive.pl
    
    This patch removes a warning that shows when receiving.
    
    To test:
    1. Do the acq workflow up to the receive step.
    2. Once you choose the items and click on Finish
    => FAIL: There's a warning in the logs
    3. Revert receipt
    4. Apply this patch
    5. Receive
    => SUCCESS: No more warnings
    6. Sign off :-D
    
    Bug 29771: Remove warning from svc/members/add_to_list
    
    To test:
    1. Run:
       $ tail -f /var/log/koha/kohadev/*-error.log
    2. Generate a patron list
    3. Perform a patron search that gives you a few
    4. Select some, and choose to add them to the list
    => FAIL: The logs show the infamous warn:
    CGI::param called in list context from /kohadevbox/koha/svc/members/add_to_list
    5. Apply this patch
    6. Restart plack and repeat 4
    => SUCCESS: No warn!
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 23334aa6ca43264a489e1fa66727fe46efb431ff
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Mar 8 22:00:05 2022 -1000

    Bug 30128: DBrev 21.12.00.017
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7be7b0b6312fb2c6895355a704dc2bfc8c916764
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Mar 8 21:58:02 2022 -1000

    Bug 30128: DBIC Schema update
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4bd5d0f0bf5e7ace0636967ec65a05ecbc13316f
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 17 20:37:13 2022 -1000

    Bug 30128: Change language_subtag_registry.description to varchar(255)
    
    In database, language_descriptions.description is VARCHAR(255).
    language_subtag_registry.description is VARCH(25), it should have same size.
    
    You can see in https://www.loc.gov/standards/iso639-2/php/code_list.php there is for example 'South American Indian languages'
    
    Test plan :
    1) Run atomic update
    2) Check language_subtag_registry.description is now varchar(255)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 89ac4cfd4367b6a019705e2e630c7283a8837764
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Mar 4 08:47:15 2022 +0100

    Bug 30035: Fix failing test
    
    Looks like there was a change in the output for Spanish.
    Can be 'ene.' in older versions
    
    Sponsored-by: Orex Digital
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ba972111133fc7d9b2ed3c0ecc8edcaf7dcc074f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Mar 3 10:27:20 2022 +0000

    Bug 30203: Circulation.t: prevent locking by setting envvar
    
    Running this test without prove is disastrous. The LOCK in
    the called SendCirculationAlert will ruin your data.
    But no longer when you apply this patch.
    
    Test plan:
    Run prove Circulation.t
    Inspect your data (e.g. borrowers table).
    Run perl Circulation.t
    Inspect your data (e.g. borrowers table) again.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de28b9e416dc9fc876d7b9b8957e94bf18f61987
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 18 16:19:23 2022 +0000

    Bug 28782: (QA follow-up) Fix missing filter
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ff6b83ddf94dc0974987d268b1d150bf56a1537
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 18 16:15:55 2022 +0000

    Bug 28782: (QA follow-up) Bug 29844 follow-up
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3842e5ded359f3fd60524b35c9fe763f904a4aa3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 14:47:12 2022 +0100

    Bug 28782: Fix cancel holds in bulk
    
    See also bug 29969.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3339dc93132252661ee2a966ecce06a8ee4f452c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 14:46:38 2022 +0100

    Bug 28782: Fix link when placing a hold for a patron from patron list
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4f8a7fb9094df240e9de96eca2c791aa589f2800
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Oct 30 21:49:10 2021 +0000

    Bug 28782: (follow-up) Pass real array to query_form()
    
    It excepts to receive a real array and not a list, in order to be able
    to generate the query parameters.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 52b5a22edfbab0e211f5c5a3a8aa51b6fbd25202
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Jul 29 17:23:01 2021 +0300

    Bug 28782: Use query param list instead of splitting elements using '/'
    
    This removes the need to handle single and multiple cases separately,
    thus removing bunch if-else cases and simplifying our code. This
    coding style is also in line with our other .pl scripts.
    
    To test:
     1) Make sure placing a hold still works from the following pages:
    
       /cgi-bin/koha/catalogue/detail.pl?biblionumber=XXX
    
       /cgi-bin/koha/catalogue/search.pl?q=a
    
       /cgi-bin/koha/virtualshelves/shelves.pl?op=view&shelfnumber=XXXX
    
       /cgi-bin/koha/clubs/clubs.pl (create a new club and add a patron
       there and through the clubs.pl create a hold to a bib)
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ee957fc812daba845f8515e0254d082741e43eca
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 24 14:24:18 2022 -1000

    Bug 30147: Fix modules usage in opac-detail.pl
    
    On the ktd sample database when trying to go to the detail page from the result list:
    Undefined subroutine &CGI::Compile::ROOT::kohadevbox_koha_opac_opac_2ddetail_2epl::searchResults called at /kohadevbox/koha/opac/opac-detail.pl line 260
    Turning off OpacBrowseResults makes the error disappear.
    
    In opac-detail.pl, use C4::Search is missing searchResults and getRecords
    
    To test:
    - Search for something that gives several result pages in OPAC, example: e
    - Switch to one of the last pages using link on top of results, example: 10
    - Open any of the records listed in detail view
    - Verify that the error is shown
    - Apply patch and repeat, error is gone and browsing behaves as expected
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 666ec454734c66844f8fbdef22bb2dd48075f235
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 7 15:34:49 2022 -1000

    Bug 29826: Manage call of Template Plugin Branches GetName() with null or empty branchcode
    
    Bug 26587 added a concatenation that sends a warning if var is undef :
    $ prove t/db_dependent/Template/Plugin/Branches.t
    Use of uninitialized value $branchcode in concatenation (.) or string at /kohadevbox/koha/Koha/Template/Plugin/Branches.pm line 35.
    
    This patch adds an early return empty string when GetName is called with $branchcode null or empty string.
    
    Test plan :
    1) Run t/db_dependent/Template/Plugin/Branches.t without patch
    2) Run with the patch to see warning disappear
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2c821535ef1736d670a8e19946209dc27447cfbc
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Feb 14 18:38:16 2022 +0000

    Bug 30098: Only redirect from patron search if single result is on first page
    
    This patch simply adds a check that we are oin the first page (starting at result 0)
    before redirecting to a isngle patron
    
    To test:
    1 - Perform a patron search that returns 41 results, on Koha testing docker, 'a' works
    2 - Go to second page of results, works
    3 - Go to third page of results, redirected to the patron
    4 - Apply patch
    5 - Repeat search and paging
    6 - On third page you remian in results and are not redirected to patron
    
    Signed-off-by: Emmanuel Bétemps <e.betemps@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a771d0f704b85a08ceb93878bffc8e7839d44f51
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Mon Oct 18 14:35:21 2021 +0200

    Bug 26269: "Date due to" and "Show any items currently checked out" filters doesn't work properly in overdues.pl
    
    Filter "Date due to" is now taken into account even when filled with a
    future date for the displayed result and downloaded results.
    Filter "Show any items currently checked out" is now taken into account
    for the downloaded results.
    
    To test:
    1- Go to Circulation then to overdues
    2a- Add a filter with "Date due To" > today
    2b- Check that only the results with "Due date" < today are displayed
    (not those with "Due date" between today and the date requested)
    2c- Click on "Download file of displayed overdues"
    2d- Check that the file contains only the results with "Due date" <
    today (not those with "Due date" between today and the date requested)
    3a- Reset filter and then add the filter "Show any items currently
    checked out"
    3b- Check that all the results are displayed (even those with "Due date"
    > today)
    3c- Click on "Download file of displayed overdues"
    3d- Check that the file contains only the results with "Due date" <
    today (not those with "Due date" between today and the date requested)
    9- Apply the patch
    10- Repeat step 1 to 8, checking that all the results corresponding to
    the selected filter are now displayed/downloaded
    
    https://bugs.koha-community.org/show_bug.cgi?id=26269
    
    Signed-off-by: Theodoros Theodoropoulos <theod@lib.auth.gr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1d6a2eb5c586a6c421b0a2f4a9f39118763d6fd7
Author: David Gustafsson <glasklas@gmail.com>
Date:   Wed Oct 13 15:36:43 2021 +0200

    Bug 29220: Minor fixes and improved code readability
    
    The current handling of onsite checkouts with OnSiteCheckoutsForce
    syspref enabled is confusing and hard to understand. It's also fragile
    with a high risk future changes could result in subtle bugs.
    
    Also fix an inconsistency in which errors (DEBT_GUARANTORS) are considered blocking for
    forced onsite checkouts.
    
    To test:
    1) Enable OnSiteCheckouts, disable OnSiteCheckoutsForce
    2) Edit a biblio item and for example set Not for loan to a value
    restricting loans
    3) Try to check out the item for some patron
    4) A message that item is not for loan should be displayed
    5) Select "On-site checkout" and try again
    6) The same message should be displayed
    7) Try to checkout with some invalid barcode
    8) A message that barcode was not found should be displayed
    9) Now enable OnSiteCheckoutsForce
    10) Try to checkout the item for some patron
    11) A message that item is not for loan should be displayed
    12) Select "On-site checkout" and try again
    13) Checkout should now succeed, no messages should be displayed
    14) Try to checkout with some invalid barcode
    15) A message that barcode was not found should be displayed
    16) All of the above steps should produce the same result with and without this patch
    
    Additional:
    Before patch:
     a) Set  NoIssuesChargeGuarantorsWithGuarantees to 1
     b) add a guarantee with another guarantor
     c) charge a 1.01 fine to other guarantor
     d) checkout is blocked due to fines
    Apply patch
     e) checkout is allowed when onsite checkouts forced
    
    Sponsored-by: Gothenburg University Library
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f8ea837b53b9756809d2a740e02a0ea4ceadb58f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 12:10:30 2022 -0300

    Bug 29877: Make POST /holds handle maxreserves correctly
    
    The current implementation doesn't consider the following values for the
    syspref: undef and 0.
    
    The tests mistakenly didn't cover them.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => FAIL: Tests fail, obvious warnings about comparing undefined values
             too.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. You can try on Postman as well
    => SUCCESS: Behavior is correct!
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3ce1b0b707137960e95133f71dc9d48b232b06cb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 12:10:24 2022 -0300

    Bug 29877: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e55914a5d0e6a3fcc7dc59f785fb767b42db93d3
Author: Janusz Kaczmarek <januszop@gmail.com>
Date:   Thu Feb 24 21:26:46 2022 +0100

    Bug 30178: (bugs 27526 and 28445 follow-up) Every librarian can edit every item with IndependentBranches on
    
    Problem arises after applying bugfix 27526 and 28445: with
    IndependentBranches on, a librarian without superlibrarian privileges,
    can edit (and potentially delete) every item (i.e. also from a foreign
    branch).  This is because can_be_edited calculation is buggy (in two spots).
    
    Test plan:
    1. Have (at least) two branches defined.
    2. Have IndependentBranches set.
    3. Have a biblio record with items belonging to different branches.
    4. Be a librarian without superlibrarian rights, with editcatalogue
       and tool permissions set.
    
    Scenario A (Edit items):
    1. Go to Edit -> Edit items view (cataloguing/additems.pl).
    2. You will be able to edit every item, also ones not from the branch
       you are from (cf. the button 'Actions').
    3. Apply the patch.
    4. Repeat 1.
    5. You should be able to edit only the items from your branch.
    
    Scenario B (Edit items in batch):
    1. From Normal view go to Edit -> Edit items in batch.
    2. You will be able to batch edit every item, also ones not from the branch
       you are from.
    3. Apply the patch.
    4. Repeat 1.
    5. You should be able to edit only the items from your branch (and
       see 'Cannot edit' for others.
    
    Scenario C (Delete items in batch):
    1. From Normal view go to Edit -> Delete items in batch.
    2. You will not see the string 'Cannot delete' and only by chance
       will not be able to activate the checkboxes next to foreign items.
    3. Apply the patch.
    4. Repeat 1.
    5. You should be able to delete only the items from your branch (and
       see 'Cannot delete' for others.
    
    Scenario D and E:
    Analogous steps can be executed from Tools -> Batch item modification
    and Tools -> Batch item deletion
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1bbfda8c78dce3687334d8ac7e4caa4b0fce0ea1
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Mar 3 14:42:04 2022 -1000

    Bug 30072: (follow-up) Fix UT after Bug 29857
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6464827b77a8e83b8221fe5a7ee80c18432b802f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 11 15:35:31 2022 -0300

    Bug 30072: (follow-up) Silence useless warning
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f832efe548f3202518f92334f6e6e6d313673aec
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 11 15:28:31 2022 -0300

    Bug 30072: Add missing hold actions plugin hooks
    
    This patch introduces the after_hold_action plugin hook, with 4
    different 'action' parameters:
    
    - fill
    - cancel
    - suspend
    - resume
    
    To test:
    1. Apply the unit tests
    2. Run:
       $ kshell
      k$ t/db_dependent/Koha/Plugins/Holds_hooks.t -v
    => FAIL: The hooks are not in the code, so the expected output from the
    Koha::Plugin::Test plugin is not there, and the tests fail
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Note: I think we could deprecate 'after_hold_create' and migrate it to
    the one introduced here, using the 'place' action.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f51868cb821c09f848f2a404d57ab444cab00930
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 11 15:28:10 2022 -0300

    Bug 30072: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b0638ce23dcb1ff1d02268c803603aebcc9d4332
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 18 12:03:46 2022 +0000

    Bug 30125: (QA follow-up) Rename variable as cities
    
    It's what we are testing :-)
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 18ba814d6a70a60e6892003dce349919e203e13b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 17 14:50:14 2022 -0300

    Bug 30125: Add full-stack tests for API pagination
    
    This patch adds tests for all the pagination use cases on a real route
    (GET /cities). It tests _page, _per_page along with the returned Link
    headers and total counts (i.e. X-Total-Count, X-Base-Total-Count), and
    the results themselves.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/pagination.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 15acfaefb638870ff64d54a87bf68907fb6f6fd7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 14 13:03:54 2022 -0300

    Bug 29886: Add Koha::Suggestions->search_limited
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a92e0eafe6073827ce47aee9c748f11a807e09a6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 14 14:49:29 2022 -0300

    Bug 29886: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aab535f8d1d325e9d660839560db9de2b9abb0ae
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 15:05:02 2022 -0300

    Bug 30007: (follow-up) Adapt tests
    
    This patch adapts tests to acknowledge ->cancel and ->fill methods won't
    yield 'undef' borrowernumber when anonymization takes place, and even
    further, and exception will be thrown and cancellation/fulfillment will
    be rejected.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Bonus: this problem was hidding bad tests caused by 29857, fixed on this
    one as well.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8fd2083295af0376a00651c256ae6e6e2444f61d
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 2 08:52:54 2022 -1000

    Bug 25616: (follow-up) Fix t/Search.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f0fc5916db762654509aa0cf74a0cfcfdff4ad79
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 09:19:55 2022 -0300

    Bug 30007: (follow-up) Adjust Koha::Patrons->search_patrons_to_anonymise tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 812e1a5bb169c466c4d3c1b335e2b8dcfc069df1
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 2 08:21:40 2022 -1000

    Bug 29857: (follow-up) Fix t/db_dependent/api/v1/transfer_limits.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit af601225bbf5c5b7c4ff671ec887e8a7c3612931
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 2 08:16:33 2022 -1000

    Bug 29857: (follow-up) Fix t/db_dependent/Koha/BackgroundJobs/BatchUpdateBiblio.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6573dd7ef97fd6e571f02277387c65c58f06236c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 2 08:04:00 2022 -1000

    Bug 29857: (follow-up) Fix t/db_dependent/Koha/Club/Hold.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 85c4ac7582bc41f3ef72d484841c9f18307a252e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 2 07:57:58 2022 -1000

    Bug 29857: (follow-up) Fix t/db_dependent/Koha/Plugins/Plugins.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a7d941f31dc39b7401ab8d3a1c6841f2e91c6843
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 2 07:37:47 2022 -1000

    Bug 29857: (follow-up) Fix t/Koha/REST/Plugin/Query.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bbbb88f0350d5729aa33161b49ca22d88f5acb57
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 11:42:51 2022 -0300

    Bug 29857: (follow-up) Fix t/db_dependent/Koha/Patron/Modifications.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5213c65ceaaf3a70c2fd93b3789b82aee148cafe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 11:36:56 2022 -0300

    Bug 29857: (follow-up) Fix t/db_dependent/Auth.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d0e6731075347c38171747be85cf1a74147cd028
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 09:55:32 2022 -0300

    Bug 29857: (follow-up) Fix t/Koha/Email.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 007af54b5d5e93bcdc278ca8ecb349411a71b042
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 09:52:20 2022 -0300

    Bug 29857: (follow-up) Fix t/Koha/Object/Message.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9980a0f7502ff0e0bb9770907a02b7bf346e005c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 09:49:25 2022 -0300

    Bug 29857: (follow-up) Fix t/db_dependent/Koha/Biblio.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 279c63ad98b31fb397686621cde265e76a1f6a2a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 09:31:47 2022 -0300

    Bug 29857: (follow-up) Fix t/Koha/Plugins/Tab.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 86b853c7c6fff4a68689fa00a7769f65903cdb14
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Mar 2 09:28:35 2022 -0300

    Bug 29857: (follow-up) Fix Barcode_transform_hooks.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fab5fdfc31dc4a5fe79ef08ea1cff5210beadc5e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Feb 26 23:41:11 2022 +0100

    Bug 29589: (follow-up) Add TT filter
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4df305bf19633ce43e6a4a1c6cd8fd08564b38d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 30 14:10:58 2021 +0100

    Bug 29589: MARCOverlayRules - fix translatability issue
    
    Strings must not contain html tags, we should use KohaSpan instead.
    
    Test plan:
    Apply the patch, update translation for a given language, edit XX-YY-staff-prog.po
    
    Notice that the string is now
    "The %s preference is not set, don't forget to enable it for rules to take effect."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b6de822ad666a55ea5ea7ac984dd26941ec89162
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 7 09:26:12 2022 +0100

    Bug 30035: Fix month name in prediction pattern
    
    We are using %B to display the month name but it seems that using the
    CLDR pattern LLLL would be more appropriated.
    https://metacpan.org/pod/DateTime#CLDR-Patterns
    %B   - The full month name.
    LLLL - The wide stand-alone form for the month.
    
    For instance in Catalan:
    https://metacpan.org/pod/DateTime::Locale::ca
    %B will display "de gener" when LLLL will be "gener"
    
    Test plan:
    Create a new numbering pattern:
    Home > Serials > Numbering patterns > New numbering pattern
    Numbering formula: {X}
    Label: monthname
    Add: 1
    Every: 1
    Set back to: 1
    When more than: 999
    Formatting: Name of month
    And test it at the bottom of the form
    Locale: Catalan
    The number column should contain "gener", not "de gener"
    Test other locales and confirm that the output is correct (no change
    expected for English, French and Spanish for instance).
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b95602fcfdc9249930b612084b45813e01ed7a0d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Dec 13 13:23:57 2021 +0000

    Bug 29687: Uninitialized warning C4/XSLT line 286
    
    From plack-opac-error.log:
    [WARN] Use of uninitialized value $value in concatenation (.) or string at /usr/share/koha/C4/XSLT.pm line 286.
    
    Test plan:
    An opac search triggered the warning. So repeat it without warns.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fd1c259c0d4e12fd08d653e9412596d928eba0d8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Feb 25 15:57:41 2022 -1000

    Bug 30185: Missing return in db rev 210600003.pl
    
    db rev files are constructed with a return {...}, db rev 210600003.pl is missing return word.
    I don't know if it can impact the db upgrade but we should fix it for consistency.
    
    To test upgrade from a version 21.05 and check db rev is applied.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42181dfce7bec6983092ca76365211e06a42ad8c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 4 08:47:05 2022 -0300

    Bug 30023: Make MarkIssueReturned use ->anonymize
    
    Koha::Old::Checkout->anonymize takes care of checking the syspref and
    raises an exception if not set. So no we can now leverage on it, instead
    of checking manually and then tweaking the checkout object manually as
    well.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Circulation/MarkIssueReturned.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bafd1c25e9891ea3bc019fcad2c5d2191b9aa935
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 4 08:40:13 2022 -0300

    Bug 30023: Add Koha::Old::Checkout->anonymize
    
    This patch adds the mentioned method. It replicates the Koha::Old::Hold
    behavior, including the exception thrown on bad configuration.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Old/Checkout.t
    => SUCCESS: Test pass
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c4e5e04f57f61ff11b7b3cfd9085e5e61722f97d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 4 08:15:06 2022 -0300

    Bug 30007: Make ->anonymize methods throw an exception if AnonymousPatron is not set
    
    This patch makes the ->anonymize methods throw a
    Koha::Exceptions::SysPref::NotSet exception when trying to anonymize
    holds and checkouts without AnonymousPatron properly set.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Old/Checkouts.t \
               t/db_dependent/Koha/Old/Holds.t \
               t/db_dependent/Koha/Old/Hold.t
    => FAIL: Tests fail, no exception thrown
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    https://bugs.koha-community.org/show_bug.cgi?id=3007
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7ebeb58bfdbcbe78d23694af4af519ee804df250
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 3 16:22:49 2022 -0300

    Bug 30007: Add Koha::Exceptions::SysPref
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    https://bugs.koha-community.org/show_bug.cgi?id=3007
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8d63dd37609bbdb07768dab1be93b3259199ad3d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 4 08:14:30 2022 -0300

    Bug 30007: Regression tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    https://bugs.koha-community.org/show_bug.cgi?id=3007
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c2871214716cf35f430b6b6c6af138385f6a17d1
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Mar 1 21:04:13 2022 -1000

    Bug 29857: (QA follow-up) Fix unit test Object.t
    
    Unit test failling with :
        #   Failed test 'Exception message correct'
        #   at /kohadevbox/koha/t/db_dependent/Koha/Object.t line 335.
         #          got: 'Exception 'Koha::Exception' thrown 'Asked to embed items but its return value doesn't implement to_api'
        # '
        #     expected: 'Asked to embed items but its return value doesn't implement to_api'
         # Looks like you failed 1 test of 29.
    
    Fixed by using $@->message like in other places.
    
    prove t/db_dependent/Koha/Object.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6ece7185b03b5323c79dfcd841673d6a42750e30
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Feb 4 08:07:47 2022 +0000

    Bug 29857: (QA follow-up) Add license
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3951145cf79dfc8e3ae0609b7a282bfac9b1f3f0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 31 12:07:02 2022 -0300

    Bug 29857: Fix behavior
    
    This patch makes:
    - passed parameters be rendered alphabetically to allow testing.
    - only the defined parameters be rendered in the string
    - the method honor the fact that $self->message should be returned if
      passed to the constructor (i.e. if the developer called
    Koha::Exceptions::MyException->throw( $string ) they will expect $string
    to be rendered.
    
    To test:
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/Koha/Exceptions.t
    => FAIL: Tests fail!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c10640e8a72c60e6fd34867ac289312c0ff19705
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 31 12:06:46 2022 -0300

    Bug 29857: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2b9fae544575a4386748238212c0ca62854af30e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 31 11:02:41 2022 -0300

    Bug 29857: Rename base class as Koha::Exception
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7429f28cfc7a47a486a8ffb54473db4ed6292500
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 12 10:30:59 2022 +0100

    Bug 29857: Provide a generic full_message method for our exceptions
    
    We pass useful information when throwing exceptions, but we don't
    display them! We must display all the details we need when the exception
    is stringified.
    
    Test plan:
    
    Use the following snippet:
      use Koha::Exceptions::Elasticsearch;
      Koha::Exceptions::Elasticsearch::BadResponse->throw( type => "a good type", details => "and some details" );
    
    Execute it without and with the patch.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42096deea48a355e9b070613eb943ab75b481e86
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 12 10:31:24 2022 +0100

    Bug 29857: Make the exception classes inherit from the base class
    
    We have a base class Koha::Exceptions::Exception but it's not used in
    most of our exception classes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5daa64ca10fef9d54464ae064a2bf3ce4c32ae64
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 23 15:21:04 2022 +0100

    Bug 30164: Fix datatable wrapper when no filter passed
    
    This problem appears (at least) on the cities list view:
    If you pass a filter in the "Search cities" filter in the header, it
    won't be taken into account and all the cities will be displayed.
    
    There are two problems. First we are passing an "empty" q=[] in the
    body, the filter from the header is passed as URL parameters. We should
    not need to pass the q if it's empty.
    Then the main problem is coming from a bug in
    Koha::REST::Plugin::Query but I didn't manage to track it down. If we
    have two 2 passed, only the second one will be used. We are certainly
    using a hash somewhere we should not.
    
    This patch is fixing the bug but not on the correct side. A follow-up
    bug should take care of the main problem at lower level.
    
    Test plan:
    Hit /admin/cities.pl
    Create some cities
    Use the filter in the header of the page and submit
    => Without this patch all cities are retrieved
    => With this patch applied only the relevant cities are displayed.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit edfc82104296477816a3112c266d09f103ea1806
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Dec 21 21:36:28 2021 +0000

    Bug 29338: (follow-up) only show print button when hold is waiting or intransit
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b1bcf3920088ae57cc596aa59e81c866fd371c10
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Oct 27 21:58:44 2021 +0000

    Bug 29338: Add print hold/transfer button to request.tt
    
    1. Apply patch
    2. Make some holds, have some item level and some bib level
    3. On request.tt notice a new column on the holds_table called 'Print hold/transfer slip'
    4. Make sure the button works and takes you to the proper hold/transfer slip
    5. Make sure it works well with both item/bib level holds
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6a0d6b8bc3dadc59c409a0d3107fe890a01eec02
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Feb 22 16:28:19 2022 +0000

    Bug 30153: (QA follow-up) Fix unit tests
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 289551282da7209b5394c82c4f310c32ae084499
Author: Thomas Klausner <domm@plix.at>
Date:   Tue Feb 22 15:09:58 2022 +0100

    Bug 30153: Use uppercase AND to join query parts
    
    C4::Search->FindDuplicate joins title and author using 'and'
    (lowercase). When this query is passed on to ElasticSearch, it
    interprets the lowercase 'and' as a term to search for, because the
    operator has to be in uppercases ('AND').
    
    Test plan:
    * Reproduce the bug:
    - Set SearchEngine to ElasticSearch (and make sure you have the data
      indexed etc)
    - Find an existing book, note the title (245a) and the author (100a)
    - Create a new book (Cataloging -> New Record)
    - Fill in the same title and author using the same data as in an
      existing book (and any other fields that might be required)
    - Click "save"
    => A new book will be created, the Duplicate Finder has failed
    
    * Apply the patch
    
    * Check if it's working now:
    - Create a new book (Cataloging -> New Record)
    - Fill in the same title and author using the same data as in an
      existing book (and any other fields that might be required)
    - Click "save"
    - The DuplicateFinder should now report the already exising book
    
    Maybe we should also check if Zebra does not have any problems with the
    uppercase 'AND'? In that case, repeat the above steps, but set
    SearchEngine to Zebra :-)
    
    Sponsored-by: Steiermärkische Landesbibliothek
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a358f5b9ef5b27a809db9fc61b6c957d5db28b92
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 20 18:47:01 2021 +0000

    Bug 29287: Add child funds to display of parent funds on acqui home
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Michael Sutherland <sudrland@vt.edu>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 17ed92b6ddfcf7d61205c797389e4a5893c3dcf9
Author: David Schmidt <davewood@gmx.at>
Date:   Fri Feb 18 15:00:20 2022 +0100

    Bug 30132: Fix POD, show correct usage of Getopt::Long
    
    the USAGE of overdue_notices.pl shows options such as -date OR
    -csv that should be written with double dashes like --date or --csv
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e63783a817ee7808a58edd7fff817050cdfb9da8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 5 19:37:57 2021 +0100

    Bug 28663: Prevent discounts against void lines
    
    With the introduction of double entry accounting for VOID actions, we
    need to add an additional filter to the 'Apply discount' button appearance
    
    Test plan
    1/ Add a debt
    2/ Pay the debt
    3/ Void the payment
    4/ Confirm that with the patch applied the 'Apply discount' button does
    not appear on the 'Void' accountline.
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3de4031de1b002207963018f2f2142622a571cc9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 6 16:31:15 2021 +0000

    Bug 25025: Drag-and-drop cover image upload
    
    This patch updates the Upload local cover image page so that the user
    has the option of dragging a file from a folder on their computer
    instead of using a file upload button.
    
    The patch also adds a preview of uploaded single images and display of
    existing images on the record you're adding to.
    
    To test, apply the patch and make sure the LocalCoverImages system
    preference is enabled.
    
    - Go to Tools -> Upload local cover image and test the following
      processes:
    
    - Upload single cover image, specifying a biblionumber
      - Test dragging an image from a file on your computer
      - Test clicking the "Drop files here or click..." link.
        - You should see a preview of the image file on the screen, with
          information about the file: file name, image type, file size.
          - Click "Process images"
            - with "Existing covers will be replaced" checked
            - with "Existing covers will be replaced" unchecked
    
      When the upload process completes you should see information about the
      title in the page heading and a thumbnail of the cover in the sidebar.
      - Test that the image can be deleted from this page. You should be
        redirected back to this page with the same title still selected.
    
    - Upload a zip file of images
      - Test dragging an image from a file on your computer
      - Test clicking the "Drop files here or click..." link.
        - A zip file can't be previewed onscreen but you should see the same
          file information and a Font Awesome "zip file" icon.
          - Click "Process images"
    
    From the bibliographic detail page, click the "Images" tab, and click
    "Upload." With this workflow the field asking for a biblionumber should
    not appear.
    
    From the bibliographic detail page, in the holdings table, choose Edit
    -> Upload image. This process should be the same as above but should
    provide item information on the screen. Confirm that images are uploaded
    correctly to the specific item.
    
    Test with AllowMultipleCovers enabled and disabled to confirm that the
    "Existing covers will be replaced" checkbox is enabled only when
    multiple covers are possible.
    
    Signed-off-by: Solène Desvaux <solene.desvaux@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e33742c676c4ac8c9540a0d1f8391eecba92372b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 18 12:17:13 2019 +0000

    Bug 20689: (follow-up) Correct scope of template variables
    
    The removal of the <select>s should have been accompanied by a
    correction to the scope of tagfield and tagsubfield. It is also
    unnecessary to conditionally include the "value" attribute.
    
    To test, apply the patch and test the process for editing an item search
    field. All the correct values should appear in form fields during edit,
    and all values should save correctly.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2884573f9a717b59eeef98e185eebd7caeaa45e2
Author: Chris Cormack <chris@bigballofwax.co.nz>
Date:   Sun Apr 14 21:57:27 2019 +0000

    Bug 20689: (follow-up) Tiny typo fix
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 97d4689772442857b845a4c0fd8a8c0628ca2dfc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 12 15:46:43 2018 +0000

    Bug 20689: (follow-up) Make it possible to add capital letter subfields to item search fields
    
    This patch adds some custom validation to the MARC tag and subfield
    fields so that they are limited to alphanumeric characters.
    
    Both templates (the main view and the edit view) have been modified so
    that item_search_fields.js can be included in both.
    
    To test, apply the patch and test the form by entering a variety of
    different character combinations. The "MARC field" and "MARC subfield"
    inputs should only accept alphanumeric entries.
    
    Test both "new" and "edit" operations.
    Test other operations like delete and cancel.
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Jose-Mario <jose-mario.monteiro-santos@inLibro.com>
    Signed-off-by: Chris Cormack <chris@bigballofwax.co.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c4f7a40793593ad803c5b24b09041b668366c050
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Aug 9 22:51:43 2018 +0000

    Bug 20689: Replace marc (sub)field pull downs with input fields on item search fields config
    
    The pull down for marc subfields on the item search fields config page is
    long and hard to use. It also doesn't include the commonly used
    upper case letters for custom item subfields.
    
    Also hard to use with its 999 entries is the marc field list. It doesn't
    allow for tags like 01e, which exist in our MARC21 default framework.
    
    To test:
    - Go to Administration > Item search fields
    - Add different mappings with and without subfields
    - Verify the entered values are stored correctly
    - Edit mappings
    - Verify editing works and changes save correctly
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Mark Tompsett <mtompset@hotmail.com>
    Signed-off-by: Chris Cormack <chris@bigballofwax.co.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit eec528c3f65d8ed7f3a587e3b7a8268db71f66aa
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Mar 2 18:52:24 2022 +1300

    Bug 30084: Remove dependency of liblocale-codes-perl (follow-up)
    
    trival patch, no test plan
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4cc3c0a760df4ddd96cd7bdadc4a766343f0a103
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Feb 21 08:59:05 2022 -0300

    Bug 30133: (follow-up) Update objects.search POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit feb49d5088c48c53cd17682b7ac64fd952f466e4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 18 16:07:02 2022 -0300

    Bug 30133: Fix pagination in /biblios/:bibio_id/pickup_locations
    
    This patch does the same thing we did for items on the previous patch,
    but for biblios. The tests are almost the same as well.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/biblios.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 07893d66e8d9194bf2ed6cf90649f7e70ad9d9fa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 18 15:22:36 2022 -0300

    Bug 30133: Simplify code
    
    This patch simplifies the code, and also fixes a problem with branchcode
    comparisson failing, highlighted when running the tests
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/items.t
    => FAIL: Tests fail. Notably:
    - Link header pagination is wrong
    - X-*Total-Count headers have two values (dupicated)
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1758b586424b8e012715ec686b23f8df1835052e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 18 14:25:41 2022 +0000

    Bug 30133: Avoid calling c->objects->search twice
    
    Calling this twice sets double pagination headers, which messes up the page for the requests and
    retrieves on ly the end of the list
    
    This patch simply avoids a doulbe call
    
    TO DO: must implement same for Biblio->pickup_locations and cover with tests
    this also returns all as needing override
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 60b07917f34645ed4a243c47201c6703ab099780
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 18 15:33:42 2022 -0300

    Bug 30133: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 75ab422aada32135053e74d4b55fd7c5f7404c35
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 15 16:27:18 2021 +0000

    Bug 29703: Use get_effective_rules in GetBranchItemRule
    
    To test:
    1 - prove -v t/db_dependent/Circulation/Branch.t
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d90831f67fa0e2c65b3eb6eece426a1bd3b716a7
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Jan 7 22:31:35 2022 +0000

    Bug 29824: Allow editing of quick spine labels
    
    To test:
    1. Apply patch
    2. Go to the quick spine label tool and enter a barcode of an item with a itemcallnumber
    3. Notice the 'Edit this label' button at the bottom of the page, click it
    4. Edit the itemcallnumber in some way: add some line breaks, remove some, insert some new characters, remove some characters.
    5. You can now print the label with your edits.
    
    Note: This changes nothing in the database, if you relaod the same item/itemcallnumer it will have returned to its original form
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 01fa021943535eb0f2011882b49106671852466d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 18 15:54:56 2022 +0100

    Bug 28955: Impact News as well
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d43eea51dd9653efbf6d7cee5a6ea9bd65591b1d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Dec 15 14:36:47 2021 +0000

    Bug 28955: (follow-up) Set to fall back
    
    This patch updates the original fix to only set the template parameter
    for opac sessions and updates all occurences in templats to check first
    for logged_in_user.branchcode before falling back to default_branch
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e940c8ab02e9f6f759c31c70ca3076c9ad2376d1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 11:27:18 2021 +0100

    Bug 28955: Add OPAC_BRANCH_DEFAULT
    
    This patch adds support for OPAC_BRANCH_DEFAULT as an environment option
    that can be passed via apache with either SetEnv or as a header for
    plack.  It allows setting a default branch for the anonymous opac
    session such that you can display the right opac content blocks prior to
    login if you have set up per branch URI's.
    
    To test (on top of bug 29691)
    1 - Add to apache conf (/etc/apache2/sites-available/kohadev.conf)
        SetEnv OPAC_BRANCH_DEFAULT "CPL"
        RequestHeader add X-Koha-SetEnv "OPAC_BRANCH_DEFAULT CPL"
    2 - Restart all
    3 - Confirm that news for all and CPL show on opac mainpage
    4 - Sign in as a different library
    5 - Confirm users library news shows
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2a698d15cdbf831d55ca6193c12c524a12ef3d07
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 24 14:34:30 2022 -1000

    Bug 30060: Update DBIC Schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 109925459bde5060564dc4b68198a04f65384b97
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 24 13:36:23 2022 -1000

    Bug 30060: DBRev 21.12.00.016
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 64e679b012bfdd86a3ea879737209a0a581593ec
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Feb 15 12:17:44 2022 +0000

    Bug 30060: (follow-up) Remove duplicate prior to adding key
    
    I had issues with this update as somehow my user_permissions table
    contained duplicate rows which throws an error when adding the new
    primary key.
    
    This follow-up patch adds SQL to remove any duplicate rows prior to
    adding the new primary key.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ec3c7a85c978a31a4404dfd9fad487bc74a4434c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 27 18:34:17 2021 +0000

    Bug 30060: Add primary key to user_permissions table
    
    Without primary key DBIC is failing with something like:
    
    GET /api/v1/suggestions/managers: unhandled exception (DBIx::Class::Exception)<<DBIx::Class::ResultSource::RowParser::_resolve_collapse(): Unable to calculate a definitive collapse co
    lumn set for UserPermission (last member of the Borrower -> user_permissions chain): fetch more unique non-nullable columns at /kohadevbox/koha/Koha/Objects.pm line 394>> Koha::REST::Plugin::Exceptions::__ANON__ /
    kohadevbox/koha/Koha/REST/Plugin/Exceptions.pm (73)
    
    Test plan:
    Execute the atomic update and confirm that the new PK has been added to the user_permissions table.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c023f63abcce53d71c9492aea4bc7aa30fdc5d73
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Feb 22 16:15:11 2022 +0000

    Bug 25616: (QA follow-up) Catch a case in labels/label-item-search.pl
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2ebd429227cbf08ecd6089c3ea211bbe8c179263
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Feb 14 21:21:40 2022 -1000

    Bug 25616: (follow-up) Use uppercase in advanced search booleans
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9436d85806cbe67c5612957d5cc6e3c8c501ead4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Feb 14 21:16:16 2022 -1000

    Bug 25616: Fix t/db_dependent/Search.t
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7da4912f8ebc7b45850b835d7f452ab2de07f0e4
Author: David Gustafsson <glasklas@gmail.com>
Date:   Thu May 28 14:30:03 2020 +0200

    Bug 25616: Uppercase hard coded lower case boolean operators for Elasticsearch
    
    Uppercase occurances of all (hopefully) lowercase "and"
    used in ElasticSearch Query String Query contexts
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 116d231ec9c0c420186f6c174909948498252001
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 4 16:14:48 2021 +0000

    Bug 27627: Fix invalid HTMl in OPAC results XSLT: change spans to divs
    
    This patch modifies the XSL template for OPAC search results in order to
    improve HTML validation: Changing some <span>s to <div>s will prevent an
    error when those <span>s contain block-level elements.
    
    To test, apply the patch and restart_all if necessary.
    
    - Confirm that OPACXSLTResultsDisplay is set to "default"
    - Perform a catalog search in the OPAC.
    - Validate the page source and confirm that there are no errors about
      "Element ul not allowed as child of element span in this context"
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c98d14cef899d5d8c0a9d36b7db64ab3247fedea
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 24 12:59:57 2022 -1000

    Bug 27613: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5c0071a39f331ca89c6ebfa027b91692502b604d
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Sun Dec 12 23:27:54 2021 +0000

    Bug 27613: (follow-up) add authors and contributors
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b4ec4548ff400f7038968fcc4c40d16e235f9385
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 28 13:18:18 2021 +0000

    Bug 27613: (follow-up) Modify additional repeating entries for consistency
    
    This patch makes further changes to the detail and results XSLT in the
    OPAC so that previously pipe-separated fields are styled with CSS. The
    following tags are modified on the detail page:
    
    020 ISBN
    022 ISSN
    050 LOC classification
    060 NLM classification
    082 DDC classification
    084 Other classification
    130/240/730 Uniform titles
    246 Other title
    336 Content type
    337 Media type
    338 Carrier type
    385 Audience
    508 Production credits
    583 Action note
    586 Awards
    655 Genre/Form
    700/710/711 Contained works
    700/710/711 Related works
    770 Supplement
    772 Supplement to
    856 Online resources
    
    These are modified on the results page:
    
    028 Publisher number
    246 Other title
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    In order to better see the effect of the CSS change you can add
    something ike this to your OPACUserCSS system preference:
    
        .resource_list li::after {
            content: "♦";
        }
    
    View catalog search results and detail pages for records which contain
    repeated entries from the tag list above. The entries should be
    separated by "|" without customization, or the symbol from your
    OPACUserCSS if you specified one.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 41aa6089568a923b4c0b5042392d6f6e5c1061a3
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Feb 4 00:27:11 2021 +0000

    Bug 27613: Change pipe seperated online resource links to psuedo elements
    
    To test:
    1. Have a record with many 856 links
    2. Look at the links on both the results and detail pages.
    3. Look at the '|' and notice it is outside any HTML element, making it
       hard to remove.
    4. Apply the patch and regenerate the CSS
    5. Look at both the pages again and notice that the '|' is now a psuedo
       element.
    6. It should look identical to the way it did without the patch
    7. Switch the system pref OPACURLOpenInNewWindow to 'do' and make sure
       the the links look and function right still.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b44db939bffb720e16fa2a20e9b7b487b1b5206a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Feb 19 20:25:53 2022 +0100

    Bug 29965: (QA follow-up) Fix translation issue in moved JS code
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0492b19938bad7a93c4ce297c7380b34597959d4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 18 17:31:04 2022 +0000

    Bug 29965: (follow-up) Use a new class for the preview
    
    With previous patches everythign worked, however, clicking the heading in
    authority search results now launched the preview instead of taking you to the
    authority details
    
    This patch uses a new class to launch the modal and conditionally applies it to
    authority results as we expect different behaviours when searching from the popup
    vs authority module
    
    To test:
    1 - Repeate previous tests, confirm they pass
    2 - Search for authorities in the authority module
    3 - COnfirm clicking on heading takes you to detail page for authority
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e155dd70a6f5593679ef38145e6bad18a8690500
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 18 17:15:07 2022 +0000

    Bug 29965: (follow-up) Move repeated JS to its own file
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e3f82fe1ceedc2af246d7bf049dd2034453ed10f
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Jan 28 02:58:55 2022 +0000

    Bug 29965: Preview MARC in authority search results
    
    This enhancement makes the authority MARC preview modal available for
    the general authority search results.
    
    To test:
    1) Do a catalog search and edit a biblio record
    2) Go to one of the authority tags (i.e. 1xx, 6xx, 7xx) and open the
    authority finder plugin
    3) Do an authority search
    4) Click on one of the search result headings to open the modal. Confirm
    it opens as expected.
    5) Exit the biblio editor and go to Authorities
    6) Do an authority search
    7) Click on the Actions dropdown, then the MARC preview button,
    to open the modal. Confirm it opens as expected.
    
    Sponsored-by: Education Services Australia SCIS
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f81cd2a2b93eec65b991c4a627eb1e0f410089d1
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Feb 15 17:59:47 2022 +0000

    Bug 29845: add classes to overdrive results action buttons
    
    To test:
    1. You must have OverDrive credentials populated in the OverDrive
       system preferences
    2. Go to the Overdrive results page and make sure you are logged in.
    3. Use your browsers dev tools to look at the check-in, check-out,
       place hold, cancel hold buttons, none of them contain classes.
    4. Apply patch
    5. Repeat 3 again but this time they should all contain a class which
       makes them much easier to style.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2b1e0d2100bc3110d286ca61f826ce7440823cd0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 10 15:59:26 2022 +0000

    Bug 26975: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    https://bugs.koha-community.org/show_bug.cgi?id=26975
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 54ed859482a42f8685102bd71573b004e60a27f9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 10 15:52:16 2022 +0000

    Bug 26975: Reindent authorities editor template
    
    This patch performs general template cleanup to the authorities editor:
    Make indentation consistent, replace tabs with spaces, and trim trailing
    whitespace.
    
    To test, apply the patch and edit or create a new authority record. Test
    the functionality of the authority editor and confirm that everything
    works correctly, including JS interactions like subfield reordering, tag
    and subfield cloning, and tag and subfield deletion.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3cfdb305c4290250de0eb34304593189c02c0025
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 23 11:02:24 2022 +0100

    Bug 29844: Fix advanced editor
    
    The method Koha::Libraries->branchcode is not covered by tests!
    Trace begun at /kohadevbox/koha/Koha/Objects.pm line 572                                                                                                                                                             Koha::Objects::AUTOLOAD('Koha::Libraries=HASH(0x563bf134b810)') called at /kohadevbox/koha/svc/cataloguing/framework line 33
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5a841a8d4c36b818dd414ad544a1c58e7467f1a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 10 14:25:06 2022 +0100

    Bug 29660: Fix conflict with bug 29844
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d4855131e3b8e5852f221182ed9588f4ddc67368
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 8 15:34:28 2021 +0100

    Bug 29660: Remove biblioitem loop from request.pl
    
    It seems that hiddencount didn't work prior to this patch (to confirm)
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4bc94127dbab66376496b1ccc6fa6a3c0db929f2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 8 15:32:14 2021 +0100

    Bug 29660: Unused code in placerequest.pl
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1cf268a157b03a03d552556f2bb68c95a852d932
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 8 15:10:57 2021 +0100

    Bug 29660: Remove hostitemsflag
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8d05b9d0607669c1abf75ce853a7e7bee55af623
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 14 19:01:45 2022 +0000

    Bug 29876: (follow-up) Change "Report number" to "Report ID"
    
    This makes is consistent with the display of saved reports where the
    number is shown in an "ID" column.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0a819572bdedb7fda8ea2e8180e1788e06556f0b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 11 14:57:17 2021 +0000

    Bug 29876: Style report id in report results heading
    
    This patch makes minor changes to the template and adds some CSS to
    style the report id portion of the page heading.
    
    To test, apply the patch and go to Reports -> Saved SQL reports.
    
    - Run any report.
    - On the results page, confirm that the report id portion of the page
      heading is styled and labeled "Report number."
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e221bc52a06b9e46cdb502119411693bfa5affe9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 11 19:56:42 2022 +0000

    Bug 30085: Move IndependentBranches check sooner
    
    This doesn't rely on the other statuses, and requires only cached
    preference check, so lets allow the possibiliy of an early exit
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f44e797c76ea2339b8ff2e4f10721e5c283a14e4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 11 19:49:49 2022 +0000

    Bug 30085: Consolidate querycoutn code and only check if needed
    
    Similar to first patch, move a count only conditionally used into
    the conditional
    
    This could be updated to use DBIC, but the itemtype conditionals
    add complexity
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aa7bffc1a3f2fa3b75b0cb5b089dc9dfa713624d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 11 19:39:33 2022 +0000

    Bug 30085: Don't fetch ReservesControlBranch twice
    
    We essentially copy the code from GetReservesControlBranch here, because we
    also calculate 'branchfield'
    
    Setting it to "" vs undef makes no difference in this code, so lets not fetch this
    again later.
    
    Rename the variable to make it clearer where the branchcode came from
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5efaed428e41f7ef87c1c6bd7ca97c8962626e72
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Feb 11 19:21:22 2022 +0000

    Bug 30085: Reduce scope of holds count / today holds count
    
    We retrieve two counts that are only needed if rules for hold limits are defined.
    The DB counts should only be fetched once the rules are confirmed to exist
    
    Further improvement would be possiblke by allowing them to be passed in (or cached?)
    from CanBookBeReserved as they rely only on patron/biblionumber and not item specific information
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 96c05acaf6cddf2b17936f4032ada60af92a8262
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Feb 15 14:53:02 2022 +0000

    Bug 29760: (follow-up) Fix class name
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 05ce32175a53edf65745d34b26dae7e80a6c23e5
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Jan 12 16:12:37 2022 +0000

    Bug 29760: Add patron category column to view_holdsqueue.tt
    
    To test:
    1. Have some holds and build the holds queue.
    2. Go to view_holdsqueue.tt, there is no patron category column
    3. Apply patch
    4. Look again, there should now be a column for 'Patron category'
       showing both the caterory name and the category code.
    5. Make sure you can sort and filter by this new column
    6. Go to table settings and make sure you can properly hide this column
       and all other columns in the Holds queue.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f8ca2d733c786c72ce74e11459872a73658f3e3e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 21 12:59:40 2022 +0100

    Bug 30129: Add test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e30efbd0bd0bb6cfbca245ae0a160d27111a570c
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Fri Feb 18 13:42:34 2022 +0200

    Bug 30129: remove the third required date that was causing 500 error
    
    This problem appeared because of this commit:
    Bug 14435 Add the ability to store result's report
    cf9031711282f4be23e4a639797d0fd178940e1f
    
    This patch fixes it by removing the third $date that wasn't removed
    back then.
    
    To reproduce:
    1) Head over to Reports page.
    2) Search for report by date. It should cause 500 error.
    3) Apply the patch.
    4) Repeat the search again, it should be working now.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 30c7dd1866138c226284949b1f6bc75ff019c466
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 09:49:44 2022 +0100

    Bug 29962: (bug 27526 follow-up): Fix columns button on item list
    
    The "Columns" button on the item list view has been broken (hidden) by
    bug 27526.
    "column_name" was removed from the item_header_loop:
    -    if ( $kohafield && $kohafield =~ /items.(.+)/ ) {
    -        $header_value{column_name} = $1;
    -    }
    
    We can still access the attribute name using 'attribute' however.
    The difference is that non-mapped subfield will have an "attribute", but
    there is a net to prevent a crash in columns_settings.inc:
     12         var named_id = $( 'thead th[data-colname="' + this.columnname + '"]', selector ).index( selector + ' th' );
     13         var used_id = dt_parameters.bKohaColumnsUseNames ? named_id : counter;
     14         if ( used_id == -1 ) return;
    
    We should simply pass attribute.
    
    Test plan:
    Create a non-mapped subfield (952$k)
    Edit an item, add a value for k
    On the item table at the top of the edit form notice that the "Columns"
    button is back and that it's working correctly.
    Note that 'k' cannot be hidden (may be considered as a bug, but it's not
    a regression).
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7f4bd35a856bb7714e71efa5e6c0a7788046e436
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 12:29:11 2022 +0100

    Bug 29803: Do not wait for the images more than 5 seconds
    
    In case of the previous bug, the page was calling the callback function
    every 100ms, endlessly. We should add a test to prevent future similar
    problem.
    
    Test plan:
    Remove the previous patch "Prevent local cover image to be hidden if
    Coce is enabled"
    Recreate the test plan
    => You should see the local image displayed after 5 seconds, and a
    log in the JS console
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1513cd66b68b83614712c9f22947c03eec98d296
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 12:19:54 2022 +0100

    Bug 29803: Prevent local cover image to be hidden if Coce is enabled
    
    If Coce is enabled by no image are returned by the service, then no
    other image will be displayed (actually un-hidden)
    
    The getURL is returning early if no image is returned by the service and
    the "done" flag is never set.
    
    Test plan:
    Add a local cover image to a bibliographic record (ktd biblionumber=14
    is good)
    Set CoceHost = http://coce.bywatersolutions.com
    Select all CoceProviders
    Enable OpacCoce
    
    => If no image is returned by Coce then the local image should be
    displayed anyway
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 450b629ed3554d893830414be8d2c6c9a96ea69f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 15:04:49 2022 +0100

    Bug 29969: Prevent crash if 'Update holds' clicked after bulk cancellation
    
    If you cancel holds in bulk, the list is not updated as we enqueued the
    task. But the "Update hold(s)" button will explode if clicked.
    
    Test plan:
    Place several holds on a bib record
    Use the "Cancel selected" link to cancel holds in bulk
    The job is enqueued and the hold list still show the holds you cancelled
    Click "Update holds"
    => Without this patch you get an ugly 500
    Can't call method "found" on an undefined value at /kohadevbox/koha/C4/Reserves.pm line 1060
    => With this patch applied the table is refresh, no crash (and there is
    a warning in the log, that may not be necessary)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5433de09c8b5b51a96d1b364c31a16d66f062b76
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Feb 1 11:55:23 2022 +0000

    Bug 29989: Improve headings in MARC staging template
    
    This patch updates the MARC staging page so that the headings are
    descriptive based on the context.
    
    To test, apply the patch and go to Tools -> Stage MARC for import.
    
    - The heading should be "Stage MARC records for import."
    - Upload a MARC file and stage the file for import.
    - The heading on the next page should read "MARC staging results."
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1bfcb995554c61adc56391b07c0eb4d9d3a5fdba
Author: Kevin Carnes <kevin.carnes@ub.lu.se>
Date:   Tue Feb 8 14:35:18 2022 +0100

    Bug 27770: ES: Deprecated aggregation order key [_term] used, replaced by [_key]
    
    Starting in Elasticsearch 6.0 _key should be used instead of _term to order
    buckets by their term
    
    To test:
    1) Run prove t/db_dependent/Koha/SearchEngine/Elasticsearch/Search.t
    2) If you observe an error about types, apply patch for bug 25669
    3) Run prove t/db_dependent/Koha/SearchEngine/Elasticsearch/Search.t
    4) Observe if you get a deprecation warning about order key
    5) Apply patch
    6) Run prove t/db_dependent/Koha/SearchEngine/Elasticsearch/Search.t
    7) Observe no deprecation warning about order key
    8) Sign off
    
    Sponsored-by: Lund University Library
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 10e657e8b7e59364ea04a3bd31f6ac771bf2dddc
Author: Philippe Blouin <blou@inlibro.com>
Date:   Tue Feb 15 16:18:15 2022 -0500

    Bug 30115: Uninitialized value warning in C4/Output.pm
    
    Use of uninitialized value $url_suffix in concatenation (.) or string at GIT/C4/Output.pm line 180.
    Use of uninitialized value $url_suffix in concatenation (.) or string at GIT/C4/Output.pm line 197.
    Use of uninitialized value $url_suffix in concatenation (.) or string at GIT/C4/Output.pm line 211.
    
    This is in pagination_bar sub.  A lot of pages call it.  For me it
    happened with any Authority search (authorities/authorities-home.pl)
    producing multiple results.
    
    Simple fix is initializing the variable.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 91c48e27ecd68b0a543cb5902908054fae3e088c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 18 11:01:55 2022 +0100

    Bug 29625: Add test for get_all_biblios_iterator
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 73bb8bbee957378b25bc7ce5300ae030f0ecb643
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 2 12:21:45 2021 -1000

    Bug 29625: Fix var name in Koha::BiblioUtils get_all_biblios_iterator
    
    In Koha::BiblioUtils, get_all_biblios_iterator method is a class level method like get_from_biblionumber.
    So its first arg should be named $class instead of $self.
    Even if this var in not used.
    
    Test plan :
    1) Run Elasticsearch full rebuild with and without patch
    2) Check all biblio records are in index
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8d1248db4f19683dba80f6ae4bcba561768fb730
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 18 12:29:19 2021 +0000

    Bug 22671: Show warning if browser doesn't support applicationCache
    
    This patch adds a check for browser support for the "applicationCache"
    feature required by the offline circulation tool. If the feature is not
    available, a message is shown to the user that offline circulation is
    disabled.
    
    To test, apply the patch and enable the AllowOfflineCirculation system
    preference.
    
    In a browser which supports applicationCache (Firefox < 81, Chrome < 94,
    Safari <= 15), go to Circulation -> Built-in offline circulation
    interface.
    
    - You should see the standard Offline Circulation menu options: Check
      out, check in, syncrhonize, etc.
    - Click "Synchronize," then "Download records."
    - The process should complete correctly, updating the "last synced"
      information on the page.
    
    Follow the same steps in a browser which has dropped support for
    applicationCache. As soon as you reach the built-in offline circulation
    page you should see a message, "Your browser is not compatible..."
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit be18ee7aa517f647ecb83fe1349af8c88f3e15f8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jan 11 19:40:35 2022 -1000

    Bug 29853: Add HTML filter before KohaSpan filter
    
    Usage of Template Toolkit plugin KohaSpan as filter is actually :
      Group [% added.title | $KohaSpan class = 'name' | $raw %] created.
    
    But KohaSpan filter does not escape HTML characters.
    Whe should filter HTML then KohaSpan.
    
    This patch adds TT html filter before KohaSpan.
    Also replaces in Javascript html() with text()
    to ensure special caracters are still encoded.
    See https://api.jquery.com/text/
    
    Test plan :
    1) Create a library with name Libra&apos;rie
    2) Create a library group with name Grou&apos;pe
    3) Play with this group
    4) Add library
    5) Remove library
    6) Edit group
    7) Delete group
    8) Each time check that &apos, is not interpreted as single quote
    
    Signed-off-by: Solène Desvaux <solene.desvaux@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2d9aec24d6edad514435f8f754ee3ddcd248a2d8
Author: Alex Buckley <alexbuckley@catalyst.net.nz>
Date:   Mon Dec 13 02:31:51 2021 +0000

    Bug 29761: Prevent batch patron modification to process several time the same patron
    
    If a cardnumber, SMS number, or borrower number is inputted multiple times then the batch patron
    modification page should not display that patron multiple times.
    
    Test plan:
    1. Create three text files that list card numbers, SMS numbers, and borrower numbers for three patrons. Example lists are below, notice in each there is one number duplicated:
    
    Card numbers:
      23529000035676
      23529000651225
      23529000080862
      23529000035676
    
    Borrower numbers:
      19
      49
      7
      49
    
    SMS numbers:
      2125551212
      2125551212
      2125551213
      2125551214
    
    2. Enable sending of SMS messages:
    * Set SMSSendDriver system preference to Email
    
    3. Make sure the cardnumbers, borrower numbers, and SMS numbers listed
    above belong to patrons in your Koha
    
    4. Go to Tools > Batch patron modification
    
    5. Upload lists of cardnumbers, SMS numbers, and borrower numbers above, and confirm the following is happening in the batch patron modification page:
    - Upload the text file of cardnumbers. Notice one patron is displayed twice
    - Paste in the list of cardnumbers. Notice one patron is displayed twice
    - Upload the text file of SMS numbers. Notice one patron is displayed twice
    - Paste in the list of SMS numbers. Notice one patron is displayed twice
    - Upload the text file of borrower numbers. Notice one patron is displayed twice
    - Paste in the list of borrower numbers. Notice one patron is displayed twice
    
    6. Apply patch and restart services
    
    7. Repeat step 5 and this time observe that the patron record is not duplicated in the batch patron modification page
    
    Sponsored-By: Catalyst IT
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    JD Amended patch: adjust commit title
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 78a9de0cd6a60e746e53ed9120f669d6ed3625cc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Feb 10 15:28:11 2022 +0100

    Bug 30074: Add missing extended_attributes rs in DBIC schema
    
    REST API route /patrons has extended_attributes available (x-koha-embed) but it's actually not working.
    
    GET /api/v1/patrons: unhandled exception (Koha::Exceptions::BadParameter)<<Cannot find Koha::Object class for extended_attributes>> Koha::REST::Plugin::Exceptions::__ANON__ /kohadevbo
    x/koha/Koha/REST/Plugin/Exceptions.pm (73)
    
    It's missing the relationship named "extended_attributes".
    
    Test plan:
    Create a new patron attribute CODE and a value for a patron
    
    Hit /api/v1/patrons?q={"extended_attributes.type":"CODE"}
    
    Also:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Tests fail, boooo
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2ae8d149d3341e7d880051ffed3903fab6262a69
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 16 11:50:40 2022 -0300

    Bug 30074: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit feee248de491c42c07f42fe3f60ce3e98fb1e81b
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Jan 4 22:44:32 2022 +0000

    Bug 29795: add empty value for branchcode on self-reg form
    
    1. Set branch code as a PatronSelfRegistrationBorrowerMandatoryField
    2. Go to the self reg form and look at the Home library field, it defaults to the first choice alphabetically
    3. Fill out the other required fields and the captcha. Don't change the branchcode value.
    4. Submit the form, it submits.
    5. If branchcode is required it should default to an empty value and force the user to make a choice.
    6. Apply patch
    7. Repeat 1-3
    8. Now you cannot submit the form unless you choose a branchcode
    9. Make sure it still works normally when branchcode is not in PatronSelfRegistrationBorrowerMandatoryField
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit af22b87965774290cc56b6946460f2cedf68a239
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Feb 14 10:35:53 2022 -1000

    Bug 30099: Fix error when accessing circulation.pl without patron parameter
    
    If I access circulation.pl directly, with no patron cardnumber or borrowernumber submitted, I get an error:
    Can't call method "messages" on an undefined value at /kohadevbox/koha/circ/circulation.pl line 525
    
    This is caused by Bug 29230 which calls $patron outside a
    "if ($aptron)".
    
    Test plan :
    1) In staff interface, click in 'check out' search box
    2) Hit enter (without a search text)
    => Without patch you get an error
    => With patch you see a blank page /cgi-bin/koha/circ/circulation.pl
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0c155dd7b7370f2248fc7e3f56da43e8f2a37e18
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Dec 13 09:59:15 2021 +0000

    Bug 23873: Enable capture groups in MarcModificationTemplates
    
    This patch adds support for regular expression capture groups in
    MarcModificationTemplates.
    
    We escape double quotes in the replacement string, then quote the whole
    string before applying the `ee` modifier to the final regex application.
    
    See
    https://blog.james.rcpt.to/2010/10/25/perl-search-and-replace-using-variables/
    for further details.
    
    Test plan
    1) Attempt to use capture groups in your regular expression based
       MarcModificationTemplate and note it does not work.
    2) Apply the patch and try again, this time the capture group should
       yield the expected results.
    3) Run t/SimpleMARC.t and confirm the tests still pass.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 502a2b54830ce20e9cfb8e2bfc28b7933c69e35f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Dec 13 10:20:54 2021 +0000

    Bug 23873: Unit tests
    
    This patch adds a unit test for capture groups support in
    Koha::SimpleMARC.
    
    Test plan
    1) Run the test prior to applying the capture groups fix, note it fails.
    2) Apply teh capture groups fix patch
    3) Run the test again, it should now pass
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dfa2f4b436a00b4d857328615e2e4d01779478ce
Author: Mason James <mtj@kohaaloha.com>
Date:   Tue May 25 09:21:53 2021 +1200

    Bug 30084: Remove explicit dependency of liblocale-codes-perl
    
    1/ apply patch
    
    2/ build and install new koha-common package
    
    => Package liblocale-codes-perl is not installed, Koha does not need it
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Mason James <mtj@kohaaloha.com>
    
    JD amended patch: fix commit message
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e1274d4689b0e9dbe9cd285599e19c5dfeab252e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 15 08:42:49 2022 +0100

    Bug 30089: (bug 29844 follow-up) Fix placing holds - OPAC
    
    The method Koha::AuthorisedValues->authorised_value is not covered by tests!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c72b5d80c9f33018e46e6e4464209c755ed156d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 15 08:45:42 2022 +0100

    Bug 30104: (bug 29844 follow-up): Fix holds to pull
    
    There was an error when circ/pendingreserves.pl was hit:
    The method Koha::Items->biblionumber is not covered by tests!
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 542833e01273677c9781ebdc379131148abc9e6d
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Feb 14 11:04:25 2022 -1000

    Bug 30090: Don't export some columns in patron search results
    
    The checkout and Edit buttons should not export (Exel, Print) on the patron search result list.
    Same for fist column with checkboxes.
    
    Test plan :
    1) Go to patrons module /cgi-bin/koha/members/members-home.pl
    2) Perform a search with results
    3) Click on 'Export' then 'Print'
    => Check you dont see column with checkboxes (text 'Select patron') and colum with actions
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5e452a1173252c3f485f00f9cb320e4c72b3b52b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Feb 16 20:56:58 2022 -1000

    Bug 29603: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 915815ddae7a69e549e0114eddd2be6a44f1486b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 27 15:29:32 2022 +0000

    Bug 29603: Fix responsive behavior of facets menu in OPAC search results
    
    The OPAC was originally featured a search results facets box that would
    collapse at narrower browser widths and show a "Refine your search" link
    under the breadcrumbs menu. At some point this broke, with the "Refine
    your search" link appearing at the bottom instead.
    
    This patch revises the page to restore the previous behavior.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Perform catalog search in the OPAC which will return multiple results.
    - View the page at various browser widths. At narrower widths the facets
      menu should appear as a "collapsed" box with a "Refine your search"
      link.
    - Clicking the link should toggle the facets menu visibility.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 36b378ebabb9b149155c5839605f0a92d07002f4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 11 12:36:21 2022 +0000

    Bug 29960: (follow-up) Include enquire.js in print slip template
    
    This patch adds enquire.js to the print slip template in order to
    prevent a JS error.
    
    Also removed is a line from global.js which was added in the previous
    patch and which was an unwanted change.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ca6431e252b18a94f889d666485b381f54e4ae71
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 30 15:06:05 2021 +0000

    Bug 29960: Remove Modernizr dependency in the OPAC
    
    This patch refactors the code around JavaScript-driven responsive
    behavior in the OPAC. The use of Modernizr dropped and the dependency
    removed.
    
    This patch also adds a missing listing for Enquire.js licensing on the
    "About" page.
    
    To test, apply the patch and perform a catalog search in the OPAC.
    
    - Narrow your browser window until its width falls below 609 pixels
      (Using your browser's Responsive Design Mode is helpful for this, e.g.
      https://developer.mozilla.org/en-US/docs/Tools/Responsive_Design_Mode)
    - The window should automatically scroll to the "main content" area, in
      this case the section headed by "Your search returned..."
    
    - Change your browser window's width until it falls below 768 pixels.
    - Scroll to the bottom of the search results where you should find the
      "Refine your search" facets box collapsed.
    - As you increase your browser width above 768 pixels the facets box
      should expand.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 985c32398fd3d450337a3f986b071b6993c21a93
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 11 12:36:21 2022 +0000

    Bug 29960: (follow-up) Include enquire.js in print slip template
    
    This patch adds enquire.js to the print slip template in order to
    prevent a JS error.
    
    Also removed is a line from global.js which was added in the previous
    patch and which was an unwanted change.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6596f768172cd01921744d877b0c4e5be200e75e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 30 15:06:05 2021 +0000

    Bug 29960: Remove Modernizr dependency in the OPAC
    
    This patch refactors the code around JavaScript-driven responsive
    behavior in the OPAC. The use of Modernizr dropped and the dependency
    removed.
    
    This patch also adds a missing listing for Enquire.js licensing on the
    "About" page.
    
    To test, apply the patch and perform a catalog search in the OPAC.
    
    - Narrow your browser window until its width falls below 609 pixels
      (Using your browser's Responsive Design Mode is helpful for this, e.g.
      https://developer.mozilla.org/en-US/docs/Tools/Responsive_Design_Mode)
    - The window should automatically scroll to the "main content" area, in
      this case the section headed by "Your search returned..."
    
    - Change your browser window's width until it falls below 768 pixels.
    - Scroll to the bottom of the search results where you should find the
      "Refine your search" facets box collapsed.
    - As you increase your browser width above 768 pixels the facets box
      should expand.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 05f3c879a0e0b41e53c7e4e54e0f9168337aa401
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Dec 2 01:36:26 2021 +0000

    Bug 29617: exclude categorycode from BorrowerUnwantedField
    
    To test:
    1. Go to BorrowerUnwantedField and select categorycode as unwanted
    2. Try adding a new patron, you will see an error message in the staff client "Something went wrong when creating the patron. Check the logs." You will be unable to make a new patron.
    3. Apply patch
    4. Go to BorrowerUnwantedField, you are unable to exlcude it. Patrons need categorycodes
    
    Signed-off-by: Emmanuel Bétemps <e.betemps@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 742e14a97b8ede220b8aeba34b2f064b245353a2
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Fri Feb 11 13:07:40 2022 +0000

    Bug 30081: Use itemtype description instead of itemtype code
    
    To test:
    1. Use same plan as previous patch, but observe full item type description
       instead of item type code
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a925cb8ba41976a545c8fdf8f42d7b361e95ebb5
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Fri Feb 11 12:53:55 2022 +0000

    Bug 30081: Add item type column to holds table
    
    Add new column item type to holds table in patron's details and check
    out views. Some libraries will find this information useful for
    distinguishing inter library holds from normal holds.
    
    To test:
    1. Apply patch
    2. Place a hold and confirm it
    3. Go to cgi-bin/koha/circ/circulation.pl?borrowernumber=1 with
       borrowernumber being the id of your patron
    4. Click "1 Hold(s)" tab
    5. Observe new column "Item type"
    6. Confirm the item type is correct
    7. Go to moremember.pl?borrowernumber=1 with
       borrowernumber being the id of your patron
    8. Repeat steps 4-6
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit adb11b866bea087c6745cff946a7c4ba763d3083
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Feb 11 15:24:43 2022 +0000

    Bug 30082: Bibliographic details tab missing when user can't add local cover image
    
    This patch corrects the template logic which determines whether the
    "Images" tab should be displayed on the bibliographic detail page. The
    "Images" tab should display whenever local cover images are enabled, not
    just if the user has permission to manage cover images.
    
    To test, apply the patch and go to Administration -> System preferences.
    
    - Enable the LocalCoverImages system preference.
    - Locate and view the detail page for a bibliographic record in the
      catalog which doesn't have a local cover image attached.
    
      - If you are logged in as a user with upload_local_cover_images
        permission you should see an "Images" tab with the message "No
        images have been uploaded for this bibliographic record yet" and an
        upload button.
      - If you are logged in as a user without upload_local_cover_images
        permission you should see an "Images" tab with just the "No
        images..." message.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bafd7cff70016d869e0bb7bc4048d5a45b0ccac2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jan 17 13:38:28 2022 +0000

    Bug 29781: Enable capture groups in batch item modification
    
    This patch adds support for regular expression capture groups in
    MarcModificationTemplates.
    
    We escape double quotes in the replacement string, then quote the whole
    string before applying the `ee` modifier to the final regex
    application.
    
    See https://blog.james.rcpt.to/2010/10/25/perl-search-and-replace-using-variables/
    for further details.
    
    Test plan
    1) Attempt to use capture groups in your regular expression based
       batch item modification and note it does not work.
    2) Apply the patch and try again, this time the capture group
       should yield the expected results.
    3) Run t/SimpleMARC.t and confirm the tests still pass.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jo Hunter <jhunter@clicweb.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1516514f1ac8a8775582712b432d274cc975e65f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jan 17 13:50:34 2022 +0000

    Bug 29781: Unit test
    
    This patch adds a unit test for capture groups support in Koha::Items
    
    Test plan
    1) Run the test prior to applying the capture groups fix, note it fails.
    2) Apply the capture groups fix patch
    3) Run the test again, it should now pass
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jo Hunter <jhunter@clicweb.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0a91f3c70069e623788d4fe693b46f4922f5de5d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 27 11:50:28 2022 +0000

    Bug 29952: Replace obsolete DataTable column filter function
    
    The "Filter paid transactions" link on the Accounting -> Transactions
    page is broken because it uses an obsolete DataTables function for
    filtering. This patch updates it to use the current syntax, available in
    DataTables since version 1.10.
    
    To test, apply the patch and locate a patron in the staff interface who
    has multiple fines, some paid.
    
    - View the patron's "Accounting" page and click the "Transactions" tab.
    - Click the "Filter paid transactions" link. The table should be
      filtered so that only transactions with an outstanding amount > zero
      are shown.
    - The filter link should change to read "Show all transactions."
    - Clicking "Show all transactions" should clear the filter.
    - Test with one or more columns hidden using the "Columns" control.
      Filtering should still work correctly with columns hidden.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5be6968f2e75438efae2bc67f07f1bb4ea2e853a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Feb 8 12:30:23 2022 +0000

    Bug 29706: (follow-up) Adjust code to work for multi-holds
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f2c206f622b6f2edc0db11019e9598bd67ed67a8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 16 01:59:50 2021 +0000

    Bug 29706: Hide items that cannot be held by default when placing hold on OPAC
    
    This patch adds a 'holdable' and 'unholdable' class to the rows of the table
    
    Additionally I rename the 'backgroundcolor' field to 'onloan' as that is what it contains.
    Note: Out of the box, there is no css associated with this class
    
    I add a div around the table to allow hiding the new buttons as well when optiuons are hidden
    
    It would be nice in the future to utilise a Koha table here, however, it is complicated by multi-holds
    
    To test:
     1 - Add a number of items to a record, ensuring they belong to different libraries
     2 - Set 'Default checkout, hold and return policy'->'Hold policy' to 'From home library'
     3 - Sign in to opac and attempt to placehold on the record
     4 - Click 'show more options' and 'a specificitem'
     5 - Note holds table includes items that cannot be held
     6 - Apply patch
     7 - Reload holds page
     8 - Note items that cannot be heldare hidden
     9 - Click 'Show unholdable items' and note they appear
    10 - Click 'Hide unholdable items' and veriofy they hide
    11 - Test with multi holds
    
    Signed-off-by: The Minh Luong <the-minh.luong@inlibro.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9b0888de88105d58549642c47f425aaa25526aa0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Dec 16 01:12:52 2021 +0000

    Bug 29706: Improve table elements
    
    This patch add a thead and tbody element to the 'copiesrow' table
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 35f35c629f593a787fc9cf4d35fd432327fccef5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 1 17:47:51 2021 +0000

    Bug 29616: Replace library information popup in the OPAC with a modal
    
    This patch modifies the OPAC bibliographic detail page so that
    information stored in libraries' "OPAC info" field can be displayed in a
    modal window instead of in a tooltip. This will make it more readable,
    especially for libraries with so much info content that the popup can
    disappear off the bottom of the page.
    
    To test, apply the patch and make sure you have at least one library
    configured according to each of these:
    
    A. One with both branches.branchurl and branches.opac_info
    B. One with branches.branchurl but not branches.opac_info
    C. One with branches.opac_info but not branches.branchurl
    D. One with neither branches.branchurl nor branches.opac_info
    
    View the bibliographic detail page in the OPAC for title(s) which have
    holdings from the libraries you configured above. In the holdings table,
    check the behavior of the library name in the "Current library" or "Home
    library" columns *
    
    - Case A: The library name appears as a link with an "info" icon.
      Clicking it shows the library information in a modal window. In the
      modal footer, a "Visit web site" button should take you to the correct
      URL.
    - Case B: The library name appears as a link without an icon. Clicking
      the link takes you to the correct URL.
    - Case C: The library name appears as a link with an "info" icon.
      Clicking it shows the library information in a modal window. In the
      modal footer there is no "Visit web site" button.
    - Case D: The library name is plain text.
    
    * Display of "Current library" and/or "Home library" is controlled by
      the OpacLocationBranchToDisplay system preference.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: The Minh Luong <the-minh.luong@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fc3e532897c26430ba08fb9ac886ff132b98d1cb
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Fri Dec 3 10:13:12 2021 -0500

    Bug 29634: Map biblio.medium to 245 by default (MARC21)
    
    This patch adds a mapping from 245 to biblio.medium.
    
    To test:
    1) Apply patch
    2) Delete existing frameworks
       -  In the database
          delete from marc_tag_structure;
          delete from marc_subfield_structure;
          delete from biblio_framework;
    3) Load default framework
       - In a terminal, run
         ./misc/load_yaml.pl -f installer/data/mysql/en/marcflavour/marc21/mandatory/marc21_framework_DEFAULT.yml --load
    4) In the staff interface, go to Administration > MARC bibliographic framework
       - Make sure the default framework is there
    5) In Administration > Koha to MARC mapping, check the mappings for biblio.medium
       - biblio.medium should be mapped to 245
    6) Create a bibliographic record with a value in 245
       - In the database, check the biblio entry for this record, the value from 245 should be in medium
    
    I hope I didn't forget anything! :)
    
    Caroline
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3b1b78955f21ca181c63cfd5c2f8d7fba06cdeef
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Thu Dec 2 17:46:39 2021 -0500

    Bug 29626: Map biblioitems.place to 264 by default (MARC21)
    
    This patch adds a mapping from 264 to biblioitems.place.
    
    To test:
    1) Apply patch
    2) Delete existing frameworks
       -  In the database
          delete from marc_tag_structure;
          delete from marc_subfield_structure;
          delete from biblio_framework;
    3) Load default framework
       - In a terminal, run
         ./misc/load_yaml.pl -f installer/data/mysql/en/marcflavour/marc21/mandatory/marc21_framework_DEFAULT.yml --load
    4) In the staff interface, go to Administration > MARC bibliographic framework
       - Make sure the default framework is there
    5) In Administration > Koha to MARC mapping, check the mappings for biblioitems.place
       - biblioitems.place should be mapped to 260 as well as 264
    6) Create a bibliographic record with a value in 264
       - In the database, check the biblioitems entry for this record, the value from 264 should be in place
    7) Create a bibliographic record with a value un 260
       - In the database, check the biblioitems entry for this record, the value from 260 should be in place
    
    I hope I didn't forget anything! :)
    
    Caroline
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3bd46890754764ab51c0be25e9224460491a63fc
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Thu Dec 2 17:54:31 2021 -0500

    Bug 29627: Map biblioitems.publishercode to 264 by default (MARC21)
    
    This patch adds a mapping from 264 to biblioitems.publishercode.
    
    To test:
    1) Apply patch
    2) Delete existing frameworks
       -  In the database
          delete from marc_tag_structure;
          delete from marc_subfield_structure;
          delete from biblio_framework;
    3) Load default framework
       - In a terminal, run
         ./misc/load_yaml.pl -f installer/data/mysql/en/marcflavour/marc21/mandatory/marc21_framework_DEFAULT.yml --load
    4) In the staff interface, go to Administration > MARC bibliographic framework
       - Make sure the default framework is there
    5) In Administration > Koha to MARC mapping, check the mappings for biblioitems.publishercode
       - biblioitems.publishercode should be mapped to 260 as well as 264
    6) Create a bibliographic record with a value in 264
       - In the database, check the biblioitems entry for this record, the value from 264 should be in publishercode
    7) Create a bibliographic record with a value un 260
       - In the database, check the biblioitems entry for this record, the value from 260 should be in publishercode
    
    I hope I didn't forget anything! :)
    
    Caroline
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 20bcd599d30e8c8ac94ceefa608cf502ae5e7c4d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 13:52:45 2021 +0100

    Bug 29385: Catch register_id for payments against fees
    
    This patch refactors the pay method in SIP FeePayment such that we
    consistently pass parameters to both invocations of Koha::Account->pay.
    
    It ensure the missing cash_register definition is passed when a set of
    account lines to pay is defined.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dc077ccef591fbc7a509130b4f0e680f7cca0a89
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Feb 14 10:07:44 2022 -1000

    Bug 30101: Fix OPAC advanced search after Bug 29844
    
    Bug 29844 forgot to add as_list to opac-search.pl.
    You can see it changed search.pl
    
    Patch fixes and also adds explicit interface = opac in get_search_groups() call.
    Since intranet is explicit, opac should also be.
    We keep opac as default value.
    
    Test plan :
    1) Create a libary group for OPAC and one for staff
    2) Go to OPAC advanced search page
    3) Check you see the OPAC libary group
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3d7e4f6c8cc77f1b12c903205171cffeb3afccbc
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 15 22:06:44 2022 -1000

    Bug 26704: (follow-up) Fix t/db_dependent/Koha/Items.t
    
    Note this patch also fixes wrong text in test line 1295
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 744c0d237de87d0b1ee9091a5f60d3bde38a3396
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 15 23:17:11 2022 -1000

    Revert "Bug 29579: Show saved SQL report ID in database query"
    
    This reverts commit 39ec12fc48919a92a3ec12b4c766605556a9b0c3.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 39ec12fc48919a92a3ec12b4c766605556a9b0c3
Author: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
Date:   Fri Nov 26 11:54:52 2021 +0200

    Bug 29579: Show saved SQL report ID in database query
    
    When trying to figure out which saved SQL report caused too much load,
    it's useful to have the report id show in the mysql process list.
    
    This patch adds the saved SQL ID number as a comment line in front
    of the SQL before passing it to the database.
    
    To test:
    1) Run a saved report that takes long enough time, so you can:
    2) Connect to the database with your preferred client, and use
       "show processlist;" to list all the running mysql processes.
    3) The running saved SQL report should show up with
       "-- saved_sql.id=123" in the process info field.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 908ad2cd129676e469ed7ade46709704092c9ac3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 8 17:35:27 2022 +0100

    Bug 29570: Simplify for loop
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3d7757654b829c500a5e404c2d45d91a73cef3a3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 2 17:10:36 2022 -0300

    Bug 29570: Enable sorting orders by summary
    
    This patch enables (on receiving) sorting orders by the summary column.
    It needs the previous patches to work. Title is given more precedence as
    expressed by users on the bug report. Which, by the way, makes sense.
    
    To test:
    1. Create a basket
    2. Create orders
    3. Close basket
    4. Receive shipment
    5. Enter invoice information
    => SUCCESS: You should see your pending orders
    => FAIL: Verify the 'Summary' column is not sortable
    7. Apply this patches
    8. Restart Plack
    9. Reload the page
    => SUCCESS: Can sort by the summary column
    10. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1e8ead9727bf2832dd5589e0f45b55f5ee46fa32
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 2 17:04:08 2022 -0300

    Bug 29570: Fix sorting orders by biblioitems columns
    
    The API representation of Koha::Biblio objects includes the
    biblioitems.* columns too. This proved problematic as queries had to get
    translated so they work (i.e. if a query passes q={"biblio.ean":"123%"}
    then the query needs to be tweaked so biblio.ean is translated into
    biblio.biblioitem.ean. This is solved, locally, in the controller.
    
    But sorting needs the same kind of tweak, and it was missing. This patch
    solves that by doing a similar conversion.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/acquisitions_orders.t
    => FAIL: Tests fail, searching on a 'biblioitems' column generates a 500
    error.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! We can sort on those fields
    5. Sign off :-D
    
    Note: you will notice the tests only cover sorting by ISBN. I consider
    it enough as sorting is a DB problem, and we only want to know if the
    generated ORDER BY is valid for the underlying query, and MySQL would
    complain if it wasn't the case.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 696bd24dfeaf177648e9b8dc7c4d54284ce225ce
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 2 16:29:00 2022 -0300

    Bug 29570: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1f746a585e5ffc121ede2c36a6fbb00506e31562
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 17 16:07:40 2021 +0000

    Bug 29519: Allow resolution of claims return at checkin
    
    Add a 'Resolve' button in the alert dialogue that is displayed when a
    lost item with a return claim is checked in. The button will trigger the
    usual resolution modal allowing the user to pick their resolution.
    
    This patch splits the resolution modal out of checkouts.js and
    checkouts-table.inc so it can be used outside of the checkouts table.
    We then reload it, optionally based upon the presence of the claims
    preference, where needed.  This has the added benefit that it saves a
    little bit of page load data in cases where the feature is not enabled.
    
    Test plan
    1. As we alter the file locations of the resolution handling code we
       need to test that normal claims functionality continue to work as
       expected.
    2. Test the new functoinality by checking in an item that has been
       claimed as returned (but not yet resolved). The dialogue box should
       now contain a 'resolve' button next to each claimant and clicking
       upon it should trigger the resolution modal where the librarian can
       subsequently pick the resolution and submit it.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2d19bfb0522c16edb7d018a98746e2fd9c5ce7af
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Nov 16 08:35:22 2021 +0000

    Bug 29515: Make title for HTML customizations optional
    
    This adds code to make the title field for HTML customizations optional
    while it stays mandatory for news entries.
    
    1) Add a new HTML customization, verify you are forced to enter a title
    2) Apply patch
    3) Repeat and verify that you can now save without title
    4) Add a new news entry
    5) Verify that the title field remained mandatory there.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 327be4a704e0ad5ad480ab618920c82d591c79ee
Author: The Minh Luong <the-minh.luong@inlibro.com>
Date:   Tue Feb 1 14:44:06 2022 -0500

    Bug 28576: Update the maximum size of an image.
    
    This patch modifies the maximum size of a patron's image, from 500KB to
    2MB. Also, in Home/Patrons/anyPatron, when you try to add an image to a
    patron, you can now see the supported file types AND the maximum size.
    
    The following places are affected by this patch:
    - Home/Patrons/anyPatron
    - Home/Tools/Upload patron images
    - Home/Tools/Patron card creator/Images
    
    To test:
    1)Search for any patron and go to his page.
    2)Hover over the image area on the left and click on the "Add" button.
    3)Notice that the message above the choose file button only specifies
    file types without the maximum size.
    4)Add an image bigger than 500KB.
    5)Nothing happens. (This is because the maximum size is 5KB)
    6)Apply the patch.
    7)Repeat steps from 1 to 3.
    8)Notice that the message now includes the maximum size.
    9)Add an image bigger than 500KB, but smaller than 2MB.
    10)The image is succesfully uploaded.
    11)Add an image bigger than 2MB.
    12)Nothing happens. (The maximum size is now 2MB)
    13)Repeat the steps 9 to 12 in "Home/Tools/Upload patron images" and
    "Home/Tools/Patron card creator/Images".
    14)Notice that the maximum size is updated.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 55c8bf114e18d67595bdf83944ae393128637bf1
Author: Salman Ali <salman.ali@inLibro.com>
Date:   Wed Jun 16 13:20:24 2021 -0400

    Bug 28576: Add patron image in patron detail section does not specify image size limit
    
    When you try to add an image to a patron in Home/Patrons/anyPatron, it only states the file types that are supported but not the maximum size. If you try to add an image that is bigger than 500 kb, nothing happens and the reason is not presented.
    
    This is not the case with the 2 other places where we can add patron images in which they give warnings:
    Home/Tools/Upload patron images
    Home/Tools/Patron card creator/Images
    
    For now, i simply added the size limit to the file supported message.
    
    To test:
    1)Search for any patron and go to his page
    2)Hover over the image area on the left and click on add
    3)Notice the message above the choose file button only specifies file types not size.
    4)Add an image bigger than 500 kb
    5)Nothing happens
    6)Apply patch
    7)Repeat steps from 1 to 3
    8)Notice the message now includes the maximum size
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c7045254e11d640e6358bf0f78c1b5116ee1b00f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 8 19:03:47 2022 +0100

    Bug 28405: Add author for multi holds view
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7ebe70c70fbede3c97daf1bb82a258f74f1af4d6
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Jan 20 22:06:56 2022 +0000

    Bug 28405: add author name to request.tt when it exists
    
    To test:
    1. Place a hold and observe request.tt
    2. No author name
    3. Apply patch
    4. Reload request.tt
    5. Author name should appear on the same line as the title.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: George Williams <george@nekls.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5aee0f6a2a06fedcfdabd34c1757a7a1455a6fcd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Feb 11 10:32:04 2022 +0000

    Bug 26704: (follow-up) Rebase for bug 29785
    
    Update newly introduced calls from '->messages' to '->object_messages'
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 649d6d2eb265d1fac172d4b2da69dfeccfb54fb3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 29 15:18:21 2021 -0300

    Bug 26704: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 68d566e60b84249753d14ca7d3a1c0b0c3436ba8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 19 14:51:57 2021 +0000

    Bug 26704: Update Koha::Item to use Koha::Object::Messages
    
    Use the newly introduced Koha::Object::Messages system to pass
    additional information provided by object methods internally in the
    objects themselves.
    
    This patch updates the existing bespoke passing scheme to something
    we've formally agreed to adopt going forward.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4a2befa3c75d01ffc9327824583f0eb8d039ab62
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 19 19:50:01 2020 +0000

    Bug 26257: Move translatable strings out of subscription-add.tt and into subscription-add.js
    
    This patch removes the definition of translatable strings out of
    templates and into the corresponding JavaScript file, using the new JS
    i81n function.
    
    To test:
    
    - Apply the patch and go to Serials -> New subscription
    - Click "Next" without filling out any fields. You should get two
      confirmations, "If you wish to claim late or missing issues you must
      link this subscription to a vendor. Click OK to ignore or Cancel to
      return and enter a vendor" and "You must choose or create a
      bibliographic record."
    - Manually enter a vendor number which doesn't exist and click "Next."
      Error: "The vendor does not exist."
    - Manually enter a record number which doesn't exist and click "Next."
      Error: "Bibliographic record does not exist!"
    - Select a valid vendor and bibliographic record and proceed to the next
      page.
    - Click "Test prediction pattern" without filling in any fields. Error:
      "Cannot test prediction pattern for the following reason(s): Frequency
      is not defined. - First publication date is not defined"
    - Click "Save subscription" without filling in any information. Error:
      "You must choose a first publication date."
    - Fill in a date and click "Save subscription." Error: "You must choose
      a subscription length or an end date."
    - Enter a frequency and subscription start date and click "Save
      subscription." Error: "Please click on 'Test prediction pattern'
      before saving subscription."
    - Click "Show advanced pattern" and then "Save subscription." Error:
      "You have modified the advanced prediction pattern. Please save your
      work or cancel modifications."
    
    Testing numbering patterns:
    
    - There are several strings related to setting and editing numbering
      patterns but I don't think they can be tested live while Bug 28012 is
      unfixed.
    
    Testing Mana integration:
    
    - To test Mana integration you must have Mana enabled, and a
      bibliographic record in your catalog which has an ISSN
      matching a record in Mana. You can go to "Search on Mana"
      from the Serials sidebar menu to locate a working record.
    - Add a subscription using the bibliographic record which will match a
      record in Mana. When you click "Next" you should see a message at the
      top of the page saying, "Searching for subscription in Mana Knowledge
      Base"
    - After a moment this message should be replaced with "Subscription
      found on Mana Knowledge Base: Show Mana results"
    - Clicking the "Show Mana results" should trigger a modal window with
      the heading "Results from Mana Knowledge Base."
    
    - Test the subscription add process using a bibliographic record which
      doesn't match anything in Mana. The message at the top of the page
      should read, "No subscription found on Mana Knowledge Base"
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/subscription-add.js for translation,
      e.g.:
    
      msgid "Next issue publication date is not defined"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client
      and repeat the test plan above. The translated strings should
      appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bc548c0d0b88677e52ff611e32a1b94f57a911a0
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 9 15:50:21 2021 +0100

    Bug 24630: (follow-up 2) call number when singleBranchMode=1
    
    singleBranchMode=1 is when there is only one library (branch).
    
    Test disply of available item.
    Patch allows display of call number like in regular mode
    
    Signed-off-by: Florian Bontemps <florian.bontemps@biblibre.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 77e504ae5d9b34ecadce9a6a262272b897f83a12
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 9 15:39:40 2021 +0100

    Bug 24630: (follow-up 1) fix indenting
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d62a675468e1fc11a0d18c7fa35bf819c0a79a8c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Feb 11 14:06:07 2020 +0000

    Bug 24630: UNIMARC XSLT changes for bug 7611
    
    Follow test plan from 7611 on a UNIMARC system.
    
    These changes have not been tested by me
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 65cc721e9f90fea4d0eb3d2b85831b60f3046ce6
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Feb 7 11:37:15 2022 -0500

    Bug 29779: Fix unit tests count
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 189663ee0894e994e367ff7c0f26a684f3630cd6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 10:24:15 2022 +0100

    Bug 29859: Fix currencies display
    
    Oops!
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0ee23d67c9ca61ca2d2f31b27a39c021d3d7aade
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 09:15:34 2022 +0100

    Bug 29859: (follow-up) Use iterator instead of as_list
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 72c69eb4c54631f1ea0aa88ebff9e2188fb0475a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Feb 11 08:54:27 2022 +0100

    Bug 29844: Fix selenium/administration_tasks.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5520b8fb84f26419c6ec9f73a14cdf14f036afce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 31 16:39:59 2022 +0100

    Bug 29458: Fix selenium test
    
    The authentication.t selenium tests (and a couple of others) were
    failing with:
    Error while executing command: element not interactable: Element <input class="btn btn-primary" type="submit"> could not be scrolled into view at /usr/local/share/perl/5.32.1/Selenium/Remote/Driver.pm line 411. at /usr/local/share/perl/5.32.1/Selenium/Remote/Driver.pm line 356.
    
    We changed the other of the form, and t::lib::Selenium::submit_form was
    not getting the correct (first) form. The one from the auth modal was
    retrieved and submit button was clicked. Selenium raised an error as it
    is not displayed.
    The ->is_displayed selenium method does not work, as per the doc
    """
    Note: This does *not* tell you an element's 'visibility' property; as it still takes up space in the DOM and is therefore considered 'displayed'.
    """
    https://metacpan.org/pod/Selenium::Remote::WebElement#is_displayed
    
    "The internet" is saying we should be able to use the following in our
    xpath expression: not(ancestor::div[contains(@style,'display:none')]
    but it actually only works if the display:none rule is defined on the
    node (not from .css). Which does not work for us.
    
    The only solution I found is to check for the size of the element, which
    is (0,0) if not effectively displayed.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b8038cfe33752053a78aaba3694471f0341a64fc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 09:54:33 2022 -0300

    Bug 29874: Remove unused method C4::SIP::ILS::Item::fill_reserve
    
    This patch removes the unused method.
    
    Likely a leftover from ancient ages. AddIssue already fills the hold and
    is called in the Checkout.pm library.
    
    To test:
    1. Run:
       $ git grep fill_reserve
    => FAIL: Notice it is only mentioned in the line that defines it
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Removed.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b1842ffb58ecbdd0b8e3ab787faf6e17116820ac
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Feb 10 14:18:16 2022 -1000

    Bug 29277: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 049aa2ceeac1fe1b275c956304b2f750e4fe51dc
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 21 12:45:45 2022 +0000

    Bug 29277: Replace the use of jQueryUI tabs on item circulation alerts page
    
    This patch replaces jQueryUI tabs on the item circulation alerts page as
    a simple example to start the process of switching how we implement
    tabbed interfaces.
    
    The patch bumps the Bootstrap version from 3.3.7 to 3.4.1 and adds the
    tabs component.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Administration -> Item circulation alerts.
    - Confirm that the "Checkout" and "Check-in" tabs look correct and work
      correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2a3d0fa7626452cb18b54e18dad6de0611d9bb93
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 1 16:38:15 2022 +0100

    Bug 29832: Use KohaTable
    
    NoSort is defined in KohaTable
    
    Also add noExport
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b3a0f559dd419ed236257eccc9ce14b291a09c1f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 10 12:28:40 2022 +0000

    Bug 29832: Make library column in desk list sortable
    
    This patch makes minor updates to the DataTable configuration on the
    Circulation Desks Administration page. Redundant options are removed and
    existing options are updated to use current DataTables syntax.
    
    To test, apply the patch and make sure that the UseCirculationDesks
    system preference is enabled.
    
    - Go to Administration -> Circulation desks.
    - Add multiple circulation desks if necessary, at multiple libraries.
    - The "Desk" column should be sorted by default, and the "Actions"
      column should not be sortable.
    - The "Library" column should be sortable.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a444eeac016139a125c7a39de6dc738c4024424e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 3 14:48:44 2021 -0300

    Bug 29397: Use kohaSelect for pickup locations
    
    This patch makes the pickup location dropdowns that rely on Select2 and
    the API use the new wrapper. The original transport function is removed
    as it is now embedded in the wrapper.
    
    To test:
    1. Follow bug 29404 test plan
    => SUCCESS: All works
    2. Apply this patches
    3. Repeat 1
    => SUCCESS: All works!
    4. sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 437e6b1267a0c9121bf9488b98ba9df5b11063c5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 3 14:46:53 2021 -0300

    Bug 29397: Add function documentation
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 499c7a0a8d35b060c7e320b17d46b4e6ab991e14
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jan 13 12:33:34 2022 +0000

    Bug 7374: Add remote image option for authorized values
    
    This patch adds the option of using a remote image for an authorized
    value, just as you can with item types.
    
    To test, apply the patch and go to Administration -> Authorized values.
    
    - Click "CCODE" to view the collection authorized values.
    - Edit a collection code.
    - In the form, under "Choose an icon," there should now be a "Remote
      image" tab.
    - Enter a remote image url, e.g. https://via.placeholder.com/50/FF0000/FFFFFF.png
    - Click "Save."
    - After the page redirects to the list of collection codes you should
      see your image in the table next to the code you edited.
    - Test that you can still edit a collection to set "No image" or to
      use one of the local image sets.
    - Test that remote images can also be added when adding a new
      collection.
    
    - Make sure "ccode" is in the "AdvancedSearchTypes" sytem preference.
    - Go to the catalog's advanced search page and click the "Collection"
      tab.
    - You should see your collection image in the list of collections.
    - Perform the same check in the OPAC.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    JD amended patch: fix indentation
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 715e3323e143186fc261da01c2ab909ec5d6d095
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 12 19:05:02 2022 +0000

    Bug 29867: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fb1213a3964103163ee5a37dbec21b200ddbe021
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 12 18:44:28 2022 +0000

    Bug 29867: Reindent authorized values administration template
    
    This patch performs general template cleanup to authorized values
    administration: Make indentation consistent, replace tabs with spaces,
    and trim trailing whitespace.
    
    To test, apply the patch and go to Administration -> Authorized values.
    Test that all functionality works correctly:
    
     - Adding or deleting categories
     - Adding, editing, and deleting authorized values.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4eec44630254928b69aa5b67a27935d23fa04807
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Feb 4 15:46:15 2022 -0300

    Bug 29984: Remove unused method Koha::Patrons->anonymise_issue_history
    
    The method is no longer used, and replaced by
    Koha::Old::Checkouts->anonymize.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patrons.t
    => SUCCESS: Tests still pass
    3. Run:
       $ git grep anonymise_issue_history
    => SUCCESS: The code doesn't mention it
    4. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9e2432bc633ad70a9df9d24ec44c2bcbccbdb9cc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 11:44:07 2022 -0300

    Bug 29843: Use in opac/opac-privacy.pl
    
    This patch makes the opac/opac-privacy.pl OPAC page use the new
    anonymize method.
    
    To test:
    1. Have some checked-in materiales
    2. Have OPACPrivacy enabled
    3. Notice your checkouts history contains what you expect
    4. Go to 'your privacy'
    5. Click on 'Delete checkout history'
    => SUCCESS: It works, no crash.
    6. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit daff241b1da95f51780c02fe54557c64e1aac284
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 12:14:11 2022 -0300

    Bug 29843: Use in tools/cleanborrowers.pl
    
    This patch makes tools/cleanborrowers.pl use the new methods.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d976d65f62eb47eebb766c66c0922205043ffa05
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 11:32:15 2022 -0300

    Bug 29843: Use in batch_anonymise.pl
    
    This patch makes the batch_anonymise.pl cronjob script use the newly
    introduced methods instead of the old ones.
    
    To test:
    1. Try the tool
    => SUCCESS: No behavior change
    2. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 91e76a5a2690a110b7a239a44a594aca02795e31
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 11:23:10 2022 -0300

    Bug 29843: Add ->anonymize and ->filter_by_anonymizable to Koha::Old::Checkouts
    
    This patch implements high-level methods for:
    
    * Filtering a Koha::Old::Checkouts resultset so only anonymizable rows
      are left
    * Anonymizing the rows in a resultset
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Old/Checkouts.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7287edae77922ebb71e9fb6029acdd3a51fca3d2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 11:22:52 2022 -0300

    Bug 29843: Unit tests
    
    This patch adds unit tests for the introduced methods.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c1aa03f29d60de9f527a04995e9dc05715d958ee
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Jan 3 23:02:23 2022 +0000

    Bug 29526: (follow-up) change wording on opac-holdshistory.tt when table is empty
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 093193d3a3852eddc0e9474a360c1027eb4e7006
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Jan 3 18:07:14 2022 +0000

    Bug 29526: (follow-up) Put delete buttons in HTML table
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7f13f49ff9f2129a133470b3585d74a040df6650
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 3 11:53:32 2022 -0300

    Bug 29526: Add a way for patrons to delete their hold history
    
    The same way we have a button to immediately delete the checkouts history in the OPAC, we should have a similar option for the holds history.
    
    This patch implements that.
    
    To test:
    1. Have a patron with some old checkouts and old holds.
    2. Have OPACPrivacy, OPACHoldsHistory and opacreadinghistory enabled.
    3. Notice in the OPAC the patron has some old checkouts and holds.
    4. Use the Privacy tab to clean checkouts
    => SUCCESS: They are still cleaned as before this patch
    5. Try to clean the old holds
    => SUCCESS: They are cleaned!
    6. Add some old checkouts and holds
    7. Use the new 'All' button
    => SUCCESS: All cleaned
    8. Sign off :-D
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4c2f4a302e78e253dcf8e47cdbbc8d8fe8c287e1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 14:40:04 2022 -0300

    Bug 29525: Make Koha::Hold->fill anonymize if required
    
    This patch makes filling a hold anonymize it on the same call, if
    settings require it (i.e. if borrowers.privacy is set to 2).
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => SUCCESS: The code actually does what it is meant to
    3. Try on the UI, notice it gets anonymized if the patron has privacy == always/2.
    4. Sign off :-D
    
    Note: AnonymousPatron should be set. Otherwise it would set NULL. But
    that's fine, that's what Koha does already.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2f3926965f846f507f233dc552fb032301d35536
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 12 16:32:24 2022 -0300

    Bug 29525: Make Koha::Hold->cancel anonymize if required
    
    This patch makes cancelling a hold anonymize it on the same call, if
    settings require it (i.e. if borrowers.privacy is set to 2).
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => SUCCESS: The code actually does what it is meant to
    3. Try on the UI, cancelling a hold, noticing it gets anonymized if the
       patron has privacy == always/2.
    4. Sign off :-D
    
    Note: AnonymousPatron should be set. Otherwise it would set NULL. But
    that's fine, that's what Koha does already.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c96977ede271ac91e9d2d28f1cdd30787ab35585
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 3 15:15:15 2022 -0300

    Bug 29525: (follow-up) Adapt OPAC text to mention holds
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2952550c8773611b117935197ee642be84aef3c3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 3 15:08:27 2022 -0300

    Bug 29525: Make batch_anonymise.pl deal with holds
    
    This patch makes the batch_anonymise.pl script handle holds too. It does
    so by leveraging on the newly introduced method 'filter_by_anonymizable'
    and also 'anonymize'.
    
    To test:
    1. Have a patron with two past holds.
    2. Make sure they are a few days back:
       $ koha-mysql kohadev
       > UPDATE old_reserves SET timestamp=ADDDATE(NOW(), INTERVAL -4 DAY);
    3. Run:
       $ kshell
      k$ perl misc/cronjobs/batch_anonymise.pl --days 2 -v
    => SUCCESS: You see something like:
    Checkouts and holds before 2022-01-01 will be anonymised.
    0 checkouts anonymised.
    2 holds anonymised.
    4. Repeat 3
    => SUCCESS: They are already anonymized. You see
    Checkouts and holds before 2022-01-01 will be anonymised.
    0 checkouts anonymised.
    0 holds anonymised.
    5. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 67a48726b76b296a35707ceac3b2c32e880fc7db
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 3 15:06:23 2022 -0300

    Bug 29525: Add Koha::Old::Holds->filter_by_anonymizable
    
    This patch adds the 'filter_by_anonymizable' method, and tests for it. A
    new DBIC relationship is added as well to the OldReserve schema file.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ t/db_dependent/Koha/Old/Holds.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c8c6655bdeffa9426165e6a513f5a7b61e441a9a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 12 16:24:35 2022 -0300

    Bug 29868: Add Koha::Old::Hold->anonymize
    
    This patch introduces a new method in Koha::Old::Hold. The method is
    fully covered by tests.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Old/Hold.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6c7fdc38cef8b4c13831f1b93fd4796abfca7c73
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jan 14 12:11:42 2022 -0500

    Bug 29869: (QA follow-up) import t::lib::Mocks for Hold.t for mock_preference
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42bf7c613765bc50417eb01de07abd553ade18da
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 10:04:02 2022 -0300

    Bug 29869: Teach log viewer about FILL
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f245e49287933964f3f253758a037fb5cfe7467e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 09:45:12 2022 -0300

    Bug 29869: Remove C4::Reserves::ModReserveFill
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c82b607498c7825e28cde3ee97594403fcebe762
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 09:08:11 2022 -0300

    Bug 29869: Make ModReserveFill a (temporary) wrapper for Koha::Hold->fill
    
    Before diving into removing ModReserveFill, I propose this:
    
    In order to perform real-life testing of the new Koha::Hold->fill
    method, this patch makes the ModReserveFill method, just call the new
    one.
    
    To test:
    1. Apply this patchset
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold* \
               t/db_dependent/Hold* \
               t/db_dependent/api/v1/holds.t \
               t/db_dependent/Reserves* \
               t/db_dependent/Circulation* \
               t/db_dependent/SIP/*
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bbb30495ee90109f20cde25634b38dad4072db7c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 09:03:20 2022 -0300

    Bug 29869: Add Koha::Hold->fill
    
    This patch introduces a new method for marking a hold as filled. The
    code is the result of tracking the following methods in C4::Reserves:
    - ModReserveFill
    - GetReserveFee
    - ChargeReserveFee
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 00beba6e5fe3811cc83491e9c8ac141a156a0c0d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 13 09:03:04 2022 -0300

    Bug 29869: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 49e6e6c07a9cba3c20ce189901fe06c2be03c508
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 3 10:36:55 2022 -0300

    Bug 29780: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e654a1b1009b6ff88570f9944d23d39933a1b0f6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 3 10:37:09 2022 -0300

    Bug 29780: Add Koha::Old::Holds->anonymize
    
    This patch adds a handy method for anonymizing a Koha::Old::Holds
    resultset. It is planned to be used on bug 29526.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Old/Holds.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 34c405d6fe32cd7d803ff7b6ee66ccea3c458327
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 7 16:00:52 2022 +0000

    Bug 20894: Add barcode size parameters to /svc/barcode
    
    This patch adds a couple of new parameters to the barcode generator
    service: "modulesize," which controls the size of QRcodes*, and
    "height," which can be applied to all other barcode types.
    
    * The "modulesize" number refers to the pixel dimensions of each black
    and white square in the generated QRcode. The dimensions in "squares" of
    the QR code depends on how much data is being encoded.
    
    For QRcodes, one default parameters is used: An error-correction level
    of "M" (Medium, https://en.wikipedia.org/wiki/QR_code#Error_correction).
    
    To test, apply the patch and restart services. Test various settings to
    confirm that barcodes are displayed correctly:
    
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=QRcode&modulesize=3&barcode=https%3A%2F%2Fkoha-community.org
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=QRcode&modulesize=6&barcode=https%3A%2F%2Fkoha-community.org
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=Code39&height=50&barcode=32000000203734
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=Code39&height=20&barcode=32000000203734
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=COOP2of5&height=50&barcode=32000000203734
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=IATA2of5&height=50&barcode=32000000203734
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=Industrial2of5&height=50&barcode=32000000203734
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=ITF&height=50&barcode=32000000203734
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=Matrix2of5&height=50&barcode=32000000203734
    http://127.0.0.1:8081/cgi-bin/koha/svc/barcode?type=NW7&height=50&barcode=32000000203734
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7fdf948f20818cc85e1aed7ddd3a328d817eb335
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jan 30 13:16:12 2022 +0000

    Bug 29767: (QA follow-up) Make singular/plural forms consistent
    
    Just fixes some strings to match with the other runtime
    parameters in their singular and plural forms.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=29796
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5ce1048cba8c601434ed409f26d0d335365469ae
Author: Jérémy Breuillard <jeremy.breuillard@biblibre.com>
Date:   Wed Dec 22 11:42:07 2021 +0100

    Bug 29767: SQL Koha reports and variable of database table << name|table_name>>
    
    'Insert runtime parameter' has now more options for the SQL reports : 'cash register', 'debit types' and 'credit types'
    
    Test plan:
    1)Home > Reports > Create from SQL
    2)Click on 'Insert runtime parameter' and notice the current options
    3)Apply patch and repeat 2)
    4)New parameters are now available
    5)A simple SQL request to try 'credit_types' option : SELECT * FROM account_credit_types WHERE code = <<Credit types|credit_types>>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=29796
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b78395d8fec361fcc336864bd2482cce7b0aeacd
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Feb 9 21:03:19 2022 -1000

    Bug 28993: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c51a1d726ba813ab0801766188a765718e589ccf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 12 16:29:27 2022 +0000

    Bug 28993: Switch magnifying glass in staff detail pages to FA icon
    
    This patch modifies the staff interface's bibliographic detail XSL so
    that a Font Awesome is used instead of a magnifying glass image when
    listing authority subject headings.
    
    The patch also corrects two other places where the image is used so that
    the image can be removed. Some markup from authorities.detail.tt is
    removed because it appears to be unused (a copy and paste from
    catalogue/detail.tt).
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - To view the changes to the staff interface bibliographic detail page,
      locate a record which has at least one subject heading which is linked
      to a subject authority record.
    - The subject heading link should be followed by a magifying glass
      (Font Awesome) icon which links to the authority record's detail page.
    - View a similar change to the MARC detail page for the record. Confirm
      that the subject headings are followed by a link to the authority
      detail page.
    - Follow the authority search link to locate and view an authority
      record. The information on the authority detail page should be
      correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4bfdad20c685570942748cfaec17e03bb5bb871f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 18 18:47:32 2021 +0000

    Bug 27904: Improve display in creating profile for staging MARC records for import
    
    This patch updates the Stage MARC records for import page, in particular
    the format of the part of the form for saving or removing a profile.
    
    The page moves these controls into their own fieldset so that it is
    clear they are separate from the "Stage for import" button. The "Remove"
    control now includes the name of the profile which will be removed.
    
    To test, apply the patch and go to Tools -> Stage MARC for import.
    
     - Upload a file of records.
     - Make some changes to the settings and options.
     - At the bottom of the form you should see a "Save profile" fieldset.
     - Confirm that the "Save profile" button becomes enabled if you type
       something in the field (or paste something, or select something from
       form history).
     - Confirm that the profile is saved correctly by re-uploading a MARC
       file and selecting your newly added/edited profile and confirming
       that  the values are set as expected.
     - In the "Save profile" section there should be a "Remove" link styled
       with a Bootstrap "trash" icon: "Remove profile: <profile_name>"
     - Confirm that profile deletion still works correctly.
     - Confirm that the "Remove" link is updated correctly when you make a
       selection from the "Profile" dropdown at the top of the form:
       - Choosing "Do not use profile" should change the "Remove" link to
         drop the name of the profile and disable the link.
       - Choosing different profiles should update the name in the "Remove"
         link.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f14e527d5f8adcfd92d886c02501ce1216fc7ce7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Feb 7 08:58:43 2022 -0300

    Bug 29754: (QA follow-up) Minor tests tweaks
    
    This patch does two things:
    
    - Wraps the new SIP tests in a single transaction. We do that to avoid
      sub-test interference, specially when test files get big. The provided
      tests are correct and don't require previous tests data.
    - Migrated from the introduced 'diag' calls to 'note', as I just learned
      they are the same, but 'note' is only displayed when in verbose mode.
      Which is great to avoid unnecessary noise in Jenkins.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f55e73800925811326cef78ab6936918e94e616c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 22 15:25:44 2021 +0000

    Bug 29754: Don't include patron when fetching guarantees fines
    
    This patch removes the flag to fetch the patrons own debts as we have already
    calculated them
    
    This test plan highlights another issue - the value of NoIssuesChargeGuarantorsWithGuarantees
    is not checked in SIP code - we merely get the total owed including guarantees and compares to
    noissuescharge
    See bug 29755
    
    To test:
     1 - Apply first patch only
     2 - prove t/db_dependent/SIP/Patron.t
     3 - It fails
     4 - Enable NoIssuesChargeGuarantorsWithGuarantees, you can set to 1
     5 - Create/find a patron
     6 - Add a $10 charge to parons account
     7 - Add a guarantee to patron
     8 - Add a $5 charge to guarantee
     9 - Set noissuescharge to 15.01
    10 - perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 -l CPL -m patron_information --patron BARCODE
    11 - Note the 64 message starts with Y's that mean patron is blocked
    12 - Patron shouldn't be blocked as under 15.01
    13 - Apply patch
    14 - Restart all
    15 - repeat 10
    16 - Patron is no longer blocked
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4757f0ed525546f1f4ec85f8a7ee10f2adb7fead
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 22 15:20:16 2021 +0000

    Bug 29754: Unit test
    
    This adds a unit test to the SIP code
    
    It also adds some spacing and dividers to make the tests for 'relationships_debt' easier to read
    
    To test:
    prove -v t/db_dependent/Koha/Patron.t - passes and is readable
    prove -v t/db_dependent/SIP/Patron.t - fails
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7ea17a24221a6936540be2149d240ecd70a853af
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 28 09:59:15 2022 +0000

    Bug 29966: Dont pass authnotrequired true and flags together
    
    Test plan:
    Logout in OPAC.
    Goto sco help page.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fcf3ce3b73ae74b1fc02d79f10486e3ccd4458d4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 09:57:38 2021 +0200

    Bug 29230: Add Koha::Patron->messages
    
    Add methods to return the messages attached to a patron.
    
    It will add the capability to access them from notice templates.
    
    Test plan:
    Define some messages for a given patron
    Go to the circulation page of the patron and confirm that they are still
    displayed
    
    Test the notice templates:
    Add to HOLD_SLIP the following content
    """
    [% SET messages = borrower.messages %]
    [% IF messages.count %]
    Messages:
    <ul>
      [% FOR m IN messages.search( message_type => 'L' ) %]
        <li>[% m.message %]</li>
      [% END %]
    </ul>
    [% END %]
    """
    
    To display all the messages from staff ('L')
    
    Adapt following your needs.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Stina Hallin <stina.hallin@ub.lu.se>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 049a6bf0dc01ed5666d25ac97207a3581781c178
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 4 14:28:26 2022 +0100

    Bug 29785: Rename Koha::Object->message with ->object_messages
    
    It will conflict with other ->messages methods, it's too generic.
    
    Bug 29230 needs Koha::Patron->messages to return Koha::Patron::Messages for instance.
    
    Test plan:
    Confirm that the tests modified by this patch still pass
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 82a66155fbd0ee5627c9f9b0ea9b02f31f646af2
Author: Michael Hafen <michael.hafen@washk12.org>
Date:   Fri Jan 14 11:35:05 2022 -0700

    Bug 28977: Fix cat_issues_top.pl report with strict SQL modes
    
    To get the 'Most circulated items' report to run in ONLY_FULL_GROUP_BY
    Sql mode.
    
    Test plan:
    
    Turn on strict_sql_modes ( make sure <strict_sql_modes> is 1 in KOHA_CONF )
    Go to Reports -> Most circulated items
    submit the form.
    
    Without the patch you get an error like:
    CGI::Compile::ROOT::usr_local_koha_master_reports_cat_issues_top_2epl::calculate(): DBI Exception: DBD::mysql::st execute failed: Expression #4 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'koha_main_v4.items.itemcallnumber' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by [for Statement "SELECT DISTINCT biblio.title, COUNT(biblio.biblionumber) AS `RANK`, biblio.biblionumber AS ID, itemcallnumber as CALLNUM, ccode as CCODE, location as LOC FROM `old_issues`
                      LEFT JOIN items USING(itemnumber)
                      LEFT JOIN biblio USING(biblionumber)
                      LEFT JOIN biblioitems USING(biblionumber)
                      LEFT JOIN borrowers USING(borrowernumber)
                      WHERE 1 AND old_issues.issuedate > '2020-08-03' AND old_issues.issuedate < '2021-05-17' AND old_issues.returndate > '2020-08-27' AND old_issues.returndate < '2021-06-01' AND old_issues.branchcode like '403' AND items.itype like 'F' AND ccode like 'FIC' AND borrowers.categorycode like 'ST' group by biblio.biblionumber order by `RANK` DESC"] at /usr/local/koha_master/reports/cat_issues_top.pl line 67
     at /usr/share/perl5/DBIx/Class/Exception.pm line 77
    
    With the patch you will see the report results view.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    JD Amended patch - adjust commit's title
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5903ae2bca5f1936d427dba701596a14f674094c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Feb 9 15:17:39 2022 -1000

    Bug 11873: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5bb8e376574c6aacb42a051dcdd6875b3dbf583a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Feb 9 15:16:32 2022 -1000

    Bug 11873: (QA follow-up) Add missing TT filters
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 026b36dff5e49e9f80fef5e48394c73ec34d5931
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 27 11:10:34 2022 +0100

    Bug 11873: Remove decoration on current authority
    
    Previously the current authority was not styled like a link. It was
    useful to have a visual feedback knowing which authority is currently
    displayed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b3e472090d778142ec2e85590852f803244294df
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 10 15:42:08 2021 +0000

    Bug 11873: Upgrade jstree jQuery plugin to the latest version
    
    This patch upgrades the jstree plugin in the OPAC and the staff
    interface. The old version had compatibility issues with the latest
    jQuery.
    
    Also changed: When viewing an authority record in the OPAC's MARC view,
    clicking one of the hierarchy links should now open the MARC view again
    rather than reverting to the normal view.
    
    To test, apply the patch and rebuild the staff interface and OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    To test you must have the AuthDisplayHierarchy system preference
    enabled, and you must have some authorities data which can be displayed
    as a hierarchy. From the test plan for Bug 8523:
    
    "Create authority records with a hierarchy of see also fields (in
     MARC21/NORMARC, you'll be using 5xx fields for this, with a subfield
     $w = 'g' for broader terms and subfield $w = 'h' for narrower terms)"
    
    - Perform an authority search in the OPAC which will return one of your
      modified authority records.
    - View the record.
    - There should be an expanded tree menu at the top of the authority
      information.
      - Clicking the arrows in the tree should correctly expand
        and collapse the nodes.
      - Clicking the authority record link in the node should load that
        record.
    - Test also from the OPAC's MARC view of the authority record.
      - Confirm that clicking an authority record link in the MARC view
        opens the corresponding record in MARC view again.
    
    - Perform the same tests in the staff interface.
    
    Signed-off-by: Eugene Espinoza <eugenegf@yahoo.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7a7d503faa993690657374da0ab420c5834178b7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 21 13:05:40 2022 +0000

    Bug 29932: Use localStorage instead of cookie for bibs_selected
    
    This patch replaces the use of the jquery.cookie.js plugin in the
    "Browse selected records" feature. The feature is modified to use
    localStorage instead of cookies.
    
    To test, apply the patch and go to Administration -> System preferences.
    
     - Enable the "BrowseResultSelection" system preference.
     - Perform a catalog search which will return multiple results.
     - On the search results page, check the checkbox for a number of
       titles.
     - Click the "Browse selected biblios" button in the toolbar.
     - You should be directed to the detail page for the first title you
       checked.
     - Clicking the right-arrow in the sidebar should take you
       through each one of your selected titles.
     - When you click the "Results" link in the sidebar you should be
       returned to the same search results set and the same titles should be
       checked.
     _ If you uncheck those titles and reload the page the checkboxes should
       remain unchecked.
     - If you log out of the staff interface the "bibs_selected" item in
       localStorage should be deleted. See, for example,
       https://developer.mozilla.org/en-US/docs/Tools/Storage_Inspector for
       information about viewing local storage.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 64025e0e4dcab9dd6645b712631765a4b9242cfd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 24 18:33:30 2022 +0000

    Bug 29933: Fix stray usage of jquery.cookie.js plugin
    
    This patch removes a few instances where the old cookie plugin was still
    being used for deleting cookies even though the new plugin is being used
    to set the cookies.
    
    To test, apply the patch and test the following processes in the staff
    interface:
    
    Search to hold:
    
     - View a patron record and click the "Search to hold" button.
     - Perform a catalog search which will return results.
     - On the search results page there should be a "Place hold for
       <patron>" link under each holdable title.
     - Click the "Place hold" button's dropdown arrow and choose "Forget
       <patron>." The "Place hold for..." links should disappear.
    
    Search to hold for a patron club:
    
     - If necessary, create a patron club.
     - Add one or more patrons to the club.
     - In Tools -> Patron clubs, find the club you added patrons to.
     - Click the "Actions" button and then "Search to hold."
     - Perform a catalog search which will return results.
     - On the search results page there should be a "Place hold for
       <club>" link under each holdable title.
     - Click the "Place hold" button's dropdown arrow and choose
       "Forget <club>." The "Place hold for..." links should disappear.
    
    Batch item modification show/hide columns:
    
     - Go to Tools -> Batch item modification.
     - Submit a list of items for modification.
     - Uncheck some checkboxes to hide columns on the page showing the items
       you submitted.
     - In the browser's storage inspector (e.g.
       https://developer.mozilla.org/en-US/docs/Tools/Storage_Inspector),
       should see a "showColumns" cookie with a string of numbers and
       slashes.
     - Click the "Show all columns" checkbox.
     - The "showColumns" cookie should disappear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 80e7f7dae6da45ecbb3706e5989209969604e435
Author: Mason James <mtj@kohaaloha.com>
Date:   Fri Jan 14 19:44:24 2022 +1300

    Bug 29881: libdbd-sqlite2-perl is unavailable on deb12 (koha-common wont install)
    
    to test...
    
    - attempt to install koha-common pkg on deb12
    
      confirm error...
       The following packages have unmet dependencies:
       koha-common : Depends: libdbd-sqlite2-perl but it is not installable
    
    - apply patch, rebuild new package
    
    - install new koha-common pkg on deb12 successfully
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0757b0976f705d72942d7849b9aa6b35d5f0148d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 8 12:12:22 2022 +0100

    Bug 30045: (bug 29543 follow-up) Fix SCO print slip
    
    Certainly since bug 29543 and bug 29914.
    
    We should do the same authentication check than sco-main.pl, and also
    make sure to generate the checkout history only for the logged in patron
    (the OPAC one, not staff member)
    
    Test plan:
    Use the different combinations of the SCO config (AutoSelfCheckAllowed,
    SelfCheckoutByLogin and WebBasedSelfCheck) and confirm that this patch
    fixes the SCO print slip feature.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8a1113376ce8c9be974ad2daed3ec5458ba77606
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 21 09:44:11 2022 +0100

    Bug 29735: Fix flatpickr init from circulation.tt
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 933b09147e45697ff7b7bf89e67daf9ab979a476
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 3 14:43:13 2022 +0000

    Bug 29859: (QA follow-up) Minor typo correction
    
    We introduced a tiny bug with a typo in the patchset, the accessor
    method is called 'get_column' not 'get_columns'.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d02e91f2694b7642282e124a871a8b6ebcde1055
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 12 15:40:36 2022 +0100

    Bug 29859: Use iterator instead of as_list
    
    On bug 29844 we decided to remove wantarray from Koha::Objects->search.
    Reviewing the difference occurrences I found some unnecessary uses of ->as_list,
    where iterators should be used instead.
    
    This patch only removes the obvious places, not the tricky ones.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9bf19f628ac444fe29f7817b807c872af894331b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 2 10:35:54 2022 -0300

    Bug 29847: Make Koha::Patron::HouseboundProfile->housebound_visits return a resultset
    
    This patch makes the method consistent with the rest of the codebase, by
    making it return a proper resultset.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Patron/HouseboundProfiles.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Check the UI hasn't got broken either.
    => SUCCESS: It hasn't!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit db0ebb3ab54748058ad5606a8845cef506c99c60
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Feb 3 10:54:25 2022 -0300

    Bug 29844: Simplify Koha::Clubs->get_enrollable
    
    This patch removes the wantarray use in Koha::Clubs->get_enrollable and
    adjusts the callers.
    
    Also, reference to some unused params in Koha::Patron clubs-related
    methods are removed as well.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0bec03e861bd242b6188025ae11b16bd080e0ea4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Feb 3 12:13:20 2022 +0000

    Bug 29844: (QA follow-up) Fix Koha::Library::Groups->all_libraries
    
    I think a rebase perhaps lost a change here.. this fix gets the unit
    tests passing again.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 571a13f667336d03f6a400a5585a4108971aecd2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jan 11 09:42:00 2022 -0300

    Bug 29844: Some more uncaught cases
    
    Some more cases found using
    
    $ git grep '\->search(' | grep -v -e '\->as_list' -e '\->get_column' \
          | grep '@'
    
    and then manually looking at them.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e53667105d98dde0500323cb9699bf217c2f2508
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 11 10:09:09 2022 +0100

    Bug 29844: Fix ->search occurrences
    
    and some more...
    
    There are lot of inconsistencies in our ->search calls. We could
    simplify some of them, but not in this patch. Here we want to prevent
    regressions as much as possible and so don't add unecessary changes.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4ae2f6d9d8addd4e7fb8480ea0c41adfaa0febb0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 16:18:57 2022 -0300

    Bug 29844: Remove use of wantarray from Koha::Objects
    
    This patch removes the use of `wantarray` from the following methods in
    the Koha::Objects class:
    - search
    - search_related
    
    In both cases, the change is trivial. And the tests get the 'list
    context' portion removed as well.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Objects.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Caveat: we broke many things by removing the feature. Check follow-up
    patches as well.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ea31326a6e3a5aa67918ff761cdc31efc69dcff
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 17:08:24 2022 -0300

    Bug 29844: Fix t/db_dependent/Koha/*
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ecd4b91334a6e9b125bb8ed72f6ac0f307a148d8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 25 11:57:01 2022 +0100

    Bug 29914: Remove 'Use of uninitialized value ' warnings
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 393efc7b736add1534e4b3cc90784eb2891be2b5
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 24 14:23:29 2022 +0000

    Bug 29914: (QA follow-up) Add comment to explain last case
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: remove ref to line number
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b3d8cb6ff736a209e67773b6dc24661103b4ea4a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 24 14:19:24 2022 +0000

    Bug 29914: (QA follow-up) Expand tests to cover failure case before patches
    
    When asking for permissions we get 'failed', without we get 'ok'
    Adding explicit checks for not 'ok'
    
    Add a FIXME:
    We should cover the case where we return 'failed' after changes, but that is a larger undertaking
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 939ccaf5c48cd3d4d0886e9b2feef8ecb9e6af91
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 21 10:50:59 2022 +0000

    Bug 29914: (QA follow-up) Remove warn on timeout
    
    The warn is:
    The value of the system preference 'timeout' is not correct, defaulting to 600.
    
    Caused by previous test.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 408b7164c3c468ebafda6763253b06b403faf707
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 21 09:23:38 2022 +0100

    Bug 29914: Add tests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 95097d1cc2752715fea099940face25949d3b204
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 20 10:10:05 2022 +0100

    Bug 29914: Make check_cookie_auth compare the userid
    
    check_cookie_auth is assuming that the user is authenticated if a cookie exists
    and that the login/username exists in the DB.
    
    So basically if you hit the login page, fill the login input with a
    valid username, click "login"
    => A cookie will be generated, and the sessions table will contain a
    line with this session id.
    On the second hit, if the username is in the DB, it will be enough to be
    considered authenticated.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dd4800f08d688de940f61d50085ff178992f0628
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 19 11:21:54 2022 +0100

    Bug 29903: Prevent messages to be deleted from unauthorised users
    
    The "Delete" link is hidden but the controller does not do the necessary checks.
    
    /cgi-bin/koha/circ/del_message.pl?message_id=1&borrowernumber=5&from=moremember
    
    Test plan:
    Create a message, see the "Delete" link, don't click it but copy it
    Change logged in library and use the link
    If AllowAllMessageDeletion is off you should be redirected to 403
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 09e02476773c181fcd4009f59c19c7ac1f46d775
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 12 09:43:48 2022 -0300

    Bug 29544: (QA follow-up) Simplify code
    
    I think this is a better approach for the same thing. Posting it just in
    case it helps.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c967a4e9c2b3a29047fd56c43257b4e0bf2b5e07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 09:04:14 2021 +0100

    Bug 29544: Fix opac-issue-note.pl
    
    We must check if logged in user is trying to modify one of their
    checkouts
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e4a402cd50b2f118ec2d7917d39b7310d5c0f1a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 22 14:56:58 2021 +0100

    Bug 29544: Ensure logged in user is allowed to modify checkout note
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ef85122b1dad86637b652460ee898f6cc2931669
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 15:56:24 2022 +0100

    Bug 29542: Prevent access to private list to non authorized users
    
    The catalogue permission is not enough.
    
    Test plan:
    Create a private list owned by user A
    Login with user B and hit (with XX the shelfid)
      /cgi-bin/koha/virtualshelves/sendshelf.pl?shelfid=XX
    
    You should get an error message "You do not have sufficient permission
    to continue."
    
    Login with user A
    => You should be able to send the list
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2c3a11f138247c53df306667f421857ef2a3977a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 6 13:58:25 2021 +0100

    Bug 29541: Prevent users from another group to access patron's images
    
    We should respect group restrictions here.
    
    Test plan:
    Create a patron from another group of libraries and don't let them
    access info from patrons outside of this group.
    Access the following link and confirm that you can see the image only
    for patrons from their group
      /cgi-bin/koha/members/patronimage.pl?borrowernumber=XX
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7f50439cb2cf7d9a6d84e49eaf1cd8330b0995f0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 22 15:29:58 2021 +0100

    Bug 29541: Restrict access to patron's image to borrowers => * and circulate => *
    
    The patron images is displayed on the 'circulation' and 'members'
    modules.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b8088051e9fb56ec0fbab0decf912f6f0fb29926
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Nov 22 07:55:47 2021 +0000

    Bug 29540: Raise flagsrequired in modrequest
    
    Test plan:
    Try modrequest with a user having only 'catalogue' perms and the following URLs:
    [1] /cgi-bin/koha/reserve/modrequest.pl?reserve_id=XX&CancelBorrowerNumber=XX&CancelItemnumber=XX&biblionumber=XX
        Fill the XXs with correct identifiers for some item level hold.
    [2] /cgi-bin/koha/reserve/modrequest_suspendall.pl?suspend=1&suspend_until=2021-12-01&borrowernumber=XX
        Fill the XX with borrowernumber for borrower that has pending holds.
    You should see: Error: You do not have permission to access this page.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [AMENDED] More consensus for using reserveforothers than circulate_remaining.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2e5d59d902be82cebd80d016eefaac531f8c118e
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Jul 22 06:34:20 2021 +0000

    Bug 28735: Self-checkout users can access opac-user.pl for sco user when not using AutoSelfCheckID
    
    This patch makes the sandboxing of the selfcheckout more robust by
    adding a "sco_user" session variable which is turned on when
    logging into the self-checkout (either by AutoSelfCheckAllowed or manually).
    
    If a user with this session variable turned on tries to access
    other parts of the system (like the rest of the OPAC), it will
    "kick out", so that the browser user will lose the authenticated session.
    
    Test plan:
    1) Apply the patch
    2) koha-plack --restart kohadev
    3) Go to http://localhost:8080/cgi-bin/koha/sco/sco-main.pl
    4) Note that you are logged into the self-checkout
         So you see the login screen specific to the self-checkout.
         To log with the actual patron. It's a nested auth.
    5) Go to http://localhost:8080/cgi-bin/koha/opac-main.pl
    6) Note that you are not logged into the OPAC
    7) Log into the staff interface and disable the
    system preference AutoSelfCheckAllowed
    8) Log out of the staff interface (this step is very important)
    9) Go to http://localhost:8080/cgi-bin/koha/sco/sco-main.pl
    10) Note that you are prompted to log into Koha
    11) Login using the "koha" user (when using koha-testing-docker)
    12) Note that you are logged into the self-checkout
    13) Go to http://localhost:8080/cgi-bin/koha/opac-main.pl
    14) Note that you are not logged into the OPAC
          Without the patch you would still be logged as "koha"
    15) Go back to http://localhost:8080/cgi-bin/koha/sco/sco-main.pl
    16) Note that you will need to log in again as you've lost your
    session cookie
          Without the patch you will still be logged in the self-checkout
    Voila!
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c55d2a205c75186520d562884dcef378d4a695b6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 5 16:06:15 2022 +0000

    Bug 29543: Set autocomplete off for SCO login fields
    
    Cardnumber already had it set, adding for username and password
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8336634aa14e76a4390fd5e01419a5bbe73c5279
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 16:37:49 2022 +0100

    Bug 29543: Add Mojo::JWT dependency
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b11619cb52976ac49db524adc60c229a46e13e78
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jan 5 15:29:41 2022 +0000

    Bug 29543: (follow-up) Add a warning to SelfCheckoutByLogin
    
    This updates the language to warn users of risk if using cardnumber for login and auto-self-check is enabled
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b80fda78d9d5affe3b9beb4ede49d5ab4e73cf38
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 15:25:48 2022 +0100

    Bug 29543: Prevent user to checkin or renew items they don't own
    
    Checkin or renew must be restricted to the items they own.
    
    Test plan:
    Create an item with barcode bc_1
    Check it in to user A
    Login to SCO with user B
    Get the token using the browser dev tool, from the cookie
    Hit (replace $JWT)
        /cgi-bin/koha/sco/sco-main.pl?jwt=$JWT&op=renew&barcode=bc_1
        /cgi-bin/koha/sco/sco-main.pl?jwt=$JWT&op=returnbook&barcode=bc_1
    
    You should see an error message
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 78815e97774a101f1108950249ff10ba3a3f9898
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 12:47:10 2022 +0100

    Bug 29543: Enforce authentication for self-checkout
    
    The self-checkout feature is assuming a patron is logged in if patronid
    is passed. It also assumes that "We're in a controlled environment; we
    trust the user", which is terribly wrong!
    
    This patch is suggesting to generate a JSON Web Token (JWT) to store in
    a cookie and only allow action (renew, check in/out) is the token is
    valid. The token is only generated once the user has been authenticated
    And is removed when the user finish the session/logout.
    
    Test plan:
    You must know exactly how the self-checkout feature works to test this patch.
    The 4 following sysprefs must be tested:
     SelfCheckoutByLogin, AutoSelfCheckAllowed, AutoSelfCheckID, AutoSelfCheckPass
    Confirm that you can renew, checkin for the items you own, and checkout new items.
    Confirm that you are not allowed to access other account's info.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3cb8640cbf67224addf0ae6abaeca5cf74d2690d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 12:20:28 2022 +0100

    Bug 29543: Add JWT token handling
    
    Mojo::JWT is installed already, it's not a new dependency.
    We need a way to send the patron a token when it's correctly logged in,
    and not assumed it's logged in only if patronid is passed
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 66c895eb125d182f5ed08b9c06fe946e5154b961
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 11:25:12 2022 +0100

    Bug 29543: Remove inputfocus variable
    
    It's not used in template
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 820a2bb4e0ee1d255bd10b6b416e9c24e7e35b58
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 11:24:12 2022 +0100

    Bug 29543: Remove borrower variable
    
    It's not needed, we have $patron
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 504371de4f65a1db13c863e87386ac3339382ea1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 17:26:18 2020 +0000

    Bug 26102: Prevent XSS when To.json is used: unimarc_field_4XX.tt
    
    To test, edit a MARC framework to link a subfield to the
    unimarc_field_4XX.tt. The process of triggering the plugin and selecting
    a search result from the plugin popup should work correctly.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b211b2be915b2bd1e6d1baea655717bb235afe82
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 15:22:33 2020 +0000

    Bug 26102: Prevent XSS when To.json is used: subscription-add.tt
    
    Test the process of adding a subscription, entering both a valid vendor
    ID and a non-existent vendor ID. The non-existent vendor ID should
    trigger a validation alert.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 081fbd24661c6ff427726fdbf2d1e84527b5e2a6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 15:05:59 2020 +0000

    Bug 26102: Prevent XSS when To.json is used: guarantor_search.tt
    
    To test, edit a patron record and go through the process of adding a
    guarantor. In the guarantor search results table the address should be
    displayed correctly.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a55ff7fe8703e765c6ee5c3d0a1df063447a7ef2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 12:57:48 2020 +0000

    Bug 26102: Prevent XSS when To.json is used: catalogue/results.tt
    
    To test, perform a search in the catalogue and verify that search term
    highlighting works correctly.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 120c6934949df0a211b9909417dcd38e5fb1face
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 12:41:13 2020 +0000

    Bug 26102: Prevent XSS when To.json is used: authorities/blinddetail-biblio-search.tt
    
    Test the process of searching for and selecting an authority record for
    use in the basic MARC editor.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bd87a319366ed3dc1d9792d4c1103c76f77b0eda
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 12:34:18 2020 +0000

    Bug 26102: Prevent XSS when To.json is used: authorities/authorities.tt
    
    Check that mandatory tags and subfields are correctly required when
    editing an authority record.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 97bcf926da028ba39870d3b10ac2d092d2c2ab90
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 11 12:31:26 2020 +0000

    Bug 26102: Prevent XSS when To.json is used: admin/preferences.tt
    
    Test that preference search term highlighting works correctly.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 04dd54c6111a5a70ec4b2da618851ae6235d5dbc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 2 09:49:57 2022 -0300

    Bug 29759: (follow-up) Fix api/v1/article_requests.t
    
    This patch makes the tests set debit_id to undef instead of random data.
    This way tests don't break when $article_request->cancel is invoked and
    a refund is tried.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Letters/TemplateToolkit.t
    => FAIL: Boo, tests fail, random garbage is not a debit
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6c45192a5fecf8b8c4ee2f7035a4dab74f0dbe10
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Feb 2 09:32:37 2022 -0300

    Bug 29759: (follow-up) Fix TemplateToolkit.t
    
    This patch makes the tests set debit_id to undef instead of random data.
    This way tests don't break when $article_request->cancel is invoked and
    a refund is tried.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Letters/TemplateToolkit.t
    => FAIL: Boo, tests fail, random garbage is not a debit
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 34c9fe4c2c22f39d76bbbe2f49b07ff00ccf4d18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 31 10:58:42 2022 +0100

    Bug 29975: (bug 21729 follow-up) Fix api/v1/holds.t
    
    Unknown column 'patron_expiration_date' in 'field list'
    The REST API routes don't need to be aware of the new column patron_expiration_date
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit caa1712d9ffee34975fe92de26c1ede92f8a6425
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 28 14:50:26 2022 -1000

    Bug 29976: (Bug 21729 follow-up) fix holds unit tests
    
    Bug 21729 added to holds table the column patron_expiration_date.
    
    Currently test suite is failing :
    https://jenkins.koha-community.org/view/master/job/Koha_Master_D10/516/testReport/
    
    We must fix where TestBuilder is creating with source Reserve and data expirationdate :
      t/db_dependent/Holds/WaitingReserves.t
      t/db_dependent/Reserves/CancelExpiredReserves.t
    
    Note that t/db_dependent/Reserves/CancelExpiredReserves.t does not fail
    without this patch but surely we prefere change it also.
    
    Test plan :
    prove t/db_dependent/Holds/WaitingReserves.t
    prove t/db_dependent/Reserves/CancelExpiredReserves.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bb316c5ded332cb09dc3ef25c82ccbbfce20525b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 1 21:36:56 2022 -1000

    Bug 29943: DBRev 21.12.00.015
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 320d73b10f33429e0baf550067afa5a9f460596d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 25 15:35:05 2022 +0000

    Bug 29943: Db rev: replace typo in existing notices
    
    Test plan:
    Run updatedatabase.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 13490c4dfb28069e1de66aff4f29335031bef920
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 25 15:27:35 2022 +0000

    Bug 29943: Fix NOTIFY_MANAGER notice in sample notices
    
    Test plan:
    Look good at this change, or do a new install :)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c34648142984c6a801963be735f6c84880f48514
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 1 21:30:41 2022 -1000

    Bug 29596: DBRev 21.12.00.014
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 87621c2c89c70e11f90273a3722e700763e71a4c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 29 18:35:46 2021 -0300

    Bug 29596: Add Yiddish language
    
    This patch adds the Yiddish language to Koha. The language codes were
    taken from https://www.loc.gov/standards/iso639-2/php/code_list.php
    
    Sponsored-by: Universidad Nacional de San Martín
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 616e99489282d744045377a944e36c9a9dfc8dd5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 1 21:13:46 2022 -1000

    Bug 29605: Update DBIC schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6935a30cfce7044fd6246dbd9d6ca5d6380772c7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Feb 1 21:04:59 2022 -1000

    Bug 29605: DBRev 21.12.00.013
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 440f31c268ebe391a0e77d1d7d4f39d560a5f54a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 12:55:36 2021 +0100

    Bug 29605: branchtransfers.cancellation_reason
    
    reason and cancellation_reason was inversed, and the enum values were
    lower cases
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b7bd116bd52050b549919622a15c832bedd0371b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 12:48:28 2021 +0100

    Bug 29605: language_script_mapping.language_subtag cannot be null
    
    It's a PK now
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 36635845d21baa989d03849ccc6d536e042d3031
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 12:37:33 2021 +0100

    Bug 29605: search_marc_map.marc_type
    
    NOT NULL was missing when MODIFY
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 62fd7c6438f4ef7009e55e38af0e2fa299ac260c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 12:29:37 2021 +0100

    Bug 29605: additional_contents.lang
    
    Up to 50 on bug 23797 but bug 24387 switched it back to 25 (bad
    resolution conflict)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e673dc4e2c381bfa4bba5a2a0fa19e1ddc516adc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 12:28:23 2021 +0100

    Bug 29605: additional_contents.code
    
    Added 100 on 210600016, but 20 in kohastructure
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 934dba4f07a37cc52ec95524ef99fdf3bc22d996
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 12:17:12 2021 +0100

    Bug 29605: account_offsets.type is not null
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8022543d93b5587fcc65ff04139ff8b1abbcb78e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 12:12:10 2021 +0100

    Bug 29605: Missing FK on tmp_holdsqueue.borrowernumber (tmp_holdsqueue_ibfk_3)
    
    Bad copy paste on the foreign_key_exists condition
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bb05b37f3e80c6e8f0421e3ae618e981e1b10b13
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 30 20:06:46 2021 -0300

    Bug 29605: (follow-up) Add language_script_mapping primary key
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aa3a86a6b6fedc5f6f636a15ec3dabc10c31a942
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 30 19:44:36 2021 -0300

    Bug 29605: Add missing constraints from bug 15067
    
    This patch fixes a missed update to kohastructure.sql.
    
    To test:
    1. Checkout prior to bug 15067
    (ab270c026be06f08745a14d1aea992877d20f812) would work.
    2.  Run:
       $ reset_all
    3. Checkout v21.11.00
    4. Run:
       $ updatedatabase
       $ koha-mysql kohadev
       > SHOW CREATE TABLE language_subtag_registry;
    => SUCCESS: There's UNIQUE KEY uniq_lang (subtag, type)
    5. Run:
       > SHOW CREATE TABLE language_descriptions;
    =>  SUCCESS: There's UNIQUE KEY uniq_desc (subtag, type, lang)
    6. Run:
       > SHOW CREATE TABLE language_rfc4646_to_iso639;
    => SUCCESS: There's UNIQUE KEY uniq_code (rfc4646_subtag, iso639_2_code)
    7. Replicate a fresh install. Run:
       $ reset_all
    8. Repeat 4, 5 and 6
    => FAIL: The UNIQUE constraints are not there!
    9. Apply this patch
    10. Run:
       $ reset_all
    11. Repeat 8
    => SUCCESS: The UNIQUE constraints are there!
    12. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 26fd5daf5004539aa3443f2909c109c21d836091
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 26 12:18:55 2022 +0000

    Bug 29949: Remove use of title-numeric sorting routine from OPAC datatables JS
    
    This patch removes the use of a specific "title-numeric" sorting routine
    from the DataTables configuration of the "Most popular" table. We can
    use a "data-order" attribute instead.
    
    The patch also removes the now unused code from our custom DataTables JS
    file in both the OPAC and the staff interface (where it was unused).
    
    To test, apply the patch and make sure the OpacTopissue system
    preference is enabled.
    
    - In the OPAC, view the "Most popular" page.
    - Change the filter settings, if necessary, to get multiple results.
    - In the results table, confirm that sorting by number of checkouts
      still works correctly.
    
    A search of the code for instances of "title-numeric" should return only
    one in a comment in the official DataTables library.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4549ebd18fcb641842331611e3a43515adc87b3d
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Jan 28 20:19:08 2022 +0000

    Bug 29967: extended width of description and opac description inputs on authorised_values.tt
    
    To test:
    -Go to Administration > Authorized values
    -In any category, new or existing, look at an authoized value.
    -The description and OPAC description inputs both have a maxlenght of 200 but you cannot see very many characters.
    -Apply patch
    -Look again, the inputs are much bigger and you can see many more characters.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b2c5945340701076e81ee16d75c21606d794cef4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Jan 31 21:13:04 2022 -1000

    Bug 24220: DBRev 21.12.00.012
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2544210395d8f6c21c3f813f446477db24705c19
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Jan 14 00:59:46 2022 +0000

    Bug 24220: Move OpacMoreSearches to HTML customizations in additional-contents
    
    To test:
    1- Before applying the patch add some content to the system preference
       OpacMoreSearches
    2- Apply patch
    3- restart_all and updatedatabase
    4. Go to additional-content.pl ( HTML customizations )
    5. You should now see your content from the system preference under
       OpacMoreSearches in HTML customizations
    6. Try searching for the system preference, OpacMoreSeaches. It has been
       removed and you should not be able to find it.
    7. Try changing/removing/adding content from OpacMoreSearches in HTML
       customizations
    8. Make sure your edits are reflected when you look at the
       OpacMoreSearch area in the OPAC.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 87f3be7a57fc5534717e107e228528939865c4c4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Jan 31 20:49:35 2022 -1000

    Bug 29212: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 830d5f9f3076986717b81b8436aa9d032f8fe248
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jan 31 16:31:54 2022 +0000

    Bug 29212: (follow-up) Restore "Clear date" text for "Suspend all holds"
    
    This patch restores the "Clear date to suspend indefinitely" link
    associated with the "Suspend all holds" date input field.
    
    The patch also introduces a generic ".clear-flatpickr" click handler for
    Flatpickr instances.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 72af322d18407ac8f90adcc301375041319c6bdb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jan 19 16:13:26 2022 +0000

    Bug 29212: (follow-up) Add futuredate attribute to date picker
    
    This patch adds the "futuredate" attribute to the "Hold not needed
    after" date field in the OPAC hold process.
    
    To test, apply the patch and log into the OPAC.
    
    - Locate a bibliographic record and being the process of placing a hold.
    - Click "Show more options" to display the date fields.
    - If the OPACAllowHoldDateInFuture system preferences is enabled:
      - Set "Hold starts on date" to a date in the future.
      - Trigger the date-picker in the "Hold not needed after" field: You
        should be limited to dates *after* the date you selected above.
    - If OPACAllowHoldDateInFuture is disabled:
      - The "Hold starts on date" will no longer be present.
      - Trigger the date-picker in the "Hold not needed after" field: You
        should be limited to dates after today.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8389b5f3323ac34c0dab62637e989cdc4fc03035
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 1 14:39:14 2021 +0000

    Bug 29212: (follow-up) Fixes to suspend hold process
    
    This patch reworks the process of suspending an individual hold from the
    patron's hold list. Instead of repeating the modal markup in each line
    of the holds table, a single modal is re-used.
    
    A "focus: false" is added to the modal via a data-attribute in order to
    overcome problems with selecting months and using keyboard navigation in
    the calendar popup.
    
    To test, apply the patch and log into the OPAC as a user with holds.
    
    - View the holds tab under "Your summary."
    - Click the "Suspend" button next to one of the holds.
    - You should see a modal which shows the title of the item in question.
    - Test that the date picker works correctly:
      - Test selecting a month and year
      - Test selecting a date both with the mouse and by using arrow keys.
      - Test that you can clear the selected date both by clicking the X and
        by clicking the text link.
    - Select a date and close the modal without submitting the suspension.
    - Click the "Suspend" link on another title to confirm that the date
      picker still works correctly.
    - Submit a suspension and confirm that the it completes successfully.
    -
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 168b3e670448b06c88e996d741ad77008795e84f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 25 11:11:10 2021 +0000

    Bug 29212: (follow-up) Update missing date input
    
    I missed the "Suspend all holds" date input in previous patches.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ca4cd6bec19c665bb435d245b8b5d1668040eb6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 14 15:57:20 2021 +0000

    Bug 29212: (follow-up) Incorporate linked date field code from Bug 29240
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5f4e4708a20987ff520299d58add973774222be8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 13 17:51:08 2021 +0000

    Bug 29212: Use Flatpickr on OPAC pages
    
    This patch adds Flatpickr assets to the OPAC (JS and SCSS). A few pages
    are updated to use Flatpickr instead of jQueryUI datepickers.
    
    jQueryUI CSS files are updated because they contain some font family
    definitions which are simple to remove but overly complicated to
    override. Without this change some Font Awesome icons are broken when
    they appear inside jQueryUI widgets like tabs.
    
    We don't run the risk of having this change overwritten by a future
    jQueryUI upgrade because there won't be any more.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Log into the OPAC and check that date pickers on the following pages
      work correctly, including month selection, year selection, forward
      and back arrows, and "Clear date" controls:
    - Go to the "Your personal details" page.
    - Check the "Date of birth" field.
    - With SuspendHoldsOpac enabled, view the "Your summary" page for a
      patron with pending holds.
    - Click "Suspend" to confirm that the "Suspend until" datepicker
      works correctly for more than one hold.
    - From the catalog search results page, select multiple results and
      click the "Place hold" link.
    - On the hold confirmation page, click "Show more options" to test
      the "Hold starts on date" (with OPACAllowHoldDateInFuture enabled)
      and the "Hold not needed after" fields.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 56ea40359a60fb0c5638c7605038736855361441
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Jan 20 21:45:49 2022 +0000

    Bug 19865: Add back horizontal scroll bar
    
    To test:
    1. Do a Z39.50/SRU search
    2. In the search results click on MARC to get the MARC preview. Choose
       something with lots of MARC data so it is both wide and long.
    3. See the Y axis scrollbar
    4. You must scroll bottom of the modal to see the X axis scrollbar,
       annoying.
    5. Apply patch
    6. Try steps 1-4 again. This time you should see the X axis scrollbar
       without having to scroll to the bottom.
    7. It's not a bad idea to test in multiple browsers.
    
    Note: I also put the CSS onto multiple lines to increase readability
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0d995fa55ae611ffe5a9d66126f38990a72484b7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 17 15:01:56 2022 +0100

    Bug 29895: Fix 'add multiple items' button on neworderempty
    
    Button [Add multiple items] stops responding when it's pressed and some multiple items added to basket
    
    It has a "visibility: hidden" we are trying to remove setting "display:
    inline"
    
    This is pretty ugly and certainly does not clean the code, but it's too
    messy and this patch fixes the problem easily.
    
    Test plan:
    Add a new order
    Click "Add multiple items", enter "2", click "Add".
    Confirm that you can use the "Add multiple items" again.
    
    Signed-off-by: Samu Heiskanen <samu.heiskanen@hypernova.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 857b937cf9641120db8e7faa26ec1ce21e0e664d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 27 17:13:32 2022 +0100

    Bug 29809: Fix StockRotationStages.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 41f26075637a7d95ec04d03d6550ad640bc2a996
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jan 18 11:55:59 2022 +0000

    Bug 29809: (follow-up) Update tests and rename variable
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 09fad02ae84ce07879e24bbff78ed00d87d124f1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:58:26 2022 +0000

    Bug 29809: Update stockration tool to reflect method name change
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit aaf0a8195f13b2d9a34d7dfe010d85c80cf14811
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 6 13:49:37 2022 +0000

    Bug 29809: Rename item relation accessor from itemnumber
    
    This patch renames the item relation accessor method in
    StockRotationItem to 'item' from 'itemnumber' to more clearly reflect
    that the method returns a Koha::Item object and not an itemnumber.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6631a2e23411a455a6c56cd0cbf5d7f4b36971a9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 20 15:15:14 2022 +0000

    Bug 29906: (follow-up) Clarify actual code use
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 092721c3d167be9ed9039982c8e9fc2d18e32c78
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Wed Jan 19 18:01:15 2022 +0200

    Bug 29906: fix when hold record forcibly gets unwanted "suspended" state
    
    This code allows for "Perl false" to pass through to $suspended_until
    if it is in $hold->suspend_until and in $body->{suspended_until}
    But in case of "Perl truth" it calls dt_from_string for that value.
    
    Reproduction:
    1. run provided test in kshell: prove t/db_dependent/api/v1/holds.t
    2. see the test fails with something like:
        #   Failed test 'Location change shouldn't touch suspended status'
        #   at t/db_dependent/api/v1/holds.t line 1067.
        #          got: '1'
        #     expected: '0'
    
        #   Failed test 'suspended_until should be undef'
        #   at t/db_dependent/api/v1/holds.t line 1068.
        #          got: '2022-01-20 00:00:00'
        #     expected: undef
        # Looks like you failed 2 tests of 39.
    3. apply the changes in this patch to Koha/REST/V1/Holds.pm
    4. run provided test in kshell: prove t/db_dependent/api/v1/holds.t
    5. test will pass.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 907fcb9497250e70cc59a8be666a8c4c5b78e824
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 17 11:40:00 2022 +0100

    Bug 29862: Add missing txn begin/rollback in TestBuilder.t
    
    It fixes the tests when SearchEngine=ES
     t/db_dependent/TestBuilder.t .. 7/15 Invalid MARC field expression: l5ffglZ_upqqcwOvaiyALgXfyJw2Ot2AGRPUsiAPzSFHfd8J_hsnuQ8z75B8RKc_kyo2rFBp8BrPNwcM1FPhc01ngP01HU_Z7Rx1VHfcIcmrifYnjBDWNmYB9N5_4xEnxMH7ZhqC9b2Bz9wf9
     wSEmx64x6t5xFFKX at /kohadevbox/koha/C4/Biblio.pm line 306.
         # Looks like you planned 12 tests but ran 6.
    
     #   Failed test 'Tests for delete method'
     #   at t/db_dependent/TestBuilder.t line 302.
     Can't call method "biblionumber" on an undefined value at t/db_dependent/TestBuilder.t line 281.
     # Looks like your test exited with 11 just after 8.
    
    Previous subtest created invalid date in the ES mappings.
    
    Test plan:
    Set SearchEngine=ES and run the tests, they must pass.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1c054e70f88f652682688ccaadf845cd249b398b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 3 12:38:29 2022 +0100

    Bug 29779: Make selenium tests return green even if lib is missing
    
    Some selenium tests are not correctly written and they fail is
    Selenium::Remote::Driver is missing.
    
    Test plan:
    1. Remove the lib rm `pmpath Selenium::Remote::Driver`
    2. prove t/db_dependent/selenium/
    should return green
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1d6e4be845151c54ec8d259c6e3d29a7718b0e4e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 18 12:46:51 2022 +0000

    Bug 29482: Replace the term branch with library
    
    This patch replaces the word "branch" with the word "library" in the
    self-checkout template, as per terminology guidelines.
    
    To test, apply the patch and go to Administration -> System preferences.
    
    - Set the "IndependentBranches" preference to "Yes."
    - Log into the self checkout system using a staff user with permission
      to do self-checkout but not superlibrarian status.
    - Try to check out an item which belongs to a library that's different
      to the one you're logged in with.
    - You should see a message, "Item cannot be checked out," including the
      text "This item belongs to another library."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 902aee833968b1273f67bc50a836234e5a0d0940
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Jan 31 14:54:30 2022 -1000

    Bug 29562: (follow-up) typo $tem in opac-reserve.pl
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6d478e75e30112e5d3bf9bd0e29c6d5c5de31ad7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 13:56:30 2022 +0100

    Bug 29562: Test $item instead of $itemNum
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8931e9214598a4b7b68fb9fd9fe4a27881c16b31
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 13:39:35 2022 +0100

    Bug 29562: Fix DecreaseLoanHighHolds.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ad13fee5fb3dd74bb525d17ca56da13989823dce
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jan 10 08:01:20 2022 -0300

    Bug 29562: (follow-up) Fix API controller
    
    This patch fixes tests failures due to bad checks in the controller.
    The tests deserve to be rewritten.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 842d4482766c0fa9f1153fe2f91fc5e1860b95ab
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Nov 23 19:56:52 2021 +0000

    Bug 29562: Adjust CanItemBeReserved and checkHighHolds to take objects
    
    Most of the changes here are simple, this can be read to view the changes
    
    Testing that holds can be placed via staff client, and opac, and are disallowed
    when expected is the best test plan, beyond running the unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 61b17625fa388bcff5db5bb7908f8c8332a54f2b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 13:47:35 2022 +0100

    Bug 29058: Don't display 'Always show holds' at the bottom of the patron list
    
    The checkbox should not appear if we are selecting a patron
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 70f0e67d01204b5b4b26df676fae2d6d1108b8ff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 13:05:55 2022 +0100

    Bug 29058: Don't display 'Show holds' button if holds are displayed
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1036c66b8017c56731a63e28c106f06a23f5a4f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 28 13:52:28 2022 +0100

    Bug 29058: Add missing filters
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0d103c2342756a0020b95d7f7cafb9a5d2ce4b1c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 20 11:17:50 2021 +0000

    Bug 29058: Add 'Always show holds' checkbox to request.pl
    
    This patch adds a new cookie 'awalys_show_holds' and utlises it on request.pl
    to determine if the existing holds table should be loaded.
    
    If the cookie does not exist, the table is loaded to preserve exiting behaviour.
    If the cookie exists and is set to 'DONT' a new button 'Show holds' is added to
    the page to allow force loading the table
    
    To test:
    1 - Place some holds on a record
    2 - Click 'Holds' tab or 'Place a hold' from details page
    3 - Note search box to place hold and table of existing holds
    4 - Apply patch
    5 - Reload the holds page and note new checkbox 'Always show holds'
    6 - Confirm the box is checked
    7 - Uncheck it
    8 - Reload the page and confirm holds do not automatically load
    9 - Click the new 'Show holds' button
    10 - Confirm the existing holds load, and that 'Always show holds' is unchecked
    11 - Check 'Always show holds'
    12 - Reload page and confirm holds don't show
    13 - Uncheck the box, load holds for another record, confirm it remains unchecked
    14 - Bring up browser console (F12)
    15 - In 'Storage' tab, under 'Cookies', delete the cookie for 'always_show_holds'
    16 - Reload holds page, confirm holds load and check box is checked
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Bug 29058: (follow-up) Add hold count and don't display show options if no holds
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bb3573d58f89fb484c903a710573862e429ad4e7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 17 15:18:13 2022 +0100

    Bug 29043: Don't fetch items if when are not on the 'Place a hold on' form
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 54a1776ebf63b205ebb478d53fae678c07ceaf33
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 14 17:15:31 2022 +0100

    Bug 29043: Don't fetch biblios info unless a patron is picked
    
    If we haven't picked a patron or a club yet we don't need to fetch
    biblios, items and holdability infos
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c33621f2d24dbec2414f2b6227b5741b77d970da
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Jan 11 14:31:27 2022 +0000

    Bug 29759: (QA follow-up) Remove abs from the test
    
    Obviously abs has two sides, and we could allow wrong results. We
    can be more precise here.
    Trivial exercise.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3ac2e046e8215b9f6b127c64e19c4728d45acae7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 22 18:17:37 2021 -0300

    Bug 29759: Make cancelling an AR refund
    
    This patch makes the Koha::ArticleRequest->cancel method perform a
    refund if it applies.
    
    The sequence is:
    - Find refundable (potentially partial) payments against the fee
    - Generate a refund for the refundable amount
    - Reduce the fee to zero
    => RESULT: the patron owes nothing, any credits applied to the debit are
    refunded.
    
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/ArticleRequest.t
    => FAIL: Nothing is refunded
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! Refunds take place!
    5. Try on the UI
    => SUCCESS: All good
    6. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f0886ce27c0f1e1eeef3f472a53718363d148534
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 22 18:17:10 2021 -0300

    Bug 29759: Unit tests
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 331af91c48413cfc9a345104d3cc6858774b2cec
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Nov 23 13:39:57 2021 +0000

    Bug 29511: Sort hash keys
    
    This code exists in authorities/authorities.pl and the hash keys are sorted
    I just do the same here
    
    To test:
    1 - Find/create a record with 245a 245h populated
    2 - Load/reload the record several times and note that fields c and b are ordered randomly
    3 - Apply patch
    4 - Reload and note c and b are ordered alphabetically
    5 - Move subfield h before subfield c
    6 - Save and reload
    7 - Confirm that existing/filled fields retain order in the MARC record
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f5b62001228ba552f5be64a6ad9a2f6c806536ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 20 11:20:49 2022 +0100

    Bug 21652: Simplify code
    
    And add a test.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7b16679b2061722caa32632f9c7e8d81ca3a7623
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Jan 6 15:16:05 2022 +0000

    Bug 21652: Only set waitingdate to today if there is no waitingdate already
    
    1- Find or create a hold with a waitingdate other than today
    2- Check the item in to generate a new hold alert
    3- Select "Confirm and Print"
    4- Verify that the waiting date has changed to the current date
    5- Apply patch
    6- Try 1-3 again, if a waitingdate already exists it should not change
    7. Try an item with no waitingdate, it should properly update to today
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1ce59fbdfe6b6ecb946bcffa226b4485732f985b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jan 14 14:17:02 2022 +0000

    Bug 21652: Unit test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4413276810f533d4f65da014be073f02ed34d283
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 26 11:22:04 2021 +0000

    Bug 29320: Update OverDrive availability to V2
    
    This patch updates the call to overdrive_proxy to allow passing a version
    and updates the code to use V2 for availability
    
    To test:
    1 - Enable OverDrive integration by setting the sysprefs
    2 - Log in to your overdrive account in the Koha opac
    3 - Perform a search and note availability display
    4 - Confirm you can checkout/hold/return books
    5 - Apply patch
    6 - Repeat search and test functionality
    7 - Note that title with '0 out of 0 copies available' now say 'Currently unavailable'
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 11a018aa301fffc7ede93470e015119c1918a232
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 13 06:21:15 2022 +0100

    Bug 29690: Prevent detail.pl to crash if MARCXML is invalid
    
    Bug 23846 added support for invalid MARCXML.
    But now page details.pl fails again with software error.
    This comes from several Koha::Biblio calling $self->metadata->record without eval.
    
    Test plan :
    1) Create a biblio record with invalid MARCXML (see Bug 29690)
    In koha-testing-docker there is biblionumber=369
    2) Go to page cgi-bin/koha/catalogue/detail.pl?biblionumber=xxx
    3) You see the page with a message :
    There is an error with this bibliographic record, the view may be degraded.
    Error: Invalid data, cannot decode metadata object ...
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 78cb924b12220fd5b81e4f62366006a35b9fefb7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 15 08:24:16 2021 +0100

    Bug 29690: Add selenium test
    
    Run prove t/db_dependent/selenium/regressions.t on KTD with selenium
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d9da01cd9b516cec4802bf2e51c3b1066d297337
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 28 20:40:17 2022 -1000

    Bug 29757: (RM follow-up) More POD fixes
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 80a9a243a45fedc143bef2b533e76886e5327c55
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 22 16:49:43 2021 -0300

    Bug 29757: (QA follow-up) POD fixes
    
    This patch adds POD, fixes the existing one in the file, and also
    renames reversable => reversible as required by the QA scripts.
    
    If this name change is problematic, I can revert it and resubmit my
    follow-up.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 31f7efb85162d886b10e21fe3435c57610521f46
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Dec 22 16:36:07 2021 -0300

    Bug 29757: Add filters for reversable offsets
    
    This patch adds filtering methods for (non)reversable offsets.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Account/Offsets.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3eca78a316c660936a2e426b53993eb3567e1500
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Dec 22 16:06:35 2021 -0300

    Bug 29757: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d8f527667fe308299dbe8189f65a1d0dbacd312e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Jan 9 10:49:44 2022 +0000

    Bug 6734: (QA follow-up) Fix punctuation, TT filters, and CSS class
    
    * Changes Location : to Location:
    * Removes html_line_break filter, as location is not multi-line
    * Add subscription_location CSS class
    * Use AuthorisedValues.GetDescriptionByKohaField()
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    https://bugs.koha-community.org/show_bug.cgi?id=6743
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 660b1d1e17066d55b7898b502c92a7ce3c856fb8
Author: Jérémy Breuillard <jeremy.breuillard@biblibre.com>
Date:   Thu Dec 16 17:59:03 2021 +0100

    Bug 6734: Show location in serials history table
    
    Opac: On a record(Serials) details the location wasn't displayed on the "Normal view" and "Full history" tabs
    
    Test plan:
    1)Intranet: Make sure to have at least two different Serials/Subscriptions on the same record with the field 'location' filled in
    2)Opac: Find your Serials/Subscriptions
    3)Click 'More details' and notice the 3 tabs : Normal view, Brief history, Full history
    4)Go to 'Normal view' and 'Full history' to notice that 'location' is missing
    5)Apply patch, refresh your browser & repeat 4)
    6)The location is now visible
    
    Signed-off-by: Chris Cormack <chrisc@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a37b824d8517c16e4f49312df468fb3461cebd77
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Nov 11 13:45:25 2021 +0000

    Bug 29458: Reorder login elements
    
    Make masthead.inc modal and opac-auth follow the order of the login
    elements on the homepage.
    
    Test plan:
    Enable prefs for reset password and self registration.
    Fill additional contents for login instructions.
    Logout on OPAC.
    Click Login from your account on top bar.
    Click Login button on the home page (right side, in the middle).
    Verify that these two forms correspond with the home page login.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Bug 29458: (follow-up) Remove FIXME
    
    With some help of Owen Leonard:
    <oleonard> Regarding the <br/>, you can wrap the submit button in <fieldset class="action"></fieldset> instead.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e238644f753cc88dd01c367cc3ba3215e7e67019
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jan 18 17:57:22 2022 +0000

    Bug 29899: Show public note to patrons when placing a hold
    
    This patch adds public note to the table of information shown about
    items when placing a hold on a specific item in the OPAC.
    
    To test, apply the patch and check Administration -> Circulation and
    fine rules. You should have at least one patron category/item type
    configured to allow OPAC item level holds.
    
    - Modify an item to add information to the "Public note" field.
    - Locate that record in the OPAC and place a hold on it.
    - On the "Placing hold" page, click "Show more options" and "A specific
      item."
    - In the table of items you should see a "Notes" column showing the
      information you added to the item.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f99f6352ee5396e7b7c9c738142568a1a10a56be
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Dec 3 08:14:48 2021 +0000

    Bug 29629: Remove two unused MODS XSLT stylesheets
    
    Follow-up of bug 29556. With thanks to Owen for checking.
    
    > koha-tmpl/intranet-tmpl/prog/en/xslt/MARC21slim2MODS3.xsl
    > koha-tmpl/intranet-tmpl/prog/en/xslt/MARC21slim2MODS32.xsl
    > These two files appear to be unused. I could only find references to them in .po files.
    
    Test plan:
    git grep MARC21slim2MODS32
    git grep MARC21slim2MODS3
    Skip the misc/translator/po references. Note in the second grep that
    you only see that MODS3-1 is used in unapi and C4::Record.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 28771ad8b724f28065fc412b9a8a317c0c0850a2
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Dec 7 22:14:07 2021 +0000

    Bug 27868: Add expiration date to holds awaiting pickup
    
    To test:
    1. Have some holds awaiting pickup, also have some holds that have been waiting longer than the ReservesMaxPickUpDelay is set to.
    2. Go to /cgi-bin/koha/circ/waitingreserves.pl
    3. There is no expiration date
    4. Apply patch and restart_all
    5. Now there should be a Expiration date column, make sure you can see it in both Holds waiting and Holds waiting over X days
    6. Make sure all the columns Waiting Since, Date hold placed, and expiration date still sort correctly
    6. Go to Table settings, and make sure all the columns hide correctly for both of the  holds_awaiting_pickup tables ( holdst & holdso )
    
    Note: This patch also corrects 2 other small problems
    
    1. Corrects a problem where the table settings did not account for the checkbox column at the beginnning of each table
    2. Removes the title-string class and uses data-order to sort Waiting Since, Date hold placed, and expiration date ( see Bug 27934 )
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3645d2b26b65dc41efa8cebbd9156333e845e4e6
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Fri Sep 24 09:15:37 2021 +0200

    Bug 28238: (follow-up) Add itemcallnumber to ILS-DI GetAvailability output for unavailable items
    
    Providing the call number for ILS-DI GetAvailability output is useful
    for libraries that use discovery tools. Patrons often don't check
    further for the call number, and then they don't have it when they look
    for the item. It could also be use full to have this call number when
    the item isn't available (to make a request for it for instance).
    
    Test plan:
    1. Enable the ILS-DI system preference
    2. Locate a record with multiple items and make sure they have call
       numbers for each item and that some are unavailable
    3. Test these URLs:
       [OPACBASEURL]/cgi-bin/koha/ilsdi.pl?service=GetAvailability&id=[BIBLIONUMBER]&id_type=biblio
       and
       [OPACBASEURL]/cgi-bin/koha/ilsdi.pl?service=GetAvailability&id=[ITEMNUMBER]&id_type=item
       (Where the [OPACBASEURL] is the OPAC URL of your test instance,
       [BIBLIONUMBER] and [ITEMNUMBER] are a record number and item number of
       your choice.)
    4. Apply the patch
    5. Run the queries from step 3 again - all the results should now have
       the tag itemcallnumber (not only the available's ones)
       Example: <dlf:itemcallnumber>840.08 COR R</dlf:itemcallnumber>
    
    Sponsored-by: University Lyon 3
    
    https://bugs.koha-community.org/show_bug.cgi?id=28238
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit be123d3832fa3bb7c282ba76b6c0774a0ab7e6e1
Author: Lyon 3 Team <koha@univ-lyon3.fr>
Date:   Tue Apr 27 16:13:39 2021 +0200

    Bug 28238: Add itemcallnumber to ils-di GetAvailability output
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3503c488e0a8a1233da357b1c0dc19df764fe4c0
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Tue Nov 9 11:04:34 2021 +0000

    Bug 28238: Add tests
    
    Add specific tests for the tag itemcallnumber in GetAvailability output.
    
    Sponsored-by: University Lyon 3
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a367026b2fcd6337b59965826516bed85c074b80
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Thu Jan 13 19:17:06 2022 +0000

    Bug 29875: Update wording on maxreserves system preference
    
    To test:
    1 - see the current wording
    2 - apply patch
    3 - words are changed
    
    Test to confirm accuracy of wording:
    1 - set maxreserves to 1
    2 - set all/all circ rule to unlimited holds allowed total, holds allowed daily, and holds per record
    3 - confirm you can place 1 hold for a patron, but the second is blocked
    4 - set maxreserves to 0
    5 - confirm you can place and number of holds for the patron
    6 - set maxreserves to blank
    7 - confirm you can place any number of holds for the patron
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9cd36f4948ab983bc61e985d33aae90a10b0d4ed
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 28 10:32:00 2022 -1000

    Bug 27946: DBRev 21.12.00.011
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5f5c199762470733d74c4ca7831669fe73cb65f7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 28 10:22:24 2022 -1000

    Bug 27946: Update DBIC schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 041808bc70cb747d1c270b78ee336b719889c0ea
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jan 7 07:04:24 2022 -0500

    Bug 27946: (QA follow-up) Remove 'scan' terminology, requests may not be scans
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f5536c566e9b261ada0a9a9213b39d70b0f9086e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 17 10:32:04 2021 -0300

    Bug 27946: Add UI handling of AR fees
    
    This patch:
    - Adds a notice about the fee to be charged to the patron (staff and
      OPAC)
    - Adds the right UI description for ARTICLE_REQUEST_FEE debit types in
      the UI.
    
    To test:
    1. Have some article request fee rules
    2. Play with placing an article request in OPAC and staff
    => SUCCESS: You see a message about the fee
    => SUCCESS: The fees are correctly applied to the patron
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b4fd79e750326f5492154cba39f7a254160512e4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 17 10:29:53 2021 -0300

    Bug 27946: Make Koha::ArticleRequest->request add a fee if required
    
    This patch makes the ->request method add a fee for the patron if
    required. It relies on methods defined in Koha::Patron for the task. The
    debit line is linked to the AR if applies.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/ArticleRequest.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d5c8aad712e72612f3212cf322b90cdf1fa00ca7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 17 10:18:53 2021 -0300

    Bug 27946: Article request fee methods in Koha::Patron
    
    This patch adds article_request_fee() and add_article_request_fee_if_needed() methods to Koha::Patron.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 62c340f06a4b9804751009e5cfa83bc850836cc7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 8 15:32:36 2021 -0300

    Bug 27946: Add article request fee to circulation rules
    
    This patch adds a new circulation rule: article requests fee.
    
    It can be set per library and category.
    
    To test:
    1. Try setting sdifferent numeric values, change, and delete them
    => SUCCESS: Things work as expected
    2. Make sure rules are loaded correctly when re-entering the circ rules
       page
    => SUCCESS: All good
    3. Verify the data on the DB is stored as it should on each of your
       tests:
       $ koha-mysql kohadev
       > SELECT * FROM circulation_rules \
         WHERE rule_name='article_request_fee';
    => SUCCESS: All good (remember NULL => 'All' in the UI)
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2946891d2164c5774cd76ec0f8ecb46cf77b03a6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 8 15:29:14 2021 -0300

    Bug 27946: Add article_requests.debit_id and ARTICLE_REQUEST account debit type
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e1f7f3a661e211f853d834aeda95eb064dece424
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 28 10:08:48 2022 -1000

    Bug 21729: Update DBIC schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3d9dfe8e8c539a0ce222553923f7ec45898f1b29
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 28 10:06:43 2022 -1000

    Bug 21729: DBRev 21.12.00.010
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 752318f7d65985bbff6ef2ca0faae78a9f84b36f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 20 16:03:46 2021 +0100

    Bug 21729: Add tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit baeea4533cc4e17d390213c484412dfbc7fc5072
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 14 08:38:02 2021 +0200

    Bug 21729: Simplify non-existent expiration date
    
    No change in behaviour expected by this patch.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Florian Bontemps <florian.bontemps@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b52f9adf0867b82805399138e0211a692bec7290
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 11:30:42 2021 +0200

    Bug 21729: Keep expiration date set when placing a hold
    
    The expiration date picked by the patron (or librarian) when placing a
    hold is lost when a waiting hold is reverted.
    
    We need a separate DB field to store this value and restore it when
    needed: patron_expiration_date
    
    The new behaviours are now:
    Create a hold and specify an expiration date:
      expirationdate=patron_expiration_date
    
    Fill the hold:
      expiration_date is calculated
      expiration_date set to the calculated value or to
    patron_expiration_date if anterior
      patron_expiration_date not modified
    
    Revert the waiting status:
      expirationdate set back to patron_expiration_date
    
    Cancel expire reserves:
      if < expirationdate OR < patron_expiration_date
    Note: This change should not be needed but won't hurt
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Florian Bontemps <florian.bontemps@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ba5f0d39bddc9be0a84af31c3e628f75b6736860
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 11:02:24 2021 +0200

    Bug 21729: DB changes
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Florian Bontemps <florian.bontemps@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 450d0d117d67f034682aec46daf5b7058cda023a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Dec 18 22:04:16 2021 +0100

    Bug 29481: Terminology: Fix other occurrences of 'Collection code'
    
    This changes "collection code" to be "collection" as Koha displays
    the collection description and no codes. This will also help to make
    the GUI more consistent overall.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 62a63fcffc8d4dcab4d10be3d21ab2f240fa3eee
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 16 19:48:29 2021 +0000

    Bug 29481: Terminology: Collection code, call number
    
    This patch corrects an instance of the phrase "Collection code,"
    replacing it with the standard "Collection."
    
    To test, apply the patch and restart services.
    
    - In the staff interface, go to Administration -> System preferences and
      set the OpacItemLocation preference to "library, collection code, and
      call number."
    - In the OPAC, search the catalog using a term which will return
      multiple results.
    - In the search results, item descriptions in the "Availability" line
      should read like this:
    
      [Collection, call number: Non-fiction 394.2663 Bu]
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 46d3d63e46d54cadae76234bb716cc429cfebf24
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 13 13:08:28 2021 +0000

    Bug 29686: Adapt Koha to use new fulfillment API for OverDrive
    
    This patch modifies the checkout_download_url routine in
    WebSerivce::ILS::OverDrive::Patron
    
    We now directly hit the fulfillment endpoint with redirects disabled
    and fetch the URL
    
    The overdrive.js is modified to use a single 'Get item' button for all
    checked out items and to refer to the fulfillment page
    
    To test:
    1 - Enable all OverDrive system preferences
    2 - Search on opac and confirm OD results returned
    3 - Checkout an item
    4 - Confirm you have the new 'Get item' button on 'OverDrive account'
        tab on opac-user.pl
    5 - Confirm the 'Get item' button works
    
    NOTE:
    Most items will also show the 'Get item' button in results, however,
    magazines may not as each checkout has a unique 'reserve id' and the
    'parent' id is not checked in our current code
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 50bb0f6e42e0b5af5ce1117ba86b3667bfb4cef6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 14 10:19:02 2022 +0000

    Bug 29403: (QA follow-up) Add comments why test should fail
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cb4c3a5e21e1d75bdad5c95afe2ab0e274634d25
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Dec 21 11:44:44 2021 +0000

    Bug 29403: Fix unit test for bug 29718
    
    Including a 'T' is actually valid for ISO date format, I was being
    naughty and writing the test to follow our code rather than writing the
    test to conform to the ISO spec first time around. Now we are properly
    supporting 'T' in ISO dates with bug 29718, we need to update the test
    here to properly reflect an invalid ISO date string.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    The commit message is misleading here. Look at the Z in the code changes.
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit df34a4d53fd6a6a6e1fa0f0e9ff2ed3f72c73e9a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 13:41:44 2021 +0000

    Bug 29403: Fix api/v1/patrons.t
    
    t::lib::Dates::compare expects either correct DateTime objects, or a
    system formatted datetime strings to be passed.. but as we're testing
    the API, we are consistently using RFC3339 strings for date-times and
    ISO8601 strings for dates.  We need to therefore pre-process the strings
    into DateTime objects for the comparison.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9b3a443477953fc253dc78feac5d03ce508627c7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 12:15:18 2021 +0000

    Bug 29403: Match the whole string
    
    This patch wraps the constructed regex such that we expect the entire
    regex to match and don't allow leading or trailing garbage.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f7683117f6e081ce87c68434c7d17271c2b858a3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 12:14:50 2021 +0000

    Bug 29403: Unit tests
    
    Add a unit test for proper iso date handling
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d8431acd7707cd03f7ec2e53ec07b6c7157d43d1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jan 14 09:07:58 2022 +0000

    Bug 29718: (QA follow-up) ISO 8601 allows +02 and +0200
    
    The UTC offset is appended to the time in the form:
        ±[hh]:[mm], ±[hh][mm], or ±[hh]
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5a8535c642af320856a56df317557b4ffc1f3fc3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jan 13 09:06:55 2022 +0000

    Bug 29718: (QA follow-up) Remove duplicate test
    
    I'd inadvertantly introduced the exact same test twice!  This patch
    removes the duplicate and annotates the test to clarify the timezone
    handling expectations.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3269c4db0a999f8b23f91bb0d05ee9e7c55e73c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 13 06:58:18 2022 +0100

    Bug 29718: Mock the timezone
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8a66d8b106d806695c7362e2c0254e9546e3f3af
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Dec 21 13:49:29 2021 +0000

    Bug 29718: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit da34328fc11ef9fbb3e265fd0603a4f207425c77
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 17 12:36:20 2021 +0000

    Bug 29718: (QA follow-up) Add optional offset handling
    
    ISO8601 optionally supports timezone offsets. If a timezone is ommited,
    we should assume 'local' time (Which in our case is instance
    configuration time), if we are passed 'Z' or 'z' we should set timezone
    to 'UTC', otherwise we should set the timezone to the passed offset.
    
    Whilst ISO8601 does NOT support AM/PM, I left that intact as it has
    historical relevance in Koha and we share the ISO parsing with SQL type
    parsing amongth other things.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9daea562a8db1033c76cbb7aec56a15f7b7cdcdf
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 17 12:20:20 2021 +0000

    Bug 29718: (QA follow-up) Make 'T' check case insensative
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e1b2fd264dadb9d1b0d36795908054c326f2f9ad
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 16:58:45 2021 +0100

    Bug 29718: Support ISO8601
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c200bf6bc94e5920cbe48f191d53dfd44918134f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 7 14:14:44 2021 +0000

    Bug 28962: Add del-unv-selfreg to crontab
    
    We also add a test by inserting a simulated borrower modification
    record in the same table which should not be deleted.
    
    NOTE: This patch fixes the del-unv-selfreg parameter in the
    cleanup db script. It did not even do what it promised :)
    
    Test plan:
    Verify if the crontab change is correct.
    Run t/db_dependent/Members.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 60ab9ddcfbfc117a46bb87a3a2484ec45addb194
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 21 20:45:27 2022 -1000

    Bug 29722: (QA follow-up) Replace unusual single quote
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 489f1d8d4dad97548a48725ce6f78c0747760384
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Dec 17 02:48:42 2021 +0000

    Bug 29722: Add more sample quotes
    
    This patch adds sample quotes from women, women of colour, trans women,
    Black and Indigenous women, and people who weren't US Presidents!
    
    To test:
    1. Install a fresh Koha and import sample quotes
    2. Go to Tools -> Quote editor
    3. Confirm the quotes show
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 50d2f00d45524d1e4abeb912888aa4f172729778
Author: Hayley Pelham <hayleypelham@catalyst.net.nz>
Date:   Mon Sep 20 04:23:11 2021 +0000

    Bug 29054: Add verbose check for warn in advance_notices.pl
    
    To test:
    1) Set EnhancedMessagingPreferences to Don't allow
    2) In the koha-shell, run misc/cronjobs/advance_notices.pl -c
    3) Note that you see the warning "The "EnhancedMessagingPreferences"
    syspref is off... etc."
    4) Apply the patch and restart services
    5) In the koha-shell, run misc/cronjobs/advance_notices.pl -c and note
    the warning no longer shows
    6) Still in the shell, run misc/cronjobs/advance_notices.pl -c -v and
    note the warning does show
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c5a4c193f44a7829d766a49c1b8b0a842aca4bf4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 14:37:11 2021 +0000

    Bug 29397: Add .kohaSelect select2 wrapper function
    
    This patch adds a kohaSelect wrapper function to simplify
    paging/infinite scrolling with select2 using the Koha RESTful api's.
    
    Invoke select2 select boxes as you normally would from JS, but instead
    of calling .select2(config) use .kohaSelect(config).
    
    If an 'ajax' property is defined in your config object, we wrap the
    transport such that responses include a pagination key as expected by
    select2.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f9bb92fb80789a77dca0bbce8d6c3b21e5cad6c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 10:38:27 2022 +0100

    Bug 29797: Fix display of itemnumbers on the background job detail view
    
    If some items have not been deleted, the detail view of the background job will display "1 item(s) could not be deleted: ", without the list of itemnumbers.
    Also add a space character between itemnumbers.
    
    Test plan:
    1. Check an item out
    2. Use the batch delete items tool to delete the item that is checked
    out and another one.
    3. On the confirmation view, use the dev tool of your browser to remove
    the "disabled" property of the disabled checkbox and select both
    items.
    4. Submit
    5. Go to the detail view of the background job and confirm that you see
    the itemnumber of the item that has failed to be deleted
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 474a19e0f1ee1294e41acb28918788129a028ec1
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Oct 1 13:06:57 2021 -1000

    Bug 29156: File missing warning in Koha::UploadedFile for permanent files only
    
    When an uploaded file is deleted, when file does not exist there is a warning :
    "Removing record for file.txt within category koha_upload, but file was missing."
    
    For temporary files, this warning is noisy.
    For example when they are in /tmp, system reboot deleted them.
    
    I propose to remove this warning for temporary files.
    
    Test plan :
    1) Upload a temporary and a permanent file via Tools > Upload
    2) Delete the file on server
    3) Delete the two files from Tools > Upload
    4) Look at warning in log files
    => You see only warning for permanent file
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 18e38b5b3eeace3a21b6e382d596d93ffa5de58b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 10:35:40 2022 +0100

    Bug 29837: Remove JS error during installer
    
    Uncaught ReferenceError: _ is not defined
    
    the _() function is called from calendar.inc, but calendar.inc is
     included before the definition of this function in
    installer-intranet-bottom.inc
    
    Test plan:
    Confirm that the JS error is gone
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3b555c54bb80b5d090dfb272f8de20848ec2df27
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 21 15:57:28 2022 -1000

    Bug 28943: (QA follow-up) Fix opac.pref
    
    Fix YAML syntax of opac.pref, we must use dash for new lines.
    
    Also removes duplicate text before syspref.
    No need to say "code" since it is now a list of categories.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 54466c6bd7708f6e2e660f8b4015178a63a9de06
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 7 12:22:05 2021 +0000

    Bug 28943: Lower the risk of accidental patron deletion
    
    If you do not use a temporary self registration patron category,
    you should actually make the preference
    PatronSelfRegistrationExpireTemporaryAccountsDelay empty.
    
    As the comment in sysprefs.sql already said, we should not let
    a zero value in the pref delete patrons too.
    
    The module is changed now, the test adjusted and
    the description of both related sysprefs modified.
    
    Test plan:
    Run t/db_dependent/Members.t
    Check in Administration the two adjusted OPAC pref descriptions.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit db07ca09cc3da4d32fad03d629f834d6e02db169
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 14:02:49 2022 +0100

    Bug 29840: Deal with non-existing biblionumber in opac-reserve
    
    We should not explode if the biblionumber passed in not in DB.
    
    Test plan:
    Hit /cgi-bin/koha/opac-reserve.pl?biblionumber=42424
    and notice the error message.
    
    Without this patch you got
    Can't call method "holds" on an undefined value at
    /kohadevbox/koha/opac/opac-reserve.pl line 172
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 53b693bae4a7e2b1cb086038f62b9b848f6d3900
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 10 11:34:27 2022 +0100

    Bug 29838: Fix string interpolation in ImportBatch.t
    
    Test plan:
    Tests should return green
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1aa2aa85d9d17a5c2872cc0fcce5ae4cf2f305b3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 12 15:21:46 2022 -0300

    Bug 29865: Fix duplicate includes in circ/returns.pl
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f88bbdada06d51a701588fa2814cde2a3152f47b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 21 14:58:42 2022 -1000

    Bug 29646: (RM follow-up) Add space before colon
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a1ac05193dddc82e70eb2ef8a37a4a40e86f6b87
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Dec 6 08:31:48 2021 +0000

    Bug 29646: Fix undefined category crash in opac-password-recovery
    
    The crash is a result of a not found borrower. This is typically
    a bad or repeated recovery attempt.
    
    Test plan:
    Do a password recovery.
    Use the mailed URL twice.
    Without this patch, the second attempt crashes.
    With this patch, the second attempt shows an error dialog.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e653effe5783e149f5ab69f388aa5509db454ef4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jan 8 23:05:00 2022 +0000

    Bug 11750: (QA follow-up) Remove unconditional warn
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a5fd77be044a893bdbbd4127f39e82dc278d897d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 19 14:01:17 2021 +0200

    Bug 11750: Hide patron's attributes on overdue list if needed
    
    If a patron's attributes is limited to some libraries, we must apply
    this limit on the overdue list view.
    
    Test plan:
    1. Create the following patron attributes:
    A that is not searchable
    B is searchable and does not have library limitation
    C is searchable and is limited to another library than yours
    2. On the right part of the overdue list view you must see B only
    Without this patch C is displayed as well.
    
    Signed-off-by: The Minh Luong <the-minh.luong@inlibro.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 43abf06b6445ba00712086a3dc2fb9cf99ef7054
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 23 08:41:33 2021 -0300

    Bug 29764: Fix incorrect EmbedItems RecordProcessor filter POD
    
    This patch makes the usage POD for the EmbedItems filter actually be
    usable. The filter is used in opac-ISBDdetail.pl and the POD is updated
    to how it is used there.
    
    Not much to test.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cf77d0f7b2e6a58c888ea47d724858e6425b7722
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 7 15:54:16 2022 +0100

    Bug 29806: (follow-up) Call ->as_list for ->pickup_locations on request.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cdbfadbc92be16f7dd839c3cd0f8f7029575b9fc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 09:27:45 2022 -0300

    Bug 29806: Fix POST /holds use of pickup_locations
    
    This patch makes Koha::Item->pickup_locations and
    Koha::Biblio->pickup_locations explicitly call ->as_list in list
    context. This way we workaround bug 28871.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/holds.t
    => FAIL: Tests fail, the route gives a 500 (unhandled exception)
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass, the route correctly returns a 400 with a
    message about the pickup location being invalid
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3eb2f8ebbe76984c9b64eb123c25a96018bf368d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 09:22:05 2022 -0300

    Bug 29806: Call ->as_list for ->pickup_locations on request.pl
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 12079466655ba7929b88024d75f12ae9136c7e68
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 09:27:28 2022 -0300

    Bug 29806: Regression tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fe0a0ee83490103d49711d2afaacb9803e9b9740
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 08:53:30 2022 -0300

    Bug 29807: Make Branches plugin handle empty pickup locations list
    
    This patch makes the plugin handle empty Koha::Biblio->pickup_locations
    and Koha::Item->pickup_locations correctly.
    
    It does so by explicitly calling ->as_list. It also restores the logic
    that was changed by 6cd1ffab4e491349c99769018a7df33dc8a8aabf so, now
    that ->empty is handled correctly, it doesn't return ALL the pickup
    locations when the item/biblio doesn't have valid pickup locations.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Template/Plugin/Branches.t
    => FAIL: Awful error
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fa1e67ecc7177544a60fd438b60e3a9d4e142e9d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 08:53:01 2022 -0300

    Bug 29807: Regression tests
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e3a98dd05c20333a4bcd64f3b3c00d58d68a347e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 23 17:50:33 2021 -0300

    Bug 18320: Remove calls to CGI->param from the templates in patron cards
    
    This patch removes calls to CGI->param from within the templates
    (patroncards-errors.inc) and passes error_* variables with the same
    codes from the controllers to the template instead.
    
    This way we can be sure CGI->param is not called in list context.
    
    To test, try those pages and see they don't show warnings anymore.
    Verify that error situations still show the error messages.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b31d1f669a0b78d642be74f11aff68e4994f4275
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 23 09:51:09 2017 -0300

    Bug 18320: Remove patroncards/edit-layout.pl warnings
    
    This patch removes warnings generated by the script itself.
    
    To test:
    - Go to Tools › Patron card creator › Manage layouts and
            Tools › Patron card creator › New layout
    - Add a new layout, adit existing.
    => FAIL: Warnings logged by edit-layout.pl
    - Apply this patch
    - Go to Tools › Patron card creator › Manage layouts and
            Tools › Patron card creator › New layout
    - Add a new layout, adit existing.
    => SUCCESS: No warnings generated by edit-layout.pl
    - Sign off :-D
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2c60281ab4102551d46dc793a1ca35af9ad5f9c0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 14 19:39:02 2022 +0000

    Bug 29889: Incorrect library check in patron message deletion logic
    
    This patch corrects the logic controlling whether a patron message on
    the circulation or patron details page has a "Delete" link. An error in
    the logic prevented messages from being removed by staff who should have
    been authorized to do so.
    
    To reproduce the bug, check that your AllowAllMessageDeletion preference
    is disabled.
    
    - In the staff client, check out to a patron whose home library doesn't
      match the library you're logged in at.
    - Add a message to the patron's account.
    - You should see no "Delete" link next to the newly-added message.
      - If you edit the patron so that their home library matches the
        library you're logged in at the delete link will appear.
    
    To test, apply the patch and follow the steps above. The delete link
    should aways appear if the message was left by someone logged in at the
    same library.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 20366164af813dde564b5f9fba410408ff66b39a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 18 16:01:00 2022 +0100

    Bug 29495: Fix TestBuilder.t
    
    Value not allowed for auto_incr issue_id in Issue at /kohadevbox/koha/t/lib/TestBuilder.pm line 387.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ead3c624b6722c824b832db4ff061b16c727cfef
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 7 19:34:21 2022 +0000

    Bug 29820: Set paging option using boolean instead of string
    
    Bug 28450, "Make Account summary print tables configurable," added
    DataTables to the print summary view. The updated page includes the
    wrong option:
    
    "paging": "false",
    
    It should be:
    
    "paging": false,
    
    Because DataTables expects that option to be boolean (true or false).
    
    To test, apply the patch and check out to a patron who has more than 20
    checkouts and more than 20 holds.
    
     - From the toolbar, click Print -> Print summary.
     - On the acount summary page, confirm that the "Items checked out" and
       "Pending holds" tables show ALL entries, not just the first 20.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4851e10119226c114b34235d8ba54eaf99f4a6c3
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jan 18 21:06:13 2022 -1000

    Bug 29336: Update DBIC schema
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4962a4395df16d475ee6dcc6f7f429825ea2c76b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jan 18 20:45:45 2022 -1000

    Bug 29336: DBRev 21.12.00.009
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 05ead115bb9c5ad6119b85f0bb14237f761dbf62
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 7 16:04:28 2022 +0100

    Bug 29336: Remove TODOs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 051aafb896de51d4b66efda9616bfdde4459aadb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 28 12:11:07 2021 +0000

    Bug 29336: Database revision
    
    Resizes the six fields identified earlier:
    
    additional_fields.authorised_value_category 16=>32
    auth_subfield_structure.authorised_value 10=>32
    auth_tag_structure.authorised_value 10=>32
    club_template_enrollment_fields.authorised_value_category 16=>32
    club_template_fields.authorised_value_category 16=>32
    marc_tag_structure.authorised_value 10=>32
    
    Test plan:
    Run dbrev, check database.
    Bonus: Connect an AV category with a long name to a authority subfield.
    Check if you see its values in the authority editor.
    (This was the way I found the problem.)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1d5332deb691488000ef92baed78bee442b0c564
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 28 11:45:39 2021 +0000

    Bug 29336: Identify the fields with wrong length (or name) first
    
    This report will fix the bad lengths first.
    And mark the 'bad' names with a TODO for follow-up.
    Bad name means: refers to value, should be category.
    Scanning kohastructure.sql.
    
    Note: Bug 29347 has been opened to fix the names.
    
    Test plan:
    Search for another AV category field with length<>32.
    Bonus: Reinstall and check database.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 34248e5805e03808e4408b8ae772a8175c9d1e3c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 23 15:51:52 2021 -0300

    Bug 29758: Get rid of warning in members/boraccount.pl
    
    This patch removes a noisy warning found in production logs.
    
    To test:
    1. Run:
       $ tail -f /var/log/koha/kohadev/plack-intranet-error.log
    2. Open the 'Accounting' tab for a patron, then click on 'Transactions'
    => FAIL: You see this kind of warning in the logs:
    
    [WARN] CGI::param called in list context from...
    3. Apply this patch
    4. Repeat 2 (change tab and go back)
    => SUCCESS: No more warning!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ae91a0b5db0024876e230106118b147bbe81af27
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 7 10:54:34 2022 -0300

    Bug 18540: Update MARC21 biblio XSL file
    
    I ran the xsltproc on both MARC21 and UNIMARC files (biblios and
    authorities). With my follow-up the only changed one is this one.
    
    I skipped NORMARC as it is supposed to be removed by now (so unused in
    Norway).
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 75514a85c554840712057553cace9839449fa01f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jan 7 10:44:30 2022 -0300

    Bug 18540: (QA follow-up) Only mention index_sort_title if defined
    
    This patch makes the generated xslt not mention index_sort_title unless
    the entry is defined on the xml file. Otherwise there's a call to
    
    <xslo:apply-templates mode="index_sort_title"/>
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 78d403ca3db8e528f9d6c0635d9eabc7ec79ee92
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu May 13 16:34:38 2021 +0000

    Bug 18540: Handle indexing sort title only when needed
    
    This patch moves the code that generates the xsl for MARC21 biblio sorting
    to it's own template that is only called when specified in the xml
    
    To test:
     1 - xsltproc etc/zebradb/xsl/koha-indexdefs-to-zebra.xsl etc/zebradb/marc_defs/marc21/authorities/authority-koha-indexdefs.xml > etc/zebradb/marc_defs/marc21/authorities/authority-zebra-indexdefs.xsl
     2 - git diff
     3 - Note that authority-zebra-indexdefs.xsl now has 245 Title:s info
     4 - Apply patch
     5 - xsltproc etc/zebradb/xsl/koha-indexdefs-to-zebra.xsl etc/zebradb/marc_defs/marc21/authorities/authority-koha-indexdefs.xml > etc/zebradb/marc_defs/marc21/authorities/authority-zebra-indexdefs.xsl
     6 - git diff
     7 - There are lines added about title sort, but no 245 block
     8 - xsltproc etc/zebradb/xsl/koha-indexdefs-to-zebra.xsl etc/zebradb/marc_defs/marc21/biblios/biblio-koha-indexdefs.xml > etc/zebradb/marc_defs/marc21/biblios/biblio-zebra-indexdefs.xsl
     9 - git diff
    10 - Note lines changes to ...title_sort
    11 - 245 block does not change
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit eb2136cfcc4d5df973a9b481d77a816952891dca
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 7 11:29:47 2022 +0100

    Bug 29812: Add missing use C4::Context in Koha::Token
    
    Caused by bug 18124.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 774f28761773b5ffdf6e36761d07046977e4f1a7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 10 10:17:45 2021 -0300

    Bug 29464: Make GET /acquisitions/orders honour sorting
    
    When bug 20212 was pushed, we lost (didn't dig enough to find out how)
    the sorting feature for this route.
    
    This is mainly because biblio+biblioitems filtering prevents the route
    to use plain $c->objects->search, so it has baked a custom version of
    it. In this case, it missed the call to the dbic_merge_sorting helper,
    that takes care of reading the query parameters and inject the sorting
    attributes to the resultset.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/acquisitions_orders.t
    => FAIL: Tests fail, sorting doesn't actually work
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Sorting works!
    5. Test sorting the pending orders on parcel.tt
    6. Sign off :-D
    
    Sponsored-by: ByWater Solutions
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cb23615ad5e0824c54b64aca4112cdf8b878eabc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 10 10:15:42 2021 -0300

    Bug 29464: Regression tests
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9b9417ca136fc95d3ee4dfaa7010fee70f24b6ee
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jan 18 09:49:09 2022 -1000

    Bug 29704: (RM follow-up) Fix typo sned send
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d1a701573e9005fdfb770a40b3a04c4fcc0029b6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Dec 17 15:49:17 2021 +0000

    Bug 29704: Add a triggered option to holds_reminder.pl
    
    This patch adds an option to only trigger notices matching the number of
    days waiting specified
    
    You will need to define HOLD_REMINDER notices for the specific branch of the
    patron and ensure the patron has hold reminder notices in their messaging preferences
    
    TO test:
    1 - Place a hold for a patron and check in to confirm
    2 - Set the waiting date back a few days:
        update reserves set waitingdate = DATE_SUB(CURDATE(), INTERVAL 5 DAY);
    3 - Run the cron and see that patron would be notified if running for 4 days weaiting
        perl misc/cronjobs/holds/holds_reminder.pl -v --days 4
    4 - Apply patch
    5 - perl misc/cronjobs/holds/holds_reminder.pl -v --days 4 --triggered
    6 - Note patron would not be notified
    7 - perl misc/cronjobs/holds/holds_reminder.pl -v --days 5 --triggered
    8 - Note patron is notified when days waiting matches exactly
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 40da37caa66840280f421d994e56ecdf6eb446cf
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Nov 16 15:31:02 2021 +0000

    Bug 29498: Remove usage of deprecated Mojolicious::Routes::Route::detour
    
    Mojolicious::Routes::Route::detour was deprecated in Mojolicious 8.67
    and removed in Mojolicious 9
    
    It was used in Koha::App::Plugin::RESTV1 to connect the "REST API"
    Mojolicious app to the other Mojolicious apps (Koha::App::Intranet and
    Koha::App::Opac), so it's only a problem when running Koha as a
    Mojolicious app.
    
    This patch makes use of the "partial" attribute instead, which does the
    same thing.
    
    Test plan:
    1. Run `morbo bin/intranet`
    2. Point your browser to what morbo says (should be localhost:3000)
    3. Log in, and go to Administration » Libraries. This table uses the
       REST API, so if you see data in it, that means the API (and the
       patch) works
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c96fee3840ca68508ced69ca9db990cefe2a8c41
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Nov 14 12:10:15 2021 +0000

    Bug 29474: Remove one layer of indendation by adding if check in the begginning
    
    If we simply return "no" immediately from the function when the
    checkout is not an autorenewed checkout we can drop one layer of
    indendation and the code becomes much easier to read.
    
    To test:
     1) prove t/db_dependent/Circulation.t
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6f7554754063518cc3399a45b2aaa72d520c8326
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Nov 14 12:05:16 2021 +0000

    Bug 29474: Decouple renewal checks of auto-renewed issues from non-autorenewed
    
    The too_soon check does not relate at all to auto-renewed issues and
    should be moved outside the _CanBookBeAutoRenewed() function.
    
    To test:
       1) prove t/db_dependent/Circulation.t
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6ceeafab7fc3a21c9986c08089cf51ba6bb7370a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Nov 13 14:43:36 2021 +0000

    Bug 29474: Return too_soon before checking renewals
    
    This patch allows us to avoid checking reserves when the issue is
    too_soon and we are running the cron
    
    Code is covered by existing tests
    
    To test:
    1 - prove -v t/db_dependent/Circulation.t
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dafdfe32325c8185f66bdcedbac12750572bb8e4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 14 15:17:56 2022 +0100

    Bug 29884: Run missing test in api/v1/patrons.t
    
    compare is not calling is() or ok(), it's caller job to do it.
    
    Test plan:
      prove t/db_dependent/api/v1/patrons.t
    should still return green
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2bd3f876f1fafdf8f182653c542343e194c338db
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Dec 9 13:55:41 2021 +0000

    Bug 29670: Fix EDI for AcqCreateItem = 'placing on order'
    
    The AcqCreatItem at order time functionality was broken by bug 27708.
    This patch resolves that.
    
    Test plan.
    1) Run the newly created unit tests that prove both settings work
    
    Signed-off-by: Jonathan Field <jonathan.field@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 91b8f990aed0bfe93dd54d0ce03be4b161d7fa1b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Dec 9 16:04:55 2021 +0000

    Bug 29670: Unit tests
    
    This patch adds unit tests for Koha::Edifact::Order->order_line. We now
    check that the message segments are created as expected for both the
    'ordering' and not 'ordering' case for acquisitions item creation time.
    
    Signed-off-by: Jonathan Field <jonathan.field@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD amended patch: spelling segement ==> segment
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 61e3acf7a318fdc09a1eb07167093fbea350943e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 6 12:38:05 2022 +0000

    Bug 29808: Do not receive transfer for checked out items
    
    This patch adds a check to StockRotationItem->advance to check if an
    item is checked out from the destination branch. If so, we do not receive the transfer
    
    To test:
     1 - Enable StockRotation system preference
     2 - Browse to Tools->Stock rotation->New Rota and create a new rota, set as cyclical
     3 - Manage->stages and add two stages, each with 0 day duration
     4 - Manage->items - add an item
     5 - Checkout the item from the first branch of rotation
     6 - Tools->Stock rotation->Manage->items->move to next stage
     7 - Error:
        [Transfer item is currently checked out] at /usr/share/perl5/Exception/Class/Base.pm line 88
     8 - Check in the item at first branch
     9 - Checkout the item from the second stage branch
    10 - Apply patch
    11 - Tools->Stock rotation->Manage->items->move to next stage
    12 - No error!
    13 - Check in item at second branch
    14 - Checkout from first branch
    15 - Tools->Stock rotation->Manage->items->move to next stage
    16 - Still no error!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 19da27fef2579c9063e129915ece3f16fa4dc64a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jan 6 12:28:23 2022 +0000

    Bug 29808: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8ffd26dc99541b62e8d261d29e5959b6cfe4be20
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 07:13:57 2022 -0300

    Bug 29804: Fix Koha::Hold->is_pickup_location_valid exploding
    
    This trivial patch acknowledges the fact bug 28871 is probably not going
    to be pushed, and changes the method so  it, internally, uses
    Koha::Item->pickup_locations and Koha::Biblio->pickup_locations in
    scalar context.
    
    This is probably the correct solution as the discussion on bug 28883
    points towards the future removal of the use of wantarray altogether,
    eventually.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Hold.t
    => FAIL: It explodes as we see in production, with:
    The method Koha::Libraries->branchcode is not covered by tests!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 28816cf55bdd9142659a18891cd3da42ba6cf804
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 07:11:02 2022 -0300

    Bug 29804: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 087176138cd7edfc8083941e370c5e43f9534b50
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jan 4 13:37:53 2022 +0000

    Bug 29786: Select only specific items for item level holds
    
    This patch adjusts get_items_that_can_fill to make two requests:
    first the list of items for item-level holds
    second the list of biblionumbers for title-level holds
    
    This stops the report from pulling more items for item-level hold
    
    This patch also removes the aliases used in the code - while readability
    is a bit harder, it allows for using 'me' in get_items_that_can_fill
    Otherwise, this routine would need a parameter to know what we called the table.
    
    To test:
    1 - Find a record with many items available
    2 - Place an item level hold for an item on the record, not the one with lowest itemnumber
    3 - Run 'Hold to pull' report
    4 - Note the barcode does not match
    5 - Apply patch
    6 - Reload report
    7 - It matches!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 04d94627fbe0d3af0df96c21b82f57d2ec183de1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jan 4 13:33:07 2022 +0000

    Bug 29786: Unit tests
    
    I add a new test for the case of an item level hold, and additionally
    adjust later tests to use a title level hold.
    
    I also fix a typo where the comment says item 1 when it means item 2
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 97a2b7538c1b1ef4204cc49beb125ab59e98ae2d
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed Jan 5 10:00:10 2022 -0300

    Bug 28932: Fix duplicate next_action & prev_action
    
    This patch fixes the duplicate buttons issue.
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Illrequests.t
    => FAIL: Tests fail
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ce4d70988d1c4680fde081e0ecf7cb0de41849fc
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed Jan 5 10:02:22 2022 -0300

    Bug 28932: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3c2bf7b037b496396110ff32e5a88d2a21e17c7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Jan 17 14:31:22 2022 -1000

    Bug 29495: DBRev 21.12.00.008
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 389763c1aaa20a6ad2c866587770dd2a93f3e38c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Nov 22 17:58:13 2021 +0000

    Bug 29495: Add relation tests
    
    This patch adds missing tests for relationship accessors in the
    ReturnClaim class.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ddd138e0c8ef80b22b6c990b4f3167d127c7d223
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 18 15:47:02 2021 +0000

    Bug 29495: (follow-up) Use 'item' relationship
    
    This patch adds the missing 'item' relationship in
    Checkouts::ReturnClaim and then uses it from the resolve method.
    
    This improve the reliability of the resolution code so it works when the
    item has already been checked in (without having to check
    Old::Checkouts).
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3e17d55976a205dabe7ca4a587bfc24b4e349676
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 18 07:43:44 2021 +0000

    Bug 29495: Update relationship methods
    
    This patch updates the relationship methods found in
    Koha::Checkouts::ReturnClaim so that they are prefetchable and embeddable on
    the API.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c5d48ed2789707d7e8fedfdd293278bba0bd8fb0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 17 10:27:38 2021 +0000

    Bug 29495: Add code level constraint replacement
    
    This patch adds a check in Koha::Checkouts::ReturnClaim::store to
    replace the database level foreign key check.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c2773d89f5ea11ee4fa656d9fae61e9ccb6653b9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 17 10:10:18 2021 +0000

    Bug 29495: Add DBIC relationships back into Schema
    
    This patch adds the relationship accessors back into the affected Schema
    classes, now below the fold so they are retained during dbic rebuilds.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 86331823ede1f90318003575d1fa38b4e927c23f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 17 10:01:47 2021 +0000

    Bug 29495: DBIC Schema Rebuild
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7beddcb7a9347e280dee0a2a43bcad5a5405e9bc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 17 09:56:48 2021 +0000

    Bug 29495: Drop issue_id constraint from return_claims
    
    This patch removes the issue_id constraint from return_claims.
    
    Due to the nature of our dual table approach to checkouts/old_checkouts
    we can't safely hae this constraint and not lose data.  Prior to this
    commit, when an item is checked in we move the checkout from checkouts
    to old_checkouts.. this therefore triggers the delete of the issue_id
    from the return_claims table as described by the foreign key constraint.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 27587912d7d36faa303042b6e993f6a9a5c845ac
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Nov 22 16:30:13 2021 +0000

    Bug 29495: Unit Tests
    
    Test plan
    1. Run updated tests prior to applying new patches.. pass
    2. Run updated tests after applying new patches.. pass
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4bc4a127aaa99b9d10f4ea488584fcf1e14fa820
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 29 07:59:47 2021 -0300

    Bug 29585: Fix unstranslatable strings in addbiblio.tt
    
    This patch makes 'Go to field' and 'Errors' strings translatable
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6ddb8c9e25ebf9ba041418dae66c29cee4701116
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 16 16:44:30 2021 +0100

    Bug 29717: Remove unecessary DT manipulations from tools/additional-contents.pl
    
    DBIC handles DateTime correctly, no need for this output_pref call.
    
    Test plan:
    Create a new content, set the dates, confirm they are set correctly
    Modify the content, modify the dates, confirm they are stored correctly
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9d31f0d4ed98654477db9d17bfee2365169da8ee
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Dec 15 15:44:06 2021 +0000

    Bug 29702: Fetch group libraries in a single call
    
    The current code gets all group members, then loops through and fetches the library if there is a
    branchcode, or recursively calls itself if a group. This slows down performance.
    
    We can utilize the 'libraries' method to get all child libraries at once, then make a check
    for child groups separately
    
    To recreate:
     1 - Add 100 items to a biblio
     2 - Define a library group as a hold group
     3 - Add all libraries to the group
     4 - Set 'Default checkout, hold and return policy'->'Hold pickup library match' = 'Any library'
     5 - place a hold on the record and note load time after patron is selected
     6 - Set 'Default checkout, hold and return policy'->'Hold pickup library match' = 'Patrons hold group'
     7 - place a hold, note longer load time after patron selection
     8 - Apply patch
     9 - note improvement
    10 - prove -v t/db_dependent/Koha/Libraries.t
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2f554fd2882d60f352d146ae2b78cf4998eee85a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 6 15:28:20 2022 -0300

    Bug 29813: Add missing semicolon in skeleton.pl
    
    This has no effect as it is not causing problems. But.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f1c90be392a5389f5252e7fe9570f3dd6baf6be5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 13 21:05:07 2022 -1000

    Revert "Bug 20076: Add Thibaud Guillot to contributors"
    
    This reverts commit 9f4cd767673194ceb00e946c36ee9f7b8297553e.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9f4cd767673194ceb00e946c36ee9f7b8297553e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 13 16:53:03 2022 -1000

    Bug 20076: Add Thibaud Guillot to contributors
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b4982123514c2bdea1a583c88a23a526eb2046a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 21 10:16:55 2021 -0300

    Bug 29736: (QA follow-up) No need to delete all clubs
    
    There's no real need to delete all the existing clubs in the tests.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a2d8ed5ec42d241645bd74add3314b2298dc34c7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 21 10:49:56 2021 -0300

    Bug 29736: Restore searching
    
    Without this patch, the list will always display all clubs.
    
    To test:
    1. Have two clubs, with enrollemnts:
       - Cthulhu fans
       - The Shadow Out of Time fans
    2. Search for the letter c
    => FAIL: You get both results
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Only Cthulhu is returned
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f86243fb5ca9edbbbcb39cc34df3650db7e1ac5e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 20 15:14:56 2021 +0100

    Bug 29736: Don't return empty clubs
    
    There is an error when placing a hold for a club without members:
    Uncaught TypeError: err.responseJSON.error is undefined
    
    It seems that we should remove clubs without members from the search.
    
    Test plan:
    Create 1 club xx with 2 patrons
    Create 1 club xxx with 1 patron and cancel their enrolment
    Create 1 club xxxx without patron
    
    Place a hold for club "x", only the first one should be returned with
    this patch.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cdf19f8ed69d4fb0cf44fe3b70e7e5bce2dd0513
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 13 17:27:42 2021 +0000

    Bug 29476: (follow-up) Fix return, add precision test
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ed021c0add2e710ef402fdf7aa6126fc1501da05
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Nov 14 14:19:08 2021 +0000

    Bug 29476: Correct soonest renewal date calculation for checkouts with auto-renewal
    
    If a checkout with auto-renewal enabled doesn't have a
    "norenewalbefore" circulation rule set the code in CanBookBeRenewed()
    falls back to using due date (to verify this please look for the
    string "auto_too_soon" in C4/Circulation.pm), the calculation result
    of GetSoonestRenewDate() however didn't do this, though luckily it was
    not used in CanBookBeRenewed so we didn't get any issues
    there. However, GetSoonestRenewDate() is used for displaying the
    soonest renewal date in the staff interface on the circ/renew.pl page
    so you would have gotten wrong results there.
    
    This patch moves additionally the tests made for Bug 14395 under a new
    subtest for GetSoonestRenewDate() as they should have been like that
    already before.
    
    To test:
      1) prove t/db_dependent/Circulation.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 093cffe7c120b2586a40140e35bafa5c4d50f968
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 20 12:02:45 2021 +0100

    Bug 29735: Remove flatpickr init from categories.js and holds.js
    
    Same as bug 29394, we want the flatpickr instanciations be done at the
    same place, from calendar.inc. That way they will all behave
    identically.
    
    Test plan:
    Edit a patron category and confirm that the "until date" calendar has
    the "yesterday" and "today" dates disabled
    
    Place a hold on an item, go to the patron detail page, click the "holds"
    tab, suspend.
    That should trigger a modal that will display a calendar with
    "yesterday" and "today" dates disabled
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 14660a6f293633b588caced1aa6a2937d7142ec6
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 13 16:18:31 2022 -1000

    Bug 29552: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d9985ea07280e7cb3c1182f4e871b46e8f96f5e2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 20 11:44:24 2021 +0100

    Bug 29552: Disable today for dates in the future
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 934269df3127f6880c9d56219043f4379b3c8a36
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Dec 3 14:40:41 2021 +0000

    Bug 29552: (follow-up) Use CSS to set disabled class
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b046b1da98f9ecd3dd8c0191a1686174031a894a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 23 14:17:09 2021 +0100

    Bug 29552: Flatpickr - Disable shortcut buttons if inactive
    
    If one of the buttons is not relevant we should disable it and mark is
    as such on the interface.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6c84f705d086f3657f26611d87bf1c3da58062fa
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 13 15:56:34 2022 -1000

    Bug 20076: DBRev 21.12.00.007
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8a8e1056957deb683f128bc4b65ab36538d167ea
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jan 13 15:33:09 2022 -1000

    Bug 20076: (RM follow-up) Fix system preference boolean logic
    
    A Yes/No system preference must use 1 for Yes and 0 for No.
    So "Send" for 1/Yes and "Don't send" for 0/No.
    We add too much problems with double-negation boolean system preferences (such as dontmerge).
    
    Previous patch changed default value to 1 in atomicupdate, do the same
    in installer/data/mysql/mandatory/sysprefs.sql
    
    Also to be consistant, sets options = NULL instead of '' in atomicupdate
    
    Also removed useless added empty line in /misc/cronjobs/overdue_notices.pl
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cbd9b75e6bbd01d3842c98d49cbfe725f1cdbaef
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Dec 19 14:17:33 2021 +0100

    Bug 20076: (QA follow-up) We need to default to 'Send' on update to keep existing behavior
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7714ebb666b13bc2b5e17def1c737674763c4416
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Dec 19 14:16:23 2021 +0100

    Bug 20076: (QA follow-up) Rephrase system preference description sightly
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 58f653fde10fca8ad9f7c193121e243ca834a7be
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Dec 19 02:55:49 2021 +0000

    Bug 20076: (QA follow-up) Reformat database update to use newer format
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 43cb3b299c9596039611eca1eefd99156920caa5
Author: Thibaud Guillot <thibaud.guillot@biblibre.com>
Date:   Fri Dec 10 15:02:03 2021 +0000

    Bug 20076: Add syspref to remove overdues notification by email to staff if user has no email address
    
    I took the same test plan as victor but I added the system preference to manage the case more easily, especially for users who do not have access to the koha server.
    
    Test plan
    1. Check the size of the message queue
         With the following SQL query (using an SQL report if you want)
         SELECT COUNT(*) FROM message_queue;
    2. Run misc/cronjobs/overdue_notices.pl
    3. Check the size of the message queue
         To ensure that no other overdues will create noise in this test plan.
         Or you can take them into account.
    4. Choose a patron with no email address
    5. Create an overdue (checkout an item and unfold "Checkout settings"
       and set a date in the past which is compatible with what you find in
       staff:/cgi-bin/koha/tools/overduerules.pl
    6. Run misc/cronjobs/overdue_notices.pl
    7. Check that you have two new messages in the queue
    8. Inspect these two messages
       SELECT * FROM message_queue ORDER BY time_queued DESC LIMIT 2 \G
       1. One has the type "print" and the borrowernumber matching the patron.
       2. The other has
            subject: Overdue Notices
            borrowernumber: NULL
            message_transport_type: email
            and contains "These messages were not sent directly to the patrons."
            This is the one we don't want anymore.
            Because it's now obsolete due to the first message.
    9. Apply this patch
    10. Run updatedabatase.pl
    11. Change syspref 'EmailOverduesNoEmail' to "Don't send"
    12. Delete data from message_queue (if you have access) for a cleaner view
    13. Run again misc/cronjobs/overdue_notices.pl
    14. Check that only the print message is now generated and not the
          "Overdue Notices" one.
    
    https://bugs.koha-community.org/show_bug.cgi?id=20076
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 600f9648e832ebe3564ec86a9bfc8c06f0465a92
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 23 18:27:21 2021 +0000

    Bug 29530: Fix handling of NumSavedReports preference in reports table
    
    This patch updates the way the NumSavedReports preference value is used
    on the saved reports page so that the setting is correctly incorporated
    into the DataTable.
    
    The patch also expands the description of the NumSavedReports preference
    in order to clarify the expected behavior when no value is saved.
    
    To test, apply the patch and go to Administration -> System
    preferences and note the value of NumSavedReports.
    
     - Go to Reports -> Use saved.
     - Confirm that the first page of saved reports shows the number
       specified in NumSavedReports.
     - In the "Show" dropdown menu, confirm that the number from
       NumSavedReports is preselected by default.
       - Expand the dropdown menu to confirm that the NumSavedReports number
         is positioned sequentially with the default values. For example, if
         NumSavedReports = "78," the menu options should be
         "10, 20, 50, 78, 100, All".
     - Test with various values of NumSavedReports. A blank value should
       result in the "All" option being selected. A non-numeric or
       non-positive value should result in the default set of options being
       used ("10, 20, 50, 100, All").
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7eb196982808b14776eb3550147f0f2987483b3d
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Nov 18 10:30:33 2021 +0000

    Bug 29516: Remove dependency on IO::Scalar
    
    IO::Scalar is used in Koha::App::Plugin::CGIBinKoha to create a
    filehandle tied to a scalar.
    Perl has this feature built in since 5.8.0 so IO::Scalar is not needed
    
    I'm not sure how to test this, since it should behave exactly the same
    with or without the patch, but we can at least verify that it doesn't
    introduce encoding issues.
    
    Test plan:
    1. Run `morbo bin/intranet`
    2. Go to http://localhost:3000
    3. Create a bibliographic record with some non-latin characters (try
       emoji characters for instance). Verify that there is no visible
       encoding issues.
    4. Save this record as MARCXML and re-import it as a new record using
       Tools » Stage MARC records for import. Verify that the new record has
       no visible encoding issues
    5. `git grep IO::Scalar` should not return any result
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit efce19392fa9ec10335658dec0974e5f1d76ba4a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 17 16:09:02 2021 +0000

    Bug 29491: Improve display of notices in patron details
    
    This patch updates the patron notices list so that notices are shown in
    a modal dialog instead of inline in the table. The "Resend" button is
    shown in the modal window controls.
    
    To test, apply the patch and locate a patron in the staff interface with
    multiple sent notices.
    
    - View the patron's "Notices" tab.
    - In the table of notices, click one of the notice titles.
    - A modal window should appear with the notice subject as the header
      and the notice content in the main body of the modal.
      - If the message has any other status than 'pending' there should be a
        "Resend" button in the modal footer. Confirm that it submits the
        form and resends the correct message.
      - Try viewing multiple notices to confirm that the contents of the
        modal are correctly updated for each message.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2abdce7c948fb14db1fa5b21a7929bd1c02e02cd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 17 15:35:37 2021 +0000

    Bug 29491: (preparatory step) Reindent template
    
    Step 1: Replace tabs with spaces and reindent. This patch should include
    only whitespace changes. If you view the diff while ignoring whitespace
    there should be no changes.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 80c3c918821fb3426f1439f2a3b692cf9a49cbcb
Author: Florian Bontemps <florian.bontemps@biblibre.com>
Date:   Thu Nov 25 08:59:03 2021 +0000

    Bug 24866: Changed $raw for html for extra safety
    
    Same test plan as before
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 95186ffd0c58f538699ec0d3beee0f930225090a
Author: Florian Bontemps <florian.bontemps@biblibre.com>
Date:   Tue Nov 9 13:36:36 2021 +0000

    Bug 24866: (follow-up) Replaced tabulations by dashes
    
    The rendering of SELECT elements is up to the browser.
    But Bug 16123 CSS code 'style="padding-left: xx' doesn't work on modern browsers.
    
    Based on the previous contribution, this fix replaces CSS style attribute with dashes, creating a leveled structure that should work with most browsers.
    
    Tested on Linux Ubuntu with Firefox 94.0, Chromium 95.0.4 and Opera 81.0.1
    TEST PLAN :
    
    1. Go to the Administration module
    2. Add a new budget (ie : Budget 2022)
    3. Add a fund to this budget (ie : Book)
    4. Add a sub-fund to fund Book (ie : Fiction)
    5. Add another sub-fund, this time to sub-fund Book (ie : Adult fiction)
    You will have this hierarchy :
    
    Budget 2022
     |____ Book
             |_____ Fiction
                    |_____ Adult fiction
    
    6. Go to the Acquisition module
    7. Select a vendor and create a new basket
    8. Place an order
    9. Check the budget dropdown menu
    
    BEFORE PATCH
    Book
    Fiction
    Adult fiction
    
    OR
    
    Book
       Fiction
             Adult fiction
    
    AFTER PATCH
    Book
     -- Fiction
     -- -- Adult fiction
    
     Co-authored-by: Didier Gautheron <didier.gautheron@biblibre.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3487877f569b25a914a5fdd5069ad3fc5562dbbd
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Mon Apr 6 14:30:40 2020 +0000

    Bug 24866: Display budget hierarchy in the budget dropdown menu used when placing a new order
    
    The rendering of SELECT elements is up to the browser.
    But Bug 16123 CSS code 'style="padding-left: xx' doesn't work on modern browsers.
    
    This patch replace CSS style attribute with &emsp; html entity.
    
    On supported platforms
    TEST PLAN :
    
    1. Go to the Administration module
    2. Add a new budget (ie : Budget 2020)
    3. Add a fund to this budget (ie : Book)
    4. Add a sub-fund to fund Book (ie : Adult fiction)
    
    You will have this hierarchy :
    
    Budget 2020
     |____ Book
             |_____ Adult fiction
    
    5. Go to the Acquisition module
    6. Select a vendor and create a new basket
    7. Place an order
    8. Check the budget dropdown menu
    
    BEFORE PATCH
    Book
    Adult fiction
    
    OR
    
    Book
       Adult fiction
    
    AFTER PATCH
    Book
       Adult fiction
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fccf1433301b7e120d2a27d949e6312e0be89515
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Dec 13 12:01:24 2021 +0000

    Bug 29685: Reduce item processing by calculating 'items any available' outside of loop
    
    See bug 24185, this avoids looping every each item of the record for every item of the record
    
    How to reproduce:
    
    1) on freshly installed kohadevbox create/import one book,
    remember that biblionumber for later use it in down below,
    
    2) add 100 items for that book for some library,
    
    3) find some patron, that patron's card number we will
    use as a borrower down below to open holds page,
    
    4) check for the rule or set up a single circulation rule
    in admin "/cgi-bin/koha/admin/smart-rules.pl",
    that rule should match above book items/library/patron,
    check that rule to have a non-zero number of holds (total, daily, count) allowed,
    and, IMPORTANT: set up "On shelf holds allowed" to "If all unavailable",
    ("item level holds" doesn't matter).
    
    5) open "Home > Catalog > THAT_BOOK > Place a hold on THAT_BOOK" page
    ("holds" tab), and enter patron code in the search field,
    or you can create a direct link by yourself, for example, in my case it was:
    /cgi-bin/koha/reserve/request.pl?biblionumber=4&findborrower=23529000686353
    
    6) it should be pretty long page generation time on old code, densely increasing for every hundred items added. In the case of this solution, it's fast, and time increases a little only, linear.
    
    In testing with 100 books I went from ~6.5 seconds to ~3.2 seconds
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cd0d647c61845276b628aaa197d4b9ec057948d8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 12 09:46:46 2022 +0100

    Bug 29856: Make the ES config more flexible
    
    I need to add a 'request_timeout' entry to the ES configuration to fix some timeout problems on the sandboxes.
    
    Instead of hard coding this new option it seems preferable to be
    flexible and allow different options to be passed from the config file.
    
    Test plan:
    Add to the $KOHA_CONF, inside the elasticsearch section
      <request_timeout>60</request_timeout>
    Rebuild the ES index
      koha-elasticsearch --rebuild kohadev
    Change the value of the timeout to 1
    Rebuild the index
    It should fail (with a quite bad error 'Bad response received when
    submitting request to Elasticsearch')
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9f8c77e864be9f142f3f0d44e6319f5e4b26cc9a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jan 11 20:30:21 2022 -1000

    Bug 29788: Fix t/db_dependent/Reserves.t
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 42491ed1c38de87fdd5ffe2c0015e06132ddc783
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jan 11 11:45:26 2022 -1000

    Bug 29557: DBRev 21.12.00.006
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f2389de803a8fd59dd739d3d7f7840db43f3efb0
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Dec 19 12:05:18 2021 +0100

    Bug 29557: (QA follow-up) Add note for translated notices to update statement
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9c10d754431260150af8336a24ad7683c8fb3538
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 23 14:48:22 2021 +0100

    Bug 29557: Add auto_account_expired to AUTO_RENEWALS
    
    It was missing and the notice sent was not providing the reason of the
    failure.
    
    Test plan:
    Check an item out with a date in the past, mark it as auto renew
    Modify the expired date of the patron and set it in the past
    Run the automatic_renewals.pl cronjob script, confirm that the notice
    now contains the reason of the failure.
    
    QA note: The template will be updated only for English installations.
    Should we add an alert for others?
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f004ad000d288b6288c4cf131e61ba569ac9fba6
Author: Florian Bontemps <florian.bontemps@biblibre.com>
Date:   Wed Oct 27 12:50:42 2021 +0000

    Bug 17127: Remove notes from detail.tt to only use MARCNOTES
    
    Notes come from the biblio table, but that table is already used to fill in MARCNOTES through Biblio.pm and get_marc_notes.
    Get_marc_notes does check for NotesToHide and already read every note on the records, but .notes doesn't go through that same filter.
    I don't see the point of keeping notes as a condition when MARCNOTES does the same job but better.
    
    To test:
        1) Take any record, or create one
        2) Input something in the 500 field (or 300 in UNIMARC)
        3) In Systempreferences -> NotesToHide, fill in the number 500 (or 300).
        4) Save, then go look at the record detail in the OPAC and admin website.
        5) You should still see the 500 or 300 field under the Description tab.
        6) Apply patch.
        7) Reload the record detail page.
        8) Observe the error is gone.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c780d61f90a385026f2b442767035211705fe997
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 16 11:55:08 2021 +0100

    Bug 29419: Retain user's inputs when suggesting for purchase and match found
    
    If a user suggests for purchase and a match is found, their inputs was
    not retained: quantity, item type, library, reason.
    
    Test plan:
    1. Suggest for purchase
    2. Fill the title in with a string that will match an existing record
    3. Fill value in quantity, item type, library and reason input/dropdown
    4. Submit
    => Notice that with this patch the values you entered are retained on
    the confirmation screen
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1824b761a8626cb13ea8ba911a6e4b0bcb49c89d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 13 10:40:18 2021 -0300

    Bug 29688: Incorrect use of _() in holds.js
    
    Bug 29404 moved code from request.tt into holds.js, and I didn't know
    about the _() vs. __().
    
    This patch fixes that.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 06f1a2429703bee39c2676fec645fdf3bea60355
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 10:27:30 2022 +0100

    Bug 29788: Fix batch delete item
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 21bc236e57bfaa46b80602e3d34f0f6f2175d14a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 4 15:34:48 2022 +0100

    Bug 29788: Make Koha::Item->safe_to_delete use Koha::Result::Boolean
    
    This patch reuse the (awesome) Koha::Result::Boolean module to retrieve
    the return of Koha::Item->safe_to_delete.
    
    Test plan:
    Try to delete an item that has previously been checked out and confirm
    that you are still blocked.
    Try using the cronjobs, the item and biblio detail pages, as well as the
    batch delete item tool.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 381898d8ca2a78319dfc9e6d8e44564754172766
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 4 15:59:15 2022 +0100

    Bug 29790: Restore warning if deletion of serial item fails
    
    If the deletion of a serial item failed, the UI did not provide a warning/error message.
    
    Test plan:
    0. Create a new subscription with "Create an item record when receiving
    this serial"
    1. Receive a new item, set a barcode
    2. Check it out
    3. Select the item you have received in the serial item list (page
    "Serial collection information") and click "Delete selected issues"
    4. Tick "Delete the associated items" and confirm the deletion
    => Without this patch the deletion fail but the UI does not warn it
    => With this patch applied you see a warning "one or more associated
    items could not be deleted at this time."
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d85328ee3c67ef08d2df7321150502f5f91ef87e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jan 4 15:40:19 2022 +0100

    Bug 29789: Remove unused $error from cataloguing/additem.pl
    
    my $error        = $input->param('error');
    
    It should be removed as $error is used later but not related to this variable.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c56b74ae9c970c75f314667001f96417a1a68ccb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 17 12:53:28 2021 -0300

    Bug 29553: (QA follow-up) Check defined instead of evaluating as boolean
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f9fc43eb6f14687136f5da24e32c8230555c5bdd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 17 12:52:17 2021 -0300

    Bug 29553: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0195da0a8a6ff3a5f3360d511de1625dec5f953d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Nov 22 10:53:07 2021 +0000

    Bug 29553: Fix crash on undefined notforloan value
    
    Test plan:
    Set item level itypes to biblioitems.
    Find a record with itemtype NULL, having an item.
    Place a hold. Without this patch, it crashes.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: ThibaudGLT <thibaud.guillot@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 4b3b6f199659934e4d6737b3cc6206bdf32c9c15
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 2 13:10:35 2021 +0000

    Bug 29391: Improve output of reservoir search
    
    This patch makes the cataloging reservoir search results a configurable
    DataTable. The empty edition and date columns are removed, and an import
    data column is added.
    
    To test, apply the patch and go to Cataloging.
    
    - Perform a cataloging search which will return results from the
      reservoir.
    - The table of reservoir search results should be a DataTable with
      paging, navigation, filtering, column configuration, etc.
      - Confirm that all DataTable controls work correctly.
    - Go to Administration -> Table settings -> Cataloging -> addbooks.
      - Try modifying the default configuration and confirm that the
        settings take effect.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e2e2e4bed26aeb4d5a593e2262e74f2ca32f5c86
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Sun Jan 9 20:52:36 2022 -1000

    Bug 29778: DBREv 21.12.00.005
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c2e91f7248d12f367a738eea70bf6576e7c351d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jan 5 16:45:34 2022 +0100

    Bug 29778: Remove DBMS error
    
    ERROR - {UNKNOWN}: DBI Exception: DBD::mysql::db do failed: Table 'additional_contents' is specified twice, both as a target for 'DELETE' and as a separate source for data at /kohadevbox/koha/C4/Installer.pm line 738
    
    Happened on MariaDB 10.1 and 10.3, not 10.6
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0c4590160aabaa3adb082554c8173ee4f641dff6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 3 11:31:54 2022 +0100

    Bug 29778: Prevent orphan additional contents
    
    When deleting a content, only the main one (lang="default") is removed,
    which leads to orphan contents in the DB that are still displayed on the
    UI.
    
    Test plan:
    0. Don't apply this patch
    1. Create some contents, translate them in different languages
    2. Delete some of them
    => Note that they are still displayed on the UI and that the entries
    with lang!="default" are still in the DB
    3. Apply this patch
    4. Repeat 1
    5. Run updatedatabase
    6. Delete from of the contents
    => Note that the orphan entries created before you applied the patch
    have been removed and that the "delete" behaviour is now working
    correnctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cb6ef3ac19a6e10c4aa878904788832b3fd9eed4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 20 13:49:44 2021 +0100

    Bug 29737: Remove some unecessary parameters
    
    We don't need them. We could also remove the biblionumber but it
    requires change to the controller I'd prefer to not do now.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fd1b110fd5a1e0a4e75bc874517bb0b80958231d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 20 13:45:04 2021 +0100

    Bug 29737: Fix suspend from hold list
    
    From holds list of a bibliographic record, the "unsuspend" button does not work as expected.
    The form is submitted but the suspension is still there.
    
    There are 3 requests, 2 GET and 1 POST.
    One of the GET is rejected by Firefox (NS_BINDING_ABORTED)
    
    Test plan:
    Place some items on hold, play with suspend/unsuspend from the hold list
    /cgi-bin/koha/reserve/request.pl?biblionumber=XX
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e4f4a7ea98c64b7726784d58b174eb010ae9d4f2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jan 4 16:55:05 2022 -0300

    Bug 29794: (follow-up) Add license
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit db5c5c0bc724e1583f7741b0a7ed74ca97fd0cd4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jan 4 16:51:18 2022 -0300

    Bug 29794: Add missing include in delete_items.pl
    
    This patch adds a missing include so the script is no longer broken.
    
    To test:
    1. Choose an item that is checked out and copy its barcode
    2. Run:
       $ kshell
      k$ perl misc/cronjobs/delete_items.pl --verbose \
              --where "barcode='39999000010831'"
    => FAIL: It explodes with:
    Can't locate object method "find" via package "Koha::Items"...
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: You get:
    Where statement:  where barcode='39999000010831'
    Item '549' not deleted: book_on_loan
    5. Sign off :-D
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 60f6fe17f436c26e45c8b011aefc16e86e7a1486
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Dec 21 13:20:46 2021 +0000

    Bug 29747: Delete columns that don't exist from settings
    
    This patch simply checks if we are callinmg from the plugin, and removes
    two columns from the settings if so
    
    To test:
     1 - In Admin->Marc bibliographic framework got to Marc Structure for default framework
     2 - Search for 856$u
     3 - Set Plugin to upload.pl
     4 - Edit a record in the default framework
     5 - Under 856u, click 'Upload'
     6 - Uplaod a file and then click 'Choose'
     7 - nothing happens
     8 - View consiole (f12) and see error
     9 - Apply patch
    10 - Reload the page
    11 - No more error
    12 - Click choose
    13 - Record link is populated
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3eb7480e0c58f095a138d3efc16746699db3ccf9
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Sun Jan 9 20:21:54 2022 -1000

    Bug 26296: DBrev 21.12.00.004
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 432f296b965485b56e9fdead1873c28fdcb87a65
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 8 17:27:03 2021 +0000

    Bug 26296: (follow-up) Make sure title remains mandatory
    
    This patch adds a flag to the OPAC preferences file marking suggestion
    title as mandatory OPACSuggestionMandatoryFields and excluded from
    OPACSuggestionUnwantedFields.
    
    The patch also modifies the markup around required fields in the OPAC
    suggestion form to comply with changes made in Bug 27668 to mandatory
    field styling.
    
    To test, apply the patch and restart services.
    
    - Test the OPACSuggestionMandatoryFields preference. In the modal,
      "title" should be checked and the label in red. It should not be
      possible to uncheck the checkbox.
      - Test that the "Select all" and "Clear all" links don't affect the
        "title" checkbox.
      - Confirm that your selections are still saved correctly.
    - Test the OPACSuggestionUnwantedFields preference. In the modal,
      "title" should be unchecked and disabled.
      - Test that the "Select all" and "Clear all" links don't affect the
        "title" checkbox.
      - Confirm that your selections are saved correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fe46f077a7b27ebb82891abf37144ba9f4fd59ea
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 8 20:06:45 2021 +0000

    Bug 26296: Use new table column selection modal for OPAC suggestion fields
    
    This patch builds on the change introduced by Bug 22844, changing the
    selection mode for the OPACSuggestionMandatoryFields and
    OPACSuggestionUnwantedFields preferences to a modal.
    
    This patch includes a database update for converting the format of the
    saved values in these preferences. Previously the suggestions table
    fields would be separated by a comma. Now they should be separated by a
    pipe.
    
    To test, apply the patch run the database update.
    
     - Go to Administration -> System preferences.
     - Search for 'OPACSuggestion.'
     - The input fields for OPACSuggestionUnwantedFields and
       OPACSuggestionMandatoryFields should appear as "locked" (read-only)
       inputs.
     - Clicking either input field should trigger a modal window with
       checkboxes for each available column in the suggestions table.
     - Test that the "select all" and "clear all" links work correctly.
     - Test that the "cancel" link closes the modal without saving your
       selections.
     - Test that the "Save" button closes the modal, copies your
       selections to the form field, and triggers the preference-saving
       function.
     - Test that changes to both preferences are correctly reflected in the
       OPAC suggestion form.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 895fc88605f7381218b38463be17531a06403c1a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 17 16:36:11 2021 -0300

    Bug 29508: Make GET /patrons/:patron_id use Koha::Patrons->search_limited
    
    This patch makes the route return 404 if the user is not allowed to see
    the requested patron information.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: The code doesn't respect limits
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d46debdff26d1bc0290149e0da3d1f8ae60cf9cb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 17 16:35:33 2021 -0300

    Bug 29508: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c9cb8e5879a1cfac2bbe8e878107c47832164f56
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 17 14:57:26 2021 -0300

    Bug 29506: (follow-up) Adapt GET /patrons
    
    This patch makes GET /patrons rely on this new behavior from the
    objects.search helper.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 13fba03080af3389217ca0c152a08521e0b9cd42
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 17 14:30:21 2021 -0300

    Bug 29506: Make objects.search call search_limited if present
    
    This patch makes objects.search implicitly update the passed
    *$result_set* to use search_limited. This way no object leaks could
    happen without noticing.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/REST/Plugin/Objects.t
    => FAIL: Tests fail because search_limited is not used
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! Results are correctly filtered based on userenv!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 91123608b25cc9413eda768c812c051376cbd23f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 17 14:30:11 2021 -0300

    Bug 29506: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 152bc1f04eb075ea2f3f276e5371263704586a81
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 17 13:07:12 2021 -0300

    Bug 29503: Make GET /patrons use Koha::Patrons->search_limited
    
    This patch makes the controller method use Koha::Patrons->search_limited
    so filters based on configuration and permissions apply when fetching
    patrons.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Boo, you get more patrons than you should
    3. Apply the patch
    4. Repeat 2
    => SUCCESS: Yay! Things are filtered as expected (i.e. using
    Koha::Patron->libraries_where_can_see_patrons)
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2b432cec1d904af62655a77cc91a707a3820e356
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 17 13:07:07 2021 -0300

    Bug 29503: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 724f53e5ec86667fa74590da086e69403c1ae542
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Dec 13 14:13:54 2021 +0000

    Bug 29680: Change markup to correct button radius
    
    This patch alters the markup around the "Show SQL/Hide SQL" buttons so
    that they are not styled as if they are a button group.
    
    To test, apply the patch and run an SQL report.
    
    The "Show SQL code" button should be styled consistently with other
    single buttons in the toolbar. Click it to test that the "Hide SQL code"
    button is also correct.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Andreas Roussos <a.roussos@dataly.gr>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit cf86a5554deb417dc7be4040d5a5997778c835c2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 27 11:39:10 2021 -0300

    Bug 29772: (follow-up) Document error codes
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 82c32a1aa50a86b87d303014866d48a2a747700c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 27 11:37:59 2021 -0300

    Bug 29772: Make DELETE /patrons/:patron_id return error codes
    
    This patch makes the controller add the error_code attribute on error
    conditions payload.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Boo, the API doesn't include the error_code attribute on the
    error responses for the DELETE /patrons/:patron_id route
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! error_code is included in the response!
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b3fe6a4ba399b92d061dfb92446d9d259915ccf9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 27 11:37:35 2021 -0300

    Bug 29772: Regression tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 770e263b870377e03100d5ec232fa98e6d5153f2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 23 11:47:19 2021 -0300

    Bug 29765: Adjust DELETE /patrons/:patron_id controller
    
    This patch adjusts the only current place using the
    Koha::Patron->safe_to_delete method to the new return value. There
    should be no behavior change
    
    To test:
    1. Apply the previous patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Tests fail, because of the change, the controller is broken
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! No test tweak required, no behavior change
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ed2acc9266bd3edd563243232d219ef2e3fadef9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 23 11:43:52 2021 -0300

    Bug 29765: Make Koha::Patron->safe_to_delete use Koha::Result::Boolean
    
    This patch makes the safe_to_delete method in Koha::Patron return this
    new object type instead of a plain string. This way we have a consistent
    way to deal with 'can_*'-like methods return values when feedback is
    needed.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => SUCCESS: The adjusted tests pass. Tests cover the boolean context
    eval and also the carried messages, that include the same string code
    that was returned originally.
    3. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 367a90ca189b0c3f49a7b3a87ce023070a7f05ea
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jan 4 15:58:54 2022 -0300

    Bug 29746: (it-doesn't-hurt follow-up) More tests
    
    In an attempt to add (even) more tests for this library, we wanted to
    add tests for the return values initialization and then hit
    a wall when trying to add tests: Test::More tries to compare in string
    context first [1], and when you force integer context (by using cmp_ok +
    '==') it tells '==' is not overridden for the class.
    
    So this patch adds those tests, and also the overloaded '==' operator
    that is required for such tests.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/Koha/Result/Boolean.t
    => SUCCESS: Tests pass
    3. Sign off :-D
    
    [1] https://metacpan.org/pod/Test::More#Overloaded-objects
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a8ab17f82326e34b7a6708e636ab56230a7399a0
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 21 09:44:24 2021 -0300

    Bug 29746: Add Koha::Result::Boolean
    
    This patch introduces a new OO class that can be used as return value
    from methods that need to return boolean values, but also provide some
    feedback. This last bit is implemented using Koha::Object::Message
    objects that can carry valuable information.
    
    This class can also implement a `to_api()` method so it is suitable for
    API usage. And so the Koha::Object::Message class. Will be done as
    needed.
    
    If some other result types are required, then we can move some of the
    messaging logic to a top-level Koha::Result class this one inherits from
    (and the new one as well, say, Integer?).
    
    To test:
    1. Apply this patchset
    2. Run:
       $ kshell
      k$ prove t/Koha/Result/Boolean.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 01a38cfebd943602c35b2440d0be2f6578eec6a4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Dec 21 09:44:09 2021 -0300

    Bug 29746: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dbd69d66506fbde8a6b8a2b2120d962561bd32b6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 20 15:11:02 2021 -0300

    Bug 29741: (follow-up) Make DELETE /patrons use the new validation method
    
    This patch adapts the route so it uses the newly introduced
    Koha::Patron->safe_to_delete method.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Note: There's a trivial behavior change, in which the 'anonymous patron'
    use case is caugh eariler than the ->delete call. I left the exception
    catch block just in case, who knows :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b3f19f1e95fff652fdc889e01ff2f75b38055bae
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 20 14:17:49 2021 -0300

    Bug 29741: Add Koha::Patron->safe_to_delete
    
    This patchset adds a handy method for checking if a patron meets the
    conditions to be deleted. This conditions are:
    
    - Has no linked guarantees
    - Has no pending debts
    - Has no current checkouts
    - Is not the system-configured anonymous user
    
    To test:
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => FAIL: Of course heh
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass, conditions are validated and the right string is
    returned on each case
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b28f35efbfa85bf69b5eb784b887e9ded779bd0d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 20 14:17:31 2021 -0300

    Bug 29741: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b7b6a85de591df246e1c11b94e0bffac47f23f78
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 27 09:51:31 2021 -0300

    Bug 28020: (follow-up) Add docs about error_code on the API
    
    This patch intends to be a guide for inserting Markdown documentation
    for error codes. The idea is that it can be copied and pasted as-is in
    new routes. And adapted to new error codes.
    
    To test:
    1. Apply this patch
    2. Run:
       $ npx redoc-cli@0.10.4 bundle --cdn --output index.html \
                api/v1/swagger/swagger.yaml
    => SUCCESS: It builds correctly
    3. Open index.tml on your browser
    4. Pick a route, and see the 500 status description includes information
       about the possible `error_code` values.
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8dee5083ebb1c72a8f3e848826374dfbc072551f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 27 08:27:24 2021 -0300

    Bug 28020: Add error_code to error responses
    
    This patch adds the *error_code* attribute to the error response
    definition. This way it can be added when returning an error.
    
    I also made a sample usage of it on the generic unhandled_exception
    helper, which the unit tests on this patchset expect.
    
    To test:
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/unhandled_exceptions.t
    => FAIL: The unhandled_exception() helper doesn't return an error_code
    in the response payload.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 320437e7bd980779e44aa930b83741405f124fbb
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 27 08:20:11 2021 -0300

    Bug 28020: Unit tests
    
    The unhandled_exception() Mojo helper didn't have proper tests. As this
    bug is adding a slight behavior change, I tried to add some. As it
    relies on the OpenAPI plugin, it cannot be done the usual way using
    Mojo::Lite. So I picked a route and forced an exception through mocking
    to be able to write tests.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/unhandled_exceptions.t
    => FAIL: The unhandled_exception() helper doesn't return an error_code
    in the response payload.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 942d7cd8a69b222ca9b914970bee2b8cf5b65acf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 20 12:05:59 2021 -0300

    Bug 29018: Make DELETE /patrons/:patron_id check things
    
    When the route was implemented, the checks were overlooked. This patch
    adds checks for:
    - Guarantees
    - Debts
    - Current checkouts
    
    Any of those will block deletion, as it should.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: Tests fail, the route misses checks
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! The three conditions prevent deletion!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a0a8e08989dd77bba28a7f236268dd74767e9053
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 20 12:05:28 2021 -0300

    Bug 29018: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 442fb97155285ff4063cdd6279328ebed62ea6d4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 7 16:44:47 2021 +0000

    Bug 28876: Wrap no renewal before advisory text in selector
    
    This patch adds some more <span>s to the user summary page in the OPAC
    so that information about renewal status can be targeted with CSS or JS.
    It adds each <span> with a "usr-msg" class for general styling and a
    specific class for each renewal message, e.g.
    
    <span class="usr-msg no-renew-hold">Not renewable <span
    class="renewals">(on hold)</span></span>
    
    These classes are added:
    
    - no-renew-hold - Not renewable (on hold)
    - no-renew-too-many - Not renewable (too many renwals)
    - no-renew-unseen - Item must be renewed at the library
    - no-renew-overdue - Not allowed (overdue)
    - no-renew-too-late - No longer renewable
    - auto-renew-fines - Automatic renewal failed, you have unpaid fines
    - auto-renew-expired - Automatic renewal failed, your account is expired
    - no-renewal-before - No renewal before [date]
    - automatic-renewal - Automatic renewal
    
    To test, apply the patch and try to locate or set up a patron to have
    multiple checkouts with multiple renewal conditions:
    
    - On hold
    - Too many renewals
    - Overdues (if  OverduesBlockRenewing is on)
    
    ...etc.
    
    In the OPAC, log in and view the table of checkouts on the "your
    summary" page. Confirm that messages in the "Renew" column are marked up
    correctly.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    JD amended patch: fix commit title
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 197f73e8ae7412de6337daa3b35a0a1e4ea51a80
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Dec 14 15:43:18 2021 +0000

    Bug 29693: Make CodeMirror work again
    
    To test:
    1. Go to Tools > HTML customizations
    2. Open or create a new entry with CodeMirror. ( Edit with text editor )
    3. CodeMirror doesn't work, you don't see line numbers or syntax highlighting
    4. Apply patch
    5. Try steps 1 & 2 again. The CodeMirror editor should now load.
    6. Make sure it works in both the Default and English(en) tabs.
    7. BONUS: install some other language packs and look at the tabs for that language, it should still work.
    8. Try 5 and 6 again but with Additional contents (News) instead of HTML customizations
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0c8496a85af997a1a5f367d975e252e637c087ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Dec 14 12:08:13 2021 +0100

    Bug 29689: (bug 28445 follow-up) Fix AutoBarcode=hbyymmincr
    
    The selector is not correct, we must to not rely on the number.
    This patch fixes a regression caused by bug 28445, but also a
    long-standing bug.
    
    * Regression:
    The barcode plugin is broken is autoBarcode=<branchcode>yymm0001
    There is a JS error in the console:
      Uncaught TypeError: form.field_value is undefined
          Focustag_952_subfield_p_878344
          Focustag_952_subfield_p_878344_handler
          jQuery 11
          BindEventstag_952_subfield_p_878344
    
    * Long standing bug:
    If there are several item forms on the same page, the branchcode is not
    correctly retrieved. For instance on the "Serial edition" page there are
    2 item forms, the homebranch that is used by the barcode plugin will be
    the one from the last form.
    
    Test plan:
    * regression
    Set autoBarcode=<branchcode>yymm0001
    Catalogue a new item, click into the barcode input
    Notice that without this patch you get a JS error in the console
    
    * long standing bug
    Create a new subscription, select "Create an item record when receiving this serial".
    Receive a serial
    Open the 2 item forms ("Click to add item")
    Select 2 different home library and click the barcode inputs.
    The prefix (branchcode) should be correct with this patch applied.
    
    QA Note: it would be way easier if all add item forms were using the new
    methods, it could be:
      let loc = document.getElementsByName('items.homebranch')[0].value;
    Yes, that's all!
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3d1556dafa7cd09614f86512cae8fa2e215d9ab7
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Dec 13 07:49:07 2021 +0100

    Bug 29571: (follow-up) Fix display of pending suggestions in acqui-home.tt
    
    In addition to the Staff Client's home page, the number of pending
    suggestions is also displayed in Home > Acquisitions. Currently,
    these are only displayed if there are pending suggestions at the
    logged in library. However, suggestions should always be displayed.
    
    This follow-up patch fixes that, and also removes a template variable
    (`suggestion`) that is no longer in use (removed as part of Bug 4331,
    commit 70af4593722ce2f3debd4f6d2c251ad29008b923).
    
    Test plan:
    1) Create a suggestion for Library A.
    2) Go to Home > Acquisitions while logged in at Library B.
       Without this patch, nothing is displayed regarding suggestions.
    3) Apply this patch. Notice how suggestion information is shown, like:
       "Manage suggestions: Library B: 0 / All libraries: 1"
       If you change the library to Library A, you should get:
       "Manage suggestions: Library A: 1"
    
    Signed-off-by: Florian Bontemps <florian.bontemps@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c4c2aa2e3301afe7ba64762144cbff0b9017ff53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 25 14:06:07 2021 +0100

    Bug 29571: Display all pending suggestions even if none from logged in library
    
    The number of pending suggestions was only displayed if there are pending
    suggestions at the logged in library.
    
    Test plan:
    Login at CPL
    Create a suggestion (ASKED) for another library
    => Without this patch there is nothing on the mainpage
    => With this patch applied you will see info about pending suggestions:
    
    "Suggestions pending approval: Centerville: 0 / All libraries: 1"
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: ThibaudGLT <thibaud.guillot@biblibre.com>
    Signed-off-by: Andreas Roussos <a.roussos@dataly.gr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ebb544dd91fe0dfef1a2fd3ce5e5eb3b11476475
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 13 15:42:39 2020 +0000

    Bug 29591: Add autorenew_checkouts column to preferences json
    
    Bug 24476 added autorenew_checkouts as a borrower column, intending it to be able to be
    hidden if a library was not using the feature.
    
    When the column chooser was added, this column was not included.
    
    To test:
    1 - Search system preferences for "BorrowerUnwantedFields"
    2 - Click the box to change the value
    3 - "autorenew_checkouts" is not an option
    4 - Confirm that you see the option to opt patron out of autorenewal when editing patron on staff side
    5 - Apply patch and restart everythign
    6 - Search for the syspref again
    7 - Note that now you can select "autorenew_checkouts"
    8 - Check the box and save
    9 - Confirm the opt out option is no longer visible during patron editing
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 55e16bef7f42935894609d395171d8f5e3fea53e
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Dec 17 21:09:19 2021 +0000

    Bug 29729: Build a tr for each subscription
    
    To test:
    1 To to Reports > Serials > Serials subscriptions and run the report while selecting a branch without subscriptions.
    2 Notice console error
    3 If you run the report for a branch WITH subscriptions it works just fine.
    4 Apply patch
    5 Do 1 again, no console error and show no see 'No entries to show'
    6 Make sure it also works when you have a few subscriptions for a branch as well
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 319f80c45762dd80f1173d0f214582a5a09d93d2
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Jan 3 20:36:27 2022 -1000

    Bug 29604: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 71ea7b8ae7d53642fd8a19acacc50e7c5a92509b
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Dec 2 01:59:06 2021 +0000

    Bug 29604: Dont add psuedo content to highlighted terms
    
    To test:
    1. Do a search for something where the search terms will be in the 505
       note.
    2. Visit the OPAC detail page of the record.
    3. The first occurance of the term highlighting will include the CSS
       pseduo element "→ ";
    4. Apply patch
    5. Do the stuff to regenerate the CSS
       (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_interface)
    6. Do 1 & 2 again.
    7. No weird psuedo element in the term highlighting
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ae7dff6546132443c8cb076eae75b702a949786e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 30 12:07:02 2021 +0100

    Bug 29588: (bug 29478 follow-up) Make strings translatable
    
    "or", "Yesterday", "Today" and "Tomorrow" are not translatable, we are
    using __ when _ should be used (__ is for .js files only).
    
    Test plan:
    0. Apply the patch
    1. cd misc/translator && perl translate update fr-FR
    2. Edit misc/translator/po/fr-FR-staff-prog.po
    Search for "or", "Yesterday", "Today" and "Tomorrow" and translate them
    3. cd misc/translator && perl translate install fr-FR
    4. Enable fr-FR (syspref 'language')
    5. Edit a patron and an item and confirm that the flatpickr widget has
    the strings correctly translated
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: ThibaudGLT <thibaud.guillot@biblibre.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c9263fe32e63733562f043106f877b9527d6dd47
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 9 15:52:36 2021 +0000

    Bug 29289: 'Show fines to guarantor' should have its own id on patron detail page
    
    This patch adds an id attribute to the list item containing the "Show
    fines to guarantor" information on the patron detail page in the staff
    interface. This makes it consistent with the markup for the similar
    "Show checkouts to guarantor" list item.
    
    To test, apply the patch and view a patron's details in the staff
    client. Inspect the source to confirm that the "Show fines to guarantor"
    line has an id, "patron-privacy_guarantor_fines".
    
    Alternatively, add this to the IntranetUserCSS system preference: #patron-privacy_guarantor_fines { background-color: pink; }
    
    The line on the patron details page should be highlighted in pink.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fe6e054c598964fef09f2609f4e453667d4a0037
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 15 07:02:46 2021 +0100

    Bug 29696: Preserve link to biblio when creating a suggestion
    
    Caused by
      commit 586bed1319592e05f5dc3acf64a1dba8cae69d6b
      Bug 28941: Filter suggestion inputs at the OPAC
    
    We are loosing the link with the biblio (suggestion.biblionumber)
    
    Test plan:
    At the OPAC, go to the detail page of a bibliographic record, click
    "Suggest for purchase" and submit the form.
    Without this patch the suggestion is created but the link to the
    bibliographic record is lost
    With this patch applied you should see that suggestions.biblionumber has
    correctly been preserved
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e214d5e9766f629b686673c7ad4a9a2b253434f6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 15 07:02:08 2021 +0100

    Bug 29696: Add tests
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 401ce06ffe23bfb684038ed15328c1884a2e3d11
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 16 16:04:45 2021 +0100

    Bug 29436: ES mappings not saved if zebra is configured
    
    The mappings must be editable even if ES is not turned on yet.
    
    Using a separate array to store the errors as we are testing for $@ ||
    @messages.
    
    There is still something wrong that should be improve, but this patch
    should be safe for backport.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fc690e8f84a055a520b7b07460e06521cdcf9b23
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 21 20:43:34 2021 -1000

    Bug 29457: DBRev 21.12.00.003
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 500446237760f4f779e0902872316789187ab352
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 17 16:49:27 2021 +0000

    Bug 29457: Generic warning at upgrade
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Adding exec flag and two dots.
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f6d6aa3f65a8dc75ce5b3871f3c57b16b97f8228
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 11 10:56:45 2021 +0000

    Bug 29457: Pass context borrowernumber
    
    This patch updates the call to cancel such that we pass the currently
    logged in users borrowernumber instead of their userid.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8140017f8fd7521ccb9b2daeda4ec343080db9ba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 13 12:25:29 2021 +0100

    Bug 26587: Use Koha::Cache::Memory::Lite
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b31eef144b1eba64d84127281830ffb78e5c3ae
Author: Björn Nylén <bjorn.nylen@ub.lu.se>
Date:   Mon May 3 13:13:25 2021 +0200

    Bug 26587: Cache libraries in Koha/Template/Plugins/Branches.pm to improve performance
    
    This patch caches the Koha::Library object in a hashmap in the Branches object (GetName, GetURL)
    to avoid multiple database lookups while looping many items.
    
    To test:
    1. Have a biblio with many items (1000's).
    2. View in staff (detail.pl) and opac (opac-detail.pl). Note how long it takes to load.
    3. Apply patch.
    4. Repeat 2. Note that pages load faster.
    
    Sponsored-by: Lund University Library
    JK: replaced tab indendation with spaces
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7bfba3740b92f132365bb4046c84892455dd1ba8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 16 14:27:03 2021 -1000

    Revert "Bug 29403: Fix api/v1/patrons.t"
    
    This reverts commit bf9107074d77ee0e619849f8857d5d5056244560.

commit a11ccd2d28f1c6040061d9ea6f3842a3d879c3f5
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 16 14:27:02 2021 -1000

    Revert "Bug 29403: Match the whole string"
    
    This reverts commit 62652115dc2b9263c9ac1d9067fdab240f96f9a1.

commit dda19c7811fc05615b42c583b31d83160d4880d6
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 16 14:26:53 2021 -1000

    Revert "Bug 29403: Unit tests"
    
    This reverts commit b09e3e99b7a9dc77c00b462fa4973616aace226e.

commit 7c1b21de3e7283f2e680a6b51987bc3222cba493
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 13 10:17:30 2021 -0300

    Bug 28377: (QA follow-up) .js files should use __()
    
    As noted by QA, this bug contained uses of _() which is not correct in
    include .js files [1].
    
    [1] https://wiki.koha-community.org/wiki/Coding_Guidelines#JS5:_Enabling_translation_of_language_strings_in_linked_JavaScript
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 111f4af2e9cc7838c0462de739f82f7aa1460247
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 9 16:32:50 2021 -0300

    Bug 28377: (QA follow-up) Fallback error handling
    
    The code only dealt with 404, this patch makes it have a fallback
    message for failure codes.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ea8a246225f8af46921dd5e8d90687bf8239cc79
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 9 16:15:20 2021 -0300

    Bug 28377: (28937 follow-up) Flatpickr change
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d9c0c85cf9a8e9c8f3b69829e0be3c85002d44b6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue May 18 17:49:28 2021 -0300

    Bug 28377: (follow-up) Remove svc/hold/{resume|suspend}
    
    This files are no longer used and thus removed. Their functionality is
    already present on the API
    
    POST   /holds/:hold_id/suspension
    DELETE /holds/:hold_id/suspension
    
    To test:
    1. Apply this patch
    2. Run:
       $ git grep 'hold/suspend'
       $ git grep 'hold/resume'
    => SUCCESS: No references to the scripts
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit fab3f92cd0552cb4eb80be1b77e3d1136643c533
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 13 17:37:44 2021 -0300

    Bug 28377: Use the API to suspend/resume holds
    
    This patch makes the patron page (detail and circulation) use the API to
    suspend/resume holds on the holds tab.
    
    It previously used the old svc/ scripts we plan to replace.
    
    To test
    1. Have a patron with some holds
    2. Play with suspending/resuming holds. Include the indefinite
       suspension.
    => SUCCESS: Everything works as usual
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Nothing changed, a soft breeze surprises you
    5. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 65915fedffc50fb8650392b92df8d9d79fe1ec8a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 16 11:34:07 2021 -1000

    Bug 28481: (RM follow-up) formatting
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit e600418c6d0106388809a480bbfe5bf19f41dcc4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Dec 13 09:36:33 2021 +0000

    Bug 28481: (QA follow-up) Set date to 23:59:59
    
    This patch changes the fix from adding a day to setting the time to
    23:59:59.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 7974ecbeabe51643bf83e6ce3a7ebc8c9cabcce6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Nov 29 10:46:06 2021 +0000

    Bug 28481: Make 'to' date inclusive.
    
    Test Plan:
    1) Sell an item
    2) Cash up to make the sale historical
    3) Search "Older transactions" with both dates being the current date,
       click "Display" to search
    4) Note you get no results
    5) Apply the patch
    6) You should now see your transaction
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5bfe34a37552f25cb5f6b4cc3c3671349a712053
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Dec 16 11:26:57 2021 -1000

    Bug 29575: (RM follow-up) remove HTML comments
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 29e3d3d7fe13237fcd5d28dcdc5f9d7bf980513b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 25 12:33:34 2021 +0000

    Bug 29575: (QA follow-up) Patron fields can be empty strings
    
    We need to account for empty strings as well as 'null' values in the
    patron data structure.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0d35f3846661f114102175f5bc1fb08ae1931150
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Nov 25 11:42:17 2021 +0000

    Bug 29575: (QA follow-up) Add JSDoc documentation
    
    This patch adds some basic documentation for the $patron_to_html
    function the patchset introduces.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 633d6d3e67a51810ff09b9ea5b9081944f12904a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 20 18:16:37 2021 -0300

    Bug 29575: Add $patron_to_html to render patron information in JS
    
    This patch adds a re-usable javascript render function that accepts a
    Koha REST api Patron object and outputs the HTML representation.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 81bb6761a23bb0c68aee2bdc43a5b353b7f76157
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Thu Dec 9 15:47:07 2021 +0200

    Bug 29669: fix uninitialized value warnings when XSLTParse4Display is called
    
    Wrong key 'xsl_filename' is present in opac-tags.pl and shelves.pl
    (the only places where it is used in the code even) instead of
    'xsl_syspref' that is actually used and this is the cause of those
    warnings.
    
    Also added honeypot to check if other calls in same way happens.
    Honeypot probably not needed, review when QA in the Community.
    
    To reproduce (shelves.pl):
    1) Prepare some test list with items or use existing one.
    2) Go to the lists page (koha/virtualshelves/shelves.pl),
    notice multitude of new warnings in the "intranet-error.log" log file
    that mostly have to do with "Use of uninitialized value $xslsyspref".
    3) Apply the patch.
    4) Go back to same page and check it again, warns like that should not
    appear in the log file anymore.
    
    To reproduce (opac-tags.pl):
    1) Go to the "my tags" page in OPAC and open "tag cloud".
    2) Notice a bunch of new warnings in the log file that mostly have to
    do with "Use of uninitialized value $xslsyspref".
    3) Apply the patch.
    4) Reload the page and check the log file again.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit de487dac12de0a63cfa46bfb31083bd131803787
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Dec 13 12:16:06 2021 +0000

    Bug 29679: Remove redundant divider element from reports menu
    
    The SQL report batch operations dropdown menu has divider list items
    which add a border between sections (Bibliographic records, item
    records, etc.). This element is redundant because the sections have
    "headers" which also add a border.
    
    This patch removes them.
    
    To test, apply the patch and run an SQL report which will return results
    that trigger the batch modification menu:
    
    SELECT biblio.biblionumber , biblio.title, items.itemnumber,
    items.itemcallnumber, items.barcode, borrowers.firstname,
    borrowers.surname, borrowers.borrowernumber, borrowers.cardnumber
    FROM issues
    LEFT JOIN borrowers ON borrowers.borrowernumber=issues.borrowernumber
    LEFT JOIN items ON issues.itemnumber=items.itemnumber
    LEFT JOIN biblio ON items.biblionumber=biblio.biblionumber
    ORDER BY RAND()
    
    There should be no double border in the menu.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1573424236307e93c129914b3fca2aea62d130bf
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 5 07:57:51 2021 +0000

    Bug 27266: (QA follow-up) Remove GetBiblioData from sendshelf too
    
    Applies to opac and intranet script.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b3dc62180b6a66385c1c75d09a70b19faeb28287
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 5 07:52:55 2021 +0000

    Bug 27266: (QA follow-up) Indentation in opac-sendshelf
    
    Minimal fix to improve bad indentation a bit, moving to 2 spaces.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 441f57184dd105af6bf1d36547f194b7d9349422
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 5 07:34:45 2021 +0000

    Bug 27266: (QA follow-up) Remove GetBiblioData from basket scripts
    
    We are adding (or already doing) a Koha::Biblios->find, so we should
    get rid of GetBiblioData, fetching the same data.
    It returned a few extra columns, but unused here:
        $dat->{bnotes}, $dat->{bi_notforloan}
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bb0328218974f59b8d952438a3cdd202adb13a0d
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Sep 30 11:31:45 2021 +1300

    Bug 27266: (follow-up) Remove get_marc_authors from opac-detail
    
    There's no way to use 'no' XSLT now, so don't need to use this to show
    authors on the detail page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dfed3e842fe5985b221ca4fae767665ed691c32b
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Jul 23 08:29:46 2021 +1200

    Bug 27266: (follow-up) Using biblio frameworkcode to get rid of FIXME
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 241cbea6912d0ecc0232e57f0b09d0a72a9926e4
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Jul 22 10:15:54 2021 +1200

    Bug 27266: (follow-up) Remove instances of GetMarcAuthors
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 903b0244529ead14061cb36a0f61ea8860ae4ac7
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Thu Jul 22 09:24:52 2021 +1200

    Bug 27266: (QA follow-up) Rename to get_marc_authors
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d5621ce9512f4f8244deab843318dd08dbd7148a
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Fri Dec 18 13:51:26 2020 +1300

    Bug 27266: Move GetMarcAuthors to Koha namespace
    
    This patch moves C4::Biblio::GetMarcAuthors to
    Koha::Biblio->get_authors_from_MARC. This is so the method can be
    used in templates and notices.
    
    To test:
    1. Find a record that has an author in the added entry field (700-720).
    2. Add the record to the cart and a list.
    3. View your cart and click 'more details'. Confirm authors show as
    normal.
    4. Click 'send' and confirm the email sent shows the authors as normal.
    5. Go to the list you added the record to and click 'send list'. Confirm
    the email sent shows the authors as normal.
    xslt)
    6. Log in to the OPAC. Find the record and add it to the cart and a list
    7. View the cart and click 'more details'. Confirm authors show as
    normal.
    8. Click 'send' and confirm the email sent shows the authors as normal.
    9. Go to the list you added the record to and click 'send list'.
    Confirm the email sent shows the authors as normal.
    10. Confirm tests pass:
    - t/Biblio.t
    - t/db_dependent/Koha/Biblio.t
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Württemberg (BSZ)
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bcf8cff857c29ea1308df9fc94218b26ed689099
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Dec 3 15:29:00 2021 +0000

    Bug 27801: Fix javascript price calculations
    
    This patch ensures we're formatting the price values consistently for
    the table total and the amount to pay input field.
    
    Test plan
    1) Add an item to charge at 0.10.
    2) Add this same item 8 or 9 times (Do not use the 'quantity')
    3) Note that the table total and the 'Amount paid' values do not match
    4) Apply the patch and repeat the above steps.. the values should now
       match.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f4e62d25e04257aaca443711be69543c47cc4c12
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Dec 7 19:21:03 2021 +0000

    Bug 29349: (follow-up) Fix width of item level dropdowns
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b62723ce5a9355f2e18814d29fb318f1a9fec1cd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Dec 3 16:45:21 2021 -0300

    Bug 29349: Do not assume holding branch is a valid pickup location
    
    The original code for pickup locations when placing item-level holds
    picked the currently logged-in library.
    
    We made things more robust, as the logged-in library might not be a
    valid pickup location for the patron and item. But it was wrongly chosen
    to use the holding branch as the default.
    
    A more robust approach is needed, and this precedence is picked this
    time (it could be configuration-driven in the future):
    
        - Logged-in library
        - Empty
    
    To test:
    1. Pick a biblio with various valid pickup locations, some not including
       the logged-in library.
    2. Pick a patron for placing the hold
    => FAIL: Notice that (when valid pickup location) the holding branch is
    always chosen
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: If valid pickup location, the logged-in branch is picked as
    default for item-type level. When it is not, an empty dropdown is used
    as a fallback.
    5. Sign off :-D
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3c9b57141f83d8fed47df7bbc210f42398b4b4d
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Tue Nov 9 13:08:58 2021 +0000

    Bug 28855: (follow-up) adapt specific test
    
    Adapt the test of function DelSuggestionsOlderThan to match the new behaviour of the function.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9aa9608013c337cf98ea8c218a3dfdee14e4a410
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Fri Oct 22 15:07:43 2021 +0200

    Bug 28855: Purging suggestions test should not be on timestamp
    
    DelSuggestionsOlderThan is on "date", a timestamp. It can be a problem
    because "date" is updated when we update the database, in consequences
    all the suggestions take the same date.
    
    This patch use 'manageddate' instead.
    
    In order to test this patch, you will need to have some suggestions
    where "Managed on" (suggestions.manageddate in the database) is older
    from "Last updated" (suggestions.date in the database). This can append
    during some specific update. If you don't have such data, you will have
    to add them via SQL request.
    
    Example of sql for insertion (ID is the patron id of a librarian which
    can manage suggestions):
    INSERT INTO suggestions (suggestedby, suggesteddate, managedby,
    manageddate, acceptedby, accepteddate, STATUS, title) VALUES (1,
    '2020-10-13', 1, '2020-10-26', 1, '2020-10-26', 'ACCEPTED', 'title');
    
    Test plan:
    1- Choose a date and find (or add) a suggestion where:
        - "Last updated" is not older than this date
        - "Managed on" is older than this date
        - "Status" is different from "Pending" ("ASKED" in database)
    Calculate number_days = today's date - chosen date
    Example: (Today's date 28/10/2021, chosen date : 28/10/2020,
    number_days=365)
    Suggestion | .. | Managed on | .. | Last updated | .. | Status
    title      | .. | 10/26/2020 | .. | 05/15/2021   | .. | Accepted
    
    2- Run cron job
    /home/koha/src/misc/cronjobs/purge_suggestions.pl --confirm --days number_days
    
    3- Check that this suggestion has not been deleted
    
    4- Apply the patch
    
    5- Repeat steps 1 and 2
    
    6- Check that this suggestion has been deleted
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bf9107074d77ee0e619849f8857d5d5056244560
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 13:41:44 2021 +0000

    Bug 29403: Fix api/v1/patrons.t
    
    t::lib::Dates::compare expects either correct DateTime objects, or a
    system formatted datetime strings to be passed.. but as we're testing
    the API, we are consistently using RFC3339 strings for date-times and
    ISO8601 strings for dates.  We need to therefore pre-process the strings
    into DateTime objects for the comparison.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 62652115dc2b9263c9ac1d9067fdab240f96f9a1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 12:15:18 2021 +0000

    Bug 29403: Match the whole string
    
    This patch wraps the constructed regex such that we expect the entire
    regex to match and don't allow leading or trailing garbage.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b09e3e99b7a9dc77c00b462fa4973616aace226e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 12:14:50 2021 +0000

    Bug 29403: Unit tests
    
    Add a unit test for proper iso date handling
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a3594f160a773384fb835d253ddb99d7589f6521
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 19 14:54:58 2021 +0100

    Bug 29040: Remove warning from the itemtype edit view
    
    Use of uninitialized value $interface in concatenation (.) or string at /kohadevbox/koha/C4/Languages.pm line 121.
    
    We are expecting "intranet" or "opac, here we sent undef which raises a
    warning.
    For no change in behaviour we can send "both" (or whatever different
    than "intranet" and "opac").
    
    Test plan:
    Hit /cgi-bin/koha/admin/itemtypes.pl?op=add_form&itemtype=BK
    Notice that the warning does no longer appear in the logs with the patch
    applied.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c403c972ca77547dd0f7cf18411d0c99acad96d7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Dec 14 09:48:50 2021 -1000

    Bug 13188: DBRev 21.12.00.002
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ba16daf26a2f1ee44e443e1f131484b41730a5fa
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Dec 7 20:42:25 2021 +0000

    Bug 13188: (QA follow-up) Enhance list of field exclusions
    
    It doesn't make sense to allow for fields not visible in the
    OPAC form to be made mandatory. This patch specifically adds:
    
    * opacnote
    * borrowernotes
    * sort 1 and sort2 (missing only from Modification)
    
    PatronSelfRegistrationBorrowerMandatoryField
    exclusions: sort1|sort2|opacnote|borrowernotes
    
    PatronSelfModificationMandatoryField
    exclusions: password|cardnumber|dateexpiry|categorycode|sort1|sort2|opacnote|borrowernotes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 306004242ec527faa28ab2a9b2015decdd80b867
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Dec 7 20:41:53 2021 +0000

    Bug 13188: Fix alphabetic order in sysprefs.sql
    
    As a librarian I had to.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5985d13e7ad5d56a0c19a9ca8f73cbb43f5c29ca
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Dec 10 19:33:29 2021 -1000

    Bug 13188: (RM follow-up) Several fixes on db changes
    
    Several issues with the atomic update:
     - File must to be .pl
     - File must be executable : chmod a+x
     - Syspref type is 'free' not 'multiple'
    
    Small addition in atomic update:
    I've added a print of syspref name and value,
    this can be usefull for upgrade logs.
    
    Also a minor issue in installer/data/mysql/mandatory/sysprefs.sql :
    The description whas different from the atomic update.
    I choose that atomic update is correct.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 66058aa8e820101468231bd31a361a4be91bc6c8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 24 16:26:14 2021 +0100

    Bug 13188: (QA follow-up) Modernise atomicupdate
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2e1affddfb832400cb65f1a97d9880c46485e5e8
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Jul 30 17:31:08 2021 +0000

    Bug 13188: (follow-up) Get value from PatronSelfRegistrationBorrowerMandatoryField when updating database
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9987686f38ad6f0a0bafd9fcf3ae63594c47bacc
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Jan 19 22:39:57 2021 +0000

    Bug 13188: Add PatronSelfModificationMandatoryField system preference
    
    TEST PLAN:
    1. Apply patch, updatedatabase, restart_all
    2. In the  PatronSelfRegistrationBorrowerMandatoryField add the field password.
    3. Go to the self registration page on make sure password is required.
    4. Now go to the OPAC modification page, make some changes and attempt to submit. It should work.
    5. Go to PatronSelfModificationMandatoryField and select some fields.
    6. The columns you selected should now be required.
    7. On the PatronSelfModificationMandatoryField page, make sure the select all and clear all buttons work.
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9b603543162368091774765c7ef6a8e502ae0240
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Apr 26 09:40:08 2021 +0200

    Bug 28216: Fix vendor list group by in serials statistics wizard
    
    Bug 24940 added sort vendor list by aqbookseller.name but removed accidentally the group by.
    Now vendors are repeated in the list.
    
    Test plan :
    1) Create several subscriptions for same vendor
    2) Go to Reports > Serials
    3) Check list of vendors
    => Without patch you see the same vendor several times
    => With patch you seen it once
    4) Check sort is still on vendor name
    
    Signed-off-by: Samu Heiskanen <samu.heiskanen@hypernova.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b96f8b3e973b18121e57d4cabcebd3315ba18dd1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 2 09:07:13 2021 +0100

    Bug 15156: Add filter_by_amount_owed that's chainable
    
    This patch acts as an alternative here. We pull out the code from bug
    11983 and extend it to support filtering of debts by branchcode and
    debit_type.
    
    The advantage of this approach is that we can add the filter into the
    middle of a search chain to filter down an pre-existing search.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5795f8f5cb9fe1f25b99fe05529ba41364bb0daa
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Dec 13 15:56:39 2021 -1000

    Bug 29586: DB Rev 21.12.00.001
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8ce7e3d97dc1d8e6917d2a0cd06b7482d68363ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Dec 1 10:21:59 2021 +0100

    Bug 29586: Add atomic update for existing intallations
    
    In case an installation was created on 21.11.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f5213a407da99fe1a73f30600166b73deb82d15d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 29 12:44:07 2021 +0000

    Bug 29586: Fix typos in installer files
    
    When HOLD_REMINDER info was added I neglected to move the semicolons, this meant
    the statements were ending before the data was added
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d5257fd99a07ec3cf94fbb145759b00602352b27
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Dec 13 07:27:28 2021 -0300

    Bug 29631: (QA follow-up) Add missing cleanups
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9c2929a3513b4178ba2a9e783e3bca3054a80a03
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Dec 3 14:33:41 2021 +0100

    Bug 29631: Prevent uniq_lang creation to fail
    
    We got 2 reports of this problem in the last 24h, uniq_lang unique key is failing to be created because several rows with the same (subtag, type) exist in DB.
    
    I have no idea how this is possible, but apparently it is.
    
    Test plan:
    Checkout a commit before 21.06.00.012
    reset_all
    Create duplicate in language_subtag_registry
    > insert into language_subtag_registry(subtag, type, description) values('IN', 'region', 'India');
    Checkout master+this patch, updatedatabase
    => Only 1 IN-region exists in the DB, the last one.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1eb6a02c2f1265cef30788f141efd527eaff58d5
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Sep 26 15:36:45 2021 +0000

    Bug 29115: Fix syntax errors in club hold functionality
    
    The code didn't previously correctly do the checks for patron
    debarment status and whether the patron has fees, this caused the
    intended warnings messages to not appear when they should have.
    
    To test:
     1) Create a new club and add a patron to it who has manual debarment
        and a manual charge of over $5 (more than the maxoutstanding syspref).
     2) Try to create a new club hold for the previously created club and
        notice no warnings are listed for the patron.
     3) Apply patch
     4) Try to create now the club hold again and notice the warnings
        being shown in the hold page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 68502d183f93ee6016b1cfdcaf518bce07523aba
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Dec 1 15:44:26 2021 +0000

    Bug 29611: Clubs enrollment layout problem in the OPAC
    
    This patch makes a minor change to the HTML of the clubs enrollment form
    in the OPAC so that the layout works better.
    
    To test you should have at least one club available which allows public
    enrollment. The club should have at least one enrollment field
    configured.
    
    - Apply the patch and log in to the OPAC.
    - On the "Your summary" page, click the "Clubs" tab.
    - Click "Enroll" next to the club you configured.
    - You should see an enrollment form with the field(s) you configured.
    - The "Finish enrollment" button should be styled green and should be
      positioned inside the box which delineates the Clubs tab.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9611b9967eda3367dc671e44a6e62e2e4f8b1b98
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Dec 6 14:44:07 2021 +0100

    Bug 9565: Use Koha::Biblio
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 0b66310580e71223bc66168a8ee3b2c8e7299b5d
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Thu Dec 2 13:41:11 2021 +0100

    Bug 9565: (follow-up) Adapt batch record deletion tool
    
    Add a column "Subscriptions" to the batch deletion tools
    Add a link on the number of subscription to the search page with all the subscriptions of the record
    Add a button in the toolbar to select only biblio record without subscriptions
    
    The changes are only on display
    It is still possible to delete records that are attached to subscriptions from this tool (as it is possible for records with attached items)
    
    To test:
    1) Go to the batch record deletion (in tools)
    2) Select a list of record numbers (select some with one or more subscription)
    3) Click on Continue
    4) Check that there is no column named "Subscription" and that there is no button "Select without subscription" in the toolbar
    5) Apply patch
    6) Repeat steps 1 to 3
    7a) Check that there is a column named "Subscription" fill with the number of subscriptions attached to the record
    7b) Check that the link in the subscriptions column send you to the search page with the subscriptions linked to this record
    7c) Check that there is a button "Select without subscription" in the toolbar that selects record with no subscription attached
    8) Sign off
    
    Signed-off-by: Frank Hansen <frank.hansen@ub.lu.se>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a7771f0503e8913753a6b47c904797c2b59bdab4
Author: Marion Durand <marion.durand@biblibre.com>
Date:   Thu Oct 21 15:06:02 2021 +0200

    Bug 9565: (follow-up) Deleting a biblio should alert/fail if there are existent subscriptions
    
    Clicking on "Delete record" while there are existent subscriptions no
    longer delete the record and the subscription. Instead an alert box
    inform the user that he must delete all subscription before deleting the
    record.
    
    To test:
    1) Add a subscription to a biblio, or check a biblio which has one
       attached already.
    2) Remove all items if there are any.
    3) Apply patch.
    4) Confirm that the 'Delete record' item is disabled in the list.
    5) Attempt to 'Delete record', you should recieve
       an error message stating to delete all subscriptions before
       deleting record.
    6) Sign off.
    
    Sponsored by: Lunds Universitetsbibliotek
    
    Signed-off-by: Samu Heiskanen <samu.heiskanen@hypernova.fi>
    
    Signed-off-by: Frank Hansen <frank.hansen@ub.lu.se>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 1dcc368df176e70503e694048384927d8e2397ab
Author: Timothy Alexis Vass <timothy_alexis.vass@ub.lu.se>
Date:   Fri Nov 13 09:47:32 2020 +0000

    Bug 9565: Deleting a biblio should alert/fail if there are existent subscriptions
    
    Currently Koha will delete a biblio record if there are existent serial subscriptions.
    This patch will prevent deleting the biblio until attached subscriptions are removed.
    
    To test:
    1) Add a subscription to a biblio, or check a biblio which has one attached already.
    2) Remove all items if there are any.
    3) Apply patch.
    4) Confirm that the 'Delete record' item is disabled in the list.
    5) Sign off.
    
    Sponsored by: Lunds Universitetsbibliotek
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Frank Hansen <frank.hansen@ub.lu.se>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit c8c8f08615214b1143ce65995009928b0c37ca5e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 15 09:52:15 2021 -0300

    Bug 29484: Make ListSets return noSetHierarchy when no sets defined
    
    This simple patch makes our OAI-PMH server return the appropriate error
    code when no sets are defined.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ t/db_dependent/OAI/Server.t
    => FAIL: Tests fail. Boo!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! YAY!
    5. Sign off :-D
    
    Bonus: you can check with the tool mentioned on the bug report, that
    the error is gone. No sets need to be defined.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    JD amended patch
    -    ) unless scalar @{$sets} > 0;
    +    ) unless @$sets;
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit dd711f606399e4fbcf05f3dfe5b52df7dfd707f9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 15 09:51:53 2021 -0300

    Bug 29484: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 988d8c0bd047a6a55196f4aa04005b2e89ae9a71
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 8 19:06:59 2021 +0000

    Bug 5697: Automatic linking in guided reports
    
    This patch modifies the output of reports so that if certain columns are
    returned the data in the colums automatically offer menus of actions:
    
    - borrowernumber: View, edit, check out
    - cardnumber: Check out
    - itemnumber: View, edit
    - biblionumber: View, edit
    
    Like the menu of batch operations, this functionality is available only
    if the column is returned with its original name (e.g. biblionumber or
    [[biblionumber|Biblio number]] but not "biblionumber AS `Biblio
    number`).
    
    To test, apply the patch and run a report which will return examples of
    each kind of data. I used:
    
    SELECT biblio.biblionumber , biblio.title, items.itemnumber,
    items.itemcallnumber, items.barcode, borrowers.firstname,
    borrowers.surname, borrowers.borrowernumber, borrowers.cardnumber
    FROM issues
    LEFT JOIN borrowers ON borrowers.borrowernumber=issues.borrowernumber
    LEFT JOIN items ON issues.itemnumber=items.itemnumber
    LEFT JOIN biblio ON items.biblionumber=biblio.biblionumber
    ORDER BY RAND() LIMIT 50
    
    When the report runs you should see that the data in each affected
    column is displayed as a link, each of which should trigger the correct
    menu. Test each case to confirm that the correct page is opened.
    
    Test the "toggle data menus" control. Clicking it should hide and show
    the menus in the report results. The selection persists until the
    user logs out.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 3ba74940ee730e92ad7061f27f18390cc6308364
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 2 12:25:42 2021 -0300

    Bug 29620: (follow-up) Rename remaining old-style parameters
    
    The first routes we added named parameters in camelCase. We moved to
    snake_case really fast, but there are two that were kept by mistake.
    
    This patch fixes them.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d6c67eddd320a2579261762c18c7a3a8faf63f06
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Dec 2 09:08:48 2021 -0300

    Bug 29620: Move the OpenAPI spec to YAML format
    
    This patch moves all the REST API spec pieces into YAML.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/*
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a5885949b5e162d88906beae6c561fd661a2437c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 29 15:30:51 2021 -0300

    Bug 29593: Fix wrong tag in GET /public/libraries spec
    
    This makes the documentation look untidy.
    
    To test:
    1. Open the api/v1/swagger/paths/libraries.json file with your favourite
       editor.
    => FAIL: All routes, but this one, have tags: ['library']
    2. Apply this patch
    => SUCCESS: All routes have tags: ['libraries']
    3. swagger.yaml too!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d7390be41bdaa0b2f95389967d024661f414b678
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Nov 22 09:51:53 2021 +0000

    Bug 28617: (QA follow-up) Restore FindBin in two places
    
    Resolving:
        Name "FindBin::Bin" used only once: possible typo
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 238fabc4ab68735afc463a8d1ed53709c88dcd66
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 19 11:00:52 2021 +0200

    Bug 28617: Remove kohalib.pl and rely on PERL5LIB
    
    The purpose of this script was to load the relevant Koha lib for the
    different scripts (installation, cronjob, CLI, etc.)
    However it is not used consistently and we prefer to rely on PERL5LIB.
    
    From bug 28617 comment 6 from Galen:
    """
    Time marches on, and one of the motivations for having kohalib.pl - making
    it possible to install Koha without setting a single environment variable -
    has been obviated by the vast improvements in the ease of installing Koha.
    
    Consequently, I think kohalib.pl can go away.
    """
    
    Test plan:
    confirm that the changes make sense and that kohalib.pl can be removed
    safely.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a339a275031b19298632578c90c292361673f50d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Dec 2 15:03:46 2021 +0100

    Bug 29528: Surround strings with span
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 61de505ef36e770d915e0b0f08d8e71e787fefa6
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 22 16:46:01 2021 +0000

    Bug 29528: Breadcrumbs on HTML customizations take you to news
    
    This patch removes the "Additional contents" breadcrumb when working
    with news items or HTML customizations. Since news and HTML
    customizations are separate links on the Tools home page there's no
    reason to have the breadcrumbs imply the two sections are connected in
    any way. We already have the "See News" link, for example, for switching
    quickly between the two areas.
    
    To test, apply the patch and go to Tools -> News.
    
    - The breadcrumbs should be: Home > Tools > News
      - Click "New entry." The breadcrumbs should be: Home > Tools > News >
        Add additional content (News). Clicking "News" should take you to
        the correct page.
    - Go to Tools -> HTML customizations.
      - The breadcrumbs should be Home >  Tools > HTML customizations.
      - Click "New entry." The breadcrumbs should be: Home > Tools >  HTML
        customizations > Add additional content (HTML customizations).
        Clicking "HTML customizations" should take you to the correct page.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit d308a064d75d3509b1a193af06203400b3b99d9d
Author: Michael Hafen <michael.hafen@washk12.org>
Date:   Fri Dec 3 11:43:16 2021 -0700

    Bug 29637: AutoSwitchPatron should look for card number in the barcode
    
    Bug 26352 changed the line in circ/circulation.pl that searches for a
    patron card number in the barcode field from using the $barcode variable
    to the $findborrower variable.  This breaks AutoSwitchPatron.
    
    Test plan:
    
    1. make sure AutoSwitchPatron system preference is on.
    2. get two patron card numbers.
    3. enter the first card number to check out to the patron.
    4. enter the second card number in the item barcode field.
    5. observe that the barcode is not found.
    
    6. apply patch
    
    7. enter the second card number in the item barcode field again.
    8. observe that the second patron is loaded to check out to.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a72b787bfe3889f0c4c2631c4315db04730f4a10
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Aug 12 10:30:17 2021 -1000

    Bug 28853: Fix authority plugin when textarea in biblio record editor
    
    In biblio record editor, when subfield value contains more than 100 characters the editor uses a textarea instead of an input.
    On a field using authority plugin, this breaks the JavaScript because it only searches for input tags :
    In /koha-tmpl/intranet-tmpl/prog/en/modules/authorities/blinddetail-biblio-search.tt :
    > this.getElementsByTagName('input')[1].value = values[i];
    
    Test plan :
    1) Prepare :
    1.1) Create a new biblio record with a field using authority plugin, for example 606
    1.2) Do not use authority plugin but enter in 606$x more than 100 chars
    1.3) Save record
    1.4) Create a new autority for 606 biblio field with $a and a $x containing more than 100 chars
    2) Test 1 :
    2.1) Edit again the biblio record, you see a text area for 606$x
    2.2) Use authority plugin on field 606
    2.3) Search and choose the new autority
    2.4) Check $a,$x and $9 are well filled
    3) Test 2 :
    3.1) Empty field 606
    3.2) Create a second $x subfield and fill it with a random value
    3.3) Use authority plugin again on field 606
    3.4) Search and choose the new autority
    3.5) Check $a and $9 are well filled
    3.6) Check first $x contains the value from autority and second $x is empty
    
    Signed-off-by: Florian Bontemps <florian.bontemps@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit a7a098e9efd74785b6af02f485f486f43608ce02
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Nov 26 15:40:03 2021 -1000

    Bug 29580: Fix missing end tag in circ/overdue.tt
    
    In circ/overdue.tt there is a end tag </td> inside a IF condition.
    I should be outside.
    
    Test plan :
    Check HTML in overdue page with and without seeing patrons infos from other
    branches
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5fbb414fd1561e780953d66dd29eeea1bcc9b281
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Nov 30 14:49:33 2021 +0000

    Bug 29601: Lists: Test OPACISBD before showing ISBD download
    
    Test plan:
    Check if you see Download/ISBD for a list on OPAC.
    Clear OPACISBD.
    Check if the link is gone.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ecaf4f418e33fd84fd3c26dae4ac7525913ad6d7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 19 19:34:20 2021 +0000

    Bug 29556: MARC21slim2MODS.xsl broken by duplicate template name "part"
    
    This patch removes a redundant section from MARC21slim2MODS.xsl which
    was breaking the option to use unAPI in the OPAC using MODS format.
    
    To test, apply the patch and view a record in the OPAC using unAPI,
    e.g.:
    
    /cgi-bin/koha/unapi?id=koha:biblionumber:1&format=MODS
    
    You should see an XML file where previously there would have been an
    error.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 11e2cbde2afd927ec6c1f97f6ab3516f13f193e1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 15 18:25:20 2021 +0000

    Bug 29487: Set autocomplete off for userid/password fields at login
    
    This patch adjust:
    Intranet login
    Opac-main
    Opac-main - 'log in to your account modal'
    
    To test:
    Login at the three places above
    Confirm html shows autocomplete off on the fields
    Confirm logins work
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8bd30b03b4ae8533eae9945d587ec1a2b11117ff
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 19 14:48:49 2021 +0000

    Bug 29529: Fix \n in hint on Koha to MARC mappings
    
    This patch breaks up a translatable string so that "\n" is excluded from
    what is translated.
    
    Unrelated: Capitalization is corrected on an instance of the phrase
    "Koha to MARC Mappings."
    
    To test, apply the patch and go to Administration -> Koha to MARC
    mapping.
    
    - The breadcrumb for the current page should have correct capitalization
      ("mapping" instead of "Mapping").
    - Click the "Add" button for any Koha field. The dialog should display
      correctly:
    
      Adding a mapping for: biblio.abstract.
      Please enter field tag and subfield code, separated by a comma. (For
      control fields: add '@' as subfield code.)
      The change will be applied immediately.
    
    Test the way the po file is updated:
    
     > cd misc/translator
     > perl translate update en-GB (for example)
     - Open the updated po file, en-GB-staff-prog.po
     - You should find these lines:
    
     SCRIPT
     koha-tmpl/intranet-tmpl/prog/en/modules/admin/koha2marclinks.tt:86
     msgid "The change will be applied immediately."
     msgstr ""
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit bb97545f0b66051093521654276736a3d5af6c1d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 16 09:18:58 2021 -0300

    Bug 29494: html-template-to-template-toolkit.pl no longer required
    
    This helper script was used to transition from HTML::Template to
    Template::Toolkit, which happened 11 (?) years ago.
    
    The file is part of Koha history, but we don't need it in current
    master.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6babd2a44fb6edd2b36a46ab065502a608324501
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Dec 1 21:33:26 2021 -1000

    Bug 29036: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8ff01a99974acb6b8cb638803ac090f2765c868d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 24 16:57:00 2021 +0000

    Bug 29036: (follow-up) Improve the use of variables to keep colors consistent
    
    This patch modifies the OPAC SCSS so that a "base theme color" variable
    is defined which can be used to color button backgrounds and similar
    elements. The patch also moves some other colors into variables and
    removes some unused CSS.
    
    The Koha logo which is displayed in the upper left corner of the OPAC
    has been modified to use the same color.
    
    To test, apply the patch and repeat the previous test plan.
    
    Signed-off-by: jeremy breuillard <jeremy.breuillard@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 9d6a0716f570b651fac5f426688289c69019084e
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Mon Sep 20 21:50:28 2021 +0000

    Bug 29036: Accessibility OPAC buttons don't have sufficient contrast
    
    This patch changed the base colour of OPAC buttons to increase the
    contrast ratio, improving accessibility and making the button text
    easier to read.
    
    To test:
    
    1. Use an accessibility tool (e.g. Chrome's Lighthouse tool) to check
       the contrast ratio on the OPAC
    2. Confirm that the OPAC buttons don't have sufficient colour contrast
    3. Apply the patch and rebuild css:
       yarn build --view opac
    4. Use the accessibility tool to confirm the button contrast ratio now
       meets minimum accessibility requirements
    5. Check that the OPAC still looks ok after the changes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: jeremy breuillard <jeremy.breuillard@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit b0826068bcc7f1c04c87d95d65094122bac859a9
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Nov 16 00:17:38 2021 +0000

    Bug 29488: make NumSavedReports work
    
    1. Have a bunch of saved reports
    2. Try to use the sys pref NumSavedReports to limit how many show by default
    3. It doesn't work
    4. Apply patch
    5. Try again, now it should work
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit ad8548913942826e04b1435fe70bebedf3c8e6ea
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 18 19:17:48 2021 +0000

    Bug 29521: Fix style of patron clubs table when in clubs management
    
    This patch follows up Bug 24627 to add some additional template logic to
    the table of clubs so that the interface is consistent whether you're
    looking at clubs during the holds process or during the clubs management
    view.
    
    The ways Bug 24627 made the clubs list more consistent with patron
    search results made it LESS consistent with the Clubs management
    interface.
    
    To test, apply the patch and go to Tools -> Patron clubs.
    
    - Scroll down to the "Clubs" table, below the "Club templates" table.
      - In the table of clubs, the club name should not be a link.
      - Hovering your mouse over the table should not highlight each row.
    
    Confirm the previous behavior of a clubs search when placing a hold:
    
    - Search the catalog and start the process of placing a hold on an item.
    - On the "Place hold" page, click the "Clubs" tab and perform a search
      which will return multiple clubs.
    - In this view, the club name should be a link. Clicking it should
      select that club for the hold.
    - You should also be able to click anywhere in the row to select the
      club for the hold.
    
    Signed-off-by: Andreas Roussos <a.roussos@dataly.gr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 677426b8f3c474e9bf4c7b25dce3cd0e2b52e1bc
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Nov 16 08:43:01 2021 +0000

    Bug 29513: (QA follow-up) Fix TT filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 8cb4aeca8cfb124209a548e2b0d604fa6df92172
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Thu Nov 18 09:37:01 2021 +0100

    Bug 29513: Convert remaining breadcrumbs div blocks into nav
    
    As per https://bugs.koha-community.org/bugzilla3/show_bug.cgi?id=27846#c0,
    breadcrumbs should adhere to the WAI-ARIA Authoring Practices. Most Staff
    Client template files have already been fixed, but there were a few that
    were missed.
    
    This patch fixes that.
    
    Test plan:
    1) Apply this patch.
    2) Visit these pages in the Staff Client:
       Home > Acquisitions > TestVendor > Basket TestBasket (1) for TestVendor (*)
       Home > Administration > Set library checkin and transfer policy (**)
       Home > Patrons > Merge patron records (***)
       ...and confirm that the breadcrumbs display correctly.
    
       (*) Can be accessed by creating a test basket for a test vendor
       (**) Can be found under Administration -> Patrons and circulation
       (***) Can be found by trying to merge two Patron records
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 543be89b41b309c6a48a12c9b2f1f410b81ac8f6
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Thu Nov 18 10:45:10 2021 +0100

    Bug 29514: Remove extraneous HTML entity from breadcrumbs
    
    The template file for ILL requests has a small typo in the breadcrumbs
    section: there exists an extra &rsaquo; HTML entity after "Home".
    
    This patch fixes that.
    
    Test plan:
    1) Access the ILL requests module, and notice how an extra character
       is displayed after "Home" in the breadcrumbs.
    2) Apply this patch.
    3) Refresh the page -- the extra character is no longer displayed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 2aff87cecdf00db82a853e31cf2449affd411d1e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Dec 1 20:37:24 2021 -1000

    Bug 28716: Compiled CSS
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit f14e04831b7afd0833119b0cb4c9e332c4732d50
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Jul 15 16:53:19 2021 +0000

    Bug 28716: hide moresearches and opaccredits from print
    
    To test:
    1. Make some lists and look at them in the OPAC
    2. Have some content in your OPACCredits news section
    3. Look at some lists and try clicking 'Print list'
    4. You will see the moresearches (top navigation) and opaccredits content
    5. apply patch and regenearte the CSS
    6. Do 3 again, you should not see the contents of moresearches (top navigation) and opaccredits content
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>

commit ffdf994057e9fdaac93f715d208faf1b52ad21dd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Nov 3 15:27:26 2021 +0000

    Bug 29406: Improve display of OPAC suppression message
    
    This patch changes the way the "Suppressed in OPAC" message is shown on
    the staff interface search results and the bibliographic detail page.
    Now the information is displayed like other bibliographic details.
    
    To test, apply the patch and restart services.
    
    - Enable the OpacSuppression system preference and modify at least one
      record to be suppressed in the OPAC (942$n in MARC21).
    - Perform a catalog search which will return this record in the staff
      client.
    - The entry for that record in the search results should include the
      message "Suppressed in OPAC" at the bottom of the list of other
      bibliographic details.
    - View the details for that record. You should see a line labeled "OPAC
      view" It should say "Suppressed in OPAC."
    - Test a record which is not suppressed. If you have OPACBaseURL
      populated you should see "OPAC view: Open in new window."
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 6f1082166e90429e6d3b00c8351c1d46f42c1592
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Dec 1 20:11:04 2021 -1000

    Koha 21.12 - start of a new dev cycle
    
    All that is gold does not glitter,
    Not all those who wander are lost;
    The old that is strong does not wither,
    Deep roots are not reached by the frost.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>

commit 5b9902487b76d0adcd2e40442165171b5942af46
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 25 12:02:13 2021 +0100

    Koha 21.11.00 is here!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e52c2a2fc287d2c4d2d2fc75b70d038e7727742
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 26 11:01:09 2021 +0100

    21.11.00 - Fix translation issues
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb1bcc411e2d580251f22036cebe8b10b2f43954
Author: Koha translators <>
Date:   Fri Nov 26 04:29:39 2021 -0300

    Translation updates for Koha 21.11.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f8088f4e57622a476c97fa36f19bab5d83f5a32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 25 16:24:49 2021 +0100

    Add release notes for Koha 21.11.00
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84fc62289b4fcc417e4342305e78e94624198c68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 24 11:13:38 2021 +0100

    21.11.00 - Update .mailmap
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8df3116760bdf1b889dc6f78e4605e231c4d7d6d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 24 10:52:58 2021 +0100

    21.11.00 - Update kohastructure.sql
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ea52f0efee9739e7e4d3b340643f1942d87375e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 24 10:39:04 2021 +0100

    21.11.00 - Update history.txt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b7a0418bf6a2abba6f14842d2be975cad5775de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 24 10:38:26 2021 +0100

    21.11.00 - Update contributors.yaml
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a59ab278e0824f924b2adaa9dda1b2e17552697
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 26 12:15:17 2021 +0100

    Bug 28959: Fix occurrence in tools/batch_delete_records.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77a34e099a9f3bcef2076a4170e8c8d843c403eb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 25 13:53:55 2021 +0100

    Bug 28445: Prevent UI/Form/Builder/Item.t to fail randomly
    
    MySQL and Perl don't order strings with _ identically which cause a
    mismatch when comparing the itemtypes.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 288b39c3d4d5e4dd3fc779003c0e9ca0e23ccec6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 25 12:46:25 2021 +0100

    Bug 28445: (follow-up) Add diag for failing test
    
    Last diag was not enough (Koha_Master_D11/457)
    
             #   Failed test 'Item types should be sorted by description and an empty entries should be shown'
             #   at t/db_dependent/Koha/UI/Form/Builder/Item.t line 127.
             #     Structures begin differing at:
             #          $got->[11] = 'X_vvQE5'
             #     $expected->[11] = 'knHm32'
             # Itemtypes details: $VAR1 = [
             #           '',
             #           'EMVzKcGR',
             #           'x4S8_BaFCp',
             #           'Cp2BGkY',
             #           'BK',
             #           'CF',
             #           'CR',
             #           'bBvgmVAIzD',
             #           'WKyaQ_l',
             #           'Cjc0SKQz',
             #           'liic63',
             #           'X_vvQE5',
             #           'knHm32',
             #           'MP',
             #           'MX',
             #           'MU',
             #           'g_F5eNqA',
             #           'REF',
             #           'pkxaMSv',
             #           'VM'
             #         ];
             # $VAR2 = [
             #           'bBvgmVAIzD',
             #           'BK',
             #           'CF',
             #           'Cjc0SKQz',
             #           'Cp2BGkY',
             #           'CR',
             #           'EMVzKcGR',
             #           'g_F5eNqA',
             #           'knHm32',
             #           'liic63',
             #           'MP',
             #           'MU',
             #           'MX',
             #           'pkxaMSv',
             #           'REF',
             #           'VM',
             #           'WKyaQ_l',
             #           'X_vvQE5',
             #           'x4S8_BaFCp'
             #         ];
    We needed the translated_description. It should be the same actually,
    but maybe something weird is happening.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a8ea2e46da6c788a633383b81cce70c9323f750
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 7 10:06:15 2021 +0200

    Bug 29113: Fix random assignation
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 264ac5fd2dbb97c5f3f875559c95a19ce49c6aea
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 4 16:28:49 2021 +0200

    Bug 29113: Hide code for additional contents and generate it
    
    additional_contents.code is used to group DB rows together. Each row
    represent one content in a given language, and the code is used to know
    they are translation of the lang='default' one.
    
    It's not really useful for the end user and we could hide it and
    generate it.
    
    Test plan:
    Create/Edit/Delete additional contents (news and HTML customizations)
    and confirm that they are correctly grouped together.
    You need several languages installed to test this patch correctly.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb2e8e3450963aa3bdfee4fa1ddd9837e4224732
Author: Mason James <mtj@kohaaloha.com>
Date:   Wed Nov 24 14:57:51 2021 +1300

    Bug 29564: Use List::MoreUtils so SIP U16/Xenial does not break
    
     - run prove t/00-load.t, see error
     - apply patch
    
        00:07:08.189 koha_1       | #   Failed test 'use C4::SIP::Sip::Configuration;'
        00:07:08.189 koha_1       | #   at t/00-load.t line 46.
        00:07:08.189 koha_1       | #     Tried to use 'C4::SIP::Sip::Configuration'.
        00:07:08.189 koha_1       | #     Error:  "uniq" is not exported by the List::Util module
    
     - run prove t/00-load.t, see tests pass :0)
    
    https://bugs.koha-community.org/show_bug.cgi?id=29478
    
    https://bugs.koha-community.org/show_bug.cgi?id=29564
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af0ec1e715a31fa16df0cb13e38de1cbdb03a1c1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 24 11:56:52 2021 +0100

    Bug 29567: (bug 28445 follow-up) Restore cataloguing plugins
    
    Broken by bug 28445.
    
    See also the FIXME from
      commit 86156da415141e32e16f2090477be32bda241afb
      Bug 28445: Adjust code to handle regexs
    
    The problem is that the cataloguing plugins inject JS code in the DOM BEFORE the footer
    in somes page we have all the JS loaded at the end of the DOM
    and so $ (jQuery) is not defined
    
    It's working on additem as we don't have the JS in the footer, but the
    batch item mod tool has it there.
    
    Test plan:
    Batch edit items and confirm that cataloguing are working correctly with
    this patch applied.
    
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92dce6465e496dbf79d17ef2409ae2e498283773
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Oct 31 14:52:50 2021 +0000

    Bug 29381: Prevent sending of automatic renewal messages on every cron run
    
    Currently the auto-renewal digest messages are sent on every cron run
    even if there was nothing to renew or no renewal errors.
    
    This regression was introduced in the commit "Bug 18532: Add
    individual issues to digest notice and hide auto_renewals messaging
    preference when not needed".
    
    To test:
     1) set syspref AutoRenewalNotices to be according to patron
        preferences
     2) Enable renewal digest messages on a patron's messaging preferences
     3) Checkout a book for patron, during the checkout use the Checkout
     settings menu to check the box "Automatic renewal"
     4) Run
        $ perl misc/cronjobs/automatic_renewals.pl --send-notices --confirm --digest-per-branch
        $ perl misc/cronjobs/automatic_renewals.pl --send-notices --confirm --digest-per-branch
     5) Notice you have now two renewal messages for the patron
     6) Apply patch
     7) repeat step 4) and notice you don't get anymore these unnecessary
        renewal messages
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee76f80a7b02b9405994d3cccc6104410cad0590
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 22 14:24:40 2021 +0100

    Bug 29524: (bug 28935 follow-up) Restore modification of some patron's attributes
    
    On
      commit 5f37d8d2f496ce3c9fd6dfd5a2efa7a9fe435af3
      Bug 28935: No filtering on patron's data on member entry pages
    we restricted the list of the columns from the borrowers table that can
    be modified from the patron edit view.
    We were too restrictive, the following 3 attributes can be edited from
    this form: privacy_guarantor_fines, privacy_guarantor_checkouts,
    checkprevcheckout and lang
    
    Test plan:
    Turn on the following prefs:
    - AllowStaffToSetFinesVisibilityForGuarantor
    - AllowStaffToSetCheckoutsVisibilityForGuarantor
    - CheckPrevCheckout (set to 'unless overridden *')
    - TranslateNotices
    Edit a patron and see the 4 different options are now displayed.
    Change their value, save, edit again
    Confirm that the values have been saved
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53956232f94a8d1b987b14ef0342b113217c86b8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 24 09:26:38 2021 +0100

    Bug 29565: Prevent regressions.t to fail on slow boxes
    
    It's failing randomly on some Jenkins' nodes
    
     #   Failed test 'Encoding in session variables'
     #   at t/db_dependent/selenium/regressions.t line 300.
     Can't call method "get_text" on an undefined value at t/db_dependent/selenium/regressions.t line 285.
    
    It can be recreated locally with the following changes:
    @ t/lib/Selenium.pm:50 @ sub new {
         );
         bless $self, $class;
         $self->add_error_handler;
    -    $self->driver->set_implicit_wait_timeout(5000);
    +    $self->driver->set_implicit_wait_timeout(1000);
         return $self;
     }
    
    @ t/lib/Selenium.pm:50 @ sub new {
         );
         bless $self, $class;
         $self->add_error_handler;
    -    $self->driver->set_implicit_wait_timeout(5000);
    +    $self->driver->set_implicit_wait_timeout(1000);
         return $self;
     }
    
    This patch suggests to simply double the timeout.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65edbe5af21b9bba154cf5d5120d83da43eee0c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 24 09:12:16 2021 +0100

    Bug 29485: (follow-up) Trying to prevent administration_tasks.t to fail randomly
    
    Recreated the problem after run #47
    Error while executing command: no such element: Unable to locate element: //*[@id="userid"] at /usr/local/share/perl/5.28.1/Selenium/Remote/Driver.pm line 411.
    
    With this patch I do not longer recreate the failure. It's ugly but,
    well, I don't have any other solutions. It seems that the accept_alert
    is taking too long and is async (??)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4dcabc3bd89624d033595fca6b6c20c05791c82
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 22 11:51:26 2021 +0100

    Bug 29478: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a91325387bbdeca474bdfea0c8d7afba5aaa3ccd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 19 10:55:47 2021 +0100

    Bug 29478: (follow-up) Today should select now for pastinclusive
    
    This is getting ugly. We need to add 1 minute for the minDate or the
    'Today' link may not work.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 03884cc9f9aaf95a5b4f1258857ae65068b196cd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 12:19:50 2021 +0100

    Bug 29478: Today should select now for pastinclusive
    
    If Today is clicked when we only allow dates in the past and today/now,
    we should select the current date/time
    We need to update the maxDate to make it up-to-date, or the maxDate may
    be set to the minute before and clicking Today will blank the input.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58cec67dbdd6064e9435b04b7474fe0ebc5e0ac5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 16 14:17:19 2021 +0000

    Bug 29478: (follow-up) Provide default style for shortcut buttons
    
    This patch adds some CSS to _flatpickr.scss in order to give a deafult
    style to the "yesterday," "today," and "tomorrow" controls added by the
    shortcut plugin.
    
    A missed translatable string is now wrapped in the __() function:
    __("or").
    
    The patch also updates the date calculation for those shortcuts to use
    Flatpickr's date calculation shorthand. This isn't strictly necessary
    but I think it makes the code more readable.
    
    To test, apply the patch and build the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    In the staff client, view some pages with date-picker widgets. A
    calendar widget time selection:
    
    - Circulation -> Check out -> Checkout settings -> Select date:
      - The calendar widget should have "yesterday," "today," and "tomorrow"
        controls styled like links appearing after the time selector. The
        controls should be centered, with the "or" label on the same line.
    
    A calendar widget without time selection:
    
    - Tools -> Log viewer -> Display from.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 622b4c019b5c1078affacfa24e07edd68a2cb6e9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 10:59:08 2021 +0100

    Bug 29478: Flatpickr - Restore 'Today' button
    
    It's not implemented, looks like we need to use a plugin for that
    
    https://github.com/flatpickr/flatpickr/issues/576
    
    https://github.com/jcsmorais/shortcut-buttons-flatpickr
    
    Test plan:
    Confirm that flatpickr instances now have a yesterday, today and
    tomorrow buttons.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cc3e618d84c85ed353392006fc06ed094b46f27
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 11:22:57 2021 +0100

    Bug 29500: Flatpickr - accept original date in the past and not others
    
    Bug 29241 was supposed to fix this but it didn't properly.
    We are accepting other dates in the past when we should only accept the
    original one (the one from the DB) AND dates in future.
    
    Test plan:
    Retry test plan for 29241 and confirm that you cannot set manually another
    date in the past.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f5670c889bb0a56f7493504e79282a846f935bf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 11:30:21 2021 +0100

    Bug 29394: Remove futuredate for renew
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ed705056ddb72a4b38ef5531a9bc9152ada0d9f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 09:20:59 2021 +0100

    Bug 29394: adjust request.tt
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fb01c0453ad3272a2fbb2a05ecfc10789094559
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Nov 16 16:46:44 2021 +0000

    Bug 29394: (follow-up) Pass correct time format and other corrections
    
    This patch makes a few corrections, including adding the
    correct Flatpickr date format option when the timepicker is enabled.
    
    Besides past and future date options, I've added a "pastinclusive"
    option which allows dates in the past OR today. This option was
    previously applied to the checkin page.
    
    The patch also corrects a couple of places where the wrong date field
    was modified with the new data attributes.
    
    To test, apply the patch and test the datepickers on the batch checkout
    and renew pages. When you select a date and time the "TimeFormat" system
    preference should be correctly applied.
    
    The calendar widget on the checkin page should allow you to select
    today's date.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcfd3849a9f8ac91ab9a0b90c1e5cdf9d7b360bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 16 10:54:10 2021 +0100

    Bug 29394: Remove flatpickr instantiations from most of the tt files
    
    We must reduce the instantiations as much as possible to take advantages
    of the default values and specific behaviours we have defined in
    calendar.inc
    
    This patch is suggesting to have a .flatpickr class and using the data
    attributes:
    - flatpickr-futuredate
    - flatpickr-pastdate
    - flatpickr-enable-time
    - flatpickr-on-close-focus
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 106f791e619e965e609892e537e232917814d6d5
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Fri Nov 19 16:08:05 2021 +0100

    Bug 29010: (QA follow-up) Change inputmode from numeric to decimal
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0673c73c5f6fcb03ebab045cc2b93ec99ef25d6e
Author: Thomas Klausner <domm@plix.at>
Date:   Tue Sep 14 11:13:11 2021 +0200

    Bug 29010: fix pattern in search_field.weight
    
    search_field.weight is of type NUMERIC(5,2) in the database, and values
    are rendered as floats in /admin/searchengine/elasticsearch/mappings.pl
    
    But the field validation only accepts INTs. This patch fixes the pattern
    to accept NUMERIC(ish) values
    
    - Enable Elasticsearch (but no need to actually index anyting)
    - go to cgi-bin/koha/admin/searchengine/elasticsearch/mappings.pl
    - Enter an integer (eg "8") into any "weight" column and click save
    - Koha now displays the value as NUMERIC, eg. "8.00"
    - Change nothing, and click save again
    - Save does not work, you get a warning by the browser that the input
      does not match the requested format (because in the html field only
      ints are allowed, but the DB stored the value as numeric and returns
      it as such)
    - Workaround: Change all the values back to ints (i.e. remove ".00"),
      but this is very cumbersome if you have several weights
    
    - Apply the patch
    - Now try to save again (without changing eg "8.00" to "8". It works
    - Add a new weight (eg "4"), save, it's turned into "4.00", but saving
      again still works
    
    Sponsored-by: Steiermärkische Landesbibliothek
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df87d3ab2378e413b032f274a928daae9f90ebac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 22 11:04:51 2021 +0100

    Bug 17600: Fix opac/unapi
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e350b5bb637281d0bf488d35950f41b4d007b5d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 19 07:54:37 2021 +0000

    Bug 29437: (QA follow-up) Update TODO in Breeding.t
    
    We now have some tests for BreedingSearch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f0d86b2cb63656866f0a52149e790794e6c126e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 19 07:53:26 2021 +0000

    Bug 29437: (QA follow-up) Remove Business::ISBN from addbooks
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10de703d61d79685eb72094c5013cf760fe076c6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 8 19:24:36 2021 +0000

    Bug 29437: Search reservoir for term as title, author, or variations of ISBN
    
    The code in the script and the module attempt to determine whether a term is an isbn, or not. Rather
    than try to do this, we can simply search it on the three fields: isbn, title, author
    
    Additionally, we should search as any of the ISBN variations to broaden our matches
    
    Note: Curently only an ISBN 10 is stored in import biblios, so for an ISBN13 that doesn't convert
    the value will be blank - this is another bug
    
    To test:
    1 - Perform a cataloging search for a valid ISBN 13 with no ISBN10 counterpart:
        9798200834976
    2 - 500 error
    3 - Apply patch
    4 - Repeat, no results
    5 - Import some records
    6 - Search by title/author/isbn
    7 - Confirm searching works as expected
    
    WNC amended to fix spelling
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    AMENDED: Useless call of ISBNs (plural) when you only pass one parameter.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80f393cc3ea360c80bd8958a6e9792517c039d30
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Nov 10 13:33:41 2021 +0000

    Bug 29437: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6cdda9b01c5f29e3728b4ea8dbef11a62fe0d19
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Nov 15 16:29:49 2021 +0000

    Bug 29456: Add Hold_Reminder description to patron categories overview page
    
    This was missed when initially adding the notice.
    
    To test:
    - Go to Administraiton > patron categories
    - Edit a patron category and check "Hold reminder" in messaging
      preferences, save.
    - Go to the overview page and verify it shows as 'Unknown'.
    - Apply patch.
    - Descrpition should now display.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d50aad2a91410577aa8e71810a038a3f9b232290
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 16 14:57:21 2021 +0100

    Bug 29456: (bug 18532 follow-up) handle Auto_Renewals messages in category
    
    The new message appears in the list on the edit view, but the list view
    is showing "unknown"
    
    Test plan:
    Set AutoRenewalNotices to "according to patron messaging prefs"
    Edit a patron category
    Tick all the checkboxes
    On the category list view you should see a correct display in the
    "Messaging" column
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ee29390f1cff9c7a5fac5aed849e9d2766c49a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 19 15:20:00 2021 +0100

    Bug 5229: DBRev 21.06.00.049
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c483fecc63ebe20991077a611a0e11be4359aa4e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 16 09:14:57 2021 -0300

    Bug 5229: Remove from searching.pref
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f6c364ee091aac745e3deab11b77c17ea1caf6f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 12:48:28 2021 +0100

    Bug 5229: Remove system preference 'OPACItemsResultsDisplay'
    
    We dropped it on bug 12561 when removing the non-XSLT view. This feature
    has never been implemented for XSLT views and the pref must then be
    removed.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 288ef824616fff1bb8a685a43efed3a3f7654f30
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Fri Nov 12 15:14:46 2021 +0200

    Bug 29463: Escape utf8 characters before appending search query to url
    
    To test:
    1) go to the main page of Koha and search in the "Check out" search window type "näyttö".
    2) see that umlauts got replaced with replacement characters.
    3) apply the patch.
    4) repeat 1-2, ensure that umlauts displayed correctly and are not getting replaced with replacement characters.
    
    JK: remove period from commit title
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ddb520b963adfa784354746dbfd65d3356e3456
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 19 07:22:09 2021 +0000

    Bug 29387: (QA follow-up) Fix modules in test
    
    Can't locate object method "new" via package "Koha::BackgroundJob::BatchUpdateBiblio" (perhaps you forgot to load "Koha::BackgroundJob::BatchUpdateBiblio"?) at t/db_dependent/Koha/BackgroundJobs/BatchUpdateBiblio.t line 45.
    
    How did it pass at signoff?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e34fa5b5119765d65e0c82dc5b6267b087b30b50
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 8 10:22:09 2021 +0100

    Bug 29387: Stringify exceptions for other background job modules
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27793b89797fa3bdce7c39d70c020fbabb44fb1b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 2 10:43:57 2021 +0100

    Bug 29387: Stringify exception when logging error during a batch mod biblio
    
    If an exception is raised by one the methods/subroutines called when batch biblio update, the job will fail in the middle and some records won't be processed.
    
    Test plan:
    0. Don't apply the patch
    In KTD you can run the a batch mod biblio on the 100 first records and
    the worker will fail with
    """
    countered object 'C4::Biblio::_koha_modify_biblioitem_nonmarc(): DBI Exception: DBD::mysql::st execute failed: Data too long for column 'lccn' at row 1 at /kohadevbox/koha/C4/Biblio.pm line 423
    ', but neither allow_blessed, convert_blessed nor allow_tags settings are enabled (or TO_JSON/FREEZE method missing) at /kohadevbox/koha/Koha/BackgroundJob/BatchUpdateBiblio.pm line 120.
    """
    The UI is not saying anything about this problem.
    
    Generate 100 biblionumbers: perl -e 'for (1..100){print "$_\n"}'
    1. Apply the patch and confirm than now you see the detail of the batch
    update and that biblionumber 72 is marked as not been modified with the
    correct error (raw DBI error)
    
    JK: add executable bit to BatchUpdateBiblio.t
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62316cd58590c47594865a88b23ad2854c6f7fa3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 19 15:20:54 2021 +0100

    Bug 29341: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a280a7d54d433c3f74503e7375a3da98a302471
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 19 15:19:20 2021 +0100

    Bug 29341: DBRev 21.06.00.048
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee3ffed6f54c947f875aad536494895d063dacb4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 12:25:35 2021 +0100

    Bug 29341: Remove foreign keys on pseudonymized_transactions
    
    Behave like the statistics table and don't remove the code even if the
    branch or patron's category is removed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90090a3601ae06ff070830827fad319f8b2f8cf2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 15:48:48 2021 +0100

    Bug 29496: (bug 27526 follow-up) Fix item form validation
    
    The validation of the forms were blocked with "X item mandatory fields
    empty" when at least one dropdown list subfield was marked as mandatory.
    
    We need to add the 'input_marceditor' class to the select (does it
    actually make sense? select vs input...)
    
    Caused by
      commit 6ed29bccef590a1bc5e4cea175b41b8024483320
      Bug 27526: Fix mandatory and important checks
    Which lamentably failed as it was stating:
    "Using .input_marceditor let us fix the additem.tt form and prevent to break the other ones"
    
    Signed-off-by: Marion Durand <marion.durand@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 294741b1df281c6ab44ea1399cc63c64714cd472
Author: Marion Durand <support@biblibre.com>
Date:   Wed Nov 17 11:02:01 2021 +0100

    Bug 29496: CheckMandatorySubfields don't work properly with select field in serials-edit.tt
    
    Since one of the patches of BZ 27526 (Bug 27526: Fix mandatory and
    important checks), CheckMandatorySubfields use the class
    "input_marceditor" but in file serials-edit.tt this class is not set for
    all field (it is present on text input but not on select input) 5
    9- Check that no error appear and that your item has been created.
    
    In consequence if a select field is set as mandatory, it is detected as
    missing even if it is filed and so you can't submit the form and receive
    the new serial.
    
    Test plan:
    0- Be sure to be in a version of koha where the patch that introduces
       the bug is present (it is present in master since Jul 8 2021 (it is
       present in 21.06.00.046) and will be pushed in 21.11.00)
    1- Create (or find) a subscription for a biblio record and select the
       option "Create an item record when receiving this serial"
    2- Be sure to have at least one mandatory subfield that is filed with a
       select input in the framework used by the biblio record. (ex: 995$b,
       995$c or 995$e in unimarc; 952$a, 952$b or 952$c in marc21)
    3- From the subscription-detail page click on "Receive"
    4- Change the status to "Arrived" and fill the item form that appears.
    5- Click on "Save"
    6- Check that an error box appear with the message " Form not submitted
       because of the following problem(s) 1 mandatory fields empty
       (highlighted)" (the number can be different according to the number of
       concerned subfields)
    7- Apply the patch
    8- Repeat step 3 to 5
    9- Check that no error appear and that your item has been created
    
    JD amended patch: remove comma to separate classes
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7bddfeb412e427ee8c02c700295382fe4a7340d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 09:32:42 2021 +0100

    Bug 29270: start_for is actually date_to
    
    The attribute has been renamed in the meanwhile..
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad50d6ad6f856b7c6ea84838ca5fe9a22d1ab9c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 10:32:30 2021 +0100

    Bug 29477: Flatpickr - default to 23:59 for the time part
    
    It was defaulting to 12:00 which was an unexpected change in behaviour
    caused by flatpickr switch.
    
    Test plan:
    On the circulation view, check some items out and play with the time
    part and "Remember for session". The behaviour must be correct, ie. the
    same as prior to flatpickr switch.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34422de230d4caa5053ef4e91e3f9446c266b753
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 17 09:03:14 2021 +0100

    Bug 29270: Expiration date must be in future
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0ab8b6a5c9077aac4ce82e1694f9519df2d6c88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 16 15:46:02 2021 +0100

    Bug 29469: (bug 17600 follow-up) Fix tag approval/rejection from staff
    
    Usage: POSIX::exit(status) at /kohadevbox/koha/tags/review.pl line 72.                                                                                                                                                at /usr/share/perl/5.28/Carp.pm line 289
            Carp::croak('Usage: POSIX::exit(status)') called at /usr/lib/x86_64-linux-gnu/perl/5.28/POSIX.pm line 22
            POSIX::usage('exit(status)') called at (eval 2066) line 3
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e04afffa17513384d1a0752880f404409173a63
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Nov 15 13:42:02 2021 +0000

    Bug 28692: (follow-up) Add tests
    
    Test plan:
    Run t/db_dependent/Log.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6abe27e7b85fb76da34c84c20f6f0be304f830fd
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 12 10:40:32 2021 +0000

    Bug 28692: (QA follow-up) Fix test for objects
    
    Fix the bug where object is first stringified and then tested for
    being a Koha::Item.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d528efc6989f7b1ca45a6bb13b03ac2a2920b6c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 12 10:29:04 2021 +0000

    Bug 28692: (QA follow-up) Sort hash keys of unblessed
    
    Trivial add. Reads much better. And might help future diffs.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53c56bc3dc11741e28d7999035f761af67712d69
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 12 09:58:22 2021 +0000

    Bug 28692: (QA follow-up) Add module
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de99b016d835e70d24ee6e8c9fa5623317dd55b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 12 11:44:12 2021 +0200

    Bug 28692: Get from storage before log actions
    
    To make sure we have logging the values from DB.
    It will reduce DB action_log table size when we log the full object and
    it contains DateTime object.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff2fbfe35f20e767d0c47374ef9d366e62b8e848
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 16 13:59:48 2021 +0100

    Bug 28816: (follow-up) Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26dd4002835ebe4361c145375b875fcb31c87ab7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 15:04:06 2021 +0100

    Bug 29485: Trying to prevent administration_tasks.t to fail randomly
    
    Since bug 19185, and Koha_Master running the tests after t/db_dependent/selenium/01-installation.t is ran, t/db_dependent/selenium/administration_tasks.t is failing randomly with:
    
    12:32:59 koha_1       | STRACE: /usr/share/perl5/Try/Tiny.pm:123 in Selenium::Remote::Driver::catch {...}
    12:32:59 koha_1       |         /usr/local/share/perl/5.28.1/Selenium/Remote/Driver.pm:361 in Try::Tiny::try
    12:32:59 koha_1       |         (eval 1710):1 in Selenium::Remote::Driver::__ANON__
    12:32:59 koha_1       |         (eval 1712):2 in Selenium::Remote::Driver::__ANON__
    12:32:59 koha_1       |         /usr/local/share/perl/5.28.1/Selenium/Remote/Driver.pm:1340 in Selenium::Remote::Driver::_execute_command
    12:32:59 koha_1       |         /usr/local/share/perl/5.28.1/Selenium/Remote/Driver.pm:1340 in (eval)
    12:32:59 koha_1       |         /kohadevbox/koha/t/lib/Selenium.pm:170 in Selenium::Remote::Driver::find_element
    12:32:59 koha_1       |         t/db_dependent/selenium/administration_tasks.t:188 in t::lib::Selenium::click
    
    I don't recreate it locally.
    
    The screenshot of the failure shows that the screen is still on the authorised value list view.
    
    This does not make a lot of sense, but I am failing to find a logic
    here.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5c49d1dd7fb8f368360dfaa224ee66da0f9c7ce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 14:34:03 2021 +0100

    Bug 21105: Fix test if sample data missing
    
        #   Failed test 'Identify - earliestDatestamp in the right format'
        #   at t/db_dependent/OAI/Server.t line 182.
        # Compared $data->{"Identify"}{"earliestDatestamp"}
        #    got : '2021-11-15T13:16:09Z'
        # expect : '2014-05-07T13:36:23Z'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab4b46a8484fd560df03de21f596b14626f45e66
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 14:15:22 2021 +0100

    Bug 29273: Fix failing tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6ef152db9e71805efe8e7dd6b2f8549da0f65b4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 11:44:14 2021 +0100

    Bug 21105: (follow-up) Regression tests
    
    Mock KohaAdminEmailAddress in case it differs from the default value
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de75673d8acfc44bde99a4ac303758bfa7769185
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 16:52:57 2021 +0000

    Bug 29408: Add JSDoc documentation for kohaTable function
    
    This patch adds some JSDoc formatted parameter documentation for the
    kohaTable function.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 030db7cc8d8fa7b588d8fcac1e8336ca0ee29e0d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 16:30:50 2021 +0000

    Bug 29408: Update all existing uses of .api to .kohaTable
    
    This patch goes through the codebase and updates existing revelant calls
    to .api referencing the Koha REST dataTables wrapper to use the name
    name 'kohaTable'.
    
    Test plan.
    1) Ensure the tables on the following pages all continue to work as
       expected
       a) acqui/parcel
       b) admin/branches
       c) admin/cities
       d) admin/smtp_servers
       e) pos/register
       f) tools/quotes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db4cec8498aed76af297135a04149c17cab41999
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 16:29:21 2021 +0000

    Bug 29408: Rename Koha dataTables wrapper
    
    This patch renames the Koha REST JS dataTables wrapper from the
    ambigious 'api' to the clearer 'kohaTable'.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0ca6749c5843517ea35af37769b2f8baee3d64a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Nov 3 13:47:35 2021 +0000

    Bug 29405: Fix date_renewed attribute format in patron spec
    
    This patch just adds the 'date' format string to ensure we are
    validating the input/output of the date_renewed field correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0255f0cf2c7657b2139f9d606345340605e974d2
Author: Christophe Croullebois <christophe.croullebois@biblibre.com>
Date:   Wed Nov 10 16:23:54 2021 +0100

    Bug 29452: remove unnecessary warns in the logs
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aeb242dd156af73b60d73d755bc26ef9ead1d4b9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 5 15:00:04 2021 +0000

    Bug 29321: Remove a last without loop context
    
    This reads better when converted to regular if.
    Note that last within such a block is allowed in Perl, but it feels
    better to use it only in a loop context.
    
    Test plan:
    Read the patch ;)
    Bonus: Test if you enter the block by using pref OPACSuggestionMandatoryFields
    when adding a suggestion from opac.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Edit: Added a space between 'if' and '(' :-D
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fdf64e06b5f6047eea22d431f9cf3095215bb72
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Dec 4 06:55:37 2020 -0500

    Bug 27145: Wrap delete and move_to_deleted in a transaction
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83dcdf2a5a29c0ef7795ecb4a30f6895f0e1a5d8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Dec 3 09:10:30 2020 -0500

    Bug 27145: Rethrow all other exceptions
    
    Bug 14708 introduced a try catch around $patron->delete in commit:
      "Bug 14708: (QA follow-up) Use try/catch blocks when calling"
    
    However, in the catch block it only assumes the exception was from trying to
    delete anonymous patron when it can be anything else as well, the code should
    be modified so that it will handle the anonymous patron case and if it is
    anything else we log the other exception.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38f190146151315258ecc6f3b200ab71b7e5324d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 12 11:34:58 2021 -0300

    Bug 21105: (QA follow-up) Avoid MySQL-ism
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5cce1014445bcb39f88309b4e36cb7e87dc24e56
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 12 11:15:08 2021 -0300

    Bug 21105: (QA follow-up) Silence warning because of tests setup
    
    The tests are using 'http://localhost' and the regex is setting $baseURL
    to empty in this case. It works on the oai.pl front-end.
    
    This patch changes the regex.
    
    To test:
    1. Run:
       $ kshell
      k$ t/db_dependent/OAI/Server.t
    => FAIL: Boo! Warning!
    2. Apply this patch
    3. Repeat 2
    => SUCCESS: Oh, cool. No warning :-D
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24c2fee5b47cc8bc5d41b2c91e45342f2428bcb6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 12 10:16:37 2021 -0300

    Bug 21105: Regression tests
    
    This patch introduces a regression test for the fixed behavior.
    I also changed a oneliner regex we had for stripping query parameters
    because it was causing a warning with the tests base URL
    (http://localhost) because it was generating an empty baseURL.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/OAI/Server.t
    => FAIL: Tests fail, the response is incorrect!
    3. Apply the bug's patch
    4. Repeat 2
    => SUCCESS: Tests pass! Good response!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b3d856bc42ab9372e25eae799ea50beb4cf1c0e
Author: Rudolf Byker <rudolfbyker@gmail.com>
Date:   Thu Apr 15 09:32:30 2021 +0200

    Bug 21105: oai.pl returns invalid earliestDatestamp
    
    For OAI-PMH, all date and time values must be in the format
    "YYYY-MM-DDThh:mm:ssZ" and in UTC. Currently,
    Identify.earliestDatestamp uses the SQL format "YYYY-MM-DD hh:mm:ss".
    This patch fixes that.
    
    To test:
    1) Get a Koha instance with OAI-PMH enabled.
    2) Visit /cgi-bin/koha/oai.pl?verb=Identify, view source for the page
       and observe that earliestDate is in the wrong format
       "YYYY-MM-DD hh:mm:ss"
    3) Apply patch
    4) Visit /cgi-bin/koha/oai.pl?verb=Identify, view the source for the page
       and observe that earliestDate is now in the correct format
       "YYYY-MM-DDThh:mm:ssZ"
    5) Sign off
    
    Sponsored-by: Reformational Study Centre
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 62bda478abc4ccedb211d17c4657f6eace5d1080
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 12 07:47:48 2021 +0000

    Bug 29460: Fix typo 'pendin g approval'
    
    Test plan:
    Apply and git grep for it.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90c87b2ab2022bf82ea0ddc967c7338984bb1176
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 27 12:48:35 2021 +0000

    Bug 29334: Do not apply defaultvalue to existing auth record
    
    Note: The check in build_authorized_values_list with defaultvalue can be
    simplified since $value may already contain the defaultvalue. It is filled
    before the sub is called.
    The test for inserting a blank option is generalized; and may be still
    improved when using required attributes in the template? Note that we
    might experience some browser issues for these placeholders.
    
    Removed a few useless lines with respect to fields controlled
    by itemtypes. The last assignment to $value was useless and
    its probable intention unwanted (just use defaultvalue).
    
    Test plan:
    Put a defaultvalue in an authority framework.
    Add a new authority. Check for that value.
    Open existing authority. Clear field, save and reopen. Check if
    field is still empty.
    Bonus: test field controlled by authorised values.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e191e229e77c280e862c97b0da62e23dcf3adf1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 27 12:30:07 2021 +0000

    Bug 29146: Add test for editing existing item
    
    Test plan:
    Run t/db_dependent/Koha/UI/Form/Builder/Item.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35ad7311022e0385505388070305ac8c1322d5de
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 27 12:07:03 2021 +0000

    Bug 29146: Same for item editor
    
    Test plan:
    Put some defaultvalue in an item subfield.
    Test adding new item; is defaultvalue supplied already?
    Test adding existing item. Clear the subfield. Save. Open again.
    Is the subfield still empty now?
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc30d4c3768146f23931d2c1f97a9669346465fe
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 30 13:39:59 2021 +0000

    Bug 29146: Apply framework defaultvalue only to new records
    
    This applies only to the 'regular' cataloguing editor.
    Another report could be opened for the advanced one,
    if needed.
    
    Test plan:
    [1] Add a default value to some field X in framework Y.
    [2] Open an existing biblio record in that fw. Clear field X. Save.
    [3] Reopen the record. The default should not be in field X.
    [4] Add a new record in that fw. You should see default value in X.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 22392e4a6106b6b2be7eda4a59b2c4c4ac5848de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 19 15:58:25 2021 +0200

    Bug 29273: Remove warnings from plugin tests
    
    This patch is suggesting to move the broken test plugins into a separate
    directory.
    
    t/lib/plugins and t/lib/bad_plugins
    
    Signed-off-by: David Nind <david@davidnind.com>
    JK: Add executable bit to Broken.t
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7e2837c4eafe16f3ce80d4ebf20a798d1be5039
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 12 17:15:20 2021 +0000

    Bug 28627: Calculate unitprice if not set
    
    On bug 23376 the developer was too clever by half. Instead of passing
    values to the template we moved to simply passing the order object.
    
    The calculations that populated the unitprice, however, were simply dropped.
    
    This patch restores the behaviour of setting unitprice to the estimated cost
    by default. We do this conditionally in the template
    
    To test:
     1 - Create a basket and adding items to it. Set the 'Vendor price' to
        '20', do not add an 'Actual cost'
     2 - Close the basket
     3 - Select 'Receive shipment'
     4 - Set a value for vendor invoice
     5 - Receive the order you created
     6 - Observe 'Actual cost' is = 0.00
     7 - Apply patch
     8 - Refresh the order receival page, and confirm the 'Actual cost' =
        20.00
     9 - Cancel receipt - reopen basket - edit order - add an actual cost - close
    10 - Receive the order again
    11 - Confirm the actual price is used
    12 - Repeat this whole plan, but ensure the vendor has a different value for
         Invoice prices: Include tax
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95d3c301323b42767730c204f28fe16b6319e0c7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 15 18:27:16 2021 +0000

    Bug 29255: Built-in offline circulation broken with SQL error
    
    This patch makes a minor correction to one of the queries used when
    synchronizing transactions in the built-in offline circulation system.
    This fixes the error:
    
    DBD::mysql::st execute failed: Column 'branchcode' in field list is
    ambiguous at /kohadevbox/koha/offline_circ/download.pl line 84
    
    To test you must be using a browser which still supports
    applicationCache (Firefox before version 81, Chrome before version 94).
    
    - Apply the patch and restart services.
    - Enable the AllowOfflineCirculation system preference.
    - Go to Circulation -> Built-in offline circulation interface.
    - Click "Synchronize."
    - Click the "Download records" button.
    - After the page refreshes you should see updated dates where it lists
      "last synced" information.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9bc90ebb0dfa5c9724e7473b4003275c0313d7f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Oct 18 12:28:27 2021 +0000

    Bug 29264: SIP config allows use of non-branchcode institution ids causes workers to die without responding
    
    If is entirely possible to create an SIP institution whose ID does not match a valid branchcode in Koha's SIP config. In fact, Koha's example SIP config contains an example of this ( kohalibrary / kohalibrary2 ).
    
    If a SIP login uses an institution with an id that doesn't match a valid branchcode, everything will appear to work, but the SIP worker will die anywhere that Koha gets the branch from the userenv and assumes it is valid.
    
    The repercussions of this are that actions such as the checkout message simply die and do not return a response message to the requestor.
    
    At the very least, we should output a warning to the SIP log.
    
    I think we should strongly consider disallowing institution ids in the SIP config that do not match valid branchcodes. In this scenario, attempting to start the SIP server should result in a error message with the SIP server exiting immediately.
    
    Test Plan:
    1) Apply this patch
    2) Make a sip login that uses an instution whose id is *not* a valid branchcode
    3) Start the SIP server
    4) Check sip.log, you should see a warning similar to the following:
    [2021/10/18 12:18:29] [2068079] [ERROR] ERROR: Institution kohalibrary does does not match a branchcode. This can cause unexpected behavior. C4::SIP::Sip::siplog /kohadevbox/koha/C4/SIP/Sip.pm (220)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3cca6f444084621e9b84489a2615368d2af189fe
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Nov 6 14:16:38 2021 +0000

    Bug 29204: (QA follow-up) Fix variable name
    
    The patch "Bug 29204: Fix reports/issues_stats.pl for MySQL 8"
    accidentally changed the variable name from $strsth2 to $strsth
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70f0d50d0721f6692453176f1d901f638d165092
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 19 11:08:29 2021 +0200

    Bug 29204: Fix reports/issues_stats.pl for MySQL 8
    
    Error was: Incorrect DATETIME value: ''
    
    Test plan
    Go to Reports -> Circulation
    On Period select "Row" or "Column" and choose a date
    Submit
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec3a35441569381024c3f0621478f86203663a62
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 12:37:50 2021 +0100

    Bug 28374: DBRev 21.06.00.047
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c559cdeec007071c556c84fe107affec752746cc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Nov 11 15:29:39 2021 -0300

    Bug 28374: (QA follow-up) Avoid adding duplicate USE
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c6312b873b07a23e406a736c3e3147cbb3021d6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 5 14:53:39 2021 +0000

    Bug 28374: Update existing notices
    
    This patch updates the default slip to include KohaDates, Branches and
    Price plugins as required and prepends the same to existing notices at
    upgrade time.  We also, switch the HTML flag on.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1fbae1580f1669285a0f6bb4cf9f131728e29a5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 18 16:15:53 2021 +0100

    Bug 28374: Convert printreceipt to use GetPreparedLetter
    
    This patch converts the point of sale receipt printer controller to
    using GetPreparedLetter instead of calling getletter directly.
    
    Test plan
    1. Setup for testing:
       i.   Enable EnablePointOfSale and UseCashRegisters system preferences
       ii.  Add a new cash register
            (Administration > Accounting > Cash registers)
       iii. Add one or two products for sale
            (Administration > Accounting > Debit types, make sure 'Can be sold?' is ticked)
    2. Go to Home > Point of sale
    3. Add some items for purchase to a sale
    4. Click confirm
    5. Click on 'Print receipt' and save the PDF file somewhere
    6. Apply patches
    7. Update database: updatedatabase
    8. Repeat steps 2-5
    9. Compare receipt PDFs - should be no changes
    10. Check that the default RECEIPT is updated - for print, HTML should be ticked
    11. Sign off!
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88e9cca3594c42c1eb430b3155c47a4a6fcab761
Author: Magnus Enger <magnus@libriotech.no>
Date:   Tue Nov 9 10:13:05 2021 +0000

    Bug 28994: Fix logical errors with amount vs amoutoutstanding
    
    The writeoff debts script contained an error whereby we could writeoff
    more than the current outstanding debt of a charge.  This patch corrects
    that mistake by passing amountoutstanding in place of amount in the
    writeoff and offset creation lines.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4c44ac212078a956d0bdb088af9170ab3fa9c64
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 8 09:45:31 2021 -0300

    Bug 29183: (follow-up) Add x-koha-query option
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4d1b30276ded632600c7fdcf1de00bd08f028ae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 13 11:39:27 2021 +0100

    Bug 29183: Add some documentation around query filtering
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 562e543c3e40af2436a0058e6d990e8217d3919d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Nov 12 08:55:42 2021 +0000

    Bug 29330: (QA follow-up) Change to message/rfc822
    
    This content-type might be more appropriated to use as a temporary
    label for the serialized email message with attachments.
    
    WARNING: perl -cw tells you that the constant is redefined. This has
    to do with an already existing module dependency loop of Letters.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d6ef70bb0779b27e0325e51b9cc06a72f313f85
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Nov 8 08:10:38 2021 -0300

    Bug 29330: (QA follow-up) Use passed MIME type
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: tidied.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbd700ce0b45a1b90053fdca4af6e77e8cca6c96
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 5 16:05:48 2021 -0300

    Bug 29330: Restore handling of serialized MIME messages in message_queue
    
    This patch changes how multipart MIME messages are handled on the
    message_queue table.
    
    The email, with the required attachments, is now generated using
    Koha::Email, and serialized using Koha::Email->as_string.
    
    This bug also adds Koha::Email->new_from_string which is used to read
    that data from the DB, and produce a Koha::Email object, that can be
    further augmented/modified using regular Koha::Email methods.
    
    This implementation should be considered a middle ground, with
    backportability in mind. higher-level methods should encapsulate setting
    the default headers and addresses, to clean the area a bit further.
    
    Preparation:
    - You need a valid SMTP configuration in koha-conf.xml. If you use Gmail
      you can generate an 'app password' and set things like this:
    
     <smtp_server>
        <host>smtp.gmail.com</host>
        <port>587</port>
        <timeout>5</timeout>
        <ssl_mode>STARTTLS</ssl_mode>
        <user_name>youraddress@gmail.com</user_name>
        <password>youpassword</password>
        <debug>1</debug>
     </smtp_server>
    - Set KohaAdminAddress to your address.
    
    To test:
    1. Pick a patron. Make sure it doesn't have any email address (Acevedo?)
    2. Set an overdue notice trigger for its category
    3. Check something out, with due date in the past to force an overdue
    4. Run:
       $ kshell
      k$ misc/cronjobs/overdue_notices.pl -v
      k$ exit
       $ koha-mysql kohadev
       > SELECT * FROM message_queue WHERE borrowernumber=the_borrowernumber;
    => SUCCESS: A notice has been created
    5. Run:
       $ kshell
      k$ misc/cronjobs/process_message_queue.pl --verbose
    => SUCCESS: SMTP is ok => Email is sent
    => FAIL: Your inbox shows an email with weird content
    6. Apply this patches
    7. Run:
       $ koha-mysql kohadev
       > DELETE FROM message_queue;
    8. Repeat 4 and 5
    => SUCCESS: You got an email with an attachment!
    => SUCCESS: The attachment contains an email that couldn't be delivered!
    9. Try all the things that enqueue messages :-D
    => SUCCESS: No behavior change
    10. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Edited the POD, restoring a few lines that describe the needed hash
    keys of the attachments.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c741692e14ea7453f6257e22aaee8ae377b59ebf
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 5 15:22:25 2021 -0300

    Bug 29330: Add Koha::Email->new_from_string
    
    This patch introduces a new method to Koha::Email. This method allows us
    to parse a MIME email to initialize the Koha::Email object. This is
    particularly important when we are restoring emails from the DB. i.e.
    from the *message_queue* table.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/Koha/Email.t
    => SUCCESS: Tests pass! Koha::Email->new_from_string is the correct
    counterpart for Koha::Email->as_string!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43a603d9ccca8e804d06998d90bf9a74807b2c50
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Nov 8 09:29:58 2021 +0100

    Bug 29435: include missing subroutine from C4::AuthoritiesMarc
    
    The OPAC authority details page is broken when the 'AuthDisplayHierarchy'
    System Preference is set to 'Enable',
    
    This patch fixes that.
    
    Test plan:
    1) Set AuthDisplayHierarchy to 'Enable' and try to view the details
       page of an authority in the OPAC -- the page is broken.
    2) Apply this patch.
    3) Refresh the page; this time the authority details are displayed.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b5b443d6c1eb18d32a72a603e8f090fd85128e9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Nov 11 13:46:32 2021 +0000

    Bug 29459: Replace some missed datetimepickers in circulation templates with Flatpickr
    
    This patch updates a few more instances of jQueryUI datepickers which
    were missed initially, replacing them with Flatpickr widgets.
    
    Also changed: A few datetime input fields are updated to have a size of
    20, consistent with other datetime input fields.
    
    To test, apply the patch and go to Circulation.
    
    Check in:
    
    - With the 'SpecifyReturnDate' system preference enabled, go to Check
      in.
    - Click the "Checkin settings" link.
    - Test the "Specify return date" field. Clicking it should trigger a
      Flatpickr widget with a time picker. It should limit your selection to
      dates in the past.
    - Check the "Remember return date" checkbox and confirm that the date is
      preserved over page reloads.
    - Check and uncheck the "Box drop mode" checkbox to confirm that the
      return date field is disabled and enabled correctly.
    
    Check out:
    
    - With the 'AllowRenewalOnHoldOverride' preference enabled, check out to
      a patron who has a checkout which is on hold for another patron.
    - At the bottom of the table of checkouts, click the "Override renewal
      restrictions" checkbox.
    - The on-hold checkouts should now have a checkbox in the "Renew"
      column. Check one or more of these checkboxes.
    - In the table footer you should now see two date inputs, "Renewal due
      date" and "On hold due date." These should both trigger Flatpickr
      widgets with time pickers.
    - Confirm that your date selections are submitted correctly when you
      renew items.
    
    ILL checkout:
    
    - Create a new ILL request with the type "book," filling in at least
      title, patron, and destination library.
    - On the "Manage ILL request" page, click "Confirm request" and "Confirm
      request" on the next confirmation page.
    - There should now be a "Check out" button in the "Manage ILL request"
      toolbar. Click it.
    - Test the "Due date" field. It should trigger a Flatpickr widget with a
      time picker.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d06aa52c659c7b34edfd05e758dfc4d9b331e71
Author: Andrew Nugged <nugged@gmail.com>
Date:   Fri Nov 12 23:48:48 2021 +0200

    Bug 28413: (QA follow-up) Fix for missing use Koha::Items
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c44edf6f1c33f57428b72c552647c604301ab472
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 11:01:34 2021 +0100

    Bug 28376: (follow-up) Replace jQueryUI date/timepicker with Flatpickr
    
    Remove uneeded include of flatpickr.min.js (we load it from
    calendar.inc)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02d094a36c517dd442394430db5d4007071d8eb1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 15 11:48:51 2021 +0100

    Bug 27360: (follow-up) DBRev 21.06.00.041
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0767f94d07950e7420deb901b208d131427c535
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 5 12:50:35 2021 -0300

    Bug 29427: Make SMTP transport set debug mode correctly
    
    This patch makes the _transport_ method in Koha::SMTP::Server pass the
    debug flag correctly to the Email::Sender::Transport::SMTP->new
    constructor.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/SMTP/Server.t
    => FAIL: Oh noes! debug is not passed to the constructor!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Hey! It is being set!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6b6bdb96f4cab0677402194db7e6408feb6fca6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Nov 5 12:50:01 2021 -0300

    Bug 29427: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9b5c861b26a18d040606462230d85668736d9ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 8 12:15:38 2021 +0100

    Bug 29195: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3a91082e97fcda636da0daa99412897b44f1d0a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 5 12:22:07 2021 +0000

    Bug 29195: Fix highlighting on odd rows in circ-patron-search-results
    
    This patch adds "!important" to the CSS rule governing the background
    color of table cells when hovered. It only applies to tables with the
    "selections-table" class.
    
    Although "!important" is not usually recommended, in this case the
    appliation is narrow enough that I think it outweighs the complicated
    selector that would be required to make it work otherwise.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Locate a record in the catalog and being the process of placing a
      hold.
    - When you're asked to enter a card number or search by name, search
      using a name which will return multiple results.
    - In the table of results, hovering the mouse over the table should
      highlight the row in yellow.
    - Perform the same test when searching for a club by name.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5324962a8beb4d85619d00d06be443f0a67b6629
Author: Florian Bontemps <florian.bontemps@biblibre.com>
Date:   Fri Nov 5 16:28:37 2021 +0000

    Bug 29429: (bug 17600 follow-up) Fix import in aqbudgetperiods.pl
    
    Adds GetBudgetHierarchy to the functions called by C4::Budgets
    
    Plan :
    1. Create a budget with a random amount, save it.
    2. Try to close the budget.
    3. You should get an Error Trace.
    
    4. Apply the patch
    5. Close the budget again
    6. It should work.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d28f9342825ad399ac62d28810345b4bdaddb022
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 3 12:22:24 2021 -0300

    Bug 29407: Make the pickup locations dropdown JS reusable
    
    This patch generates a function to be used in places where select2
    dropdowns are usesd for choosing pickup locations. This cleans
    repeated/almost identical code introduced by different bugs.
    
    To test:
    1. Make sure choosing pickup locations works
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: No functional changes
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7af1a0f052ace730d6d6bd2a0de457a8901bc61c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Nov 2 16:57:49 2021 -0300

    Bug 29404: Add infinite scrolling to pickup location dropdowns
    
    This patch adds infinite scrolling to the pickup locations select2
    dropdowns on the staff interface.
    
    It does so by adding a new transport function (in select2.js) to read
    the response headers Koha's API sends back, and converting to the right
    data structure Select2 expects for the feature to work.
    
    This is manually used in the different pickup locations dropdowns.
    There's a separate bug that will introduce a select2 wrapper that will probably embed this function in it.
    
    To test:
    1. Run the [DO NOT PUSH] script inside koha-shell to generate random
       pickup locations:
       $ kshell
      k$ perl generate_pickup_locations.pl
    2. Try placing holds. Notice the visible pickup locations dropdowns
       display some pickup locations based on the matches you got. They are
       all fetched once
    => SUCCESS: It works
    3. Repeat for the current holds page and the patron holds listing
    => SUCCESS: Same behavior
    4. Apply this patch
    5. Repeat 2 and 3
    => SUCCESS: Things work, but pickup locations are retrieved as needed,
    while you scroll.
    6. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4efbe396a7575a4b969b9caeab65ba60cf39d2f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 5 18:19:40 2021 +0000

    Bug 29430: Table cell click doesn't activate buttons in patron search
    
    Bug 15812 included a change which allows a click on the patron
    search results table cell to toggle the checkbox it contains. This patch
    modifies that click event so that it fires the change() event which is
    required for toggling the "Add to patron list" and "Merge patrons"
    buttons.
    
    To reproduce this problem, perform a patron search in the staff client
    which will return multiple results.
     - In the first column containing checkboxes, click in the empty part of
       the table cell. The checkbox should be checked.
       - However, the "Add to patron list" button remains disabled.
      - Clicking a table cell to check another checkbox should result in the
        "Merge selected patrons" button being enabled, but it doesn't.
    
    To test, apply the patch and repeat the process above. The behavior of
    the buttons should be the same whether you're clicking the checkbox
    itself or the table cell it's in.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e87dcc7b20ce03753abe2ac737f97c52a45d5daa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 8 11:38:35 2021 +0100

    Bug 24224: DBRev 21.06.00.046
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8473254ec31d3b0f5ccc07865a732a5b9c932c56
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Nov 5 10:45:45 2021 +0000

    Bug 24224: Convert OpacNavBottom system preference to additional content
    
    This patch builds on Bug 22318 to move the OpacNavBottom system
    preference into the "Additional contents" system, making it possible to
    have language- and library-specific content.
    
    To test you should have some content in the OpacNavBottom system
    preference. To make testing easier it's also a good idea to have content
    in the OpacNav preference.
    
    - Apply the patch and run the database update process.
    - In the staff client, go to Tools -> HTML customizations and verify
      that the content from OpacNavBottom is now stored there. When you
      edit the entry you should see content from the OpacNavBottom system
      preference under the "default" tab.
      - The publication date for the entry should be today's date.
      - Confirm that the previous contents of OpacNavBottom were added
        correctly.
    - Go to Administration -> System preferences -> OPAC and verify that
      the OpacNavBottom preference has been removed.
    - Update and reinstall active translations (for instance fr-FR):
      - cd misc/translator/
      - perl translate update fr-FR
      - perl translate install fr-FR
    - View the OPAC and confirm that the contents of the OpacNavBottom
      system preference displays in the left-hand sidebar.
    - Test as many pages as possible to confirm that wherever the
      OpacNavBottom content is displayed, OpacNavBottom is also displayed.
    - Test also using the updated translation.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa419b9e4ce51881865c6ffaa868bf51372dd006
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Nov 8 11:31:10 2021 +0100

    Bug 24223: DBRev 21.06.00.045
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dbec2d4951ded6270642f4ceeea00338f5eafa6b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 19 11:36:11 2021 +0000

    Bug 24223: (QA follow-up) Do not copy to other languages
    
    By majority on Bugzilla, we dont want to have the existing text in all
    translatable languages.
    
    Note: Removing the news_123 as code here, switching to OpacNav now.
    Another report should handle/improve the use of code, assuming that
    it is meant to provide some form of grouping. There is now confusion
    between the fields code and location.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5b147df0a44d3423f5c48ed047eca78bcbeba25
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 10:36:51 2021 +0200

    Bug 24223: Get languages for OPAC
    
    There were 2 warnings
    
    Use of uninitialized value $interface in concatenation (.) or string at /kohadevbox/koha/C4/Languages.pm line 121.
    Use of uninitialized value $theme in concatenation (.) or string at /kohadevbox/koha/C4/Languages.pm line 121.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d0a023b6f5cb09a9fcef46ee9bd0fac5b07b903
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 24 20:38:46 2021 -1000

    Bug 24223: (follow-up) Do not add id 'opacnav' in navigation.inc
    
    Id attribut will be defined by 'koha_news_block'.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4577950900e0738f3e3cf09b1ae5ebf364e8d8be
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 4 19:33:33 2020 +0000

    Bug 24223: Convert OpacNav system preference to additional content
    
    This patch builds on Bug 22318 to move the OpacNav system
    preference into the "Additional contents" system, making it possible to
    have language- and library-specific content.
    
    To test you should have some content in the OpacNav system
    preference. To make testing easier it's also a good idea to have content
    in the OpacNavBottom preference.
    
     - Apply the patch and run the database update process.
     - In the staff client, go to Tools -> HTML customizations and verify
       that the content from OpacNav is now stored there. When you
       edit the entry you should see content for each of the enabled
       translations in your system under each tab.
       - Confirm that the previous contents of OpacNav were added
         correctly.
     - Go to Administration -> System preferences -> OPAC and verify that
       the OpacNav preference has been removed.
     - Update and reinstall active translations (for instance fr-FR):
       - cd misc/translator/
       - perl translate update fr-FR
       - perl translate install fr-FR
     - View the OPAC and confirm that the contents of the OpacNav system
       preference displays in the left-hand sidebar.
     - Test as many pages as possible to confirm that wherever the
       OpacNavBottom content is displayed, OpacNav is also displayed.
     - Test also using the updated translation.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 24223: (follow-up) Add date to OpacNav additional content entries
    
    This follow-up modifies the atomic update so that it inserts today's
    date as the "Published on" date. Without that information the system
    considers the item unpublished and will not display the content.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 24223: (follow-up) Make logged-in user's branchcode available to template
    
    This patch makes a couple of corrections for problems I discovered
    while working on Bug 24224: The variables required for correct display
    of news items by branch and language were not consistently available to
    the templates.
    
    In opac-readingrecord.pl, the "lang" variable was being overwritten. On
    this and other pages the logged-in patron's brachcode was not made
    available. I've corrected instances of KohaNews.get() to use the
    globally-available "logged_in_user.branchcode" instead.
    
    To test, apply the patch and follow the original test plan, with the
    addition of instances of the OpacNav additional contents item which
    have a specific library selected.
    
    Confirm that such items are correctly displayed according to the
    logged-in user's home library. If there is no logged-in user the
    library-specific OpacNav should not display.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 24223: (follow-up) Updates to conform to new practices
    
    - The patch now works with new "Additional contents" system
    - The database update follows new skeleton.pl
    - Add "OpacNav" option to the additional contents template
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 24223: (follow-up) Add missing "return" to atomicupdate
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 24223: (QA follow-up) Link OpacNav to HTML customizations now
    
    In the pref description of OpacNavBottom. (Before obsoleting that
    one too somewhere soon.)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e290d8d02abbbc6c5160b02dee4dede2fa059bf4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 5 10:13:47 2021 +0100

    Bug 29416: (bug 28941 follow-up) Restore suggestion prefill
    
    From commit 586bed1319592e05f5dc3acf64a1dba8cae69d6b
         Bug 28941: Filter suggestion inputs at the OPAC
    
    But later in the script we send { suggestion => %$suggestion } to the
    template and so erase the variable previously passed.
    
    Test plan:
    Login at the OPAC
    Go to the bibliographic detail page
    Suggest for purchase
    => The form must be prefilled!
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ada1c03350eb952928f68b5f1594174a3e25bf98
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 21 12:45:46 2021 +0000

    Bug 24674: (follow-up) Simpler regex
    
    The 'Polish notation' actually simplifies things.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b71f1137ba761e641a91c435908b9b77a740fa51
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Feb 18 14:49:46 2020 +0100

    Bug 24674: Adjust tests and add new ones to cover changes
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Rebased 21-09-21.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fa32f239475e019d840e01d5bf471d10f0fc1ac
Author: Janusz Kaczmarek <januszop@gmail.com>
Date:   Mon Feb 17 12:58:46 2020 +0100

    Bug 24674: Uncertain years for publicationyear/copyrightdate -- corrected
    
    This is a correction to Bug 11046: YYY-, YY--, Y---, are also
    correct according to ISBD: uncertain year, but certain decade/century
    (cf. n. 4.3.8 in ISBD Consolidated Edition of 2011).
    (Question mark is not mandatory.)
    
    In addition, in Poland a form with one only dash is quite common,
    like YY- (== YY--).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    See last follow-up.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a060bbb2f0e67ae43666834027800b5bf7a7180
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 21 11:57:20 2021 +0200

    Bug 28413: Reduce background job worker memory footprint
    
    It's loading the modules in RAM then forks.
    Then do not need it to have them loaded in the parent process (the worker/daemon).
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ba18f5f4497c13d961bc2f1d7ee7fc992baeaf0
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Sep 27 14:47:00 2021 +0200

    Bug 29123: Add Dataly Tech to About page
    
    This patch adds Dataly Tech to the list of "Contributing companies
    and institutions" in the About page.
    
    Test plan:
    1) View the About page, notice how Dataly Tech is missing
    2) Apply this patch
    3) Reload the About page, this time "Dataly Tech, Greece" is listed
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75cc8ba054daad4d46fee7c9b8ffe64965bbe2e8
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Tue Nov 2 23:22:45 2021 +0000

    Bug 27708: (QA follow-up) Add a few tests for Koha::Edifact::Order
    
    1. This adds a simple regression test to make sure order_line() method
    executes correctly with basket create_items set to "ordering" and
    "receiving".
    
    2. A simple test for the filename method is added
    
    To test:
     1) prove t/db_dependent/Koha/Edifact/Order.t
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4e738a720b71716a9b6c4badbe40a0592a038e7
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Wed Mar 3 14:34:52 2021 +0200

    Bug 27708: Unify two item object creation blocks to be stored as hash
    
    Previously for existing item data was stored as an object reference and
    then treated as one, but for not yet existing item data was stored as
    keys in hash reference in the same variable and later it was treated
    like an object, hence why it crashed with "no method".
    This patch unifies that variable in both cases filled as hash and
    treated as such.
    
    To reproduce:
        1) Go to "Administration->System preferences" and change
    "AcqCreateItem" to "receiving an order."
        2) Now, go to "Acquisitions" and create a new Vendor,
    or use an existing one.
        3) Next, go to "Administration->EDI Account" and add EDI account
    (pick that Vendor that you created recently, or the one that you will
    use for this test).
        4) Also in "Administration->Library EANs" add EAN if you didn't
    have one previously.
        5) Go back to "Acquisitions" and add a new basket to your Vendor
    that you will use for this test.
        6) Press "Create EDIFACT order" button. It should throw
    "Can't call method "homebranch" on unblessed reference..."
    software error.
        7) Apply the patch.
        8) Reload the page that threw software error previously
    (or repeat steps 5, 6 if you need another basket),
    it should go through now.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc3a129db81fe009a893c074757ec1df44096dea
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Nov 4 06:50:46 2021 +0000

    Bug 29411: Redirect to circulation if circsearch is true
    
    TO test:
     1 - Have a patron with a unique surname i.e. Acosta
     2 - Enter the surename into 'Search patrons' box on staff homepage
     3 - You are redirected to 'members/moremember.pl'
     4 - Enter the surname into 'Check out' box at top of page
     5 - You are redirected to 'members/moremember.pl'
     6 - Apply patch
     7 - Enter the surename into 'Search patrons' box on staff homepage
     8 - You are redirected to 'members/moremember.pl'
     9 - Enter the surname into 'Check out' box at top of page
    10 - You are redirected to 'circ/circulation.pl'
    
    Signed-off-by: Owen <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9bf06723609fcecb1e4d6c0d9e89a029a21c7664
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 5 09:30:31 2021 +0100

    Bug 28768: Fix borrowernumber from opac-readingrecord.tt
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3203ffe58eb58949de4b0ab51724ee956c07c70b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 30 12:12:17 2021 +0000

    Bug 28768: (QA follow-up) Remove unused variable
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 94e10564624cee53caae8619e5809ea37d4dc549
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Jul 27 18:08:12 2021 +0000

    Bug 28768: remove unnessesary template variable
    
    To test:
    1. Add some news that should display on opac-readingrecord.pl. For example: opacheader, OpacCustomSearch, opaccredits
    2. Go to opac-readingrecord.pl, the news doesn't display
    3. Apply patch, restart_all
    4. Go to opac-readingrecord.pl, the news displays
    5. Turn on 'opacreadinghistory' and test to make sure it still works
    
    Signed-off-by: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a691760ac20e1cbfea96de93c487582a5dcc926d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 5 12:16:53 2021 +0100

    Bug 29180: DBRev 21.06.00.044
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bff9d86b92edea694ea2c7da1734e6c801e6a5f6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 5 10:03:34 2021 +0000

    Bug 29180: (QA follow-up) Don't alter old DB up date
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a9c23156b1efea45922d36b03b103b28d745b43
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 5 10:02:32 2021 +0000

    Bug 29180: (QA follow-up) Alphabetize sysprefs.sql
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70485bf1cc6848b47797a4035be0689c598e456a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 4 14:39:28 2021 +0100

    Bug 29180: Rename syspref RequestOnOpac with OPACHoldRequests
    
    It is a confusing name because we have 'Article Request' as a feature,
    and this does not follow Koha terminology.
    
    Test plan:
    `updatedatabase` and confirm that the syspref has been renamed
    `git grep RequestOnOpac` => No occurrence in the code
    
    QA: The syspref's value is always retrieved using Koha.Preference from
    .tt files, we don't need to send it from controllers or C4::Auth
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71aa651b5ce696d0a5b37048866d8feaa1119540
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 5 12:12:52 2021 +0100

    Bug 29386: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 849d7a3838148ff787008cb6ad6865a74bca38d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 5 12:10:30 2021 +0100

    Bug 29386: DBRev 21.06.00.043
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 866fbfdb605b47ae7cbf427cdbb2ea5435b52ea5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 4 10:44:28 2021 +0100

    Bug 29386: Extend background_jobs.data to LONGTEXT
    
    TEXT is too small, we must extend it to allow bigger jobs.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 588cb367bab6d2c991cbc06a10e880f3d34c1df4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 5 11:50:09 2021 +0100

    Bug 29265: Add missing category parameter
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fac962413e637fd2a5205e42feaf24c70ff6c7b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 4 09:25:34 2021 +0100

    Bug 26326: Add missing +x flag
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91d1d3daeb079bca9380eeea012b66f3959da984
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Nov 4 09:24:59 2021 +0100

    Bug 29261: Add missing html filters
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7ba9148610582fb772cf4e2cc7e35227e1aac8f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 25 18:55:53 2021 +0000

    Bug 29265: Add option to pick editor when creating a new content entry
    
    This patch changes the "New entry" button on the additional contents
    page to be a split button which offers the alternative of the
    non-default editor (as defined by AdditionalContentsEditor).
    
    Also changed: I moved some of the template logic around to consolidate
    handling of the editor variables.
    
    To test, apply the patch and go to Tools -> HTML customizations.
    
     - At the top of the page there should be a split button. The dropdown
       option should offer the non-default editor.
     - If AdditionalContentsEditor is set to "text editor," clicking the
       "main" part of the button should take you to an entry page which uses
       the text editor.
       - The dropdown part of the button should say "New entry using
          WYSIWYG editor."
     - Switch the AdditionalContentsEditor preference and confirm that the
       button reflects the change.
     - Confirm that the individual "Edit" buttons for each existing content
       entry still works correctly according to the system preference.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d14c1f15a472712d1228906bc0998b82f981d97b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 28 11:00:29 2021 +0000

    Bug 29201: Add option to insert biblio_framework runtime parameter in SQL report
    
    This patch modifies the SQL report creation process so that the list of
    runtime parameters includes an option for bibliographic framework.
    
    To test, apply the patch and go to Reports -> Create from SQL.
    
    - Click the "Insert runtime parameter" menu button and select
      "Bibliographic framework."
    - You should be shown a modal dialog in which you can change the label
      on the framework input.
    - Click "Insert parameter." The SQL field should now contain the correct
      parameter, e.g. <<Framework|biblio_framework>>
    - Use the parameter to define an SQL query, e.g.
    
      "SELECT * FROM biblio WHERE frameworkcode =
      <<Framework|biblio_framework>> LIMIT 10"
    
    - Run the report. You should be asked to choose a framework. Confirm
      that the report runs correctly.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2054efff2b7c068031afe0afca337cb884e06f9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 29 10:47:03 2021 +0000

    Bug 29369: Use Flatpickr in dateaccessioned cataloging plugin
    
    This patch udpates the dateaccessioned cataloging plugin to use the
    Flatpickr date picker instead of jQueryUI.
    
    To test, apply the patch and open an item for editing in Cataloging.
    
    - The date acquired field (952$d) should have flatpickr styling.
    - Clicking in the field should populate the field with today's date and
      trigger the calendar popup.
    - Clicking the "..." next to the field should populate the field (when
      empty) with today's date.
    - Verify that tabbing from a different field into the date acquired
      field behaves the same as a click.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bc141ae7d1af623b2501dd39ce10a508b7b230f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:02:59 2021 +0100

    Bug 28982: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7093543192b679431dff735cdd8fe6e4cb65fec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 4 17:33:31 2021 +0000

    Bug 28982: (follow-up) Ensure that date format is correctly checked
    
    This patch modifies the global calendar include so that it doesn't use
    the potentially-undefined template variable "dateformat."
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3135848077b0ea0bbdc8eda3eb796048bf25fbf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 9 14:10:57 2021 +0000

    Bug 28982: Use Flatpickr on onboarding pages
    
    This patch replaces the use of jQueryUI's datepicker in the onboarding
    templates. The addition of calendar.inc to the template requires that
    some additions be made to the installer's header files, adding the i18n
    JavaScript assets.
    
    jQueryUI-specific CSS is removed from installer.scss, and inclusion of
    Flatpickr's SCSS is added.
    
    To test, apply the patch and rebuild the staff client SCSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Start the installation process.
    - Continue through the installation process until you reach the stage in
      onboarding where you are creating a patron category.
    - The "Enrollment period -> Until" field should be a Flatpickr calendar
      widget. The widget should look and work correctly.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a67a732c2109e6c27014d3b71725130bb0381de
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:02:46 2021 +0100

    Bug 28816: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 087cb956e0fd76a3d6138e538a8868a9ba99bda5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Aug 5 18:02:29 2021 +0000

    Bug 28816: Improve the display of multiple holds during hold process
    
    This patch updates the appearance of the "confirm holds" page, shown
    during the process of placing a hold for someone in the staff interface.
    
    Most of the changes affect the appearance of the page when placing
    multiple holds on titles which have one or more holds on them already.
    
    The changes are intended to make the page clearer and easier to scan,
    especially when placing multiple holds at once.
    
    Also changed: The page heading when placing multiple holds now changes
    based on whether you've selected a patron or not. It says "Search
    patrons or clubs" when it's waiting for a patron/club selection. It says
    "Place holds" after the patron/club has been selected. This is instead
    of "Confirm holds" on both pages.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Administration -> System preferences and set HoldsSplitQueue to
      "nothing."
    - Perform a search in the staff client catalog and place multiple holds
      titles from that result set on hold for a patron.
    - Perform the same search and select one or more of the titles you
      selected before in addition to one or more titles with no holds.
    - After clicking the "Place hold" button you should see a page with the
      heading "Search patrons or clubs" showing information about existing
      holds. This section of the page should be clear and readable, with
      clear distinction between each section of information about each hold.
    - Test this page again under each different option for the
      "HoldsSplitQueue" system preference by changing the preference and
      reloading the page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5215670c90f8400583423ec7e5af62d98fd3b76
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:02:35 2021 +0100

    Bug 28694: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fe42caeb9efcdd0d37488f16468a1bb5e5c580e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 8 15:31:46 2021 +0000

    Bug 28694: Check alert in cataloguing should be a static message
    
    This patch modifies the basic cataloging interface so that form
    validation errors are collected in a static "dialog" at the top of the
    page instead of showing in a transient JavaScript alert.
    
    The text of the message is roughly the same as it was in the alert, and
    links have been added so that the user can click to jump directly to the
    field referenced.
    
    If the user scrolls down away from the static error message, a button
    appears in the floating toolbar to jump back to the message.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Cataloging and create a new record using the basic cataloging
      editor and a framework which has multiple mandatory fields defined
      (e.g. an unmodified default framework)
    - Without entering anything in mandatory fields, click the "Save"
      button.
    - You should see a message box appear at the top of the page.
      - It should list each missing mandatory subfield and tag, each with a
        "Go to field" link next to it.
      - Clicking the "Go to field" link should switch you to the correct tab
        and scroll the mandatory field into view.
    - When you have scrolled down far enough for the error messages to be
      offscreen, an "Errors" button should appear in the floating toolbar.
      Clicking it should scroll the box back into view.
    - The JS function for scrolling to a particular element on the screen
      has been modified, so test that the links in the toolbar for
      individual tags still work correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ce700923e682f17d3856a9bf5acd75b5033d6ec
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 17 15:15:55 2021 +0000

    Bug 28537: (follow-up) Correct and improve OverDrive checkout modal
    
    This patch corrects the markup of the modal which is displayed when the
    user clicks the "Download as" button in their list of OverDrive
    checkouts. The modal markup had not been updated in the conversion to
    Bootstrap 4.
    
    I have also modified the markup generated when listing the download
    format options so that they use some standard Bootstrap 4 classes,
    improving the layout a little.
    
    To test you must have valid credentials entered in system preferences
    for the OverDrive API. You should test using a patron who has holds and
    current checkouts in OverDrive.
    
    Apply the patch and log in to the OPAC.
    
    - On the "Your summary" page, open the "OverDrive Account" tab.
      - Log in to your OverDrive account.
      - In the list of current checkouts, click the "Download as" button for
        one of the titles.
        - A modal window should display with a list of radio buttons for
          each available format.
          - Confirm that the format text acts as the label for the radio
            button.
          - Confirm that closing the modal without making a selection works
            correctly.
          - Confirm that making a selection and submitting the form closes
            the modal and submits your choice.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 883accab08f70cafab8ab9f71c204d7ca7dd5362
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 9 15:43:50 2021 +0000

    Bug 28537: Improve HTML generated by OverDrive integration
    
    This patch makes changes to the way HTML is generated when showing
    output from OverDrive integration:
    
    - Buttons have Bootstrap button classes
    - Layout of information is improved.
    - Handling of cover image thumbnails is improved, especially in cases
      where images were much larger than expected.
    - An OverDrive-specific CSS file is added.
    
    To test you must have valid credentials entered in system preferences
    for the OverDrive API. You should test using a patron who has holds and
    current checkouts in OverDrive.
    
    Apply the patch and log in to the OPAC.
    
    - On the "Your summary" page, open the "OverDrive Account" tab.
      - Log in to your OverDrive account.
      - The contents of the tab should display well, with item
        thumbnails showing in a column to the left, and item information
        showing to the right.
      - Controls should be styled with standard Bootstrap style.
      - Confirm that operations work correctly: Acessing titles, checking
        in, canceling holds, etc.
    
    - Perform a catalog search which will return results also found in your
      OverDrive collection.
      - Open the OverDrive results page.
      - The page should display correctly, especially thumbnails.
      - Confirm that operations work correctly: Checking out and placing
        holds.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a368c4e4346e0d2e8f4e4e06f0dfee6c74a0a16
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:02:16 2021 +0100

    Bug 28450: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1f074ee8dc3e04d44c6c3ccb19646434be1f41c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 12 10:32:05 2021 +0000

    Bug 28450: Make Account summary print tables configurable
    
    This patch adds table settings for the three tables which appear on the
    patron's "Print summary" view. This will allow the administrator to
    set a default configuration for columns on the print summary page.
    
    To test, apply the patch and restart-all to load the revised columns
    settings YAML. Rebuild the staff interface SCSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Administration -> Table settings -> Circulation.
    - Under the "Circulation tables" heading you should see a "Jump to" link
      to "print_summary."
    - In the settings for the print_summary page you should see three
      tables: print-summary-checkouts, print-summary-fines, and
      print-summary-holds.
    - Locate a patron account which has checkouts, fines, and holds.
      - From the patron detail view click "Print -> Print summary."
      - A new window should open with the print summary view. All tables
        should display correctly.
      - Test that the "Columns" buttons work correctly to show and hide
        columns.
    - Make changes to the default settings for these tables to confirm that
      they work on the print summary page.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13375107ce8d3a2a636df0aa07c657f3a62494d7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:01:46 2021 +0100

    Bug 27823: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e9aa4268569a8424a4d0e55f08153391bdda7a9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 15 12:26:16 2021 +0000

    Bug 27823: List upcoming steps during installation process
    
    This patch adds text to each step of the installation process showing
    which steps have been completed, which step is current, and which steps
    come next. This helps the user know where they are in the process.
    
    To test, apply the patch and begin the process of installing Koha. In my
    testing environment I drop the Koha database and create it again.
    
    On each step of the installation process, confirm that the list of steps
    is correct, showing the right stage in the process.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d8df2e5a5a88d4c58167a536536cc1775915802
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:01:21 2021 +0100

    Bug 27296: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6a8a2d624b1c3cf48d2b1d9039f74d18e1324f8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Nov 9 19:36:22 2020 +0000

    Bug 27296: Return claims should be filtered by default to show unresolved claims
    
    This patch modifies the DataTables configuration of the return claims
    table on the checkout and patron detail pages. Using the footerCallback
    function, the count of resolved and unresolved claims is calculated and
    used to filter the list of claims to show only unresolved claims by
    default.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - If necessary, Enable claims returned functionality by defining a value
      in the ClaimReturnedLostValue system preference.
    - Open for checkout a patron who has items checked out.
    - From the table of checkouts, click "Claim returned" for one or more
      items.
      - As you mark items "Clamed returned," the the items should appear
        under the "Claims" tab. The corresonding filter links should be
        updated accordingly, "Show all X claims."
      - Mark one or more claims resolved. As you do so they should disappear
        from the list of claims. The filter links should be updated to
        reflect that there are some resolved and some unresolved claims.
      - Clicking each filter link should trigger the correct filter.
      - Test this process when the count of unresolved claims is zero and
        when the cound of resolved claims is zero.
    
    TESTING TRANSLATABILITY
    
    - Update a translation, e.g. fr-FR:
    
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for JavaScript strings, e.g.
      misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from
      koha-tmpl/intranet-tmpl/prog/js/checkouts.js for
      translation, e.g.:
    
      #: koha-tmpl/intranet-tmpl/prog/js/checkouts.js:1086
      msgid "Show 1 claim"
      msgid_plural "Show all {count} claims"
      msgstr[0] ""
      msgstr[1] ""
    
    - Edit the "msgstr" strings however you want (it's just for testing).
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    - Switch to your newly translated language in the staff client and
      repeat the test plan above. The translated strings should appear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d3cd34ffe2cf744af749fe44297a535961a4724
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:01:06 2021 +0100

    Bug 29015: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2e15f0cac4046b35f4bcbb748f0fe3fec8a8ccc
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Oct 27 14:09:52 2021 +0000

    Bug 29015: (QA follow-up) Change collection code to be just collection
    
    We did some clean-up in that area a little while ago, agreeing that
    as we acutally display the descriptions, the label should be just
    "collection".
    
    This patch also removes some ():
    
    Before:
    4 items found for Centerville and item type:(Books) and collection: (Reference) and shelving location: (General Stacks)
    
    Now:
    4 items found for Centerville and item type: Books and collection: Reference and shelving location: General Stacks
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00ff7216fd505cb005216c06e65a527a9ceff462
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 15 17:17:28 2021 +0000

    Bug 29015: (follow-up) Default to logged in branch unless viewing queue
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a87ff87035a60d39ef5c822ddad48626efcd5df
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 15 12:14:19 2021 +0000

    Bug 29015: (follow-up) Show sidebar filter form with results
    
    This patch adds the new filter form in the sidebar when showing results.
    To do so the form markup is moved into a BLOCK so that it can be reused.
    
    This patch also adds pre-selection of submitted options on the filter
    form so that it reflects the user's choices.
    
    To test, apply the patch and rebuild the staff client CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Circulation -> Holds queue.
    - Submit the form with one or more filters selected.
    - On the results page the queue should be correctly filtered and the
      sidebar should show your search fields preselected.
    - Test with the CircSidebar preference enabled and disabled. The
      circulation menu should appear correctly, with the filter form only
      displaying in the sidebar after submitting the form.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c03ce56c9e3751b4033b813911681a55b6f6b74
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 15 10:34:15 2021 +0000

    Bug 29015: Unit tests
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD Amended patch: perltidy!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a6af1a6bd4dcddb7aab823833b60b1ef44c0463
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 14 19:29:27 2021 +0000

    Bug 29015: Add options for itemtype, collection, and shelving location to view_holdsqueue.pl
    
    This patch makes the code for itemtypeslimit work, and adds options for shelving location and collection code
    
    This also remove the 'post' method from the form to allow easy bookmarking
    
    To test:
    1 - Add holds to your system
    2 - Run the holds queue builder
    3 - Browse to Circulation->Holds queue
    4 - Note the library dropdown
    5 - Apply patch
    6 - Reload and note new options
    7 - Test that both limits and 'All' options work as expected
    8 - Note that description at top includes options when selected
        "### items found for All libraries and item type:(Books)"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2febaeac4d4567fd3d5dbaf64d69b7226378e0f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:07:07 2021 +0100

    Bug 26326: DBRev 21.06.00.042
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce2e85f56f2e924a00f2bd2b12739147f46ad84d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 19 12:54:16 2021 +0000

    Bug 26326: DBIC Schema changes
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 701929b25393f7029a4ad0a670dbe65dc6ecb910
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Mar 30 15:08:09 2021 +0000

    Bug 26326: (follow-up) Add ability to check for existence of any primary key
    
    Before dropping a primary key we need to see if one exists - this updates
    the installer method to allow searching for existence of key
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 26326: (follow-up) Address qa script failures
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a78306e63fab948a3c030e7f45a96f364f8e514e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 31 16:47:51 2020 +0000

    Bug 26326: Add Koha Objects for Import Records and Import Record Matches
    
    To test:
    1 - Apply patches
    2 - Update database
    3 - Generate schema files (dbic)
    4 - prove -v t/db_dependent/Koha/Import/Records.t
    5 - prove -v t/db_dependent/Koha/Import/Record/Matches.t
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD Amended patch: remove unused unset_chosen method
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0205ba1c55bc883298b1973ef6bc122d10179975
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 15:04:06 2021 +0100

    Bug 27360: DBRev 21.06.00.041
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4fd7dcd9c934774802251c6380f9bea43956a80
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 14:39:17 2021 +0100

    Bug 27360: Prevent crash if branchcode does not exist
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9176a7835f07a646df7eea4d1a5d3d205ce6d774
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Oct 27 04:37:19 2021 +0000

    Bug 27360: Add hint to input field
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 65d223e6a3de40ed53907f0818eb07324cb8ca86
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Nov 1 08:21:09 2021 +0000

    Bug 27360: (follow-up) Mark public as boolean
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6e4d74b0f685df1a1ae20f35879989a821135f6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 14:54:43 2021 +0100

    Bug 27360: Use 'public' to filter libraries for opac display
    
    This patch adds the ability to set a library as 'public' or not; this
    allows librarians to hide back office library branches from the opac.
    
    Test plan
    1/ Set a library as public from `admin > libraries`.
    2/ Navigate to the `Libraries` page in the OPAC
    3/ Note that only `public` libraries are displayed.
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 568733d1a6d3c3461e6f77bd91938794a24856e6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 14:49:01 2021 +0100

    Bug 27360: DBIC Build
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 06d4a1f982783fa0cf109e4b1e097bebc2191788
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 14:48:16 2021 +0100

    Bug 27360: Add public field to branches table
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    Signed-off-by: Christopher Brannon <cbrannon@cdalibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d85ada469ae83aba0ec9f2132892f1ebbca40464
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Nov 1 08:30:44 2021 +0000

    Bug 25883: (follow-up) Update columns_settings
    
    Replace 'holdinglibrary' with 'transferlibrary' in checkedin
    columns_settings description.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcf93633b386053073d897da28925c9750345e08
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Apr 27 14:10:27 2021 +0100

    Bug 25883: Replace 'holdingbranch' with 'transfer to' in returns
    
    This patch replaces the "Holding library" column in the returns table
    with a 'Transfer to' column that displays the destination for the item
    awaiting transfer if a transfer exists.
    
    Signed-off-by: Ben Daeuber <bdaeuber@fargolibrary.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 064933165b8139318fd4444b1966199c445daab7
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 28 13:39:58 2021 +0000

    Bug 27173: Add tests
    
    Test plan:
    Run t/db_dependent/Koha/Plugins/authority_hooks.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e366d0d1dd6991b561338dd749005c9ec9a871a1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Dec 8 15:54:00 2020 +0100

    Bug 27173: Add plugin hooks for authority record changes
    
    2021-09-28 Updated version
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 404e6d901f6b551c82dbc937357875502f0097cf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu May 27 09:53:01 2021 -0400

    Bug 28474: Pass process_message_queue.pl params to before_send_messages plugin hooks
    
    It would be useful to send most of the process_message_queue.pl script parameters to any plugin before_send_messages hooks. For example, the Twilio Voice plugin uses before_send_messages to send phone messages, but if the script is called with "-t email", it doesn't know and will make phone calls! If that info were passed in, the plugin could be made aware of it and only make calls if no "-t" or a "-t phone" were set in the parameters.
    
    Test Plan:
    1) Apply this patch
    2) Install Kitchen Sink plugin v2.2.0 or later
       https://github.com/bywatersolutions/dev-koha-plugin-kitchen-sink/releases/download/v2.2.0/dev-koha-plugin-kitchen-sink-2.2.0.kpz
    3) Run misc/cronjobs/process_message_queue.pl with any or all non-email
       related paramters
    4) Note the plugin output shows the parameters were passed to the plugin
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa2d8b024ff157b229a152f306eb9a7ee4f8ab50
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Aug 22 14:20:55 2021 +0000

    Bug 24406: Wrap patron category type code in a span on patron search results
    
    The patron category type code (A, C, O, ...) is currently displayed in the
    patron module search and the patron card creator and acquisition patron searches.
    
    This information is not useful for most users, as these are internal codes
    that cannot be easily "decoded". And while you might be able to guess A as
    Adult in English, it doesn't translate to other languages.
    
    This patch wraps a span around the patron category type code shown
    in () after the patron category.
    
    To test:
    - Verify for each of the following three searches, that the patron category code
      displays in the search results, but is wrapped in a span with the class
      patron_category_type
    - Tools > Patron card creator
      - New > New card batch > Add patrons
      - Search for patrons
    - Patrons
      - Search for patrons
    - Acquisitions
      - Add a budget
      - Add a fund for the budget
      - Search for a user or owner to add
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37005486d361f6a9ea60912da0249eeec9734db9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 13:43:11 2021 +0100

    Bug 28417: Don't require C4::Auth_with_cas from opac-user if not needed
    
    Note that without the use URI::QueryParam statement in C4::Auth we get:
    Can't locate object method "query_param_delete" via package "URI::_generic" at /kohadevbox/koha/C4/Auth.pm line 1254
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0931d1004e1bf83273318f36b4c0bf79270f4fc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 29 16:17:17 2021 -0300

    Bug 28417: (follow-up) Fix typo
    
    - There are CAS demo servers, pick one [1]
    - They all seem to have the same user/pass as of writing this:
      User: casuser
      Password: Mellon
    
    To test:
    1. Enable CAS and all related preferences. I chose v3 or higher, it only affects the logout action.
    2. Set the CAS URL: https://casserver.herokuapp.com/cas (note that if you click on any of the examples, they include a trailing /login, don't put it).
    3. Generate a Koha user, with userid: casuser (I also used that for cardnumber, just in case). Set no password to the user, or its irrelevant anyway. Add it stff permissions.
    4. Open your Koha OPAC, I use KTD thus:
       http://kohadev.myDNSname.org:8080
    5. Try to login using CAS
    => SUCCESS: You are redirected to the right login page
    6. Login using casuser/Mellon as advertised in the 'demos' site.
    => SUCCESS: You are logged in!
    7. Now logout
    => SUCCESS: You are sent to CAS so they know you wanted to logout (if you enabled CAS logout)
    8. Repeat on the staff interface.
    => SUCCESS: Things work!
    9. Apply this patches, restart all the things:
       $ restart_all
    10. Repeat all in OPAC and admin interfaces
    => SUCCESS: Things work!
    11. Sign off :-D
    
    [1] https://apereo.github.io/cas/Demos.html
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf1c4c24316a608cfce6edb5551787756f016a69
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 21 14:26:29 2021 +0200

    Bug 28417: Don't use C4::Auth_with_cas if CAS is not used
    
    We should follow the same pattern as ldap and not use C4::Auth_with_cas
    if the cas syspref is not turned on.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3adc5de903065d5977869a66708b4268759db81
Author: Johanna Raisa <johanna.raisa@gmail.com>
Date:   Mon Jan 11 09:49:45 2021 +0200

    Bug 27375: Set YAML file settings in .editorconfig
    
    To test:
    1) Start an editor that supports .editorconfig.
    2) Open YAML file mappings.yaml for example.
    3) Format the file.
    4) Observe that nothing changes.
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 320b16282796a297809926c83ce53b9f7f13c7f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 13:36:27 2021 +0100

    Bug 28879: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b286d9be41521def3f252fa03df6ae5eef17dc64
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed Aug 18 15:07:54 2021 +0100

    Bug 28879: Fix display of request metadata
    
    This commit adjusts the CSS surrounding the display of request
    metadata, it improves the display for metadata with long key names.
    
    Test plan:
    
    - Do not apply patch
    - Create a FreeForm ILL request with a custom metadata field with a long
      name
    - View the created request
    - Observe that the long metadata name breaks the display of the metadata
    - Apply the patch
    - View the created request
      => TEST: Observe that the display is no longer broken
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8605082a782af2c00bf735e32fd711a67ad78e01
Author: Andreas Jonsson <andreas.jonsson@kreablo.se>
Date:   Mon Sep 7 09:31:58 2020 +0000

    Bug 26402: Add --framework parameter to commit_file.pl
    
    This patch adds the option to pass a frameworkcode to the commit_file.pl
    script.
    
    To test:
    1. Stage a MARC file using stage_file.pl.  For instance using the devbox:
    
       cd ~/kohaclone
       sudo koha-shell -c 'perl misc/stage_file.pl --file t/db_dependent/www/data/marc21record.mrc' kohadev
    
    2. Note the assigned batch number and commit the batch using --framework parameter to commit_file.pl.  For example using the devbox:
    
       sudo koha-shell -c 'perl misc/commit_file.pl --batch-number 1 --framework ACQ' kohadev
    
    3. Verify that the framework code was correctly assigned:
    
       sudo koha-mysql kohadev -e 'SELECT frameworkcode FROM biblio ORDER BY timestamp DESC LIMIT 1;'
    => SUCCESS: It picked it
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e44b4837f58fe22fa2010cceffac0fa0171277fc
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Sep 8 08:31:47 2021 -0400

    Bug 28973: Improve Koha::Patron::can_see_patron_infos efficiency
    
    The method can_see_patron_infos looks up a row in the branches table by branchcode just to get the branchcode it already has. This seems inefficient.
    
    Test Plan:
    1) Apply this patch
    2) No changes should be noted
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f4d5954c99c7c206d5ccf8f335014fdc1f4723e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 17 16:20:41 2021 +0200

    Bug 28365: (Bug 19873 follow-up) Make it possible to search on value 0
    
    Bug 19873 fixed search with value 0.
    It works in first page but not in other pages.
    
    This patch fixes query_cgi var.
    
    Test plan:
      - create a st-numeric index in zebra conf related to
        a numeric field
        i.e:
        yourindex 1=yourindex 4=109
      - fill a field with 0 in several biblio records,
      - reindex your biblios,
      - search yourindex=0 and go to second page of results,
      - should not work,
      - apply this patch,
      - test again,
      - should work
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9a68f9f7d656be9552ca1eb3450032e1366fd65
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon May 17 16:15:19 2021 +0200

    Bug 28365: Add unit test
    
    Run prove t/db_dependent/Search.t
    
    Without fix you get error :
        #   Failed test 'buildQuery should keep 0 value in query_cgi'
        #   at t/db_dependent/Search.t line 670.
        #          got: 'idx=su%2Cphr'
        #     expected: 'idx=su%2Cphr&q=0'
    
    This patch also adds a test for query_desc in case it is broken in the
    future.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ead06892044ef76d4a2817ed17bbff136fb6788
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Oct 30 19:02:39 2021 +0000

    Bug 29380: Correct table name in joins to prevent errors
    
    The commit "Bug 29290: Rename relationships borrower =>
    patron" (d46492ac23) renamed the relation for the borrowers table from
    'borrower' to 'patron' but the joins were not updated accordingly so a
    few scripts got broken.
    
    To test:
     1) Notice that
        $ perl misc/cronjobs/automatic_renewals.pl -c -s -v
        returns 255 error code on exit
     2) Apply patch
     3) Notice the automatic_renewals.pl works now and exit code is 0
     4) Make sure /cgi-bin/koha/tools/batch_extend_due_dates.pl works.
     5) Try to grep for 'borrower' in Koha source code and see if there
        are any other join done using the Koha::Checkout or
        Koha::Old::Checkout objects.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 29380: (follow-up) Fix renewal feature in staff interface
    
    The commit "Bug 29290: Rename relationships borrower =>
    patron" (d46492ac23) renamed the relation for the borrowers table from
    'borrower' to 'patron' but the usage in the renew.pl script was not
    updated.
    
    To test:
     1) Try to renew a book in intranet through the renewal tab
     2) Notice it gives error
     3) Apply patch
     4) Notice the error is now gone
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35c279ac59a02fc9656f0917cbda4c597945c203
Author: Johanna Raisa <johanna.raisa@gmail.com>
Date:   Thu Sep 2 12:22:51 2021 +0300

    Bug 28236: Allow access to json files from apache config
    
    This patch grants json files from koha-tmpl. Otherwise systempreferences won't be able to fetch them.
    
    TEST PLAN:
    
    1) Try to set systempreference BorrowerUnwantedField.
    2) The modal is empty.
    3) Modify Apache configurations like in this patch.
    4) Try again set the systempreference.
    5) The modal should show list of parameters.
    
    Sponsored-by: Koha-Suomi Oy
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD Amended patch: replace tab characters and reword commit title
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb017ee239eee3fac407d9d7c205cbf2f04d1d68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 12:05:42 2021 +0100

    Bug 24850: Correctly handle suspended_until for PUT
    
    if we are passing suspended_until to the body, it should be a rfc3339 (what the spec is expecting)
    but $hold->suspend_until will be iso
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d1ad49ec90f5fe110ff6851b4d6e90ecc6ee548
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 10:06:35 2021 +0100

    Bug 24850: Date only are not RFC3339
    
    We removed the fallback on 'Bug 24850: Don't fallback when date_format
    is passed', and the dates passed for date only (YYYY-MM-DD) are not
    RFC3339 formatted but ISO8601.
    We must assume that all dates will be YYYY-MM-DD, without fallback.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c718e18da233939cd90eb04b58abc0a37e262ef
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Nov 3 06:55:19 2021 -0300

    Bug 24850: suspended_until is a date-time
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5da73b604f1458a4442f73e967659454804a102c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 10:44:14 2021 +0100

    Bug 24850: Fix api/v1/holds.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54fa48b139a2903c8779262c24a2b7de0ecd0223
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 09:55:54 2021 +0100

    Bug 29395: use EXPORT_OK from Koha::Patron::Debarments
    
    Missed from bug 17600.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f57531d14230c39145bea6db628602c5eb12172
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 2 09:42:05 2021 +0100

    Bug 29261: (bug 15812 follow-up 3) Fix translation issue in include file
    
    This is getting messy. No idea how I tested the previous patches but it
    was not working, the problem still persisted.
    
    This patch is using the I18N TT plugin to make things easier and fix the
    original problem.
    
    Test plan:
    Apply the patch
    perl translate update fi-FI
    Edit misc/translator/po/fi-FI-messages.po
    Locate and translate "Check out"
     61 #: koha-tmpl/intranet-tmpl/prog/en/modules/members/tables/members_results.tt:20
     62 msgid "Check out"
     63 msgstr "Laina"
    Locate and transate "View"
     182 #: koha-tmpl/intranet-tmpl/prog/en/modules/members/tables/members_results.tt:22
     183 msgid "View"
     184 msgstr "Nayta"
    Apply the change to the fi-FI templates
    perl translate install fi-FI
    
    Now enable the fi-FI in the lang syspref, search for patron and confirm
    that the result view is displayed correctly.
    Note that the "Check out" and "View" strings are correctly translated
    (when you hover the cardnumbers or patron's names)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fab97c6d3803e3dec862e798b22c926303b2bce4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 3 13:36:04 2021 +0100

    Bug 28901: (follow-up) Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4a05feef3840d8b1a45d7010eafbe5208c96126
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 29 13:22:59 2021 +0100

    Bug 28729: Additions to POD
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7130f7d4eda4a1faca18657df6cde62c779fe3c7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Oct 19 16:57:10 2021 +0100

    Bug 28729: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3955815a47f8fd7bb3d83c828cf8c171233d6d20
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Oct 19 16:57:25 2021 +0100

    Bug 28729: Make Koha::Email->send_or_die handle returnpath
    
    Koha used to rely on Mail::Sendmail for sending emails. As an SMTP
    client, the library would extract the from address from the Sender
    header to pass along in the MAIL FROM: field of the SMTP protocol [1].
    
    This was overlooked when we moved to Email::Stuffer/Email::Simple and
    there's a different behavior as it expects the envelope to be passed and
    falls back to extracting the 'From' header when said envelope is not
    found [2].
    
    This patchset re-introduces the behavior from Mail::Sendmail by
    overriding the send_or_die method locally (in Koha::Email) and doing the
    right thing.
    
    Unless an explicit {from} parameter is passed, it extracts the MAIL FROM
    envelope from the Sender header, as Mail::Sendmail did, and calls
    $self->SUPER::send_or_die with the right parameters.
    
    To test:
    1. Apply the unit tests
    2. Run:
       $ kshell
       k$ prove t/Koha/Email.t
       => FAIL: Sender is not handled correctly!
    3. Apply this patch
    4. Repeat 2
       => SUCCESS: Tests pass!
       The from parameter is correct!
       No Sender header sent!
    5. Sign off :-D
    
    [1] https://metacpan.org/dist/Mail-Sendmail/source/lib/Mail/Sendmail.pm#L284
    [2] https://metacpan.org/pod/Email::Sender::Manual::QuickStart#envelope-information
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    AMENDED (SHORTENED)
    -        my @headers = $self->email->header_str_pairs;
    -        foreach my $pair ( pairs @headers ) {
    -            my ( $header, $value ) = @$pair;
    -            $args->{from} = $value if $header eq 'Sender';
    -        }
    -
    -        # Remove the Sender header
    -        $self->email->header_str_set('Sender');
    +        $args->{from} = $self->email->header_str('Sender');
    +        $self->email->header_str_set('Sender'); # remove Sender header
    
    Tested with same results (scrambled domains):
    From: noreply@mydevserver.com
    Cc: marcel@email.nl
    To: test@somewhere.nl
    Reply-To: bieb@mydevserver.com
    Return-Path: postmaster@mydevserver.com
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2e4b90f99054cf33344d0a3aef3a2cde961ee09
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Nov 1 09:52:26 2021 +0000

    Bug 28904: Fix typo and display
    
    Fix typo in template: Newletter => Newsletter
    Fix latest newsletter editor definition.. it's a has not an array.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d242cd2599f52fb4bf1d80636c70f639f6b12e6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 15:37:07 2021 +0100

    Bug 28904: Update team list to include newsletter editors
    
    It seems we stopped recording the newsletter editor as part of the team
    for a while :(.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6c1fbb08a2c2a75d116dc6980253df9a6109856
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 15:27:45 2021 +0100

    Bug 28904: Add newsletter editor to about page display
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 036d7bd4287d08f2ad8ee9846eee65f779cb35b2
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Oct 26 19:52:24 2021 +0000

    Bug 29329: Remove stray character in opac-detail.tt
    
    1. Have  OpacBrowseResults on.
    2. Make search with many results.
    3. Go to the record detail page
    4. Click 'Browse results'
    5. At the bottom of the container notice the stray "s".
    6. apply patch
    7. Try again, the "s" is gone!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2666f34b0ce8ebf3451b1f9c7436dafb46092912
Author: David Gustafsson <glasklas@gmail.com>
Date:   Wed Sep 15 15:32:35 2021 +0200

    Bug 27884: Add tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a45b3d2dc4293cfa4879d42dd3c1ef66590e3a9
Author: David Gustafsson <glasklas@gmail.com>
Date:   Thu Mar 4 17:54:22 2021 +0100

    Bug 27884: Add html support for report mails
    
    To test:
    1) Create a new notice, for example with Koha module "Patrons",
       name/code TEST and message body "<strong>testing<strong>".
    2) Create a new sql report, the query could be someting like:
       SELECT "<number>" as `borrowernumber`, "to@example.com", as `email`, "from@example.com" as `from`;
       where "<number>" is a valid borrowernumber.
    3) Run patron_emailer.pl --report=<id> --notice=TEST --module=members -commit
       where <id> is the report id.
    4) Check the message_queue table that the content_type column has been
       set to text/html; charset="UTF-8".
    5) Ideally process the message queue and veriy that the sent email is displayed
       as rendered html.
    6) Run tests in t/db_dependent/Reports/Guided.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ef35565481e29200830d0ef8acb4599476b95c3
Author: Maryse Simard <maryse.simard@inlibro.com>
Date:   Mon May 11 14:20:42 2020 -0400

    Bug 25459: Makes barcode position respect units in patron cards layout
    
    When using any unit besides postscript points, barcode positionning
    doesn't work correctly. There is an error in the calculation: the unit
    factor must be applied to the individual card part only and not to the
    full page position.
    
    This patch moves the unit part of the calculation to the right place.
    
    To test :
    1. Create a working patron card setup, using postscript points:
        card template, layout and card batch. Use barcode and at least
        one other element (text or images) in the layout.
        => Some tips for testing:
            - activate guides for the layout
            - use a template and a batch containing more than one card; the
            displacement will be different for each card and depend on the
            barcode position relative to the bottom left of the entire page.
    2. Change units from postscript points to any other unit.
        => At least for the layout, but changing it in the template will
        scale the page as well.
    4. Export the card batch.
    3. Note the guides are scaled to fit the new unit and the lower left
    corner of text and images are still correctly placed relative to the
    guides, but the barcode is not.
        => In some cases, the barcode even seem to not print at all since
        it's new coordinates are out of screen.
    4. Apply patch.
    5. Generate the batch again.
    6. Note the barcode now appears exactly where it should.
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 080197d175fa4e73dce1bcbda7ac2a4032080b2d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 2 16:49:37 2021 +0100

    Bug 28263: DBRev 21.06.00.040
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f831175338d16719e6202b42cb12afa7660877c9
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Oct 30 20:19:39 2021 +0000

    Bug 28263: (QA follow-up) Use new atomicupdate code style
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a722d814705f33acf87a653b1f9d2421af96832
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Apr 29 14:36:03 2021 +0000

    Bug 28263: Fix too_many auto renewal message
    
    To test:
    1. Make an item eligible for auto_renewal.
    2. Set circ rule so only 1 auto_renewal is allowd.
    3. Run auto_renew once, get a successful message.
    4. Run it again and get the too_many error "You have reached the maximum number of checkouts possible."
    5. This has nothing to do with the number of checkouts
    6. Apply patch and updatedatabase.
    7. Do 1-4 again.
    8. Message is now "You have reached the maximum number of renewals possible."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51f42b87343f64638d6484218b3a23e579816bfa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 28 15:32:04 2021 -0300

    Bug 29356: Pickup location dropdowns should perform 'contains' searches
    
    When placing a hold, the dropdowns for selecting a pickup library automatically right-truncate, so one can type "cen" and find Centerville.
    
    On the Libraries page in Admin, however, the search box both left- and
    right-truncates, so one can type "en" and find Centerville.
    
    This patch makes the search perform 'contains' searches.
    
    To test:
    1. Try placing a hold. Make sure your rules allow Centerville to be a
       valid pickup location.
    2. Search 'cen'
    => SUCCESS: Centerville shows
    3. Search 'en
    => FAIL: Centerville doesn't show
    4. Apply this patch and reload
    5. Repeat 2
    => SUCCESS: Works!
    6. Repeat 3
    => SUCCSS: Centerville shows!
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 413d8824889e35a70236663a61bab551092a920c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 28 15:03:18 2021 -0300

    Bug 29355: Make pickup location dropdowns RESTdefaultPageSize agnostic
    
    This patch makes the select2 dropdowns for pickup locations not be
    limited to the RESTdefaultPageSize syspref limit.
    
    To test:
    1. Have less than 20 libraries in your system as valid pickup locations
    2. Place a hold via the staff client
    => SUCCESS: See that all your libraries appear in the pickup location dropdowns at the bib and item level
    3. Update RESTdefaultPageSize, set the value to something lower than your count of pickup libraries
    4. place another hold
    => FAIL: Your pickup location list gets cut off and only shows as many locations as RESTdefaultPageSize allows
    5. Apply this patch
    6. Repeat 4
    => SUCCESS: All your pickup locations show
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07464b53ed303d8d62d793db385aaa5b9a42e960
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 28 14:15:12 2021 +0000

    Bug 29351: Add missing cn_source parameter to reports parameter menu
    
    This patch adds an option to insert "Source of classification or
    shelving scheme" as a runtime parameter in SQL reports. The ability to
    use cn_source as a parameter seems to have always been part of this
    feature but wasn't documented.
    
    To test, apply the patch and go to Reports -> Create from SQL.
    
     - Click the "Insert runtime parameter" button and select
       "Classification source."
     - Customize the parameter label if you wish and click "Insert
       parameter."
     - The parameter should be inserted like this:
    
       <<Source of classification or shelving scheme|cn_source>>
    
     - Use it to create a valid SQL report, for example:
    
       SELECT * FROM items WHERE cn_source = <<Source of classification or
       shelving scheme|cn_source>> LIMIT 10
    
     - Confirm that upon running the report you are prompted to select a
       classification source.
     - Confirm that the report runs correctly.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca6c81ec5cff9ad626787b2cf48aa99a3c217e70
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 28 14:46:00 2021 +0000

    Bug 29352: Runtime parameter labels should not be said to be optional
    
    This patch alters the form shown when using the "Insert runtime
    parameter" button in SQL reports. It makes the label field required and
    removes "optional" from the field hint.
    
    To test, apply the patch and go to Reports -> Create from SQL.
    
     - Click the "Insert runtime parameter" button and select "Authorized
       value."
     - Clear the "parameter label" field and click "Insert parameter."
     - The form should display an error asking you to fill in the label
       field.
     - Test that the category field is also required.
     - Close the modal and select a different runtime parameter.
     - Test again that the label field is required.
     - Test that the form submits correctly when the label field is
       populated.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0a000d5df14c679753e670b94517cf2e8a756f4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 28 15:45:21 2021 +0000

    Bug 29328: Add missing list parameter to reports parameter menu
    
    This patch adds an option to insert "list" as a runtime parameter in SQL
    reports (As added by Bug 27380).
    
    To test, apply the patch and go to Reports -> Create from SQL.
    
    - Click the "Insert runtime parameter" button and select
      "List."
    - Customize the parameter label if you wish and click "Insert
      parameter."
    - The parameter should be inserted like this:
    
      <<List of values|list>>
    
    - Use it to create a valid SQL report, for example:
    
      SELECT * FROM borrowers WHERE categorycode IN  <<List of values|list>>
      LIMIT 10
    
    - Confirm that upon running the report you are shown a textarea. Enter
      two or more values in the textarea, each on a separate line.
    - Confirm that the report runs correctly. The SQL above would show you
      this when you click "Show SQL code":
    
      SELECT * FROM borrowers WHERE categorycode IN  ('A','S')  LIMIT 10
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9c4fe3d9f301d694228882b175296b419ad4ff7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 14 17:56:23 2021 +0000

    Bug 29242: Flatpickr - Should autocomplete be turned off?
    
    This patch adds a step to Flatpickr initialization to add an
    autocomplete attribute set to "off" so that browsers' built-in
    autocomplete menus do not obscure the calendar.
    
    To test you must be using a browser which has form history enabled.
    
    Locate a form that includes a Flatpickr input field, e.g.  Reports
    -> Catalog statistics.
    
    Fill the date fields and submit the form. Go back to the form and click
    one of the form fields you previously filled out (once in Chrome, twice
    in Firefox). The browser should not show its native form history
    dropdown.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9210f718362f1238a814c2237bbe1e8fd5abdf1c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 2 15:57:01 2021 +0100

    Bug 28901: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2de22db29ca98fdf8bbabe19b4a37cd8cbbd01fa
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 20 14:57:23 2021 +0000

    Bug 28901: showCart incorrectly calculates position if content above navbar
    
    This patch makes changes to the OPAC Cart's CSS and JS so that the cart
    pop-up message display more consistently. The CSS is changed to use
    position "fixed" instead of "absolute." This allows the message to
    display without recalculating the position every time, and keeps the
    appearance we expect.
    
    The z-index of the message is also increase to prevent it from being
    hidden behind a floating toolbar.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Perform a catalog search in the OPAC which will return multiple
       results.
     - In the list of search results, click the "Add to cart" link next to
       several search results. Each time you should see a message appear in
       the upper left corner of the screen, "The item has been added to the
       cart."
     - The position of the messages should be consistent no matter how far
       down the page you scroll.
     - Test again after adding content to the OpacHeader region. One way to
       do this is to add the following to the OpacUserJS preference:
    
       $(document).ready(function(){
         $("#wrapper").prepend('<img src="https://generative-placeholders.glitch.me/image?width=900&height=200&style=triangles&gap=30">');
       });
    
     - Test at various browser widths, from a phone-sized screen width up to
       wide desktop-sized.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60e60cad6e4d814d52aa28822938a4449109ad03
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 17 13:25:10 2021 +0000

    Bug 28910: Correct eslint errors in OPAC basket.js
    
    This patch corrects eslint errors in the OPAC copy of basket.js:
    Indentation inconsistencies, undeclared variables, unused functions,
    etc.
    
    To test, apply the patch and test the "Cart" functionality in the
    OPAC:
    
    - In the OPAC, add an item to the cart.
    - A popup message should appear telling you the item has been added.
    - The "Add to cart" link should update to read "In your cart."
    - The count if cart items in the header should be updated.
    - The "In your cart (remove)" link should work correctly.
    - Test this process from both the search results and
      detail pages.
    - Open the cart.
    - The cart should open correctly.
    - In the cart, test all the controls:
      - More details
      - Send
      - Download
      - Empty and close
      - Hide window
      - Print
      - Select all / clear all
      - With checked items:
        - Remove
        - Add to list
        - Place hold
        - Tag
    
    The following unused functions were removed: readCookieValue,
    AllAreChecked, SelectAll, and quit. A search of the Koha codebase should
    return no results from the opac-tmpl directory.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfd033c68aa63650f7f78d85054d2d41b697c094
Author: Mason James <mtj@kohaaloha.com>
Date:   Tue Aug 31 16:05:05 2021 +1200

    Bug 28926: Update cpanfile for Mojolicious::Plugin::OpenAPI v2.16
    
    to test...
     - apply patch
     - build package
     - confirm in about.pl that minimum versions are updated
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a324c66d8ae31807ae6bdc1b2f43da5243ff191
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Oct 25 22:52:22 2021 +0000

    Bug 29319: Use Business::ISBN to check ISBNs on addbooks.pl/cataloging search
    
    To test:
    1. Go to cataloging search and enter something like "7th Heaven".
    2. Get an error when searching, Koha thinks you entered an ISBN
    3. Apply patch
    4. Try the same search, it should be a proper title search now
    5. Find some stuff in the catalog with ISBN numbers in them.
    6. The search should properly return ISBN13/ISBN10 searches, without with out the '-'.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b296b8ae23de846d87ae4e720d75934e8ea00d88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 15:27:00 2021 +0200

    Bug 29350: Don't need to escape the 'delete' TT methods
    
    Will be needed by bug 22605.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36d2111d70654593666867d5b9f8f139a5812067
Author: Jérémy Breuillard <jeremy.breuillard@biblibre.com>
Date:   Wed Oct 27 13:24:43 2021 +0000

    Bug 29075: 'OPAC info' removed in branches.pl
    
    In Administration › Libraries, we see content of OPAC info as escaped HTML.
    This content may be long and seeing HTML tags is strange.
    
    We should not show it in this table.
    Or maybe create a modal preview of it (not escaped HTML).
    
    To test :
    1) Home > Administration > Libraries
    2) In 'Address' column notice the 'OPAC info' field (if this one is
    filled) with visible HTML tags
    3) Apply patch
    4) Repeat 1) and 'OPAC info' field should be gone
    
    Signed-off-by: Owen <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0011eca7e67b2db9fb49d536784cd7f5f247f84d
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Aug 27 16:27:53 2021 +0000

    Bug 28913: Note cronjob on automatic return settings in itemtypes
    
    To test:
    1 - go to itemtype config in Admin
    2 - confirm it doesn't mention the automatic_return cron
    3 - apply patch and restart
    4 - confirm note now says "This feature requires the misc/cronjobs/automatic_checkin.pl cronjob. Ask your system administrator to schedule it."
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0858a202bb12e88749704c71a4f762736eeabce
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 13 15:20:05 2021 +0000

    Bug 29223: Use patron's branchcode for digest if not sending digest per branch
    
    To test:
     1 - Set system preference  AutoRenewalNotices to 'according to patron messaging preferences'
     2 - Set circ rule for auto renewal - 100 renewals allowed - no renewal before 100
        This shoud make a checkout eligible for many auto renewals for testing
     3 - Checkout an item to a patron, ensure item is from a different branch than patron
     4 - Ensure the patron has an email, and set an email for patron's branch and items branch
     5 - Set the patron messaging preferences for auto-renewal to 'email' and 'wants digest'
     6 - perl misc/cronjobs/automatic_renewals.pl --send-notices --confirm
     7 - Job dies:
        Can't call method "from_email_address" on an undefined value at /usr/share/koha/bin/cronjobs/automatic_renewals.pl line 286.
     8 - Apply patch
     9 - Repeat
    10 - NO errors
    11 - Check patron notices tab, should be a notice enqueued, check DB to see from address is patron's branch
    12 - perl misc/cronjobs/automatic_renewals.pl --send-notices --confirm --digest-per-branch
    13 - No errors
    14 - Check patron notices tab, should be a notice enqueued, check DB to see from address is item's branch
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47a0e5e49e349f7e8a48cc916eb30c6dd4b0f77b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 6 12:56:39 2021 +0000

    Bug 29152: Change default value for SearchLimitLibrary to 'homebranch'
    
    Behvaiour before this option was added was 'homebranch'
    We should preserve this rather than introduce a change
    
    No atomic update added as liobraries may have already set/changed the value,
    but safer to default to previous behvaiour
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit afa594c73b7c3af4014cc35a9ead7c323f05a80c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Feb 8 15:46:35 2021 +0100

    Bug 24850: (follow-up) Add tests for invalid RFC3339 dates
    
    Make this failure explicit, otherwise we get a "bad plan" failure.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b246e6de1ba8700443d673489c16e742277726dd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jan 27 09:18:45 2021 +0000

    Bug 24850: (QA follow-up) Add more comments
    
    To try and clarify the logic here I've added an addition comment to the
    code.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af3a6126667784a3511b7487ac6f25166df959be
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 26 11:12:26 2020 +0000

    Bug 24850: Continue to handle default time and daylight saving
    
    This patch prevents the call to set_time_zone if we are handling a
    dateonly datetime string or a DST time
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef882714e5079db0f9062d9095f49ac7330018a2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 17 10:22:16 2020 +0000

    Bug 24850: Always return 'instance' local time
    
    This patch adds handling to ensure we always convert a passed in time to
    the instance configured timezone..
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c641589e444ea5233632573bd8cd7968971fba23
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 11 17:55:34 2020 +0000

    Bug 24850: Don't fallback when date_format is passed
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 911f9bcde54f0d135602678a7505899c3935ba85
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 11 16:20:36 2020 +0000

    Bug 24850: Add tests for invalid RFC3339 dates
    
    We should die on invalidly formatted dates being passed.  This patch
    adds such a test case.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1059303f90eaedbca76f3491a2b6b008a77abdc5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 11 15:59:19 2020 +0000

    Bug 24850: Correct offset handling in dt_from_string
    
    This patch adds correct handling for when an offset is passed within an
    RFC3339 formatted datetime.
    
    Test plan
    1/ Run the DateUtils test and varify it now passes.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8d33c0e1b71168920a2302d012ffef2b3c1b08b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 11 15:57:07 2020 +0000

    Bug 24850: Correct tests for offset handling in RFC3339 dates
    
    The tests were incorrectly passing for RFC3339 dates passed with an
    offset.  This patch corrects the test.
    
    Test plan:
    1/ Read the change
    2/ Agree the change adheres to the RFC
    3/ Run the test and varify it now fails
    3/ Signoff
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5095e0a9543773e933be567ce3dab507013f4dde
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Oct 31 12:22:06 2021 +0000

    Bug 29283: (QA follow-up) Remove code duplication
    
    We have already a search filter for active orders.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1de960e7e33e1b5e0c7493d7e1463d74182fdfe3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 20 13:06:06 2021 +0000

    Bug 29283: Don't attempt to cancel cancelled orders
    
    When deleting a basket we cancel all the contained orders - when a
    basket contains an order that was previously cancelled this can cause
    an error if the biblio was deleted
    
    When picking the orders to cancel, we should limit our search
    to those not already cancelled.
    
    To test:
    - have a basket with at least one order
    - click "Cancel order and delete catalog record", confirm cancellation of order and deletion of bib
    - click "Delete basket", confirm deletion
    - get error "Cannot insert order: Mandatory parameter biblionumber is missing at /kohadevbox/koha/acqui/basket.pl line 136.
     at /usr/share/perl/5.28/Carp.pm line 289"
    - apply patch
    - restart
    - delete the basket
    - success!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90c577c06c29ee7d1614f62423552dfdea8d549e
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Oct 10 11:01:29 2021 +0000

    Bug 26871: Flush SIP2 cache on every SIP request
    
    SIP connections tend to be long lived, weeks if not months, in the
    libraries I see. Basically the connection per SIP machine is initiated
    once when the SIP machine boots and then never closed until
    maintanance needs to be done. Therefore we need to reset the Koha's L1
    caches on every SIP request to get the latest sysprefs and configs
    from the memcached cache that is shared between all the Koha
    programs (intranet, opac, sip, cronjobs) and is guaranteed to be up to
    date.
    
    To test:
     0. Have kohadevbox
     1. Enable IssueLog
     2. In one terminal run the command "perl C4/SIP/SIPServer.pm /etc/koha/sites/kohadev/SIPconfig.xml"
     3. Checkin and return a book using telnet:
    
        $ telnet localhost 6001
        9300CNterm1|COterm1|CPCPL|
        11YN20211010    10565320211010    105653AOCPL|AA1|AB3999900000001|ACterm1|BON|BIN|
        09N20211010    10564420211010    105644APCPL|AOCPL|AB3999900000001|ACterm1|BIN|
    
     4. Keep the telnet connection open and go to
        http://localhost:8081/cgi-bin/koha/tools/viewlog.pl and check that
        the *checkout* entry is in the circulation rules 5.
     6. Disable IssueLog
     7. Move back to the telnet prompt and check out and return a book again
    
        11YN20211010    10565320211010    105653AOCPL|AA1|AB3999900000001|ACterm1|BON|BIN|
        09N20211010    10564420211010    105644APCPL|AOCPL|AB3999900000001|ACterm1|BIN|
    
     8. Go check out the circulation logs and notice a new entry was added
        when it shouldn't have according to the IssueLog syspref!
     9. Apply patch and repeat steps to notice that the syspref is now
        followed correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae84b13e48752e063e63572123f879ca9c87d615
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Oct 2 12:28:52 2021 +0000

    Bug 14999: Make sure order prices are not mixed-up
    
    We were shifting the price and replacement price for imported orders
    only after the line:
    
    > $duplinbatch = $import_batch_id and next if $duplifound;
    
    This lead to the "replacementprice" and "price" query parameters not
    being shifted/removed from the list if a duplicate record came across
    and caused the prices be applied to the next record being imported.
    
    To reproduce:
     1) Download two records from koha to marcxml file, then cat those:
       cat bib1.marcxml bib2.marcxml > bibs.marcxml
     2) Delete bib2 from koha
     3) Stage bibs.marcxml for import
     4) Create a new order basket, then "Add to basket" using "From a
        staged file" option
     5) Select both bib1 and bib2 and set price & replacement price for
        bib1 to be 99.00 and for bib2 to be 88.00
     6) Click save and notice bib2 was imported with the wrong prices, 99.00!
     7) Apply patch and notice the prices are now correctly set to 88.00.
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 134e9715d2e29f6077fbb15c28188b9dfb4fb739
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 25 13:55:36 2021 +0200

    Bug 24370: Allow resetting library to ANY
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 153ff795abd75e8117b7dc2001f8c6d552ab5eae
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 20 18:19:46 2020 +0000

    Bug 24370: (QA follow-up) Make new suggestions default to the library you re viewing
    
    It looks like this problem was caused by code from bug 25033, we were attempting to have the
    dropdown either be the current branch filter, or the suggestion's branch code, but the variables here are confusing and it didn't work
    
    This explicitly sets the branchcode when creating a new suggestion to allow fixing current behaviour and
    show the correct value when creating new
    
    To test:
    1 - Be signed in as branch A
    2 - Browse to suggestions and limit to branch "Any"
    3 - Click 'New suggestion"
    4 - Defaults to Any
    5 - Cancel and limit to branch B
    6 - New suggestion defaults to branch B
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02adde9a43972c042f61c9ff17fe4684f0d9965d
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 5 17:23:31 2020 +0000

    Bug 24370: Don't reset library when editing a suggestion
    
    When editing a suggestion, the library will be reset to the currently
    logged in librarian's homebranch, no matter what the libray was before.
    
    This fixes this, the library selection will remain at the db value when
    edited.
    
    To test:
    - Create a suggestion with Any library.
    - Edit the suggestion - it will show your homebranch as library
    - Change to any library but your homebranch
    - The summary should show the correct value after saving
    - Edit the suggestoin again - it's set back to your homebranch again
    - Apply patch
    - Repeat the steps, the pull down should now show the correct library
      at all times.
    
    Caveat: I think there is a somewhat separate issue/bug in that once a library
    was saved, you cannot switch back to "Any". I haven't been able to fix this and
    suggest to maybe file a separate bug.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef335f252a37c46f5a92ee74e1eb53d49cc2899e
Author: George Veranis <gveranis@dataly.gr>
Date:   Tue Oct 12 23:01:57 2021 +0200

    Bug 28573: Replace authority record with Z39.50/SRU creates new authority record
    
    When trying to replace an authority record with Z39.50/SRU then a new authority
    record is created without deleting the old one and not link the new one with
    any record.
    
    This patch fixes that.
    
    Test plan:
    
    1) Try to catalogue a new authority record from cataloguing form.
    2) Try to replace that authority record with Z39.50/SRU, then a new authority
    record is created and also you have that one that you tried to replace.
    3) Apply the patch.
    4) Try to replace the authority from step1 with Z39.50/SRU, then is working as
    expected.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Eric Phetteplace <phette23@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bfa981a5e5bd80617e5065e010782b06133b6d2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 28 13:14:06 2021 +0000

    Bug 17600: Fix imports for GetClassSources in guided_reports.pl
    
    This will fix the broken option to use cn_source as a runtime
    parameter, e.g. <<Call no. source|cn_source>>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 32ca2b2fd9ae2e5add8685b87b3b9b7d0cacd55d
Author: Andrew Nugged <nugged@gmail.com>
Date:   Mon Nov 1 09:07:03 2021 +0200

    Bug 28959: (QA follow-up) One more lost 'category' to 'public' change
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 145b26a272c07e83c2fa821660bbe03d627d59bc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Nov 2 11:39:30 2021 +0100

    Bug 28959: Fix occurrence in tools/batch_record_modification.pl
    
    No method count found for Koha::Virtualshelves DBIx::Class::Storage::DBI::_dbh_execute(): DBI Exception: DBD::mysql::st execute failed: Unknown column 'category' in 'where clause' at /kohadevbox/koha/Koha/Objects.pm line 601                                                                                                                                                                             at /kohadevbox/koha/koha-tmpl/intranet-tmpl/prog/en/modules/tools/batch_record_modification.tt line 80.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20991feb62daedf5827b29e986002a34b0d41cce
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 29 12:27:25 2021 +0200

    Bug 29374: Don't crash if search engine returns a deleted record
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8959629947e17f27fa86dceb9d5fcfb99c8c51c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 29 12:27:32 2021 +0200

    Bug 29368: Fix remove_from_cart
    
    Reusing what has been done previously.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4988c8090576150e10aa45c88ab0710fb66d0c3d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 29 11:15:48 2021 +0200

    Bug 29368: Correctly mock Zebra index from tests
    
    This is just reusing what is done in Search.t (and that is correct).
    But search_utf8.t and remove_from_cart.t are wrong as we want to use the
    UI (and we cannot mock the zebra index, ie. koha-conf, from tests for
    plack).
    
    This still needs some work but improve a bit the existing code and make
    tests pass (hopefully!)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4f32c745f830a042cec772b2558ee801b1bd7d6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 29 10:33:57 2021 +0200

    Bug 29364: Revert changes to framework visibility made by Search.t
    
    To recreate run:
    
    drop database koha_kohadev;
    create database koha_kohadev;
    
    restart_all
    
    KOHA_TESTING=1 prove t/db_dependent/selenium/01-installation.t t/db_dependent/Search.t t/db_dependent/Koha/UI/Form/Builder/Item.t
            #   Failed test 'Item types should be sorted by description and an empty entries should be shown'
            #   at t/db_dependent/Koha/UI/Form/Builder/Item.t line 127.
            #     Structures begin differing at:
            #          $got = undef
            #     $expected = ARRAY(0x557716b68e98)
            # Itemtypes details: $VAR1 = undef;
            # $VAR2 = [
            #           'BK',
            #           'CF',
            #           'CR',
            #           'ihxGmo7',
            #           'MP',
            #           'MU',
            #           'MX',
            #           'REF',
            #           'VM'
            #         ];
    
            #   Failed test 'Labels should be correctly displayed'
            #   at t/db_dependent/Koha/UI/Form/Builder/Item.t line 130.
            #     Structures begin differing at:
            #          $got = undef
            #     $expected = HASH(0x557716e2e150)
            # Looks like you failed 2 tests of 2.
    
        #   Failed test 'itemtypes'
        #   at t/db_dependent/Koha/UI/Form/Builder/Item.t line 133.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42d1bc3d4907a365f0924c5f3c9e165cc088c7b2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 29 09:59:29 2021 +0200

    Bug 29363: Fix TestBuilder.t if bib 123 does not exist
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20078affb945f7e95563488c0d84b883eb08b7cd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 7 08:09:39 2021 -0300

    Bug 28959: DBIC update
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 900bd815d127a877fbcc5ca5ae0fc6a6cf4368f4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 17:47:05 2021 +0200

    Bug 28959: DBRev 21.06.00.039
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d821cf9c9ca92ed76070331115dc680d60ea3034
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 28 11:58:36 2021 -0300

    Bug 28959: Fix other cases
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35d03d6cf630575b402fea2f6b18c5eb7aebae9c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Sep 10 20:50:31 2021 -1000

    Bug 28959: (follow-up) Adjust more places in which 'category' was used
    
    Some links still had category.
    
    I propose we use explicit public=1 and public=0 when links to public/private are side by side.
    Otherwise whe just use /cgi-bin/koha/opac-shelves.pl?op=list using default value 0.
    
    Signed-off-by: David Nind <david@davidnind.com>
    JK: Adjust commit title
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit adc3772204f3c9d5f95866c1e4b90d81198671fc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 8 16:44:16 2021 -0300

    Bug 28959: (follow-up) Adjust all places in which 'category' was used
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c720315394f76a809ef26f533c9d6414dfb0473
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 7 12:19:03 2021 -0300

    Bug 28959: Add virtualshelves.public as a boolean
    
    This patchset moves the 'category' attribute for virtual shelves, that
    takes values of 1 and 2 (private and public respectively) into a boolean
    for public.
    
    The DBRev is trivial, and the changes to the code are as well.
    
    To test:
    1. have some known public and private lists
    2. Apply this patches
    3. Run:
       $ updatedatabase
    => SUCCESS: Public lists have public=1, private have public=0
    4. Run:
       $ kshell
      k$ prove t/db_dependent/Utils/Datatables_Virtualshelves.t \
               t/db_dependent/Virtualshelves.t
    => SUCCESS: Tests pass!
    5. Try the feature in staff and OPAC
    => SUCCESS: All good
    6. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d38be59a48bb4f3a2dce64947731f3288ba58a50
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 7 08:06:59 2021 -0300

    Bug 28959: Move category => public
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9fc07aee3bc9b60a856b1b873ec731a31c2bc8a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 27 09:06:44 2021 -0300

    Bug 29290: Unit tests
    
    This patch adds unit tests for the new route. All behaviors are tested:
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/biblios.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8fdd52b17cfe149c5e9721161cab60e61ad97877
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 20 18:12:41 2021 -0300

    Bug 29290: Add GET /biblios/:biblio_id/checkouts
    
    This patch adds the required controller method.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d46492ac234cb00028618bd46f623c5243d627b6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 20 16:59:38 2021 -0300

    Bug 29290: Rename relationships borrower => patron
    
    This is a trivial change that is required to be able to embed patron
    objects in the (old) checkout object.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ff32002dab417a69879139b092bbcdfd8a81761
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 20 18:09:35 2021 -0300

    Bug 29290: Add spec changes
    
    This patch adds the new route. It also tweaks the checkout object
    definition to allow embedding the required related objects (for bug 29275).
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84f51671088194fd2a60499fec90877983047378
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 20 18:02:01 2021 -0300

    Bug 29288: Add current_checkouts and old_checkouts methods to Koha::Biblio
    
    This patch adds helper methods for accessing current and past checkouts
    for a given Koha::Biblio object.
    
    To test:
    1. Apply the unit tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Biblio.t
    => FAIL: Methods are not implemented
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca5781d795313ac484d9056ef80157f11f8266b4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 20 18:01:42 2021 -0300

    Bug 29288: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f3b63261ebaeb1f81ba0315ccc0ce3cf3f4f541
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 24 09:05:21 2021 -0300

    Bug 29108: Add q parameters to items routes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5ee8ced5753aa4c8530d7df0cd6c78539fcb187
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 24 08:28:17 2021 -0300

    Bug 29107: Rename item_type => item_type_id
    
    This simple change renames the attribute in the item object API
    representation.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/items.t
    => SUCCESS: Tests pass
    2. Run:
       $ git grep 'api/v1/items'
    => SUCCESS: The items routes are not (yet) used in Koha
    3. Run:
       $ cd koha-tmpl
       $ git grep --name-only '"embed"'
    => SUCCESS: Only two templates are using embed.
    4. Check:
       - register.tt uses it to embed the manager, good
       - parcel.tt uses it to embed items. Alert.
    => SUCCESS: parcel.tt only uses a count on items. No item_type involved.
    5. Sign off
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ef23bb642802dee9b2a9c2833daef32bf9b4e32
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 08:50:43 2021 -0300

    Bug 27358: Add GET /public/biblios/:biblio_id/items
    
    This patch introduces a route to fetch items belonging to a biblio. It
    is expected to return the 'public' representation of the Koha::Item
    objects.
    
    It is also enforcing the visibility rules, by using
    Koha::Items->filter_by_visible_in_opac.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/biblios.t
    => SUCCESS: Test pass and they cover all the cases!
    3. Try your favourite REST tool against the new route.
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9070701163ddcfff076cdaff88087928a30866f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 15:38:54 2021 -0300

    Bug 27358: Unit tests for public items retrieval
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fde97d396984051a17a178495a7ccb7925cc2ec8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 28 09:30:41 2021 -0300

    Bug 28948: Fix random failure
    
    This patch makes the query for randomly generated libraries
    deterministic, thus getting rid of the random tests failures.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a1d841e444401129a2eb15f2f79d16f06d70ebd
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 7 18:46:53 2021 +0000

    Bug 28948: Don't require catalogue permission for public route, don't allow smtp server embed
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc22185625abbc0cb38e3b86c1b060d03ebd55dc
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 7 14:42:33 2021 -0400

    Bug 28948: Remove query params, 'q' param covers everything needed
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0de8364b7c197cd3bd1b70f93766ecc6da11216
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 7 14:51:51 2021 -0300

    Bug 28948: Remove FIXME
    
    This patch reproduces what we did for `to_api_mapping`: make it always
    present on Koha::Object classes. This has the side-effect of... making
    things more secure!
    
    Before this patch, if undefined, all attributes were returned.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31e9ccfe70db09de407f05589fe3a28b70234cdb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 3 12:18:03 2021 +0100

    Bug 28948: (QA follow-up) Convert to allow-list
    
    This patch converts the code to use an allow-list as aposed to a
    deny-list.  This is more 'fail safe' than requireing maintanence of a
    deny-list.
    
    We also switch to using db fields names for the list as aposed to api
    mapped names. This way, the list can be re-used for non-api related
    sanitising if required.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c56b2db564139e11361d74c10348f6b0189fa5f5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 08:50:43 2021 -0300

    Bug 28948: Add GET /public/libraries routes
    
    This patch introduces a route to fetch a list of libraries or a single
    library as expected on the /public namespace. It is expected to return
    the 'public' representation of the Koha::Library objects.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/libraries.t
    => SUCCESS: Test pass and they cover all the cases!
    3. Try your favourite REST tool against the new route.
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7647d5147861ad3b0c83ea9fabeba6ad837b9f0c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 13:18:27 2021 -0300

    Bug 28948: Teach objects.search about public requests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b2226a649c48b268afa7acdee8330c43eb1609d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jan 7 12:36:42 2021 -0300

    Bug 28948: Make is_public stashed on public routes
    
    This patch makes the API authentication code stash the 'is_public' value
    when public routes are hit.
    
    This will be particularly useful to have $c->objects->search generically
    pass this info down to the ->to_api method.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/auth_authenticate_api_request.t
    => SUCCESS: Tests pass! When a public route is reached, the controller
    has the 'is_public' value stashed
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6c2147ec755e61266b114a9399c799240223d2b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Jan 6 16:16:01 2021 -0300

    Bug 28948: Add a generic way to handle API privileged access attributes deny-list
    
    This patch introduces a way for Koha::Object(s)->to_api to filter out
    attributes that require privileged access. It is done in a way that the
    'public' parameter is recursively passed to nested objects in recursive
    to_api() calls.
    
    This way, Koha::Object-based classes can determine how they will render
    depending on this parameter. For example, for implementing a
    route for fetching an library looks like:
    
    GET /libraries
    
    The controller will look like:
    
    my $library = Koha::Libraries->find( $c->validation->param('library_id') );
    return $c->render(
        status  => 200,
        openapi => $library->to_api
    );
    
    Implementing an unprivileged (public) route would look like:
    
    GET /public/libraries/:library_id
    
    The controller will look like:
    
    my $library = Koha::Libraries->find( $c->validation->param('library_id') );
    return $c->render(
        status  => 200,
        openapi => $library->to_api({ public => 1  })
    );
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Object*.t
    => SUCCESS: Tests pass (i.e. current behaviour is kept, new behaviour
            passes the tests)
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e68f71534006d8039911bb5244a5ce94550601a8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 23 14:48:11 2021 -0300

    Bug 17314: Implement /suggestions routes
    
    This patch introduces routes to handle purchase suggestions, from the
    staff POV.
    
    Tests are added as well.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/suggestions.t
    => SUCCESS: Tests pass! And they are meaningful!
    3. Play with your favourite REST tool (Postman?)
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cc404b651fb848fc840838e121ed684f1762929
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 23 14:43:31 2021 -0300

    Bug 17314: OpenAPI spec
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acdba5165f6781a0e4ad3e96de28312f40eafdc3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 23 14:48:54 2021 -0300

    Bug 17314: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 370a79648d8f46acd917e4a996b056456fa3323d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Apr 23 14:41:08 2021 -0300

    Bug 17314: Make TestBuilder set good defaults for Suggestions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16e988301c8afb4f4ecca498ca7a01a3a82f64d9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 10:25:37 2021 +0200

    Bug 28859: Correctly handle 'Checked out by' visibility
    
    We must have the column in the table and let DT deal with the
    visibility.
    
    This patch hides the "Checked out by" column by default if
    RecordStaffUserOnCheckout is off, but the DT column settings is aware of
    its existence and the end user can still display the column.
    
    IMO that's the most optimal situation considering both maintenance and ergonomic.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8a7ce37177b0009a7f51a35d8b65b3bc634d15c
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Sep 17 14:14:36 2021 +0100

    Bug 28859: Fix missing column setting
    
    This commit adds the missing checked_out_by column to
    columns_settings.yaml
    
    Test plan:
    
    - Follow the test plans in the bug description and note that the
    symptoms are no longer seen
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 712be5b41fdbc0b9f75ad747745628cc5da2d873
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 26 18:19:27 2021 +0000

    Bug 29229: (follow-up) Update method for linking flatpickr fields
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 675224ebc984450d66c7601e12516696dc07637f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 13 19:05:10 2021 +0000

    Bug 29229: Use Flatpickr in suggestion search sidebar filter
    
    This patch corrects the date field configurations for the suggestions
    sidebar filter. These fields are now linked Flatpickr widgets instead of
    jQueryUI datepickers.
    
    To test, apply the patch and go to Suggestions.
    
    - In the sidebar, click "Suggestion information" to expand the form.
    - Test these linked date fields:
      - "Suggested date from" and "to"
      - "Managed date from" and "to"
      - "Accepted by from" and "to"
    - Each should trigger Flatpickr calendars which are linked, i.e. you
      can't select a "to" date which is before a "from" date.
    - Test that the dates submit correctly to filter as expected.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 204ded1950dfff663a7bcf17c6b64ea39b064ecf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 17:19:49 2021 +0200

    Bug 29261: (bug 15812 follow-up 2) Fix translation issue in include file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67398811d4ff8c09950ce458a815a201615fe68e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 21 12:16:07 2021 +0000

    Bug 29301: Display error with serials search flatpickr when searching Mana
    
    This patch changes the way certain serials search fields are hidden when
    a standalone search of Mana is being performed (from the "Search on
    Mana" link). Instead of targeting specific labels and inputs to hide we
    can hide list items by class.
    
    Unrelated: This patch updates the page heading so that it is different
    depending on whether you're searching Koha subscriptions or Mana
    subscriptions.
    
    To test, apply the patch and enable Mana.
    
    - Go to Serials -> Advanced search (in the search header).
    - The search form should include all fields, including call number,
      vendor, library, location, and "Expires before."
    - Click "Search on Mana" in the sidebar.
    - This page should have the heading "Mana subscriptions search," and
      there should only be three fields visible: ISSN, Title, and Publisher.
    - When you perform a Mana search which returns results the page should
      have the heading "Mana subscriptions (X found).
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d1bed2b60c37d1f9ccbd3f16888d80b10c0f1fe
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 21 12:02:06 2021 +0000

    Bug 29299: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42158f3c069921e20071735aed8121feaf29a712
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 21 11:51:47 2021 +0000

    Bug 29299: Reindent serials search template
    
    This patch updates the serials search template to give it consistent
    indentation.
    
    The patch also moves one section of markup: The <tfoot> section is moved
    to after <tbody> in order to conform to current standards.
    
    To test, apply the patch and go to Serials -> Search subscriptions (in
    the header).
    
    - Serials search should work correctly and the page should look correct.
    - With Mana enabled, click on the "Search on Mana" link in the sidebar.
    - Searches of Mana should work correctly too.
    - If you view the diff while ignoring whitespace the only changes should
      be the move of <tfoot> and places  where line breaks were introduced.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e5046a0294defb07c4033cf53a790ce872d7aa8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 22 08:52:56 2021 -0300

    Bug 28613: Add missing parameters to objects.search-based routes
    
    The objects.search helper provides convenient ways to paginate and a 'q' filter parameter to build complex queries on this Koha::Objects-based routes.
    
    Some routes were created prior to this feature getting introduced. We need to adjust the parameters for all existing objects.search-based routes.
    
    This patch adds that.
    
    The only GET (as in list) routes that would still be missing the
    parameters are those about ILL, that are not objects.search based, and
    probably need to be rewritten.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da285c5255adfae1c87c849dfcdc695a051ea7fb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 21 13:10:35 2021 +0100

    Bug 29300: Add 22.05 release team to teams.yaml
    
    Add the 22.05 release team.
    
    Test plan
    1/ Check against
       https://wiki.koha-community.org/wiki/Release_Teams
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit deea41e9efba4efd9a5030383124efd2afbded76
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 10:16:00 2021 +0200

    Bug 29218: Rename .hidden class for DT visibility
    
    .hidden get the CSS that interferes with DT behaviour
    
    .hidden {
        display: none !important;
    }
    
    Test this patch with bug 28859.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de6a37312604b818c846a7bd048f9d95f2f7f0ee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 7 12:17:51 2021 +0200

    Bug 28349: (bug 26234 follow-up) Correct wrong array merge
    
    Bug 26234 allowed to remove the different classes we use in aoColumnDefs
    for sorting columns of table using DT.
    
    However there is a terrible mistake, the merge of existing aoColumnDefs
    array with the default one is totally wrong:
      $.extend(true, new_parameters, default_column_defs);
    When we actually wanted to do:
      $.extend(true, new_parameters["aoColumnDefs"], default_column_defs);
    
    But it's still wrong, extend is doing a deep copy and the array will be
    replaced by the other one, whereas we want to append.
    
    We want to merge default_column_defs with the existing aocolumnDefs,
    this patch is doing it explicitely.
    
    This bug only exists when there is an existing aocolumnDefs.
    
    See commit d3f3a55e0b1544ebcd3166d141e126a4324baab1
    It happens on:
     * cataloguing/z3950_search.tt
     * reports/guided_reports_start.tt
     * serials/subscription-detail.tt
     * opac-course-reserves.tt
     * opac-detail.tt
    
    However this bug has been hidden as we have in master related bug from
    bug 27945, which removes title-string.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b0962028763c4e36bc6d05fd07513b0f10754bd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sun Oct 24 19:54:24 2021 -0300

    Bug 29272: (QA follow-up) Category setup overrides syspref
    
    This patch removes an early short-circuit we had, which wasn't correct
    regarding the OpacPasswordChange syspref. If a patron category is
    allowed to change password, it overrides the syspref.
    
    To test:
    1. Tests still pass.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d91d813e5ca9b5592957c3c561d83d3b507e61f9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 19 10:29:55 2021 -0300

    Bug 29272: Make public password changing honour category constraints
    
    This patch makes the public API routes validate
    $user->category->effective_change_password before allowing the change.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons_password.t
    => FAIL: Tests fail, it allows the first change instead of returning
             403.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81ec1ad5b5319233255a78e63eabcc88faa8e8fa
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 19 10:27:53 2021 -0300

    Bug 29272: Regression tests
    
    This patch introduces regression tests for the described bug.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons_password.t
    => FAIL: Tests fail, excepted failures are considered success
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b78011d8c42363f1f3ebdaaa53431f8493efe70
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 3 16:35:57 2020 +0000

    Bug 26374: update from bug 19974 is not idempotent
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7948b429d1941e14f5d341b19aa61e5c77ce0eb0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 11:50:18 2021 +0100

    Bug 29332: Set default library limits in search_for_display
    
    Koha::AdditionalContents->search_for_display needs to filter to just
    items with a 'null' branchcode if no library_id is passed.
    
    Test plan
    1/ Add some additional content blocks that should display only for
    specific branches.
    2/ Navigate to the OPAC and note that blocks display for all libraries
    prior to login
    3/ Login to the OPAC and note that now you only see you users library
    block
    4/ Apply the patch
    5/ Repeat steps 2 and 3 and note that now you see only the 'All
    libraries' blocks display prior to login and that 'All libraries' +
    'Your users library' blocks appear after login.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1780f02f28438d42d42d6993462b48fc641ed5d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Oct 27 12:07:02 2021 +0100

    Bug 29332: Unit tests
    
    This patch adds unit tests to ensure we do not leak branch specific
    addtional contents blocks outside of logged in sessions (i.e. where a
    users branch is not yet set).
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c70de8c5305700cce9a6fe9a6f75c2cf53be02f1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 12:15:17 2021 +0200

    Bug 28445: Add diag for failing test
    
    Temporary patch to help trying to fix the following random error:
         #   Failed test 'Item types should be sorted by description and an empty entries should be shown'
         #   at t/db_dependent/Koha/UI/Form/Builder/Item.t line 121.
         #     Structures begin differing at:
         #          $got->[12] = 'Be9T9FH5aO'
         #     $expected->[12] = 'REF'
         # Looks like you failed 1 test of 2.
    
     #   Failed test 'itemtypes'
     #   at t/db_dependent/Koha/UI/Form/Builder/Item.t line 130.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca179e808f00b0fe08f0fa9c377c10096da0702c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 12:03:58 2021 +0200

    Bug 28445: Fix LostItem call and display errors
    
    Never a try without a catch, ever!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75c468de00c8b2ae72d946473a1f0ee0874ef880
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 11:47:07 2021 +0200

    Bug 28445: Remove modified_itemitemnumbers
    
    Wrong substitution
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd9ef9bdc01a531ac6fb113d12c4e635442f8fc9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 11:40:09 2021 +0200

    Bug 28445: Correctly count modified items
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79e8701b1de5eb471d0e32103ea44cd8af40d06e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 10:47:51 2021 +0200

    Bug 28445: Add tests for subfields_to_prefill
    
    I first wrote test for another thing but the code was actually correct.
    So submitting the tests.
    
    Note that the marc for more_subfields does not need to be passed, we can
    build it when needed.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1fa2afe44bbec0fd2ae0d34f30488fe6b9b9835d
Author: Andrew Nugged <nugged@gmail.com>
Date:   Thu Oct 28 00:22:28 2021 +0300

    Bug 27526: Fix for prefill preventing duplication 2
    
    Prefill feature should not be in the priority
    when user choose "Duplicate" for the item
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd29c73a387c3c167177b7c76693397d97392fe5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 28 10:43:05 2021 +0200

    Bug 27526: Fix SubfieldsToUseWhenPrefill
    
    my $a = "z";
    my @x = split ( ' ', $a ) || ("");
    
    @x will be [1]
    
    Which is not at all what we are expecting here!
    Be more verbose and don't introduce bug.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 103bbf2c9a1841a3c2ed0a7e066b7e2a20ce018c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 27 09:17:25 2021 +0200

    Bug 14957: DBIC changes - Remove MarcOverlayRulesModule.pm
    
    Where is that coming from??
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1cefcd6e123d27049970994fd6cc5390765d8286
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 27 09:16:42 2021 +0200

    Bug 14957: Fix perlcritic error on admin/marc-overlay-rules.pl
    
    Subroutine "new" called using indirect syntax at line 30, column 13.  See page 349 of PBP.  (Severity: 4)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3376e0d2189504cea220f2eb151d949e9a0835c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 11 11:11:26 2021 +0200

    Bug 27526: Correct NULL vs empty string when editing
    
    When an item is edit we must keep the NULL values in DB if the input
    have been left empty.
    It also fixes the "barcode cannot be unique" error when an item does not
    have a barcode.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 474f228a6986cce5e3da2425db7fbcad444c5fd0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 25 18:50:17 2021 +0000

    Bug 29318: Tidy the code
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0099cff73967cf459a8a3b6dcf583f5ee01d0394
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 25 18:47:22 2021 +0000

    Bug 29318: Remove permission check from overdrive search page
    
    This removes the 'edit_borrowers' permission from OverDrive search
    
    To test:
    1 - Enable OverDrive via koha system preferences
    2 - Sign in to opac with a user with no permissions
    3 - Perform a search that will return OD results, 'love' works
    4 - Click thje "Found XX results in the library's OverDrive collection"
    5 - Note you are logged out of Koha
    6 - Apply patch
    7 - Repeat
    8 - Success
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93822a8ca77afe2b7230d8f1fc41f56e28204f01
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 25 18:00:12 2021 +0000

    Bug 29286: Typo: Librarien will need the manage_auth_values subpermission.
    
    This patch fixes a typo in the Cataloging system preferences text.
    
    "Librarien" -> "Librarian"
    
    To test, apply the patch and go to Administration -> System preferences
    -> Cataloging.
    
     - Check the CreateAVFromCataloguing system preference.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16d2765c3c8575012c437f2c1d343d94f2a79ce1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 25 11:49:38 2021 +0200

    Bug 29158: (bug 22435 follow-up) Remove ref to account_offset_types.sql in intaller
    
    Caused by
      commit 3d6a6e79f79bfbc17807072faf0ff1d4e6aafb82
      Bug 22435: (follow-up) Drop account_offset_types table
    that removes the file but the reference to it from the installer
    process.
    
    Test plan:
    Go through the install process and notice that the following warning
    does not appear in the log:
    [2021/10/25 09:47:58] [WARN] Something went wrong loading file /kohadevbox/koha/installer/data/mysql/mandatory/account_offset_types.sql (Couldn't read '/kohadevbox/koha/installer/data/mysql/mandatory/account_offset_types.sql' : No such file or directory at /usr/share/perl5/DBIx/RunSQL.pm line 180.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aab18ba056000c27e89f84fdfb16388be77f44f1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 26 15:49:59 2021 +0200

    Bug 14957: DBRev 21.06.00.038
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 38a71afebf64b96cd60128a28ed7f51c52ecca1e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 26 15:46:22 2021 +0200

    Bug 14957: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3247eb9a7345bacf3d87894d735d0984cd218a56
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 15:51:50 2021 +0200

    Bug 14957: Add tests for subfield order
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8425cf1e13da5ccd7854bf01f3327f1601d3877f
Author: David Gustafsson <glasklas@gmail.com>
Date:   Wed Oct 20 17:17:31 2021 +0200

    Bug 14957: Fix field order issue
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f756d9534e7f7e23336635f53493ab04a59179b5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 18 13:04:55 2021 +0200

    Bug 14957: Fix record preview
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ab1ca24283d73c4404ef67f3d30651966f4c435
Author: David Gustafsson <glasklas@gmail.com>
Date:   Fri Oct 1 16:47:44 2021 +0200

    Bug 14957: Exclude leader from saved/updated record comparison in tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d306da9f8dce5c5266629e5fe376af2804ce3c3b
Author: David Gustafsson <glasklas@gmail.com>
Date:   Fri Oct 1 15:42:24 2021 +0200

    Bug 14957: Fix regression, rules must be refetched on add/edit/deletion
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 435abd3379e7ffb2e937a58254c473cf0dbf69c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 18:20:19 2021 +0200

    Bug 14957: Improve readbility of tests
    
    Not saying that they were not readable before, but I had to do some
    changes to compare the before/after records and it was easier that way.
    Feel free to obsolete if you disagree.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10a51487caa86269042e20e37b69b7ba521009c9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 12:06:30 2021 +0200

    Bug 14957: Clean controller
    
    Too many imports and unecessary complicated init of $rules
    
    There are certainly other things to improve, like the "op" handling,
    standardize names of "op", etc.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78b5cd20158b217728383bf5a69db4a3fd535ef7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 6 08:23:46 2021 +0100

    Bug 14957: (QA follow-up) Fix for jQuery undefined
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3906bf1dca7cd7d9d2d63fd53df8ba94e3e6365
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 6 08:07:38 2021 +0100

    Bug 14957: (QA follow-up) Fix script name
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4b55db9d48a682a5509997d50428ccb1efc6ed3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 5 16:49:11 2021 +0100

    Bug 14957: (QA follow-up) Fix template indentation
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7838c8e3078b87b73f5f542329f2fc570c44568c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 5 16:43:37 2021 +0100

    Bug 14957: (QA follow-up) Update for bug 27846
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28aef3a5257ff7b18a8a798e74d2e1d0aa1b82f5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 5 16:28:30 2021 +0100

    Bug 14957: (QA follow-up) Update for bug 17858
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3e113977bd2c1b5422b60291da1d28575d7af5d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 5 16:13:07 2021 +0100

    Bug 14957: (QA follow-up) Update for bug 26703
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: (QA follow-up) Update for bug 20054
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: (QA follow-up) Update for bug 20053
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: (QA follow-up) Update for bug 23271
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 342dae89f88f4e89e8cee0c273fe065260950770
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 5 16:07:32 2021 +0100

    Bug 14957: (QA follow-up) Add missing filters
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e14a2e350e94538d3fa880527417c68484f1438f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 29 13:31:59 2021 +0100

    Bug 14957: (QA follow-up) Comment 'bulkmarcimport' temporarily
    
    It appears this patchset doesn't fully support bulkmarcimport (see bug
    25539 for details).
    
    At this time, to get this bug moving I think we should comment out the
    ability to define rules that affect bulkmarcimport and then we can fix
    and re-enable that feature at a later date.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9ed5b0e34a403cb4157486a38c8158f9a169979
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 29 10:31:52 2021 +0100

    Bug 14957: (QA follow-up) Rename and move admin link
    
    This patch renames 'MARC overlay rules' to 'Record overlay rules' and
    moves it up the list to just below 'Record matching rules' to make it
    more contextually ordered.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad1fa00ed34d9251d48bdfdcd66053d639bec146
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Mar 29 10:21:23 2021 +0100

    Bug 14957: (QA follow-up) Fix translation issues
    
    This patch fixes all the translation issues I could spot in the
    marc-overlay-rules template.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27f3d0af638f3c047468d28b70a4ccc65c1f7da7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 26 16:48:24 2021 -0300

    Bug 14957: (QA follow-up) Clarify 'context' param
    
    This patch renames the (passed through) 'context' param for
    'overlay_context'. I propose doing so, because in Koha-land 'context'
    has a special meaning, related to C4::Context and it reads ambigous.
    
    The patch itself is pretty trivial.
    
    Tests should pass:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Biblio/MarcOverlayRules.t
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: (follow-up) Clarify 'context' param
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 702af7ac6860d5ffad05736542228d7d94430dd6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 26 16:38:31 2021 -0300

    Bug 14957: (follow-up) marc_merge_rules_modules removed
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59e04730519f100b64d38c71ef8d59fe74a2b92b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 26 14:52:07 2021 -0300

    Bug 14957: DBIC changes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66157286ad4ecc2c218cccf1bc8501b10e987519
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 26 13:16:09 2021 -0300

    Bug 14957: Feature hidden in menues if no other 'cagaloguing' permissions
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02720d423cb591cc854c6ec3d06a1fe51bd5c128
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Mar 26 13:12:11 2021 -0300

    Bug 14957: (QA follow-up) Rename 'merge' => 'overlay'
    
    This patch acknowledges the fact that 'merging' has a different meaning
    in Koha than the behavior this great patchset introduces. The more
    idiomatic way of describing the behavior is to talk about 'overlay rules'.
    
    This patch also:
    - Fixes kohastructure.sql missing table encoding a collation
    - Fixes the atomic update completely missing a table
    - Moves the syspref entry to 'Importing', probably a rebase issue
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: (QA follow-up) Fix syntax error in atomicupdate
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: Fix imports in tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: Fix imports in marc-overlay-rules.pl
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 14957: Fix syspref's values
    
    It didn't switch off when set to "don't use"
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch: Fix license statement
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4725b64270c13e9824f9a9bd669d88515d1853d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 26 17:00:27 2021 +0000

    Bug 14957: (QA follow-up) Add tooltips
    
    This patch adds an info-tooltip to the field rules in the table header
    to expand on their meaning to reduce the need to read the documentation
    each time you come to use the configuration tool
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d323cdb12434edb19db9802b9dba84a84e31895
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Mar 26 16:31:39 2021 +0000

    Bug 14957: (QA follow-up) Button styling
    
    This patch updates the action buttons to include btn-default and
    switched from btn-sm to btn-xs to match other similar UI's found in
    datatable based admin pages.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e8b67e1edc01fe38861d1c953de17810350d709
Author: David Gustafsson <glasklas@gmail.com>
Date:   Fri Mar 5 14:35:32 2021 +0100

    Bug 14957: fix context for batchmod and batchimport
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 859396b804356852ff7b3feb3b0a9f8200672141
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Feb 10 16:49:16 2021 +1300

    Bug 14957: Updated schema files
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 139e6c30d6a88641148ea9ab7f00d0a0722f9fb5
Author: David Gustafsson <david.gustafsson@ub.gu.se>
Date:   Thu Feb 2 13:36:38 2017 +0100

    Bug 14957: Merge rules system for merging of MARC records
    
    Add a rule based system for merging MARC records to for example
    prevent field data from being overwritten.
    
    To test:
        1. Apply this patch.
        2. Log in to staff client.
        3. Enable new syspref MARCMergeRules.
        4. Click the new link "MARC merge rules" in the "Catalog"
           section of the Koha administration page.
        5. Create a new rule:
           Module: source, Filter: *, Tag: 245, Preset: Protect.
        6. Clicking "Edit" should allow you to edit corresponding rule.
        7. Clicking "Delete" should remove corresponding rule after confirmation.
        8. Selecting one or more rules followed by clicking "Delete
           selected" should remove all selected rules after confirmation.
        9. Try creating a rule with tag set to "**", the other options does
           not matter. Verify that saving this rule produces an error
           message complaining about invalid tag regular expression.
        10. Try creating a rule with tag set to "008" (or other control
            field) and set Appended: Append and Removed: Skip, the other
            options does not matter. Verify that saving this rule produces
            an error message complaining about invalid combination of actions
            for control field.
        11. With the 245 rule in step 5 in place, edit a bibliographic record,
            change 245a for example (which should be Title for MARC21) and save.
        12. Verify that the changes has not been saved.
        13. Create a new rule:
            Module: source, Filter: intranet, Tag: 245, Preset: Overwrite.
        14. Repeat step 12, and verify that the changes has now been saved.
        15. Run tests in t/db_dependent/Biblio/MarcMergeRules.t and very
            that all tests pass.
    
    Sponsored-by: Halland County Library
    Sponsored-by: Catalyst IT
    Sponsored-by: Gothenburg University Library
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c0a03d34cafd28eaa07e565109b448d09c04d398
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 26 15:44:19 2021 +0200

    Bug 11175: DBRev 21.06.00.037
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b05b534b947ab313c929192133a59d01cfd9e07
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 26 15:16:54 2021 +0200

    Bug 11175: Add tests
    
    Add coverage for the message set by get_marc_components when the search
    fails.
    Also cleans a bit the weird return comparisons.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ecbf3a3469bd53d5cb86a825f2df9d169df49af
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 26 12:46:25 2021 +0000

    Bug 11175: (QA follow-up) Test message contents for analytics error
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 012d2333b28ec7df9ebd53d01e19488464d8b948
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Oct 26 10:48:11 2021 +0100

    Bug 11175: (QA follow-up) Restore bug 29284
    
    This patch restores the functional fixes introduced in bug 29284 and
    also prevents the 'Show analytics' link from displaying when no
    component parts are found and inline display is enabled.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Amended: Fixed error with $err vs $error(s) :)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfce3d3c0ce53ba3c40adaf69bc924bdfafed051
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Sun Oct 24 12:11:02 2021 +0000

    Bug 11175: (QA follow-up) Do not fetch twice
    
    We were fetching components in the first call of XSLTParse4Display
    (opac-detail around L220). And again (opac-detail around L660).
    Same for catalogue/detail.pl.
    Moving the XSLT block in both scripts and removing the code from
    XSLT.pm which again makes the tests obsolete.
    
    Not hiding the link when there are components. Might be helpful too.
    
    Also fixing biblionumber in the XSLTParse4Display call for parts.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 936e86366cb44c9dce510cd421a546890599e51f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 22 10:02:09 2021 +0000

    Bug 11175: (QA follow-up) Remove caching _components
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7502f4182e450a60017a5aacfccd8c411dc99c30
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 22 10:15:45 2021 +0200

    Bug 11175: Uniformize ComponentParts in template
    
    More robust as it takes empty array into account
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e87270076227e4eebdedfa010e5423d0aa4c974
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 22 09:46:43 2021 +0200

    Bug 11175: Add syspref MaxComponentRecords to remove hardcoded limit
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 919523a5246b54a18469d53174cd6f8112b1c097
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Oct 18 16:32:57 2021 +0100

    Bug 11175: (QA follow-up) Restore link to more results
    
    This patch restores the link to 'more results' should you exceed the
    hard coded limit of 300 component parts.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca6ef8ddaf732587ad4293b7d5bd2122b7ca685c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Oct 18 16:14:07 2021 +0100

    Bug 11175: (QA follow-up) Be more specific with title fields
    
    We were using the MARC::Record title accessor, but that just stringifies
    all the subfields of field 245. The indexer, and the XSLT, specifically
    use 245a so we need to do the same.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 304247d326f6de073364098850dcd091985f8315
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Oct 12 10:31:47 2021 +0100

    Bug 11175: (QA follow-up) Display components tab if no holdings
    
    This patch updates the default details tab selection to components for
    the case when there are no holdings attached to the record and there is
    no HTML5 content to display in preference.
    
    Bug 11175: (QA follow-up) OPAC - Display components tab if no holdings
    
    As for the staff client, this selects the default tab to be 'Components'
    for the case where no holdings are found.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85e6e197fbe4b1d72a58f9c296159f8ce9326eb5
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Oct 12 09:49:34 2021 +0100

    Bug 11175: (QA follow-up) Account for difference in simple_search return
    
    Thanks to a comment from Andrew, I discovered that the return from
    simple_search_compat actually differs depending on if you are using
    ElasticSearch or Zebra. The 'results' arrayref contains MARC::Record
    objects for ES and raw marc strings if you are using Zebra.  This is
    actually already dealt with in the misnamed new_record_from_zebra
    function inside C4::Search.. so this patch simply replaces our
    MARC::Record instantiation code with a call to that function.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43dff988bd480c27e6e2d1aee33811ce06e93f0a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 1 16:16:33 2021 +0100

    Bug 11175: (follow-up) Use clean_search_term
    
    This patch uses the now public clean_search_term from bug 28316 to
    sanitize the title string and prevent crashes in elastic search when
    title contain reserved characters.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b292ebbccec91c0004642d906b42494988017a13
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Aug 9 08:30:12 2021 +0100

    Bug 11175: Display components in own tab
    
    This patch updates the display so that rather than displaying the
    components using the main XSLT and then using CSS to move them into a
    box on the right side for display, which causes issues with RTL records;
    We instead add them in a new tab beneath the rest of the record details
    alongside holdings and other details.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Bug 11175: (QA follow-up) Fixes for bug 12561
    
    Bug 12561 changed the prototype for XSLTParse4Display so this patcha
    accounts for the additional calls to that method introduced in this
    patchset.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69a3d0fd8e7b9fa306a767aa5a7a538ccb4b7365
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 6 17:01:38 2021 +0100

    Bug 11175: (QA follow-up) Fix queries
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 412f22e4ad60de83cee26d80830491a9a7327c79
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 6 13:00:29 2021 +0100

    Bug 11175: (QA follow-up) Only get biblio once
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0b56eadaf46ea4f8b0588e01f6b070a9fcd0b484
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Aug 6 12:44:23 2021 +0100

    Bug 11175: (QA follow-up) Move get_component_part_query
    
    This patch removes Koha::Util::Search in preference to embedding the
    search query builder in Koha::Biblio as get_analytics_query.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Bug 11175: (QA follow-up) Rename back to get_marc_components
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37c7b9358dc0dc35474597a4cbae25742cf529d3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 3 14:29:27 2021 +0100

    Bug 11175: (QA follow-up) Take account of bug 15851
    
    We can simplify the code introduced by bug 15851 by moving the
    'show_analytics_link' variable assignment into C4::XSLT and thus making
    the code more DRY.
    
    Taking the code in bug 15851 as inspiration this patch also adds proper
    handling for UseControlNumber vs EasyAnalytics style 773 linking and
    ensures we only return analytic component parts and no other records
    containing 773's.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acdbbcd40cec81399227625c7ce132663a1ed418
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Aug 3 09:03:13 2021 +0100

    Bug 11175: (QA follow-up) Move preference to 'Display'
    
    The 'ShowComponentRecords' preference was displaying under the 'Export'
    section in the cataloging system preferences tab. As a display related
    feature, I felt it was more appropriate to put it into the 'Display'
    section.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a38b55e258eba808c57f285c0e3b0e81d8742317
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jul 9 12:30:35 2021 +0100

    Bug 11175: (follow-up) Rename routine get_marc_components
    
    For consistency with other marc data accessor methods rename the new
    'components' method to 'get_marc_components'.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e34b9d6db95078489eaf21dcb575da87457b4fd
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Tue Apr 27 12:50:56 2021 +0300

    Bug 11175: (follow-up) make atomic update idempotent
    
    Atomic update tries to insert line into system preferences even if it's
    already there. This patch fixes that by adding 'IGNORE' to the query,
    making it idempotent.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ffe2477cf0f5a90de21d4928fc5ed0594d8427f
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 10 20:21:46 2020 +0300

    Bug 11175: (follow-up) Add tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 14858f561e70d222ea56ed48346b62e1943c7e90
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Feb 12 14:03:15 2021 +0200

    Bug 11175: Remove outdated info about Elasticsearch not being suppported
    
    Support for Elasticsearch was added in commit "Bug 11175: Add
    Elasticsearch support".
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a819ae07a60cd52f44b9dc5785dd28df79a6a6df
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Nov 24 19:19:04 2020 +0200

    Bug 11175: Search using double quotes to support Elasticsearch
    
    With Elasticsearch if you would use the search string here without the
    change to double quotes, i.e.
    
    (rcn='1234' AND cni='FI-XXX') OR rcn='FI-XXX 1234'
    
    then the search would somehow manage to return a record with 001 =
    1234 and 003 = FI-XXX. Using double quotes prevents that. Also using
    parenthesis around the latter part of the OR seems to work:
    
    (rcn='1234' AND cni='FI-XXX') OR (rcn='FI-XXX 1234')
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d21e919ba6d398baa727ca2b6a746dac370b2f96
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Nov 13 19:52:18 2020 +0200

    Bug 11175: Limit the amount of component parts returned
    
    There was already before this a limit of 100 results when using
    Elasticsearch but then the list of component parts was truncated
    silently. This change now limits the amount to hard coded limit of 300
    which is still fast to render. Also when the 300 component part record
    limit is reached there is a link in the list now to list all the
    records via the cataloging search.
    
    To test:
       1) Create 300+ component part records and see if the link to list
          all the component part records shows up
       2) Make sure prove t/Koha/Util/Search.t passes
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Bug 11175: (QA follow-up) Replace en dash with hyphen in perldoc
    
    This fixes the QA tool failure.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f83be33671c56c55d57a21a3b04c9a7ba8d171e
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Nov 13 19:08:17 2020 +0200

    Bug 11175: Keep component part record list items inside the box
    
    Without this the number denoting the component part item in the list
    will overflow and is partly hidden.
    
    To test:
     1) Create 100 component parts
     2) Notice without this patch the number next to the component part is
        not fully shown
    
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc7fb7a7fbe90035b927d78f92475c93f5aedc45
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Nov 2 14:59:33 2020 +0000

    Bug 11175: Add Elasticsearch support
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c14ff59f73adb7f9706c38c5a8282473b8ef5d0b
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Nov 2 17:24:39 2020 +0200

    Bug 11175: (follow-up) Relocate and reword ShowComponentRecords syspref description
    
    The syspref is not only affecting staff interface so moving it to
    Cataloguing section. Added also notes about UNIMARC and Elasticsearch
    not being supported.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b09b2558bd9715a0d4258df407af5d5aabd3e0c
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 10 20:20:19 2020 +0300

    Bug 11175: (follow-up) Return empty array if no components
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 796935876522db6d3a02d2907b07c0d920455d80
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Jun 8 15:12:52 2020 +0300

    Bug 11175: (follow-up) Don't return explicitly undef
    
    This would create in list context an list of one element that is
    undef, which we don't want, we want empty list if there are no
    components.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60505e57d6015e4b08718868f3fa7489c012125c
Author: Pasi Kallinen <pasi.kallinen@joensuu.fi>
Date:   Mon Aug 20 09:51:55 2018 +0300

    Bug 11175: Show record component parts in the detail view
    
    Shows the component records of a host, on the hosts detail view in
    staff client or OPAC, with clickable links to the component records.
    
    The host does not require linking entries to the components, but
    components do require a link to the host record via 773$w.
    
    Adds a new search index, Control-number-identifier (aka cni), which
    indexes the 003 controlfield.
    
    Adds 'Yet Another System Preference', ShowComponentRecords, which can
    be used to turn this feature on or off in staff client and/or OPAC,
    and defaults to off.
    
    When looking up the component part records, the code searches for
    records with (773$w=Host001 and 003=Host003) or 773$w='Host003 Host001'
    or, if the 003 is not defined in the Host, 773$w=Host001.
    
    Does not use easyanalytics or useControlNumber.
    
    Only for MARC21 biblios - UNIMARC has not been updated.
    
    staff-global.css and opac.css have not been recreated, so you need
    to use sass to recreate those from staff-global.scss and opac.scss
    
    Test plan:
    
    0) Apply patch
    1) perl bulkmarcimport -file /tmp/easypiano.mrc -m MARCXML
       (This file is an attachment on the bug)
    2) rebuild the zebra biblio index
    3) Search for "easy piano" in staff client, and go to
       the biblio detail page. You should not see anything different
       in the record detail page.
    4) Do the same on OPAC.
    5) Change the ShowComponentRecords syspref appropriately and check
       the record detail page in staff client and OPAC.
       You should see a list of component part records.
    
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    JD amended path
    -    if ($xslsyspref =~ m/Details/) {
    +    if ( $xslsyspref eq "OPACXSLTDetailsDisplay" || $xslsyspref eq "XSLTDetailsDisplay" ) {
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54a1c5433bb89f714cba5061ae33eb94851a0260
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 26 12:20:54 2021 +0200

    Bug 19185: Fix regressions.t
    
    The following test is failing:
    | #   Failed test 'OPAC - Remove from cart'
    | #   at t/db_dependent/selenium/regressions.t line 132.
    | Can't call method "get_value" on an undefined value at t/db_dependent/selenium/regressions.t line 110.
    | # Looks like your test exited with 2 just after 3.
    | [12:14:08] t/db_dependent/selenium/regressions.t
    
    We are dependind on the search engine and the records in the DB but the
    installer is not inserting any records.
    
    This patch is suggesting to reuse the code from search_utf8
    (and so make it reusable first) for remove_from_cart test.
    This code is mocking the Zebra index with some MARC data and so the
    search will return results. We will finally be able to click on the
    add to/remove from cart links.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit facc13f6f08c223b8e89ff28e3a4da14e3f53d1b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 25 15:49:05 2021 +0200

    Bug 29126: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02f96f6dfaf5e2a586e12bb440e97089379c2cc5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 21 11:17:33 2021 +0000

    Bug 29126: (follow-up) Correct color of btn-link class in striped tables
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 775cb9cc6e412b41811c0b06c26576b2a730f361
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 24 18:58:35 2021 +0000

    Bug 29126: Accessibility: More corrections to contrast in the OPAC
    
    This patch makes a few more corrections to OPAC CSS in order to avoid
    having elements which lack sufficient contrast, in particular parts of
    the interface where a standard-colored link appears on a darker
    background.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    
    Check the following pages/areas:
    
    - Breadcrumbs navigation
    - Datatables buttons (on the "Your summary" page)
    - Bibliographic view tabs (Normal/MARC/ISBD) on the bibliographic detail
      pages.
    - "Action" menu on the bibliographic detail pages: Place hold, print,
      etc.
    - Links inside "striped" tables: Links on the alternate grey background
      are darker to increase contrast.
    - Sidebar links on user pages: Your summary, your charges, etc.
    - Tag cloud: Approved tags in the weighted list.
    
    Signed-off-by: Jérémy Breuillard <jeremy.breuillard@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e257363cb324a9945bce2b84df880d698bbb679
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 25 15:48:48 2021 +0200

    Bug 28101: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4ba96bcea793eab7624b7a7f848d5dc582fb01f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 25 13:13:18 2021 +0000

    Bug 28101: (follow-up) Correct breadcrumb divider image
    
    This patch corrects the CSS for generating a chevron-style divider
    between breadcrumb items. The CSS copied from staff-global.scss needed
    some tweaks to make it work in the OPAC with Bootstrap 4.
    
    Also changed: The Base64-encoded SVG is converted to plain based on
    https://css-tricks.com/probably-dont-base64-svg/
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 43aea684f07380f525e442c8fa2b50dc77593c92
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 22 18:15:06 2021 +0000

    Bug 28101: Update breadcrumb markup in the OPAC for consistency and accessibility
    
    Modified breadcrumbs to be accessible, in particular for a
    screen-reader. Also ensured the breadcrumbs were all consistent.
    
    Made the block of breadcrumbs to be a <nav id="breadcrumbs"
    aria-label="Breadcrumb" class="breadcrumbs"> with an ordered list
    inside. The last breadcrumb also has aria-current="page" to specify that
    it is the current page.
    
    To test, apply the patch and rebuild the OPAC CSS (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client)
    
    - Confirm that OPAC templates are updated consistently to use
      breadcrumbs markup beginning with '<nav
      id="breadcrumbs" aria-label="Breadcrumb" class="breadcrumb">'
    - Pages in the OPAC should look consistent, with the last breadcrumb
      styled as text and with the "aria-current" attribute "page."
    
    Sponsored-by: Catalyst IT
    Signed-off-by: Henry Bolshaw <bolshawh@parliament.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca6205ea0d9a89ba534c7a1183d326e9bd5fa9c5
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Apr 19 00:35:05 2021 +0000

    Bug 28101: changed styling for breadcrumbs
    
    Updates opac.scss file so the breadcrumbs will appear the same as Bug
    27846 (Staff Client breadcrumbs).
    
    This works but the file may need to be changed/cleaned up so that there
    is not unnecessary information in it.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30f4726697e572948a69e7347567f670d4bfd6a0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 25 15:02:55 2021 +0200

    Bug 28847: Remove diag statements
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c546b662d5ebd5c952a6e1a6bb8aadac360c488
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 25 14:37:54 2021 +0200

    Bug 29315: Remove warnings from Search.t
    
    The syspref SearchLimitLibrary was requested but I don't know what to
    say; this indicates that the test requires updating at
    t/db_dependent/Search.t line 198.
    The syspref FacetOrder was requested but I don't know what to say; this
    indicates that the test requires updating at t/db_dependent/Search.t
    line 198.
    The syspref OPACResultsUnavailableGroupingBy was requested but I don't
    know what to say; this indicates that the test requires updating at
    t/db_dependent/Search.t line 198.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 033ce601a3fcbac339adcee1d60461fc4d87df4b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 11 10:57:40 2021 +0000

    Bug 29186: (QA follow-up) Correct the check for showing limit menu
    
    The template conditional for showing the limit menu should be changed
    to:
    
    [% IF ( unlimited_total > 10 && limit <= 1000 ) %]
    
    - "unlimited_total > 10" so that the "rows per page" button only shows
      if there are more than 10 total results, because 10 is the smallest
      increment the "rows per page" control offers.
    - "limit <= 1000" so that the "rows per page" button will show when the
      current result limit is less than or equal to 1000, because 1000 is
      the upper limit to the "rows per page" control.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5fee6f18a48e3a6214f6095f52feb87ab222bfaf
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 17 19:18:53 2020 +0000

    Bug 29186: Move reports result limit menu into toolbar
    
    This patch creates a new Bootstrap button menu for selecting the number
    of search results to be shown. This replaces the HTML <select>.
    
    To test, apply the patch and go to Reports -> Saved reports.
    
    - Test the appearance and functionality of the "Rows per page" button in
      various situations:
      - A report that returns more than 10 results
      - A report that returns fewer than 10 results
      - A report that returns no results
    - Test that the batch operations button menu appears correctly when
      there are biblionumbers, itemnumbers, or cardnumbers in the results.
    - When there are no results, or fewer than 10 results with no batch
      operations possible the toolbar shouldn't appear at all.
    
    Signed-off-by: George Williams <george@nekls.org>
    
    Signed-off-by: George Williams <george@nekls.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6f852be57b9a3ac77068259b4f534f2bb5e5586
Author: Katrin Fischer <katrin.fischer@bsz-bw.de>
Date:   Wed Aug 4 17:28:06 2021 +0200

    Bug 20463: (follow-up) Remove option from search templates
    
    Using this search option in the GUI would require the user to
    enter the codes from MARC, LDR 19, see:
    
    https://www.loc.gov/marc/bibliographic/bdleader.html
    
    So I think it's better to leave this out for the moment.
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dffbfad15687c7ddb7d4eb614eeb85ac0085b2c2
Author: Katrin Fischer <katrin.fischer@bsz-bw.de>
Date:   Wed Aug 4 17:26:47 2021 +0200

    Bug 20463: (follow-up) Configure short name mrl for Multipart-resource-level index
    
    This adds mrl as appreviation of Multipart-resource-level to
    the Zebra configuration and Search.pm so it can be used when
    searching.
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 45fee768e97a159333150a9f962c00a9a320ed4d
Author: Hayley Pelham <hayleypelham@catalyst.net.nz>
Date:   Tue Jul 27 04:49:24 2021 +0000

    Bug 20463: Adding index for Leader 19 Multipart resource record level
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Wuerttemberg
    
    Signed-off-by: Katrin Fischer <katrin.fischer@bsz-bw.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ecf5ee106354a8e1c55cbd7278064b6283bac0a
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Oct 11 16:52:08 2021 +0300

    Bug 29207: Getopt::Long should not ignore cases
    
    To avoid Getopt::Long treating upper case and lower case options,
    this patch restores removed ":config no_ignore_case".
    
    Steps to reproduce:
    1. Start koha-z3950-responder deamon for any instance.
    2. Check z3950.log log file, there should be
    "[fatal] Failed to listen on ...-koha-z3950" in it.
    3. Alternatively you can "curl localhost:2100/biblios?version=1.1 -v"
    to ensure that it doesn't work "Failed to connect to localhost
    port 2100: Connection refused".
    4. Apply the patch.
    5. Stop and start daemon again.
    6. Check the logs again, there should be no new error there.
    7. Same way do the curl to ensure that this time it listens on that port.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d7066e309efc6f7f8f453533f7d7fcb0774e1b6
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Oct 24 00:54:53 2021 +0200

    Bug 29309: (follow-up) Change 'Pay fines' to 'Pay charges'
    
    Fixes another occurence of the fines to charges.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2a9b4c4ba3fa59fbc3801be43f719f01bb2d312
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 22 18:59:37 2021 -0300

    Bug 29309: Make 'Pay all fines' be 'Pay all charges'
    
    It is not just fines, it is also fees, etc.
    
    To test:
    1. Have a patron with debt
    2. Go to the circulation page for the patron
    => FAIL: There's a button saying 'Pay all fines'
    3. Apply this patch and reload page
    => SUCCESS: The button now says 'Pay all charges'
    4. Enjoy the new terminology
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1622fdf6fb1b14299550ef6e381922452d09899
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 14 12:03:31 2021 +0000

    Bug 29227: Patron messaging preferences digest show as editable but are not
    
    On moremember.pl we load the messaging preferences for display only, we do
    not need to load the JS for editing the preferences
    
    To test:
    0 - Enable EnhancedMessagingPreferences
    1 - Load the detais tab for a member
    2 - Note the digest column in messaging preferences is clickable
    3 - Apply patch
    4 - Reload, it is not clickable
    5 - Confirm editing the patron (or their messaging prefs) works as expected
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a84deb04469b1b8131c3c8007575ae25755858a5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 22 08:19:01 2021 +0000

    Bug 29306: Fix warning on undefined $_ in Holds.t
    
    Use of uninitialized value $_ in concatenation (.) or string at t/db_dependent/Holds.t line 1658.
    
    Results from copying line 70.
    
    Test plan:
    Run Holds.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66683318ff16241952ca5e207ac535f949b3902b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 21 10:31:18 2021 +0000

    Bug 29284: (follow-up) Fix code that I copied from too
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cf301ac6ff5d1d39881fa41f316d3e48c81a2db
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 21 10:26:12 2021 +0000

    Bug 29284: (follow-up) Improve error logging to prevent warns
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8c32b2ccab92ac174a8d7d51ebba13315f574b8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 21 10:08:05 2021 +0000

    Bug 29284: Unit test
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8920e7b1bea0b879679b5353c28fb2849f51655
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 20 12:49:42 2021 +0000

    Bug 29284: Handle the case of an exclamation point in parentheses
    
    This expands the regex to handle this specific case
    
    To test:
    1 - Load record created for last patch
    2 - Note analytics error
    3 - Apply patch
    4 - Restart and reload
    5 - No more errorm also no Analytics link
    6 - Add a 773$t to a record with title used before:
        Digger does it all (not really!)
    7 - reload the initial record
    8 - See 'Show analytics' link
    9 - Click the link
    10 - You should end up on the record you added the 773 to
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0bcbce7673919d3d5174dc44cdca9a33176bbe9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 20 12:46:07 2021 +0000

    Bug 29284: Don't die on analytics searching error
    
    This patch adds an eval around the call to search for analytic records
    It pases a value to the template on the staff side, but logs the warning on
    the opac
    
    This seems similar to 'decoding_error' which is noted on staff side, but absent on OPAC
    
    The eval follows the patter used during searching
    
    To test:
    1 - Add a title to catalog, with 245a:
        Digger does it all (not really!)
    2 - Set searchEngine preference to: Elasticsearch
    3 - The record does not load
    4 - Apply patch
    5 - The record loads, there is a note about analytics at the top fo the record
    6 - View record in opac, no note
    7 - Check logs on intranet and opac, searching error is logged
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 707a01380ca27a8856737e72795ea7d5d8c03b22
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 21 15:33:54 2021 -0300

    Bug 28585: (QA follow-up) Add explicit tests for setting date/date-time attributes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1eb935d0acb88ca0cf824c4e79176e17fa4511b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 21 16:08:19 2021 +0100

    Bug 28585: (QA follow-up) Fix object.t
    
    Object.t was still testing for the return of DateTime objects from
    attributes_from_api. I checked all calls to attrbutes_from_api for
    reliance of DateTime objects and confirmed they all get passed into
    search calls and thus are better served as SQL formatted strings.
    
    I then converted the test to check that the rfc3339 formatted dates
    passed in were converted to strings appropriate for feeding into SQL
    where statements instead.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    JD amended patch:
      FAIL   spelling
        formated ==> formatted
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 538ab104f3287835f40ad496b0c284e675302c39
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 25 11:49:06 2021 -0300

    Bug 28585: (follow-up) Tests for q= supporting date/date-time parameters
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19b781986c89359f2666a4c8e618fa6465f50f60
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 25 11:37:29 2021 -0300

    Bug 28585: Use the datetime_parser for handling API dates
    
    This patchset takes the GET /patrons route as a sample usage for filtering
    on date and date-time (including timestamp) fields.
    
    It then makes Koha::Object->attributes_from_api use the DB storage
    datetime parser for format the parameters correctly.
    
    To test:
    
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: It doesn't find the patron when filtering by date
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: It works now!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90ccfb8f340197029faca349ea175b3870c92137
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 25 09:57:11 2021 -0300

    Bug 28585: Regression tests
    
    This patch adds tests for filtering GET calls with date/date-time
    parameters. Tests fail because the feature is not working
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79960f3c6581390137ee431f00a46e34064e6290
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 19 16:20:19 2021 +0000

    Bug 29278: Fix selector of hint used to show age
    
    This patch modifies the patron entry form to correct a problem with the
    write_age() function introduced by the switch to Flatpickr on this page
    (Bug 28937).
    
    Rather than selecting the element based on the sequence of elements on
    the page, we should add an ID for direct selection.
    
    To test, apply the patch and go to Patrons.
    
    - Locate a patron record which has a date of birth saved.
      - When you open that patron for editing, you should see their age
        displayed below the date of birth input field, e.g. "Age: 23 years 9
        months."
      - Changing the date in the date of birth field should update the age
        string correctly.
    - Go to Patrons -> New patron.
      - The date of birth field should have a hint showing the required date
        format, e.g. "(DD.MM.YYYY)".
      - When you select a date of birth using the Flatpickr calendar the age
        string should be updated correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4cae315940fbda9e2ac2a5f4632861c0615b151
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 15 09:49:19 2021 +0200

    Bug 29270: Remove flatpickr instantiation from request.tt
    
    The JS code is only used when placing a hold for club BUT the date
    inputs are not displayed there.
    
    Test plan:
    Place holds for patrons and clubs and confirm that the two date inputs
    are working correctly
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44ddbf8ec781a08206e43b7202b7c779db310725
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 14 11:36:02 2021 +0200

    Bug 29241: Allow display of past date for .futuredate
    
    When a past date is set for a flatpickr instance with the .futuredate
    class, only dates in the future are available AND the input is blanked.
    It does not display the date in the past.
    
    For instance if a hold is expired (expirationdate in the past), the date input will be blanked.
    
    We can use the flatpickr's allowInvalidPreload option to allow date in the past to be displayed.
    
    Test plan:
    Place a hold
    Edit its expirationdate and set a date in the past (yesterday is fine)
    Go to /reserve/request.pl?biblionumbers=42
    => With the patch you see the date, and the widget let you chose anoter date,
    in the future
    => Without this patch the expiration date is not displayed
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e203730002d88caba5bf5100a4ed662f6c521ad5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 25 13:09:34 2021 +0200

    Bug 19185: Add missing +x on new test files
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39e969f05f7172f522547e041991f58419bdf40b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 20 12:04:25 2021 +0200

    Bug 19185: Split installation and onboarding
    
    The previous installation tests were testing the full onboarding process
    by not selecting all the sample data.
    It would be good to test the whole sample data set.
    
    So there are now 2 files, 00-onboarding.t and 01-installation.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fb71cc8ace277e5613227f9f4bd4d7e86cac556
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 20 11:08:02 2021 +0200

    Bug 19185: DB must exist but empty
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f02a58da9e4a6d8129e619ad805f0c86d9fad217
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 20 10:24:30 2021 +0200

    Bug 19185: Fix language selection
    
    'en' is in an optgroup
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfccfcab02974f56172fa158b06fcea6878c9fe2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Apr 28 16:36:12 2021 +0200

    Bug 19185: Fix tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae7ddc4ab25229d21b99003475954853cf9b0d2d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 4 14:52:44 2018 -0300

    Bug 19185: Add selenium tests for installation and onboarding process
    
    == Test plan ==
    1. Apply the patches (including bug 19821)
    2. restart_all
    3. prove -Mt::lib::Bootstrap t/db_dependent/selenium/00-installation.t
    4. result: Config entry 'database_test' does not exist at
         /home/vagrant/kohaclone/t/lib/Bootstrap.pm line 18
    5. Edit $KOHA_CONF, add a database_test entry identical to database
         You should have:
         <database>koha_kohadev</database>
         <database_test>koha_kohadev</database_test>
    6. restart_all
    7. prove -Mt::lib::Bootstrap t/db_dependent/selenium/00-installation.t
    8. result: Entries 'database_test' and 'database' have the same value in your
         config at /home/vagrant/kohaclone/t/lib/Bootstrap.pm line 20.
    9. Edit $KOHA_CONF, edit database_test with koha_test as DB name
    10. restart_all
    11. prove -Mt::lib::Bootstrap t/db_dependent/selenium/00-installation.t
    12. result: Access denied for user 'koha_kohadev'@'localhost'
           to database 'koha_test'
    13. Connect to the DBMS
    14. Example for koha_testing_docker
          docker exec -it koha_db_1 bash
          mysql -u root --password=password
    15. GRANT ALL PRIVILEGES ON `koha_test`.* TO 'koha_kohadev';
    16. prove -Mt::lib::Bootstrap t/db_dependent/selenium/00-installation.t
    17. result: All tests successful.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9c171c7763adc48c107b9d1b73d8292fc92a23c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 4 14:36:38 2018 -0300

    Bug 19185: Ease elements selection
    
    - The marcflavour select needs an id to be selected easily
    - "Continue to the next step" should be a button (like others)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f22576157f9d94225e642f4fd2ca8822f35d246a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 4 14:44:44 2018 -0300

    Bug 19185: Use submit button if only one exists on the page
    
    During the installation process we do not have fieldset.action, in order
    to not complicate changes we are just going to use the submit button if
    only one exists.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfd25f0ed73f7b7cc14e7abba3cbb55d934eb78c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Nov 2 11:00:01 2018 -0300

    Bug 19821: Require database_test != database
    
    To prevent developpers to drop their database.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f39d287bc480970c641c42cc79f502a8bae41fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 4 14:26:25 2018 -0300

    Bug 19821: Use database_test entry if exists
    
    If the database_test entry exists in the config file we are going to use
    it. This will be a trick for developers and CI
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98c42b8d5acf2a001943705b324bf120aae49338
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 4 14:41:14 2018 -0300

    Bug 19821: Do not modify KOHA_CONF, use new database_test entry instead
    
    I have tried to use the original idea of this patch for bug 19185, but
    it cannot work as it. ENV is not shared between processus and KOHA_CONF
    will not be read by webserver (used for selenium tests).
    
    Moreover on bug 19185 we are testing the installation process and we do
    not want the database to be populated with sample data, we just need a
    new and clean DB.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16442dabd13c612a4f52f6085ae274614368f67b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri May 4 07:41:45 2018 +0200

    Bug 19821: Ignore .proverc and .proverc.dist in Makefile.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d33552f871946a874ff2c912c65a5b12102f841d
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Feb 16 16:00:34 2018 +0100

    Bug 19821: Install sample data, ES mappings and Version syspref
    
    Also move .proverc to .proverc.dist, so it cannot be used by accident.
    
    Different ways to use it:
    
    1/ prove --rc .proverc.dist
       Use defaults
    
    2/ cp .proverc.dist .proverc && prove
       Allows to configure db name, marcflavour, and prove options
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a78c4b45e4654c105d75ec06c978f0c44f722fa2
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Dec 18 09:09:58 2017 +0100

    Bug 19821: Close filehandle after writing
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0308261de6130f7a930249830f78d7914b842e9b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Fri Dec 15 15:18:24 2017 +0100

    Bug 19821: Run tests on a separate database
    
    Running the tests on the same database as the one used for dev has some
    drawbacks:
    - Everybody has different data, so we cannot make any assumptions about
    data in tests and it can make tests fail for non-obvious reasons.
    - Tests have to clean up every change to the database using SQL
    transactions, so we cannot write testable code that use transactions
    (AFAIK)
    - Transactions in tests happen to be committed sometimes, resulting in
    garbage data added to the dev database
    
    This patch provides a .proverc file that will load t/lib/Bootstrap.pm
    before the tests are run.
    t/lib/Bootstrap.pm is responsible for recreating a fresh database and
    telling the test scripts to use it.
    To use it, just run prove normally from the root directory of Koha.
    By default, the database is 'koha_test' and it's created using MARC21
    SQL files, it can be changed by running:
    
        prove --norc \
        --Mt::lib::Bootstrap=database,koha_test,marcflavour,UNIMARC
    
    Test plan:
    1. Apply bug 19185 which will also apply these patches
    2. In the DBMS run `select count(*) from koha_kohadev.borrowers;`
         (adapt if your usual koha DB isn't koha_kohadev)
    3. Run the test plan of bug 19185 and during execution of the
       installation test, pay attention to the following:
    4. List the databases in the DBMS (show databases;) to ensure that
       koha_test is created
    5. After the test has run, the koha_test database should not be here anymore.
    6. In the DBMS run `select count(*) from koha_kohadev.borrowers;`
    7. That was to verify that the database you use usually was untouched.
       The counts should be the same.
    
    Signed-off-by: Jon Knight <J.P.Knight@lboro.ac.uk>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Bouzid Fergani <bouzid.fergani@inlibro.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e88ee4c1c021fc40ead2fdb5b92f346a7512ef9c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 12:20:03 2021 +0200

    Bug 29200: DBRev 21.06.00.036
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2a8f1f426fd40571e0866760fdb5f970782e043
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 13 18:39:36 2021 +0000

    Bug 29231: Add missing Flatpickr to inventory page
    
    This patch corrects a stray instance of the "datepicker" class in the
    inventory template and replaces it with "flatpickr" to trigger a
    Flatpickr.
    
    To test, apply the patch and go to Tools -> Inventory. Check that the
    "Last inventory date" field is a Flatpickr widget.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aaf4d7e0e92c12aad361992707d825a45108b0d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 12:22:14 2021 +0200

    Bug 29052: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecd9bd421ec3a0f7693b0b6ebeaf295896629151
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jul 28 15:12:09 2021 +0000

    Bug 29052: Make consistent use of spans and div with hint class
    
    This patch makes minor HTML corrections to several templates, primarily
    to wrap form help text in <span class="hint"> or <div class="hint">.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    View the following pages to confirm that forms look correct:
    
    - Administration -> Authority types -> Authority type -> Edit.
    - Administration -> Authority types -> Authority type -> MARC structure.
      -> Subfields -> Edit.
    - Administration -> Authorised values -> View category -> New authorized
      value.
    - Administration -> Credit types -> New credit type.
    - Administration -> Debit types -> New debit type.
    - Administration -> Item types -> New item type.
      Also changed: Added link to ITEMTYPECAT authorized value page for
      users with the correct permission.
    - Administration -> MARC frameworks -> MARC structure -> Edit subfields.
    - Administration -> Patron attribute types -> New patron attribute type.
    - Administration -> Share content with Mana KB.
    - Administration -> Z39.50/SRU servers -> New Z39.50 server.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 417f03142aa6b39ae094e7e3e8fd8eb91b73f1ff
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 19 11:08:36 2021 +0000

    Bug 28867: (follow-up) Make error message translatable
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0d11ec2ab1f20bda6445ed853ef15a16618daff2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 12:22:05 2021 +0200

    Bug 28867: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f64cc6b472e94afc7ee1e40ffb1a5555ffba56cb
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 23 16:09:12 2021 +0000

    Bug 28867: Use Bootstrap button menu and modal for adding patrons to lists
    
    This patch reworks the controls for adding patrons to a list from the
    patron search results page. The <select> is converted to a Bootstrap
    dropdown menu, and the list creation form is moved into a Bootstrap
    modal.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - In the staff interface, perform a patron search that will return
      multiple results.
    - In the toolbar at the top of the search results you should see two
      disabled Bootstrap-styled buttons: "Add to patron list" and "Merge
      selected patrons."
    - The "Select all" and "Clear all" links should work to enable and
      disable the toolbar buttons.
    - "Clear all" and then check the checkbox next to one of the results.
      The "Add to patron list" button should be enabled.
    - Check a second checkbox. The "Merge selected patrons" button should be
      enabled.
    - Test the "Add to patron list" button. It should trigger a dropdown
      menu listing existing patrons lists and a "New list" link.
      - Test adding to an exising patron list. It should trigger a message
        at the top of the page which shows a link to that list.
      - Test adding to a new list. It should trigger a Bootstrap modal where
        you can enter the name of the new list.
        - Submitting the list title form should close the modal and trigger
          the display of the message showing how many patrons were added to
          your new list. The link to the new list should be correct.
    - Test the "Merge selected patrons" button. It should send the selected
      patrons to the patron merge screen.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d0ab4f292d128f5fe1ab0315cf8bcbc867afee81
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 11 16:12:29 2021 +0000

    Bug 28084: Standardize: Cardnumber, Card number, Card
    
    This patch modifies templates so that instances of "cardnumber" are
    replaced with "card number."
    
    Some instances where the word "card" is used by itself have been updated
    to "library card" to add some context.
    
    To test, apply the patch and view the following pages:
    
    - Circulation -> Built-in offline circulation interface -> Submit the
      "Check out" form without entering  number. Check the alert message
      which appears.
    - Go to Administration -> System preferences and enable the
      AutoMemberNum system preference and use the BorrowerMandatoryField
      preference to make card number mandatory.
      - Go to Patrons -> New patron. The hint under the "Card number" field
        should refer to "card number" instead of "cardnumber."
    - Go to Tools -> Import patrons.
      - Under the page heading, the note should read "If a card number
        exists..."
      - Under "Field to use for record matching" you should see a "Card
        number" option in the menu.
      - If you try to import a CSV with an invalid card number you'll see an
        error message, "Card number X is not a valid card number."
    - Under Tools -> Upload patron images, check the "image file" radio
      button. The card number field label should read "Enter patron card
      number."
    - Log in to the OPAC as a patron whose card has been marked lost. Try to
      place a hold. You should see a message containing "please take your
      library card to the circulation desk"
      - On the "your summary" page you should see a message, "Your library
        card has been marked as lost or stolen."
      - Try to check out an item to this patron in the self-checkout system.
        You should be shown a message, "This library card has been declared
        lost."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b15842460dfb3d28478bf16723a9ba6f732bb85
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 12:21:54 2021 +0200

    Bug 29244: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b4d9d367ba067f41c9cb9e1c19808b138ca2cb86
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 14 12:45:05 2021 +0100

    Bug 29244: Add dialog class where missing in print-notices.tt
    
    The print notices template had it's own implimentation of a message
    dialog. To make it consistent with other area's, we should add the
    dialog class.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 813ca7369e400af937da95cf6bb66449493070a8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 14 12:43:56 2021 +0100

    Bug 29244: Move message inside dialog and remove width
    
    This patch moves the message css rules inside the dialog ruleset to
    clarify their intention and removes the width so it inherits from the
    dialog class.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d20e800ac29f47daa701e80e1e57beff1958dcf3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 30 13:08:31 2021 +0000

    Bug 16446: (follow-up) Fix translation and adjust radio buttons
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad1d734e548809ab7534545a1b2c7c936ae542eb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 27 12:39:49 2021 +0000

    Bug 16446: Add ability to add patrons to list by borrowernumber
    
    AddPatronsToList already took a borrowernumber parameter, however, it
    did not check if those were valid numbers. This patch expands the search
    to apply to cardnumber or borrowernumbers in the subroutine.
    
    Template and script are adjusted to allow choosing borrowernumbers or cardnumbers
    
    To test:
    1 - Apply patch
    2 - Browse to Tools->Patron lists
    3 - Create a list, or choose Actions->Add patrons for an existing list
    4 - Click 'Add multiple patrons'
    5 - Cardnumbers is preselected
    6 - Enter a list of cardnumbers, ensure you test:
        Cardnumber already in list
        Cardnumber not in list
        Non-existent cardnumber
    7 - Patrons should be added/errors reported correctly
    8 - Repeat with borowernumbers
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5d5623ee26d9fdcee13aea87a2ccbdd01ee7876
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 11:48:14 2021 +0200

    Bug 27287: Add new columns to the table settings yml file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da13a79d57eac0321162116fde3b25cf4d089d9a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 18 11:43:07 2021 +0000

    Bug 27287: (QA follow-up) Unit tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5b6dc9e5bbeea308997546d62e595fe97a4077d
Author: Hayley Pelham <hayleypelham@catalyst.net.nz>
Date:   Tue Aug 10 10:54:09 2021 +1200

    Bug 27287: Make note fields from orders history searchable
    
    This patch adds aqorders.order_internalnote and
    aqorders.order_vendornote to the Acquisitions history search.
    
    To test:
    1) Apply patch and restart services
    2) Create an order in Acquisitions and set an internal note and a vendor note
    3) Go to /cgi-bin/acqui/histsearch.pl and search by internal or vendor
    note using the terms you set in step 2
    4) Note your order is returned and internal note and vendor note are
    included in the search results at the end of the table
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Wuerttemberg
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02ebc90e4b1e0f59a2d64204da0054e4c3b55dde
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 11:46:07 2021 +0200

    Bug 29298: Add 'Managing library' column to table settings for histsearch
    
    Bug 14669 added the column to the table but forgot to add it to the
    table settings yml file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1d2b148e16b3240aa241a5c97450e758e8f0aecb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 11:34:36 2021 +0200

    Bug 29200: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52fdbd9d6bcf44bcc9c3f98e62eeb030c3ccdc27
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 19 16:33:30 2021 +0200

    Bug 28180: Remove adlibris conflict
    
    Can be squashed when pushed
    Edit from RM before push: too many conflicts!
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1916c644808577beb3170d642f93b456bfcc5c56
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 13 00:08:35 2021 +0200

    Bug 28180: Fix bug with first image does not exist
    
    This was first written for Adlibris, before its removal from the
    codebase.
    But this patch maybe still be useful for other services (if first and no image).
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 819095aa219cfc721f2892fcc3b8bc12c10542db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 16:35:42 2021 +0200

    Bug 28180: Correctly guess if images have been loaded
    
    window.load won't assure us that the images loaded using JS code are
    correctly loaded.
    
    This patch adds a flag to the different providers when the images are
    fully loaded.
    
    Note that the img.naturalHeight check is not working for google jackets
    and is actually not needed (test with a bib record with and without
    google jacket and confirm that it's working as expected).
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 974524b2e52b150493e0d25a53ef9634d12a8ff4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 13:58:54 2021 +0200

    Bug 28180: Fix collision with existing verify_images
    
    At the OPAC we already had a verify_images JS function in amazonimages.js
    It's preferable to use another function name.
    This patch replace our verify_images with verify_cover_images and apply
    the change to the staff code as well.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c19e9f562cd8973d2031d5772b3c5bb13e24d10c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 14:46:29 2021 +0200

    Bug 28180: Fix some non-translatable strings
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 00e09e3f96d86560ce9d1ca6afa718632680b4dd
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 10 18:21:14 2021 +0000

    Bug 28180: (follow-up) Updates to styling of lightbox controls
    
    This patch adds style changes like the ones made in Bug 28179. It also
    addresses a bug with the way the verify_images() function was firing.
    I've moved the function outside of document.ready() and added a call to
    it on window load, consistent with how it works in the staff client.
    
    I've removed a redundant call to verify_images() from the footer include
    file, opac-bottom.inc.
    
    The cosmetic changes replace the Chocolat image icons with new SVG
    assets based on Bootstrap Icons (https://icons.getbootstrap.com/). The
    color changes I think help the controls to be more visible.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1273921e45d2f56b3b5a1db53208de793adf10d1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 09:15:22 2021 +0200

    Bug 28180: Restore NO_LOCAL_JACKET
    
    This is a patch to squash. No idea what it got removed previously
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f90078d56045d2e448d507236dc869740094a8c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 10 09:12:07 2021 +0200

    Bug 28180: (follow-up) Remove console.log
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 607eae9f7994b3de24ec8536c210b86ef35e613b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 20 15:50:02 2021 +0200

    Bug 28180: Bug fix - cannot select cover-nav button when on top of the .contentblock
    
    Found a bug and ended up with this solution, suggestions welcomed!
    
    example with OpenLibrary with isbn=9780670026623, the image is a bit
    higher than others and then the cover-nav buttons are on top of
    .contentblock and cannot be clicked
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75604c959b6b56ec1d30d6382f5de96124ea5a3a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 20 15:32:42 2021 +0200

    Bug 28180: Reintroduce and adjust Baker and Taylor
    
    Test plan:
    1. Turn on BakerTaylorEnabled and fill BakerTaylorUsername/BakerTaylorPassword (if you don't have, ask me)
    2. Display the cover images in the gallery
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 112168cfd5b59b6a18b6b4a72bbb475983165a32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 20 14:41:34 2021 +0200

    Bug 28180: Reintroduce and adjust OpenLibrary
    
    1. Turn on OpenLibraryCovers
    2. Display the cover images in the gallery
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 511720999af2a231a66ecde5b4be36212d628394
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 20 14:08:01 2021 +0200

    Bug 28180: Reintroduce and adjust Google Jackets
    
    Test plan:
    1. Turn on GoogleJackets
    2. Display the cover images in the gallery
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca25ef96737540c0fb66e48f87f0e3c16bb0b554
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 20 12:06:33 2021 +0200

    Bug 28180: Reintroduce and adjust Syndetics
    
    Test plan:
    1. Enable SyndeticsEnabled and SyndeticsCoverImages
    2. Display the cover images in the gallery
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fad97080e97da5bc77724c68b9394aba15518847
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Apr 20 09:26:43 2021 +0200

    Bug 28180: Add a lightbox gallery to display cover images - detail page, OPAC interface
    
    This patch is the OPAC version of
      Bug 28179: Add a lightbox gallery to display cover images - detail page, staff interface
    
    But there were several difficulties as the staff and OPAC code diverged
    a lot.
    First we are going to apply the different enhancements that have been
    made staff-side:
    - Display all the local cover image on the bibliographic detail pages
    (before this patch only the first one was displayed)
    - The slider functionality added by bug 25031
    
    Test plan:
    All the cover images are affected, all the different sources will be
    tested.
    All the steps will be done on the same bibliographic record.
    1. Local cover images
     a. Turn on OPACLocalCoverImages and AllowMultipleCover
     b. Add several local cover images to a bibliographic record
     c. Add several local cover images to an item
     d. Click on an image and confirm that it is displayed in a gallery and
     you can navigate see all the images attached to the bibliographic
     record
     e. Same for items
    2. Adlibris
     a. Turn on AdlibrisCoversEnabled
     b. Edit the biliographic record and add an ISBN that will return a
     cover image for this service (9780670026623 for instance)
     c. Display the cover images in the gallery
     d. Note the link to the adlibris.com website at the bottom
    3. Amazon
     a. Turn on OPACAmazonCoverImages
     b. Display the cover images in the gallery
    4. Coce
     a. Turn on OpacCoce, set CoceHost to "http://coce.tamil.fr:8080"
     and select some values for CoceProviders.
     b. Display the cover images in the gallery
    5. Custom cover images
     a. Turn on OPACCustomCoverImages and set CustomCoverImagesURL to https://covers.openlibrary.org/b/isbn/{isbn}-M.jpg
     of anything else meaningful
     b. Display the cover images in the gallery
    
    QA Note: Other sources have been removed by this patch but will be
    re-added by follow-ups
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e309857d2fe1d6947f39d265190a239df39b5a9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Apr 19 14:31:53 2021 +0200

    Bug 28180: Add Chocolat to OPAC
    
    See Bug 28179: Add the Chocolat gallery lightbox JS library
    
    Sponsored-by: Gerhard Sondermann Dialog e.K. (presseplus.de, presseshop.at, presseshop.ch)
    
    Signed-off-by: Rasmus Leißner <rasmus.leissner@solutions-factory.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e94e4476f126e131bd343c0a3524f9a093784bc8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 12 15:31:46 2021 +0000

    Bug 29200: Remove Adlibris cover service
    
    This patch removes integration of the Adlibris cover service which has
    been discontinued.
    
    To test, apply the patch and rebuild the OPAC and staff interface CSS:
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Run the database update.
    - Go to Administration -> System preferences -> Enhanced content. You
      should see no Adlibris-related preferences.
    - Perform a catalog search and confirm that the search result and detail
      pages look correct.
    - Enable one or more other cover image services and test that search
      results and detail page look correct.
    - Perform the same test in the OPAC including these pages:
      - Catalog search results
      - Bibliographic detail page
      - Lists
      - Comments
      - User summary
      - User reading history
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a11acbe347065b0d938a4e0adff6bdebc052a26a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 21 10:03:30 2021 +0000

    Bug 29271: (follow-up) Remove changes to accounts.inc
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 73a541e19c535cc6629e9b6dbac7598f8d434db1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 11 18:09:27 2021 +0000

    Bug 28079: Set focus to search box field when adding an order to basket
    
    This patch modifies the "Add to basket" modal in acquisitions so that
    focus is automatically moved to the first form field when the modal
    appears.
    
    The patch also corrects the modal markup so that it's more consistent
    with default Bootstrap markup.
    
    To test, apply the patch and go to Acquisitions.
    
    - Search for a vendor and, if necessary, create a basket.
    - Click the "Add to basket" button. The modal which appears should
      have a header reading "Add order to basket <basketname>"
    - The form field should have cursor focus.
    - View the basket and click the "Add to basket" button in the toolbar.
    - The modal shown should also be correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0725b12a8d29cc91253b2ce5a78711010822389
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Fri Oct 15 10:03:52 2021 -0400

    Bug 29216: Correct --where documentation in update_patrons_category.pl
    
    This patch removes two misleading examples of the --where parameter
    documentation in update_patrons_category.pl
    
    To test:
    
    1. Apply patch
    2. In your favourite text editor, open misc/cronjobs/update_patrons_category.pl
    3. Look for the documentation for the --where parameter (around line 133 or so)
    4. Make sure the examples and their explanations make sense
    5. Sign off :)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 751cae0ef8214343379aaf5d8991bd11f8f00905
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 14 12:28:30 2021 +0000

    Bug 29225: Don't hide subgroup filter on pag load
    
    When we auto select the last used tab, we hit code that hides the Subgroup
    dropdown
    
    Clicking to other tabs shows the dropdown again
    
    There is code on the tab selection to hide subgroups on the 'All' tab,
    the other line seems superfluous
    
    To test:
    1 - Create a report and assign a group and subgroup, creating if necessary
    2 - Browse to "Reports->Use saved"
    3 - Click on the tab for the report you just created, see the subgroups dropdown
    4 - Reload the page, Subgroups dropdown disappears
    5 - Apply patch
    6 - Relaod the page
    7 - It's back!
    8 - Confirm dropdown filters as expected
    
    Signed-off-by: Donna <donna@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85f6781562ef4cbe13eb0d94b97bddd4897f11f5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 10:19:55 2021 +0200

    Bug 29279: Use class for targets
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e1b1f3d156dc2a7f11fe3d349d1802cbbf2a388
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 19 16:47:50 2021 +0000

    Bug 29279: Don't sort holds ratio numeric columns as 'natural'
    
    TO test:
    1 - Place a variety of holds on some records
    2 - Place more holds on records with low biblionumbers and less on ones with high biblionumbers
    3 - Go to Circulation->Holds ratios
    4 - Set the ration to 1 and load the report
    5 - Sort by the 'Holds ratio' column and note it is incorrect
    6 - Apply patch
    7 - Confirm sort works correctly on first three columns and call numbers column
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0af6f31dbef58d6d72b0c71a81a6a30e1d093d10
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 20 14:06:29 2021 +0000

    Bug 29271: (QA follow-up) Fetch and send descriptions to template
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 388611ef78b27e376765b5fef5c94254c773d60e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Oct 19 21:09:00 2021 +0000

    Bug 29271: (QA follow-up) Add missing filter
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b29a7148a9123fec08277d91ba7c2d4a75c34db6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 19 13:03:07 2021 +0000

    Bug 29271: Fix cash register report results
    
    This patch changes accounts.inc to use the credit/debit type codes directly
    rather than needlessly fetching the credit_type/debit_type object jsut to get
    the code. This allows the BLOCK to work on non-object lines
    
    We also only pass a debit or credit type to csv (accountline cannot be both)
    
    empty-line.inc is also removed in favor of correcting the markup
    
    one more column added to total line
    
    To test:
    1 - Add some debits and credits to accounts
    2 - Browse to Reports->Cash register
    3 - Select transaction type 'All transactions'
    4 - Output to screen
    5 - Run report
    6 - Note transaction types column is empty
    7 - Output to a file
    8 - Run report
    9 - Open file and note:
          amount column is out of place
          extra line before total
    10 - Apply patch
    11 - Repeat and note display and export are correct
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 515a596fb95751d8cb1fb890b45e5112487e0dd4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 19 10:34:38 2021 +0000

    Bug 25030: (QA follow-up) Fix tests
    
    Fluid is not a valid value for cxn_pool - valid values are:
    Sniff,Static,NoPing
    
    AddAuthority call calls index - the indexing call was trying to access
    the ES server with mocked values and dying when they were invalid
    
    This patch uses a correct value for cxn_pool and inserts directly into DB
    to avoid indexing
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df63fe79e0e4cff1dac624e53b21c661c84fd41c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 18 11:09:00 2021 +0000

    Bug 25030: (QA follow-up) Add POD
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c0d09e9936c318acc6809d0c54f277565749f95
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Nov 10 15:22:21 2020 +0100

    Bug 25030: Implement IncludeSeeFromInSearches with Elasticsearch
    
    Test plan:
    1. Create an authority with at least a 1XX$a and a 4XX$a, for instance:
        100 $a Foo
        400 $a Bar
    2. Create a biblio and add a link to this authority using the
       cataloguing plugin
    3. Disable syspref IncludeSeeFromInSearches
    4. Reindex the biblio. You should be able to find it when searching
       'Foo' but not when searching 'Bar'
    5. Enable syspref IncludeSeeFromInSearches
    6. Reindex the biblio. You should be able to find it when searching
       'Foo' and also when searching 'Bar'
       without the patch, 'Bar' doesn't yeld results. With it, it does.
    7. prove t/db_dependent/Koha/SearchEngine/Elasticsearch.t
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Lucy Vaux-Harvey <lucy.vaux-harvey@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5da108e350455e24c49dfd5679cc6d2f105b5f6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 19 11:50:37 2021 +0200

    Bug 29215: (bug 3137 follow-up) Fix guarantor block toggle
    
    The guarantor template must be kept hidden, always.
    
    Test plan:
    
    Edit a patron with a guarantor, click the legend of the "patron
    guarantor" block and confirm that the template is not shown
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47528bffe26123b8d78d2639b71947a849e6d92b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 18 11:05:18 2021 +0200

    Bug 29261: (bug 15812 follow-up) Fix translation issue in include file
    
    Strings must be surrounded by double quote or it wil break the translate
    script.
    
    Without this patch you get:
      5  "dt_name":
      6  "<a %]\"="%]\""
    in the translated template and the UI explodes with "Template process
    failed: file error - parse error"
    
    Test plan:
    Apply this patch, update PO files for a given language, translate
    "View". Search for something like:
      msgid "\\\"View\\\""
      msgstr "\\\"Näytä\\\""
    Remove fuzzy.
    Install the language and search for patrons
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4aaf383e527ff4b165696e8dd982daf82abb6ff2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 19 11:39:48 2021 +0200

    Bug 29221: Correctly display refund info
    
    2132             $messages->{'LostItemFeeRefunded'} = $updated_item->{_refunded};
    
    But, in returns.pl:
    495     elsif ( $code eq 'LostItemFeeRefunded' ) {
    496         $template->param( LostItemFeeRefunded => 1 );
    497     }
    
    1. Set BlockReturnOfLostItems to 'don't block'
    2. Make sure your 'Default lost item fee refund on return policy' circ rule is set to 'Leave lost item charge'
    3. Check something out and then mark it as lost.
    4. Check the item in
    => No message to tell there was a refund
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d858dc8ea95dd5ddcaa98f9f69a537c115cca0a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 21 09:56:29 2021 +0200

    Bug 17600: Fix imports for svc/letters/preview
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c4fa7d82df150c11b35dc4c8a3a5f34e147198a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 19 09:46:32 2021 -0300

    Bug 28211: (QA follow-up) Test for hook calls properly
    
    Some warnings, that mean a hook has been called were not tested.
    This patch adds those tests, and does some tidy also.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c290ae7e0edf3f30241adb08ad222a6aa7ecb10c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Oct 19 11:28:40 2021 +0000

    Bug 28153: (follow-up) Ensure update is idempotent
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6d635ec8630f943070e9e6fcdbebc5fe5ff10a4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 19 09:57:26 2021 +0200

    Bug 29240: Rename start_for with date_to
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3d0c08ce52c2a71c845cbc25eaf19cf208485f0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 14 17:05:07 2021 +0000

    Bug 29240: (follow-up) Correct more instances
    
    This patch fixes linked date fields in these pages:
    
     - Reports -> Patrons with the most checkouts
     - Reports -> Patrons statistics wizard
     - Reports -> Most-circulated items
     - Reports -> Catalog statistics wizard
     - Reports -> Guided reports
     - Reports -> Average loan time
     - Reports -> Holds statistics wizard
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30196fcdf3f5d726ad79c4f8983b17e9ad06b46a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Oct 14 15:06:30 2021 +0100

    Bug 29240: Centralise from/to handling
    
    This patch moves to using a data-start_for attribute to point the 'from'
    flatpickr to the 'to' flatpickr.
    
    We also fix the date validation issue in the onClose handler inline.
    
    Test plan.
    1. Check that the from/to datpicker combinations work on each of the
       changed pages.
    2. Look at the console for errors, there should be none
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 12436073165355e76fac83de9b2a001435f52691
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 13 18:27:17 2021 +0000

    Bug 29233: Correct missed jQueryUI datepicker in serials search sidebar
    
    This patch fixes the serials search sidebar so that the "Expires before"
    field uses Flatpickr instead of jQueryUI datepicker.
    
    To test, apply the patch and go to Serials. Perform a subscription
    search which will return multiple results.
    
    In the sidebar, test that the "Expires before" field uses a
    Flatpickr widget and works correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e0d86da7eb23427005ac53a67200f9d2106bc09
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 13 17:58:58 2021 +0000

    Bug 29232: Clean up obsolete jQueryUI datepicker code from cash register stats template
    
    This patch removes some jQueryUI datepicker code from
    reports/cash_register_stats.tt which was left behind by Bug 28949.
    
    To test, apply the patch and go to Reports -> Cash register statistics
    wizard. The "From" and "To" date fields should work correctly, since
    Flatpickr code is unchanged.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1de9d530f4dd5eac831e9026e9a43b6a2606f5b0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 18 14:53:05 2021 +0200

    Bug 29263: (bug 24387 follow-up) Fix 'Cancel' link when editing a html custom
    
    When editing content that is a html customization, the 'cancel' link
    should redirect to the html custom list, not the 'news' list.
    
    Test plan:
    Create or edit a html customization, click the 'Cancel' link
    => You should be redirected to the html custom list
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1021b1dc887b61dcac2c02330cbd9269819b28ef
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Oct 15 17:05:42 2021 +0000

    Bug 29153: Fix CodeMirror textareas to work with all languages
    
    To test:
    1. Go to Tools > HTML customizations
    2. Open or create a new entry with CodeMirror. ( Edit with text editor )
    3. CodeMirror doesn't work, notice a console error.
    4. Apply patch
    5. Try steps 1 & 2 again. The CodeMirror editor should now load.
    6. Make sure it works in both the Default and English(en) tabs.
    7. BONUS: install some other language packs and look at the tabs for that language, it should still work.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 78db69fb569b0cf16656fcf092d8025df64fe943
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Aug 22 04:07:02 2021 +0000

    Bug 20277: Improve 773 link when $a is present
    
    At the moment $t (Title) and $a (Main heading - author) are both
    searched in ti,phr, which sometimes may work, as ti contains the
    full 245 field, including $c with author information. But often
    $c will not match what is in 100$a, so the search fails.
    
    This splits the search string so we search for $t in with ti,phr
    and for $a in au.
    
    To test:
    - Make sure UseControlnumber is deactivated
    - Search for a record with an author in 100 in your catalog
      Example from sample data: Programming Perl / Tom Christiansen, Brian D. Foy & Larry Wall.
    - Add a child record using New > Add child record
    - Verify that in 773 $a and $t are filled in
    - Complete mandatory fields and save the record
    . In OPAC and staff interface:
    - Verify the link in the detail page is doing a search with ti,phr
    - Verify the link works/doesn't work (more likely the latter)
    - Apply patch
    - Verify the link has changed and (now) works
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcb0dfd8adb4061dfd9886b3c4c98fd862a8b5fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 18 11:50:11 2021 +0200

    Bug 29254: Fix date formatting on the additional contents form
    
    We are sending ymd but flatpickr is expecting a 'dateformat' formatted
    date.
    
    Test plan:
    Create a new content, set a date, save, edit again
    => The date must be displayed correctly
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca55dc3e42c77f41f8c0cf66e6db9aeda4e66842
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 8 15:57:31 2021 +0200

    Bug 29020: Add link on the admin module
    
    It works! P1 and P2 are inverted in the test plan, but
    the principle that user with manage permission accesses
    bg jobs from the admin page and user who do not only
    have access through main page is there.
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fde5d5f7019728f56a8e16433e52c17dd021dffa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 8 15:53:02 2021 +0200

    Bug 29020: Add link on the mainpage for users without admin access
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddef2c6a0d727feaf2c1c92e19ff5e6ef7e19ab1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 19 09:25:25 2021 +0200

    Bug 28211: Fix test
    
        #   Failed test 'Plugin enabled, route defined'
        #   at t/db_dependent/Koha/REST/Plugin/PluginRoutes.t line 125.
        # Looks like you failed 1 test of 2.
    
    105         $good_plugin = $plugin
    106             if $plugin->{metadata}->{description} eq 'Test plugin';
    
    The wrong plugin was considered the good one.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9151d4c1d182a58ac3c3ec38538b009c8b1b88a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 18 11:27:18 2021 +0200

    Bug 28153: DBRev 21.06.00.035
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ec37d89a6f6f988448abd2a43ce23d812d46380
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 15 15:02:50 2021 +0000

    Bug 28153: (follow-up) Add installer files and update atomicupdate
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a37bee664747ebc984cd9e450e8223dad807138f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Apr 15 13:26:55 2021 +0000

    Bug 28153: Add 'Hold reminder' messaging preference
    
    This adds a new preference for patrons to choose how they wish to receive
    'Hold reminder' notices.
    
    The notice is always digested per branch
    
    To test:
     1 - Apply patches
     2 - Update database
     3 - Ensure EnhancedMessagingPreferences and EnhancedMessagingPreferencesOPAC are enabled
     4 - View a patron and note new messaging preference
     5 - Confirm same on the opac for a patron account
     6 - All transports should be disabled by default
     7 - Place a hold for the patron and check it in to confirm
     8 - Run hold reminder script
        perl misc/cronjobs/holds_reminder.pl -v -c
     9 - No message should be queued for patron
    10 - Enable the message in a transport for which 'HOLD_REMINDER' notice has content for the patron
    11 - Run the script
    12 - Patron should have a message queued
    13 - Ensure a different transport has content for the notice
    14 - Run the script forcing a transport
       perl misc/cronjobs/holds_reminder.pl -v -c -mtt=print
    15 - The patron should have a message queued in the forced transport
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8e9ee22dc5e36096dca4e3ff480bf8e47f67511
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 18 11:26:32 2021 +0200

    Bug 28831: DBRev 21.06.00.034
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c023f257b50eec2c6300d35733ac511a90b039f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 9 09:18:01 2021 +0000

    Bug 28831: Add the new group by substatus-block
    
    Test plan:
    Change OPACResultsUnavailableGroupingBy to substatus.
    Verify the result on opac results. (You need a few unavailable items
    with different statuses on a few branches.)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b217eab28e442d8d54cd49d860572c474ed2d44f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 9 08:56:07 2021 +0000

    Bug 28831: Add choose/when, and change indentation
    
    As a first step:
    [1] Add the new pref OPACResultsUnavailableGroupingBy in the xslt,
        and pass it via C4/XSLT.
    [2] Add a choose/when construction in the third part of Availability.
    [3] Add indentation (8 spaces) of the inner block handling group by branch.
    
    Test plan:
    Make sure that OPACResultsUnavailableGroupingBy eq branch.
    Verify that OPAC results are still untouched.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b34bb8fc62d4a46fae3dd1337224492ac539d44f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 9 09:37:50 2021 +0000

    Bug 28831: Database revision, add new preference
    
    The preference OPACResultsUnavailableGroupingBy allows you to
    group unavailable items by substatus, only showing item counts, on
    the OPAC XSLT results.
    
    This is meant to be useful for larger consortia.
    
    Test plan:
    Run dbrev.
    Check new pref on Admin, preferences, OPAC tab.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 71914b14d17420e1640feadca8088cb9847de7e6
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Oct 14 11:57:55 2021 +0000

    Bug 28211: (QA follow-up) Add unit tests
    
    JD amended patch: typo multipled ==> multiplied
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7acb5eaadc7594dfb1c6744a86eff39d110f7e1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 8 07:00:10 2021 +0000

    Bug 28211: (QA follow-up) POD changes
    
    [1] Resolving qa warn on POD coverage.
    [2] Adding a line about the passing refs-tric.
    [3] Removing an outdated line on available methods.
    [4] Removing POD section for after_hold_create. Strayed.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6cf8bcef44a363755eae07f08abd8b1c635e7057
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 8 06:51:03 2021 +0000

    Bug 28211: (QA follow-up) Remove test_call_recursive
    
    Obsoleted now.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18c15007725e88ffeb79f5d17dd3d3c4f7e978d8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Apr 23 11:53:51 2021 -0400

    Bug 28211: Replace use of call_recursive() with call()
    
    This is based on Julian's idea on bug 28026 where we could get rid of call_recursive by passing refs as arguments to call.
    
    Test Plan:
    1) Apply this patch
    2) prove t/db_dependent/Koha/Plugins/Plugins.t
    3) prove t/db_dependent/Koha/Plugins/Barcode_transform_hooks.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b271e9f9db4f1d6187d2693fabcd6c0dafec510c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 30 14:19:02 2021 +0200

    Bug 28785: Don't send SessionRestrictionByIP to template
    
    It's not used.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1a216186ff97c292ef6292cd98572015cc7c5a32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 11:28:38 2021 +0200

    Bug 28785: Add skip_version_check for checkauth
    
    We could have this patch but we also could decide to skip it. The idea
    is to avoid 2 checks of the version when we are coming from checkauth.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4390b7be0440749aba111cd27de343a9c86d9564
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 11:16:40 2021 +0200

    Bug 28785: Adjust check_cookie_auth calls
    
    The previous patch makes check_cookie_auth return the session instead of
    $sessionID, so we are adjusting the different calls to prevent
    confusion.
    However they are mainly used to check the authentication status and
    don't care about this second variable.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6545259bbf8a8683ade45c65aa57a00a8981fbae
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 11:03:46 2021 +0200

    Bug 28785: Centralize cookie auth check in check_cookie_auth
    
    This code is duplicated in 3 different places, we must call
    check_cookie_auth instead.
    
    It makes check_cookie_auth returns a 'restricted' when
    SessionRestrictionByIP is set and the IP changed.
    It also returns a third parameters contained the old and new IP, to fill
    the "info" hash in checkauth but apparently the oldip and newip
    variables are not even used from the template. We may want to remove it
    completely.
    
    No change is expected with this patch, the different authentication
    methods should still work as before.
    
    Test plan:
    Log in the staff and OPAC interfaces, logout.
    Log in and call script that call the 3 different subroutines modified by
    this patch. For instance you can list checkouts (that is using
    check_cookie_auth) and display a patron's image (using check_api_auth).
    
    QA with good knowledge of the C4::Auth module and the different
    authentication methods is required.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1255838f8d7640bb4cff9b02a1ae57a26a9de138
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 7 13:48:55 2021 +0000

    Bug 27949: (QA follow-up) Remove TODO
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1616354981c00b9b7e9a5aeb75d17a065706f545
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Jun 3 17:41:22 2021 -0300

    Bug 27949: Allow multiple article requests print slip
    
    This bug allows for batch printing of multiple article requests slips
    
    To test:
    1. apply this patch
    2. restart_all
    3. enable ArticleRequests preference
    4. create multiple article requests
    5. go to circ/article-requests.pl in staff interface
    6. print a single slip from a row
    CHECK => it works as expected
    7. select all rows and print slip from general actions menu (above the table)
    SUCCESS => all article requests slips are printed
    8. select multiple rows (not all) and print slip from general actions menu (above the table)
    SUCCESS => only selected article requests slips are printed
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: Perltidy!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66a01d4b47e8e9ce14932a4c28c18f1ef358a6c4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 14 11:30:21 2021 +0000

    Bug 29243: Correct call when adding items from staged records
    
    To test:
    1 - Populate system preference  NewItemsDefaultLocation
    2 - Stage a file of marc records
    3 - Create an acquisitions basket with 'AcqCreateItems' set to 'ordering'
    4 - Attempt to add to basket from your staged file
    5 - You get a 500 error, and in the logs:
        Can't use string ("") as a HASH ref while "strict refs" in use at /usr/share/koha/lib/C4/Items.pm line 1605.
    6 - Apply patch
    7 - Repeat #4
    8 - Success!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31c2bfae5fc6056acd422ceeb87ab96a50dae23c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 15 16:40:54 2021 +0000

    Bug 28445: (follow-up) Display count of modified items when too many to display
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95fd884441765eeb2fe5a56ad9eb729c9eb1df9a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 17:51:52 2021 +0200

    Bug 28445: Split and join on ' | ' instead of '|' for repeatable
    
    Is that correct?!
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c048faac3f4af3e305c565e4d0a0b1a46fbbdd53
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 17:27:23 2021 +0200

    Bug 28445: Respect MaxItemsToDisplayForBatchMod from job detail view
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef09becd108feee08ae686d663464429f03aa2ec
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 17:18:38 2021 +0200

    Bug 28445: delete_biblios is a boolean
    
    Will fix:
    Batch deletion failed: Cannot enqueue this job. (The error was: Can't use string ("on") as an ARRAY ref while "strict refs" in use at /kohadevbox/koha/Koha/BackgroundJob/BatchDeleteItem.pm line 214. , see the Koha log file for more information).
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac90166f4596d0c06480809b733ae3c831007733
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 11 16:26:12 2021 +0200

    Bug 28445: Don't surround the whole batch with a transaction
    
    It makes more sense to commit when an item has successfully been modified and
    so move the transaction inside the loop.
    
    It also fixes the progress of the whole job.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8943451f855a3fd7a60ca9d2b7a0a47db4740678
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 11 15:46:05 2021 +0200

    Bug 28445: Fix subfields to blank
    
    The value of the checkbox was not correct
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd7641b2c860ce18242ce6301949342ce72d9833
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 15:45:17 2021 +0200

    Bug 28445: Improve robustness of tests
    
    * Libraries are ordered by name by default but if others have been added
    the test may fail
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30235697fec467e9d231801cd2b90fc91d594cd7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 28 09:46:45 2021 +0200

    Bug 28445: Don't display the items if not finished yet
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 508ef298f76886fb4bae73a28d6e3ca7ca2b2831
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 27 18:19:18 2021 +0200

    Bug 28445: Fix encoding issue with the background job's report
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e18b9403c8809f91e50a441ab8bb863908cf69d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 27 15:29:38 2021 +0200

    Bug 28445: UI change for repeatable and regex
    
    This patch applies the changes describe in the main commit message about
    the "limitation" and "the behaviour in master was buggy".
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 424aca3d5605470087c06c6e567f6df8775aa8be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 27 11:05:54 2021 +0200

    Bug 28445: Use the task queue for the batch delete and update items tool
    
    Here we go!
    
    Disclaimer: this patch is huge and does many things, but splitting it in
    several chunks would be time consuming and painful to rebase. However it
    adds many tests and isolate/refactor code to make it way more reusable.
    
    This patchset will make the "batch item modification" and "batch item
    deletion" features use the task queue (reminder: Since bug 28158, and so
    21.05.00, we do no longer use the old "background job" functionality and
    the user does not get any info about the progress of the job).
    
    More than that, more of the code to build an item form and a list of
    items is now isolated in module (.pm) and include files (.inc)
    
    We are reusing the changes made by bug 27526 that simplifies the way we
    edit/create items (no more unecessary serialization Koha > MARC > MARCXML
    > XML > HTML)
    
    New module:
    * Koha::BackgroundJob::BatchDeleteItem
        Subclass for process item deletion in batch
    * Koha::BackgroundJob::BatchUpdateItem
        Subclass for process item modification in batch
    * Koha::Item::Attributes
        We needed an object to represent item's attributes that are not
        mapped with a koha field (aka "more subfields xml")
        This module will help us to create the marcxml from a hashref and the
        reverse.
    * Koha::UI::Form::Builder::Item
        The code that was used to build the add/edit item form is
        centralised in this module. In conjunction with the
        subfields_for_item BLOCK (from html_helpers.inc) it will be really
        easy to reuse this code in other places where the item form is used
        (acquisition and serials modules)
    * Koha::UI::Table::Builder::Items
        Same as previously for the table. We are now using this table from 3
        different places (batch item mod, batch item del, backgroung job
        detail view) and the code is only in one place.
        To use with items_table_batchmod BLOCK (still from html_helpers.inc)
    
    This patch is fixing some bugs about repeatable subfields and regex. A UI
    change will reflect the limitation: if you want to apply a regex on a
    subfield you cannot add several subfields for the same subfield code.
    
    Test plan:
    
    Prepare the ground:
    - Make sure you are always using a bibliographic/item record using the framework
    you are modifying!
    - Add some subfields for items that are not mapped with a koha field
    (note that you can use 'é' for more fun, don't try more funny
    characters)
    - Make some subfields (mapped and not mapped with a kohafield)
    repeatable
    - Add default values to some of your subfields
    
    There are 4 main screens to test:
    1. Add/edit item form
    The behaviour should be the same before and after this patch.
    See test plan from bug 27526.
    Those 2 prefs must be tested:
        * SubfieldsToAllowForRestrictedEditing
        * SubfieldsToUseWhenPrefill
    
    2. Batch modification
    a. Fill some values, play with repeatable and regex.
    Note that the behaviour in master was buggy, only the first value was modified by the regex:
        * With subfield = "a | b"
        1 value added with "new"
        => "new | b"
    
        * With subfield = "a | b"
        2 new fields "new1","new2"
        => "new2 | b"
    
    Important note: For repeatable subfields, a regex will apply on the subfields in
    the "concatenated form". To apply the regex on all the different subfields of a given
    subfield code you must use the "g" modifier.
    This could be improved later, but keep in mind that it's not a regression or behaviour
    change.
    
    b. Play with the "Populate fields with default values from default framework" checkbox
    
    c. Use this tool to modify items and play with the different sysprefs that
    interfer with it:
        * NewItemsDefaultLocation
        * SubfieldsToAllowForRestrictedBatchmod
        * MaxItemsToDisplayForBatchMod
        * MaxItemsToProcessForBatchMod
    
    3. Batch deletion
    a. Batch delete some items
    b. Check items out and try to delete them
    c. Use the "Delete records if no items remain" checkbox to delete
    bibliographic records without remaining items.
    d. Play with the following sysprefs and confirm that it works as
    expected:
        * MaxItemsToDisplayForBatchDel
    e. Stress the tool: Go to the confirmation screen with items that can be
    deleted, don't request the job to be processed right away, but check the
    item out before.
    
    4. Background job detail view
    You must have seen it already if you are curious and tested the above.
    When a new modification or deletion batch is requested, the confirmation
    screen will tell you that the job has enqueued. A link to the progress
    of the job can be followed.
    On this screen you will be able to see the result of the job once it's
    fully processed.
    
    QA notes:
    * There are some FIXME's that are not blocker in my opinion. Feel free to
    discuss them if you have suggestions.
    * Do we still need MaxItemsToProcessForBatchMod?
    * Prior to this patchset we had a "Return to the cataloging module" link
    if we went from the cataloguing module and that the biblio was deleted.
    We cannot longer know if the biblio will be deleted but we could display
    a "Go to the cataloging module" link on the "job has been enqueued"
    screen regardless from where we were coming from.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b52c7d7b3664b81b41bade88cbb3491dcdb81693
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 20 17:44:20 2021 +0200

    Bug 28445: Start form with empty library for batch mod
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 86156da415141e32e16f2090477be32bda241afb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 18:30:33 2021 +0200

    Bug 28445: Adjust code to handle regexs
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e125ea2aa5da2c31edef197c04a4630c273c4c7a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 18:29:16 2021 +0200

    Bug 28445: Use Koha::UI::Form::Builder::Item from batchmod as well
    
    Now that it's reusable, let use it somewhere else!
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 103ae6edcc67fadb5d48be8b4cba2115bdb2b516
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 18:26:32 2021 +0200

    Bug 28445: Move controller code to Koha::UI::Form::Builder::Item
    
    To ease reusability
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af7cc5f81668fe50dde12fa0a03278fcbb0005fa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 18:25:19 2021 +0200

    Bug 28445: Isolate add item form to an include file
    
    To ease reusability
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31ab35f4f317e17bda0edc91d68da5ec0efd10bc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 15 06:51:55 2021 +0000

    Bug 28769: (QA follow-up) Fix another occurrence
    
    Framework plugin unimarc_leader_authorities.pl.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c66668b16cd8949e46f88a104870298ba013ed82
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 20 10:30:30 2021 +0200

    Bug 28769: Remove tabloop from cataloguing plugins
    
    There is a "tabloop" variable that is passed from the add item form logic to the cataloguing plugins.
    But there is confusion, sometimes it's an iterator ($i) and sometimes (batchMod.pl) an array.
    
    Actually this tabloop variable is never used from cataloguing plugins, we should remove it.
    
    Test plan:
    Read the code and confirm the above.
    You can also test a couple of plugins and confirm that they are still
    working.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ae81043b794e9b5cb4bf2486d6f88b7917a397a
Author: Andrew Nugged <nugged@gmail.com>
Date:   Sat Oct 16 00:16:35 2021 +0300

    Bug 27526: Fix for prefill preventing duplication
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46394b00218f565c7d0f2540b2df67aa09e94727
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 09:34:19 2021 +0200

    Bug 27526: Fix 'add & duplicate item'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8d9c0e1a7fbe91294b009ef30f0db06d6010e39
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 13 09:29:12 2021 +0200

    Bug 27526: Fix 'duplicate item'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81ee4a0e2f0026b38558454a660dc149918fb3f3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 15 13:16:55 2021 +0200

    Bug 29093: (follow-up) DBRev 21.06.00.033
    
    Had to decrease the number because of a patch removed from the branch but forgot to rename the dbrev file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 663f937d8598784bde3ebf3e94e2a9e8d11d99eb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 30 12:28:39 2021 +0000

    Bug 28337: Use existing definition in ccl.properties and bib1.att
    
    As the field is already dfined, we don't need to add anything here.
    Bib1.att can use the existing number as well
    
    To test, enable zebra debugging in koha-conf, adding 'request' to the list:
    <zebra_loglevels>none,fatal,warn,request</zebra_loglevels>
    
    Restart all the things
    
    Repeat matching (redo matching with no rule, then with OCN rule)
    Tail the zebra-output.log and note 1=Ohter-control-number is searched and match is found
    Perform a search in the staff client for: other-control-number:expialodocious
    Note in logs that 1=1211 is searched
    
    Previous test plan did not mention copying ccl.properties and bib1.att to the package install,
    so highlighted that things work without these changes
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a30e2d66cd964c3a18c14c8a5b7184d6dbae56b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 12 17:49:36 2021 +0000

    Bug 28337: Add System-control-number index to Zebra MARC21 files
    
    To test:
    1 - Apply patch
    2 - Copy zebra files to destination:
        cp /kohadevbox/koha/etc/zebradb/marc_defs/marc21/authorities/authority-koha-indexdefs.xml /etc/koha/zebradb/marc_defs/marc21/authorities/authority-koha-indexdefs.xml
        cp /kohadevbox/koha/etc/zebradb/marc_defs/marc21/authorities/authority-zebra-indexdefs.xsl /etc/koha/zebradb/marc_defs/marc21/authorities/authority-zebra-indexdefs.xsl
    3 - Reindex authorities
    4 - Edit an authority and add 035$aExpialodocious
    5 - Export the authority
    6 - Create a new record matchign rule:
        Matching rule code: OCN
        Description: Other control number
        Match threshhold: 1000
        Record type: Authority record
        Search-index: Other-control-number
        Score: 1000
        Tag: 035
        Subfields: a
    7 - Stage the record and use the new matchign rule
    8 - Match found!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ecc08bf5995070685b7d88caa86c4a6cfb67a2ad
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 19 14:24:33 2021 +0100

    Bug 28389: Add 'Details' link to refund type payout lines in POS
    
    This patch adds a link to the account-details page for refund type
    payout lines displaying on the register details page of cash management.
    
    Test plan
    1/ Enable 'UseCashRegisters'
    2/ Add some transactions with at least one including a 'Refund'
    3/ Look at the transaction history for the current register (Tools >
    Cash management > Transaction history for X)
    4/ Note the refund line does not contain a link to 'Details'
    5/ Apply the patch
    6/ The refund line should now have a 'Details' button on the right.
    7/ Bonus points, perform a cashup and then search for older transactions
    and check the 'Details' button appears in this table too.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d3f466ef0f0fca98f36eac6313ef831c9615e56
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 12 12:30:17 2021 +0000

    Bug 29209: Credits for Saxion in Dutch translation
    
    The Rijksmuseum sponsored translation for Dutch-The Netherlands for
    many years. More recently Saxion did the bulk of that work.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Ronald Wijlens <r.j.wijlens@saxion.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b32a55126045c5e019681bccd34d6a71785ddee
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 15 11:06:36 2021 +0200

    Bug 29093: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0ac8e4dbe96a2b4bbd62881b2a9c5145d2a57c8c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 15 11:03:40 2021 +0200

    Bug 29093: DBRev 21.06.00.033
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80e4516a4c6527fbbeddfc48972ee6845bfcfc18
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 6 12:05:54 2021 +0000

    Bug 29093: (QA follow-up) Rebasing issue
    
    Bug 27944 added another block for the new stage introduced.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61df3291f601ff2a080198692906db1ce3b0778f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 6 11:56:33 2021 +0000

    Bug 29093: (follow-up) Fix the all fields empty-warning
    
    We should allow checking the TOC box only.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 730c861b847af6151e5708566e6772c7ba361f73
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Sep 29 11:23:32 2021 +0000

    Bug 29093: (QA follow-up) Adding two hover texts
    
    See QA request. Adding TOC hover text to:
    - OPAC user page, tab Article requests
    - Patron details page, Check out, tab Article requests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c6281f9856c7a08e86410f6d309d5788c937759
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 23 13:23:44 2021 +0000

    Bug 29093: Interface changes
    
    Show the TOC checkbox on OPAC and staff.
    
    Test plan:
    Add new article request on OPAC or staff. Tick checkbox.
    Verify if TOC is Yes on opac-user or staff patron details.
    Check the list view on circ/article-requests.pl.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13501fe2d77648100488354af6ee62d0ec9c8d4a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Sep 23 12:30:31 2021 +0000

    Bug 29093: Database revision for article_requests.toc_request
    
    Test plan:
    Run dbrev or new install.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4c71f9672a8ea9d91f11bec562d8ade5ef63327
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Oct 11 08:34:00 2021 +0000

    Bug 29199: Fix parameters of ListCallNumbers
    
    [1] ItemBranch should have been passed with quotes.
    [2] You cannot use $x as class name, you need to use xsl:attribute.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8086712952b7cf6dadcecf2a2c7486f228ecca6
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Sep 26 08:10:15 2021 +0000

    Bug 29111: Remove unused indicator modification code for items
    
    The indicator value for 952 was hard coded in every case to " ". In
    order to achieve that we can simply pass undef to TransformHtmlToXml()
    and it will set the indicator values to " ".
    
    To test:
     1) Make sure the submission of (at least some) the modified files
     still work, e.g. test that making a new item via
     cataloguing/additem.pl works.
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Rebased-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39f7b7140d6a8f21a2687dcb836db77ae9304699
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Sep 26 08:01:51 2021 +0000

    Bug 29111: Remove dead code from acqui/addorderiso2709.pl
    
    Test plan:
     1) open acqui/addorderiso2709.pl in your code editor and make sure
     nothing references $item in the if block where it was removed from
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4d078db3ac1803dc0576fc9f636673617c9de16
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Oct 12 08:49:48 2021 -1000

    Bug 29213: Fix typo ol in member-alt-contact-style.inc
    
    There is a typo in member-alt-contact-style.inc, tag ol is open twice for alternate contact.
    
    Test plan :
    1) Create new patron
    2) Look at HTML structure in "Alternate contact" section
    => Without patch you see <ol> twice and </ol> once
    => With patch you see once <ol> and </ol>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 868e02bfab5ded8759e85cadb7d6d14ec2c2773d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 7 15:28:40 2021 -0300

    Bug 29157: Date and Datetime attributes cannot be set NULL
    
    This patch makes Koha::Object->attribute_from_api allow setting
    attributes the undef value. The original implementation passed the value
    directly to dt_from_string, which made the attribute be set the current
    date.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Object.t \
               t/db_dependent/api/v1/patrons.t
    => FAIL: Tests fail! Our code is buggy!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS! Fix fixed this thing!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Eric Phetteplace <phette23@gmail.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a8563d0744c1da5798322a11ea8c87744cc4d61
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 7 15:16:01 2021 -0300

    Bug 29157: Regression tests
    
    This patch implements regression tests for the filed bug.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Eric Phetteplace <phette23@gmail.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef089661ffea4184b4a38efea0e5f1133625946d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 1 12:25:20 2021 +0100

    Bug 15812: (follow-up) Enable click cell to select
    
    This patch adds handling to allow clicking anywhere in the table cell to
    select/deselect the patron
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ddfe42eebf18658d479e486ea6d2b40a79b0847
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Oct 1 09:58:08 2021 +0100

    Bug 15812: (follow-up) Tweaks to patron results display
    
    Move the button into the actions column and make 'cardnumber' a link to
    checkout, with a tooltip.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd4f18471aec491e0475cd49b6ccee5033952474
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 30 11:31:45 2021 +0000

    Bug 15812: (follow-up) Add permission check for 'Check out' button
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7a7e4581200ae8472aed66d38250b7cf28e1755
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 24 00:05:30 2021 +0000

    Bug 15812: Use patron search in place of circ search
    
    The 'Checkout' search hijacks some of the DataTables searching code used for 'Search patrons'
    Rather than try to implement the search again on another page, we can simply send the user
    to the patron search if the cardnumber is not found
    
    Additionally, this patch adds a 'Check out' button to the patron search results to allow
    going to checkotus directly
    
    To test:
    1 - Apply patch
    2 - Perform a 'Checkout' search from the header
    3 - Note that:
        For a cardnumber, you are redirected directly to checkouts page for the borrower
        For a search with one result, you are redirected directly to the checkout page for the borrower
        For a search with many results, you are redirected to the patron search results
        and there is a 'Checkout' button under the cardnumber
    4 - Confirm circulation page works as expected (i.e. checkout to a patron)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: George Williams <george@nekls.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47634e087c57e25ac5df4b495287dfc09edfd207
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 12 11:16:39 2021 +0200

    Bug 28978: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 790dc699b00705af76a1630dcf7007c0b1ef41c3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 8 23:30:11 2021 +0000

    Bug 28978: Convert installer CSS to SCSS
    
    This patch creates a new SCSS file, installer.scss, from which
    installer.css will be compiled.
    
    Most of the resulting CSS is unchanged, but some minor sections were
    removed because they were obsolete. The jQueryUI-specific section isn't
    fully converted to SCSS because it's going to go away with the addition
    of Flatpickr.
    
    To test, apply the patch and rebuild the staff client SCSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Confirm that koha-tmpl/intranet-tmpl/prog/css/installer.css is
      updated.
    - Go through the complete web installation process, including
      onboarding, to confirm that everything is styled as before.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18f96e95a2bd1cd3f93ea1ec2d49958f89489253
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Mon Sep 6 23:15:39 2021 +0000

    Bug 28956: Correct default tax rate on orderreceive
    
    When there is more than one tax rate defined in system preferences, and
    a vendor has a tax rate that is not 0%, then when you are receiving an
    order in a basket for that vendor, the default tax rate should be the
    correct non 0 rate. This should be seen in acqui/orderreceive.
    
    To test:
    1) Go to staff client
    2) Go to Koha administration
    3) Search for "tax rate" in system preferences
    4) Add 0|0.15 into the preference
    5) Create a vendor
    6) Set vendor tax rate to 15%
    7) Add a new basket to vendor
    8) Add to basket
    9) Add any sample order to basket - add actual cost
    10) Close basket
    11) Receive shipment
    12) Make invoice
    13) Click on Receive in the table
    14) Should be on orderreceive.pl page
    15) Observe tax rate default is 0%
    16) Apply patch
    17) Refresh page
    18) Observe tax rate default is 15%
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Julien Sicot <julien.sicot@univ-rennes2.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7f7fba378050b42a09cba527283f01d6770d726
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 4 19:18:04 2021 +0000

    Bug 29162: Change template structure on OPAC library page so that a single library can easily be hidden
    
    This patch adds markup to the OPAC library page so that CSS or JS can
    more easily target elements of the page:
    
    - Each library is wrapped in a div, e.g. <div id="section_CPL">
    - Classes are added to the paragraphs containing phone, fax, URL, and
      library description.
    - An ID has been added to the menu of libraries in the sidebar so that
      they can be targetted individually.
    
    To test, apply the patch and go to Administration -> System prefernces.
    
    - Add some testing CSS to the OPACUserCSS system preference, if
      necessary replacing "CPL" with a branchcode in your system:
    
      div#section_CPL,
      li#menu_CPL {
         font-size: 80%;
      }
    
    - In the OPAC, view the "Libraries" page.
    - In the view of all libraries you should see your CSS reflected in the
      section for that library.
    - In the individual library view you should see the menu item for that
      library affected by your custom CSS.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4ebf1788c830b378e113da1e37af424f3d85c74f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 12 11:09:29 2021 +0200

    Bug 28963: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0111632f1e5edd4f7d23a1888e2e2e576d757c43
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Oct 4 16:33:25 2021 +0000

    Bug 28963: Use Flatpickr on calendar page
    
    This patch replaces the use of jQueryUI's datepicker widget on the
    Calendar page.
    
    In order to ease customization of the static calendar which shows the
    current calendar, I've converted the calendar.css file to SCSS. This
    allows us to define new SCSS variables to pass to the Flatpickr SCSS.
    
    Also changed: Removed some unecessary comments in the template.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Tools -> Calendar.
    - Confirm that entering holidays works correctly for all types: Single,
      weekly, yearly, ranges, repeated ranges.
    - Confirm that holidays are deleted as expected.
    - Confirm that the colors of each type of holiday is correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e81f6de26e6bd5dbd0f38041615929eb0a86f9e2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 9 18:42:48 2021 +0000

    Bug 28988: (follow-up) Add markup comments
    
    This patch adds comments to the template to highlight the markup
    structure.
    
    This patch should have no effect on the page's appearance or
    functionality.
    
    https://bugs.koha-community.org/show_bug.cgi?id=28988
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b294e374dde15f22e6944f858b4479d079cb9f0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 9 18:32:20 2021 +0000

    Bug 28988: Reindent calendar template
    
    This patch performs general template cleanup to the calendar template:
    Make indentation consistent and trim trailing whitespace.
    
    To test, apply the patch and go to Tools -> Calendar.
    
    The page should look correct and work correctly. If you view the diff
    while ignoring whitespace the only changes should be where line breaks
    were introduced.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4e73f8c06e2a0b6f5ec4ca66d296ca27f3056941
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 5 14:05:49 2021 +0000

    Bug 29177: Remove TODO in acqui/finishreceive
    
    Replacing a multiple object->column(value) by ->update.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 283b6b0c067da0117628bda6b5d8f97ec9581517
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Sep 26 16:09:20 2021 +0000

    Bug 29116: Use a pre-existing accessor instead of reimplementing it
    
    We can use the Koha::Patron::is_expired accessor instead of re-writing
    it in request.pl.
    
    To test:
     1) Make that a warning is being shown with and without this patch
        when placing a hold to an expired patron account
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f3e5607e928d898fa9cde15163d74013d84ebc83
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 12 11:09:08 2021 +0200

    Bug 29112: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23bee95ad9456236d81568d8893fa5213a6b230d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 5 16:22:20 2021 +0000

    Bug 29112: Module navigation sidebars in staff now show bullet points
    
    Bug 27873 removed an image file which was still being referenced in the
    staff interface CSS, intended to replace the default bullet point in
    sidebar menus like Administration and Tools pages have.
    
    This patch creates a new variable in the SCSS "mixins" file so that the
    SVG image file created by Bug 27873 can be reused, and corrects the CSS
    for the affected menus.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Tools -> Patron lists
      - The sidebar menu should be styled with little arrows instead of
        the default HTML bullets.
    - Check the same on an Administration page, e.g. Administration ->
      Libraries.
    - Check that there hasn't been a regression on the checkout and patron
      detail views:
      - Check out to a patron who has one or more messages on their account,
        e.g. overdues, return claims, holds waiting, notes, messages, etc.
      - The display of these list items should be the same: An arrow bullet
        point instead of the default.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f30186e8f049447154f464047cde72d97d58f0d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 7 14:04:32 2021 +0000

    Bug 28441: Terminology: Reserve notes should be Hold notes
    
    This bug corrects the text "Reserve notes" to be "Hold notes" on the
    holds to pull page.
    
    To test, apply the patch and go to Circulation -> Holds to pull.
    
    You should see in the table header a column labeled  "Hold notes."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44b26c62f6715d9859480166e63acc11750f00e4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 7 15:44:03 2021 +0000

    Bug 28579: Typo: No record have been imported because they all match an existing record in your catalog.
    
    This patch corrects a grammatical error in text which might be shown
    when adding records from a staged file to a basket. It corrects this:
    
      "No record have been imported because they all match an existing
      record in your catalog."
    
    ..to this:
    
      "No records have been imported because they all match existing
      records in your catalog."
    
    To see the error in Koha, apply the patch and export some records from
    Koha (Tools -> Export) and then re-import them using Tools -> Stage MARC
    for import.
    
    - Go to Acquisitions -> Vendor -> Basket -> Add to basket -> From a
      staged file.
    - Click the "Add to order" button corresponding to the file you just
      uploaded.
    - Select all records and define default accounting details.
    - When you click "Save" you should see the error message.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 358c2adf9cb65a5e9d61e08c9a9c4ffa57054700
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Oct 7 14:19:56 2021 +0000

    Bug 28470: Typo: Are you sure you with to chart this report?
    
    This patch corrects the text of a warning on the report results page,
    from this:
    
    _("Fetching full chart data for reports with many rows can cause
    performance issues. Are you sure you with to chart this report?")
    
    ...to this:
    
    _("Fetching full chart data for reports with many rows can cause
    performance issues. Are you sure you want to chart this report?")
    
    To test, apply the patch and go to Reports -> Use saved.
    
     - Run a report which, unlimited, will return more than 1000 rows.
     - Click the "Fetch all data for chart" button.
     - You should be asked for confirmation. Check that the text is correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf585088c117bd6000623f537723d3c25c81f05c
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Oct 4 18:21:02 2021 +0000

    Bug 29172: (follow-up) Amend preference text for control fields
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0038f40356a028e88e88ee335c395c0d466677e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 13:57:04 2021 +0200

    Bug 29172: Make CustomCoverImagesURL compatible with control fields
    
    Bug 22445 added CustomCoverImagesURL that deals with MARC fields, but
    control fields were not supported.
    
    Test plan:
    Turn CustomCoverImages on
    Fill CustomCoverImagesURL with https://covers.openlibrary.org/b/isbn/{006}-M.jpg
    Add an isbn in 006 (0596001738 will work)
    Go to the detail page of the bibliographic record and confirm that you
    see a cover image.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 082d53a6caa41c6b5b9d8ecb8df585baa9cf6bf4
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Oct 3 11:51:22 2021 +0000

    Bug 24698: QA fixes
    
    This is a squashed patch of the following patches:
    
    Bug 24698: (QA follow-up) Fix errors caused by more strict exports being introduced
    
    The original patch "Bug 24698: Add plugin and template files for
    unimarc authority leader" doesn't work without explictly importing the
    methods from C4::Auth and C4::Output due to the default exports being
    changed in those modules after the patch was made.
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Remove debug info being outputted to the template
    
    This is only needed during development.
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Align variables with whitespace
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Remove dead code
    
    These were left off from the copy&paste taken from
    unimarc_field_100_authorities.pl
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Fix formatting and typos
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Remove passing of authnotrequired parameter
    
    It should only be used when we want to override the default of auth
    being required.
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Make plugin script executable
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Use spaces instead of tabs
    
    This makes the QA script happy.
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Filter untrusted input to prevent XSS
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Don't specify select element's size if it is 1
    
    This is to make the QA script happy, in order to not to break
    Bootstrap CSS rules, see Bug 28066 for more info
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (QA follow-up) Don't specify script type explictly
    
    It's makes the QA script complain because the option doesn't have any
    effect nowadays:
    
    https://www.w3.org/TR/2017/REC-html52-20171214/obsolete.html#warnings-for-obsolete-but-conforming-features
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 24698: (follow-up) remove HTML select option for Series
    
    The IFLA authorities format specification defines only the letters a-l
    as possible values for authority leader 000 character position 9 ("Type
    of entity"). Therefore, the first option from the HTML select dropdown
    menu (" - Series") must be removed.
    
    Mentored-by: Andreas Roussos <a.roussos@dataly.gr>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 208f7158559b886fbe25152dbebf560b2dd8542c
Author: George Veranis <gveranis@dataly.gr>
Date:   Fri Mar 12 12:51:57 2021 +0100

    Bug 24698: Add plugin and template files for unimarc authority leader
    
    In Unimarc installations when adding/editing an authority record there is no
    Tag Editor for the leader field ( 000 ).
    
    This patch fixes that.
    
    Test plan:
    
    1) Try to catalogue a new authoritry and check if on field 000 you can find
    the Tag Editor.
    2) Apply the patch.
    3) In the authorities framework view the subfields of field 000 and select for
    plugin option the value unimarc_leader_authorities.pl.
    4) Restart memcached / plack if needed.
    5) Repeat step 1 and notice if the Tag Editor is visible and click it to open
    new window in order to manage the field contents and press OK.
    6) Check the value of the generated leader.
    
    Signed-off-by: Esther <estherm@sodapsringsid.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccaa25a70d164e05084150cb025bff56af457e0d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 12 11:14:38 2021 +0200

    Bug 29138: DBRev 21.06.00.032
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bfb403dfb4454f7ae5a17738c0a3e0000ae853b2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 8 06:30:13 2021 +0000

    Bug 29138: (QA follow-up) Changes to UPDATE
    
    Move the condition to the WHERE clause, using COALESCE to
    prevent mysqlism (IFNULL) and strings for strict SQL.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested on NULL, 0, 1, 2, no, yes. (2 and yes become 0 too. Fine.)
    Tested strict sql mode: no truncated incorrect DOUBLE value-error anymore.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 701bce97f5791b837a386e16deb7c685171cdb87
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Wed Sep 29 19:24:13 2021 +0000

    Bug 29138: Use zero instead of no in LoadSearchHistoryToTheFirstLoggedUser
    
    To test:
    - apply patch
    - set LoadSearchHistoryToTheFirstLoggedUser to 'Don't add'
    - confirm via sql that value=0
    - confirm on OPAC that search history is not loaded to account on login
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8ba35b2fa8610046c0502b5c97cd5d862ce20d5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 8 10:44:00 2021 -0300

    Bug 29197: Add missing import in commit_file.pl
    
    This patch adds a new method import to the commit_file.pl script.
    
    To test:
    1. Have MARC data staged
    2. Run:
       $ kshell
      k$ perl misc/commit_file.pl --list-batches
    => FAIL: You get
    Undefined subroutine &main::GetAllImportBatches called at misc/commit_file.pl line 68.
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: You get the list of batches
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 802af9c5c859ac70e04c288aa454a8be1b89e366
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 7 19:34:01 2021 +0000

    Bug 29193: Specify paging as false in circ-patron-search-results.js
    
    This patch removes paging from patron searches using circ-patron-search-results.js
    
    To test:
    1 - Browse to a record
    2 - Click on the 'Holds' tab
    3 - Search for 'a' in patrons
    4 - Note you see only 20 results
    5 - Sort by name and note that you see different results
    6 - Apply patch
    7 - Reload page and search
    8 - Note you see all results
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ffbea4faac43d85bc93b92ce030024d95578eb65
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Oct 6 11:57:19 2021 +0000

    Bug 28748: Prepare pickup locations for overridden holds
    
    The logic in request.pl only passes pickup locations if a hold is allowed,
    they are not calculated when the hold is overridden.
    
    This patch copies the pickup locations code into the override conditional,
    adjusting to mark the item overridden
    
    This also highlights an condition of override:
    If a hold is allowed, but there are no valid pickup locations the override
    is not allowed.
    
    To test:
     1 - Set a holds rule to allow on-shelf holds only if all unavailable
     2 - Set AllowHoldPolicyOverride to 'Allow'
     3 - Find a record with several items available
     4 - Attempt to place a hold
     5 - The items have a yellow triangle, but no pickup locations
     6 - Place an item level hold
     7 - Note the hold has no pickup location
     8 - Cancel the hold
     9 - Apply patch and restart all
    10 - Attempt hold again
    11 - Items still have yellow triangle, but there are dropdowns for pickup location
    12 - Place an item level hold, verify a pickup location is set
    13 - Cancel the hold
    14 - Alter circ rule to allow on shelf holds
    15 - Change 'Default checkout, hold and return policy' - 'Hold pickup library match' to "item's hold group"
    16 - Ensure there is no group for the item
    17 - Attempt to place hold
    18 - Override is not allowed 'No valid pickup locations'
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 155c3f18244a415812346127304493ec20165ecc
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Thu Sep 30 22:53:15 2021 +0300

    Bug 29135: Fix handling of deleted items in OAI-PMH provider
    
    When the OAI-PMH provider was configured to include item information
    in the returned records, deleting an item would cause the record to
    be reported as deleted. The provider also did some useless checks when
    determining the timestamp of a deleted record. These checks only had
    a performance impact.
    
    To test:
    1) Create /var/lib/koha/kohadev/OAI.yaml with:
    
    format:
      marcxml:
        metadataPrefix: marcxml
        metadataNamespace: http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim
        schema: http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd
        include_items: 1
    
    2) Set preference OAI-PMH to Enable
    3) Set preference OAI-PMH:ConfFile to /var/lib/koha/kohadev/OAI.yaml
    4) Delete an item from a record
    5) View the page: http://localhost:8080/cgi-bin/koha/oai.pl?verb=ListRecords&metadataPrefix=marcxml
    6) Note the record is now listed as deleted
    7) Run prove -v t/db_dependent/OAI/
    
    Sponsored-by: The National Library of Finland
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6d013efad595a5c434a4d0f85a7854be83fcbe9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 12 09:10:58 2021 +0200

    Bug 28734: Clear cache to prevent random failures
    
    MSS is modified, we must clear the cache before and after
    
        #   Failed test 'Authorised value is correctly parsed to show description rather than code'
        #   at t/db_dependent/Koha/Biblio.t line 617.
        #          got: 'CODE'
        #     expected: 'Description should show'
    
        #   Failed test 'Authorised value is correctly parsed for OPAC to show description rather than code'
        #   at t/db_dependent/Koha/Biblio.t line 624.
        #          got: 'CODE'
        #     expected: 'Description should show OPAC'
        # Looks like you failed 2 tests of 13
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 81d11915d774dedeeaa699f1def3b7b458e286e4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 12 08:53:49 2021 +0200

    Bug 27526: (follow-up) Remove uneeded call to TransformMarcToKoha
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2c7c9430bb4a38b80e954599bc090dfb04f3674
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 8 15:05:39 2021 +0200

    Bug 3142: Add tests for item-level_itypes=0
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1aa70c9bb6d20034a53e981741bc1848641209f2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 8 12:03:41 2021 +0200

    Bug 3142: Handle biblio level item type
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05ddd7eede98f30368ab4debf4ac389c4b3ad13d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 8 09:10:22 2021 +0000

    Bug 3142: (QA follow-up) Include notforloan itemtypes
    
    As was done in the code already.
    Note that we are ignoring effective itemtype now.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10b971c08b2b0d39e61548540a339710afc0fa22
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 8 08:31:52 2021 +0000

    Bug 3142: (QA follow-up) Cosmetic changes
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 064500bc9670e5a96d41bbd9cafe0061afb26471
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 14:32:47 2021 +0200

    Bug 3142: Add note about imprecision of filter_by_for_hold
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd438ff99d593fd42f995229b36548beeefdfeba
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 14:30:49 2021 +0200

    Bug 3142: Add test for the circ rule
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70a303a5de4c8b351b6be1c7b7b9553a4f1c62a3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 14:17:22 2021 +0200

    Bug 3142: Add tests
    
    And fix a bug!
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ad0e172cddce560afcc23579948d0c4a1eca71c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 15:49:45 2021 +0200

    Bug 3142: Use filter_by_for_holds where holdability is calculated
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9b306fa7c98de6d5f25d15c55fd1d387e954343
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 15:43:10 2021 +0200

    Bug 3142: Add itype
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d63e9be1848a3bebcc73f21a238f3990e50cf6f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 15:39:55 2021 +0200

    Bug 3142: Exclude damaged items
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31392f5fc25d037637758d67034cc4d932b10963
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 15:38:29 2021 +0200

    Bug 3142: Add itemlost, withdrawn and notforloan
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3bdeae3459f66b37c1a3c39002014c57914138ae
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Oct 7 12:02:24 2021 -0300

    Bug 29169: Fix wrong terminology when article request is not available
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 67ead5e7aef49f44b4744f8a85a35a28931b10d9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Oct 8 14:42:48 2021 +0000

    Bug 29134: (follow-up) Specify which borrowernumber
    
    When performing a search that includes permissions we need to specify we are comparing
    the borrowers tabnle borrowernumber
    
    To test:
    1 - Browse to Admin->Funds
    2 - Edit a fund
    3 - Click '+ Add users'
    4 - Attempt a search, no results
    5 - Check plack-error.log
        C4::Utils::DataTables::Members::search(): DBI Exception: DBD::mysql::st execute failed: Column 'borrowernumber' in IN/ALL/ANY subquery is ambiguous at /kohadevbox/koha/svc/members/search line 80
    6 - Apply patch
    7 - Repeat 1-3
    8 - search for 'a'
    9 - Result!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5eca355cbc37d44fc9eeefeacb777d59dc1c7a1e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Oct 7 09:56:22 2021 +0000

    Bug 29182: (follow-up) Fix ArticleRequests.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9285e107206bb3d1a8af4eee771ebd7fba4bd68
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 6 09:10:38 2021 -0300

    Bug 29182: (follow-up) Simplify Koha::ArticleRequest->store
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 707e68b7fcf831aceaddf72b576ec7cfd25af50b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 6 09:01:13 2021 -0300

    Bug 29182: Make sure methods call the overloaded ->store
    
    This patch addresses the issue of `request()` and `set_pending()`
    calling $self->SUPER::store instead of the overloaded one.
    
    This prevents created_on being set.
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/ArticleRequest.t
    => FAIL: created_on is not set on two methods
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: created_on is now set!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b356ad25decc6d1e1d8a815a46e0d2ebb850f84d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 6 09:00:48 2021 -0300

    Bug 29182: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8db487cf8bfe6dbcb37d27c06586836e6497b7d2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Oct 5 12:12:34 2021 +0000

    Bug 29131: Row striping breaks color coding on item circulation alerts
    
    The CSS we use for table row "striping," which uses 'tbody
    tr:nth-child(odd),' is often difficult to work with because it takes a
    lot of increased specificity to override the default. Bootstrap
    compounds this by adding its own similar CSS.
    
    In order to overcome this I've added '!important' to the CSS embedded in
    the item circulation alerts page. I normally would avoid '!important'
    but since this CSS is only relevant to this page I think it's
    appropriate.
    
    This patch also adds [% FILTER collapse %] around the <style> block and
    does some reindenting, so ignore whitespace when using diff to see the
    changes clearly.
    
    To test, apply the patch and go to Administration -> Item circulation
    alerts.
    
    - Check the "Legend" table. The first cells should be distinct colors:
      red, pink, and green.
    - In the "Checkout" table, table cells should be green by default.
      Clicking in one of the cells should turn it red with the text
      "Disabled for all."
    - Use the "Select a library" dropdown to pick a library.
    - Clicking in any green cell should turn the cell pink and add the text
      "Disabled for XXX" where XXX is the branchcode.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f981b1f28155d6d0b453ffcf7b82f5aa6b447c8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Oct 7 13:13:20 2021 +0000

    Bug 29062: Unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb068b31beedd12bd2d28736d4964b3bba7526ce
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Oct 6 13:32:55 2021 +0000

    Bug 29062: (QA follow-up) Add comment
    
    Wrapped it in a TODO ;)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0138d09109d4277a3b23af48141092f0289a28ee
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Oct 4 18:43:52 2021 +0000

    Bug 29062: (follow-up) Adjust SendCirculationAlert
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 814789f8cb18d324591ecaeeeb01f6c79d4b239f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 22 11:49:14 2021 +0000

    Bug 29062: Use primary key issued_id to fetch old_issues for letters
    
    The code currently uses itemnumber to fetch old_issues for notices.
    This doesn't seem to be used in any current notices except the CHECKINSLIP:
    SELECTY letter.code,content FROM letter WHERE content LIKE 'old\\_%'\G
    
    For issues we use itemnumber, however, issues has a constraint to limit issues for an itemnumber to 1
    Old issues has no such constraint, we try to rectify this in the old code by adding 'ORDER BY returndate DESC LIMIT 1"
    
    As the code is not used by default and buggy I think we can make a change to using 'issue_id' as the key and
    announcing the change - it prevents leaky data
    
    To test:
    1. Check something out to patron A. Check it in.
    2. Check something out to patron B. Check it in.
    3. Check something out to patron C. Check it in and print the check-in slip. (Leave the checkin paghe open)
    4. You will see the checkin repeat itself 3 times, one for each line in old_issues.
    5. Apply patch and restart_all
    6. Click the 'Print checkin slip' button again
    7. You see a single checkin
    8. Checkout a different item to patron A. Check it in and print the check-in slip
    9. See the correct checkins
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8a2df77f8339ac17c461c8ce5a3c990fe488691
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 17:18:48 2021 +0200

    Bug 27622: Fix sample_notices.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bef5b6833a7e81b597ee607abed48c5365b8573
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 17:17:35 2021 +0200

    Bug 27622: Add stuffs to custom.sql
    
    NOK currency and z3950 servers (And assume they are now using MARC21)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0befd299a4f933ece47307151f1d099cde8e264
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 17:16:20 2021 +0200

    Bug 27622: Remove Remove nb-NO installer data
    
    With installer data in YAML format and it's translations,
    there are no need for localized installer files.
    
    This patch removes nb-NO installer files.
    
    1) Apply the patch
    2) Translate to nb-NO
       cd misc/translator
       ./translate update nb-NO
       ./translate install nb-NO
    3) Do a clean install using nb-NO,
       check no problems during install
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f10b6c32c36f29853b21d105abcff09929d69ac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 7 15:47:21 2021 +0200

    Bug 18984: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e8f37e7efe43f5ebd4d34648322aa5ae782966f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 7 15:46:42 2021 +0200

    Bug 18984: DBRev 21.06.00.031
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e975ed4e3e16dc4a6b9bdaede282e91c5e07abe8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 17:04:40 2021 +0200

    Bug 18984: Remove *-NORMARC.po files
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a5e0c1a3e985f21f3585c7ce6f7367696e054b32
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 17:00:07 2021 +0200

    Bug 18984: DB changes
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0760045e0b10a80643b90cac77f653d5cda42e75
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 21 10:33:40 2021 +0100

    Bug 18984: Remove ES mapping for NORMARC
    
    perl misc/search_tools/export_elasticsearch_mappings.pl > admin/searchengine/elasticsearch/mappings.yaml
    grep -v 'mandatory: ~' admin/searchengine/elasticsearch/mappings.yaml|grep -v 'opac: 1'|grep -v 'staff_client: 1'
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 08c03af2ae3e77c3187e543961472a8a46bfc788
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 21 10:28:21 2021 +0100

    Bug 18984: Remove NORMARC support
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dbce2e79aa8126af7ab24e82550402aeb8e482b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 16 10:40:46 2021 +0200

    Bug 27101: Fix sample_notices.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6acd6718e8b5a654c95696face0681f20fce4542
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 16 10:39:45 2021 +0200

    Bug 27101: Remove fr-CA installer data
    
    With installer data in YAML format and it's translations,
    there are no need for localized installer files.
    
    This patch removes fr-CA installer files.
    
    1) Apply the patch
    2) Translate to fr-CA
       cd misc/translator
       ./translate update fr-CA
       ./translate install fr-CA
    3) Do a clean install using fr-CA,
       check no problems during install
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9af936b79f0a32b94da8749f4dafbf56eae661ef
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 6 10:34:42 2021 -0300

    Bug 27944: Add fr-FR AR_REQUESTED notice
    
    This patch adds the missing notice.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87e53a335242f9b47183d8437885b22706bbde3c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Feb 18 16:37:37 2021 +0000

    Bug 27725: Use JavaScript to set history state during patron search
    
    This patch modifies the patron search page so that clicks on the "Browse
    by last name" letters add an entry to the browser history, allowing the
    user to click back and forth from results while preserving their search.
    
    To test, apply the patch and go to Patrons in the staff interface.
    
    - Click one of the "Browse by last name" letters.
    - The table of search results should load the correct data.
    - In the browser's location bar you should see a query string added to
      the URL, e.g. /cgi-bin/koha/members/members-home.pl?firstletter=Q
    - Click another letter.
    - Click the back button. You should be returned to the search results
      for your first letter choice.
    - Clicking the forward button should work correctly as well.
    - Other patron searches (header search, sidebar search) should continue
      to work as expected.
    
    EDIT: Clear single-letter querystring history item if only one result
    was returned.
    
    EDIT 2: Fixed handling of history state changes so that forward and back
    buttons work correctly.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 27725: (follow-up) Remove code for clearing search results
    
    This patch removes code which cleared search results if there was no
    first-letter search. It was unnecessary for the letter search
    functionality and made all other searches fail.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90be2877c98e2c74bbdcea9e4a9e4ce4cf2455e2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 22 16:57:46 2021 +0100

    Bug 28730: (QA follow-up) Add new option to example configs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5be090b55662cac4e045605e7b94b19f3d3ac017
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 21 13:56:22 2021 +0000

    Bug 28730: Add option to format AH field (due date) in SIP checkout response
    
    This patch adds a new option to sip accounts:
    format_due_date
    
    If set to 1 the AH field in checkouts will follow the dateFormat system preference and format as due dates (ignoring time portion if 23:59:59 or 11:59:59)
    
    To test:
     1 - checkout an item via SIP:
    perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 -l CPL -t CR --item 3999900000001 --patron enda -m checkout
     2 - Note the AH field is like "YYYYMMDD    HHMMSS"
     3 - Apply patch
     4 - repeat SIP checkout - nothing has changed
     5 - edit SIPConfig.xml and add format_due_date="1" to 'term1' account:
        <login id="term1"  password="term1" delimiter="|" error-detect="enabled" institution="CPL" encoding="ascii"     checked_in_ok="1" format_due_date="1"/>
     6 - restart all
     7 - repeat the SIP checkout
     8 - AH field now matches dateFormat system preference
     9 - Change your dateFormat preference
    10 - repeat the SIP checkout
    11 - AH matches new format
    
    Note: If you cannot renew and don't get an AH just check the item back in:
    perl misc/sip_cli_emulator.pl -a localhost -p 6001 -su term1 -sp term1 -l CPL -t CR --item 3999900000001 --patron enda -m checkin
    
    Signed-off-by: Winfred Thompkins <Winfred.thompkins@cedarhilltx.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7babcc0718e0f12efa52159fc666578d2314909d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 7 11:10:45 2021 +0200

    Bug 18631: Use - instead of _ for options
    
    To match existing options
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 951587562601171c2946b50d2d1cbee2915613a2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 21 19:15:27 2021 +0000

    Bug 18631: Add option to specify logs to preserve or delete in cleanup_database.pl
    
    This adds two new parameters:
    --log_module
    --preserve_log
    
    These can be repeated to include or exclude specific modules from the cleanup
    
    To test:
    0 - Apply patch
    1 - Enable cataloging log and borrowers log
    2 - Make some changes to borrowers and records
    3 - run cleanup databse with --logs 0 --preserve_log=MEMBERS --preserve_log=CATALOGUING
    4 - nothing is removed
    5 - run cleanup databse with --logs 0 --log_module=MEMBERS
    6 - the borrower logs are removed, the record changes remain
    7 - run cleanup database with --logs 0
    8 - record changes are removed (all other logs too)
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 156a59926885fba3b4fd0448c8bfd2edb82d3ab9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Oct 5 13:02:38 2021 +0000

    Bug 29175: finishreceive: Replace , by ;
    
    This certainly is one of my shortest fixes ever ;)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95c46c0db5b139d72b198a1f208de67fd9f2df48
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Sep 29 12:45:47 2021 +0000

    Bug 28821: (QA follow-up) Adjust javascript test
    
    The test did not work when SearchEngine == Elasticsearch.
    
    Test plan:
    Verify if it works now for Elasticsearch.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2047cd98db63653f16d6827751a4bf64f175a082
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 6 07:28:12 2021 +0000

    Bug 28821: (follow-up) Improve operation of button plus/less
    
    Follow-up for bug 28784.
    
    Do not remove the op select on the first row.
    Allow plus/less on all lines. Allow less until we have one line left.
    Make sure that first op is disabled and hidden with plus/less.
    
    Test plan:
    Search on multiple indexes on advanced search.
    Verify that plus/minus works as expected.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83c3b10a8a46604eb932d7961ce1824dafc397d7
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Jul 29 22:39:09 2021 +0000

    Bug 26544: Add housebound details to delivery page
    
    To test:
    1. Turn on the housebound module
    2. go to the housebound for a given patron /cgi-bin/koha/members/housebound.pl?borrowernumber=X
    3. add some housebound details, fill out all the fields
    4. Go to 'Add a new delivery'
    5. No housebound details, hard to know what the patron likes or days to deliver!
    6. apply patch
    7. Go to 'Add a delivery'
    8. See the housebound details, yay! All the line breaks should be preserved.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41a92321def09404727978fe488ccb889aaa820b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 4 10:52:29 2021 +0200

    Bug 28931: Remove unused Koha::DateUtils from tests
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e249435f96d77da5354b40eb94beffd86b97b8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 12:01:01 2021 +0200

    Bug 28931: Use EXPORT_OK from Koha::DateUtils
    
    It has been missed on bug 17600.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Adjusted commit title.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10d8a3e82ffb30000324b9c0652e460223e52cca
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 5 13:24:58 2021 -0300

    Bug 29179: Remove useless includes in moveitem.pl
    
    This patch moves a trivially unneeded set of includes from this file.
    
    To test:
    1. Apply the patch
    2. Try attaching an item to another biblio
    => SUCCESS: Things work as expected!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ad35094adf18097e5c9cd2a5c5675f3f3e4d08a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Oct 7 10:14:49 2021 +0200

    Bug 29083: Don't pass _count var
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 107176a07bdb8ee28fe443d7a3701401e016fa9f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 22 16:53:50 2021 -0300

    Bug 29086: (follow-up) Remove unrequired Koha::ArticleRequest::Status uses
    
    I noticed a couple places in which this library was included but not
    used.
    
    To test:
    1. Apply this patch
    2. Run:
       $ git grep 'Koha::ArticleRequest::Status'
    => SUCCESS: There aren't any calls to their defined constants in
    Biblio.pm or Patrons.pm
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb6ffc0008160b2acf05596bda39c78f8854bd17
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 22 16:49:33 2021 -0300

    Bug 29086: Simplify querying active article requests
    
    This patch makes a trivial replacement of a query for a higher level
    method that does the same query.
    
    To test:
    1. Enable the ArticleRequests feature
    2. Place some article requests on known biblios
    3. Have some article requests be active on others finished (either
       completed or cancelled)
    4. Go to the detail page for those records
    => SUCCESS: The active article requests count is correct!
    5. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f968a65793b877e3118fa347cba542e629acde9d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 22 16:19:21 2021 -0300

    Bug 29084: Update article requests-related Koha::Biblio methods to use relationships
    
    This patch makes Koha::Patron->article_requests use the underlying DBIC
    relationship and _new_from_dbic instead of a plain search. It also
    refactors 'article_requests_current' and 'article_requests_finished' to
    use ->article_requests, as well as the new methods introduced by bug
    29082 for filtering.
    
    No behavior change should take place.
    
    To test:
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Biblio.t \
               t/db_dependent/ArticleRequests.t
    => SUCCESS: Tests pass!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 29084: Unit tests
    
    This patch adds missing tests for Koha::Biblio->article_requests and
    reorganizes (and extends) the tests for 'article_requests_current' and
    'article_requests_finished' that were originally in ArticleRequests.t
    into Koha/Biblio.t as we do now.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/ArticleRequests.t \
               t/db_dependent/Koha/Biblio.t
    => SUCCESS: Tests pass!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 29084: Remove article_requests_finished and article_requests_current
    
    This patch removes those methods that are not really needed. Templates
    are adjusted to use the expected combination of
    ->article_requests->filter_by_current.
    
    To test:
    1. Apply this patch
    2. Visit a biblio with article requests
    => SUCCESS: All works
    3. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Biblio.t
    => SUCCESS: Tests pass, less tests.
    4. Sign off :-D
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 02db36b95ce3611f818fb2fd2c3d37632e2b5d10
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 22 15:46:26 2021 -0300

    Bug 29083: Update article requests-related Koha::Patron methods to use relationships
    
    This patch makes Koha::Patron->article_requests use the underlying DBIC
    relationship and _new_from_dbic instead of a plain search. It also
    refactors 'article_requests_current' and 'article_requests_finished' to
    use ->article_requests, as well as the new methods introduced by bug
    29082 for filtering.
    
    No behavior change should take place.
    
    To test:
    1. Apply the unit tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t \
               t/db_dependent/ArticleRequests.t
    => SUCCESS: Tests pass!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 29083: Unit tests
    
    This patch adds missing tests for Koha::Patron->article_requests and
    moves (and extends) tests for 'article_requests_current' and
    'article_requests_finished' that were originally in ArticleRequests.t
    into Koha/Patron.t as we now do.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/ArticleRequests.t \
               t/db_dependent/Koha/Patron.t
    => SUCCESS: Tests pass!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 29083: (QA follow-up) Remove unused param
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 29083: Fix OPAC listing of article requests
    
    This patch makes the OPAC template reuse a precalculated value for the
    active article requests for the patron (and its count).
    
    The original code relied on the methods returning a list, which is not
    the case for _new_from_dbic until bug 28883 is pushed.
    
    This patch fixes that.
    
    Note: there was an odd behavior when ArticleRequests was enabled but no
    active article requests were present: the tab wasn't rendered but the
    'empty table' with the 'You have no article requests currently.' message
    was displayed below the Checkouts tab. I'm not sure that was caused by
    this patches, or other. Fixed on this patch.
    
    To test:
    1. In the OPAC, go to 'your summary'
    => FAIL: Things don't show for article requests
    2. Add some article requests and repeat 1
    => FAIL: Something's wrong there
    3. Apply this patch and repeat 1
    => Yes! Things show correctly!
    4. Cancel all your article requests
    => SUCCESS: Things render as they should
    5. Re-enter the 'your summary' page (to force re-rendering)
    => SUCCESS: Things render correctly for empty article requests
    6. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Bug 29083: Remove article_requests_finished and article_requests_current
    
    This patch removes those methods that are not really needed. Templates
    are adjusted to use the expected combination of
    ->article_requests->filter_by_current.
    
    To test:
    1. Apply this patch
    2. Visit a patron with article requests
    => SUCCESS: All works
    3. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => SUCCESS: Tests pass, less tests.
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f74dff45374e8a801652b95643e5b869616c04db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 4 12:44:51 2021 +0200

    Bug 29082: Simplify tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ae273ddcbe80f65ace0445f2cba139dfe579c72
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 22 15:23:07 2021 -0300

    Bug 29082: Add filtering methods to Koha::ArticleRequests
    
    This patch adds handy methods for filtering Koha::ArticleRequests
    resultsets.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/ArticleRequests.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 861bce53c314eb410c2a87229b33aca70f882814
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Oct 6 13:44:16 2021 -0300

    Bug 27526: (QA follow-up) Wrap tests in transaction
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96029f226dfe776c53124b1c00b4128421809fc9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 15:45:17 2021 +0200

    Bug 27526: Improve robustness of tests
    
    * Could fail if not using the original sample data: build the AV we need
    instead of relying on what is in the DB
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aed1e4cb7a6279e71514b1f890668a87d191c3a3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 15:53:47 2021 +0200

    Bug 27526: Fix perlcritic in tests
    
    Problem while critiquing "t/db_dependent/Koha/Item.t": Can't parse code: Encountered unexpected character '195'
    
    non-ascii chars must be quoted when used as hash keys
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4f533776c609463a88db560f447874f351e8d131
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jan 14 09:47:46 2021 -0500

    Bug 26352: Switch from using call() to call_recursive()
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec3bce4fa1de3a080db2d38904c0bfc0f71d1b98
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Nov 20 14:13:39 2020 +0000

    Bug 26352: (QA follow-up) Add additional tests
    
    This patch adds additional unit tests for autoMemberNum handling and
    corrects the implimentation there.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b00aab7052490a2e1acf42295bc6e2772c26d6d3
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Nov 20 08:32:14 2020 -0500

    Bug 26352: Replace call to barcode_generate with call to patron_barcode_transform
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0b2554d5f0d3828d6b558a8f22e9ddfd558aa07
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Nov 12 13:34:33 2020 -0500

    Bug 26352: Add unit test
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aea8ce7fccf4b2e09de74d12d2d0e03bfaea65c0
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Sep 2 09:22:57 2020 -0400

    Bug 26352: Add plugin hooks to transform patron barcodes
    
    Some of our partners have unusual barcode requirements that have
    required us to transform scanned barcodes using javascript. This is not
    the most reliable method. It would make more sense to have Koha
    transform the barcodes on the backend using a plugin. We should add
    hooks to transform and generate new item and patron barcodes.
    
    Test Plan:
    1) Apply this patch
    2) Download and install the Barcode Transformer plugin
       https://github.com/bywatersolutions/koha-plugin-barcode-transformer/releases/download/v1.0.1/koha-plugin-barcode-transformer-v1.0.1.kpz
    3) Go to the plugin configuration page, set the configuration to the example configuration from the same page
    4) In the patron search and anywhere else you can scan a patron
       cardnumber, type in some cardnumbers but prefix them with A and postfix
       them with A or B, e.g. A12345A, A12345B
    5) Note the letters are removed by Koha!
    6) Try a cardnumber like X123456Y
    7) Note Koha converts it to Z13456Z
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b2b1483f4d829512b7d92723b587a7f060de57bb
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Sep 2 09:17:31 2020 -0400

    Bug 26351: Add plugin hooks to transform item barcodes
    
    Some of our partners have unusual barcode requirements that have
    required us to transform scanned barcodes using javascript. This is not
    the most reliable method. It would make more sense to have Koha
    transform the barcodes on the backend using a plugin. We should add
    hooks to transform and generate new item and patron barcodes.
    
    Test Plan:
    1) Apply this patch
    2) Download and install the Barcode Transformer plugin
       https://github.com/bywatersolutions/koha-plugin-barcode-transformer/releases/
    3) Go to the plugin configuration page, set the configuration to the example configuration from the same page
    4) In the item barcode field on the checkin and checkout pages,
       and anywhere else you can scan an item barcode, type in some
       valid barcodes, but prefix them with X and postfix them with
       Y, e.g. X123456Y
    5) Note the letters are removed by Koha!
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: (QA follow-up) Fix QA script issue
    
    * Fixes issue with barcode generate stub so perlcritic is happy
    * Removes extra semicolon from return call in configure method
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: Add unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: (QA follow-up) Remove unused method barcode_transform
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: (QA follow-up) Rename barcode_transform to item_barcode_transform
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: (QA follow-up) Barcodes inputted into Koha should always pass though barcodedecode
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: (QA follow-up) Catch one last case of itemBarcodeInputFilter
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: (QA follow-up) Fix Checkouts.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: Use call_recursive() as a replacement for call()
    
    The method `call()` is not sufficient for barcode transformations. It's
    possible that more than one barcode transformation plugin will be
    installed. The `call_recursive()` method takes the output of the first
    plugin and uses it as the input for the next plugin and so on. This allowes
    each plugin to see the current version of the barcode and modify it if
    necessary.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 26351: Fix t/db_dependent/Koha/Plugins/Circulation_hooks.t
    
    Bug 26351: Revert improper change to unit test, fix number of tests
    
    Bug 26351: Remove uneeded use Koha::Plugins statements
    
    Left over from previous changes
    
    Bug 26351: Add missing barcodedecode import
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc68d49897900fb365e3016ba38fbc10be77d14f
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Mar 23 16:07:20 2021 +0000

    Bug 28026: Add call_recursive() as a supplement for call()
    
    The method call() is not sufficient for all plugin hook types. It's
    possible that more than one plugin will be installed that wants to
    return the arguaments passed in an updated form.  These transformation
    plugins need to work recursively rather than independantly.
    
    This patch adss a `call_recursive()` method that takes the output of
    the first plugin and uses it as the input for the next plugin and so
    on. This allowes each plugin to see the current version of the arguament
    list and modify it as necessary.
    
    Test plan
    1/ Run the included tests - t/db_dependent/Koha/Plugins/Plugins.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ce74ab1330b4eedfa3502c85a4a6b8bdb009bd9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 14:55:45 2021 +0200

    Bug 25429: DBRev 21.06.00.030
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c0f722a3ad944a3811199e67ab88af9cd55328b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Oct 1 08:45:48 2021 +0000

    Bug 25429: (QA follow-up) Add extra variable for days
    
    I think it is a bit more clear to use another variable for the
    number of days from the preferences than overwriting the flag
    variable.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested by adding an authval for LOST.
    Filling prefs ClaimReturnedLostValue, CleanUpDatabaseReturnClaims.
    Claiming a return, resolving it. Setting date back via SQL.
    Running the script with -v --return-claims, toggling --confirm.
    The claim is counted and deleted with confirm.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e4c7ce2129d093fb7a3f6415691814ea2bae36c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu May 13 09:28:36 2021 -0400

    Bug 25429: Require command line switch to enable, control DAYS via syspref
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f28e817ea57a2dddb0fc803e0caf56170e45c489
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Apr 6 09:16:52 2021 -0400

    Bug 25429: Use filter_by_last_update
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a8dc21a6a4d557dd09d1f41ed4770657b494d72
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jan 12 07:55:22 2021 -0500

    Bug 25429: Script should be able to run with only return claims
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e18cfe0731941a6aeba841e49b7ad09a5fd04cb2
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri May 8 14:02:34 2020 -0400

    Bug 25429: Cleanup Database - remove resolved claims returned from db after X days
    
    Add option to cleanup_database script to removed 'resolved' return claims from the database after a specified number of days.
    
    Test Plan:
    1) Apply this patch
    2) Set the new syspref CleanUpDatabaseReturnClaims to a number of days
    3) Run cleanup_database.pl
    4) Note resolved claims older than the specified number of days are removed from the database
    
    Bug 25429: Implement system preference, remove command line switch
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Rebecca Coert <rcoert@arlingtonva.us>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 478ffeae6030bc774f8b752b3c19e75879a3bad9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Mar 22 13:29:13 2021 +0000

    Bug 27032: (follow-up) Pass rather than fetch variables
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c862fd13823633266ac3206bbce4d44cd65715bd
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Nov 16 15:49:07 2020 +0200

    Bug 27032: Move auto renewal code out of CanBookBeRenewed
    
    This moves the checks related to whether auto renewal can be done on
    the checkout to its own function _CanBookBeAutoRenewed(). This makes
    it more clear which parts of the code are related to auto renewal
    checking and which are not.
    
    To test:
      1) Make sure prove t/db_dependent/Circulation.t still passes
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b246015cad44fb2b1cec9ac7dbd3345f19312612
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Nov 16 14:00:15 2020 +0200

    Bug 27032: Remove unused variables
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc1c2cbaaf63a89e76b056781270902a7cd7c475
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 2 14:47:09 2021 +0200

    Bug 27526: Add tests for columns_to_str and host_items
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33d4367cd81ad79f267583644d6b9b694b518bac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 30 16:25:04 2021 +0200

    Bug 27526: Add missing POD
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6560049c65d911905090afa3bf261984fa4b35f1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 23 15:16:32 2021 +0200

    Bug 27526: Fix cn_source display
    
    For an unknown reason C4::Biblio::GetAuthorisedValueDesc (that we are
    calling from Koha::Item->columns_to_str) does not deal with class
    sources.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f1d78e8750a5c02e0e6e73f4185a5ffc18bed83
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 21 11:24:27 2021 +0200

    Bug 27526: Fix encoding issue on subfield
    
    If you have a "é" subfield it should work!
    
    Note that VARCHAR(1) for binary means 1-byte (from MySQL doc):
    "For example, if the default character set is utf8mb4, CHAR(5) BINARY is
    treated as CHAR(5) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin. This
    differs from BINARY(5), which stores 5-byte binary strings that have the
    binary character set and collation."
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5c0c400e16212b390eba9ca54bdd21a945dfe631
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 20 14:49:48 2021 +0200

    Bug 27526: Remove uneeded call to TransformMarcToKoha
    
    And also clean some imports.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b21be4f35eb4c68ce05603c630f508439e31573c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 20 12:09:55 2021 +0200

    Bug 27526: Fix empty string vs undef
    
    Empty strings must be removed, not inserted as empty strings in DB.
    The relevant code is in TransformHtmlToXml, $skip variable.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c4cccec97e18b8e29ad7423fb97836e6370b644
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 20 11:45:25 2021 +0200

    Bug 27526: Fix incorrect condition
    
    The barcode was always prefilled!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 738ffb504729d139f19afd12cbc37b59e9d1937e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 9 10:03:26 2021 +0200

    Bug 27526: Fix Add multiple copies
    
    This has been moved to Koha::Item->store by bug 27545.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1439243ac4f3d5962f40054379e50b5a31a4a048
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 9 10:00:05 2021 +0200

    Bug 27526: Fix Add & duplicate
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d6fc598a43feedb521b2915a1e01f6b9baed132
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 9 09:24:19 2021 +0200

    Bug 27526: Fix PrefillItem
    
    We are basically adding:
      $current_item = $item->unblessed;
    
    Other changes are for readability
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ed29bccef590a1bc5e4cea175b41b8024483320
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 8 15:48:36 2021 +0200

    Bug 27526: Fix mandatory and important checks
    
    The input names have been changed from "field_value" to $kohafield.
    Modifying this could have an impact in other area, where
    CheckMandatorySubfields and CheckImportantSubfields are called.
    Using .input_marceditor let us fix the additem.tt form and prevent to
    break the other ones.
    Note that the other ones are actually broken (!)
    
    Also note that there is a typo in the error message
            alertString2 += "\n- " + "%s " + MSG_MANDATORY_FIELDS_EMPTY.format(total_errors);
    There is an extra %s
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9341e74aa265037c9f47a5a2d69538a3c3a7cbd1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 8 15:32:59 2021 +0200

    Bug 27526: Fix repeatable more subfields
    
    We retrieved always the first value.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f02fb9b375d924040886a4014f20cf1ed4972b19
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 23 10:35:54 2021 +0200

    Bug 27526: Improve grep for date fields
    
    'replacementpricedate' should not catch 'price'
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a8357f7099d0863a322d1e91741b792b97fd6e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jan 25 11:55:38 2021 +0100

    Bug 27526: Adjust code to use Koha::Items
    
    Not that we removed all the transformations of the item and are using
    Koha::Item from DB to TT (and the other way around), some code needs
    adjustments.
    
    - Retrieve host items can be simplified (see Koha::Biblio->host_items)
    - Some TT variables have been renamed for better understanding
    - Koha::Item->columns_to_str return a hashref with the representation
    string of the columns. A date will return the value how it must be
    displayed, using output_pref. A subfield linked with a AV will be
    replaced with the AV's description.
    - LastCreatedItem cookie serializes and stores Koha::Item->unblessed,
    no longer the MARC::Record
    
    Change in behaviour: If a subfield is linked with a AV cat and the value
    is not a valid AV, before this patch the column was displayed with an
    empty value. Now the column is hidden, it's considered empty.
    In the sample data it happens with itemlost (0) and withdrawn (0).
    
    Test plan:
    1. Test the Prefill
     a. Turn PrefillItem on
     b. Fill in SubfieldsToUseWhenPrefill with some subfield codes
     c. Catalogue an item, save
     => The values from subfields listed in SubfieldsToUseWhenPrefill must be
     kept
    2. more subfields
     a. Add subfields that are not linked with a koha field (k is available)
     b. Create an item and fill in all the values
     c. Confirm that non linked subfields are stored and displayed correctly
     d. Try with a "more subfield" that is linked with an authorised value
     category
    3. Test barcode values
    4. Test the different "Add" buttons at the bottom of the form
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13557d1646dac6a43aa33d63576984efceddb800
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 22 11:46:38 2021 +0100

    Bug 27526: Remove AddItemFromMarc from additem
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96826fd2d00d0c33631e5767445001b1f6909bf5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 22 11:24:58 2021 +0100

    Bug 27526: Remove ModItemFromMarc from additem
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 075c8a96b387efebf40601debc347c4a33607e51
Author: Andreas Jonsson <andreas.jonsson@kreablo.se>
Date:   Tue Aug 31 12:50:03 2021 +0000

    Bug 28930: Keep cardnumber be editable after server side form validation fails during self registration.
    
    Test plan:
    
    - Enable the system preference PatronSelfRegistration
    - Make sure  PatronSelfRegistrationBorrowerUnwantedField does not
      contain cardnumber.
    - Set the system preference  GDPR_Policy to "Enforce".
    - In the OPAC click "Log in to your account" and "Register here".
    - Fill out the form with valid data, but make sure you leave the
      checkbox under "GDPR consent" unchecked.
    - Submit the form
    - You will get back the form with the error message "You have not filled
      out all required fields. Please fill in all missing fields and
      resubmit."
    - Without patch: cardnumber is not editable, and there is no input
      element for borrower_cardnumber (so the cardnumber will be lost when
      resubmitting the form)
    - With patch: cardnumber is editable.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eefbe9bf3fa2390f1f3ab4063a292358b7dd2548
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 11:32:17 2021 +0200

    Bug 27945: (follow-up) Add tests
    
    Restore +x flag
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0c755efd1fe43ec6fafe3155b3477bf14e8f8396
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Oct 6 11:42:48 2021 +0200

    Bug 27944: Fix t/db_dependent/AuthorisedValues.t
    
     #   Failed test 'The second category should be correct (ordered by category name)'
     #   at t/db_dependent/AuthorisedValues.t line 141.
     #          got: 'AR_CANCELLATION'
     #     expected: 'av_for_testing'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bebe7a1c10ce4e16a6c42d6fcb370a4a3da11b62
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 5 11:44:01 2021 -0300

    Bug 27947: (QA follow-up) Fix shipped notice
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e85290a7032221d61c0473a28138752cba415e1a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 5 11:10:10 2021 -0300

    Bug 27947: (QA follow-up) Make parameters a hashref
    
    This patch makes the Koha::ArticleRequest->cancel parameters into a
    hashref. (Missing) tests are added for those parameters being set as
    well.
    
    Calls to ->cancel are updated.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/ArticleRequest.t \
               t/db_dependent/api/v1/article_requests.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fccde3acdd883a6df4ff0d0f28069fca16124db
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 11:44:02 2021 +0200

    Bug 27947: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 924bcc5754e9dd8a601e0b2e58156873ebe260d5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 11:34:52 2021 +0200

    Bug 27947: DBRev 21.06.00.029
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c4a1b19aa86b246ea2528a6f1a33401d1007fae
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 17 15:39:17 2021 -0300

    Bug 27947: (QA follow-up) Clarify permissions
    
    Privileged routes need permissions defined. This patch adds the minimum
    required permission until there are article request-specific permissions
    in Koha: circulate: circulate_remaining_permissions
    
    It is also clarified that interacting with an article request  from
    another patron, but having your own patron_id in the path would return
    404 instead of 403, as technically the resource (an article request from
    the patron, identified.by the supplied id) doesn't exist.
    
    Tests are tweaked.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77506a474a799928779c14620666bc9b27ffd697
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 17 17:09:58 2021 +0100

    Bug 27947: (QA follow-up) Update test to highlight issue
    
    This addition to the tests highlights a permissions/security check
    error.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b3bc8c21b25d31bb7d38f9af5c53740e7ce76a6c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Sep 17 16:46:14 2021 +0100

    Bug 27947: (QA follow-up) Remove incorrect permission check
    
    The API was checking for 'reserverforothers' permission, but that
    doesn't make sense to apply here.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9b4cee4e9983bdb773729b3fbd39b503010e7a9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 17 12:13:09 2021 -0300

    Bug 27947: Add regression tests for routes
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc79aa0f40f50f6c0d26fecf249b0b69fd3dc7ba
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Sep 17 11:42:34 2021 -0300

    Bug 27947: (QA follow-up) Refactor routes
    
    This patch refactors the route specs a bit, and also reorganizes code
    for easier tracking.
    
    Unused exceptions that were added earlier are removed for now.
    
    A follow-up patch will add tests to this routes.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c53a907c66aab7f932f3bf09924084935aae5962
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 17 09:06:08 2021 +0000

    Bug 27947: (follow-up) Add OPAC cancellation as new reason too
    
    Something that currently comes up now already too:
    If the user cancels from the OPAC page, there is no reason in the notice.
    We could simply add one now.
    
    Test plan:
    Run dbrev to add the OPAC authval.
    Create new AR and cancel it from OPAC.
    Verify notice created for the user.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c76399c42ef5c6124f5119a63a8c2f86c70b95a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 17 08:38:44 2021 +0000

    Bug 27947: (follow-up) Improve atomic update
    
    We do not need to replace the whole notice text, we only need to
    replace the reference to article_requests.notes.
    
    Test plan:
    Run the dbrev. Verify result for notice AR_CANCELED.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a10af0620330b80841e67d4563227ef7c9d79a07
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Aug 19 23:51:38 2021 -0300

    Bug 27947: Add cancellation reason to article request
    
    This bug adds a cancellation reason authorised values to article requests
    
    To test:
    1. apply this patch
    2. updatedatabase
    3. in staff interface go to /cgi-bin/koha/admin/authorised_values.pl
    CHECK => AR_CANCELLATION category should appears
    4. place several article requests
    5. in staff interface go to /cgi-bin/koha/circ/article-requests.pl
    6. select multiple requests, or just one and cancel them
    SUCCESS => a modal pops up offering to select a cancellation reason
    CHECK => message_queue table has messages with cancellation reason included
    7. repeat steps 4 to 6 but for /cgi-bin/koha/circ/request-article.pl
    8. cancelling article requests from opac interface should work just as before
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b73fac8105aa8968ce87f7a11193820cc767f4c
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Aug 19 23:00:26 2021 -0300

    Bug 27947: Add authorised values list in article requests cancellation
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 788afd38c78ecccf87f0fb38a980f5f2c52cb314
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Oct 5 12:02:12 2021 -0300

    Bug 27945: Terminology: max daily => open requests limit
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96b1c3fa00b84093dde728e8d62f1f1db0298677
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 11:30:37 2021 +0200

    Bug 27945: Don't save rule if not defined
    
    The DB rev added a row with NULL (unlimited), and the UI a row with ''
    (unlimited as well) when saved without value.
    
    Better is to not have a row (still unlimited)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 82155cdf35fa215e3d7bc600951f7594e4d166c3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Oct 4 12:08:12 2021 -0300

    Bug 27945: Fix error handling and translatability
    
    This patch adds better error handling and reporting when placing an
    article request fails. It also makes the error messages translatable.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c4fa722df7996b18db1a6dfd9e9c265468b5ecc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Oct 4 09:43:11 2021 -0300

    Bug 27945: Implement limits using circulation rules
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 558977ac229f8547c8b1fd190c6209762d0b10a5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Oct 4 09:14:16 2021 -0300

    Bug 27945: Add max_daily_article_requests circulation rule
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ed86ec73084937981092c623d548913954ae2214
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 30 15:57:00 2021 -0300

    Bug 27945: Clarify 'same day' behavior
    
    This patch introduces tests for the 'same day' check of the ability to
    place article requests for a patron.
    
    The limit goes against current requests, and those that have been
    completed on the same day. The tests cover this specific situation.
    
    The current behavior is that it takes into account a 24 hr timespan, but
    consensus on the QA step was that we should do it as 'same day' and use
    a separate feature request to change this, if required.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Patron.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ccfaa0d0335382f8ba66f1d2dea5972e2116ccd
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Jul 27 12:20:46 2021 -0300

    Bug 27945: Add limit article request feature
    
    This patch makes it possible to limit article requests per patron per day.
    
    To test:
    1. Apply patches
    2. updatedatabase
    3. Enable ArticleRequests preference
    4. Edit a patron category and set an article request limit to 1
    CHECK => if you set the limit to anything else but a positive number or empty string, a warning appears
    5. In staff search biblios and request an article for a patron of the modified category
    6. Repeat step 5
    SUCCESS => if limit is reached, when you select the user to request an article a warning appears saying that the limit was reached
    7. Repeat steps 5 and 6 but this time in opac
    SUCCESS => Patron is not allowed to request another article if limit is reached
    8. prove t/db_dependent/ArticleRequests.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Edit: This patchset originally changed the 'categories' table structure
    and relied on that for limit calculation. I removed all that code and
    squashed into this one, as we moved everything to the circulation_rules
    table.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 712bdd2c7d0b5fdc5d5dca7b25d732ae39f936ac
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Jul 22 00:54:41 2021 +0000

    Bug 27945: Add tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30b3185d7faef3098f7e0a25abb7d4837837857e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 11:42:07 2021 +0200

    Bug 27944: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7db474beffd188aaff47fdec6a7c33c26e3fecf5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Oct 5 11:34:24 2021 +0200

    Bug 27944: DBRev 21.06.00.028
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe2776cc38a25e7e5c24f66d241335d499756d55
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 30 15:05:54 2021 -0300

    Bug 27944: Add missing tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f668504db20c4f9342e8c347e4d7ec0811e0868
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 30 11:55:11 2021 -0300

    Bug 27944: (follow-up) Add POD
    
    The library didn't contain real POD. This patch adds it.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 504deebdfc861ddf7d328ad574f3ea7d6bfbd443
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 22 14:42:28 2021 -0300

    Bug 27944: (QA follow-up) Make atomic update idempotent
    
    This patch checks the DB structure to see if the status column
    definition contains 'REQUESTED' as a valid ENUM value.
    
    The script is also moved into the new style.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9078f2a00832debeb7b4eb9ca7d9fa5a5e5141a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 17 11:03:17 2021 +0000

    Bug 27944: (QA follow-up) Add span to fix pipe separator
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea64bbdda0e3bf4053dd9be55a8d696566bb3702
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 10 13:39:46 2021 -0300

    Bug 27944: (QA follow-up) Make staff home page show new article requests
    
    As exposed on comment 29, the current code is showing the 'pending'
    requests when it should display 'requested' ones (i.e. the new ones).
    
    This patch changes that accordingly.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da29499e0fdd62193c00dd2ec0640d9c367bc4df
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 10 13:16:53 2021 -0300

    Bug 27944: (QA follow-up) Rename ->open for ->set_pending
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60d6b7f3eb0397d0e454702bd2ad662325bc7bed
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 10 13:11:42 2021 -0300

    Bug 27944: REQUESTED is the new default status
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5a21f59245aabbf10cf3cfe996e3911b4f29b3a
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jul 15 06:13:36 2021 +0000

    Bug 27944: (follow-up) Move statuses to constants
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13b5908c87ca689d2a096cea8803f9572c8ca7c9
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 14 15:01:23 2021 +0000

    Bug 27944: (follow-up) Move existing statuses, rename idempotent
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e83e6d743a96847d47074a7ff79a572096cc9cb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 14 14:42:30 2021 +0000

    Bug 27944: (follow-up) Improving consistency between notice names
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19355caa83848d2c9e561ab7c46ea74d270a03b3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jul 8 09:30:34 2021 +0000

    Bug 27944: Add missing Status module
    
    Test plan:
    perl -c the module or run qa tools
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fc76156e29a345bd7e603b390c93303a11463d7
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Mar 30 10:52:31 2021 -0300

    Bug 27944: Add "requested" stage in article request process
    
    This patch adds the stage "requested" in article request process, which
    is previous to pending stage.
    
    To test:
    1. apply this patch
    2. updatedatabase
    3. enable ArticleRequests syspref
    4. from staff inteface and from opac search for a record and place an
       article request
    5. koha-mysql kohadev
    6. query: select subject, content, letter_code from message_queue;
    CHECK => There is a message for each article request with code
    AR_REQUESTED
          => In opac-user.pl, in "Article requests" tab you should see a row
    in the table with "Requested" status
    5. in staff go to Circulation -> Article Requests
    SUCCESS => You should see 3 tabs, one for Requested stage (with two
    requests), one for Pending stage and one for Processing stage.
    6. play with actions buttons
    CHECK => you should see a new action called "Set request as pending"
    SUCCESS => All action buttons behave as expected, and tab counts updates
    correctly.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb0423defe0a39bdb7bfa99fbd9f86dfc195b0d0
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Mar 30 10:51:57 2021 -0300

    Bug 27944: Add AR_REQUESTED message in sample_notices.yml and modify AR_PENDING
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2edfeb9e4d88da6eae927cb4ba2ea1450f0c0834
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Tue Mar 30 10:49:06 2021 -0300

    Bug 27944: Add new letter in atomicupdate, and modify status column in article_requests table
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a913552c8e9fea67c1d4c18017062ed9687428f
Author: Jérémy Breuillard <jeremy.breuillard@biblibre.com>
Date:   Tue Sep 28 13:14:45 2021 +0000

    Bug 29128: Remove the other whitespace in browse shelf link
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c557132e3708df0a355c1d00b2c671cd84d3037
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Sep 27 20:16:22 2021 +0000

    Bug 29128: Remove whitespace in browse shelf link
    
    To test:
    -Turn on OPACShelfBrowser and make sure you have some itemcallnumbers
    -Go to detail page and see the link: (Browse shelf )
    -Apply patch and look at the link again, it should be: (Browse shelf)
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27ead7a75732d11a3af486c19d8ae8443826c124
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 16 15:28:14 2021 +0000

    Bug 29042: Improve formatting of entry form in Additional Contents
    
    This patch makes some corrections to the Additional Contents template so
    that the content entry form can be styled like other similar forms in
    the staff interface.
    
    The patch also updates the form's "title" field so that it is longer and
    has a maxlength attribute matching the size of the table column.
    
    To test, apply the patch and go to Tools -> News.
    
     - Create a new news item.
     - In the entry form, confirm that the "Title" and "Content" fields are
       styled consistently with other similar forms.
     - Confirm that the "title" field is longer.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 683975bbe2f43486286ddb551f5f8f3fe98591a8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 27 16:44:12 2021 +0000

    Bug 29041: (follow-up) Expand the scope of changes
    
    This patch expands the scope of the original changes to add consistency
    to the non-edit views.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c2cd3e623a92d8280360347e9713096e27d152b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 16 15:14:52 2021 +0000

    Bug 29041: Improve specificity of breadcrumbs in Additional Contents
    
    This patch adds a link to news or HTML customizations in the breadcrumbs
    navigation depending on which category of content you're adding or
    editing.
    
    To test, apply the patch and go to Tools -> News.
    
     - Begin the process of adding a news item.
     - In the breadcrumbs menu you should see:
       Additional contents > News > Add additional content
     - Clicking "News" should return you to the view of news items.
     - Test the same process in "HTML customizations."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16fd8c10f4ad3824d191ff94c8e359beeecc8681
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 4 15:43:04 2021 +0200

    Bug 29006: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c63337a12aab0286756003775a237f5f7c2b90d8
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 13 14:49:53 2021 +0000

    Bug 29006: Make GoogleOpenIDConnect options consistent in the OPAC
    
    This patch makes modifications to OPAC templates to make the Google
    login options more consistent.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - In the staff interface, enable the GoogleOpenIDConnect preference, and
      populate the GoogleOAuth2ClientID the GoogleOAuth2ClientSecret with
      values (they don't need to be valid).
    - On the OPAC main page you should see a "Log in with Google" button
      above the Koha login form.
    - If you click the "Log in to your account" link at the top of the page
      you should see a "Log in with Google" button in the modal window
    - If you navigate directly to /cgi-bin/koha/opac-user.pl when not logged
      in you should see the same "Log in with Google" button on that page.
    - In each case the Google button should point to /cgi-bin/koha/svc/auth/googleopenidconnect
    - If you disable GoogleOpenIDConnect the buttons should disappear.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0aa44b802f04fe15574c771abf63ef2de0e944c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 13 13:37:55 2021 +0000

    Bug 29004: Update GoogleOpenIDConnect preference to make it clear that it is OPAC-only
    
    This patch modifies the description of the GoogleOpenIDConnect and
    related preferences to make it clear that GoogleOpenIDConnect affects
    OPAC logins and that the preferences are related.
    
    To test, apply the patch and go to Administration -> System preferences.
    
    Search for "google," and confirm that the descriptions of
    GoogleOpenIDConnect and related preferences look clear and correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b70a9a29d77f4109b082fe6ed57cc44f3c2bae4f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 8 11:15:00 2021 +0000

    Bug 28983: Use Flatpickr on various pages
    
    This patch replaces the use of jQueryUI's datepicker on various
    unrelated pages.
    
    To test, apply the patch and test the following pages to confirm
    that datepickers work correctly. "Linked" date fields should prevent a
    "to" selection which preceeds the selected "from" date.
    
    - Tools -> Patron clubs -> New club: Linked "start date" and "end date"
      fields.
    - ILL requests: Two linked pairs of date fields in the sidebar, "Date
      placed between" and "Updated between." Each pair should work correctly
      and table filtering by date should work correctly.
    - Tools -> Label creator -> Manage -> Layout batches -> Edit a batch ->
      Add items. This should trigger a popup window with a linked pair of
      date fields, "Added on or after date," and "Added on or before date."
    - Point of sale -> Transaction history: "From" and "To" linked date
      field in the "Older transactions" section.
    - Acquisitions -> Suggestions -> Add a suggestion: "Created by,"
      "Accepted on," and "Managed by" fields.
    - Tools -> Tags -> Filter tags by date.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89dfbe654b1d6fe945d0a344d2e3cb2b526f679a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 7 14:14:54 2021 +0000

    Bug 28961: Use Flatpickr on tools pages
    
    This patch replaces the use of jQueryUI's datepicker on tools pages.
    
    To test, apply the patch and test the following tools pages to confirm
    that datepickers work correctly. "Linked" date fields should prevent a
    "to" selection which preceeds the selected "from" date.
    
     - News -> New entry: Linked fields "Published date" and "Expiration
       date".
     - Batch extend due dates: Linked fields "Due date from" and  "Due date
       to"; "Hard due date" field.
     - Batch patron deletion: "who have not borrowed since," "whose
       expiration date is before," and "Permanently delete checkout history
       older than."
     - Export: Linked "Start date" and "End date" fields.
     - Import patrons -> Enter default values: "Date of birth,"
       "Registration date," and "Expiry date."
     - Inventory: "Set inventory date to."
     - Batch patron modification -> Submit a batch of cardnumbers or a
       patron list: "Registration date," "Expiry date," and "Restriction
       expiration."
     - Task scheduler: "Date" field.
     - Log viewer: "Display from" and "Display to" linked fields.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cde87a34a182e30a08f11988ed9dbeb5692a0570
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Sep 7 12:44:06 2021 +0000

    Bug 28958: Use Flatpickr on serials pages
    
    This patch replaces the use of jQueryUI's datepicker on serials pages.
    
    To test, apply the patch and test the following serials pages to confirm
    that datepickers work correctly. "Linked" date fields should prevent a
    "to" selection which preceeds the selected "from" date.
    
    - Claims -> Choose vendor -> Filter missing issues (linked "from" and
      "to" fields).
    - Check expiration -> "Expiring before" field.
    - Manage numbering patterns -> New numbering pattern -> "First issue
      publication date" field.
    - Serials advanced search -> "Expires before" field.
    - Subscription search results -> Check multiple checkboxes -> Edit
      selected serials: "Expiration date" field.
    - Subscription details -> Serial collection -> Edit serials ->
      "Published on" and "Expected on" fields.
    - Subscription details -> Renew -> "Start date" field in the popup
      window.
    - Subscription details -> Edit subscription -> Page 2 -> "First issue
      publication date," "Subscription start date," and "Subscription end
      date" fields.
    - Locate a subscription with manual history enabled. From the
      subscription detail page, click the "Planning" tab, then "Edit
      history" -> Linked fields "Subscription start date" and "Subscription
      end date."
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09f011493c42f5372666b9d8dba5fb923f7b8680
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 3 17:27:00 2021 +0000

    Bug 28949: Use Flatpickr on reports pages
    
    This patch replaces the use of jQueryUI's datepicker on reports pages.
    
    To test, apply the patch and test the following reports pages to confirm
    that datepickers work correctly. "Linked" date fields should prevent a
    "to" selection which preceeds the selected "from" date.
    
    - Acquisitions statistic wizard: Linked pairs of fields for
      "placed on" and "received on."
    - Patrons with the most checkouts: Linked pairs of fields for
      "Checkout date from" and "Check-in date from"
    - Patrons who haven't checked out: "Not checked out since"
      field.
    - Cash register statistics wizard: Linked "From" and "To"
      fields.
    - Most-circulated items: Linked pairs of fields for
      "Checkout date from" and "Check-in date from"
    - Catalog statistics wizard: Linked pairs of fields for "Date acquired
      (item)" and "Date deleted (item)" The latter is shown by checking the
      "Count deleted items" radio button.
    - View dictionary -> New definition:
      - Enter a definition name
      - Select table Circulation
      - Choose a date column, e.g. "Date of birth" or "Registration date"
      - Select "Date range"
        - Test that the "Start of date range" and "End of date range" fields
          are linked correctly.
    - Create guided report:
      - Module: catalog
      - Type: Tabular
      - Select columns (any)
      - Select criteria to limit on: There should be three pairs of linked
        fields, "Creation date," "Modification date," and "Due date."
      - Confirm that the report is saved correctly with the dates you chose.
    - Create from SQL -> Test a report with one or more date
      fields, e.g. https://wiki.koha-community.org/wiki/SQL_Reports_Library#Items_added_by_Collection
    - Average loan time: Linke pairs of fields for "Checkout
      date" and "Returns."
    - Reports -> Circulation statistics wizard: Linked "Period" fields.
    - Reports -> Holds statistics wizard: Linked pairs of fields "Hold
      date," "Notification date," "Reminder date," "Waiting date," and
      "Cancellation date."
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7ec0773715188cc4e2376d9c87035b226f063491
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Sep 3 11:35:47 2021 +0000

    Bug 28945: Use Flatpickr on administration pages
    
    This patch updates administration templates to use Flatpickr instead of
    jQueryUI datepickers.
    
    To test, apply the patch and test date fields on the following pages:
    
    - Administration -> Budgets ->
      - New budget: Linked "Start date" and "End  date" fields.
      - Duplicate budget: Linked "Start date" and "End  date" fields.
    - Acquisitions -> Vendor -> New contract: Linked "Start date" and "End
      date" fields.
    - Administration -> Circulation and fine rules: "Hard due date" and "No
      automatic renewal after" fields.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a662146866ac327a2d9e61031eec8ba220974a03
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 2 14:36:07 2021 +0000

    Bug 28942: Use Flatpickr on acquisitions pages
    
    This patch modifies several acquisitions pages replacing jQuery
    datepickers with Flatpickr widgets.
    
    To test, apply the patch and test datepickers on the following
    Acquisitions pages:
    
     - Acquisitions -> Late orders (linked date fields in the sidebar)
     - Acquisitions -> Invoices (linked date fields in the sidebar)
     - Acquisitions -> Invoices -> Invoice details (shipment date and
       billing date)
     - Acquisitions -> Vendor -> Receive shipment (shipment date)
     - Acquisitions -> Vendor -> Receive shipment -> Receive (on order line)
       -> Date received field under "Accounting details
     - Acquisitions -> Orders search tab in the header -> Advanced search:
       Linked date fields in the search form."
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 30f1d730cadac7c186f3c053747a1e5e2ac36f62
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 18 12:48:08 2021 +0000

    Bug 28720: (follow-up) Improve string translation
    
    This patch fixes the following issues raised by QA:
    
    - It modifies the markup so that "Add note" and "Edit note" can be
      translated more easily.
    - It adds display of existing notes back to the table of checkouts.
    - It adds to the table configuration so that a "plain" view of the notes
      (without buttons) is shown in print view and in CSV export.
    - It improves handling of notes containing quotation marks which would
      previously have broken some edit interactions.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c49671ca84efde4e9083b6befbe3222d72f3782
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 26 15:27:02 2021 +0000

    Bug 28720: Update the process of adding a checkout note in the OPAC
    
    This patch moves the entry of checkout notes into a modal window with
    the goal of making note entry easier.
    
    To test, apply the patch and make sure the AllowCheckoutNotes system
    preference is enabled.
    
    - Log in to the OPAC as a user with checkouts.
    - On the "Your summary" page, confirm that the table listing your
      checkouts has a "Report a problem" column with "Add note" buttons.
    - Click an "Add note" button. A modal window should be shown which
      includes the title of the item, a textarea for writing a note, and a
      hint, "Your note will be shown to the librarian when the item is
      checked in."
    - Add a note and submit it.
    - The modal should close and a note at the top of the page should tell
      you your note has been saved. The contents of your note should be
      shown below that along with an "Edit note" link.
      - Confirm that the "Edit note" link works as expected.
      - Confirm that the "Add note" button you clicked in the table of
        checkouts now reads "Edit note."
        - You should be able to click this button and edit your note.
    - Confirm that each note button works to add a note to the correct
      title.
    - Confirm that the "Renew selected" and "Renew all" controls work.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ef49ac0f82eb24be3a07ec6855321477d5cb796
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Oct 4 15:10:44 2021 +0200

    Bug 28321: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3657a6fca1dc48f1f6b5f4b34692de9e10fdc460
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 30 10:36:42 2021 +0000

    Bug 28321: Use template block for display of items in search results
    
    This patch updates the staff interface catalog search results to use
    a new reusable BLOCK for displaying item information: Available items,
    checked-out items, and unavailable items.
    
    Some style has been updated, and an old GIF image has been replaced with
    an SVG. The hold ratios template has been updated to accommodate this
    change.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Perform a catalog search in the staff interface which will return
      multiple results with multiple items each. For thorough testing, some
      records should have items which are checked out, available, or
      lost/notforloan.
    - On the search results page, confirm that item information is accurate
      and readable.
    - Test with  item-level_itypes on and off.
    - Test with noItemTypeImages on and off.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba19c4fd9b4d383bcaca153dfd2749376871758a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Sep 27 18:50:48 2021 +0000

    Bug 26949: Upgrade TinyMCE in the staff interface from 5.0.16 to 5.9.2
    
    This patch upgrades TinyMCE in the staff interface from 5.0.16 to 5.9.2.
    Other than the required TinyMCE package files, the only other change is
    to the internationalization include file, which is updated to include
    the latest set of strings for translation.
    
    To test, apply the patch and clear your browser cache if necessary.
    
    Test that the TinyMCE editor works in the staff interface:
    
     - In system preferences, with the  UseWYSIWYGinSystemPreferences
       preference enabled: IntranetCirculationHomeHTML,
       IntranetmainUserblock, IntranetReportsHomeHTML, etc.
     - Additional contents, with the AdditionalContentsEditor preference
       set to "WYSIWYG."
     - Administration -> Libraries, in the "OPAC info" field.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3b28f78bc80dcc6549b75ad10c7886af57e08c7
Author: Michael Hafen <michael.hafen@washk12.org>
Date:   Fri May 7 14:13:49 2021 -0600

    Bug 28303: Fix plugins system with multiple pluginsdir settings
    
    C4/Templates::badtemplatecheck mucks with the config('pluginsdir') array ref.
    This makes sure it operates on a copy of the array.
    
    To test:
       1) $ prove t/db_dependent/Templates.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    JK: Fix commit message styling and add test plan
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb16931d9d544ea7c71c0ddc58dfdfea60393e22
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Oct 3 10:53:40 2021 +0000

    Bug 28303: Add unit test for badtemplatecheck
    
    This tests that pluginsdir value is not modified by the call to
    badtemplatecheck to make sure badtemplatecheck operates with its own
    copy of pluginsdir configuration value.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17a1b0cec5b65176b166327400ba103567e83994
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Jul 21 17:01:23 2021 +1200

    Bug 28734: Parse display in $biblio->get_marc_notes
    
    1. Go to Koha Administration, MARC bibliographic frameworks
    2. Edit a framework, find tag 590, edit the $z subfield to use an
    authorised value.
    3. Do a catalogue search and edit a record using this framework. Edit
    590$z and select an authorised value. Save the record.
    4. Add the record to your cart.
    5. View your cart. Click More Details.
    6. Scroll down to the Notes section. Notice the authorised value code is
    displayed instead of the description.
    7. Apply the patch, restart services.
    8. Refresh your cart. Click More Details again if you need to.
    9. Scroll down to the Notes section. The description of the authorised
    value should now be displayed.
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 28734: (follow-up) Use transformMARCXML4XSLT and tests
    
    Confirm the following tests pass:
    - t/db_dependent/Koha/Biblio.t
    - t/db_dependent/XSLT.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 28734: (QA follow-up) Fix test imports and readability
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 28734: (QA follow-up) Update documentation about function usage
    
    We are now using the function from Koha::Biblio.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 28734: Remove unadvertised changes
    
    1. Using $frameworkcode instead of the default '' is an unadvertised change.
    It would make sense to use $frameworkcode, but actually we must remove this parameter and always use the default, as we decided to make the default authoritative.
    I would prefer to not introduce this change, just in case..
    
    2. Restore good import (use plurals)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74e5353539a984c76b494cb232fb42b61d11da6b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 29 11:05:04 2021 +0200

    Bug 29133: Correct select2 strings
    
    We are using 'max'/'min' when the arguments are 'maximum'/'minimum'.
    Also using %n, %d when only %s is working in .format()
    
    Have a look at https://github.com/select2/select2/blob/45f2b83ceed5231afa7b3d5b12b58ad335edd82e/src/js/select2/i18n/en.js
    It's Select2 v.4.0.13, the one we are using. We should match what's
    there.
    
    Test plan:
    Bug 29002 is using minimumInputLength, you can see the difference when
    selecting a patron:
     "Please enter %s or more characters"
    vs
     "Please enter 3 or more characters"
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 29133: (follow-up) Fix for argument mismatch
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    JK: fix typo in commit message
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cbf405828a6a048c17a3501a0e2d69a54386b56c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 29 12:26:59 2021 +0000

    Bug 29134: Use a subquery to increase performance of patron attributes search
    
    This patch generates a subquery and checks if a borrowrnumber is in the results to add patrons
    to search results
    
    To test:
     1 - Generate a bunch of patrons:
        SELECT surname, firstname, branchcode, categorycode FROM ( SELECT surname FROM borrowers ORDER BY rand() ) a,( SELECT firstname FROM borrowers ORDER BY rand() ) b,( SELECT branchcode FROM borrowers ORDER BY rand() ) c,( SELECT categorycode FROM borrowers ORDER BY rand() ) d LIMIT 50000
     2 - Add a patron attribute to the system and make it searchable - I used code 'TEST'
     3 - Add a value for this attribute to many patrons:
       INSERT INTO borrower_attributes (borrowernumber,code,attribute) SELECT borrowernumber, 'TEST','alphabet' FROM borrowers LIMIT 10000;
     4 - In staff client got 'Patrons'
     5 - Open the browser console (F12) and view the netwrok tab
     6 - Perform a patron search for 'a'
     7 - Note the time it takes for 'search' to complete in console
     8 - Apply patch, restart_all
     9 - Repeat search
    10 - Note it is much faster
    11 - prove -v t/db_dependent/Utils/Datatables_Members.t
    
    NOTE: I tested with 500k patrons and 100k attributes - search returned in ~2 seconds with patch
    and did not return before I got impatient without patch
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6768848746f17ebd9c23d80b040c197d96a13089
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Sep 30 22:11:32 2021 +0000

    Bug 29148: Check if hold is item or bib level
    
    To test:
    1 - place an item level hold, it says: [one of the barcodes] or any available
    2 - place a bib level hold, it says: [one of the barcodes] or any available
    3 - Apply patch
    4 - item level hold should say: Only [barcode]
    5 - bib level hold should say: [one of the barcodes] or any available
    
    Signed-off-by: Azucena <Azucena.Aguayo@uvu.edu>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b75bda82f8dc304b4fa93754e1c666008350c3c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 18 17:58:38 2021 +0200

    Bug 28717: Fix additional content logs
    
    The logging for additional contents added by bug 26205 has been broken
    by but 22544.
    
    This patch is a revisited version as bug 24387 has been pushed.
    It does not log MODIFY if no modification has been made on a template
    (useful when only 1 version/lang of a content has been modified)
    
    Test plan:
    Turn on NewsLog
    Add/modify and delete additional contents/News and confirm that
    modification are logged.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aca4a763268996b443820dbeeaf969abf0774f34
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 14 19:26:32 2021 +0200

    Bug 24387: Entries with parent are missing a code
    
    We executed the same 2 queries, we want to adjust the code for the
    parent and the language specific row.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58c765c492c14d7b311eb5102684fd594317a5fd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 1 15:55:33 2021 +0200

    Revert "Bug 28510: Remove unnecessary conditional"
    
    This reverts commit d284735d05f67226feba1b4b9e7bf17259eaabaf.
    
    The following test was failing randomly:
     #   Failed test 'take from lowest cost branch (don't use cost matrix) holding branch'
     #   at t/db_dependent/HoldsQueue.t line 1494.
     #          got: 'LHKtxLk'
     #     expected: 'JL9C_OR'
     # Wrong pick-up/hold for first target (pick_branch, hold_branch, reserves, hold_fill_targets, tmp_holdsqueue)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c7eb047126275fe9c38149697ee14c3834acabfe
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 26 11:42:02 2021 +0000

    Bug 28352: Only check authorised values mapped to DB fields
    
    The errors reported seem to be caused by authorised values mapped to MARC fields
    but not mapped to a koha field.
    
    We should additionally make sure to check the Default framework
    
    Also, adding comment to indicate we only check records with items, because we do
    
    TO test:
    1 - In a framework that is not the default map a MARC field to an authorised value, but not a koha field
    2 - In SQL, force the kohafield to NULL for the mapping you just make
        UPDATE marc_subfield_structure SET kohafield = NULL WHERE frameworkcode='BKS' and authorised_value='HINGS_AS'
    3 - perl misc/maintenance/search_for_data_inconsistencies.pl
    4 - get the following errors:
    Use of uninitialized value $tmp_kohafield in pattern match (m//) at /kohadevbox/koha/misc/maintenance/search_for_data_inconsistencies.pl line 151.
    Use of uninitialized value $tmp_kohafield in substitution (s///) at /kohadevbox/koha/misc/maintenance/search_for_data_inconsistencies.pl line 154.
    Can't call method "get_column" on an undefined value at /kohadevbox/koha/misc/maintenance/search_for_data_inconsistencies.pl line 157.
    5 - Apply patch
    6 - Repeat
    7 - No more errors
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d82dc06594486a7f6b4db567d2399d9954daeac
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 30 10:02:20 2021 -0300

    Bug 29139: Only pass the offsets for lines the credit was applied to
    
    On writing the regression tests, I noticed the CREATE offset was added
    to the template. The idea behind passing the offsets is that we can
    print information about the lines that got the credit applied. Having
    the CREATE offset is meaningless, and (worse) would require users to add
    logic to skip it. And all the payment information is already passed in
    the 'credit' variable anyway.
    
    This patch filters the credit_offsets by type, leaving the APPLY ones
    only.
    
    To test:
    1. Apply up to the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Account.t
    => FAIL: 3 offsets, including the CREATE one, boo!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass! Only the two APPLY offsets are returned!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33092c7f2a7cccbde7b72a5d776d088c1aaa378f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 30 10:01:19 2021 -0300

    Bug 29139: Add regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a9c934a0a1c37c6f012f1b6316f8775aecefde74
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 30 09:28:29 2021 +0100

    Bug 29139: Add exceptions to relation accessors
    
    We already had exceptions on the many-to-many links, but we didn't have
    them for the middle table. The underlying dbic relations make it clear
    which id's are being used for linking.  A 'credit' has 'credit_offsets',
    a 'debit' has 'debit_offsets'.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 88bf99cc08e8302f87a23b3a8549ec56322bab8a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Sep 30 09:14:15 2021 +0100

    Bug 29139: Fix incorrect relation call
    
    The bug here was worse than originally thought. We were calling the
    wrong relation too.. we should probably add some exceptions to catch
    this, it confuses me every single time!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc5c91f53f59af9e4f2ff203ebfd6e10196a1b9d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 29 16:27:04 2021 -0300

    Bug 29139: $line->debit_offsets doesn't honor list context
    
    Being based on _new_from_dbic (discussion on bug 28883), makes the
    assignment incorrect:
    
    my @account_offsets = $payment->debit_offsets;
    
    This patch explicitly makes the resultset be assigned as a list by
    calling *as_list*.
    
    To test:
    1. Have UseEmailReceipts disabled
    2. Have a patron with a debt of 6
    3. Make a payment of 2
    => SUCCESS: All good
    4. Enable UseEmailReceipts
    5. Repeat 3
    => FAIL: You get something like:
    
    ERROR PROCESSING TEMPLATE: undef error - The method Koha::Account::Offsets->debit is not covered by tests!
    
    Trace begun at /kohadevbox/koha/Koha/Objects.pm line 595
    Koha::Objects::AUTOLOAD('Koha::Account::Offsets=HASH(0x561cbe2ac930)') called at input text line 6
    eval {...} at input text line 6
    eval {...} at input text line 23
    
    6. Apply this patch
    7. Repeat 3
    => SUCCESS: It doesn't explode anymore!
    8. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit edfa6b9ffe808075c00761a204c4dbd9d6ca77b8
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Mon Sep 27 11:55:06 2021 +0000

    Bug 29121: Add POD to plugins
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 375a9197b1170b92c9cd27e809bb0dcfce050517
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 27 08:24:53 2021 -0300

    Bug 29121: Catch errors in ->install and ->upgrade calls on plugins
    
    This patch adds a try/catch block when instantiating plugins. Calling
    ->new on a plugin eventually triggers a call to ->install (this has
    always been like this since bug 7804). If the ->install method is
    somehow borked, then the process dies. We need to prevent that, and
    report back some error took place. That's what this patch does.
    
    The same happens to the ->upgrade.
    
    To test:
    1. Install any plugin you like
    2. Restart plack (just in case)
    => SUCCESS: All good
    3. Manually change its install method to:
    
    sub install {
        die "plugin, die!";
    }
    
    4. Run:
       $ koha-mysql kohadev
       > DELETE FROM plugin_data;
    (to make sure there's no __INSTALLED__ entry, do on a safe to delete DB).
    5. Point your browser to the plugins-home.pl page
    => FAIL: Boom
    6. Apply up to the regression tests
    7. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Plugins/Plugins.t \
               t/Koha/Exceptions.t
    => FAIL: Tests fail!
    8. Apply this patch
    9. Repeat 2
    => SUCCESS: Tests pass!
    10. Run:
        $ restart_all
    11. Repeat 5
    => SUCCESS: The page is not broken
    12. Sign off :-D
    
    Note: I used
        $ kshell
       k$ perl misc/devel/install_plugins.pl
    to test as well.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit edc8f4933585cae8986e4a1eae58cabf5ba07918
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 27 08:21:34 2021 -0300

    Bug 29121: Regression tests
    
    This patch adds regression tests for broken ->install and ->upgrade
    methods on plugins.
    
    It adds two dummie plugins named BrokenInstall and BrokenUpgrade, for
    convenience.
    
    Tests are added to catch the warnings that will be logged when trying to
    load this plugins on different scenarios.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b937450ce5f39d6cc56c2fc4884b628c117bffb7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Sep 27 08:18:33 2021 -0300

    Bug 29121: Add new plugin exceptions
    
    This patch introduces two new exceptions:
    
    - Koha::Exceptions::Plugin::InstallDied
    - Koha::Exceptions::Plugin::UpgradeDied
    
    Tests are added for their stringification output.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/Koha/Exceptions.t
    => SUCCESS: Tests pass!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb1c0d483a8d921b528ae24101778e8149ede3b9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 1 16:27:59 2021 +0200

    Bug 29137: DBRev 21.06.00.027
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8ecc6b7007f6d1dde499c4ea32f9f3fcfc718b7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 30 08:56:36 2021 +0200

    Bug 29137: Add new syspref to disable AV creation within the cataloguing module
    
    "I don't like this patch at all!"
    "We will see a cataloger revolt if we do not find a way to make this
    optional for catalogers."
    
    I imagined a hord of catalogers running behind me and I got scared.
    
    This patch will allow to turn the new feature added by bug 25728 off.
    
    Test plan:
    Confirm that the new CreateAVFromCataloguing will permit to turn the
    feature off.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de798994b2e386b2d197063e03deeace4d111a24
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 1 11:42:10 2021 +0200

    Bug 23678: Include file for batch_hold_cancel
    
    Use additional_report to retrieve patron and biblio's info.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfb529215370c592448036c654b79647f7278ace
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Oct 1 10:40:49 2021 +0200

    Bug 23678: Don't display code of the job type
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 954d2606a86fbd12dfdc7164b73263e000744c6d
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Feb 25 13:07:12 2021 -0300

    Bug 23678: Allow cancel holds in bulk
    
    This patch allows staff patrons to cancel multiple holds in bulk.
    
    To test:
    1. Apply this patch
    2. restart_all
    3. In cataloge go to a book and place many holds
    CHECK => Holds table shows a column of checkboxes
    4. Play with checkboxes (have some fun ;-P)
    CHECK => When you manually check all checkboxes, the checkbox in the
    header also gets checked.
          => When you uncheck one of the checkboxes, the one in the header also gets unchecked.
          => If no checkbox is checked and you check the one in the header,
    all checkboxes get checked.
          => If there are some checkboxes that are checked and others are
    not, when you click on the checkbox in the header all checkboxes get
    unchecked.
          => If all checkboxes are checked, when you uncheck the one in the
    header, all checkboxes get unchecked.
          => Every time you play with checkboxes, the number in the button
    "Cancel selected" changes.
    5. Check some of the checkboxes and click on cancel selected.
    SUCCESS => A background job gets fired to cancel all selected holds.
            => A message should appear with a link to the job.
    6. Wait a few seconds and click on the link
    SUCCESS => A message appears with the report of the execution of the
    background job.
    7. Grab a patron and search to hold
    8. Select multiple biblios and click on "place hold for <patron>"
    CHECK => After holds are confirmed, multiple holds table are shown.. one for
       each record. Checkboxes work exactly the same as before, but scoped
    for each individual table. Checkboxes from one table will not affect
    checkboxes from other tables.
    9. Repeat steps 4 to 6.
    10. Check In some of the items so the get in Waiting state.
    11. Update expirationdate os some of those holds and set it to
        ReservesMaxPickUpDelay + 1 days earlier
    NOTE => ReservesMaxPickUpDelay = 7 days by default, so sql syntax to update would be
         => update reserves set expirationdate = date_sub(expirationdate, interval 8 day) where reserve_id in (...)
    12. Repeat steps 4 to 6 but in waitingreserves.pl, in both tabs.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 23678: (QA follow-up) Add missing template filter
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 23678: (QA follow-up) Add missing filters
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 23678: (QA follow-up) Use correct indentation
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    JD amended patch: also Koha/BackgroundJob/BatchCancelHold.pm
    
    JD Amended patch: Full rebase and adjustements made on top of bug 26080.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 170020d453f3e6fdb57c9ea897da5e6efa75d574
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Oct 1 09:22:58 2021 -0300

    Bug 29149: (QA follow-up) Reorganize mapping
    
    This patch changes the mapping so it is more readable, and also allows
    adding things there more easily, like allowing to add code => class
    mappings from plugins, when time comes.
    
    To test:
    1. Just verify things still work
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 987a49406858daff25b33afbbda5e8ae087f930d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 19:22:29 2021 +0200

    Bug 29149: Add the capability to provide more info to the background job detail view
    
    (Patch extracted from bug 28445 to make it reusable for bug 23678)
    We already had the need for that, when bibliographic records are
    modified in batch we wanted to add a "Add to list" feature, and so pass
    a list of lists/virtual shelves to the template.
    
    Here (in 28445) we will want to pass the infos of the items that have been modified
    to display a table.
    
    Test plan:
    0. Create at least one list (virtual shelf)
    1. batch update biblios
    2. Go to the job detail
    3. Notice that dropdown list to add the record to a list
    => No regression found!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ccc4be5dc91ba4ddb9a17fcd9b9dc8af60853c6b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 1 13:23:00 2021 -0300

    Bug 26080: (QA follow-up) Add POD
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2c6eadceaa4007ff993180505e7e24a240e643a3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 1 13:16:32 2021 -0300

    Bug 26080: (QA follow-up) Minor template issues
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d210b8b1ca2414ea9f49ab0217ebab3debab0dd7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 12:13:39 2020 +0200

    Bug 26080: Use the task queue for batch delete authorities
    
    Same as the first patch, for authorities
    
    Test plan:
    Delete authority records using the batch record deletion tool
    Confirm that the job is now delegated to the task queue and that
    everything else is working as before
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7adae4930bcd2ff27bc28186ab5fa1e866829e99
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 12:12:59 2020 +0200

    Bug 26080: Some refactoring
    
    A new include file is created per background job to avoid
    background_jobs.tt to grow too much
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e4182c4fca434441e51c7e3066246c7f73a1e5e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 29 11:17:34 2020 +0200

    Bug 26080: Use the task queue for batch delete biblios
    
    This patch takes advantage of the task queue to delegate the batch
    delete biblios tool.
    
    Test plan:
    Delete bibliographic records using the batch record deletion tool
    Confirm that the job is now delegated to the task queue and that
    everything else is working as before
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e9c2afbb37a38ec48f0f7eecf51cc785af50fc0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 30 09:49:50 2021 +0200

    Bug 28772: DBRev 21.06.00.026
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c458ea9bd74fab3720998eb07efb5679c445bc74
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 21 10:59:22 2021 +0200

    Bug 28772: Fix Koha/Object.t
    
    Koha::ApiKeys is no longer the simple object we need to test
    Koha::Object->store, let use Koha::Library::Groups
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5051bb1e98e9488c2d524a90ecf959d4cfe9057f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 21 13:18:52 2021 -0300

    Bug 28772: Fix auth_authenticate_api_request.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3929db6bc23d905b32d48fdd44d32166152ca842
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 10:34:41 2021 +0200

    Bug 28772: Make validate_secret return 1|0
    
    Not an empty string
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15f930e1012aeedb342f597ff2779ab2c1e90b0c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 9 08:53:07 2021 -0300

    Bug 28772: (QA follow-up) Fix wrong message
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e4f334de93c53b36258efcb21839305dca6c9e4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 9 08:51:02 2021 -0300

    Bug 28772: Do not hash secrets twice
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3816a57abcb944ce0ce2bc3d6057dc98970222fc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 9 08:38:25 2021 -0300

    Bug 28772: Make secret validation use the new method
    
    This patch makes the Koha::OAuth library use the new validation method
    
    To test:
    1. In master, enable RESTOAuth2ClientCredentials and have your
       superlibrarian patron a client_id/secret pair generated
    2. Use Postman to gain an access token with the client_id/secret pair
    => SUCCESS: This works in Koha
    3. Use the access token to GET /api/v1/patrons
    => SUCCESS: It works
    4. Apply this patchset up to the regression tests
    5. Run:
       $ updatedatabase
       $ koha-plack --restart kohadev
    => SUCCESS: All good
    6. Repeat 2
    => FAIL: You get an error trying to acquire an access token. Boo
    7. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/oauth.t
    => FAIL: Tests fail!
    8. Apply this patch
    9. Run:
       $ koha-plack --restart kohadev
       $ kshell
      k$ prove t/db_dependent/api/v1/oauth.t
    => SUCCESS: Tests pass!
    10. Repeat 2
    => SUCCESS: Your original client_id/secret pair works!
    11. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e58091b7ed47105b4bb3fc7171694ef759dc49c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Sep 9 08:23:48 2021 -0300

    Bug 28722: Regression tests
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove tt/db_dependent/api/v1/oauth.t
    => FAIL: Tests fail!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    https://bugs.koha-community.org/show_bug.cgi?id=28772
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da758626fed7bd6024a5ba74a435d1336483f783
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 30 12:07:56 2021 -0300

    Bug 28772: Display API secret once
    
    This patch makes the apikeys.pl display the generated API secret once,
    when generated. After that, it won't be displayed by the UI.
    
    To test:
    1. Generate a new API key
    => FAIL: The secret is displayed in the API keys table
    2. Visit some other page, and go back to the API keys page
    => FAIL: The API key secret is there
    3. Apply this patch
    4. Go to More > Manage API keys
    => SUCCESS: It no longer displays the secret
    5. Generate a new API key
    => SUCCESS: The API key details (including the secret) are displayed.
    => SUCCESS: A message telling to copy the secret because it won't be
                displayed again is shown.
    6. Repeat 4
    => SUCCESS: The secret is no longer displayed
    7. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 671174d02c5a8d8d038e23e5a154a18a7c380160
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 30 11:08:57 2021 -0300

    Bug 28772: Add a warning about hash_password usage in updatedatabase.pl
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad9bc3e8c718e5ea5d31ce7ec7aff4ff8c506bbd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 30 11:08:30 2021 -0300

    Bug 28772: Update existing keys
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26a1b38573157ff0fffeb33cfc7ef34af7c4a33b
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 26 20:24:43 2021 -0300

    Bug 28772: Make Koha::ApiKey->store encrypt the secret
    
    This patch refactors the Koha::ApiKey class so:
    - It encrypts the generated secret
    - Allows accessing the plain text secret only immediately after the key
      creation (this implies that it won't be accessible if the key is
      fetched from the DB).
    - It implements an allow list for attributes, that are not read only.
      Changing any other of them will make ->store throw an exception.
    - A method for validating plain text secrets against the encrypted one
      is added.
    - A method for accessing the plain text secret is added. Returns undef
      if the object is not 'fresh'.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/ApiKey.t
    => SUCCESS: Tests pass! Expected behavior is confirmed
    3. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcb87024ad97c6a0a8be756aa6977c7bbd17839d
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Tue Aug 10 18:08:53 2021 +0300

    Bug 28759: limit accessibility for "Manage API keys"
    
    This patch limits the accessibility for "Manage API keys" section only
    to superlibrarians and the owner of that said API key account.
    
    The way it does it is by checking if user is superlibrarian or if
    logged-in user is the same as a patron id/borrower number is the same
    as logged-in user number both in template and apikeys.pl and making sure
    the link is inaccessible or redirects to the 403 page if user tries to
    go there directly.
    
    To reproduce:
    1) create/pick existing patron, set Staff access, allows viewing
    of catalogue in staff interface (catalogue)" and "Add, modify and
    iew patron information (borrowers)" permissions on;
    2) enable "RESTOAuth2ClientCredentials" in sysprefs;
    3) login with that user into staff interface;
    4) check any other patron, go to the "More"->"Manage API keys" and
    check that you can see, add delete their API keys;
    5) apply patch;
    6) with that same user try to access "Manage API keys" page again.
    Ensure that you can't access that page of other patrons but can
    access your own page and manage your own API keys.
    7) log in with superlibrarian now and ensure that you can access every
    "Manage API keys" page of every patron and apply changes there.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9ad6e004bf85cab3aae496266a4d5fefc8d14be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 11:33:18 2021 +0200

    Bug 28941: Deal with OPACSuggestionUnwantedFields
    
    Remove fields from OPACSuggestionUnwantedFields before creating the
    suggestion
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD amended patch: remove useless sort
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 586bed1319592e05f5dc3acf64a1dba8cae69d6b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Sep 2 11:51:48 2021 +0200

    Bug 28941: Filter suggestion inputs at the OPAC
    
    The following sequence is bad:
    46 my $suggestion      = $input->Vars;
    
    181         &NewSuggestion($suggestion);
    
    All columns can be set when we insert the suggestion into the DB
    We definitely want to avoid the following fields to be set by the final
    user: acceptedby, accepteddate, STATUS, etc...
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 74ec89abc60bcc6ffc4361150b6f2d63529a4004
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 3 12:01:12 2021 +0200

    Bug 28947: Prevent OPAC user to create new users
    
    This patch prevents an existing user from exploiting the patron edit form in order to
    force create new patrons
    
    To test:
    Try all combinations of PatronSelfRegistration and PatronSelfRegistrationVerifyByEmail
    with and without this patch.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b5cf0ca8429573d06b5de4582a1a37246e7b200
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 13 12:56:30 2021 +0000

    Bug 28935: (QA follow-up) Use BorrowerUnwantedField on staff client
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f37d8d2f496ce3c9fd6dfd5a2efa7a9fe435af3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Sep 1 16:04:31 2021 +0200

    Bug 28935: No filtering on patron's data on member entry pages
    
    Security patch. Follow-up for 28929.
    Including correction for gonenoaddress and two others.
    Includes unwanted fields too now.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93350d14b2dcd8c9ecc7422d28a225cd4cd15421
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 31 17:12:22 2021 +0200

    Bug 28929: Add selenium tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 28929: (follow-up) Add exec flag to tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6def2804276a03feef969520dd364fb4bb4e8349
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 31 15:55:15 2021 +0200

    Bug 28929: Prevent flags to be sent during patron's edition
    
    * selfreg and selfmod for OPAC
    * patron's edition on staff
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Tested OPAC and staff side. Prevents mangling flags column.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 244b847a08bf61a747a1e4be4eed86cc776eabd6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 29 12:43:36 2021 +0200

    Bug 28937: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 281be1ade3a73072083dc739584dd5806e2033cb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Sep 27 12:48:54 2021 +0100

    Bug 28937: (QA follow-up) Accessability improvement
    
    This patch adds a keydown event listener onto the flatpickr instance and
    looks for the down arrow key. When such an event is detected we take
    that to mean the user wants to keyboard navigate the calendar widget and
    so disable the buggy allowInput option allowing keyboard navigation to
    work as expected.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5f1ada24940211e14e89a190755128fc0b5cf6a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 31 19:23:21 2021 +0000

    Bug 28937: Use Flatpickr on circulation and patron pages
    
    This patch replaces the use of jQueryUI's datepicker on circulation and
    patron-related pages.
    
    The patch modifies Flatpickr's default configuration (in calendar.inc)
    so that it has the following features:
    
     - A Flatpickr input with a "futuredate" class will require that the
       selected date be after today.
     - The Flatpickr input field will be wrapped in a container to
       facilitate better CSS styling.
     - Generic handling of paired date fields is enabled using
       ".flatpickrfrom" and ".flatpickrto" field classes. This mimics the
       same feature we have for jQueryUI datepickers using ".datepickerfrom"
       and ".datepickerto".
    
    This patch also removes an unused function which was repeated in three
    templates: validate1.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Go to Circulation and check out to a patron.
      - Open the Restrictions tab and click "Add manual restriction."
        - In the "Expiration" field, test that the Flatpickr widget works
          correctly and limits to dates after today.
      - Enable the SpecifyDueDate preference if necessary.
        - Test the behavior of the SpecifyDueDate controls: Setting a date,
          clearing a date, session persistence.
    - Enable the SuspendHoldsIntranet system preference if necessary.
      - Check out to a patron with existing holds.
        - Open the Holds tab and click the "Suspend" button for one of the
          holds.
          - In the modal window which appears, check that the Flatpickr
            widget works correctly and limits to dates after today.
          - At the bottom of the table of holds, test that the "Suspend all
            holds" Flatpickr works correctly and limits to dates after
            today.
            - Perform this same test from the patron details page.
    - Enable the  BatchCheckouts system preference if necessary.
      - Open a patron record and click "Batch check out" in the left-hand
        sidebar menu.
        - Test that the "Hard due date" Flatpickr works correctly as a date
          and time picker.
    - Go to Circulation -> Overdues.
      - Test that the date due filters in the sidebar work correctly and
        are linked, e.g. the "to" field cannot be before the "from" field.
         - Perform the same test here: Circulation -> Holds to pull; and
           here: Circulation -> Hold ratios.
    - Enable the  HouseboundModule system preference if necessary.
      - Check out to or view details of a patron.
        - Click "Housebound" in the sidebar menu.
          - Save delivery day and frequency settings for that patron.
          - Click "Add a new delivery."
          - Test that the "Date" Flatpickr widget works correctly.
    - Go to Patrons -> A patron record -> Edit.
      - Test that Flatpickr widgets work on the following fields:
        - Date of birth
        - Registration date & Expiration date (linked).
        - Patron restrictions -> Add manual restriction -> Expiration.
    - View a bibliographic record and start the process of placing a hold.
      - After selecting a patron, test the "Hold starts on" and "Hold
        expires on" date fields. The fields should be linked and each
        should limit to future dates.
      - Confirm that the dates are saved correctly when you submit the
        hold.
    - Locate a bibliographic record with multiple holds and view the holds.
      - In the table of holds, test each date field: Date, expiration, and
        suspend-until.
    - Test that Flatpickr's static "formatDate" method is working
      correctly:
      - Locate a bibliographic record's item so that there is text in both
        the "Public note" and "Non-public note" field.
      - Check that item out to a patron.
      - After the page reloads the public and non-public notes should be
        shown under the checkout title highlighted in red.
    - Check for references to a "validate1" function. There should be none.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98f32c074e404bb7a362778fe90eeada55ab94f4
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Aug 31 20:36:37 2021 +0000

    Bug 28933: Add subscription class to each subscription in opac-detail
    
    To Test:
    1. Go to a record with some subscriptions, have some closed and some
       open.
    2. Go to the opac-detail page, click on the subscription tab and use
       your developer tools to inscept the element.
    3. Notice the hierarchy of HTML structure, everything is a sibling of
       the next.
    4. Apply patch
    5. Reload the same opac-detail page and again inscept the element.
    6. Now every individual subscription should be wrapped in an element
       with the class name of 'subscription'.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b1f1a10b937061639f635a16518886e03dfb27a4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 25 12:44:56 2021 +0200

    Bug 28454: Add Koha version number to database schema link in reports
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 28454: (follow-up) Add missing filters
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a03d9171141a631c32e26ed795d638f51f8ad02f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 29 12:10:17 2021 +0200

    Bug 29030: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5a8e78fab07e0f46474a8734c2dbdec9faf03c1c
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 15 17:40:19 2021 +0000

    Bug 29030: Make authorized value and description fields required
    
    This patch modifies the markup of the "Create a new authorized value"
    modal so that a minimum set of fields is required: Authorized value and
    description.
    
    The patch also modifies the JavaScript which handles the submission so
    that the jQuery Validation plugin can handle the field checks.
    
    The spelling "authorised" is changed to "authorized" following coding
    guidelines.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Locate a record in the catalog which has items and open an item for
      editing.
    - In the add item form, test the process of adding an authorized
      value on the fly with the following fields: Withdrawn, Lost,
      Damaged, Use restrictions, Not for loan, Collection code, Shelving
      location, and Shelving control number.
      - In each case you should be able to type a new value in the
        dropdown's search box and be shown the option "Select to create."
      - Selecting should trigger a modal window, "Create a new authorized
        value."
      - Test that both "Authorized value" and "Description" fields are
        required, and the form can't be submitted without them.
      - Test that an error message shows up when you submit an authorized
        value which already exists, e.g. authval "1" for "DAMAGED."
      - After triggering this error, click the "Cancel" button and try
        creating another new authorized value. When the modal reopens the
        form should be reset: No previously-entered data, no error messages.
      - Submitting a valid form with a new authorized value should work
        correctly. The modal window should close automatically.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ee9dcff441f8afbbafaf14b8c282b0968e3956b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Sep 29 12:46:54 2021 +0200

    Bug 28826: DBRev 21.06.00.025
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc67449a4626d10f1e2860d6893112c5b33b45ce
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 6 18:50:35 2021 +0000

    Bug 28826: Add FacetOrder system preference
    
    This bug adds a system preference to control ordering of facets and
    adds the control to both Zebra and Elasticsearch
    
    To test:
    1 - Have a koha that can use both Zebra and ES
    2 - Set 'displayFacetCount' to true
    3 - Search in ES and Zebra
    4 - Note facets in Zebra sorted alphabetically, ES by usage
    5 - Apply patch, updatedatabase
    6 - Search in ES and Zebra, facets are alphabetically sorted in both
    7 - Find new syspref FacetOrder and set to 'by usage'
    8 - Search in both engines, facets sorted by usage
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ae5204bfe0f46b37ec65255c65e901d9a7289a6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 28 11:50:22 2021 +0000

    Bug 27155: Include identifier test in Biblio_and_Items_plugin_hooks.t
    
    The biblio and item action hooks pass a biblionumber or itemnumber now
    to the plugin at time of deletion.
    This patch adds a tiny refinement to Biblio_and_Items_plugin_hooks.t
    and the associated test plugin to be sure of that.
    
    Test plan:
    Run t/db_dependent/Koha/Plugins/Biblio_and_Items_plugin_hooks.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c8257a4ecfcc97e59aa474cbfb844179c0467d1b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 28 20:33:46 2021 +0000

    Bug 28484: (QA follow-up) POD fix
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d788a65ce137d4293efa58aedd0109a0cab2e13
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 28 20:24:39 2021 +0000

    Bug 28484: (QA follow-up) Add fix on OPAC
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e994012c9d296c069142e93411b510d96b2babf0
Author: Alex Arnaud <alex.arnaud@biblibre.com>
Date:   Thu Jul 22 11:45:15 2021 +0000

    Bug 28484: ES clean title in biblio detail
    
    Test plan:
     - Create a biblio with title like "osteuropa:" or "osteuropa!"
     - Go the this biblio detail pages (cgi-bin/koha/catalogue/detail.pl)
       => Error
     - Apply bug 28316 and this one
     - test again
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84c5f369a5b9f45b5fc921d3a72042df1343bf9c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 14:55:35 2021 +0200

    Bug 29091: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcd8c96d5fde0f0a6a385bbf73579d53740e6f69
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 23 11:54:43 2021 +0000

    Bug 29091: Correct display of lists and tags on search results
    
    This patch makes a minor change to CSS to fix the display of tags and
    lists on the OPAC search results page so that the list doesn't have
    extra padding.
    
    To test, apply the patch and rebuild the OPAC SCSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - To test you should be able to perform a catalog search in the OPAC
      which will return results which have one or more tags and which are on
      one or more lists.
    - In the OPAC search results, confirm that there isn't extra padding
      between the "Tags:" and "Lists:" labels and their values.
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 835ad1ae3e0ce164c2550286301a30e3f67a42e9
Author: David Nind <david@davidnind.com>
Date:   Sat Sep 18 21:57:41 2021 +0000

    Bug 28438: (follow-up) Capitalization: Various corrections
    
    One mdditional correction.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 13ad7c7ea0c085f39a4f1134b07f33cd4bd96582
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 9 12:27:29 2021 +0000

    Bug 28438: Capitalization: Various corrections
    
    This patch makes capitalization corrections to many templates in the
    OPAC and staff interface. A exhaustive test plan would be huge, so I
    recommend examining the patch to confirm that it contains correct case
    changes.
    
    If you want to make it easier to examine changes you can try:
    https://github.com/so-fancy/diff-so-fancy
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0ebdab046bc647b89d8c95ada12a28087b6d5b8
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Sep 22 14:06:07 2021 +0000

    Bug 29078: Resolve division by zero in touch_all scripts
    
    Illegal division by zero at misc/maintenance/touch_all_biblios.pl line 102.
    
    Trivial fix.
    Funny that the percentage is not even shown without verbose flag ;)
    
    Test plan:
    Run misc/maintenance/touch_all_biblios.pl -where 'biblionumber<0'
    You should now see:
    Good: 0, Bad: 0 (of 0) in 0 seconds
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e61a928130293ffa8f09947ba0555403b7b4100b
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Sep 1 19:16:15 2021 +0000

    Bug 28940: In spinelabel-print.tt call IntranetUserJS only once
    
    1. In IntranetUser add some JS that will target spinelabel-print.tt, I used this:
        if ( $('#labels_spinelabel-print').length ) {
          $('#labels_spinelabel-print').append('<div>TEST</div>');
          console.log('TEST');
        }
    2. Generate a quick spine label
    3. Once you have entered a barcode the JS will go off 2x. With the jQuery added you will see 2 div's with the word 'TEST'. Look at the console and you will also see TEST console logged 2x.
    4. Apply patch
    5. Try seto 2 and 3 again, the JS should only be called once.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58d6423e6cc60207655acb9d49d041edf8eae155
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Mon Sep 20 22:33:42 2021 +0000

    Bug 29067: Remove duplicate conditional statement from OPAC messaging settings title
    
    We can never reach the first [% ELSE %]Koha online[% END %] block in OPAC
    messaging preferences title, so it's dead code.
    
    This patch removes the useless duplicate if-statement.
    
    To test:
    1. Enable EnhancedMessagingPreferencesOPAC system preference
    2. Go to /cgi-bin/koha/opac-messaging.pl
    3. Observe title Your messaging settings > Koha online catalog
    4. Apply patch
    5. Refresh page /cgi-bin/koha/opac-messaging.pl
    6. Observe same title Your messaging settings > Koha online catalog
    7. See patch content
    8. Confirm there are no functional changes in the new logic
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 401f7bf5aeec6c0b824293bf0dbce23d7ed506c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 14:55:23 2021 +0200

    Bug 28934: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e1cd6618e13a52024f2e7a2285dfaf6ad1fe4a21
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Tue Sep 21 16:32:00 2021 +0000

    Bug 28934: Make the OPAC registration form design consistent
    
    The gender/sex and GDPR inputs were slightly misaligned (by
    1.5em). Now they are aligned with the other inputs which have a width
    of 10em (9em width + margin 1em). The label assignments and required
    attributes for input elements are made also consistent.
    
    To test:
     1) Enable GDPR_Policy syspref
     2) Apply patch, run "yarn build --view opac", restart plack
     3) Go to /cgi-bin/koha/opac-memberentry.pl
     4) Check that the GDPR input box shows the required text now in red
        color
     5) Check that the alignment of sex/gender and GDPR input matches with
        the other inputs perfectly.
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 936008207ab2ddd99eee9ec244484f3a7809191f
Author: Lari Taskula <lari.taskula@hypernova.fi>
Date:   Mon Sep 20 22:07:53 2021 +0000

    Bug 29064: Remove duplicate term Most popular titles
    
    To test:
    1. Enable system preference OpacTopissue
    2. Go to OPAC /cgi-bin/koha/opac-topissues.pl
    3. Observe title Most popular titles &rsaquo; Koha online catalogMost popular titles
    4. Apply patch
    5. Observe title Most popular titles &rsaquo; Koha online catalog
    6. See that this path complies with Bug 27742
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d284735d05f67226feba1b4b9e7bf17259eaabaf
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 3 07:29:52 2021 -0400

    Bug 28510: Remove unnecessary conditional
    
    It makes sense to use items by branch to get the list of branches, as it
    already tells use which branches have available items. We could use
    branches to pull from instead, but all we would accomplish is added
    extra ununsed loop iterations. We already know that any additional
    branches in the branches to pull loop have no items to fill holds.
    If they did, they would be in the items_by_branch hash.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba23348db60fdf026723deef6e2907f6fc8093e6
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 3 06:57:52 2021 -0400

    Bug 28510: Remove marking of closed branches as 'disable_transfer'
    
    We no longer need to act as if closed branches were marked as
    disable_transfer. This allows us to clean up a nice bit of code.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 28510: Remove unused variable
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7ae33b47bb891830a09ce2062ef13c1096b2bae
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jun 3 06:44:59 2021 -0400

    Bug 28510: Skip processing holds queue items from closed libraries when HoldsQueueSkipClosed is enabled
    
    Right now we skip closed branch's items as we iterate over all items looking for ones to fill a hold. If HoldsQueueSkipClosed is enabled, no items held be a closed library can be targeted, so it would be more efficient if we never selected the items from those branches to begin with. This is how the holds queue works if we are not using the transport cost matrix, so we should make it work the same way if we *are* using the matrix.
    
    Test Plan:
    1) Apply this patch
    2) prove prove t/db_dependent/HoldsQueue.t
    3) All tests should continue to pass
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9588776baca1c4464bb70441202d0eb7c611d53b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 14:43:46 2021 +0200

    Bug 29070: Compiled CSS
    
    It also contains the compiled CSS changes for the previous accessibility commits
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da9657045b755100d3f169c8c04409309cb5ca54
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 14:39:53 2021 +0200

    Bug 29070: Use a variable to store the #666666 color
    
    To prevent repetition
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98b0570ffe9a0139a045ac9c4b3147bc2d04a231
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Mon Sep 20 23:38:17 2021 +0000

    Bug 29070: Accessibility OPAC Purchase suggestions box on search results page has insufficient contrast
    
    This patch changes the text colour for the purchase
    suggestion box on the OPAC search results page to
    make the text easier to read and improve accessibility.
    
    To test:
    
    1. Log in to the OPAC and search for something
    2. Use an accessibility tool (e.g. Chrome's
       Lighthouse tool) to check the contrast ratio
    3. Confirm that the Purchase suggestion text
       fails to meet accessibility requirements
    4. Apply the patch and rebuild CSS:
       yarn build --view opac
    5. Confirm the text contrast ratio now meets
       minimum accessibility requirements
    6. Check that the OPAC still looks ok after
       the changes.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d39056a4dbf97578ae20b12d97abd2747e115e1b
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Mon Sep 20 22:45:55 2021 +0000

    Bug 29068: Accessibility OPAC search results summary text has insufficient contrast
    
    This patch changes the colour of the label text in
    OPAC search results to increase the contrast ratio,
    improve accessibility and make the text easier to read.
    
    To test:
    
    1. Search for something on the OPAC
    2. Use an accessibility tool (e.g. Chrome's Lighthouse
       tool) to check the contrast ratio
    3. Confirm that the labels (Edition, Format etc.) in the
       results summary have insufficient contrast
    4. Apply the patch and rebuild CSS:
       yarn build --view opac
    5. Use the accessibility tool to confirm the contrast
       ratio now meets minimum accessibility requirements
    6. Check that the OPAC still looks ok after the changes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 42e685f6204284433d7107646a8d50c1c98f3030
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Mon Sep 20 22:27:23 2021 +0000

    Bug 29065: Accessibility OPAC clear search history link has insufficient contrast
    
    This patch changes the colour of the clear search history link
    on the OPAC to increase the contrast ratio, improve accessibility
    and makes the text easier to read.
    
    To test:
    
    1. Go to the OPAC homepage
    2. Use an accessibility tool (e.g Chrome's
       Lighthouse tool) to check the contrast ratio
    3. Confirm that the clear search history link
       has insufficient contrast
    4. Apply the patch and rebuild css:
       yarn build --view opac
    5. Confirm that the contrast ratio now
       meets minimum accessibility requirements
    6. Check the OPAC still looks ok after the changes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ff9cd4bcd044713fc5ebb07294cd6ec501549002
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Mon Sep 20 21:10:15 2021 +0000

    Bug 29038: Accessibility OPACUserSummary heading doesn't have sufficient contrast
    
    This patch changes the colour of the OPAC User Summary heading text to
    increase the contrast ratio, improving accessibility and making the
    text easier to read.
    
    To test:
    
    1. Log in to the OPAC homepage as a user with items checked out
    2. Use an accessibility tool (e.g. Chrome's Lighthouse tool) to test the
       contrast ratio.
    3. Confirm the UserSummary heading has insufficient contrast.
    4. Apply the patch and rebuild css:
       yarn build --view opac
    5. Use the accessibility tool to confirm the contrast ratio now meets
       accessibility requirements
    6. Check that the OPAC still looks ok after the changes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0086ad9f41e9574e54403e572688c37b25d12a9
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Thu Sep 16 07:55:01 2021 +0000

    Bug 29037: Accessibility: OPAC links don't have sufficient contrast
    
    This patch changes the colour of links on the OPAC
    to improve the contrast ratio and make the link
    text easier to read. This accessibility issue was
    identified using the WebAIM WAVE accessibility
    browser extension and Google Chrome's Lighthouse
    tool.
    
    To test:
    1. Use an accessibility tool (e.g. Chrome's
       Lighthouse tool) to test the contrast ratio.
    2. Confirm that some links (e.g. breadcrumb links
       and title links in search results) have
       insufficient contrast.
    3. Apply the patch and rebuild the OPAC CSS:
       yarn build --view opac
    4. Use the accessibility tool to confirm the
       contrast ratio meets minimum requirements
    5. Check that the OPAC still looks ok after the
       changes.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b4d41dea82e2778076754133cda20ad291f42ae
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Thu Sep 16 12:53:12 2021 +0000

    Bug 29035: Accessibility: OPAC masthead_search label doesn't have sufficient contrast ratio
    
    This patch changes the colour of the masthead
    search label to improve accessibility and make it
    easier to read.
    
    To test:
    1. Use an accessibility tool (e.g. Chrome's
       Lighthouse tool) to test the contrast ratio.
    2. Confirm that the search label has insufficient
       contrast.
    3. Apply the patch and rebuild the OPAC CSS:
       yarn build --view opac
    4. Use the accessibility tool to confirm the
       contrast ratio now meets accessibility
       requirements.
    5. Check that the OPAC still looks ok after
       the changes.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a409859088d074eca602b70878f42ac3115fa3e
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Thu Sep 16 08:35:39 2021 +0000

    Bug 29034: Accessibility: OPAC nav links don't have sufficient contrast ratio
    
    This patch changes the colour of the navigation
    links on the OPAC (Cart, Lists etc.) to improve
    the contrast ration and make them easier to read.
    
    To test:
    1. Use an accessibility tool (e.g. Chrome's
       Lighthouse tool) to check the contrast
       ratio on the OPAC
    2. Confirm that the navigation links have
       insufficient contrast
    3. Apply the patch and rebuild the OPAC css:
       yarn build --view opac
    4. Use the accessibility tool to confirm
       the contrast ratio meets  the minimum
       accessibility requirements
    5. Check that the OPAC looks ok after the
       changes
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a09beafe0fcdc917ac5542be65d449bc73c8543
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Sep 20 12:36:02 2021 +0300

    Bug 29056: Remove the demo functionality leftovers
    
    Remove forgotten code of the old legacy demo functionality that was
    removed from elsewhere except systempreferences, this code not only
    serves no purpose but also is causing some troubles for our customers.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 269f52f5ae167a1fdb416051dd04dee6f861b749
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 14:17:36 2021 +0200

    Bug 29049: Remove reference to optionloop
    
    It's no longer used.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3dd9f24d9c3443ec6af12ee8388f494d3e7612ed
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Sep 25 11:15:08 2021 +0000

    Bug 29049: (QA follow-up) Initialize uninitialized variable to prevent warning
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4219b9ffca6a2718013d6721b96576ae9e688da7
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Sep 25 10:54:44 2021 +0000

    Bug 29049: (QA follow-up) Remove unused variable
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36c778ff25120ee430b04e9a408ca95840b5143f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 17 16:18:09 2021 +0000

    Bug 29049: (follow-up) Reduce number of line returns in page
    
    While moving the dropdown to a block, I noticed the page size was very large when there are many holds
    
    This patch chomps a large amoutn of whitespace, from the block and elsewhere and drecreased the paeg from about 400k lines to 25k lines for a record with ~200 holds
    
    To test:
    1 - Apply previous patch
    2 - Load holds tab for a biblio
    3 - Save the page as html from your browser, note the size of the file
    4 - Apply patch this
    5 - Reload and repeat
    6 - Note the size is much smaller
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc4fe788e497b4bc3e06b8cb94a6b75d016a7598
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 17 13:59:25 2021 +0000

    Bug 29049: Simplify holds priority dropdown logic on request.pl
    
    This patch makes a few changes:
    1 - If we are not splitting the queue ( HoldsSplitQueue == 'nothing' ) then
        there are no changes for 'virtual' vs 'actual' numbering
    2 - If we are splitting the queue you cannot use the dropdown, so we do not need to process the options
    3 - If the hold is 'found' we do not need to process the options
    4 - We can simply use the 'last priority' to build the options, we do not need to process in the script
    5 - We can use a block to build the options
    6 - Remove a stray holds.index
    
    To test:
     1 - Place 5 holds on a bib
     2 - 'Find' two of the holds i.e. check them in to set status to 'transit' or 'waiting'
     3 - View the holds page for the biblio
     4 - Inspect the priorty dropdown for the found holds, note they have options for 1-5 but are disabled
     5 - Note the dropdowns for other holds have options 1-5
     6 - Note options 4&5 in the dropdowns have no effect
     7 - Apply patch
     8 - Inspect the priority dopdowns on the found holds
     9 - Note they only show their found status
    10 - Note the other dropdowns only show options 1-3
    11 - Test with other HoldsSplitQueue options and HoldsSplitQueueNumbering
    12 - When holds queue is split, no dropdowns should be active and should show only their current priority
    13 - When  HoldsSplitQueueNumbering is 'virtual' the dropdown should be disabled and correctly count the number of unfound holds in the list
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    JK: Fixed grammar in commit title
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    JD: Remove trailing 'i'
    
    Bug 29049: (QA follow-up) Remove excessive whitespace
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 716f9c4ea28e9041ddecb344db827880e6de182f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 19 13:43:48 2021 +0000

    Bug 27461: Right pad with default elements for too short 008s
    
    Note that we treat the elements 18-34 as one block of elements,
    since its subdivision may vary.
    E.g. if you pass 24 characters to the form, it will use the first
    18 chars (until the last complete element) and pad with default
    elements from position 18-39.
    
    Test plan:
    [1] Go to addbiblio. Make sure that 008 is connected to the plugin.
    [2] Backspace field 008 a bit, click on the plugin button.
    [3] Verify that the last elements come from the default.
    [4] Repeat for a few different lengths.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c17adb49f3fd5ac4544d347f474cf09dd0e401a2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 19 11:42:36 2021 +0000

    Bug 27461: Add tests for biblio_008
    
    Test plan:
    Run  t/db_dependent/FrameworkPlugin.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f2c17857d497ecad11ce3d871ef0cf86272c9df
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 19 09:52:14 2021 +0000

    Bug 27461: Move hardcoded value to module
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c83645eab9767366051541f0e8249623078ef365
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 11:07:11 2021 +0200

    Bug 27279: (bug 23916 follow-up) Fix issuer display on "Checkout history"
    
    Caused by
      commit 61a39b0dd52df4f6d743671823449e265d6add26
      Bug 23916: (QA follow-up) Adapt all the things to the new column and accessor names
    
    - [% INCLUDE 'patron-title.inc' patron=checkout.issued_by %]
    
    + [% INCLUDE 'patron-title.inc' patron=checkout.issuer_id %]
    
    It must have been patron=checkout.issuer as patron-title.inc is
    expecting a Koha::Patron object, not a borrowernumber.
    
    Test plan:
    Turn RecordStaffUserOnCheckout on
    Check an item out then in
    Go to the biblio checkout history and confirm that the "Checked out by"
    column contains the logged in librarian's name.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05ce3534beb4c6000ab02bfe32a12a9becb1262c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Sep 14 21:33:47 2021 -1000

    Bug 29026: Restore behavior when an empty barcode field is submitted in circulation
    
    When preference CircAutoPrintQuickSlip is 'clear the screen', when an empty barcode field is submitted in circulation :
    
    Before Bug 17845, behavior was to display empty circulation page (no patron selected).
    Now behavior is displaying the circulation page of current patron.
    
    I think previous behavior was used when scanner is used to clear form and wait for another patron card to be scanned.
    
    Test plan :
    1) Set system preference CircAutoPrintQuickSlip to 'clear the screen'
    2) Go to a patron circulation page
    3) Post form without a barcode
    => Check you go to circulation page with no patron selected
    4) Set system preference CircAutoPrintQuickSlip to 'open a print quick slip window'
    5) Go to a patron circulation page
    6) Post form without a barcode
    => Check you go to print quick slip window with correct datas
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b83f9920ad335f617065e42ad6217b17b5378930
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Sep 7 23:04:54 2021 -1000

    Bug 28927: (follow-up) remove rule on id=opacheader in opac CSS
    
    Actually this rule does nothing, it defines same background color as "body" : #fcf9fc
    
    Test plan :
    1) Without patch look at OPAC header
    2) With patch OPAC header should have same background color
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5a78261b58800930354858a28163467de052bbb
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Aug 30 20:59:27 2021 -1000

    Bug 28927: Fix id opacmainuserblock used twice in OPAC
    
    Since preference OpacMainUserBlock is now an HTML customization,
    there is actually an HTML tags with id="opacmainuserblock" and one with id="OpacMainUserBlock".
    Same for OPACNavRight in opac-registration-confirmation.tt
    
    This patch removed id from page to keep the one comming from HTML customization include.
    
    Test plan :
    1) Create an HTML customization for OpacMainUserBlock with some text
    2) Go to OPAC main page
    3) Check HTML code of the page
    4) Check you see id="OpacMainUserBlock" once and not id="opacmainuserblock"
    5) Same for id="opacnavright" in opac-registration-confirmation.tt
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bedf8d3b10a902c8024a359a41057f206c4fceb8
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Wed Sep 15 07:32:34 2021 +0200

    Bug 29025: Don't prefill userid and password in user creation form
    
    Recent Firefox versions try to prefill userid and password with
    logged in user credentials.
    
    To test
    1 - Log in staff as user foo password bar
    2 - Save user and password in Firefox
    3 - Log out
    4 - Log in again, log in pop-up must be pre-filled
    5 - Open Create a new patron form
    6 - At least password field is pre-filled with logged in user's credentials
    7 - Apply patch
    8 - Redo 4 and 5
    9 - Userid and password fields aren't prefilled
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8ff6293e859a8f19580c9cf6f7e73e73a70e4c8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 12:43:07 2021 +0200

    Bug 29019: Restore eval call
    
    But fix it (pass an arrayref). We need the eval to catch possible errors.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5fcd2a55eed9358f7a75c66a7eb6ef7d45b586f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Sep 23 21:14:52 2021 +0000

    Bug 29019: Unable to delete HTML customization
    
    This patch makes some corrections to additional contents to allow
    content to be deleted. The wrong parameter was being passed to the
    script. The script was also not handling multiple deletions correctly.
    
    The patch also adds a "category" parameter to the delete operation so
    that the page is redirected correctly.
    
    The patch also changes some strings which referred to "news"
    referencing operations which might be performed on news or on HTML
    customizations, e.g.:
    
    "Are you sure you want to delete the selected content?" instead of "Are
    you sure you want to delete the selected news?"
    
    To test, apply the patch and go to Tools -> News.
    
    - Create multiple news items if necessary.
    - Test the "Delete" button corresponding to a single news item:
      - Clicking the button should ask you to confirm.
      - Check that the wording of the message is correct.
      - After confirming the news item should be deleted.
      - Ideally, test on news items which are on the second page of the
        DataTable of news items.
    - Test the process of deleting multiple news items at once:
      - Check the checkbox next to multiple items.
      - Click the "Delete selected" button at the bottom of the page.
      - Check that the wording of the confirmation message is correct.
      - After you confirm, the items should be deleted.
    - Repeat these tests under Tools -> HTML customizations to confirm that
      redirects work correctly. After deleting an HTML customization you
      should be redirected back to the list of HTML customizations.
    
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c08fd3e9872d16eb86abcb6035dd2d86b0047041
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Sep 22 12:02:43 2021 +0000

    Bug 29076: Fetch the zebraqueue entries when not confirm
    
    This patch remove a check for confirm when fetching the entries
    for possible deletion from the zebraqueue
    
    Without this we die when we try to access the entries for counting
    
    To test:
    1 - perl  misc/cronjobs/cleanup_database.pl --sessions --zebraqueue 10 --list-invites --z3950 --logs 180 --mail 375 -v
    2 - Dies
    3 - Apply patch
    4 - Repeat 1
    5 - Success!
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa4d179256303eb61e5934b1b6e3e70e489c44e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 15:11:24 2021 +0200

    Bug 29073: DBRev 21.06.00.024
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b6ed8097e28b090206aab2c41bcc7d546750aaf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 21 15:15:15 2021 +0000

    Bug 29073: Use 0 and 1 as values for DefaultHoldExpirationdate
    
    DefaultHldexpirationDate is set in the pref screen to 'yes/no'
    
    The code checks if the preference is 'true', 'no' is true
    
    We should instead use 1/0
    
    To test:
    0 - Have a fresh devbox
    1 - With syspref disabled, place a hold
    2 - Note no expiration date set
    3 - Enable the preference
    4 - Place a hold and note the expiration date is set, good
    5 - Disable the pref
    6 - Place a hold and note the expiration date is set, bad
    7 - Apply patch
    8 - Update database
    9 - Repeat 1-8, date not set when pref disabled
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c3b37d4e722b0df846cbd40bd406964115e8a497
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 28 15:10:20 2021 +0200

    Bug 28534: DBRev 21.06.00.023
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 16859016d3633e938aaafffff836b10146d2cf67
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jun 14 12:41:50 2021 +0000

    Bug 28534: Atomic update to fix existing installs
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d99c977a30bba2ba61008cd18d2b036f12f2509f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 9 13:46:16 2021 +0000

    Bug 28534: Fix engine for pending_offline_circulations table
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Bug 28534: (follow-up) Don't adjust original DB update
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bd34a3eeadcbdfd34dbaf2ef573339f8367d3d6a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Sep 21 17:08:22 2021 +0100

    Bug 28803: (QA follow-up) Reinstate UNKNOWN_ERROR in templates
    
    I can't see how this will ever get thrown, but as it's there we should
    have the template handling included.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33165bd22e3e5127e68fb4ee51126ae1b4925f3f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Sep 13 10:18:46 2021 +0100

    Bug 28803: (follow-up) Error details improvement
    
    This patch updates the exceptions thrown by Koha::Email to include the
    parameter that failed email validation and then updates the failure code
    to include this parameter and finally display this field in the template.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cfbdee6a84516de245798301916ac23705c46b7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 5 08:00:19 2021 +0100

    Bug 28803: Add invalid email handling in _send_message_by_email
    
    This patch adds a try/catch block around the call to Koha::Email->create
    to catch and handle invalid emails being passed in the parameters.
    
    The message is marked as 'failed' with an error_code of 'INVALID_EMAIL'.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb027d7a45324772e06885d64b8b382ee1fb9b1e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 5 08:43:32 2021 +0100

    Bug 28803: Add unit tests
    
    This patch updates Letters.t to confirm that invalid email addresses in
    the message_queue should not throw an exception when sending mail but
    instead set the status to failed and pass error details to the end user.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1ac673e70543a4a33615d9b1b668c4246f99bb12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 26 17:21:32 2021 +0200

    Bug 28870: non-FQDN addresses are valid
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 27affe637a5a6d90fc3c15724cc018ac5e5b1477
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 26 17:13:41 2021 +0200

    Bug 28870: Use Email::Address->parse
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddb24eb4032e6362ee5b92419bcaf2e0f6366cac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 26 17:12:58 2021 +0200

    Bug 28870: Move email address validation to a specific class method
    
    To ease testing and future changes if needed.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 481f52308a32860e8594d13bd11086845e498ae4
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 20 18:37:37 2021 -0300

    Bug 28870: Remove traces of Email::Valid
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23aac004c04a12d7e0830a4f8ceb49f5d1c29179
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 20 18:23:30 2021 -0300

    Bug 28870: Use Email::Address to validate email addresses
    
    This patch adds a new dependency, Email::Address. It is used in
    Koha::Email to replace the current use of Email::Valid, which proved to
    be problematic when it comes to UTF-8 characters.
    
    Email::Address provides suitable regexes that -when used- keep our
    tests passing, but also deal better with UTF-8 data.
    
    To test:
    1. Apply the regression tests patch
    2. Notice the only change is that it tweaks a couple addresses so they
       contain umlauts and also have the "Description <address>" format that
       is used when sending carts.
    3. Run:
       $ kshell
      k$ prove t/Koha/Email.t
    => FAIL: Tests fail! Things die because Email::Valid doesn't like the
       from we passed.
    4. Run:
       $ sudo apt install libemail-address-perl
    5. Apply this patch
    6. Repeat 3
    => SUCCESS: Tests pass!
    7. Try what is described in comment 1
    => SUCCESS: Things are back to normal
    8. Sign off :-D
    9. Send cookies
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33994650f08612b5181aa200098e8e1e8755ded9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 20 18:22:58 2021 -0300

    Bug 28870: Regression tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 870e3e8e161f6da998c1deae216d7fdf0d0490e7
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu May 27 17:02:35 2021 -0300

    Bug 28412: Add information about supported authentication methods
    
    This patch adds an initial text explaining the valid authentication
    mechanisms Koha has for the API.
    
    My first approach included information about the controlling sysprefs,
    but I decided to remove it, as it is not usual for API consumers to be
    presented such detailed internal information which is probably
    confusing. We could add a link to the manual, but that's not the point I
    think.
    
    I've added an entry about error messages and how we thougth about them.
    It is copied from Docker Engine's API docs.
    
    This is my 2 cents.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c2f4ed6bfe45619fbec20a7480ef26f606b5976
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 8 15:03:29 2021 +0000

    Bug 28536: Move translatable strings into overdrive.js
    
    This patch takes strings defined as variables in opac-bottom.inc for use
    in overdrive.js and moves them to overdrive.js, wrapped in the
    double-underscore translation function.
    
    To test you must have valid credentials entered in system preferences
    for the OverDrive API. Ideally you should test using a patron who has
    holds and current checkouts in OverDrive.
    
    Apply the patch and log in to the OPAC.
    
    - On the "Your summary" page, open the "OverDrive Account" tab.
      - Log in to your OverDrive account.
      - The contents of the tab should display correctly, with correct
        labels for controls like "Log out of your OverDrive account", "Check
        in", "On hold", etc.
    - Perform a catalog search which will return results also found in your
      OverDrive collection.
      - Open the OverDrive results page.
      - The page should display correctly, with correct labels on controls
        like "Check out" and "Place hold."
    
    To test that the correct strings are translatable. In this example I'm
    testing fr-FR:
    
     - Update a translation:
    
      > gulp po:update
      > cd misc/translator
      > perl translate update fr-FR
    
    - Open the corresponding .po file for the strings pulled from
      JavaScript  e.g.  misc/translator/po/fr-FR-messages-js.po
    - Locate strings pulled from bootstrap/js/overdrive.js for
      translation, e.g.:
    
      koha-tmpl/opac-tmpl/bootstrap/js/overdrive.js:124
      msgid "OverDrive account page"
      msgstr ""
    
    - Edit the "msgstr" string however you want (it's just for testing)
    - Install the updated translation:
    
      > perl translate install fr-FR
    
    In the OPAC, switch to the language you're testing. Confirm that your
    translated strings appear. In the above example, the string should
    appear at the top of the "Overdrive Account" tab.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 492481d14ea0108bffcae33de9f3547f507c188a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 14 15:04:38 2021 +0000

    Bug 28356: Consolidate catalogue search box code
    
    To test:
    1 - Apply patch
    2 - Confirm searchign the catalog works from:
        Administration->Budgets
        Cataloging
        Circulation->Check in
        Administration->Cities and towns
        Acquisitions->{Vendor}->Contracts
        Administration->Currencies
        Administration->Circulation desks (requires  UseCirculationDesks preference)
        Home
        Tools->Notices and slips
        Patrons
        Adminstration
        Serials
        Acquisitions->Suggestions
        Administration->Z39.50/SRU servers
    
    Signed-off-by: hakam <hakam@inlibro.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a38b9f1a9e1edd564f3d7e2ffebb34c91287c505
Author: Thomas Klausner <domm@plix.at>
Date:   Mon Mar 29 13:59:50 2021 +0200

    Bug 28022: Only show subfield "9" if subfield "a" is visible
    
    Amend the workaround (from but 2206) to only show subfield "9" in editor if
    subfield "a" has the editor-visibility bit set.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 555990298e5703d727196154893f3213d095cfc9
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 28 15:01:01 2021 +0200

    Bug 28898: (follow-up) Add context to some more occurrences of Term in course reserves
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc86b497353960b96db6b10f36995582251346e7
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Aug 28 14:54:29 2021 +0200

    Bug 28898: (follow-up) Remove comment lines before PROCESS statements
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a33592b6b42ae4e12fe6e0598f563877e870689a
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed Aug 25 16:23:02 2021 -0400

    Bug 28898: Context for translation: term (word) vs. term (semester)
    
    This patch add context to the term Term in the context of course reserves.
    
    To test:
    0- Apply patch
    Set up course reserves
    1- Enable UseCourseReserves
    2- Create at least one authorized value for DEPARTMENT
    3- Create at least one authorized value for TERM
    4- Create a course
    5- Add at least one item to the course
    
    Check the terms:
    6- Go to the OPAC
    7- Go to Course reserves
    ** 8- In the list of courses, check the Term column heading
    9- Go to the staff interface
    10- Go to Course reserves
    ** 11- In the list of courses, check the Term column heading
    12- Click on the course name
    ** 13- Check the Term line in the course description
    
    Add a new language (fr-CA in the example, change for whatever language code you want)
    14- In a terminal, run
    gulp po:create --lang fr-CA
    15- Then, run
    gulp po:update --lang fr-CA
    16- In system preferences, enable the new language in language and OpacLanguages
    17- Switch the language in staff interface and OPAC
    
    Change the translations
    18- In your favourite text editor, open fr-CA-messages.po
    19- Find the string 'msgctxt Semester'
    20- Enter a word in msgstr
    21- Save the file
    22- In a terminal, go to misc/translator
    23- Run
    ./translate install fr-CA
    
    Check the translations
    24- Redo the steps to check the terms (6-16) and make sure the terms in steps 8, 11, and 13 are changed for the word you put in step 20.
    25- Optionally, check the following pages to make sure the terms are not the word you put in step 20 (these pages shouldn't have been changed)
    - opac-tags (your account > your tags)
    - opac-authorities (search for an authority in Authority search)
    - review (tags in staff interface)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Julian Maurice <julian.maurice@biblibre.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df92c9ddf9316119e513dc93c8ece32ccab9a511
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Thu May 13 10:31:08 2021 +0100

    Bug 28340: Alphabetise metadata for notices
    
    This commit sorts metadata by key prior to preparing a notice with it
    
    Test plan:
    
    - Do not apply patch
    - Create a report with the following SQL:
      SELECT * FROM message_queue;
    - Create an ILL request with plenty of metadata
    - Go to "Manage request"
    - Send a notice to a patron
    - Run the report created earlier
    
    => TEST:
    - Observe that the metadata is in random order
    
    - Apply the patch
    - Create an ILL request with plenty of metadata
    - Go to "Manage request"
    - Send a notice to a patron
    - Run the report created earlier
    
    => TEST:
    - Observe that the metadata is now sorted alphabetically by key
    
    Signed-off-by: Jill Tivey <Jill.Tivey@sasa.gov.scot>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09b66a8035c23bb9430e0a4675a5ccb54f9cfac1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 30 15:52:18 2021 +0000

    Bug 28340: Unit test
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: remove commented line
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 567557117ad11d7857d3ef32c95b089065d8cd9b
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Jun 18 11:10:01 2021 +0100

    Bug 27170: Fix bug fix
    
    <sigh> This commit fixes the incorrect bug fix from the previous commit
    
    Signed-off-by: Holly Cooper <hc@interleaf.ie>
    Signed-off-by: Barry Cannon <bc@interleaf.ie>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7811505506fd27f98a10654a4e8a5ff1b69f149f
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Fri Jun 18 10:59:01 2021 +0100

    Bug 27170: Fix bug with undefined 'links'
    
    If a row object doesn't have a 'links' property, calling 'length' on it
    will fail. This commit fixes this.
    
    Signed-off-by: Holly Cooper <hc@interleaf.ie>
    Signed-off-by: Barry Cannon <bc@interleaf.ie>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 045a59a3585851ed5894b855c2f01b54a97fe9e5
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue Dec 8 12:21:43 2020 +0000

    Bug 27170: Add support for new 'links' property
    
    This commit adds support for the new 'links' property that will allow an
    availability plugin to return an array of links for a result. These
    links are parsed and appended to the title field of a results record.
    
    Signed-off-by: Holly Cooper <hc@interleaf.ie>
    Signed-off-by: Barry Cannon <bc@interleaf.ie>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57c5d83998e169701c0103d51c710ec5c247f86d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 2 13:44:31 2021 +0000

    Bug 24190: (QA follow-up) record unchanged bookfund and fix typo
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9f457ab14d545bc19ea964dc0d76c86c1d0132e
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed Jun 16 14:27:30 2021 +0100

    Bug 24190: (follow-up) Rename AcqLog
    
    As requested in comment #49, renamed uses of AcqLog to AcquisitionLog
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: replace one missing occurrence in Budgets.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 114f4ea5a3427482def8a42411934e901231b910
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Oct 26 11:44:50 2020 +0000

    Bug 24190: (follow-up) Modify order of logging
    
    Basket creation involves two steps in Koha, creating the basket then
    modifying its header. We were logging these two steps in the wrong
    order. This commit fixes that.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ad81611ad495084fc2c74fa6ca66bb2ae27068c
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Sep 28 15:12:45 2020 +0100

    Bug 24190: (follow-up) Add tests
    
    In response to Jonathan's request for tests, I have now added additional
    tests for the methods in C4/Budgets.pm that do logging
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50109e06f903ad25ac1e84270cb371c243a3581d
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Sep 28 10:41:16 2020 +0100

    Bug 24190: (follow-up) Respond to QA feedback
    
    This commit makes changes in response to Jonathan's feedback in comment
    
    - Moved from using zero padded strings to store log data to a JSON
    object
    - Stopped storing formatted dates in logged data
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 23e7f7995e4427ffa05dd4cba50e72776e426764
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Tue May 19 12:06:47 2020 +0100

    Bug 24190: (follow-up) Cancel order del item bug
    
    If an order is cancelled but the associated bib / items are unable to be
    removed, we go into error handling. We still need to log the
    cancellation though. So this fix moves the logging to just after the
    cancellation, so it will be logged regardless of the outcome with
    associated things.
    
    Signed-off-by: Maura Stephens <maura.stephens@gmit.ie>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf90fb810ecfda70583994b75ae53b32ac3d1b5d
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Wed Jun 16 14:22:30 2021 +0100

    Bug 24190: Add acquisition logging
    
    Signed-off-by: Maura Stephens <maura.stephens@gmit.ie>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fc80c35aa4dcf863fb3b437e1530d5791a3baeb
Author: Andrew Isherwood <andrew.isherwood@ptfs-europe.com>
Date:   Mon Apr 1 14:09:10 2019 +0100

    Bug 22614: Migrate original request
    
    This patch changes an active request's backend and initiates the
    migration on that request, rather than creating another and migrating
    that.
    
    The majority of the work to accomplish this bug is being carried out in
    the backends, since Koha delegates migrations to them.
    
    Signed-off-by: Barry Cannon <bc@interleaf.ie>
    Signed-off-by: Assumpta Byrne <abyrne@ait.ie>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d3d400d7f8516ff3d23792bdcea0ccd9454dfd2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Sep 21 09:52:19 2021 -0300

    Bug 29072: Move reference route /cities spec to YAML
    
    This patch moves the /cities routes spec and related files into YAML so
    devs can use it as a reference for future routes.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/cities.t
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5e497a47a218ee7c222c4be02f284353f842113a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Sep 15 12:12:33 2021 -0300

    Bug 29032: Pre-load ILL backends to speed up response
    
    Bug 22440 will rewrite the route and make it even more efficient by
    prefetching the related data instead of performing several queries in
    loops.
    
    In the meantime, we can make this controller perform better with a
    simple intervention: load backends once, and use the
    $request->_backend() setter to pre-set it before using the objects.
    
    To test:
    1. Perform any usual ILL requests listing, try having several
    => FAIL: Notice it takes a weird amount of time to load
    2. Apply this patch
    3. Restart all
    4. Repeat 1
    => SUCCESS: It feels fast enough!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a005865b813ef466f29c836c5ad65e8b69142f95
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 16:14:13 2021 +0200

    Bug 17600: Fix overdrive_proxy and recordedbooks
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 166ebea01fc27202b34a373f166fe19b1fa16921
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 16:11:35 2021 +0200

    Bug 28972: Fix failing tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d587341d3401f5c165b221f1850360f3b10224dc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 14:25:48 2021 +0200

    Bug 17600: Remove wrong C4::Context imports
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 93e02e8178d4e51c222ca8b2769a7b5ce7f8ca0c
Author: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
Date:   Fri Jul 2 15:05:27 2021 +0300

    Bug 28653: Add new method RefreshIssuesTable
    
    On patrons check out or details page, after renewing
    loans they don't sort correctly when clicking on "Date due"
    tab. Page has to be reloaded so that sorting works.
    This patch adds new method RefreshIssuesTable to
    checkouts.js. When loans are renewed or checked in, issues
    table is reloaded to and due dates are sorted correctly.
    
    To test:
    1. Add 3 loans for patron.
    2. Change due dates so you they are e.g. 07/01, 07/02, 07/04
    3. Make sure you have renewal period set e.g. 5 days and
    check your RenewalPeriodBase syspref (I use current date there)
    4. Renew loan with date due on 07/01, it should now be 07/07
    5. Sort loans by date due
    => Note that order from top to bottom is 07/04->07/02->07/07
    or 07/07->07/02->07/04, not 07/02->07/04->07/07 as one would
    assume.
    6. Apply patch and repeat.
    => Note that issues table is reloaded ("Loading..." pop-up is displayed)
    and that due dates are in correct order.
    
    Sponsored-by: Koha-Suomi Oy
    
    Signed-off-by: kelly <kelly@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Bug 28653: (QA follow-up) Remove debug message used during development
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63437e25726568bb44c7274e8eb7c23d3ea009b3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 27 16:06:02 2021 +0000

    Bug 18747: Select All in Add Patron Option in Patron Lists only selects the first 20 entries
    
    This patch corrects the JavaScript functions for the "select all" and
    "clear all" action when viewing patrons in a list. Before this
    correction, checkboxes which were previously in hidden table rows would
    not be checked.
    
    To test, apply the patch and go to Patrons -> Patron Lists
    
    - View a patron list
    - If necessary, add multiple patrons to the list so that the number
      exceeds 20.
    - Change the number of entries shown by the DataTable: Show [ 50 ]
      entries.
    - Click "Select all." All visible checkboxes should be checked.
    - Click "Clear all." All checkboxes should be unchecked.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e3c1b2068ff2f0c136f706ce0ec213c332e818c0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Sep 10 07:39:40 2021 +0000

    Bug 28992: Resolve warning on BIG_LOOP
    
    Argument "" isn't numeric in numeric gt (>) at
    /usr/share/koha/koha-tmpl/intranet-tmpl/prog/en/modules/cataloguing/
    addbiblio.tt line 896.
    
    Came across it when testing 28608. Could have been a QA follow-up.
    
    Test plan:
    If you run QA tools on this patch, you should see the warning only
    when processing files before patches.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e176c4edce47258b50f46c08e468a0c1f44dd556
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 14:02:15 2021 +0200

    Bug 28972: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80af49bcf7c3adf9eab5394772ee70f2f4d59d5d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 14:01:08 2021 +0200

    Bug 28972: DBRev 21.06.00.022
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36a37b245d8debe63e39c9eb551f3c169e68eada
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Sep 20 13:57:06 2021 +0200

    Bug 28972: Make DB rev idempotent
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7170fe2cc5f30e055ffa3ab33648e977ffd3a25c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Sep 8 08:02:05 2021 -0400

    Bug 28972: Add missing foreign key constraints to holds queue table
    
    The table tmp_holdsqueue is missing a couple key constraints that should
    be there, one for biblio and one for borrowers.
    
    Test Plan:
    1) "SHOW CREATE TABLE tmp_holdsqueue;" should show no FKs for biblio or borrowers
    2) Apply this patch
    3) Run updatedatabase.pl
    4) "SHOW CREATE TABLE tmp_holdsqueue;" should now show FKs for biblio or borrowers
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5bbafce7204c6c1e0e87578f4abaf79713458c5e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Sep 1 15:58:04 2021 +0100

    Bug 28316: (QA follow-up) Make clean_search_term public
    
    With all the work that's gone into improving the internal
    _clean_search_term method I feel we should expose it publically as it's
    going to be more widely helpful
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc988b2d16cc0399a979d3ce491e29084a0d1166
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Sep 6 16:46:45 2021 +0300

    Bug 28316: escape ES ranges if QueryAutoTruncate is enabled
    
    if QueryAutoTruncate enabled we will have any special operators ruined
    for example: "test [6 TO 7]" will be converted to "test* [6* TO* 7]"
    so no reason to keep ranges when QueryAutoTruncate set to "enabled"
    
    1) enable QueryAutoTruncate at your sysprefs.
    2) perform a search using range, for example: "[1999 TO 2020]",
    it shouldn't work the way it's supposed to.
    3) apply the patch.
    4) perform the same search with range, ensure that it works correctly.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3ce2810324fc28d5f9c9791ee7ec7805df94ff3e
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jun 14 16:38:51 2021 +0300

    Bug 28316: avoid messing up regexes in the search queries
    
    This patch ensures that the behavior with
    QueryRegexEscapeOptions set to values other than
    "Escape" still will works as expected.
    
    It does so by storing the contents of regexes
    before escaping special characters and
    then restores the contents of regexes back to how
    it was before, ensuring that searching with regex is possible.
    
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0083f96bc9238148a67a58512331144e28b08c94
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Fri Jun 18 10:44:56 2021 +0300

    Bug 28316: escape exclamation signs in the query
    
    Currently having exclamation sign at the end of the query makes ES
    search fail, and when you try to search for a book that has exclamation
    sign in the tittle (something like "Words! words") won't show results
    correctly as it tries to negate everything that is after exclamation
    sign, making it impossible to search for books that have in in the title
    
    This patch escapes exclamation signs if it's at the end of the query or
    has a space after it, resolving both of the issues listed above.
    
    To reproduce:
    1) with ES enabled, search for the book with title that contains
    exclamation sight at the end, like "book!", this search should result
     in error.
    2) do another search, but this time find/prepare beforehand book with a
    title that has exclamation sign with a space after it,
    e.g "exclamation! sign", it shouldn't find it as ES treats everything
    after that exclamation sign as negation.
    2) apply the patch.
    3) perform searches from the steep one and two again.
    Search from step one should no longer fail, while search from the step
    two should find that book.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa39f9a65efc15a7b6bcd4d0f4629294ab962060
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Tue Jul 13 12:13:03 2021 +0300

    Bug 28316: escape brackets in the search query
    
    This patch screens square and curly brackets which have no special
    language meaning.
    
    To reproduce:
    1) using ES, search for the book with title that contains
    square and/or curly brackets, like "book [second edition]", which will
    result in error.
    2) apply the patch.
    3) search for that book again, ensure that it works now.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 999f8ba0a8f36b3237e3e18758738bdb3812d31a
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Fri Jun 18 10:43:14 2021 +0300

    Bug 28316: screen unquoted semicolons and all followup colons
    
    Currently searches like: "book:", ":book" and "host-item:test:n"
    cause internal server errors.
    
    This patch adds additional regexes that remove the colons at the start
    and end of the query, and another regex that screens all follow-up
    colons that go after the first colon to avoid errors when searching for
    "host-item:test:n".
    
    To reproduce:
    1) using ES, search for the book with title that contains
    semicolon at the start or at the end of the line, separated with spaces,
    this should cause internal server error.
    2) try doing the same with something like "host-item:test:n", it should
    result in error as well.
    3) apply the patch.
    4) repeat steps 1-2, ensure that it works now.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da9fcb01532ad143c78ca93cc84063b5982a86f0
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Tue Jun 15 10:40:27 2021 +0300

    Bug 28316: add tests
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Alex Buckley <alexbuckley@catalyst.net.nz>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b296474cef4ec7b7eb491757cf7b230f481bef67
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 10 12:12:07 2021 +0000

    Bug 28985: Force positive numbers for itemtype charge fields
    
    This patch adds a min attribute to the fields on this page and adds
    other cost related fields to validator
    
    To test:
    1 - Apply patch
    2 - Browse to Administration->Item types
    3 - Edit or create an item type
    4 - Attempt to place a negative or non numeric value in:
        Daily rental charge
        Hourly rental charge
        Default replacement cost
        Processing fee
    5 - You should not be able to
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 87de9fbb8aa8aa4940cad8b2e6eb9a62bb9a401f
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Sep 13 11:53:39 2021 +0000

    Bug 28847: Remove dead code and make regex consistent
    
    This updates the regex code to match throughout the routine and removes
    code that would no longer be reached.
    
    Note that the code to update library name in the query descruiption was
    broken before this patch, so removal does not change behaviour
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4955c69243cf2aeca7293d2a50ce94c9f9337cd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Sat Sep 11 15:12:31 2021 +0000

    Bug 28847: (follow-up) Handle branch_group_limit
    
    To test:
    1 - Create a library group as an OPAC search group
    2 - Enable OpacAddMastheadLibraryPulldown
    3 - Browse to:
        http://localhost:8080/cgi-bin/koha/opac-search.pl?idx=&q=t&branch_group_limit=multibranchlimit-1&weight_search=1
    4 - Confirm search works and returns correct results
    5 - Confirm dropdown is correctly populated
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 109bbcf2421a66b31082ed93019fcbfbf643ee0b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Aug 13 19:48:48 2021 +0000

    Bug 28847: Only apply JS to branch/multibranch selection if there are search groups
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 065ec4e7260cb00279978e9cc1fa9b9c8d5232c4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 12 11:13:46 2021 +0000

    Bug 28847: Cleanup of branch limitsand fix OPAC_SEARCH_LIMIT
    
    The opac had 'branch_group_limit' parameters which can be simplified to more
    closely match intranet code.
    
    Adjust C4::Auth for chaneg above to ensure dropdowns correctly populate
    
    Expand JS to prevent selection of single and multibranch limits
    
    To test:
    1 - Enable OpacAddMastheadLibraryPulldown system preference
    2 - Ensure branches and groups show as before patch
    3 - Ensure single and multibranch limits from masthead apply as expected
    4 - Test advanced search page, ensure you cannot select both single and multibranch limit
    5 - Follow test plan on 28845 - ensure multibranch limit still correctly pre-selected
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8b86ac693c8dbf6ce695ce559b7d29c94c45cb1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 12 11:11:54 2021 +0000

    Bug 28847: Unit tests
    
    Note: tests are very similar between ES and Zebra, however, ES requires the uppercase
    OR and doesn't use '=' in the same way. I feel having test coverage in each module is fair and more future
    proof in case of changes to search engine
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 777c519c5a8fec958a7363aa02619f1fb5ad7d97
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 12 11:02:39 2021 +0000

    Bug 28847: Move SearchLimitLibrary code to QueryBuilder Modules
    
    This patch removes the code from the search scripts into QueryBuilder
    modules.
    
    To test:
    1 - Have a library group defined as a search group for both staff and opac
    2 - Search on staff client and opac with that group limit and a single branch limit
    3 - Note your results/counts
    4 - Note the visuals of the search description
    5 - Apply patch
    6 - Repeat searches
    7 - All should work as before
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01bb1f278747335a80aa69969ca9a91525b14078
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Sep 7 22:37:39 2021 +0000

    Bug 21093: In additem.pl set the right stickyduedate for fast add
    
    To test:
    -1 Set the specify due date option to a date, don't check the checkbox
    -2 Enter an unknown barcode
    -3 Click on fast add
    -4 Add a record
    -5 Add an item (don't change the barcode!)
    -6 The item is checked out to the patron
    -7 Verify: The checkbox is "Remember for session" is checked now
    -8 APPLY patch
    -9 Do steps 1-6 again, this time "Remember for session" should be unchecked
    -10 Do steps 1-6 again but this time do check the "Remember for session" checkbox.
    -11 It should be properly checked
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 91a557bd089701eb0034e312b1d7bee432977c49
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed May 26 11:16:13 2021 -0400

    Bug 28464: Remove useless check that gives the incorrect error message
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07b10a77ee4c27c6bfdd7dc4cede21e1f4c01773
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed May 26 11:13:44 2021 -0400

    Bug 28464: Add unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 28464: (QA follow-up) Correct test plan
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b678b638358989ecad48a9a4f0136990904b691
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue Jun 30 12:20:39 2020 -0400

    Bug 28228: Supress plugin related error message
    
    Use of uninitialized value in subroutine entry at /usr/share/koha/lib/Koha/Plugins/Base.pm line 182.
    
    Test Plan:
    1) Install the Kitchen Sink plugin ( it does not have a max versio defined )
    2) Note the warning in your logs
    3) Apply this patch
    4) Restart all the things
    5) No warning!
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b85472b2eac5ca7f11d9cab420b7deb7de47a71
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Aug 27 08:37:03 2021 -1000

    Bug 28914: Fix wording in authentication forms
    
    In most authentication forms we see :
    Fields "Login:" and "Password:" with a submit button "Log in".
    
    In some places submit button contains "Login", which is confusing for translation.
    It is not correct according to terminology https://wiki.koha-community.org/wiki/Terminology#L
    Also in opac-user.pl ":" is missing, it generates new translation entries.
    
    Test plan:
    1) Log out if you are logged in
    2) Go to staff interface
    3) Check you see button "Log in"
    4) Go to OPAC page /cgi-bin/koha/opac-user.pl
    5) Check you see fields "Login:" and "Password:"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b94a1d60e3bd99987e0cd2a141da2f420476237
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Aug 6 16:02:09 2021 -1000

    Bug 28829: Remove single quote escaping in value_builder/unimarc_field_4XX.pl
    
    Since Bug 23777 added To.json, single quote escaping in value_builder/unimarc_field_4XX.pl is useless.
    
    Test plan:
    1) Use UNIMARC database
    2) Define value builder unimarc_field_4XX on 463$t
    3) Create a record B1 with 200$a : L'avion
    4) Create a record B2
    5) Click on value builder in 463$t
    6) Search for record B1
    7) Click on "Choose"
    => Without patch 463$t contains : L\'avion
    => With patch 463$t contains : L'avion
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 68ea3d67dd6591602beb61451ab0f5b11799cabf
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Fri Sep 17 15:51:51 2021 +0200

    Bug 28472: (follow-up) add unit test for the case where location = NULL
    
    This patch adds an extra unit test, to cover the case where the
    UpdateItemLocationOnCheckin System Preference is set to "_ALL_: CART"
    and the item being returned has no shelving location set.
    
    Test plan:
    
    1) Apply the patch provided earlier
    2) prove -v t/db_dependent/Circulation/issue.t
       ...and sign off if all tests pass.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    JD amended patch: use 'is' instead of 'ok'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5de0705275ba5a61ebee2d8766d804a36c611287
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Fri Jul 2 13:12:21 2021 +0200

    Bug 28472: handle items with NULL shelving location
    
    The UpdateItemLocationOnCheckin System Preference can be set to update the
    location of ALL items during check in, regardless of their shelving location.
    However, this does not currently work 100% as it is excluding items with no
    shelving location (i.e. value of NULL in the corresponding database field).
    
    This patch, based on the comment made by Nick Clemens, fixes that.
    
    Test plan (based on the original Bug Description by Andrew Fuerste-Henry):
    
    1) Have a shelving location CART
    2) In UpdateItemLocationOnCheckin, enter "_ALL_: CART" (without the quotes)
    3) Check in an item that has a shelving location, confirm it changes to CART
    4) Check in an item with a NULL shelving location, confirm it doesn't go to CART
    5) Apply this patch
    6) Repeat step 4): this time the item should move to the CART shelving location
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bb6f2c2ed082ba26db19cd8ac5c8aaeec7a3b8e3
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Sep 9 15:21:10 2021 +0000

    Bug 28986: Remove (All) notation to correctly select rule for editing
    
    This patch updates the JS comparison code to remove the '(All)' hint before comparing
    to the current value
    
    To test:
    1 - Go to Administration -> Item types
    2 - Edit a type to have a parent of another type
    3 - Go to Administration -> Circulation and fines rules
    4 - Add a rule for all categories for the child itemtype
    5 - Add a rule for all categories for the parent itemtype
    6 - Click edit on child type, note itemtype dropdown in editor correctly selected
    7 - Click edit on parent type - note itemtype dropdown menu refers to 'All' itemtypes
    8 - Apply patch
    9 - Reload page and edit parent type rule
    10 - Itemtype dropdown is correctly populated
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95dc733f6fc283d710edb17049942cd2de0de109
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Sep 7 11:57:48 2021 +0000

    Bug 28845: (follow-up) Retain selection when using advanced search
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 280c096d0794c05b8f15801735d205460a7f606a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Aug 11 15:30:36 2021 +0000

    Bug 28845: Match against the full limit string, not just the group id
    
    To test:
    1 - Add to OPAC virtual host in apache conf:
       SetEnv OPAC_SEARCH_LIMIT branch:multibranch-1
       SetEnv OPAC_LIMIT_OVERRIDE 1
       RequestHeader add X-Koha-SetEnv "OPAC_SEARCH_LIMIT branch:multibranchlimit-1"
       RequestHeader add X-Koha-SetEnv "OPAC_LIMIT_OVERRIDE 1"
    2 - Enable system preference OpacAddMastheadLibraryPulldown
    3 - Create a library group enabled as OPAC search group (or make sure existing group 1 is an OPAC search group)
    4 - Load the opac - dropdown does not pree-select the search group
    5 - Apply patch
    6 - Relaod opac - group is pre-selected!
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea88cfb3ab75bec6d5a49def235f0397e33acdd4
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 7 15:39:43 2021 +0000

    Bug 28676: Cache and retrieve match_count when searching a cached heading
    
    We use match_count to determine if a new authority record should be created, however,
    we were not adding this count to the cache, so if a record returned too many matches on first
    lookup, we would create a new record on the second lookup
    
    To test:
    1 - Set Linker Module to 'Default'
    2 - Enable  AutoCreateAuthorities  and  BiblioAddsAuthorities and  CatalogModuleRelink and LinkerRelink
    3 - Add two copies of a single authority via Z39
    4 - Add two headings for that authority to a bib record (e.g. a 610 and 710)
    5 - Save the record and note a new authority is generated
    6 - Repeat and see another is generated
    7 - Apply patch
    8 - Restart all the things
    9 - Save the record again, no new authority created
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ce51e2c9816199fa645064d10359e6d904170631
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 7 15:39:21 2021 +0000

    Bug 28676: Unit test
    
    Signed-off-by: Phil Ringnalda <phil@chetcolibrary.org>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 51f978696eb6f9a5a1f76a952fe56d51d97e799a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Sep 7 12:14:03 2021 +0100

    Bug 28960: Explicitly call get_column
    
    This patch adds get_column to ensure we are returning a string value of
    a field rather than accidentally triggering a relationship accessor.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d609e42a3cf537bdeb3ff35db7e72191d5b92eb9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Sep 14 18:22:13 2021 +0200

    Bug 17600: Fix opac/svc/overdrive
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 047c65d385e263bc6abdb9bc1b61316bab4559be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Sep 10 10:03:05 2021 +0200

    Bug 28946: (bug 23271 follow-up) Missing occurrence in add_user_search.pl
    
    commit f6e0b04f48e8f0a02dbb8d48152646257d9accba
    Bug 23271: Replace search_limited with search_with_library_limits
    
    We were modifying the occurrences of:
      Koha::Patron::Categories->search_limited;
    with:
      Koha::Patron::Categories->search_with_library_limits;
    
    But between the patch submission and the push, another occurrence has
    been added by bug 23590.
    
    Test plan:
    Create a new suggestion from staff and click "select manager"
    Without the patch, notice the error:
      The method Koha::Patron::Categories->search_limited is not covered by tests!
    With the patch applied everything is working correctly
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a5a3a330cfc7c7d6c35db13326745dabf8fe0df3
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Mon Aug 30 16:26:05 2021 +0200

    Bug 28921: Remove warning from html_helpers.inc
    
    Argument "" isn't numeric in numeric gt (>) at /home/koha/src/koha-tmpl/opac-tmpl/bootstrap/en/includes/html_helpers.inc line 23.
    
    To test:
    1 - Open OPAC main page
    2 - Check opac-error.log or plack-opac-error.log for message as above
    3 - Apply patch
    4 - Open OPAC main page
    5 - Check opac-error.log again, there should be no more warnings
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f6af47c15c27afbdf147bd1c2be2428e82262c7
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 17 10:17:35 2021 +0000

    Bug 28149: (follow-up) Add string for job status "new"
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c35f6f70a0952617e47934de0a86469d42b9c47f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Apr 14 17:43:38 2021 +0000

    Bug 28149: Improve internationalization and formatting on background jobs page
    
    This patch adds some logic to the background jobs template in order to
    make job status and job type translatable. Output of dates has been
    changed to use the KohaDates plugin, using the "with_hours" flag.
    
    This patch also modifies the page title and breadcrumbs so that if one
    is viewing the details of a background job the page title and
    breadcrumbs reflect this.
    
    I've also added inclusion of the preferences search form in the header,
    the default for administration pages which don't have their own search.
    
    To test, apply the patch and go to Administration -> Background jobs.
    
     - If there are no background jobs listed, submit at least one batch of
       bibliograhpic records and at least one batch of authorty records for
       modification (Tools -> Batch record modification).
       - In the table of background jobs, the status should be shown
         correctly. If you see it capitalized ("Finished") you're seeing the
         new string in the template which will be used for translation.
       - In the "Type" column, you should see either "Batch authority record
         modification" or "Batch bibliographic record modification"
       - In the "Queued," "Started," and "Ended" columns the date should be
         formatted according to your system's dateformat system preference,
         including the time.
      - View the details of a background job. The same changes to status and
        type should be seen on this page, as well as the date formatting of
        the date fields.
        - In the breadcrumbs, confirm that it shows a link to the
          background jobs page followed by "Details if job #X".
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 432e4b88e8ab6851c9c7a46d819968754a2db12f
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Sep 1 14:17:21 2021 +0000

    Bug 28392: make streettype and B_streettype work with BorrowerUnwantedField
    
    To test:
    1. Add values to the AV ROADTYPE
    2. Go to the BorrowerUnwantedField system preference and attempt to hide streettype and B_streettype.
    3. It doesn't work, the fields still show.
    4. Apply patch
    5. Repeat step 2, it should work now.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aba3611dc0ff8ff2ec538f779b8b692e4482f8ca
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sat Sep 4 18:23:16 2021 +0000

    Bug 21794: (QA follow-up) Separate city and country with a comma
    
    If only the city and country address information was provided they ended
    up being glued together like this: CityCountry. (AddressFormat=US style)
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea9b9ba090b208d02aff11a8bc289e2cda287d4e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Aug 24 00:34:13 2021 +0200

    Bug 21794: Fix display of addresses on details tab in staff when city is empty
    
    If the city field was not filled out on the main or alternate address,
    the content of state, country and zipcode wouldn't display on the
    Details tab in the patron account in staff.
    
    To test:
    - Enter main contact and alternate address without city
    - Verify that the address information isn't shown on the details
      tab after saving
    - Apply patch
    - Verify that the information is displayed now
    - Toggle AddressFormat and check display is correct for all settings
    - Switch back to US address format
    - Try several combinations of empty fields for city, zipcode, country
      and state. The punctuation and whitespace should always appear
      correctly.
    
    Examples:
    - Enter just country
    - Enter zipcode and country
    - ...
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90d6d1b4a73f49f182ae456b18eff789ed897a73
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed Sep 1 16:24:52 2021 +0000

    Bug 28936: Add sort1/sort2 to borrowers.json
    
    To Test:
    1. Check the BorrowerMandatoryField and BorrowerUnwantedField system preferences, sort1 and sort2 cannot be hidden or required
    2. Apply patch
    3. Check the BorrowerMandatoryField and BorrowerUnwantedField system preferences again, you should see sort1 and sort2
    4. Since sort1 and sort2 are now added to borrowers.json we must also check the system preferences PatronQuickAddFields & PatronDuplicateMatchingAddFields
    5. They should both now include sort1 and sort2, check to make sure they work with these two system preferences
    6. Look at the system preferences PatronSelfRegistrationBorrowerMandatoryField, PatronSelfRegistrationBorrowerUnwantedField, and PatronSelfModificationBorrowerUnwantedField
    7. sort1 and sort2 should be disabled in these OPAC system preferences
    
    This patch does not attempt to add sort1 or sort2 to the self reg or borrower mod pages. If they should be added, which I am not sure they should, we should do so in a seperate bug
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f11453e6cc604ae7b5c8b2206216ae41ad7e4f2d
Author: Joonas Kylmälä <joonas.kylmala@iki.fi>
Date:   Sun Sep 5 12:10:17 2021 +0000

    Bug 10265: (QA follow-up) Make if-else checks consistent
    
    The != '' version doesn't check for the whitespace existing and thus
    might have added the punctuation without the partNumber or partName being
    inserted at all.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96c490517242c987ee5049e5b7e4d9c9e9f45cf7
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Aug 22 03:29:47 2021 +0000

    Bug 10265: Keep punctuation for 8xx series added entry fields (MARC21)
    
    At the moment the punctuation entered for $n $p and is
    removed in the part template, which leads to displaying the subfields
    without any punctuation and spaces in between.
    
    To test:
    - Catalog records with various combinations of 8xx series added
      entry fields. Subfield a, t, n, p and v are the most important.
    - Verify the display in OPAC and staff is not great.
    - Apply the patch.
    - Verify the display in OPAC and staff is improved.
    
    For examples see:
    https://www.loc.gov/marc/bibliographic/bd80x83x.html
    
    Important note: At the moment 8xx series added entry fields will only display, when
    there is also a 490 ind. 1 = 1 field present.
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95ff094030344e22b43ebf73a6a8184bea18c26f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 27 16:59:43 2021 +0200

    Bug 28912: Remove duplicated warnings on the about page
    
    Bad conflict resolution
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac9dff5509448d733026ee4b7f8dde8b1a6b9394
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 27 16:56:08 2021 +0200

    Bug 28912: Prevent Pseudonymization to be set if bcrypt_settings not set
    
    If Pseudonymization is set but the bcrypt_settings config used by the
    feature is not set, then there is an ugly 500 on checking out.
    
    bad bcrypt settings at /kohadevbox/koha/Koha/PseudonymizedTransaction.pm line 116.
    
    However it's pretty hard to handle correctly this exception (and that's
    why it hasn't be done initially). However we could prevent the pref to
    be turned on if the config entry is not present.
    
    Test plan:
    Remove the bcrypt_settings from the config
    Try to turn the syspref on
    Add the config
    Try to turn the syspref on/off
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    JD amended patch: fix qa failures
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 641c4ffa97a6060c939934ef21d9b59ddd9a05eb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 25 11:47:18 2021 +0200

    Bug 28882: Disable select/hide all links
    
    We want to prevent non-superlibrarian users to remove superlibrarian
    flag.
    It's handled already in the controller, but needs to be done
    client-side.
    
    Here we are disabling the select/hide all links to remove the remaining
    possibility to remove the superlibrarian flag from non-superlibrarian
    users.
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f58ecb609107cead637734d43bff277f564ce12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 19 15:07:50 2021 +0200

    Bug 28882: permission UI allows selection of superlibrarian permission
    
    With bug 20100 and 22150 we allow to select all the permissions but the
    superlibrarian permission, to ease the selection. And we also forbid a
    non-superlibrarian user to add superlibrarian permission.
    
    However there is something wrong in the JS code and it's possible to add
    the superlibrarian permission. The user is getting an ugly 500 and so
    the permission change is not done, but the UI checks must be fixed.
    
    To recreate:
    Login with a non-superlibrarian user
    Edit permission
    Clear all
    => You can select the "superlibrarian" permission
    
    Test plan:
    Login with a non-superlibrarian user
    Try to set the superlibrarian permissions to a user
    => not possible
    Try the select all/clear all
    => still cannot set the superlibrarian permission
    
    Work to be done:
    Login with a non-superlibrarian user
    Edit permissions for a superlibrarian user
    => You can remove it, then cannot add it back
    Should we allow removal of superlibrarian permission by
    non-superlibrarian user?
    
    Signed-off-by: Hayley Pelham <hayleypelham@catalyst.net.nz>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 53b435ff0364260daadbd3f264fc2053249da536
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Tue Aug 31 14:00:00 2021 +0200

    Bug 28306: Fix t/db_dependent/Koha/Objects.t
    
    It looks like a circular dependency problem where methods are
    not exported correctly
    
    There is at least one circular dependency here:
    
        C4::Context -> Koha::Caches -> Koha::Cache -> C4::Context
        (-> means "uses")
    
    The tests pass if C4::Context is loaded early, so the patch does that.
    
    Circular dependencies should be fixed ideally, but it is a little
    more complicated, and I don't have the time right now...
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 48f1c6db7a73dd04c41fcd8462e6fb91afaeb91d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Sep 3 15:25:32 2021 +0000

    Bug 28373: (follow-up) Fix copy error
    
    Previous commit linked all 'default' buttons for sysprefs to OPACXSLTListsDisplay
    
    This adjusts the links
    
    To test:
    Click "default" for all 6 XSLT preferences
    Confirm the syspref relating to the link is marked 'modified' when clicked
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 72fc7babaa97dc6534325f248520715c29452f96
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Sep 1 18:08:49 2021 +0000

    Bug 28938: Correct Flatpickr's default 12hr time formatting
    
    This patch corrects Flatpickr's default 12 time formatting so that it
    uses the formatting token "G" ("Hours, 2 digits with leading zeros")
    instead of "h" ("Hours, 2 digits without leading zeros").
    
    This will prevent incorrect times from being saved when the submitted
    time is before 12.
    
    - To test, apply the patch go to Administration -> System preferences.
    - Set the TimeFormat system preference to "12 hour"
    - Find an item which is checked out and renewable.
    - Go to Circulation -> Renew and use the date picker to select a time <
      12, e.g. 9:00 AM
    - Submit the barcode for renewal.
    - Check the patron's account to see the due date of the renewed item: It
      should match the date and time you selected.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5aaaa57ce4790068f3092f3aa33d98b87a14e746
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 9 16:01:43 2021 +0200

    Bug 20529: Remove other occurrences of decodeURIComponent from browser.js
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 125c5da32a4a21e6f1b39e24ee172b9c09d474f0
Author: Victor Grousset <victor.grousset@biblibre.com>
Date:   Mon Apr 16 18:55:48 2018 +0200

    Bug 20529: Fix "Return to results" link broken by a double quote
    
    (in the search query)
    
    cause: decodeURIComponent used when URI encoding was necessary. (At
    least in main usecase of this feature)
    It could have been a copy and paste error. From the above
    browseRecords() function.
    
    == Test plan ==
    1. Search in the staff catalogue «a "alice"»
         Replace a and alice with whatever than will return a result for you
    2. Click on the first result
    3. Check the "Return to results" link
         It should be like
         staff_url://cgi-bin/koha/catalogue/search.pl?idx=kw&q=a
         This is the bug. Because when clicking the link, your search will be
         'kw,wrdl: a'
         instead of
         'kw,wrdl: a "alice"'
    4. Apply this patch.
    5. Search in the staff catalogue «a "alice"»
         Replace a and alice with whatever than will return a result for you
    6. Click on the first result
    7. Check the "Return to results" link
         The link should preserve the full query
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1bd10a4a2e2c25a2b688f898d31f9ee1e6089e40
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 31 12:09:44 2021 +0000

    Bug 28928: Minor follow-ups to Bug 28376 - Flatpickr introduction
    
    This patch corrects three errors in the original Flatpickr introduction
    patch:
    
    - Missing document.ready() in borrowers_stats.tt.
    - Redundant calendarFirstDayOfWeek setting in caregories.js
    - Missing preventDefault() in calendar.inc
    
    The first two issues don't appear to cause any malfunction but are best
    practices. The third issue can cause the page to scroll unexpectedly.
    
    To reproduce this bug, go to (for instance) Administration -> Patron
    categories -> New category.
    
     - If necessary, narrow the height of your browser window so that there
       is a vertical scrollbar.
     - Scroll down the page so that the "Until date" field is at the top.
     - Click the "X" next to the field.
     - The page will scroll to the top.
    
    Apply the patch and test again. The page jump should not occur.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80b8c6e225e9987e96849f1b9257d2a67c7cf37c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 31 10:26:05 2021 +0200

    Bug 25078: Fix indentation and style for additional descriptions
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4d285a9c40c9afdb8fd4472d2b5cd83da264b40
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 13 14:50:16 2020 -0300

    Bug 26195: Add a way to specify authorised values should be expanded [OAI]
    
    This patch introduces a new configuration entry for OAI so the resulting
    records include authorised value descriptions instead of codes.
    
    This is off by default.
    
    To test:
    1. Create a yaml file with the extended OAI configuration
    2. Visit http://kohadev.myDNSname.org:8080/cgi-bin/koha/oai.pl
    3. Browse some records
    => SUCCESS: The fields tied to AV show codes.
    4. Update your configuration with 'expanded_avs: 1' for one  of the
       defined format like in:
    
      ---
      format:
        marc21:
          metadataPrefix: marc21
          metadataNamespace: http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim
          schema: http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd
          include_items: 0
        marcxml:
          metadataPrefix: marcxml
          metadataNamespace: http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim
          schema: http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd
          include_items: 1
          expanded_avs: 1
    5. restart_all
    6. Repead 3
    => SUCCESS: AV descriptions are returned!
    7. Sign off :-D
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57e95681d4b4e51fb48e1925690a0960d594016b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 23 15:19:30 2021 -0400

    Bug 28306: Fix POD
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c115fcff70271246c500d5b5f9290c47b715693
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 23 15:11:52 2021 -0400

    Bug 28306: Switch back to using 'mock' instead of 'redefine'
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4605304f62228172be094393875625b1e9666bda
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon May 10 08:54:35 2021 +0200

    Bug 28306: Allow to query database with minimal memory footprint
    
    The goal is to be able to build a database handler (dbh) and to execute
    queries without loading unnecessary stuff. This will be useful to reduce
    memory usage of daemons that need to check the database
    periodically
    
    The patch provides a new method Koha::Database::dbh which returns a
    database handler without loading the DBIx::Class schema. This method is
    also used by DBIx::Class, so whether you use DBI or DBIx::Class, the
    same method is used to initialize the connection.
    
    The patch also moves some code in order to avoid loading C4::Context:
    - C4::Context::timezone moves to Koha::Config
    - C4::Context::db_scheme2dbi moves to Koha::Database
    
    To measure memory usage I used the following commands:
    
    * before the patch:
    perl -MKoha::Database \
        -E 'Koha::Database->schema->storage->dbh->do("select 1");' \
        -E '$|=1; say $$; sleep 2' \
        | while read pid; do ps -p $pid -o rss=; done
    
    * after the patch:
    perl -MKoha::Database \
        -E 'Koha::Database->dbh->do("select 1");' \
        -E '$|=1; say $$; sleep 2' \
        | while read pid; do ps -p $pid -o rss=; done
    
    It will give you the RSS (Resident Set Size) of the perl process in kB
    
    What I get:
    * before the patch: between 96.9MB and 97.2MB
    * after the patch: between 17.8MB and 18.2MB
    
    Note that if a timezone is configured (either from $KOHA_CONF or
    TZ environment variable), Koha will load DateTime::Timezone to check if
    it's valid, and it increases RSS to 36MB
    
    Another interesting metric is the number of modules loaded:
    * before the patch:
    perl -MKoha::Database \
        -E 'Koha::Database->schema->storage->dbh;' \
        -E 'say scalar keys %INC'
    
    Result: 567
    
    * after the patch:
    perl -MKoha::Database \
        -E 'Koha::Database->dbh;' \
        -E 'say scalar keys %INC'
    
    Result: 51
    
    Test plan:
    1. Apply the patch & restart starman
    2. Make sure Koha is still ok (ie. can access the database, does not
    have encoding issues, ...)
    3. Run the tests in t/Context.t, t/Koha/Config.t,
    t/db_dependent/Koha/Database.t, t/timezones.t
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1fc2e3f7a547a0b703c7e359d9095b00316c4c94
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 31 10:16:49 2021 +0200

    Bug 28774: DBRev 21.06.00.021
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70d2deb10369bc959c305030f0200d4de0102fd7
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 28 12:23:50 2021 +0000

    Bug 28774: Don't store blank values for rental discount
    
    This patch adds 'can_be_blank => 0' for the rentaldiscount rule to prevent
    storing blank values in the database
    
    Additionally, if there is no charge we do not need to check for a discount
    and can simply return
    
    To test:
    1 - Set rental discount to "" to a rule in circulation rules
    2 - Checkout an item that will follow this rule
    3 - Check the intranet log:
        [WARN] Argument "" isn't numeric in subtraction (-) at /kohadevbox/koha/C4/Circulation.pm line 3385.
    4 - Apply patch and restart all
    5 - Update database
    6 - Set the rule to "" again
    7 - Check the DB, no rule is stored
        SELECT * FROM circulation_rules WHERE rule_name = 'rentaldiscount';
    8 - Checkout the item again
    9 - No warns in log
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a56bf98c1b5d7a739200617958096f6e8a2c768
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 31 10:15:28 2021 +0200

    Bug 28373: DBRev 21.06.00.020
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 192d5bf13ba24d2e9f67e998b0b8f70bdb204c8a
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 30 19:53:40 2021 +0000

    Bug 28373: Add warning if custom stylesheets are defined
    
    This patch adds a check of the current XSLT prefs and warns to check the new pref
    if any are not set to default
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2bc48bc748a425d05f465feef501a8aa3b2dbae0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 30 19:53:07 2021 +0000

    Bug 28373: Add note to XSLT prefs about the new pref
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 735ce7bd7d9a1a39412bf88903fa55ab4e7e8686
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 23 14:12:26 2021 +0000

    Bug 28373: (follow-up) QA fixes
    
    Use fully qualified subroutine name
    Don't return explicit undef
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 967244f898fdf92eea2b71bf4fa0c258208a0853
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Jun 3 21:47:42 2021 +0000

    Bug 28373: (QA follow-up) Fix typo in system preference description
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 28373: (QA follow-up) Add . to end of system preference description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc20c964b03538370570c1dcc30dbf0e4580cb5d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 18 15:06:43 2021 +0000

    Bug 28373: Add PassItemMarcToXSLT system preference
    
    Default stylesheets do not reference item fields for XSLT display, however, we
    spend time translating the values in the item fields.
    
    This patch adds a system preference, PassItemMarcToXSLT. and unless enabled we remove
    item fields before processing
    
    To test:
    1 - Perform some search on the staff client and opac
    2 - Use the console (F12) to view the time spent on the network tab
    3 - Note performance
    4 - Apply patch, updatedatabase, restart_all
    5 - Repeat searches
    6 - Note that display has not changed
    7 - Note performance, results should display slightly faster
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1648c52c92e6bd0e04be63820b997701a4bc0673
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jul 6 12:32:19 2021 +0000

    Bug 28373: Unit test
    
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3675ff994062ac6adeaa575171c89a6bfa69b92d
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Aug 19 10:49:34 2021 -0400

    Bug 28885: Skip invalid biblios for OpacBrowseResults
    
    If a record is deleted from Koha, but is for some reason not deleted from the search indexes, OpacBrowseResults can cause an ISE if the deleted record is in the search results for any given item. OpacBrowseResults loops through the search results, and checks if there is a biblionumber, but does *not* check to see if a result was pulled from the database for that biblionumber. It simply assumes the result must exist.
    
    We should be checking to ensure the biblionumber was valid before operating on the biblio object.
    
    Test Plan:
    1) Use zebra for searching
    2) Disable koha-indexer
    3) Enable OpacBrowseResults
    4) Perform a search
    5) Delete an item in the search results
    6) View on of the remaining items in the search results
    7) Note the error
    8) Apply this patch
    9) Restart plack
    10) Reload the page
    11) The error should be gone!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@iki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c9342322f40e6693125251a997060e9c1f48077
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 31 08:23:01 2021 +0200

    Bug 22690: Fix the tracklink feature
    
    With the FK we must set to undef/NULL, not 0.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5db6ab82f6e6a1e0eae0c06a56ea51f3a53c9e7d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 30 18:08:26 2021 +0200

    Bug 28376: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f892ae8bf1f5e82b566ea0d22fc36b88fb33774a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu May 20 15:48:58 2021 +0000

    Bug 28376: Replace jQueryUI date/timepicker with Flatpickr
    
    This patch is a proof of concept demonstrating how jQueryUI date & time
    pickers could be replaced using the Flatpickr library
    (https://flatpickr.js.org/).
    
    NEW: I've modified the default configuration of Flatpickr instances so
    that a "Clear date" link is automatically appended. This eliminates the
    need to add a button to the markup and event handling for each case.
    
    NEW: Date/time formatting should be corrected in this revised patch.
    
    The patch modifies three pages as test cases:
     - Circulation -> Renew (with SpecifyDueDates enabled), to demonstrate
       date and time selection.
       - NEW: You can also test the datepicker shown when you renew an
         on-hold item. This demonstrates a configuration which requires that
         the selection be after today.
     - Administration -> Patron categories -> New category, to demonstrate a
       calendar-only date picker enforcing a date after today.
     - NEW: Reports -> Patrons. The "Date of birth" fields are linked so
       that the second cannot be before the first.
    
    I've made some customizations to the default Flatpickr library's CSS and
    incorporated it into staff-global.scss, so you must rebuild the staff
    client SCSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1393e48d8e1bf036bc558b99b5a5bb9b9c13342a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 30 18:06:42 2021 +0200

    Bug 26302: (follow-up) DBRev 21.06.00.019
    
    oops
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e52cc698fadf12670f493990042533f3b4bc3cd8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 30 17:08:58 2021 +0200

    Bug 26302: DBRev 21.06.00.019
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d85e5c80bc44b15650600ae915f426aca6ed2df
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 30 14:18:20 2021 +0000

    Bug 26302: (QA follow-up) Prefix prefs with OPAC
    
    git grep -l "ResultsMaxItems" | xargs sed -i -e "/ResultsMaxItems/ s/ResultsMaxItems/OPACResultsMaxItems/g"
    
    And line:
    koha-tmpl/opac-tmpl/bootstrap/en/xslt/MARC21slim2OPACResults.xsl:    <xsl:variable name="OPACResultsMaxItems" select="number(marc:sysprefs/marc:syspref[@name='resultsMaxItems']+0)"/>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7b9f0106a3a0cc9689f14d55ea92c929a9322ffd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 30 15:18:40 2021 +0200

    Bug 26302: Make syspref's names start with uppercase
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb752d7e245eb458db5788db75eecb883f2f47b6
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 9 11:55:11 2021 +0000

    Bug 26302: (QA follow-up) Prevent empty call numbers
    
    This does not make the code easier, but here we go:
    
    Suppose resultsMaxItems == 2.
    If we would normally list two call numbers like:
        Liberty (2) [Call number: PERL F 1, PERL F 2].
    If one call number would be empty, we now list:
        Liberty (2) [Call number: PERL F 1, ...].
    And when both are empty, we only show a number:
        Liberty (2).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 174554bb4da10d602ef8fe0d6ef15e18de89ba3c
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 9 09:51:36 2021 +0000

    Bug 26302: (QA follow-up) Reset preference values
    
    Mimic current behavior.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ddce55a2aa33128189f55a7b61ef605b8a656cc2
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 5 11:43:16 2021 +0000

    Bug 26302: Refactor Availability block in OPAC results xslt
    
    Decided finally to do a larger refactor here. Hopefully we improved
    consistency and removed some redundancy. And the two new prefs provide
    additional functionality.
    
    Most significant changes:
    [1] Clearer distinction of the Availability line in three parts:
        Available, Reference and Unavailable.
        For Unavailable we loop thru branches now too.
    [2] Calling template to list item data (including location or ccode).
        Made the separate Location line obsolete.
    [3] The tests around OPACItemLibrary are removed since we now look at
        resultbranch from XSLT.pm.
    [4] Removed code replication for various 'other' statuses like Checked out.
    [5] Obsoleted three xslt key indexes, singleBranchMode.
    [6] Apply the two prefs to control number of listed items.
    
    Test plan:
    You may play with: OPACResultsLibrary (home/holding), OPACItemLocation
    (library, callno, location, ccode), resultsMaxItems[Unavailable] (numbers),
    Reference_NFL_Statuses (list of notforloan codes in reference part).
    
    [1] Create a biblio with various items on a few branches. Fill call number,
        location and ccode too. Set home branch and holdingbranch differently.
    [2] Toggle the preferences, and verify display within OAPC search results.
    
    Example with prefs (home, callnumber, 2, 2):
    Availability: Items available for loan: Centerville (2)Call number: perl A 4, PERL D 1. Items available for reference: Fairfield: Not For Loan (1)Call number: PERL A 5. Not available: Centerville: Checked out (1)Call number: PERL A 3. Centerville: Ordered (1)Call number: PERL B 1. Centerville: Staff Collection (2)Call number: PERL A 2, PERL E 1. Centerville: Withdrawn (1)Call number: PERL B 2. Fairfield: Withdrawn (1)Call number: PERL C 1.
    
    Same data with prefs (holding, callnumber, 2, 2):
    Availability: Items available for loan: Centerville (1)Call number: PERL D 1. Liberty (1)Call number: perl A 4. Items available for reference: Centerville: Not For Loan (1)Call number: PERL A 5. Not available: Centerville: Checked out (1)Call number: PERL A 3. Centerville: Staff Collection (1)Call number: PERL A 2. Centerville: Withdrawn (1)Call number: PERL B 2. Fairfield: Ordered (1)Call number: PERL B 1. Fairfield: Withdrawn (1)Call number: PERL C 1. Liberty: Staff Collection (1)Call number: PERL E 1.
    
    Same data with prefs (holding, library, n/a, n/a):
    Availability: Items available for loan: Centerville (1). Liberty (1). Items available for reference: Centerville: Not For Loan (1). Not available: Centerville: Checked out (1). Centerville: Staff Collection (1). Centerville: Withdrawn (1). Fairfield: Ordered (1). Fairfield: Withdrawn (1). Liberty: Staff Collection (1).
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2fce208e64b7b5e2e63861641becabb08b302d8d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 5 12:24:31 2021 +0000

    Bug 26302: Changes for substatus, resultbranch in XSLT.t
    
    Test plan:
    Run t/db_dependent/XSLT.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 513d72135eb4b630a6148879dae43142bca20b53
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Aug 5 11:43:16 2021 +0000

    Bug 26302: Add resultbranch and other status in C4/XSLT
    
    Groundwork for changes in the OPAC results xslt.
    
    NOTE: Adds both new prefs too.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d7b9c443861ecf211a21e4fe23cd0466e6d3615
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 24 13:43:20 2021 +0000

    Bug 26302: Add dbrev for two new prefs
    
    Adding two prefs:
        resultsMaxItems
        resultsMaxItemsUnavailable
    
    Test plan:
    Check Preferences/OPAC/Appearance.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b6a79be4cd076f86b4bea5fdd4a33e17ae301ec
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Mon Jul 26 12:27:40 2021 +0300

    Bug 28736: fix requirements for the correct error message to show up
    
    There is existing error message in the code stating:
    "Unable to understand your search query, please rephrase and try again."
    which fits perfectly but because it looks for "ParseException" in the
    warning output it doesn't show up on this page as it's actually
    "parse_exception".
    
    This patch makes that it's also checked if "parse_exception" is present
    in the warning output.
    
    Side note:
    "ParseException" reaction code was added here:
        e0f6c4dc Bug 12478: improve error reporting a bit
    Search::Elasticsearch seems propagates clean ES JSON answer,
    and in current ES version inside of $@ it contains "parse_exception"
    string in dumped JSON answer ("'type' => 'parse_exception'").
    Old seeked phrase "ParseException" wasn't reproduced, only in ES logs
    ("Caused by: org.apache.lucene.queryparser.classic.ParseException:
     Cannot parse ..."). Check for both phrases won't complicate future
    changes, but this note added for reference and code cleanup if needed.
    
    To reproduce:
    1) using ES search for something like "// ^ ! { } [ ] .. , <>" that
    will for sure break the syntax of ES.
    2) after the search query fails note that the error is
    "Unable to perform your search. Please try again."
    3) apply the patch
    4) search for the same thing again
    5) error message should be "Unable to understand your search query,
    please rephrase and try again." now.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a2bb93da7ab21d77e155048d0f0acee3598fae5
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Aug 11 12:21:19 2021 +0000

    Bug 28843: Add view and edit buttons to result of MARC record import
    
    This patch adds "View" and "Edit" buttons to the output of the result of
    a MARC record import.
    
    To test, apply the patch and go to Tools -> State MARC for import.
    
     - Import a file of MARC records.
     - Click the "Manage staged records" button.
     - In the table of staged records the last column labeled "Records"
       should be empty.
     - Click "Import this batch into the catalog."
     - The table of records will be shown again, and this time the last
       column should contain "View" and "Edit" buttons for each row.
     - Confirm that the buttons work correctly, opening the correct record
       for viewing and editing.
    
    Test with both bibliographic and authority records to confirm that the
    correct view and edit pages open for each.
    
    EDIT: Add permission check for "Edit" link
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 108857e1edc801d74a53fb080e335ed36681d00e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 19 10:55:17 2021 +0000

    Bug 24019: Patron batch modification based on borrowernumber
    
    This patch adds batch patron modifications based on borrowernumber. The
    user can choose to upload a file of borrowernumbers or submit a list of
    borrowernumbers in a textarea, just like they can with card numbers.
    
    To test, apply the patch and prepare files containing borrowernumbers
    and card numbers. Patron lists should be enabled, and you should have at
    least one patron list with patrons on it.
    
    - Go to Tools -> Batch patron modification.
    - You should see three tabs: "By card number," "By borrowernumber," and
      "By patron list."
    - Test each option for batch patron modifications:
      - By card number file
      - By card number list
      - By borrowernumber file
      - By borrowernumber list
      - By patron list
    - In each case the correct batch should be submitted, and modifications
      should finish correctly..
    - There should be an "order of operations" for card numbers and
      borrowernumbers:
      - If a file is uploaded AND a list of numbers is entered, the list of
        numbers should be used.
    - Batches should only get submitted from the active tab.
      - If you upload a file or enter card numbers in one tab and then
        switch to another tab and submit numbers from there, the original
        tab's batches should be ignored.
    
    Signed-off-by: kelly mcelligott <kelly@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 765225d99f422eb477c9484c3ff1c34419070ff6
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 25 18:46:37 2021 +0000

    Bug 28456: Add WHERE option to membership_expiry cronjob
    
    Some libraries have a large amount of accounts and want to be able to limit how many email reminders they send.
    Adding a where statement will allow for flexibility
    
    To test:
    1 - Set some borrowers to expire soon
    2 - Set MembershipExpiryDaysNotice to 10
    3 - perl misc/cronjobs/membership_expiry.pl -c -v -n --before 100 --after 100
    4 - Note the patrons that yo uadjusted show up
    5 - Limit by various patron fields, e.g.
        perl misc/cronjobs/membership_expiry.pl -c -v -n --before 100 --after 100 --where="lastseen IS NULL"
        perl misc/cronjobs/membership_expiry.pl -c -v -n --before 100 --after 100 --where="lastseen IS NOT NULL"
        perl misc/cronjobs/membership_expiry.pl -c -v -n --before 100 --after 100 --where="surname LIKE '%a%'"
        perl misc/cronjobs/membership_expiry.pl -c -v -n --before 100 --after 100 --where="surname NOT LIKE '%a%'"
    6 - Confirm expected results
    7 - perl misc/cronjobs/membership_expiry.pl
    8 - Confirm the help message makes sense
    
    Signed-off-by: Azucena Aguayo <azucena.aguayo@gmail.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] Replace two inclue by include.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6288f077ff442371b276b4f0ab9178a3a5adfc14
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 26 10:11:26 2021 +0000

    Bug 20688: Add accesskeys for transfers
    
    To test:
    1 - Disable AutomaticItemReturn systme preference
    2 - Check in an item that does not float at a branch no it's home
    3 - Test new accesskeys for I,N,Y,P
    4 - With transfer confirmed check the item in at a wrong branch
    5 - Test accesskeys Y,P,X
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1135fc7161c29993aab219e2a11357a981400329
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 26 09:57:37 2021 +0000

    Bug 20688: Add accesskeys to hold modals
    
    This patch adds accesskey elements to the hold modals during checkin
    
    For tips on how to access the accesskeys:
    https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/accesskey
    
    To test:
    1 - Place some holds on items
    2 - Check in an item with a hold at a branch that requires transfer
    3 - Use accesskey I to ignore
    4 - Use accesskey Y to confirm and transfer
    5 - Check in again
    6 - Use accesskey Y to confirm
    7 - Repeat 4-6 with a new hold but use the accesskey P to print the slip
    8 - Check in the item again ans use accesskey X to cancel
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit deece7b76bd57e7c978b2f74089d0c223bf680b9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Aug 9 12:06:30 2021 +0100

    Bug 28830: Add cni index for 003
    
    This patch adds the cni/Control-number-identifier index to enable
    searches to use the 003 field.
    
    Test plan
    1/ Apply patch
    2/ Re-index using updated configurations
    3/ Confirm cni:number searches yield the expected results
    4/ Signoff
    
    Split-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Pasi Kallinen <pasi.kallinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cfe76ffc29bbaead5c3c99061ca511f2551b0dd5
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Aug 10 14:18:23 2021 +0000

    Bug 28838: add unique IDs to sco-main.tt impossible errors
    
    To test:
    1. Apply patch
    2. Go SCO and try to checkout some items that will generate some of the
       following errors:
    
    The system does not recognize this barcode.
    You have checked out too many items and can't check out any more.
    This item is checked out to someone else.
    You cannot renew this item again.
    This item is not for loan.
    You owe the library [% DEBT | $Price %] and cannot check out.
    This item has been withdrawn from the collection.
    This item is restricted.
    This item is on hold for another patron.
    This item belongs to another branch.
    Your account has expired.
    Your account has been suspended.
    This card has been declared lost.
    Your contact information seems to be incomplete.
    Due date is not valid.
    Item must be checked out at a circulation desk.
    
    3. The display should be exactly as it was without the patch but if you
       use the browsers dev tools you should be able to inscept each error
       message and see that it is now wrapped in a <span> with an ID.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3eaa17682c983f084cc4ff0e5bd6c7183ccd75f0
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Tue Aug 3 21:24:17 2021 +0000

    Bug 28810: replace housebould detail inputs with textarea
    
    To test:
    1. apply patch
    2. enable housebound module
    3. go to a patron and look at the housebound tab
    4. Edit the detials.
    5. The preferred materials, subjects, authors, referral, and note inputs should be replace with much larger textareas.
    6. You should now be able to added line breaks, so fill out each of the fields adding some line breaks. I added something like:
    Fiction authors: Frank Herbert
    Non-fiction authors: Malcolm Gladwell
    
    7. Save changes
    8. Now when you look at the housebound details those line breaks should be preserved and much easier to read.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee60339a842b79fcf2d6f1646b11e70c541fe9d7
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Thu Jul 8 20:57:58 2021 +0000

    Bug 28695: Add shelving location column to overdue.tt
    
    To test:
    1. have some overdues
    2. go to the overdue report on the circulation page (overdue.tt)
    3. no shelving location
    4. apply patch and restart the things
    5. look at the overdue report again and there should be a Shelving location column
    6. make sure it is accurate
    7. go to table settings and make sure you can properly hide the column. test other columns in the table and make sure they are still hiding correctly as well
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0083fd7e609e53abf6ac1df8297e3b7b1c975920
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 25 10:49:30 2021 +0200

    Bug 28893: Remove unused opac/rss directory
    
    RSS feeds are now generated using opac/opac-search.pl (format=rss).
    
    But prior to
      commit 09df0de35fcb5b1645490bd3ec9d9a77ec7923a1
      Removing obsolete RSS <link> tags and the scripts
    it was using opac/opac-rss.pl, which used opac/rss
    
    The directory should have been removed by this commit.
    
    Test plan:
    Confirm that this directory is useless and can be removed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d41b197ff6f5e7b80cb47f37375568536b045bf5
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 23 00:39:16 2021 -0300

    Bug 28744: Better handling of undefined to_api_mapping
    
    We always had some mapping because of the DB vs. API object definition discrepancies. But bug 25260 revamps the reserves table, and it is a perfect match. It highlights this edge case: if no mapping defined, then and undef from_api_mapping is generated (as opposed to an empty hashref) and this leads to errors in the query translation from the API.
    
    This patch makes a small change so this method always returns an empty
    hashref.
    
    To test:
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Object.t
    => FAIL: Test fail!
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: Tests pass!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD amended patch: remove uneeded commented lines
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcc586ef93eea0258cf1032a8deca3c7ade6af11
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 23 00:35:49 2021 -0300

    Bug 28744: Regression tests
    
    This patch adds tests for the following cases:
    - to_api_mapping not defined
    - to_api_mapping returning an empty hashref
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Object.t
    => FAIL: Tests fail :-(
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    JD amended patch: remove uneeded commented lines
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9a69c025451859776b9d4fd747ccb7705c806597
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Mon Aug 23 15:19:03 2021 +0200

    Bug 28891: (bug 23916 follow up) Always use 'Checkout on' as default Checkout history sort column
    
    To test:
    1 - Unset RecordStaffUserOnCheckout
    2 - Check out an item
    3 - Display Checkout history, table is sorted by 'Checkout on' column
    4 - Set RecordStaffUserOnCheckout
    5 - Display Checkout history, table is sorted by 'Renewed' column
    6 - Apply patch
    7 - Redo 1, 3, 4 and 5, table is always sorted by 'Checkout on'
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db11b222974a844a0d57ee2533fa738d3faa339a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 6 12:54:46 2021 +0000

    Bug 7703: (follow-up) Treat no items like none available
    
    This patch modifies the holds template so that during the
    multi-hold process, titles with no items attached are treated the same
    way as titles with no items available (items exist but cannot be place
    don hold):
    
     - The row showing such a record will say "No items are available to be
        placed on hold."
     - The pickup location dropdown will be hidden.
    
    To test, follow the previous test plan and confirm that these change are
    reflected. Now that the pickup location field isn't present for titles
    without items you should be able to complete the holds process.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d19784f6a57f10eeb964255359ae97da90faf2b3
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Aug 6 11:46:12 2021 +0000

    Bug 7703: (QA follow-up)
    
    Revised test plan from Owen:
    
    This patch modifies the hold process so that if one of the titles in a
    multi-hold process has no items the process doesn't abort completely.
    
    To test, apply the patch and perform a search in the catalog which will
    return one or more records with no items attached.
    
     - Check checkboxes for multiple results, some of which have items and
       at least one of which has no items.
     - Click "Place hold."
     - You should be taken to the page for placing multiple holds, with a
       heading, "Cannot place hold on some items."
     - Note: You will not be able to complete the holds process without the
       next patch.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0390b0ef450cb8f67e3576edc883b2c6fa7775e4
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Aug 6 11:19:12 2021 +0000

    Bug 7703: Don't block bulk hold action on search results if some items can't be placed on hold
    
    If you select multiple titles on the search results page in order to
    place a bulk hold and some of those titles have no items you get a
    JavaScript alert warning you can some cannot be placed on hold. You are
    blocked from completing the action until you deselect the invalid hold.
    
    This is unnecessary because the bulk hold process will safely refuse to
    place a hold on these titles later in the process.
    
    This patch removes the check that prevents submitting a multi-hold if
    one or more records in the multi-hold have no items.
    
    Test plan:
    1) Apply patch
    2) On the staff interface, do a search
    3) On the search results, select at least one record with items and one
       record with no items.
    4) Click the 'Place hold' button.
    5) You should be redirected to reserve/request.pl with the message
       "Cannot place hold: this record has no items attached."
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9e9eea1d5be5a27516124954e391ccbfc768ffc9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 30 16:31:43 2021 +0200

    Bug 28902: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7397897c6cedc58792cd44aa644632cc54e7e95c
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Aug 25 20:31:12 2021 -1000

    Bug 28902: Grey color on label for record metadata
    
    Actually looking at a record search or details, we see a black label
    (for example "Author:") and a grey metadata (for example "J.R.R Tolkien").
    
    Seems bad for accessibility.
    In my opinion the most important to see is the metadata not the label.
    
    It is possible to change with a custom CSS but I open this report to
    propose to change default display.
    
    Test plan :
    1) Apply patch and build CSS in OPAC and staff interface
    2) Search for any record in OPAC/Staff interface
    3) You see grey label and black metadata
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 473888bc239ba95f457210c593e4030b7c2d77ff
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Aug 3 22:11:10 2021 -1000

    Bug 28554: Fix t/db_dependent/AuthorisedValues.t
    
    Fixes where sort on lib breaks the test.
    
    Also removes useless params in search_by_koha_field()
    
    Run prove t/db_dependent/AuthorisedValues.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd6333d529182bc2d00bbdc648d88aa56bc6c170
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jun 11 13:42:00 2021 +0200

    Bug 28554: In itemsearch sort item types filter by description
    
    In itemsearch form, the item types filter should be sorted by description.
    
    Test plan :
    1) Create several values and descriptions in item types
    2) Go to itemsearch
    3) See filter by item types sorts on description and not on value
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7baea6631a5250c19e1b460d57accb6029924eaa
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jun 11 13:35:41 2021 +0200

    Bug 28554: In Koha::AuthorisedValues sort by description
    
    In itemsearch form, there are several filters build with authorized values.
    There values should be sorted by description.
    
    Test plan :
    1) Create several values and descriptions in authorized values LOC
    2) Go to itemsearch
    3) See filter by location sorts on description and not on value
    
    Seems change in search_by_marc_field can not be tested in interface
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8021117ca5410d62a212a027066e41601948ddb
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 30 14:43:35 2021 +0200

    Bug 28812: Improve robustness of selector
    
    Use the same fix as bug 28828.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70ea4115cfbd7456938678f56233752267efcac0
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Thu Aug 26 15:27:45 2021 +0200

    Bug 28812: (bug 7882 follow up) Copy all subfields in plugin editor
    
    To test:
    1- Create a notice with a 700$a and 700$d
    2- Click on 700 $a field Tag Editor
    3- Only 700$a is copied in search windows eg /authorities/auth_finder.pl pop up
    4- Apply patch
    5- Redo 2
    6- 700$a is copied in 'Search main heading ($a only)' and $d is copied in 'Search main heading'
    
    Signed-off-by: George Veranis <gveranis@dataly.gr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d2606a1c83a004e5e9b1ea86c8ee96111a0e2da3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 27 17:06:09 2021 +0200

    Bug 22690: Add koha_object[s]_class to fix TestBuilder.t
    
    'Can't locate object method "_new_from_dbic" via package "Koha::Linktracker" (perhaps you forgot to load "Koha::Linktracker"?) at /kohadevbox/koha/Koha/Object.pm line 334.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f7846202554611c2c4659b3e7119a0bac10531b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Aug 26 19:07:53 2021 +0000

    Bug 25619: Adjust POD and move date check before logging
    
    Potentially we could have logged a change when no date was passed.
    
    This patch moves the test before logging and updates POD
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f008b3ebe72b53821902bb60d8681fc0f1d2217e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 13:17:13 2021 +0200

    Bug 25619: Adjust POD
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70d25adbe71d2476229cb20902a01caab6726c50
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 22 06:24:12 2021 -0400

    Bug 25619: (QA follow-up) Fix subtest description
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bcd43bb62f317924a37424522a0c3b2dd1fc20e3
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 16 14:26:37 2021 -0400

    Bug 25619: Unit Tests
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d303e49f092aa5900a567aa1790b3066c031838b
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Jul 16 13:50:29 2021 -0400

    Bug 25619: Add ability to adjust expiration date for waiting holds
    
    There are times when an item that is waiting for pickup needs to have the expiration date extended. This would give staff the ability to modify one by one, as needed, the reserves.expirationdate for a given item awaiting pickup.
    
    Test Plan:
    1) Place a hold, trap an item for it such that is is waiting
    2) Attempt to update the expiration date
    3) Note the new date is not saved
    4) Apply this patch, restart all the things!
    5) Attempt to update the expiration date
    6) The new date should be saved!
    
    Signed-off-by: Abbey Holt <aholt@dubuque.lib.ia.us>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2b083cb82ae3af93307e45908bceb3e475209109
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 27 14:39:51 2021 +0200

    Bug 22690: DBRev 21.06.00.018
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46a13422264bf35560d032550c05574879d927fc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 27 14:34:00 2021 +0200

    Bug 22690: Remove uneeded return and add no_triggers
    
    * C4/Items.pm
      - Koha::Biblios not used
    
    * Koha/Item.pm
      - Koha::Item->orders must return an empty set if no order attached
      - no_triggers should be passed to other update calls
    
    * Item.t
      - No need to build a fund
      - Add new test to test Koha::Item->orders when no order attached
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d21f626e8067b028897c6c0d7e2d9fa99a7a36e0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 27 10:43:38 2021 +0200

    Bug 22690: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 020b93bfc07764c11fe2948b42048828d499c14d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 5 14:19:55 2021 +0100

    Bug 22690: (QA follow-up) Fix indexing for Items sets
    
    This patch adds tests and handling for calling move_to_biblio on a
    Koha::Items set that contains items from more than one source biblio.
    
    Test plan
    1/ Inspect the changes to t/db_dependent/Koha/SearchEngine/Indexer.t
    2/ Run t/db_dependent/Koha/SearchEngine/Indexer.t and confirm it passes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d5349b914d6915ce7a80a9d1454bfe6b5b51dc8
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Jul 22 14:32:09 2021 +0000

    Bug 22690: (QA follow-up) Correct variable name
    
    The $from_biblio variable name doesn't exists after a refactoring that
    happened. Here we need to re-index both the $self biblio and $to_biblio
    biblio.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c958dec78527415385dc51b4b43c5774d5b6ed2a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 22 11:40:20 2021 +0100

    Bug 22690: (QA follow-up) Add TrackedLink classes and use them
    
    This patch adds Koha::TrackedLink(s) classes based on Koha::Object(s)
    and then adds the relationship accessor to Koha::Item and uses it within
    the move_to_biblio method.
    
    Tests for new relationship also added to t/db_dependent/Koha/Item.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e5bfbc5a7681831faf19d64506a38ce3a597fa7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 22 10:57:17 2021 +0100

    Bug 22690: (QA follow-up) Use relationship accessor
    
    With the addition of foreign key relationships to the linktracker table
    we now get a DBIC relationship accessor we can use. This clarifies the
    code slightly by using the _result->relationship form to get the DBIC
    resultset.  We should still introduce a Koha::Object based class for
    this table at some point.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e19ecd51e047c99075e19366d4c56314049f42d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 22 10:37:26 2021 +0100

    Bug 22690: (QA follow-up) Add relationships to linktracker
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e552b366862431f0a601576914b7865600d097d3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 22 10:25:28 2021 +0100

    Bug 22690: (QA follow-up) Clarify uses of DBIC
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ab8f50835acb06a115f00119b88e6f5053472c1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 22 10:13:42 2021 +0100

    Bug 22690: (QA follow-up) Move adopt_items_from_biblios to Koha::Items
    
    This patch moves the Koha::Biblio->adopt_items_from_biblio method to the
    Koha::Items set class and updates all calls from
    Biblio2->adopt_items_from_biblio(Biblio1) to Biblio->items->move_to_biblio(Biblio2)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33dc5da1559d028a2929c9393306cc188f7db5f6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 22 10:01:32 2021 +0100

    Bug 22690: (QA follow-up) Improve negation syntax
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56b86cf35ab97845dbdaf200f9d36851e44ac787
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jul 22 09:56:49 2021 +0100

    Bug 22690: (QA follow-up) Rename 'item_orders' to 'orders'
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34597e95ab9b30c51ebd09d5ac765da8cdd0f47c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 19 11:30:32 2021 +0200

    Bug 22690: Remove MoveItemFromBiblio import
    
    Added in the meanwhile by bug 17600.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c03f7f1ad1ad56e1946d06063095788f12453db2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 19 11:59:10 2021 +0200

    Bug 22690: Add missing txn_begin in subtest
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34224b8141e90be099c582be7caccd1bee2265b0
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri May 28 13:57:53 2021 +0300

    Bug 22690: (QA follow-up) Make bib-level hold object actually bib-level
    
    We need to pass undef itemnumber to build_object() to actually have a
    hold without an item tied to it. Otherwise build_object() will create
    automatically an item for us (thus making it an item-level hold)
    
    To test:
     $ prove t/db_dependent/Koha/Item.t
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ca69b49af54a01a7a46b8f791539145d1f2c6ad
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue May 25 18:34:33 2021 +0300

    Bug 22690: (QA follow-up) Index also source biblio when calling move_to_biblio()
    
    We need to update the search index record for the old biblio where the
    item was moved from to keep the item info in search index up-to-date.
    
    To test:
    1) $ prove t/db_dependent/Koha/SearchEngine/Indexer.t
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e0664c8d00fabc4e12d9e910eb2dd314f6d8a379
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue May 25 18:09:30 2021 +0300

    Bug 22690: (QA follow-up) Silence manually generated warnings
    
    In our test setup we mock the index_records() to produce warnings like
    this:
    
    Koha::Item at t/db_dependent/Koha/SearchEngine/Indexer.t line
    93.
    
    By wrapping all our item creations to warnings_are{} we can silence them.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4da161d05ae088cb0852c02a95dc52ab89dd4da4
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Mon Nov 9 14:28:16 2020 +0200

    Bug 22690: Add more tests
    
    - Tests for adopt_items_from_biblio
    - Tests for the relationship between items and acquisition orders
    - Tests for indexer calls in adopt_items_from_biblio
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2615ee1010920b91692dfbd8cc2711fbff377ebd
Author: Ere Maijala <ere.maijala@helsinki.fi>
Date:   Mon Sep 16 13:55:37 2019 +0300

    Bug 22690: Refactor merging of records to improve performance (Elasticsearch)
    
    This patch allows merging of records with many items without the web server timing out.
    
    Test plan:
    
    Without the patch:
    
    - Create 2 records (one with e.g. 1000 items).
    - Do a cataloguing search that displays both records, select them and click "Merge selected".
    - Choose the record with many items as the one to be eliminated.
    - Start the merging.
    - After a while the web server should give you a timeout error (the merging process may still continue)
    
    With the patch:
    - Do the same as above
    - This time verify that the records are merged without timeout
    - Create a new biblio with an item
    - Add with the item:
      * acquisition order
      * hold (reserve)
    - Merge the biblio to another one
    - Verify that the item and its related data was moved
    - Verify that tests pass:
      prove -v t/db_dependent/Koha/Biblio.t
      prove -v t/db_dependent/Koha/Item.t
      prove -v t/db_dependent/Koha/SearchEngine/Indexer.t
    
    Signed-off-by: Michal Denar <black23@gmail.com>
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c834f18d59c9334e6b9480b525692cbdb5ea666
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 26 09:06:50 2021 -0300

    Bug 26223: (QA follow-up) Fix filter order
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c6cea294c801f7828b72f91a1ec2eb7da108f95e
Author: Andreas Roussos <a.roussos@dataly.gr>
Date:   Mon Aug 17 10:57:03 2020 +0200

    Bug 26223: include item information in OPAC ISBD view
    
    The ISBD view in the OPAC interface does not display item information.
    
    This patch fixes that.
    
    Test plan:
    0) Have a biblio with at least one item attached to it and include one
       of the following snippets in the OPACISBD system preference,
       depending on your MARC flavour:
    
       MARC21:
       #952|<br/><h2>Items</h2><table><th>Copy number</th><th>Shelving
       location</th><th>Koha item type</th><th>Barcode</th><th>Call number
       (Full call number)</th><th>Materials specified (bound volume or
       other part)</th>|<tr><td>{952t} </td><td> {952c} </td><td> {952y}
       </td><td> {952p} </td><td> {952o} </td><td> {9523}</td></tr>|</table>
    
       UNIMARC:
       #995|<br/><h2>Items</h2><table><th>Copy number</th><th>Shelving
       location</th><th>Koha collection</th><th>Barcode</th><th>Call number
       (Full call number)</th><th>Numbering (volume or other part)</th>|
       <tr><td>{9956} </td><td> {995e} </td><td> {995h} </td><td> {995f}
       </td><td> {995k} </td><td> {995l}</td></tr>|</table>
    
       Switch to the OPAC ISBD view for your biblio; notice how it does
       not display item information.
    1) Apply the patch, and restart Plack/memcached if necessary.
    2) Refresh the OPAC ISBD view page, this time you should see item
       information as per the OPACISBD system preference setting.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52df27ff6f221352c937f276bde2bbf7c64a21f8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 19 12:34:58 2021 +0200

    Bug 28881: (bug 23376 follow-up) Fix suggestion display on order receive page
    
    On bug 23376 we replaced $order, from hashref Koha::Acq::Order, but 2
    occurrences have not been corrected.
    
    It causes a bug on the order receive page when the bib is linked with a
    suggestion.
    
    Test plan:
    Create an order from bib A, create a suggestion for purchase on bib A
    (OPAC)
    Receive the order.
    Without the patch: Notice the "Suggested by: (suggestion #)"
    With the patch you see the info of the suggester
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e25ecc8a04aac27d938b7e8714c9a4fbff5a33ac
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Aug 6 08:03:27 2021 +0000

    Bug 28784: (QA follow-up) Remove num_paragraph cookie from include
    
    Still found in opac-bottom.inc.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 426d54c409816a0f1bf10ac2d79af132623cea36
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Aug 3 12:17:02 2021 +0000

    Bug 28784: (follow-up) Always make three search boxes
    
    The previous patch removed search_boxes_loop - that's okay, it was always
    getting the same three values.
    
    If we don't do something in the template though, we get no boxes
    
    Ultimately this should be a include, and not a hardcoded loop, but keeping changes
    small for backporting
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f42412cb910d9dd3a1a32cc009e92a50d0c9d54a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 3 10:58:47 2021 +0200

    Bug 28784: Remove code related to num_paragraph cookie
    
    It could lead to server freeze if set to a big value (we are pushing
    into an array and so RAM is being fulfilled, and CPU is looping).
    
    I don't understand the point of this cookie.
    
            var numPar = $("#booleansearch fieldset p").size();
            if (numPar > [% search_boxes_count | html %]){
                jQuery.cookie("num_paragraph", numPar,{ path: '/'});
            }else{
                jQuery.removeCookie("num_paragraph", { path: '/'});
            }
    
    But "#booleansearch fieldset p" does not exist, it's not 'p' but 'div'
    elements.
    
    I've removed the code related to num_paragraph and the "Return to the
    last advanced search" feature still works as before.
    
    From this comment:
        # determine what to display next to the search boxes (ie, boolean option
        # shouldn't appear on the first one, scan indexes should, adding a new
        # box should only appear on the last, etc.
    
    The only bit that is not working as described is "adding a new box
    should only appear on the last", but it has been working this way for
    a long time already I think, and I don't see it as a bug.
    
    Test plan:
    Read the code, check that the above is correct.
    Search for regression in this "return to last adv search" feature added
    by bug 13307.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36ef9a219de1f76bd460c2b75cdd4bb67e79ca68
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Aug 19 09:55:51 2021 +0200

    Bug 28872: DBRev 21.06.00.017
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc48decc315890085bbe5d7055a3dacdec770655
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 18 13:03:09 2021 +0200

    Bug 28872: Fix QA issues on atomicupdate
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 31c3455f8a0d557a6366a27462f9d6f20cabc975
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Tue Aug 17 23:57:54 2021 +0000

    Bug 28872: Atomicupdate to correct existing values
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e070b73e66218a9b9d06527ee76fafb4ea81577
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Tue Aug 17 17:29:02 2021 +0000

    Bug 28872: make AcquisitionLog, NewsLog, NoticesLog use 1/0 for their values
    
    To test:
    1 - edit AcquisitionLog, NewsLog, NoticesLog to change their values
    2 - in About Koha, see the errors noted above
    3 - apply patch, restart services
    4 - re-edit AcquisitionLog, NewsLog, NoticesLog to change their values again
    5 - reload About, see errors are cleared
    6 - confirm that actions are logged as expected when logs are on, not logged when logs are off
    
    Signed-off-by: Kelly <kelly@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 258caf32efd8c61bffe67899f76ddb38b34f64b4
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Aug 18 20:35:26 2021 -1000

    Bug 28819: Fix advanced search button on mainpage.pl incorrectly links to item search
    
    The previous follow-up changed the link for the Advanced search button on mainpage.pl.
    
    Test plan :
    1) Go to intranet main page
    2) Click on big button "Advanced search"
    => Without patch you go to item search /cgi-bin/koha/catalogue/itemsearch.pl
    => With patch you go to advanced search /cgi-bin/koha/catalogue/search.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa8f2920f3e64999a6a5034e27ed61e59755207d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 18 16:50:03 2021 +0200

    Bug 21670: Add debug to Plugins.t
    
    It's failing randomly (at least on Jenkins, cannot recreate locally).
    Maybe the plugin is not actually installed?
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac88b8facedf7b5074650bb2c4194cf67a00c027
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 17:09:16 2021 +0000

    Bug 27523: (follow-up) Add copy of image to carredart in the OPAC
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a412cc1233466d739f5c52510549372c8f145f27
Author: Victoria Faafia <vfaafia29@gmail.com>
Date:   Wed Jan 20 12:56:03 2021 +0000

    Bug 27523: Adding new itemtype lock image to carredart
    
    Test Plan
    1. Go to Administration>item types>modify item type
    2. There should be a lock item type under the carredart
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f776b5eaae9656153737e81e457662717c234e2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 17:15:57 2021 +0000

    Bug 27522: (follow-up) Add copy of image to carredart icons in the OPAC
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 77c745a1badd0d3e7757277f3091b02a6c5946dd
Author: Victoria Faafia <vfaafia29@gmail.com>
Date:   Wed Jan 20 12:22:28 2021 +0000

    Bug 27522: Adding new itemtype info image to carredart
    
    Test Plan
    1. Go to Administration>Item Types>Modify Item Type
    2. Under carredart you should see an info item type
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a920f1a39d5672f56da27208f2d6f5f6c79b78c9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 17:21:44 2021 +0000

    Bug 27521: (follow-up) Add copy of image to carredart icons in the OPAC
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c24a2bdbf8b96f1ca9a72f9032d94d5f5e248de2
Author: Ava Li <rubyli208@gmail.com>
Date:   Thu Jan 21 06:44:28 2021 +0000

    Bug 27521: Add new item type headset image for carredart
    
    TEST PLAN:
    1) Go to administration
    2) Go to item types
    3) Click edit on one of the item types
    4) Go to the category "carredart"
    5) Check that there is a small headset icon
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bee42b3a7d308db94912ebb4d5372cc71ef9c821
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 17:53:03 2021 +0000

    Bug 27520: (follow-up) Add copy of images to carredart icons in the OPAC
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4fe18db2a05d13e0e3cfa92d0048eacf4ef0acdf
Author: Victoria Faafia <vfaafia29@gmail.com>
Date:   Wed Jan 20 10:43:54 2021 +0000

    Bug 27520: Adding new itemtype images to carredart
    
    This patch adds 3 new itemtype images to carredart: boardgame(domino), zoom-in and zoom-out
    
    Test Plan
    1. Go to Administration>item types>Modify item type
    2. Click on the carredart tab that under choose an icon
    3. Check that a these 3 icons have been added
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54e9a8cb283a47fc9128a13d303f173d2a7f3975
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 22 17:13:39 2021 +0000

    Bug 27505: (follow-up) Add copy of image to carredart icons in the OPAC
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc9d1920c87ca755b115a3a1d107cdfbe5fa4fd5
Author: Ava Li <rubyli208@gmail.com>
Date:   Thu Jan 21 02:17:24 2021 +0000

    Bug 27505: Add new item type controller image for carredart
    
    TEST PLAN:
    1) Go to administration
    2) Go to item types
    3) Click edit on one of the item types
    4) Go to the category "carredart"
    5) Check that there is a small controller icon
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40c3d182af4ca161b7d4e860efbf2426b241b239
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 18 16:25:26 2021 +0200

    Bug 28802: Fix Asset.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d83639b0661a000cd32db51e4ddf5699c5fb0f2d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 19 14:55:01 2021 +0100

    Bug 28390: Move timestamp into grouping row
    
    This patch moves the timestamp that was getting repeated for each
    transaction breakdown row into the group header row.
    
    Test plan
    1/ Add a series of transactions to to a register (via Point of Sale
    or/and Borrower Accounts)
    2/ View the transactions (and past transactions tables) on the Register
    details page
    3/ Apply the patch and compare the display
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ca90632c5d13b7676c1ba33720eb72b4323686d6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Aug 18 09:45:59 2021 +0100

    Bug 28346: (QA follow-up) Add `-action` for consistency
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8a1427843454eaf282ed719af2129f48b3891fe1
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 13 11:54:07 2021 +0100

    Bug 28346: Add classes to account action buttons
    
    This patch adds identifiable classes to each action button that may be
    displayed next to an accountline on the borrower account page.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b61e849b718ab57cf70aacbe0aae48db21616f3d
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Aug 16 21:23:47 2021 +0000

    Bug 28868: Add back mastheadsearch class name
    
    In masthead.inc there is a wrapper for the main search bar called #opac-main-search. Prior to Bug 20168 that warpper had a class name of 'mastheadsearch'.
    
    Historically CSS/JS customization of the main search bar was done via the mastheadsearch class.
    
    Test plan:
    1. Inscept the element on the OPAC main page and see the element with an ID of 'opac-main-search'.
    2. Apply patch
    3. Inscept that same element and you should now also see a class of 'mastheadsearch'.
    4. Nothing visually should be different with the patch applied.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37e11da07bf761e8aa01e348f0584aa78438f479
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Jun 7 22:17:46 2021 +0000

    Bug 28525: Dont let TinyMCE do code cleanup
    
    If you look at Bug 24764 and Bug 26942 we adjusted the TinyMCE for the News tool so it will not do some types of automatic code clean up.
    
    The TinyMCE editor for system preferences which can be enabled by 'UseWYSIWYGinSystemPreferences' has the same problems.
    
    We should make the configurations the same.
    
    To Test:
    1. Turn on 'UseWYSIWYGinSystemPreferences'
    2. Go to a system preference like 'RestrictedPageContent'
    3. Try entering something like '<i class="fa fa-facebook-official" aria-hidden="true">TEST</i>' in the Source Code window
    4. It gets cleaned up by the editor
    5. Try something like '<a href="https://www.test.com" referrerpolicy="&quot;no-referrer-when-downgrade">TEST</a>'
    6. It's cleaned up by the editor.
    7. Try something like '<link href="https://fonts.googleapis.com/css?family=Open+Sans” rel=“stylesheet">'
    8. Cleaned up by editor.
    9. Apply patch
    10. Try step 3, 5, and 7 again.
    11. It should not be changed by the editor
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe07102b37d01b2e7b9fd072c0197cb86b314496
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Aug 10 11:47:26 2021 -1000

    Bug 28839: Better texts in stage MARC for import
    
    Tool stage MARC for import is /cgi-bin/koha/tools/stage-marc-import.pl.
    Its form contains texts in legends, labels, hints.
    
    I feel like :
    Labels are sometimes too long, showing them on multilines, like "Modify record using the following template". Long texts should be in legend or hint.
    Legend are sometimes contains redundant text, like "Stage records into the reservoir".
    Section beginning with "Comments about this file" is missing a legend, it looks like it is part of the upper section for profile.
    
    Also lengends should be driving the user, that is why optional parts
    contains a legend with "?".
    
    Test plan :
    Compare texts in page without and with patch
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 28839: (QA follow-up) Fix tabs/indentation in code paragraph
    
    QA tools complained about a tab char. Cleaned up the template paragraph
    it pointed out, removing tabs and correcting indentation.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1e9caf3ba64b2af90a333d30a06502b221d8af8f
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Aug 13 17:00:38 2021 -0300

    Bug 28861: Item type column always hidden in OPAC holds history
    
    This patch fixes the 'Requested item  type' column not showing for holds
    history in OPAC.
    
    It was due to a template variable not being set. When solved, it become
    clear that an import was missing for a template plugin.
    
    To test:
    1. Enable AllowHoldItemTypeSelection
    2. Add a couple item-type constrained holds
    3. See them in the holds history page
    => SUCCESS: Item type column shows
    4. Enable OPACHoldsHistory
    5. Look for them in the OPAC
    => FAIL: The item type column doesn't show
    6. Apply this patch
    7. Repeat 5
    => SUCCESS: The column shows! The item type is described!
    8. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 421e3972c67d50a5b3576d77726ee4ac90f6a28b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 28 13:32:24 2021 +0000

    Bug 28776: Warns from GetItemsInfo when biblio marked as serial
    
    GetItemsInfo sorts the items using serial fields if the biblio is
    defined as a serial
    
    The fields may not be defined. We can add a fallback to blank in this case
    
    To test:
    1 - Mark a record with items as serial in the marc (942$s)
    2 - At least one of the items should have no enumchron defined
    3 - Load the detail page
    4 - Warns in logs:
        [WARN] Use of uninitialized value in string comparison (cmp) at /kohadevbox/koha/C4/Items.pm line 811.
    5 - Apply patch and restart all
    6 - Reload the details page
    7 - No more warns
    
    Signed-off-by: Fridolin Somers <fridolin.somers@biblibre.com>
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 508aa6837cfb2a5c0600e6f51b66c92870d58763
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Aug 17 10:19:29 2021 -1000

    Bug 28873: Fix age displayed in db_dependent/Koha/Patrons.t
    
    In test suite db_dependent/Koha/Patrons.t actually shows :
    
        1..10
        ok 1 - Patron with no dateofbirth is always valid for any category
        ok 2 - Today=2020-02-28, dob=2015-03-01, is 5, should be valid=0
        ok 3 - Today=2020-02-28, dob=2015-02-27, is 5, should be valid=1
        ok 4 - Today=2020-02-28, dob=2009-02-28, is 11, should be valid=0
        ok 5 - Today=2020-02-28, dob=2015-02-28, is 7, should be valid=1
        ok 6 - Today=2020-02-28, dob=2009-02-27, is 11, should be valid=0
        ok 7 - Today=2020-02-28, dob=2016-08-27, is 3, should be valid=0
        ok 8 - Today=2020-02-28, dob=2009-03-01, is 11, should be valid=1
        ok 9 - Today=2020-02-28, dob=2007-08-27, is 12, should be valid=0
        ok 10 - Today=2020-02-28, dob=2015-02-28, is 5, should be valid=1
    
    Some ages are incorrect :
    
    1) dob=2009-03-01, is 11
    => it is age 10
    so valid=1 in category 5 to 10
    
    2) dob=2015-03-01, is 5
    => it is age 4
    so valid=0 in category 5 to 10
    
    3) dob=2015-02-28, is 7
    => this date of birth is already tested
    I suppose here dob is wrong, age wanted is 7 in the middle of age restrictions.
    so dob=2013-02-28
    
    This patch fixes ages.
    Also adds the category code 'AGE_5_10' in messages to display age limits
    
    Test plan :
    Run prove -v t/db_dependent/Koha/Patrons.t without and with patch
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 17f4de73a422b60122dcc00d129ba647c537c68b
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Aug 2 22:57:10 2021 -1000

    Bug 28802: Untranslatable strings in browser.js
    
    File koha-tmpl/intranet-tmpl/js/browser.js is not parsed by translation
    process, which uses koha-tmpl/intranet-tmpl/prog/js/**/*.js
    We must move it to prog/js.
    
    Test plan :
    1) Perform a search on staff interface
    2) Click on a result
    3) Check you see records browser
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 86ed812b2b3aaa7180bcbfca3b35868ceced815e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Aug 17 09:15:50 2021 +0000

    Bug 28850: (QA follow-up) Add "patrons with fines" for clarification
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 275e99c2ed74dc9f7d40bf787ba526576601eee8
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Aug 13 16:20:43 2021 +0000

    Bug 28850: Reword AllFinesNeedOverride
    
    To test:
    Apply patch, look up AllFinesNeedOverride, confirm it now says that checkouts will be blocked via the web-based selfcheck and SIP.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8b0a44dcb597d039b03e4f0529a2af6326f3afbf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 18 12:57:51 2021 +0200

    Bug 25078: Explicitely return from DB revs to avoid warnings
    
    % perl -wc installer/data/mysql/atomicupdate/skeleton.pl
    Useless use of anonymous hash ({}) in void context at installer/data/mysql/atomicupdate/skeleton.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85c395460687f7e359417711b6facd42e0a24f8f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 15:17:24 2021 +0200

    Bug 24387: Fix Letters/TemplateToolkit.t
    
    We must cast to date or the comparison does not work
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a4e278845a80ab5343448149b9acb653b864901a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 13:59:09 2021 +0200

    Bug 24387: Fix AdditionalContents.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f293d911e074b7bd38de4cadbac904e68671f711
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 13:54:46 2021 +0200

    Bug 24387: Fix one remaining occurrence of KohaNews
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 29b79ce9c7934cba1bd8a9579eb976d88fb07a3e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 13:56:56 2021 +0200

    Bug 25078: Add exec flags
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 465553c99787c8e20496bc24b152bf557420ecac
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 12:24:58 2021 +0200

    Revert "Bug 26860: facets.inc refactor availability facet"
    
    This reverts commit 63d6c1d8c583a734bd289f01a423133f0c56bb0e.

commit 42ce8c29960dc8d133f8403db31459bae810f8e1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 11:44:14 2021 +0200

    Bug 25078: Don't process db revs if updatedatabase.pl failed
    
    The updatedatebase stops when something wrong happens, we should not
    continue to process the new DB revs (db_revs dir) in that case.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59439886c327ab4bcb1292e85a89a4165fbedc42
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 11:35:28 2021 +0200

    Bug 25078: Move skeleton file
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fd829dbdcb9f5ea39146c88cd976137876e9a411
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 2 11:06:57 2021 +0200

    Bug 25078: Keep atomic updates in "atomicupdate" dir
    
    The atomicupdate directory will contain all the atomic update files (old
    and new version).
    That will ease job for the RM and RMaints, no file (except skeletons)
    must be in this directory before push.
    
    This patch also fixes an inconsistency we had: the atomic update was run
    before the other db revs on the UI but after when the CLI script was
    used.
    
    Now we make sure that the CLI does not deal with the atomic update files
    when called from the installer (UI)
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb4749a417ad77d1792f7dfbbff439aae88c1084
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 16 10:01:29 2021 +0200

    Bug 25078: Fix 'Wide character' from CLI
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 25dda58f044fef361106a553490a4c357e268746
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Jul 8 16:01:41 2021 +0200

    Bug 25078: Fix encoding issue with db_revs output
    
    From `perldoc -f open`:
    
    The scalars for in-memory files are treated as octet strings: unless the
    file is being opened with truncation the scalar may not contain any code
    points over 0xFF.
    
    So $out need to be decoded first in order to be used in other Perl
    strings
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 005f20507d7673b1cff9311b98b0de4bfbce2f4b
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Jul 8 16:01:38 2021 +0200

    Bug 25078: Close open filehandle
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b86a54ad73bcb9dcf4665f12d1a821413cce58ca
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 23 12:16:11 2021 +0100

    Bug 25078: (follow-up) Update 'NewVersion' for output_version changes
    
    This patch updates the NewVersion compatability method to add arrayref
    description handling to split it into description + report.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ef9aab0e597fbd81231a34f1fa900754e231cc90
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Mon Jun 14 18:44:06 2021 +0200

    Bug 25078: Separate update "report" from its description
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 312c5f16d8bb0d8c58bd6deb1350a47ba526cb77
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 15 11:38:51 2021 +0200

    Bug 25078: Re-introduce NewVersion
    
    This is ugly, we re-add the code we removed in the previous patch.
    
    We need to continue supporting "old" versions.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c07ba4c80415d579779ddb0b1f344f07d15b169
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jan 29 12:50:27 2021 +0100

    Bug 25078: Put db revs into different files to handle them better
    
    This patch suggests to stop using updatedatabase.pl to add new DB revs.
    Each DB rev will be in a separate pl files (installer/data/mysql/db_revs).
    
    The switch should ideally be done from 21.06.00.000.
    
    Each DBrev is executed in a try block and a transaction. If something
    went wrong, the whole DB rev is rolled back.
    
    Why do /var/log/koha/kohadev/updatedatabase_*.log (not -error) contain
        Status: 500
        Content-type: text/html
    
        <h1>Software error:</h1>
    etc.
    
    Test plan:
    - git checkout c4b4db21d25 (master on 2021-07-08)
    - Set the version syspref to 21.0500000:
        > update systempreferences set value="21.0500000" where variable="version";
    - Apply "Bug 25078: [DO NOT PUSH] DB revs for testing" (restart_all)
    - Read the different DBrevs created as examples
    - Make sure the different use cases are covered
    - execute the updatedatabase script (CLI)
    - Set the version syspref to 21.0500000
    - Update the DB from the UI
    - Set the version syspref to 21.0500000
    - execute the updatedatabase script with the --force parameter (for
    testing purpose)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64ccbdb8f223cc7f8320dd09262ecd6724da4266
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 8 09:43:58 2021 +0200

    Bug 25078: Move DB revs up to 21.06.00.016
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6936f97a9472718a7734614b14903175e01aef3f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Oct 21 11:15:50 2020 +0000

    Bug 26761: Use aria-disabled attribute in OPAC cart for disabled links
    
    This patch adds "aria-disabled" attributes to disabled links in the
    Cart, and adds JS to change the value from "true" to "false" when the
    links are enabled. The goal is to make the interface more informative to
    users of screen readers.
    
    To test, apply the patch and add some items to the Cart in the OPAC.
    
    - Inspect the markup of controls like "Remove", "Place hold," etc. Each
      should look disabled (grey) and has the correct aria-disabled
      attribute value.
    - Select one or more checkboxes. The links should be come active, and
      the aria-disabled attribute shoulk now be "false."
    - Deselect all checkboxes. The links should now be disabled.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3e95d4906b53692b7ec11ec3b796436a2bf59000
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 10:29:15 2021 +0200

    Bug 10902: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc88e53e26c54c1b47c30d0c084ba0915843690f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 10:49:48 2021 +0200

    Bug 10902: Use prefetch and dbic rs
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dd8e23d85c96890543a17ef1b224d44112d32d24
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Aug 10 11:56:45 2021 +0000

    Bug 10902: (follow-up) Account for singleBranchMode
    
    This patch checks singleBranchMode before highlighting the current
    branch in search results.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ecf36f5420cbb2eb034bd0cc776f7ece1eb5970
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Aug 9 11:43:32 2021 +0000

    Bug 10902: (follow-up) Fix patron search autocomplete
    
    The circulation search autocomplete (e.g. from circulation.pl search
    header) was corrected in the previous patch to include library name
    instead of branchcode. This patch makes the same correction for patron
    search autocomplete (e.g. from members-home.pl search header).
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b17e52ae9796cddc38ddd6fb60649cab8998f682
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 6 13:48:42 2021 +0000

    Bug 10902: (QA follow-up) Show library name instead of code
    
    This patch modifies the patron search autocomplete so that library name
    is shown instead of library code.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40a79145df55237e129dcb65562268cc1a7d7648
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 30 16:21:06 2021 +0000

    Bug 10902: Highlight patrons from logged-in library in patron searches
    
    This patch alters a few different patron search interfaces so that
    patrons from the currently-logged-in library are highlighted in a way
    that differentiates them from other patrons.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - In Administration -> System preferences, make sure the
      PatronAutoComplete preference is enabled.
    - In the "Check out" tab in the header, type a partial patron name which
      will return multiple results and wait for the autocomplete menu to
      appear..
      - Patrons in the autocomplete results should show the branchcode, and
        patrons from the currently-logged-in library should be highlighted
        in green.
    - Submit your partial name in the "check out" tab.
      - In the search results the branch name of patrons from the
        currently-logged-in library should be similarly highlighted.
    - Go to patrons browse for patrons. These results should be highlighted
      as in the previous steps.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b509a77ee855f0cfc46f6f65c4ad84f378b7ffb4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 13 17:00:37 2021 +0000

    Bug 28819: (follow-up) Use stacked icons for different searches
    
    This patch modifies the staff interface home page so that the "Advanced
    search" and "Item search" links are differentated using stacked Font
    Awesome icons.
    
    To test, apply the patch and view the staff interface home page. The
    icons associated with advanced and item searches should be different:
    
    - The Advanced search link should have a magnifying glass icon on top of
      a grey book icon.
    - The Item search link should have a magnifying glass icon on top of a
      grey list icon.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9cac8fbbf2dd32ef2dfff8095cd7c4f77de51120
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon Aug 9 16:39:55 2021 +0000

    Bug 28819: Add item search to intranet-main.tt
    
    To test:
    1. Apply patch
    2. Go to staff main page ( intranet-main.tt )
    3. Now you should see an 'Item search' button and icon.
    
    Signed-off-by: kelly mcelligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cd6ab5e2e87f61597acd103175df532715254cf4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 18:31:43 2021 +0200

    Bug 28765: Remove sub find_value from batchMod.pl
    
    It has never been used and should be removed
    
    Test plan:
    Search for "find_value" in the file and confirm that there is no more
    occurrence
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 293ed9a8d0058406fcdea76dd0470a5f05ebf735
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 09:01:28 2021 +0000

    Bug 24387: DBRev 21.06.00.016
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 945565445fb0e6aed7dc01e07c3a7307809e73d8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 16:50:18 2021 +0200

    Bug 24387: Fix sample_news.yml installer file
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c91c3f7c2eb64c4443711962015593c52cc5ab5e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 16:49:59 2021 +0200

    Bug 24387: Remove sample_news.for other languages
    
    We shouldn't continue to update those files as we are going to remove
    them soon.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e82096c124591a0e30926f5953f9312f974a9cfe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 10 20:54:08 2021 -0300

    Bug 24387: (QA follow-up) Fix method import issues
    
    Raised by the QA script, a couple issues carried by pre-17600 patches.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f43037b26c7823a9098020641a4633b0adad0f82
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Aug 10 15:52:40 2021 -0300

    Bug 24387: (QA follow-up) Add missing filters
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 266aacc1f9b5ac5a6bcadd2db964d58622f0cc4f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 16 09:13:34 2021 +0200

    Bug 24387: DBIC schema changes
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34c2a3f57d9d16262234820324c738ba4f0b1b91
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 9 15:26:24 2021 +0200

    Bug 24387: Fix location options when editing HTML custom
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89ade834d6460fe08aa69c3571e36cd117574c09
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 6 17:28:19 2021 +0200

    Bug 24387: Rename "News" with "Additional contents"
    
    One big patch for one big move.
    
    The "News" feature (opac_news) has been hijacked to handle some system
    preferences (bug 26050). The goal was to take profit of the UI (editor)
    and the ability to translate the value.
    
    Disclaimer: This patch is NOT offering the best implementation but, as
    we still don't have bug 24975, it cannot be done now. And no, we don't
    want to wait for it to move forward here. This patch is going into the
    right direction anyway.
    
    This enhancement is going to rename the "News" with a more genertic
    "Additional contents". We have two different "categories" of content:
    "news" and "html customizations".
    
    What does it bring?
    - A split on the UI for disambigate the two types of content (news and
    syspref/html customizations)
    - A simplification of the edit form: all languages will be translatable
    on the same view (like the "notice templates")
    - Ground will be prepared for different types of content (if needed later)
    - Staff news can be translated
    
    How was the "News" area working before this patch?
    The opac_news DB table contained a (very inconsistent) 'lang' column.
    The different values were:
    - '' => news to display at the OPAC and staff interfaces
    - 'koha' => news for staff only
    - 'slip' => news for slip notices
    - $lang => news for OPAC only, translated in $lang ('en', 'es-ES', etc.)
    - "$location_$lang" => A syspref moved to this "news" area. The syspref
    is $location, and is translated in $lang. Eg. OpacLoginInstructions_en,
    OpacLoginInstructions_fr-FR, opacheader_es-ES
    
    This patch is improving the DB structure with the following changes:
    - renaming 'opac_news' with 'additional_contents'
    - new 'category' column
     => 'news' or 'html_customizations'
    - new 'location' column
     => For 'news': 'staff_and_opac', 'staff_only', 'slip'
     => For 'html_customizations': the old syspref name (eg. 'OpacLoginInstructions').
    - new 'code' column (see later for more info)
    - the 'lang' column will only contain the language code ('en', 'es-ES',
    etc.). BUT a 'default' entry will ALWAYS exist for fallback behaviour.
    
    We are getting closer to the 'notice template' table structure because
    we want to match its UI. The 'code' column will bring us the ability to
    group the different 'additional_contents' rows. The code for a given
    news will be the same, but the (lang, title, content) will differ.
    Examples:
      News 1 will have, for each of the translated versions
      (category, code,    location, branchcode)
      ('news',   'News1', $location, $branchcode||undef)
      And the 3 following columns will differ:
      (title,              content,               lang)
      ('title for news 1', 'content for news 1', 'default')
      ('titulo para 1',    'contenido para 1',   'es-ES')
    
    Note that the "category" is not strictely necessary, but it seems better
    to have the ability to split the different content by category/type
    easily.
    
    Additional changes:
    - Syspref 'NewsToolEditor' is renamed 'AdditionalContentsEditor'
    - Koha::NewItem => Koha::AdditionalContent
    - Koha::News => Koha::AdditionalContents
    - Script and template renamed from koha-news to additional-contents
    - Foreign keys have been renamed
    - Subpermission edit_news has been renamed edit_additional_contents
    - The UI can now be accessed via a "News" or "HTML customizations" link
    from the tools module. The related contents will then be displayed (both
    categories are now split)
    
    Changes not done here:
    - Primary key 'idnew' could be renamed 'id'
    
    Limitations of the upgrade:
    News cannot be grouped by a unique code for existing translations.
    => A given news will be now displayed several times on the translated
    interface
    Any ideas to improve the upgrade behaviour?
    We will have to add a warning in the release notes to tell libraries to
    review their news.
    
    Test plan:
    0. Don't apply the patches
    1. Translate the interfaces in some languages
    . Create some news for staff and OPAC
    . Create some content for different entry of HTML customizations
    Note that you are forced to define a 'default'.
    Also note that you are only forced to fill the title (not the content).
    This is certainly problematic (see FIXME in the code) as sometime only
    the content is displayed.
    . Play with the interface (edit, delete, filter)
    . Go to the different places the news are displayed, and confirm they
    are displayed correctly (staff home, opac home, opac rss)
    . Create 1+ news for 'slip', check an item out and 'print slip' (from
    the circulation page). You must see the news.
    . Go to the different places you are expecting the HTML customizations
    to be present and confirm that you see them.
    . Switch the lang of the interface and confirm that you now see the
    content in the translated version
    . Generate the templates in another language, don't translate the
    content
    . Use this language for the interface and confirm that the 'default'
    version is displauyed.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 556d0fcafff573017ea34b50cd5c118370fcc90a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Aug 16 09:01:27 2021 +0000

    Bug 12561: DBRev 21.06.00.015
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 817f19945bf60ee27b276da6fdc520ed1b22ed5c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 16:13:17 2021 +0200

    Bug 12561: Add warning on about page
    
    If a default xslt file has been removed or if the one filled in one of
    the syspref does not exist.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 977774f0959dfd5e523f222df81f76b2e3be0cff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 16:05:34 2021 +0200

    Bug 12561: Change prototype of XSLTParse4Display
    
    Use a hash for better readability and reusability.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 56c2856e268ec02638898923d751a0b69c716f93
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 15:27:40 2021 +0200

    Bug 12561: Remove non-XSLT views
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 24103412bc3ea9d2bd58d5b69ae69b88a4f8ee8e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 14:55:25 2021 +0200

    Bug 12561: Remove HighlightOwnItemsOnOPAC and HighlightOwnItemsOnOPACWhich
    
    This is the only remaining non-XSLT only feature. We should remove the
    non-XSLT views that have been deprecated for a while now, and remove
    this feature.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 395678474b3f6ece85d714185ff4a16fe133e5c5
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed May 19 12:10:25 2021 -0400

    Bug 28393: Elasticsearch - Add 050a to lc-call-number index mapping (MARC21)
    
    This patch adds 050 $a to the mapping for the lc-call-number index.
    
    To test:
    1) Apply patch
    2) Reindex using rebuild_elasticsearch.pl -r
    
    If you don't have access to a terminal (in a sandbox for example)
    2a) Go to Administration > Search engine configuration, click "Reset mappings"
    and confirm
    2b) Then reindex
    
    I'm not sure how to search specifically for an LC call number.
    You can confirm that 050 $a is displayed in the Search engine configuration page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba30e6a8d9e1f952939c4f6ab8079c46e3efac40
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Tue May 18 17:12:34 2021 -0400

    Bug 28381: Elasticsearch - Add 710 and 711 to default mappings for author index (MARC21)
    
    This patch adds fields 710$a and 711$a to the default author mappings for elasticsearch indexing.
    
    To test:
    1) Apply patch
    2) Reindex using rebuild_elasticsearch.pl -r
    
    If you don't have access to a terminal (in a sandbox for example)
    2a) Go to Administration > Search engine configuration, click "Reset mappings"
    and confirm
    2b) Then reindex
    
    3) Search for an author name found only in 710 using the Author index
    in advanced search
    4) Repeat search for an author name in 711
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dc673a85afa27bfac5ad6bd5194d015143e0664f
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Tue May 18 16:40:50 2021 -0400

    Bug 28380: Elasticsearch - correct 024aa in mappings (MARC21)
    
    This patch corrects a typo in the mappings.yaml file
    
    To test:
    1) Apply patch
    2) Reindex using rebuild_elasticsearch.pl -r
    
    If you don't have access to a terminal (in a sandbox for example)
    2a) Go to Administration > Search engine configuration, click "Reset mappings"
    and confirm
    2b) Then reindex
    
    3) Search for a standard number found in 024$a using the Standard number index
    in the advanced search
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5d53b8e85a0e1cd107f540bb6ce6a87e7549fe61
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Tue May 18 16:13:17 2021 -0400

    Bug 28379: Elasticsearch - Add 710 to author-name-corporate index (MARC21)
    
    This patch adds 710 to the default author-name-corporate index mappings for
    elasticsearch.
    
    To test:
    1) Apply patch
    2) Reindex using rebuild_elasticsearch.pl -r
    
    If you don't have access to a terminal (in a sandbox for example)
    2a) Go to Administration > Search engine configuration, click "Reset mappings"
    and confirm
    2b) Then reindex
    
    3) Search for an author name found only in 710 using the Author (Corporate name) index
    in advanced search
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 21b9e455f1ce362dba03eb6648c36968c83fe17b
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Tue May 18 16:04:41 2021 -0400

    Bug 28378: Elasticsearch - Add 264c to default copydate mappings (MARC21)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0baa439e3a10a5601a291058318047c60e43a3a9
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Tue May 18 15:50:34 2021 -0400

    Bug 28339: Elasticsearch - Add 8XX to default title-series index mappings (MARC21)
    
    This patch adds series added entries titles (800 $t, 810 $t, 811 $t, and 830 $a) in the
    default title-series index mappings.
    
    To test:
    
    1) Apply patch
    2) Reindex using rebuildelasticsearch.pl -r
    
    If you don't have access to a terminal (in a sandbox for example)
    2a) Go to Administration > Search engine configuration and click "Reset mappings" and confirm
    2b) Then reindex
    
    3) Search for a series title found only in and added entry field
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 135ce163c22a710ad163aefe8bfa637963faaf10
Author: Alexis Ripetti <alexis.ripetti@inLibro.com>
Date:   Fri Jul 16 11:43:44 2021 -0400

    Bug 28719: Change somes links in the serials page to avoid them leading to nothing
    
    To test:
    1- Search for a serial
    2- Pick one
    3- Go to 'Serial collection' on the left
    4- An issue should be selected if you're expected a new issue
    5- delete it using 'Delete selected issues'
    6- Confirm deletion
    7- If you're supposed to receive more issues the next one should now be there
    8- Now edit the serial ('Edit serials')
    9- See that the link leads to nothing
    10- Apply patch and redo steps 1 to 8
    11- See that the link now leads to something
    
    Signed-off-by: kelly <kelly@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fad3af0005c3a4234634ee477fafc85902540843
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed Aug 11 09:03:58 2021 -0300

    Bug 28842: A summary to the /items/:item_id/pickup_locations route
    
    This patch simply adds a summary to the route. This will be picked by
    the API docs.
    
    It also removes the 'pickup_locations' tag, as we did in bug 28461.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae43d0cfe046f611735173168a5c6fa826fdca0d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Aug 12 11:15:22 2021 -0300

    Bug 28848: Make sure the 'swagger' attribute is a string
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64c9999932e177aa2f10891854a968e581f2c65c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 17:01:51 2021 +0200

    Bug 26852: Fix Heading.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9428f662fe2ec0271878ec78886e7f95a25a9e1
Author: Janusz Kaczmarek <januszop@gmail.com>
Date:   Sun Dec 21 09:31:47 2014 +0100

    Bug 26852: subfield $e missing in X11 definition of MARC21 headings
    
    This patch adds $e to 111 and 611, but removes it from 100 and 110 as it's
    used for the relator term there and should not be copied. Same for 111$j.
    
    Test plan:
    
    1. Have a biblio record with, for example, 711 field with a $e subfield.
    2. Have two auth records: one with 111 field reflecting the 711 field and second similar but without $e subfield
    3. Have LinkerModule set to Default
    4. Run link_bibs_to_authorities.pl
    5. 711 should remain unlinked since there were two record found by the Default Linker and no one was chosen.
    
    6. Apply the patch.
    7. Run link_bibs_to_authorities.pl
    8. 711 should be linked now.
    
    Repeat testing in similar fashion for authorities:
    
    9. 100/110 $e
    10. 111 $j
    
    NB zebra index definition is OK:
    kohaidx:index_match_heading tag="111" subfields="acdefghjklnpqstvxyz" subdivisions="vxyz">
    in etc/zebradb/marc_defs/marc21/authorities/authority-koha-indexdefs.xml
    
    Signed-off-by: Sara Brown <sbrown@bywatersolutions.com>
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7c781b21343aa88d641fa097944a264ab9827df
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Aug 9 10:07:53 2021 -1000

    Bug 28834: Correct wording biblios/authorities in tools home
    
    In tools home, we actually see 2 wordings : biblios/bibliographic authorities/authority
    Looks like bibliographic is more correct.
    
    Test plan :
    1) Apply patch and look at words in tools home /cgi-bin/koha/tools/tools-home.pl
    
    Signed-off-by: Barbara Johnson <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b2c0f4ce5317e1e34bc12a08b98689c64e249a6
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Aug 10 15:21:18 2021 +0200

    Bug 28779: (QA follow-up) Even more specific message
    
    For the detail page, the MARC view etc. we use the text:
    
    The record you requested does not exist (488).
    
    I think this is better than "not found", because that sounds
    like it might be an issue with the search index, which we can
    rule out in this case.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76b6bd8eb9dae02d7885c4b794bd527b25ed9665
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 30 14:39:39 2021 +0000

    Bug 28779: (QA follow-up) More specific message and soem cleanup
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96ea4a4dde03e32ead94682c87f7a85350cca0cb
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Thu Jul 29 19:35:47 2021 +0300

    Bug 28779: Skip processing of non-existent biblios
    
    Just checking with a regex that whether an input looks like a biblionumber
    is not enough, we need to also verify there is a biblio really existing
    in the database and skip processing of hold request for non-existent
    biblionumbers.
    
    To test:
     1) Go to page /cgi-bin/koha/reserve/request.pl?biblionumbers=XXXXX
        where XXXXX is non-existent biblionumber, notice internal server error
     2) Apply patch
     3) Repeat step 1 and notice we cannot place a hold
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c1fbfa5fafde0056f10b9a8e17d780cb423c7217
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Aug 6 16:49:50 2021 +0000

    Bug 28825: Can't edit local cover image for item from details page
    
    This patch corrects the markup for local cover images attached to items.
    The correction allows correct display of an "edit" link when the user
    clicks an item's cover image and views it in the lightbox-style modal.
    
    To test, apply the patch and make sure the "LocalCoverImages" system
    preference is enabled.
    
    - View the details of a bibliographic record in the catalog which has
      items attached..
    - In the table of holdings, click Edit -> Upload image.
    - Upload an image for the item and return to the bibliographic detail
      page.
    - Your image should now be displayed in the holdings table.
    - Click the image to view it.
    - In the footer of the modal there is an edit link: "Local cover image
      (edit). Before this patch the edit link would lead to a missing page.
      After applying the patch the link should take you to the "Image view"
      where you have the option of deleting the image or uploading another
      one.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1729d17ffdd79ab24cd62aec63a36629c77fef6c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 13:26:12 2021 +0200

    Bug 27847: Compiled CSS changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da700c3e8836b34e2b7b517fca2d73f1a634a63a
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Apr 19 11:49:25 2021 +0000

    Bug 27847: Don't obscure page when checkin modal is non-blocking
    
    This patch changes the series of events striggered when a non-blocking
    modal dialog is displayed during checkin. If the "TransfersBlockCirc"
    preference is set to "Don't block," the user can continue to check in
    even though a transfer dialog has appeared. This patch hides the modal's
    "backdrop" element so that the modal doesn't look like one which blocks
    further action.
    
    There is no Bootstrap backdrop option which both hides the backdrop and
    makes it non-blocking, so we have to use the default non-blocking option
    and "manually" hide the backdrop.
    
    The "show.bs.modal" event must be added in order to make the
    necessary change before the modal is displayed. This prevents the
    darkened backdrop from appearing and then being hidden.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - Set the "TransfersBlockCirc" preference to "Don't block."
    - Check in an item which belongs to another library.
    - A modal dialog should be displayed: "Please return this item to XXX"
    - The page "behind" the modal should not be darkened, and the cursor
      focus should remain in the check-in field.
    - Checking in an item which as a hold should still trigger the
      "blocking" behavior: The modal must be dismissed by clicking one of
      its buttons (not the backdrop) and the page behind the modal should be
      darkend.
    - Test with "TransfersBlockCirc" set to "Block." Checking in an item
      belonging to another library should trigger the "blocking" modal
      behavior.
    - Test that other checkins still work correctly.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c320cd5ac7768f75e2077deff8e4d78137acd87
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Aug 9 13:41:45 2021 +0000

    Bug 28764: (QA follow-up) Add comment, remove two defined's
    
    If we no longer offer the sortfield with :asc actively, we should
    probably write it somewhere too.
    Replaced a few defined tests by empty test. No need to split empty
    string or zero etc.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ee3f131f50f249e6a3c34eed13b8124c94102055
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 30 10:54:47 2021 +0000

    Bug 28764: Alter sort dropdown to use direction parameter
    
    This code is odd -we build a select in the template, then turn it into a list of links using javascript
    This patch adds a direction data element and uses it while building the links
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit caad849036bf13a4438731309ea45c7edcf75c3d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jul 27 11:27:21 2021 +0000

    Bug 28764: Parse direction parameter in public list view
    
    This patch adds a check for a 'direction' paramter in list sorting.
    
    It maintains the existing syntax for sorting 'sortfield=field:direction'
    but adds support for the form used in paginations and more commonly thtoughout
    Koha' sortfield=field&direction=direction'
    
    To test:
    1 - Create a public list
    2 - Add enough items to generate two pages (40 worked for me)
    3 - View the list and enforce sorting by date added descending:
        sortfield=dateadded:desc
    4 - Note the titles shown
    5 - Click to second page using the pagination bar
    6 - Note the same titles are shown, in a reversed order
    7 - Apply patch
    8 - repeat 305
    9 - Second page is sorted correctly!
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6e1dbac8385de4dbbe3ff4aef525f61be13b755c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 11 11:25:45 2021 +0000

    Bug 28813: DBRev 21.06.00.014
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 229aaf6d2b36687655ef122c9b2691467b1ef839
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 5 10:17:29 2021 +0100

    Bug 28813: Rename delivery_note to failure_code
    
    We now use the codes from the half implimented error_code in place of
    the plain text that was being added to the delivery_note field. As part
    of that we rename the field to failure_code to clarify it's intended
    content.
    
    Test plan
    1/ Confirm t/db_dependent/Letters.t passes
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 226697264dd70db403435c68bb6268b4161bb24c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 5 10:16:24 2021 +0100

    Bug 28813: Update unit tests
    
    This patch updates the unit tests to check for failure_code instead of
    delivery_note and catches a missing case.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c090f98ff3575308ca11b7bfec4b7dc76779ef25
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 5 10:15:58 2021 +0100

    Bug 28813: DBIC Schema Update
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7abc1ef87e2d43c7c761716601f68545c3431b8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Aug 5 10:14:49 2021 +0100

    Bug 28813: Update database field name
    
    Update the database field name from 'delivery_note' to 'failure_code' to
    more accurately denote it's use.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9468d8195f72825d809ab75a74c315d566ffc1b8
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Mon Aug 9 23:14:03 2021 -1000

    Bug 28835: Fix ability to pass list contents to batch record modification
    
    Bug 12759 added the ability to pass list contents to batch record
    modification/deletion tools.
    Patch Bug 22417 [Restore the 'add to list' feature] removed the fetch
    of lists in batch_record_modification.pl I don't understand why.
    It still exists in batch_delete_records.pl.
    
    Note that this is needed when first form is displayed.
    
    Test plan :
    1) Create a private and a public list of records
    2) Open Tools > Batch record modification
    3) Check you can use the lists
    4) Open Tools > Batch record deletion
    5) Check you can use the lists
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f2e4ecb25be62db403ba39399058c5be8c49fef
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Aug 9 12:09:13 2021 +0000

    Bug 28828: Fix unimarc_field_4XX.tt and marc21_linking_section.tt value builders
    
    Find closest ul for value builders.
    
    Since Bug 22399 changes in biblio editor, value builder unimarc_field_4XX.tt JavaScript
    code does not do its job anymore.
    This is because a div is added and this call is now wrong:
      var subfields = whichfield.parentNode.parentNode.getElementsByTagName('input');
    
    Test plan 1:
    1) Use a UNIMARC DB
    2) Define value builder unimarc_field_4XX on 463$t
    3) Create a record B1 with 200$a, 200$f
    4) Create a new record B2
    5) Click on value builder in 463$t
    6) Search for record B1
    7) Click on "Choose"
    => Without patch only 463$t is filled with a value
    => With patch 463 $t, $a, $0 and $9 are filled with a value
    
    Test plan 2:
    1) Use a MARC_21 DB
    2) Define plugin marc21_linking_section.pl on 773$t
    3) Make sure 773$t and other subfields are visible in intranet/editor
    4) Create a new record in basic cataloging editor
    5) Click on value builder in 773$t
    6) Search fro a record
    7) Click on "Choose"
    => Without patch fields are not fileld
    => With patch subfields are correctly filled
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cdc0f07f5d2a9c00102bb9eaf6d12ec5dd8da813
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Jun 16 11:17:19 2021 +0200

    Bug 28569: In opac-suggestions.pl preselect user library
    
    In OPAC new purchase suggestion opac-suggestions.pl for library combobox :
    actually first value is selected, user library should be selected.
    
    Test plan :
    1) Create a new library named 'ZZZ top'
    2) Set this library on a user U1
    2) Loggin at OPAC with user U1
    3) Create a new suggestion
    => Check library 'ZZZ top' is preselected
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ba95bf885c1c0001e4c7a8224b0e4bf2a252f83
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Wed Aug 11 01:04:49 2021 +0200

    Bug 28727: (QA follow-up) Simplify permission check
    
    There was another permission check for edit_items directly below,
    so instead of changing them to both be edit_items, I think we
    can now remove one.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4baaaff8170227867f6cec7e4e547f4622c94151
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Tue Jul 20 19:42:41 2021 +0000

    Bug 28727: Show edit item link when user has edit items permission
    
    To test:
    1: log in as a user with edit_items but not edit_catalogue
    2: confirm you do not get an Edit Item link on moredetail.pl
    3: apply patch, restart, reload
    4: confirm link now shows
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f2253158d795fb2fe47061d6235d3ff773eeed5c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 4 08:59:40 2021 +0200

    Bug 28804: (bug 25026 follow-up) Handle SQL errors in reports
    
    Since bug 25026 DBMS errors are raised, but the report module is not
    dealing correctly with the errors.
    If an error occurred in execute_query, next queries will fail as well,
    we should skip them.
    
    Test plan:
    1. Create report from SQL queries, containing errors (invalid syntax, etc.)
    'SELECT id FROM borrowers' can do it
    2. Execute the query
    => Without this patch you get a 500
    => With this patch applied you see that the error raised at DBMS level
    is propagated to the UI
    3. Confirm that there is no regression on valid queries
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89b634abc1b7eb42d63e00a7fe7d34b4c990f1c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Aug 6 12:04:16 2021 +0200

    Bug 17600: Fix missing imports from mappings.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c039d4716a099365a45ab8d40d6b1362229f72b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 4 11:12:41 2021 +0200

    Bug 28630: Improve date comparisons in tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f61de11993a154d119da5478eac39ca17c0728e
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 28 14:42:13 2021 +0100

    Bug 28630: (follow-up) Update wording of syspref
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 34a5a3506d1a4bfdddbf37d6c4891fe55cffb8ab
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 25 10:33:18 2021 +0100

    Bug 28630: Add unit tests
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0f4bad73def87e15fc4a45d457b6a25ef03085cd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri Jun 25 09:50:50 2021 +0100

    Bug 28630: Add track_login_daily to ILSDI::AuthenticatePatron
    
    This patch adds a call to track_login_daily for the AuthenticatePatron
    method in ILSDI.
    
    Many libraries use this ILSDI endpoint for electron book borrowing and
    need to maintain the lastseen based on this type of lending.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ddd899a99f511ae2b605eb9cb02a7bf4d35d989
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 28 13:51:40 2021 +0000

    Bug 28261: (QA follow-up) Fix width after adding visual feedback
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ec1bd1a1033f9573814468c5764c4cacaa77452
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Apr 29 08:53:43 2021 -0300

    Bug 28261: Add visual feedback on overridden pickup locations on patron's page
    
    This patch makes the patron pages in the staff interface use the API and
    Select2 to render the pickup locations list. This has the effect of
    adding visual feedback on those pickup locations that need an override,
    based on the current configuration options.
    
    All the checks are done in the GET /holds/:hold_id/pickup_locations
    route, so this is a fairly trivial change.
    
    To test:
    1. Have a couple holds for a patron, some overrriden, some not
    2. Visit the patrons' detail page, holds tab.
    => SUCCESS: You see the holds, pickup location has a dropdown
    3. Repeat in the circulation tab for the patron
    => SUCCESS: You see the holds, pickup location has a dropdown
    4. Apply this patch
    5. Repeat 2 and 3
    => SUCCESS: Same behavior as before, but the dropdown is rendered with
    Select2 and has a search feature. Overridden pickup locations have an
    icon telling so
    6. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2dbae66f0419a9a8d68dbc04d94f8cae27b216a2
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 24 10:57:24 2021 +0100

    Bug 28421: Unit Tests
    
    This patch adds test test cases for both a Voided Payment and Voided
    Writeoff. These cases need special handling in the refund process.
    
    Test plan
    0/ Don't apply
    1/ Run t/db_dependent/Koha/Items.t
    2/ Prior to this commit the test should pass
    3/ Apply this commit but not the dependency(bug 22435)
    3/ The test should fail
    4/ Bug 22435 should make the test pass again.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90bcfaff9a30e92bccf55699b7cd0aec0f16595a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 4 09:28:52 2021 +0000

    Bug 22435: DBRev 21.06.00.013
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ba701089931f7e67f1f8de363d125477fef2820
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jul 5 14:16:30 2021 +0100

    Bug 22435: (follow-up) Set CREATE offset for credits to positive
    
    The history view of an accountline shows increases and decreases in the
    amount outstanding from the perspective of the credit/debit line you are
    inspecting.
    
    Apply creates a negative offset amount which acts to 'reduce' both the
    outstanding 'debt' for the debit line and the outstanding 'credit' for
    the credit line.  Starting with a negative offset for the credit thus
    makes this nonsenical.
    
    Void creates positive offset amounts which act to 'restore' both the
    outstanding 'debt' for the debit line and the outstanding 'credit' for
    the credit line.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 36140f37e59f50ac407cbb0c5e8f2dd557c18d4f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 21 18:32:50 2021 +0100

    Bug 22435: (QA follow-up) More test updates
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7293115c5615213aa1768811ccf38f316f9bd9d9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 21 17:08:33 2021 +0100

    Bug 22435: (QA follow-up) Fix returned offsets in moredetail
    
    This patch updates the offsets query for lost item returns displayed in
    the catalogue/moredetail controller.
    
    Test plan (Same as bug 19919)
    Test plan:
    1) Pay off a LOST item
    2) Check for the associated display of 'Paidfor?:' on the itemdetails page
    3) Writeoff a LOST item
    4) Check that a 'Paidfor?:' is not displayed on the itemdetails page.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 57e4176f6493cd7b6541e8afe1c958280dc0ed67
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 21 16:41:54 2021 +0100

    Bug 22435: Update DBIC Schema's
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5dfbddafa7a30e27c4fe5458b2b4f5aec6d0eef0
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 21 16:39:38 2021 +0100

    Bug 22435: (QA follow-up) Fix test for offset total
    
    This patch updates the test for the offset total method to adhere to the
    new restricted set of offset types available.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0971368dc7f0988577b720eff39d0ec3d8772661
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 21 16:20:22 2021 +0100

    Bug 22435: (QA follow-up) Add missing test for manager relation
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d6a6e79f79bfbc17807072faf0ff1d4e6aafb82
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 21 16:15:12 2021 +0100

    Bug 22435: (follow-up) Drop account_offset_types table
    
    This patch drops the now defunkt account_offset_types table and ensure
    the type field in account_offsets is instead an enum type column.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 37c795d589bd4939c83002e18e624460c6e22ad4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 21 15:43:04 2021 +0100

    Bug 22435: (follow-up) Update POS for reduced offset types
    
    This patch updates the Koha::Charges::Sales class to use the 'CREATE'
    and 'APPLY' offset types.
    
    Test plan
    1/ Run t/db_dependent/Koha/Charges/Sales.t
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2ec46485b32175da81c03b829c9e2cc55bfcd49d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 18 15:11:31 2021 +0000

    Bug 22435: (QA follow-up) Fix test file and adjust test
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1aa0f6dfb58e9aa7c02048a84505b48225fbbaa4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 14 16:42:44 2021 +0100

    Bug 22435: Improve database update
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c475d4d97b910fed8d57a01cc84a26f21277547d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 14 15:39:03 2021 +0100

    Bug 22435: Update accountline-details page to show all history
    
    The accountline-details page took a simplistic approach to displaying
    the history of an accountline. This patch drops the now defunct
    offset_type_description template block from it's respective include
    files, and then updates the accountline-details template and controller
    to show the full history of what's happend to the accountline passed.
    This includes the creation, any increments/decrements (for fines), and
    finally any offsets against the total (payments, cancellations, voids).
    
    Test plan
    1/ Create some credits and debits and apply them to each other in
    various combinations.
    2/ View the 'Details' page for some of the debit/credits
    3/ Compare before patch and after for the Details page.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47c589bea1d18d3ac0d352802ec79e0094bc8aba
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 14 14:37:59 2021 +0100

    Bug 22435: Update for bug 27049
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dec9f754f8bbebaf6d2a2e9ba1ce1b9935ba45da
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Fri May 14 14:04:35 2021 +0100

    Bug 22435: Fix _set_found_trigger
    
    The _set_found_trigger utilised the 'Writeoff' offset type to
    distinguish between the application of a writeoff and any other form of
    offset application.
    
    This patch updates the trigger to use the full link through from offset
    to account credit line to get the credit type being offset.
    
    Test plan
    1/ Run t/db_dependent/Koha/Items.t and prove it fails before the patch,
    but passes after applying this patch.
    2/ Run t/db_dependent/Koha/Account/Offsets.t and prove it passes both
    before and after applying this patch.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c188ec1567e69a1ee9e9fff19320a273e4ea65dd
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Mar 18 10:23:57 2021 +0000

    Bug 22435: Fix CREATE offset amounts
    
    Updateing the tests highlighted a mistake in the original code.. the
    offsets for the cancel and reduce creation lines were incorrectly
    signed.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9b34ca9fe2aa01bc55a432e26a658ec489a866ac
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 17 17:48:23 2021 +0000

    Bug 22435: Update unit tests
    
    This patch updates the unit tests to reflect the changes we have made to
    offset types.  We do two things:
    
    1) Clean up calls to 'apply' to drop passing offset_type
    2) Update test code to look for APPLY and CREATE instead of specific
       offset types.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5a09e46546dff342d6bf248d3561fc2c37956bc
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 17 14:11:20 2021 +0000

    Bug 22435: ->apply() should always use 'APPLY' for offset_type
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 990c023b42b2de6365b42fdb2247f070a5a836f6
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Mar 17 17:48:04 2021 +0000

    Bug 22435: Add 'APPLY' to account_offset_types
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dfd3f183cfa3e65d9bdf2d002fe9aa7ddbe0127f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 16 17:18:39 2021 +0000

    Bug 22435: Use 'CREATE' offset type in Koha::Account::Line
    
    This patch updates the Koha::Account::Line methods that result in new account
    lines to use the 'CREATE' offset type for the creation record.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 47c16a8ac0eb069a155d4b94e7c8f0695e934cba
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 16 17:12:07 2021 +0000

    Bug 22435: Use 'CREATE' offset type in Koha::Account
    
    This patch updates the Koha::Account methods for adding debits and
    credits to use the 'CREATE' offset type for the creation record.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 457692413e0a90a2ca82c16489c00422027761e9
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Mar 16 17:28:12 2021 +0000

    Bug 22435: Update CREATE offset types
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f1b6931fca46aeae74dec07651a1e1828daaeeda
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 4 11:28:05 2021 +0200

    Bug 28142: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2d6bf5de66956cfb264203a8cfd919901941b3f6
Author: Henry Bolshaw <bolshawh@parliament.uk>
Date:   Thu Jul 15 22:32:40 2021 +0000

    Bug 28142: Accessibility: OPAC cart/basket checkboxes are not labelled
    
    This patch adds labels to the checkboxes on the "Your cart" page to
    improve accessibility for users of screen readers. The labels are
    hidden from display because the item titles provide enough visual
    context.
    
    Test Plan:
    
    1. Go to the OPAC
    2. Search for some items and add them to your cart
    3. Inspect the page html and confirm the checkboxes are not labelled
    4. Select the "More Details" page and confirm these labels are missing too
    5. Apply the patch
    6. Inspect the checkboxes on the "Brief display" and "more details" views
    7. Confirm that the checkboxes have meaningful labels and that the visual
    display of the pages has not changed.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: fix indentation
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9127ab677381eb693834fa92b15db8721bbb1684
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed May 12 16:36:18 2021 -0400

    Bug 27848: Elasticsearch - include 245p to default title index mappings
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Lucy Vaux-Harvey <lucy.vaux-harvey@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8bfb85d7e10551472b4eb4566129b3f7ee99e696
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed May 12 16:32:45 2021 -0400

    Bug 27848: Elasticsearch - include 245b subtitle subfield in the default title index mappings
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Lucy Vaux-Harvey <lucy.vaux-harvey@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f331238ef4d4b293d314faf45053498babbd41ed
Author: Caroline Cyr La Rose <caroline.cyr-la-rose@inlibro.com>
Date:   Wed May 19 09:52:57 2021 -0400

    Bug 28391: Elasticsearch - Add 264b to publisher index mapping
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9abe5530f0548d46d6828507f5c580101ad35f88
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Aug 4 09:28:52 2021 +0000

    Bug 15067: DBRev 21.06.00.012
    
    JD Amended DB rev: no need to display a warning, the creation of the
    unique key will fail with an appropriate error.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 660b3936b63b46c2113b8824a415144ba7d0d462
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 23 16:04:27 2021 +0000

    Bug 15067: (QA follow-up) Ensure update is idempotent
    
    These tables really shoul;d have some unique keys, we need a test so we can add
    those
    
    This ended up being a bigger work than expected, RM feel free to reject or move
    to another bug and let the risk of duplicated languages
    
    This is an old one, let's get it in :-)
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0bb4e8c1c78ad6768e1b4d5ea8e2cfa52dc8393e
Author: Hayley Pelham <hayleymapley@catalyst.net.nz>
Date:   Mon May 13 10:10:03 2019 +1200

    Bug 15067: Added translations of languages to those 5 languages
    
    Estonian, Latvian, Lithuanian, Inuktitut and Inupiaq are added with
    their translations to the Advanced Search languages.
    
    Test Plan:
    1. From homepage, go to Advanced search
    2. Click on More options next to the Search button
    3. Scroll down to the Limits section
    4. Click on Language: No limit
    5. Find Estonian, Latvian, Lithuanian, Inuktitut and Inupiaq at the
    bottom of the dropdown.
    6. They should all be there.
    7. Estonian and Latvian are repeated, this need to be fixed.
    8. They need to be put in alphabetical order.
    
    Signed-off-by: Hayley Mapley <hayleymapley@catalyst.net.nz>
    The five languages are present, sorted alphabetically, and are not
    repeated.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 90822bc7104ae807828546582f6afe5d7fd6dffe
Author: Gus Ellerm <gel1163@stacmail.net>
Date:   Thu Jan 21 02:23:38 2016 +0000

    Bug 15067: Add additional languages to advanced search language search
    
    run update database script, look for new laguages under 'Language:' in Advanced search.
    Languages that should be added are:
    1. Estonian
    2. Latvian
    3. Lithuanian
    4. Inuktitut
    5. Inupiaq
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83e899f8b119b095501ce7e94ea619ff20cdee14
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jan 25 20:47:27 2016 +0000

    Bug 15067: Follow up to fix sorting
    
    It looks like C4::Languages:getLanguages relies on implicit database
    order for languages. They appear to be sorted by subtag so this patch
    adds that sorting to the database query to ensure the dropdown is
    sorted.
    
    Signed-off-by: Aleisha <aleishaamohia@hotmail.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab270c026be06f08745a14d1aea992877d20f812
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 30 08:51:24 2021 +0000

    Bug 28773: (QA follow-up) Additional changes
    
    The work of the first patch was not yet finished.
    
    [1] Similar changes to template for Cataloging and Authorities
    [2] Made a better distinction now between short title on button
        and long title on menu and modal
    [3] The short title parameter removes need for previewed var
    [4] To keep related code closer, moved the dataPreview hidden code
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0fffa209a979922b91f0075d5a889c116d9da5a9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 28 12:04:43 2021 +0200

    Bug 28773: (bug 23302 follow-up) Fix add order from z3950 search results
    
    For translated interface.
    
    Using 'Order' (the button text) was not a good idea as the interface can
    be translated :)
    
    Signed-off-by: Mark Hofstetter <koha@trust-box.at>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 946b9dc0b150024a94c4bcfa290e323133df6209
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 23 17:56:39 2021 +0000

    Bug 28754: Only adjust holds on specific biblio and don't go past end of array
    
    Our query for lowest priority holds only needs to adjust holds on the biblio we are looking at
    so I add biblionumber
    
    Additionally we can simply find the end of the array and use that rather than 99998
    so I set new_rank to scalar @priority
    
    Lastly, we don't need to fetch the lowest priority holds if we are ignoring lowest priority
    so I move it into the conditional
    
    To test:
     1 - Add holds with lowest priorty to 2 records in the catalog
     2 - Add a hold on a third record
     3 - Note errors in log like:
        [2021/07/23 17:47:17] [WARN] splice() offset past end of array at /kohadevbox/koha/C4/Reserves.pm line 1649
     4 - Apply patch and restart all the things
     5 - Add a new hold on third record - no warns
     6 - Make one of the holds on third record have lowestPriority (click rightmost arrow with line at bottom)
     7 - Note no warns
     8 - Adjust other holds on record and note no warns
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8ebe67393156721ba8ea56269ccd17e836b8ad49
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Aug 2 10:04:01 2021 -0300

    Bug 28741: (follow-up) Silence warning
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c765cfecf651a506cf3982ad15ac96991e683d6e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 22 17:56:39 2021 +0000

    Bug 28741: Fix use of resumption token params
    
    TO test:
     1 - Enable OAI-PMH server in Koha
     2 - Set OAI-PMH:MaxCount to 5
     3 - Define 6 sets in Admin->OAI sets configuration
        Can setSpec and setName to 1,2,3....
     4 - Browse to:
        http://localhost:8080/cgi-bin/koha/oai.pl?verb=ListSets
     5 - Click 'Show more'
     6 - Keep seeing the same 5 - note the page says 'Results fetched -4-0'
     7 - Apply patch
     8 - Restart all the things
     9 - Reload the ListSets URL above
    10 - Click 'Show more'
    11 - See the 6th set and note no 'Show more'
    12 - Set OAI-PMH:MaxCount to 1
    13 - Go to the base ListSets url again
    14 - Confirm you can 'Show more' until you reach the end
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aaa74db5f4ea48178bf432cfcfeebb02e1e9e767
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jul 30 14:53:31 2021 -0300

    Bug 28741: Regression tests
    
    This patch adds regression tests for the behavior.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 914d1c97f6cfd0179c5af57a604d2ff99ed32fd1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 30 19:20:29 2021 +0000

    Bug 28533: Fix other ocurrence
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ad858a41096c33add7092ff53fa1195eaed1dc0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 9 12:59:27 2021 +0000

    Bug 28533: Set subfields to 'undef' if whole field request in itemcallnumebr system preference
    
    This patch undefines the CNsubfields variable when the whole field is requested
    
    Note that the substr returns '' when no characters are found, so we test if the string eq ''
    
    Testing 'truth' doesn't work because "0" is a valid option
    
    To test:
     1 - Edit a record, add an 082 field
         082 0 0 ‡aalpha‡bbeta‡0delta
     2 - Set itemcallnumber system preference to 082
     3 - Attempt to add/edit items
     4 - ISE
     5 - Apply patch, restart all the things
     6 - Add/edit items - no error
     7 - Confirm the itemcallnumber field is populated with "alpha beta delta"
     8 - Set itemcallnumber system preference to '0820'
     9 - Add/edit items
    10 - Confirm itemcallnumber is populated with 'delta'
    
    Signed-off-by: Salman Ali <salman.ali@inLibro.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18176504405d8f83e057abacd9c13230d4ad7a02
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 28 17:37:46 2021 +0000

    Bug 28057: (follow-up) Get the biblionumber column
    
    When we fetch the biblioitems we use a select to limit the columns fetched,
    we must include the biblionumber as well
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f4238e9ab1257064c80d8f01b76c542ce8885165
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Apr 14 18:19:40 2021 +0000

    Bug 28057: Use the biblioitem's biblionumber for checking availability
    
    The loop here gets items from the record, plus analytic items. Because of this
    we need to check more than 1 record - we decide to do this via biblioitems.
    
    We need to preserve that, but when checking ItemsAnyAvailableAndNotRestricted we
    cannot assume that the biblionumber and biblioitemnumber are the same (they should be
    but this may not be the best of all possible worlds)
    
    I simply switch the call here
    
    To test:
    1 - Apply patch
    2 - Test placing holds on single bibs and multiple bibs
    3 - Confirm it works as expected
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9fd9885fb501af1e4ad957e36a6882c1b81be9a9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 3 14:46:56 2021 +0200

    Bug 17600: Add missing imports in authorities/
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dec0a22a63fa48ec627c49d2c30fa940558580c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Aug 3 14:35:18 2021 +0200

    Bug 17600: Fix GetTagsLabels imports
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aeae221495e34ea988cb2662f169e649e7f8965d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jul 13 10:54:59 2021 +0000

    Bug 28704: Library MARCOrgCode field needs maxlength attribute
    
    This patch adds a maxlength attribute to the "MARC organization code"
    field in the form for adding and editing libraries. The maxlength, 16,
    matches the limit of the table column.
    
    To reproduce the problem, go to Administration -> Libraries.
     - Add or edit a library
     - Fill the "MARC organization code" field with a string longer than 16
       characters, e.g. Decriminalization
     - When you save the record you will see an error.
    
    Apply the patch and add or edit a library.
     - Confirm that you cannot enter more than 16 characters in the "MARC
       organization code" field.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e717fca2d5095ef2cc7f5be59657872279dd21d0
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Wed Jul 21 12:37:21 2021 +0000

    Bug 28728: Link to holds page from holds raio
    
    To test:
    1 - Find a bib with 1 item, place 3 bib-level holds on it (just to make
        sure there's at least one title on your holds ratio page)
    2 - Go to the holds ratio page in circulation
    3 - mouse over the Holds Ratio column, see that the number there is a
        link to http://[your koha]/cgi-bin/koha/circ/reserveratios.pl#, the
        page you're already on
    4 - apply patch, restart_all, reload page
    5 - link now goes to the holds page for that title
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 75f4095f783fe419a758611cbbbfb8a8a34d9b44
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jul 22 18:35:13 2021 +0000

    Bug 28733: Correct position of desks link in admin menu
    
    This patch moves the "Desks" link from the "Basic parameters" section to
    the "Patrons and circulation" section, matching the category of the link
    on the Administration home page.
    
    To test, apply the patch and go to an administration page which includes
    the left-hand navigation sidebar, e.g. Administration -> Libraries.
    
    In the sidebar, the "Desks" link should be in the "Patrons and
    circulation" section, under "Item circulation alterts," matching its
    position on the Administration home page.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Bug 28733: (follow-up) Add manage_libraries permission check
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 583cbb5f35abc2effa8ff950aab845a89a29fe02
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Jul 15 13:00:14 2021 +0000

    Bug 28689: Extra %s in alert message when saving an items
    
    This patch removes an unnecessary %s in the text built to show when
    there are errors in the cataloging add item form.
    
    To reproduce, open the add item form in cataloging and click "Add item"
    without filling in all mandatory fields. You should see an alert message
    that contains, "- %s 1 mandatory fields empty (highlighted)"
    
    To test, apply the patch and return to the add item form. Now when you
    save an incomplete form the message should omit the %s:
    
    - 1 mandatory fields empty (highlighted)
    
    https://bugs.koha-community.org/show_bug.cgi?id=28690
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e2f5dbecdfa4cff34745853c94763904275c89c7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 30 14:07:09 2021 +0000

    Bug 28567: DBRev 21.06.00.011
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b7e17f9fdb6906460b11b8eef298917e523ecd9
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 25 12:44:19 2021 +0200

    Bug 28567: Fix 0 vs "" vs undef on the admin library form
    
    There are two things here:
    * Branches.pickup_location has a default = 1 in DB, we should not set to undef if 0
    or it will be set to 1 when stored.
    * The other fields are all text (varchar, mediumtext or longtext) and
    can be NULL. They are correct set to NULL when a new library is created
    but set to an empty string when the library is modified. That's not
    consistent
    
    Test plan:
    0. Don't apply the patch
    1. Create a new library, set pickup location to "No"
    2. Save
    => Pickup location is set to YES
    => In DB notice that the different values you didn't fill in are set to
    NULL
    3. Edit the library
    4. Save
    => In DB notice that the different values you didn't fill in are now set
    to an empty string
    5. Apply the patch, restart_all
    6. Run the updatedatabase script
    => In DB all the empty string values are set to NULL
    7. Repeat 1 to 4 and confirm that everything is now working as expected
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1634dd122b131d74d32817ba9c33c98c2372a48f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 19 14:35:11 2021 +0200

    Bug 28509: Prevent Koha/Acquisition/Orders.t to fail randomly
    
    The random errors were:
    03:25:39 koha_1       |     #     Structures begin differing at:
    03:25:39 koha_1       |     #          $got->[0] = '10'
    03:25:39 koha_1       |     #     $expected->[0] = '9'
    
    and
    
    16:36:15 koha_1       |     #     Structures begin differing at:
    16:36:15 koha_1       |     #          $got->[0] = '100'
    16:36:15 koha_1       |     #     $expected->[0] = '99'
    
    You see it coming?
    
    We sorted the ordernumbers alphabetically.
    
    Test plan:
    0. Don't apply this patch
    1. % git checkout v21.05.01 # The error is not appearing in master right now
    2. Add 2 warn statements before the 'The 2 orders are returned' tests to
    display $order_1->ordernumber and $order_2->ordernumber
    3. MariaDB CLI > ALTER TABLE aqorders AUTO_INCREMENT=3;
    4. prove t/db_dependent/Koha/Acquisition/Orders.t
    => Fail with
        #     Structures begin differing at:
        #          $got->[0] = '10'
        #     $expected->[0] = '9'
    5. Apply this patch, repeat 3. and 4.
    => The test passes now.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da7177f536b2673d7d68ff75e78fa8bd86d5726b
Author: Jason Boyer <JBoyer@equinoxOLI.org>
Date:   Wed Jul 28 14:01:25 2021 +0000

    Bug 28749: Restore the database name to Koha dumps
    
    The line to use the --databases flag with mysqldump by default was accidentally
    removed from koha-dump when the --schema-only option was added. This makes all
    backups act as if koha-dump is called with the --without-db-name flag, causing
    koha-restore to fail to restore the database because it's neither CREATEd or USEd.
    
    This patch restores that line
    
    To test:
    1 - sudo debian/scripts/koha-dump kohadev
    2 - zcat /var/spool/koha/kohadev/kohadev-2021-07-28.sql.gz | grep DATABASE
    3 - Notice no output
    4 - Apply patch
    5 - sudo debian/scripts/koha-dump kohadev
    6 - zcat /var/spool/koha/kohadev/kohadev-2021-07-28.sql.gz | grep DATABASE
    7 - You get the line:
        CREATE DATABASE /*!32312 IF NOT EXISTS*/ `koha_kohadev` /*!40100 DEFAULT CHARACTER SET latin1 */;
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7436094e19b39ba7285429d03df3ca52164b0632
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 30 13:19:23 2021 +0000

    Bug 17600: (follow-up) Fully qualify routine in cancel_expired_holds.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e9ae9a95a460462dfc224228722fea45a2900697
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 30 08:06:04 2021 +0200

    Bug 17600: (follow-up) Fix missing C4::AuthoritiesMARC import
    
    Oops
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 96adb7373ab3b39a42dc3a8304f050ee81c991c4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 30 07:20:20 2021 +0200

    Bug 28585: Revert of the 3 commits
    
    Revert "Bug 28585: (follow-up) Tests for q= supporting date/date-time parameters"
    
    This reverts commit 89d9dd6d5d3c76f0fd7e9062cb29ac93357b9088.
    
    Revert "Bug 28585: Use the datetime_parser for handling API dates"
    
    This reverts commit 2e266f35f9cae5f4b90d5e28e72990e6ba1bfeca.
    
    Revert "Bug 28585: Regression tests"
    
    This reverts commit 8d74d3226ad9e596f7aec77ce61ac378db7a5e4a.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 103f9e8e5e0e98e5ec963f1b0ffa73170e57795e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jul 28 12:24:14 2021 +0200

    Bug 28632: Prevent api/v1/patrons.t to fail on dates comparison
    
     #   Failed test 'Returned patron from update matches expected'
     #   at t/db_dependent/api/v1/patrons.t line 537.
     #     Structures begin differing at:
     #          $got->{updated_on} = '2021-07-27T13:33:53+00:00'
     #     $expected->{updated_on} = '2021-07-27T13:33:52+00:00'
     # Looks like you failed 1 test of 42.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 728f3816e3ea235a552c459cf9bb4ff253277d71
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 15:34:25 2021 +0200

    Bug 17600: Fix missing C4::AuthoritiesMARC import
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0275be68bbed3ea48c9f9f2d89560d4471e7be3b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jul 29 13:14:37 2021 +0000

    Bug 17600: (follow-up) Import GetAuthority in rebuild_zebra
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 903f50b6f08273626224169e5f0604d68167c7f7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jul 29 14:36:24 2021 +0200

    Bug 17600: Fix POSIX imports
    
    it fixes xgettext and (maybe) friends
    
    [12:22:29] Error: Command failed: misc/translator/xgettext.pl --charset=UTF-8 -s -o /tmp/koha-Jaa9rf/Koha-marc-NORMARC.pot -f /tmp/koha-Jaa9rf/files
    /tmp/koha-Jaa9rf/Koha-marc-NORMARC.pot at misc/translator/xgettext.pl line 387.
    Use of uninitialized value in subroutine entry at misc/translator/xgettext.pl line 388.
    Argument ">:encoding(utf-8)" isn't numeric in subroutine entry at misc/translator/xgettext.pl line 388.
    Argument "/tmp/koha-Jaa9rf/Koha-marc-NORMARC.pot" isn't numeric in subroutine entry at misc/translator/xgettext.pl line 388.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 402bce9b821529f0f79c0d8acfdf973f8f48c8be
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 17:19:44 2021 +0200

    Bug 17600: (follow-up) Fix wrong import in Koha::I18N - LC_MESSAGES
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d4ee40aa9e78313e8a78d0e42116a63fbe176365
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 27 13:49:38 2021 +0200

    Bug 28763: (bug 17600 follow-up) Import XSLTParse4display in opac-tags.pl
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 801e086f7b3461c210b73d7f2e29eb1cc2ed3bec
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue Jul 27 11:15:08 2021 +0000

    Bug 28763: (bug 17600 follow-up) Import XSLTParse4display in lists
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d4a4e7ca20fcc1da75708fb2ae55308fb49c77c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 19:34:59 2021 +0200

    Bug 17600: Fix t/db_dependent/Members.t
    
    Was failing after "Bug 17600: Fix other occurrences in svc"
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fcb1eb9357fbb4fa23a2709fa1701032952bf512
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 16:56:46 2021 +0200

    Bug 17600: (follow-up) Fix other occurrences in svc
    
    Erk, shame on me!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6c5aa578366aa02ace6095950a82b5c63111a898
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 16:47:18 2021 +0200

    Bug 17600: Fix wrong import in Koha::I18N - LC_MESSAGES
    
    $ perl -wc Koha/I18N.pm
    Subroutine Koha::I18N::LC_MESSAGES redefined at Koha/I18N.pm line 36.
    Prototype mismatch: sub Koha::I18N::LC_MESSAGES: none vs () at Koha/I18N.pm line 36.
    Koha/I18N.pm syntax OK
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a6bb271c4324c3dfff199d0bf3cacd45387474e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 16:41:07 2021 +0200

    Bug 17600: Fix other occurrences in svc
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 18aff2331c961c0bd3e9f5254eae1d291dec027e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon Jul 26 11:08:13 2021 +0000

    Bug 28758: (bug 17600 follow-up) Import subroutines from C4/AuthoritiesMarc
    
    To test:
    1 - Stage authority records
    2 - Attempt to import - nothing happnes
    3 - Apply patch
    4 - Stage file again
    5 - IMport records
    6 - Success!
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26a7898b1f6896fc0a843b0affae70c3ea6049d1
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 23 16:29:32 2021 +0000

    Bug 28750: fix svc/bib_framework
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 79854d6c4537ca343b8755ecee30774e8c6822e8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 23 14:16:06 2021 +0000

    Bug 28750: (bug 17600 follow-up) Use full routine names in svc/new_bib svc/bib
    
    To test:
    1 - Attempt to save a record in the advanced cataloging editor
    2 - It fails
    3 - Apply patch
    4 - It succeeds
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8813f8d37c88edd048464848c84708ff07e8a69
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 23 13:53:44 2021 +0000

    Bug 28750: (bug 17600 follow-up) Use full path for subroutines
    
    Throughout the file we call methods with the module
    Following suit rather than importing the methods
    
    To test:
    1 - Attempt to load advanced cataloging editor
    2 - it fails
    3 - http://localhost:8081/cgi-bin/koha/svc/cataloguing/framework?frameworkcode=&callback=define
    4 - Undefined subroutine &CGI::Compile::ROOT::kohadevbox_koha_svc_cataloguing_framework::GetMarcStructure called at /kohadevbox/koha/svc/cataloguing/framework line 18
    5 - Apply patch
    6 - Cataloging editor loads!
    7 - Link in #3 loads!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f891156f424a466aadb5ab85c445fcdbae4f3536
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 22 11:43:03 2021 -0300

    Bug 28565: Refactor tests
    
    Tests were too complex with no gain. They even deleted the whole DB to
    run (inside a transaction). I refactored to test the same thing, and
    make it rely (mostly) on existing data.
    
    _count behavior is tested implicitly by comparing with Koha::*->count.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/UsageStats.t
    => SUCCESS: Tests pass
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests still pass
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7c955c95009c1e272b64e7d17190a0db3719424
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jun 14 17:44:30 2021 -0300

    Bug 28565: Move the sysprefs to a reusable sub
    
    This patch moves the big sysprefs list to a sub. Behavior shouldn't
    change.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/UsageStats.t
    => SUCCESS: Things work as expected, no changes.
    2. Sign off :-D
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c623dfa94663e66e87e75518d6bb5f4c7ae70be1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 12:45:28 2021 +0200

    Bug 28394: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07ae0dfb0c4f2038bf4a8ff4e3336d3c962677e3
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 19 16:14:43 2021 +0000

    Bug 28394: Improve style of patron category entry form
    
    This patch makes some style and structure changes to the patron
    cartegory entry form:
    
    - Margin added to the enrollment period fieldset so that it aligns with
      the rest of the form.
    - Informational text inside the form wrapped in <div class="hint"> like
      it is on other pages.
    - Converted heading tag to legend tag in the messaging preferences
      fieldset.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    Go to Administration -> Patron categories -> New category and confirm
    that the style updates look good.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0511ced01c1d5fb81a233e9d2a069c45d2bdb135
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed May 12 18:35:27 2021 +0000

    Bug 28347: Add DataTables, additional information to patron attribute types management
    
    This patch enhances the display of patron attribute information on the
    attribute management page.
    
    To test, apply the patch and go to Administration -> Patron attribute
    types.
    
     - If necessary, add multiple patron attributes so that there is data to
       display. Include:
       - Some which are mandatory
       - Some which are linked to an authorized value category
       - Some which share a class.
     - The tables showing your attributes should each have DataTables
       sorting and controls (except for column configuration, which isn't
       added by this patch).
     - Confirm that DataTable controls work correctly for each table.
     - The table should include columns showing authorized value category
       and whether the attribute is mandatory.
     - If you are logged in as a user with permission to manage
       authorized values, the data in the authorized value category
       column should be linked to that category on the authorized values
       page.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7e1227890b43d5e17971568e7c4408bee13e445f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 1 21:14:37 2021 +0000

    Bug 28073: Patron modifications should auto-open panel for referring patron record
    
    This patch makes it possible to link directly to the correct panel on
    the "Update patron records" page. The link on the checkout and patron
    details screen has been updated to read "Patron has pending
    modifications."
    
    Also changed: Moved the "Patron's address in doubt" message so that it
    is above the table of changed fields.
    
    To test, apply the patch and if necessary submit patron modification
    requests from multiple patrons via the OPAC.
    
     - Open the checkout page for one of these patrons.
       - If you are logged in as a user with permission to edit patron
         records you should see a message, "Pending modifications: Review
         pending modifications," which links to the pending modifications
         page.
         - Clicking the link should open the page for reviewing pending
           patron modifications, and the correct panel should be
           automatically expanded.
       - If you are logged in as a user without permission to edit patrons
         you should see the message "Pending modifications: Patron has
         pending modifications," which isn't linked.
     - The process should work exactly the same from the patron detail page.
     - Following the "Pending modifications" link from the staff interface
       home page or the patrons home page should work as before: The page
       opens with the first panel expanded.
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6d9e145716d89ceb7bfde63b70d807c34e543abd
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 23 13:05:41 2021 +0000

    Bug 27747: (QA follow-up) Make code consistent and add explicit brackets
    
    The while statements were including the next statement, I add brackets to make it
    more obvious
    
    Also the highlighting was applying to [[borrowernumber|Borrow number]
    I removed the break to match code above and only highlight when syntax complete and correct
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3c8be8bf7a945d6901b277f8bea19b9347337f2f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Feb 22 12:36:08 2021 +0000

    Bug 27747: Add CodeMirror custom syntax highlighting for column placeholders
    
    This patch adds some additional configuration to CodeMirror so that
    column placeholders have a distinct color in the CodeMirror SQL editor.
    
    To test, apply the patch and create or edit an SQL report which contains
    one or more column placeholders, e.g. [[itemnumber|Item number]],
    [[borrowernumber|Borrower number]], etc.
    
    Confirm that when editing the SQL, these placeholders should appear as
    red text. Save your report and view it. The syntax highlighting should
    be updated in this view too.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 601a969915dd133312d6d89e96b880a3ecaf5e76
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 12:11:12 2021 +0200

    Bug 25464: Adjust occurrence in debian/koha-core.postinst
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 006c70f4f2112f7057e5c6228bfd4dd6684cf976
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Tue May 12 07:11:12 2020 -0400

    Bug 25464: Add ability to specify client IP and SIP account used in SIP2 logging
    
    Bug 15253 originally had the ability to specify the incoming IP address used for
    a given log statement via SIP, as well as the SIP2 account that was in use at the time.
    This data is very helpful for debugging purposes, and should be brought back.
    
    Test Plan:
    1) Apply this patch
    2) Update you SIP ConversionPattern to "[%d] [%p] %X{accountid}@%X{peeraddr}: %m %l %n"
    3) Restart SIP
    4) Use the SIP cli tester to make some SIP requests
    5) View the SIP2 log, note the account id and client ip address show in the log!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb2eae80d996f007566e79baa46e057a743029aa
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 24 09:44:33 2021 +0200

    Bug 28624: Remove Smart::Comments
    
    It's not used in those files (there is no occurrence of ###), and it's
    not installed anyway (it is by koha-testing-docker however).
    
    We should remove those lines.
    
    Test plan:
    Confirm the above
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 024c4911327ab94e24a0161164bb4dcf3569a281
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jun 10 15:42:14 2021 +0200

    Bug 28543: Clicking on 'New record' will use default framework
    
    In biblio records cataloguing, clicking on 'New from z39.50/SRU' will run action with default framework.
    Clicking on 'New record' should do the same.
    
    Test plan :
    1) Go to cataloguing home page
    2) Check you see 'New record' with a sparator and then a caret
    (like 'New from z39.50/SRU')
    3) Click on button text
    => You go to record edition with default framework
    4) Clik on caret
    => You see list of framworks
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1339fd514360659804fd734edc1f1039a008f624
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri May 14 16:02:57 2021 +0200

    Bug 27850: Search link for 260 a and c in MARC21 XSLT OPAC display
    
    In MARC21 XSLT OPAC display, 260$b is a search link on 'Provider'.
    $a and $c also have a search field, we can create search links.
    
    Test plan:
    1) Create 2 records with same 260 : two $a, one $b, two $c
    2) Use XSLT display in OPAC
    2) Look at first record details page in OPAC
    3) Click on a $a link => you see both records
    4) Click on a $c link => you see both records
    
    https://bugs.koha-community.org/show_bug.cgi?id=27850
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4debc8c5148d645433746813f7ba52dadc33e360
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Wed Mar 3 14:27:00 2021 +0100

    Bug 27850: Search link for 260 a and c in MARC21 XSLT intranet display
    
    In MARC21 XSLT intranet display, 260$b is a search link on 'Provider'.
    $a and $c also have a search field, we can create search links.
    
    Test plan:
    1) Create 2 records with same 260 : two $a, one $b, two $c
    2) Use XSLT display in staff inteface
    2) Look at first record details page in staff interface
    3) Click on a $a link => you see both records
    4) Click on a $c link => you see both records
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e87f51bd7ff8ff24928d328923aa73a06d3b3c96
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu May 27 03:34:30 2021 +0000

    Bug 28469: Move "Skip to main content" to top of OPAC page
    
    This patch moves the "Skip to main content" button out of the nav
    element and to the top of the <body> element, so that it's the first
    (potentially) viewable element on the page.
    
    This means you can inject content above the navbar, which has
    a relative position, and it won't disrupt the display of the
    "Skip to main content" button.
    
    To test:
    1) Apply patch
    2) Same test plan as Bug 22807:
    Go to any page in the OPAC and hit the tab key. The "Skip to main
    content" link should appear. Tabbing away from it should cause the link
    to hide. Hitting the ENTER key when the link is highlighted should cause
    the page to scroll to the main content.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4d91955e932d8b112103f647dfe51146e4034a9
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jul 24 22:53:38 2021 +0000

    Bug 28677: (QA follow-up) Correct capitalization
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07564cd4bbcedcef7cf083cdb9b7c2ccd6ce600b
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Mon Jul 19 16:32:18 2021 +0000

    Bug 28677: Update wording on ExpireReservesOnHolidays
    
    To test:
    1: look at ExpireReservesOnHolidays syspref description
    2: apply patch, restart
    3: look at wording again, see that it now clarifies that it only pertains to systems using ExpireReservesMaxPickUpDelay and includes the word "calendar"
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 896e0e662267cebdd5512bf2cc5263fff4a8248a
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Thu Jul 1 09:25:22 2021 -0400

    Bug 28640: (QA follow-up) Prevent unit tests from failing
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33dd62d66110e498236903a65f8aa7f5946a2ee3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 30 12:37:59 2021 +0100

    Bug 28640: Expose EDI Status on basket details page
    
    This patch adds the edi_order relationship method to
    Koha::Acquisition::Basket to return the most recently attached
    edi_message of type 'ORDER' for the basket.
    
    NOTE: EDI currently returns raw DBIC results. I have opted to maintain
    that approach here, but would like to work on upgradeing the
    Koha::EDIFACT::Order class to be a subclass of Koha::Object at a later
    date.
    
    We then use this new relationship in acqui/basket to display the EDI
    status for such baskets.
    
    Test plan
    1/ Setup a vendor with EDI Ordering enabled
    2/ Add a new basket for the vendor.
    3/ Note the new 'EDI status' field displays and reads 'Not ordered'
    4/ Close the basker
    5/ The 'EDI status' should continue to display 'Not ordered'
    6/ Re-open the basket
    7/ Close the basket via 'Create EDIFACT order'
    8/ Navigate back to the now closed basket
    9/ Note the 'EDI status' field now displays 'Pending' and the transfer
    date.
    10/ Progress the EDI order by running the edi_cron.pl script
    11/ The EDI status field should now reflect that the message has been
    sent.
    
    Signed-off-by: Benjamin Veasey <B.T.Veasey@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b17b691e01bb5fe28d2c8c6a6f4deac50ebe037f
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Jun 30 14:26:02 2021 +0100

    Bug 28640: Unit tests for edi_order relation
    
    Test plan
    1/ Run t/db_dependent/Koha/Acquisition/Basket.t
    
    Signed-off-by: Benjamin Veasey <B.T.Veasey@lboro.ac.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit da24b92793bdf50cb362d4cda5a01882db8aa0d4
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Feb 1 13:14:45 2021 +0000

    Bug 27583: Proposed terminology changes
    
    This patch impliments some terminology changes and clarifications for
    the cash management system
    
    Test plan
    1/ Apply the patches
    2/ Enable 'UseCashRegisters'
    3/ Navigate around the cash management system (via the Tools menu)
    4/ Enable 'EnablePointOfSale'
    5/ Navigate around the cash management system (via the Point of sale
    module)
    6/ Comment on what you think about the changes
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 252a4759b71e7a8bcce9f9713c9942b3bf176289
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 12:45:11 2021 +0200

    Bug 28662: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7de0384e4202641dd9943bdce0c398678a36716f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 11:19:17 2021 +0200

    Bug 28620: Replace remaining occurrence in test
    
    Not useful but won't hurt either.
    At least all our occurrences are identical now.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9eee9f931d0bd4da2c6b5b737a26b11f143a344f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jun 23 11:59:21 2021 +0000

    Bug 28620: Remove trailing space when logging with log4perl
    
    Trivial change.
    Do sed -i -r -e'/log4perl/ s/\s%n$/%n/' on the log4perl configs.
    
    Test plan:
    Update your own config.
    Trigger some logging and check that logfile.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66b6b284daeb7d6d2a8e624499ee4910c6fb8147
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jul 6 13:07:42 2021 +0000

    Bug 28662: Not possible to log out of patron account in OPAC with JavaScript disabled
    
    This patch adds a "Log out" link to the OPAC header which is hidden by
    CSS when JavaScript is enabled.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Log in to the OPAC with JavaScript disabled in your browser.
     - In the header next to the logged-in user's name there should be a
       "Log out." link.
     - Confirm that it logs the user out.
     - Enable JavaScript and repeat the process to confirm that the new
       logout link doesn't appear.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d1889d82d8ac8ab03ff96586a19b45f513db67a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 26 11:01:10 2021 +0200

    Bug 28408: Add new column to the table settings config
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 783e14076720f93384bca87bd53fa40a3951ffda
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 28 12:52:03 2021 +0000

    Bug 28408: Add 'Last updated' column to suggestions table
    
    We have specific meanings for the different dates in suggestions
    Managed - means the status was changed or the suggestion edited, but doesn't change if item type updated
    Modification - implies an edit of the subscript, not updated if status changed alone
    Updated - this is the date field in the DB, which is actually a timestamp
    
    The cronjob purge_suggestions.pl uses teh 'date' field
    
    For a user, a suggestion can look old in the interface, but be considered recent by the script
    
    To clear the confusion we should show the timestamp as well
    
    To test:
    1 - Add a suggestion
    2 - In the DB, pretend you set it in the past:
        UPDATE suggestions SET manageddate='2021-01-01', suggesteddate='2021-01-01', date='2021-01-01 12:12:12';
    3 - Click 'Go' In Organize by: Status
    4 - Note the suggestion looks old now
    5 - Check the box, and click 'Update item types with:' -> Submit
    6 - Prganize by status again
    7 - No change?
    8 - Check the DB:
        SELECT date FROM suggestions;
    9 - The field is updated
    10 - Apply patch
    11 - Organize by status again
    12 - See the 'Last updated' ate set to today
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 33b89f3a13017d0f3b9a2d8bd41265c135c3a31b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 12 17:00:57 2021 +0000

    Bug 28336: Add missing input for item_action
    
    To test:
    1 - Stage a marc file of authorities
    2 - Manage the staged file
    3 - Attempt to change the matching rule
    4 - 500 Error, in intranet-error.log:
    [Wed May 12 16:53:03.046652 2021] [cgi:error] [pid 52072] [client 172.19.0.1:50580] AH01215: C4::ImportBatch::SetImportBatchItemAction(): DBI Exception: DBD::mysql::st execute failed: Column 'item_action' cannot be null [for Statement "UPDATE import_batches SET item_action = ? WHERE import_batch_id = ?" with ParamValues: 0=undef, 1="1"] at /kohadevbox/koha/tools/manage-marc-import.pl line 160: /kohadevbox/koha/tools/manage-marc-import.pl, referer: http://localhost:8081/cgi-bin/koha/tools/manage-marc-import.pl?import_batch_id=1
    5 - Apply patch
    6 - Reload page and change matching rule
    7 - Success!
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9228ffbd6554bb3373bdeca87e0f54e190eae47
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 26 12:17:41 2021 +0000

    Bug 27885: (follow-up) Use biblionumbers instead of biblionumber in form action for club search
    
    This simply matches the code on the patrons search tab
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66ce3c1a8be1690eb6331d94564404e2687a20a2
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Mar 5 17:32:28 2021 +0000

    Bug 27885: Populate biblionumbers parameter using biblionumbers array
    
    Currently we send $biblionumbers as the parameter, but this is just apassthrough form when a list of biblios is selected for placing a hold
    
    If passed a single biblionumber we push it into @biblionumbers and use that for building the biblio loop
    
    This patch uses @biblionumbers to avoid sending a blank variable in the URL
    
    To test:
    1 - On the staff client click 'place hold' for an individual record
    2 - Use the form to find a patron
    3 - Note the url is:
        http://localhost:8081/cgi-bin/koha/reserve/request.pl?biblionumbers=
    4 - Apply patch
    5 - Repeat
    6 - The url is now like:
        http://localhost:8081/cgi-bin/koha/reserve/request.pl?biblionumbers=248
        (but with whatever biblionumber you chose)
    7 - Perform a search and select multiple biblios and confirm you can place holds as before
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    JD Amended patch: Add missing space
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4a2447f432709192a762987c7e3d82725868a7e1
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Fri Jul 16 14:44:10 2021 +0000

    Bug 28718: handle multiple deletions from news
    
    To test:
    1. have multiple news
    2. check several of them and and click 'Delete selected'
    3. see ugly error
    4. apply patch
    5. try again
    6. no error
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fc96399c95153e4b305c9239e3211c9e829d67a6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 23 16:19:15 2021 +0200

    Bug 28622: (bug 15758 follow-up) Remove incorrect branch selection in adv search
    
    From
      commit df97814f3034a3d5015546c4eca21f08ae951e37
      Bug 15758: Koha::Libraries - Remove GetBranches
    
    +    selected_branchcode => ( C4::Context->IsSuperLibrarian ? C4::Context->userenv : '' ),
    
    And
    
    -        [% PROCESS options_for_libraries libraries => Branches.all() %]
    +        [%# FIXME Should not we filter the libraries displayed? %]
    +        [% PROCESS options_for_libraries libraries => Branches.all( selected => selected_branchcode, unfiltered => 1 ) %]
    
    The change in the pl is wrong as it should pass C4::Context->userenv->{branch},
    but prior to this commit it seems that we didn't select the logged in
    library anyway.
    
    Looks like we should remove this code but preserve the current behavior and select "All libraries".
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c739305d8566984cf4f59f517a8b18d87c90075c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Jun 17 12:36:01 2021 +0000

    Bug 22801: (follow-up) Use date-of-publication directly
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0fb60358dc5042fbfcaf634d6e37dbfd9d6bd6af
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Fri Jan 22 09:39:33 2021 +0100

    Bug 22801: Advance search yr must use date-of-publication and not copydate
    
    In advanced search with Elasticsearch the limit on years range is actually using copydate :
    
    Koha/SearchEngine/Elasticsearch/QueryBuilder.pm in _fix_limit_special_cases() :
            if ( $l =~ /^yr,st-numeric,ge=/ ) {
                my ( $start, $end ) =
                  ( $l =~ /^yr,st-numeric,ge=(.*) and yr,st-numeric,le=(.*)$/ );
                next unless defined($start) && defined($end);
                push @new_lim, "copydate:[$start TO $end]";
            }
    
    With Zebra it uses date-of-publication and also in Koha/SearchEngine/Elasticsearch/QueryBuilder.pm :
    
    our %index_field_convert = (
    (...)
        'yr' => 'date-of-publication',
    
    This patch uses %index_field_convert to perform 'yr' limit.
    
    Test plan:
    1) Apply patch
    2) Use Elasticsearch searchengine
    3) Go to advanced search with 'More options'
    4) Perform a search with a year limit (value or range)
    5) Check results are correct
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f148cae6bd0d0408bf101dda3c688f89e03d852e
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Jul 23 11:57:36 2021 +0000

    Bug 28747: Clarify working on RestrictionBlockRenewal
    
    To test, apply patch, restart services and reload page, confirm that now the syspref says "from the staff interface."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 89d9dd6d5d3c76f0fd7e9062cb29ac93357b9088
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 25 11:49:06 2021 -0300

    Bug 28585: (follow-up) Tests for q= supporting date/date-time parameters
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e266f35f9cae5f4b90d5e28e72990e6ba1bfeca
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 25 11:37:29 2021 -0300

    Bug 28585: Use the datetime_parser for handling API dates
    
    This patchset takes the GET /patrons route as a sample usage for filtering
    on date and date-time (including timestamp) fields.
    
    It then makes Koha::Object->attributes_from_api use the DB storage
    datetime parser for format the parameters correctly.
    
    To test:
    
    1. Apply the regression tests
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/patrons.t
    => FAIL: It doesn't find the patron when filtering by date
    3. Apply this patch
    4. Repeat 2
    => SUCCESS: It works now!
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8d74d3226ad9e596f7aec77ce61ac378db7a5e4a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 25 09:57:11 2021 -0300

    Bug 28585: Regression tests
    
    This patch adds tests for filtering GET calls with date/date-time
    parameters. Tests fail because the feature is not working
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5dcac8523cf797967bc0a7448fb328d0f20997b9
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jul 12 13:29:27 2021 +0000

    Bug 28679: Unable to click "Log in to your account" when GoogleOpenIDConnect is enabled
    
    This patch corrects the login link in the OPAC when GoogleOpenIDConnect
    is enabled. It removes modal-related markup which was causing the link
    to fail.
    
    To test, apply the patch and enable the GoogleOpenIDConnect system
    preference.
    
    - In the OPAC, click the "Log in to your account" link in the header.
      You should be redirected to a Google authentication form.
    - Disable the GoogleOpenIDConnect preference. The login link in the OPAC
      should trigger a modal login form.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dcc8229e13a20eaaf598b251c88e693a781a93af
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 30 15:42:50 2021 +0000

    Bug 28631: Holds History title link returns "not found" error
    
    This patch corrects a broken path in the OPAC holds history page.
    
    This patch also corrects the breadcrumb markup which didn't conform to
    the new Bootstrap 4 pattern.
    
    To test, apply the patch and log into the OPAC as a patron who has past
    or current holds.
    
    - View the "your holds history" page.
    - Click a title link in the table of holds. It should take you to the
      correct bibliographic detail page.
    - Check the breadcrumbs of the page. They should look consistent with
      breadcrumb navigation on other pages in the OPAC.
    
    Signed-off-by: Kelly <kelly@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 638b3df2e85edb83946afddb1d1e0267f1e12e3c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 23 11:46:33 2021 +0200

    Bug 28745: (bug 28158 follow-up) Restore the items table once the job is done
    
    Caused by bug 28158, the batch item modifications tool does not longer
    display the table with the items that have been modified on the result screen.
    
    There is no more fork and so no more completedJobID var.
    We must process the items THEN build the items' info.
    
    Test plan:
    Use the batch item modification tools to modify some items.
    Confirm that with this patch the table with the modified items is
    displayed on the last screen.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 09e0799a8d617ba61e120576a6478465dc975aff
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 6 14:48:51 2021 +0200

    Bug 28660: (bug 21325 follow-up) Fix auto self check
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Works as expected.
    The need for an additional check of pref WebBasedSelfCheck is
    merely theoretical.
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3748efc8abbe8ff62bfa263fbfc25c7f333aae96
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jul 21 14:55:01 2021 +0000

    Bug 28731: (bug 17600 follow-up) Import necessary subroutines in reports svc endpoint
    
    TO test:
     1 - Write a report
     2 - Click the svc link in the saved reports list
     3 - ISE
     4 - Make report public
     5 - Click the svc link in saved reports list
     6 - ISE
     7 - Apply patch
     8 - Comfirm opac/public link works
     9 - Make report not public
    10 - Confirm the internal svc link works
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f0108f4ff70bc351a2129ee670e07c8f79ae023e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 19 16:39:06 2021 +0200

    Bug 17600: Fix batchMod.pl
    
    Undefined subroutine &CGI::Compile::ROOT::kohadevbox_koha_tools_batchMod_2epl::haspermission called at /kohadevbox/koha/tools/batchMod.pl line 89
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f5bf73f72262844a840f6d11c96cfde08a8471a8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jul 16 09:46:59 2021 +0200

    Bug 17600: Fix tests
    
    No idea why UpdateStats in C4::Circulation needs the fully qualified
    namespace!
    
    I kept getting
    Undefined subroutine &C4::Circulation::UpdateStats called at /kohadevbox/koha/C4/Circulation.pm line 1643.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9d6d641d1f8b77271800f43bc027b651f9aea52b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Nov 9 12:06:44 2016 +0000

    Bug 17600: Standardize our EXPORT_OK
    
    On bug 17591 we discovered that there was something weird going on with
    the way we export and use subroutines/modules.
    This patch tries to standardize our EXPORT to use EXPORT_OK only.
    
    That way we will need to explicitely define the subroutine we want to
    use from a module.
    
    This patch is a squashed version of:
    Bug 17600: After export.pl
    Bug 17600: After perlimport
    Bug 17600: Manual changes
    Bug 17600: Other manual changes after second perlimports run
    Bug 17600: Fix tests
    
    And a lot of other manual changes.
    
    export.pl is a dirty script that can be found on bug 17600.
    
    "perlimport" is:
    git clone https://github.com/oalders/App-perlimports.git
    cd App-perlimports/
    cpanm --installdeps .
    export PERL5LIB="$PERL5LIB:/kohadevbox/koha/App-perlimports/lib"
    find . \( -name "*.pl" -o -name "*.pm" \) -exec perl App-perlimports/script/perlimports --inplace-edit --no-preserve-unused --filename {} \;
    
    The ideas of this patch are to:
    * use EXPORT_OK instead of EXPORT
    * perltidy the EXPORT_OK list
    * remove '&' before the subroutine names
    * remove some uneeded use statements
    * explicitely import the subroutines we need within the controllers or
    modules
    
    Note that the private subroutines (starting with _) should not be
    exported (and not used from outside of the module except from tests).
    
    EXPORT vs EXPORT_OK (from
    https://www.thegeekstuff.com/2010/06/perl-exporter-examples/)
    """
    Export allows to export the functions and variables of modules to user’s namespace using the standard import method. This way, we don’t need to create the objects for the modules to access it’s members.
    
    @EXPORT and @EXPORT_OK are the two main variables used during export operation.
    
    @EXPORT contains list of symbols (subroutines and variables) of the module to be exported into the caller namespace.
    
    @EXPORT_OK does export of symbols on demand basis.
    """
    
    If this patch caused a conflict with a patch you wrote prior to its
    push:
    * Make sure you are not reintroducing a "use" statement that has been
    removed
    * "$subroutine" is not exported by the C4::$MODULE module
    means that you need to add the subroutine to the @EXPORT_OK list
    * Bareword "$subroutine" not allowed while "strict subs"
    means that you didn't imported the subroutine from the module:
      - use $MODULE qw( $subroutine list );
    You can also use the fully qualified namespace: C4::$MODULE::$subroutine
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af7e41d1142573666d302a8475274ea58e5c99f4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 13 11:42:03 2021 +0200

    Bug 28606: Remove warning from C4::Auth 887
    
    [WARN] Use of uninitialized value in sprintf at /kohadevbox/koha/C4/Auth.pm line 887.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f132fc82033464daf00d0bfd29982be9e397bcd3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 13 09:49:24 2021 +0200

    Bug 27948: Fix file mode
    
    From
      commit b7acefa116c9ae1e738b5c53f30cf0d6c11d8784
      Bug 27948: (follow-up) Use Koha.news and PROCESS koha_news_block to bring disclaimer
    
    opac/opac-request-article.pl changed file mode from 100755 to 100644
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 244bb2e4439830fc1cd3b87b1a3a9cde789bdfa5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jul 13 09:46:59 2021 +0200

    Bug 28483: Fix t/Search/buildQuery.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba13ce40f35ff747ef00af5ab77c94d039e613fc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 22 17:32:20 2021 -0300

    Bug 28636: Add POD to t:lib::Mocks
    
    There's no POD. This patch adds it. I wrote it as part of bug 28615 but
    then it took another direction, so submitting here.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit af1779880dca4cd73f7022128bcc80f4aba69fad
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jul 6 11:11:31 2021 +0000

    Bug 28177: (follow-up) Add time to date column
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae79ba3e259cee22d239e68048501e13e87c5f86
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 20 14:24:29 2021 +0000

    Bug 28177: Add date column and column configuration to uploads
    
    This patch adds a "Date added" column to the table showing uploaded
    files. Column configuration is added to the table, and the date column
    is hidden by default.
    
    To test, apply the patch and restart all.
    
    - Go to Tools -> Upload.
    - If necessary, upload multiple files with the same category.
    - Use the "Search uploads by category" form to find those uploads.
    - In the table of uploads, confirm that table settings and other
      DataTable controls work correctly, including the option to show the
      "Date added" column.
    - Go to Administration -> Table settings -> Tools -> upload.
    - Change the settings for the uploads table.
    - Return to Uploads and confirm that your changes are reflected in the
      display of the uploads table.
    
    Signed-off-by: Salman Ali <salman.ali@inLibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2f6877d6163dce3cbfbb4d418ee55ea31be6349b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Jun 22 19:09:23 2021 +0000

    Bug 28175: (follow-up) Preselect correct category after search
    
    This patch modifies the script and template so that if the user submits
    a search by category, that category will be preselected on the search
    results page.
    
    Also added is an empty "Choose" option so that a search category isn't
    selected by default.
    
    To test, apply the patch and view the uploads page.
    
     - In the category search form, a "Choose" option should be selected.
       Submitting the form without selecting a category should not work.
     - Search using one of your existing categories. On the search results
       page the category you selected should remain selected.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e078875cbc1006fd8c26259449b9ffdad24872e1
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Apr 23 16:05:40 2021 +0000

    Bug 28175: (follow-up) Adapt layout when there are no upload categories
    
    This patch adds some logic to the uploads template so that if there are
    no upload categories there isn't an empty space on the page where the
    "Search by category" form would be.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 59309b321f844f973bceb959fb314fe6df345b57
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Apr 20 12:13:28 2021 +0000

    Bug 28175: Usability improvements to uploads page
    
    This patch makes a variety of changes to the uploads page in order to
    improve usability:
    
    - Add a toolbar with an "Upload" button so that it can be accessed from
      the upload results or search results views
    - On views other than the "main" view, add search forms to the sidebar
      - The search form markup has been modified somewhat in order to make
        it work well in both the sidebar and the main body of the page.
    - Show the upload category description instead of the code
    - Link the upload category in search results to a search for that
      category
    
    The "enctype" attribute has been removed from the search forms because
    it is unnecessary and causes form resubmission errors in some browsers
    (Firefox at least).
    
    To test, apply the patch and make sure you have at least one entry under
    Authorized values for the category UPLOAD.
    
    - Go to Tools -> Upload.
    - Upload a file, adding a category as you do so.
    - On the upload results page, test that the "Upload file" button
      returns you to the main upload page.
    - On the upload results or search results view, confirm that the "Search
      uploads by category" and "Search uploads by name" forms work
      correctly.
    - When viewing upload or search results, confirm that the category
      discription is shown instead of the code. Confirm that the category is
      a link to a search for other files in that category.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5c86f4aacdf1ffaf50fed1e8bd34f833a2b7610
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 15:43:52 2021 +0200

    Bug 27873: Compiled CSS changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dffb3fede8767ff28c8558451b404e5f964e1758
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Thu Apr 1 13:29:29 2021 +0000

    Bug 27873: Improve message consistency: checkout and patron detail pages
    
    This patch creates a new include for showing circulation and
    patron-related messages on both the checkout page and the patron detail
    page. This allows the two pages to be consistent with each other.
    
    The patch also makes some minor CSS adjustments, including the addition
    of an SVG to replace an old GIF, arrow-bullet.gif.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
    - View both the checkout and patron details page for patrons in the
      staff interface, confirming that the information is displayed in the
      same way, including:
    
      - Pending modifications
      - Pending expiration
      - Expired
      - Address in doubt
      - Card lost
      - Restricted (indefinite and with expiration)
      - Outstanding overdues
      - Outstanding return claims
      - Patron age incorrect for their category
      - Outstanding charges
      - Account credit
      - Waiting holds (at logged-in library or other library)
      - Circulation note (from borrowers.borrowernotes)
      - Messages (added at logged-in library or other library)
    
    EDIT: Fixed merge error.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit de1ac2b5588c022522194372d1234ac56a73bd8b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 15:44:10 2021 +0200

    Bug 27445: Compiled CSS changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf0c2c7d8c8c31219a6891a62689a3e4cdff0bef
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Jan 15 19:15:06 2021 +0000

    Bug 27445: OPAC header tweaks for non-JavaScript users
    
    This patch makes some minor changes to the header menu in the OPAC
    visible only to users with JavaScript support.
    
    To test, apply the patch and rebuild the OPAC CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - View the OPAC with JS disabled in your browser.
     - The "Cart" button should not be visible.
     - The "List," "Log in," and "Search history" links should be styled
       blue like other links.
     - Log in to the OPAC and confirm that the "Welcome <name>" link is also
       styled like other links.
     - Enable JavaScript and verify that the links appear and function just
       as they did before the patch.
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5da5a2bbc53613c511ba9e7e1a93d9f71e993160
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed May 19 10:19:33 2021 +0000

    Bug 28384: Add 'no_items' option to TransformMarcToKoha
    
    This patch adds a new option 'no_items' and uses it in the C4::Search::searchResults
    routine. We don't use the item info fetched here, so skipping those lines saves us time.
    
    Additionally, I fix an incorrect FIXME comment, and pass the ISBN returned by the routine above
    into GetNormalizedISBN to save another lookup
    
    TO test:
    1 - Enable AmazonCoverImages system preference
    2 - Search staff client with a term that returns books with covers
    3 - Apply patch
    4 - prove -v t/db_dependent/Biblio/TransformMarcToKoha.t
    5 - Confirm searching works
    6 - Confirm Amazon images display (normalized_isbn is used for these)
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] Amended, replacing a tab character.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6d0ba552ecef05de9a8893c0b2833ec1def3ad9
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Thu Mar 18 13:52:37 2021 +0000

    Bug 27985: Add option to send a record to batch modification from details page
    
    This patch adds an option to modify a single record using a marc modification
    template to the 'Edit' menu on the details page
    
    To test:
     1 - Apply patch
     2 - Browse to details page on the staff client
     3 - Be a user with permission to edit records and use batch record modification
     4 - Verify the option 'Modify record using template' appears in list
     5 - Click it
     6 - You should be sent to batch record modification screen
     7 - If you have no templates there will be a link prompting you to create on, do that
     8 - If oyu already had one, or created on above you shoudl now be able to select a template
     9 - Apply the template
    10 - Browse to the record again
    11 - Confirm changes were applied correctly
    
    Signed-off-by: Kelly McElligott <kelly@bywatersolutions.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19551b4e780cc881b9645bfe14df9bb9855c19e2
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 13:45:17 2021 +0000

    Bug 20472: DBRev 21.06.00.010
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8aefe1bb721122d3db1bd2512b048cc84a46cd0d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 13:45:17 2021 +0000

    Bug 20472: DBRev 21.06.00.009
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0301624b022e2abb2caf4502bfc2d59c23099afc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 15:41:45 2021 +0200

    Bug 20472: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b9dc107914b294ca4f76ef1cfba9cc6cd4d226e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 15:37:14 2021 +0200

    Bug 20472: Add kohastructure changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2de4f55ea5f2efd6c1d37bbf07252c5004e1d0ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 13:52:02 2021 +0200

    Bug 20472: Make DB rev idempotent
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f77fd6c993896f9ee3b5d643f68877ed11a8a813
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 24 11:50:05 2021 +0000

    Bug 20472: (QA follow-up) Add few TT filters
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    No more warns from qa tools.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cf01494aa5f5ce37222c257d93e0d8c34ed44a8e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 29 13:32:22 2020 +0000

    Bug 20472: Update translated AR notices
    
    Originally, we had:
    de-DE/mandatory/sample_notices.sql
    fr-CA/obligatoire/sample_notices.sql
    fr-FR/1-Obligatoire/sample_notices.sql
    it-IT/necessari/notices.sql
    nb-NO/1-Obligatorisk/sample_notices.sql
    pl-PL/mandatory/sample_notices.sql
    ru-RU/mandatory/sample_notices.sql
    uk-UA/mandatory/sample_notices.sql
    
    Obviously, the landscape changed in the meantime.
    We still have: fr-CA, fr-FR, nb-NO.
    
    Test plan:
    Reinstall notices for one of the languages above.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Have run all sql files thru mysql on the command line.
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9c0ee1f5c5baddec748ebe9e389fdafbe66559da
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 29 11:12:12 2020 +0000

    Bug 20472: Add format to sample notices
    
    NOTE: We are only changing English here. A follow-up will care for
    the translated languages. (English is in yml format, the remainder
    not yet.)
    
    We need to change the following notices:
    AR_SLIP, AR_CANCELED, AR_PROCESSING, AR_PENDING and AR_COMPLETED.
    In AR_COMPLETED the last sentence about picking up has been modified
    too.
    
    Test plan:
    Reinstall Koha. Choose English. Check notice text.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f10326000659c595ebcf9d94b37775964ffb27c0
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Apr 5 14:22:42 2018 +0200

    Bug 20472: Edit URL field on staff form
    
    This patch makes the following changes:
    
    Add menu option Edit URLs.
    Edit modal form to edit URLs.
    Save URLs via ajax call to svc/article_request (Add action update_urls).
    Add URL column to pending and processing table.
    Allow Edit URLs for pending table too (just as Complete).
    Do not allow 'Complete request' if a scan request has no URL(s).
    
    Test plan:
    [1] Add a few scan and photocopy requests.
    [2] Fill url-A and url-B in two separate scan requests.
    [3] Verify that these two urls are really saved (refresh form).
    [4] Check that you cannot complete a scan request without URL and that you
        cannot add a URL to a photocopy request.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f539428d061372cf6dad24aa9b1c594f6b3fd66e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Apr 3 16:19:13 2018 +0200

    Bug 20472: Add format field to the interface
    
    We need to add the format to the forms entering new requests:
      opac/opac-request-article
      circ/request-article
    If the pref contains multiple formats like SCAN|PHOTOCOPY, the first listed
    format will be preselected on the request form. If there is only one option,
    we should not disable the select however. (Possibly hide it.)
    
    If we have no mandatory fields, we should not allow the submit of a complete
    empty form (check on OPAC).
    
    And we need to show the format of pending requests on forms:
      opac/opac-user
      circ/request-article (biblio detail tab)
      circ/article-requests (staff form to handle requests)
      members/moremember (Article requests tab at the bottom)
      circ/circulation (Checkout/Article requests tab)
    Note: The last two forms use the same include file.
    
    Test plan:
    [1] Add an article request via opac or staff. Choose Scan.
    [2] Verify that you see the Scan format on opac-user and the
        above-mentioned staff forms.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b715abdc10345f3e1c92fbcec4b43a312d084ad
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 26 15:10:54 2018 +0200

    Bug 20472: Db rev for new preference ArticleRequestsSupportedFormats
    
    This preference controls which formats are actually offered to patrons of
    the library via the Article Request feature.
    By default, it only contains PHOTOCOPY. This is default behavior.
    
    The request format SCAN will be made possible by this report and can be
    added by changing the preference.
    
    Test plan:
    Run the dbrev. Check the new pref on Administration.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f97fca4f0088d1799e5d89273f25ed32adaf711f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 26 14:41:06 2018 +0200

    Bug 20472: Add new fields article_requests.format and urls
    
    The field 'format' will allow to make a distinction between requests for
    photocopies and digital scans.
    The field 'urls' will be used to save the URLs that allow the client to
    download the scanned materials.
    
    Test plan:
    Run new install or upgrade existing install with atomic update.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8505daaf796e5dc4ae11c075159cba711418a770
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 13:45:17 2021 +0000

    Bug 20310: DBRev 21.06.00.008
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 61ed4887e116ae502672ec9ed46ef5fcd2bafa26
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jul 9 12:02:38 2021 +0000

    Bug 20310: (QA follow-up) Add 'Opac' to pref and description
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ea8d8945b741b3592d5602cdbb1ef7f1fcc90dee
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 28 14:13:07 2021 +0100

    Bug 20310: (follow-up) Rename method to get_marc_host
    
    This method is a mix of database relationship accessor and marc field
    accessor. We have get_marc_notes already and other patches in the queue
    are also starting to introduce get_marc_* named methods. This patch
    updates the method name to conform with that scheme.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 472538b17d99a044994de2baca8f68544c45000b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon Jun 28 14:07:53 2021 +0100

    Bug 20310: (follow-up) Move syspref check into controller
    
    I believe the syspref check is better placed in the controller. This way
    the host_record method is not so closely tied to the articel requests
    feature and may subsequently prove useful to future use cases.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cc316db0b1c35594e81a93daec0d16fcc2aee2cb
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Apr 9 07:39:49 2021 +0000

    Bug 20310: (follow-up) Check if biblio exists; 755 host_record.t
    
    In order to prevent an error like:
    Can't call method "host_record" on an undefined value at opac/opac-request-article.pl
    
    Also chmod's host_record.t to 755 (File must have the exec flag)
    
    Test plan:
    Change the URL so that the biblionumber does not exist.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bf5ed39364fec678403dbe61d5cb260bf3776728
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 8 13:29:45 2020 +0000

    Bug 20310: Adding a pref to control behavior
    
    If people want to control the redirection, we could add a pref
    like ArticleRequestsHostRedirection. If it is not enabled,
    the party is over.
    
    Test plan:
    Test if redirection stops on a child and host when you disable.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1f8d0a8fe5dd99ce072d184baab875e568a9b8cd
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Tue Sep 8 12:59:53 2020 +0000

    Bug 20310: (follow-up) Add or remove orgcode in second try
    
    We did remove an orgcode, but we could also do the other way
    around.
    
    Note: Hard to include in the unit test since it mocks the whole
    search engine part.
    
    Test plan:
    [1] Run t/db_dependent/Koha/Biblio/host_record.t
    [2] Test host 001 = number and child 773 = (org)number
    [3] Test host 001 = (org)number and child 773 = number
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e5651d4dad95bb5f5ba2be8eb418c956a05fcf77
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 19 14:14:39 2018 +0100

    Bug 20310: Redirect article record without items for article requests
    
    If an article record has been catalogued separately, has no items and
    contains a reference to its host via MARC21 field 773 (host item entry),
    this patch makes an article request redirect to the host record while
    copying title, author and page info (from 773$g).
    
    This is accomplished by using the new Koha::Biblio->host_record method.
    
    Note: Subfield 773$g may contain additional information on volume and
    issue number etc. It will be very hard or perhaps impossible to parse $g
    and copy these details into the corresponding fields of the article
    request form for all possible variations used in libraries. A similar
    remark can be made for selecting the correct item (when item level is
    used). We could try this on a future report, but will probably need at
    least a preference to define the expected format.
    
    Test plan:
    [1] Enable article requests. Add rules for an ART and a SER itemtype.
    [2] Create a SER host biblio record.
    [3] Create an ART biblio record, no items. Include a 773w pointing to the
        SER record with '(MARCorgcode)[recno]' (keep the parentheses, remove
        the square brackets when inserting the biblionumber).
        Include text in 773$g too.
    [4] Place an article request on the ART record. Verify that it redirects
        you to the SER record while copying title, author, page info.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Hugo Agud <hagud@orex.es>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80d93b62c10eb20bcc7f4fa45b87dacf37dc823e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 13:34:15 2021 +0200

    Bug 27948: Remove unused branchcode var
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2a4a8266efe150241727716aa263d91efcc33038
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Mar 19 14:14:39 2018 +0100

    Bug 20310: Introduce Koha::Biblio->host_record
    
    This is a more generic method that allows you to get to the host record
    as defined in MARC21 field 773$w. This control number is looked up in the
    search engine (MARC21 field 001).
    
    Note: The current implementation is based on MARC21 and does not change
    behavior for UNIMARC.
    This includes the follow-up originally submitted separately on Bugzilla,
    dealing with multiple 773 fields.
    
    Test plan:
    Run t/db_dependent/Koha/Biblio/host_record.t
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b17567f2b74bb1347195f4df7e694fbd23eb7a0
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 10 10:45:18 2021 -0500

    Bug 27908: Add support for circulation status 1 ( other ) for damaged items
    
    Some libraries would like to transmit if an item is damaged via the
    circulation status field. There is no specific code for a damaged item,
    so we should use value 1 (other) along with an AF screen message to
    describe the reason for the the circulation status of 1.
    
    Test Plan:
    1) Apply these patches
    2) prove t/db_dependent/SIP/Transaction.t
    
    Signed-off-by: Christopher Kellermeyer - Altadena Library District <ckellermeyer@altadenalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e4b1bb5b27b1732d1aa76aff9c51bcc81716b82c
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 10 10:45:15 2021 -0500

    Bug 27908: Add unit test
    
    Signed-off-by: Christopher Kellermeyer - Altadena Library District <ckellermeyer@altadenalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f859b21b7d8e77097832606b4838e59034b26236
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 10 10:33:28 2021 -0500

    Bug 27907: Add support for circulation status 2 ( on order )
    
    In Koha, we represent on order items by giving those items a notforloan
    value less then zero. We can use this to implement circ status 02 ( on
    order ) in for SIP.
    
    Signed-off-by: Christopher Kellermeyer - Altadena Library District <ckellermeyer@altadenalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2e613fa7bc13961dbb18bd3e72ecafe2ebf12fcc
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 10 10:33:23 2021 -0500

    Bug 27907: Add unit test
    
    Signed-off-by: Christopher Kellermeyer - Altadena Library District <ckellermeyer@altadenalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6b1822b3be1dff2bf091a34cd5d4f639f3e424c2
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 10 10:24:16 2021 -0500

    Bug 27906: Add support for circulation status 9 ( waiting to be re-shelved )
    
    In Koha, we can support circ status 09 in SIP by checking if the item's
    location is "CART".
    
    Test Plan:
    1) prove t/db_dependent/SIP/Transaction.t
    
    Signed-off-by: Christopher Kellermeyer - Altadena Library District <ckellermeyer@altadenalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 92500853e4b1ba948e587bbcdd31d2e272fee7af
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Wed Mar 10 10:22:54 2021 -0500

    Bug 27906: Add unit test
    
    Signed-off-by: Christopher Kellermeyer - Altadena Library District <ckellermeyer@altadenalibrary.org>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b5eee9bc7bf085215de6cb3fbba763495e612707
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Tue Mar 30 15:04:24 2021 +0000

    Bug 27883: (follow-up) Make label match input id
    
    This change alters the list of columns under "Preserve existing values,"
    changing the label for each checkbox can be clicked to trigger the
    checkbox change.
    
    To test, apply the patch and refresh the patron import page. Expand the
    "Preserve existing values" section and click any label in the list. The
    corresponding checkbox should be checked.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58b5c1a68f5cdad77868abc2f017e180e768fd33
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri Mar 5 09:13:34 2021 -0500

    Bug 27883: Add ability to preserve patron field from being overwritten by import
    
    Some libraries would like to be able to preserve particular fields for
    existing patrons when overwriting them via the patron import tool.
    Effectively, this means the specified columns of the CSV are used for
    new patrons, but ignored for existing patrons.
    
    Test Plan:
    1) Create a patron CSV with one new patron, make the surname and
       firstname "Test1". Add a cardnumber so we can upload it again later.
    2) Import the file
    3) Change the firstname and surname in the CSV to "Test2"
    4) Return to the patron import tool, choose to match on cardnumber,
       overwrite existing patrons, and preserve exiting firstnames
    5) Import the file with these settings
    6) Referesh the patron details for this patron, the patron's surname
       should still be "Test" while the firstname should now be "Test2"
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a1bee1b210a635e03de8967bf3cda6de15c320f2
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed May 12 10:24:30 2021 +0200

    Bug 26760: Escape URI parameters in redirect URI to paycollect.pl
    
    Also remove useless '%.2f' formatting of amount and amountoutstanding
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3b99ebe032956e41416f2058bfc695f18b28bdc4
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Oct 21 12:58:29 2020 +0200

    Bug 26760: Redirect to paycollect.pl when clicking on "Save and pay"
    
    Bug 14898 added the "Save and pay" button that redirects to "Make a
    payment" tab after creating a manual invoice
    This requires the user to click on another "Pay" button before being
    taken to the real payment form.
    By redirecting directly to paycollect.pl, this useless step will no
    longer be needed.
    
    Signed-off-by: Lisette Scheer <lisetteslatah@gmail.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f146e1bb360c3a914230411d09aba7975c89ec12
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 14:53:38 2021 +0200

    Bug 26340: Code simplification
    
    And rename $range with $barcode_length
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9f6fe663c2f2389917c518dd51b42f861f011c88
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sat Jul 3 22:22:35 2021 +0200

    Bug 26340: (QA follow-up) Remove warns and set input fields hidden again
    
    Removes traces of debugging.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a75bd018831562767eb92181015f4f63fdbe7f8b
Author: Ivan Dziuba <ivan.dziuba@inlibro.com>
Date:   Mon Jun 14 14:41:14 2021 -0400

    Bug 26340: When printing labels from a barcode range, keep zero padding
    
    TEST PLAN:
    
    1. Go  Tools > Label creator
    2. Click +New -> Barcode range
    3. Print barcode range with zero(s) in the start (Ex. from 00011881 to 00012000 )
    4. Select a template to be applied:: Code à barre 48467
    Select a layout to be applied: Code à barres
    5. Export
    6. Open PDF
    
    The prefix is not displayed. We should see 00011881 on the labels, but we see 11881, 11882, ... without zeros in the start of labels.
    This patch fix it.
    
    Signed-off-by: hakam <hakam@inlibro.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e16b93b4fa8922d5d2abb75a517235c6a5cce1e8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 13:45:17 2021 +0000

    Bug 11879: DBRev 21.06.00.007
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fa2d2016ee3b34ef848cf9235c881c3fd81210d3
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 15:40:22 2021 +0200

    Bug 11879: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 60685c55c7f78dd6e0801988f9c1a756ee5825dd
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 15:04:56 2021 +0200

    Bug 11879: Remove primary_contact_method from REST API
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f946d095a15db42bac3e483d81abca31438b2075
Author: Alexis Ripetti <alexis.ripetti@inLibro.com>
Date:   Mon Mar 29 10:03:40 2021 -0400

    Bug 11879: Remove the 'unwanted' preferences from the main contact method pull-down menu in the OPAC
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b23ecb5882872487395ef740f9bae0e074ad3868
Author: Maryse Simard <maryse.simard@inlibro.com>
Date:   Tue Oct 20 11:56:42 2020 -0400

    Bug 11879: (follow up) Some fixes and code cleanup
    
    - Display the value in the patron detail page
    - Adds support for BorrowerUnwantedField (staff)
    - Removes unecessary code in opac/opac-memberentry.pl
    
    Sponsored-by: CCSR ( http://www.ccsr.qc.ca )
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 975c48fb4a9c62376e8f473ca965098e5ec15cd4
Author: Bin Wen <bin.wen@inlibro.com>
Date:   Wed Dec 18 11:52:49 2019 -0500

    Bug 11879: Add a new field to patron record: main contact method
    
    This patch adds the "Main Contact Method" field in the borrower
    modification form.
    
    This field is useful for reporting purposes, or to
    know which contact method to use first when trying to contact a borrower.
    
    Test plan:
    0) Apply patch
    1) updatedatabase.pl
    2) In the staff client, edit a patron's contact info. There should be a new dropdown select to choose the main contact method
    3) In the opac page, edit the personal details.There should be a new dropdown select to choose the main contact method.
    4) Save the form. It should work.
    
    Sponsored-by: CCSR ( http://www.ccsr.qc.ca )
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58946fc43243454cc12a0b1d6938a785bb094b9d
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jul 12 07:47:34 2021 +0000

    Bug 27948: (QA follow-up) Remove NewsChannels reference
    
    We only need to remove the obsolete module here.
    Note that the two NewsToDisplay calls were removed already.
    Replaced by a KohaNews.get call.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 187fd73e1385875666aa8a32ac6cc5672083087f
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 2 07:02:22 2021 +0000

    Bug 27948: (QA follow-up) Correct empty branchcode
    
    Let us just fix it here and leave the rest to bug 28650.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b518d2535d5dd9bb1e8f9fe8949c55c1b723174
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jul 2 06:19:14 2021 +0000

    Bug 27948: (QA follow-up) Remove unused $disclaimer code
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b7acefa116c9ae1e738b5c53f30cf0d6c11d8784
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Thu Jul 1 21:00:31 2021 -0300

    Bug 27948: (follow-up) Use Koha.news and PROCESS koha_news_block to bring disclaimer
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ff5863d8b1d0129d8f8b1b0b2177de1c03d95b1
Author: Agustín Moyano <agustinmoyano@theke.io>
Date:   Wed May 26 16:00:32 2021 -0300

    Bug 27948: Add disclaimer to article request
    
    If ArticleRequestsDisclaimerText news is set, a disclaimer text will appear before an article request can be made
    
    To test:
    1. apply patches
    2. enable ArticleRequest syspref
    3. in OPAC place an article request for a patron
    CHECK => No disclaimer text should appear before placing article request
    4. add a text in ArticleRequestsDisclaimerText news
    5. repeat step 3
    SUCCESS => A disclaimer text is shown before you can place an article request
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d9ef08365fc0742b5b11b2220b60d812317ec13d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jul 12 13:45:17 2021 +0000

    Bug 14237: DBRev 21.06.00.006
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46f25273887948f0170c48fe405758d1d86376f0
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 11 19:17:27 2021 +0000

    Bug 14237: (follow-up) Make the routines exclusively take itemnumber, biblionumber, or ci_id
    
    This patch changes the parameters for several of the CourseReserves routines to take a single
    identifier exclusively.
    
    Following the existing pattern we simply return if the params are incorrect
    
    This patch also:
    removes an unused 'title' variable
    adds a prefetch to save some db calls where we fetch related objects
    adjusts tests
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b9d11020aeb32dfa7368bbab9acd2f04557b6e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 09:22:50 2021 +0200

    Bug 14237: Set course_items.biblionumber in the DBrev
    
    We need to create the new column without the NOT NULL clause, set the
    correct values, then add the NOT NULL clause.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 961f477ee2606c4cbc0b3ef1659f80c00c2cf9eb
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Mon Mar 15 09:15:32 2021 +1300

    Bug 14237: Tests
    
    Confirm all tests pass: t/db_dependent/CourseReserves/CourseItems.t
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 54ed23f1861c0a6656d6c9d825b3fd1cc8426a9d
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Feb 3 10:04:30 2021 +1300

    Bug 14237: Schema updates
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 84a203ca0584278d9851c5a47dd4cb7964914cea
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Feb 3 10:01:15 2021 +1300

    Bug 14237: Database updates
    
    This patch adds a biblionumber column to course_items, adds a
    relationship between course_items.biblionumber and biblio.biblionumber,
    and changes course_items.itemnumber to allow null values.
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 580c390bda0e694d901e892b579bef442d660b5e
Author: Aleisha Amohia <aleisha@catalystacademy.net.nz>
Date:   Wed Feb 3 13:03:31 2021 +1300

    Bug 14237: Add individual bibliographic records to course reserves
    
    This feature allows a patron to add bibliographic records to course
    reserves. They can be added individually or in a batch. The courses that
    have reserved this record will also show on the record's detail page.
    
    To test:
    1) Update database, refresh schema, and restart services
    2) Enable the system preference UseCourseReserves
    3) Set up a couple of biblios and a couple of items (attached to
        different biblios)
    4) Go to Course Reserves and add a new course
    5) Click Add reserves and put something in both the barcode field and
    biblionumber field. Click submit and confirm you get an error.
    6) Add a barcode in the barcode field and submit. Confirm the item is
    reserved for the course as expected.
    7) Add a biblionumber in the barcode field and submit. Add notes and
    Save. Confirm the record is reserved for the course as expected and the
    notes are saved correctly.
    8) Edit the record-level course reserve that you just added. Confirm the
    correct record shows and any edits save as expected.
    9) Go back to the course and try removing reserves. Use both the Remove
    action button for individual reserves and the Remove all reserves
    button. Confirm both work as expected.
    10) Go to Batch add reserves and put something in both the barcodes
    field and biblionumbers field. Click submit and confirm you get an
    error.
    11) Remove the barcodes and put some biblionumbers in the biblionumbers
    field. Add notes and Submit. Confirm the records are all added as
    expected.
    12) Click on one of the biblios that has been reserved for the course.
    Confirm that the course shows under 'Courses that have reserved this
    title' on the biblio detail page.
    13) Go back to the course and click Add reserves. Try and add a
    biblionumber that is already reserved. Confirm it detects that the
    biblio has already been reserved.
    
    Sponsored-by: Bibliotheksservice-Zentrum Baden-Württemberg (BSZ)
    
    Signed-off-by: Christian Stelzenmüller <christian.stelzenmueller@bsz-bw.de>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a8736a1a982ff139090d02cde9c045a0d4c8839e
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jul 1 14:13:05 2021 +0000

    Bug 28644: Fix calling borrowernumber on undefined value
    
    If the hold is not found (e.g. already cancelled), we should
    return earlier without crashing:
        Can't call method "borrowernumber" on an undefined value at /usr/share/koha/C4/Reserves.pm line 521
        (Note: line number from 19.11)
    
    Test plan:
    Run t/db_dependent/Reserves.t
    Add a hold, go to user menu with holds in OPAC.
    At the same time, cancel this hold from staff.
    Now click the Cancel in OPAC.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b8ab792dc439d84efdba84d58da4eec6b23adf9e
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 22 16:41:55 2021 -0300

    Bug 28483: Remove warnings from Search.t
    
    There are too many warnings about uninitialized variables in Search.pm.
    This patch deals with that, the same way it is dealt accross the file:
    by setting an empty string when things are not defined.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/Search.t
    => FAIL: Wow, too many warnings. Some related to this bug, some not.
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: No more warnings!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0a8f7b3645ba38af21ec3fbd1acbcce8a07d6707
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Wed Jul 7 12:38:48 2021 +0000

    Bug 28673: Add missing ampersand to amp; construction
    
    Super trivial one character fix ;)
    
    Test plan:
    Open Your Lists from the button on main page.
    Click again on Your lists under Lists in the middle of the form.
    Verify that the URL does no longer show something like:
        op=listamp;category=1
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f062b6e7c710e60da13875fbae08a6ec2cfbce7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 12:36:00 2021 +0200

    Bug 28561: Remove DBIC warning in opac-shelves
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39d6b5fe021607bb84207167070823782fb6ffc3
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jun 14 12:51:13 2021 +0000

    Bug 28561: Fix noisy warning about $direction too
    
    Use of uninitialized value $direction in string ne at /usr/share/koha/opac/opac-shelves.pl line 265.
    
    Bonus:
    Use of uninitialized value $sortfield in string eq at /usr/share/koha/opac/opac-shelves.pl line 264.
    
    Test plan:
    While testing patch 1, check the logs for these warnings with and
    without this patch.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fe2ba2fb8573825df043c650b89f26d5167f761c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 24 15:11:18 2021 +0200

    Bug 28399: Remove txn error from batchRebuildItemsTables.pl
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4b4db21d2586fd95de942d38913d5142f694563
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 11:59:51 2021 +0100

    Bug 22544: Restore newdate and timestamp for slip notices
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] Fixed typo pubished_on
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f99d55ac48a9386d52b25515c0f944bd8272283
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 11:50:39 2021 +0100

    Bug 22544: Fix OpacLoginInstructions
    
    Moved recently
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76d53f6787532dcb1da4109f624de09e7a3335e5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Feb 17 11:48:36 2021 +0100

    Bug 22544: TT plugin should return hashref only if news exist
    
    It restore the header and fix the RSS feeds (see comment 103)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52ff082aa0fa78a72cbf73097906f4498f013f76
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Jan 19 08:42:02 2021 +0000

    Bug 22544: Use template plugin for news author display
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4838615d084be7875c05a66fab4b6662bf314588
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Jan 18 12:41:31 2021 +0000

    Bug 22544: Add default language value to KohaNews template plugin
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8e0c80de9744e0b56b9da3749bbb8f5b7f30751a
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Jan 18 11:49:51 2021 +0000

    Bug 22544: Enhance exception description
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 98392c82eeee72670db41416d639d0b7061edbad
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Jan 18 10:33:21 2021 +0100

    Bug 22544: Clarify documentation and change param 'type' to 'location'
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ec6d2900b4ad5c187a452281c6625e18f1ca3963
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Oct 1 05:39:19 2020 +0000

    Bug 22544: Fix filtering by location on tools -> news management
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c4985dd2ee530f74ec044bc3557a8af9d211917a
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Thu Oct 1 05:03:52 2020 +0000

    Bug 22544: Update search_for_display to be able to take more types
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 15573ab950690d133bc5fa6d3624648caff1d08d
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Sep 30 18:58:01 2020 +0000

    Bug 22544: Update to current codebase
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ac70d7cfae28af57eed1be279afeb51ebca7c6b5
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Mon Mar 2 07:04:54 2020 +0000

    Bug 22544: (QA follow-up) Fix spelling
    
    Signed-off-by: Josef Moravec <josef.moravec@gmail.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6eaae7e626236d47921ece99d68b16ef4229b419
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Mar 20 11:07:22 2019 +0000

    Bug 22544: Refactor searching of news items
    
    Test plan:
    1) Go to tools and define some news
    2) Try different parameters, try to edit new items, and delete some
    3) Go to all places where news are presented and ensure that there are
    the right ones shown:
        opac main page - based on language
        opac righ column (formerly syspref OpacNavRight) - based on language
        opac news rss feed
        circulation slip (not quick slip)
        intranet main page
    4) run tests:
    prove t/db_dependent/Koha/News.t
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e7d21b6b623be3ad4cceaaefd0ef28c68c06278b
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Mar 20 10:20:29 2019 +0000

    Bug 22544: Add tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9ca8d08a51f823a55998dd8c36f4bf2aae7b71aa
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Wed Mar 20 07:36:53 2019 +0000

    Bug 22544: Move GetNewsToDisplay to Koha namespace
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 22544: fix count call - to squash
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 05798ec1aaf38546da6153e435de02c2db14d6c9
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Mar 19 10:35:23 2019 +0000

    Bug 22544: Move add_opac_item to Koha namespace
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d5a7199208193ded7ea4edcdabee7a186cc98e1
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Mar 19 10:30:27 2019 +0000

    Bug 22544: Move upd_opac_new to Koha namespace
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5866c88d840709bdae2b6ef7e573b6fa2890141d
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Mar 19 10:23:40 2019 +0000

    Bug 22544: Move del_opac_new to Koha namespace
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ae0c08c936126f63e048b63257e587abe783a171
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Mar 19 10:17:31 2019 +0000

    Bug 22544: Move get_opac_news to Koha namespace
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb606ddfcf2ce383cc7a70d1d28071ad16fed6cc
Author: Josef Moravec <josef.moravec@gmail.com>
Date:   Tue Mar 19 09:14:47 2019 +0000

    Bug 22544: Move get_opac_new to Koha namespace
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 85594dbbfcc9866ceadc45c45f5c3552540bb7c8
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 18 13:09:29 2021 +0000

    Bug 28597: Fetch the logged in branchcode for OpacSuggestioninstructions
    
    To test:
     1 - Set two news items with location 'OpacSuggestioninstructions'
     2 - One should be for all libraries
     3 - One should be for a specific library
     4 - Sign in to opac with user from the specific library
     5 - Add a suggestion
     6 - The instructions only show the all libraries item
     7 - Apply patch
     8 - Reload
     9 - All libraries and specific library items are shown
    10 - Allow anonymous suggestions:  AnonSuggestions - Allow
    11 - Sign out of opac
    12 - Add a suggestion
    13 - Only all librares news is visible
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 83c3c7d57d12e44741c2e9bbb787ec61876e0327
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Thu Jun 3 21:11:56 2021 +0000

    Bug 28455: Update wording on TrackLastPatronActivity
    
    This patch updates the wording on TrackLackPatronActivity to maintain the corrections from bug 28467 and also reflect the change made in this bug. It should now read: The first time each day that a patron either logs into the OPAC, connects to Koha via SIP, or checks an item out, borrowers.lastseen will update with the current date and time.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3a2a0eef1043f0e3432531026dae216fa087d674
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Tue May 25 18:20:25 2021 +0000

    Bug 28455: lastseen should be updated at checkout if TrackLastPatronActivity is enabled
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e6c04ff745a066b33b0b38d5fee46267cb0b76a5
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 11:46:55 2021 +0200

    Bug 28611: Fix width to 50% for additem form elements
    
    This patch suggests to set the width of select and input to 50%
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a882783326c2f7f731f388703fab9cc9fee1b345
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 10 10:01:02 2021 +0200

    Bug 28299: Make buildKohaItemsNamespace accept Koha::Items
    
    This patch makes buildKohaItemsNamespace (and its only caller,
    XSLTParse4Display) accept a an optional Koha::Items resultset.
    
    This way we don't need to calculate (from the DB) the list of hidden
    itemnumbers, but solve it in one query.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4d8ff723d53abe8c95e18d5034d4c727b0dbfb3e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 7 11:16:17 2021 +0200

    Bug 28299: Take OpacHiddenItems into account on opac-shelves
    
    hidden_items was not passed to XSLTParse4Display
    
    2 things:
    * Should we hide the biblio record if OpacHiddenItemsHidesRecord is set?
    * allow_onshelf_holds is not working like in other scripts, what's the
    expected behaviour? If hidden should we completely ignore the item?
    
    Test plan:
    1. Without the patch
    2. fill OpacHiddenItems with «damaged: [1]»
    3. find a record with several item
    4. mark one of them as damaged
    5. OPAC: go to the record, you shouldn't see the damaged item
    6. add the record to a list
    7. see the list
    8. in Availability you see the damaged item mentioned, this is the issue
    9. apply the patches and restart the services
    10. the list should not mention the damaged item :D
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eb157ae2d2ee642541255870dff418c668bf85d8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon May 10 11:17:57 2021 -0300

    Bug 28299: Unit tests for buildKohaItemsNamespace
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 46340efc933d408275ddc7f8de127a72d1477e4e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 23 09:50:55 2021 +0200

    Bug 28462: Remove line breaks in TT tags
    
    Same as previous patch for other files.
    Looks like the problem exists only with IF.
    
    == test plan ==
    1. See the problematic strings in a given language
         git grep "\bIF\b" misc/translator/po | grep -v '#' | grep '\bzh-Hant-TW'
    2. update the language
       misc/translator/translate update zh-Hant-TW
    3. Recheck the problematic strings, they aren't here anymore
    4. Check the diff: git diff
       and search the if's with «/-.* IF » to see how the deleted strings
       look like and that it makes sense.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f2964c2ec042f8f872e428046de2ce551d3ce3c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed May 26 16:24:32 2021 +0200

    Bug 28462: Remove TT tag on several lines - opac-advsearch.tt
    
    It fixes the translation in case the operators have been translated
    
    Test plan:
    1. misc/translator/translate update pt-BR
    2. In pt-BR-opac-bootstrap.po , find OpacAdvSearchMoreOptions
    3. sabotage the translation part, like replacing IF with something else
    4. misc/translator/translate install pt-BR
    5. enable and use pt-BR and hit opac-advsearch.pl
    6. Notice the error
       Template process failed: file error - parse error - /kohadevbox/koha/koha-tmpl/opac-tmpl/bootstrap/pt-BR/modules/opac-advsearch.tt line 409: unexpected token (e)                                                    [% IF (OpacAdvSearchMoreOptions and OpacAdvSearchMoreOptions.size> 0 e extended_options) ou (OpacAdvSearchOptions and OpacAdvSearchOptions.size> 0 e n expandido_options) %] at /kohadevbox/koha/C4/Templates.pm
    7. Apply the patch and redo update and install of the language
    8. Note that it's now working
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5faddae26f7dd2c877161652f396414f56337421
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 16 14:51:08 2021 +0200

    Bug 28524: Escape 'rank' in cat_issues_top.pl
    
    It's a MySQL 8 keyword
    
    Test plan:
    Turn off strict_sql_modes (there are other problems in this script)
    Hit Home Reports > Most-circulated items
    Submit the form
    
    Without this patch you got:
      You have an error in your SQL syntax; check the manual that
      corresponds to your MySQL server version for the right syntax to use
      near 'RANK, biblio.biblionumber AS ID, itemcallnumber as CALLNUM,
      ccode as CCODE, loca' at line 1
    
    With this patch applied you see the report result view
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d795fcf5f72e105667eb21e671fb1a63db8383b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 16 14:54:47 2021 +0200

    Bug 28523: Escape 'rank' in bor_issues_top.pl
    
    It's a MySQL 8 keyword
    
    Test plan:
    Turn off strict_sql_modes (there are other problems in this script)
    Hit Home Reports > Patrons with the most checkouts
    Submit the form
    
    Without this patch you got:
        You have an error in your SQL syntax; check the manual that
        corresponds to your MySQL server version for the right syntax to
        use near 'RANK, borrowers.borrowernumber AS ID FROM `old_issues`
    
    With this patch applied you see the report result view
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit dca25b9dcea4823a7fb7bb9a1f4ca83aa09c9fc1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 24 09:55:23 2021 +0200

    Bug 28409: Adjust regression test
    
    We are no longer expecting an URI escaped value but a corrected category
    value, either 1 or 2.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 69c3fc9729d189ede9f14ec4005e989947404ec1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 21 09:09:53 2021 +0200

    Bug 28409: Simplify data validation
    
    Simplify the affectation then trust it.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    JD Amended patch: remove duplicate comma
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e99f7ad63f45f85e6e7d2f3080a960379e3e6f79
Author: David Cook <dcook@prosentient.com.au>
Date:   Fri May 21 06:52:25 2021 +0000

    Bug 28409: Comprehensively validate category in opac-shelves.pl
    
    Default to a category of 1 (ie Private). Only allow input of 1
    or 2 (ie Public)
    
    == Test plan ==
    1. Go to http://localhost:8080/cgi-bin/koha/opac-shelves.pl?category=function(){window.location.href%20=%20%27https://git.koha-community.org/stats/koha-master/authors.html%27}()
    2. Note that you are redirected to another website
    3. Go to http://localhost:8080/cgi-bin/koha/opac-shelves.pl?op=add&shelfname=foo&category=9
    4. Note that you can't see this list in the Lists (but it has been added to the database)
    5. Apply the patch & restart services
    6. Go to http://localhost:8080/cgi-bin/koha/opac-shelves.pl?category=function(){window.location.href%20=%20%27https://git.koha-community.org/stats/koha-master/authors.html%27}()
    7. Note that you are not redirected to another website
    8. Go to http://localhost:8080/cgi-bin/koha/opac-shelves.pl?op=add&shelfname=bar&category=9
    9. Note that "bar" has been added as a Private list
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d5a792ddf5970205b38cf20231f1a249318730f3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 29 12:24:52 2021 -0300

    Bug 28615: (follow-up) Disable strict mode explicitly
    
    So Debian 9's version of Test::MockModule doens't have ->redefine, and
    Ubuntu 20.04's doesn't recognise qw(nostrict). So the only solution is
    to just remove the keywords use completely and move back to using
    ->mock, as the rest of the codebase.
    
    FIXME: using ->mock might be hiding some errors (like a method not being
    defined/removed) and should be avoided. ->redefine will explode if the
    method doesn't already exist, which is what we want, to catch this kind
    of errors. That's why ->mock in strict mode is forbidden. We should try
    packaging a newer Test::MockModule ourselves.
    
    Tested on master-buster, master-stretch and master-focal.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit ec382b926ce238f4d19675ae12fd41016cca8584
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 29 11:18:12 2021 -0300

    Bug 28615: (follow-up) Newer Test::MockModule forbid ->mock
    
    In strict mode, ->mock is forbidden and ->redefine needs to be used
    instead. I tested this on buster to see if it breaks something, but it
    doesn't.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 34139e3e19965a372e69dfa10c52372991be8e96
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jun 28 15:28:49 2021 -0300

    Bug 28615: Fix t/Auth_with_shibboleth.t
    
    This patch makes t/Auth_with_shibboleth.t use the new
    t::lib::Mocks::Logger tools
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit 5754411d66dffe9563b5ee17527dc70e3a65d419
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jun 28 15:22:33 2021 -0300

    Bug 28615: Add a simple way to mock Koha::Logger
    
    This patch introduces a new way to mock and test Koha::Logger.
    
    As the POD says, it is used by calling
    
        my $logger = t::lib::Mocks::Logger->new();
    
    It then provides convenient methods for testing the logging itself per
    log-level:
    
    * warn_is
    * warn_like
    * debug_is
    * debug_like
    ...
    
    Methods for counting the logging activity and also for clearing the mock
    buffer are provided as well. This is covered in the POD and also on the
    follow-up, that makes use of this to fix Auth_with_shibboleth.t
    
    To test:
    
    1. Run:
       $ kshell
      k$ prove t/Auth_with_shibboleth.t
    => FAIL: Tests fail! It expects some warns but they are not returned by
    the lib
    2. Apply this patches
    3. Repeat 1
    => SUCCESS: Tests pass! The tests now use the new lib, and they
    correctly find the logging Auth_with_shibboleth.pm does on function
    calls.
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>

commit ce5d409cfd69bdfd45e1c116f9d8f13ed4696f85
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 16 15:28:01 2021 +0200

    Bug 28571: Remove C4::Auth::_session_log
    
    It's not used and must be removed
    
    Test plan:
      % git grep _session_log
    must not return any result.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 41a8005d1013815d312089c00e9e5464768e1332
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 12:54:15 2021 +0200

    Bug 28606: Remove $DEBUG and $ENV{DEBUG}
    
    We should remove the debug statements or use Koha::Logger when we want
    to keep it.
    
    Test plan:
    Confirm that occurrences of remaining occurrences of DEBUG need to be
    kept (historical scripts for instance)
    Confirm that the occurrences removed by this patch can be removed
    Confirm that the occurrences replaced by Koha::Logger are correct
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Looks good to me, noting a few minor points on BZ.
    
    JD amended patch: replace "warn #Finished" with "#warn Finished", and
    put the statement on a single line
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit feb09b1cc28e530fba86cfe2b53e8d0bde1f9d5b
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 18 15:45:42 2021 +0000

    Bug 28601: Fix 'Home' breadcrumd on circulation-home.pl
    
    To test:
    1 - Got to 'Circulation'
    2 - Click 'Home' in breadcrumbs
    3 - You are still in circulation home
    4 - Apply patch
    5 - reload page
    6 - Click 'Home'
    7 - Success!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b033366beabb0e59d3c278e8599ba00661ed8be9
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 18 15:20:30 2021 -0300

    Bug 28600: (bug 18989 follow-up) Resolve variable scope issue
    
    This patch fixes a scope issue. Originally, a variable declared as
    
    our $borcat
    
    was replaced by
    
    my $patron
    
    This patch makes the method not rely on global variables, but have a
    parameter for the patron, and thus things are clearer.
    
    To test:
    1. Open the OPAC detail page for a record
    => FAIL: The logs show some errors about the $patron variable not
    available in the scope
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: No errors
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 883ee12560f11fc2fbf35c72bbf63520ce0e4762
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 18 16:34:00 2021 -0300

    Bug 28588: (follow-up) Make the API use the new method
    
    This patch adapts the controller method for resolving a return claim so
    it uses the Koha::Checkouts::ReturnClaim method instead.
    
    To test:
    1. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/return_claims.t
    => SUCCESS: Tests pass!
    2. Apply this patch
    3. Repeat 1
    => SUCCESS: Tests pass!
    4. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 9964bd4b58bd114e052d5448a5a2fe4c1dfcf3d3
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 18 16:15:15 2021 -0300

    Bug 28588: Add Koha::Checkouts::ReturnClaim->resolve
    
    This patch introduces a high-level method for resolving claims.
    The behavior intends to replace the code in the API controller that is
    used for resolving a claim.
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/Koha/Checkouts/ReturnClaim.t
    => SUCCESS: Tests pass
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 471fb27313751d9246a90a3e2fae4782a4973ba1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 18 16:14:43 2021 -0300

    Bug 28588: Unit tests
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a908117dcfb5e16f51c8b343983b663f406d1cc
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 18 18:32:37 2021 -0300

    Bug 28604: Prevent double encoding of MARC::Record::MiJ->to_mij output
    
    This patch fixes a double-encoding issue with MiJ output.
    
    Mojolicious' *text* renderer encodes the passed information according to
    the request context. [1]
    
    MARC::Record::MiJ->to_mij, conveniently encodes the string before
    output [2].
    
    This causes double encoding.
    
    So the solution to this situation, is to use the *data* renderer, which
    doesn't perform any encoding [3].
    
    To test:
    1. Apply the regression tests patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/biblios.t
    => FAIL: Tests contain diacritics and fail!
    3. Have a record with diacritics
    4. Try the API routes for fetching a biblio:
       $ curl --location --request GET 'http://localhost:8080/api/v1/public/biblios/144' \
              --header 'Accept: application/marc-in-json'
       (replace the record id with the one you've chosen)
    => FAIL: Boo, double encoding
    5. Bonus point: you can try it on the non-public route, but you need
       more configuration boilerplate (basic auth, permissions). If you look
       at the fix, you will understand the tests cover it and no need to
       complicate yourself.
    6. Apply this patch
    7. Repeat 2
    => SUCCESS: Tests pass!
    8. Repeat 4 (and maybe 5)
    => SUCCESS: No double encoding! Yay!
    9. Sign off :-D
    
    [1] https://metacpan.org/release/MRAMBERG/Convos-0.5/view/local/lib/perl5/Mojolicious/Guides/Rendering.pod#Rendering-text
    [2] https://metacpan.org/dist/MARC-File-MiJ/source/lib/MARC/Record/MiJ.pm#L111
    [3] https://metacpan.org/release/MRAMBERG/Convos-0.5/view/local/lib/perl5/Mojolicious/Guides/Rendering.pod#Rendering-data
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f9bf5304958e1f6cc8b1df09d1b9bcb3333141a1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri Jun 18 18:30:56 2021 -0300

    Bug 28604: Regression tests
    
    This patch introduces regression tests for the encoding issue with MiJ
    output.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba738eac1c42c0e90c5fa2febab6fb0c5933a2fb
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 11 18:02:11 2021 +0000

    Bug 28480: (QA follow-up) Add unit test
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0efdb1bb7a364db487b5bc7c692dc728d7b927fe
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Fri May 28 08:34:29 2021 -0300

    Bug 28480: Add q parameters for GET /patrons
    
    This patch adds the q query parameters to the route.
    
    To test:
    1. Try the route with the following query parameter:
       q={"patron_id":2}
       i.e. GET /api/v1/patrons?q={"patron_id":2}
    => FAIL: You get a bad request respose
    2. Apply this patch
    3. Restart all
    4. Repeat 1
    => SUCCESS: You get the patron
    5. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e188b5c89968af20c3adc543ea098995d42f5e2b
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Mon Jun 21 08:47:59 2021 +0000

    Bug 28581: (QA follow-up) Fix method on unblessed reference
    
    Speaks for itself.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0636e1a8f006fec71e2333463a18cdea9fcdce9c
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 17 14:47:07 2021 +0100

    Bug 28581: Enhance POD for EnqueueLetter
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c7794f1b250abf5fc8c82fa30e4f2c97df38727
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 17 14:30:59 2021 +0100

    Bug 28581: Use 'from_email_address' where appropriate
    
    This patch replaces a few more trivial cases where we were using
    library->branchemail with a fallback to KohaAdminEmail to just use the
    new library->from_email_address method directly instead.
    
    There were also a couple of cases where we were passing borrowernumber
    and the patrons library from address too.. this is unneccesary as the
    code in _send_email_massage will already default to patron library from
    address if we do not pass an override.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Added a semicolon.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7c6575e86a87b40c9a82d17ea928ffea066cefc7
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 17 14:12:23 2021 +0100

    Bug 28581: (QA follow-up) Prevent code failure
    
    This patch prevents a fatal error when both $params->{from} and
    $params->{borrowernumber} are undefined. We fallback to
    KohaAdminEmailAddress before finally falling through to setting a
    failure status for the message if that last fallback is not found.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fdf75e4cb0a0a7b2f2ed8694980f68d4fdc5b922
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 17 09:59:18 2021 +0000

    Bug 28581: Use from_email_address in the codebase
    
    Adding only a few (trivial) cases now. Changes in C4::Letters
    are not trivial after all..
    We now add the KohaAdminEmail fallback implicitly when the from
    address was still empty. The extra check makes us not rely on
    a do or die action in Email::Stuffer.
    
    Test plan:
    Run password recovery or membership expiry cron.
    Check sender address.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a7c202de1c97438a32b86a309a449e7c427f77d3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu Jun 17 09:54:46 2021 +0100

    Bug 28581: Add 'from_email_address' method and use in Koha::Patron
    
    This patch adds a new 'from_email_address' method to Koha::Library to
    return the appropriate email address to use as the 'from' field for
    email notices from the library.
    
    We then update Koha::Patron->queue_notice to use this new method instead
    of the incorrect inbound_email_address.
    
    I also update the POD for inbound_email_address to clarify it's use
    case.
    
    Test plan
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7293802becd3741a1f042f233ff614792c9e480f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 23 13:08:36 2021 +0000

    Bug 26205: DBRev 21.06.00.005
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d895f4a207b28465f3e78ec0fcc4d6b3c1e9eb6a
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Jun 1 08:16:52 2021 +0000

    Bug 26205: (QA follow-up) Add punctuation and widen pref description a bit
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8c3862d557b927cab4be1f84b7229bdd38530fcd
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Jun 1 08:15:49 2021 +0000

    Bug 26205: (QA follow-up) Change OPACNEWS to just NEWS
    
    As news are usable in OPAC and staff interface, I suggest changing the code
    to just be NEWS instead of OPACNEWS.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5ee18e058efef0857867bc49a0350bd54a3b302e
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Jun 1 08:13:11 2021 +0000

    Bug 26205: (QA follow-up) Capitalization: OPAC News
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52fcc6b904c260a4e4e00b063aa2deaf55ab9a71
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Wed May 12 18:20:16 2021 +0000

    Bug 26205: Add logging of news items
    
    To test:
    
    1. Apply patch, updatedatabase, restart_all
    2. Make sure the system pref 'NewsLog' is turned on.
    3. Go to the Koha News tool and create a new news item.
    4. View the logs and display only the OPAC News module
    5. You should see your new news, it will include the lang (
       OPACheader_en ) and the content of the news item.
    6. Filter the logs so the only action is 'Add', your new news item
       should appear
    7. Modify some news items
    8. They should appear in the logs now as modification.
    9. Make sure you can filter the action to 'Modify' and can confirm it
       works
    10. Delete some news items
    11. They should appear in the logs now as deletinon
    12. Make sure you can filter the action to 'Delete' and can confirm it
        works
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fbecb78ca9a9ae19b465b36d1398dd3ca09b840b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 4 15:36:59 2021 +0200

    Bug 28516: Prevent failures if borrower_attribute_types.mandatory=1
    
    TestBuilder will generate an integer for the
    Koha::Patron::Attribute::Type object, but if 1 is picked some tests are
    failing randomly
    At least t/db_dependent/Koha/Patrons.t and t/db_dependent/Koha/Patrons/Import.t
    The expection "Missing mandatory extended attribute" is raised when the
    patron is stored.
    
    Test plan:
    The following script should return 0 when the patch is applied:
    
    """
    use t::lib::TestBuilder;
    my $builder = t::lib::TestBuilder->new;
    my $x = $builder->build_object(
        {
            class => 'Koha::Patron::Attribute::Types',
        }
    );
    say $x->mandatory;
    """
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 2678d6a4bc480e166d5b1c9e9bc1f1f45ddf6197
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 23 09:40:36 2021 +0200

    Bug 28616: (bug 28220 follow-up) Replace Data::Printer with simple warn
    
    $_ is an exception that will be stringify in scalar context. We don't
    need Data::Printer here.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c2fb056d7dc3e7add53418ff1efaa04ad852771d
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 22 16:14:16 2021 -0300

    Bug 28572: Set missing __LOG_DIR__ variable in zebra_config.pl
    
    This patch makes zebra_config.pl create a temporary directory for logs
    and sets it in ENV so, when called, rewrite-config.PL sets it correctly.
    
    It also adds the new syspref Reference_NFL_Statuses to the big mock to
    silence many warnings introduced by bug 21260.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3d1a92b6e1cc8be181b25ad5ac6b75786031fac0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 16:57:50 2021 +0200

    Bug 28572: Fix Search.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 438cfbe1fc39e6a3f12af2d9eb64c08410105480
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 16:57:29 2021 +0200

    Bug 28572: Fix misc/admin/koha-preferences
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6a6c04b35195f65d614c0deb134a89529750ce39
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Fri Jun 18 13:15:34 2021 +0000

    Bug 28598: Update DateFormat and TimeFormat descriptions to remove warnings
    
    To test, confirm that the warnings are present without the patch and gone with it.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3fe837bc74d110b9b3f378ee0565464d8529e827
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 11:25:16 2021 +0200

    Bug 28572: Remove C4::Debug
    
    We are using Koha::Logger when it makes sense to keep the info,
    otherwise we simply remove it
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Bug 28572: Replace missing occurrence in misc/admin/koha-preferences
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6f204fdf96f16340da184aa27142a391871dcc37
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 11:34:54 2021 +0200

    Bug 28591: Don't pass debug to get_template_and_user
    
    There is a "debug" parameter we are passing from the controller scripts
    to C4::Auth::get_template_and_user, but it's not actually used!
    
    Test plan:
    Confirm the assumption
    Review the changes from this patch
    
    Generated with:
    perl -p -i -e 's#\s*debug\s*=\>\s*(0|1),?\s*##gms' **/*.pl
    
    git checkout misc/devel/update_dbix_class_files.pl # Wrong catch
    + Manual fix in acqui/neworderempty.pl
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 512c7ba7e49cff9909aa6c864ccf1736e30db040
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 18 10:27:01 2021 +0200

    Bug 28590: Remove get_shelves_userenv and set_shelves_userenv
    
    They are no longer used since bug 7310, now we are using
    Koha::Virtualshelves->get_some_shelves
    
    Test plan:
    Create some lists, login at the OPAC and confirm that you see
    the list in the navbar (top)
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 70a0c391540ee966e8fc8d5b98c1d97520dc7fa8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 16 15:24:31 2021 +0200

    Bug 28570: Remove log to /tmp file from bor_issues_top.pl
    
    This is unusual and must not be done.
    Removing it.
    
    Test plan:
    Use the "Home > Reports > Patrons with the most checkouts" report and
    confirm that it is working correctly after you applied this patch
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 705655aff4a13f8efd84a6aeb1173c61d23d1a99
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 22 11:57:00 2021 +0200

    Bug 28514: Set lang to default is not passed
    
    It fixes the following test:
        #   Failed test 'no lang passed, default is returned'
        #   at t/db_dependent/Koha/Notices.t line 105.
        #          got: 'es-ES'
        #     expected: 'default'
        # Looks like you failed 1 test of 7.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d3ab8dbeec188ad21c468d82ba8692e89df77a59
Author: Wainui Witika-Park <wainuiwitikapark@catalyst.net.nz>
Date:   Sun May 2 09:52:18 2021 +0000

    Bug 28242: added captions to tables and legends to forms
    
    Ensured that in the OPAC, all tables have relevant captions and all forms have relevant legends.
    
    Many of these have class="sr-only" so they are not visible but will be
    available for people who use screen-readers.
    
    To test:
    1) Go to OPAC
    2) Apply patch and dependencies
    3) Check that on all pages, any tables have a caption (many of them will
        not be visible, but will be in the markup code)
    4) Check that on all pages, any forms have a legend (many of them will
        not be visible, but will be in the markup code)
    5) Check that the captions are appropriate and relevant
    6) Check that the legends are appropriate and relevant
    
    Sponsored-by: Catalyst IT
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 140d461115a4f40ec7f0f5f564f4c6d34f426e53
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Mon Jun 14 19:24:42 2021 +0000

    Bug 28563: (QA follow-up) Fix unit test
    
    Add the new preference to the UsageStats.t
    
    To test:
    - Run t/db_dependent/UsageStats.t
    - Watch it pass :)
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a2abd3c305ec65b7a9c101a320800fd44a100609
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jun 14 12:26:20 2021 -0300

    Bug 28563: Add AllowHoldItemTypeSelection to HEA
    
    This patch adds the mentioned syspref to the sysprefs list, shared for
    statistical purposes.
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbedf182d35b293e5465f64083b17f94450d5922
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Jun 9 10:59:31 2021 +0000

    Bug 28508: Use "Invoice number" instead of "Invoice no" on the invoice search filter
    
    This patch corrects instances of the abbreviated phrase "Invoice no."
    from the templates, making it "Invoice number." Also corrected: An
    instance of "Bookseller" is replaced with "Vendor."
    
    To test, apply the patch and confirm that the phrase is correct in these
    cases:
    
    - Acquisitions -> Invoices: Check the "Search filters" form in the
      left-hand sidebar.
      -> View an invoice: Check the label in the form.
    - Acquisitions -> Vendor -> Receive shipments: Check the table of
      invoices.
    - Acquisitions -> Orders search (in the search header) -> Advanced
      search: Check the labels in the form.
    
    Signed-off-by: Salman Ali <salman.ali@inLibro.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Note: I fixed Salman's SO line
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c5c33163add980f52ff2aa242d1b714fad1442d0
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 21 18:10:14 2021 +0000

    Bug 28418: Show template_id of MARC modification templates
    
    This patch adds an "id" column to the table of MARC modification
    templates. The table is now a DataTable with table settings, with the
    new column hidden by default to preserve the existing configuration.
    
    To test, apply the patch and restart services.
    
     - Go to Administration -> MARC modification templates.
     - If necessary, add two or more templates.
     - Confirm that table of templates displays as a DataTable, with all
       associated sorting, filtering, export, etc.
     - The "id" column should be hidden by default.
     - Confirm that column visibility controls work correctly.
     - Confirm that the table settings found under Administration -> Table
       settings work correctly to set the default visibility of the table
       columns.
    
    Signed-off-by: Barbara Johnson  <barbara.johnson@bedfordtx.gov>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a34bdcb59fed089ad504a5f1b03f586d9b27efa2
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Mar 5 15:19:40 2021 +0000

    Bug 27882: Move external search results links out of page heading
    
    This patch modifies the JavaScript which adds search result information
    to the OPAC search results page which is returned from OverDrive,
    Recorded Books, or Open Library. The information now displays below the
    page heading instead of inside it.
    
    To test you must have OpenLibrarySearch enabled, OverDrive-related
    preferences populated (OverDriveClientKey, OverDriveClientSecret,
    OverDriveLibraryID), or RecordedBooks preferences (RecordedBooksClientSecret,
    RecordedBooksDomain, RecordedBooksLibraryID).
    
    This patch was written with OverDrive and Open Library results active.
    
    - Apply the patch and perform a search in the OPAC catalog.
    - On the search results page you should see results for your external
      services appear below the page heading ("You search returned..."),
      e.g.
    
      "Found 20257 results in the library's OpenLibrary collection"
      "Found 337 results in the library's OverDrive collection"
    
    Signed-off-by: Lucas Gass <lucas@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d8bafe7eaea827f3084783bc5a9cf383ddbff7c9
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Sun Mar 21 13:11:25 2021 +0000

    Bug 27498: (follow-up) Update to display logic
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b20827b1489e9fd225d20f16036fc12bb3f37c9d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Wed Feb 3 12:04:31 2021 +0000

    Bug 27498: Add a link for the Hold Ratios to Acquisitions home page
    
    This patch adds a link to the hold ratios report in the Acquisitions
    sidebar menu under the "reports" heading.
    
    To test, apply the patch and go to Acquisitions. The link to the hold
    ratios report should be there and it should work correctly.
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    Signed-off-by: Amit Gupta <amitddng135@gmail.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1dcba130d63f8a878dc7d4f6fc23ac88825c3d63
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 21 13:55:58 2021 +0200

    Bug 26838: Compiled CSS changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 20450829eb5132966dc1d8a37cfdceb696f91b65
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri Oct 30 12:33:54 2020 +0000

    Bug 26838: Improve styling of checkin message
    
    This patch makes some changes to the style and use of the "problem"
    class in the staff interface:
    
    - Remove the background color
    - Remove the extra line height
    
    Some changes to the template:
    
     - Remove the problem class from the checkin message. The checkin
       message configuration determines whether the dialog is an alert or a
       message-style dialog.
     - Add Font Awesome icons to the "problem" messages in patron details
       and serials collection. This is to help emphasize the message for
       users  who might have difficulty seeing the color difference.
    
    To test, apply the patch and rebuild the staff interface CSS
    (https://wiki.koha-community.org/wiki/Working_with_SCSS_in_the_OPAC_and_staff_client).
    
     - Go to Administration -> Item types and configure a checkin message
       for an item type: Add a message and select "Message" as the checkin
       message type.
     - Check in an item with that item type and confirm that you see the
       checkin message. It should be displayed in a message-style dialog
       without any additional styling.
     - Change the item type configuration to use "Alert" as the checkin
       message type. Confirm that the correct style is shown in this case as
       well.
    
     - Locate a patron with a NULL value in borrowers.password. View the
       detail page for that patron.
     - Under the "Library use" heading, the "Password" line should contain a
       link with the text "Undefined," preceded by a red-colored Font
       Awesome  icon.
    
     - In Serials, locate a subscription which is expired.
     - View the details for the subscription, and then open "serial
       collection" from the sidebar menu.
     - On the serial collection page there should be a cell in the
       subscription summary table showing the message "Subscription expired"
       preceded by a red-colored Font Awesome icon.
    
    Signed-off-by: Salman Ali <salman.ali@inLibro.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 701e2877eeda5f469fcef9289b87e3c5124b302d
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 11 12:15:35 2021 +0000

    Bug 8280: Add koha set and item fields to pqf.properties
    
    This patch adds a 'koha' set to the pqf properties and maps some basic
    koha fields to all for searchign
    
    To test:
    1 - Apply patch
    2 - cp etc/z3950/pqf.properties /etc/koha/sites/kohadev/z3950/pqf.properties
    3 - sudo koha-z3950-responder --restart kohadev
    4 - Test a search:
        curl -XGET "http://localhost:2100/biblios?version=1.1&operation=searchRetrieve&query=koha.itemtype=BK&maximumRecords=60&recordSchema=marcxml"
    5 - Test other fields added:
        koha.withdrawn
        koha.lost
        koha.classification-source
        koha.materials-specified
        koha.damaged
        koha.restricted
        koha.cn-sort
        koha.notforloan
        koha.ccode
        koha.itemnumber
        koha.homebranch
        koha.holdingbranch
        koha.location
        koha.barcode
        koha.onloan
        koha.itemtype
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] Copied the changes from z3950 to zebradb too.
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 303518c6f3f0032bf8cf1e546e71fa30755470e5
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Fri Jun 18 06:48:38 2021 +0000

    Bug 8280: Sync whitespace differences between pqf config files
    
    Test plan:
    Diff etc/zebradb/pqf.properties with the etc/z3950 one.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 238500c9651306038629ac7f50bea13103029541
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 10 16:30:31 2021 +0100

    Bug 27600: Remove password check from `add_hold`
    
    As suggested in the bugzilla comments, the add_hold method also
    doesn't require the password checking code.
    
    Test plan
    1/ Run t/db_dependent/SIP/ILS.t and watch it pass
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e8eef4879004ac19a0fb157b813befdd4b565612
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 10 16:09:17 2021 +0100

    Bug 27600: Remove password check from `cancel_hold`
    
    As suggested in the bugzilla comments, the cancel_hold method also
    doesn't require the password checking code.
    
    Test plan
    1/ Run t/db_dependent/SIP/ILS.t and watch it pass
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5699c825ccd89bc4166c5e8abfc4b3c39f8ad859
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 3 10:03:31 2021 +0000

    Bug 27600: Remove password check from SIP2 `renew_all`
    
    This patch removes the password check code from the renew_all method for
    SIP2. This is required, as many units send an empty AD field in the SIP
    message which can cause the transaction to fail.. but the authentication
    should have already taken place earlier in the session.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1b9d18fdefe8531a210a1c091aede1e793112111
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed Feb 3 10:16:30 2021 +0000

    Bug 27600: Add unit test
    
    This patch adds a basic unit test to catch the case where patron_pwd is
    sent to renew_all as an empty string.
    
    Test plan
    1/ Run t/db_dependent/SIP/ILS.t and watch it fail
    2/ Apply second patch
    3/ Re-run the above test and watch it pass.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3cb8446d760dd67c9f834eb911b6982e9b9a11ef
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 21 11:56:17 2021 +0000

    Bug 15788: DBRev 21.06.00.004
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cb9d3839c963ab7315cd734611af51721c2bfad1
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Jun 12 10:55:22 2021 -0300

    Bug 15788: Make the API require the new permission
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 571444e99c8b069ac7e7651d1da2d294f4858ae8
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Sat Jun 12 10:43:09 2021 -0300

    Bug 15788: (QA follow-up) Simplify query in update
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 138fb47e1fe429d937a9d9aaa2c0588c14386bdb
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jan 12 14:24:41 2021 +0000

    Bug 15788: Use delete_borrowers permission
    
    Link the new delete_borrowers sub-permission to the delete actions.
    
    Test plan
    1/ Remove the delete_borrowers permission from a staff user
    2/ Check that the user cannot use the 'Delete' option from the members
    menu.
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c782a03956307a44a3b7228cca0af11d29f033e3
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jan 12 14:06:45 2021 +0000

    Bug 15788: Add delete_borrowers permission
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b82c91d8cb99e10da8e78477de4a68352b562955
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 3 13:01:43 2021 +0200

    Bug 28514: Remove getletter
    
    The way we handle notice templates is confusing (see bug 27660, bug 26787, bug 28487).
    
    This patch remove C4::Letters::getletter and use either Koha::Notice::Templates->find
    or the newly created methods ->find_effective_template that will do
    all necessary to return the correct template.
    
    Test plan:
    - Create and modify notice templates
    - Make sure you have TranslateNotices turned on and that some notices
    templates have a translated version
    - Use holds_reminder.pl and overdue_notices.pl cronjobs and confirm that
    the generated notices are the expected ones
    - Test also pos/printreceipt.pl
    - And finally test some other notices (CHECKIN, RENEWAL for instance)
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    [EDIT] Amended by removing comment for $params={%$params}
    
    JD amended patch:
    * Add missing POD
    * Fix spelling (dont  ==> don't)
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d785a5536f52da2d48dd681ce5bd1276b5e0d7b8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue May 11 09:39:42 2021 +0100

    Bug 28264: (QA follow-up) Impliment fix for debit_type_code
    
    The fix for the debit_type line was also missing.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d1def24428eb48e4eaa7e546c8b589ae5be540e6
Author: Ivan Dziuba <ivan.dziuba@inlibro.com>
Date:   Thu May 6 15:33:02 2021 -0400

    Bug 28264: Transaction type is empty is cash register statistics wizard report
    
    To test:
    1) Go into a patron file and add some manual fees and pay them
    2) Go to Reports > Statistics wizards > Cash register
    3) In the form, choose Transaction type: All transactions
    4) Click "Submit"
    5) Note that the Transaction type column is empty
    6) In the form, choose Output: To a file
    7) Click "Submit"
    8) Open the file in a spreadsheet software (I use LibreOffice)
    9) The Transaction type column IS NOT empty
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 63d6c1d8c583a734bd289f01a423133f0c56bb0e
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Oct 27 11:48:30 2020 +0100

    Bug 26860: facets.inc refactor availability facet
    
    To prepare new facet, this patch refactors the availability facet,
    without any change in restult.
    Appart from an id 'facet-availability', like other facets.
    
    Test plan:
    1) Perform a search in staff interface
    2) Check availability facet displays well
    3) Click on it
    4) Check availability facet displays well
    
    Signed-off-by: Séverine QUEUNE <severine.queune@bulac.fr>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c08c344325f086a9d97cd2075c98d4de30b389ae
Author: Kyle M Hall <kyle@bywatersolutions.com>
Date:   Fri May 7 11:16:54 2021 -0400

    Bug 12169: Fix SIPconfig.xml, restore missing end tag
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d94d81fdf7031e13d66b05cacffe2ed0706ecf63
Author: Colin Campbell <colin.campbell@ptfs-europe.com>
Date:   Thu May 1 15:17:44 2014 +0100

    Bug 12169: Use pid file in sipserver shutdown
    
    Change sample SIPConfig to request server writes a pid file
    
    Use this pid in shutdown rather than the current open to error
    method.
    
    Have also added to the Config parameters to ensure that the sipserver
    runs as the correct user and sets its own session id. These are always
    useful but makes it easier for users to run up the sipserver as root at
    boot time similarly to apache, mysql etc
    
    Added to the sample config where to locate other server parameter
    documentation.
    
    Removed from the sample config the unedifying, unwanted and
    purely historical http example
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4c79fe761b9fee8bce811466cfff6838f4c9251f
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jan 7 10:55:35 2021 +0100

    Bug 27348: Fix test on ALTERNATE_INDEXER_DAEMON in koha-indexer
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 44ef42430890e0cdfc07425d366ac9edba725bf1
Author: David Cook <dcook@prosentient.com.au>
Date:   Thu Jan 7 00:22:03 2021 +0000

    Bug 27348: Fix test on INDEXER_PARAMS in koha-indexer
    
    koha-indexer doesn't test INDEXER_PARAMS correctly which causes errors
    to display when stopping/starting the daemon.
    
    This patch fixes the test so that the variable is tested as a string,
    so that no errors are created and the params are passed correctly.
    
    Test plan:
    0. Apply patch
    1. vi /etc/default/koha-common
    2. Add the following to the bottom of the file:
    INDEXER_PARAMS="-daemon -sleep 6"
    3. cp debian/scripts/koha-indexer /usr/sbin/koha-indexer
    4. koha-indexer --stop kohadev
    5. Note no errors
    6. koha-indexer --start kohadev
    7. Note no errors
    8. ps -efww | grep "indexer"
    9. Note that rebuild_zebra.pl has the arguments "-daemon -sleep 6"
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b6fa81ef5e7c356cb0bd74fb7f41077b40ccb59f
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 7 16:36:20 2021 +0000

    Bug 28443: Terminology: Issuing should be Checking out
    
    This patch modifies the title element of the batch checkout page so that
    it uses the phrase "Batch check out" instead of "Issuing."
    
    To test, apply the patch and enable BatchCheckouts system preference.
    
    - Open a patron for checkout who has a category included in the
      BatchCheckoutsValidCategories system preference.
    - Click the "Batch check out" tab and confirm that the page's title is
      correct.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 265da90e0f3a147684f8f26081afdb5b4363e823
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 24 10:58:00 2021 +0000

    Bug 28428: Capitalization: Password Updated
    
    This patch corrects the case of two headings on the "Change password"
    page in the staff interface.
    
    As far as I can tell these strings are never seen because the page
    redirects to the patron detail page instead of redisplaying after a new
    password or username is submitted.
    
    A visual inspection of the patch may be the only test.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 748e1c0630f54a957972f524124eb0c0974831c3
Author: Mason James <mtj@kohaaloha.com>
Date:   Sun Dec 6 18:33:58 2020 +1300

    Bug 28476: Update info in docs/teams.yaml file
    
    to test...
     1/ apply patch
     2/ view 'about' page to confirm info is updated
    
    Signed-off-by: Magnus Enger <magnus@libriotech.no>
    Looks good.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 28476: Update info in docs/teams.yaml file (2)
    
    oops, correct info
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7d8b2d67ff7d0fcce717e197fb8b7d0c84ac2be4
Author: Didier Gautheron <didier.gautheron@biblibre.com>
Date:   Tue May 4 09:15:52 2021 +0200

    Bug 28280: itemtype page, add price formatting
    
    To Test:
    1- create an item type with a 'Default replacement cost' and a
    'Processing fee (when lost)'
    2- numbers are displayed with 6 decimals.
    4- apply patch
    5- numbers are displayed with 2 decimals.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f55688626f87c5f4165d06a713f32e5577ab011
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 7 12:26:02 2021 +0000

    Bug 28522: Correct eslint errors in staff-global.js
    
    This patch makes minor corrections to staff-global.js in order to quiet
    warnings from ESLint. This includes:
    
    - Remove unused variables
    - Declare undeclared variables
    - Update list of global and exported variables and functions
    - Correct whitespace
    - Remove an unused function (paramOfUrl)
    
    To test, apply the patch and clear your browser cache if necessary.
    
    - Confirm that the first search header form field has focus when
      switching bewteen pages.
    - Confirm that text entered in any search header form field persists
      when you switch search header form tabs, e.g. a word typed into the
      "Check out" tab is copied to the "Check in" form when you switch to
      that tab.
    - Perform a search from the "Search the catalog" tab in the header. On
      the search results page and any following detail page your search term
      should remain in the header search form.
    - From a bibliographic detail page, confirm that selecting a list from
      the "Add to list" button menu correctly triggers a popup window.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c788d6205b0938e8cd54106d4372c053626add2e
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 24 10:24:59 2021 +0000

    Bug 28427: Terminology: Shelf should be list
    
    This patch corrects the title element on the download list page in the
    staff interface.
    
    The affected page should never be seen by the user because other
    error-handling should take precedence. In order to see it you have to
    set up such an error:
    
    - Log into the staff client as a user with existing lists.
    - Open the Lists page.
    - Open one of your lists in a new tab.
    - In the original tab, delete the list you opened.
    - In the tab showing the contents of the list, click the "Download" menu
      button and select an option.
    - You should be redirected to a page with an error message at the top.
    - The title of this page should be correct: "Download list."
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f83d773ada85e3c092f68291d1ec4468f84135d
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Fri May 21 17:11:09 2021 +0000

    Bug 28423: JavaScript error on MARC modifications page
    
    This patch makes a minor change to the MARC modifications template so
    that the "mmtas" variable isn't defined if there is no JSON to be
    assigned as its value.
    
    To test, apply the patch and go to Administration -> MARC modification
    templates.
    
     - If necessary, add a template with at least one action.
     - Check the browser console, there should be no errors.
     - Click the "Edit" button corresponding to one of the template actions.
     - The details of the action should load correctly in the edit form and
       there should be no errors in the console.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3efe55d8db1f792d40ee3964cc3eba610576eadc
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 17 09:38:15 2021 +0000

    Bug 28582: Fix hashref in a warning message
    
    Can't enqueue letter HASH(0x55edf1806850)
    
    Test plan:
    If you cancel an article request when there is no email address
    (no branch email, no KohaAdminEmailAddress), Koha warns.
    Verify that the warning now contains the letter code.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0ec355514692d267d22d130e77bac22d512f3f1
Author: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
Date:   Thu Jun 10 14:02:16 2021 +0000

    Bug 28545: Noisy uninitialized warn at opac-MARCdetail.pl line 313
    
    Test plan:
    You do not even need a NULL value in a authorised value controlled
    item field, a zero in damaged or withdrawn is enough to trigger the
    warnings. (Because only the 1 is linked to an authvalue.)
    
    Check your plack-opac-error.log before and after applying this change.
    
    Signed-off-by: Marcel de Rooy <m.de.rooy@rijksmuseum.nl>
    Without the patch I had at least four warnings per item: withdrawn,
    lost, damaged and notforloan.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 399b24d53795734ab869366dc6e54e9cfb42a6b2
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri May 28 13:33:24 2021 +0300

    Bug 28479: Use primary keys to check object existence in TestBuilder
    
    The TestBuilder::build_object function used any foreign keys to check
    whether an object already exists or not. This brought incorrectly
    results of unrelated objects because using any other keys other than
    primary keys don't guarantee our results to point to one single
    object. For example, as is put here in the unit test, if you created
    two items with the same biblionumber and then tried to create a hold
    using build_object() we were using the biblionumber to check whether
    an item was linked to the hold already. Thus, we were checking whether
    a random item was already linked to the hold instead of the one we
    wanted either by passing it explicitly to build_object() or the one
    build_object() created implicitly. This also resulted in following
    warnings when there were more than one match:
    
    DBIx::Class::Storage::DBI::select_single(): Query returned more than
    one row.  SQL that returns multiple rows is DEPRECATED for ->find and
    ->single at /kohadevbox/koha/t/lib/TestBuilder.pm line 235
    
    To test:
     $ prove t/db_dependent
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a3c5ecd0e451504000b3d929e486dea95220b0f7
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri May 21 09:37:54 2021 +0200

    Bug 28388: Preserve "Browse results" when "view plain" is clicked
    
    This patch modifies the way search sessions are preserved in the OPAC so
    that viewing the "plain MARC" view will not cause the search context to
    be lost.
    
    To test, apply the patch and make sure OpacBrowseResults is enabled.
    
    - Perform a search in the OPAC which will return multiple search
      results.
    - View the details of one of the search results.
      - You should see a "Browse results" box in the right-hand sidebar.
    - Click the "MARC view" link.
      - If you click back to the "Normal view" now, the results browser
        should still appear.
      - From the MARC view, click the "view plain" link.
      - Return to the "Normal view."
        - Before the patch: The results browser is gone.
        - After the patch: The results browser is still there.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fefd252f0a80c1d9ddb81cd6ffddb93f7972364b
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 7 18:47:25 2021 +0000

    Bug 28511: Road types in OPAC should prefer OPAC description if one exists
    
    This patch modifies the patron entry form in the OPAC so that if street
    types are defined in authorized values, the OPAC description is
    preferred.
    
    To test, apply the patch and go to Administration -> Authorized values.
    
    - Add or edit entries in the "ROADTYPE" category.
      - Some entries should have only the "Description" set, while others
        should have "Description" and "Description (OPAC)".
    - In the OPAC, open the patron registration page. Check the "Stree type"
      drop down in the "Main address" section.
      - For entries which have an OPAC description, this value should show.
      - For entries without an OPAC description the default should show.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a6adf70decc9caa691dce12db9a5505c861cff04
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon May 24 15:55:43 2021 +0000

    Bug 28422: OPAC MARC detail view doesn't correctly evaluate holdability
    
    This patch modifies the MARC detail view in the OPAC so that it
    evaluates whether a title can be placed on hold in the same way it is
    done on the "normal" detail page and the ISBD detail page. This allows
    for consistency in the display of the "Place hold" link.
    
    To test, apply the patch and log into the OPAC.
    
     - Perform a search which will return results, at least one of which can
       be placed on hold.
     - View the detail page, the MARC detail page, and the ISBD detail page.
       In each case the "Place hold" link should appear in the sidebar.
     - View the same pages for a record which cannot be placed on hold to
       confirm that the link doesn't appear. For instance:
       - All items are not for loan.
       - All items are lost.
       - There are no items attached.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e961e45daa8e66f9b2e99eab61014462f1370387
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Mon May 24 13:13:10 2021 +0000

    Bug 21286: Add Corporate-name as phrase to zebra indexes
    
    When using Zebra for searching, Koha performs a number of searches in order
    to improve relevancy. This means that even for 'wordlist' search, we perform a phrase search.
    
    When selecting 'Corporate-name' as an index, this expansion of the search causes errors and fails
    the search
    
    We can fix this for 'Corporate-name' searches by adding a phrase index
    
    To test:
     1 - Edit koha-conf.xml and uncomment the zebra debug line and add 'request' to the list
     2 - Restart all
     3 - tail -f /var/log/koha/kohadev/zebra-output.log
     4 - Edit a record to add a 110 field e.g. 'House plants'
     5 - Enable syspref IntranetCatalogSearchPulldown
     6 - Search for 'Corporate name' and term 'House plants'
     7 - No results
     8 - View the log, see 'ERROR' and full search terms listed
     9 - Apply patch
    10 - copy the zebra files to the production instance:
        cp etc/zebradb/marc_defs/marc21/biblios/biblio-koha-indexdefs.xml /etc/koha/zebradb/marc_defs/marc21/biblios/biblio-koha-indexdefs.xml
        cp etc/zebradb/marc_defs/marc21/biblios/biblio-zebra-indexdefs.xsl /etc/koha/zebradb/marc_defs/marc21/biblios/biblio-zebra-indexdefs.xsl
    11 - restart all
    12 - rebuild: sudo koha-rebuild-zebra -v -f kohadev
    13 - Repeat search
    14 - Success!
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 66a20e0431a81d4b78f7028d772be827f616d8ea
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 13 11:25:36 2021 +0100

    Bug 28344: Restore ability to issue refund against older payments
    
    When implimenting the refund features into the point of sale system, it
    appears that at some point we lost the ability to apply refunds against
    accountlines in the historic transactions table. This patch restores
    that ability.
    
    Test plan:
    1/ Add some transations via the point of sale system
    2/ Navigate to the 'register details' page and note that you have the
    option to refund some of the lines.
    3/ Use the Cashup option to make the transactions historic
    4/ Refresh the page and then select a past date to see the historic
    transactions in the second datatable
    5/ Note that the option to refund has not dissapeared from all lines
    6/ Apply patch
    7/ Refresh and note the refund option now appears as expected.
    
    Signed-off-by: Sally <sally.healey@cheshiresharedservices.gov.uk>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f6ffc9a0dbb156a1d845ca35834c28ddf53b6680
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 21 10:53:48 2021 +0200

    Bug 28313: (follow-up) Define roadtypes
    
    It's not necessarily defined at this point
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ab162534e3f4eb484d1339f69b178257809e7f4c
Author: Lucas Gass <lucas@bywatersolutions.com>
Date:   Mon May 10 21:16:59 2021 +0000

    Bug 28313: Add street type to alternate address in OPAC
    
    1. Add some values to the ROADTYPE authorized value
    2. Go to PatronSelfRegistrationBorrowerUnwantedField and make sure B_streettype is NOT checked
    3. Go the self reg form, no alternate address street type field
    4. Apply patch
    5. Check the self reg form, B_streettype should be there with all the options defined in ROADTYPE a.v.
    6. Check the self modification form, B_street type should be there.
    7. Make sure PatronSelfRegistrationBorrowerUnwantedField and PatronSelfModificationBorrowerUnwantedField hide the field correctly.
    8. Make sure PatronSelfRegistrationBorrowerMandatoryField properly makes the field required.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 4b7446abca1edbcb580acc42ec36690971a004d4
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Thu Jun 3 23:33:11 2021 +0000

    Bug 28191: Upate wording on batch patron deletion
    
    This adds another point to the list of things that prevent patron
    deletion:
    
    <li>They have permissions assigned to them.</li>
    
    In order to test:
    - Go to tools > patron deletion and anonymization
    - Verify the new condition shows at the top of the page.
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0276ca0ce810173fc49d15391770a8b5a1b0e8aa
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Fri Jun 4 14:06:53 2021 +0300

    Bug 28513: Fix analytics search links so they don't match unrelated biblios
    
    At least when using Searchengine=Elasticsearch what happened was that
    without () parenthese included the search for Host-item field was done
    only to the first token, the subsequent ones matched any
    fields. Adding the parentheses restrict the search to Host-item search
    field only.
    
    To test:
     1) Set Searchengine = elasticsearch
     2) Make a biblio with 245a = "biológica paranaense." and 773a = "Acta"
     3) Go to a biblio with 245a = "Acta biológica paranaense" (in
     kohadevbox or create one if you need).
     4) Notice that the "Acta biológica paranaense" biblio's detail page link "Show
     analytics" takes to the "biológica paranaense" incorrectly just
     because the 773a has "Acta" and the words "biológica" and "paranaense"
     appear elsewhere in the biblio.
     5) Apply patch and notice the link is now not created at all
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a0813c97c56cc828b6d3e99e77e6c879c05ca253
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 17 10:26:20 2021 +0200

    Bug 28271: Add (current status)
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f93d28e8c6fec635eba2281b4490d47c0fc54018
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon May 3 16:04:16 2021 +0200

    Bug 28271: Preselect the current item lost value
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e775c1b66830ff251774b5645eb8d46f5b6b85b4
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 30 15:21:46 2021 +0200

    Bug 28271: Adjust API spec
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58db137c0aeda1f0a1d5f1972f1f415c31be62ed
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Apr 30 15:13:26 2021 +0200

    Bug 28271: Add the ability to set a new lost status when a claim is resolved
    
    When a claim is resolved the librarian should be able to edit the lost
    status of the item.
    
    It is also letting a way out when BlockReturnOfLostItems is set (the
    lost status is stuck on ClaimReturnedLostValue as we remove the
    option to edit itemlost on the item edit form).
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f7f8b771c665f646330a21759b1fc8501033d675
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 11 17:44:01 2021 +0000

    Bug 27929: (QA follow-up) Hide tag editor on regex
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 289e0aba7560afddc93a080ec1bac31d11c266d0
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Mar 11 16:22:13 2021 +0100

    Bug 27929: Allow regex for subfield linked with cataloguing plugin
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 10e7e6697204cff9f11f69626a287c8e9edec5e7
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Thu Jun 10 15:05:51 2021 +0200

    Bug 28542: Move new authority from Z39.50/SRU to a button
    
    Actually in authority tools bar, 'New from Z39.50/SRU' is inside 'New autority' menu.
    This is different from biblio cataloguing toolbar, and adds a click to access it.
    
    I propose to move this to its own button.
    
    Test plan :
    1) Create a Z39.50/SRU server connexion for authorities
    2) Go to authorities home page
    3) Check you see buttons 'New autority' and 'New from Z39.50/SRU'
    4) Click on 'New autority'
    5) Check you only see autority types
    6) Click on 'New from Z39.50/SRU'
    7) Check you go to Z39.50/SRU popup
    8) Delete Z39.50/SRU server connexion for authorities
    9) Go to authorities home page
    10) Check you dont see 'New from Z39.50/SRU'
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 3f6a77d721a992d78e8ed2cc52ceaf7910700d59
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Jun 11 17:50:32 2021 +0000

    Bug 28526: (QA follow-up) Don't search if query is blank
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 50cc36524390c2823e83a3978f3866b19c18e08a
Author: Fridolin Somers <fridolin.somers@biblibre.com>
Date:   Tue Jun 8 10:43:34 2021 +0200

    Bug 28526: Impossible to search only zero
    
    In staff interface and OPAC, searching only zero leads to advanced search page.
    
    Test plan :
    1) Go to opac home page
    2) Enter 0 into search field
    => Without patch you go to advanced search page
    => With patch you go to results page
    3) Idem on staff interface
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 639aa95a50c3900590b376e56f39272fcd7ea109
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jun 17 16:02:35 2021 -0300

    Bug 28586: (follow-up) updated_by should be set
    
    This patch makes the route set the 'updated_by' attribute as well, when
    resolving a return claim through the API.
    
    Tests are added for this behavior.
    
    To test:
    1. Apply this patch
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/return_claims.t
    => SUCCESS: Tests pass! updated_by is set correctly!
    3. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit aa8fc8c0ee283e08620a41abb96285ca81eec83a
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Jun 17 12:49:56 2021 -0300

    Bug 28586: Pass the right parameter to resolve claim
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e917b5788ccc406263b49eda7bce6177260f73e6
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 17 15:41:46 2021 +0200

    Bug 28519: Add lib to koha-shell
    
    Test plan:
    % koha-shell kohadev -c 'echo $PERL5LIB'
    => /kohadevbox/koha:/kohadevbox/koha/lib
    
    % koha-shell kohadev
    echo $PERL5LIB
    => /kohadevbox/koha:/kohadevbox/koha/lib:/kohadevbox/qa-test-tools
    
    Note that this is not consistent but at least we have lib now in both
    situations
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 40089a0a538dffca7ee5bd619b902b9830e4460c
Author: David Cook <dcook@prosentient.com.au>
Date:   Mon Jun 7 00:14:55 2021 +0000

    Bug 28519: Put CGI::Session::Serialize::yamlxs in lib directory
    
    This patch adds a "lib" directory to the source tree which gets
    mapped to the same directory as "C4" and "Koha" for single and
    standard installations.
    
    CGI::Session::Serialize::yamlxs is put into this "lib" directory.
    
    This patch also includes some changes so that dev/git installations
    work as well.
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 323acde9911343864633718ca6f2d1b7f11c00cf
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 16 14:44:14 2021 +0200

    Revert "Bug 20985: Unit tests"
    
    This reverts commit 5600f7e23e40b72040bcf66d27f21b4107860cbe.

commit 3d5fa815be0a6853703bc3c65e5d786f745ec78a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 16 14:44:10 2021 +0200

    Revert "Bug 20985: Add OnShelfHoldsAllowed checks to CanItemBeReserved"
    
    This reverts commit a151d7ba0f233745d716d439881818e8ed8f7c57.

commit 602331127ec59a7e896422781b43815ff7ee3abd
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Mon Jun 14 14:49:43 2021 -0300

    Bug 28503: (follow-up) Get rid of tests warnings
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit acb0fdb688acec538b2be24f03a2f725957d2323
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 2 15:20:08 2021 +0000

    Bug 28503: Compare item homebranch to patron branch when hold policy set to 'from_home_library'
    
    This fixes an issue in the way we calculate the check for hold policy 'from_home_library'
    
    Currently we change the comparison based on ReservesControlBranch, however, that should
    only control the rule we fetch, not how we compare
    
    When ReservesControlBranch is set to "patron's home library" we compare the patron's branch to
    the patron's branch, this is useless and means we pass the check for all branches all of the time
    
    We should instead compare the patron's branch to the item's branch, and only fetch the rule using ReservesControlBranch
    
    To test:
     1 - Have a record with an item from library A and library B
     2 - Set the 'Default checkout, hold and return policy'->Hold policy->From home library for all libraries
         and ensure you have no branch specific/itemtype specific rules set
     3 - Attempt to place a hold on the record for a patron from library B
     4 - Note that only the library B item is holdable - place a title level hold (do not choose an item)
     5 - Check in the item from library A
     6 - It fills the hold - This is incorrect - ignore the hold
     7 - Apply patch
     8 - Restart all the things
     9 - Check in the item from library A
    10 - No hold found
    11 - Check in the item from library B
    12 - Hold found, correctly
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Bug 28503: Clarify what ReservesControlBranch controls
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 19f2684d5ad5a0bc55343113336aedb4f985fe4e
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 2 15:05:08 2021 +0000

    Bug 28503: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6fdbf5cce01b73f17d8407c61eb587edbb7f3fa4
Author: Owen Leonard <oleonard@myacpl.org>
Date:   Mon Jun 7 16:02:35 2021 +0000

    Bug 28488: Javascript error in self-checkout (__ is not defined)
    
    This patch adds inclusion of the internationalization JavaScript which
    is required by the newest version of the DataTables include. It
    references the double-underscore function provided by i18n.js.
    
    To test, apply the patch and log into the self-checkout system as a user
    with checkouts. The table of checkouts should display correctly and
    there should be no JavaScript errors in the console.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b21b42afa7a0cb1b68f5b0daf49bdb30052ef1b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jun 5 16:08:46 2021 +0200

    Bug 28518: Display missing inputs for "Return to the last advanced search"
    
    When more than 3 search terms are passed on the advanced search form,
    the "Return to the last advanced search" feature does not display them.
    
    Test plan:
    Perform an adv search at the OPAC, enter more than 3 terms, launch the
    search, click the "Return to the last advanced search" link and confirm
    that all the entries are there.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a56c4f63ba4af04ab1655200dfdd797e7338b176
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 11 13:25:57 2021 +0200

    Bug 28383: Fix itemsearch when accessed from the login form
    
    There are params here (credentials), we need to test for the existence of $format.
    
    Test plan:
    logout
    access /cgi-bin/koha/catalogue/itemsearch.pl
    Login
    => Without this patch you get a 500 (because we hit the exit statement)
    => With this patch you see the items search form.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a151d7ba0f233745d716d439881818e8ed8f7c57
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Tue Nov 17 14:24:36 2020 +0100

    Bug 20985: Add OnShelfHoldsAllowed checks to CanItemBeReserved
    
    The expected behaviour for "On shelf holds allowed" setting for the circulation rules (Koha administration > Patrons and circulation > Circulation and fines rules):
    - Allow holds only on items that are currently checked out or otherwise unavailable.
    - If set to "Yes", patrons can place holds on items currently checked in.
    - If set to "If any unavailable", patrons can only place holds on items that are not unavailable.
    - If set to "If all unavailable", patrons can only place holds on items where *all* items on the record are unavailable.
    (Adapted from https://bywatersolutions.com/education/preparing-for-library-closures)
    
    These rules should also work when using ILS-DI, but currently they don't. This bug makes sure that the "On shelf holds allowed" rules work correctly when using ILS-DI to place holds.
    
    Test plan:
    
    1. Enable ILS-DI (set the ILS-DI system preference to Enable).
    2. Go to Koha administration > Patrons and circulation > Circulation and fines rules.
    3. Work through steps 4-5 for each of the settings for "On shelf holds allowed" for all libraries/patron categories/item types:
       . "Yes", "If any unavailable", and "If all unavailable"
    4. Staff interface - place a hold on a record with items available for loan, the rules should work as expected before and after the patch is applied:
       . "Yes"
          ==> information column in the item table displays "Not on hold", the hold is placed, cancel the hold
       . "If any unavailable" and "If all unavailable"
          ==> the hold is not placed, message is "Cannot place hold. No items are available to be placed on hold.", red "X" in the hold column and the information column displays "Not on hold".
    5. ILS-DI - place a hold on a record with items available for loan (note: without the patch, holds can be placed):
       . Query to place a hold using ILS-DI on a title that have all its items available,
         example query: http://127.0.0.1:8080/cgi-bin/koha/ilsdi.pl?service=HoldTitle&patron_id=1&bib_id=1&request_location=127.0.0.1
         ==> Without the patch the hold is placed but it shouldn't be allowed, cancel the hold
       . Query to place a hold using ILS-DI on an available item,
         example query: http://127.0.0.1:8080/cgi-bin/koha/ilsdi.pl?service=HoldItem&patron_id=1&bib_id=1&item_id=1)
         ==> Without the patch the hold is placed but it shouldn't be allowed, cancel the hold
    6. Run the tests prove t/db_dependent/Reserves.t - these should pass.
    7. Apply the patch (and flush_memcached and restart_all if using koha-testing-docker).
    8. Run through steps 3-6 again, and note the changes when "If any unavailable" and "If all unavailable" options are used:
       . For the staff interface: there should be no change in behavour and should work as expected, for the red "X" in the items table additional text is added "onShelfHoldsNotAllowed".
       . For ILS-DI: these should now work as expected, with holds not placed, and this message in the results returned <code>onShelfHoldsNotAllowed</code> (check to confirm no holds place for either the patron or the item)
       . Tests: should still pass.
    9. Sign off.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5600f7e23e40b72040bcf66d27f21b4107860cbe
Author: Arthur Suzuki <arthur.suzuki@biblibre.com>
Date:   Thu Mar 21 21:52:06 2019 +0100

    Bug 20985: Unit tests
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5b86322b4ac28428ca4cb74eaf47c9319bc94841
Author: Katrin Fischer <katrin.fischer.83@web.de>
Date:   Tue Jun 1 04:43:23 2021 +0000

    Bug 28467: (QA follow-up) Remove errorenous space in borrowers.lastseen
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f8c59169b4a8a8e7ff32c81eea179da4b48941d6
Author: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
Date:   Wed Jun 2 14:58:53 2021 +0000

    Bug 28467: Update wording of TrackLastPatronActivity syspref
    
    To Test:
    1 - look up TrackLastPatronActivity
    2 - Read it, be dissatisfied with it
    3 - apply patch, restart, reload page
    4 - be happier with the new wording
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 97f6d9a0878bc911863b5de3288c6da553fef78d
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Jun 8 11:14:20 2021 +0300

    Bug 28520: Allow creating a transfer back automatically if a hold is canceled during transit
    
    This fixes regression caused by "Bug 12362: Cancel transfer with hold
    cancelation" where cancelled hold's transfer didn't show up in
    intranet and opac because it create a new transfer that was not yet
    put in in-transit state. The original idea of bug 12362 was to be able
    to trigger transfer back home if a hold was cancelled (a regression
    caused by bug 26078). However, we can do it more simply by setting the
    $validTransfer variable true in the item check-in code when we are
    dealing with Reserve transfers. More down in the AddReturn() code
    there is also a check "and !$resfound" to make sure we only try to
    trigger the transfer back home automatically if there is no hold
    waiting at the current location the item arrived in.
    
    It should be noted however that now we only display generic message
    for the automatic transfer reason. Bug 12362 made the return display
    as the reason "Transfer was cancelled whilst in transit". However,
    since this fixes the original regressions caused by bug 26078 and
    restores similar behaviour to that I think giving a more descriptive
    message for example regarding a hold being cancelled can be considered
    a further enhancement.
    
    To test:
     1) Apply patch
     1) Have biblio with item in branch A
     2) Create a new hold with a pickup library to branch B
     3) Check-in the item at branch A and confirm the hold and transfer
     4) Cancel the hold
     5) Check-in the hold at branch B and notice it prompt to return it to
     branch A
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 939aa2c868f7c71027fe1e06670c506903404ea2
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Jun 8 10:55:52 2021 +0300

    Bug 28520: Bring back TransferCancellation reason handling from reverted Bug 12362
    
    The code from Bug 12362 was reverted but there might be still in
    database transfers with the reason 'TransferCancellation' so we need
    to restore the code to handle displaying that information.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 39e88fc1f77d3926e4beae7353c920098093d5b7
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Jun 8 07:50:29 2021 +0000

    Bug 28520: Revert "Bug 12362: Reverse transfer upon cancellation"
    
    This reverts commit d0407686eb070c5bdf0302147a198027abea5ac0.
    
    This commit was part of a series adding adding reverse transfers, i.e.
    transfers that were created for transfers that were cancelled and
    we wanted the item to return back to its sending library. This however
    hid the information about transfer happening and we need another approach
    to the problem.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb7cf86879c2b5881359668bada45414aa065637
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Jun 8 07:50:05 2021 +0000

    Bug 28520: Revert "Bug 12362: Cancel transfer with hold cancelation"
    
    This reverts commit 6c105829144cd341a4bc65ad8d0ee1f996b423d4.
    
    This commit was part of a series adding adding reverse transfers, i.e.
    transfers that were created for transfers that were cancelled and
    we wanted the item to return back to its sending library. This however
    hid the information about transfer happening and we need another approach
    to the problem.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    Rebased-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    JD amended patch: restore Koha::Item::Transfer->from_library (we are
    adding tests in a future patch).
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit cea528dbf36c6967b7e364e11ab304fa94718bd4
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Jun 8 07:47:32 2021 +0000

    Bug 28520: Revert "Bug 12362: (QA follow-up) Fix ModItemTransfer cancellation handling"
    
    This reverts commit fbba09f63f200d3e57a8612554984d807867cf84.
    
    This commit was part of a series adding adding reverse transfers, i.e.
    transfers that were created for transfers that were cancelled and
    we wanted the item to return back to its sending library. This however
    hid the information about transfer happening and we need another approach
    to the problem.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 28a154a02cacf964312ff68f74dd9e92ddf29bde
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Tue Jun 8 09:27:50 2021 +0100

    Bug 24434: DBIC Update
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a99f0a77d66599eb054deee92a3a1b138c2492a8
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue Jun 15 14:41:01 2021 +0000

    Bug 24434: DBRev 21.06.00.003
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8128b0d8f1b5f3e9cd6a5a3796a56dbb4e4fab3a
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 6 14:14:24 2021 +0100

    Bug 24434: Add 'WrongTransfer' to cancellation_reasons
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit e75ecdea92f2033f064557804b50c09db7b31937
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 17 10:42:04 2021 +0100

    Bug 24434: Submit on print slip
    
    This patch ensures that the print slip option on the WrongTransfer modal
    also submits the form and thus triggers the actual transfer of the item.
    
    We also prevent a double transfer submission (and thus a cancellation
    line appearing in the branchtransfers table) for the case where a
    transfer back home is triggered.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ba678553ce179760d21a900471ad90935c3c567b
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 10 10:11:19 2021 +0100

    Bug 24434: Unit tests for updateWrongTransfer
    
    Add unit tests to cover updateWrongTransfer
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Bug 24434: (QA follow-up) Remove tab character
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit fb413a87d166adc205b9249b1ed829bb4627a7ae
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 10 09:12:38 2021 +0100

    Bug 24434: Add Unit Tests for relations
    
    This patch adds unit tests for the newly introduced to_library (and also
    add the missing test for the existing from_library).
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b031ec58453c29fb0fe6469cdadc511e56b9397d
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 6 13:53:51 2021 +0100

    Bug 24434: Reinstate updateWrongTransfer
    
    This patch re-instates the call to updateWrongTransfer to ensure the
    transfer line is updated to reflect the new frombranch.
    
    Test plan
    note: when applying the patches, also update the database
    
    1/ Check an item out from it's home library
    2/ Check the item in at another library
       (with AutomaticItemReturn system preferences enabled)
    2a/ Accept the transfer and note we now have a transfer present from the
        items check-in library to it's home library
    3/ Check the item in at a third library
    3a/ Note you are asked to return the item to it's home library.
    3b/ With the patch applied, the modal title should highlight that a
        'Wrong transfer' was detected.
    4/ Go to the item record and note the holding library has been updated
       to reflect where the item was most recently checked in.
    4a/ With the patch applied the item status should reflect the last
        checked in branch as the 'from' branch of the transfer.
    5/ check-in from a 4th library, but use the 'Print slip' option for
       accepting the transfer and confirm that also works.
    6/ check-in from a 5th library, but use the 'Cancel' option and check
       that this results in the item staying at it's current location and the
       final transfer having been cancelled.
    
    Signed-off-by: Victor Grousset/tuxayo <victor@tuxayo.net>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit b0f9033f135aef4c114a335c477be22603f82e90
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Tue Jun 15 11:56:43 2021 +0300

    Bug 27064: Correct transferbook.t tests to reflect new behaviour of transferbook()
    
    The transferbook() behaviour was changed so that it only allows
    transferring the item with a reserve if ignore_reserves=1 is passed to
    it. The tests are changed here to reflect that. Note that however the
    tests were buggy already before this change because the transfer's
    "from" and "to" branches were the same and so the transfer should have
    failed due to the error DestinationEqualsHolding, but futher though
    the transferbook() code was buggy and it override the
    DestinationEqualsHolding checking totally if there was a transfer! So
    the tests were earlier working due to a bug in transferbook().
    
    To test):
       1) Make sure the new test scenarios make sense
       2) prove t/db_dependent/Circulation/transferbook.t
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c66ddc0926984b605eca70b40dab19c91c508a83
Author: Alexis Ripetti <alexis.ripetti@inLibro.com>
Date:   Thu May 13 11:09:05 2021 -0400

    Bug 28350: Fix borrowernotes sorting for patron search
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 333ee7260072c02bb28f2d9e576de0c494f134e6
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 12 17:02:27 2021 -0300

    Bug 28338: Default to holding branch to save clicks
    
    This patch makes request.pl pass the holding library object to the
    template, if it is a valid pickup location for the item. This way, the
    template can set a good default to save clicks.
    
    To test:
    1. Have "Hold pickup library match" set to "Item's home library"
    2. Have a record with items in three different branches. For example:
       - item1: homebranch: MPL, holdingbranch: MPL
       - item2: homebranch: FPL, holdingbranch: FPL
       - item3: homebranch: CPL, holdingbranch: IPT
    3. Have FPL marked as 'No' for pickup location
    4. On the record, open the page for placing a hold for a patron
       (acevedo?)
    => SUCCESS: You are presented the regular hold placing page, with an
    extra column on the items for pickup location setting
    => SUCCESS: The item2 (on FPL) cannot be selected, there's a clear message
    about not having valid pickup locations
    => FAIL: The other ones don't have anything pre-selected on the
    dropdowns
    5. Apply this patch
    6. Repeat 4 (go back to the record, etc)
    => SUCCESS: Nothing changed BUT the item with holding branch = MPL has
    it set by default in the dropdown.
    => SUCCESS: IPT is not a valid pickup location for item3, so not set by
    default in this case.
    7. Sign off :-D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7fbb07ba59373f9b815c67c3737d1cbafa397736
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Wed May 12 15:19:29 2021 -0300

    Bug 28338: Make item-level holds use locally defined pickup branches
    
    Besides the commit subject, this patch does much more:
    - It makes request.pl stop passing a pickup location to
      CanItemBeReserved
    - It makes the page use the API to render a dropdown for each item, with
      their valid pickup locations
    - Items with no valid pickup locations have a nice message about why
      they are disabled for selection
    
    To test:
    1. Apply this patch
    2. Choose a biblio for placing a hold
    3. Choose a patron
    => SUCCESS: You are presented with a new layout, that includes a
    dropdown for choosing each item's pickup location. If an item is not
    holdable, it still isn't.
    4. Try having an item whose home branch is not marked as a pickup
       location
    => SUCCESS: Notice you cannot choose that item
    5. CHoose an item, but do not choose a branch, and click 'Place hold'
    => SUCCESS: It shows an alert about the need to choose a pickup location
    6. Choose one of the (only possible) pickup locations for the specific
       item
    7. Place the item level hold
    => SUCCESS: All goes as expected!
    8. Sign off :D
    
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bbe424dcfbe67c0f73231948b61fb949c2a8daf2
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 16:30:52 2021 -0300

    Bug 27931: Add GET /items/:item_id/pickup_locations
    
    This patch adds the mentioned route. It does so by:
    - Adding the new path in paths.json
    - Adding the full route spec in items.json
    - Adds a controller method that takes care of the task
    
    To test:
    1. Apply this patches
    2. Run:
       $ kshell
      k$ prove t/db_dependent/api/v1/items.t
    => SUCCESS: Tests pass!
    3. Play with your favourite REST tool. Pay special care to
       the AllowHoldPolicyOverride syspref and the expected behaviors.
    => SUCCESS: All works as expected
    4. Sign off :-D
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8f0fe0c6f02854f20efa6b6397817bc4c1edc37c
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Thu Mar 11 16:30:18 2021 -0300

    Bug 27931: Unit tests
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit d75b0c7c72d6050f533aa3b3b4eb40af7f5ace6c
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Wed Jun 9 17:59:59 2021 +0000

    Bug 28538: Insert formatted date if valid
    
    This patch restores the setting of the date from bug 27937 and adds a parsing of the date to
    ensure the correct format
    
    To test:
    1 - Follow test plan from bug 27937 - it fails
    2 - Follow test plan from bug 28351 - it succeeds
    3 - Apply patch
    4 - Repeat 1-2
    5 - both plans pass now
    
    Signed-off-by: Andrew Fuerste-Henry <andrew@bywatersolutions.com>
    Signed-off-by: Tomas Cohen Arazi <tomascohen@theke.io>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit db35077e76245ac8527a343bed8c768f6a27755b
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 4 12:19:18 2021 +0200

    Bug 28487: Fallback to default template in overdue_notices
    
    There is no fallback to the "default" language if there is no
    language-specific template for the lang of the patron.
    
    I am not really sure why we are not using GetPreparredLetter here (which
    defaults), but this needs to be backported into all stable branches and
    so as small as possible.
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 01734a9ca38b698c449b967b2ceddc3153bf10a1
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 14 14:37:03 2021 +0000

    Bug 28490: DBRev 21.06.00.002
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 7a0de31b0a57b22255c7805de911c272e9ed3553
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Jun 7 05:30:35 2021 +0000

    Bug 28490: Add DBIx schema changes for testing
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 64afd5e24d5aba0e26eade5d259550b014753455
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 2 20:37:25 2021 +0300

    Bug 28490: Bring back accidentally deleted relationship columns
    
    These were in active use before and were accidentally deleted in Bug
    26995. This restores those deleted relationship columns.
    
    To test:
     1) verify the borrower_modifications, borrowers,
        deletedborrowers contain the column exactly like it was before after
        applying these patches by comparing to the old kohastructure.sql
        version
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 26bf540268af59808fb17ec8000abfe2db265a51
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 2 20:22:51 2021 +0300

    Bug 28490: Comment out the relationship data removing DB update step
    
    These columns that were actively used to store non-patron guarantor
    relationship info were dropped incorrectly. In a later patch the
    relationship fields will be re-added.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD Amended patch: Add a "SKIP" note on the DBrev we commented out
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit bc1c556ebdea433b4f2f8bd53bdd2901f4cd3106
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 2 17:14:08 2021 +0000

    Bug 28490: Revert "Bug 26995: Drop column relationship from borrowers, deletedborrowers and borrower_modifications tables"
    
    This reverts commit ca0e7541ecdff13ada9ba8ffbd992c963959d30f.
    
    It was part of a patch set that removed actively used data and must be
    therefore reverted.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 07b8008a037e152f5f7ac23014c96dd91a2ba6cf
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 2 17:13:12 2021 +0000

    Bug 28490: Revert "Bug 26995: Remove references to relationship column"
    
    This reverts commit 1cc8a77c287666ed878ea58f17216793f52ce224.
    
    It was part of a patch set that removed actively used data and must be
    therefore reverted.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ebece43a9601754e0a055187cce0efe538333db8
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 2 17:12:16 2021 +0000

    Bug 28490: Revert "Bug 26995: Fix SQL syntax error on the about page"
    
    This reverts commit 1131bb687f14fef7b4cb5f3b194711e85f9227af.
    
    It was part of a patch set that removed actively used data and must be
    therefore reverted.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 640068ed5c7f819e008f1817e717ed006d45add5
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 2 17:11:02 2021 +0000

    Bug 28490: Revert "Bug 26995: Remove occurrences in sample_patrons.yml"
    
    This reverts commit 690b073478b04c7c801058b49f85275281c502d5.
    
    It was part of a patch set that removed actively used data and must be
    therefore reverted.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1c0bf00f9d2f5191e4238debe488de734174841f
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Jun 2 17:08:25 2021 +0000

    Bug 28490: Revert "Bug 26995: Remove one remaining occurrence in moremember"
    
    This reverts commit c3b50e9e97e917090ce09283807168caaad3de4a.
    
    It was part of a patch set that removed actively used data and must be
    therefore reverted.
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Emmi Takkinen <emmi.takkinen@koha-suomi.fi>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit df5c500843c655816bd02dfec76b44da90809f52
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 14 16:34:15 2021 +0200

    Bug 28489: DBIC schema changes
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e8a2d58af2975a3dbb96c1fc0ccb337d5a520dc
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Mon Jun 14 14:34:48 2021 +0000

    Bug 28489: DBRev 21.06.00.001
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit a502ae7b68bd2edeeeaaa163834b5a7854a6ac22
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jun 5 15:27:02 2021 +0200

    Bug 28489: Don't deal with encoding during the serialization
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 1887f3b53fbd78c0dfa114942d57df2f24b7a954
Author: Andrew Nugged <nugged@gmail.com>
Date:   Fri Jun 4 22:32:22 2021 +0300

    Bug 28489: POD - CGI::Session::Serialize::yamlxs for CGI::Session
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8df6ac9c882cd7e5a19b2e735cf4efce9d73442a
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Sat Jun 5 14:50:48 2021 +0200

    Bug 28489: Add selenium tests
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    JD amended patch: Remove libraries the tests created
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 58b56de1c4f37b0037868cc7be7f15d01b8b2f96
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Thu Jun 3 11:28:57 2021 +0200

    Bug 28489: Modify sessions.a_session from longtext to longblob (kohastructure.sql)
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 0e1ca19a4865260201f221887251a930dbecc736
Author: Julian Maurice <julian.maurice@biblibre.com>
Date:   Wed Jun 2 16:05:17 2021 +0200

    Bug 28489: Modify sessions.a_session from longtext to longblob
    
    This column contains serialized data, it should be a blob.
    And it fixes encoding issues.
    
    Test plan:
    1. Apply patch and run updatedatabase
    2. In $KOHA_CONF make sure that you have
       <strict_sql_modes>0</strict_sql_modes>
    3. Create 2 libraries:
      a. TESTÄ/Testä
      b. TEST✓/Test✓
    4. Go to the staff interface, change your library to Testä, then
       navigate to a few other pages, make sure there is no encoding problem
       with the library name in the top right corner
    5. Do the same with Test✓
    
    Signed-off-by: Petro Vashchuk <stalkernoid@gmail.com>
    Signed-off-by: Andrew Nugged <nugged@gmail.com>
    
    Signed-off-by: David Cook <dcook@prosentient.com.au>
    
    Signed-off-by: Nick Clemens <nick@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit f401137d0624d8516e1325b66ff05c17c3f49c27
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Wed May 19 09:37:35 2021 +0100

    Bug 28382: Set trigger to 'Reserve' when actioning a reserve transfer
    
    This patch sets the transfer trigger to 'Reserve' when the staff user
    confirms they are transfering to fulfil a reserve.
    
    Test plan
    1 - Place a hold for delivery at Library B
    2 - Sign in at Library A
    3 - Browse to Circulation->Transfers
    4 - Attempt to transfer an item on the title with the hold to Library B
    5 - You get a notice that hold was found
    6 - You have the option transfer the for the hold - click it
    7 - Confirm hold is set to transit and transfer generated
    8 - Check the branchtransfers table and confirm the 'reason' is
      'Reserve' not 'Manual'.
    
    Signed-off-by: David Nind <david@davidnind.com>
    JK: fix typo resver -> reserve
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit ad03c9e8f83ee60bd8c7d8df85cc07e0b2326556
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Mon Jun 7 17:07:04 2021 +0300

    Bug 27064: (QA follow-up) Add error message only if we have one defined
    
    This moves the DestinationEqualsHolding error message addition to if
    clause so the value is added to %err hash only when there is actually
    an error. Then we only append to the @errmsgloop array the error
    message if one was defined.
    
    To test:
     1) Create a hold request to a pickup library where the item currently
     is not
     2) Add transfer to the pickup library using branchtransfers.pl and
     notice without this patch we get and empty message box but with this
     patch we don't get it.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 630468bf08d9ebb62c9e07fb7de85824b64aef42
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Thu May 6 16:31:39 2021 +0100

    Bug 27064: (QA follow-up) Pass 'replace' through to Koha::Item::Transfer->cancel
    
    The `replace` option found in Koha::Item->request_transfer should be
    passed through to Koha::Item::Transfer->cancel and prevent any reverse
    transfers from being queued in such cases.
    
    This prevents modItemTransfer from adding superflous reverse transfers
    whenever it is used.
    
    Test plan
    1/ Run t/db_dependent/Koha/Item.t to prove the new tests pass
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 6ac4542948c451595a154a5467e548a43e9817e8
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 17 15:51:46 2021 +0100

    Bug 27064: (QA follow-up) Do not create transfer prior to accepting it
    
    This patch prevents the cancellations we were seeing. Transfers were
    being created pre-emtively for reserves in branchtransfers before the
    librarian had selected their prefered action. As such, we were getting
    double lines in the branchtransfers table.
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit be7c1efa7b328608d61afdacc2a224c0a88bef47
Author: Martin Renvoize <martin.renvoize@ptfs-europe.com>
Date:   Mon May 10 11:06:36 2021 +0100

    Bug 27064: (QA follow-up) Do not send tobranchcd twice
    
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 8cb7747544ffa30eb093251c30d40b36f16c4872
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri Nov 20 11:34:11 2020 +0000

    Bug 27064: Only allow transferring a hold from the transfers page
    
    These patches replace the 'Waiting' button on the transfers page with a 'Transfer' button
    and correct some other related problem by passing the hold object to the template and
    using that to fetch patron info as well as passing the reserve_id through to ensure the correct hold is
    affected at all times
    
    To test:
     1 - Place a hold for delivery at Library B
     2 - Sign in at Library A
     3 - Browse to Circulation->Transfers
     4 - Attempt to transfer an item on the title with the hold to Library B
     5 - You get a notice that hold was found (missing patron/branch info)
     6 - You have the option to set the hold waiting - click it
     7 - The transfer is generated and marked completed
     8 - The hold is marked as waiting, but the item is still at Library A and no transfer is active
     9 - The patron is notified that the hold is waiting
    10 - Revert the hold or cancel and place a new one
    11 - Apply patches
    12 - Attempt transfer again
    13 - You now have the option to transfer the hold
    14 - Click that
    15 - Hold is in transit and transfer is generated correctly
    16 - Transfer again and choose 'cancel'
    17 - Confirm hold is cancelled and transfer generated
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    Signed-off-by: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 5f9333ffda0b0479f16e0e80b4f73687b2caae3e
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Fri Jun 4 12:09:48 2021 +0200

    Bug 28204: Compiled CSS
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 80b632c3cc1dbf2e309d0693f6b53b8055f3a319
Author: Petro Vashchuk <stalkernoid@gmail.com>
Date:   Thu May 20 16:12:18 2021 +0300

    Bug 28204: Fix table highlighting on the items table
    
    Fix table highlighting at
    /cgi-bin/koha/cataloguing/additem.pl?biblionumber=XXXX
    Every odd row of the table didn't get highlighted with the yellow color
    when you tried to edit it previously, this patch fixes that.
    That happened because every odd row had different coloring style that
    was overwriting yellow highlight.
    
    How to reproduce:
    1) Head over to the
    /cgi-bin/koha/cataloguing/additem.pl?biblionumber=XXXX,
    where XXXX is id of some bilbio record that has more than one
    biblio item.
    2) Press the "Action" button of the first (or any other odd numbered)
    biblion item, and from the dropdown menu select "edit" option.
    3) Notice that it doesn't highlight it with yellow color.
    4) Now do the same but with second biblio item (or any even numbered
    item).
    5) Notice that it highlights it with the yellow color.
    6) Apply the patch. Do yarn build to compile css.
    7) Make sure that every row of the table that you edit gets properly
    highlighted with the yellow color.
    
    Signed-off-by: Owen Leonard <oleonard@myacpl.org>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    JD Amended commit title
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52a884db7e37598248f1eaef4cd1a9434c9faf18
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Thu Jun 3 15:38:01 2021 +0200

    Bug 28171: Restore comment to remove ambiguity
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 95745fb1dd1eb948b0d81e06728004e3b3381913
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Apr 21 19:19:07 2021 +0300

    Bug 28171: Restore previous sorting behaviour for Serial enumchron column
    
    Before Bug 27980 the sorting was done either by item's publisheddate
    if it existed in at least one item. If it didn't exist then the
    sorting was done using "h - Serial Enumeration / chronology"
    field. This restores this sorting functionality in catalogue/detail.pl
    page.
    
    To test:
     1. Create a serial subscription for a biblio, make sure to enable the
        option "Create an item record when receiving this serial"
     2. Receive two serials, so that they have different received dates
        and check that the items are now created to the biblio
     3. Add now two additional items with one having "A" and other having
        "B" in the "h - Serial Enumeration / chronology" field.
     4. Try sorting and notice the items with publisheddate are being
        sorted and ones without stay in the order they happened to be
     5. Remove the items with publisheddate and notice that now items with
        "A" and "B" get sorted correctly
    
    Signed-off-by: Christian Nelson <christian.nelson@tritonia.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 76960e472e690700ba60bf14208c230e83337871
Author: Joonas Kylmälä <joonas.kylmala@helsinki.fi>
Date:   Wed Apr 21 15:34:57 2021 +0000

    Bug 28171: Revert "Bug 27980: Remove itemdata_publisheddate from controller"
    
    This reverts commit c7fef23763754ad65c5a59438ed370d53aeec4b6.
    
    The code is needed back to fix broken sorting.
    
    Signed-off-by: Christian Nelson <christian.nelson@tritonia.fi>
    
    Signed-off-by: Kyle M Hall <kyle@bywatersolutions.com>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 52c82407fda99a896bef9e18f564c018b333196c
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Tue May 18 09:41:40 2021 +0200

    Bug 28353: Display a list of items that cannot be deleted
    
    We used to display a list of items that cannot be deleted (checked out
    or on hold) on the Batch item deletion tool.
    With bug 8132 we improve the error handling, but the info is spread in
    the table.
    
    This patch adds, at the top of the page, the list of items (barcode)
    that cannot be removed.
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 35612f8223d7c758c42c28d45849fc6f42e67135
Author: Tomás Cohen Arazi <tomascohen@theke.io>
Date:   Tue Jun 1 13:14:05 2021 -0300

    Bug 28496: Club holds pickup locations don't come from the API
    
    This patch fixes a issue that is generated by the fact different inputs
    were reusing the same id.
    
    To test:
    1. Have a club with some enrollments
    2. Make sure you have your circ rules to allow any  library be a pickup
       location.
    3. Search for a biblio
    4. Try placing a club hold
    => FAIL: The dropdown only has the (currently) logged in library.
    5. Apply this patch
    6. Repeat 3-4
    => SUCCESS: The dropdown has all the options
    
    Signed-off-by: David Nind <david@davidnind.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit eaa1e75b992d8748857561f3ad4283b38c676774
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 28 12:02:19 2021 +0000

    Bug 28482: Refresh line from DB to get stored value
    
    Before checking if the amount is 0 we get the stored value from the DB. This
    ensures any amounts beyond the 6 digit precision we store will be removed.
    
    To test:
    1 - Add a processing fee of 15 to an itemtype
    2 - Add an item of that type, set the replacement fee to 12.63
    3 - Set MarkLostItemsAsReturned to 'On payment' only
    4 - Set  WhenLostChargeReplacementFee to 'Charge'
    5 - Checkout the item to a patron
    6 - Mark the item lost
    7 - Reload patron and confirm they are charged 27.63
    8 - Go to accounting, pay amount, pay 27.63
    9 - Item is still lost and not returned
    10 - Apply patch
    11 - Checkin the item
    12 - Checkout to another patron
    13 - Mark lost
    14 - Patron charged 27.63
    15 - Pay amount, 27.63
    16 - Item returned!
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit c9df1adfda1942cb517cb0e8698b231230d1fdcf
Author: Nick Clemens <nick@bywatersolutions.com>
Date:   Fri May 28 12:02:09 2021 +0000

    Bug 28482: Unit test
    
    Signed-off-by: Martin Renvoize <martin.renvoize@ptfs-europe.com>
    
    Signed-off-by: Katrin Fischer <katrin.fischer.83@web.de>
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>

commit 211b23df8b3f05bc40c519c441e64b451640326d
Author: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
Date:   Wed Jun 2 16:44:17 2021 +0200

    Koha 21.06 - start of a new dev cycle
    
    Run, rabbit run.
    Dig that hole, forget the sun,
    And when at last the work is done
    Don't sit down it's time to dig another one.
    
    ---
    
    Breathe
    Waters, Gilmour, Wright
    
    Signed-off-by: Jonathan Druart <jonathan.druart@bugs.koha-community.org>
